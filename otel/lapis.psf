; CASEMaker AcuBench Program Structure File, Version 9.2
; WARNING: DO NOT MODIFY THIS FILE!

[PROGRAM_CONTENT]
QUIT_CONFIRM=0
INIT_PROGRAM=1

{{@DESCRIPTION:

@}}

[WORKING_STORAGE]
m_nType=1
m_strName=Working Storage
m_bBlockRecords=1
m_bRecordFixed=1
m_bStandard=1
{{@FD_m_strDescriptionWK

@}}
[FDITEM0_WK]
m_strName=fs-santral
m_strRawPic=xx
m_strPic=XX
m_nItemLevel=77
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM0_WK
->telefon error hata...

@}}
[FDITEM1_WK]
m_strName=oda-var-yok
m_strRawPic=9
m_strPic=9
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM1_WK

@}}
[FDITEM2_WK]
m_strName=oda-yok
m_nItemLevel=88
m_nSync=-1
m_bFixed=1
m_strTrue=0
{{@DataItem_m_strDescriptionFDITEM2_WK

@}}
[FDITEM3_WK]
m_strName=oda-var
m_nItemLevel=88
m_nSync=-1
m_bFixed=1
m_strTrue=1
{{@DataItem_m_strDescriptionFDITEM3_WK

@}}
[FDITEM4_WK]
m_strName=sonuccopy
m_strRawPic=9
m_strPic=9
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM4_WK

@}}
[FDITEM5_WK]
m_strName=sira
m_strRawPic=9(04)
m_strPic=9(04)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM5_WK

@}}
[FDITEM6_WK]
m_strName=fs-mira
m_strRawPic=xx
m_strPic=xx
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM6_WK

@}}
[FDITEM7_WK]
m_strName=takas-adres
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM7_WK

@}}
[FDITEM8_WK]
m_strName=FILLER
m_strRawPic=x(20)
m_strPic=x(20)
m_strDefaultValue="/asya/ytl/liste/mira"
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
m_strAlias=FILLER__14
{{@DataItem_m_strDescriptionFDITEM8_WK

@}}
[FDITEM9_WK]
m_strName=FILLER
m_strRawPic=x
m_strPic=x
m_strDefaultValue="."
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
m_strAlias=FILLER__3
{{@DataItem_m_strDescriptionFDITEM9_WK

@}}
[FDITEM10_WK]
m_strName=takas-no
m_strRawPic=999999
m_strPic=999999
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM10_WK

@}}
[FDITEM11_WK]
m_strName=fs-lapisyedek
m_strRawPic=xx
m_strPic=xx
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM11_WK

@}}
[FDITEM12_WK]
m_strName=lapisyedek-dosya
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM12_WK

@}}
[FDITEM13_WK]
m_strName=FILLER
m_strRawPic=x(24)
m_strPic=x(24)
m_strDefaultValue="/asya/ytl/entegre/lapis/"
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
m_strAlias=FILLER__14
{{@DataItem_m_strDescriptionFDITEM13_WK

@}}
[FDITEM14_WK]
m_strName=lapisyedek-tarih
m_strRawPic=9(8)
m_strPic=9(8)
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
m_strAlias=FILLER__3
{{@DataItem_m_strDescriptionFDITEM14_WK

@}}
[FDITEM15_WK]
m_strName=lapisyedek-zaman
m_strRawPic=9(8)
m_strPic=9(8)
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
m_strAlias=FILLER__3
{{@DataItem_m_strDescriptionFDITEM15_WK

@}}
[FDITEM16_WK]
m_strName=lapisyedek-from
m_strRawPic=x(15)
m_strPic=x(15)
m_nItemLevel=2
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM16_WK

@}}
[FDITEM17_WK]
m_strName=fs-takas
m_strRawPic=xx
m_strPic=xx
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM17_WK

@}}
[FDITEM18_WK]
m_strName=kopyala-adres-local
m_strRawPic=x(250)
m_strPic=x(250)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM18_WK

@}}
[FDITEM19_WK]
m_strName=komut-satiri
m_strRawPic=x(250)
m_strPic=x(250)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM19_WK

@}}
[FDITEM20_WK]
m_strName=kopyala-adres-local-verilen
m_strRawPic=x(250)
m_strPic=x(250)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM20_WK

@}}
[FDITEM21_WK]
m_strName=yol
m_strRawPic=x(50)
m_strPic=x(50)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM21_WK

@}}
[FDITEM22_WK]
m_strName=BUF
m_strRawPic=X(512)
m_strPic=X(512)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM22_WK

@}}
[FDITEM23_WK]
m_strName=sis-date
m_strRawPic=x(8)
m_strPic=x(8)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM23_WK

@}}
[FDITEM24_WK]
m_strName=4hane
m_strRawPic=9(4)
m_strPic=9(4)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM24_WK

@}}
[FDITEM25_WK]
m_strName=3hane
m_strRawPic=9(3)
m_strPic=9(3)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM25_WK

@}}
[FDITEM26_WK]
m_strName=Copy-of-4hane
m_strRawPic=9(4)
m_strPic=9(4)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM26_WK

@}}
[FDITEM27_WK]
m_strName=sis-zaman
m_strRawPic=x(8)
m_strPic=x(8)
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM27_WK

@}}
[FDITEM28_WK]
m_strName=pol-bulundu
m_strRawPic=9
m_strPic=9
m_nItemLevel=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM28_WK

@}}
[FDITEM29_WK]
m_strName=vis-pen
m_strRawPic=9
m_strPic=9
m_strDefaultValue=0
m_nItemLevel=1
m_bValue=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM29_WK


@}}
[FDITEM30_WK]
m_strName=odemepen
m_strRawPic=9
m_strPic=9
m_strDefaultValue=0
m_nItemLevel=1
m_bValue=1
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM30_WK

@}}
[FDITEM31_WK]
m_strName=aranan-i
m_strRawPic=9
m_strPic=9
m_nItemLevel=77
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM31_WK

@}}
[FDITEM32_WK]
m_strName=xdepkod
m_strRawPic=9(3)
m_strPic=9(3)
m_nItemLevel=77
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM32_WK

@}}
[FDITEM33_WK]
m_strName=gelen-foliox
m_strRawPic=x(8)
m_strPic=x(8)
m_nItemLevel=77
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM33_WK

@}}
[FDITEM34_WK]
m_strName=gelen-folio9
m_strRawPic=9(8)
m_strPic=9(8)
m_nItemLevel=77
m_nSync=-1
m_bFixed=1
{{@DataItem_m_strDescriptionFDITEM34_WK

@}}


[LINKAGE_SECTION]
m_nType=1
m_strName=Linkage Section
m_bBlockRecords=1
m_bRecordFixed=1
m_bStandard=1
{{@FD_m_strDescriptionLK

@}}


{{@SCREEN:
*   Screen Painter Data
*   Schema 6.0
*
BEGIN-SPDATA

END-SPDATA

@}}

{{@REPORT:
*   Report Writer Data
*   Schema 6.0
*
BEGIN-RWDATA-6.0A

END-RWDATA

@}}

{{@PARAGRAPH:
*
 santral-aktar. 
    call "c$makedir" using "/asya/ytl/entegre".   
    call "c$makedir" using "/asya/ytl/entegre/lapis".   
    accept terminal-abilities from terminal-info.
**************************************************s
    move "IMZA"   to isyeri-adres-tasi.
    set environment "cursor_mode" to "2".
    accept tarih-tasi from century-date.

     move "9999" to k-kodu-tasi
   
     accept komut-satiri from command-line 
     inspect komut-satiri replacing trailing spaces by low-values
     unstring komut-satiri delimited by ";" 
     into isyeri-adres-tasi kopyala-adres-local dir-dosya-adres kopyala-adres-local-verilen  

     if isyeri-adres-tasi = spaces or 
        kopyala-adres-local = spaces or 
        dir-dosya-adres = spaces
            display message box
            "Asya-Soft Lapis Entegrasyon v1.7(Asya2Lapis)",x"0a0d0a0d",
            "Kullanim :",x"0a0d",
            "Komut satiri = program_kutuphane_ismi;lapis_entegrasyon_dizini;dosya_listesi_dosya_adi(path haric);lapis_local_verilen_dosya;"
            x"0a0d"
            "Gelen Parametreler ",x"0a0d",
            "program_kutuphane_ismi:",isyeri-adres-tasi,x"0a0d", 
            "lapis_entegrasyon_dizini:",kopyala-adres-local,x"0a0d",
            "dosya_listesi_dosya_adi:",dir-dosya-adres,x"0a0d",
            "lapis_local_verilen_dosya:",kopyala-adres-local-verilen
            icon mb_error_icon
            title "Asya2Lapis Komut Satiri Hatasi ..."
            goback
     end-if

     perform adresleri-tasi
       display window pop-up form1-handle
       display window 
               boxed shadow erase 
               line 2 col 4 size 75 lines 5
               color 64 reverse
               title "Asya-Soft Lapis Bilgi Aktarma Konsolu ~~~~~~~~"
               bottom right title "F2-Cikis".
 yeni-basla.
 yeni-basla-1.
     display "Start Transfer ...." line 1 col 1.

     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid
          continue
     end-read
     close genel.
     move calisma-tarihi           to tarih-tasi.


     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid 
             continue
     not invalid
           add 1 to ekran-fis-1 
           rewrite genelfis-rec invalid 
                   continue 
           end-rewrite
           compute takas-no = ekran-fis-1 + 115
     end-read 
     close genelfis


     open output takas  close takas  
     open i-o takas  with mass-update.

*->
              open input odalar konuk ulke polisxml
              initialize odalar-rec
              start odalar key not < odalar-anah invalid
                    close odalar konuk ulke polisxml
                    exit paragraph
              end-start
              initialize fs-odalar 
              perform with test after until fs-odalar = "10"
                    read odalar next no lock 
                       end move "10" to fs-odalar
                       not at end
              display  odalar-anah at 0101

                    initialize takas-rec 
                    perform konuk-ara thru konuk-ara-exit
                    move odalar-anah to takas-oda
                    move 0           to takas-dolu-bos
                      if odalar-hayali = "H"
                       if not oda-var 
                          exit perform cycle
                       end-if
                    end-if
                    if oda-var
                      
                       move 1            to takas-dolu-bos
                       move konuk-adi    to takas-adi
                       move konuk-soyadi to takas-soyadi
                       compute takas-kisi = konuk-buyuk + konuk-kucuk +
                                            konuk-free + konuk-bebek
                       move konuk-git-gun to takas-cik-gun
                       move konuk-git-ay  to takas-cik-ay
                       move konuk-git-yil to takas-cik-yil

                       move konuk-gel-gun to takas-gir-gun
                       move konuk-gel-ay  to takas-gir-ay 
                       move konuk-gel-yil to takas-gir-yil
                       move konuk-ulke    to ulke-anah
                       read ulke no lock invalid 
                            move "**********" to ulke-adi
                       end-read
                       move ulke-adi      to takas-ulke-adi
                       move 0 to pol-bulundu
                        perform polisxml-bul
                         if  pol-bulundu = 0 
                            write takas-rec invalid 
                                rewrite takas-rec invalid continue
                                end-rewrite
                           end-write,
                        end-if

                    end-if
                  

                     
                    end-read
              end-perform 

     open output mira
*     move  "    -----------------  " TO mira-rec
*       move X"0D"   to mira-crlf
*       write mira-rec end-write
     initialize takas-rec sira
     start takas key not < takas-anahtar invalid
                    close odalar konuk ulke polisxml
                    close takas
                    delete file takas
                    exit paragraph
              end-start
              initialize fs-takas
              perform with test after until fs-takas = "10"
                    read takas next no lock end move "10" to fs-takas
                      not at end
                        
                      add 1 to sira
                      move sira               to mira-sira
                      move takas-oda          to mira-oda
                      perform konuk-extra-bul
                      move takas-dolu-bos     to mira-dolu-bos   
                      move takas-adi          to mira-adi        
                      move takas-soyadi       to mira-soyadi     
                      move takas-kisi         to mira-kisi       
                      move takas-cik-gun      to mira-cik-gun 
                      move takas-cik-ay       to mira-cik-ay  
                      move takas-cik-yil      to mira-cik-yil 
                      move takas-ulke-adi     to mira-ulke-adi   
                      move takas-gir-gun      to mira-gir-gun 
                      move takas-gir-ay       to mira-gir-ay  
                      move takas-gir-yil      to mira-gir-yil 
                      move takas-tcno         to mira-tcno
                      move takas-pasport      to mira-pasport
                      move takas-dog-tar(1:4) to mira-dog-yil     
                      move takas-dog-tar(5:2) to mira-dog-ay
                      move takas-dog-tar(7:2) to mira-dog-gun

                      move ";"            to m-1 m-2 m-3 m-4 m-5 m-6 m-7 m-8 m-9 m-10 m-11 m-12 m-13
                      move "."            to mm-1 mm-2 mm-3 mm-4 mm-5 mm-6
                      if takas-cik-yil = 0
                         move spaces to mira-cik-gun 
                                        mira-cik-ay mira-cik-yil
                      end-if 
                      if takas-gir-yil = 0
                         move spaces to mira-gir-gun 
                                        mira-gir-ay mira-gir-yil
                      end-if 
                      move X"0D"   to mira-crlf

                      write mira-rec end-write
                    end-read
              end-perform

              move all low-values to buf
              inspect kopyala-adres-local replacing trailing spaces by low-values
              accept sis-date from century-date
              accept sis-zaman from time
              string buf,
                      "@[DISPLAY]:" delimited by low-values
                      kopyala-adres-local delimited by low-values 
*                      isyeri-adres-tasi delimited by low-values
*                      sis-date delimited by low-values
*                      sis-zaman delimited by low-values
                      "rooms.txt" delimited by low-values
                      into buf
               call "C$COPY" using "/asya/ytl/liste/lapis.txt" 
                      buf 
              giving sonuccopy
              close odalar konuk ulke polisxml

              close takas
              delete file takas

             open i-o onbkodlar10
             initialize onbkodlar10-rec
             move "EE"                 to onbkodlar10-tipi
             read onbkodlar10 no lock invalid
                  initialize onbkodlar10-rec
                  initialize onbkodlar10-entegrasyonlar
                  move "EE"            to onbkodlar10-tipi
             end-read


             accept onbkodlar10-lapis-tarih from century-date
             accept onbkodlar10-lapis-zaman from time
             rewrite onbkodlar10-rec invalid
                     write onbkodlar10-rec end-write
             end-rewrite
             close onbkodlar10


              perform lapisrcv
     .
 santral-aktar-exit.
    exit.
 dlldkdkd.
     destroy form1-handle
     initialize key-status.
     goback.
*
 mmesaj-ver.
     .
* Form1
 Acu-Form1-Evaluate-Func.
     EVALUATE TRUE
        WHEN Exit-Pushed
           PERFORM Acu-Form1-Exit
        WHEN Event-Occurred
           IF Event-Type = Cmd-Close
              PERFORM Acu-Form1-Exit
           END-IF
     END-EVALUATE
* avoid changing focus
     MOVE 1 TO Accept-Control
     .
 Acu-Form1-Display-Status-Msg.
     MODIFY Form1-St-1-Handle
        PANEL-WIDTHS (20, 80), 
        PANEL-STYLE (1, 1), 
        PANEL-TEXT ("F2->Durdur...", SPACE), 
        GRIP, FONT IS Traditional-Font, 
     .

 Acu-Form1-Clear-Status-Msg.
     PERFORM Acu-Form1-Display-Status-Msg
     .

 Acu-Form1-Exit.
     SET Exit-Pushed TO TRUE
     .
 Form1-Ex-Other.
     .
 Form1-Event-Proc.
     .
 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other.
 konuk-ara.
    initialize konuk-rec oda-var-yok.
    move "I"          to konuk-durumu.
    move odalar-anah  to konuk-odano.
    start konuk key = konuk-oda invalid
          initialize konuk-rec
          move odalar-anah  to konuk-odano
          go konuk-ara-exit.
 konuk-oku.
    read konuk next no lock end go konuk-ara-exit.
    if fs-konuk = 99 go konuk-oku.
    if konuk-odano      > odalar-anah  go konuk-ara-exit.
    if konuk-durumu not = "I" go konuk-ara-exit.
    if konuk-fol-kodu   = "R" or konuk-fol-kodu = "G" or konuk-fol-kodu = "E"
       continue
    else 
       go konuk-oku
    end-if.
       move 1 to oda-var-yok.

 konuk-ara-exit.
       exit.
*
* polisxml-bul.
*     initialize polisxml-rec
**     move konuk-rez-no        to polisxml-rezno
*     start polisxml key not < polisxml-anah invalid
*           continue
*     not invalid
*     perform with test after until fs-polisxml = "10"
*     read polisxml next no lock end move "10"   to fs-polisxml
*     not at end
*             if polisxml-rezno <> konuk-rez-no
*                exit perform
*             end-if
*             evaluate polisxml-sirano
*             when 1
*                 move polisxml-dog-tar       to takas-d-tarih
*                 if polisxml-uyruk(1:2) = "TC"
*                    move polisxml-tckimlikno to takas-tc-pasaport1
*                 else
*                    move polisxml-kseri      to takas-tc-pasaport1
*                 end-if
*             when 2
*                 move polisxml-adi         to takas-adi2
*                 move polisxml-soyadi      to takas-soyadi2
*                 if polisxml-uyruk(1:2) = "TC"
*                    move polisxml-tckimlikno to takas-tc-pasaport2
*                 else
*                    move polisxml-kseri      to takas-tc-pasaport2
*                 end-if
*
*             when 3
*                 move polisxml-adi         to takas-adi3
*                 move polisxml-soyadi      to takas-soyadi3
*                 if polisxml-uyruk(1:2) = "TC"
*                    move polisxml-tckimlikno to takas-tc-pasaport3
*                 else
*                    move polisxml-kseri      to takas-tc-pasaport3
*                 end-if
*             end-evaluate
*     end-read
*     end-perform
*     end-start
      .


*
 lapisrcv.

     open input depkod kur.
     open i-o konuk romhrk onkasa exthrk nt
     set environment "EXTEND_CREATES"         to 1.
     move dir-dosya-adres  to lapisrcv-dir-dosya
     perform lapisrcv-dir-cek.
     if lapisrcv-donus <> 0 
        exit paragraph.
     perform lapisrcv-kur-oku.
 
     if lapisrcv-donus <> 0 
        exit paragraph.

     perform lapisrcv-dir-oku.
     close depkod romhrk onkasa konuk exthrk kur nt.

 
*
 lapisrcv-dir-cek.
     accept lapisrcv-tarih from century-date
     accept lapisrcv-zaman from time
     inspect kopyala-adres-local-verilen replacing trailing spaces by low-values.
     inspect dir-dosya-adres replacing trailing spaces by low-values.
     inspect lapisrcv-dir-dosya replacing trailing spaces by low-values.
     move all low-values to lapisrcv-from-dosya lapisrcv-to-dosya
     string lapisrcv-from-dosya 
            "@[DISPLAY]:" delimited by low-values
            kopyala-adres-local-verilen delimited by low-values
            lapisrcv-dir-dosya delimited by low-values
            into lapisrcv-from-dosya

     
     string lapisrcv-to-dosya
            "/asya/ytl/liste/" delimited by low-values
            lapisrcv-tarih delimited by low-values
            lapisrcv-zaman delimited by low-values
            ".rcv" delimited by low-values
            into lapisrcv-to-dosya

     move lapisrcv-to-dosya               to dir-dosya-adres.
     perform lapisrcv-copy.
     if lapisrcv-donus <> 0 
        exit paragraph.
*
 lapisrcv-dir-oku. 


     open input dir-dosya 
     perform with test after until fs-dir-dosya = "10"
     initialize dir-dosya-rec
     read dir-dosya next no lock end move "10" to fs-dir-dosya
     not at end
          display dir-dosya-rec
          if dir-dosya-rec <> spaces
             move 0 to lapisrcv-donus
             perform lapisrcv-dosya-cek
             if lapisrcv-donus <> 1
                perform lapisrcv-islem
                if lapisrcv-donus = 0
                   perform lapisrcv-delete-file
                   perform lapisrcv-backup-file
                end-if
             end-if
          end-if
     end-read
     end-perform
     close dir-dosya .



*
 lapisrcv-dosya-cek.
     inspect dir-dosya-rec replacing trailing spaces by low-values
     move all low-values to lapisrcv-from-dosya lapisrcv-to-dosya
     string lapisrcv-from-dosya 
            "@[DISPLAY]:" delimited by low-values
            kopyala-adres-local-verilen delimited by low-values
            dir-dosya-rec delimited by low-values
            into lapisrcv-from-dosya

     initialize aranan-i 
     inspect dir-dosya-rec tallying aranan-i for all ".txt"

     if aranan-i = 1 
            string lapisrcv-to-dosya
            "/asya/ytl/liste/" delimited by low-values
            dir-dosya-rec
            into lapisrcv-to-dosya 

     else
            string lapisrcv-to-dosya
            "/asya/ytl/liste/" delimited by low-values
            dir-dosya-rec
            ".lps" delimited by low-values
            into lapisrcv-to-dosya
     end-if

   

     move lapisrcv-to-dosya         to lapis-dosya-adres

     perform lapisrcv-copy.


*
 lapisrcv-islem.
     open input lapis-dosya.
     initialize lapis-dosya-rec lapis-deg
     read lapis-dosya next no lock end-read
     close lapis-dosya.
     delete file lapis-dosya.
     if lapis-dosya-rec = spaces
        exit paragraph.

     display ".".

     unstring lapis-dosya-rec delimited by "|" into
              lapis-alan1      
              lapis-folio     
              lapis-dep     
              lapis-tarzaman     
              lapis-aciklama       
              lapis-alan8     
              lapis-tutar     
              lapis-alan10    
              lapis-alan11
              lapis-gelen-folio.

***"Start|1012|012|2012-08-11 14:24:03|ID: AO219010 / Paket: 1 Gün 3 Euro||3|EUR|End


     if lapis-folio = spaces or 
        lapis-tarzaman = spaces
             exit paragraph.

     move function numval(lapis-gelen-folio) to gelen-folio9
     inspect lapis-tutar replacing all "," by "v"
     inspect lapis-tutar replacing all "." by ","
     inspect lapis-tutar replacing all "v" by "."

     initialize depkod-rec
     move FUNCTION NUMVAL(lapis-dep) to xdepkod
     move xdepkod                    to DEPKOD-KODU.
     read depkod no lock invalid
          initialize lapisrcv-error-rec
          move lapis-dep           to  lapisrcv-error-aciklama
          move "-"                 to  lapisrcv-error-aciklama(4:)
          move "Departman Kodu Tanimlamasi Bulunamadi !!!" to lapisrcv-error-aciklama(5:)
          perform lapisrcv-hata-yaz
          move 2 to lapisrcv-donus
          exit paragraph
     end-read
     if function numval-c(lapis-tutar) <= 0
          initialize lapisrcv-error-rec
          move lapis-dep           to  lapisrcv-error-aciklama
          move "-"                 to  lapisrcv-error-aciklama(4:)
          move "Sifir TL!!!" to lapisrcv-error-aciklama(5:)
          perform lapisrcv-hata-yaz
          move 2 to lapisrcv-donus
          exit paragraph
     end-if
*********************ROYAL CÝNGOSSSS    -> IASSOSTA YILDIZLA
     move function numval-c(lapis-folio)        to 4hane
     move 4hane                                 to takas-oda

     if 4hane < 1000
          move function numval-c(lapis-folio)   to 3hane 
          move 3hane                            to takas-oda
     end-if

     perform konuk-extra-bul
     if mira-folio = spaces  and 4hane < 1000
            |3 haneli oda yoksa geldiði gibi oku
            move 4hane                         to takas-oda
            perform konuk-extra-bul
     end-if
     move mira-folio                            to lapis-folio
********************* ROYAL CÝNGOS   -> IASSOSTA YILDIZLA

     initialize konuk-rec
     move function numval-c(lapis-folio)         to konuk-folio
     read konuk no lock invalid
          initialize lapisrcv-error-rec
          move lapis-folio         to  lapisrcv-error-aciklama
          move "-"                 to  lapisrcv-error-aciklama(9:)
          move "Folio Bulunamadi !!!" to lapisrcv-error-aciklama(10:)
          perform lapisrcv-hata-yaz
          move 3 to lapisrcv-donus
          exit paragraph 
     end-read

     if gelen-folio9 <> lapis-folio  and gelen-folio9 <> zeroes 
            initialize lapisrcv-error-rec
            move lapis-folio         to  lapisrcv-error-aciklama
            move "-"                 to  lapisrcv-error-aciklama(9:)
            move "Gecmis Folio Cout Olmus !!!" to lapisrcv-error-aciklama(10:)
            perform lapisrcv-hata-yaz
            move 3 to lapisrcv-donus
            exit paragraph 
     end-if
     if konuk-durumu <> "I"
          initialize lapisrcv-error-rec
          move lapis-folio         to  lapisrcv-error-aciklama
          move "-"                 to  lapisrcv-error-aciklama(9:)
          move "Folio C/Out !!!"   to lapisrcv-error-aciklama(10:)
          perform lapisrcv-hata-yaz
          move 4 to lapisrcv-donus
          exit paragraph        
     end-if

     if konuk-git-tar < tarih-tasi
          initialize lapisrcv-error-rec
          move lapis-folio                to  lapisrcv-error-aciklama
          move "-"                        to  lapisrcv-error-aciklama(9:)
          move "Konuk Cikis Tarihi !!!"   to lapisrcv-error-aciklama(10:)
          perform lapisrcv-hata-yaz
          move 4 to lapisrcv-donus
          exit paragraph        
     end-if


     perform lapisrcv-fis-al.
     if lapisrcv-donus <> 0
        exit paragraph
     end-if.

     perform lapisrcv-onb-write.

*
 lapisrcv-onb-write.
     initialize hrkgir-rec
     move konuk-folio                        to hrkgir-folio
     move cekgir-oto                         to hrkgir-islem 
     move "E"                                to hrkgir-islem-tipi
*******************apüs 
     move CALISMA-TARIHI                     to hrkgir-tarih
*****     accept hrkgir-tarih                     from century-date
     move "B"                                to hrkgir-ba 
     accept hrkgir-zaman                     from time 
     move function numval-c(lapis-fis)       to hrkgir-cekno 
     move "LPS "                             to hrkgir-staf 
     move function numval-c(lapis-tutar)     to hrkgir-dv-tutar
     if konuk-banka not =  onkpara-banka then 
      perform  lapisfol-kur-al
       compute hrkgir-tl-tutar rounded = hrkgir-dv-tutar * lapisfol-kur 
     else
     compute hrkgir-tl-tutar rounded = hrkgir-dv-tutar * lapisrcv-kur 
     end-if
     move FUNCTION NUMVAL(lapis-dep) to xdepkod
     move xdepkod                    to hrkgir-depkod


********************kopyalanacak
*04062012    open input route konu2 rez kodlar02
*04062012    open i-o yromhrk
*04062012
*04062012    move hrkgir-rec  to yromhrk-rec
*04062012    move hrk2-data to yromhrk-data
*04062012    write yromhrk-rec invalid 
*04062012          initialize lapisrcv-error-rec
*04062012          move "YRomhrk->Kayit Yazilamadi<>"   to lapisrcv-error-aciklama
*04062012          move lapis-dosya-rec                to lapisrcv-error-aciklama(28:)
*04062012          perform lapisrcv-hata-yaz
*04062012          move 11 to lapisrcv-donus
*04062012          close yromhrk route konu2 rez kodlar02
*04062012          exit paragraph          
*04062012    end-write 
*04062012    close yromhrk
    
*04062012    perform folref-bul
*04062012    perform folref-ata
*04062012    close route konu2 rez kodlar02
*04062012    open i-o hrk2
*04062012    move hrkgir-anah to hrk2-anah
*04062012    move yromhrk-folio to hrk2-kaynak-folio
*04062012    write hrk2-rec end-write
*04062012    close hrk2
*04062012    move hrkgir-rec       to romhrk-rec exthrk-rec
**************** kopyalanacak


********************kopyalanacak
    open input route konu2 rez kodlar02 
    open i-o yromhrk

    move hrkgir-rec  to yromhrk-rec
    move hrk2-data to yromhrk-data
    write yromhrk-rec invalid stop " " end-write 
    close yromhrk
    
    perform folref-bul
    perform folref-ata
    close route konu2 rez kodlar02 
    open i-o hrk2
    move hrkgir-anah to hrk2-anah
    move yromhrk-folio to hrk2-kaynak-folio
    write hrk2-rec end-write
    close hrk2
    move hrkgir-rec       to romhrk-rec exthrk-rec
**************** kopyalanacak

*********************>>>>><<<<<<******************************
    initialize konuk-rec
    move hrkgir-folio          to konuk-folio
    read konuk no lock invalid
         continue
    end-read
*********************>>>>><<<<<<******************************


    if  konu2-fol-kodu = "R" 
        write romhrk-rec invalid
              initialize lapisrcv-error-rec
              move "Romhrk->Kayit Yazilamadi<>"   to lapisrcv-error-aciklama
              move lapis-dosya-rec                to lapisrcv-error-aciklama(27:)
              perform lapisrcv-hata-yaz
              move 6 to lapisrcv-donus
              exit paragraph
        end-write
        perform log-operation-romhrk
    else  
        write exthrk-rec invalid
              initialize lapisrcv-error-rec
              move "Exthrk->Kayit Yazilamadi<>"   to lapisrcv-error-aciklama
              move lapis-dosya-rec                to lapisrcv-error-aciklama(27:)
              perform lapisrcv-hata-yaz
              move 7 to lapisrcv-donus
              exit paragraph
        end-write
        perform log-operation-exthrk
    end-if

    initialize not-rec
    if konu2-fol-kodu = "R"
       move  "RHR"     to NOT-DOS
       move romhrk-anah to  NOT-DOS-ANAH 
    else
       move  "EHR"      to NOT-DOS
       move exthrk-anah to  NOT-DOS-ANAH 
    end-if        
       move lapis-aciklama      to not1     
    write not-rec invalid
          continue
    end-write
     
    initialize onkasa-rec
    move hrkgir-tarih              to onkasa-tarih
    move hrkgir-depkod             to onkasa-dep
    read onkasa no lock invalid
         initialize onkasa-tutar-tl onkasa-tutar-dv
    end-read
    compute onkasa-tutar-tl = onkasa-tutar-tl + hrkgir-tl-tutar
    compute onkasa-tutar-dv rounded = onkasa-tutar-dv + 
            hrkgir-dv-tutar
    write onkasa-rec invalid 
          rewrite onkasa-rec end-rewrite  
    end-write 
 
    move hrkgir-folio                 to konuk-folio
    read konuk no lock invalid
         initialize lapisrcv-error-rec
         move "Konuk->Kayit Bulunamadi<>"   to lapisrcv-error-aciklama
         move lapis-dosya-rec                to lapisrcv-error-aciklama(27:)
         perform lapisrcv-hata-yaz
    end-read

    compute konuk-top-borc = konuk-top-borc + hrkgir-tl-tutar
    rewrite konuk-rec invalid  
         initialize lapisrcv-error-rec
         move "Konuk->Kayit Yazilamadi<>"   to lapisrcv-error-aciklama
         move lapis-dosya-rec                to lapisrcv-error-aciklama(27:)
         perform lapisrcv-hata-yaz
    end-rewrite.  
 
*

 lapisrcv-delete-file.

    if is-remote
       set asya-deletefile-remote to true
       set asyadll-remote         to true
    else
       set asya-deletefile-local  to true
       set asyadll-local          to true
    end-if.

    move all low-values    to mydeletefile
    string mydeletefile
            kopyala-adres-local-verilen delimited by low-values
            dir-dosya-rec delimited by low-values
            into mydeletefile
    inspect mydeletefile replacing trailing spaces by low-values
    call asyadll on exception 
         display message box 
                 "asyadll.dll bulunamadi ...."
    not on exception
         call asya_deletefile using 
                              by reference mydeletefile
                              by value mydeletefile-donus
         end-call
         cancel asya_deletefile
         cancel asyadll         
    end-call.
*
 lapisrcv-backup-file.
    accept lapisyedek-tarih from century-date
    accept lapisyedek-zaman from time
    move dir-dosya-rec to lapisyedek-from
    open output lapisyedek
    initialize lapisyedek-rec
    move lapis-dosya-rec         to lapisyedek-rec
    write lapisyedek-rec
    move all low-values to lapisyedek-rec
    string lapisyedek-rec
           "Onb. Tarihi :" delimited by low-values
           hrkgir-gun delimited by low-values
           "/" delimited by low-values
           hrkgir-ay delimited by low-values
           "/" delimited by low-values
           hrkgir-yil delimited by low-values
           " Sistem Tarihi (YYYY/MM/DD) : " delimited by low-values
           lapisyedek-tarih,  delimited by low-values
           " Sistem Zamani (HH:MM:SS:XX) : ", delimited by low-values
           lapisyedek-zaman delimited by low-values
           " Onburo Islem No : " delimited by low-values, 
           hrkgir-islem delimited by low-values,
           " Onburo Cek No : " delimited by low-values
           hrkgir-cekno delimited by low-values
           " Onburo Folio : " delimited by low-values
           hrkgir-folio delimited by low-values
           into lapisyedek-rec
    inspect lapisyedek-rec replacing all low-values by spaces
    write lapisyedek-rec

    close lapisyedek.
*
 lapisrcv-kur-oku.
    initialize kur-rec lapisrcv-kur
    move calisma-tarihi     to kur-tarih
    move onkpara-banka      to kur-banka 
    move onkpara-doviz      to kur-doviz 
    read kur no lock invalid
         initialize lapisrcv-error-rec
         move "Kur Bulunamadi !!!" to lapisrcv-error-aciklama 
         perform lapisrcv-hata-yaz
         move 12 to lapisrcv-donus
    not invalid
         evaluate true 
         when onkpara-d-e = "D" and onkpara-a-s = "A"  
              move doviz-alis    to lapisrcv-kur 
         when onkpara-d-e = "D" and onkpara-a-s = "S"  
              move doviz-satis   to lapisrcv-kur 
         when onkpara-d-e = "E" and onkpara-a-s = "A"  
              move efektif-alis  to lapisrcv-kur 
         when onkpara-d-e = "E" and onkpara-a-s = "S"  
              move efektif-satis to lapisrcv-kur 
         when other  
              move doviz-alis    to lapisrcv-kur 
         end-evaluate 
    end-read.        
*
*
 lapisfol-kur-al.
    initialize kur-rec lapisfol-kur
    move calisma-tarihi     to kur-tarih
    move konuk-banka      to kur-banka 
    move onkpara-doviz      to kur-doviz 
    read kur no lock invalid
         move lapisrcv-kur to lapisfol-kur
         initialize lapisrcv-error-rec
         move "Kur Bulunamadi Folio !!!" to lapisrcv-error-aciklama 
         perform lapisrcv-hata-yaz
         move 13 to lapisrcv-donus
    not invalid
         evaluate true 
         when onkpara-d-e = "D" and onkpara-a-s = "A"  
              move doviz-alis    to lapisfol-kur 
         when onkpara-d-e = "D" and onkpara-a-s = "S"  
              move doviz-satis   to lapisfol-kur 
         when onkpara-d-e = "E" and onkpara-a-s = "A"  
              move efektif-alis  to lapisfol-kur 
         when onkpara-d-e = "E" and onkpara-a-s = "S"  
              move efektif-satis to lapisfol-kur 
         when other  
              move doviz-alis    to lapisfol-kur 
         end-evaluate 
    end-read.   
*
 lapisrcv-fis-al.
    open i-o genelfis
    move 1 to genelfis-anahtar 
    read genelfis no lock invalid  
          initialize lapisrcv-error-rec
          move "Genelfis Tanimsiz !!!"   to lapisrcv-error-aciklama
          perform lapisrcv-hata-yaz
          move 5 to lapisrcv-donus
    not invalid 
         compute cekgir-oto = cekgir-oto + 1 
         rewrite genelfis-rec end-rewrite
    end-read
    close genelfis.
*
 lapisrcv-copy.
     call "c$copy" using lapisrcv-from-dosya lapisrcv-to-dosya giving lapisrcv-donus.
     if lapisrcv-donus <> 0 
        initialize lapisrcv-error-rec
        perform lapisrcv-hata-yaz
     end-if.
     display lapisrcv-to-dosya.

*
 lapisrcv-hata-yaz.
     open extend lapisrcv-error
     accept lapisrcv-error-tarih from century-date
     accept lapisrcv-error-zaman from time.
     move lapisrcv-from-dosya         to lapisrcv-error-from
     move lapisrcv-to-dosya           to lapisrcv-error-to
     if lapisrcv-error-aciklama = spaces
        move "Dosya kopyalanamadi !!!" to lapisrcv-error-aciklama
     end-if
     write lapisrcv-error-rec.
     close lapisrcv-error.
     display lapisrcv-error-rec reverse.
 folref-bul.
*       if k-kodu-tasi = "ASYA" then stop " " end-if
       initialize aroute-anah routtur routyazma routbulundu  extradan-geldi
       if konuk-fol-kodu = "R" then 
          move konuk-rez-no to aroute-rezno
         else
          if konuk-extra-rez-no  > 0 
              move 1 to extradan-geldi
              move konuk-extra-rez-no to aroute-rezno
           else
              move konuk-folio to aroute-folio
          end-if
       end-if

     
       perform until routbulundu = 1 or routtur > 10 
       add 1 to routtur
       initialize route-rec
       move aroute-anah to route-anah
       move hrkgir-depkod   to route-depkod
       if hrkgir-corr-depkod not = spaces and hrkgir-corr-depkod not = zeroes 
         move  hrkgir-corr-depkod to route-depkod
       end-if
       read route no lock invalid
           
           perform rout-folio-kontrol
           perform def-pen-bul
            move 1 to routbulundu
         not invalid
         if route-tip = "P"

            perform rout-folio-kontrol
            move 1 to routbulundu
          else
            if route-tip = "F"
               if route-no <> route-folio
                        initialize aroute-anah
                        move route-no to  aroute-folio
                   else
                     perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

                end-if
              else
                if route-no <> route-rezno
                      initialize aroute-anah
                      move route-no  to aroute-rezno
                         else
                       perform rout-folio-kontrol
                       perform def-pen-bul
                       move 1 to routbulundu

               end-if
            end-if
        end-if
        end-read
       end-perform 
        .
 rout-folio-kontrol.
     initialize konu2-rec
     if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read
          
            if extradan-geldi = 1 then 
            
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move konuk-folio to konu2-folio
                     read konu2 no lock invalid 
                        continue
                      end-read

                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move konuk-folio to konu2-folio
                      read konu2 no lock invalid 
                        continue
                      end-read
                  end-if
               end-read
               else
                move rez-folio to konu2-folio
                read konu2 no lock invalid
                       continue
                      end-read
           end-if

    end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
          if KONU2-ACIK-KAPALI    = "C" 
            move 2 to routyazma
          end-if
          if KONU2-DURUMU not = "I" then
              move 3 to routyazma
          end-if
       end-read
          .
 def-pen-bul.
        
       initialize konu2-rec
      if route-rezno = 0 then
         move route-folio to konu2-folio
       else
        initialize rez-rec
        move route-rezno to rez-no
        read rez no lock invalid
           move 1 to routyazma
        end-read
          if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move konuk-folio to konu2-folio
                   read konu2 no lock invalid
                       continue
                      end-read
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move konuk-folio to konu2-folio
                      read konu2 no lock invalid
                       continue
                      end-read
                  end-if
               end-read
               else
                move rez-folio to konu2-folio
                read konu2 no lock invalid
                       continue
                      end-read
           end-if

     end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
           move konuk-folio to konu2-folio
           read konu2 no lock invalid continue
           end-read
          not invalid
             move "B"               to kodlar02-tipi
               move konu2-odeme-tipi  to kodlar02-kodu 
              read kodlar02 no lock invalid
                    move 1 to route-no
             
                  not invalid
                     if ode-tipi  not =  "A"  | KREDI ISE
                        if hrkgir-corr-depkod not = spaces and hrkgir-corr-depkod not = zeroes
                                    move  hrkgir-corr-depkod to depkod-anah
                                    read depkod no lock invalid continue
                                    end-read
                        end-if
                          if depkod-tipi = 2 then 
                                 move 1 to route-no
                             else
                                move 2 to route-no
                                

                                  
                               
                          end-if
                          if hrkgir-corr-depkod not = spaces and hrkgir-corr-depkod not = zeroes

                                    move  hrkgir-depkod to depkod-anah
                                    read depkod no lock invalid continue
                                    end-read
                          end-if
                      else
                         move 1 to route-no
                   end-if
             end-read
       end-read
          .
*
 folref-ata.
     if routyazma = 0 and routbulundu = 1 
      move konu2-folio to hrkgir-folio
      if vis-pen = 1 then
          move odemepen to hrkgir-ref
             else
          move route-no to hrkgir-ref
      end-if
      else
       if vis-pen = 1 then
          move odemepen to hrkgir-ref
             else
          move 1 to hrkgir-ref
      end-if
    end-if .


*
*
*04062012 folref-bul.
*04062012       initialize aroute-anah routtur routyazma routbulundu
*04062012       if konuk-fol-kodu = "R" then 
*04062012          move konuk-rez-no to aroute-rezno
*04062012         else
*04062012          if konuk-extra-rez-no  > 0 
*04062012              move konuk-extra-rez-no to aroute-rezno
*04062012           else
*04062012              
*04062012              move konuk-folio to aroute-folio
*04062012          end-if
*04062012       end-if
*04062012
*04062012     
*04062012       perform until routbulundu = 1 or routtur > 10 
*04062012       add 1 to routtur
*04062012       initialize route-rec
*04062012        move aroute-anah to route-anah
*04062012       move hrkgir-depkod   to route-depkod
*04062012       read route no lock invalid
*04062012           
*04062012           perform rout-folio-kontrol
*04062012           perform def-pen-bul
*04062012            move 1 to routbulundu
*04062012         not invalid
*04062012         if route-tip = "P"
*04062012
*04062012            perform rout-folio-kontrol
*04062012            move 1 to routbulundu
*04062012          else
*04062012            if route-tip = "F"
*04062012               if route-no <> route-folio
*04062012                        initialize aroute-anah
*04062012                        move route-no to  aroute-folio
*04062012                   else
*04062012                     perform rout-folio-kontrol
*04062012                     perform def-pen-bul
*04062012                  move 1 to routbulundu
*04062012
*04062012                end-if
*04062012              else
*04062012                if route-no <> route-rezno
*04062012                      initialize aroute-anah
*04062012                      move route-no  to aroute-rezno
*04062012                         else
*04062012                       perform rout-folio-kontrol
*04062012                     perform def-pen-bul
*04062012                  move 1 to routbulundu
*04062012               end-if
*04062012            end-if
*04062012        end-if
*04062012        end-read
*04062012
*04062012
*04062012           
*04062012       
*04062012       end-perform 
*04062012
*04062012       
*04062012        .
*04062012 rout-folio-kontrol.
*04062012     initialize konu2-rec
*04062012     if route-rezno = 0 then
*04062012       move route-folio to konu2-folio
*04062012       else
*04062012        move route-rezno to rez-no
*04062012        read rez no lock invalid
*04062012         move 1 to routyazma
*04062012        end-read
*04062012
*04062012        move rez-folio to konu2-folio

*04062012    end-if
*04062012       read konu2 no lock 
*04062012          invalid
*04062012           move 1 to routyazma
*04062012          not invalid
*04062012          if KONU2-ACIK-KAPALI    = "C" 
*04062012            move 2 to routyazma
*04062012          end-if
*04062012          if KONU2-DURUMU not = "I" then
*04062012              move 3 to routyazma
*04062012          end-if
*04062012       end-read
*04062012          .
*04062012 def-pen-bul.
*04062012       initialize konu2-rec
*04062012      if route-rezno = 0 then
*04062012       move route-folio to konu2-folio
*04062012       else
*04062012        initialize rez-rec
*04062012        move route-rezno to rez-no
*04062012        read rez no lock invalid
*04062012         move 1 to routyazma
*04062012        end-read
*04062012        move rez-folio to konu2-folio
*04062012
*04062012     end-if
*04062012       read konu2 no lock 
*04062012          invalid
*04062012           move 1 to routyazma
*04062012          not invalid
*04062012             move "B"               to kodlar02-tipi
*04062012               move konu2-odeme-tipi  to kodlar02-kodu 
*04062012              read kodlar02 no lock invalid
*04062012                    move 1 to route-no
*04062012             
*04062012                  not invalid
*04062012                     if ode-tipi  = "B"  | KREDI ISE
*04062012                          if depkod-tipi = 2 then 
*04062012                                 move 1 to route-no
*04062012                             else
*04062012                                move 2 to route-no
*04062012                          end-if
*04062012                      else
*04062012                         move 1 to route-no
*04062012                   end-if
*04062012             end-read         
*04062012       end-read.

*
*04062012 folref-ata.
*04062012     if routyazma = 0 and routbulundu = 1 
*04062012      move konu2-folio to hrkgir-folio
*04062012      move route-no to hrkgir-ref
*04062012    end-if.
     


 polisxml-bul.
     initialize polisxml-rec
     move konuk-rez-no        to polisxml-rezno
     move 1                   to polisxml-sirano
     start polisxml key not < polisxml-anah invalid
           continue
     not invalid
     perform with test after until fs-polisxml = "10"
     read polisxml next no lock end move "10"   to fs-polisxml
     not at end
             if polisxml-rezno <> konuk-rez-no
                exit perform
             end-if
                 move polisxml-sirano         to takas-sira
                 move polisxml-tckimlikno     to takas-tcno
                 move polisxml-kseri          to takas-pasport
                 move polisxml-ADI            to takas-adi
                 move polisxml-soyadi         to takas-soyadi
                 move polisxml-dog-gun        to takas-dog-tar(7:2)
                 move polisxml-dog-ay         to takas-dog-tar(5:2)
                 move polisxml-dog-yil        to takas-dog-tar(1:4)
                 move 1 to pol-bulundu
                 write takas-rec invalid 
                       rewrite takas-rec invalid continue
                       end-rewrite
                 end-write,
     end-read
     end-perform
     end-start

      .

*
 konuk-extra-bul.

    initialize konuk-rec mira-folio
    move "I"          to konuk-durumu.
    move takas-oda    to konuk-odano
    start konuk key = konuk-oda invalid
          initialize konuk-rec
          exit paragraph
    end-start.

    perform with test after until fs-konuk = "10"
    read konuk next no lock end exit perform not at end
         if konuk-odano <> takas-oda or 
            konuk-durumu <> "I"  
               exit perform
         end-if
         evaluate konuk-fol-kodu
         when "R"
         when "G"
              move konuk-folio   to mira-folio
         when "E"
              move konuk-folio   to mira-folio
              exit perform
         end-evaluate
    end-read
    end-perform.



@}}

[KEY_STATUS_FIELD_FORMAT]
PIC=9(4)
USAGE=[None]

[KEYSTATUS_CONTENT:KS1]
CONDITION=Exit-Pushed
VALUE=27

[KEYSTATUS_CONTENT:KS2]
CONDITION=Message-Received
VALUE=95

[KEYSTATUS_CONTENT:KS3]
CONDITION=Event-Occurred
VALUE=96

[KEYSTATUS_CONTENT:KS4]
CONDITION=Screen-No-Input-Field
VALUE=97

[CODE_GENERATION_OPTIONS]
FOLLOW_PROJECT_OPTIONS=1
GENERATE_PROGRAM_FILE=1
GENERATE_WORKING_STORAGE=1
GENERATE_EVENT_PARAGRAPH=1
GENERATE_SCREEN_SECTION=1
GENERATE_REPORT_SECTION=1
GENERATE_PROCEDURE_DIVISION=1
GENERATE_MENU_PARAGRAPH=1
GENERATE_LINKAGE_SECTION=1
REPLACE_REMARK_PART=1
EXCLUDE_PROGRAM_VARIABLE=0
EXCLUDE_PROGRAM_PARAGRAPH=0
PROGRAM_EXTENSION=.cbl
WORKINGSTORAGE_EXTENSION=.wrk
EVENT_EXTENSION=.evt
SCREEN_EXTENSION=.scr
REPORT_EXTENSION=.rpt
PROCEDURE_EXTENSION=.prd
MENU_EXTENSION=.mnu
LINKAGE_EXTENSION=.lks
PROGRAM_FILE_READ_ONLY=0
LINK_CLOSE_TO_OPEN=0
COPYBOOK_READ_ONLY=0
GENERATE_COPY_FILES=1
ACCEPT_CONTROL=4
ANSI_DOCUMENT_FORMAT=0