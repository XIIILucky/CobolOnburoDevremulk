* gunrez.evt
* gunrez.evt is generated from D:\asya\acugt.ytl\otel\gunrez.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel kllnc
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
     move ONKPARA-DOVIZ to butce-cev-doviz  
    initialize k-kodu   muh-sup
    move k-kodu-tasi to K-KODU 
                        read kllnc no lock invalid
                                initialize kllnc-rec
                                continue
                        end-read
                    if   K-muh-SUP  = 1 
                     move K-muh-SUP to  muh-sup
                    end-if
       close genel kllnc.
    open input genel2
    move 1 to genel2-anah 
    read genel2 no lock invalid continue
         not invalid continue
    end-read
    close genel2  

    perform birlesik-ref-bul            

**********************************************************************pdf conv
    call "c$narg" using link-var
**********************************************************************pdf conv
     .
*
 Form1-Aft-Initdata.
    move gun-tasi to ilk-gun son-gun.
    move ay-tasi  to ilk-ay  son-ay.
    move yil-tasi to ilk-yil son-yil.
    move "I" to rez-dur(1:1).
    move "A" to rap-det.
    perform ekran-goster.
     perform Form1-Ef-1-Aft-Procedure
**********************************************************************pdf conv
    if link-var > 0 
        move forlink-bas-tarih to ilk-tarih
        move forlink-bit-tarih to son-tarih
        move 2 to key-status
        perform Form1-Ex-Other       
    end-if 
**********************************************************************pdf conv
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*   
         
*
 ekran-goster.
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            com-01 com-02.
 takas-dosya-ac.
    initialize link-gelen gel-refler
*    if rez-dur(1:1) = "I" and gruplar-dahil not = 1 then                 firat silinen rezervasyonlar detayi icin kapatildi 07/03/2020
    if gruplar-dahil not = 1 then 
**       if filtre-var not = 1   alt toplam geliþmiþ filtre çalýþmýyor RAMAZAN ... hatalý olmasýný engellemek için bu satýrý kaldýrýn
       if onkpara-referans-var = 1
          move oda-ref   to gel-oda-ref
          move fiyat-ref to gel-fiyat-ref
       end-if 
       move link-det to link-giden
       call "/asya/ytl/obj/otel/gunrezt.asy" 
           using link-giden, link-gelen,gel-refler
       on exception 
           perform callerr-proc
       not on exception
           cancel   "/asya/ytl/obj/otel/gunrezt.asy"      
       end-call
**      end-if
    end-if
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid 
    move 1 to ekran-fis-1.
  
    add 1 to ekran-fis-1.

    move ekran-fis-1(2:) to takas-no takasi-no takasd-no takas13-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    open output takas takasi takasd takas13 close takas takasi takasd takas13 open i-o takas takasi takasd takas13 with mass-update.
*
 takasi-olustur.
       initialize genel-share
       perform with test after until fs-rez = "10"
                    read rez next no lock end move "10" to fs-rez
                    not at end
                         
                                 
                         if rez-durumu not =  rez-dur(1:1)   
                           exit perform    
                         end-if

                         if rez-isl-tar > son-tarih
                           exit perform
                         end-if
                           if  gruplar-dahil = 1 
                               and rez-grup-no > 0 then
                              exit perform cycle
                         end-if
                         initialize konuk-rec 
                         move rez-folio      to konuk-folio
                         read konuk no lock invalid 
                              continue 
                         not invalid 
                                 if cl-cikma = 1 and
                                    konuk-duzeltme = 1 
                                       exit perform cycle                                
                                 end-if                             
                         end-read 
                            if sadece-sejour = 1
                               if rez-sejour-entegre not = 1
                                   exit perform cycle
                               end-if 
                            end-if 
                           
*                         if rez-isl-tar > rez-gir-tar
*                            exit perform cycle 
*                         end-if
                         if onkpara-referans-var = 1 then 
                            perform ref-filtre
                            if not ref-gecti then 
                               exit perform cycle
                            end-if
                         end-if
                           if rapor-staf not = spaces and rez-staf not = rapor-staf
                            exit perform cycle
                          end-if
                           if  rez-k-g-b not = rap-tip(1:1) then
                               exit perform cycle
                           end-if
                            if  rez-dur(1:1) not = rez-durumu then 
                            exit perform cycle 
                            end-if
                        
                          if acn-grup-kod not = spaces
                              initialize grup-rec
                              set grup-acenta to true
                              move acn-grup-kod to grup-kodu
                              move rez-acenta   to grup-alt
                              read grup no lock
                                invalid
                                  exit perform cycle
                              end-read
                            end-if
                         if rez-acenta = rapor-acenta or rapor-acenta  = spaces

                             if filtre-var = 1 then 
                                    perform filtre
                                 if filtre-gecti  = 1 then 
                                  perform  tek-takas-yaz
                                   end-if
                                 else
                                   perform  tek-takas-yaz
                              end-if
                              
                         end-if 

                       
                    end-read
              end-perform
              
               if  gruplar-dahil = 1 
              initialize gruplar-rec
         
              start gruplar key >= gruplar-anahtar invalid continue
                 not invalid
                   perform until fs-gruplar = "10" 
                      read gruplar next no lock 
                       end move "10" to fs-gruplar
                         not end
                         if gruplar-durumu = " " then move "I" to gruplar-durumu 
                         else
                          if gruplar-durumu = "I" then move "S" to gruplar-durumu end-if
                          end-if
                           if gruplar-durumu not =  rez-dur(1:1)
                           exit perform cycle
                         end-if

                         if gruplar-isl-tar > son-tarih  or gruplar-isl-tar < ilk-tarih 
                           exit perform cycle
                         end-if
                          if onkpara-referans-var = 1 then 
                            perform ref-filtre
                            if not ref-gecti then 
                               exit perform cycle
                            end-if
                         end-if
                           if rapor-staf not = spaces and gruplar-staf not = rapor-staf
                            exit perform cycle
                          end-if
                           perform  tekgrup-takas-yaz


                      end-read
                  end-perform
              end-start
         
           end-if
            .
*
 Form1-Ex-Other.
    evaluate key-status
        
        when 1 
           if control-id= 15 then 
              initialize acenta-cagir
              call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to rapor-acenta
                        display acc-07a
                     end-if
             end-call
             move 4  to accept-control
             move 15 to control-id

           end-if
          
           if control-id= 30 then 
             initialize acn-grup-kod
             call "/asya/ytl/obj/otel/grupara.asy" 
                  using "A", acn-grup-kod  
                  on exception 
                     perform callerr-proc
                  not on exception
                     display acc-08
             end-call
            end-if

       
             exit paragraph


    
       when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre
              
        when 2
              perform takas-dosya-ac
              open input rez  merkez gruplar cast konuk firma acenta doviz konum kodlar02 ulke kllnc  hesayr grup  kur odalar


           
              initialize rez-rec
              move rez-dur(1:1)   to rez-durumu
              move ilk-tarih to rez-isl-tar
              start rez key not < rez-isl invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close rez cast firma acenta konuk konum   merkez grup  kur gruplar
                          doviz kodlar02 ulke takas takasd takasi kllnc  hesayr takas13 odalar

                    delete file takas takasi takasd takas13
                    exit paragraph
              not invalid
              
                    perform takasi-olustur                      
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     if rez-dur(1:1) = "I" 
        move "Islenen Rezervasyonlar Raporu"      to det-filler
     else
        move "Iptal Rezervasyonlar Raporu"      to det-filler
     end-if 
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     if rez-dur(1:1) = "I" 
        move "Islenen Rezervasyonlar Raporu"      to det-filler
     else
        move "Iptal Rezervasyonlar Raporu"      to det-filler
     end-if 
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RRLLRRRRRLLLLLLLLLLLLLLL"  to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2)     
     move "Isl. Tarih"                  to det-1
     move "#"                           to det-1-1
     MOVE "Rez. No."                    to det-2 
     move "Grup "                       to det-g
     MOVE "Adi       "                  to det-3      
     MOVE "Soyadi    "                  to det-4     
     MOVE "Blok"                        to det-5      
     MOVE "Pax"                         to det-6     
     MOVE "Chi"                         to det-7      
     MOVE "Fre"                         to det-8    
     MOVE "Beb"                         to det-88    
     MOVE "Acen"                        to det-9 
     move "Firma"                       to det-9-9 
     MOVE "Acenta Adi"                  to det-10
     move "Firma Adi"                   to det-10-10
     MOVE "Konum"                       to det-11    
*     MOVE "Oda T."                      to det-12   29/07/2017 xiii delete
     move "F.Konumu"                    to det-12   |29/07/2017 xiii write
     MOVE "PK"                          to det-13 
     MOVE "Pansiyon  "                  to det-14 
     MOVE "OK"                          to det-15 
     MOVE "Odeme     "                  to det-16 
     move "Sejour Entegrasyon"          to det-16-0
     MOVE "C/In      "                  to det-17 
     MOVE "C/Out     "                  to det-18 
     move "Satis Tarihi"                to det-30
     move "Anlasma "                    to det-31
     move "Hesaplama Yontemi"           to det-ack
     MOVE "Rez       "                  to det-19 
     move "G.Pax Ort"                   to det-pax-gun
     move "T.Pax Ort"                   to det-pax-top
     move "G.Fiyat"                     to det-191
     move "T.Fiyat"                     to det-192
     move "T.Fiyat (DV)"                to det-193
     MOVE "Voucher   "                  to det-20 
     MOVE "C/In      "                  to det-21 
     move "NOT       "                  to det-22
     if rez-dur(1:1) not = "I"  then 
        move "Silinme Sebebi       "       to det-22
     end-if
     move "Staf"     to det-23
     move "Adi"      to det-24
     move "Soyadi"   to det-25
     move "K.Zaman"  to det-26
     move "OK"       to det-13-1
     move "Operator" to det-13-2
     move "GS"       to det-13-3                                                                      
****************************************************************************************firat bas
     move "Ulke"     to det-13-4                                                       |                
     move "Pazar"    to det-13-5                                                       |firat 07/03/2020
     move "Ort.G.Fiy" to det-13-6 
     move "Ort.G.FiyDV" to det-13-7 
****************************************************************************************firat son

     move "|" to fil-1 fil-1-1 fil-2 fil-g fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-88 fil-9 fil-10 fil-11  fil-16-0
                 fil-12 fil-13 fil-14 fil-15 fil-16 fil-9-9 fil-10-10 
                 fil-30 fil-31 fil-ack fil-ack fil-17 fil-18 fil-19 
                 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22 fil-23 fil-24 
                 fil-25 fil-26 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7   fil-pax-gun fil-pax-top
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-1-1 det-2 det-g det-3 det-4 det-5 det-6
                     det-7 det-8 det-88 det-9 det-10 det-11 det-9-9 
                     det-12 det-13 det-14 det-15 det-16 det-16-0 det-10-10 
                     det-17 det-18 det-19 det-191 det-192 det-193 det-20 det-21 
                     det-22 det-23 det-24 det-25 det-26 det-13-1 det-13-2 
                     det-13-3 det-13-4 det-13-5 det-13-6 det-13-7 det-pax-gun det-pax-top
     write dokumer-rec from detay
**************************
        open input    aksiyhrk  grupfiy  formul fiyat takvim
          aceanlas fiyatana   romhrk  cast3 ,
          open i-o fiyatind
              initialize toplam tarih-topla tarih-kont ort-top-dv ort-top
              initialize fs-rez
             initialize takasi-rec
             evaluate rap-sir(1:1)
               when "A"
                 start takasi key > takasi-isl
                   invalid     continue
                   not invalid
                    perform until fs-takasi="10"
                      read takasi next no lock 
                        end move "10" to fs-takasi
                        not end  perform  tek-detay-yaz
                       end-read
                    end-perform
                 end-start
               when "B"
                  start takasi key > takasi-gir
                   invalid     continue
                   not invalid
                    perform until fs-takasi="10"
                      read takasi next no lock 
                        end move "10" to fs-takasi
                        not end  perform  tek-detay-yaz
                       end-read
                    end-perform
                 end-start
               
               when "C"
                    start takasi key > takasi-ace
                  invalid     continue
                   not invalid
                    perform until fs-takasi="10"
                      read takasi next no lock 
                        end move "10" to fs-takasi
                        not end  perform  tek-detay-yaz
                       end-read
                    end-perform
                 end-start
               when "D"
                    start takasi key > takasi-dovi
                  invalid     continue
                   not invalid
                    perform until fs-takasi="10"
                      read takasi next no lock 
                        end move "10" to fs-takasi
                        not end  perform  tek-detay-yaz
                       end-read
                    end-perform
                 end-start
               when "E"
                    start takasi key > takasi-paz
                   invalid     continue
                   not invalid
                    perform until fs-takasi="10"
                      read takasi next no lock 
                        end move "10" to fs-takasi
                        not end  perform  tek-detay-yaz
                       end-read
                    end-perform
                 end-start

             end-evaluate
            


              perform liste-tarih-toplam
              perform liste-genel-toplam
              perform takas-yaz
              perform gelen-yaz
              close dokumer
**********************************************************************pdf conv
              if link-var > 0 
***                  PDF yazdýr
                 perform pdf-olustur                  
                string             
                    dokumer-dosya(17:4) delimited by "    "
                    ".pdf" delimited by size     
                into forlink-donus-dosya-adi
              else
                      call  dokumer-prog on exception
                           perform callerr-proc
                      not on exception
                           cancel dokumer-prog
                      end-call
              end-if 
**********************************************************************pdf conv
*              call dokumer-prog on exception
*                   perform callerr-proc
*              not on exception
*                   cancel dokumer-prog
*              end-call
              close rez  firma merkez acenta konuk cast doviz  hesayr  grup  kur gruplar
                    konum kodlar02 ulke takas takasi takasd KLLNC odalar takas13 

                  close    aksiyhrk  grupfiy  formul fiyat  takvim
          aceanlas fiyatana   romhrk  cast3 ,
          close fiyatind
              delete file dokumer takas takasi takasd takas13
**********************************************************************pdf conv
              if link-var > 0 
                 set exit-pushed to true
              end-if 
**********************************************************************pdf conv
    end-evaluate.
     .
*
 pdf-olustur.
    initialize pdf-link-tum
    move dokumer-dosya               to pdf-dokumer-adres
    call "/asya/ytl/obj/otel/dok2pdf.asy" using  pdf-link-tum 
       on exception 
          perform callerr-proc
          exit paragraph
    not on exception
    cancel "/asya/ytl/obj/otel/dok2pdf.asy"
    end-call.
*
 tekgrup-takas-yaz.
       initialize takasi-rec
         move gruplar-kodu to takasi-grup-no               
         move gruplar-acenta to takasi-acenta           
         move gruplar-ISL-TAR to takasi-isl-tar
         move gruplar-Gel-TAR  to takasi-gir-tar
         move gruplar-doviz   to takasi-doviz
         move gruplar-pazar to takasi-pazar
         if (rez-gel-sirket = spaces or  rez-gel-sirket  = zeroes ) or 
            (rez-git-sirket = spaces or rez-git-sirket  = zeroes )
             move " " to takasi-tr
             else
            move "T" to takasi-tr
         end-if
          
        |   perform fiyatlar
         write takasi-rec invalid display message box "Hata-467326" end-write.
*
 tek-takas-yaz.
       initialize takasi-rec
         move rez-no        to takasi-rez-no               
         move rez-acenta    to takasi-acenta           
         move rez-isl-tar   to takasi-isl-tar
         move rez-gir-tar   to takasi-gir-tar
         move rez-doviz     to takasi-doviz
         move rez-pazar     to takasi-pazar
         move rez-isl-zaman to takasi-isl-zaman
         if (rez-gel-sirket = spaces or rez-gel-sirket  = zeroes ) or 
            (rez-git-sirket = spaces or rez-git-sirket  = zeroes )
             move " " to takasi-tr
             else
            move "T" to takasi-tr
         end-if
         perform 
           perform fiyatlar
         write takasi-rec invalid display message box "Hata-467326" end-write.
* 
 grupdan-rez.
        initialize rez-rec  grup-oda-say  grup-pax-say  grup-gun-tut  grup-top-tut  
     move gruplar-adi      to rez-adi
     move gruplar-firma      to rez-firma       
     move gruplar-acenta     to rez-acenta     
     move gruplar-gel-tar    to rez-gir-tar    
     move gruplar-git-tar    to rez-cik-tar    
     move gruplar-banka      to rez-banka      
     move gruplar-doviz      to rez-doviz      
     move gruplar-pan-tipi   to rez-pan-tipi   
     move gruplar-odeme      to rez-odeme-tipi 
     move gruplar-anlasma    to rez-anlasma    
     move gruplar-pazar      to rez-pazar      
     move gruplar-ulke       to rez-ulke       
     move gruplar-not1       to rez-not1       
     move gruplar-not2       to rez-not2 
     move gruplar-grup-statu to rez-gr-status
     move gruplar-kaynak-1   to rez-kaynak-1
     move gruplar-kaynak-2   to rez-kaynak-2
     move gruplar-kaynak-3   to rez-kaynak-3
     move gruplar-kur        to rez-cin-kuru
     move gruplar-staf       to rez-staf
    
     move gruplar-satis-tar     to rez-al-tar
     move gruplar-isl-tar       to rez-isl-tar
      move gruplar-gel-tar to takas-blok-bas-tar
    move gruplar-git-tar to takas-blok-bit-tar
    move 1 to takas-blok-fiyatli
        move 1 to takas-blok-konumlu
    move gruplar-kodu to  tek-grup  
     if gruplar-dahil    =  1
       perform grup-takas-al
       perform gruplari-takasa-ekle
     end-if




        .


*
 gruplari-takasa-ekle2.
       
        add takas-blok-ayrilan-tutar to   rez-top-fiyat
        if  takas-blok-tarih = gruplar-gel-tar
          
            add takas-blok-ayrilan-oda to grup-oda-say
            if  takas-blok-ayrilan-oda > 0
            move  takas-blok-konum to rez-oda-konumu
            end-if
        end-if
        if  takas-blok-tarih = gruplar-gel-tar
            add takas-blok-ayrilan-pax to grup-pax-say
           
        end-if
        if  takas-blok-tarih = gruplar-gel-tar
            add takas-blok-ayrilan-tutar to grup-gun-tut
        end-if
       move grup-gun-tut to rez-fiyati



          .
 tek-detay-yaz.  

      if takasi-rez-no > 0 
         move takasi-rez-no to rez-anah
         read rez no lock invalid 
              exit paragraph
         end-read 
      else
         if takasi-grup-no > 0
            move takasi-grup-no to gruplar-kodu
            read gruplar no lock invalid
                 exit paragraph
            end-read 
            perform grupdan-rez
         else
            exit paragraph
         end-if
      end-if
            
      if sadece-tr = 1 and takasi-tr not = "T" then 
         exit  paragraph
      end-if

      if tarih-kont = zeroes 
         evaluate rap-sir(1:1)
             when "A"
                  move rez-isl-tar to tarih-kont,
             when "B"
                  move rez-gir-tar(1:6) to tarih-kont,
             when "C"
                  move rez-acenta to tarih-kont,
             when "D"
                  move rez-doviz(1:2)  to tarih-kont
             when "E"
                  move rez-pazar  to tarih-kont
         end-evaluate 
      end-if

      if (rap-sir(1:1) = "A" and rez-isl-tar = tarih-kont) or
         (rap-sir(1:1) = "B" and rez-gir-tar(1:6) = tarih-kont(1:6)) or
         (rap-sir(1:1) = "C" and rez-acenta = tarih-kont(1:4)) or
         (rap-sir(1:1) = "D" and rez-doviz(1:2) = tarih-kont(1:2)) or
         (rap-sir(1:1) = "E" and rez-pazar = tarih-kont)
         continue
      else 
         perform liste-tarih-toplam
         initialize dokumer-rec detay
         move "-"            to det-dokumer-20(5:1)
         move all "-" to det-1 det-2 det-g det-3 det-4 det-5 det-6
                     det-7 det-8 det-88 det-9 det-10 det-11 
                     det-12 det-13 det-14 det-15 det-16   det-16-0
                     det-17 det-18 det-19 det-191 det-192 det-193 det-20 det-21 det-22 det-23 det-24 det-25 det-26
                     det-9-9 det-10-10 det-13-1 det-13-2 det-13-3 det-13-4 det-13-5 det-13-6 det-13-7 det-pax-gun det-pax-top
         write dokumer-rec from detay

         initialize tarih-topla
         evaluate rap-sir(1:1)
             when "A"
                  move rez-isl-tar to tarih-kont,
             when "B"
                  move rez-gir-tar(1:6) to tarih-kont,
             when "C"
                  move rez-acenta to tarih-kont,   
             when "D"
                  move rez-doviz(1:2) to tarih-kont,
             when "E"
                  move rez-pazar to tarih-kont,
         end-evaluate 
      end-if

      evaluate rap-sir(1:1)
          when "A"
               move rez-isl-tar to tarih-kont,
          when "B"
               move rez-gir-tar(1:6) to tarih-kont,
          when "C"
               move rez-acenta to tarih-kont,   
          when "D"
               move rez-doviz(1:2)  to tarih-kont
          when "E"
               move rez-pazar  to tarih-kont
      end-evaluate 

      initialize dokumer-rec detay
      if rez-dur(1:1) = "I"
         move rez-isl-gun   to xgun
         move rez-isl-ay    to xay
         move rez-isl-yil   to xyil
         move xtarih        to det-1 
      else 
         if rez-sil-tar > 0
            move rez-sil-tar(1:4) to xyil
            move rez-sil-tar(5:2) to xay
            move rez-sil-tar(7:2) to xgun 
            move xtarih           to det-1
         else
            move rez-isl-gun   to xgun
            move rez-isl-ay    to xay
            move rez-isl-yil   to xyil
            move xtarih        to det-1
         end-if
      end-if
      move rez-al-gun    to xgun
      move rez-al-ay     to xay
      move rez-al-yil    to xyil


      move xtarih        to  det-30 
      move rez-anlasma to kodlar02-kodu
      


      move "D" to kodlar02-tipi
      move rez-anlasma to kodlar02-kodu  det-31
      read kodlar02 no lock invalid 
           move all " " to kodlar02-adi
      end-read
      
      move kodlar02-adi to det-31(4:)
      move takasi-top-acik to det-ack
                         
      if takasi-rez-no not > 0 and   takasi-grup-no > 0
         move gruplar-kodu to det-g
      else
         move rez-no        to det-2
      end-if
      move rez-adi       to det-3
      move rez-soyadi    to det-4 
      if rez-odano > spaces and 
         rez-odano > zeroes
         initialize odalar-rec
         move rez-odano     to det-5 odalar-anah
         read odalar no lock invalid 
              continue
         end-read

         if odalar-uzun-no not = spaces 
            move odalar-uzun-no to det-5
         end-if                            
      end-if

      if takasi-rez-no not > 0 and   takasi-grup-no > 0
         move grup-oda-say to z-g
         move z-g to   det-5
         move grup-pax-say    to z-g   
         move z-g          to det-6
      else
         move rez-buyuk    to z-2   
         move z-2          to det-6
         move rez-kucuk    to z-2  
         move z-2          to det-7
         move rez-free     to z-2   
         move z-2          to det-8
         move rez-bebek    to z-2   
         move z-2          to det-88
      end-if

      initialize acenta-rec
      move rez-acenta      to det-9 acenta-kodu
      read acenta no lock invalid
           move all "*"    to acenta-adi,
      end-read
      move acenta-adi    to det-10

      if merkez-kodlar = 1 then 
         move rez-acenta  to acenta-anahtar 
         read acenta no lock invalid                      
              move all "*" to acenta-adi
              move acenta-kodu to acenta-adi
         not invalid 
             if ACENTA-merkez-kodu > spaces 
                initialize merkez-rec
                move "A" to merkez-tipi
                move ACENTA-merkez-kodu    to merkez-kodu
                read merkez no lock invalid
                     continue
                not invalid
                    initialize det-9  det-10
                    move   merkez-kodu   to det-9
                    move merkez-adi      to det-10 
                end-read
             end-if
         end-read
      end-if

      initialize firma-rec
      move rez-firma    to det-9-9 firma-kodu
      read firma no lock invalid 
           move "    "     to firma-adi,
      end-read
      move firma-adi    to det-10-10
      if takasi-rez-no not > 0 and   takasi-grup-no > 0
         continue
      else
         move rez-oda-konumu to konum-anahtar 
         read konum no lock invalid 
              move all "*" to konum-adi
         end-read

         move konum-adi to det-11

         move rez-fiyat-konumu to konum-anahtar                        |  29/072017 firat
         read konum no lock invalid 
              move all "*" to konum-adi
         end-read |
         move konum-adi to det-12           
      end-if
**************************************************************
*                         evaluate rez-buyuk                 |  29/07/2017 firat 
*                            when 0                          |
*                            when 1 move "Single" to det-12  |
*                            when 2 move "Double" to det-12  |
*                            when 3 move "Triple" to det-12  |
*                            when 4 move "Group"  to det-12  |
*                            when other                      |
*                                move "Group"  to det-12     |
*                         end-evaluate                       |
****************************************************************************************
                                                   |
****************************************************************************************
      initialize takvim-rec geceleme
      move rez-gir-tar to takvim-anah
      start takvim key >= takvim-anah
      invalid
      continue
      not invalid
      perform until fs-takvim = "10"
            read takvim next no lock end move "10" to fs-takvim
              not end
                if takvim-anah < rez-cik-tar
                  add 1 to geceleme
                  else
                  move "10" to fs-takvim
                end-if
             end-read      
      end-perform
      end-start
      move geceleme to z-3 
      move z-3      to det-13-3
      add geceleme to t-geceleme genel-geceleme
      move rez-operator    to det-13-1
      initialize kodlar02-rec
      move "O"             to kodlar02-tipi
      move rez-operator    to kodlar02-kodu
      read kodlar02 no lock invalid 
           initialize kodlar02-adi
      end-read
      move kodlar02-adi    to det-13-2

      move rez-pan-tipi    to det-13
      initialize kodlar02-rec
      move "A" to kodlar02-tipi
      move rez-pan-tipi to kodlar02-kodu
      read kodlar02 no lock invalid move all "*" to kodlar02-adi,end-read
      move kodlar02-adi to det-14

      move rez-odeme-tipi  to det-15
      initialize kodlar02-rec
      move "B" to kodlar02-tipi
      move rez-odeme-tipi to kodlar02-kodu
      read kodlar02 no lock invalid move all "*" to kodlar02-adi,end-read
      move kodlar02-adi to det-16

      if rez-sejour-entegre = 1
         move "E"            to det-16-0
      else
         move "H"            to det-16-0                          
      end-if 

      move rez-gir-gun to xgun
      move rez-gir-ay  to xay 
      move rez-gir-yil to xyil
      move xtarih      to det-17

      move rez-cik-gun to xgun
      move rez-cik-ay  to xay 
      move rez-cik-yil to xyil
      move xtarih      to det-18
      initialize doviz-rec
      move rez-doviz       to doviz-kodu
      read doviz no lock invalid 
          move all "*"     to D-KISA-ADI
      end-read 
          move D-KISA-ADI to det-19

      move rez-isl-saat   to det-26(1:2)
      move ":"            to det-26(3:1)
      move rez-isl-dakika to det-26(4:2)
      move rez-voucher             to det-20 
      move rez-c-in                to det-21
*********************************************************************firat bas
                                                                    |
      initialize det-22                                             |
      if rez-dev-uye-no <> 0                                        | 
         perform devremulk-guncel-borc-hesapla                      |
      end-if                                                        |
      if rez-durumu = "I"                                           |
         evaluate rez-dev-uye-no                                    |
             when 0                                                 |
                  string rez-not1 delimited by "   "                | firat 21/08/2017
                         rez-not2 delimited by "   "                |
                         into det-22                                |
             when other                                             |
                  string ztl-top        delimited by "   "          |
                         dev-ack1       delimited by "   "          |
                         dev-ack3       delimited by "   "          |
                         zdov-top       delimited by "   "          |
                         dev-ack2       delimited by "   "          |
                         into det-22                                |
         end-evaluate                                               |
*********************************************************************firat son
      else
         move rez-isl-gun      to det-22(1:)
         move "/"              to det-22(3:)
         move rez-isl-ay       to det-22(4:)
         move "/"              to det-22(6:)
         move rez-isl-yil(3:2) to det-22(7:)
         move " - "            to det-22(9:)
         move rez-sil-neden    to det-22(12:)
      end-if

*********************************************************************firat bas
      initialize ulke-rec                                           |
      move rez-ulke                to ulke-anah1                    |
      read ulke no lock invalid                                     |
           move rez-ulke           to ulke-adi                      |
      end-read                                                      |
      move ulke-adi                to det-13-4                      |firat 07/03/2020 
                                                                    |
      initialize kodlar02-rec                                       |
      move "E"                     to kodlar02-tipi                 |
      move rez-pazar               to kodlar02-kodu                 |
      read kodlar02 no lock invalid                                 |
           move rez-pazar          to kodlar02-adi                  |
      end-read                                                      |
      move kodlar02-adi            to det-13-5                      |                  
*********************************************************************firat son

*******************kaya istanbul share start block******************************
      if takasi-rez-no not > 0 and  
         takasi-grup-no > 0
         continue
      else
         initialize cast-rec
         move rez-gir-tar         to cast-tarih
         move rez-no              to cast-rez-no
         read cast no lock invalid
              continue 
         not invalid 
              if cast-share = 1
                 move 0           to det-1-1
              else
                 move 1           to det-1-1
                 compute genel-share = genel-share + 1                                    
              end-if
         end-read 
*************************************kaya istanbul share end block******************************
         initialize rez-top-fiyat  
         if muh-sup = 1
            start cast key >=  cast-anah1 invalid continue
                  not invalid
            perform until fs-cast = "10"
            read cast next no lock end move "10" to fs-cast 
            not end
                if cast-rez-no =  rez-no then
                   if cast-tarih < rez-cik-tar
                      add CAST-FIYATI   to rez-top-fiyat
                   else
                      move "10" to fs-cast 
                   end-if
                else
                   move "10" to fs-cast 
                end-if
            end-read
            end-perform
            end-start
         end-if
      end-if

      move rez-fiyati            to zgfiy
      move zgfiy                 to det-191
      move rez-top-fiyat         to ztfiy
      move ztfiy                 to det-192


       evaluate ychild(1:1)
       when 1 
           compute pax-sayisi = rez-buyuk + ( rez-kucuk / 2 )
       when 0
           compute pax-sayisi = rez-buyuk
       when 2 
           compute pax-sayisi = rez-buyuk +  rez-kucuk  + rez-free
       when 3
           compute pax-sayisi = rez-buyuk +  rez-kucuk  + rez-free + rez-bebek
       when 4
           compute pax-sayisi = rez-buyuk +  rez-kucuk 
       when other
            compute pax-sayisi = rez-buyuk + ( rez-kucuk / 2 )   
      end-evaluate


       compute hes-tutar rounded = rez-fiyati / pax-sayisi
       move hes-tutar  to z-gt
       move z-gt       to det-pax-gun

       compute hes-tutar rounded = rez-top-fiyat / pax-sayisi
       move hes-tutar  to z-gt
       move z-gt       to det-pax-top


       compute tarih-oda = tarih-oda + 1
       compute tarih-pax = tarih-pax + rez-buyuk
       compute tarih-chi = tarih-chi + rez-kucuk
       compute tarih-fre = tarih-fre + rez-free
       compute tarih-beb = tarih-beb + rez-bebek
      
       if  rez-doviz = butce-cev-doviz 
          move rez-top-fiyat to cev-top-fiyat
          else
           initialize  kur-rec
            move "01" to kur-banka
            move rez-isl-tar to kur-tarih
             move butce-cev-doviz to kur-doviz
                 read kur no lock invalid
                        move 1 to cev-kur
                     not invalid 
                       move doviz-alis to cev-kur
                  end-read
             initialize  kur-rec
             move "01" to kur-banka
              move rez-isl-tar to kur-tarih
             move rez-doviz to kur-doviz
                 read kur no lock invalid
                        move 1 to rez-kur
                     not invalid 
                       move doviz-alis to rez-kur
                  end-read

           compute cev-top-fiyat rounded =  rez-top-fiyat * rez-kur / cev-kur 
      end-if
        compute tarih-tutar = tarih-tutar + cev-top-fiyat
      if takasi-rez-no not > 0 and   takasi-grup-no > 0
           compute t-oda   = t-oda   + grup-oda-say
       compute t-pax   = t-pax   + grup-pax-say
       
       compute t-tut = t-tut + rez-top-fiyat
          else
           compute t-oda   = t-oda   + 1
       compute t-pax   = t-pax   + rez-buyuk
       compute t-chi   = t-chi   + rez-kucuk
       compute t-fre   = t-fre   + rez-free
       compute t-beb   = t-beb   + rez-bebek
       compute t-tut = t-tut + rez-top-fiyat
      end-if
      


      move rez-staf to K-KODU 
      read kllnc no lock invalid
              initialize kllnc-rec
              continue
      end-read
      move rez-staf      to det-23
      move K-ADI         to det-24
      move K-SOYADI      to det-25
      move cev-top-fiyat to ztfiy
      move ztfiy         to det-193

      compute gece-ort-fiy rounded = rez-top-fiyat / geceleme
      move gece-ort-fiy           to zgfiy
      move zgfiy                  to det-13-6

      compute ort-top = ort-top + gece-ort-fiy

      compute gece-ort-fiy rounded = cev-top-fiyat / geceleme
      move gece-ort-fiy           to zgfiy
      move zgfiy                  to det-13-7


      move "|" to fil-1 fil-1-1 fil-2 fil-g fil-3 fil-4 fil-5 fil-6
           fil-7 fil-8 fil-88 fil-9 fil-10 fil-11
           fil-12 fil-13 fil-14 fil-15 fil-16 fil-16-0
           fil-17 fil-18 fil-19  fil-191 fil-192 fil-193 fil-20 fil-21 fil-22   
           fil-30 fil-31 fil-ack fil-23 fil-24 fil-25 fil-26
           fil-9-9 fil-10-10 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7  fil-pax-gun fil-pax-top
       write dokumer-rec from detay

      initialize takas-rec
      evaluate rap-det
       when "A"
        initialize takas-rec
      
        move rez-oda-konumu   to takas-anahtar
          perform takas-topla
       when "B" 
        initialize takas-rec
       
         if merkez-kodlar = 1 then
             move rez-acenta       to   acenta-kodu



             read acenta no lock invalid continue
             end-read
             move acenta-merkez-kodu to takas-anahtar
          else
           move rez-acenta       to takas-anahtar  acenta-kodu
        end-if
           perform takas-topla
       
       when "C"
        initialize takas-rec
      
        move rez-ulke         to takas-anahtar
          perform takas-topla
       when "D"
       initialize takas-rec
       
        move rez-pan-tipi     to takas-anahtar
          perform takas-topla
         
       when "E"
         initialize takas-rec
       
        move rez-anlasma      to takas-anahtar
        read takas no lock invalid 
             initialize takas-rec
             move rez-anlasma     to takas-anahtar
        end-read
         perform takas-topla
       when "F"
       initialize takas-rec
      
        move rez-odeme-tipi   to takas-anahtar
          perform takas-topla
       when "G"  
       initialize takas-rec
      
        move rez-doviz   to z2
        move z2          to takas-anahtar
         perform takas-topla
       when "H"
       initialize takas-rec
      
        move rez-pazar   to takas-anahtar
         perform takas-topla
       when "T"


         initialize takas-rec
        
         move rez-pazar   to takas-anahtar
         perform takas-topla

      end-evaluate
                       .
*
 fiyatlar.
           initialize hesayr-rec  ilk-tur
           move rez-no to hesayr-rez-no
                start hesayr key > hesayr-anah invalid continue
                    not invalid
                      perform until fs-hesayr = "10"
                        read hesayr next no lock end move "10" to fs-hesayr
                           not end
                             if   rez-no not = hesayr-rez-no 
                                   move "10" to fs-hesayr
                                   exit perform cycle
                             end-if
                               add hesayr-ham-fiyat to  takasi-ham
                               add  hesayr-eb-tut   to takasi-eb
                               add  hesayr-aks1-tut hesayr-aks2-tut  hesayr-so1-tut hesayr-so2-tut to    takasi-aks-tut
                               add  hesayr-basilacak-tut to takasi-basilacak
                                if hesayr-aks1-tut > 0 then 
                                        move hesayr-aks1-acik to    takasi-aks-acik
                                  else
                                    if hesayr-aks2-tut > 0 then 
                                        move hesayr-aks2-acik to    takasi-aks-acik
                                   end-if
                                end-if
                                if  ilk-tur = 0 then
                                    move 1 to ilk-tur
                                    move hesayr-ham-fiyat to z-tutar
                                    string "Ham:" delimited by size
                                           z-tutar delimited by size
                                      into takasi-top-acik
                                    
                                    if hesayr-ind-tut > 0 
                                       string takasi-top-acik delimited by "     "
                                              "-Ind:"         delimited by size
                                              hesayr-ind-acik delimited by ",00" 
                                         into takasi-top-acik
                                    end-if
                                   
                                    if hesayr-eb-tut > 0 
                                       string takasi-top-acik delimited by "     "
                                              "-Eb:%"         delimited by size
                                              hesayr-eb-acik  delimited by ",00"  
                                         into takasi-top-acik
                                   end-if
                                   if hesayr-ug-tut > 0 
                                      string takasi-top-acik delimited by "     "
                                             "-Ug:"          delimited by size
                                             hesayr-ug-acik  delimited by size
                                        into takasi-top-acik
                                   end-if
                                 
                                   if hesayr-ozl-tut > 0 
                                      string takasi-top-acik delimited by "     "
                                             "-Ozl:"         delimited by size
                                             hesayr-ozl-acik delimited by size
                                        into takasi-top-acik
                                   end-if

                                   if hesayr-aks1-tut > 0 
                                      string takasi-top-acik  delimited by "     "
                                             "-Aks:"          delimited by size
                                             hesayr-aks1-acik delimited by  ",00" 
                                        into takasi-top-acik
                                   end-if

                                   if hesayr-aks2-tut > 0 
                                      string takasi-top-acik  delimited by "     "
                                             "-Aks:"          delimited by size
                                             hesayr-aks2-acik delimited by ",00" 
                                        into takasi-top-acik
                                   end-if

                                   if hesayr-so1-tut > 0 
                                      string takasi-top-acik delimited by "     "
                                             "-Sp:"          delimited by size
                                             hesayr-so1-acik delimited by size
                                        into takasi-top-acik
                                   end-if
               
                                   if hesayr-so2-tut > 0 
                                      string takasi-top-acik delimited by "     "
                                             "-Sp:"          delimited by size
                                             hesayr-so2-acik delimited by size
                                        into takasi-top-acik
                                   end-if

                                   if hesayr-kkp-tut > 0 
                                      string takasi-top-acik delimited by "     "
                                             "-KKP:"         delimited by size
                                             hesayr-kkp-acik delimited by size
                                        into takasi-top-acik
                                   end-if      

                                   if hesayr-kom-tut > 0 
                                      string takasi-top-acik delimited by "     "
                                             "-Kom:"         delimited by size
                                             hesayr-kom-acik delimited by size
                                        into takasi-top-acik
                                   end-if

                                   if hesayr-kb-tut > 0                       
                                      string takasi-top-acik delimited by "     "
                                             "-Kick:"        delimited by size
                                             hesayr-kb-acik  delimited by size
                                        into takasi-top-acik
                                   end-if
                              end-if
                                
                       end-read
                     end-perform
                end-start


                         .
*
 takas-topla.
                   if takasi-rez-no not > 0 and   takasi-grup-no > 0
                        
                          move grup-gun-tut to  rez-fiyati
                         move grup-top-tut to  rez-top-fiyat
                         else 
                         move 1 to  grup-oda-say
                         move rez-buyuk to grup-pax-say

                     end-if
                        read takas no lock invalid 
                               continue
                          end-read
                        compute takas-oda   = takas-oda + grup-oda-say
                        compute takas-pax   = takas-pax   + grup-pax-say
                        compute takas-child = takas-child + rez-kucuk
                        compute takas-free  = takas-free  + rez-free
                        compute takas-bebek = takas-bebek + rez-bebek
                           compute takas-tutar = takas-tutar + rez-top-fiyat
                        write takas-rec invalid 
                              rewrite takas-rec 
                          end-rewrite 
                        end-write.
                        if muh-sup = 1
                        initialize takasd-rec
                        move rez-doviz to takasd-anahtar
                        read takasd no lock invalid 
                               continue
                          end-read
                        compute takasd-oda   = takasd-oda + grup-oda-say
                        compute takasd-pax   = takasd-pax   + grup-pax-say
                        compute takasd-child = takasd-child + rez-kucuk
                        compute takasd-free  = takasd-free  + rez-free
                        compute takasd-bebek = takasd-bebek + rez-bebek
                        compute takasd-tutar = takasd-tutar + rez-top-fiyat
                        write takasd-rec invalid 
                              rewrite takasd-rec 
                          end-rewrite 
                        end-write
                        if  rez-doviz = butce-cev-doviz 
                            move rez-top-fiyat to cev-top-fiyat
                            else
                             initialize  kur-rec
                              move "01" to kur-banka
                              move rez-isl-tar to kur-tarih
                               move butce-cev-doviz to kur-doviz
                                   read kur no lock invalid
                                          move 1 to cev-kur
                                       not invalid 
                                         move doviz-alis to cev-kur
                                    end-read
                               initialize  kur-rec
                               move "01" to kur-banka
                                move rez-isl-tar to kur-tarih
                               move rez-doviz to kur-doviz
                                   read kur no lock invalid
                                          move 1 to rez-kur
                                       not invalid 
                                         move doviz-alis to rez-kur
                                    end-read

                             compute cev-top-fiyat rounded =  rez-top-fiyat * rez-kur / cev-kur 
                        end-if
                         initialize takasd-rec
                        move high-values to takasd-anahtar
                        read takasd no lock invalid 
                               continue
                          end-read
                        compute takasd-oda   = takasd-oda + grup-oda-say
                        compute takasd-pax   = takasd-pax   + grup-pax-say
                        compute takasd-child = takasd-child + rez-kucuk
                        compute takasd-free  = takasd-free  + rez-free
                        compute takasd-bebek = takasd-bebek + rez-bebek
                          compute takasd-tutar = takasd-tutar + cev-top-fiyat
                        write takasd-rec invalid 
                              rewrite takasd-rec 
                          end-rewrite 
                        end-write
                       end-if .


*
 liste-tarih-toplam.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-1-1 det-2 det-g det-3 det-4 det-5 det-6
                    det-7 det-8 det-88 det-9 det-10 det-11 
                    det-12 det-13 det-14 det-15 det-16 det-16-0
                    det-17 det-18 det-19 det-191 det-20 det-21 det-22  det-23 det-24 det-25  det-26
                    det-9-9 det-10-10 det-13-1 det-13-2 det-13-3 det-13-4 det-13-5 det-13-6 det-13-7 det-pax-gun det-pax-top
    write dokumer-rec from detay.

    initialize dokumer-rec detay
    move "-Tarih-" to det-2.
    move "-Toplam-" to det-3.
        evaluate rap-sir(1:1)
            when "A"
                move kont-gun  to xgun
                move kont-ay   to xay
                move kont-yil  to xyil
                move xtarih to det-1
            when "B"
               
                move kont-ay   to xay
                move kont-yil  to xyil
                move xtarih to det-1
                initialize det-1(1:3)
                move "girisler" to det-2
            when "C"
             move tarih-kont(1:4) to tarih-kont acenta-kodu,
             read acenta no lock invalid
               move all "*" to acenta-adi
             end-read
              move "Acenta" to det-2
             move acenta-adi to det-4  
            when "D"
             move tarih-kont(1:2) to tarih-kont doviz-kodu,
             read doviz no lock invalid
               move all "*" to d-kisa-adi
             end-read
              move "Doviz" to det-2
             move d-kisa-adi to det-4
            when "E"
             move tarih-kont to tarih-kont kodlar02-kodu
             move "E"   to kodlar02-tipi,
             read kodlar02 no lock invalid
               move all "*" to kodlar02-adi
             end-read
              move "Pazar" to det-2
             move kodlar02-adi to det-4


        end-evaluate   
    
      
   
    move tarih-oda    to z-2
    move z-2          to det-5
    move tarih-pax    to z-2   
    move z-2          to det-6
    move tarih-chi    to z-2  
    move z-2          to det-7
    move tarih-fre    to z-2   
    move z-2          to det-8
    move tarih-beb    to z-2   
    move z-2          to det-88
    move t-geceleme   to z-3   
    move z-3          to det-13-3
    

    move "IslTar Paritesi ile " to det-ack
          
            
    move kur-adi            to det-20
    move tarih-tutar        to ztfiy
    move ztfiy              to det-192


    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1 fil-1-1 fil-2 fil-g fil-3 fil-4 fil-5 fil-6
                fil-7 fil-8 fil-88 fil-9 fil-10 fil-11
                fil-12 fil-13 fil-14 fil-15 fil-16  fil-16-0
                fil-17 fil-18 fil-19 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22  fil-23 fil-24 fil-25 fil-26
                fil-9-9 fil-10-10 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7   fil-pax-gun fil-pax-top
    write dokumer-rec from detay
    initialize t-geceleme
    .
*
*
 gelen-yaz.
       initialize il
       perform varying il from 1 by 1 until il > 200 or GEL-LNK2(il) not > spaces
        initialize dokumer-rec detay
        move    detg-det(il) to        det-3                 
        if il = 1 
                move detg-1(il) to det-4             
                move detg-2(il) to det-5             
                move detg-3(il) to det-6             
                move detg-4(il) to det-7             
                move detg-5(il) to det-8             
                move detg-6(il) to det-88            
                move detg-7(il) to det-9             
                move detg-8(il) to det-10            
                move detg-9(il) to det-11            
                move detg-10(il) to det-17            
                move detg-11(il) to det-18            
                move detg-12(il) to det-30            
                move detg-13(il) to det-31            
                move detg-top(il) to   det-ack 
                move "A"          to det-dokumer-20(3:1)
                            move 481          to det-renk1
                            move "1"          to det-dokumer-20(10:1)                 
        

        
         else                               
        move function numval(detg-1(il))   to z-g    move  z-g  to det-4             
        move function numval(detg-2(il))   to z-g    move  z-g  to det-5             
        move function numval(detg-3(il))   to z-g    move  z-g  to det-6             
        move function numval(detg-4(il))   to z-g    move  z-g  to det-7             
        move function numval(detg-5(il))   to z-g    move  z-g  to det-8             
        move function numval(detg-6(il))   to z-g    move  z-g  to det-88            
        move function numval(detg-7(il))   to z-g    move  z-g  to det-9             
        move function numval(detg-8(il))   to z-g    move  z-g  to det-10            
        move function numval(detg-9(il))   to z-g    move  z-g  to det-11            
        move function numval(detg-10(il))  to z-g    move  z-g  to det-17            
        move function numval(detg-11(il))  to z-g    move  z-g  to det-18            
        move function numval(detg-12(il))  to z-g    move  z-g  to det-30            
        move function numval(detg-13(il))  to z-g    move  z-g  to det-31            
        move function numval(detg-top(il)) to z-gt   move  z-gt to det-ack 
        end-if
         move "|" to fil-1 fil-1-1 fil-2  fil-g fil-3  fil-4  fil-5 fil-6
                     fil-7 fil-8   fil-88 fil-9 fil-10 fil-11
                fil-12 fil-13 fil-14 fil-15 fil-16  fil-16-0
                fil-17 fil-18 fil-19 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22  fil-23 fil-24 fil-25 det-26
                fil-9-9 fil-10-10 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7  fil-pax-gun fil-pax-top
                if il < 100 
                  if   GEL-LNK2( il + 1 ) not > spaces
                    move "A"          to det-dokumer-20(3:1)
                            move 481          to det-renk1
                            move "1"          to det-dokumer-20(10:1)

                end-if
              end-if
    write dokumer-rec from detay  
       end-perform

        .
*
 liste-genel-toplam.
  
   
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-1-1 det-2 det-3 det-4 det-5 det-6
                    det-7 det-8 det-88 det-9 det-10 det-11 
                    det-12 det-13 det-14 det-15 det-16  det-16-0
                    det-17 det-18 det-19 det-191 det-20 det-21 det-22 det-23 det-24 det-25 det-26
                    det-9-9 det-10-10 det-13-1 det-13-2 det-13-3 det-13-4 det-13-5 det-13-6 det-13-7 det-pax-gun det-pax-top
    write dokumer-rec from detay
    initialize dokumer-rec detay      
    move "-Genel-" to det-2.
    move "-Toplam-" to det-3.
     move 481          to det-renk1
     if muh-sup = 1
      initialize takasd-rec
     start takasd key > takasd-anahtar invalid move "10" to fs-takasd
      not invalid 
        read takasd next no lock end move "10" to fs-takasd
        not end
          if takasd-anahtar = high-values
             move "IslTar Paritesi ile " to det-ack
             move "TOPLAM"               to det-19
             move 176                    to det-renk1
             move kur-adi                to det-20
          else
             move takasd-anahtar         to doviz-kodu
             read doviz no lock invalid 
                  move all "*"           to d-kisa-adi
             end-read 
             move d-kisa-adi             to det-19
          end-if
          move takasd-tutar              to ztfiy
          move ztfiy                     to det-192
        end-read
    end-start
    else
    move "10" to fs-takasd
    end-if
    move t-oda          to z-2
    move z-2            to det-5
    move t-pax          to z-2   
    move z-2            to det-6
    move t-chi          to z-2  
    move z-2            to det-7
    move t-fre          to z-2   
    move z-2            to det-8
    move t-beb          to z-2   
    move z-2            to det-88
    move genel-share    to z-2
    move z-2            to det-4
    move genel-geceleme to z-3
    move z-3            to det-13-3
    move "A"            to det-dokumer-20(3:1)
   
    move "1"            to det-dokumer-20(10:1)
    move "|" to fil-1 fil-1-1 fil-2 fil-g fil-3 fil-4 fil-5 fil-6
                fil-7 fil-8 fil-88 fil-9 fil-10 fil-11
                fil-12 fil-13 fil-14 fil-15 fil-16  fil-16-0
                fil-17 fil-18 fil-19 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22  fil-23 fil-24 fil-25  fil-26
                fil-9-9 fil-10-10 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7  fil-pax-gun fil-pax-top
    write dokumer-rec from detay.
    
    perform until fs-takasd = "10"
            initialize dokumer-rec detay 
             read takasd next no lock end move "10" to fs-takasd
               not end
                 move 481          to det-renk1
              if takasd-anahtar = high-values
          move "IslTar Paritesi ile " to det-ack
            move "TOPLAM" to  det-19
            move 176  to det-renk1
            move kur-adi to  det-20
            else
            move takasd-anahtar       to doviz-kodu
            
                         read doviz no lock invalid 
                             move all "*"     to D-KISA-ADI
                             
                         end-read 
                             move D-KISA-ADI to det-19
           end-if
                    move takasd-tutar to ztfiy
                    move ztfiy        to det-192

                   move "A"          to det-dokumer-20(3:1)
                  
                    move "1"          to det-dokumer-20(10:1)
                           move "|" to fil-1 fil-1-1 fil-2 fil-g fil-3 fil-4 fil-5 fil-6
                                fil-7 fil-8 fil-88 fil-9 fil-10 fil-11
                                fil-12 fil-13 fil-14 fil-15 fil-16 fil-16-0
                                fil-17 fil-18 fil-19 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22  fil-23 fil-24 fil-25 fil-26
                                fil-9-9 fil-10-10 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7  fil-pax-gun fil-pax-top
                                 write dokumer-rec from detay
                 end-read
    end-perform 



    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-1-1 det-2 det-3 det-4 det-5 det-6
                    det-7 det-8 det-88 det-9 det-10 det-11 
                    det-12 det-13 det-14 det-15 det-16     det-16-0
                    det-17 det-18 det-19 det-191 det-20 det-21 det-22  det-23 det-24 det-25 det-26 
                    det-9-9 det-10-10 det-13-1 det-13-2 det-13-3 det-13-4 det-13-5 det-13-6 det-13-7 det-pax-gun det-pax-top
    write dokumer-rec from detay.
   

*
 takas-yaz.
    initialize dokumer-rec detay
    move "Dagilim"  to det-2.
    evaluate rap-det
       when "A" move "Oda Konumu" to det-3
       when "B" 
        if merkez-kodlar = 1 
          move "Merkez Acenta " to det-3
          else
       
            move "Acenta    " to det-3
       end-if
       when "C" move "Ulke      " to det-3
       when "D" move "Pansiyon  " to det-3
       when "E" move "Anlas.Tipi" to det-3
       when "F" move "Odeme Tipi" to det-3
       when "G" move "Doviz Kodu" to det-3
       when "H" move "Pazar Kodu" to det-3
    end-evaluate
    move "A"          to det-dokumer-20(3:1)
    move 104          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1 fil-1-1 fil-2 fil-g fil-3 fil-4 fil-5 fil-6
                fil-7 fil-8 fil-88 fil-9 fil-10 fil-11
                fil-12 fil-13 fil-14 fil-15 fil-16   fil-16-0
                fil-17 fil-18 fil-19 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22 fil-23 fil-24 fil-25 fil-26
                fil-9-9 fil-10-10 fil-13-1 fil-13-2 fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7  fil-pax-gun fil-pax-top
    write dokumer-rec from detay.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-1-1 det-2 fil-g det-3 det-4 det-5 det-6
                    det-7 det-8 det-88 det-9 det-10 det-11 
                    det-12 det-13 det-14 det-15 det-16  det-16-0
                    det-17 det-18 det-19 det-191 det-20 det-21 det-22  det-23 det-24 det-25 det-26
                    det-9-9 det-10-10 det-13-1 det-13-2 det-13-3 det-13-4 det-13-5 det-13-6 det-13-7 det-pax-gun det-pax-top
    write dokumer-rec from detay.


    initialize takas-rec 
    start takas key not < takas-anahtar invalid 
          continue
    not invalid
    initialize fs-takas
    perform with test after until fs-takas = "10"
          read takas next no lock end move "10" to fs-takas
          not at end
               initialize dokumer-rec detay
               evaluate rap-det
                   when "A"
                         move takas-anahtar(1:2)  to konum-anahtar
                         read konum no lock invalid
                              move all "*" to konum-adi 
                         end-read
                         move konum-anahtar   to det-2
                         move konum-adi       to det-3
                   when "B"
                         if merkez-kodlar = 1 then 
                            initialize merkez-rec
                            move "A" to merkez-tipi
                            move takas-anahtar(1:4)      to merkez-kodu
                            read merkez no lock invalid
                                 initialize det-2  det-3
                                 move   "****"   to det-2                                          
                                 move "*******"     to det-3
                            not invalid
                                initialize det-2  det-3
                                move   merkez-kodu   to det-2                                          
                                move merkez-adi      to det-3
                            end-read
                                        
                         else 
                            move takas-anahtar(1:4)  to acenta-anahtar
                            read acenta no lock invalid
                                 move all "*" to acenta-adi
                            end-read
                            move acenta-anahtar  to det-2
                            move acenta-adi      to det-3
                         end-if
                   when "C"
                         move takas-anahtar(1:3)  to ulke-anah
                         read ulke no lock invalid
                              move all "*" to ulke-adi
                         end-read
                         move ulke-anah       to det-2
                         move ulke-adi        to det-3
                   when "D"
                         move takas-anahtar(1:2)  to kodlar02-kodu
                         move "A"                 to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all "*" to kodlar02-adi
                         end-read
                         move kodlar02-kodu   to det-2
                         move kodlar02-adi    to det-3
                   when "E"
                         move takas-anahtar(1:2)  to kodlar02-kodu
                         move "D"                     to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all "*" to kodlar02-adi
                         end-read
                         move kodlar02-kodu   to det-2
                         move kodlar02-adi    to det-3
                   when "F"
                         move takas-anahtar(1:2)  to kodlar02-kodu
                         move "B"                 to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all "*" to kodlar02-adi
                         end-read
                         move kodlar02-kodu   to det-2
                         move kodlar02-adi    to det-3
                   when "G"
                         move function numval(takas-anahtar)       to doviz-kodu
                         read doviz no lock invalid 
                            move all "*"          to d-kisa-adi
                         end-read 
                            move doviz-kodu       to det-2
                            move d-kisa-adi       to det-3
                   when "H"
                         move takas-anahtar  to kodlar02-kodu
                         move "E"                 to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all "*" to kodlar02-adi
                         end-read
                         move kodlar02-kodu   to det-2
                         move kodlar02-adi    to det-3
                   when "I" 
                      move takas-anahtar(1:4) to xyil
                      move takas-anahtar(5:2) to xay
                      move takas-anahtar(7:2) to xgun
                      move xtarih to   det-2
                      move xtarih to   det-3
               end-evaluate
                   move takas-oda    to z-2
                   move z-2          to det-5
                   move takas-pax    to z-2   
                   move z-2          to det-6
                   move takas-child  to z-2  
                   move z-2          to det-7
                   move takas-free   to z-2   
                   move z-2          to det-8
                   move takas-bebek  to z-2   
                   move z-2          to det-88
            move "A"          to det-dokumer-20(3:1)
            move 104          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            move "|" to fil-1 fil-1-1 fil-2 fil-3 fil-4 fil-5 fil-6
                        fil-7 fil-8 fil-88 fil-9 fil-10 fil-11
                        fil-12 fil-13 fil-14 fil-15 fil-16  fil-16-0
                        fil-17 fil-18 fil-19 fil-191 fil-192 fil-193 fil-20 fil-21 fil-22 fil-23 fil-24 fil-25 
                        fil-9-9 fil-10-10 fil-13-1 fil-13-2  fil-13-3 fil-13-4 fil-13-5 fil-13-6 fil-13-7   fil-pax-gun fil-pax-top
            write dokumer-rec from detay
          end-read
    end-perform
    end-start.
 acc-07-Aft-Procedure.
     open input acenta
     if rapor-acenta = spaces
        move "Tum Acentalar"   to acenta-adi
     else
        move rapor-acenta    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 15 to control-id
        end-read
     end-if
     display lb-acenta.
     close acenta.
     
     .
*
 acc-08-Aft-Procedure.
     open input grup
     if acn-grup-kod = spaces
        if rapor-acenta = spaces
           move "Tum Gruplar"   to grup-adi
        end-if
     else
        initialize grup-rec
        set grup-acenta to true
        move acn-grup-kod    to grup-kodu
        read grup no lock invalid
             move "Tanimsiz Acenta Grubu..." to grup-adi
             move 4 to accept-control
             move 23 to control-id
        end-read
        
     end-if
     display lb-acngrupadi
     close grup
     .
*
 Form1-Ef-1-Aft-Procedure.
       open input kur doviz 
         move butce-cev-doviz to DOVIZ-KODU
         read doviz no lock invalid
            display message box  "Tanimsiz Doviz Girdiniz"
            move "Tanimsiz " to d-kisa-adi
         end-read
         move  d-kisa-adi to kur-adi

        move tarih-tasi to kur-tarih
        move "87" to kur-banka
       
          move "01" to kur-banka
      
        move doviz-kodu to kur-doviz
           read kur no lock invalid
                  move 1 to doviz-alis
                
            end-read
           move doviz-alis to cevrim-kuru cevrim-kur-sayisal
         display kdov adov ikur
        close kur doviz
     .
*
 devremulk-guncel-borc-hesapla.
     open i-o odemeler 
     initialize odemeler-rec takas-rec
     move rez-dev-uye-no to odemeler-devremulk-no
     move low-values     to odemeler-sira
     start odemeler key not < odemeler-anah invalid
           continue
     not invalid
     perform with test after until fs-odemeler = "10"
     read odemeler next no lock end move "10" to fs-odemeler
     not at end
         
         if odemeler-devremulk-no <> rez-dev-uye-no 
            exit perform
         end-if
         move odemeler-doviz-kodu to takas13-doviz-kodu 
         read takas13 no lock invalid
              continue
         end-read
         evaluate odemeler-hareket-turu
             when "B"
                  compute takas13-toplam-tl = takas13-toplam-tl - odemeler-tutar  
                  compute takas13-toplam-doviz = takas13-toplam-doviz - odemeler-tutar-dv  
             when "A"
                  compute takas13-toplam-tl = takas13-toplam-tl + odemeler-tutar  
                  compute takas13-toplam-doviz = takas13-toplam-doviz + odemeler-tutar-dv
         end-evaluate
         write takas13-rec invalid
            rewrite takas13-rec end-rewrite
         end-write

     end-read
     end-perform
     end-start 
     close odemeler
     initialize takas13-rec ztl-top zdov-top
     start takas13 key not < takas13-anah invalid
           continue
     not invalid
     perform with test after until fs-takas13 ="10"
     read takas13 next no lock end move "10" to fs-takas13
     not at end
         move takas13-toplam-tl    to ztl-top
         move takas13-toplam-doviz to zdov-top
     end-read
     end-perform 
     end-start


    .
 

 
