* gruplar.evt
* gruplar.evt is generated from D:\asya\acugt.ytl\otel\gruplar.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-Form1-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form1-Ta-1-Value
        MOVE 0 TO Form1-Pg-1-Visible, Form1-Pg-2-Visible,
            Form1-Pg-3-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form1-Pg-1-Visible
        WHEN 2
           MOVE 1 TO Form1-Pg-2-Visible
        WHEN 3
           MOVE 1 TO Form1-Pg-3-Visible
        END-EVALUATE
        PERFORM Form1-Ta-1-Bef-Tabchg-Display
        DISPLAY Form1
        PERFORM Form1-Ta-1-Aft-Tabchg-Display
     END-EVALUATE
     .

 Acu-Form3-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form3-Ta-1-Value
        MOVE 0 TO Form3-Pg-1-Visible, Form3-Pg-2-Visible,
            Form3-Pg-3-Visible, Form3-Pg-4-Visible, Form3-Pg-5-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form3-Pg-1-Visible
        WHEN 2
           MOVE 1 TO Form3-Pg-2-Visible
        WHEN 3
           MOVE 1 TO Form3-Pg-3-Visible
        WHEN 4
           MOVE 1 TO Form3-Pg-4-Visible
        WHEN 5
           MOVE 1 TO Form3-Pg-5-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form3
        PERFORM Form3-Ta-1-Aft-Tabchg-Display
     END-EVALUATE
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Gd-2-Event-Proc.
     EVALUATE Event-Control-Id
     WHEN 6
        PERFORM Form1-Gd-3-Ev-Other
     WHEN 10
        PERFORM Form1-Gd-2-Ev-Other
     END-EVALUATE
     .

 Form1-Ta-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM Form1-Ta-1-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 Form1-Gd-4-Event-Proc.
     PERFORM Form1-Gd-4-Ev-Other
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form3-Ta-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM Form3-Ta-1-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 Form3-Gd-1-Event-Proc.
     PERFORM Form3-Gd-1-Ev-Other
     .

 Form3-Gd-2-Event-Proc.
     PERFORM Form3-Gd-2-Ev-Other
     .

 Form3-Gd-2-Exception-Proc.
     .

 Form3-Gd-3-Event-Proc.
     PERFORM Form3-Gd-3-Ev-Other
     .

 Form3-Gd-4-Event-Proc.
     PERFORM Form3-Gd-4-Ev-Other
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form4-Gd-1-Event-Proc.
     PERFORM Form4-Gd-1-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform icyetki-kontrol
     call "c$narg" using link-var.
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read
     close genel.
     open input kllnc
     initialize kllnc-rec
     open i-o odalar2
     move k-kodu-tasi         to k-kodu
     read kllnc no lock invalid 
           display message box "Kullanici Bulunamadi..."
                           title "[ Uyari ]"
                           icon 1
              close kllnc
              exit paragraph 
     end-read 
     close kllnc
     perform read-genelfis.

     move ekran-fis-1     to xblok-dosya-no.

     open  i-o rez  takvim.
       
     initialize gec-gecme dondur-baba.
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka gruplar-banka.
     move rezpara-doviz       to xrez-doviz gruplar-doviz.
     move rezpara-pan-tipi    to xrez-pan-tipi gruplar-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi gruplar-odeme.
     move rezpara-ulke        to xrez-ulke gruplar-ulke.
     move rezpara-anlasma     to xrez-anlasma gruplar-anlasma.
     move rezpara-pazar       to xrez-pazar gruplar-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil gruplar-gel-yil gruplar-git-yil xrez-al-yil gruplar-satis-yil xrez-isl-yil gruplar-isl-yil.
     move calis-ay            to xrez-gir-ay  xrez-cik-ay gruplar-gel-ay gruplar-git-ay xrez-al-ay gruplar-satis-ay xrez-isl-ay gruplar-isl-ay.
     move calis-gun           to xrez-gir-gun xrez-cik-gun gruplar-gel-gun gruplar-git-gun xrez-al-gun gruplar-satis-gun xrez-isl-gun gruplar-isl-gun.
     move "4"                 to xrez-gr-status.
 default-ata.
*************Default Degerler Ataniyor.........
        continue.
 

*
 Form1-Aft-Initdata.
     open i-o gruplog bloklog close bloklog gruplog
     initialize konumlar-sayi

     move 1 to satistami
     perform load-konum
     
*     move 0 to satistami
*     perform load-konum

     
     perform grid-reset.

     perform default-gecerli-konum   
     perform konumlar-to-cb

     perform rez-parametre-ata
     perform default-ata
     perform gun-bul
     perform form-update

*     perform acenta-oku   thru acenta-oku-exit

     perform banka-oku    thru banka-oku-exit
     perform doviz-oku    thru doviz-oku-exit
     perform firma-oku
     
     perform pansiyon-oku thru pansiyon-oku-exit
     perform odeme-oku    thru odeme-oku-exit
     perform anlasma-oku  thru anlasma-oku-exit
     perform pazar-oku    thru pazar-oku-exit
     perform ulke-oku     thru ulke-oku-exit.
     if link-grup-kodu > 0
        move link-grup-kodu        to grup-no
        display accept-grup-kodu
        move 1 to control-id
        move 4 to accept-control 
        perform Aft-Procedure
        modify accept-grup-kodu,enabled = false
     else
        move 1    to control-id
        move 4    to accept-control
        move  0   to grup-no
        perform Aft-Procedure
        move 1014 to control-id
        move 4    to accept-control
        modify grst-acc,value = 4
*        modify accept-grup-kodu,enabled = false
       
     end-if 
      
     exit paragraph.



         
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 okunan-goster.
*************Formu Goster............
           perform gun-bul
           perform form-update
************Degerleri Oku
            perform acenta-oku   thru acenta-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            perform doviz-oku    thru doviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform firma-oku 
            perform not-goster
          
     .
*
 Aft-Procedure.
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
      initialize gec-gecme.
      evaluate control-id
       when 1003
            perform acenta-oku thru acenta-oku-exit
         when 22
            perform firma-oku
            if firma-rate not = spaces 
               if xrez-acenta  = spaces                      
                   move firma-rate to xrez-acenta
                   display accept-acenta
                end-if
            end-if            
      when 1
         move 0 to y-rez
           if key-status = 52
               exit paragraph
            end-if 
        if grup-no = zeroes
           perform fis-al
           move 1 to y-rez
        end-if

        delete file xblok
          perform gruplar-oku
          perform grupfiy-oku
          perform son-kontrol
        delete file takas 

      when 1016
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform banka-oku thru banka-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1017
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform doviz-oku thru doviz-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1018
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform pansiyon-oku thru pansiyon-oku-exit
            if gecmez
               exit paragraph
            end-if 
**********>Kontrat kontrolu....Alotment Rezervasyonar icin...
**********>Aksiyon ve stop-sale kontrolu
**********>KONTROLLER-2. 
             
       when 1019
            if key-status = 52
               exit paragraph
            end-if 
          
            initialize gec-gecme
            perform odeme-oku thru odeme-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1020
            if key-status = 52
               exit paragraph
            end-if 
          
            initialize gec-gecme
            perform anlasma-oku thru anlasma-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1021
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform pazar-oku thru pazar-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1022
            if key-status = 52
               exit paragraph
            end-if 
         
            initialize gec-gecme
            perform ulke-oku thru ulke-oku-exit
            if gecmez
               exit paragraph
            end-if 
        when 1004
        when 1005
        when 1006
            if son-baslangic-tarih <> xrez-gir-tar or 
               son-bitis-tarih <> xrez-cik-tar 
               if xrez-gir-tar < xrez-cik-tar
                  perform load-mygrid
                  move xrez-gir-tar         to son-baslangic-tarih
                  move xrez-cik-tar         to son-bitis-tarih
               end-if
            end-if
        when 1009
        when 1010
        when 1011
            if xrez-gir-tar > xrez-cik-tar 
               display omitted beep
               exit paragraph
            end-if
            if son-bitis-tarih <> xrez-cik-tar 
               perform load-mygrid
               move xrez-cik-tar         to son-bitis-tarih
            end-if
      end-evaluate.
      .
*
 exception-procedure.
         if key-status = 118
           perform extra-ac
         end-if
         if key-status = 120
           perform dis-veri-al
         end-if 
         if key-status = 2009
             perform sabit-kur-belirle
         end-if 
        if key-status  = 119
            perform toplu-degisim
        end-if 
        if key-status = 1005
           perform grupfiy-form-ac
        end-if 
        if key-status = 17
             move gruplar-dosya        to link-logview-dosya-adi
             set link-logview-pointer  to address of gruplar-rec
             set link-logview-rec-size to size of gruplar-rec
             perform logview-call
             initialize key-status
        end-if        
        if key-status  = 3131
            perform mesaj-gonder
        end-if
        if key-status =  1 
            evaluate control-id
              when 1 
*                 perform rezgrup2-olustur
*                 perform rezgrup-ara
                  perform grup-ara
              when  22
                    perform firma-ara   
              when  1003
                    perform acenta-ara   thru acenta-ara-exit
              when  1016
                    perform banka-ara    thru banka-ara-exit
              when  1017
                    perform doviz-ara    thru doviz-ara-exit
              when  1018
                    perform pansiyon-ara thru pansiyon-ara-exit
              
              when  1019
                    perform odeme-ara    thru odeme-ara-exit
              when  1020
                    perform anlasma-ara  thru anlasma-ara-exit
              when  1021
                    perform pazar-ara    thru pazar-ara-exit
              when  1022
                    perform ulke-ara     thru ulke-ara-exit
              when 28
                   perform kaynak1-ara
              when 167 
                   perform kaynak2-ara
              when 169
                   perform kaynak3-ara
            end-evaluate

     end-if .
      if key-status = 2  
               perform konum-isaretli-kontrol
               if isaretli-konum not = 1
                  display message box "Konum Secilmeden Grup Kaydedilemez..."
                                  title "Uyari"
                                  icon 1
                   exit paragraph 
               end-if 
               perform kaydet thru kaydet-exit 
       end-if
      if key-status = 3
               perform sil-rez-kontrol
               if buldum = 1
                   display message box grup-no" 'Nolu Gruba Bagli Rezervasyon Bulundu."new-line
                                              "Silme islemi yapilamaz."
                                   title "Uyari"
                                   icon 1
                   exit paragraph 
               else
                  perform gruplar-sil
               end-if
      end-if .
      if key-status = 5
          perform sil-rez-kontrol
          if buldum = 1
                   display message box grup-no" 'Nolu Gruba Bagli Rezervasyon Bulundu."new-line
                                              "Iptal islemi yapilamaz."
                                   title "Uyari"
                                   icon 1
                   exit paragraph              
          else 
             perform gruplar-iptal
          end-if 
      end-if 
      if key-status = 4
         perform route-prog-cagir
      end-if 
      if key-status = 6
           perform break-tablosu
      end-if. 
     

*
 kaydet. 
 kaydet-kontrol. 
        initialize mesaj-degiskenler gec-gecme.
        
           move 0 to y-rez
        move " [ Hata ] " to mmesaj-title
        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
        perform acenta-oku   thru acenta-oku-exit
                if gecmez 
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform banka-oku    thru banka-oku-exit
                if gecmez
                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform odeme-oku    thru odeme-oku-exit
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez
                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        move xrez-al-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Satis Tarihi Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 


        move xrez-gir-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-cik-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if
        if xrez-gir-tar  < tarih-tasi
           move "Hata Tipi : [ Uyumsuz Veri .......]" to mmesaj-1
          move "Hata Yeri : [ Gecmis Tarihe Rezervasyon Girilemez]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
*           go kaydet-exit
         end-if
        if xrez-cik-tar < xrez-gir-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if sabit-tar-kur = 1
           if kur-sabit-tar = zeroes 
              move "Hata Yeri : [ Kur Tarihi Sifir Yazilamaz...................]" to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
              go kaydet-exit
           end-if 
        end-if 
        if sabit-tar-kur = 1
           move kur-sabit-tar to tarih
           perform takvim-oku   thru takvim-oku-exit
           if gecmez
           move "Hata Yeri : [ Kur Tarihi Tanimsiz..............]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
           end-if
        end-if 
*/ konfirme denetimi 
            
       initialize mesaj-degiskenler
       move " [ Kaydet Soru ] " to mmesaj-title
       move " GIRDIGINIZ BILGILER KAYDEDILECEKTIR " to mmesaj-1.
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2. 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go kaydet-exit
       end-if

       if kayit-var
          initialize mesajcan
          if kirpma-bastan-var
             move kirpma-bastan-durum       to mesajcan
          end-if

          move x"0a0d"                       to mesajcan(149:)
          if kirpma-sondan-var
             move kirpma-sondan-durum       to mesajcan(151:)
          end-if

          if kirpma-bastan-var or
             kirpma-sondan-var
                    inspect mesajcan replacing trailing spaces by low-values
                    display message box mesajcan
                    x"0a0d",
                    "Devam etmek istermisiniz ?"
                    type mb_yes-no
                    default 2
                    returning return-code 
                    title "Bilginize"
                    icon mb_warning_icon
             if return-code <> 1 
                go kaydet-exit
             end-if
          end-if
       end-if

       initialize log-tar log-zaman

       accept log-tar from century-date 
       accept log-zaman from time
       
        perform kaydediliyor-gruplar.
        if link-var > 0 

        set exit-pushed to true 
           call "w$keybuf" using 1,x"1B" end-call
       
        end-if
        initialize gruplar-rec xgruplar-rec xrez-rec grup-no grup-adi 
                   kaynak1-tipi-goster 
                   kaynak2-tipi-goster
                   kaynak3-tipi-goster

        display acc-kaynak1 acc-kaynak2 acc-kaynak3
                lb-kaynak1 lb-kaynak2 lb-kaynak3
        perform grid-reset.

        perform rez-parametre-ata
        move 4 to accept-control
        move 1 to  control-id
        perform form-update .


 kaydet-exit. 
     exit. 

*
 firma-ara.
      initialize firma-cagir.
      call "/asya/ytl/obj/otel/firmara.asy" using firma-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/firmara.asy" 
       end-call.
       move firma-cagir     to xrez-firma.
       display accept-sirket
       perform firma-oku.
*
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to xrez-acenta.
*

*
 acenta-oku.
       open input acenta.
       initialize acenta-rec.
       move xrez-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            perform acen-dft-oku
            
       end-read
       close acenta.
       move acenta-adi     to adi-goster.
      
       modify lb-acenta-e, title = adi-goster.
       initialize adi-goster
       display accept-acenta.
             if y-rez = 1 and xrez-firma = spaces then
               perform acen-dft-yukle
            end-if   .

 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.

*
*
 firma-oku.
       open input firma.
       initialize firma-rec.
       move xrez-firma   to firma-kodu
       read firma        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            perform firma-dft-oku
       end-read
        
       
       close firma.
       move firma-adi     to sirket-goster.
       
       
       display accept-sirket lb-sirket.
        if y-rez = 1  then
               perform acen-dft-yukle
            end-if   .



*
 takvim-oku.
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.
 takvim-oku-exit.
       exit.







*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to xrez-banka.
 banka-oku.
       
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-banka-sabit = 1 and 
          acen-dft-banka not = xrez-banka
          display message box "Acenta icin sabit banka degeri girilmis" new-line
                              "Banka varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-banka to xrez-banka
        end-if.
       open input banka.
       initialize banka-rec.
       move xrez-banka    to banka-kodu
       read banka        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to adi-goster.
       modify lb-banka-e, title = adi-goster.
       initialize adi-goster
       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-doviz.
 doviz-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-doviz-sabit = 1 and 
          acen-dft-doviz not = xrez-doviz
          display message box "Acenta icin sabit doviz degeri girilmis " new-line
                              "Doviz varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-doviz to xrez-doviz
        end-if.
 
 
       open input doviz.
       initialize doviz-rec.
       move xrez-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-doviz-e, title = adi-goster.
       initialize adi-goster
       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.
       exit.

*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to xrez-pan-tipi.
 pansiyon-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pansiyon-sabit = 1 and 
          acen-dft-pan-tipi not = xrez-pan-tipi
          display message box "Acenta icin sabit pansiyon degeri girilmis" new-line
                              "Pansiyon varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pan-tipi to xrez-pan-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xrez-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pansiyon-e, title = adi-goster.
       initialize adi-goster
       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odemeara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-odeme-tipi.
 odeme-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-odeme-sabit = 1 and 
          acen-dft-odeme-tipi not = xrez-odeme-tipi
          display message box "Acenta icin sabit odeme degeri girilmis" new-line
                              "odeme varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-odeme-tipi to xrez-odeme-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-odeme-e, title = adi-goster.
       initialize adi-goster
       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy" 
       end-call.
       move infox-kodu-cagir     to xrez-anlasma.
 anlasma-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-anlasma-sabit = 1 and 
          acen-dft-anlasma not = xrez-anlasma
          display message box "Acenta icin sabit anlasma degeri girilmis" new-line
                              "Anlasma varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-anlasma to xrez-anlasma
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi.
       move xrez-anlasma       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-anlasma-e, title = adi-goster.
       initialize adi-goster
       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/pazarara.asy" 
       end-call.
       move pazar-kodu-cagir     to xrez-pazar.
 pazar-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pazar-sabit = 1 and 
          acen-dft-pazar not = xrez-pazar
          display message box "Acenta icin sabit pazar degeri girilmis" new-line
                              "Pazar varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pazar to xrez-pazar
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move xrez-pazar         to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pazar-e, title = adi-goster.
       initialize adi-goster
       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ulkeara.asy" 
       end-call.
       move ulke-cagir     to xrez-ulke.
 ulke-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-ulke-sabit = 1 and 
          acen-dft-ulke not = xrez-ulke 
          display message box "Acenta icin sabit ULKE  degeri girilmis" new-line
                              "ULKE  varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-ulke  to xrez-ulke 
        end-if.
       open input ulke.
       initialize ulke-rec.
       move xrez-ulke    to ulke-anah1
       read ulke         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close ulke.
       move ulke-adi     to adi-goster.
       modify lb-ulke-e, title = adi-goster.
       initialize adi-goster
       display accept-ulke.
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.

*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form1-Aft-Routine.
     close rez takvim  odalar2.
     .
*
 gun-bul.
     initialize gun-s
     move rez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= rez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      
                      end-if 
                end-read
             end-perform  
     end-start.
     move gun-s to gun-say
*     display la-gun
      .

     .
*******************************************************************
************ mesaj receiving olayi *******************************
 form-update.

        
        display
            accept-grup-adi
            accept-grup-kodu
            grst-acc
            accept-acenta 
            accept-gir-gun 
            accept-gir-ay 
            accept-gir-yil 
            accept-gir-saat 
            accept-gir-dakika 
            accept-cik-gun 
            accept-cik-ay 
            accept-sirket
            accept-cik-yil 
            accept-cik-saat 
            accept-cik-dakika 
            accept-banka 
            accept-doviz 
            accept-anlasma
            accept-pansiyon 
            accept-odeme 
            accept-pazar 
            accept-ulke 
            accept-not1
            accept-not2
            accept-kur
            accept-ind-orani
            accept-skur
             accept-skurb
            accept-room-kdv
            accept-extra-kdv
            accept-sat-gun
            accept-sat-ay
            accept-sat-yil
            accept-isl-gun
            accept-isl-ay
            accept-isl-yil
            accept-sabit-kur
            accept-kur-gun accept-kur-ay accept-kur-yil

            .
*
*
 firma-dft-oku.
      open input nt
     initialize not-rec 
     move "FIR" to not-dos
     move "Default" to not-dos-anah.
     move firma-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
      

     
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke     
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit.
*
 fis-al.
     open i-o genelfis
     initialize genelfis-rec 
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          initialize genelfis-rec
          move 1 to genelfis-anahtar
          write genelfis-rec end-write
     end-read
         if grup-oto = 9999
            add 1 to tel-fis-oto
         else
            add 1 to grup-oto 
         end-if 
          rewrite genelfis-rec end-rewrite                 
     close genelfis     
     if grup-oto = 9999
        
        compute tel-fis-oto = 10000 + tel-fis-oto
        move tel-fis-oto       to grup-no
     else
        move grup-oto          to grup-no
     end-if 

     
     add 100000 to  grup-no
     display accept-grup-kodu.

*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move xrez-kaynak-1 to onbkodlar10-kodu1
    read onbkodlar10 no lock invalid
        initialize onbkodlar10-rec
    end-read
        move onbkodlar10-adi to kaynak1-tipi-goster
        display acc-kaynak1 lb-kaynak1
    close onbkodlar10.

 kaynak2-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AC" to onbkodlar10-tipi
    move xrez-kaynak-2 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak2-tipi-goster
    display acc-kaynak2 lb-kaynak2
    close onbkodlar10.

 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AD" to onbkodlar10-tipi
    move xrez-kaynak-3 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak3-tipi-goster
    display acc-kaynak3 lb-kaynak3
    close onbkodlar10.


*****************************************************************************
*****************************************************************************
********************************YENÝ BÖLÜM***********************************
*****************************************************************************
*****************************************************************************
*                                                               
 grid-reset.
 
     initialize form1-gd-2-record gmami
     move "       "                     to g1
     perform varying mamii from 1 by 1 until mamii > apo-5
           move "Oda   "       to g21(mamii) 
           move "Pax    "    to g22(mamii)
           move "Chi."       to g222(mamii)
           move "Satilan"     to g23(mamii) 
           move "Kalan   "  to g24(mamii)
      end-perform
     modify form1-gd-2,
            reset-grid = 1
            mass-update = 1
            record-to-add(gmami)
          
        
*/ konum bilgileri
 
    perform varying mamii from 1 by 1 until mamii > apo-5 
      
     modify form1-gd-2(1,( mamii * 5 ) - 3 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) - 2 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) - 1 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) - 0 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) + 1 ) hidden-data = gecerli-konum-kod(mamii)

     end-perform                 


     initialize form1-gd-2-record gmami
     move "Tarih -   Ayr / Kalan"                     to g1
     perform varying mamii from 1 by 1 until mamii > apo-5
           move gecerli-konum-adi(mamii)       to g21(mamii) g22(mamii) g222(mamii) g23(mamii) g24(mamii)
      end-perform
     modify form1-gd-2,
            
            mass-update = 1
            record-to-add(gmami)
           
           modify form1-gd-2 num-col-headings = 2 
*/ konum bilgileri
    perform varying mamii from 1 by 1 until mamii > apo-5 
      
     modify form1-gd-2(1,( mamii * 5 ) - 3 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) - 2 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) - 1 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) - 0 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 5 ) + 1 ) hidden-data = gecerli-konum-kod(mamii)
     end-perform                                      
    .

*
 load-konum.
     open input konum
     initialize konum-rec
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          if konum-satis <> satistami
**             exit perform cycle
              continue 
          end-if
          add 1                      to konumlar-sayi
          move konum-anahtar         to occ-konum-kod(konumlar-sayi)   
          move konum-adi             to occ-konum-adi(konumlar-sayi)   
          move konum-satis           to occ-konum-satis(konumlar-sayi)
          
     end-read
     end-perform
     end-start.
     close konum.

 default-gecerli-konum. 
    perform varying i 
            from 1
            by 1
            until i > apo-5
              
            move  occ-konum-kod(i)     to gecerli-konum-kod(i)
            move  occ-konum-adi(i)     to gecerli-konum-adi(i)
            move  1                    to gecerli-konum-secildimi(i)
                                          occ-konum-secildimi(i)
     end-perform.
*
 gruplar-oku.
     initialize gruplar-rec xgruplar-rec
     open i-o gruplar
     move grup-no                   to gruplar-kodu
     read gruplar no lock invalid
          initialize gruplar-rec
          move grup-no              to gruplar-kodu
          perform rez-parametre-ata
          set kayit-yok             to true
     not invalid
          set kayit-var             to true
          move gruplar-rec          to xgruplar-rec
     end-read
     close gruplar.
      if gruplar-isl-tar < "19000000" and k-kodu-tasi = "ASYA" or "X   " then 
       move gruplar-satis-tar to gruplar-isl-tar
     end-if
     move gruplar-adi        to grup-adi
     move gruplar-firma      to xrez-firma       
     move gruplar-acenta     to xrez-acenta     
     move gruplar-gel-tar    to xrez-gir-tar    
     move gruplar-git-tar    to xrez-cik-tar    
     move gruplar-banka      to xrez-banka      
     move gruplar-doviz      to xrez-doviz      
     move gruplar-pan-tipi   to xrez-pan-tipi   
     move gruplar-odeme      to xrez-odeme-tipi 
     move gruplar-anlasma    to xrez-anlasma    
     move gruplar-pazar      to xrez-pazar      
     move gruplar-ulke       to xrez-ulke       
     move gruplar-not1       to xrez-not1       
     move gruplar-not2       to xrez-not2 
     move gruplar-grup-statu to xrez-gr-status
     move gruplar-kaynak-1   to xrez-kaynak-1
     move gruplar-kaynak-2   to xrez-kaynak-2
     move gruplar-kaynak-3   to xrez-kaynak-3
     move gruplar-kur        to xrez-cin-kuru
     move gruplar-skur       to XREZ-UG-IND
     move gruplar-kalanlar-double  to kalanlar-double
     move gruplar-extra-ind  to xrez-extra-ind
     move gruplar-room-kdv-yok  to room-kdv-yok
     move gruplar-extra-kdv-yok to extra-kdv-yok
     move gruplar-satis-tar     to xrez-al-tar
     move gruplar-isl-tar       to xrez-isl-tar
     move gruplar-sabit-tarih-kur to sabit-tar-kur 
     if sabit-tar-kur = 1
        modify accept-kur-gun , visible = true
        modify accept-kur-ay , visible = true
        modify accept-kur-yil , visible = true
     end-if 
     move gruplar-sabit-kur-tarih to kur-sabit-tar

     move gruplar-gel-zaman to xREZ-GEL-ZAMAN
     move gruplar-git-zaman to xREZ-GIT-ZAMAN
     perform okunan-goster.
     perform blok2xblok.
     perform load-mygrid. 

*
 accept-grup-kodu-Bef-Procedure.
     initialize kayit-durum.
*
 kaydediliyor-gruplar. 
     open i-o gruplar.
     initialize gruplar-rec
     move grup-no           to gruplar-kodu
     move grup-adi          to gruplar-adi
     move xrez-firma        to gruplar-firma
     move xrez-acenta       to gruplar-acenta
     move xrez-gir-tar      to gruplar-gel-tar
     move xrez-cik-tar      to gruplar-git-tar
     move xrez-banka        to gruplar-banka
     move xrez-doviz        to gruplar-doviz
     move xrez-pan-tipi     to gruplar-pan-tipi
     move xrez-odeme-tipi   to gruplar-odeme 
     move xrez-anlasma      to gruplar-anlasma
     move xrez-pazar        to gruplar-pazar
     move xrez-ulke         to gruplar-ulke
     move xrez-not1         to gruplar-not1
     move xrez-not2         to gruplar-not2
     move xrez-gr-status    to gruplar-grup-statu
     move xrez-kaynak-1     to gruplar-kaynak-1
     move xrez-kaynak-2     to gruplar-kaynak-2
     move xrez-kaynak-3     to gruplar-kaynak-3
     move k-kodu-tasi       to gruplar-staf
     move XREZ-CIN-KURU     to gruplar-kur
     move xrez-extra-ind    to gruplar-extra-ind
     move XREZ-UG-IND       to gruplar-skur 
     move  kalanlar-double  to gruplar-kalanlar-double  
     move room-kdv-yok      to gruplar-room-kdv-yok
     move extra-kdv-yok     to gruplar-extra-kdv-yok
     move xrez-al-tar       to gruplar-satis-tar 
     move xrez-isl-tar      to gruplar-isl-tar
     move sabit-tar-kur     to gruplar-sabit-tarih-kur
     move kur-sabit-tar     to gruplar-sabit-kur-tarih
 
     move xREZ-GEL-ZAMAN    to gruplar-gel-zaman 
     move xREZ-GIT-ZAMAN    to gruplar-git-zaman 

     write gruplar-rec invalid
           rewrite gruplar-rec end-rewrite
     end-write.
     close gruplar.
     
     perform log-kaydet.
     perform kaydediliyor-blok.
         
*

 load-mygrid.
     if kayit-yok
        perform load-mygrid-kayitsiz
     else
        perform load-mygrid-kayitli
     end-if.
*
 load-mygrid-kayitli.
      
     perform kirpma-varmi-kontrol
     initialize mesajcan
     if kirpma-bastan-var
        move kirpma-bastan-durum       to mesajcan
     end-if

     move x"0a0d"                      to mesajcan(149:)
     if kirpma-sondan-var
        move kirpma-sondan-durum       to mesajcan(151:)
     end-if

     if kirpma-bastan-var or
        kirpma-sondan-var
               display message box mesajcan
               title "Bilginize"
               icon mb_warning_icon
     end-if



     open i-o xblok
     perform girili-konumlari-al


     perform grid-reset
     perform konumlar-to-cb

     modify Form1-Gd-2,
            mass-update = 1


     perform satilan-kalan-doldur

     initialize i ii takvim-rec
     open input takas 
     move xrez-gir-tar     to takvim-anah
     start takvim key not < takvim-anah invalid
           display message box 
                   "Gecersiz Tarih veya Takvim bilgileri olusturulmamis !!!"
                   icon mb_error_icon
                   title "Bilgi"
           close takvim
           exit paragraph
     end-start
     move 2 to i
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
          if takvim-anah = xrez-cik-tar
             exit perform 
          end-if

          initialize form1-gd-2-record gmami renk toplam-kalan-oda  toplam-ayrilan-oda
       
          move takvim-gun                 to egun2 gizli-gun
          move takvim-ay                  to eay2  gizli-ay
          move takvim-yil                 to gizli-yil
          move takvim-yil(3:2)            to eyil2
          move etarih2                    to g1(1:8)
  
          perform varying inx-i
                  from 1
                  by 1
                  until inx-i > apo-5

                  initialize xblok-rec
                  move grup-no                    to xblok-kodu
                  move takvim-anah                to xblok-tarih
                  move gecerli-konum-kod(inx-i)   to xblok-konum
                  read xblok no lock invalid
                       continue 
                  end-read

                  initialize takas-rec
                  move takvim-anah              to takas-anahtar
                  move gecerli-konum-kod(inx-i) to takas-konum
                  read takas no lock invalid 
                       continue 
                  end-read 
                  move takas-satilan-adet       to xblok-satilan-oda 
                  
                  if xblok-ayrilan-oda <> 0 or
                     xblok-satilan-oda <> 0 or
                     xblok-ayrilan-pax <> 0 or
                     xblok-ayrilan-child <> 0
                         
                          move xblok-ayrilan-oda  to 4z
                          move 4z                 to g21(inx-i)

                          move xblok-ayrilan-pax  to 4z
                          move 4z                 to g22(inx-i)

                          move xblok-ayrilan-child  to 4z
                          move 4z                 to g222(inx-i)

                          move xblok-satilan-oda  to 4z
                          move 4z                 to g23(inx-i)
                          compute xblok-kalan-oda = 
                                  xblok-ayrilan-oda -
                                  xblok-satilan-oda  
                          move xblok-kalan-oda    to 4z
                          move 4z                 to g24(inx-i)  
                          if xblok-kalan-oda < 0                              
                             modify form1-gd-2(i + 1,(inx-i * 5) + 1),cell-color = 176
                          end-if 

                          compute toplam-kalan-oda = 
                                  toplam-kalan-oda + xblok-kalan-oda
                          compute toplam-ayrilan-oda = 
                                  toplam-ayrilan-oda + xblok-ayrilan-oda

                     rewrite xblok-rec invalid 
                         write xblok-rec end-write 
                     end-rewrite 

                  end-if
          end-perform
          
          move "-"               to g1(9:1)

          move toplam-ayrilan-oda  to 4z2
          move 4z2                to g1(10:4) 

          move "/"                to g1(15:1)

          move toplam-kalan-oda  to 4z2
          move 4z2                to g1(16:4) 

          modify form1-gd-2,
                 record-to-add(gmami)
          add 1 to i
          modify form1-gd-2(i,1)
                 hidden-data = gizli-bilgi
     end-read
     end-perform

     modify form1-gd-2,
            mass-update = 0.

     close xblok takas .
*
 load-mygrid-kayitsiz.

     perform grid-reset.

     perform konumlar-to-cb

    
     modify Form1-Gd-2,
            mass-update = 1
     initialize i ii takvim-rec

     move xrez-gir-tar     to takvim-anah
     start takvim key not < takvim-anah invalid
           display message box 
                   "Gecersiz Tarih veya Takvim bilgileri olusturulmamis !!!"
                   icon mb_error_icon
                   title "Bilgi"
           close takvim
           exit paragraph
     end-start
     move 2 to i
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
          if takvim-anah = xrez-cik-tar
             exit perform 
          end-if
          initialize form1-gd-2-record gmami
          move takvim-gun                 to egun2 gizli-gun
          move takvim-ay                  to eay2  gizli-ay
          move takvim-yil                 to gizli-yil
          move takvim-yil(3:2)            to eyil2
          move etarih2                    to gd-2-col-1

          modify form1-gd-2,
                 record-to-add(form1-gd-2-record)
          add 1 to i
          modify form1-gd-2(i,1)
                 hidden-data = gizli-bilgi
     end-read
     end-perform

     modify form1-gd-2,
            mass-update = 0.


*
 kaydediliyor-blok.
     open i-o xblok blok.
     initialize xblok-rec
     start xblok key not < xblok-anahtar invalid
           continue
     not invalid
     initialize fs-xblok
     perform with test after until fs-xblok = "10"
     read xblok next no lock end move "10" to fs-xblok
     not at end
          initialize blok-rec
          move xblok-rec   to blok-rec
          read blok no lock invalid
               continue
          end-read
          perform dondur-baba
          if xblok-ayrilan-oda = 0 and 
             xblok-satilan-oda = 0 and
             xblok-ayrilan-pax = 0| büyük ihtimal silindi
             delete blok invalid continue end-delete
          else
             move xblok-rec    to blok-rec
             if ilk-gun = 1 then 
                 stop " " 
               if xblok-tarih = xrez-gir-tar
                 
                  initialize takvim-anah
                  move xrez-gir-tar to takvim-anah
                  start takvim key  >= takvim-anah invalid continue
                    not invalid
                          perform until takvim-anah > xrez-cik-tar
                             read takvim next no lock 
                                  end move "10" to fs-takvim
                                  not end
                                   if takvim-anah >= xrez-gir-tar and takvim-anah < xrez-cik-tar
                                       move xblok-rec    to blok-rec
                                       move takvim-anah to blok-tarih
                                                    move " " to blok-durumu
                                      write blok-rec invalid
                                           rewrite blok-rec end-rewrite
                                     end-write
                                      perform blok-log-kaydet
                                   end-if
                             end-read  
                          end-perform
                  end-start
                
               else
               move  "10" to fs-xblok
               exit perform cycle
              end-if
             end-if
             move " " to blok-durumu
             write blok-rec invalid
                   rewrite blok-rec end-rewrite
             end-write
               perform blok-log-kaydet
          end-if
     end-read
     end-perform
     end-start
*7 verilen tarihler disinda bilgi kaldiysa bloktan tekrar kontrol et

     initialize blok-rec
     move grup-no         to blok-kodu
     start blok key not < blok-kodu invalid
           continue
     not invalid
     initialize fs-blok
     perform with test after until fs-blok = "10"
     read blok next no lock end move "10" to fs-blok
     not at end
          if blok-kodu <> grup-no 
             exit perform
          end-if
          perform dondur-baba
          if blok-tarih < xrez-gir-tar or 
             blok-tarih >= xrez-cik-tar
                  delete blok end-delete

          end-if
     end-read
     end-perform
     end-start


     close xblok blok .
     delete file xblok.
    
*
 read-genelfis.
     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
              move 1 to ekran-fis-1
     end-read
     add 1 to ekran-fis-1
     rewrite genelfis-rec invalid
             write genelfis-rec end-write
     end-rewrite
     close genelfis.

*
 blok2xblok.
 
     open output xblok close xblok
     open i-o blok xblok.
     initialize blok-rec
     move grup-no         to blok-kodu
     start blok key not < blok-anahtar invalid
           continue
     not invalid
     initialize fs-blok
     perform with test after until fs-blok = "10"
     read blok next no lock end move "10" to fs-blok
     not at end
          if grup-no <> blok-kodu
             exit perform 
          end-if
          move blok-rec   to xblok-rec
          write xblok-rec invalid
               stop " "
          end-write
     end-read
     end-perform
     end-start
     close blok xblok.

*
 Form1-Gd-2-Ev-Other.
     evaluate event-type
     when msg-cANCEL-entry
          open input xblok
          initialize xblok-rec
          inquire form1-gd-2(event-data-2,1),
                  hidden-data in gizli-bilgi
          inquire form1-gd-2(1,event-data-1),
                  hidden-data in xblok-konum
           
          move gizli-bilgi        to xblok-tarih
          move grup-no            to xblok-kodu
          read xblok no lock invalid 
               initialize xblok-rec
          end-read


          evaluate event-data-1

          when 4
          when 9
          when 14
          when 19
          when 24
          when 29
          when 34
          when 39
          when 44
          when 49
          when 54
          when 59
          when 64
          when 69
          when 74
          when 79
          when 84
          when 89
          when 94
          when 99

             move xblok-ayrilan-child to 4z  

          when 02 
          when 07
          when 12
          when 17
          when 22
          when 27
          when 32
          when 37
          when 42
          when 47
          when 52
          when 57
          when 62
          when 67
          when 72
          when 77
          when 82
          when 87
          when 92
          when 97
         
          move xblok-ayrilan-oda     to 4z

          when 03 
          when 08
          when 13
          when 18
          when 23
          when 28
          when 33
          when 38
          when 43
          when 48
          when 53
          when 58
          when 63
          when 68
          when 73
          when 78
          when 83
          when 88
          when 93
          when 98
         
          move xblok-ayrilan-pax     to 4z
           
          end-evaluate



          modify form1-gd-2(event-data-2,event-data-1)
                 cell-data = 4z
          close xblok

           

     when msg-finish-entry
 
          open i-o xblok
          initialize xblok-rec
          inquire form1-gd-2(event-data-2,1),
                  hidden-data in gizli-bilgi
          inquire form1-gd-2(1,event-data-1),
                  hidden-data in xblok-konum
          inquire form1-gd-2(event-data-2,event-data-1)
                  cell-data in 4z
           
          move gizli-bilgi        to xblok-tarih
          move grup-no            to xblok-kodu
          read xblok no lock invalid 
               initialize xblok-bilgiler
          end-read
          if xblok-konum = spaces
             display message box "Konum Secimi yapilmadan oda girisi yapilamaz.."
                             title "Uyari"
                             icon 1
               modify form1-gd-2(event-data-2,event-data-1)
                     cell-data spaces
               close xblok
               exit paragraph 
          end-if 
             evaluate event-data-1
          when 4
          when 9
          when 14
          when 19
          when 24
          when 29
          when 34
          when 39
          when 44
          when 49
          when 54
          when 59
          when 64
          when 69
          when 74
          when 79
          when 84
          when 89
          when 94
          when 99

             move 4z to xblok-ayrilan-child
          when 02 
          when 07
          when 12
          when 17
          when 22
          when 27
          when 32
          when 37
          when 42
          when 47
          when 52
          when 57
          when 62
          when 67
          when 72
          when 77
          when 82
          when 87
          when 92
          when 97
         
                  move  4z   to xblok-ayrilan-oda     
          when 03 
          when 08
          when 13
          when 18
          when 23
          when 28
          when 33
          when 38
          when 43
          when 48
          when 53
          when 58
          when 63
          when 68
          when 73
          when 78
          when 83
          when 88
          when 93
          when 98
         

          move  4z  to xblok-ayrilan-pax    


          end-evaluate

          evaluate event-data-1                               
          when 02 
            move 4z  to     xblok-ayrilan-oda           
          when 03 
            move 4z  to     xblok-ayrilan-pax                                                                         
          when 07 
            move 4z  to     xblok-ayrilan-oda           
          when 08 
            move 4z  to     xblok-ayrilan-pax                                                                           
          when 12 
            move 4z  to     xblok-ayrilan-oda           
          when 13 
            move 4z  to     xblok-ayrilan-pax                                                                           
          when 17 
            move 4z  to     xblok-ayrilan-oda           
          when 18 
            move 4z  to     xblok-ayrilan-pax                                                                         
          when 22 
            move 4z  to     xblok-ayrilan-oda           
          when 23 
            move 4z  to     xblok-ayrilan-pax                                                                                                                                       
          end-evaluate                                        
                                                              
          write xblok-rec invalid
                rewrite xblok-rec end-rewrite
          end-write
          close xblok  
     end-evaluate.
*
 kirpma-varmi-kontrol.
    initialize kirpma-bastan-durum kirpma-sondan-durum 
    open i-o xblok
*/ kayit olnuþ baþlangýç tarihinden yeni basþlangýç tarihine kadar kontrol
    if xrez-gir-tar > xgruplar-gel-tar
      initialize xblok-rec
      start xblok key not < xblok-anahtar invalid
            continue
      not invalid
      initialize fs-xblok
      perform with test after until fs-xblok = "10"
      read xblok next no lock end move "10" to fs-xblok
      not at end
           if xblok-tarih < xrez-gir-tar
              set kirpma-bastan-var to true
              exit perform
           end-if
      end-read
      end-perform
      end-start
    end-if.


*/ kayit olnuþ baþlangýç tarihinden yeni basþlangýç tarihine kadar kontrol
    if xrez-cik-tar < xgruplar-git-tar
      initialize xblok-rec
      start xblok key not < xblok-anahtar invalid
            continue
      not invalid
      initialize fs-xblok
      perform with test after until fs-xblok = "10"
      read xblok next no lock end move "10" to fs-xblok
      not at end
           if xblok-tarih >= xrez-cik-tar and 
              xblok-tarih <= xgruplar-git-tar
              set kirpma-sondan-var to true
              exit perform
           end-if
      end-read
      end-perform
      end-start
    end-if.

    close xblok.
*
 gruplar-sil.
    initialize mesaj-degiskenler silden-geldi iptalden-geldi
    move " [ Sil ] " to mmesaj-title
    move " BU Grup SILINECEKTIR ......  " to mmesaj-1
       
    move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2 
    move 2           to mmesaj-type
    move 1           to mmesaj-icon
    move 2           to mmesaj-default
    perform mmesaj-ver
    if donus-kodu = 2 
       exit paragraph
    end-if.
       

    move 1               to silden-geldi
    perform Acu-Form2-Routine.


*
 gruplar-iptal.
    initialize mesaj-degiskenler iptalden-geldi silden-geldi
    move " [ Iptal ]" to mmesaj-title
    move " BU Grup IPTAL Edilecektir......  " to mmesaj-1
       
    move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2 
    move 2           to mmesaj-type
    move 1           to mmesaj-icon
    move 2           to mmesaj-default
    perform mmesaj-ver
    if donus-kodu = 2 
       exit paragraph
    end-if.
      

    move 1   to iptalden-geldi
    perform Acu-Form2-Routine.

*
 Form2-Ex-Other.
    evaluate key-status
    when 2
        if is-neden = spaces
           display message box "Lutfen Neden Giriniz...."
                           title "[ Uyari ]"
                           icon 1
               exit paragraph 
        end-if 
        if iptalden-geldi = 1 and 
           is-neden not = spaces
               initialize log-tar log-zaman
        
               accept log-tar from century-date 
               accept log-zaman from time

              perform iptal-et
              move 27 to key-status
              perform form2-ex-other 

        end-if
        if silden-geldi = 1 and 
           is-neden not = spaces 
               initialize log-tar log-zaman
        
               accept log-tar from century-date 
               accept log-zaman from time

              perform sil-gec
              move 27 to key-status
              perform form2-ex-other               
         end-if
         perform log-kaydet
    when 27
        
    end-evaluate 
     .
* 
 sil-gec.
    open i-o gruplar blok
    initialize gruplar-rec blok-rec

    move grup-no       to blok-kodu gruplar-kodu
    start blok key not < blok-kodu invalid
          continue
    not invalid
    initialize fs-blok
    perform with test after until fs-blok = "10"
    read blok next no lock end move "10" to fs-blok
    not at end
         if blok-kodu <> grup-no
            exit perform
         end-if
         move "S"      to blok-durumu
         rewrite blok-rec end-rewrite
         move blok-rec to xblok-rec
         perform blok-log-kaydet
 
    end-read
    end-perform
    end-start
    read gruplar no lock invalid 
         continue 
    not invalid 
  
      move "S"           to gruplar-durumu
      move is-neden      to gruplar-silme-iptal-nedeni
      accept gruplar-sil-tar from century-date
      move k-kodu-tasi       to gruplar-staf
      rewrite gruplar-rec end-rewrite 
              perform log-kaydet
    end-read 

    close gruplar blok
    delete file xblok.
   

    initialize rezgrup-rec gruplar-rec xgruplar-rec xrez-rec grup-no grup-adi
                   kaynak1-tipi-goster 
                   kaynak2-tipi-goster
                   kaynak3-tipi-goster

        display acc-kaynak1 acc-kaynak2 acc-kaynak3
                lb-kaynak1 lb-kaynak2 lb-kaynak3
    perform grid-reset.
    perform form-update
    move 4    to accept-control
    move 1002 to control-id.  
*
 iptal-et.
    open i-o gruplar blok
    initialize gruplar-rec blok-rec

    move grup-no       to blok-kodu gruplar-kodu
    start blok key not < blok-kodu invalid
          continue
    not invalid
    initialize fs-blok
    perform with test after until fs-blok = "10"
    read blok next no lock end move "10" to fs-blok
    not at end
         if blok-kodu <> grup-no
            exit perform
         end-if
         move "I"      to blok-durumu
         rewrite blok-rec end-rewrite 
         move blok-rec   to xblok-rec 
         perform blok-log-kaydet

    end-read
    end-perform
    end-start
    read gruplar no lock invalid 
         continue 
    not invalid 
      move "I"           to gruplar-durumu
      move is-neden      to gruplar-silme-iptal-nedeni
      accept gruplar-sil-tar from century-date
      move k-kodu-tasi       to gruplar-staf
      rewrite gruplar-rec end-rewrite 
              perform log-kaydet
        
    end-read 
    close gruplar blok
    delete file xblok.

    initialize rezgrup-rec gruplar-rec xgruplar-rec xrez-rec grup-no grup-adi
                   kaynak1-tipi-goster 
                   kaynak2-tipi-goster
                   kaynak3-tipi-goster

        display acc-kaynak1 acc-kaynak2 acc-kaynak3
                lb-kaynak1 lb-kaynak2 lb-kaynak3
    perform grid-reset.
    perform form-update
    move 4    to accept-control
    move 1002 to control-id.
    .
*
 dondur-baba.
    add 1 to dondur-baba.
    evaluate dondur-baba
    when 1 modify form1-st-1-handle,panel-index = 1 panel-text = "|"
    when 2 modify form1-st-1-handle,panel-index = 1 panel-text = "/"
    when 3 modify form1-st-1-handle,panel-index = 1 panel-text = "-"
    when 4 modify form1-st-1-handle,panel-index = 1 panel-text = "\"
    when other
         move 0 to dondur-baba
    end-evaluate.
*
 konumlar-to-cb.
    perform varying i
            from 0
            by 1
            until i > 10
            after ii
            from 1
            by 1
            until ii > 4

            compute 2hane = (i * 5) + ii
*             if isyeri-adres-tasi(1:4) = "long"   
              if 2hane > 5 and i > 0 and i <= 1  
                  subtract 1 from 2hane
              end-if 
              if i > 1 and 2hane > 9
                 subtract i from 2hane
              end-if 
*            end-if
            if occ-konum-satis(2hane) = 1 or 0 
              move 0 to buldum2
             perform varying mamii from 1 by 1 until mamii > apo-5
               if occ-konum-kod(2hane) = gecerli-konum-kod(mamii) then  
                  move 1 to buldum2
                  exit perform 
              end-if
              end-perform
                if buldum2 = 1 
                  move 1 to occ-konum-secildimi(2hane)
                  modify form1-gd-3(i + 1, ii),
                         cell-data = occ-konum-adi(2hane)
                         bitmap = check-bmp
                         bitmap-width = 16
                         bitmap-number = 2
                         hidden-data = occ-konumlar-occurs(2hane)
               else
                  move 0 to occ-konum-secildimi(2hane)
                  modify form1-gd-3(i + 1, ii),
                         cell-data = occ-konum-adi(2hane)
                         bitmap = check-bmp
                         bitmap-width = 16
                         bitmap-number = 1
                         hidden-data = occ-konumlar-occurs(2hane)
               end-if
                    compute konumy(2hane) = i + 1
                    compute konumx(2hane) = ii
            end-if
    end-perform.    
*
 Form1-Gd-3-Ev-Other.
    evaluate event-type
    when Msg-Bitmap-Clicked      
         initialize occ-konumlar-occurs(99)
         inquire form1-gd-3(event-data-2,event-data-1),
                 hidden-data in occ-konumlar-occurs(99)
         if occ-konum-secildimi(99) = 1
            perform konum-cikar
         else
            perform konum-ekle
         end-if
    when msg-begin-entry
         move event-action-fail to event-action
    end-evaluate.
*
 konum-ekle.
    move 0 to iii
    perform varying i
            from 1
            by 1
            until i > konumlar-sayi
                 if occ-konum-secildimi(i) = 1
                    add 1 to iii
                 end-if
    end-perform.

    if iii >= apo-5
       display message box 
               "Tablo'ya Max.  "
               apo-5
               " konum ekleyebilirsiniz !!!"
               icon mb_warning_icon
               title "Bilginize ..."

    else
       move 1 to occ-konum-secildimi(99)
       modify form1-gd-3(event-data-2,event-data-1)
              hidden-data = occ-konumlar-occurs(99)
              bitmap  = check-bmp
              bitmap-number = 2
              bitmap-width = 16
       
       perform varying i
               from 1
               by 1
               until i > konumlar-sayi
               if occ-konum-kod(99) = occ-konum-kod(i) 
                  move 1 to occ-konum-secildimi(i)
                  exit perform 
               end-if
       end-perform
       initialize yedek-konum
       perform varying iii
               from 1
               by 1
               until iii > apo-5
               if gecerli-konum-kod(iii) = spaces
                  if occ-konum-kod(i) = yedek-konum
                      exit perform cycle 
                  end-if 
                  move occ-konum-kod(i)         to gecerli-konum-kod(iii) yedek-konum
                  move occ-konum-adi(i)         to gecerli-konum-adi(iii)
                  move 1                        to gecerli-konum-secildimi(iii)
               end-if
       end-perform


       perform grid-reset
       set girilen-bulma to true
       perform load-mygrid
       initialize girilen-bulayimmi


    end-if.
*
 konum-cikar.
    open input xblok
    initialize xblok-rec
    start xblok key not < xblok-anahtar invalid
          continue
    not invalid
    initialize fs-xblok
    perform with test after until fs-xblok = "10"
    read xblok next no lock end move "10" to fs-xblok
    not at end
         if xblok-konum = occ-konum-kod(99)
            close xblok
            display message box 
                    "Secimi kaldirmaya calistiginiz konum :",occ-konum-kod(99)," kodu ",x"0a0d",
                    xblok-gun,"/",xblok-ay,"/",xblok-yil , " tarihinde hareket gormus"
                    icon mb_error_icon
                    title "Bilginize "
            exit paragraph
          end-if
    end-read
    end-perform
    end-start
    close xblok.


    move 0 to occ-konum-secildimi(99)
    modify form1-gd-3(event-data-2,event-data-1)
           hidden-data = occ-konumlar-occurs(99)

           bitmap  = check-bmp
           bitmap-number = 1
           bitmap-width = 16

    perform varying i
            from 1
            by 1
            until i > konumlar-sayi
            if occ-konum-kod(99) = occ-konum-kod(i) 
               move 0 to occ-konum-secildimi(i)
               exit perform 
            end-if
    end-perform

    perform varying iii
            from 1
            by 1
            until iii > apo-5
            if gecerli-konum-kod(iii) = occ-konum-kod(99)
               initialize gecerli-konumlar-occurs(iii)
               exit perform 
            end-if
    end-perform


    perform grid-reset
    perform load-mygrid

     .


*
 girili-konumlari-al.
     if girilen-bulma
        exit paragraph.

     initialize gecerli-konumlar
     perform varying i
             from 1
             by 1
             until i > konumlar-sayi
             move 0 to occ-konum-data-bilgi(i)
                       occ-konum-secildimi(i)
     end-perform


     initialize xblok-rec
     start xblok key not < xblok-kodu invalid
           continue
     not invalid
     initialize fs-xblok
     perform with test after until fs-xblok = "10"
     read xblok next no lock end move "10" to fs-xblok
     not at end
          perform varying i
                  from 1
                  by 1
                  until i > konumlar-sayi
                  if occ-konum-kod(i) = xblok-konum
                     move 1 to occ-konum-data-bilgi(i)
                     exit perform
                  end-if
          end-perform
     end-read
     end-perform
     end-start.


     move 0 to ii
     perform varying i
             from 1
             by 1
             until i > konumlar-sayi
             if occ-konum-data-bilgi(i) = 1
                add 1 to ii
                move occ-konum-kod(i) to gecerli-konum-kod(ii)
                move occ-konum-adi(i) to gecerli-konum-adi(ii)
                move 1                to occ-konum-secildimi(i)
                move occ-konum-secildimi(i) to gecerli-konum-secildimi(ii)
             end-if   
     end-perform.
*
 Form1-Mn-1-MI-RezervasyonOlustur-Link.
          open input gruplar
          initialize gruplar-rec
          move grup-no  to gruplar-kodu
          read gruplar no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplar 
                 exit paragraph
          end-read 
          close gruplar
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
        
*          if st-x <> end-x 
*             display message box 
*                     "Birden fazla kolon secemezsiniz !"
*                     icon mb_warning_icon
*                     title "Hata"
*             exit paragraph
*          end-if.

          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 

          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp              to gruplar-gel-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to gruplar-git-tar

          initialize takvim-rec
          move gruplar-git-tar   to takvim-anah
          start takvim key > takvim-anah invalid 
              continue 
          not invalid 
          read takvim next no lock end continue 
          not at end               
               move takvim-anah to gruplar-git-tar
          end-read 
          end-start 
          inquire form1-gd-2(1,st-x),
                  hidden-data in temp

          move temp              to gruplar-adi(99:2)|oda konumu
          move gruplar-rec       to link-rez-grup-rec

          if gruplar-gel-tar > gruplar-git-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if 

          call "/asya/ytl/obj/otel/rez.asy" 
                        using  link-rez-no link-gelen-rec link-gelen-sharenum link-rez-grup-rec 
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/rez.asy"
          end-call

          move 1 to control-id
          move 4 to accept-control
          perform Aft-Procedure.

*
 kaynak1-ara.
    initialize kaynak-cagir.
    move "AB"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk1ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk1ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-1
    perform kaynak1-goster
    .

 kaynak2-ara.
    initialize kaynak-cagir.
    move "AC"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk2ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk2ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-2
    perform kaynak2-goster
    .
 kaynak3-ara.
    initialize kaynak-cagir.
    move "AD"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk3ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk3ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-3
    perform kaynak3-goster
    . 
*
 break-tablosu.
    initialize link-hepsi
    move high-values   to gelen-break
    move xrez-pan-tipi to gelen-break(7:2)
    move grup-no       to gelen-break(1:6)
    move xrez-doviz    to gelen-doviz

    call "/asya/ytl/obj/otel/break.asy" using link-hepsi
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/break.asy" 
    end-call
    initialize link-hepsi 
     .
*
 grup-ara.
    initialize gruplar-cagir
    call "/asya/ytl/obj/otel/gruplara.asy" using gruplar-cagir
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/gruplara.asy" 
    end-call
    move gruplar-cagir   to grup-no
    display accept-grup-kodu
     .
*
 grupfiy-form-ac.

    initialize link-grupfiy
    move gruplar-kodu            to link-grupfiy-kodu 
    move 1                       to link-grup-link-var    
    call "/asya/ytl/obj/otel/grupfiy.asy" using link-grupfiy
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/grupfiy.asy" 
    end-call
 
    
     .
*
 grupfiy-oku.
    open input konum
    perform fiyat-grid-reset
    open i-o grupfiy
    initialize grupfiy-rec k ydk-grupfiy-bas-tar ydk-grupfiy-bit-tar
               buldum 
    move gruplar-kodu       to grupfiy-kodu
    start grupfiy key not < grupfiy-anahtar invalid
          continue 
    not invalid 
    perform with test after until fs-grupfiy = "10"
    read grupfiy next no lock end move "10"  to fs-grupfiy
    not at end
             if grupfiy-kodu <> gruplar-kodu
                  exit perform 
             end-if         
*             if ydk-grupfiy-bas-tar = zeroes
*                move grupfiy-bas-tarih  to ydk-grupfiy-bas-tar 
*             end-if
*             if ydk-grupfiy-bit-tar = zeroes
*                move grupfiy-bit-tarih  to ydk-grupfiy-bit-tar
*             end-if 
*             if grupfiy-bas-tarih = ydk-grupfiy-bas-tar  and     
*                grupfiy-bit-tarih = ydk-grupfiy-bit-tar
*                 exit perform cycle 
*             end-if 

             initialize form1-gd-4-record
             add 1                        to k
             move k                       to gd-4-col-1
             move grupfiy-bas-tarih(1:4)  to eyil
             move grupfiy-bas-tarih(5:2)  to eay
             move grupfiy-bas-tarih(7:2)  to egun
             if eyil > "1900"
             move etarih                  to gd-4-col-2
             end-if
             move grupfiy-bit-tarih(1:4)  to eyil
             move grupfiy-bit-tarih(5:2)  to eay
             move grupfiy-bit-tarih(7:2)  to egun
              if eyil > "1900"
             move etarih                  to gd-4-col-3
             end-if
          
             move grupfiy-konum   to konum-anahtar
             read konum no lock invalid continue end-read
             move konum-adi to gd-4-col-5 
             evaluate grupfiy-pax 
                when 1
                       move "1-SINGLE"      to gd-4-col-4
              
                when 2
                  
                   move "2-DOUBLE"      to gd-4-col-4
               
                  
                when 3
                  
                   move "3-TRIPLE"      to gd-4-col-4
                  
                when 4
                   
                   move "4-QUARTER"      to gd-4-col-4
                  

             end-evaluate
             move grupfiy-ayrilan-tutar to z-tutar
             move z-tutar to  gd-4-col-6
             modify form1-gd-4,record-to-add(form1-gd-4-record) 
    end-read 
    end-perform
    end-start
    close grupfiy
    modify form1-gd-4,
           mass-update = 0
             close konum
    .
*
 fiyat-grid-reset.
    modify form1-gd-4,reset-grid = 1
                      mass-update = 1
       
    initialize form1-gd-4-record
    move "#"          to gd-4-col-1
    move "Bas Tar."   to gd-4-col-2
    move "Bit Tar."   to gd-4-col-3
    move "Pax " to  gd-4-col-4
    move "Konum " to     gd-4-col-5
    move "Tutar " to   gd-4-col-6
    modify form1-gd-4,record-to-add(form1-gd-4-record)
     .
*
 Form1-Gd-4-Ev-Other.
    evaluate event-type
    when msg-begin-entry
            initialize link-grupfiy

            inquire form1-gd-4(event-data-2,2),cell-data in ybas-tar
            inquire form1-gd-4(event-data-2,3),cell-data in ybit-tar

            move event-action-fail       to event-action  
            move gruplar-kodu            to link-grupfiy-kodu

            move ybas-tar(1:2)           to link-grupfiy-bas-gun
            move ybas-tar(4:2)           to link-grupfiy-bas-ay
            move ybas-tar(7:4)           to link-grupfiy-bas-yil

            move ybit-tar(1:2)           to link-grupfiy-bit-gun
            move ybit-tar(4:2)           to link-grupfiy-bit-ay
            move ybit-tar(7:4)           to link-grupfiy-bit-yil
            move 2                       to link-grup-link-var 
            call "/asya/ytl/obj/otel/grupfiy.asy" using link-grupfiy
                 on exception perform callerr-proc
                 not on exception
            cancel "/asya/ytl/obj/otel/grupfiy.asy" 
            end-call
    end-evaluate
     
     .
*
 satilan-kalan-doldur.
     open i-o genelfis cast
     initialize genelfis-rec 
     move 1             to genelfis-anahtar
     read genelfis no lock invalid 
          continue 
     not invalid
          add 1 to ekran-fis-1 
          move ekran-fis-1    to takas-no
          rewrite genelfis-rec end-rewrite 
     end-read 
     close genelfis
     open output takas close takas open i-o takas 
             
     initialize rez-rec 
     move grup-no       to rez-grup-no
     move "I"           to rez-durumu
     start rez key not < rez-grup invalid 
          continue 
     not invalid 
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10"  to fs-rez
     not at end 
            if rez-grup-no <> grup-no or
               rez-durumu <> "I"
                exit perform 
            end-if 

            initialize takas-rec takvim-rec
            move rez-gir-tar    to takvim-anah 
            start takvim key not < takvim-anah invalid 
                  continue 
            not invalid 
            perform with test after until fs-takvim = "10"
            read takvim next no lock end move "10"  to fs-takvim
            not at end
                   if takvim-anah >= rez-cik-tar
                       exit perform 
                   end-if 
                   initialize cast-rec
                   move takvim-anah      to cast-tarih
                   move rez-no           to cast-rez-no
                   read cast no lock invalid 
                        continue 
                   not invalid 
                        if cast-share <> 1
                           initialize takas-rec 
                           move takvim-anah      to takas-anahtar
                           move cast-fiyat-konumu to takas-konum
                           read takas no lock invalid
                                move 1        to takas-satilan-adet
                                write takas-rec end-write 
                           not invalid 
                                add 1         to takas-satilan-adet 
                                rewrite takas-rec end-rewrite 
                           end-read 
                        end-if 
                   end-read 
            end-read 
            end-perform
            end-start

     end-read 
     end-perform
     end-start
     close  takas cast
     .
*
 Form1-Mn-1-MI-GelmesiBeklenenler-Link.
          open input gruplar
          initialize gruplar-rec
          move grup-no  to gruplar-kodu
          read gruplar no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplar 
                 exit paragraph
          end-read 
          close gruplar
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 
        
          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp       to link-ilk-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to link-son-tar                 
          move gruplar-kodu      to link-grup-no 
                                                
          if link-ilk-tar > link-son-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if 

          call "/asya/ytl/obj/otel/ggelrez.asy" 
                        using  link-gelrez-hepsi
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/ggelrez.asy"
          end-call
          move 1 to control-id
          move 4 to accept-control
          perform Aft-Procedure.
*
 Form1-Mn-1-MI-LogGoruntuleyici-Link.
     move gruplar-kodu         to blok-kodu
     inquire form1-gd-2(1,event-data-2),
               hidden-data in blok-konum
     move blok-dosya        to link-logview-dosya-adi
     set link-logview-pointer  to address of blok-rec
     set link-logview-rec-size to size of blok-rec
     perform logview-call
     initialize key-status
       
     
     .
*
 sil-rez-kontrol. 
    initialize rez-rec buldum
    move grup-no           to rez-grup-no
    move "I"               to rez-durumu
    start rez key not < REZ-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"  to fs-rez
    not at end 
           if rez-durumu <> "I" or
              rez-grup-no <> grup-no
                 exit perform
           end-if 
              move 1 to buldum
    end-read 
    end-perform
    end-start

    
     .
*
 grup-fiyat.
     open i-o blok. 
      move   grup-no  to blok-kodu
      start blok key >= blok-kodu invalid continue
         not invalid
           perform until fs-blok = "10"
            read blok next no lock end move "10" to fs-blok
               not end
                 if blok-kodu not = grup-no
                    exit perform
                 end-if
                 perform  grup-fiyat-tek-gun
                
            end-read
          end-perform
      end-start
     close blok.




*
 grup-fiyat-tek-gun.
        initialize gham2
        move high-values to grupfiy-rec
        move blok-kodu     to grupfiy-kodu
        move blok-konum  to grupfiy-konum
        move xrez-buyuk         to grupfiy-pax 
                    
       start grupfiy key < grupfiy-anah2
          invalid  
            continue
          not invalid 
           perform until fs-grupfiy = "10"
               read grupfiy previous no lock end move "10" to fs-grupfiy
                  not end 
                  if grupfiy-kodu  not = rez-grup-no 
                     exit perform
                  end-if
                  if   blok-kodu           not = grupfiy-kodu or
                       xrez-fiyat-konumu   not = grupfiy-konum   or
                       xrez-buyuk          not = grupfiy-pax 
                    exit perform
                 end-if
                  if (takvim-anah >= grupfiy-bas-tarih or grupfiy-bas-tarih < "11111111" )  and 
                     (takvim-anah <= grupfiy-bit-tarih or grupfiy-bit-tarih < "11111111" )

                      move grupfiy-ayrilan-tutar to gham2
                    
                       exit perform
                  end-if
              end-read
           end-perform 
        end-start
     
       .



*
 Form1-Mn-1-MI-GrupIslemleri-Link.     
          open input gruplar
          initialize gruplar-rec
          move grup-no  to gruplar-kodu
          read gruplar no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplar 
                 exit paragraph
          end-read 
          close gruplar
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 
        
          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp              to link-ilk-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to link-son-tar
          inquire form1-gd-2(1,st-x),
                  hidden-data in temp

          move temp              to gruplar-adi(99:2)|oda konumu
          move gruplar-rec       to link-rez-grup-rec
          move gruplar-kodu      to link-grup-no 
                                                
          if link-ilk-tar > link-son-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if

          perform acu-form3-routine.
          move 1 to control-id
          move 4 to accept-control
          perform Aft-Procedure.
          
*
 Form3-Aft-Initdata.
       initialize takvim-rec
       move link-son-tar   to takvim-anah
       start takvim key > takvim-anah invalid 
           continue 
       not invalid 
       read takvim next no lock end continue 
       not at end               
            move takvim-anah to link-son-tar
       end-read 
       end-start
       
       initialize takvim-rec
       move tarih-tasi      to takvim-anah
       read takvim no lock invalid 
            display message box "Tarih Bulunamadi.!!!"
                            title "Uyari"
                            icon 1
                 
       not invalid 
           
             perform form3-baslik-yukle
             initialize p m
             perform varying p
                       from 1
                       by 1
                       until p > ust-occ
                       initialize form3-gd-1-record
                       add 1             to m
                       move m            to zzz
                         
                       move zzz          to gd-5-col-1

                       move link-ilk-tar to gruplar-gel-tar
*                       move link-ilk-gun to egun
*                       move link-ilk-ay  to eay
*                       move link-ilk-yil to eyil
*                       move etarih       to gd-5-col-8 

                       move link-son-tar to gruplar-git-tar
*                       move link-son-gun to egun
*                       move link-son-ay  to eay
*                       move link-son-yil to eyil
*                       move etarih       to gd-5-col-9

                       
                       modify form3-gd-1,
                       record-to-add(form3-gd-1-record)

             end-perform
       end-read 
       modify form3-gd-1,mass-update = 0
        
     
     .
*
 form3-baslik-yukle.
     modify form3-gd-1,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-1-record
     move "Sira"              to gd-5-col-1
     move "[1].Kisi Adi"      to gd-5-col-2
     move "[1].Kisi Soyadi"   to gd-5-col-3
     move "[2].Kisi Adi"      to gd-5-col-4
     move "[2].Kisi Soyadi"   to gd-5-col-5
     move "[3].Kisi Adi"      to gd-5-col-6
     move "[3].Kisi Soyadi"   to gd-5-col-7
     move "[4].Kisi Adi   "    to gd-5-col-8
     move "[4].Kisi Soyadi"    to gd-5-col-9

     move "[1].Cocuk Adi"    to gd-5-col-10
     move "[1].Cocuk Soyadi"    to gd-5-col-11
     move "[2].Cocuk Adi"    to gd-5-col-12
     move "[2].Cocuk Soyadi"    to gd-5-col-13
     move "[3].Cocuk Adi"    to gd-5-col-14
     move "[3].Cocuk Soyadi"    to gd-5-col-15

     move grupda-share-yok to share-yok
     move "Giris :"   to  gir-tar-Label(1:7)
      move "Cikis :" to git-tar-Label(1:7)
      move link-ilk-gun to egun
                   move link-ilk-ay  to eay
                   move link-ilk-yil to eyil
                   move etarih       to gir-tar-Label(10:)
           
                   move link-son-tar to gruplar-git-tar
                   move link-son-gun to egun
                   move link-son-ay  to eay
                   move link-son-yil to eyil
                   move etarih       to  git-tar-Label(10:)
     display Form3-Cb-1  Form3-La-1 Form3-La-1a



     modify form3-gd-1,record-to-add(form3-gd-1-record)
      .
*
 Form3-Gd-1-Ev-Other.
     evaluate event-type
     when msg-finish-entry
          evaluate event-data-1
          when 2
              modify form3-gd-1,cursor-Y event-data-2 
                                cursor-X 3
          when 3             
              modify form3-gd-1,cursor-Y event-data-2 + 1
                                cursor-X 2
          end-evaluate
     end-evaluate
     
     .
*
 Form3-Ex-Other.
     evaluate key-status
     when 2
        perform toplu-rez-olustur
     when 3
        perform temiz-oda-cin-yap
        perform form3-tab3-grid-baslik-yukle
        perform gelecek-rez-bul
     when 4
        perform tum-oda-cin-yap
        perform form3-tab3-grid-baslik-yukle
        perform gelecek-rez-bul
     when 6
        evaluate Form3-Ta-1-Value
        when 4
          initialize sayac
          inquire form3-gd-4,cursor-y in sayac
          inquire form3-gd-4(sayac,1),
               cell-data in ydk-rez
           initialize rez-rec
           move ydk-rez   to rez-no
           read rez no lock invalid 
               continue 
           not invalid 
               move rez-folio   to ydk-konuk-folio
               perform folio-cagir               
           end-read 
               perform form3-tab4-grid-baslik-yukle
               perform gidecek-rez-bul
        end-evaluate 
     when 7
         perform grup-cout
         perform form3-tab4-grid-baslik-yukle
         perform gidecek-rez-bul
     when 145
         if Form3-Ta-1-Value = 2
            compute xtoplam-kayit-sayi = toplam-kayit-sayi - 1
            if sil-adet > xtoplam-kayit-sayi
               display message box "Silinecek Max. Rezervasyon Adedi : " xtoplam-kayit-sayi
                               title "Uyari"
                               icon 1
               exit paragraph 
            end-if
 
            inquire Form3-Gd-2,
                    last-row in son-satir
            initialize k
            move 1 to grid-satir-sayi
            perform varying k
                    from 1
                    by 1
                    until k > son-satir
                      add 1 to grid-satir-sayi
                      if grid-satir-sayi = son-satir
                         exit perform cycle 
                      end-if 
                      if k <= sil-adet
                         modify form3-gd-2(grid-satir-sayi,15),
                                bitmap = yes-bmp
                                bitmap-width = 16
                                bitmap-number = 1                        
                                hidden-data = "E"
                      else
                         modify form3-gd-2(grid-satir-sayi,15),
                                bitmap = no-bmp
                                bitmap-width = 16
                                bitmap-number = 1                        
                                hidden-data = "H"
                      end-if                        
            end-perform
         end-if 
     end-evaluate.
*
 grup-cout.
    open input acenta doviz konuk 
               romhrk firma cast odalar kodlar02
    initialize rez-rec
    move tarih-tasi       to rez-cik-tar
    move "I"              to rez-durumu
    start rez key not < REZ-cik invalid 
          continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end 
          if rez-durumu <> "I" or
             rez-cik-tar <> tarih-tasi
                exit perform 
          end-if
          if rez-grup-no <> gruplar-kodu
              exit perform cycle 
          end-if
          initialize konuk-rec
          move rez-folio   to konuk-folio
          read konuk no lock invalid 
               exit perform cycle 
          not invalid 
              if konuk-durumu = "H"
                  exit perform cycle 
              else                 
                  perform folio-bakiye-bul
                  if folio-bakiye not = 0
                     exit perform cycle 
                  end-if                   
                  perform cout-prog-cagir                 
              end-if 
          end-read 
    end-read 
    end-perform
    end-start
    close acenta doviz romhrk 
          firma cast odalar kodlar02 konuk       
     .
*
 cout-prog-cagir.
    initialize dokcagir-tasi
    set dokcagir-tasi-call-cout2    to true
    move rez-odano                  to dokcagir-konuk-odano
    move konuk-folio                to dokcagir-konuk-folio
    move 1                          to dokcagir-toplu
    perform dokcagir-call
    move dokcagir-konuk-odano      to rez-odano
    move dokcagir-konuk-folio      to rez-folio
     
       call "w$keybuf" using 3 end-call

     .
*
 temiz-oda-cin-yap.
     if title-temiz-adet = spaces 
        display message box "C/In Yapilacak Temiz Oda Bulunamadi..."
                        title "Uyari"
                        icon 1
        exit paragraph 
     end-if 
     display message box title-temiz-adet " 'Adet Temiz Oda C/in Yapilacaktir..." new-line
                                     "Eminmisiniz.!!!"
                     title "Uyari"
                     icon 1
                     type 2
                     default 2
                     returning return-code 
     if return-code = 2
         exit paragraph 
     end-if

     open input  odalar 
     initialize rez-rec
     move tarih-tasi       to rez-gir-tar
     move "I"              to rez-durumu
     start rez key not < REZ-GIR invalid 
           continue 
     not invalid 
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10" to fs-rez
     not at end 
           if rez-durumu <> "I" or
              rez-gir-tar <> tarih-tasi
                 exit perform 
           end-if
           if rez-grup-no <> gruplar-kodu
               exit perform cycle 
           end-if 
           if rez-odano = spaces
               exit perform cycle
           end-if 
           if rez-c-in = "E"
              exit perform cycle 
           end-if 
           if rez-folio > 0
               exit perform cycle 
           end-if 
*/KAÇIÞ YOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK :)
           initialize odalar-rec 
           move rez-odano   to odalar-anah
           read odalar no lock invalid 
                exit perform cycle 
           not invalid 
               if house-durumu not = house-bt|sadece temiz oda c/in yapiliyor.
                   exit perform cycle 
               end-if 
           end-read 
              perform cin-prog-cagir
     end-read 
     end-perform
     end-start
     close  odalar.
*
 tum-oda-cin-yap.
     if title-oda-adet = spaces 
        display message box "C/In Yapilacak Oda Bulunamadi..."
                        title "Uyari"
                        icon 1
        exit paragraph 
     end-if 
     display message box title-oda-adet " 'Adet Oda C/in Yapilacaktir..." new-line
                                     "Eminmisiniz.!!!"
                     title "Uyari"
                     icon 1
                     type 2
                     default 2
                     returning return-code 
     if return-code = 2
         exit paragraph 
     end-if

     open input  odalar 
     initialize rez-rec
     move tarih-tasi       to rez-gir-tar
     move "I"              to rez-durumu
     start rez key not < REZ-GIR invalid 
           continue 
     not invalid 
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10" to fs-rez
     not at end 
           if rez-durumu <> "I" or
              rez-gir-tar <> tarih-tasi
                 exit perform 
           end-if
           if rez-grup-no <> gruplar-kodu
               exit perform cycle 
           end-if 
           if rez-odano = spaces
               exit perform cycle
           end-if 
           if rez-c-in = "E"
              exit perform cycle 
           end-if 
           if rez-folio > 0
               exit perform cycle 
           end-if 
*/KAÇIÞ YOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK :)
           initialize odalar-rec 
           move rez-odano   to odalar-anah
           read odalar no lock invalid 
                exit perform cycle 
           not invalid 
               continue  
           end-read 
              perform cin-prog-cagir
     end-read 
     end-perform
     end-start
     close  odalar
     .
*
 cin-prog-cagir. 
    if rez-folio = 0 then 
      move 99999997 to rez-folio
    end-if
    initialize dokcagir-tasi
    set dokcagir-tasi-call-cin2    to true
    move rez-no                    to dokcagir-konuk-rez-no      
    move rez-folio                 to dokcagir-konuk-folio
    perform dokcagir-call
    move dokcagir-konuk-rez-no     to rez-no
    move dokcagir-konuk-folio      to rez-folio 
       call "w$keybuf" using 3 end-call  
     .
*
 toplu-rez-olustur.
       initialize takvim-rec
       move tarih-tasi      to takvim-anah
       read takvim no lock invalid 
            display message box "Tarih Bulunamadi.!!!"
                            title "Uyari"
                            icon 1                 
       not invalid             
             initialize p m occ-sayi link-toplu-adlar
             perform varying p
                       from 1
                       by 1
                       until p > ust-occ                               
                          add 1 to m
                          if m = 1
                             exit perform cycle 
                          end-if 
                          inquire form3-gd-1(m),
                                  record-data in form3-gd-1-record
                          if gd-5-col-2 = spaces
                             exit perform cycle 
                          end-if 
                          add 1              to occ-sayi
                          move gd-5-col-2    to link-toplu-grup-adi1(occ-sayi)
                          move gd-5-col-3    to link-toplu-grup-soy1(occ-sayi)

                          move gd-5-col-4    to link-toplu-grup-adi2(occ-sayi)
                          move gd-5-col-5    to link-toplu-grup-soy2(occ-sayi)

                          move gd-5-col-6    to link-toplu-grup-adi3(occ-sayi)
                          move gd-5-col-7    to link-toplu-grup-soy3(occ-sayi)
                          move gd-5-col-8    to link-toplu-grup-adi4(occ-sayi)
                          move gd-5-col-9    to link-toplu-grup-soy4(occ-sayi)

                          move gd-5-col-10    to link-toplu-grup-coc-adi1(occ-sayi)
                          move gd-5-col-11    to link-toplu-grup-coc-soyadi1(occ-sayi)

                          move gd-5-col-12    to link-toplu-grup-coc-adi2(occ-sayi)
                          move gd-5-col-13    to link-toplu-grup-coc-soyadi2(occ-sayi)

                          move gd-5-col-14    to link-toplu-grup-coc-adi3(occ-sayi)
                          move gd-5-col-15    to link-toplu-grup-coc-soyadi3(occ-sayi)


              



             end-perform      
             move share-yok   to link-share-yok
                move gruplar-rec             to link-rez-grup-rec
             perform toplu-rez-cagir
       end-read. 
*
 toplu-rez-cagir.          
          call "/asya/ytl/obj/otel/rez.asy" 
                        using  link-rez-no link-gelen-rec link-gelen-sharenum 
                               link-rez-grup-rec link-toplu-adlar
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/rez.asy"
          end-call    
     .
*
 Form3-Mn-1-MI-Yapistir-Link.
     perform form3-baslik-yukle.
     call "c$sleep" using 2.
     if is-remote             
        perform clipboard-islem 
     else
        perform clipboard-islem-yerel
     end-if.        

*
 clipboard-islem.
     initialize buf
     call "@[DISPLAY]:C:\windows\system32\user32.dll" 
     on exception
           display message box "user32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph
     end-call      .
     call "@[DISPLAY]:C:\windows\system32\kernel32.dll" on exception
           display message box "kernel32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "@[DISPLAY]:C:\windows\system32\msvcrt.dll" on exception
           display message box "msvcrt.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "@[DISPLAY]:OpenClipboard" using by value 0
          giving hwnd.

     call "@[DISPLAY]:GetClipboardData" using by value cf_text
                                        giving hglobal.

     call "@[DISPLAY]:GlobalLock" using by value hglobal
                                  returning ptr

     call "@[DISPLAY]:lstrlenA" using by value ptr 
                               returning boy.

     if boy > 0
     call "@[DISPLAY]:RtlMoveMemory" using by reference buf
                                     by value ptr
                                     by value boy
     end-call
            initialize sayac
            move 1 to sayac
            perform varying k 
                    from 1 
                    by 1 
                    until k > ust-occ                        
                         unstring buf delimited by x"0d0a"
                         into satir(k)   pointer sayac
                         
                         if satir(k) = spaces
                            exit perform cycle 
                         end-if 

                         initialize sayac2
                         move 1 to sayac2
                         perform varying l 
                                 from 1 
                                 by 1 
                                 until l > 10
                                  unstring satir(k) delimited by x"09"
                                       into sutun(k,l)   pointer sayac2                                                                           
                         end-perform
            end-perform
           perform form3-baslik-yukle 
           perform varying m 
                   from 1 
                   by 1 
                   until m >= k            
                   initialize form3-gd-1-record
                   move m     to zzz
                   move zzz   to gd-5-col-1

                   move sutun(m,1)                         to gd-5-col-2
                   move sutun(m,2)                         to gd-5-col-3
                   move sutun(m,3)                         to gd-5-col-4
                   
                   move sutun(m,4)                         to gd-5-col-5 
                   move sutun(m,5)                         to gd-5-col-6

                   move sutun(m,6)                         to gd-5-col-7
                    move sutun(m,7)                         to gd-5-col-8

                   move sutun(m,8)                         to gd-5-col-9

                   move sutun(m,9)                         to gd-5-col-10
                   move sutun(m,10)                         to gd-5-col-11
                   move sutun(m,11)                         to gd-5-col-12
                   move sutun(m,12)                         to gd-5-col-13
                   move sutun(m,13)                         to gd-5-col-14
                   move sutun(m,14)                         to gd-5-col-15

                    move link-ilk-tar to gruplar-gel-tar
*                   move link-ilk-gun to egun
*                   move link-ilk-ay  to eay
*                   move link-ilk-yil to eyil
*                   move etarih       to gd-5-col-8 
           
                   move link-son-tar to gruplar-git-tar
*                   move link-son-gun to egun
*                   move link-son-ay  to eay
*                   move link-son-yil to eyil
*                   move etarih       to gd-5-col-9


                   

                   modify form3-gd-1,
                          record-to-add(form3-gd-1-record)
           
           end-perform
     call "@[DISPLAY]:GlobalUnlock" using hglobal.
     call "@[DISPLAY]:CloseClipboard".
     cancel "@[DISPLAY]:user32.dll".
     cancel "@[DISPLAY]:kernel32.dll".
     cancel "@[DISPLAY]:msvcrt.dll".     
     modify form3-gd-1,
            mass-update = 0 
     .
*
 clipboard-islem-yerel.
     initialize buf
     call "user32.dll" 
     on exception
           display message box "user32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph
     end-call      .
     call "kernel32.dll" on exception
           display message box "kernel32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "msvcrt.dll" on exception
           display message box "msvcrt.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "OpenClipboard" using by value 0
          giving hwnd.

     call "GetClipboardData" using by value cf_text
                                        giving hglobal.

     call "GlobalLock" using by value hglobal
                                  returning ptr

     call "lstrlenA" using by value ptr 
                               returning boy.

     if boy > 0
     call "RtlMoveMemory" using by reference buf
                                     by value ptr
                                     by value boy
     end-call
            initialize sayac
            move 1 to sayac
            perform varying k 
                    from 1 
                    by 1 
                    until k > ust-occ                        
                         unstring buf delimited by x"0d0a"
                         into satir(k)   pointer sayac
                         
                         if satir(k) = spaces
                            exit perform cycle 
                         end-if 

                         initialize sayac2
                         move 1 to sayac2
                         perform varying l 
                                 from 1 
                                 by 1 
                                 until l > 10
                                  unstring satir(k) delimited by x"09"
                                       into sutun(k,l)   pointer sayac2                                                                           
                         end-perform
            end-perform
           perform form3-baslik-yukle 
           perform varying m 
                   from 1 
                   by 1 
                   until m >= k            
                   initialize form3-gd-1-record
                   move m     to zzz
                   move zzz   to gd-5-col-1

                   move sutun(m,1)                         to gd-5-col-2
                   move sutun(m,2)                         to gd-5-col-3
                   move sutun(m,3)                         to gd-5-col-4
                   
                   move sutun(m,4)                         to gd-5-col-5 
                   move sutun(m,5)                         to gd-5-col-6

                   move sutun(m,6)                         to gd-5-col-7
                    move sutun(m,7)                         to gd-5-col-8

                   move sutun(m,8)                         to gd-5-col-9

*                   move link-ilk-tar to gruplar-gel-tar
*                   move link-ilk-gun to egun
*                   move link-ilk-ay  to eay
*                   move link-ilk-yil to eyil
                   move etarih       to gd-5-col-8 
           
*                   move link-son-tar to gruplar-git-tar
*                   move link-son-gun to egun
*                   move link-son-ay  to eay
*                   move link-son-yil to eyil
                   move etarih       to gd-5-col-9

                   modify form3-gd-1,
                          record-to-add(form3-gd-1-record)
           
           end-perform

     call "GlobalUnlock" using hglobal.
     call "CloseClipboard".
     cancel "user32.dll".
     cancel "kernel32.dll".
     cancel "msvcrt.dll".
     modify form3-gd-1,mass-update = 0.

*
 Form3-Ta-1-Ev-Cmd-Tabchanged.

     
     .
*
 form3-tab2-grid-baslik-yukle.
     modify form3-gd-2,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-2-record
     move "Rez No"   to gd-6-col-1
     move "Adi"      to gd-6-col-2
     move "Soyadi"   to gd-6-col-3
     move "C/In Tarihi" to gd-6-col-4
     move "C/Out Tarihi" to gd-6-col-5
     move "Firma"        to gd-6-col-6
     move "Acenta"       to gd-6-col-7
     move "Pax"          to gd-6-col-8
     move "Child"        to gd-6-col-9
     move "Pansiyon"     to gd-6-col-10
     move "Fiyat"        to gd-6-col-11
     move "DV"           to gd-6-col-12
     move "#"            to gd-6-col-13
     move "C/In"         to gd-6-col-14
     move "#"            to gd-6-col-15
     modify form3-gd-2,
           record-to-add(form3-gd-2-record)
     .
*
 form3-tab3-grid-baslik-yukle.
     modify form3-gd-3,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-3-record
     move "Rez No"         to gd-7-col-1
     move "Adi"            to gd-7-col-2
     move "Soyadi"         to gd-7-col-3
     move "C/In Tarihi"    to gd-7-col-4
     move "C/Out Tarihi"   to gd-7-col-5
     move "Firma"          to gd-7-col-6
     move "Acenta"         to gd-7-col-7
     move "Pax"            to gd-7-col-8
     move "Child"          to gd-7-col-9
     move "Pansiyon"       to gd-7-col-10
     move "Oda No/Durumu"  to gd-7-col-11
     move "DV"             to gd-7-col-12
     move "#"              to gd-7-col-13
     move "C/In"           to gd-7-col-14
     modify form3-gd-3,
           record-to-add(form3-gd-3-record)
     .
*
 form3-tab4-grid-baslik-yukle.
     modify form3-gd-4,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-4-record
     move "Rez No"         to gd-8-col-1
     move "Adi"            to gd-8-col-2
     move "Soyadi"         to gd-8-col-3
     move "C/In Tarihi"    to gd-8-col-4
     move "C/Out Tarihi"   to gd-8-col-5
     move "Firma"          to gd-8-col-6
     move "Acenta"         to gd-8-col-7
     move "Pax"            to gd-8-col-8
     move "Child"          to gd-8-col-9
     move "Pansiyon"       to gd-8-col-10
     move "Oda No/Durumu"  to gd-8-col-11
     move "DV"             to gd-8-col-12
     move "#"              to gd-8-col-13
     move "C/In"           to gd-8-col-14
     move "Bakiye[TL]"     to gd-8-col-15    
     modify form3-gd-4,
           record-to-add(form3-gd-4-record).
*
 form3-tab5-grid-baslik-yukle.
     modify form3-gd-9,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-9-record
     move "Rez No"         to gd-9-col-1
     move "Adi"            to gd-9-col-2
     move "Soyadi"         to gd-9-col-3
     move "C/In Tarihi"    to gd-9-col-4
     move "C/Out Tarihi"   to gd-9-col-5
     move "Firma"          to gd-9-col-6
     move "Acenta"         to gd-9-col-7
     move "Pax"            to gd-9-col-8
     move "Child"          to gd-9-col-9
     move "Pansiyon"       to gd-9-col-10
     move "Oda No/Durumu"  to gd-9-col-11
     move "DV"             to gd-9-col-12
     move "#"              to gd-9-col-13
     move "C/In"           to gd-9-col-14
*     move "Bakiye[TL]"     to gd-9-col-15    
     modify form3-gd-9,
           record-to-add(form3-gd-9-record)
     .
*
 acilmis-rezervasyon-bul.

    open input firma acenta doviz cast
    initialize rez-rec 
               toplam-oda-sayisi toplam-kisi-sayi
    move 1                to toplam-kayit-sayi
    move gruplar-kodu     to rez-grup-no
    move "I"              to rez-durumu
    start rez key not < rez-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"   to fs-rez
    not at end
           if rez-grup-no <> gruplar-kodu or 
              rez-durumu <> "I"
                 exit perform 
           end-if 
      
           initialize form3-gd-2-record
           move rez-no          to gd-6-col-1
           move rez-adi         to gd-6-col-2
           move rez-soyadi      to gd-6-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-6-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-6-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-6-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-6-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-6-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-6-col-9
           move rez-pan-tipi    to gd-6-col-10
           move rez-fiyati      to etutar
           move etutar          to gd-6-col-11
           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-6-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-6-col-13
                     add 1      to toplam-oda-sayisi
                else
                     move 0     to gd-6-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move rez-c-in        to gd-6-col-14

           modify form3-gd-2,
                  record-to-add(form3-gd-2-record)

           if rez-c-in = "E"
              modify form3-gd-2(toplam-kayit-sayi),
                  row-color = 176
           end-if
           initialize eh
           if rez-c-in not = "E"
               move "H"                   to eh
               modify form3-gd-2(toplam-kayit-sayi,15),
                      hidden-data eh
               modify form3-gd-2(toplam-kayit-sayi,1),
                      hidden-data rez-no
               modify form3-gd-2(toplam-kayit-sayi,15),
                      bitmap = no-bmp
                      bitmap-width = 16
                      bitmap-number = 1

           end-if 
    end-read 
    end-perform
    end-start

    close firma acenta doviz cast

    initialize form3-gd-2-record
    move "Toplam->"       to gd-6-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-6-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-6-col-8

    modify form3-gd-2,
       record-to-add(form3-gd-2-record)

    modify form3-gd-2(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-2,
       mass-update = 0

     .
*
 silinmis-rez-yukle.
    open input firma acenta doviz cast
    initialize rez-rec 
               toplam-oda-sayisi toplam-kisi-sayi
    move 1                to toplam-kayit-sayi
    move gruplar-kodu     to rez-grup-no
    move "S"              to rez-durumu
    start rez key not < rez-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"   to fs-rez
    not at end
           if rez-grup-no <> gruplar-kodu or 
              rez-durumu <> "S"
                 exit perform 
           end-if 

           initialize form3-gd-9-record
           move rez-no          to gd-9-col-1
           move rez-adi         to gd-9-col-2
           move rez-soyadi      to gd-9-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-9-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-9-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-9-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-9-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-9-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-9-col-9
           move rez-pan-tipi    to gd-9-col-10
           move rez-fiyati      to etutar
           move etutar          to gd-9-col-11
           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-9-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-9-col-13
                     add 1      to toplam-oda-sayisi
                else
                     move 0     to gd-9-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move rez-c-in        to gd-9-col-14

           modify form3-gd-9,
                  record-to-add(form3-gd-9-record)
 
    end-read 
    end-perform
    end-start

    close firma acenta doviz cast

    initialize form3-gd-9-record
    move "Toplam->"       to gd-9-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-9-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-6-col-8

    modify form3-gd-9,
       record-to-add(form3-gd-9-record)

    modify form3-gd-9(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-9,
       mass-update = 0

     .
*
 gelecek-rez-bul.
    open input acenta doviz firma cast odalar kodlar02
    initialize rez-rec
               toplam-oda-sayisi toplam-kisi-sayi temiz-oda-adet
               toplam-oda-adet 
    move 1                to toplam-kayit-sayi
    move tarih-tasi       to rez-gir-tar
    move "I"              to rez-durumu
    start rez key not < REZ-GIR invalid 
          continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end 
          if rez-durumu <> "I" or
             rez-gir-tar <> tarih-tasi
                exit perform 
          end-if
          if rez-grup-no <> gruplar-kodu
              exit perform cycle 
          end-if 
 
           initialize form3-gd-3-record
           move rez-no          to gd-7-col-1
           move rez-adi         to gd-7-col-2
           move rez-soyadi      to gd-7-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-7-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-7-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-7-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-7-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-7-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-7-col-9
           move rez-pan-tipi    to gd-7-col-10
*           move rez-fiyati      to etutar
*           move etutar          to gd-7-col-11
           initialize odalar-rec
           move rez-odano       to odalar-anah
           read odalar no lock invalid 
               continue
           not invalid 
            initialize kodlar02-rec
            move "C"          to kodlar02-tipi
            move house-durumu to kodlar02-kodu
            read kodlar02 no lock invalid 
                continue 
            end-read
            move   odalar-no   to   o-kisa 
            perform oda-uzat
           
               string gd-7-col-11
                     o-uzun  delimited by "    "
                     "-"        delimited by size
                     kodlar02-adi delimited by size 
               into gd-7-col-11 

           end-read 

           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-7-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-7-col-13
                     add 1      to toplam-oda-sayisi
                       if house-durumu = house-bt and 
                          rez-c-in not = "E"
                          add 1 to temiz-oda-adet
                       end-if
                       if rez-c-in not = "E"
                          add 1 to toplam-oda-adet
                       end-if 
                else
                     move 0     to gd-7-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move REZ-C-IN        to gd-7-col-14
           modify form3-gd-3,
                  record-to-add(form3-gd-3-record)          
           if REZ-C-IN = "E"
              modify form3-gd-3(toplam-kayit-sayi),
                   row-color = 176
           end-if 
    end-read 
    end-perform
    end-start
    close acenta doviz firma cast odalar kodlar02
    initialize form3-gd-3-record
    move "Toplam->"       to gd-7-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-7-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-7-col-8

    modify form3-gd-3,
       record-to-add(form3-gd-3-record)

    modify form3-gd-3(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-3,
       mass-update = 0
    move temiz-oda-adet  to title-temiz-adet
    move toplam-oda-adet to title-oda-adet
    
    modify bt-temiz,
           title = bt-title
    modify bt-hepsi,
           title = hepsi-title
     .
*
 gidecek-rez-bul.
    open input acenta doviz konuk 
               romhrk firma cast odalar kodlar02
    initialize rez-rec
               toplam-oda-sayisi toplam-kisi-sayi
               toplam-grup-bakiye    
    move 1                to toplam-kayit-sayi
    move tarih-tasi       to rez-cik-tar
    move "I"              to rez-durumu
    start rez key not < REZ-cik invalid 
          continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end 
          if rez-durumu <> "I" or
             rez-cik-tar <> tarih-tasi
                exit perform 
          end-if
          if rez-grup-no <> gruplar-kodu
              exit perform cycle 
          end-if 
 
           initialize form3-gd-4-record
           move rez-no          to gd-8-col-1
           move rez-adi         to gd-8-col-2
           move rez-soyadi      to gd-8-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-8-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-8-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-8-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-8-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-8-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-8-col-9
           move rez-pan-tipi    to gd-8-col-10
*           move rez-fiyati      to etutar
*           move etutar          to gd-7-col-11
           initialize odalar-rec
           move rez-odano       to odalar-anah
           read odalar no lock invalid 
               continue
           not invalid 
            initialize kodlar02-rec
            move "C"          to kodlar02-tipi
            move house-durumu to kodlar02-kodu
            read kodlar02 no lock invalid 
                continue 
            end-read
             move   odalar-no   to   o-kisa 
            perform oda-uzat
           
               string gd-8-col-11
                     o-uzun  delimited by "    "
                     "-"        delimited by size
                     kodlar02-adi delimited by size 
               into gd-8-col-11                
           end-read 

           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-8-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-8-col-13
                     add 1      to toplam-oda-sayisi
                else
                     move 0     to gd-8-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move REZ-C-IN        to gd-8-col-14
              perform folio-bakiye-bul
           move folio-bakiye    to etutar
           move etutar          to gd-8-col-15

           compute toplam-grup-bakiye = 
                   toplam-grup-bakiye + folio-bakiye

           modify form3-gd-4,
                  record-to-add(form3-gd-4-record)          
           initialize konuk-rec 
           move rez-folio  to konuk-folio
           read konuk no lock invalid 
                continue 
           not invalid
             if konuk-durumu = "H"
                modify form3-gd-4(toplam-kayit-sayi),
                     row-color = 176
             end-if   
           end-read 
*           if REZ-C-IN = "E"
*           end-if 
    end-read 
    end-perform
    end-start
    close acenta doviz romhrk 
          firma cast odalar kodlar02 konuk
    initialize form3-gd-4-record
    move "Toplam->"       to gd-8-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-8-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-8-col-8
    move toplam-grup-bakiye to etutar
    move etutar             to gd-8-col-15
    modify form3-gd-4,
       record-to-add(form3-gd-4-record)

    modify form3-gd-4(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-4,
       mass-update = 0.
*
 folio-bakiye-bul.
    initialize romhrk-rec folio-bakiye 
               borc-bakiye alacak-bakiye
    move rez-folio     to romhrk-folio
    start romhrk key not < romhrk-anah invalid 
         continue 
    not invalid 
    perform with test after until fs-romhrk = "10"
    read romhrk next no lock end move "10"  to fs-romhrk
    not at end  
           if romhrk-folio <> rez-folio
               exit perform 
           end-if
           evaluate romhrk-ba
           when "B"
               compute borc-bakiye = 
                       borc-bakiye + ROMHRK-TL-TUTAR
           when "A"
               compute alacak-bakiye = 
                       alacak-bakiye + ROMHRK-TL-TUTAR
           end-evaluate
    end-read 
    end-perform
    end-start
    compute folio-bakiye = borc-bakiye - alacak-bakiye
     .
*
 Form3-Ta-1-Aft-Tabchg-Display.
     evaluate Form3-Ta-1-Value
     when 1
        modify Form3-Pb-1,enabled = true
        modify bt-temiz,enabled = false
        modify bt-hepsi,enabled = false
        modify cb-cout,enabled = false
        modify lb-sil-adet,visible = false 
        modify acc-sil-adet,visible = false
        modify btn-sil-adet,visible = false
     when 2         
        perform form3-tab2-grid-baslik-yukle
        perform acilmis-rezervasyon-bul
        modify Form3-Pb-1,enabled = false                 
        modify bt-temiz,enabled = false
        modify bt-hepsi,enabled = false 

        modify lb-sil-adet,visible = true 
        modify acc-sil-adet,visible = true
        modify btn-sil-adet,visible = true
     when 3
        perform form3-tab3-grid-baslik-yukle
        perform gelecek-rez-bul
        modify Form3-Pb-1,enabled = false                 
        modify bt-temiz,enabled = true
        modify bt-hepsi,enabled = true 
        modify cb-cout,enabled = false
        modify lb-sil-adet,visible = false 
        modify acc-sil-adet,visible = false
        modify btn-sil-adet,visible = false

     when 4
        perform form3-tab4-grid-baslik-yukle
        perform gidecek-rez-bul
        modify Form3-Pb-1,enabled = false                 
        modify bt-temiz,enabled = false
        modify bt-hepsi,enabled = false
        modify cb-cout,enabled = true
        modify lb-sil-adet,visible = false 
        modify acc-sil-adet,visible = false
        modify btn-sil-adet,visible = false

     when 5
       perform form3-tab5-grid-baslik-yukle
       perform silinmis-rez-yukle
       modify Form3-Pb-1,enabled = true
       modify bt-temiz,enabled = false
       modify bt-hepsi,enabled = false
       modify cb-cout,enabled = false
       modify lb-sil-adet,visible = false 
       modify acc-sil-adet,visible = false
       modify btn-sil-adet,visible = false
     end-evaluate.
*
 Form3-Gd-2-Ev-Other.
    evaluate event-type
    when msg-begin-entry
       move event-action-fail to event-action
       inquire form3-gd-2(event-data-2,1),
               cell-data in ydk-rez
       if ydk-rez = 0 or 
          ydk-rez = spaces 
            exit paragraph 
       end-if 
       perform rez-cagir
       perform form3-tab2-grid-baslik-yukle
       perform acilmis-rezervasyon-bul
    when msg-bitmap-clicked
       evaluate event-data-1
       when 15
            move event-action-fail to event-action
            initialize eh son-satir
            inquire Form3-Gd-2,last-row in son-satir
            if son-satir not = event-data-2
               inquire Form3-Gd-2(event-data-2,15),hidden-data = eh
               if eh = "H"
                     modify Form3-Gd-2(event-data-2,15),
                            bitmap = yes-bmp
                            bitmap-width = 16
                            bitmap-number = 1
                            hidden-data = "E"
               else
                     modify Form3-Gd-2(event-data-2,15),
                            bitmap = no-bmp
                            bitmap-width = 16
                            bitmap-number = 1
                            hidden-data = "H"
               end-if
            end-if         
       end-evaluate 
    when msg-heading-dblclick
         evaluate event-data-1
         when 15
             initialize eh son-satir
             inquire Form3-Gd-2,last-row in son-satir 
             compute son-satir = son-satir - 1
             initialize k i  
             perform varying i 
                        from 1
                        by 1
                        until i > son-satir
                        if i = son-satir
                            exit perform 
                        end-if 
                            compute k = i + 1
                            inquire Form3-Gd-2(k ,15),hidden-data eh
                            
                            if eh = "H"
                                  modify Form3-Gd-2(k,15),
                                         bitmap = yes-bmp
                                         bitmap-width = 16
                                         bitmap-number = 1
                                         hidden-data = "E"
                            else
                                  modify Form3-Gd-2(k,15),
                                         bitmap = no-bmp
                                         bitmap-width = 16
                                         bitmap-number = 1
                                         hidden-data = "H"
                            end-if 
             end-perform
         end-evaluate
    end-evaluate.
*
 Form3-Gd-4-Ev-Other.
    evaluate event-type
    when msg-begin-entry
       move event-action-fail to event-action
       inquire form3-gd-4(event-data-2,1),
               cell-data in ydk-rez
       if ydk-rez = 0 or 
          ydk-rez = spaces 
            exit paragraph 
       end-if 
       perform rez-cagir
       perform form3-tab4-grid-baslik-yukle
       perform gidecek-rez-bul
    end-evaluate     
    .
*
 rez-cagir.
      initialize dokcagir-tasi
      set dokcagir-tasi-call-rez1    to true
      move ydk-rez                   to dokcagir-rez-no
      perform dokcagir-call
      move dokcagir-rez-no           to rez-no
         call "w$keybuf" using 3 end-call.
*
 dokcagir-call.
      call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
           on exception 
              perform callerr-proc
           not on exception
              cancel "/asya/ytl/obj/otel/dokcagir.asy"
      end-call
      call "w$keybuf" using 3 end-call .
*
 Form3-Gd-3-Ev-Other.
    evaluate event-type
    when msg-begin-entry
       move event-action-fail to event-action
       inquire form3-gd-3(event-data-2,1),
               cell-data in ydk-rez
       if ydk-rez = 0 or 
          ydk-rez = spaces 
            exit paragraph 
       end-if 

       perform rez-cagir
    end-evaluate     
    .
*
 Form3-Mn-2-MI-SeciliSatirSil-Link.
    display message box "Secili Rezervasyonlar Silinecektir." new-line
                             "Eminmisiniz.."
                      title "Uyari"
                      icon 1
                      default 2
                      type 2
                      returning return-code
    if return-code = 2
        exit paragraph 
    end-if    
    open i-o cast
    initialize k
    inquire form3-gd-2,last-row in son-satir
    perform varying k
             from 2
             by 1
             until k > son-satir
                 inquire form3-gd-2(k,15),hidden-data eh
                 if eh not = "E"
                    exit perform cycle 
                 end-if 
                 inquire form3-gd-2(k,1),
                         cell-data in ydk-rez
                 
                 perform satir-rez-sil
                 
    end-perform
    close cast                    
    perform form3-tab2-grid-baslik-yukle
    perform acilmis-rezervasyon-bul.
*
 satir-rez-sil.    
    initialize rez-rec  
    move ydk-rez to rez-no 
    read rez no lock invalid 
       display message box "Silinecek Rezervasyon Bulunamadi..."
                       title "Uyari"
                       icon 1            
        exit paragraph 
    end-read 
    if rez-c-in = "E" 
       initialize mesaj-degiskenler
       move " [ Silinemez Rezervasyon ] " to mmesaj-title
       move " Bu Rezervasyon C-In Yapilmis   !!! " to mmesaj-1 
       move " C-In'i Iptal Edip Siliniz      !!! " to mmesaj-2 
       move 1           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       exit paragraph 
    end-if
    if rez-sharenum > 0
       move rez-sharenum to eski-sharenum       
    end-if

        if rez-para-isl-sistemden = 1 then
             move tarih-tasi to rez-isl-tar
        else
              accept sys-tar from century-date 
              move sys-yil to rez-isl-yil
              move sys-ay  to rez-isl-ay 
              move sys-gun to rez-isl-gun 
        end-if

       move k-kodu-tasi   to rez-staf 

       initialize rez-sharenum
************* share kontrol **********
       move "S" to rez-durumu 

       accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
       accept rez-edit-zaman from time          |                           

       rewrite rez-rec invalid 
               initialize mesaj-degiskenler
               move " [ Hata ] " to mmesaj-title
               move " BU REZERVASYON SILINEMEDI.........  " to mmesaj-1
               move " KONTROL EDINIZ....................  " to mmesaj-2 
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               exit paragraph
      end-rewrite 
               perform log-operation-rez
      if rez-k-g-b = "K"
         perform prohrk-sil  
         perform acenhrk-sil  
         perform takvim-sil
      end-if 

      if eski-sharenum > 0
         initialize cast-rec
         move rez-no           to cast-rez-no
         start cast key not < CAST-ANAH1 invalid 
              continue 
         not invalid 
         perform with test after until fs-cast = "10"
         read cast next no lock end move "10" to fs-cast 
         not at end 
               if cast-rez-no <> rez-no
                   exit perform 
               end-if 
               initialize cast-sharenum
               rewrite cast-rec end-rewrite 
         end-read 
         end-perform
         end-start
         perform share-sil-kont2
      end-if. 
*
 prohrk-sil.
     open i-o prohrk
     move isyeri-adres-tasi       to prohrk-rez-sirket
     move rez-no                 to prohrk-rez-no
     start prohrk key not < prohrk-rez-anah invalid
         continue
     not invalid
     perform with test after until fs-prohrk = "10"
     read prohrk next no lock end move "10"   to fs-prohrk
     not at end
            if     isyeri-adres-tasi       = prohrk-rez-sirket and
                   rez-no       = prohrk-rez-no
                   move "S"        to prohrk-rez-durumu
                   accept prohrk-duz-tarih from century-date
                   rewrite prohrk-rec invalid stop " " end-rewrite
            else
               move "10"   to fs-prohrk
            end-if
  
     end-read
     end-perform
     end-start
     close prohrk.
*
 acenhrk-sil. 
         
           open i-o acenhrk |grupla bilboard kullanýlamaz mami 
           move rez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
                continue 
           not invalid
           perform with test after until fs-takvim = "10"
           read takvim next no lock end move "10"  to fs-takvim
           not at end 
                  if takvim-anah >= rez-cik-tar
                      exit perform 
                  end-if 

                    move rez-acenta to acenhrk-acenta         
                    move takvim-anah      to acenhrk-tarih 
                    move rez-fiyat-konumu  to acenhrk-oda-konumu 
                    move rez-s-d-t-g     to acenhrk-s-d-t-g 
                    read acenhrk invalid 
                         continue
                    not invalid
                            compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
                            compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk
                            compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
                            compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free
                            compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
                            rewrite acenhrk-rec invalid 
                                continue 
                            end-rewrite
                    end-read

                     move rez-acenta to acenhrk-acenta
                     move takvim-anah      to acenhrk-tarih
                     move 41  to acenhrk-oda-konumu 
                     move rez-s-d-t-g     to acenhrk-s-d-t-g 
                     read acenhrk invalid 
                          continue
                     not invalid
                          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
                          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk
                          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
                          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free 
                          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
                         rewrite acenhrk-rec invalid 
                            continue 
                         end-rewrite
                     end-read

                     move rez-acenta        to acenhrk-acenta
                     move takvim-anah       to acenhrk-tarih 
                     move rez-fiyat-konumu  to acenhrk-oda-konumu 
                     move 5     to acenhrk-s-d-t-g 
                     read acenhrk no lock invalid 
                         continue 
                     not invalid
                            compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
                            compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk 
                            compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
                            compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free 
                            compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
                            rewrite acenhrk-rec invalid 
                                    continue 
                            end-rewrite
                     end-read

                     move rez-acenta       to acenhrk-acenta
                     move takvim-anah      to acenhrk-tarih 
                     move 41               to acenhrk-oda-konumu 
                     move 5                to acenhrk-s-d-t-g 
                     read acenhrk no lock invalid 
                          continue 
                     not invalid  
                          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
                          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk 
                          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
                          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free
                          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
                
                            rewrite acenhrk-rec invalid 
                                 continue 
                            end-rewrite
                     end-read
           end-read 
           end-perform
           end-start
           close acenhrk.                 
*
 takvim-sil.
           initialize takvim-rec
           move rez-gir-tar    to takvim-anah
           start takvim key not < takvim-anah invalid
                continue 
           not invalid 
           perform with test after until fs-takvim = "10"
           read takvim next no lock end move "10"  to fs-takvim
           not at end 
                  if takvim-anah >=rez-cik-tar
                     exit perform 
                  end-if 
                  compute takvim-sat-oda(rez-oda-konumu)   = 
                                  takvim-sat-oda(rez-oda-konumu)   - 1 
                          compute takvim-sat-buyuk(rez-oda-konumu) = 
                                  takvim-sat-buyuk(rez-oda-konumu) - rez-buyuk 
                          compute takvim-sat-kucuk(rez-oda-konumu) = 
                                  takvim-sat-kucuk(rez-oda-konumu) - rez-kucuk 
                          compute takvim-sat-free(rez-oda-konumu)  = 
                                  takvim-sat-free(rez-oda-konumu)  - rez-free 
                          compute takvim-sat-free(rez-oda-konumu)  = 
                                  takvim-sat-free(rez-oda-konumu)  - rez-bebek
                        rewrite takvim-rec invalid continue end-rewrite 
           end-read 
           end-perform
           end-start.
      
*
 Form3-Mn-2-MI-GrubaBagliTumRezervasyonlariSila-Link. 
           display message box "Gruba Bagli Tum Rezervasyonlar Silinecektir.." new-line
                               "Eminmisiniz.!!!"
                           title "Uyari"
                           icon 1
                           type 2
                           default 2
                           returning return-code 
           if return-code = 2
               exit paragraph 
           end-if
           modify form3-gd-2,enabled = false
           open i-o cast
           initialize rez-rec ydk-rez ydk-rez-rec
           move gruplar-kodu        to rez-grup-no
           move "I"                 to rez-durumu
           start rez key not < rez-grup invalid 
                 continue 
           not invalid 
           perform with test after until fs-rez = "10"
           read rez next no lock end move "10" to fs-rez
           not at end 
                  if rez-durumu <> "I" or
                     rez-grup-no <> gruplar-kodu
                        exit perform 
                  end-if
             
                  move rez-no   to ydk-rez
                  move rez-rec  to ydk-rez-rec
                     move 0 to tek-rez-sil
                     perform satir-rez-sil
                  move ydk-rez-rec to rez-rec

           end-read 
           end-perform
           end-start
           close cast 

           modify form3-gd-2,enabled = TRUE
           perform form3-tab2-grid-baslik-yukle
           perform acilmis-rezervasyon-bul.
           display message box "Rezervasyonlar Silindi..." new-line
                               "Lutfen Kontrol Ediniz.."
                           title "Uyari"
                           icon 1.
*
 route-prog-cagir.
         string  gruplar-kodu delimited by size
                 gruplar-adi delimited by "   "
         into rout-text
         move xrez-gir-tar to routsec-gir-tar
         move "G"          to rout-tip
         
         move gruplar-kodu to s-6
         move s-6 to rout-rez-no(1) 
         
         call "/asya/ytl/obj/otel/routsec.asy" 
              using link-rout
              on exception 
              perform callerr-proc
              exit paragraph
              not on exception 
         cancel "/asya/ytl/obj/otel/routsec.asy"
         end-call

        .         
*
 folio-cagir.
       initialize dokcagir-tasi
       set dokcagir-tasi-call-folio1      to true
       move ydk-konuk-folio               to dokcagir-konuk-folio
       perform dokcagir-call
       move dokcagir-konuk-folio          to konuk-folio
          call "w$keybuf" using 3 end-call.
*
 log-kaydet.      
       open i-o gruplog  
       initialize gruplog-rec 
      
*       move gruplar-rec   to gruplog-rec
*       move blok-rec      to bloklog-rec
       move log-tar       to gruplog-log-tar 
       move log-zaman     to gruplog-log-zaman        
       move k-kodu-tasi   to gruplog-staf 
       move gruplar-kodu  to gruplog-kodu
       move gruplar-adi   to gruplog-adi
       move gruplar-firma to gruplog-firma
       move gruplar-acenta to gruplog-acenta
       move gruplar-grup-statu    to gruplog-grup-statu
       move gruplar-banka         to gruplog-banka
       move gruplar-doviz   to gruplog-doviz
       move gruplar-pan-tipi to gruplog-pan-tipi
       move gruplar-anlasma  to gruplog-anlasma
       move gruplar-odeme    to gruplog-odeme
       move gruplar-pazar    to gruplog-pazar
       move gruplar-ulke     to gruplog-ulke
       move gruplar-gel-tar  to gruplog-gel-tar
       move gruplar-git-tar  to gruplog-git-tar
       move gruplar-not1     to gruplog-not1
       move gruplar-not2     to gruplog-not2
       move gruplar-toplam-oda-geceleme to gruplog-toplam-oda-geceleme
       move gruplar-toplam-pax-geceleme to gruplog-toplam-pax-geceleme
       move gruplar-kaynak-1 to gruplog-kaynak-1
       move gruplar-kaynak-2 to gruplog-kaynak-2
       move gruplar-kaynak-3 to gruplog-kaynak-3
       move gruplar-durumu   to gruplog-durumu
       move gruplar-silme-iptal-nedeni to gruplog-silme-iptal-nedeni
       move gruplar-isl-tar       to gruplog-isl-tar   
       move gruplar-sil-tar       to gruplog-sil-tar   
       move gruplar-satis-tar     to gruplog-satis-tar 
       move gruplar-kur           to gruplog-kur       
       move gruplar-extra-ind     to gruplog-extra-ind   
       move gruplar-skur          to gruplog-skur
       move gruplar-kalanlar-double  to  gruplog-kalanlar-double
       move gruplar-room-kdv-yok  to gruplog-room-kdv-yok
       move gruplar-extra-kdv-yok to gruplog-extra-kdv-yok
       move gruplar-sabit-tarih-kur to gruplog-sabit-tarih-kur
       move gruplar-sabit-kur-tarih to gruplar-sabit-kur-tarih

       write gruplog-rec invalid 
            rewrite gruplog-rec end-rewrite 
       end-write 
        

       close gruplog .
*
 blok-log-kaydet.
       open i-o bloklog
       initialize bloklog-rec
       move xblok-kodu       to bloklog-kodu      
       move xblok-tarih      to bloklog-tarih
       move xblok-konum      to bloklog-konum     
       move xblok-ayrilan-oda to bloklog-ayrilan-oda   
       move xblok-ayrilan-pax to bloklog-ayrilan-pax   
       move xblok-ayrilan-child to bloklog-ayrilan-child 
       move xblok-ayrilan-free  to bloklog-ayrilan-free  
       move xblok-ayrilan-tutar to bloklog-ayrilan-tutar 
       move xblok-satilan-oda   to bloklog-satilan-oda   
       move xblok-satilan-pax   to bloklog-satilan-pax   
       move xblok-satilan-child to bloklog-satilan-child 
       move xblok-satilan-free  to bloklog-satilan-free  
       move xblok-satilan-tutar to bloklog-satilan-tutar 
       move xblok-kalan-oda     to bloklog-kalan-oda     
       move xblok-kalan-pax     to bloklog-kalan-pax
       move xblok-kalan-child   to bloklog-kalan-child
       move xblok-kalan-free    to bloklog-kalan-free
       move xblok-kalan-tutar   to bloklog-kalan-tutar 
       move xblok-durumu        to bloklog-durumu 
       move log-tar               to bloklog-log-tar
       move log-zaman             to bloklog-log-zaman       
          
       write bloklog-rec invalid 
            rewrite bloklog-rec end-rewrite 
       end-write 
       close bloklog   .
*
 Form1-Ta-1-Aft-Tabchg-Display.      
       evaluate Form1-Ta-1-Value
       when 3       
          perform log-grid-baslik-yukle
          perform log-grid-yukle
       end-evaluate.
*
 log-grid-baslik-yukle.
       modify form1-gd-1,reset-grid = 1
                         mass-update = 1
       initialize form1-gd-1-record
       move "Tarih"      to gd-1-col-1
       move "Zaman"      to gd-1-col-2
       move "Staf"       to gd-1-col-3
       move "Durum"      to gd-1-col-4
       modify form1-gd-1,record-to-add(form1-gd-1-record)
      .
*
 log-grid-yukle.
      open input gruplog
      initialize gruplog-rec
      move 1                     to log-grid-adet
      move gruplar-kodu          to gruplog-kodu
      start gruplog key not < gruplog-kodu invalid
           continue 
      not invalid 
      perform with test after until fs-gruplog = "10"
      read gruplog next no lock end move "10"  to fs-gruplog
      not at end 
               if gruplog-kodu <> gruplar-kodu
                   exit perform 
               end-if
               add 1 to log-grid-adet
               initialize form1-gd-1-record
               move gruplog-log-yil       to eyil
               move gruplog-log-ay        to eay
               move gruplog-log-gun       to egun
               move etarih                to gd-1-col-1

               move gruplog-log-saat        to esaat
               move gruplog-log-dak         to edak
               move gruplog-log-saniye      to esaniye
               move ezaman                  to gd-1-col-2

               move gruplog-staf            to gd-1-col-3
               evaluate gruplog-durumu
               when "S"
                   move "Silindi"           to gd-1-col-4
                       modify form1-gd-1(log-grid-adet),
                              row-color = 176        
               when "I"
                   move "Iptal"             to gd-1-col-4
                       modify form1-gd-1(log-grid-adet),
                              row-color = 176        
               end-evaluate
               modify form1-gd-1,
               record-to-add(form1-gd-1-record)

               modify form1-gd-1(log-grid-adet,1),
               hidden-data = gruplog-log-tar

               modify form1-gd-1(log-grid-adet,2),
               hidden-data = gruplog-log-zaman

      end-read 
      end-perform
      end-start
      close gruplog
      modify form1-gd-1,
      mass-update = 0
      .
*
 Form1-Gd-1-Ev-Other.
      evaluate event-type
      when msg-begin-entry
         move event-action-fail to event-action
         initialize link-gruplog
         inquire form1-gd-1(event-data-2,1),
                 hidden-data link-gruplog-tarih
         inquire form1-gd-1(event-data-2,2),
                 hidden-data link-gruplog-zaman
         move gruplar-kodu   to link-gruplog-kodu
              
         call "/asya/ytl/obj/otel/gruplog.asy" 
               using link-gruplog
                on exception 
                perform callerr-proc
                exit paragraph
              not on exception 
                cancel "/asya/ytl/obj/otel/gruplog.asy"
         end-call
              
      end-evaluate
     
     .
*
 mesaj-gonder.
            move grup-no to  link-NOT-DOS-ANAH   
             if link-not-dos-anah not = spaces then
                move "U"     to  link-not-islem
                move "GRU"   to  link-NOT-DOS    
                move 89 to link-nereden 
             string grup-adi
                  " grubuna " delimited by size
                  into link-dosya-aciklamasi
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
                    display not-ac
                    exit paragraph 
             end-if
          .
**
 not-goster.
         initialize toplam-not
          move grup-no to  link-NOT-DOS-ANAH   
       if link-not-dos-anah not = spaces  then
           move "K"     to  link-not-islem
           move "GRU"   to  link-NOT-DOS    
           move 89 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
         end-if
         display not-ac .
*
 Form1-Ta-1-Bef-Tabchg-Display.           
     .
*
 Form1-Ta-1-Ev-Cmd-Tabchanged.
     .
*
 extra-ac.
       initialize konuk-rec grup-extra-folio
       open i-o konuk ozluk
       move "I"  to konuk-durumu
       move grup-no to konuk-grup-no
       start konuk key >= KONUK-GRUP invalid 
             continue
       not invalid
       perform until fs-konuk = "10"
       read konuk next no lock end continue
       not end 
           
           if konuk-durumu  = "I" and konuk-grup-no  = grup-no
              if KONUK-EXTRA-REZ-NO >  0 and konuk-fol-kodu = "E"
                 initialize rez-rec
                 move KONUK-EXTRA-REZ-NO  to rez-no
                 read rez no lock invalid 
                      continue 
                 not invalid 
                     exit perform cycle 
                 end-read 
              end-if

              if konuk-fol-kodu = "E" 
                 move konuk-folio to grup-extra-folio
                 exit perform 
              end-if
           else
              move "10" to fs-konuk
           end-if
           
       end-read
       end-perform
       end-start

       if grup-extra-folio > 0 then 
          initialize dokcagir-tasi
          set dokcagir-tasi-call-folio1      to true
          move grup-extra-folio                   to dokcagir-konuk-folio
          perform dokcagir-call
             
          close konuk ozluk
          exit paragraph
       end-if

       open input odalar
       initialize konuk-rec ozluk-rec bos-odano. 
       if genel-grup-extra-oda-no not = spaces
          if genel-grup-extra-oda-no not = "0000"
             move genel-grup-extra-oda-no to odalar-anah
          end-if
       end-if
       start odalar key > odalar-anah invalid 
             continue
       not invalid
       perform until fs-odalar = "10"
       read odalar next no lock end move "10" to fs-odalar 
       not end
           if odalar-hayali = "H" 
              initialize konuk-rec
              move odalar-anah to konuk-odano 
              move "I" to konuk-durumu
              start konuk key = konuk-oda invalid 
                 if odalar-anah > "9000" and odalar-anah < "9100"
                    continue
                 else
                    move konuk-odano to bos-odano
                    move "10" to fs-odalar
                 end-if
               end-start
            end-if
       end-read
       end-perform 
       end-start
       close odalar
       if bos-odano not = spaces
          continue
       else
          display message box "Bos Hayali Oda bulunamadi "   new-line 
                              "Hayali oda tanimlayip" new-line
                              "Tekrar Deneyiniz......" 
          close konuk ozluk
          exit paragraph
       end-if 
       initialize konuk-rec ozluk-rec. 
       open i-o genelfis. 
       move 1 to genelfis-anahtar. 
       read genelfis no lock invalid 
            initialize genelfis-rec 
            move 1 to genelfis-anahtar
       end-read. 
       add 1 to folio-oto. 
       move folio-oto to konuk-folio ozluk-folio. 
       rewrite genelfis-rec invalid write genelfis-rec. 
       close genelfis. 
        
       read konuk no lock invalid 
            continue
       not invalid
           close konuk ozluk
           exit paragraph
       end-read
       
       read ozluk no lock invalid 
            continue, 
       end-read
       move "I"              to konuk-durumu
       move "E"              to konuk-fol-kodu
       move grup-no          to konuk-grup-no
       move gruplar-adi      to konuk-adi
       move "GRUP MASTER  "  to konuk-soyadi
       move gruplar-firma    to konuk-firma  
       move gruplar-acenta   to konuk-acenta      
       move bos-odano        to konuk-odano
       move gruplar-banka    to konuk-banka       
       move gruplar-doviz    to konuk-doviz       
       move gruplar-pan-tipi to konuk-pan-tipi    
       move gruplar-anlasma  to konuk-anlasma     
       move gruplar-odeme    to konuk-odeme-tipi      
       move gruplar-pazar    to konuk-pazar       
       move gruplar-ulke     to konuk-ulke      
       move gruplar-gel-tar  to konuk-gel-tar.
       move gruplar-git-tar  to konuk-git-tar
       move gruplar-not1     to konuk-acik-1  
       move gruplar-not2     to konuk-acik-2  
       move "I"              to konuk-durumu. 
       move "E"              to konuk-fol-kodu. 
       
       
***********>Gereksiz bilgiler sifirlaniyor........... 
       initialize konuk-rez-no 
       konuk-kisi konuk-voucher   
       konuk-cik-cikma konuk-nor-indirim
       konuk-oda-tutar konuk-extbed-tutar konuk-kahvalti-tutar 
       konuk-ogle-tutar konuk-aksam-tutar konuk-icecek-tutar 
       konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
       konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno . 
       
       open input odalar                            |firat 10/03/2020
       initialize odalar-rec 
       move bos-odano to odalar-anah 
       read odalar no lock invalid
            continue
       end-read 
       move odalar-konumu to konuk-oda-konumu
                             konuk-fiyat-konumu
       close odalar


       write konuk-rec invalid continue
       end-write.
     
        
       write ozluk-rec invalid continue
       end-write.
       close konuk ozluk.
       display message box bos-odano " nolu odaya Extra folio Acildi ....." title "Bilginize ....."
            .    
*
 toplu-degisim.
          initialize secim-toplu-grup
          move gruplar-kodu        to secim-grup-no
          move "G"                 to secim-grup-nereden
          call "/asya/ytl/obj/otel/grupsec.asy" 
                        using  secim-grup-no,secim-grup-nereden 
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/grupsec.asy"
          end-call
      
     .
*
 Form1-Mn-1-MI-KisiDagilimi-Link.
          open input gruplar
          initialize gruplar-rec
          move grup-no  to gruplar-kodu
          read gruplar no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplar 
                 exit paragraph
          end-read 
          close gruplar
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 
        
          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp              to link-ilk-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to link-son-tar
          inquire form1-gd-2(1,st-x),
                  hidden-data in temp

          move temp              to gruplar-adi(99:2)|oda konumu
          move gruplar-rec       to link-rez-grup-rec
          move gruplar-kodu      to link-grup-no 
                                                
          if link-ilk-tar > link-son-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if

          perform acu-form4-routine.
*
 Form4-Aft-Initdata.
      open input konum
      initialize konum-rec
      move gruplar-adi(99:2)    to konum-anahtar
      read konum no lock invalid
          move "Hata"     to konum-adi
          display message box "Konum Secilmedi..."
                          title "Uyari"
                          icon 1
          set exit-pushed to true 
      end-read 
          move konum-adi  to acc-konum-adi

      close konum
      open input blok
      modify form4-gd-1,reset-grid = 1
                        mass-update = 1
      initialize Form4-Gd-1-record
      move "Tarih"     to gd-10-col-1
      move "Single"    to gd-10-col-2
      move "Double"    to gd-10-col-3
      move "Triple"    to gd-10-col-4
      move "Quarter"   to gd-10-col-5
      modify form4-gd-1,record-to-add(form4-gd-1-record)
    
      initialize blok-rec
      move 1               to kayit-sayi
      move xrez-gir-tar    to blok-tarih 
      move grup-no         to blok-kodu
      move gruplar-adi(99:2) to blok-konum
      start blok key not < blok-ANAHTAR invalid 
           continue 
      not invalid 
      perform with test after until fs-blok = "10"
      read blok next no lock end move "10"  to fs-blok
      not at end 
              if blok-tarih >= xrez-cik-tar or
                 blok-kodu not = grup-no   or
                 blok-konum not = gruplar-adi(99:2)
                   exit perform 
              end-if
              
              add 1 to kayit-sayi
              initialize Form4-Gd-1-record
              move blok-yil         to eyil
              move blok-ay          to eay
              move blok-gun         to egun
              move etarih           to gd-10-col-1
              
              move blok-single-oda  to z3
              move z3               to gd-10-col-2

              move blok-double-oda  to z3
              move z3               to gd-10-col-3

              move blok-triple-oda  to z3
              move z3               to gd-10-col-4

              move blok-quarter-oda to z3
              move z3               to gd-10-col-5

              modify form4-gd-1,
                     record-to-add(form4-gd-1-record)
              modify form4-gd-1(kayit-sayi,1),
                     hidden-data blok-anahtar
      end-read 
      end-perform
      end-start
      close blok
      modify form4-gd-1,mass-update = 0
      display acc-1 acc-2 acc-3.
*
 Form4-Ex-Other.
        .
*
 Form4-Gd-1-Ev-Other.
      evaluate event-type
      when msg-finish-entry
         evaluate event-data-1
         when 2         
                initialize top-oda-dagilim  eski-blok-oda
              open i-o blok bloklog xblok
              inquire form4-gd-1(event-data-2,1),
                      hidden-data blok-anahtar 
              move gruplar-adi(99:2)   to blok-konum
              read blok no lock invalid 
                  display message box "Blok Bulunamadi.."
                  close blok bloklog  xblok
                  exit paragraph
              end-read 
              move blok-single-oda to eski-blok-oda
              inquire form4-gd-1(event-data-2,event-data-1)
                      cell-data in blok-single-oda 

              compute top-oda-dagilim = blok-single-oda + blok-double-oda + blok-triple-oda + blok-quarter-oda
              if top-oda-dagilim > blok-ayrilan-oda
                  display message box "Dagilim Ayrilan Oda Sayisindan Buyuk Olamaz..."
                          title "Uyari"
                          icon 1
                      modify form4-gd-1(event-data-2,event-data-1)
                            cell-data  = eski-blok-oda 
                  close blok bloklog xblok
                  exit paragraph                 
              end-if 

              rewrite blok-rec end-rewrite


              initialize xblok-rec
              move blok-anahtar to xblok-anahtar
              read xblok no lock invalid
                 display message box "Blok Bulunamadi.."
                  close blok bloklog xblok
                  exit paragraph
              not invalid 
                  move blok-rec to xblok-rec
                  rewrite xblok-rec end-rewrite 
              end-read

              move blok-rec   to bloklog-rec
              accept bloklog-log-tar from century-date
              accept bloklog-log-zaman from time 
              write bloklog-rec invalid 
                 rewrite bloklog-rec end-rewrite 
              end-write 
              
              close blok bloklog xblok             
         when 3
              initialize top-oda-dagilim  eski-blok-oda
              open i-o blok  bloklog xblok
              inquire form4-gd-1(event-data-2,1),
                      hidden-data blok-anahtar 
              move gruplar-adi(99:2)   to blok-konum
              read blok no lock invalid 
                  display message box "Blok Bulunamadi.."
                  close blok bloklog xblok
                  exit paragraph
              end-read 
                move blok-double-oda to eski-blok-oda


              inquire form4-gd-1(event-data-2,event-data-1)
                      cell-data in blok-double-oda 
              compute top-oda-dagilim = blok-single-oda + blok-double-oda + blok-triple-oda + blok-quarter-oda
              if top-oda-dagilim > blok-ayrilan-oda
                  display message box "Dagilim Ayrilan Oda Sayisindan Buyuk Olamaz..."
                          title "Uyari"
                          icon 1
                      modify form4-gd-1(event-data-2,event-data-1)
                            cell-data  = eski-blok-oda 
                  close blok bloklog  xblok
                  exit paragraph                 
              end-if 
              rewrite blok-rec end-rewrite 

              initialize xblok-rec
              move blok-anahtar to xblok-anahtar
              read xblok no lock invalid
                 display message box "Blok Bulunamadi.."
                  close blok bloklog xblok
                  exit paragraph
              not invalid 
                  move blok-rec to xblok-rec
                  rewrite xblok-rec end-rewrite 
              end-read

              move blok-rec   to bloklog-rec
              accept bloklog-log-tar from century-date
              accept bloklog-log-zaman from time 
              write bloklog-rec invalid 
                 rewrite bloklog-rec end-rewrite 
              end-write 

              close blok bloklog xblok
         when 4
              initialize top-oda-dagilim  eski-blok-oda
              open i-o blok bloklog xblok
              inquire form4-gd-1(event-data-2,1),
                      hidden-data blok-anahtar 
              move gruplar-adi(99:2)   to blok-konum
              read blok no lock invalid 
                  display message box "Blok Bulunamadi.."
                  close blok bloklog  xblok
                  exit paragraph
              end-read 
               move blok-triple-oda to eski-blok-oda
              inquire form4-gd-1(event-data-2,event-data-1)
                      cell-data in blok-triple-oda 
              compute top-oda-dagilim = blok-single-oda + blok-double-oda + blok-triple-oda + blok-quarter-oda
              if top-oda-dagilim > blok-ayrilan-oda
                  display message box "Dagilim Ayrilan Oda Sayisindan Buyuk Olamaz..."
                          title "Uyari"
                          icon 1
                      modify form4-gd-1(event-data-2,event-data-1)
                            cell-data  = eski-blok-oda 
                  close blok bloklog  xblok
                  exit paragraph                 
              end-if 

              rewrite blok-rec end-rewrite 


              initialize xblok-rec
              move blok-anahtar to xblok-anahtar
              read xblok no lock invalid
                 display message box "Blok Bulunamadi.."
                  close blok bloklog xblok
                  exit paragraph
              not invalid 
                  move blok-rec to xblok-rec
                  rewrite xblok-rec end-rewrite 
              end-read

              move blok-rec   to bloklog-rec
              accept bloklog-log-tar from century-date
              accept bloklog-log-zaman from time 
              write bloklog-rec invalid 
                 rewrite bloklog-rec end-rewrite 
              end-write 

              close blok bloklog  xblok
         when 5
              initialize top-oda-dagilim  eski-blok-oda
              open i-o blok bloklog  xblok
              inquire form4-gd-1(event-data-2,1),
                      hidden-data blok-anahtar 
              move gruplar-adi(99:2)   to blok-konum
              read blok no lock invalid 
                  display message box "Blok Bulunamadi.."
                  close blok bloklog xblok
                  exit paragraph
              end-read 
                move blok-quarter-oda to eski-blok-oda
              inquire form4-gd-1(event-data-2,event-data-1)
                      cell-data in blok-quarter-oda 
              compute top-oda-dagilim = blok-single-oda + blok-double-oda + blok-triple-oda + blok-quarter-oda
              if top-oda-dagilim > blok-ayrilan-oda
                  display message box "Dagilim Ayrilan Oda Sayisindan Buyuk Olamaz..."
                          title "Uyari"
                          icon 1
                    modify form4-gd-1(event-data-2,event-data-1)
                            cell-data  = eski-blok-oda 
                  close blok bloklog  xblok
                  exit paragraph                 
              end-if 

              rewrite blok-rec end-rewrite 

              initialize xblok-rec
              move blok-anahtar to xblok-anahtar
              read xblok no lock invalid
                 display message box "Blok Bulunamadi.."
                  close blok bloklog xblok
                  exit paragraph
              not invalid 
                  move blok-rec to xblok-rec
                  rewrite xblok-rec end-rewrite 
              end-read

              move blok-rec   to bloklog-rec
              accept bloklog-log-tar from century-date
              accept bloklog-log-zaman from time 
              write bloklog-rec invalid 
                 rewrite bloklog-rec end-rewrite 
              end-write 
              close blok bloklog xblok
         end-evaluate 
      end-evaluate.
*
 sabit-kur-belirle.
     if sabit-tar-kur = 1
        modify accept-kur-gun,visible = true 
        modify accept-kur-ay,visible = true 
        modify accept-kur-yil,visible = true 
     else 
        initialize kur-sabit-gun kur-sabit-ay kur-sabit-yil
        display accept-kur-gun  accept-kur-ay accept-kur-yil
        modify accept-kur-gun,visible = false 
        modify accept-kur-ay,visible = false 
        modify accept-kur-yil,visible = false 
     end-if.
*
 konum-isaretli-kontrol.
     initialize sutun-1 satir-1 isaretli-konum
     perform varying sutun-1
               from 1
               by 1
               until sutun-1 > 5
                      initialize satir-1 
                      perform varying satir-1
                                from 1
                                by 1
                                until satir-1 > 10
                                   initialize occ-konumlar-occurs(99)
                                   inquire form1-gd-3(satir-1,sutun-1),
                                           hidden-data in occ-konumlar-occurs(99)
                                    
                                   if occ-konum-secildimi(99) = 1
                                      move 1        to isaretli-konum
                                   end-if 
                      end-perform 
     end-perform. 
*
 son-kontrol.
      open i-o takas
      move 0 to son-konum
      initialize takas-rec
         start takas key >= takas-konum invalid continue
            not invalid
              perform until fs-takas = "10"
                 read takas next no lock end move "10" to fs-takas
                  not end
*                  if son-konum = 0 then move takas-konum to son-konum end-if 
                  if takas-konum = son-konum
                    continue
                    else
                     move takas-konum to son-konum
                      move 0 to zaten-var
                      perform varying inx-i
                             from 1
                               by 1
                              until inx-i > apo-5
                          if  gecerli-konum-kod(inx-i)   = son-konum
                               move 1 to zaten-var
                           end-if
                      end-perform 
                      if zaten-var = 0 
                        
                          if  occ-konum-secildimi(son-konum)  = 0 then
                         close takas                              
**                            display message box son-konum  konumy(son-konum)  konumx(son-konum)
                              display message box "Grup Konumlari Disinda Satis Yapildi..." new-line
                                                  son-konum " 'Nolu Konum isaretlenecektir."
                                              title "Uyari"
                                              icon 1
                             move konumy(son-konum) to event-data-2
                           move konumx(son-konum) to event-data-1
                           move Msg-Bitmap-Clicked to event-type
                           perform  Form1-Gd-3-Ev-Other
                         open input takas
                          
                        initialize takas-rec  event-data-2 event-data-1  event-type
                         move son-konum to takas-konum
                         start takas key >= takas-konum invalid move "10" to fs-takas
                         end-start
                         else
                           display message box "Satis yapilmis konum isaretlenemedi Hata 2566663333 "
                      end-if
                      end-if
                   end-if
              end-read    
              end-perform 
         end-start
        
         close takas.
*
 dis-veri-al.
         initialize link-gruplar-rec
         move gruplar-rec        to link-gruplar-rec     
         call "/asya/ytl/obj/otel/rezxls.asy" 
                       using  link-gruplar-rec
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/rezxls.asy"
         end-call
          call "w$keybuf" using 3 end-call.
*
 Form3-Pb-2-Link.
     open i-o cast  konuk
     initialize cast-rec
     start cast key not < cast-anah invalid 
          continue 
     not invalid 
     perform until fs-cast = "10"
     read cast next no lock end move "10" to fs-cast
     not at end 
               if cast-grup = 105093
                  move 0 to cast-grup
                  rewrite cast-rec end-rewrite 
                  
                  initialize rez-rec
                  move cast-rez-no  to rez-no
                  read rez no lock invalid 
                       continue 
                  not invalid 
                       if rez-grup-no = 105093
                           move  0 to rez-grup-no

                           accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                           accept rez-edit-zaman from time          |                           

                           rewrite rez-rec end-rewrite 
                       end-if 
                  end-read 

                  initialize konuk-rec 
                  move rez-folio to konuk-folio
                  read konuk no lock invalid
                      continue 
                  not invalid 
                      if konuk-grup-no = 105093
                          move 0 to konuk-grup-no
                          rewrite konuk-rec end-rewrite 
                      end-if 
                  end-read 
               end-if 
     end-read 
     end-perform
     end-start
     close cast  konuk
     .

 
