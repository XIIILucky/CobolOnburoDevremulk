* fiyatgir.evt
* fiyatgir.evt is generated from D:\asya\acugt.ytl\otel\fiyatgir.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Goto-Cell
        EVALUATE Event-Control-Id
        WHEN 56
           PERFORM h-kaydir2
        WHEN 31
           PERFORM grid-kaydir
        END-EVALUATE
     WHEN Msg-Goto-Cell-Drag
        EVALUATE Event-Control-Id
        WHEN 56
           PERFORM h-kaydir2
        WHEN 31
           PERFORM grid-kaydir
        END-EVALUATE
     WHEN Msg-Goto-Cell-Mouse
        EVALUATE Event-Control-Id
        WHEN 56
           PERFORM h-kaydir2
        WHEN 31
           PERFORM grid-kaydir
        END-EVALUATE
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 56
           PERFORM Form1-Gd-11-Ev-Other
        WHEN 31
           PERFORM Form1-Gd-1-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 tr-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Tv-Selchange
        PERFORM tr-degisti
     END-EVALUATE
     .

 cb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM cb-1-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-1a-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM cb-1a-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Pb-3-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM refreshle
        WHEN Cmd-Goto
           PERFORM refreshle
        END-EVALUATE
     END-IF
     .

 Form2-Event-Proc.
     .

 form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 acc-anlasmaa-Exception-Proc.
     PERFORM acc-anlasmaa-Ex-Other
     .

 cb-1b-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM cb-1b-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-1aa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Pb-1a-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM form4-ok-prc
     END-EVALUATE
     .

 form4-Cb-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM check-after
     END-EVALUATE
     .

 form5-Event-Proc.
     .

 Form2-Ef-1aaaba-Exception-Proc.
     PERFORM f-acenara
     .

 Form2-Pb-1a-Exception-Proc.
     PERFORM suzme-tamam-click
     .

 Form7-Event-Proc.
     .

 Form7-Exception-Proc.
     PERFORM Form7-Ex-Other
     .
***   start event editor code   ***
*
 acc-acenta-Aft-Procedure.
     initialize gec-gecme.
     open input acenta 
     read acenta no lock invalid
          move 1 to gec-gecme
          move "Tanimsiz ..."   to acenta-adi
     end-read
     display lb-acenta-adi.
     close acenta.
      if ONKPARA-REFERANS-VAR = 1 
                perform refli-konum
      end-if  .
*
 Aft-form1.

      if K-KODU-TASI not = "MAMI" then 
              CALL "W$MENU" USING WMENU-delete, 
                   Menu-Handle, 1006 
              CALL "W$MENU" USING WMENU-delete, 
                   Menu-Handle, 1005 
              CALL "W$MENU" USING WMENU-delete, 
                   Menu-Handle, 1006 
      end-if
         .
*
 
*
 Form1-Bef-Create.
     move 1 to dis-1.
     move 0 to dis-2.
     perform adresleri-tasi.
     move tarih-tasi     to bas-tarih bit-tarih.
     open input genel
     move 1 to genel-anahtar
     read genel no lock
       invalid
         continue
     end-read
     close genel
     open i-o kllnc
     call "c$narg" using link-var.
        
     if link-var > 0 then 
     if link-var   > 1
     if lFIYATANA-ANAH(1:1) = high-values then
         move "2" to lFIYATANA-ANAH(24:1) 
         call "/asya/ytl/obj/otel/grupfiy.asy" using lFIYATANA-ANAH(2:)
                 on exception perform callerr-proc
                 not on exception
            cancel "/asya/ytl/obj/otel/grupfiy.asy" 
         set exit-pushed to true
     end-if
     end-if
         move gelen-acenta to filtre-acenta
     end-if
               move k-kodu-tasi to k-kodu
               read kllnc no lock invalid continue
                  not invalid 
                    if k-tfiyat-bas-tar < "19000000"
                          move "20050101" to k-tfiyat-bas-tar
                     end-if
                     if k-tfiyat-bit-tar < "19000000"
                          move "20151231" to k-tfiyat-bit-tar
                     end-if
                     
                  end-read 
                  close kllnc.
     
 accept-0103-Aft-Procedure.
     initialize gec-gecme.
     open input takvim.
     move bas-tarih       to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
*
 accept-0106-Aft-Procedure.
     
     initialize gec-gecme  dis4-1.
     open input takvim.
     move bit-tarih       to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
     if bas-tarih > bit-tarih
        move 1 to gec-gecme
     end-if.
     .

 accept-0106-Aft-Procedure1.
     
     initialize gec-gecme  dis4-1.
     open input takvim.
     move bit-tarih       to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
     if bas-tarih > bit-tarih
        move 1 to gec-gecme
     end-if.
     if gec-gecme not = 1 then
          if hid(1:1) = "P" then          
               if hid(02:04) = acenta-kodu and
                  hid(06:08) = bas-tarih and
                  hid(14:08) = bit-tarih  then 
                          move 0 to dis4-1
                          display message box "Ayni periyoda kopyalayamazsiniz"
                   else
                        move 2 to  fiy-eh 
                        move 0 to kabul
                        
                        perform periyod-fiyatlari-bul
                     if fiy-eh = 1 then 
                         move 0 to dis4-1  
                         else
                         move 1 to dis4-1
                     end-if 
                    end-if    
                       else                  
                          move 0 to dis4-1
                         end-if
             
                   
           
           
           
     end-if

     display Form1-Pb-1a

     .
*
 acc-pan-kodu-Aft-Procedure.
     initialize gec-gecme.
     open input kodlar02.
     move "A" to kodlar02-tipi
     move acc-pan-kodu-value   to kodlar02-kodu
     read kodlar02 no lock invalid
          move 1 to gec-gecme
          move "Tanimsiz ..."  to kodlar02-adi
     end-read
     close kodlar02.
     display lb-pan-adi.
*
 acc-pan-kodu-Aft-Procedure1.
     initialize gec-gecme.
     open input kodlar02.
     move "A" to kodlar02-tipi
     move acc-pan-kodu-value   to kodlar02-kodu
     read kodlar02 no lock invalid
          move 1 to gec-gecme
          move "Tanimsiz ..."  to kodlar02-adi
     end-read
     close kodlar02.
     display lb-pan-adia.
*
 acc-rez-tipi-Aft-Procedure.
     initialize gec-gecme
     evaluate acc-rez-tipi-value
        when 1  move "Alotment"      to lb-rez-tipi-value
        when 2  move "It      "      to lb-rez-tipi-value
        when 3  move "Fit     "      to lb-rez-tipi-value
        when 4  move "Group   "      to lb-rez-tipi-value
        when 5  move "Munferit"      to lb-rez-tipi-value
        when 6  move "Walk-in "      to lb-rez-tipi-value
        when 7  move "Sirket  "      to lb-rez-tipi-value
        when 8  move "Ozel    "      to lb-rez-tipi-value
        when other  move "Tanimsiz"  to lb-rez-tipi-value
             move 1 to gec-gecme
     end-evaluate.
     display lb-rez-tipi.
*
 acc-rez-tipi-Aft-Procedure1.
     initialize gec-gecme
     evaluate acc-rez-tipi-value
        when 1  move "Alotment"      to lb-rez-tipi-value
        when 2  move "It      "      to lb-rez-tipi-value
        when 3  move "Fit     "      to lb-rez-tipi-value
        when 4  move "Group   "      to lb-rez-tipi-value
        when 5  move "Munferit"      to lb-rez-tipi-value
        when 6  move "Walk-in "      to lb-rez-tipi-value
        when 7  move "Sirket  "      to lb-rez-tipi-value
        when 8  move "Ozel    "      to lb-rez-tipi-value
        when other  move "Tanimsiz"  to lb-rez-tipi-value
             move 1 to gec-gecme
     end-evaluate.
     display lb-rez-tipia.
*
 acc-banka-kodu-Aft-Procedure.
     initialize gec-gecme.
     open input banka.
     read banka no lock invalid
          move "Tanimsiz ..." to banka-adi
          move 1 to gec-gecme
     end-read
     close banka.
     display lb-banka-adi.
*
 acc-banka-kodu-Aft-Procedure1.
     initialize gec-gecme.
     open input banka.
     read banka no lock invalid
          move "Tanimsiz ..." to banka-adi
          move 1 to gec-gecme
     end-read
     close banka.
     display lb-banka-adia.
*
 acc-doviz-kodu-Aft-Procedure.
     initialize gec-gecme.
     open input doviz.
     read doviz no lock invalid
          move "Tanimsiz ..." to d-adi-1
          move 1 to gec-gecme
     end-read
     close doviz.
     display lb-doviz-adi.
*
 acc-doviz-kodu-Aft-Procedure1.
     initialize gec-gecme.
     open input doviz.
     read doviz no lock invalid
          move "Tanimsiz ..." to d-adi-1
          move 1 to gec-gecme
     end-read
     close doviz.
     display lb-doviz-adia.
*
 acc-anlasma-Aft-Procedure.
     initialize gec-gecme.
     open input kodlar02
     move acc-anlasma-kodu-value    to kodlar02-kodu kodlar02-adi
     move "D"                 to kodlar02-tipi
     read kodlar02 no lock invalid
        
          move kodlar02-kodu   to kodlar02-adi(1:)
          move "-Tanimsiz ..." to kodlar02-adi(4:)
          move 1 to gec-gecme
     end-read.
     close kodlar02.
     display lb-anlasma-adi.
*
 acc-anlasma-Aft-Procedure1.
     if coklu-secim-var = 1
        exit paragraph 
     end-if 
     initialize gec-gecme.
     open input kodlar02
     move acc-anlasma-kodu-value    to kodlar02-kodu   kodlar02-adi
     move "D"                 to kodlar02-tipi
     read kodlar02 no lock invalid
          move "-Tanimsiz ..." to kodlar02-adi(4:)
          move 1 to gec-gecme
     end-read.
     close kodlar02.
     display lb-anlasma-adia
      
           if gec-gecme not = 1 then
                        move 2 to  fiy-eh 
                        move 0 to kabul
                       
                        perform anlasma-fiyatlari-bul
                       
                     if fiy-eh = 1 then 
                         move 0 to dis4-1  
                         else
                         move 1 to dis4-1
                     end-if 
                     
                       else                  
                          move 0 to dis4-1
      end-if
      display Form1-Pb-1a

     
     
     .
*
 Form1-Aft-Initdata.
     open i-o carpan close carpan
     modify form1-gd-1,
            reset-grid = 1 
            mass-update = 1 
     modify form1-gd-11,
            reset-grid = 1 
            mass-update = 1 
     if link-var > 1 then 
     if lFIYATANA-ANAH(1:1) = high-values then
        exit paragraph
     end-if
     end-if

     initialize form1-gd-1-record 
     move "Minumum Pax" to  gd-1-col-1
     modify form1-gd-11,
            record-to-add(form1-gd-1-record)
     move "PP Fiyat" to  gd-1-col-1
     modify form1-gd-11,
            record-to-add(form1-gd-1-record)     
     initialize form1-gd-1-record   
     move "Kisi/Konum"             to gd-1-col-1

     open input konum kategori
     initialize kodlar02-rec konum-rec
     move 1 to i 
     start konum key not < konum-anahtar invalid
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
             
          evaluate konum-anahtar
             when 1  move konum-adi   to gd-1-col-2     gd-11-col-2    
             when 2  move konum-adi   to gd-1-col-3     gd-11-col-3    
             when 3  move konum-adi   to gd-1-col-4     gd-11-col-4    
             when 4  move konum-adi   to gd-1-col-5     gd-11-col-5    
             when 5  move konum-adi   to gd-1-col-6     gd-11-col-6    
             when 6  move konum-adi   to gd-1-col-7     gd-11-col-7    
             when 7  move konum-adi   to gd-1-col-8     gd-11-col-8    
             when 8  move konum-adi   to gd-1-col-9     gd-11-col-9    
             when 9  move konum-adi   to gd-1-col-10    gd-11-col-10   
             when 10 move konum-adi   to gd-1-col-11    gd-11-col-11   
             when 11 move konum-adi   to gd-1-col-12    gd-11-col-12   
             when 12 move konum-adi   to gd-1-col-13    gd-11-col-13   
             when 13 move konum-adi   to gd-1-col-14    gd-11-col-14   
             when 14 move konum-adi   to gd-1-col-15    gd-11-col-15   
             when 15 move konum-adi   to gd-1-col-16    gd-11-col-16   
             when 16 move konum-adi   to gd-1-col-17    gd-11-col-17   
             when 17 move konum-adi   to gd-1-col-18    gd-11-col-18   
             when 18 move konum-adi   to gd-1-col-19    gd-11-col-19   
             when 19 move konum-adi   to gd-1-col-20    gd-11-col-20   
             when 20 move konum-adi   to gd-1-col-21    gd-11-col-21   
             when 21 move konum-adi   to gd-1-col-22    gd-11-col-22                 
             when 22 move konum-adi   to gd-1-col-23    gd-11-col-23   
             when 23 move konum-adi   to gd-1-col-24    gd-11-col-24   
             when 24 move konum-adi   to gd-1-col-25    gd-11-col-25   
             when 25 move konum-adi   to gd-1-col-26    gd-11-col-26   
             when 26 move konum-adi   to gd-1-col-27    gd-11-col-27   
             when 27 move konum-adi   to gd-1-col-28    gd-11-col-28   
             when 28 move konum-adi   to gd-1-col-29    gd-11-col-29   
             when 29 move konum-adi   to gd-1-col-30    gd-11-col-30   
             when 30 move konum-adi   to gd-1-col-31    gd-11-col-31   
             when 31 move konum-adi   to gd-1-col-32    gd-11-col-32
                
             when 32 move konum-adi   to gd-1-col-33    gd-11-col-33 
              
             when 33 move konum-adi   to gd-1-col-34    gd-11-col-34 
               
             when 34 move konum-adi   to gd-1-col-35    gd-11-col-35
            
             when 35 move konum-adi   to gd-1-col-36    gd-11-col-36 
            
             when 36 move konum-adi   to gd-1-col-37    gd-11-col-37 
           
             when 37 move konum-adi   to gd-1-col-38    gd-11-col-38  
               
             when 38 move konum-adi   to gd-1-col-39    gd-11-col-39
               
             when 39 move konum-adi   to gd-1-col-40    gd-11-col-40 
             
             when 40 move konum-adi   to gd-1-col-41    gd-11-col-41   
          end-evaluate
         move konum-adi to gd-4-col-1
     end-read
        end-perform
     end-start.

     perform varying i from 31 by 1 until i > 39
           initialize konum-rec 
           move i to konum-anahtar
           read konum no lock invalid
             evaluate konum-anahtar
              when 31 move konum-adi   to gd-1-col-32    gd-11-col-32
                 if konum-adi = spaces then
                       move  gd-1-col-2 to  gd-11-col-32  gd-1-col-32 
                       move "HS" to   gd-11-col-32(4:4) gd-1-col-32(4:4) 
                 end-if
             when 32 move konum-adi   to gd-1-col-33    gd-11-col-33 
              if konum-adi = spaces then 
                       move gd-1-col-3 to  gd-11-col-33    gd-1-col-33 
                       move "HS   " to   gd-11-col-33(4:4)    gd-1-col-33(4:4)
                 end-if
             when 33 move konum-adi   to gd-1-col-34    gd-11-col-34 
                  if konum-adi = spaces then 
                       move gd-1-col-4 to  gd-11-col-34   gd-1-col-34 
                       move "HS   " to gd-11-col-34(4:4)    gd-1-col-34(4:4)
                 end-if
             when 34 move konum-adi   to gd-1-col-35    gd-11-col-35
              if konum-adi = spaces then 
                       move gd-1-col-5 to  gd-11-col-35    gd-1-col-35  
                       move "HS   " to  gd-11-col-35(4:4)   gd-1-col-35(4:4)
                 end-if
             when 35 move konum-adi   to gd-1-col-36    gd-11-col-36 
              if konum-adi = spaces then 
                       move gd-1-col-6 to  gd-11-col-36     gd-1-col-36  
                       move "HS   " to  gd-11-col-36(4:4)   gd-1-col-36(4:4)
                 end-if
             when 36 move konum-adi   to gd-1-col-37    gd-11-col-37 
              if konum-adi = spaces then 
                       move gd-1-col-7 to  gd-11-col-37    gd-1-col-37  
                       move "HS   " to   gd-11-col-37(7:4) gd-1-col-37(7:4)
                 end-if
             when 37 move konum-adi   to gd-1-col-38    gd-11-col-38  
                 if konum-adi = spaces then 
                       move gd-1-col-8 to  gd-11-col-38    gd-1-col-38 
                       move "HS   " to   gd-11-col-38(7:4) gd-1-col-38(7:4)
                 end-if
             when 38 move konum-adi   to gd-1-col-39    gd-11-col-39
                 if konum-adi = spaces then 
                       move gd-1-col-9 to  gd-11-col-39    gd-1-col-39 
                       move "HS   " to  gd-11-col-39(7:4) gd-1-col-39(7:4)
                 end-if
             when 39 move konum-adi   to gd-1-col-40    gd-11-col-40 
                if konum-adi = spaces then 
                       move gd-1-col-10 to  gd-11-col-40   gd-1-col-40 
                       move "HS   " to   gd-11-col-40(7:4)  gd-1-col-40(7:4)
                 end-if
             end-evaluate

           end-read 

     end-perform 
     
     
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
     modify form1-gd-11,
            record-to-add(form1-gd-11-record)
     
     initialize kategori-rec i son-i
     move 1 to son-i i
     start kategori key not < kategori-anah invalid
           continue
     not invalid
     initialize fs-kategori
     perform with test after until fs-kategori = "10"
     read kategori next no lock end move "10" to fs-kategori
     not at end
          add 1 to i son-i
          initialize form1-gd-1-record
          move kategori-buyuk     to gd-1-col-1     cell1-buyuk
          move "+"                to gd-1-col-1(3:)
          move kategori-kucuk     to gd-1-col-1(4:) cell1-kucuk
          move "-"                to gd-1-col-1(6:)
          move kategori-adi       to gd-1-col-1(7:)
          modify form1-gd-1,
                 record-to-add(form1-gd-1-record)
          modify form1-gd-1,
                 y = i
                 x = 1 
                 hidden-data = cell1-hidden
     end-read
     end-perform
     end-start.
     close konum kategori.
     modify form1-gd-1,
            mass-update = 0.
     modify form1-gd-11,
            mass-update = 0.
   
      if link-var > 0 then       
        perform tree-refresh
      end-if  . 
       if link-var = 2 
           modify tr ENSURE-VISIBLE = yer-po
                      value = yer-po
       end-if
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 tree-doldur.
     open input acenta kodlar02
     initialize  fiyatana-rec
      move filtre-acenta to fiyatana-acenta
     open input  fiyatana
     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
                     
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                     not end
                         if filtre-acenta not = spaces and filtre-acenta not = fiyatana-acenta then
                           move "10" to fs-fiyatana
                           exit perform 
                         end-if
                         if (filtre-acenta = spaces or filtre-acenta = fiyatana-acenta )
                           and (k-tfiyat-bas-tar <= fiyatana-son-tarih and 
                               k-tfiyat-bit-tar >= fiyatana-ilk-tarih ) then
                          if fiyatana-acenta not =  acenta-kodu then
                            perform acenta-ekle 
                          end-if
                          if fiyatana-per-anah not = son-per
                           perform peryod-ekle
                          end-if  
                          if fiyatana-diger-anah not = son-dig
                           perform diger-ekle
                          end-if
                          end-if
             
                  end-read
            end-perform
      end-start
    close acenta fiyatana kodlar02.
     
     modify tr, item = per-po, next-item = tvni-root giving ace-po
     if filtre-acenta not = spaces then 
     modify tr, item = ace-po, expand = TVFLAG-EXPAND 
     end-if
     modify tr,  value = ace-po  

        .
 peryod-ekle.
             perform beklet
             initialize son-dig
             move fiyatana-ilk-gun to per-bas-gun
             move fiyatana-ilk-ay to per-bas-ay
             move fiyatana-son-gun to per-bit-gun
             move fiyatana-son-ay to per-bit-ay
             move fiyatana-per-anah to son-per
             modify tr, parent = ace-po, PLACEMENT = TVPLACE-last item-to-add = per-ack  giving per-po hidden-data = hid-per,  has-children = 1
        .
 tr-degisti.
          perform kullandi.
         move event-data-2 to dig-po
         modify tr, item = event-data-2
         inquire tr, hidden-data in hid
         evaluate hid(1:1) 
                 when "A" 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1000, W-Enabled, "Acenta Fiyat Kopyala", 1000       
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1001, W-DISABLED, "Periyot Fiyat Kopyala", 1001 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1002, W-DISABLED, "Anlasma Fiyat Kopyala", 1002 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1004, W-DISABLED, "Anlasma Tum Periyodlar Kopyala", 1004 
                  when "P"
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1000, W-disabled, "Acenta Fiyat Kopyala", 1000       
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1001, W-enabled, "Periyot Fiyat Kopyala", 1001 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1002, W-DISABLED, "Anlasma Fiyat Kopyala", 1002 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1004, W-DISABLED, "Anlasma Tum Periyodlar Kopyala", 1004 
                  when "D"
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1000, W-Disabled, "Acenta Fiyat Kopyala", 1000       
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1001, W-DISABLED, "Periyot Fiyat Kopyala", 1001 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1002, W-enabled, "Anlasma Fiyat Kopyala", 1002 
                       CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1004, W-enabled, "Anlasma Tum Periyodlar Kopyala", 1004 
                     perform diger-goster
        end-evaluate.
      .
 diger-goster.
 
       move hid(02:4) to acenta-kodu
       inspect acenta-kodu converting x"DD737E74" to x"A69A9899" |амнж
       move hid(06:4) to bas-yil
       move hid(10:2) to bas-ay
       move hid(12:2) to bas-gun
       move hid(14:4) to bit-yil
       move hid(18:2) to bit-ay
       move hid(20:2) to bit-gun
       move hid(22:1) to acc-rez-tipi-value
       move hid(23:2) to acc-pan-kodu-value
       move hid(25:2) to banka-kodu
       move hid(27:2) to doviz-kodu
       move hid(29:2) to acc-anlasma-kodu-value
        perform grid-bosalt
    
        move 2001 to  key-status
        perform Form1-Ex-Other.
        .
 diger-ekle.
               perform beklet
             move fiyatana-rez-tipi to dig-rez
             move fiyatana-pan-tipi to dig-pan
             move fiyatana-banka    to dig-ban
             move fiyatana-doviz    to dig-dov
             
             move fiyatana-anlasma    to kodlar02-kodu
             move "D"                 to kodlar02-tipi
             read kodlar02 no lock invalid
                  move "Tanimsiz ..." to kodlar02-adi
                  move 1 to gec-gecme
             end-read.
             move kodlar02-adi  to dig-anl
             move fiyatana-diger-anah to son-dig
             
              modify tr, parent = per-po, item-to-add = dig-ack  
              giving dig-po hidden-data = hid-dig has-children = 0
              modify tr, item = per-po, expand = tvflag-expand 
               if  link-var = 2 
                 if fiyatana-diger-anah = lfiyatana-diger-anah 
                 
                 move dig-po to yer-po
               end-if
              end-if
          .
*
 acenta-ekle.
           move fiyatana-acenta to acenta-kodu  son-ace
           perform beklet
           initialize son-per son-dig
           string "Sayin " delimited by size
                  k-adi delimited by "    "
                  " " delimited by size
                  k-soyadi delimited by "      "
                  into acikla
           read acenta no lock invalid
                continue
                    display  message box acikla new-line 
                    "Fiyat anlasmasi olan acenta silinmis" H"0A" "Acenta kodu: " acenta-kodu  new-line new-line
                    "Lutfen Acentayi kaydedip tanimli fiyatlari silip daha sonra siliniz" new-line
                    

                    icon 2 type 1
                    title "DIKKAT"
              not invalid
                   modify tr, parent = 0 PLACEMENT = TVPLACE-SORT
                   item-to-add = acenta-adi giving ace-po hidden-data = hid-ace   has-children = 1
            end-read        
        .
 Form4-Ex-Other.
     evaluate key-status
          when 4789
              initialize link-arama-turu link-arananlar-donus  
              move 01                 to link-arama-turu               
              call "/asya/ytl/obj/otel/cokluara.asy" 
                     using link-arama-turu link-arananlar-donus   
                     on exception 
                     perform callerr-proc
                     exit paragraph
                     not on exception 
               cancel "/asya/ytl/obj/otel/cokluara.asy"
               end-call
                   
               move 0         to coklu-secim-var ip
               perform varying ip 
                       from 1 
                       by 1 
                       until ip > 500
                          if link-arananlar(ip) = spaces 
                             exit perform 
                          end-if
                          if link-arananlar(ip) = kaynak-acenta
                              exit perform cycle
                          end-if 
                     move 1         to coklu-secim-var                                         
               end-perform
               if coklu-secim-var = 1
                   modify acc-acentaa,enabled = false
                   modify Form1-Pb-1a , enabled = true
               end-if 
          when 1
             evaluate control-id
          when 16
               initialize link-pan-cagir
               move "D" to link-pan-tipi
               call "/asya/ytl/obj/otel/infoxara.asy" using 
                    link-pan-cagir
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy"
                        if link-pansiyon <> spaces
                           move link-pansiyon to acc-anlasma-kodu-value
                           display acc-anlasmaa
                        end-if
               end-call
          when 4
               initialize link-acenta
               call "/asya/ytl/obj/otel/acenara.asy" using 
                    link-acenta
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy"
                        if link-acenta <> spaces
                           move link-acenta to acenta-kodu
                           display acc-acentaa
                        end-if
               end-call
          when 20
               initialize link-pan-cagir
               call "/asya/ytl/obj/otel/panara.asy" using 
                    link-pan-cagir
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/panara.asy"
                        if link-pansiyon <> spaces
                           move link-pansiyon to acc-pan-kodu-value
                           display acc-pan-kodua
                        end-if
               end-call
          when 26
               initialize link-banka
               call "/asya/ytl/obj/otel/bankaara.asy" using
                    link-banka
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy"
                        if link-banka <> spaces
                           move link-banka to banka-kodu
                           display acc-banka-kodua
                        end-if
               end-call
          when 28
               initialize link-doviz
               call "/asya/ytl/obj/otel/dovizara.asy" using
                    link-doviz
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy"
                        if link-doviz <> spaces
                           move link-doviz to doviz-kodu
                           display acc-doviz-kodua
                        end-if
               end-call
           end-evaluate
     end-evaluate.
*
    
*
 acenta-bakim.
        open i-o acenta
        read acenta no lock invalid  close acenta
        display message box "Bakim yapilamaz"
        end-read
         move 0 to acenta-pasif 
           rewrite acenta-rec invalid continue
           end-rewrite
    
       open i-o fiyat fiyatana aksiyon aksiyon2  takvim  aksiyhrk
    
       
            
       initialize fiyat-rec
       move acenta-kodu to fiyat-acenta
            
 
        start fiyat key not < fiyat-anah invalid 
              continue
           not invalid
           perform until fs-fiyat = "10"
                  read fiyat next no lock end 
                         move "10" to fs-fiyat
                      not at end
                        if fiyat-acenta = acenta-kodu
                            perform fiyat-sil
                         else
                            move "10" to fs-fiyat
                       end-if
                   end-read
          end-perform
      end-start
         initialize fiyat-rec fiyatana-rec 
       move acenta-kodu to fiyatana-acenta

    
        start fiyatana key not < fiyatana-anah invalid 
              continue
        not invalid
        perform until fs-fiyatana = "10"
        read fiyatana next no lock end 
        move "10" to fs-fiyatana
        not at end
            
            if fiyatana-acenta = acenta-kodu
              if fiyatana-buyuk not > 0 and FIYATANA-kucuk not > 0 then 
                 delete fiyatana invalid stop " " end-delete
                 perform log-operation-fiyatana          ||| firat 19-10-2019
              else
                 perform fiyat-yaz
              end-if
            else
                move "10" to fs-fiyatana
            end-if
      end-read
      end-perform
      end-start
      perform varying ig from 1 by 1 until ig > 6 
             evaluate ig 
                   when 1   move "A" to atipi
                   when 2   move "B" to atipi 
                   when 3   move "S" to atipi                  
                   when 4   move "K" to atipi 
                   when 5   move "O" to atipi 
                   when 6   move "P" to atipi 
                    
               end-evaluate
           initialize aksiyhrk-rec
          move atipi       to aksiyhrk-tipi
          move acenta-kodu to aksiyhrk-acenta

        start aksiyhrk key >= aksiyhrk-anah
         invalid continue
         not invalid 
           perform until fs-aksiyhrk = "10" 
              read aksiyhrk next no lock end move "10" to fs-aksiyhrk
              not end
                if aksiyhrk-acenta = acenta-kodu and aksiyhrk-tipi = atipi then 
                   delete aksiyhrk invalid stop " "  end-delete
                  else
                   move "10" to fs-aksiyhrk
                   exit perform cycle
                 end-if
             end-read
           end-perform
         end-start


         initialize aksiyon-rec
          move atipi       to aksiyon-tipi
          move acenta-kodu to aksiyon-acenta

       start aksiyon key >= aksiyon-anah
         invalid continue
         not invalid 
           perform until fs-aksiyon = "10" 
              read aksiyon next no lock end move "10" to fs-aksiyon
              not end
                if aksiyon-acenta = acenta-kodu and aksiyon-tipi = atipi then 
                  continue
                  else
                   move "10" to fs-aksiyon
                   exit perform cycle
                 end-if
         initialize aksiyon2-rec 
          move aksiyon-anah to aksiyon2-anah
          read aksiyon2 no lock invalid continue
          end-read

        initialize takvim-rec
       move aksiyon-g-tarih   to takvim-anah
       start takvim key not < takvim-anah invalid
              continue
         not invalid
               move zeroes to fs-takvim
          perform with test after until fs-takvim = "10"
           read takvim next no lock end move "10" to fs-takvim
           not at end
               if takvim-anah > aksiyon-c-tarih
                  move "10" to fs-takvim
                  exit perform cycle
               end-if

           move aksiyon-tipi     to aksiyhrk-tipi
           move aksiyon-acenta   to aksiyhrk-acenta
           move aksiyon-bos to aksiyhrk-bos
           move aksiyon-pan-tipi to aksiyhrk-pan-tipi
           move aksiyon-hes-tipi to aksiyhrk-hes-tipi
           move aksiyon-ekle     to aksiyhrk-ekle
           move takvim-anah      to aksiyhrk-tarih
           move aksiyon-gecele   to aksiyhrk-gecele
           move aksiyon-ebharic to aksiyhrk-ebharic
            move aksiyon-hafta-gunleri to  aksiyhrk-hafta-gunleri
           move aksiyon-k-bazli to aksiyhrk-k-bazli
           move AKSIYon-BOS to AKSIYHRK-BOS

           COMPUTE   aksiyhrk-ode ROUNDED =  aksiyon-ode + ( aksiyon-ode-kusur / 100 )
          
           if aksiyon-ode-yuz > 0 and aksiyon-ode-yuz < 99
             continue
             else
             move 0 to  aksiyon-ode-yuz
          end-if
           move  aksiyon-ode-yuz to aksiyhrk-ode-yuz of aksiyhrk-rec
           compute aksiyhrk-ode-yeni of aksiyhrk-rec rounded = aksiyhrk-ode of aksiyhrk-rec +    
                          ( aksiyhrk-ode-yuz of aksiyhrk-rec * 100 )



           move aksiyon-sondan   to aksiyhrk-sondan 
           if aksiyon-tipi = "S"
              initialize aksiyhrk-gecele aksiyhrk-ode 
           end-if 
           move aksiyon-ebharic to aksiyhrk-ebharic
            move aksiyon-hafta-gunleri to  aksiyhrk-hafta-gunleri
            move aksiyon-k-bazli to aksiyhrk-k-bazli
            move  AKSIYON2-rezal-tar1 to AKSIYhrk-rezal-tar1
                move  AKSIYON2-rezal-tar2 to AKSIYhrk-rezal-tar2

             move AKSIYON-G-TARIH to aksiyhrk-bas-tar of aksiyhrk-rec
            move AKSIYON-C-TARIH to aksiyhrk-bit-tar of aksiyhrk-rec
            move aksiyon-konumlar to aksiyhrk-konumlar of aksiyhrk-rec
            move aksiyon-min-gece to aksiyhrk-minimum of aksiyhrk-rec
            move aksiyon-max-gece to aksiyhrk-maximum of aksiyhrk-rec
             move aksiyon-parca-uygula to aksiyhrk-parca-uygula
            move aksiyon-so-yuzde-hes to aksiyhrk-so-yuzde-hes
              move aksiyon-ug-uygulama to aksiyhrk-ug-uygulama  of aksiyhrk-rec
              move aksiyon-oto-bil-dus to aksiyhrk-oto-bil-dus
           write aksiyhrk-rec invalid 
                 rewrite aksiyhrk-rec
                end-rewrite continue
           end-write
           end-read
*               modify Form1-Gd-1, record-to-add (form1-gd-1-record)
          end-perform




         end-start
         end-read

         end-perform
         end-start
         end-perform
            display message box "Bakim Tamamlandi Acenta Kullanima Alindi"
             close aksiyon aksiyon2 aksiyhrk.
          close fiyat fiyatana  takvim.
         move 0 to acenta-pasif 
           rewrite acenta-rec invalid continue
           end-rewrite.
           close acenta .




 fiyat-sil.
        move fiyat-acenta    to fiyatana-acenta. 
             move fiyat-bas-tarih to fiyatana-ilk-tarih.
             move fiyat-bit-tarih to fiyatana-son-tarih.
             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
             move fiyat-banka     to fiyatana-banka. 
             move fiyat-doviz     to fiyatana-doviz. 
             move fiyat-anlasma   to fiyatana-anlasma. 
             move fiyat-buyuk     to fiyatana-buyuk.
             move fiyat-kucuk     to fiyatana-kucuk.

             read fiyatana no lock invalid
                delete fiyat 
             end-read.

      .
 fiyat-yaz .
    initialize takvim-rec
    move fiyatana-ilk-tarih to takvim-anah.
    start takvim key not < takvim-anah 
       invalid continue
       not invalid
      perform  until fs-takvim = "10",
         read takvim next no lock end,
              move "10" to fs-takvim
          not end,
          if takvim-anah > fiyatana-son-tarih
                    move "10" to fs-takvim,
          end-if,
             if takvim-anah not > fiyatana-son-tarih
               and  takvim-anah not < fiyatana-ilk-tarih
              initialize fiyat-rec
              move fiyatana-acenta           to fiyat-acenta
              move fiyatana-anlasma          to fiyat-anlasma
              move takvim-anah               to fiyat-tarih
              move fiyatana-banka            to fiyat-banka
              move fiyatana-doviz            to fiyat-doviz
              move fiyatana-pan-tipi         to fiyat-pan-tipi
              move fiyatana-rez-tipi         to fiyat-rez-tipi
              move fiyatana-buyuk            to fiyat-buyuk
              move fiyatana-kucuk            to fiyat-kucuk
              move fiyatana-ilk-tarih        to fiyat-bas-tarih
              move fiyatana-son-tarih        to fiyat-bit-tarih
              write fiyat-rec invalid
                    rewrite fiyat-rec invalid continue 
                    end-rewrite
              end-write

          end-if,
        end-read,
      end-perform
    end-start  .
 
 



      
*
 Form1-Ex-Other.
     evaluate key-status
          when 45
             perform konumind-getir
          when 3003
             perform Acu-Form7-Routine
          when 1445
          if genel-fiyatgir-carpan-uygula not = 1
               display message box "Genel Parametreden Rezervasyon sekmesinde bulunan  Fiyat girisinde carpan tablosunu kullan parametresi isaretlenmelidir."
                               title "Uyari"
                               icon 1
            else 
                   call "/asya/ytl/obj/otel/carptanm.asy" 
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/carptanm.asy"
                    end-call             
           end-if 
          when 1455
             open input acenta
             read acenta no lock invalid 
                display message box "Bir anlasma seciniz"
                close acenta
               not invalid

                ||||||29.11.2018
                    
               open i-o fiyatana  kodlar02
               initialize fiyatana-rec
               move acenta-kodu  to fiyatana-acenta
               start fiyatana key not < fiyatana-anah invalid
                     continue
               not invalid
               perform until fs-fiyatana = "10"
               read fiyatana next no lock end move "10" to fs-fiyatana
               not at end  
                       if acenta-kodu <> fiyatana-acenta  
                            exit perform
                       end-if
                       if FIYATANA-ILK-TARIH > FIYATANA-SON-TARIH
                              delete fiyatana end-delete
                              perform log-operation-fiyatana          ||| firat 19-10-2019
                       end-if
                       if FIYATANA-REZ-TIPI = 0 
                              delete fiyatana end-delete
                              perform log-operation-fiyatana          ||| firat 19-10-2019
                       end-if

                       |if FIYATANA-ILK-YIL = zeroes or FIYATANA-ILK-ay = zeroes or FIYATANA-ILK-gun = zeroes
                       |        delete fiyatana end-delete
                       |        perform log-operation-fiyatana           
                       |end-if
                       |
                       |if FIYATANA-son-YIL = zeroes or FIYATANA-son-ay = zeroes or FIYATANA-son-gun = zeroes
                       |        delete fiyatana end-delete
                       |        perform log-operation-fiyatana           
                       |end-if

               
                       initialize kodlar02-rec
                       move FIYATANA-ANLASMA    to kodlar02-kodu 
                       move "D"                 to kodlar02-tipi
                       read kodlar02 no lock invalid
                              delete fiyatana end-delete
                              perform log-operation-fiyatana          ||| firat 19-10-2019
                       end-read

               end-read
               end-perform
               end-start
               close fiyatana  kodlar02


               ||||||||||||||||

                 initialize bakim-aciklama
                 move acenta-kodu to  bakim-aciklama
                      move acenta-adi to  bakim-aciklama(6:15)
                      move "icin bakim yapiliyor lufen bekleyiniz" to  bakim-aciklama (23:)
                close acenta
              perform acu-form6-routine    

             end-read
             

          when 17
               inquire form1-gd-1 cursor-y in i 
               modify form1-gd-1,
                      y = i 
               initialize fiyatana-rec
               move acenta-kodu            to fiyatana-acenta
               move bas-tarih              to fiyatana-ilk-tarih
               move bit-tarih              to fiyatana-son-tarih
               move acc-rez-tipi-value     to fiyatana-rez-tipi
               move acc-pan-kodu-value     to fiyatana-pan-tipi
               move banka-kodu             to fiyatana-banka
               move doviz-kodu             to fiyatana-doviz
               move acc-anlasma-kodu-value to fiyatana-anlasma
               inquire form1-gd-1(i,1),
                       hidden-data in cell1-hidden
               move cell1-buyuk            to fiyatana-buyuk
               move cell1-kucuk            to fiyatana-kucuk

             move fiyatana-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of fiyatana-rec
             set link-logview-rec-size to size of fiyatana-rec
             perform logview-call
             initialize key-status
          when  3131 
             move acenta-kodu to  link-NOT-DOS-ANAH   
           move bas-yil     to  link-NOT-DOS-ANAH(5:)   
           move bas-ay      to  link-NOT-DOS-ANAH(9:)  
           move bas-gun     to  link-NOT-DOS-ANAH(11:)   
           move bit-yil     to  link-NOT-DOS-ANAH(13:)   
           move bit-ay      to  link-NOT-DOS-ANAH(17:)  
           move bit-gun     to  link-NOT-DOS-ANAH(19:)   
             if link-not-dos-anah not = spaces then
                move "U"     to  link-not-islem
                move "FIYATANA"   to  link-NOT-DOS    
             
             move 99 to link-nereden 
             move acenta-adi to per-yazi-acenta
             move bas-yil   to  per-yazi-bas-gun
             move bas-ay    to  per-yazi-bas-ay
             move bas-gun   to  per-yazi-bas-yil
             move bit-yil   to  per-yazi-bit-gun
             move bit-ay    to  per-yazi-bit-ay
             move bit-gun   to  per-yazi-bit-yil
             string per-yazi
                  " Fiyat periyoduna " delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
                   display not-ac
                   exit paragraph 
             end-if
    
          when 1
               perform yardimlar
          when 2 
               if dis-1 = 1 
                  exit paragraph
               end-if
               perform  acc-12-Aft-Procedure
               if gec-gecme =  1 
                  move 4  to accept-control
                  move 63 to control-id
                  exit paragraph
               end-if
               perform  acc-15-Aft-Procedure
               if gec-gecme =  1 
                  move 4  to accept-control
                  move 66 to control-id
                  exit paragraph
               end-if
               perform kaydet-soru
               if not soru-evet 
                  exit paragraph
               end-if
               perform pre-kop
               modify tr, visible = 0
               initialize fiyat-rec fiyatana-rec
               open i-o fiyat fiyatana
               open input takvim
             
               perform varying i from 2 by 1 until i > son-i
               modify form1-gd-1,
                      y = i 
               initialize fiyatana-rec
               move acenta-kodu            to fiyatana-acenta
               move bas-tarih              to fiyatana-ilk-tarih
               move bit-tarih              to fiyatana-son-tarih
               move acc-rez-tipi-value     to fiyatana-rez-tipi
               move acc-pan-kodu-value     to fiyatana-pan-tipi
               move banka-kodu             to fiyatana-banka
               move doviz-kodu             to fiyatana-doviz
               move acc-anlasma-kodu-value to fiyatana-anlasma
               inquire form1-gd-1(i,1),
                       hidden-data in cell1-hidden
               move cell1-buyuk            to fiyatana-buyuk
               move cell1-kucuk            to fiyatana-kucuk

               perform varying ii from 2 by 1 until ii > 41
                      inquire form1-gd-1(i,ii),
                              hidden-data in fiyatana-oda-fiyati(ii - 1)

               end-perform
               if erken-enb = 1 
                  move "E"               to fiyatana-eb-eh
                  move erken-bas-tarih   to fiyatana-eb-bas-tarih
                  move erken-bit-tarih   to fiyatana-eb-bit-tarih
                  move erken-oran        to fiyatana-eb-oran
                  compute fiyatana-eb-kusur = ( erken-oran - fiyatana-eb-oran ) * 100
               else
                  move "H"               to fiyatana-eb-eh
               end-if
               if ug-enb = 1 
                  move "E"           to fiyatana-ug-eh
                  move ug-geceleme   to fiyatana-ug-geceleme
                  move ug-oran       to fiyatana-ug-oran
                  compute fiyatana-ug-kusur = ( ug-oran - fiyatana-ug-oran ) * 100
               else
                  move "H"               to fiyatana-ug-eh
               end-if
                move d-1yc    to fiyatana-d-1yc
                move d-1yf    to fiyatana-d-1yf
                move d-2yc    to fiyatana-d-2yc
                move d-2yf    to fiyatana-d-2yf

              
               move kick-oran            to fiyatana-kick-back
               move kick-oran2            to fiyatana-kick-back2
               
*               move  kkp-onbink       to fiyatana-kkp-onbin                                              
*               move  kick-onbink      to   fiyatana-kick-onbin               
               
               move k-kodu-tasi          to fiyatana-staf
               move fiks                 to fiyatana-fiks
               move hs-ug              to fiyatana-haftasonuvar

               
                 move kick-onbin         to fiyatana-kick-onbin         
                 move kkp-onbin            to fiyatana-kkp-onbin    
              
               write fiyatana-rec invalid
                     rewrite fiyatana-rec end-rewrite
               end-write
               perform log-operation-fiyatana
               end-perform
               if hizli not = 1 then
               initialize takvim-rec
               move bas-tarih   to takvim-anah
               start takvim key not < takvim-anah invalid
                     continue
               not invalid
               initialize fs-takvim
               perform with test after until fs-takvim = "10"
               read takvim next no lock end move "10" to fs-takvim
               not at end
                    if takvim-anah > bit-tarih
                       move "10" to fs-takvim
                       exit perform
                    end-if
                    perform varying i from 2 by 1 until i > son-i
                       initialize fiyat-rec
                       move acenta-kodu            to fiyat-acenta
                       move takvim-anah            to fiyat-tarih
                       move acc-rez-tipi-value     to fiyat-rez-tipi
                       move acc-pan-kodu-value     to fiyat-pan-tipi
                       move banka-kodu             to fiyat-banka
                       move doviz-kodu             to fiyat-doviz
                       move acc-anlasma-kodu-value to fiyat-anlasma
                       inquire form1-gd-1(i,1),
                               hidden-data in cell1-hidden
                       move cell1-buyuk            to fiyat-buyuk
                       move cell1-kucuk            to fiyat-kucuk
                       move bas-tarih              to fiyat-bas-tarih
                       move bit-tarih              to fiyat-bit-tarih
                       write fiyat-rec invalid
                             rewrite fiyat-rec end-rewrite
                       end-write
                    end-perform
               end-read
               end-perform
               end-start
               end-if
               close fiyat fiyatana takvim
               perform post-kop
               modify tr visible = true
               perform grid-bosalt
*/********eski hali               initialize fiyatana-rec fiyat-rec kick-oran kick-oran2 kkp-onbink kick-onbink  
               initialize fiyatana-rec fiyat-rec     
               move 0 to dis-2 erken-enb
               move 1 to dis-1
               
               perform  form-yaz

               move 4 to accept-control
               move 4 to control-id
               exit paragraph
          when 3 
               if dis-1 = 1 
                  exit paragraph
               end-if
               perform sil-soru
               if not soru-evet
                  exit paragraph
               end-if
               perform pre-kop
               modify tr visible = 0
               initialize fiyatana-rec
               open i-o fiyatana fiyat
               move acenta-kodu            to fiyatana-acenta
               move bas-tarih              to fiyatana-ilk-tarih
               move bit-tarih              to fiyatana-son-tarih
               move acc-rez-tipi-value     to fiyatana-rez-tipi
               move acc-pan-kodu-value     to fiyatana-pan-tipi
               move banka-kodu             to fiyatana-banka
               move doviz-kodu             to fiyatana-doviz
               move acc-anlasma-kodu-value to fiyatana-anlasma
               start fiyatana key not < fiyatana-anah invalid
                     continue
               not invalid
               initialize fs-fiyatana
               perform with test after until fs-fiyatana = "10"
               read fiyatana next no lock end move "10" to fs-fiyatana
               not at end  
                  if acenta-kodu            = fiyatana-acenta    and
                     bas-tarih              = fiyatana-ilk-tarih and
                     bit-tarih              = fiyatana-son-tarih and
                     acc-rez-tipi-value     = fiyatana-rez-tipi  and
                     acc-pan-kodu-value     = fiyatana-pan-tipi  and
                     function numval(banka-kodu)             = fiyatana-banka     and
                     doviz-kodu             = fiyatana-doviz     and
                     acc-anlasma-kodu-value = fiyatana-anlasma
                             delete fiyatana end-delete
                             perform log-operation-fiyatana
                  else
                     move "10" to fs-fiyatana
                     exit perform
                  end-if
               end-read
               end-perform
               end-start
               initialize fiyat-rec
               move acenta-kodu          to fiyat-acenta
               move bas-tarih            to fiyat-tarih
               move acc-rez-tipi-value   to fiyat-rez-tipi
               move acc-pan-kodu-value   to fiyat-pan-tipi
               move banka-kodu           to fiyat-banka
               move doviz-kodu           to fiyat-doviz
               move  acc-anlasma-kodu-value to fiyat-anlasma
               start fiyat key not < fiyat-anah invalid
                     continue
               not invalid
               initialize fs-fiyat
               perform with test after until fs-fiyat = "10"
               read fiyat next no lock end move "10" to fs-fiyat
               not at end
                    if acenta-kodu        <> fiyat-acenta   or
                       fiyat-tarih         > bit-tarih      or 
                       acc-rez-tipi-value <> fiyat-rez-tipi or
                       acc-pan-kodu-value <> fiyat-pan-tipi or
                       function numval(banka-kodu)         <> fiyat-banka    or 
                       doviz-kodu         <> fiyat-doviz    or 
                      acc-anlasma-kodu-value  <> fiyat-anlasma
                                move "10" to fs-fiyat
                                exit perform
                    else
                       delete fiyat invalid continue end-delete
                    end-if
               end-read
               end-perform
               end-start
               close fiyatana fiyat
               perform grid-bosalt
               perform post-kop
               modify tr visible = 1
               initialize fiyatana-rec fiyat-rec kick-oran kick-oran2     kkp-onbink      kick-onbink     
               move 0 to dis-2 erken-enb
               move 1 to dis-1
                               perform  form-yaz
               move 4 to accept-control
               move 4 to control-id
               exit paragraph
          when 4

               if dis-1 = 1
               
                  exit paragraph
               else
****** kopyalama rutini
                  initialize copy-paste-degiskenler  cop-top
                  inquire form1-gd-1,
                          cursor-x in copy-paste-from
                  if copy-paste-from = 0
                     display message box
                             "Kopyalanamadi ..."
                             icon mb_error_icon
                             title "Bilginize ..."
                  end-if
                  inquire form1-gd-1,
                         last-row in copy-paste-ii
                 perform varying copy-paste-i 
                         from 2 
                         by 1 
                         until copy-paste-i > copy-paste-ii + 1
                 inquire form1-gd-1(copy-paste-i,copy-paste-from),
                         hidden-data in copy-tut(copy-paste-i)
                 end-perform
               end-if
          when 7
               if dis-1 = 1
               
                  exit paragraph
               else
****** kopyalama rutini
                  initialize copy-paste-degiskenler  cop-top2
                  
                 
                  inquire form1-gd-1,
                         last-row in copy-paste-ii
                        
                 perform varying        copy-paste-from
                         from 2 by 1  until   copy-paste-from > 41
                 perform varying copy-paste-i 
                         from 2 
                         by 1 
                         until copy-paste-i > copy-paste-ii 
                 inquire form1-gd-1(copy-paste-i,copy-paste-from),
                         hidden-data in copy-tut2(copy-paste-i,copy-paste-from)
                 
                 end-perform
               
               end-if
              when 8
               if dis-1 = 1               
                  exit paragraph
               else
****** kopyalama rutini
                 inquire form1-gd-1,
                         last-row in copy-paste-ii
                        
                 perform varying copy-paste-from
                 from 2 
                 by 1 
                 until copy-paste-from > 41
                   perform varying copy-paste-i 
                   from 2 
                   by 1 
                   until copy-paste-i > copy-paste-ii                          
                      move copy-tut2(copy-paste-i,copy-paste-from) to tutar
                      if tutar > 0 | backspace tuўu ile ayn§ key-status oldu№u iчin eklendi fiyatlar§ komple siliyordu
                         move tutar to etutar
                         modify form1-gd-1(copy-paste-i,copy-paste-from),
                            cell-data = etutar
                            x = copy-paste-from
                            hidden-data = tutar
                      end-if | backspace tuўu ile ayn§ key-status oldu№u iчin eklendi fiyatlar§ komple siliyordu
                   end-perform
                 end-perform               
               end-if
        

          when 5
****** yapistirma rutini
               if dis-1 <> 1
                 if copy-paste-from = 0
                    display message box
                            "Kopyalama yapilmamis ..."
                            icon mb_error_icon
                            title "Bilginize ..."
                    exit paragraph
                 end-if
                 inquire form1-gd-1,
                         cursor-x in copy-paste-to
                 inquire form1-gd-1(1,copy-paste-to),
                         cell-data in yer-bilgi
                 if yer-bilgi = spaces
                    display message box
                            "Konum belirsiz,bilgi yapistirilamiyor"
                            icon mb_error_icon
                    move event-action-fail to event-action
                    exit paragraph
                 end-if
                 inquire form1-gd-1
                          ,
                         last-row in copy-paste-ii
                        
                 perform varying copy-paste-i 
                         from 2 
                         by 1 
                         until copy-paste-i > copy-paste-ii 
                 move copy-tut(copy-paste-i) to  tutar
                 move tutar to etutar
                 modify form1-gd-1(copy-paste-i,copy-paste-to),
                     cell-data = etutar
                     x = copy-paste-to
                     hidden-data = tutar
                 end-perform
               end-if
          when 6
               perform grid-bosalt
*/***eski hali               initialize fiyatana-rec fiyat-rec kick-oran kick-oran2   kkp-onbink   kick-onbink     
               initialize fiyatana-rec fiyat-rec      

               move 0 to dis-2 erken-enb
               move 1 to dis-1
               perform  form-yaz
               move 4 to accept-control
               move 4 to control-id
               exit paragraph
          when 2001
               
               perform acc-acenta-Aft-Procedure
               if gec-gecme = 1 and k-kodu-tasi not = "ASYA"
                  move 4 to accept-control
                  move 4 to control-id
                  exit paragraph
               end-if
               perform accept-0103-Aft-Procedure
               if gec-gecme = 1    and k-kodu-tasi not = "ASYA"
                  move 4 to accept-control
                  move 8 to control-id
                  exit paragraph
               end-if
               perform accept-0106-Aft-Procedure
               if gec-gecme = 1   and k-kodu-tasi not = "ASYA"
                  move 4  to accept-control
                  move 12 to control-id
                  exit paragraph
               end-if
               perform acc-pan-kodu-Aft-Procedure
               if gec-gecme = 1  and k-kodu-tasi not = "ASYA"
                  move 4  to accept-control
                  move 20 to control-id
                  exit paragraph
               end-if
               perform acc-rez-tipi-Aft-Procedure
               if gec-gecme = 1   and k-kodu-tasi not = "ASYA"
                  move 4  to accept-control
                  move 23 to control-id
                  exit paragraph

               end-if
               perform acc-banka-kodu-Aft-Procedure
               if gec-gecme = 1   and k-kodu-tasi not = "ASYA"
                  move 4  to accept-control
                  move 26 to control-id
                  exit paragraph
               end-if
               perform acc-doviz-kodu-Aft-Procedure
               if gec-gecme = 1    and k-kodu-tasi not = "ASYA"
                  move 4  to accept-control
                  move 28 to control-id
                  exit paragraph
               end-if
               perform acc-anlasma-Aft-Procedure
               if gec-gecme = 1   and k-kodu-tasi not = "ASYA"
                  move 4  to accept-control
                  move 16 to control-id
                 exit paragraph
               end-if
               if bit-tarih < bas-tarih
                  move 4  to accept-control
                  move 16 to control-id
                 exit paragraph                
               end-if 
               perform fiy-cak-kont thru fiy-cak-kont-exit
               if fiy-eh = 1 
                  move 4 to accept-control
                  move 16 to control-id
                  exit paragraph
               end-if

               move 0 to dis-1
               move 1 to dis-2
               perform  form-yaz  
           when 6007
               initialize acenta-rec aksi-flag
               open i-o kllnc
               move k-kodu-tasi to k-kodu
               read kllnc no lock invalid continue
                  not invalid 
                    if k-tfiyat-bas-tar < "19000000"
                          move "20050101" to k-tfiyat-bas-tar
                     end-if
                     if k-tfiyat-bit-tar < "19000000"
                          move "20151231" to k-tfiyat-bit-tar
                     end-if
                     perform acu-form5-routine 
                  end-read 
                  close kllnc
                
     end-evaluate.

 fiy-cak-kont.
     modify Form1-Gd-1 mass-update = 1
     modify tr enabled = 0 
| fiy-eh = 0 ise fiyatana'da bilgi var
| fiy-eh = 1 ise fiyatana'da bilgi yok ama fiyat
| kontrolu yapiliyor ..... fiyatta cakisma var
| fiy-eh = 2 ise bilgi yok
     initialize fiy-eh fiyatana-rec kayit-sayi erken-enb.
     open i-o  fiyatana fiyatind
     move acenta-kodu            to fiyatana-acenta
     move bas-tarih              to fiyatana-ilk-tarih
     move bit-tarih              to fiyatana-son-tarih
     move acc-rez-tipi-value     to fiyatana-rez-tipi
     move acc-pan-kodu-value     to fiyatana-pan-tipi
     move banka-kodu             to fiyatana-banka
     move doviz-kodu             to fiyatana-doviz
     move acc-anlasma-kodu-value to fiyatana-anlasma
     start fiyatana key not < fiyatana-anah invalid
           move "1" to fiy-eh
     not invalid
     initialize fs-fiyatana
     perform with test after until fs-fiyatana = "10"
     read fiyatana next no lock end move "10" to fs-fiyatana
     not at end
          if acenta-kodu            = fiyatana-acenta    and
             bas-tarih              = fiyatana-ilk-tarih and
             bit-tarih              = fiyatana-son-tarih and
             acc-rez-tipi-value     = fiyatana-rez-tipi  and
             acc-pan-kodu-value     = fiyatana-pan-tipi  and
             function numval(banka-kodu)             = fiyatana-banka and
             doviz-kodu             = fiyatana-doviz     and
             acc-anlasma-kodu-value = fiyatana-anlasma
                add 1 to kayit-sayi
                
                initialize yer-i

                perform yer-bul
                   
                if yer-i > 0
                   move fiyatana-kick-back  to kick-oran
                   move fiyatana-kick-back2 to kick-oran2
                   move fiyatana-kkp-onbin  to kkp-onbink       
                   move fiyatana-kick-onbin to kick-onbink     

                   move fiyatana-fiks           to fiks 
                     move  fiyatana-haftasonuvar     to hs-ug 
                     move fiyatana-kick-onbin    to kick-onbin
                       move fiyatana-kkp-onbin    to kkp-onbin

                   if fiyatana-eb-eh = "E"
                       move 1 to erken-enb
                        else
                           move 0 to erken-enb
                    end-if
                    if fiyatana-ug-eh = "E"
                       move 1 to ug-enb
                        else
                           move 0 to ug-enb
                    end-if
                move fiyatana-eb-bas-tarih   to erken-bas-tarih
                move fiyatana-eb-bit-tarih   to erken-bit-tarih
              compute erken-oran rounded =   fiyatana-eb-oran +
                      (fiyatana-eb-kusur / 100 )
                compute ug-oran rounded = fiyatana-ug-oran + 
                      ( fiyatana-ug-kusur / 100 )
                move fiyatana-ug-geceleme        to ug-geceleme              
                
                
                move fiyatana-d-1yc    to d-1yc
                move fiyatana-d-1yf    to d-1yf
                move fiyatana-d-2yc    to d-2yc
                move fiyatana-d-2yf    to d-2yf

                move fiyatana-kick-back      to kick-oran
                move fiyatana-kick-back2     to kick-oran2
             
                move  fiyatana-kkp-onbin    to  kkp-onbink       
               move    fiyatana-kick-onbin  to kick-onbink        

                   move fiyatana-oda-fiyati(1)   to etutar
                   move etutar          to gd-1-col-2
                   move fiyatana-oda-fiyati(2)   to etutar
                   move etutar          to gd-1-col-3
                   move fiyatana-oda-fiyati(3)   to etutar
                   move etutar          to gd-1-col-4
                   move fiyatana-oda-fiyati(4)   to etutar
                   move etutar          to gd-1-col-5
                   move fiyatana-oda-fiyati(5)   to etutar
                   move etutar          to gd-1-col-6
                   move fiyatana-oda-fiyati(6)   to etutar
                   move etutar          to gd-1-col-7
                   move fiyatana-oda-fiyati(7)   to etutar
                   move etutar          to gd-1-col-8
                   move fiyatana-oda-fiyati(8)   to etutar
                   move etutar          to gd-1-col-9
                   move fiyatana-oda-fiyati(9)   to etutar
                   move etutar          to gd-1-col-10
                   move fiyatana-oda-fiyati(10)   to etutar
                   move etutar          to gd-1-col-11
                   move fiyatana-oda-fiyati(11)   to etutar
                   move etutar          to gd-1-col-12
                   move fiyatana-oda-fiyati(12)   to etutar
                   move etutar          to gd-1-col-13
                   move fiyatana-oda-fiyati(13)   to etutar
                   move etutar          to gd-1-col-14
                   move fiyatana-oda-fiyati(14)   to etutar
                   move etutar          to gd-1-col-15
                   move fiyatana-oda-fiyati(15)   to etutar
                   move etutar          to gd-1-col-16
                   move fiyatana-oda-fiyati(16)   to etutar
                   move etutar          to gd-1-col-17
                   move fiyatana-oda-fiyati(17)   to etutar
                   move etutar          to gd-1-col-18
                   move fiyatana-oda-fiyati(18)   to etutar
                   move etutar          to gd-1-col-19
                   move fiyatana-oda-fiyati(19)   to etutar
                   move etutar          to gd-1-col-20
                   move fiyatana-oda-fiyati(20)   to etutar
                   move etutar          to gd-1-col-21

                  
                   move fiyatana-oda-fiyati(21)   to etutar
                   move etutar          to gd-1-col-22
                   move fiyatana-oda-fiyati(22)   to etutar
                   move etutar          to gd-1-col-23
                   move fiyatana-oda-fiyati(23)   to etutar
                   move etutar          to gd-1-col-24
                   move fiyatana-oda-fiyati(24)   to etutar
                   move etutar          to gd-1-col-25
                   move fiyatana-oda-fiyati(25)   to etutar
                   move etutar          to gd-1-col-26
                   move fiyatana-oda-fiyati(26)   to etutar
                   move etutar          to gd-1-col-27
                   move fiyatana-oda-fiyati(27)   to etutar
                   move etutar          to gd-1-col-28
                   move fiyatana-oda-fiyati(28)   to etutar
                   move etutar          to gd-1-col-29
                   move fiyatana-oda-fiyati(29)   to etutar
                   move etutar          to gd-1-col-30
                   move fiyatana-oda-fiyati(30)   to etutar
                   move etutar          to gd-1-col-31

                  
                   move fiyatana-oda-fiyati(31)   to etutar
                   move etutar          to gd-1-col-32
                   move fiyatana-oda-fiyati(32)   to etutar
                   move etutar          to gd-1-col-33
                   move fiyatana-oda-fiyati(33)   to etutar
                   move etutar          to gd-1-col-34
                   move fiyatana-oda-fiyati(34)   to etutar
                   move etutar          to gd-1-col-35
                   move fiyatana-oda-fiyati(35)   to etutar
                   move etutar          to gd-1-col-36
                   move fiyatana-oda-fiyati(36)   to etutar
                   move etutar          to gd-1-col-37
                   move fiyatana-oda-fiyati(37)   to etutar
                   move etutar          to gd-1-col-38
                   move fiyatana-oda-fiyati(38)   to etutar
                   move etutar          to gd-1-col-39
                   move fiyatana-oda-fiyati(39)   to etutar
                   move etutar          to gd-1-col-40
                   move fiyatana-oda-fiyati(40)   to etutar
                   move etutar          to gd-1-col-41
                      perform 100000 times
                      continue
                    end-perform 
                   
*                   accept omitted before time 0
                   move yer-bilgi       to gd-1-col-1

                   initialize fiyatind-rec
                   move fiyatana-anah   to fiyatind-anah
                   read fiyatind no lock invalid 
                        move 0  to konumind-var
                        move "Konum indirim " to but-title
                        move 10                         to but-boy
                   not invalid 
                        move 1    to konumind-var 
                        move "Konum indirim Duzenle" to but-title
                        move 20                         to but-boy
                   end-read 
                        display Form1-Pb-6a
   
                   if link-var = 2                     
                      if lfiyatana-anah = fiyatana-anah then                       
                       if (takvim-gun-adi = 5 or 6) and  fiyatana-haftasonuvar = 1 then 
                              modify form1-gd-1(yer-i, lfiyatana-konum + 31 )
                               cell-color = 176
                               cursor-x = lfiyatana-konum + 31
                               cursor-y = yer-i

                       else
                              modify form1-gd-1(yer-i, lfiyatana-konum + 1 )
                               cell-color = 176
                               cursor-x = lfiyatana-konum + 1
                               cursor-y = yer-i
                        end-if
                      end-if
                   end-if
                   modify form1-gd-1(yer-i),
                          x = 1
                          cell-data = yer-bilgi
                          x = 2
                          cell-data = gd-1-col-2
                          hidden-data = fiyatana-oda-fiyati(1)
                          x = 3
                          cell-data = gd-1-col-3
                          hidden-data = fiyatana-oda-fiyati(2)
                          x = 4
                          cell-data = gd-1-col-4
                          hidden-data = fiyatana-oda-fiyati(3)
                          x = 5
                          cell-data = gd-1-col-5
                          hidden-data = fiyatana-oda-fiyati(4)
                          x = 6
                          cell-data = gd-1-col-6
                          hidden-data = fiyatana-oda-fiyati(5)
                          x = 7
                          cell-data = gd-1-col-7
                          hidden-data = fiyatana-oda-fiyati(6)
                          x = 8
                          cell-data = gd-1-col-8
                          hidden-data = fiyatana-oda-fiyati(7)
                          x = 9
                          cell-data = gd-1-col-9
                          hidden-data = fiyatana-oda-fiyati(8)
                          x = 10
                          cell-data = gd-1-col-10
                          hidden-data = fiyatana-oda-fiyati(9)
                          x = 11
                          cell-data = gd-1-col-11
                          hidden-data = fiyatana-oda-fiyati(10)
                          x = 12
                          cell-data = gd-1-col-12
                          hidden-data = fiyatana-oda-fiyati(11)
                          x = 13
                          cell-data = gd-1-col-13
                          hidden-data = fiyatana-oda-fiyati(12)
                          x = 14
                          cell-data = gd-1-col-14
                          hidden-data = fiyatana-oda-fiyati(13)
                          x = 15
                          cell-data = gd-1-col-15
                          hidden-data = fiyatana-oda-fiyati(14)
                          x = 16
                          cell-data = gd-1-col-16
                          hidden-data = fiyatana-oda-fiyati(15)
                          x = 17
                          cell-data = gd-1-col-17
                          hidden-data = fiyatana-oda-fiyati(16)
                          x = 18
                          cell-data = gd-1-col-18
                          hidden-data = fiyatana-oda-fiyati(17)
                          x = 19
                          cell-data = gd-1-col-19
                          hidden-data = fiyatana-oda-fiyati(18)
                          x = 20
                          cell-data = gd-1-col-20
                          hidden-data = fiyatana-oda-fiyati(19)
                          x = 21
                          cell-data = gd-1-col-21
                          hidden-data = fiyatana-oda-fiyati(20)
                          x = 22
                          cell-data = gd-1-col-22
                          hidden-data = fiyatana-oda-fiyati(21)
                          x = 23
                          cell-data = gd-1-col-23
                          hidden-data = fiyatana-oda-fiyati(22)
                          x = 24
                          cell-data = gd-1-col-24
                          hidden-data = fiyatana-oda-fiyati(23)
                          x = 25
                          cell-data = gd-1-col-25
                          hidden-data = fiyatana-oda-fiyati(24)
                          x = 26
                          cell-data = gd-1-col-26
                          hidden-data = fiyatana-oda-fiyati(25)
                          x = 27
                          cell-data = gd-1-col-27
                          hidden-data = fiyatana-oda-fiyati(26)
                          x = 28
                          cell-data = gd-1-col-28
                          hidden-data = fiyatana-oda-fiyati(27)
                          x = 29
                          cell-data = gd-1-col-29
                          hidden-data = fiyatana-oda-fiyati(28)
                          x = 30
                          cell-data = gd-1-col-30
                          hidden-data = fiyatana-oda-fiyati(29)

                          x = 31
                          cell-data = gd-1-col-31
                          hidden-data = fiyatana-oda-fiyati(30)
                          x = 32
                          cell-data = gd-1-col-32
                          hidden-data = fiyatana-oda-fiyati(31)
                          x = 33
                          cell-data = gd-1-col-33
                          hidden-data = fiyatana-oda-fiyati(32)
                          x = 34
                          cell-data = gd-1-col-34
                          hidden-data = fiyatana-oda-fiyati(33)
                          x = 35
                          cell-data = gd-1-col-35
                          hidden-data = fiyatana-oda-fiyati(34)
                          x = 36
                          cell-data = gd-1-col-36
                          hidden-data = fiyatana-oda-fiyati(35)
                          x = 37
                          cell-data = gd-1-col-37
                          hidden-data = fiyatana-oda-fiyati(36)
                          x = 38
                          cell-data = gd-1-col-38
                          hidden-data = fiyatana-oda-fiyati(37)
                          x = 39
                          cell-data = gd-1-col-39
                          hidden-data = fiyatana-oda-fiyati(38)
                          x = 40
                          cell-data = gd-1-col-40
                          hidden-data = fiyatana-oda-fiyati(39)
                          x = 41
                          cell-data = gd-1-col-41
                          hidden-data = fiyatana-oda-fiyati(40)
                          
                end-if
          else
             move "10" to fs-fiyatana
             exit perform
          end-if
     end-read
     end-perform
     end-start
     close fiyatana fiyatind.
     modify Form1-Gd-1 mass-update = 0 
     modify tr enabled = 1
     if kayit-sayi = 0
        move "1" to fiy-eh
     end-if.
     if fiy-eh = 1
         perform tek-anlasma-kont
     end-if.
*/
 fiy-cak-kont-exit.
     exit.

 yardimlar.
      
      evaluate control-id
          when 4
               initialize link-acenta
               call "/asya/ytl/obj/otel/acenara.asy" using 
                    link-acenta
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy"
                        if link-acenta <> spaces
                           move link-acenta to acenta-kodu
                           display acc-acenta
                        end-if
               end-call
          when 20
               initialize link-pan-cagir
               call "/asya/ytl/obj/otel/panara.asy" using 
                    link-pan-cagir
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/panara.asy"
                        if link-pansiyon <> spaces
                           move link-pansiyon to acc-pan-kodu-value
                           display acc-pan-kodu
                        end-if
               end-call
          when 16
               initialize link-pan-cagir
               move "D" to link-pan-tipi
               call "/asya/ytl/obj/otel/infoxara.asy" using 
                    link-pan-cagir
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy"
                        if link-pansiyon <> spaces
                           move link-pansiyon to acc-anlasma-kodu-value
                           display acc-anlasma
                        end-if
               end-call
          when 26
               initialize link-banka
               call "/asya/ytl/obj/otel/bankaara.asy" using
                    link-banka
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy"
                        if link-banka <> spaces
                           move link-banka to banka-kodu
                           display acc-banka-kodu
                        end-if
               end-call
          when 28
               initialize link-doviz
               call "/asya/ytl/obj/otel/dovizara.asy" using
                    link-doviz
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy"
                        if link-doviz <> spaces
                           move link-doviz to doviz-kodu
                           display acc-doviz-kodu
                        end-if
               end-call
     end-evaluate.
 yer-bul.
     perform varying i from 2 by 1 until i > son-i
             modify form1-gd-1,
                    y = i
             inquire form1-gd-1(i,1),
                    hidden-data in cell1-hidden
                    cell-data   in yer-bilgi
             if cell1-buyuk = fiyatana-buyuk and
                cell1-kucuk = fiyatana-kucuk
                    move i to yer-i
                    exit perform
             end-if
     end-perform.
*
 grid-hesap.
     inquire form1-gd-1(1,i),
                         cell-data in yer-bilgi
     if yer-bilgi = spaces        
        exit paragraph
     else
          
     initialize konum-rec max-pax  max-kapasite hes-konum-kodu
     compute hes-konum-kodu = i - 1
     move  hes-konum-kodu      to konum-anahtar
     read konum no lock invalid 
          continue 
     not invalid 
          move konum-max-pax      to max-pax
          move KONUM-MAX-KAPASITE to max-kapasite
     end-read 

     inquire form1-gd-11(1,i) hidden-data in min
     inquire form1-gd-11(2,i) hidden-data in pp
     if pp = 0 then 
         exit paragraph
     end-if
       
     perform varying copy-paste-i 
     from 2 
     by 1 
     until copy-paste-i > son-i
         inquire form1-gd-1(copy-paste-i,1),
         hidden-data in cell1-hidden
         if cell1-buyuk < 1 then 
            exit perform cycle
         end-if

          if max-pax > 0
             evaluate true
             when cell1-buyuk > max-pax and 
                  cell1-kucuk = 0
                   exit perform cycle 
             when (cell1-buyuk + cell1-kucuk) > max-kapasite
                   exit perform cycle
             end-evaluate  
          end-if
          if genel-fiyatgir-carpan-uygula not = 1
                  compute hfiyat rounded = 
                   ( cell1-buyuk  * pp ) + 
                   ( cell1-kucuk * pp * ((100 - d-ci ) / 100 ) )
        
                  if cell1-buyuk > 2 then 
                     compute hfiyat rounded = hfiyat -(pp * ((d-3i)/100 ))
                  end-if
                  if cell1-buyuk > 3 then 
                     compute hfiyat rounded = hfiyat - (  pp * ((d-4i)/100 ))
                  end-if
                  if cell1-buyuk > 4 then 
                     compute hfiyat rounded = hfiyat - ( pp * ((d-5i)/100 ))
                  end-if
                  if cell1-buyuk > 5 then 
                     compute hfiyat rounded = hfiyat - (  pp * ((d-6i)/100 ))
                  end-if
                  if cell1-buyuk > 6 then 
                     compute hfiyat rounded = hfiyat - ( (cell1-buyuk - 6 )* pp * ((d-7i)/100 ))
                  end-if
                  if cell1-buyuk = 1   then           
                     compute hfiyat rounded = ( ( cell1-buyuk  * pp ) + (  pp * ((d-ss)/100 )) )
                     +  ( cell1-kucuk * pp * ((100 - d-ci )/ 100 ) )
                  end-if
        
                  if min > 0 then 
                    if min < 10 and hfiyat < min * pp then 
                       compute  hfiyat  =  min * pp
                    end-if
                    if min > 10 and hfiyat < min then 
                       move min to hfiyat
                    end-if
                  end-if
          else
             initialize carpan-rec
***sonra eklenecek             initialize  carpan-anlasma
             move acenta-kodu of acenta to carpan-acenta
             move cell1-buyuk to carpan-buyuk
             move cell1-kucuk to carpan-kucuk
             move konum-anahtar to carpan-konum
             read carpan no lock invalid 
                initialize carpan-rec
                move cell1-buyuk to carpan-buyuk
                move cell1-kucuk to carpan-kucuk
                move konum-anahtar to carpan-konum
                read carpan no lock invalid 
                     continue 
                not invalid 
                    compute hfiyat rounded = pp * carpan-degeri 
                end-read 
             not invalid                  
                  compute hfiyat rounded = pp * carpan-degeri
             end-read 
          end-if 

          move hfiyat to tutar etutar
          modify form1-gd-1(copy-paste-i, i),
            cell-data = etutar          
            hidden-data = tutar

       end-perform. 
*
 Form1-Gd-1-Ev-Other.
     evaluate event-type
         when msg-heading-dblclick
         
              inquire form1-gd-1,
                      y in ii
                      x in i
             
              open input konum carpan
              evaluate i
                when 1
                perform varying i from 2 by 1 until i > 41
                  perform grid-hesap
                end-perform 
                when other 
                 perform  grid-hesap
              end-evaluate
              close konum carpan
         when msg-begin-entry
              inquire form1-gd-1,
                      y in ii
                      x in i
              inquire form1-gd-1(ii,i),
                      hidden-data in tutar
              if i > 0 and i < 42
                 inquire form1-gd-1(1,i),
                         cell-data in yer-bilgi
                 if yer-bilgi = spaces
                    move event-action-fail to event-action
                    exit paragraph
                 else
                    modify form1-gd-1(ii,i),
                           cell-data = tutar
                 end-if
              else
                 move event-action-fail to event-action
              end-if
         when msg-finish-entry
              inquire form1-gd-1(ii,i),
                      cell-data in tutar
              move tutar to etutar
              modify form1-gd-1(ii,i),
                     cell-data = etutar
                     x = i
                     hidden-data = tutar
     end-evaluate.
*
 Form1-Gd-11-Ev-Other.
     evaluate event-type
         when msg-begin-entry
              inquire form1-gd-11,
                      y in ii
                      x in i
              inquire form1-gd-11(ii,i),
                      hidden-data in tutar
              if i > 0 and i < 42
                 inquire form1-gd-1(1,i),
                         cell-data in yer-bilgi
                 if yer-bilgi = spaces
                    move event-action-fail to event-action
                    exit paragraph
                 else
                    modify form1-gd-11(ii,i),
                           cell-data = tutar
                 end-if
              else
                 move event-action-fail to event-action
              end-if
         when msg-finish-entry
              inquire form1-gd-11(ii,i),
                      cell-data in tutar
              move tutar to etutar
              modify form1-gd-11(ii,i),
                     cell-data = etutar
                     x = i
                     hidden-data = tutar
     end-evaluate.
*
 acc-12-Aft-Procedure.
     initialize gec-gecme.
     if erken-enb = 1 
        continue
     else 
        exit paragraph
     end-if.
     open input takvim.
     move erken-bas-tarih to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
*
 acc-15-Aft-Procedure.
     initialize gec-gecme.
     if erken-enb = 1 
        continue
     else 
        exit paragraph
     end-if.
        
     open input takvim.
     move erken-bit-tarih to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
     if erken-bas-tarih > erken-bit-tarih
        move 1 to gec-gecme.
*
 cb-1-Ex-Cmd-Clicked.
     display acc-10,acc-11,acc-12,acc-13,acc-14,acc-15,acc-16.
*
 cb-1-Ex-Cmd-Clicked2.
      .
 grid-bosalt.
     initialize Form1-Gd-1-Record
     perform varying i from 2 by 1 until i > son-i
             after ii from 2 by 1 until ii > 41
             modify form1-gd-1(i,ii),
                    hidden-data = 0
                    cell-data = " "
     end-perform.
*
 Form1-Gd-1-Bef-Procedure.
     initialize msg
     move 
     "F4- Bulunulan sutundaki fiyatlari kopyala F5-Bulunulan sutuna yapistir"
     to msg
     perform Acu-Form1-Display-Status-Msg.
*
*
 Form1-Gd-11-Bef-Procedure.
     initialize msg
     move 
     "Fiyatlari Olusturmak icin sutun basliklarina tiklayiniz"   
     to msg
     perform Acu-Form1-Display-Status-Msg.
*
 Form1-Gd-1-Aft-Procedure.
     initialize msg.
     perform Acu-Form1-Display-Status-Msg.
     .
*
 form-yaz.
       initialize toplam-not
          move acenta-kodu to  link-NOT-DOS-ANAH   
           move bas-yil     to  link-NOT-DOS-ANAH(5:)   
           move bas-ay      to  link-NOT-DOS-ANAH(9:)  
           move bas-gun     to  link-NOT-DOS-ANAH(11:)   
           move bit-yil     to  link-NOT-DOS-ANAH(13:)   
           move bit-ay      to  link-NOT-DOS-ANAH(17:)  
           move bit-gun     to  link-NOT-DOS-ANAH(19:)  
       if link-not-dos-anah not = spaces  then
           move "K"     to  link-not-islem
           move "FIYATANA"   to  link-NOT-DOS    
           move acenta-kodu to  link-NOT-DOS-ANAH   
           move bas-yil     to  link-NOT-DOS-ANAH(5:)   
           move bas-ay      to  link-NOT-DOS-ANAH(9:)  
           move bas-gun     to  link-NOT-DOS-ANAH(11:)   
           move bit-yil     to  link-NOT-DOS-ANAH(13:)   
           move bit-ay      to  link-NOT-DOS-ANAH(17:)  
           move bit-gun     to  link-NOT-DOS-ANAH(19:)   
           
           move 99 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
         end-if
         display not-ac
     display acc-acenta, accept-0101, accept-0102, accept-0103, accept-0104, accept-0105, accept-0106,    
              acc-pan-kodu, acc-rez-tipi, acc-banka-kodu, acc-doviz-kodu, acc-anlasma, cb-1, form1-cb-1,  Form1-Cb-1b Form1-Cb-1c Form1-Cb-1ca
              cb-1a, acc-10a,acc-16a,
              acc-10, acc-11, acc-12, acc-13, 
     modify form1-gd-1 enabled = dis-2
     display  acc-14, acc-15, acc-16, acc-kick, acc-kicka,  
              form1-pb-2,  form1-pb-2a,  form1-pb-2aa,  form1-pb-2aaa
     display  form1-la-1ba, form1-la-1b, form1-la-1, form1-la-1bbb, form1-la-1bbba, form1-la-1bb,
              form1-la-1bba, form1-la-1a
     
              if d-1yc not > 0 then move  13 to d-1yc  end-if                
              if d-1yf not > 0 then move  6  to d-1yf  end-if                
              if d-2yc not > 0 then  move 13 to d-2yc  end-if                
              if d-2yf not > 0 then  move  6 to d-2yf  end-if                
          
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 acenta-kopyala.
*/***    modify btncoklu-secim , enabled = false
             initialize acuserve-gizle
            move 1    to acuserve-gizle

            move 1 to vis-1
            move 0 to vis-2 vis-3 vis-4 dis4-1 kabul tum-peryot tarih-at
            initialize acenta-adi ac-kont
            inquire tr, item = ace-po, item-text in la1  
            move " acentasinin tum fiyat anlasmalari kopyalanacaktir" to la1(15:)
            move "Lutfen kopyalanacak acenta kodunu giriniz"  to la2 
            
                 perform acu-form4-routine
             if kabul =1  then
                   
                     modify tr,  visible = 0
                            perform pre-kop
                    

                     perform  acenta-fiyatlari-kopyala

                      
                     perform post-kop
                     modify tr,  visible = 1
                     
             end-if
          
     .  
 sonraki-bul.
         open input takvim 
         move bas-gun to takvim-gun
         move bas-ay  to takvim-ay
         move bas-yil to takvim-yil
         start takvim key > takvim-anah  invalid
             not invalid 
             read takvim next not end 
                move takvim-gun to bas-gun
                move takvim-ay  to bas-ay
                move takvim-yil to bas-yil
             end-read
         end-start
         close takvim
         .
*
 tum-anlasma-kopyala.
            initialize acuserve-gizle
            move 1    to acuserve-gizle
            move 1 to vis-1 vis-2  vis-4
            move 0 to vis-3 dis4-1 kabul 
            move 1 to tum-peryot
            move 1 to tarih-at
            initialize acenta-adi  bas-tarih bit-tarih
            move hid(02:04)   to acenta-kodu
            open input takvim 
            initialize takvim-rec
            start takvim key > takvim-anah invalid continue
            not invalid
            read takvim next no lock end
              continue
              not end
               move takvim-anah to bas-tarih
            end-read
            end-start
            move high-values to takvim-anah
            start takvim key < takvim-anah invalid continue
            not invalid
            read takvim previous no lock end
              continue
              not end
               move takvim-anah to bit-tarih
            end-read
            end-start

            close takvim
            move bit-yil to bas-yil

            move " Bu anlasma kodundaki tum peryotlar kopyalanacaktir" to la1(13:)
            move "Lutfen kopyalanacak anlasma kodunu giriniz"  to la2    

               perform acu-form4-routine
             if kabul =1  then
                       modify tr,  visible = 0
                       perform pre-kop
                       perform  tum-anlasma-fiyatlari-kopyala
                     perform post-kop


                    
                     modify tr,  visible = 1
*                     perform  tree-refresh
             end-if.


*
  tum-anlasma-fiyatlari-bul.
     open input  kodlar02
     initialize  fiyatana-rec son-dig2
     open input  fiyatana
     move acenta-kodu  to hedef-acenta
     move kaynak-acenta to fiyatana-acenta

     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
                     
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                     not end
                        if fiyatana-acenta <> kaynak-acenta or 
                           fiyatana-ilk-tarih <  bas-tarih or



                           fiyatana-son-tarih >  bit-tarih   then
                                   move "10" to fs-fiyatana
                               else
                         if FIYATANA-ANLASMA = kaynak-anlasma
                           if fiyatana-diger-anah not = son-dig2
                             move fiyatana-diger-anah    to son-dig2
                                     perform tek-anlasma-kont4
                                     if fiy-eh = 1 then move "10" to fs-fiyatana end-if
                                     end-if
                         end-if  
                         end-if
                  end-read
            end-perform
      end-start
    close  fiyatana kodlar02.
          
*
*
 tum-anlasma-fiyatlari-kopyala.
      
     open input  kodlar02 takvim
     initialize  fiyatana-rec son-dig2
     open i-o  fiyatana fiyat
     move bas-tarih    to fiyatana-ilk-tarih
     move acenta-kodu  to hedef-acenta
     move kaynak-acenta to fiyatana-acenta
     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                      not end
                        if fiyatana-acenta    <> kaynak-acenta    or 
                           fiyatana-ilk-tarih <  bas-tarih or
                           fiyatana-son-tarih >  bit-tarih   then 
                                   move "10" to fs-fiyatana
                               else
                            if FIYATANA-ANLASMA = kaynak-anlasma
                             if fiyatana-diger-anah not = son-dig2
                                move     fiyatana-diger-anah    to son-dig2
                                perform  tek-anlasma-kopyala                                                          
                              end-if
                             end-if
                          end-if  
                   end-read
            end-perform
      end-start
    close  fiyatana kodlar02 takvim fiyat.
*



*
  periyod-fiyatlari-bul.
     open input  kodlar02
     initialize  fiyatana-rec son-dig2
     open input  fiyatana
     move hid(02:04)  to kaynak-acenta    fiyatana-acenta 
     move hid(06:08)  to kaynak-ilk-tarih fiyatana-ilk-tarih 
     move hid(14:08)  to kaynak-son-tarih fiyatana-son-tarih 
     move acenta-kodu to hedef-acenta

     move bas-tarih   to hedef-ilk-tarih
     move bit-tarih   to hedef-son-tarih

     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
                     
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                     not end
                        if fiyatana-acenta <> kaynak-acenta or 
                           fiyatana-ilk-tarih <> kaynak-ilk-tarih or
                           fiyatana-son-tarih <> kaynak-son-tarih  then 
                                   move "10" to fs-fiyatana
                               else
                         if fiyatana-diger-anah not = son-dig2
                             move fiyatana-diger-anah    to son-dig2
                                     perform tek-anlasma-kont3
                                     if fiy-eh = 1 then move "10" to fs-fiyatana end-if
                                     end-if
                         end-if  
                     
                  end-read
            end-perform
      end-start

    close  fiyatana kodlar02.
          
*
*
 periyod-fiyatlari-kopyala.
            modify c-bag visible = false 
            modify form4-La-2 visible = false
            modify accept-0101aa visible = false
            modify form4-Pb-1 visible = false
            modify Form1-La-5 visible = false
     open input  kodlar02 takvim
     initialize  fiyatana-rec son-dig2
     open i-o  fiyatana fiyat
     move hid(06:8)  to kaynak-ilk-tarih fiyatana-ilk-tarih
     move hid(14:8)  to kaynak-son-tarih fiyatana-son-tarih
     move acenta-kodu  to hedef-acenta
     move bas-tarih     to hedef-ilk-tarih
     move bit-tarih     to hedef-son-tarih
     move kaynak-acenta to fiyatana-acenta
     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                      not end
                        if fiyatana-acenta    <> kaynak-acenta    or 
                           fiyatana-ilk-tarih <> kaynak-ilk-tarih or
                           fiyatana-son-tarih <> kaynak-son-tarih   then 
                                   move "10" to fs-fiyatana
                               else
                             if fiyatana-diger-anah not = son-dig2
                                move     fiyatana-diger-anah    to son-dig2
                                perform  tek-anlasma-kopyala                                                          
                                     
                              end-if
                          end-if  
                     
                  end-read
            end-perform
      end-start
    close  fiyatana kodlar02 takvim fiyat.
*

         .
*
 periyod-kopyala.

            initialize acuserve-gizle
            move 1    to acuserve-gizle
                 
            move 1 to vis-1 vis-2
            move 0 to vis-3 dis4-1 kabul vis-4  tum-peryot    tarih-at

            initialize acenta-adi ac-kont bas-tarih bit-tarih
            move hid(02:04)   to acenta-kodu
            move hid(14:08)   to bas-tarih
            perform sonraki-bul
            move bas-tarih to bit-tarih
            inquire tr, item = per-po, item-text in la1  
            move " peryodundaki tum fiyat anlasmalari kopyalanacaktir" to la1(13:)
            move "Lutfen kopyalanacak periyodu giriniz"  to la2    
              
                 perform acu-form4-routine
             if kabul =1  then
                
                      

                        modify tr,  visible = 0
                        perform pre-kop
                       perform  periyod-fiyatlari-kopyala
                     perform post-kop
                    
                     modify tr,  visible = 1
*                     perform  tree-refresh
             end-if
          

         
         .
*
 anlasma-kopyala.
         modify btncoklu-secim , enabled = true
         move 1 to vis-1 vis-2 vis-3  vis-4
            move 0 to dis4-1 kabul  tum-peryot
            move 1 to tarih-at
            initialize acenta-adi ac-kont bas-tarih bit-tarih
            move hid(02:04)   to acenta-kodu
            move hid(06:08)   to bas-tarih
            move hid(14:08)   to bit-tarih
            move hid(22:1)    to acc-rez-tipi-value
            move hid(23:2)    to acc-pan-kodu-value
            move hid(25:2)    to banka-kodu
            move hid(27:2)    to doviz-kodu
            move hid(29:2)    to acc-anlasma-kodu-value

            
            move " Asagidaki anlasma  kopyalanacaktir" to la1
            move "Lutfen kopyalanacak anlasmayi giriniz"  to la2    
                 perform acu-form4-routine
             if kabul =1  then
                       
                       perform pre-kop
                     perform  anlasma-fiyatlari-kopyala
                     perform post-kop

                     modify tr,  visible = 1
                    
*                     perform tree-refresh
             end-if
          
         .
*
 pre-kop.
              open i-o acenta 
                       modify tr,  visible = 0
                       read acenta no lock invalid 
                          display message box "Hatali islem"
                       not invalid    
                           move acenta-kodu to oto-bakim-acenta
                          if genel-acenta-oto-fiy-bakim-yapma <> 1
                           move 1 to acenta-pasif                
                           rewrite acenta-rec invalid continue end-rewrite
                           perform log-operation-acenta
                          end-if 
                       end-read
                       close acenta.

* 
 post-kop.
      if genel-acenta-oto-fiy-bakim-yapma <> 1
         move  oto-bakim-acenta to acenta-kodu
         perform acenta-bakim
      end-if
      .

 
 form4-ok-prc.
        move 1 to kabul   
        move yeni-fiyat to yeni-fiyat-sayi
        move eski-fiyat to eski-fiyat-sayi
        compute carpan rounded = yeni-fiyat-sayi / eski-fiyat-sayi
*/*/*/eski hali bu ўekilde delphin istek /ramazan/
*/***/*compute carpan  = yeni-fiyat-sayi / eski-fiyat-sayi
*/*/*/*/29-11-2018 tolga agaoglu
        .
*
 eskileri-sil-p.
       open i-o fiyatana fiyat
       initialize fiyatana-rec
     
       move acenta-kodu to fiyatana-acenta
        start fiyatana key >= fiyatana-anah invalid continue
         not invalid
       perform until fs-fiyatana = "10" 
          read fiyatana next no lock end move "10" to fs-fiyatana
             not end
               if fiyatana-acenta not = acenta-kodu 
                  exit perform
               else
                  delete fiyatana end-delete
                  perform log-operation-fiyatana          ||| firat 19-10-2019
               end-if
               end-read
       end-perform
       end-start.
       initialize fiyat-rec
       move acenta-kodu to fiyat-acenta
         start fiyat key >= fiyat-anah invalid continue
         not invalid
       perform until fs-fiyat = "10" 
          read fiyat next no lock end move "10" to fs-fiyat
             not end
               if fiyat-acenta not = acenta-kodu
                  exit perform
                  else
                  delete fiyat end-delete
               end-if
               end-read
       end-perform
       end-start
       close fiyatana fiyat.

      .

*
 acc-acenta-Aft-Procedure1.
     initialize gec-gecme.
      if tr-sec(1:6) not = "------" and tr-sec(1:6) not = spaces then 
           display message box "Cakisma Kontrolu uygulanmayacaktir"  title "DIKKAT"
             move 1 to dis4-1
              display Form1-Pb-1a
           exit paragraph
      end-if
    

     if hid(2:4) = acenta-kodu and hid(1:1) = "A" and sir-tr = 0 then 

             move 0 to dis4-1
             display message box "Ayni acentaya kopyalayamazsiniz"
     else
               
             open input acenta 
             read acenta no lock invalid
                          move 1 to gec-gecme
                          move "Tanimsiz ..."   to acenta-adi
                          move 0 to dis4-1
                  not invalid 
                     if eskileri-sil = 1 and hid(1:1) = "A" 
                       perform eskileri-sil-p

                    end-if
                    if hid(1:1) = "A" then       
                         move 2 to  fiy-eh 
                         move 0 to kabul
                         if sir-tr = 1 
                            continue
                            else
                         perform acenta-fiyatlari-bul
                         if fiy-eh = 1 then 
                             move 0 to dis4-1  
                           else
                             move 1 to dis4-1
                         end-if 
                         end-if
                       else                  
                             move 0 to dis4-1
                         end-if
             end-read
             display lb-acenta-adia
             close acenta
     end-if

     display Form1-Pb-1a.

        .
*
 acenta-fiyatlari-bul.
     open input  kodlar02
     initialize  fiyatana-rec son-dig2
     open input  fiyatana
     move hid(2:4) to kaynak-acenta 
     move acenta-kodu to hedef-acenta
     move kaynak-acenta to fiyatana-acenta
     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
                     
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                     not end
                     if fiyatana-acenta    <> kaynak-acenta   then 
                                   move "10" to fs-fiyatana
                               else
                         if fiyatana-diger-anah not = son-dig2
                             move fiyatana-diger-anah    to son-dig2
                                     perform tek-anlasma-kont2
                                     if fiy-eh = 1 then move "10" to fs-fiyatana end-if
                                     end-if
                          end-if  
                     
                  end-read
            end-perform
      end-start
    close  fiyatana kodlar02.
    .

    .
 anlasma-fiyatlari-bul.
     open input  kodlar02
     initialize  fiyatana-rec son-dig2
     open input  fiyatana
     move hid(02:04)     to kaynak-acenta    fiyatana-acenta 
     move hid(06:08)     to kaynak-ilk-tarih fiyatana-ilk-tarih 
     move hid(14:08)     to kaynak-son-tarih fiyatana-son-tarih 
     move hid(22:1)      to kaynak-rez-tipi  fiyatana-rez-tipi
     move hid(23:2)      to kaynak-pan-tipi  fiyatana-pan-tipi
     move hid(25:2)      to kaynak-banka     fiyatana-banka
     move hid(27:2)      to kaynak-doviz     fiyatana-doviz
     move hid(29:2)      to kaynak-anlasma   fiyatana-anlasma 
     move acenta-kodu             to hedef-acenta
     move bas-tarih               to hedef-ilk-tarih
     move bit-tarih               to hedef-son-tarih
     move acc-rez-tipi-value      to hedef-rez-tipi
     move acc-pan-kodu-value      to hedef-pan-tipi
     move banka-kodu              to hedef-banka
     move doviz-kodu              to hedef-doviz
     move acc-anlasma-kodu-value  to hedef-anlasma

     
     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
                     
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                     not end
                        if fiyatana-acenta <> kaynak-acenta or 
                           fiyatana-ilk-tarih <> kaynak-ilk-tarih or
                           fiyatana-son-tarih <> kaynak-son-tarih or
                           fiyatana-rez-tipi  <> kaynak-rez-tipi  or
                           fiyatana-pan-tipi  <> kaynak-pan-tipi  or
                           fiyatana-banka     <> kaynak-banka     or
                           fiyatana-doviz     <> kaynak-doviz     or
                           fiyatana-anlasma   <> kaynak-anlasma   then 
                                   
                           
                           
                           
                           move "10" to fs-fiyatana
                               else
                         if fiyatana-diger-anah not = son-dig2
                             move fiyatana-diger-anah    to son-dig2
     
************************                                     
        move 2 to fiy-eh 
        open i-o   fiyat
        initialize fiyat-rec
        move hedef-acenta             to fiyat-acenta
        move hedef-ilk-tarih            to fiyat-tarih
        move hedef-rez-tipi     to fiyat-rez-tipi
        move hedef-pan-tipi     to fiyat-pan-tipi
        move hedef-banka             to fiyat-banka
        move hedef-doviz             to fiyat-doviz
        move hedef-anlasma         to   fiyat-anlasma
        start fiyat key not < fiyat-anah invalid
              move 2 to fiy-eh
        not invalid
        perform until fs-fiyat= "10"

        read fiyat next no lock end
             move "10" to fs-fiyat
             move 2    to fiy-eh
           not at end
                    if   acenta-kodu           =  fiyat-acenta    and
                       ( hedef-ilk-tarih      <=  fiyat-tarih     and  
                         hedef-son-tarih      >=  fiyat-tarih )   and
                         hedef-rez-tipi        =  fiyat-rez-tipi  and
                         hedef-pan-tipi        =  fiyat-pan-tipi  and
                         hedef-banka           =  fiyat-banka     and
                         hedef-doviz           =  fiyat-doviz     and
                         hedef-anlasma         =  fiyat-anlasma  and
                        (k-tfiyat-bas-tar <= fiyat-tarih and 
                         k-tfiyat-bit-tar >= fiyat-tarih ) then
                             move 1 to fiy-eh
                             perform acu-form2-routine
                              move "10" to fs-fiyat
                    end-if
                    if  acenta-kodu              <>  fiyat-acenta    or
                        hedef-son-tarih          <   fiyat-tarih     or
                        hedef-rez-tipi           <>  fiyat-rez-tipi  or
                        hedef-pan-tipi           <>  fiyat-pan-tipi  or
                        hedef-banka              <>  fiyat-banka     or
                        hedef-doviz              <>  fiyat-doviz     or
                        hedef-anlasma            <>  fiyat-anlasma
                             move "10" to fs-fiyat
                    end-if
        end-read                                             

        end-perform
        end-start
        close fiyat 
         
    
                                     
                                     
                                     
                                     
                                     
************************             
                                     if fiy-eh = 1 then move "10" to fs-fiyatana end-if
                                     end-if
                          end-if  
                     
                  end-read
            end-perform
      end-start
    close  fiyatana kodlar02.
    .
*
tek-anlasma-kont2.
        move 2 to fiy-eh 
        open i-o   fiyat
        initialize fiyat-rec
        move hedef-acenta             to fiyat-acenta
        move bas-tarih2            to fiyat-tarih
     
*        move acc-rez-tipi-value2     to fiyat-rez-tipi
*        move acc-pan-kodu-value2     to fiyat-pan-tipi
*        move banka-kodu2             to fiyat-banka
*        move doviz-kodu2             to fiyat-doviz
*        move acc-anlasma-kodu-value2 to fiyat-anlasma
        start fiyat key not < fiyat-anah invalid
              move 2 to fiy-eh
        not invalid
        perform until fs-fiyat= "10"

        read fiyat next no lock end
             move "10" to fs-fiyat
             move 2    to fiy-eh
           not at end
                    if   acenta-kodu             =  fiyat-acenta    and
                       ( bas-tarih2             <=  fiyat-tarih     and  
                         bit-tarih2             >=  fiyat-tarih )   and
                        acc-rez-tipi-value2      =  fiyat-rez-tipi  and
                        acc-pan-kodu-value2      =  fiyat-pan-tipi  and
                        function numval(banka-kodu2)              =  fiyat-banka     and
                        doviz-kodu2              =  fiyat-doviz     and
                        acc-anlasma-kodu-value2  =  fiyat-anlasma and
                        (k-tfiyat-bas-tar <= fiyat-tarih and 
                         k-tfiyat-bit-tar >= fiyat-tarih ) then
                             move 1 to fiy-eh
                             perform acu-form2-routine
                             move "10" to fs-fiyat
                    end-if
                    if  acenta-kodu2             <>  fiyat-acenta    or
                        bit-tarih2               <   fiyat-tarih     or
                        acc-rez-tipi-value2      <>  fiyat-rez-tipi  or
                        acc-pan-kodu-value2      <>  fiyat-pan-tipi  or
                        function numval(banka-kodu2)              <>  fiyat-banka     or
                        doviz-kodu2              <>  fiyat-doviz     or
                        acc-anlasma-kodu-value2  <>  fiyat-anlasma
                             move "10" to fs-fiyat
                    end-if
        end-read
        end-perform
        end-start
        close fiyat 
         .
 
tek-anlasma-kont3.
        move 2 to fiy-eh 
        open i-o   fiyat
        initialize fiyat-rec
        move hedef-acenta             to fiyat-acenta
         
             move hedef-ilk-tarih            to fiyat-tarih

*        move acc-rez-tipi-value2     to fiyat-rez-tipi
*        move acc-pan-kodu-value2     to fiyat-pan-tipi
*        move banka-kodu2             to fiyat-banka
*        move doviz-kodu2             to fiyat-doviz
*        move acc-anlasma-kodu-value2 to fiyat-anlasma
        start fiyat key not < fiyat-anah invalid
              move 2 to fiy-eh
        not invalid
        perform until fs-fiyat= "10"

        read fiyat next no lock end
             move "10" to fs-fiyat
             move 2    to fiy-eh
           not at end
                    if   acenta-kodu             =  fiyat-acenta    and
                       ( hedef-ilk-tarih        <=  fiyat-tarih     and  
                         hedef-son-tarih        >=  fiyat-tarih )   and
                        acc-rez-tipi-value2      =  fiyat-rez-tipi  and
                        acc-pan-kodu-value2      =  fiyat-pan-tipi  and
                        function numval(banka-kodu2)              =  fiyat-banka     and
                        doviz-kodu2              =  fiyat-doviz     and
                        acc-anlasma-kodu-value2  =  fiyat-anlasma and
                        (k-tfiyat-bas-tar <= fiyat-tarih and 
                         k-tfiyat-bit-tar >= fiyat-tarih ) then 
                        
                             move 1 to fiy-eh
                             perform acu-form2-routine
                             move "10" to fs-fiyat
                    end-if
                    if  acenta-kodu2             <>  fiyat-acenta    or
                        hedef-son-tarih          <   fiyat-tarih     or
                        acc-rez-tipi-value2      <>  fiyat-rez-tipi  or
                        acc-pan-kodu-value2      <>  fiyat-pan-tipi  or
                        function numval(banka-kodu2)              <>  fiyat-banka     or
                        doviz-kodu2              <>  fiyat-doviz     or
                        acc-anlasma-kodu-value2  <>  fiyat-anlasma
                             move "10" to fs-fiyat
                    end-if
        end-read
        end-perform
        end-start
        close fiyat 
         .
    
*
 tek-anlasma-kont4.
        move 2 to fiy-eh 
        open i-o   fiyat
        initialize fiyat-rec
        move hedef-acenta             to fiyat-acenta
        move bas-tarih2     to  FIYAT-TARIH.
        move kaynak-rez-tipi    to  FIYAT-REZ-TIPI   
        move kaynak-pan-tipi    to  FIYAT-PAN-TIPI  
        move kaynak-banka       to  FIYAT-BANKA  
        move kaynak-doviz       to  FIYAT-DOVIZ   
        move hedef-anlasma      to  FIYAT-ANLASMA    
       

        start fiyat key not < fiyat-anah invalid
              move 2 to fiy-eh
        not invalid
        perform until fs-fiyat= "10"

        read fiyat next no lock end
             move "10" to fs-fiyat
             move 2    to fiy-eh
           not at end
                    if   acenta-kodu             =  fiyat-acenta    and
                       ( bas-tarih2        <=  fiyat-tarih     and  
                         bit-tarih2       >=  fiyat-tarih )   and
                        kaynak-rez-tipi          =  fiyat-rez-tipi  and
                        kaynak-pan-tipi          =  fiyat-pan-tipi  and
                        kaynak-banka             =  fiyat-banka     and
                        kaynak-doviz             =  fiyat-doviz     and
                        hedef-anlasma            =  fiyat-anlasma  and
                        (k-tfiyat-bas-tar <= fiyat-tarih and 
                         k-tfiyat-bit-tar >= fiyat-tarih ) then
                             move 1 to fiy-eh
                             perform acu-form2-routine
                             move "10" to fs-fiyat
                    end-if
                    if  acenta-kodu2             <>  fiyat-acenta    or
                        bit-tarih2          <   fiyat-tarih     or
                        kaynak-rez-tipi       <>  fiyat-rez-tipi  or
                        kaynak-pan-tipi      <>  fiyat-pan-tipi  or
                        kaynak-banka            <>  fiyat-banka     or
                        kaynak-doviz             <>  fiyat-doviz     or
                        hedef-anlasma   <>  fiyat-anlasma
                             move "10" to fs-fiyat
                    end-if
        end-read
        end-perform
        end-start
        close fiyat 
         .
        

*    
 tek-anlasma-kont.
        move 2 to fiy-eh 
        open i-o   fiyat
        initialize fiyat-rec
        move acenta-kodu            to fiyat-acenta
        move bas-tarih              to fiyat-tarih
        move acc-rez-tipi-value     to fiyat-rez-tipi
        move acc-pan-kodu-value     to fiyat-pan-tipi
        move banka-kodu             to fiyat-banka
        move doviz-kodu             to fiyat-doviz


        move acc-anlasma-kodu-value to fiyat-anlasma
        start fiyat key not < fiyat-anah invalid
              move 2 to fiy-eh
        not invalid
        perform until fs-fiyat= "10"

        read fiyat next no lock end
             move "10" to fs-fiyat
             move 2    to fiy-eh
           not at end
                    if   acenta-kodu            =  fiyat-acenta    and
                       ( bas-tarih             <=  fiyat-tarih     and  
                         bit-tarih             >=  fiyat-tarih )   and
                        acc-rez-tipi-value      =  fiyat-rez-tipi  and
                        acc-pan-kodu-value      =  fiyat-pan-tipi  and
                        function numval(banka-kodu)              =  fiyat-banka     and
                        doviz-kodu              =  fiyat-doviz     and
                        acc-anlasma-kodu-value  =  fiyat-anlasma   and
                        (k-tfiyat-bas-tar <= fiyat-tarih and 
                         k-tfiyat-bit-tar >= fiyat-tarih ) then


                             move 1 to fiy-eh
                             perform acu-form2-routine
                             move "10" to fs-fiyat
                    end-if
                    if  acenta-kodu             <>  fiyat-acenta    or
                        bit-tarih               <   fiyat-tarih     or
                        acc-rez-tipi-value      <>  fiyat-rez-tipi  or
                        acc-pan-kodu-value      <>  fiyat-pan-tipi  or
                        function numval(banka-kodu)              <>  fiyat-banka     or
                        doviz-kodu              <>  fiyat-doviz     or
                        acc-anlasma-kodu-value  <>  fiyat-anlasma 
                             move "10" to fs-fiyat
                    end-if
        end-read
        end-perform
        end-start
        close fiyat 
         .
 
*
 tek-anlasma-kopyala.
       
        perform until fiyatana-diger-anah not = son-dig2       
               move hedef-acenta to fiyatana-acenta
               if tum-peryot = 1 then 
                  move hedef-anlasma   to fiyatana-anlasma
               end-if
               if tarih-at =  1 
                   
                   if erken-enb = 1 
                          move "E"               to fiyatana-eb-eh
                          move erken-bas-tarih   to fiyatana-eb-bas-tarih
                          move erken-bit-tarih   to fiyatana-eb-bit-tarih
                          move erken-oran        to fiyatana-eb-oran
                          compute fiyatana-eb-kusur = ( erken-oran - fiyatana-eb-oran ) * 100
                       else
                          move "H"               to fiyatana-eb-eh
                       end-if
                       if ug-enb = 1 
                          move "E"           to fiyatana-ug-eh
                          move ug-geceleme   to fiyatana-ug-geceleme
                          move ug-oran       to fiyatana-ug-oran
                          compute fiyatana-ug-kusur = ( ug-oran - fiyatana-ug-oran ) * 100
                       else
                          move "H"               to fiyatana-ug-eh
                       end-if
                        move d-1yc    to fiyatana-d-1yc
                        move d-1yf    to fiyatana-d-1yf
                        move d-2yc    to fiyatana-d-2yc
                        move d-2yf    to fiyatana-d-2yf
        
        
        
                       move kick-oran            to fiyatana-kick-back
                       move kick-oran2            to fiyatana-kick-back2
                         move  kkp-onbink       to fiyatana-kkp-onbin 
                         move  kick-onbink      to   fiyatana-kick-onbin  

                       move k-kodu-tasi          to fiyatana-staf
                       move fiks                 to fiyatana-fiks
                       move hs-ug              to fiyatana-haftasonuvar
                     



               end-if
               if hid(1:1) = "P" then
                 if tum-peryot =  1 
                   move hedef-anlasma   to fiyatana-anlasma
                   move hedef-anlasma   to fiyatana-anlasma
                   if erken-enb = 1 
                          move "E"               to fiyatana-eb-eh
                          move erken-bas-tarih   to fiyatana-eb-bas-tarih
                          move erken-bit-tarih   to fiyatana-eb-bit-tarih
                          move erken-oran        to fiyatana-eb-oran
                          compute fiyatana-eb-kusur = ( erken-oran - fiyatana-eb-oran ) * 100
                       else
                          move "H"               to fiyatana-eb-eh
                       end-if
                       if ug-enb = 1 
                          move "E"           to fiyatana-ug-eh
                          move ug-geceleme   to fiyatana-ug-geceleme
                          move ug-oran       to fiyatana-ug-oran
                          compute fiyatana-ug-kusur = ( ug-oran - fiyatana-ug-oran ) * 100
                       else
                          move "H"               to fiyatana-ug-eh
                       end-if
                        move d-1yc    to fiyatana-d-1yc
                        move d-1yf    to fiyatana-d-1yf
                        move d-2yc    to fiyatana-d-2yc
                        move d-2yf    to fiyatana-d-2yf
        
                       
                       move kick-oran            to fiyatana-kick-back
                       move kick-oran2            to fiyatana-kick-back2
                         move  kkp-onbink       to fiyatana-kkp-onbin 
                       move  kick-onbink      to   fiyatana-kick-onbin  
                       move k-kodu-tasi          to fiyatana-staf
                       move fiks                 to fiyatana-fiks
                        move hs-ug              to fiyatana-haftasonuvar
                     

                   else
                      move hedef-ilk-tarih to fiyatana-ilk-tarih 
                      move hedef-son-tarih to fiyatana-son-tarih 
                   
                   end-if
               end-if
               perform varying kadk from 1 by 1 until kadk > 40
                 compute FIYATANA-ODA-FIYATI(kadk) rounded = FIYATANA-ODA-FIYATI(kadk) * carpan
               end-perform
               move k-kodu-tasi     to  fiyatana-staf
               
               write fiyatana-rec 
                       invalid 
********                       display message box "FiyatAna BEKLENMEYEN MDURUM4354355"
                          continue
               end-write
               perform log-operation-fiyatana

               move fiyatana-ilk-tarih   to takvim-anah
               start takvim key not < takvim-anah invalid
                     continue
               not invalid
               initialize fs-takvim
               perform with test after until fs-takvim = "10"
               read takvim next no lock end move "10" to fs-takvim
               not at end
                    if takvim-anah > fiyatana-son-tarih
                       move "10" to fs-takvim
                       exit perform
                    end-if

                       initialize fiyat-rec
                       move hedef-acenta           to fiyat-acenta
                       move takvim-anah            to fiyat-tarih
                       move fiyatana-rez-tipi      to fiyat-rez-tipi
                       move fiyatana-pan-tipi      to fiyat-pan-tipi
                       move fiyatana-banka         to fiyat-banka
                       move fiyatana-doviz         to fiyat-doviz
                       move fiyatana-anlasma       to fiyat-anlasma
                       move fiyatana-buyuk         to fiyat-buyuk
                       move fiyatana-kucuk         to fiyat-kucuk
                       if tum-peryot = 1  then 
                         continue
                       else
                       if hid(1:1) = "P" then
                              move hedef-ilk-tarih    to fiyat-bas-tarih 
                              move hedef-son-tarih    to fiyat-bit-tarih                    
                         else
                              move fiyatana-ilk-tarih to fiyat-bas-tarih
                              move fiyatana-son-tarih to fiyat-bit-tarih
                        end-if
                        end-if
                       write fiyat-rec invalid
                              continue
*********        display message box "BEKLENMEYEN DURUM543543"
                       end-write
                    
               end-read
               end-perform
               end-start
            read fiyatana next no lock 
                    end move "10" to fs-fiyatana 
                    exit perform
            end-read 

         end-perform.
          if fs-fiyatana not = "10" then 
                  read fiyatana previous 
                          end display message box "BEKLENMEYEN MDURUM 2fgdfg" 
                  end-read
           end-if.

               .
*
*
 tek-anlasma-kopyala-sirket.
          
        perform until fiyatana-diger-anah not = son-dig2 or fs-fiyatana = "10"
              move fiyatana-rec to fana2-rec 

               move hedef-acenta to fana2-acenta
               if tum-peryot = 1 then 
                      move hedef-anlasma   to fiyatana-anlasma
               end-if
               perform varying kadk from 1 by 1 until kadk > 40
                 compute Fana2-ODA-FIYATI(kadk) rounded = FIYATANA-ODA-FIYATI(kadk) * carpan
               end-perform
               move k-kodu-tasi     to  fana2-staf
               write fana2-rec 
                       invalid 
                             move 1 to sirkette-cakisti
                             rewrite  fana2-rec
                             invalid continue
                             end-rewrite
********                       display message box "FiyatAna BEKLENMEYEN MDURUM4354355"
                          continue
               end-write
                read fiyatana next no lock 
                    end move "10" to fs-fiyatana 
            end-read 
          end-perform.
          
*
 anlasma-fiyatlari-kopyala.
                 
     open input  kodlar02 takvim
     initialize  fiyatana-rec son-dig2
     open i-o  fiyatana fiyat
     move hid(02:4) to kaynak-acenta fiyatana-acenta
     inspect kaynak-acenta converting x"DD737E74" to x"A69A9899" |амнж
     inspect fiyatana-acenta converting x"DD737E74" to x"A69A9899" |амнж
     move hid(06:8) to kaynak-ilk-tarih fiyatana-ilk-tarih
     move hid(14:8) to kaynak-son-tarih fiyatana-son-tarih
     move hid(22:1) to kaynak-rez-tipi  fiyatana-rez-tipi
     move hid(23:2) to kaynak-pan-tipi  fiyatana-pan-tipi
     move hid(25:2) to kaynak-banka     fiyatana-banka
     move hid(27:2) to kaynak-doviz     fiyatana-doviz
     move hid(29:2) to kaynak-anlasma   fiyatana-anlasma 
     move acenta-kodu               to hedef-acenta
     move bas-tarih                 to hedef-ilk-tarih
     move bit-tarih                 to hedef-son-tarih
     move acc-rez-tipi-value        to hedef-rez-tipi
     move acc-pan-kodu-value        to hedef-pan-tipi
     move banka-kodu                to hedef-banka
     move doviz-kodu                to hedef-doviz
     move acc-anlasma-kodu-value    to hedef-anlasma     
     start fiyatana key >= fiyatana-anah invalid 
       continue
     not invalid
     perform until fs-fiyatana = "10"
     read fiyatana next no lock at end    
        move "10" to fs-fiyatana
     not end
          if fiyatana-acenta    <> kaynak-acenta    or 
             fiyatana-ilk-tarih <> kaynak-ilk-tarih or
             fiyatana-son-tarih <> kaynak-son-tarih or
             fiyatana-rez-tipi  <> kaynak-rez-tipi  or
             fiyatana-pan-tipi  <> kaynak-pan-tipi  or
             fiyatana-banka     <> kaynak-banka     or
             fiyatana-doviz     <> kaynak-doviz     or
             fiyatana-anlasma   <> kaynak-anlasma   
                     move "10" to fs-fiyatana
          else

          if coklu-secim-var = 1
             initialize ip coklu-secim-var
               perform varying ip 
                       from 1 
                       by 1 
                       until ip > 500
                          if link-arananlar(ip) = spaces 
                             exit perform 
                          end-if
                          if link-arananlar(ip) = kaynak-acenta
                              exit perform 
                          end-if 
                          move 1 to coklu-secim-var
                          move link-arananlar(ip) to hedef-acenta
                            perform anlasma-olustur            
               end-perform
          else
            if fiyatana-diger-anah not = son-dig2
               move fiyatana-diger-anah    to son-dig2
**********************
                 
               if coklu-secim-var not = 1 
                 perform anlasma-olustur
               end-if 
             
                                   
*             if fs-fiyatana not = "10" then 
*                  read fiyatana previous 
*                          end display message box "BEKLENMEYEN MDURUM 2546546" 
*                  end-read
*             end-if
************************************ 
          end-if           
          end-if 


       end-if                       
      end-read
      end-perform
      end-start

    close  fiyatana kodlar02 takvim fiyat.
*  
         .
*
 anlasma-olustur.
     if coklu-secim-var not = 1 
        perform until fiyatana-diger-anah not = son-dig2       
        perform anlasma-olustur-ic                
              read fiyatana next no lock 
                      end move "10" to fs-fiyatana 
              end-read 
        end-perform
     else
        perform anlasma-olustur-ic                     
     end-if.
*
 anlasma-olustur-ic.
     move hedef-acenta           to fiyatana-acenta
    move hedef-acenta           to fiyatana-acenta
    move hedef-ilk-tarih        to fiyatana-ilk-tarih
    move hedef-son-tarih        to fiyatana-son-tarih
    move hedef-rez-tipi         to fiyatana-rez-tipi
    move hedef-pan-tipi         to fiyatana-pan-tipi
    move hedef-banka            to fiyatana-banka
    move hedef-doviz            to fiyatana-doviz
    move hedef-anlasma          to fiyatana-anlasma
    
    perform varying kadk from 1 by 1 until kadk > 40
      compute FIYATANA-ODA-FIYATI(kadk) rounded = FIYATANA-ODA-FIYATI(kadk) * carpan
    end-perform
            if erken-enb = 1 
               move "E"               to fiyatana-eb-eh
               move erken-bas-tarih   to fiyatana-eb-bas-tarih
               move erken-bit-tarih   to fiyatana-eb-bit-tarih
               move erken-oran        to fiyatana-eb-oran
               compute fiyatana-eb-kusur = ( erken-oran - fiyatana-eb-oran ) * 100
            else
               initialize fiyatana-eb-bas-tarih  fiyatana-eb-bit-tarih fiyatana-eb-oran 
               move "H"               to fiyatana-eb-eh
            end-if
            if ug-enb = 1 
               move "E"           to fiyatana-ug-eh
               move ug-geceleme   to fiyatana-ug-geceleme
               move ug-oran       to fiyatana-ug-oran
               compute fiyatana-ug-kusur = ( ug-oran - fiyatana-ug-oran ) * 100
            else
               move "H"               to fiyatana-ug-eh
            end-if
             move d-1yc    to fiyatana-d-1yc
             move d-1yf    to fiyatana-d-1yf
             move d-2yc    to fiyatana-d-2yc
             move d-2yf    to fiyatana-d-2yf
    
    
    
             move kick-oran            to fiyatana-kick-back
             move kick-oran2           to fiyatana-kick-back2
             move  kkp-onbink       to fiyatana-kkp-onbin 
             move  kick-onbink      to   fiyatana-kick-onbin  
    
             move k-kodu-tasi          to fiyatana-staf
             move fiks                 to fiyatana-fiks
             move hs-ug                to fiyatana-haftasonuvar
          
    
         
    move k-kodu-tasi     to  fiyatana-staf
    write fiyatana-rec invalid 
           display message box "Hedef Anlasma Sistemde Kayitli..Kopyalama Islemi Yapilamadi.."
                           title "Uyari"
                           icon 1                         
    end-write
    perform log-operation-fiyatana
         
    move fiyatana-ilk-tarih   to takvim-anah
    start takvim key not < takvim-anah invalid
          continue
    not invalid
    initialize fs-takvim
    perform with test after until fs-takvim = "10"
    read takvim next no lock end move "10" to fs-takvim
    not at end
         if takvim-anah > fiyatana-son-tarih
            move "10" to fs-takvim
            exit perform
         end-if
    
            initialize fiyat-rec
            move hedef-acenta           to fiyat-acenta
            move takvim-anah            to fiyat-tarih
            move hedef-rez-tipi         to fiyat-rez-tipi
            move hedef-pan-tipi         to fiyat-pan-tipi
            move hedef-banka            to fiyat-banka
            move hedef-doviz            to fiyat-doviz
            move hedef-anlasma          to fiyat-anlasma
            move fiyatana-buyuk         to fiyat-buyuk
            move fiyatana-kucuk         to fiyat-kucuk
            move hedef-ilk-tarih        to fiyat-bas-tarih 
            move hedef-son-tarih        to fiyat-bit-tarih                    
            
            write fiyat-rec invalid
                 display message box "Hedef Anlasma Sistemde Kayitli..Kopyalama Islemi Yapilamadi.."
                                 title "Uyari"
                                 icon 1
            end-write
         
    end-read
    end-perform
    end-start.
*
 acenta-fiyatlari-kopyala.
        
      
     open input  kodlar02 takvim
     initialize  fiyatana-rec son-dig2
     open i-o  fiyatana fiyat
     move hid(2:4) to kaynak-acenta 
     move acenta-kodu   to hedef-acenta
     move kaynak-acenta to fiyatana-acenta
      if tr-sec(1:6) not = "------" then 
            open input aksiyon aksiyon2
            move tr-sec(1:8) to fana2-dosya-adres aks2-dosya-adres aks22-dosya-adres
            open i-o fana2 aks2 aks22
             perform  aksiyon-kopyala-tamam-sirket
         end-if
   
     start fiyatana key > fiyatana-anah 
         invalid continue
         not invalid
                     
            perform until fs-fiyatana = "10"
                 read fiyatana next no lock 
                    at end    
                      move "10" to fs-fiyatana
                     not end
                        if fiyatana-acenta    <> kaynak-acenta      then 
                                   move "10" to fs-fiyatana
                               else
                             if fiyatana-diger-anah not = Son-Dig2
                                    move fiyatana-diger-anah    to son-dig2
                                    if tr-sec(1:6) not = "------" then 
                                        perform tek-anlasma-kopyala-sirket   
                                    else
*/*************************** emine istek */*************************************************
                                       if (k-tfiyat-bas-tar <= fiyatana-son-tarih and 
                                           k-tfiyat-bit-tar >= fiyatana-ilk-tarih ) then
                                            perform tek-anlasma-kopyala       
                                       end-if 
*/*************************** emine istek */*************************************************
                                    end-if  
                              end-if
                          end-if  
                     
                  end-read
            end-perform
      end-start
    close  fiyatana kodlar02 takvim fiyat.



     if tr-sec(1:6) not = "------" then 
           close aksiyon aksiyon2   fana2 aks2 aks22
           
          else
           initialize tr-sec
     end-if
     
    display message box "Acenta Fiyatlari kopyalandi" new-line 
        tr-sec title "  "

        .

*
 aksiyon-kopyala-tamam-sirket.
      
     
       initialize aksiyon-rec
       move "A" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "A" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                          move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read

                        
                        move aksiyon-rec to aks2-rec
                        move aksiyon2-rec to aks22-rec

                         move hedef-acenta to aks22-acenta
                         move hedef-acenta to aks2-acenta
                        write aks2-rec 
                           invalid 
                               rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                        write aks22-rec 
                            invalid rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                    end-if
                 end-if
              end-read
           end-perform
        end-start
        initialize aksiyon-rec
       move "B" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "B" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                          move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read

                        
                        move aksiyon-rec to aks2-rec
                        move aksiyon2-rec to aks22-rec

                           move hedef-acenta to aks22-acenta
                         move hedef-acenta to aks2-acenta
                        write aks2-rec 
                           invalid 
                               rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                        write aks22-rec 
                            invalid rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                    end-if
                 end-if
              end-read
           end-perform
        end-start
           initialize aksiyon-rec
       move "P" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "P" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                          move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read

                        
                        move aksiyon-rec to aks2-rec
                        move aksiyon2-rec to aks22-rec

                          move hedef-acenta to aks22-acenta
                         move hedef-acenta to aks2-acenta
                         write aks2-rec 
                           invalid 
                               rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                        write aks22-rec 
                            invalid rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                    end-if
                 
                 end-if
              end-read
           end-perform
        end-start
       initialize aksiyon-rec
       move "O" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "O" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                          move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read

                        
                        move aksiyon-rec to aks2-rec
                        move aksiyon2-rec to aks22-rec

                          move hedef-acenta to aks22-acenta
                         move hedef-acenta to aks2-acenta
                        write aks2-rec 
                           invalid 
                               rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                        write aks22-rec 
                            invalid rewrite aks2-rec invalid continue
                               end-rewrite
                        end-write
                        
                    end-if
                 
                 end-if
              end-read
           end-perform
        end-start
       
        
          .
 
*
  tree-refresh.
           
      move hid to hid-yeri

      modify tr, reset-list = 1  
          visible = 0
       
       
       initialize acenta-kodu
       perform tree-doldur
        modify tr,  visible = 1
       

*       perform tree-yer-bul
     .
* 
 tree-yer-bul.
      if hid-yeri not = spaces then 

            perform until hid = hid-yeri
                modify tr, next-item = tvni-next giving ace-po
                modify tr, value =ace-po
                inquire tr, item = ace-po, hidden-data in hid
                if hid = hid-yeri then
                    modify tr, item = ace-po, expand = tvflag-expand   
                end-if
            end-perform
       end-if  
         .   
 anlasma-ekle-gel.

    move hid(02:4) to acenta-kodu
    inspect acenta-kodu converting x"DD737E74" to x"A69A9899" |амнж
    move hid(06:4) to bas-yil
    move hid(10:2) to bas-ay
    move hid(12:2) to bas-gun
    move hid(14:4) to bit-yil
    move hid(18:2) to bit-ay
    move hid(20:2) to bit-gun
    move hid(22:1) to acc-rez-tipi-value
    move hid(23:2) to acc-pan-kodu-value
    move hid(25:2) to banka-kodu
    move hid(27:2) to doviz-kodu
    move hid(29:2) to acc-anlasma-kodu-value
    move 1 to dis-1
    move 0 to dis-2
    perform grid-bosalt
    perform  form-yaz
    move 4 to control-id
    move 4 to accept-control 
      
    .   
 tamami-disle.
      move 0 to dis4-1

            display Form1-Pb-1a
         .
 ilk-form4.
     move 1 to carpan eski-fiyat yeni-fiyat 
     move 0 to vis-carpan yeni-anlasma-olarak-at
     initialize eski-bas-tarih eski-bit-tarih
             yeni-bas-tarih yeni-bit-tarih
     

      .
 Beklet.
     add 1 to  yuzde 
*     accept OMITTED time 0.
     .
 check-after.
      
      inquire form4-cb-1 value in check-val .
            if check-val = 0 then 
         move 0 to vis-carpan
         display form4-la-1, form4-la-1a, form4-ef-1, form4-ef-1a
         move 1 to eski-fiyat yeni-fiyat
         
         else
         move 1 to vis-carpan
         display form4-la-1, form4-la-1a, form4-ef-1, form4-ef-1a
         
         move 29 to control-id
         move 4 to accept-control
         end-if
         .
 sifir-olmaz.
      if eski-fiyat = 0 then  
       display message box "Bu bolume sifir girilmez"
       move 1 to eski-fiyat
      end-if
    
     .
 rez-kopyala.
     move hid(2:4) to rez-kaynak-acenta acenta-kodu
         open input acenta 
    read acenta no lock not invalid 
        move acenta-adi to yap-ace  kaynak-acenta-adi
    end-read 
    close acenta
    CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1006, W-ENABLED, yap-menu, 1006 
     .
 rez-yapistir.
*    move 1 to vis-beklet
*    display label-beklet
    move hid(2:4) to rez-hedef-acenta acenta-kodu
    CALL "W$MENU" USING WMENU-change, 
                       Menu-Handle, 1006, W-DISABLED, "Rezervasyon Kopyala", 1006 
    open input acenta 
    read acenta no lock not invalid 
        move acenta-adi to hedef-acenta-adi
    end-read 
    close acenta
    initialize hedef-sayisi kaynak-sayisi rez-sayisi

    move rez-kaynak-acenta to acenta-kodu 
    perform rez-sayisi-bul 
    move rez-sayisi to kaynak-sayisi
    initialize rez-sayisi
    move rez-hedef-acenta to acenta-kodu 
    perform rez-sayisi-bul 
    move rez-sayisi to hedef-sayisi
    
    initialize rez-acik1 rez-acik2
    string kaynak-acenta-adi delimited by space
           " acentasina ait "           delimited by "№"
           kaynak-sayisi     delimited by "№" 
           " kayitli rezervasyon"    delimited by "№"
                 into rez-acik1
     string hedef-sayisi     delimited by "№"
           " kayitli rezarvasyonu olan " delimited by "№"
           hedef-acenta-adi delimited by space
           " acentasina kopyalanacaktir"           delimited by "№"
                 into rez-acik2

*   move 0 to vis-beklet
*   display label-beklet
    
    display message box rez-acik1 H"0A" rez-acik2 
    H"0A" "DEVAM ETMEK ISTEDIGINIZE EMIN MISINIZ?"
    title "DIKKAT" type mb-ok-cancel icon mb-warning-icon 
    default mb-cancel giving rez-ok.
 
    if rez-ok = mb-ok then 
*    move 1 to vis-beklet
*    display label-beklet

       open i-o rez   

            initialize rez-rec  
            move rez-kaynak-acenta to rez-acenta
            move "I" to rez-durumu
            start rez key not < rez-acen invalid 
                  continue
                 not invalid
                 perform until fs-rez = "10"
                      read rez next end move "10" to fs-rez
                          not end
                             if rez-acenta = rez-kaynak-acenta then
                                   move rez-hedef-acenta to rez-acenta 

                                  accept rez-edit-tarih from century-date  |firat amonra iчin konuldu 03/11/2020
                                  accept rez-edit-zaman from time          |                           

                                   rewrite rez-rec invalid 
                                           display message box "BEKLENMEYEN MDURUM 436346g"
                                   end-rewrite
                                 else
                                  move "10" to fs-rez
                             end-if
                      end-read
                 end-perform
            end-start
            close rez
*    move 0 to vis-beklet
*    display label-beklet
     end-if
    .

 rez-sayisi-bul.
     open input rez   

    initialize rez-rec  
    move acenta-kodu to rez-acenta
    move "I" to rez-durumu
    start rez key not < rez-acen invalid 
          continue
         not invalid
         perform until fs-rez = "10"
              read rez next end move "10" to fs-rez
                  not end
                     if rez-acenta = acenta-kodu then
                         add  1 to rez-sayisi
                        else
                          move "10" to fs-rez
                     end-if
              end-read
         end-perform
    end-start
    close rez
     .
*
 refreshle.
      perform tree-refresh
     .
*
 cb-1a-Ex-Cmd-Clicked.
       display acc-10a acc-16a .
*
*
 cb-1a-Ex-Cmd-Clicked2.
       display acc-10aa acc-16aa
     .
*
 f-acenta-after.
      if filtre-acenta = spaces then 
           move "Tum acentalar" to acenta-adi 
        else
           move filtre-acenta to acenta-kodu
           open input acenta
           read acenta no lock 
               invalid
                  display message box "Tanimsiz Acenta"
                  move 4 to accept-control
               not invalid 
                 continue
           end-read
           close acenta
     end-if
          display lb-acenta-adiaa   
     .
*
 suzme-tamam-click.
     if aksi-flag  = 1 then 
        perform    aksiyon-kopyala-tamam
      else  
     
     if k-tfiyat-bas-tar > k-tfiyat-bit-tar then
        display message box "Baslangic Tarihi Bitis Tarihinden kucuk olamaz"
       else
         rewrite kllnc-rec
         perform refreshle
        set exit-pushed to true
     end-if
     end-if
     .
*
 f-acenara.
      if key-status = 1 then 
               initialize link-acenta
               call "/asya/ytl/obj/otel/acenara.asy"
                   using link-acenta
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy"
                        if link-acenta <> spaces
                           move link-acenta to filtre-acenta
                           display lf-acenta
                        end-if
               end-call
     end-if
     .
*
 aksiyon-kopyala.
             move 1 to aksi-flag
            initialize acenta-rec
               move k-kodu-tasi to k-kodu
              if k-tfiyat-bas-tar < "19000000"
                 move "20050101" to k-tfiyat-bas-tar
                end-if
              if k-tfiyat-bit-tar < "19000000"
                 move "20153112" to k-tfiyat-bit-tar
             end-if
             perform acu-form5-routine 
                  initialize aksi-flag
   
     .
 aksiyon-kopyala-tamam.
       if k-tfiyat-bas-tar > k-tfiyat-bit-tar then
        display message box "Baslangic Tarihi Bitis Tarihinden dusuk olamaz"
       else
       open i-o aksiyon aksiyon2 
       initialize aksiyon-rec
       move "A" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "A" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                          move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read
                         move filtre-acenta to aksiyon2-acenta
                        write aksiyon2-rec 
                           invalid continue
                        end-write
                        move filtre-acenta to aksiyon-acenta
                        write aksiyon-rec 
                            invalid display message box "Cakisti"
                        end-write
                        perform log-operation-aksiyon
                    end-if
                 end-if
              end-read
           end-perform
        end-start
        initialize aksiyon-rec
       move "B" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "B" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                          move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read
                         move filtre-acenta to aksiyon2-acenta
                        write aksiyon2-rec 
                           invalid continue
                        end-write
                        move filtre-acenta to aksiyon-acenta
                        write aksiyon-rec 
                            invalid display message box "Cakisti"
                        end-write
                        perform log-operation-aksiyon
                    end-if
                 end-if
              end-read
           end-perform
        end-start
           initialize aksiyon-rec
       move "P" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "P" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                        move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read
                         move filtre-acenta to aksiyon2-acenta
                        write aksiyon2-rec 
                           invalid continue
                        end-write

                        move filtre-acenta to aksiyon-acenta
                        write aksiyon-rec 
                            invalid display message box "Cakisti"
                        end-write
                        perform log-operation-aksiyon
                    end-if
                 end-if
              end-read
           end-perform
        end-start
       initialize aksiyon-rec
       move "O" to aksiyon-tipi
       move hid(2:4) to kaynak-acenta aksiyon-acenta 
       
       start aksiyon key > aksiyon-anah
          invalid continue
          not invalid 
          perform until fs-aksiyon = "10"
            read aksiyon next no lock 
              end
                move "10" to fs-aksiyon
              not end
                if aksiyon-tipi not = "O" or
                   aksiyon-acenta not = kaynak-acenta then
                   move "10" to fs-acenta
                   else
                   if aksiyon-g-tarih >=  k-tfiyat-bas-tar
                     and aksiyon-g-tarih <= k-tfiyat-bit-tar then
                         move aksiyon-anah to aksiyon2-anah
                        read aksiyon2 no lock invalid continue
                        end-read
                         move filtre-acenta to aksiyon2-acenta
                        write aksiyon2-rec 
                           invalid continue
                        end-write
                        move filtre-acenta to aksiyon-acenta
                        write aksiyon-rec 
                            invalid display message box "Cakisti"
                        end-write
                        perform log-operation-aksiyon
                    end-if
                 end-if
              end-read
           end-perform
        end-start
        close aksiyon aksiyon2
        set exit-pushed to true
     end-if.
*
 acc-anlasmaa-Ex-Other.
       if key-status = 1 
         if control-id = 16
               initialize link-pan-cagir
               move "D" to link-pan-tipi
               call "/asya/ytl/obj/otel/infoxara.asy" using 
                    link-pan-cagir
                        on exception
                           perform callerr-proc
                        not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy"
                        if link-pansiyon <> spaces
                           move link-pansiyon to acc-anlasma-kodu-value
                           display acc-anlasmaa
                        end-if
               end-call
           end-if
       end-if
     .  
*
 form4-Aft-Initdata.
*     if  hid(1:1) not = "A"  
*              move 0 to vis-sil
*          else 
*              perform t-sir
*              move 1 to vis-sil
*     end-if
            initialize   eskileri-sil  coklu-secim-var
           display form4-Cb-1a
             move bas-tarih  to eski-bas-tarih
             move bit-tarih  to eski-bit-tarih
          
     if acuserve-gizle = 1
            modify c-bag visible = false 
            modify form4-La-2 visible = false
            modify accept-0101aa visible = false
            modify form4-Pb-1 visible = false
            modify Form1-La-5 visible = false
            
     end-if 
     initialize acuserve-gizle

     display    form4-Cb-1a   
*     fsil-Cm-1
     move 0 to  kon-kat-value
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*  

             modify c-bag  reset-list = 1
            mass-update = 1. 
            
         initialize bag-value
        modify c-bag item-to-add bag-value
     open i-o baglanti
     close baglanti

     open input baglanti
        initialize baglanti-rec
        start baglanti key > baglanti-kodu invalid continue
            not invalid
               initialize fs-baglanti
               perform until fs-baglanti = "10"






                   read baglanti next no lock 
                      end move "10" to fs-baglanti
                      not end
                         if baglanti-guncel not = 1 then 
                           exit perform cycle
                         end-if
                         if baglanti-adi = isyeri-adres-tasi
                             exit perform cycle 
                         end-if 
                           initialize bag-value
                         move baglanti-aciklama-1 to bag-value 
                         move baglanti-adi        to bag-value(31:)
                         modify c-bag item-to-add bag-value
                   end-read
               end-perform
         end-start
            initialize bag-value
        modify c-bag value = bag-value
          modify c-bag  
            mass-update = 0.  
     close baglanti.
     .
*
 check-after2.
        if  hid(1:1) not = "P" then
          move 0 to kon-kat-value
        end-if
          display form4-Cb-1
     .
*
 form6-Aft-Initdata.     
        perform acenta-bakim
        set exit-pushed to true
     .
*
 Form1-Gd-1-Ev-Msg-Goto-Cell.
        display message box "hhhhh".
     .
*
 grid-kaydir. 
      perform kullandi.               
      inquire  form1-gd-1  HSCROLL-POS in hpos 
      modify  form1-gd-11  HSCROLL-POS =  hpos
     
     .
*
 h-kaydir2.
      inquire  form1-gd-11  HSCROLL-POS in hpos 
      modify  form1-gd-1  HSCROLL-POS =  hpos
      
     .
*
 cb-1b-Ex-Cmd-Clicked.
          initialize erken-bas-tarih erken-bit-tarih erken-oran
          display acc-10b,acc-11a,acc-12a,acc-13a,acc-14a,acc-15a,acc-16b.
     .
*
 cb-1aa-Ex-Cmd-Clicked.
      initialize ug-geceleme ug-oran
      display acc-10aa acc-16aa
     .
*
 Form2-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
*
 form5-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
*
 res-goster.
    call "w$bitmap" using wbitmap-destroy bmp-handle
    modify bt,  
           visible = 0
           bitmap-handle null,
    display bt
    
*    if pers-resim = spaces or pers-resim = low-values
*      then 
*    move "bos.jpg" to pers-resim
*    end-if
    inspect fiyatana-resim replacing trailing spaces 
            by low-values
    move all low-values to my-dir
            string my-dir,
           base-dir    delimited by low-values
           fiyatana-resim delimited by low-values
           into my-dir
     
    call "w$bitmap" using wbitmap-load,
                          my-dir
                          giving bmp-handle
    modify bt,
    
           visible = 1
           bitmap-handle bmp-handle.
*
 resim-yukle.
    move "Tum dosyalar (*.*)|*.*" to 
          opnsav-filters
    call "c$opensavebox" using opensave-open-box,
                               opensave-data,
                         giving opensave-return.
    if opensave-return > 0
       perform resim-upload
    end-if .

*
 resim-upload.
    move low-values           to komut1 komut2
    inspect opnsav-filename 
            replacing trailing spaces by low-values
    inspect opnsav-basename 
            replacing trailing spaces by low-values
    inspect opnsav-basename,
            replacing all spaces by "_"
    if is-remote
       string komut1,
              "@[DISPLAY]:"      delimited by low-values,
              opnsav-filename    delimited by low-values,
              into komut1
       string komut2,
              base-dir           delimited by low-values
              opnsav-basename    delimited by low-values
              into komut2
    else
       string komut1,
              opnsav-filename delimited by low-values
              into komut1
       string komut2,
              base-dir           delimited by low-values
              opnsav-basename    delimited by low-values
              into komut2
    end-if.
    call "c$copy" using komut1
                        komut2
                  giving copy-status.
    move komut2               to anlasma-resim
    display acc-resim
    if copy-status <> 0
       display message box 
               opnsav-filename, " dosyasi",x"0a0d",
               base-dir," klasorune kopyalanamadi ..."
               icon mb_error_icon
               title "Hata"
    end-if
    open i-o fiyatana
    initialize fiyatana-rec
    move acenta-kodu of acenta  to fiyatana-acenta
    move acc-anlasma-kodu-value to fiyatana-anlasma
    move bas-tarih              to fiyatana-ilk-tarih
    move bit-tarih              to fiyatana-son-tarih
    move acc-rez-tipi-value     to fiyatana-rez-tipi
    move acc-pan-kodu-value     to fiyatana-pan-tipi
    move banka-kodu of banka    to fiyatana-banka
    move doviz-kodu of doviz    to fiyatana-doviz
    move cell1-buyuk            to fiyatana-buyuk
    move cell1-kucuk            to fiyatana-kucuk
    read fiyatana no lock invalid
         display message box "Bagli Anlasma Bulunamadi...."
                             "Resim Yuklenemedi..."
         close fiyatana
         exit paragraph
    end-read
        move opnsav-basename    to fiyatana-resim
        rewrite fiyatana-rec invalid continue end-rewrite 
    close fiyatana
    perform resim-goster.
*
 resim-goster.
    inspect opnsav-basename replacing trailing spaces 
            by low-values
    move all low-values to my-dir
    string my-dir delimited by low-values,
           base-dir    delimited by low-values
           opnsav-basename delimited by low-values
           into my-dir
    call "w$bitmap" using wbitmap-load,
                          my-dir
                          giving bmp-handle
    modify bt,
           bitmap-handle bmp-handle,
           visible = 0
    modify bt,
           visible = 1.
    move my-dir             to anlasma-resim
    display acc-resim

    .






*
 Form7-Ex-Other.
    evaluate key-status
    when 3004
       perform resim-yukle
    end-evaluate
     
     .
*
 Form7-Aft-Initdata.
    perform resim-ilk-goster
    move bas-tarih                 to res-tarih
    move bit-tarih                 to res-bit-tarih
    display acc-res-gun acc-res-ay acc-res-yil 
            acc-res-bit-gun acc-res-bit-ay acc-res-bit-yil
    open input acenta
    move acenta-kodu of acenta   to acenta-kodu
    read acenta no lock invalid
         move "Tanimsiz Acenta Adi..."   to acenta-adi
    end-read 
         move acenta-adi                 to res-acenta-adi
    close acenta
    display acc-res-acen

    open input kodlar02
    initialize kodlar02-rec
    move acc-anlasma-kodu-value    to kodlar02-kodu 
    move "D"                 to kodlar02-tipi
    read kodlar02 no lock invalid       
         move "-Tanimsiz ..." to kodlar02-adi
    end-read.
         move kodlar02-adi    to res-anlasma-adi
    close kodlar02.
    display acc-res-anlasma.
*
 resim-ilk-goster.
    modify bt,
           bitmap-handle bmp-handle,
           visible = 0
    open i-o fiyatana
    initialize fiyatana-rec
    move acenta-kodu of acenta  to fiyatana-acenta
    move acc-anlasma-kodu-value to fiyatana-anlasma
    move bas-tarih              to fiyatana-ilk-tarih
    move bit-tarih              to fiyatana-son-tarih
    move acc-rez-tipi-value     to fiyatana-rez-tipi
    move acc-pan-kodu-value     to fiyatana-pan-tipi
    move banka-kodu of banka    to fiyatana-banka
    move doviz-kodu of doviz    to fiyatana-doviz
    move cell1-buyuk            to fiyatana-buyuk
    move cell1-kucuk            to fiyatana-kucuk
    read fiyatana no lock invalid
         display message box "Bagli Anlasma Bulunamadi...."
                             "Resim Yuklenemedi..."
         close fiyatana
         exit paragraph
    end-read
        move fiyatana-resim    to opnsav-basename
    close fiyatana
    perform resim-goster.

             .

*
 konumind-getir.
                  initialize    ylgelen-acenta-1
              if link-var = 2 then 
                    move lfiyatana-konum to ylfiyatana-konum
               end-if
               
                   move acenta-kodu of acenta   to ylgelen-acenta



                    move  acenta-kodu of acenta    to    ylFIYATANA-ACENTA     
                     move  bas-yil                  to    ylFIYATANA-ILK-YIL    
                     move  bas-ay                   to    ylFIYATANA-ILK-AY     
                     move  bas-gun                  to    ylFIYATANA-ILK-GUN    
                     move  bit-yil                  to    ylFIYATANA-SON-YIL    
                     move  bit-ay                   to    ylFIYATANA-SON-AY     
                     move  bit-gun                  to    ylFIYATANA-SON-GUN    
                     move  acc-rez-tipi-value       to    ylFIYATANA-REZ-TIPI   
                     move  acc-pan-kodu-value       to    ylFIYATANA-PAN-TIPI   
                     move  banka-kodu of banka      to    ylFIYATANA-BANKA      
                     move  doviz-kodu of doviz      to    ylFIYATANA-DOVIZ      
                     move  acc-anlasma-kodu-value   to    ylFIYATANA-ANLASMA    
                     move kick-oran    to    ylfiyatana-kick
                    move  kick-oran2   to   ylfiyatana-kick2
                    move erken-oran                  to   ylfiyatana-eb
                    
                   call "/asya/ytl/obj/otel/konumind.asy" 
                         using acenta-kodu, ylgelen-acenta-1
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/konumind.asy"
                    end-call.

*
*
 refli-konum.
           if acenta-ref < 1 or acenta-ref > max-ref 
                move 0 to acenta-ref
              end-if
              if acenta-ref not = son-yuklenen-ref
               
                 modify Form1-Gd-1 mass-update = 1 
                 modify Form1-Gd-1 DISPLAY-COLUMNS 0
                 modify Form1-Gd-1 DISPLAY-COLUMNS 1
                 modify Form1-Gd-1 DISPLAY-COLUMNS 21 

                 modify Form1-Gd-11 mass-update = 1 
                 modify Form1-Gd-11 DISPLAY-COLUMNS 0
                 modify Form1-Gd-11 DISPLAY-COLUMNS 1
                 modify Form1-Gd-11 DISPLAY-COLUMNS 21
                 move 21 to son-col   
                 perform varying ki from 1 by 1 until ki > 40 

                  if acenta-ref not = 0 and acenta-ref not = xkonum-ref(ki) 
                    
                     add 1 to son-col
                     else
                     add 8 to son-col
                  end-if
                    modify Form1-Gd-1 DISPLAY-COLUMNS son-col
                    modify Form1-Gd-11 DISPLAY-COLUMNS son-col   
    
                      
                     
                 
                  
              end-perform
   
                
                
                 modify Form1-Gd-1  mass-update = 0 
                 modify Form1-Gd-11 mass-update = 0
             
                 
                move acenta-ref to  son-yuklenen-ref
                
              end-if .

             .
*
 acu-fiyat-kopyala.
        open input acenta2
        read acenta2 no lock invalid move "*********" to acenta2-adi
        end-read
        move acenta2-adi to lb2-adi
            display Form1-La-5
        close acenta2

              open input fiyatana
            
               open i-o fana2  find2 fiyatind 
               open input fiyat
            
          open i-o fiyat2
          initialize fana2-rec sonuc
          move acenta2-kodu      to fana2-acenta
          move  bas-tarih to fana2-ilk-tarih 
          move bit-tarih  to fana2-son-tarih
          move acc-rez-tipi-value to fana2-rez-tipi
          move acc-pan-kodu-value to fana2-pan-tipi
          move banka-kodu of banka to fana2-banka
          move doviz-kodu of doviz to fana2-doviz
          move acc-anlasma-kodu-value to fana2-anlasma
          start fana2 key > fana2-anah invalid 
                continue
          not invalid 
               initialize fs-fiyatana
               perform until fs-fiyatana = "10" 
                  read fana2 next no lock  end 
                      move "10" to fs-fiyatana
                      not end
                      if fana2-ilk-tarih not = bas-tarih
                         exit perform 
                      end-if 
                      if fana2-son-tarih not = bit-tarih
                          exit perform 
                      end-if 
                      if fana2-acenta not = acenta2-kodu
                          exit perform   
                      end-if 
                      if fana2-banka not = banka-kodu of banka
                          exit perform   
                      end-if 
                      if fana2-doviz not = doviz-kodu of doviz
                          exit perform   
                      end-if 
                      if fana2-pan-tipi not = acc-pan-kodu-value
                          exit perform   
                      end-if 
                      if fana2-rez-tipi not =  acc-rez-tipi-value
                          exit perform 
                      end-if 
                      if fana2-ANLASMA not = acc-anlasma-kodu-value
                          exit perform  
                      end-if 
                
                      if acenta2-kodu = fana2-acenta
                          if sonuc = 0
                             display message box bag-value new-line
                                      acenta2-adi new-line
                                      "adli acenta tanimli fiyat tanimlari silinecek " new-line
                                      "Yeni degerler kopyalanacaktir. Emin misiniz?"
                                      type 2 icon 2 default 2
                                      giving sonuc
                          end-if
                          if sonuc = 1 then 
                                 delete fana2 invalid stop " " end-delete  
                          end-if
                        else
                          move "10" to fs-fiyatana
                      end-if
                       
                  end-read
              end-perform 
          end-start
 
          if yeni-anlasma-olarak-at = 1
             initialize yeni-bas-tarih yeni-bit-tarih
             move bas-tarih   to yeni-bas-tarih
             move bit-tarih   to yeni-bit-tarih
             move eski-bas-tarih to bas-tarih   
             move eski-bit-tarih to bit-tarih   
          end-if
          initialize fiyatana-rec 
          move bas-tarih  to fiyatana-ilk-tarih    
          move bit-tarih  to fiyatana-son-tarih
          move acenta-kodu to fiyatana-acenta
          move acc-rez-tipi-value to fiyatana-rez-tipi
          move acc-pan-kodu-value to fiyatana-pan-tipi
          move banka-kodu of banka to fiyatana-banka
          move doviz-kodu of doviz to fiyatana-doviz
          move acc-anlasma-kodu-value to fiyatana-anlasma

            start fiyatana key > fiyatana-anah   invalid continue
               not invalid 
               perform until fs-fiyatana = "10" 
                  read fiyatana next no lock  end 
                      move "10" to fs-fiyatana
                      not end  
                      if fiyatana-ilk-tarih not = bas-tarih
                         exit perform 
                      end-if 
                      if fiyatana-son-tarih not = bit-tarih
                          exit perform 
                      end-if 
                      if fiyatana-acenta not = acenta-kodu
                          exit perform   
                      end-if 
                      if fiyatana-banka not = banka-kodu of banka
                          exit perform   
                      end-if 
                      if fiyatana-doviz not = doviz-kodu of doviz
                          exit perform   
                      end-if 
                      if fiyatana-pan-tipi not = acc-pan-kodu-value
                          exit perform   
                      end-if 
                      if fiyatana-rez-tipi not =  acc-rez-tipi-value
                          exit perform 
                      end-if 
                      if fiyatana-ANLASMA not = acc-anlasma-kodu-value
                          exit perform  
                      end-if 

                      if acenta-kodu = fiyatana-acenta
                          if sonuc = 0
                                display message box bag-value new-line
                                      acenta-adi new-line
                                      "adli acenta tanimli fiyatlar kopyalanacaktir" new-line
                                      "Emin misiniz?"
                                      type 2 icon 2 default 2
                                      giving sonuc
                           end-if
                           if sonuc = 1 then 
                                 move fiyatana-rec to fana2-rec 
                                 if yeni-anlasma-olarak-at = 1
                                    move yeni-bas-tarih to FANA2-ILK-TARIH 
                                    move yeni-bit-tarih to FANA2-son-TARIH 
                                 end-if 
                                 move acenta2-kodu to fana2-acenta
                                 write fana2-rec invalid stop " " end-write  
                          end-if
                        else
                          move "10" to fs-fiyatana
                      end-if
                     
                  end-read
              end-perform 
          end-start
       

            initialize fiyatind-rec  fs-fiyatind
              move  k-tfiyat-bas-tar to      fiyatind-ilk-tarih    
                move acenta-kodu to fiyatind-acenta
            start fiyatind key >= fiyatind-anah   invalid continue
               not invalid 
               perform until fs-fiyatind = "10" 
                  read fiyatind next no lock  end 
                      move "10" to fs-fiyatind
                      not end 
                      if acenta-kodu = fiyatind-acenta
                          if sonuc = 0
                                display message box bag-value new-line
                                      acenta-adi new-line
                                      "adli acenta tanimli fiyatlar kopyalanacaktir" new-line
                                      "Emin misiniz?"
                                      type 2 icon 2 default 2
                                      giving sonuc
                           end-if
                           if sonuc = 1 then 
                                 move fiyatind-rec to find2-rec 
                                 move acenta2-kodu to find2-acenta
                                 write find2-rec invalid 
*                                       stop " "           |lonicera iчin kald§r§ld§ 17/09/2020 firat
                                       continue
                                 end-write  
 
                          end-if
                        else
                          move "10" to fs-fiyatind

                      end-if
                  end-read
              end-perform 
          end-start
 
          close fiyatana fana2    close fiyat fiyat2 find2 fiyatind.                          
*
 form4-Pb-1-Link.
        if acenta2-kodu = spaces 
           display message box "Lutfen karsi acenta kodu giriniz"
             exit paragraph 
        end-if
        if bag-value = spaces and acenta2-kodu  = acenta-kodu then 
            display message box "Lutfen  farkli acenta kodu giriniz" 
           exit paragraph
        end-if
      display message box "Fiyatlar Kopyalacaktir." new-line
                          "Eminmisiniz?"
                      title "Uyari"
                      icon 1
                      type 2
                      default 2
                      returning return-code 
      if return-code = 2 
          exit paragraph 
      end-if 
        
        perform onb-adres-aktar
        
                              
      perform acu-fiyat-kopyala
     .
*
 onb-adres-aktar.
     if bag-value = spaces then 
          move acenta-dosya       to acenta2-ACUSERVE-DOSYA       
          move fiyatana-dosya     to fana2-ACUSERVE-DOSYA         
          move aksiyon-dosya      to aks2-ACUSERVE-DOSYA   
          move aksiyon2-dosya      to aks22-ACUSERVE-DOSYA    
          move aceanlas-dosya     to ace2-ACUSERVE-DOSYA          
          move not-dosya          to not2-ACUSERVE-DOSYA          
          move acebavel-dosya     to acebavel2-ACUSERVE-DOSYA     
          move firma-dosya        to firma2-ACUSERVE-DOSYA        
          move aksiyhrk-dosya     to aksiyhrk2-ACUSERVE-DOSYA       
          move fiyat-dosya        to fiyat2-ACUSERVE-DOSYA  
          move fiyatind-dosya     to find2-ACUSERVE-DOSYA         
      
     else 

        move bag-value(31:) to       acenta-dosya-adres    
                                     fiyatana-dosya-adres  
                                     aksiyon-dosya-adres   
                                     aksiyon2-dosya-adres   
                                     aceanlas-dosya-adres  
                                     not-dosya-adres       
                                     acebavel-dosya-adres  
                                     firma-dosya-adres     
                                     aksiyhrk-dosya-adres  
                                     fiyat-dosya-adres     
                                     fiyatind-dosya-adres
 
            string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   acenta-dosya           delimited " "
                   into acenta2-ACUSERVE-DOSYA 
        
             string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyatana-dosya           delimited " "
                   into fana2-ACUSERVE-DOSYA   

             string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyatind-dosya           delimited " "
                   into find2-ACUSERVE-DOSYA   


           string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   aksiyon-dosya           delimited " "
                   into aks2-ACUSERVE-DOSYA   
            string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   aksiyon2-dosya           delimited " "
                   into aks22-ACUSERVE-DOSYA   

           string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   aceanlas-dosya           delimited " "
                   into ace2-ACUSERVE-DOSYA 

           string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   not-dosya           delimited " "
                   into not2-ACUSERVE-DOSYA 

          string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   acebavel-dosya           delimited " "
                   into acebavel2-ACUSERVE-DOSYA  

           string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   firma-dosya           delimited " "
                   into firma2-ACUSERVE-DOSYA  

           string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   aksiyhrk-dosya           delimited " "
                   into  aksiyhrk2-ACUSERVE-DOSYA
    
          string "@" delimited by low-values
                   bag-value(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyat-dosya           delimited " "
                   into  fiyat2-ACUSERVE-DOSYA     



        move isyeri-adres-tasi to      acenta-dosya-adres    
                                       fiyatana-dosya-adres  
                                       aksiyon-dosya-adres   
                                       aksiyon2-dosya-adres   
                                       aceanlas-dosya-adres  
                                       not-dosya-adres       
                                       acebavel-dosya-adres  
                                       firma-dosya-adres     
                                       aksiyhrk-dosya-adres  
                                       fiyat-dosya-adres 
                                       fiyatind-dosya-adres

       end-if.

 


 
