* for02isg.evt
* for02isg.evt is generated from D:\asya\acugt.ytl\otel\for02isg.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     .

 elma-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Ax-Event
        EVALUATE Event-Data-2
        WHEN TChartOnClickSeries
           PERFORM elma-Ev-OnClickSeries
        END-EVALUATE
     END-EVALUATE
     .

 Form2-Event-Proc.
     .

 Form2-Gd-1-Event-Proc.
     .

 Form2-Gd-1-Exception-Proc.
     PERFORM narg-islemler
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
     move ONKPARA-DOVIZ to butce-cev-doviz .
     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to ilk-tarih son-tarih.
*    if son-ay < 12 then 
*              add 1 to son-ay
*       else
*               move 1 to son-ay
*       add 1 to son-yil
*    end-if
    move 1          to ilk-gun
    move 31         to son-gun
    move 1          to reel-gecmis

    move "N" to rap-tip.
    move "P" to bol-tip
    move "O" to ok-tip
      perform Form1-Ef-1-Aft-Procedure
    display  Form1-Cb-1aa Form1-Cb-3 Form1-Cb-5
    display acc-01 acc-02 acc-03 acc-04 acc-05
            acc-06 acc-07 com-01.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
***     perform grafik-yukleme-baslasin
*/-----------------------------\*         
     .
*
 Form1-Ex-Other. 
    evaluate key-status
      when 15
           modify elma,
                 @Export::@CopyToClipboardMetafile(1) 
      when 16
            modify elma,
                 @Showeditor() 
      when 11
          move tarih-tasi           to    starih
         display message box  function INTEGER-OF-DATE(starih)

           move "20120230"        to    starih
         display message box  function INTEGER-OF-DATE(starih)
           move "20120301"       to    starih
         display message box  function INTEGER-OF-DATE(starih)
      when 8 
*      modify elma,
*           @Export::@CopyToClipboardBitmap()

           modify elma,
                @Export::@ShowExport()
         when 19 
          perform raporla
         when 29 
          perform detay-raporla
      when 7
     

      
      modify elma,
           @printer::@ShowPreview()
         
*         modify elma, 
*               @PrintPanel(1)
      when 1002
         move 1         to ilk-gun 
         compute ilk-ay = ilk-ay + 1
         if ilk-ay > 12
            compute ilk-yil = ilk-yil + 1
            move 1  to ilk-ay            
         end-if 

         move 31         to son-gun
         compute son-ay = son-ay + 1
         if son-ay > 12
            compute son-yil = son-yil + 1
            move 1  to son-ay                        
         end-if 
         display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
          perform grafik-rapor
          modify elma, 
                 @Repaint()
                 visible = 1
      when 1001
         move 1         to ilk-gun 
         compute ilk-ay = ilk-ay - 1
         if ilk-ay > 12
            compute ilk-yil = ilk-yil - 1
            move 1  to ilk-ay            
         end-if 
         if ilk-ay < 1
            move 12       to ilk-ay
            compute ilk-yil = ilk-yil - 1
         end-if 
         move 31         to son-gun
         compute son-ay = son-ay - 1
         if son-ay > 12
            compute son-yil = son-yil - 1
            move 1  to son-ay                        
         end-if 
         if son-ay < 1
            move 12       to son-ay
            compute son-yil = son-yil - 1
         end-if 
         display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
          perform grafik-rapor
          modify elma, 
                 @Repaint()
                 visible = 1           
      when 1
        evaluate control-id
                when 12
                when 2001
                     initialize acenta-cagir
                     call "/asya/ytl/obj/otel/acenara.asy" 
                          using acenta-cagir  
                          on exception 
                             perform callerr-proc
                          not on exception
                             if acenta-cagir <> spaces
                                move acenta-cagir to acn-kod
                                display acc-07
                             end-if
                     end-call
                     move 4 to accept-control
                     move 12 to control-id
        end-evaluate
        exit paragraph
      when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre 
      when 2
         perform grafik-yukleme-baslasin
    end-evaluate.

     .
*
 takas-at.
                      
       open output takas7 close takas7
        open output takasfiyat close takasfiyat
       
       open output takas 
       open output takas3 
       open output takas-detay 
       close takas3 takas-detay takas
       open i-o takas3 with mass-update 
       open i-o takas-detay with mass-update
        open i-o takasfiyat with mass-update.
       open i-o takas7 with mass-update.
       open i-o takas with mass-update
      open input rez  takvim cast kodlar02 odalar grup
                 aksiyhrk fiyat fiyatana kur konuk takvim2
                  romhrk  cast3 konum ulke  firma onbkodlar10 ,
       initialize takvim-rec eh toplam son-sira son-gr-sira
         toplam-siklik     toplam-buyuk    toplam-kucuk toplam-free
         toplam-bebek      toplam-gelir  takas-detay-diger toplam-oda-kap
         toplam-pax-kap
     

      
       move 1 to buyil
      
                perform cast-oku thru cast-oku-exit
               
      

     initialize takas-detay-rec
     move high-values to takas-detay-siklik
  
     move 0 to son-gr-sira
     start takas-detay key < takas-detay-siklik invalid continue
       not invalid
           perform until fs-takas-detay = "10"
                  read takas-detay backward no lock 
                         end move "10" to fs-takas-detay
                         not end 
*                           if takas-detay-sira = max-detay 
*                                move max-detay to  takas-detay-gr-sira
*                                move max-detay to  takas-yer(takas-detay-gr-sira)
*                             else
*                              add   1 to son-gr-sira
*                              move  son-gr-sira      to takas-detay-gr-sira
*                              move  takas-detay-sira to  takas-yer(takas-detay-gr-sira)
*                              rewrite takas-detay-rec invalid stop " " end-rewrite
*                          end-if
                           if takas-detay-sira = max-detay 
                                move max-detay to  takas-detay-gr-sira
                                move max-detay to  takas-yer(takas-detay-gr-sira)
                             else
                              add   1 to son-gr-sira
                              move  son-gr-sira      to takas-detay-gr-sira
                              move  takas-detay-sira to  takas-yer(takas-detay-gr-sira)
                              rewrite takas-detay-rec invalid stop " " end-rewrite
                          end-if
                  end-read
           end-perform
     end-start
       close rez  odalar takvim takvim2 cast kodlar02  grup takas
       close aksiyhrk fiyat fiyatana kur konuk 
                  romhrk  cast3 konum ulke  firma onbkodlar10.

*
 grafik-yukleme-baslasin.
          perform Form1-Ef-1-Aft-Procedure
          perform grafik-rapor
          modify elma, 
                 @Repaint()
                 visible = 1          .
*
 grafik-rapor.
        perform varying cizgi from 1  by 1 until cizgi > 5
         inquire gk(cizgi + 1, 2) cell-data in  gun(cizgi)
         end-perform
           
                    
       open i-o genelfis
       move 1 to genelfis-anahtar
       read genelfis no lock invalid 
            move 1 to ekran-fis-1,
       end-read
      
       add 1 to ekran-fis-1
    
       move ekran-fis-1(2:) to takas3-no takas4-no takas-no takas-detay-no takasfiyat-no takas7-no
      
       rewrite genelfis-rec invalid 
               write genelfis-rec invalid continue
               end-write,
       end-rewrite
       close genelfis
        if k-kodu-tasi = "ASYA" or "X   " and 1=0 
        open i-o takas3 with mass-update 
       open i-o takas-detay with mass-update
        open i-o takasfiyat with mass-update
       open i-o takas7 with mass-update
       open i-o takas with mass-update
          else
                perform takas-at
        end-if
     
          perform grafik-bas.

          .

*
 grafik-bas.
     
              initialize takas3-rec
              move ilk-tarih to takas3-tarih
              start takas3 key not < takas3-tarih invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close takas3
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
    
      open input kodlar02  konum acenta ulke
*********************************
           move 0 to tamam
           modify elma visible = 0
             modify elma,
                    @ClearChart()
                move 0 to tamam
            modify elma visible = 0
            modify elma,
                    @ClearChart()
                    @Header::@Text::Clear()
                    @RemoveAllSeries(),
                    @SetTheme(ctWindowsXp,cpdefault)
                    @Axis::@Bottom::@Labels::@MultiLine(1)
                    @Axis::@Bottom::@Labels::@Angle(270)
                    @Zoom::@Enable(0)
                    @visible(0)
        
        
             
               
                 move 0 to max-seri
*                  compute i = max-seri + 1 
              perform varying i from 0 by 1 until i >  max-seri
               modify elma,
                    @AddSeries(@scBar),  | bar
                    @ASeries(i)::@Clear()
                    @Aseries(i)::@Asbar()::@StackGroup (2) 
                    @Aseries(i)::@Asbar()::@Multibar(@mbStacked)
                  
            Use elma @Aseries(i),
              
                 modify ^@Marks::@Style(@Smsvalue)                        
                        ^@Marks::@Gradient::@Visible(1)
                        ^@Marks::@Symbol::@Visible(1)
                        ^@Marks::@Arrow::@Visible(1)
                      
            end-Use 
             if i= max-seri then  modify elma, @Aseries(i)::@color('&H00FFFFFF') end-if

         end-perform 
      
              move 0 to max-seri
                  compute i = max-seri + 1 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H00000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(2) 
                            @ASeries(i)::@asfastline()::@linepen::@style(0) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
        
                              
                    end-Use 
                  compute i = max-seri + 2 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H000AA00') 
                                                 
                            @ASeries(i)::@asfastline()::@linepen::@width(3) 
                            @ASeries(i)::@asfastline()::@linepen::@style(0) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
        
                              
                    end-Use 
                   compute i = max-seri + 3 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H30000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(3) 
                            @ASeries(i)::@asfastline()::@linepen::@style(0) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
        
                              
                    end-Use 
                     modify elma, aSeries(i)::Active(0)
                   compute i = max-seri + 4 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H40000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(2) 
                            @ASeries(i)::@asfastline()::@linepen::@style(2) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
        
                              
                    end-Use  ,
                     modify elma, aSeries(i)::Active(0)
                     compute i = max-seri + 5 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H50000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(1) 
                            @ASeries(i)::@asfastline()::@linepen::@style(2) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
        
                              
                    end-Use 
                     modify elma, aSeries(i)::Active(0)
                 
                    
               
          
              initialize fs-takas3 top6  siratut
              perform with test after until fs-takas3 = "10"
                    read takas3 next no lock end move "10" to fs-takas3
                    not at end
                         
                            if takas3-tarih > son-tarih
                                   move "10" to fs-takas3
                                   exit perform
                            end-if
                        
                         initialize dokumer-rec detay z-goster 
                      
                        
                         perform detay-ata

                         perform toplam-al

                         move takas3-gun         to egun
                         move takas3-ay          to eay
                         move takas3-yil         to eyil

                
                  move takas3-gun to grf-gun
                  move takas3-ay to grf-ay
                  move takas3-yil to grf-yil
                 move siratut to takas3-sira
                 rewrite takas3-rec invalid stop " " end-rewrite
                 add 1 to siratut
                

                   
                     
                 
                       |   modify elma, aSeries(max-seri)::Active(0)
                       perform varying cizgi from 1 by 1 until cizgi > 5
                         evaluate ciz-tip(1:1)
                           when "R"
                               compute TAKAS3-s-ODA(cizgi) = TAKAS3-s-ODA-g(cizgi) / gun(cizgi)
                           when "O"
                             compute TAKAS3-s-ODA(cizgi) = TAKAS3-s-ODA-g(cizgi) / gun(cizgi)
                           when "S"
                             compute TAKAS3-s-ODA(cizgi) = TAKAS3-s-pax(cizgi) / gun(cizgi)
                           when "O"
                             compute TAKAS3-s-ODA(cizgi) = TAKAS3-s-pax-g(cizgi) / gun(cizgi)
                           end-evaluate
                       end-perform
                          compute i = max-seri + 1 
                                modify elma, aSeries(i)::add(TAKAS3-s-ODA(1) ,grf-tarih, '&H0000000') 
                          compute i = max-seri + 2 
                                modify elma, aSeries(i)::add(TAKAS3-s-ODA(2),grf-tarih,'&H000FF00')  
                        compute i = max-seri + 3 
                                modify elma, aSeries(i)::add(TAKAS3-s-ODA(3),grf-tarih, '&H3000000') 
                                
                         compute i = max-seri + 4 
                                modify elma, aSeries(i)::add(TAKAS3-s-ODA(4),grf-tarih, '&H4000000')
                                 
                        compute i = max-seri + 5 
                                modify elma, aSeries(i)::add(TAKAS3-s-ODA(5),grf-tarih, '&H5000000')
              end-read
              end-perform
              
                       modify elma,
                            @Aseries(i)::@Marks()::@visible(0)
                         

              
               
               
                    
||||||||||||||||||||||||  burda kaldým
                    
              
                         compute i = max-seri + 1 
                          move gun(i) to  det-cgun
                          modify elma  @ASeries(i)::@Title(det-cizgi)   
                        
                        
                          compute i = max-seri + 2 
                           move gun(i) to  det-cgun
                          modify elma  @ASeries(i)::@Title(det-cizgi)   

                          compute i = max-seri + 3 
                           move gun(i) to  det-cgun
                          modify elma  @ASeries(i)::@Title(det-cizgi)       
                           compute i = max-seri + 4 
                           move gun(i) to  det-cgun
                          modify elma  @ASeries(i)::@Title(det-cizgi)   
                           compute i = max-seri + 5 
                           move gun(i) to  det-cgun
                          modify elma  @ASeries(i)::@Title(det-cizgi)   
                        
                        
                        
                   
                       
            
                 modify elma  @legend::@font()::@name("Courier New")
                 modify elma  @legend::@Alignment(2)
                  modify elma  @legend::@CustomPosition(1)
                      modify elma  @legend::PositionUnits(0)
                    modify elma  @legend::@toppercent(2)
                     modify elma  @legend::@LeftPercent(38)
                      modify elma  @legend::CheckBoxes(1)
                      modify elma  @legend::@ColorWidth(15)
                      modify elma  @legend::@font::@size(7)
                    modify elma  @legend::@Vertspacing(-4)
                    if onceki-yil > 0 
                          modify elma  @panel::@MarginTop(22)
                    else
                       modify elma  @panel::@MarginTop(14)
                   end-if
                modify elma  @Header::@font::@size(15)
                 modify elma  @Header::@font::@bold(1)
                modify elma  @Header::@CustomPosition(1)
                modify elma  @subHeader::@CustomPosition(1)
                modify elma  @Header::@top(15)
                modify elma  @Header::@Left(32)
                modify elma  @subHeader::@top(50)
                modify elma  @subHeader::@Left(24)
                initialize baslik altbaslik1 altbaslik2
               
                move " SATIS ANALIZ EGRILERI " to baslik

                   modify elma  @Header::@text::@Add(baslik)
               
                modify elma  @SubHeader::@text::@Add(altbaslik1)
               modify elma  @SubHeader::@text::@Add(altbaslik2)
               modify elma  @SubHeader::@font::@size(8)    
             modify elma @visible(1)
             modify elma visible = 1 
              close  kodlar02  konum ulke acenta
              move 1 to tamam


             
              close takas3  takas-detay    takasfiyat takas7
             .

* 
 cast-oku.
    initialize cast-rec var-yok rez-rec
   
    start rez key not < rez-anah invalid continue
      not invalid
        perform  until fs-rez = "10"
          read rez next no lock end move "10" to fs-rez
            not end
                
                    if filtre-var = 1 then 
                        perform filtre
                        if filtre-gecti = 1 then                           
                          perform takas-kaydet thru takas-kaydet-exit
                        end-if
                      else
                          perform takas-kaydet thru takas-kaydet-exit
                       end-if                    
            end-read
             
        end-perform
    end-start.
 cast-oku-exit.
    exit.
*
 TAKAS-KAYDET.

        
          if rez-durumu not = "I"
                       go takas-kaydet-exit,
         end-if,
         if rez-k-g-b  not = "K" and  not = "O"
               go takas-kaydet-exit,
         end-if,
         
        
   
  
*** Grup Filtresi

*    if acn-grup-kod not = spaces
*      initialize grup-rec
*      set grup-acenta to true
*      move acn-grup-kod to grup-kodu
*      move rez-acenta   to grup-alt
*      read grup no lock
*        invalid
*          go takas-kaydet-exit
*      end-read
*    end-if

*** Grup Filtresi
    if tumu > 1 then
          
          move "B" to kodlar02-tipi
          move rez-odeme-tipi to kodlar02-kodu
          read kodlar02 no lock invalid 
              move spaces to kodlar02-adi
          end-read
          if ( ode-tipi = "D" or  ode-tipi = "F" or  ode-tipi = "O")   and tumu = 2 then
              go takas-kaydet-exit
          end-if
          if ( ode-tipi not = "D" and ode-tipi not = "F" and ode-tipi not = "O") and tumu = 3 then
             go takas-kaydet-exit
          end-if

    
    end-if
    
   
*   TRACE Uygulamasi Acik ise kisi sayilari cast'tan alinacak
     move 1 to eklenecek-oda

      
        
       if rez-share = 1 then 
             move 0 to eklenecek-oda 
            else
              move 1 to eklenecek-oda
          end-if
    if onkpara-referans-var = 1 then 
       perform ref-filtre
       if  not ref-gecti then 
           exit paragraph
       end-if
    end-if    


     

      if rez-odano not = spaces and 
       ( hayali-haric = 1 or dis-haric = 1 ) then 
              move rez-odano to odalar-anah
              read odalar no lock invalid continue
              not invalid
              if ( odalar-hayali = "H" and hayali-haric = 1 )  then
                       move 0 to eklenecek-oda
              end-if
               if ( dis-haric = 1 and odalar-dis = 1 )  then
                          exit paragraph
              end-if 
              end-read
    end-if  
      evaluate ychild 
       when 1 
        compute pax-sayisi = rez-buyuk + ( rez-kucuk / 2 )
       when 0
        compute pax-sayisi = rez-buyuk
       when 2 
           compute pax-sayisi = rez-buyuk +  rez-kucuk  + rez-free
       when 3
         compute pax-sayisi = rez-buyuk +  rez-kucuk  + rez-free + rez-bebek
       when 4
          compute pax-sayisi = rez-buyuk +  rez-kucuk 
       when other
            compute pax-sayisi = rez-buyuk + ( rez-kucuk / 2 )   
      end-evaluate

      move rez-cik-tar to s6 
      move rez-gir-tar to s5
      compute rez-gece  = function integer-of-date(s6) - function integer-of-date(s5)
 

      if buyil = 1 
       move rez-isl-tar to s1    
       perform varying bu-tarih from function integer-of-date(s1) by 1 until 
            bu-tarih > function integer-of-date (s1)  + gun(5)
          initialize takas3-rec
          move function date-of-integer(bu-tarih) to  s5
          move  s5 to TAKAS3-TARIH
          read takas3 no lock invalid continue
          end-read
         perform varying cizgi from 1  by 1 until cizgi > 5

           if  gun(cizgi) > bu-tarih - function integer-of-date(s1)   then 

             compute takas3-S-oda(cizgi)   =    takas3-S-oda(cizgi)  + 1 
             compute takas3-S-pax(cizgi)   =    takas3-S-pax(cizgi)   + PAX-SAYisi
             compute takas3-S-ODA-G(cizgi) =    takas3-S-ODA-G(cizgi) +  rez-gece
             compute takas3-S-pax-G(cizgi) =    takas3-S-pax-G(cizgi) + ( rez-gece * PAX-SAYisi )
  
          end-if

         rewrite takas3-rec invalid write takas3-rec end-rewrite
       end-perform    
   
      end-if .


 
     if buyil not = 1 
         continue              
       
       
     end-if .

    

 takas-kaydet-exit.
      exit
         .



 
   
 toplam-al.
    
    compute top4-oda = top4-oda |+ g-takas3-oda 
    compute top4-pax = top4-pax |+ g-takas3-pax
    compute top4-chi = top4-chi |+ g-takas3-child
    compute top4-fre = top4-fre |+ g-takas3-free
    compute top4-beb = top4-beb |+ g-takas3-bebek.
    .
 detay-ata.
****************
                        
*                         move g-takas3-oda   to z-goda
*                         move g-takas3-pax   to z-gpax
*                         move g-takas3-child to z-gchi
*                         move g-takas3-free  to z-gfre
*                         move g-takas3-bebek to z-gbeb
*
*                         initialize top5 oda-yuzde
*                         move takas3-hazir-oda to top5-top
*                         move top5-top       to z-mevcut
*                         compute top5-bos = takas3-hazir-oda - g-takas3-oda
*                         compute top6-kal = top6-kal + g-takas3-oda
*                         move top5-bos       to z-bosoda
*                         compute oda-yuzde = (g-takas3-oda * 100) / takas3-hazir-oda
*                         move oda-yuzde      to z-yuzde
*
*                         compute top6-top = top6-top + top5-top
*                         compute top6-bos = top6-bos + top5-bos
*                         compute top6-hzr = top6-hzr + takas3-hazir-oda
* 

    



                         .
*
 acc-07-Aft-Procedure.
     open input acenta
     if acn-kod = spaces
        move "Tum Acentalar"   to acenta-adi
     else
        move acn-kod    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 12 to control-id
        end-read
     end-if
     display lb-acenadi.
     close acenta. 
     
     .
*
 elma-Ev-OnClickSeries.
     call "c$geteventdata" using event-control-handle, myseriesindex,myvalueindex,0,0,0,0,0 
*          inquire elma,aseries(myseriesindex)::@name in acenta-adi.
***          display message box myvalueindex. 
     perform Acu-Form2-Routine
          .
*
 elma-Ev-OnMouseEnterSeries.
   
     
     .
*
 Form2-Aft-Initdata.
      open input takas  takas3 konum rez firma 
                 acenta kodlar02 doviz
         initialize takas3-rec
        move myvalueindex to takas3-sira
        read takas3 key takas3-sira  invalid stop " "
        end-read
        move takas3-yil  to grf-yil
        move takas3-ay   to grf-ay
        move takas3-gun  to grf-gun
        
     
       move grf-yil to takas-yil
       move grf-ay  to takas-ay
       move grf-gun to takas-gun
      move "Rapor Tarihi:" to baslik-val(1:14)
      move grf-gun    to egun
      move grf-gun            to baslik-val(14:2)
      move "/"             to baslik-val(16:1)
      move grf-ay          to baslik-val(17:2)
      move "/"             to baslik-val(19:1)
      move grf-yil         to baslik-val(20:4)

      modify fr-baslik, TITLE = baslik-val

      modify form2-gd-1,mass-update = 1
                        reset-grid = 1
      initialize form2-gd-1-record
      move "Rez No"         to gd-1-col-1
      move "Adi"            to gd-1-col-2
      move "Soyadi"         to gd-1-col-3
      move "C/In Tarihi"    to gd-1-col-4
      move "C/out Tarihi"   to gd-1-col-5
      move "Acenta Adi"     to gd-1-col-6
      move "Pansiyon"       to gd-1-col-7
      move "Pazar"          to gd-1-col-8
      move "P"              to gd-1-col-9
      move "C"              to gd-1-col-10
      move "F"              to gd-1-col-11
      move "B"              to gd-1-col-12
      move "Fiyat"          to gd-1-col-13
      move "Doviz"          to gd-1-col-14  
      move "Sat.Tar"        to gd-1-col-15 
      move "O.Konumu"       to gd-1-col-16
      move "F.Konumu"       to gd-1-col-17 
      move "Firma Adi"      to gd-1-col-18
      modify form2-gd-1,record-to-add(form2-gd-1-record)
     
      initialize takas-rec toplam-kayit 
                 toplam-buyuk toplam-kucuk 
                 toplam-free toplam-bebek

    
       open input cast 
       move grf-yil to takas-yil
       move grf-ay  to takas-ay
       move grf-gun to takas-gun
  
      start takas key not < takas-anahtar invalid
          continue 
      not invalid 
      perform with test after until fs-takas = "10"
      read takas next no lock end move "10"  to fs-takas 
      not at end
               if takas-yil <> grf-yil or
                  takas-ay  <> grf-ay  or
                  takas-gun <> grf-gun
                     exit perform 
               end-if

               if acn-kod not = spaces and 
                  takas-acenta not = acn-kod
                     exit perform cycle
               end-if 

               initialize rez-rec
               move takas-rez-no         to rez-no
               read rez no lock invalid
                    exit perform cycle
               end-read
              
               if takas-tarih >= rez-cik-tar
                   exit perform cycle 
               end-if

               if rez-durumu not = "I"
                    exit perform cycle 
               end-if
               initialize cast-rec
               MOVE TAKAS-TARIH to cast-tarih
               move takas-rez-no to cast-rez-no
               read cast no lock invalid
                  continue
               end-read
               if takas-tarih < tarih-tasi
                     move cast-basilan-fiyat to rez-fiyati
                     else
                     move CAST-FIYATI to rez-fiyati
               end-if
               move cast-kisi to rez-kisi
               move cast-oda-no to rez-odano
          
               add 1                  to toplam-kayit
               initialize form2-gd-1-record
               move takas-rez-no      to gd-1-col-1
               move rez-adi           to gd-1-col-2
               move rez-soyadi        to gd-1-col-3

               move rez-gir-gun       to egun
               move rez-gir-ay        to eay
               move rez-gir-yil       to eyil
               move etarih            to gd-1-col-4
               move rez-al-gun       to egun
               move rez-al-ay        to eay
               move rez-al-yil       to eyil
               move etarih            to gd-1-col-15
               move rez-cik-gun       to egun
               move rez-cik-ay        to eay
               move rez-cik-yil       to eyil
               move etarih            to gd-1-col-5

               initialize acenta-rec 
               move rez-acenta        to acenta-kodu
               read acenta no lock invalid
                   move "Tanimsiz..."  to acenta-adi
               end-read 
                   move acenta-adi     to gd-1-col-6

               initialize kodlar02-rec 
               move "A"                to kodlar02-tipi
               move rez-pan-tipi       to kodlar02-kodu
               read kodlar02 no lock invalid 
                    move "***"         to kodlar02-adi
               end-read 
                    move kodlar02-adi  to gd-1-col-7

               initialize kodlar02-rec 
               move "E"                to kodlar02-tipi
               move rez-pazar          to kodlar02-kodu
               read kodlar02 no lock invalid 
                    move "***"         to kodlar02-adi
               end-read 
                    move kodlar02-adi  to gd-1-col-8

               if rez-firma not = spaces
                  initialize firma-rec
                  move rez-firma       to firma-kodu
                  read firma no lock invalid 
                      move "Hata-"     to firma-adi
                  end-read                       
                      move firma-adi   to gd-1-col-18
               end-if 
               move rez-buyuk          to z-tek
               move z-tek              to gd-1-col-9
               move rez-kucuk          to z-tek
               move z-tek              to gd-1-col-10
               move rez-free           to z-tek
               move z-tek              to gd-1-col-11
               move rez-bebek          to z-tek
               move z-tek              to gd-1-col-12

               move rez-fiyati         to e-tut
               move e-tut              to gd-1-col-13

               compute toplam-buyuk = toplam-buyuk + rez-buyuk                   
               compute toplam-kucuk = toplam-kucuk + rez-kucuk
               compute toplam-free  = toplam-free  + rez-free                   
               compute toplam-bebek = toplam-bebek + rez-bebek

               initialize doviz-rec
               move rez-doviz          to doviz-kodu
               read doviz no lock invalid 
                    move "***"         to d-kisa-adi
               end-read 
                    move d-kisa-adi    to gd-1-col-14
               if cast-oda-konumu > 0
                  initialize konum-rec
                  move cast-oda-konumu    to konum-anahtar
                  read konum no lock invalid
                      move "Hata-"     to konum-adi
                  end-read                          
                      move konum-adi   to gd-1-col-16
               end-if 
               if cast-fiyat-konumu > 0
                  initialize konum-rec
                  move cast-fiyat-konumu    to konum-anahtar
                  read konum no lock invalid
                      move "Hata-"     to konum-adi
                  end-read                          
                      move konum-adi   to gd-1-col-17
               end-if 

               modify form2-gd-1,record-to-add(form2-gd-1-record)
      end-read 
      end-perform
      end-start   
      close cast    
               initialize form2-gd-1-record
               move "Toplam--->"           to gd-1-col-1
               move toplam-kayit           to ztoplam
               move ztoplam                to gd-1-col-2

               move toplam-buyuk           to ztoplam
               move ztoplam                to gd-1-col-9

               move toplam-kucuk           to ztoplam
               move ztoplam                to gd-1-col-10

               move toplam-free            to ztoplam
               move ztoplam                to gd-1-col-11

               move toplam-bebek           to ztoplam
               move ztoplam                to gd-1-col-12

               modify form2-gd-1,record-to-add(form2-gd-1-record)
               modify form2-gd-1(toplam-kayit + 2,1),row-color = 481

      close takas rez acenta konum firma 
            kodlar02 doviz takas3
      modify form2-gd-1,mass-update = 0
     .
*
 Form1-Ef-1-Aft-Procedure.
          open input kur doviz 
         move butce-cev-doviz to DOVIZ-KODU
         read doviz no lock invalid
            display message box  "Tanimsiz Doviz Girdiniz"
            move "Tanimsiz " to d-kisa-adi
         end-read
         move  d-kisa-adi to kur-adi

        move ilk-tarih to kur-tarih
        move "87" to kur-banka
        if merkez = 1 then 
          move "01" to kur-banka
        end-if
        move doviz-kodu to kur-doviz
           read kur no lock invalid
                move 1 to merkez
                display Form1-Cb-1
                move "01" to kur-banka
                read kur no lock invalid
                  move 1 to doviz-alis
                end-read
            end-read
           move doviz-alis to cevrim-kuru  cevrim-kur-sayisal
         display kdov adov ikur
        close kur doviz
     .
*
 dokcagir-call.
  
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
  
*
 narg-islemler.
      inquire Form2-Gd-1 cursor-y in satir-yer
    evaluate key-status
 
    when 20
    when 21
    when 6
    when 11
    when 16
    when 17
    when 14
         open input konuk 
          perform test after until not (konuk-folio  = 99999999 or konuk-folio  = 0)  
              open input rez
              inquire Form2-Gd-1(satir-yer,1) 
                      cell-data in rez-no
              read rez no lock invalid 
                   display message box 
                           "Rez okunamadi" 
                   close rez 
                   exit perform
              not invalid
                  if rez-folio = 0 then 
                     if rez-gir-tar = tarih-tasi or key-status = 16
                        move 99999998 to konuk-folio
                     else      
                        display message box 
                                "Rezervasyon C/IN olmamis" 
                        close rez 
                        exit perform
                     end-if  
                  else
                     move rez-folio to konuk-folio
                  end-if
              end-read
              close rez
       
         read konuk no lock invalid 
              evaluate true
              when konuk-folio = 99999998 and key-status = 14 
                   display message box 
                           "C/In Islemi Yapacaksiniz. Emin Misiniz? ",
                           icon mb_warning_icon
                           title "Bilginize ..."
                           type mb_yes_no,
                           default 2
                           returning uyari
                   if uyari = 1
**************************> rezcin.asy
                      move rez-no                 to konuk-rez-no
                      initialize dokcagir-tasi
                      set dokcagir-tasi-call-cin2 to true
                      move konuk-rez-no           to dokcagir-konuk-rez-no      
                      move konuk-folio            to dokcagir-konuk-folio
                      perform dokcagir-call
                      move dokcagir-konuk-rez-no  to konuk-rez-no
                      move dokcagir-konuk-folio   to konuk-folio

                   end-if
              when konuk-folio = 99999998 and  key-status = 16 
**************************> PROFORMA CALL
                   initialize dokcagir-tasi
                   set dokcagir-tasi-call-proforma2  to true
                   move rez-no                       to dokcagir-rez-no
                   move konuk-folio                  to dokcagir-konuk-folio
                   perform dokcagir-call
                   move dokcagir-rez-no              to rez-no
                   move dokcagir-konuk-folio         to konuk-folio
              when other
                   display message box "Bagli register karti bulunamadi"
              end-evaluate
         not invalid
             if key-status = 16 then 
                 if konuk-fol-kodu not = "R" then
                    display message box "Lutfen Oda Folyosu Seciniz"
                 else
*********************> profat.asy
                    initialize dokcagir-tasi
                    set dokcagir-tasi-call-proforma2   to true
                    move rez-no                        to dokcagir-rez-no
                    move konuk-folio                   to dokcagir-konuk-folio
                    perform dokcagir-call
                    move dokcagir-rez-no               to rez-no
                    move dokcagir-konuk-folio          to konuk-folio
                 end-if
             end-if

             if key-status = 21 then 
                if konuk-fol-kodu not = "R" then
                   display message box 
                           "Lutfen Oda Folyosu Seciniz"
                else
**************************> ozlukgir.asy
                   initialize dokcagir-tasi
                   set dokcagir-tasi-call-ozlukgir1 to true
                   move konuk-folio                 to dokcagir-konuk-folio
                   perform dokcagir-call
                   move dokcagir-konuk-folio        to konuk-folio
                end-if
             end-if

             if key-status = 14 then
**********************> rezcin.asy
                initialize dokcagir-tasi
                set dokcagir-tasi-call-cin2          to true
                move konuk-rez-no                    to dokcagir-konuk-rez-no      
                move konuk-folio                     to dokcagir-konuk-folio
                perform dokcagir-call
                move dokcagir-konuk-folio            to konuk-folio
                move dokcagir-konuk-rez-no           to konuk-rez-no
             end-if

             if key-status = 6 then
**************************> folio.asy
                initialize dokcagir-tasi
                set dokcagir-tasi-call-folio1      to true
                move konuk-folio                   to dokcagir-konuk-folio
                perform dokcagir-call
                move dokcagir-konuk-folio          to konuk-folio
             end-if
                 
             if key-status = 11
                initialize dokcagir-tasi
                set dokcagir-tasi-call-kfolio     to true
                move konuk-folio                   to dokcagir-konuk-folio
                perform dokcagir-call
                move dokcagir-konuk-folio          to konuk-folio
             end-if

             if key-status = 20 then
                if konuk-durumu = "H" then
                   display message box "Oda C/out Olmus"
                else
********************> cout.asy
                   initialize dokcagir-tasi
                   set dokcagir-tasi-call-cout2 to true
                   move konuk-odano             to dokcagir-konuk-odano
                   move konuk-folio             to dokcagir-konuk-folio
                   perform dokcagir-call
                   move dokcagir-konuk-odano    to konuk-odano
                   move dokcagir-konuk-folio    to konuk-folio
                end-if
             end-if
        end-read
       
         if konuk-folio = 99999999 then
            add 1 to satir-yer
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if

         if konuk-folio = 0 and satir-yer > 2 then
            subtract 1 from satir-yer 
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if
         end-perform

         close konuk 
              
        

    when 18 
         open input rez 
           
        
         perform test after until not (rez-no  = 99999999 or rez-no  = 0)  
         
              inquire Form2-Gd-1(satir-yer,1) 
                      cell-data in rez-no
        

         read rez no lock invalid 
              display message box 
                      "Bagli rezervasyon bulunamadi"
              exit perform 
         not invalid
**************************> rez.asy
             initialize dokcagir-tasi
             set dokcagir-tasi-call-rez1   to true
             move rez-no                   to dokcagir-rez-no
             perform dokcagir-call
             move dokcagir-rez-no          to rez-no
         end-read

         if rez-no = 99999999 then
            add 1 to satir-yer
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if

         if rez-no = 0 and satir-yer > 2 then
            subtract 1 from satir-yer 
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if
         end-perform
         close rez
     

     end-evaluate.
*
 raporla.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi 
     open output dokumer 
     open input takas3 
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Grafik Forecast Verileri" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Grafik Forecast Verileri" to det-filler
     move "ilk Tarih:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "                " to det-filler
     move "Son Tarih:"     to det-filler(41:10)
     move son-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move son-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move son-yil        to det-filler(57:04)
     write dokumer-rec from detay
     

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2) 
     move "Tarih "              to  det-tarih 
     move "Oda     "            to det-oda1  
     move "Doluluk"             to det-yuzde1 
     move "Pax     "            to det-pax1 
     move "Pax Ort "            to det-paxort1
     move "Oda Ort "            to det-odaort1
     move "Tutar   "            to det-tutar1 
     move "Onceki Bugun"        to det-ara1
     move "Tarih "              to det-tarih 
     move "Oda     "            to det-oda2 
     move "Doluluk"             to det-yuzde2 
     move "Pax     "            to det-pax2 
     move "Pax Ort "            to det-paxort2
     move "Oda Ort "            to det-odaort2
     move "Tutar   "            to det-tutar2 
     move "Onceki Gerc "        to det-ara2
     move "Oda     "            to det-oda3 
     move "Doluluk "            to det-yuzde3 
     move "Pax     "            to det-pax3 
     move "Pax Ort "            to det-paxort3
     move "Oda Ort "            to det-odaort3
     move "Tutar   "            to det-tutar3   
      
        move "|" to fil-0 fil-1  fil-2 fil-3  fil-4   fil-5  fil-6  fil-11  fil-12  fil-13  
        fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 fil-24 fil-25  fil-26 
        fil-27 fil-28            
     write dokumer-rec from detay
     move ilk-tarih to takas3-tarih
       if Datatip(1:1) = "A" 
                   move "00" to takas3-gun
        end-if
     start takas3 key >= takas3-tarih invalid move "10" to fs-takas3
     end-start
    

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
    move "|" to fil-0 fil-1  fil-2 fil-3  fil-4   fil-5  fil-6  fil-11  fil-12  fil-13  
        fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 fil-24 fil-25  fil-26 
        fil-27 fil-28   
     write dokumer-rec from detay
  
**************************
        
     perform  until fs-takas3 = "10"
     read takas3 next no lock end move "10" to fs-takas3
     not at end
          if takas3-tarih > son-tarih
               exit perform
          end-if

          initialize dokumer-rec detay 
 
          move takas3-gun        to egun
          move takas3-ay         to eay
          move takas3-yil        to eyil
          move etarih             to det-tarih

*          move  G-TAKAS3-ODA to zy-oda
          move zy-oda        to det-oda1

*         compute yuzde-s rounded = ( G-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde1

*          move G-TAKAS3-p to zy-pax
          move zy-pax to det-pax1
*          compute ort rounded = G-TAKAS3-t / G-TAKAS3-ODA
          move ort to zy-ort
          move zy-ort to det-odaort1

*          compute ort rounded = G-TAKAS3-t / G-TAKAS3-p
          move ort to zy-ort
          move zy-ort to det-paxort1

*          move G-TAKAS3-t to zy-tutar
          move zy-tutar   to det-tutar1

****************************************
*          move  Gk-TAKAS3-ODA to zy-oda
          move zy-oda        to det-oda2

*         compute yuzde-s rounded = ( Gk-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde2

*          move Gk-TAKAS3-p to zy-pax
          move zy-pax to det-pax2
*          compute ort rounded = Gk-TAKAS3-t / Gk-TAKAS3-ODA
          move ort to zy-ort
          move zy-ort to det-odaort2

*          compute ort rounded = Gk-TAKAS3-t / Gk-TAKAS3-p
          move ort to zy-ort
          move zy-ort to det-paxort2

*          move Gk-TAKAS3-t to zy-tutar
          move zy-tutar   to det-tutar2

*******************************************
*          move  Gk1-TAKAS3-ODA to zy-oda
          move zy-oda        to det-oda3

*         compute yuzde-s rounded = ( Gk1-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde3

*          move Gk1-TAKAS3-p to zy-pax
          move zy-pax to det-pax3
*          compute ort rounded = Gk1-TAKAS3-t / Gk-TAKAS3-ODA
          move ort to zy-ort
          move zy-ort to det-odaort3

*          compute ort rounded = Gk1-TAKAS3-t / Gk-TAKAS3-p
          move ort to zy-ort
          move zy-ort to det-paxort3

*          move Gk1-TAKAS3-t to zy-tutar
          move zy-tutar   to det-tutar3









         move "|" to   fil-0   fil-1   fil-2  fil-3  fil-4   fil-5  fil-6  fil-11 
                       fil-12  fil-13  fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 
                       fil-24  fil-25  fil-26 fil-27 fil-28    
*          move takas-sabah-adet to z-kahtop
*          move z-kahtop         to det-2

*          move takas-ogle-adet to z-ogltop
*          move z-ogltop         to det-3

*          move takas-aksam-adet to z-akstop
*          move z-akstop         to det-4

          write dokumer-rec from detay
           end-read
     end-perform
    
              initialize dokumer-rec detay 
          
          move "TOPLAM "           to det-tarih


          move takas-detay-ok to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk /  TAKAS-DETAY-pk
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk to z-tutar
                              move z-tutar to  detay-adi(42:)



          move  toplam-siklik to zy-oda
          move zy-oda        to det-oda1
            compute yuzde-s rounded =  ( toplam-siklik / toplam-oda-kap) * 100
        
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde1

          move toplam-pax to zy-pax
          move zy-pax to det-pax1
          compute ort rounded = toplam-gelir / toplam-siklik
          move ort to zy-ort
          move zy-ort to det-odaort1

          compute ort rounded = toplam-gelir / toplam-pax
          move ort to zy-ort
          move zy-ort to det-paxort1

          move toplam-gelir to zy-tutar
          move zy-tutar   to det-tutar1

****************************************
          move  takas-detay-ok to zy-oda
          move zy-oda        to det-oda2

         compute yuzde-s rounded = ( takas-detay-ok / toplam-oda-kap )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde2

          move TAKAS-DETAY-pk to zy-pax
          move zy-pax to det-pax2
          compute ort rounded = TAKAS-DETAY-tk / takas-detay-ok
          move ort to zy-ort
          move zy-ort to det-odaort2

          compute ort rounded = TAKAS-DETAY-tk / TAKAS-DETAY-pk
          move ort to zy-ort
          move zy-ort to det-paxort2

          move TAKAS-DETAY-tk to zy-tutar
          move zy-tutar   to det-tutar2

*******************************************
          move  takas-detay-ok1 to zy-oda
          move zy-oda        to det-oda3

         compute yuzde-s rounded = ( takas-detay-ok1 / toplam-oda-kap )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde3

          move TAKAS-DETAY-pk1 to zy-pax
          move zy-pax to det-pax3
          compute ort rounded = TAKAS-DETAY-tk1 / takas-detay-ok1
          move ort to zy-ort
          move zy-ort to det-odaort3

          compute ort rounded = TAKAS-DETAY-tk1 / TAKAS-DETAY-pk1
          move ort to zy-ort
          move zy-ort to det-paxort3

          move TAKAS-DETAY-tk1 to zy-tutar
          move zy-tutar   to det-tutar3

                     move "T"          to det-dokumer-20(1:1)
                          move "A"          to det-dokumer-20(3:1)
                         move 481 to det-renk1
                         move "1"          to det-dokumer-20(10:1)







         move "|" to   fil-0   fil-1   fil-2  fil-3  fil-4   fil-5  fil-6  fil-11 
                       fil-12  fil-13  fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 
                       fil-24  fil-25  fil-26 fil-27 fil-28    
*          move takas-sabah-adet to z-kahtop
*          move z-kahtop         to det-2

*          move takas-ogle-adet to z-ogltop
*          move z-ogltop         to det-3

*          move takas-aksam-adet to z-akstop
*          move z-akstop         to det-4

          write dokumer-rec from detay  
   

















     close dokumer
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     close takas3
     delete file dokumer . 
*


  detay-raporla.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi 
     open output dokumer 
     open input takas3 
*/WINDOW TITLE
     open input   kodlar02  konum ulke acenta takas-detay
     initialize dokumer-rec detay2
     move "W"                  to det2-dokumer-20(1:)
     move "Grafik Forecast Verileri" to det2-filler
     write dokumer-rec from detay2
*/ BASLIKLAR
     initialize dokumer-rec detay2
     move "1"          to det2-dokumer-20(10:1)
     move "B"                  to det2-dokumer-20(1:1)
     move "Grafik Forecast Verileri" to det2-filler
        write dokumer-rec from detay2
    
    

     initialize dokumer-rec detay2
     move "1"          to det2-dokumer-20(10:1)
     move "B"                  to det2-dokumer-20(1:1)
     move "                " to det2-filler
      move "ilk Tarih:"     to det2-filler(41:10)
     move ilk-gun        to det2-filler(51:02)
     move "/"            to det2-filler(53:01)
     move ilk-ay         to det2-filler(54:02)
     move "/"            to det2-filler(56:01)
     move ilk-yil        to det2-filler(57:04)
     move "Son Tarih:"     to det2-filler(61:10)
     move son-gun        to det2-filler(71:02)
     move "/"            to det2-filler(73:01)
     move son-ay         to det2-filler(74:02)
     move "/"            to det2-filler(76:01)
     move son-yil        to det2-filler(77:04)
     write dokumer-rec from detay2
     

     

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay2
     move "O" to det2-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det2-filler
     write dokumer-rec from detay2
*/ BASLIKLAR  
 
     initialize dokumer-rec detay2 
     move "1"          to det2-dokumer-20(10:1)
     move "D1"                          to det2-dokumer-20(1:2) 
     move "Tarih "              to  det2-tarih 

       perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                              evaluate bol-tip
                                  when "T" 
                                    if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                             evaluate  takas-detay-asya-kodu(1:2)
                                                 when "00"
                                                      move "Kendi Konaklamalari" to detay-adi
                                                 when  other 
                                                     move "Transferle Gelenler" to detay-adi
                                             end-evaluate
                                              
                                          
                                     end-if


                                  when "S" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                             evaluate  takas-detay-asya-kodu(1:2)
                                                 when "01"
                                                   move "Son Hafta Satislari" to detay-adi
                                                 when "02"
                                                   move "8-14 gun once Satislari" to detay-adi
                                                 when "03"
                                                   move "15-21 gun once Satislari" to detay-adi
                                                when "04"
                                                   move "22-28 gun once Satislari" to detay-adi
                                                when "05"
                                                   move "29-35 gun once Satislari" to detay-adi
                                                when "06"
                                                   move "36-42 gun once Satislari" to detay-adi
                                                when "07"
                                                   move "43-49 gun once Satislari" to detay-adi
                                                when "08"
                                                   move "50-56 gun once Satislari" to detay-adi
                                                 when "09"
                                                   move "57-63 gun once Satislari" to detay-adi
                                                 when "10"
                                                   move "64-70 gun once Satislari" to detay-adi
                                                 when "11"
                                                   move "71-77 gun once Satislari" to detay-adi
                                                when  other 
                                                   move "Daha onceki Satislar" to detay-adi
                                             end-evaluate
                                              
                                          
                                     end-if
                                  when "P" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to kodlar02-kodu
                                              move "E"  to kodlar02-tipi
                                              read kodlar02 no lock invalid continue
                                             end-read
                                           move kodlar02-adi to detay-adi
                                     end-if
                                   when "R" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Anlasmalar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to kodlar02-kodu
                                              move "D"  to kodlar02-tipi
                                              read kodlar02 no lock invalid continue
                                             end-read
                                           move kodlar02-adi to detay-adi
                                     end-if
                                    when "F" 
                                    when "O"
                                      if ii = max-detay - 1 then 
                                             move "Diger Konumlar" to detay-adi
                                        else
                                              move function numval(takas-detay-asya-kodu) to konum-anahtar
                                              read konum no lock invalid continue
                                             end-read
                                           move konum-adi to detay-adi
                                     end-if
                                   when "A"
                                      if ii = max-detay - 1 then 
                                             move "Diger Acentalar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to acenta-kodu
                                              read acenta no lock invalid continue
                                             end-read
                                           move acenta-adi to detay-adi
                                     end-if
                                   when "U"
                                      if ii = max-detay - 1 then 
                                             move "Diger Ulkeler" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to ulke-anah
                                              read ulke no lock invalid continue
                                             end-read
                                           move ulke-adi to detay-adi
                                     end-if
                                       
                               end-evaluate
              move detay-adi           to  det2-oda1(ii + 1 )
              move "|"                 to  fil2-1(ii + 1 )
        end-perform 
      move "TOPLAM   "            to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
     move "Yuzde "            to det2-yuzde( ii + 2 )
  
      
        move "|" to fil2-0 det2-fil(ii + 2 )  
     write dokumer-rec from detay2
     move ilk-tarih to takas3-tarih
     
     start takas3 key >= takas3-tarih invalid move "10" to fs-takas3
     end-start
    

     initialize dokumer-rec detay2
     move "D2"           to det2-dokumer-20(1:2)
     move "-"            to det2-dokumer-20(5:1)
        perform varying ii from 0 by 1 until ii > son-sira - 1
            
              move  all "-"        to det2-oda1(ii + 1)
              move "|"                 to  fil2-1(ii + 1 )

          end-perform 
          
         move  all "-"      to det2-oda1(ii + 1)
          move "|"                 to  fil2-1(ii + 1)

        
           move all "-"  to det2-yuzde(ii + 2 )

              move "|" to fil2-0 det2-fil(ii + 2 ) 

    
     write dokumer-rec from detay2
  
**************************
        
     perform  until fs-takas3 = "10"
    
     read takas3 next no lock end move "10" to fs-takas3
     not at end
          if takas3-tarih > son-tarih
               exit perform
          end-if
         
                             



          initialize dokumer-rec detay2 
 
          move takas3-gun        to egun
          move takas3-ay         to eay
          move takas3-yil        to eyil
          move etarih             to det2-tarih


          perform varying ii from 0 by 1 until ii > son-sira - 1
              move  takas-yer( ii + 1 ) to iii
             move  spaces to zy-oda
              move zy-oda        to det2-oda1(ii + 1)
              move "|"                 to  fil2-1(ii + 1 )

          end-perform 
*           move  G-TAKAS3-ODA to zy-oda
          move zy-oda        to det2-oda1(ii + 1)
          move "|"                 to  fil2-1(ii + 1)

*         compute yuzde-s rounded = ( G-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
           move  yuzde-s to zy-yuzde
           move zy-yuzde  to det2-yuzde(ii + 2 )

              move "|" to fil2-0 det2-fil(ii + 2 ) 

                      
          write dokumer-rec from detay2
           end-read
     end-perform
       
         initialize dokumer-rec detay2 
          move "TOP. ODA"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                      move takas-detay-o to zY-ODA
                     move zy-oda        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        MOVE TOPLAM-Siklik TO zY-ODA
        move zy-oda        to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
        compute yuzde-s rounded =  ( toplam-siklik / toplam-oda-kap) * 100
        move yuzde-s to yuzde-z   
        move yuzde-z  to det2-yuzde(ii + 2 )
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2  
   
          initialize dokumer-rec detay2 
          move "TOP. PAX"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                      move TAKAS-DETAY-p to zY-pax
                     move zy-pax        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        MOVE TOPLAM-buyuk TO zY-ODA
        move zy-oda        to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
        compute yuzde-s rounded =  ( toplam-pax / toplam-pax-kap) * 100
        move yuzde-s to yuzde-z   
        move yuzde-z  to det2-yuzde(ii + 2 )
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 

          initialize dokumer-rec detay2 
          move "TOP. PP"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                     compute ort rounded =  TAKAS-DETAY-t / TAKAS-DETAY-p
                      move ort to zY-ort
                     move zy-ort        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        compute ort rounded =  toplam-gelir / toplam-pax
        move ort to zY-ort
        move zy-ort       to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
       
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 

                initialize dokumer-rec detay2 
          move "ODA ORT "           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                     compute ort rounded =  TAKAS-DETAY-t / TAKAS-DETAY-o
                      move ort to zY-ort
                     move zy-ort        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        compute ort rounded =  toplam-gelir / TOPLAM-Siklik
        move ort to zY-ort
        move zy-ort       to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
       
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 
       

      
          initialize dokumer-rec detay2 
          move "TOP. GELIR"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                    
                      move TAKAS-DETAY-t to zY-tutar
                     move zY-tutar        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

     
        move toplam-gelir to zY-tutar
        move zY-tutar     to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
       
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 

        

        close  kodlar02  konum ulke acenta takas-detay

     close dokumer
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     close takas3
     delete file dokumer . 
*



               

 
