* posting.evt
* posting.evt is generated from D:\asya\acugt.ytl\otel\posting.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM exception-procedure
     .

 eposting-evet-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Eposting-Evet-Aft-Procedure
        END-EVALUATE
     END-IF
     .

 eposting-hayir-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Eposting-Hayir-Aft-Procedure
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform adresleri-tasi.
     initialize posting-tipi.
      call "c$narg" using link-var.
     .
*
 before-procedure.
     initialize mesaj.
     evaluate control-id
          when 5
              evaluate true
                  when turkce
                       move "Room Foliolara Oda Fiyatlari Basilsin.. " to mesaj
                  when ingilizce
                       move "Room Foliolara Oda Fiyatlari Basilsin.. " to mesaj
                  when almanca
                       move "Room Foliolara Oda Fiyatlari Basilsin.. " to mesaj
              end-evaluate
          when 6
              evaluate true
                  when turkce
                       move "Room Foliolara Oda Fiyatlari Basilmasin.. " to mesaj
                  when ingilizce
                       move "Room Foliolara Oda Fiyatlari Basilmasin.. " to mesaj
                  when almanca
                       move "Room Foliolara Oda Fiyatlari Basilmasin.. " to mesaj
              end-evaluate
          when 7
              evaluate true
                  when turkce
                       move "Extra Foliolara Tanimli Extra Satislar Basilsin.. " to mesaj
                  when ingilizce
                       move "Extra Foliolara Tanimli Extra Satislar Basilsin.. " to mesaj
                  when almanca
                       move "Extra Foliolara Tanimli Extra Satislar Basilsin.. " to mesaj
              end-evaluate
          when 8
              evaluate true
                  when turkce
                       move "Extra Foliolara Tanimli Extra Satislar Basilmasin.. " to mesaj
                  when ingilizce
                       move "Extra Foliolara Tanimli Extra Satislar Basilmasin.. " to mesaj
                  when almanca
                       move "Extra Foliolara Tanimli Extra Satislar Basilmasin.. " to mesaj
              end-evaluate
          when 9
              evaluate true
                  when turkce
                       move "Extra Posting Icin TL Rakamini Baz Al.. " to mesaj
                  when ingilizce
                       move "Extra Posting Icin TL Rakamini Baz Al.. " to mesaj
                  when almanca
                       move "Extra Posting Icin TL Rakamini Baz Al.. " to mesaj
              end-evaluate
          when 10
              evaluate true
                  when turkce
                       move "Extra Posting Icin Doviz Rakamini Baz Al.. " to mesaj
                  when ingilizce
                       move "Extra Posting Icin Doviz Rakamini Baz Al.. " to mesaj
                  when almanca
                       move "Extra Posting Icin Doviz Rakamini Baz Al.. " to mesaj
              end-evaluate
          when 11
              evaluate true
                  when turkce
                       move "Islemi Baslat...... " to mesaj
                  when ingilizce
                       move "Islemi Baslat...... " to mesaj
                  when almanca
                       move "Islemi Baslat...... " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 1 
            panel-text = mesaj.
     .
 Form1-Aft-Initdata.
     open input genel 
     open i-o genel2
     move 1 to genel-anahtar
     read genel no lock invalid
          initialize mesaj-link
          move 03 to mesaj-no
          perform mesaj-ver
     not invalid
         continue
     end-read

     move 1 to genel2-anah
     read genel2 no lock invalid
          continue
     end-read

     move 1 to rposting-e-h.
     move 2 to eposting-e-h.
     if genel2-extra-post-isaretle = 1
        move 1 to eposting-e-h
     end-if

     close genel genel2

     move 1 to rposting-e-h.
     modify rposting-evet, group-value = rposting-e-h.
     if onkpara-mail-dep not > 0 then 
*        move 1 to eposting-e-h                        | genel2 lib açýldý ve parametreye baðlandý fýrat 03/02/2020
*     else
        move 2 to eposting-e-h
     end-if.
     modify eposting-evet, group-value = eposting-e-h.
     modify eposting-hayir, group-value = eposting-e-h.
     inquire eposting-evet, group-value in eposting-e-h.
     if eposting-e-h = 2
        modify eposting-tlden,    enabled = false
        modify eposting-dovizden, enabled = false
        move 1 to eposting-t-d
        modify eposting-tlden, GROUP-VALUE = eposting-t-d
     else 
        modify eposting-tlden,    enabled = true
        modify eposting-dovizden, enabled = true
        move 2 to eposting-t-d
        modify eposting-tlden, GROUP-VALUE = eposting-t-d
     end-if
     display form1.
     if link-var > 0
        if link-var > 1 then 
           move 1 to rposting-e-h
           move 2 to eposting-e-h
           modify rposting-evet, group-value = rposting-e-h
           modify eposting-evet, group-value = eposting-e-h
           open input konuk
           move link-folio to konuk-folio
           read konuk no lock invalid
                close konuk
                set exit-pushed to true
           not invalid
               close konuk
               move konuk-odano to single-post-oda
               display Form1-Ef-1
               move 1 to posting-tipi 
               move 0 to tum-gunler
               display Form1-Cb-1 Form1-Cb-1a
               move 2 to key-status
               perform exception-procedure
               set exit-pushed to true

        else
           move 1 to    rposting-e-h
           move 2 to eposting-e-h
           modify rposting-evet, group-value = rposting-e-h
           modify eposting-evet, group-value = eposting-e-h
           open input konuk
           move link-folio to konuk-folio
           read konuk no lock invalid
                close konuk
                set exit-pushed to true
           not invalid
               close konuk
               move konuk-odano to single-post-oda
               display Form1-Ef-1
               move 1 to posting-tipi tum-gunler
               display Form1-Cb-1 Form1-Cb-1a
               move 2 to key-status
               perform exception-procedure
               set exit-pushed to true
           end-read
        end-if
**************************************************************|firat 30/09/2019 delphine icin kapatildi :D  
*     else                                                    |firat 29/10/2019 delphine icin acildi    :)
*        perform city-control                                 |firat 20/11/2019 delphine icin kapatildi :|
*        if city-hata = 1 then  
*           display message box "Onceki Hatalari cozmeden postinge devam edemessiniz" new-line
*           set exit-pushed to true
*        end-if
**********************************************************************
     end-if
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 eposting-hayir-Aft-Procedure.
*     inquire eposting-hayir, group-value in eposting-e-h.
     if eposting-e-h = 2
        move 1 to eposting-t-d
        modify eposting-tlden, GROUP-VALUE = eposting-t-d
        modify eposting-tlden,    enabled = false
        modify eposting-dovizden, enabled = false
     else 
        move 1 to eposting-t-d
        modify eposting-tlden, GROUP-VALUE = eposting-t-d
        modify eposting-tlden,    enabled = true
        modify eposting-dovizden, enabled = true
     end-if
     .
*
 eposting-evet-Aft-Procedure.
     inquire eposting-evet, group-value in eposting-e-h.
     if eposting-e-h = 2
        move 1 to eposting-t-d
        modify eposting-tlden, GROUP-VALUE = eposting-t-d
        modify eposting-tlden,    enabled = false
        modify eposting-dovizden, enabled = false
     else 
        move 1 to eposting-t-d
        modify eposting-tlden, GROUP-VALUE = eposting-t-d
        modify eposting-tlden,    enabled = true
        modify eposting-dovizden, enabled = true
     end-if
     .
*     
 secim-kontrolu.
     initialize gec-gecme.
     if rposting-e-h = 2 and eposting-e-h = 2
        move 1 to gec-gecme
     else
        move 0 to gec-gecme
     end-if.
    
*
 kur-kontrol. 
     initialize detay-var  bos-fiyat 
     open input konuk kur 
     initialize konuk-rec 
     move "I"  to konuk-durumu.  
    start konuk key not < konuk-oda 
        invalid 
        continue
         not invalid
         perform until fs-konuk = "10"
           read konuk next no lock
              end 
                 move "10" to fs-konuk
              not end
                initialize kur-hata
               
                if konuk-durumu not = "I" 
                     move "10" to fs-konuk
                   else
                    if konuk-fol-kodu not = "R" or
                       calisma-tarihi not < konuk-git-tar or
                       konuk-gel-tar > calisma-tarihi     then
                         continue
                       else
                          
                          if konuk-gec-giris = 1 then 
                             move konuk-gel-tar to takvim-anah
                             
                             open input takvim
                             start takvim key = takvim-anah
                                invalid 
                                   continue
                                not invalid 
                                   read  takvim previous no lock end-read
                                   read  takvim previous no lock end continue end-read
                                    move takvim-anah to konuk-gel-tar

                              end-start
                              close takvim
                          end-if
                          move konuk-gel-yil      to kur-yil
                          move konuk-gel-ay       to kur-ay
                          move konuk-gel-gun      to kur-gun
                          move konuk-banka        to kur-banka
                          move konuk-doviz        to kur-doviz
                           if KONUK-ODA-TUTAR = 0 and konuk-buyuk > 0 then 
                               move 1           to bos-fiyat
                               move konuk-odano to bos-f-oda
                           end-if  
                           read kur no lock 
                                invalid
                                   move 1 to kur-hata
                                not invalid
                                   if  doviz-alis not = konuk-kur-degeri
                                      move 1 to kur-hata
                                   end-if
                           end-read
                              
                    end-if
                 end-if
                 if kur-hata = 1 then 
                    perform detay-ata 
                 end-if

           end-read
         end-perform
     end-start.
     close konuk kur
     if detay-var = 1 then perform detay-son end-if.
     .

 ilk-detay.
        open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer 
     open input acenta
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Kur Uyusmazlik Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Kur Uyusmazlik Raporu" to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move gun-tasi       to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ay-tasi        to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move yil-tasi       to det-filler(57:04)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLRRLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"                           to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2)     
     move "Oda"                         to det-1 
     move "Adi       "                  to det-2      
     move "Soyadi    "                  to det-3   
     move "Kur-tarihi"                  to det-4 
     move "Kur Dosyasi"                 to det-5 
     move "CIN Kuru"                    to det-6      
     move "Acen"                        to det-7       
     move "Acenta Adi"                  to det-8    
     move "Folio"                       to det-9 
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 
                 fil-7 fil-8  fil-9 
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                 det-7 det-8  det-9 
     write dokumer-rec from detay.
     .

**************************
 detay-ata.
               if detay-var = 0 then
                  move 1 to detay-var
                  perform ilk-detay
                end-if
                  initialize dokumer-rec detay
                  move konuk-gel-gun         to gun-x 
                  move konuk-gel-ay          to ay-x 
                  move konuk-gel-yil         to yil-x 
                  move "/"                to fil-1x fil-2x
                  move tarih-x            to det-4
                  move konuk-folio        to det-9
                  move konuk-adi          to det-2
                  move konuk-soyadi       to det-3
                  move konuk-odano        to det-1
                  move doviz-alis         to islem-kuru-z
                  move islem-kuru-z       to det-5
                  move konuk-kur-degeri   to islem-kuru-z
                  move islem-kuru-z       to det-6
                  move konuk-acenta      to det-7
                  move konuk-acenta to acenta-kodu
                  read acenta no lock invalid move all "*" to acenta-adi
                    not invalid move acenta-adi to det-8
                  end-read
                  
                  move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 
                       fil-7 fil-8 fil-9 
                  write dokumer-rec from detay
                .
 detay-son.
          close dokumer acenta 
          display message box 
                      "CIN Kurlarinda Uyuþmazlik Tespit Edilmistir? ", new-line
                      "Raporlamak istermisiniz?",

                  icon mb_warning_icon
                  title "Bilginize ..."
                  type mb_yes_no,
                  default 1
                  returning uyari
          if uyari = 1 then 
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              
           end-if  
              delete file dokumer.

 exception-procedure.
     evaluate key-status
         when 2
              perform inhouse-kontrol
                  if genel-hkrap-auto = 1
                     initialize link-hk-rap-calis
                     move 1 to link-hk-rap-calis
                     call "/asya/ytl/obj/otel/houserap.asy" using link-hk-rap-calis 
                          on exception
                             perform callerr-proc
                          not on exception
                     cancel "/asya/ytl/obj/otel/houserap.asy"
                     end-call              
                  end-if 

              if single-posting
                 open input odalar
                 move single-post-oda to odalar-anah
                 read odalar no lock invalid
                      display message box 
                              "Tanimsiz Oda ..."
                      close odalar
                      move 4 to accept-control
                      move 15 to control-id
                      exit paragraph
                 end-read
                 close odalar
              end-if
              if not single-posting
                 perform cincout-kontrol
                 if cout-var or cin-var                    
                    move 27 to key-status
                    exit paragraph
                 end-if

                 move calisma-tarihi to takvim-anah
                 
                 open i-o takvim
                 read takvim no lock invalid 
                      display message box " Hata No :3883883"
                 not invalid
                      if takvim-posting = "E" then
                         display message box 
                         "Daha Once Posting Olmus. Emin misin? ",
                          icon mb_warning_icon
                          title "Bilginize ..."
                          type mb_yes_no,
                          default 2
                          returning uyari
                          if uyari = 2
                             close takvim
                             exit paragraph 
                          end-if
                      end-if
                  end-read
                  close takvim

                  perform kur-kontrol
                  if detay-var = 1 then  
                     display message box 
                             "CIN Kurlarinda Uyusmazliga Ragmen? ", new-line
                             "Posting Yapilsin mi?",
                             icon mb_warning_icon
                             title "Bilginize ..."
                             type mb_yes_no,
                             default 2
                     returning uyari
                     if uyari = 2 then 
                        exit paragraph 
                     end-if
                  end-if 
                  if bos-fiyat = 1  then
                            display message box 
                             bos-f-oda " oda fiyati olmamasina ragmen devam edilsin mi? ", new-line
                             "Posting Yapilsin mi?",
                             icon mb_warning_icon
                             title "Bilginize ..."
                             type mb_yes_no,
                             default 2
                     returning uyari
                     if uyari = 2 then 
                        exit paragraph 
                     end-if
                   end-if
              end-if 

              ||////perform rez-to-cast-bakim

              perform secim-kontrolu
              if gec-gecme = 0
              if tum-gunler = 1 and single-posting
                 initialize konuk-rec mami-konuk-bulundu
                  open input konuk
                       move "I" to konuk-durumu
                       move single-post-oda to konuk-odano
                       start konuk key >= konuk-oda invalid continue
                          not invalid 
                          perform until fs-konuk = "10"
                            read konuk next no lock end move "10" to fs-konuk
                               not end
                                 if konuk-durumu not = "I" or konuk-odano  not = single-post-oda
                                           move "10" to fs-konuk
                                        else

                                     if konuk-fol-kodu = "R"  
                                        if link-var > 0
                                          if  link-folio not =  konuk-folio
                                          exit perform cycle
                                          end-if
                                        end-if
                                          move 1 to mami-konuk-bulundu
                                          move "10" to fs-konuk
                                     end-if
                                end-if
                           end-read                 
                        end-perform
                     end-start

                  close konuk
                  if mami-konuk-bulundu = 1
                            move calisma-tarihi to s1   bugun
                            move konuk-git-tar to s2
     
                           perform varying si from function integer-of-date(s1) by 1 until  si >= function integer-of-date(s2)
                             
                             move function date-of-integer(si) to sbu
                             move sbu to calisma-tarihi
                              perform islem-yap thru islem-yap-exit 
        
                           end-perform 
                         move bugun to  calisma-tarihi
                   else
                      display message box "Folio bulunamadi"
                   end-if
                 else
                     perform islem-yap thru islem-yap-exit  
              end-if
                 move calisma-tarihi to takvim-anah
                 if not single-posting
                    open i-o takvim
                    read takvim no lock invalid 
                         display message box 
                                 " Hata No :3884583"
                    not invalid
                         move "E" to takvim-posting
                         rewrite takvim-rec end-rewrite
                         perform log-operation-takvim
                    end-read
                    close takvim
                 
                    if onkpara-cout-kuru = 1 then 
                         call "/asya/ytl/obj/otel/poscout.asy"
                      using 1
                      on exception 
                        perform callerr-proc
                      not on exception
                        cancel "/asya/ytl/obj/otel/poscout.asy"
                    end-call
                    end-if

                 end-if

                 perform loga-yaz
                    if not single-posting and inhouse-bulundu = 0 
                           call "/asya/ytl/obj/otel/onkinit.asy"
                              using 1
                              on exception 
                                perform callerr-proc
                              not on exception
                                cancel "/asya/ytl/obj/otel/onkinit.asy"
                            end-call
                    end-if
                evaluate link-var
                 when 2
                     display message box 
                         "Ayni Gun Cikisli konaklamaya oda fiyati post edildi."
                         title "[ Uyari ]"
                         icon 1
                  when 1 
                     display message box 
                         "Single Posting  Basariyla Tamamlandi.."
                         title "[ Uyari ]"
                         icon 1
                 when other
                 display message box 
                         "Posting islemi Basariyla Tamamlandi.."
                         title "[ Uyari ]"
                         icon 1
                 end-evaluate
                 move 27 to key-status 
              end-if
     end-evaluate.

 islem-yap.
*              if genel-oto-peryot = "E"
*                 call "/asya/ytl/obj/otel/peryot.asy" using "OTO" 
*                    on exception
*                         perform callerr-proc
*                    not on exception
*                         cancel "/asya/ytl/obj/otel/peryot.asy"
*                 end-call
*              end-if.
      continue.
 room-posting.
 posting-basla.  
 posting-kur-oku.  
         open input kur. 
      initialize islem-kuru.
      move calisma-tarihi  to kur-tarih.
      move onkpara-banka   to kur-banka.
      move onkpara-doviz   to kur-doviz.
      if tum-gunler = 1 then 
        move bugun to kur-tarih
      end-if

      read kur no lock invalid 
           display message box calis-gun "/" calis-ay "/" calis-yil x"0a0d"
                   "Tarihli Gunluk Kur Kaydi Bulunamadi..."
                    close kur go islem-yap-exit. 
                              
    initialize islem-kuru.
    move doviz-alis to islem-kuru.
    if onkpara-d-e = "D" and onkpara-a-s = "A" move doviz-alis    to islem-kuru.
    if onkpara-d-e = "D" and onkpara-a-s = "S" move doviz-satis   to islem-kuru.
    if onkpara-d-e = "E" and onkpara-a-s = "A" move efektif-alis  to islem-kuru.
    if onkpara-d-e = "E" and onkpara-a-s = "S" move efektif-satis to islem-kuru.
    if islem-kuru = 0 
       display message box calis-gun "/" calis-ay "/" calis-yil x"0a0d"
               "Tarihli Gunluk Kur Kaydi Bulunamadi..."
                close kur go islem-yap-exit
     end-if. 
 posting-kur-oku-bitti.  
         close kur. 
 dosya-ac.
    open input kodlar02 depkod extpost cast kur.
    open i-o   konuk romhrk exthrk onkasa KONU2.
      if rposting-e-h = 1 
         continue
      else 
         go posting-bitti 
      end-if.

 konuk-basla.
     
    initialize konuk-rec.
    move "I"  to konuk-durumu.  
    start konuk key not < konuk-oda invalid 
          go posting-bitti. 
 konuk-oku.
    read konuk next no lock end go posting-bitti.
    if fs-konuk = 99 go konuk-oku.
    if konuk-durumu not = "I" go posting-bitti.
    if konuk-fol-kodu not = "R" go konuk-oku.
    if onkasa-sifir-geceleme-liste = 1
       if calisma-tarihi > konuk-git-tar
          go konuk-oku
       end-if
    else
       if calisma-tarihi not < konuk-git-tar  and   konuk-gel-tar < konuk-git-tar
          go konuk-oku
       end-if
    end-if.

    if konuk-gel-tar > calisma-tarihi     
        go konuk-oku.
    if single-posting
       if konuk-odano <> single-post-oda
          go konuk-oku
       end-if
       
    end-if
    if link-var > 0
            if  link-folio not =  konuk-folio
            go konuk-oku
            end-if
        end-if
     move 0 to konuk-mini-ok




     move konuk-rez-no to cast-rez-no 
     move calisma-tarihi   to cast-tarih
     read cast no lock invalid
          continue
     end-read
     if konuk-dv-degeri not = cast-fiyati and   konuk-gel-tar < konuk-git-tar then

          move konuk-dv-degeri to z-eski
          move cast-fiyati to z-yeni
      if tum-gunler not = 1   
      display message box "LUTFEN NOT EDINIZ " new-line new-line
                   konuk-odano " nolu  odanin fiyati otomatik olarak degisti" new-line
                         "Eski-fiyat : " z-eski       new-line
                         "Yeni-Fiyat : " z-yeni new-line
      end-if 
      if  konuk-gel-tar < konuk-git-tar then           
         move cast-fiyati to  konuk-dv-degeri
      end-if
      compute KONUK-ODA-TUTAR rounded = KONUK-DV-DEGERI * KONUK-KUR-DEGERI
      rewrite konuk-rec invalid continue end-rewrite
     end-if
     
    modify Form1-St-1-Handle,
           panel-index = 2
           panel-text = konuk-odano.
       move 0 to     post-basma
       initialize yromhrk-rec
     
    move calisma-tarihi to yromhrk-tarih
    move konuk-folio    to yromhrk-folio
    open input yromhrk
    start yromhrk key = yromhrk-anah1
       invalid continue
       not invalid
       perform until fs-yromhrk = "10"
         read yromhrk next end
            move "10" to fs-yromhrk
            not end
             if calisma-tarihi  = yromhrk-tarih
                   and  konuk-folio = yromhrk-folio then 
              if yromhrk-islem-tipi = "O" or "L" then
                 move 1 to post-basma
                 exit perform 
              end-if
              else
                move "10" to fs-yromhrk
             end-if
         end-read
      end-perform
      end-start
    close yromhrk
     if post-basma = 1 then go konuk-oku.

    move "B" to kodlar02-tipi.
    move konuk-odeme-tipi to kodlar02-kodu. 
    read kodlar02 no lock invalid 
         move spaces to kodlar02-adi
    end-read.
    if konuk-fol-kodu = "R"
       perform odalar-isle   thru odalar-isle-exit.
       if ode-posting = "H" go konuk-oku.   

    move "A"             to kodlar02-tipi.
    move konuk-pan-tipi  to kodlar02-kodu.
    read kodlar02 no lock 
           invalid go konuk-oku
    end-read.
 oda-bas.       
        initialize tl-tutar dv-tutar.
        if konuk-oda-tutar not = 0 
           continue
        else 
         
           go oda-bas-exit
        end-if.
        if pan-oda = "X" 
           continue
        else 
           go oda-bas-exit
        end-if.
           move oda-dep   to depkod-kodu dep-dep.
           read depkod no lock invalid 
                move 001 to dep-dep
           end-read. 
           move konuk-oda-tutar     to tl-tutar.
           compute dv-tutar  = tl-tutar / islem-kuru.
           perform onkasa-artir thru onkasa-artir-exit.         
           perform romhrk-isle  thru romhrk-isle-exit.

 oda-bas-exit.       
    exit. 
 kahvalti-bas. 
        initialize tl-tutar dv-tutar.
        if konuk-kahvalti-tutar not = 0 
           continue
        else 
           go kahvalti-bas-exit
        end-if.
        if pan-kahvalti = "X" 
           continue
        else 
           go kahvalti-bas-exit
        end-if.
           move kahvalti-dep   to depkod-kodu dep-dep.
           read depkod no lock invalid 
                move 002 to dep-dep
           end-read. 
           move konuk-kahvalti-tutar       to tl-tutar.
           compute dv-tutar  =   tl-tutar / islem-kuru.
           perform onkasa-artir thru onkasa-artir-exit.
           
           perform romhrk-isle  thru romhrk-isle-exit.
 kahvalti-bas-exit. 
    exit. 
 ogle-bas. 
        initialize tl-tutar dv-tutar.
        if konuk-ogle-tutar not = 0 
           continue
        else 
           go ogle-bas-exit
        end-if.
        if pan-ogle     = "X" 
           continue
        else 
           go ogle-bas-exit
        end-if.
           move ogle-dep   to depkod-kodu dep-dep.
           read depkod no lock invalid 
                move 003 to dep-dep
           end-read. 
           move konuk-ogle-tutar     to tl-tutar.
           compute dv-tutar  = tl-tutar / islem-kuru.
           perform onkasa-artir thru onkasa-artir-exit.
           
           perform romhrk-isle  thru romhrk-isle-exit.
 ogle-bas-exit. 
    exit. 
 aksam-bas. 
        initialize tl-tutar dv-tutar.
        if konuk-aksam-tutar not = 0 
           continue
        else 
           go aksam-bas-exit
        end-if.
        if pan-aksam    = "X" 
           continue
        else 
           go aksam-bas-exit
        end-if.
           move aksam-dep   to depkod-kodu dep-dep.
           read depkod no lock invalid 
                move 004 to dep-dep
           end-read. 
           move konuk-aksam-tutar     to tl-tutar.
           compute dv-tutar  = tl-tutar / islem-kuru.
           perform onkasa-artir thru onkasa-artir-exit.
          
           perform romhrk-isle  thru romhrk-isle-exit.
 aksam-bas-exit. 
    exit. 
 icecek-bas. 
        initialize tl-tutar dv-tutar.
        if konuk-icecek-tutar not = 0 
           continue
        else 
           go icecek-bas-exit
        end-if.
        if pan-icecek   = "X" 
           continue

        else 
           go icecek-bas-exit
        end-if.
           move icecek-dep   to depkod-kodu dep-dep.
           read depkod no lock invalid 
                move 005 to dep-dep
           end-read. 
           move konuk-icecek-tutar     to tl-tutar.
           compute dv-tutar  = tl-tutar / islem-kuru.
           perform onkasa-artir thru onkasa-artir-exit.
           
           perform romhrk-isle  thru romhrk-isle-exit.
 icecek-bas-exit. 
    exit. 
 extra-bas. 
        initialize tl-tutar dv-tutar.
        if konuk-extra-tutar not = 0 
           continue
        else 
           go extra-bas-exit
        end-if.
        if pan-extra    = "X" 
           continue
        else 
           go extra-bas-exit
        end-if.
           move extra-dep   to depkod-kodu dep-dep.
           read depkod no lock invalid 
                move 006 to dep-dep
           end-read. 
           move konuk-extra-tutar     to tl-tutar.
           compute dv-tutar  = tl-tutar / islem-kuru.
           perform onkasa-artir thru onkasa-artir-exit.
           
           perform romhrk-isle  thru romhrk-isle-exit.
 extra-bas-exit. 
    exit. 
 post-geri.
           go konuk-oku.  
 romhrk-isle.
       
           initialize romhrk-rec.
       open i-o genelfis.
       move 1 to genelfis-anahtar.
       read genelfis no lock invalid 
            initialize genelfis-rec 
            move 1 to genelfis-anahtar
       end-read.
       add 1 to cekgir-oto.
       move cekgir-oto to romhrk-islem.
       rewrite genelfis-rec invalid 
               write genelfis-rec 
               end-write continue
       end-rewrite.
       close genelfis.

       accept zaman from time.
       move konuk-folio    to romhrk-folio. 
       if single-posting 
          move "L"            to romhrk-islem-tipi
       else
          move "O"            to romhrk-islem-tipi
       end-if.
       move calisma-tarihi to romhrk-tarih.     
       move dep-dep        to romhrk-depkod.
       move depkod-ba      to romhrk-ba.
       move tl-tutar       to romhrk-tl-tutar.
       move dv-tutar       to romhrk-dv-tutar.
       move zaman          to romhrk-zaman.
       move k-kodu-tasi    to romhrk-staf. 
 

********************kopyalanacak
          open input route rez
          
          open i-o yromhrk
          move romhrk-rec  to yromhrk-rec  hrkgir-rec
        
         
          perform folref-bul
          perform folref-ata
          close route   rez
          open i-o hrk2
          move hrkgir-anah to hrk2-anah
          move yromhrk-folio to hrk2-kaynak-folio
          compute hrk2-ger-DV-TUTAR rounded = romhrk-tl-tutar / KONUK-KUR-DEGERI
           move konuk-banka to  hrk2-ger-banka    
           move konuk-doviz to  hrk2-ger-doviz
           move 1 to  hrk2-cin-kuru    
          write hrk2-rec invalid stop " " end-write
            move hrk2-data to yromhrk-data
         write yromhrk-rec invalid stop " " end-write 
         close yromhrk
          close hrk2
          
          
          move hrkgir-folio   to konu2-folio
          read konu2 no lock invalid 
               close konu2
               exit paragraph 
          end-read 
         
          if konu2-fol-kodu = "R"
               move hrkgir-rec       to romhrk-rec
               write romhrk-rec end-write
               perform log-operation-romhrk
          else
               move hrkgir-rec       to exthrk-rec
               write exthrk-rec end-write
               perform log-operation-exthrk
          end-if.
**************** kopyalanacak
      perform konuk-artir  thru konuk-artir-exit.
 romhrk-isle-exit.
       exit. 
 odalar-isle.
             open i-o odalar
             move konuk-odano  to odalar-no. 
             read odalar no lock invalid 
                  close odalar go odalar-isle-exit
             end-read. 
             if odalar-durumu = house-ao or house-durumu = house-ao
               move house-ao      to odalar-durumu house-durumu
             else
               move house-dk  to odalar-durumu house-durumu
             end-if. 
             if genel-hk-kisi-sifirla = 1
                initialize house-buyuk house-kucuk house-free house-bebek
             end-if 
             rewrite odalar-rec invalid continue
             end-rewrite. 
*             perform log-operation-odalar.
             close odalar.
 odalar-isle-exit. 
       exit. 
 posting-bitti.
      if eposting-e-h = 1 
         continue
      else 
         go eposting-bitti 
      end-if.
 room-posting-exit.
       exit.
***************>Extra Posting Bolumu
 extra-posting-exit.
 eposting-basla.    
       initialize extpost-rec.
       move "I"   to extpost-durumu.
      start extpost key not < extpost-durumu 
            invalid go eposting-bitti.
 extra-oku.
    read extpost next no lock end go eposting-bitti.
    if fs-extpost = 99 go extra-oku.
    if extpost-durumu not = "I" go eposting-bitti.
    if extpost-p-k        = "K" 
       continue
    else 
       go extra-oku
    end-if.
       move extpost-folio  to konuk-folio.
    if calisma-tarihi < extpost-ilk-tar 
       go extra-oku.
    if calisma-tarihi > extpost-son-tar 
       go extra-oku.
    read konuk no lock invalid 
         go extra-oku.
    if single-posting
       if konuk-odano <> single-post-oda
          go extra-oku
       end-if
    end-if
    if konuk-durumu not = "I" 
       go extra-oku.

*       display konuk-odano line 02 col 25 color palet-07.
 fiyat-bas.
    initialize tl-tutar dv-tutar.
    move extpost-dep   to depkod-kodu dep-dep.
    read depkod no lock invalid go extra-oku.
    move 0 to cift-bas
    if genel-extrapos-coutbos of genel-rec = 1
       move calisma-tarihi to s1
       move konuk-git-tar to s2
       move konuk-gel-tar to s3

       compute s4 = function integer-of-date(s2) - function integer-of-date(s3)

       if function integer-of-date(s2) - function integer-of-date(s1) = 1  and (s4 > 1 )
          go extra-oku

       end-if
       if function integer-of-date(s2) - function integer-of-date(s1) = 2  and 
            extpost-son-tar > calisma-tarihi
             move 1 to cift-bas

       end-if
     end-if    
    if eposting-t-d = 1 
       move extpost-tl-tutar     to tl-tutar
       if 1 = cift-bas
          add extpost-tl-tutar   to tl-tutar
       end-if                           
       compute dv-tutar  = tl-tutar / islem-kuru.
    if eposting-t-d = 2 
       move extpost-dv-tutar   to dv-tutar
       if 1 = cift-bas
          add extpost-dv-tutar   to dv-tutar
       end-if
       if konuk-banka not = onkpara-banka 
        initialize islem-kuru-fol
      move calisma-tarihi  to kur-tarih
      move konuk-banka   to kur-banka
      move onkpara-doviz   to kur-doviz
      

      read kur no lock invalid 
           move islem-kuru to islem-kuru-fol
       
         not invalid                     
    
    move doviz-alis to islem-kuru-fol
    if onkpara-d-e = "D" and onkpara-a-s = "A" move doviz-alis    to islem-kuru-fol  end-if
    if onkpara-d-e = "D" and onkpara-a-s = "S" move doviz-satis   to islem-kuru-fol  end-if
    if onkpara-d-e = "E" and onkpara-a-s = "A" move efektif-alis  to islem-kuru-fol  end-if
    if onkpara-d-e = "E" and onkpara-a-s = "S" move efektif-satis to islem-kuru-fol  end-if

    end-read
        compute tl-tutar  rounded = dv-tutar * islem-kuru-fol
    else
       compute tl-tutar  rounded = dv-tutar * islem-kuru
    end-if
    perform onkasa-artir thru  onkasa-artir-exit.
    move konuk-folio     to hrkgir-folio
    perform konuk-artir  thru  konuk-artir-exit.
    perform hrk-isle     thru  hrk-isle-exit.

 fiyat-bas-exit.
    exit.
 epost-geri.
           go extra-oku.
 hrk-isle.
       initialize hrkgir-rec.
       open i-o genelfis.
       move 1 to genelfis-anahtar.
       read genelfis no lock invalid
            initialize genelfis-rec 
            move 1 to genelfis-anahtar
       end-read.

       add 1 to cekgir-oto.
       move cekgir-oto to hrkgir-islem.
       rewrite genelfis-rec invalid 
               write genelfis-rec 
               end-write continue
       end-rewrite.
       close genelfis.

       accept zaman from time.
       move konuk-folio       to hrkgir-folio.
       if single-posting
          move "L"            to hrkgir-islem-tipi
       else
          move "O"            to hrkgir-islem-tipi
       end-if.
       move calisma-tarihi to hrkgir-tarih.
       move dep-dep        to hrkgir-depkod.
       move depkod-ba      to hrkgir-ba.
       move tl-tutar       to hrkgir-tl-tutar.
       move dv-tutar       to hrkgir-dv-tutar.
       move zaman          to hrkgir-zaman.
       move extpost-belge  to hrkgir-CEKNO
       move k-kodu-tasi    to hrkgir-staf.

          open input route rez
          
          open i-o yromhrk
          move hrkgir-rec  to yromhrk-rec   
                 
          perform folref-bul
          perform folref-ata
          close route rez
          open i-o hrk2
          move hrkgir-anah   to hrk2-anah
          move yromhrk-folio to hrk2-kaynak-folio
          compute hrk2-ger-DV-TUTAR rounded = hrkgir-tl-tutar / KONUK-KUR-DEGERI
           move konuk-banka to  hrk2-ger-banka    
           move konuk-doviz to  hrk2-ger-doviz
*           move 1 to  hrk2-cin-kuru    
          write hrk2-rec invalid stop " " end-write
            move hrk2-data to yromhrk-data
         write yromhrk-rec invalid stop " " end-write 
         close yromhrk
          close hrk2
          
          
          move hrkgir-folio   to konu2-folio
          read konu2 no lock invalid 
               close konu2
               exit paragraph 
          end-read 
         
          if konu2-fol-kodu = "R"
               move hrkgir-rec       to romhrk-rec
               write romhrk-rec end-write
               perform log-operation-romhrk
          else
               move hrkgir-rec       to exthrk-rec
               write exthrk-rec end-write
               perform log-operation-exthrk
          end-if.
*       if konuk-fol-kodu = "R" perform rom-isle thru rom-isle-exit
*                         else  perform ext-isle thru ext-isle-exit
*       end-if.
 hrk-isle-exit.
       exit.

* rom-isle.
*        initialize romhrk-rec.
*        move hrkgir-rec  to romhrk-rec.
*        write romhrk-rec end-write
*        perform log-operation-romhrk.
* rom-isle-exit.
*      exit.
* ext-isle.
*        initialize exthrk-rec.
*        move hrkgir-rec  to exthrk-rec.
*        write exthrk-rec end-write
*        perform log-operation-exthrk.
* ext-isle-exit.
*      exit.
 eposting-bitti.
***************>Extra Posting Bolumu
 extra-posting-exit.
       exit.
 dosya-kapat.
    close      kur kodlar02 depkod extpost cast.
    close      konuk romhrk exthrk onkasa konu2.
 islem-yap-exit.
       exit.

 onkasa-artir. 
       move calisma-tarihi  to onkasa-tarih.
       move dep-dep         to onkasa-dep.
       read onkasa no lock invalid 
            go onkasa-yeni-isle.
       compute onkasa-tutar-tl   = onkasa-tutar-tl + tl-tutar. 
       compute onkasa-tutar-dv   = onkasa-tutar-dv + dv-tutar.
       rewrite onkasa-rec invalid 
               write onkasa-rec 
               end-write continue 
       end-rewrite. 
       go onkasa-artir-exit.
 onkasa-yeni-isle. 
            initialize onkasa-rec.
       move calisma-tarihi  to onkasa-tarih.
       move dep-dep         to onkasa-dep.
       move tl-tutar        to onkasa-tutar-tl.
       move dv-tutar        to onkasa-tutar-dv.
       write onkasa-rec invalid 
             rewrite onkasa-rec 
             end-rewrite continue 
       end-write.
 onkasa-artir-exit. 
       exit.
 konuk-artir.
          move hrkgir-folio to konu2-folio
           read konu2 no lock invalid
               display message box "Hata   No: AR78955552 FNF"
           end-read
           if depkod-ba = "B" 
              compute konu2-top-borc = konu2-top-borc + tl-tutar.
           if depkod-ba = "A" 
              compute konu2-top-alac = konu2-top-alac + tl-tutar.
          rewrite konu2-rec invalid continue. 
 konuk-artir-exit. 
      exit.
*
 cincout-kontrol.
      call "/asya/ytl/obj/otel/gunkont.asy"
        using status-cout, status-cin
        on exception
           perform callerr-proc
        not on exception
           cancel "/asya/ytl/obj/otel/gunkont.asy" 
      end-call
      .    
*
 Form1-Cb-1-Ex-Cmd-Clicked.
      display form1-ef-1, form1-ef-2 form1-la-1.
     
     .
 loga-yaz.
********** PROGRAMA GIRIS LOGA GONDERILIYOR
               initialize call-alan1
                          call-alan2
                          call-alan3
                          call-alan4
                          call-alan5
                          call-alan6
               perform log-no-al
               move genelfis-log-no   to call-anah
               move "Tarih: "       to call-alan1
               move gun-tasi          to call-alan1(10:)
               move "/"               to call-alan1(12:)
               move ay-tasi           to call-alan1(13:)
               move "/"               to call-alan1(15:)
               move yil-tasi          to call-alan1(16:)
               move "Room Posting Yapildi... "    to call-alan2

               if single-posting
                  move single-post-oda to call-alan2
                  move "Nolu Odaya Posting Yapildi"
                  to call-alan2(06:)
               end-if 

               perform log-operation-calling.
*
 folref-bul.
       initialize aroute-anah routtur routyazma routbulundu
        if konuk-grup-no > 0 then 
          move konuk-grup-no to aroute-rezno
          move konuk-grup-no to aroute-folio
            move hrkgir-depkod   to route-depkod
          else
          move high-values to  aroute-anah
       end-if
         move aroute-anah to route-anah
             move hrkgir-depkod   to route-depkod
         read route no lock invalid
           
                initialize route-rec aroute-anah
               if konuk-fol-kodu = "R" then 
                  move konuk-rez-no to aroute-rezno
                 else
                  if konuk-extra-rez-no  > 0 
                      move 1 to extradan-geldi
                      move konuk-extra-rez-no to aroute-rezno
                   else
                      move konuk-folio to aroute-folio
                  end-if
               end-if

       end-read
     
       perform until routbulundu = 1 or routtur > 10 
       add 1 to routtur
       initialize route-rec
        move aroute-anah to route-anah
       move hrkgir-depkod   to route-depkod
       read route no lock invalid
           
           perform rout-folio-kontrol
           perform def-pen-bul
            move 1 to routbulundu
         not invalid
         if route-tip = "P"

            perform rout-folio-kontrol
            move 1 to routbulundu
          else
            if route-tip = "F"
               if route-no <> route-folio
                        initialize aroute-anah
                        move route-no to  aroute-folio
                   else
                     perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

                end-if
              else
                if route-no <> route-rezno
                      initialize aroute-anah
                      move route-no  to aroute-rezno
                         else
                       perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu
               end-if
            end-if

        end-if
        end-read
       end-perform 
        
        .
 rout-folio-kontrol.
     initialize konu2-rec
     if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read

         if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move rez-folio to konu2-folio
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move rez-folio to konu2-folio
                  end-if
               else
                move rez-folio to konu2-folio
           end-if


    end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
          if KONU2-ACIK-KAPALI    = "C" 
            move 2 to routyazma
          end-if
          if KONU2-DURUMU not = "I" then
              move 3 to routyazma
          end-if
       end-read
          .
 def-pen-bul.
       initialize konu2-rec
      if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        initialize rez-rec
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read
         if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move rez-folio to konu2-folio
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move rez-folio to konu2-folio
                  end-if
               else
                move rez-folio to konu2-folio
           end-if


     end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
             move "B"               to kodlar02-tipi
               move konu2-odeme-tipi  to kodlar02-kodu 
              read kodlar02 no lock invalid
                    move 1 to route-no
             
                  not invalid
                     if ode-tipi  = "B"  | KREDI ISE
                          if depkod-tipi = 2 then 
                                 move 1 to route-no
                             else
                                move 2 to route-no
                          end-if
                      else
                         move 1 to route-no
                 end-if
             end-read
       end-read


          .



*
 folref-ata.
     
     if routyazma = 0 and routbulundu = 1 
      move konu2-folio to hrkgir-folio
      move route-no to hrkgir-ref
    else 
       move konuk-folio to konu2-folio
       read konu2 no lock invalid
          stop " " 
       end-read 
    end-if
       .


      

        

 
      

*
 Form1-Cb-1-Aft-Procedure.
     display form1-ef-2
     
     .
*
 city-control.
      open input romhrk konuk
      move ONKPARA-CITY-LEDGER to romhrk-depkod
      move calisma-tarihi to romhrk-tarih
      start romhrk key >= romhrk-anah2
          invalid continue
          not invalid
            perform until fs-romhrk = "10"
              read romhrk next no lock end move "10" to fs-romhrk
                  not end
                    if romhrk-tarih not = calisma-tarihi or 
                     ONKPARA-CITY-LEDGER not = romhrk-depkod
                       move "10" to fs-romhrk
                    else
                       if romhrk-ref <> 1
                          exit perform cycle 
                       end-if 
                       move romhrk-folio to konuk-folio
                       read konuk no lock invalid 
                          display message box konuk-odano "nolu odada " konuk-folio " nolu folioda hareket var folio yok "
                          move 1 to city-hata
                           move "10" to fs-romhrk
                       end-read
                       if  konuk-gel-tar = calisma-tarihi 
                          exit perform cycle
                       end-if
                       if konuk-git-tar > calisma-tarihi
                          display message box konuk-odano "nolu oda " konuk-folio " nolu folioda cikis oncesi cityledger var " new-line
                                                    "Cityledger i silin veya odayi cout edin "
                                                      move 1 to city-hata
                                                       move "10" to fs-romhrk
                       end-if
                       if konuk-git-tar = calisma-tarihi and konuk-durumu = "I" 
                               display message box konuk-odano "nolu oda " konuk-folio " nolu folio cout edilmeli " new-line
                                                    "Cityledger i silin veya odayi cout edin " 
                                                      move 1 to city-hata
                                                       move "10" to fs-romhrk
                      end-if
                    end-if
             end-read
          end-perform 
      end-start
      close romhrk konuk
        .
* 
 rez-to-cast-bakim.

    move "cast" to cast2-dosya-adi
    open i-o cast cast2
    open input rez                                      
         initialize cast-rec cast-duzeltme-adet 
         move tarih-tasi   to cast-tarih
         start cast key not < cast-anah invalid 
            continue 
         not invalid 
         perform with test after until fs-cast = "10"
         read cast next no lock end move "10"  to fs-cast
         not at end 
                 if cast-tarih <> tarih-tasi
                       exit perform
                 end-if
                 initialize rez-rec
                 move cast-rez-no to rez-no
                 read rez no lock invalid
                         exit perform cycle
                 not invalid
                      if rez-cik-tar = cast-tarih or REZ-K-G-B <> "K" or rez-durumu <> 'I'
                            exit perform cycle
                      end-if
              
                      if rez-odano <> spaces and cast-oda-no = spaces
                                 initialize cast2-rec   
                                 move cast-rez-no   to cast2-REZ-NO
                                 start cast2 key not < cast2-anah1 invalid 
                                            continue 
                                 not invalid 
                                 perform with test after until fs-cast2 = "10"
                                 read cast2 next no lock end move "10"  to fs-cast2
                                 not at end 
                                         if cast2-REZ-NO <> cast-rez-no
                                               exit perform
                                         end-if
                                         if rez-cik-tar = cast2-tarih or cast2-oda-no <> spaces
                                               exit perform cycle
                                         end-if
                                         move rez-odano to cast2-oda-no
                                         rewrite cast2-rec invalid
                                                 stop " "
                                         end-rewrite
                                         add 1 to cast-duzeltme-adet
                                 end-read 
                                 end-perform
                                 end-start 
                      end-if
                 end-read
         end-read 
         end-perform
         end-start
         |display message box cast-duzeltme-adet
    close cast rez cast2.
*
 inhouse-kontrol.
    open input konuk 
    initialize konuk-rec inhouse-bulundu
    move "I"     to konuk-durumu 
    start konuk key not < konuk-oda invalid
          continue
    not invalid
    perform with test after until fs-konuk = "10"
    read konuk next no lock end move "10" to fs-konuk 
    not at end 
        if konuk-durumu <> "I" 
           exit perform
        end-if

        move 1 to inhouse-bulundu  

    end-read 
    end-perform 
    end-start 
    close konuk 
    .

 
