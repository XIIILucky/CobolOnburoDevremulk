* acfkont1.evt
* acfkont1.evt is generated from F:\asya\acugt.kaya\otel\acfkont1.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     EVALUATE Event-Control-Id
     WHEN 1
        PERFORM Form2-Gd-1-Ev-Other
     END-EVALUATE
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 Form2-Gd-1-Exception-Proc.
     PERFORM Form2-Gd-1-Ex-Other
     .

 screen1-Event-Proc.
     .

 screen1-Exception-Proc.
     PERFORM screen1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform adresleri-tasi.
     open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
    move genel-printer-filtre to text-oku-filtre.
    perform acuserve-adres-aktar.
    move tarih-tasi  to ilk-tarih son-tarih.             
    perform max-bul.
*
 acc-ilk-yil-Aft-Procedure.
     initialize gec-gecme.
     open input takvim.
     move ilk-tarih   to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
*
 acc-son-yil-Aft-Procedure.
     initialize gec-gecme.
     open input takvim.
     move son-tarih   to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
     
     .
*
 acc-acenta-Aft-Procedure.
     initialize gec-gecme.
     if rapor-acenta = spaces
        move "Tum acentalar ..." to acenta-adi
        display lb-acenta-adi
        exit paragraph
     end-if
     open input acenta.
     move rapor-acenta to acenta-kodu
     read acenta no lock invalid
          move "Tanimsiz ..." to acenta-adi
          move 1 to gec-gecme
     end-read
     close acenta.
     display lb-acenta-adi.
*
 Form1-Ex-Other.
     if  key-status = 1   and  control-id = 12 then
           perform acenta-ara  
     end-if      
    
     if key-status = 2001 or key-status = 2002
        continue
     else
        exit paragraph
     end-if.
     perform acc-ilk-yil-Aft-Procedure.
     if gec-gecme = 1
        move 4 to accept-control
        move 6 to control-id
        exit paragraph
     end-if.
     
     perform acc-son-yil-Aft-Procedure.
     if gec-gecme = 1
        move 4 to accept-control
        move 9 to control-id
        exit paragraph
     end-if.

     perform acc-acenta-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 12 to control-id
        exit paragraph
     end-if.

     if key-status = 2001 
        perform raporla
     else
            move ilk-tarih to fat-tarih 
                    call "/asya/ytl/obj/otel/fatolus.asy" 
                    using  fat-tarih
                         on exception 
                     perform callerr-proc
                     exit paragraph
                    not on exception 
                     cancel "/asya/ytl/obj/otel/fatolus.asy"
                  end-call
                  
            perform acu-form2-routine
       end-if    .

 raporla.
     if key-status = 2001
        open input acenfat
     end-if.
     
     open input konuk konu2 acenta musteri firma doviz cari.
     initialize acenfat-rec  oda-top
     move ilk-tarih   to acenfat-tarih
     start acenfat key not < acenfat-anah invalid 
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close  konuk konu2 acenta firma musteri acenfat  doviz cari
                    exit paragraph
     end-start.

     if key-status = 2001
        open i-o genelfis
        move 1 to genelfis-anahtar
        read genelfis no lock invalid
             accept print-no from time
        not invalid
             add 1 to print-no
             rewrite genelfis-rec end-rewrite
        end-read
        close genelfis

**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Acenta Fatura Kontrol Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     move "Acenta Fatura Kontrol Raporu"   to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay
     initialize dokumer-rec detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     move "Acenta.:"           to det-filler(01:10)
     move acenta-adi           to det-filler(11:)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLRRLLRRLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  
     initialize dokumer-rec detay 
     move "D1"         to det-dokumer-20(1:2)
     move "1"          to det-dokumer-20(10:1)
     move "Tarih"          to det-1
     move "Acenta"         to det-2
     move "Acenta adi"     to det-3
     move "Gece"           to det-31
     move "Folio"          to det-4
     move "Adi"            to det-5
     move "Soyadi"         to det-6
     move "Tl tutar"       to det-7
     move "Doviz tutar"    to det-8
     move "Fatura"         to det-9
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-31
     write dokumer-rec from detay
     move high-values to son-profil

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                 det-7 det-8 det-9  det-31
     write dokumer-rec from detay
     end-if.
     initialize fat-sira son-profil  
     initialize fat-sat
     initialize fs-acenfat toplamlar
     perform with test after until fs-acenfat = "10"
         read acenfat next no lock end move "10" to fs-acenfat
         not at end
             if acenfat-tarih > son-tarih
                move "10" to fs-acenfat
                exit perform
             end-if
     
             if rapor-acenta = spaces or 
                rapor-acenta = acenfat-acenta 
                      continue
             else 
                exit perform cycle
             end-if
            
             if key-status = 2001
                initialize detay
                move acenfat-gun         to egun
                move acenfat-ay          to eay
                move acenfat-yil         to eyil
                move etarih              to det-1
                move acenfat-acenta      to acenta-kodu det-2
                read acenta no lock invalid
                     move "Tanimsiz acenta"  to acenta-adi
                end-read
                 move acenta-faturada-voucher to max-voucher
                if max-voucher < 1 or   max-voucher > 50
                      move 20 to max-voucher
                end-if
                move acenta-kodu         to det-3(1:4)
                move "-"                 to det-3(5:1)
                move acenta-adi          to det-3(6:)
                move acenfat-per-geceleme    to 3-hane
                move 3-hane              to det-31
                move acenfat-folio       to det-4 konuk-folio
                read konuk no lock invalid
                     initialize konuk-rec
                end-read
                  
                move konuk-adi           to det-5
                move konuk-soyadi        to det-6
                move acenfat-tl-tutar    to etutar
                move etutar              to det-7 
                move acenfat-ger-dv-tutar    to etutar-dv
                move etutar-dv           to det-8
                add 1 to oda-top
                add acenfat-tl-tutar     to tl-top
                add acenfat-ger-dv-tutar     to dv-top
                if acenfat-e-h = "H"
                   move "Hayir"          to det-9
                else
                   move "Evet"           to det-9
                end-if
                write dokumer-rec from detay
             else
             
                initialize form2-gd-1-record
                move acenfat-gun         to egun
                move acenfat-ay          to eay
                move acenfat-yil         to eyil
                 move acenfat-acenta      to acenta-kodu 
*                move etarih              to gd-1-col-1
                read acenta no lock invalid
                     move "Tanimsiz acenta"  to acenta-adi
                end-read
                if son-profil = high-values
                        move  ACENFAT-PROFIL   to  son-profil 
                        move  acenfat-eb       to  son-eb
                        move  acenfat-geceleme to  son-geceleme 
                        move  acenfat-op       to  son-op 
                        move acenfat-pan       to son-pan
                        move acenfat-grup      to son-grup
                end-if
                move acenta-faturada-voucher to max-voucher
                if max-voucher < 1 or   max-voucher > 50
                      move 20 to max-voucher
                end-if
                 if konuk-voucher not = son-voucher 
                    add 1 to adet-voucher
                    move konuk-voucher to son-voucher
                 end-if
                 if acenfat-fat-no = 0 then
                  if acenfat-peryod = 0 and (
                          son-profil not = ACENFAT-PROFIL   or 
                       ( EB-AYir = 1 and son-eb not = acenfat-eb) or
                       ( gir-ayir = 1  and acenfat-geceleme not = son-geceleme ) or
                       ( fat-sat > max-satir - 2 ) or 
                       ( max-voucher < adet-voucher ) or 
                         son-pan not = ACENFAT-pan   or
                        son-grup not = acenfat-grup or
                       ( op-ayir = 1 and acenfat-op not =  son-op )
                       )   then
                     
                         move  ACENFAT-PROFIL   to  son-profil 
                         move  acenfat-eb       to  son-eb
                         move  acenfat-geceleme to  son-geceleme 
                         move  acenfat-op       to  son-op 
                         move 1                 to adet-voucher
                         move acenfat-op         to son-op
                         move acenfat-eb        to son-eb
                         move acenfat-pan       to son-pan
                         move acenfat-grup      to son-grup
                         move  acenfat-geceleme to son-geceleme 
                         add 1                  to fat-sira
                             
                         move ACENFAT-PROFIL to son-profil
                         initialize fat-sat 
                    end-if
                    
                    add 1 to fat-sat 
                    move fat-sira to z-4
                    move z-4 to gd-1-col-0
                 end-if
                       
                move acenfat-per-geceleme    to 3-hane
                move 3-hane              to gd-1-col-9
                move acenfat-kfolio to konu2-folio
                read konu2 no lock invalid
                          initialize konu2-rec
                end-read
                move acenfat-folio       to  konuk-folio
*                if acenfat-folio = 34630 
*                 | and k-kodu-tasi = "X   " 
*                  then stop " " end-if
                read konuk no lock invalid
                     initialize konuk-rec
                end-read
                string konu2-adi delimited by "  " 
                      " " delimited by size
                       konu2-soyadi  delimited by "  "
                         into gd-1-col-3
                if konuk-eb = "E" then
                   move " E/B"        to gd-1-col-3(12:)
               end-if 
                   
                 initialize musteri-rec
                move ACENFAT-PROFIL  to m-profil
                move konu2-odano     to  gd-1-col-2
                if musteri-no not numeric
                      move "999999992" to musteri-no
                end-if
                   read musteri no lock invalid
                        move konu2-acenta to acenta-kodu
                       read acenta no lock invalid
                          continue
                       not invalid
                            if ACENTA-MUHNO2 = spaces
                                move acenta-muhno to cari-kodu  musteri-muhasebe-kodu
                            else
                              move acenta-muhno2 to cari-kodu  musteri-muhasebe-kodu
                            end-if
                         read cari no lock invalid
                          initialize cari-rec
                         end-read,
                            perform varying ix from 1 by 1 until ix > 18
                               if c-vergi-no(ix:1) = spaces then 
                                   move  c-vergi-no(ix + 1 :) to c-vergi-no(ix :) 
                                   move  " "                  to c-vergi-no(20:1)
                               end-if
                          end-perform 
                             move c-unvan-1          to  musteri-unvan1(1:40)       
                             move  c-unvan-2         to  musteri-unvan2(1:40)       
                             move  c-adres-1         to  musteri-adres1 (1:40)      
                             move  c-adres-2         to  musteri-adres2 (1:40)      
                             move  c-il-ilce         to  musteri-ilce(1:20)         
                             move  c-ulke(1:14)      to  musteri-il(1:14)           
                             move  c-vergi-daire     to musteri-vdairesi (1:20)    
                             move  c-vergi-no          to musteri-vno
                       end-read
                  not invalid
                           move   musteri-vno    to  c-vergi-no    
                  end-read

                 move  musteri-unvan1        to gd-1-col-6 
                 move  musteri-muhasebe-kodu to gd-1-col-7
                  move acenfat-acenta to acenta-kodu 
                read acenta no lock invalid
                     move "Tanimsiz acenta"  to acenta-adi
                end-read
                move acenta-kodu   to gd-1-col-1(1:4) 
                move "-" to   gd-1-col-1(5:1) 
                move acenta-adi          to gd-1-col-1(6:)
                initialize firma-rec
                move konuk-firma      to firma-kodu 
                read firma no lock invalid
                    continue
                end-read
                move firma-adi          to gd-1-col-4
                 if acenfat-tip = "2" then 
                   move "ROOM" to  gd-1-col-8
                   else
                   move "EXTRA" to  gd-1-col-8
                 end-if
                 move konuk-doviz to doviz-kodu
                 read doviz no lock invalid continue
                 end-read
                 move d-kisa-adi to gd-1-col-11
                
                move acenfat-tl-tutar    to z-8
                move z-8             to gd-1-col-13
                move acenfat-ger-dv-tutar    to z-8
                move z-8         to gd-1-col-10
                move acenfat-ger-tl-tutar  to z-8
                move z-8         to gd-1-col-12
                add 1 to oda-top
                add acenfat-tl-tutar         to tl-top
                add acenfat-ger-dv-tutar     to dv-top
                add acenfat-ger-tl-tutar     to ger-tl-top
                 move acenfat-fat-no   to gd-1-col-14
               
                 
                modify form2-gd-1,
                       record-to-add(form2-gd-1-record)
                       
                modify form2-gd-1(oda-top + 1, 1),
                      
                       hidden-data = acenfat-anah
                       
                if  acenfat-fat-no > 0 then 
                     modify form2-gd-1(oda-top + 1) row-color = 5
                 end-if
             end-if
         end-read
     end-perform.
*/*-*\**/*-*\**/*-*\**/*-*\**/*-*\**/*-*\**/*-*\*
     if key-status = 2001
        initialize dokumer-rec detay
        move "-"            to det-dokumer-20(5:1)
        move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                     det-7 det-8 det-9 det-31
        write dokumer-rec from detay
        initialize dokumer-rec detay
        move "A"          to det-dokumer-20(3:1)
        move 481          to det-renk1
        move "1"          to det-dokumer-20(10:1)
        move "Toplam =>"             to det-1
        move oda-top                 to 3-hane
        move 3-hane                  to det-31

        move dv-top                  to etutar-dv
        move etutar-dv               to det-8  
        move tl-top                  to etutar
        move etutar                  to det-7
        write dokumer-rec from detay 
        initialize dokumer-rec detay
        move "-"            to det-dokumer-20(5:1)
        move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                     det-7 det-8 det-9 det-31
        write dokumer-rec from detay

        close dokumer
        call dokumer-prog on exception
             perform callerr-proc
        not on exception
             cancel dokumer-prog
        end-call
        delete file dokumer
     end-if.
     
     close acenta konuk konu2 musteri acenfat firma doviz cari.

*
 Form2-Aft-Initdata.
     initialize duz-yapildi
     move "FSira"               to gd-1-col-0
     move "Acenta/Rate"         to gd-1-col-1
     move "Oda "                to gd-1-col-2
     move "Mis. Adi"            to gd-1-col-3
     move "Sirket"              to gd-1-col-4
     move "Odem"                to gd-1-col-5
     move "Cari Adi"            to gd-1-col-6
     move "Cari Kodu"           to gd-1-col-7
     move "Tip"                 to gd-1-col-8
     move "Geceleme"            to gd-1-col-9 
     move "Bas Doviz"           to gd-1-col-10
     move "Doviz"               to gd-1-col-11
     move "Bas TL"              to gd-1-col-12

     move "Tutar   "            to gd-1-col-13
     move "Fat No"              to gd-1-col-14

  
     modify form2-gd-1,
            record-to-add(form2-gd-1-record).
     perform raporla
     .
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         

*
*
 Form2-Gd-1-Ev-Other.
     initialize acenfat-rec
              inquire form2-gd-1,
                      y in i
                      x in ii
     evaluate event-type

         when msg-begin-entry
              
           if ii = 1
               modify form2-gd-1(i,1),
                      cell-data = spaces
           end-if
           if ii = 14

             perform fat-duz-gonder

           end-if
           if ii=15 then 
              perform fat-sil-gonder
          end-if
           move event-action-fail to event-action        
            
     end-evaluate.
*
 fat-duz-gonder. 
                 inquire form2-gd-1,
                      cursor-y in i
             open input konuk konu2  depkod       
                    inquire form2-gd-1(i,1),
                                 hidden-data in acenfat-anah
            perform duzeltme-folio-bul.
          
           move acenfat-kfolio to konu2-folio
                read konu2 no lock invalid
                        display message box "HATAAA"
                end-read
                move acenfat-folio       to  konuk-folio
                read konuk no lock invalid
                     display message box "HATAAA"
                end-read
              initialize depkod-rec
              start depkod key > depkod-anah invalid continue
                     not invalid
                     perform until fs-depkod = "10"
                       read depkod next no lock end move "10" to fs-depkod
                           not end
                            if depkod-BA = "B" and d-basdep = 0 then 
                                  move depkod-anah to d-basdep
                            end-if
                            if depkod-BA = "B" and depkod-turu = 2 
                                  move depkod-anah to d-cor2
                            end-if
                            if depkod-BA = "A" and depkod-turu = 2 
                                  move depkod-anah to d-cor1
                            end-if
                       end-read
                     end-perform
               end-start
                  evaluate true
                    when d-cor1 = 0 
                         display message box "CORRECTION (-) Departmani aciniz"
                    when d-cor2 = 0 
                          display message box "CORRECTION (+) Departmani aciniz"
                    when other 
                        perform acu-screen1-routine
                   end-evaluate

                
           close  konuk konu2 depkod  




             .

*
 screen1-Aft-Initdata.                                
          initialize d-tl romhrk-rec d-dv karislem basislem
         move konu3-folio to romhrk-folio exthrk-folio
         move tarih-tasi to romhrk-tarih exthrk-tarih
         open input romhrk hrk2
         start romhrk key >= romhrk-anah1 invalid continue
            not invalid
              perform until fs-romhrk = "10" 
              read romhrk next no lock end move "10" to fs-romhrk
                  not end
                   if romhrk-folio not = konu3-folio or romhrk-tarih not = tarih-tasi
                      move "10" to fs-romhrk
                      exit perform cycle
                  end-if
                  move romhrk-anah to hrk2-anah
                  read hrk2 no lock invalid
                     exit perform cycle
                    not invalid
                    if hrk2-kaynak-folio = konu2-folio
                       if romhrk-ba = "B" 
                         if romhrk-corr-depkod > 0 then 
                              if  d-tl not = 0 and d-tl not =   romhrk-tl-tutar * ( - 1 )
                                   display message box "uyumsuz karsilik "
                              end-if
                           compute d-tl  = romhrk-tl-tutar * ( - 1 )
                           if karislem not = 0 then 
                              display message box " cift karsilik" 
                           end-if
                           move romhrk-corr-depkod to d-kardep
                           move romhrk-islem to karislem
                           else
                             if  d-tl not = 0 and d-tl not =   romhrk-tl-tutar 
                                display message box "uyumsuz karsilik "
                             end-if
                           compute d-tl  = romhrk-tl-tutar 
                           if basislem not = 0 then 
                              display message box " cift basilan" 
                           end-if
                           move romhrk-depkod to d-basdep
                           move romhrk-islem to basislem
                         end-if
                       else
                           if romhrk-corr-depkod > 0 then 
                              if  d-tl not = 0 and d-tl not =   romhrk-tl-tutar * ( - 1 )
                                   display message box "uyumsuz karsilik "
                              end-if
                           compute d-tl  = romhrk-tl-tutar * ( - 1 )
                           if basislem not = 0 then 
                              display message box " cift basilan" 
                           end-if
                           move romhrk-corr-depkod to d-basdep
                           move romhrk-islem to basislem
                           else
                             if  d-tl not = 0 and d-tl not =   romhrk-tl-tutar 
                                display message box "uyumsuz karsilik "
                             end-if
                           compute d-tl  = romhrk-tl-tutar  
                           move romhrk-depkod to d-kardep
                           if karislem not = 0 then 
                              display message box " cift karsilik" 
                           end-if
                           move romhrk-islem to karislem
                         end-if


                       end-if
                    end-if
                end-read
                end-read
              end-perform 
         end-start
          close romhrk hrk2
           compute d-dv rounded = d-tl / konu2-kur-degeri
          display ad-dv
            display ad-tl ad-kar ad-bas
          if d-tl > 0 then
            
              display ad-tl ad-kar ad-bas
              if d-kardep = 0 or d-basdep = 0 then 
                 display message box "uyumsuzluk"
              end-if

         end-if

     .
*
 screen1-Ex-Other.
     if key-status = 27 
       set exit-pushed to true
     end-if
     if key-status = 2 then
        open i-o onkasa romhrk yromhrk hrk2 
         perform har-sil
       
        if d-tl not = 0 then
          perform har-yaz
        end-if
         set exit-pushed to true
          close onkasa romhrk yromhrk hrk2 
     end-if.

*
  har-yaz.
      initialize hata 
     move d-basdep to depkod-anah 
     read depkod no lock invalid
       move 1 to hata 
       not invalid
         if depkod-ba not = "B" then 
               move 1 to hata 
         end-if
           if depkod-turu not = 1 then 
            move 1 to hata
         end-if
     end-read
    move d-kardep to depkod-anah 
     read depkod no lock invalid
       move 1 to hata 
       not invalid
         if depkod-ba not = "A" then 
               move 1 to hata 
         end-if
         if depkod-turu not = 1 then 
            move 1 to hata
         end-if
     end-read
     if hata = 1 then 
        display message box "Uyumsuz duzeltme"
         else
         perform har-yaz2
        
     end-if


     .

*
 har-yaz2.
           open i-o genelfis
            move 1 to genelfis-anahtar
            read genelfis no lock invalid
                 initialize genelfis-rec 
                 move 1 to genelfis-anahtar
                 not invalid continue 
            end-read
            add 1 to cekgir-oto
            move cekgir-oto to hrkgir-islem
            add 1 to cekgir-oto
            rewrite genelfis-rec invalid 
                    write genelfis-rec 
                    end-write continue
            end-rewrite
            close genelfis.
              initialize romhrk-rec
              move  konu3-folio    to romhrk-folio
              move  hrkgir-islem   to romhrk-islem
             if d-tl > 0 then 
                  move d-basdep    to romhrk-depkod
                  move "B" to romhrk-ba
                  compute ROMHRK-TL-TUTAR = d-tl
                  compute ROMHRK-dv-TUTAR = d-dv 
               else
                  move d-basdep    to romhrk-corr-depkod
                  move d-cor1      to  romhrk-depkod
                  move "A" to romhrk-ba
                  compute ROMHRK-TL-TUTAR = d-tl * ( - 1 )
                  compute ROMHRK-dv-TUTAR = d-dv * ( - 1 )
             end-if

                 move tarih-tasi to romhrk-tarih
                 move "D" to ROMHRK-ISLEM-TIPI
                 accept romhrk-zaman from time
                   move 1 to ROMHRK-ref  
                write romhrk-rec invalid stop " "
                end-write
                move romhrk-anah to hrk2-anah
                move konu2-folio to hrk2-kaynak-folio
                write hrk2-rec invalid stop " "
                end-write
                move romhrk-rec to yromhrk-rec
                 move romhrk-folio to yROMHRK-kaynak-folio 
                 move hrk2-kaynak-folio to yromhrk-folio
                 write yromhrk-rec invalid stop " "
                 end-write
                  move romhrk-rec to hrkgir-rec
                           if romhrk-corr-depkod > 0 then 
                             perform   onkasa-corr-artir
                              else
                             perform  onkasa-artir
                           end-if
               .
                initialize romhrk-rec
              move  konu3-folio    to romhrk-folio
              move  cekgir-oto   to romhrk-islem
             if d-tl > 0 then 
                  move d-kardep    to romhrk-depkod
                  move "A" to romhrk-ba
                  compute ROMHRK-TL-TUTAR = d-tl
                  compute ROMHRK-dv-TUTAR = d-dv 
               else
                  move d-kardep    to romhrk-corr-depkod
                  move d-cor2      to  romhrk-depkod
                  move "B" to romhrk-ba
                  compute ROMHRK-TL-TUTAR = d-tl * ( - 1 )
                  compute ROMHRK-dv-TUTAR = d-dv * ( - 1 )
             end-if

                 move tarih-tasi to romhrk-tarih
                 move "D" to ROMHRK-ISLEM-TIPI
                 accept romhrk-zaman from time
                 move 1 to ROMHRK-ref  
                write romhrk-rec invalid stop " "
                end-write
                move romhrk-anah to hrk2-anah
                move konu2-folio to hrk2-kaynak-folio
                write hrk2-rec invalid stop " "
                end-write
                move romhrk-rec to yromhrk-rec
                 move romhrk-folio to yROMHRK-kaynak-folio 
                 move hrk2-kaynak-folio to yromhrk-folio
                 write yromhrk-rec invalid stop " "
                 end-write
                  move romhrk-rec to hrkgir-rec
                           if romhrk-corr-depkod > 0 then 
                             perform   onkasa-corr-artir
                              else
                             perform  onkasa-artir
                           end-if
            move 1 to duz-yapildi.
           

*
 har-sil.
            if basislem > 0 then 
              move konu3-folio to romhrk-folio
              move basislem    to romhrk-islem
              read romhrk no lock invalid
                   stop  " " 
                not invalid
                   move romhrk-anah to hrk2-anah
                   read hrk2 no lock invalid
                      stop " "
                      not invalid
                      move hrk2-kaynak-folio to yromhrk-folio
                      move romhrk-islem to yromhrk-islem
                      read yromhrk no lock invalid
                        stop " " 
                          not invalid
                            delete romhrk end-delete
                            delete yromhrk end-delete
                           delete hrk2 end-delete
                            if romhrk-corr-depkod > 0 then 
                             perform   onkasa-corr-eksilt
                              else
                              perform  onkasa-eksilt
                           end-if
                      end-read
                   end-read
              end-read
             end-if
             if karislem > 0 then 
              move konu3-folio to romhrk-folio
              move karislem    to romhrk-islem
              read romhrk no lock invalid
                   stop  " " 
                not invalid
                   move romhrk-anah to hrk2-anah
                   read hrk2 no lock invalid
                      stop " "
                      not invalid
                      move hrk2-kaynak-folio to yromhrk-folio
                      move romhrk-islem to yromhrk-islem
                      read yromhrk no lock invalid
                        stop " " 
                          not invalid
                            delete romhrk end-delete
                            delete yromhrk end-delete
                           delete hrk2 end-delete
                           move romhrk-rec to hrkgir-rec
                           if romhrk-corr-depkod > 0 then 
                               perform   onkasa-corr-eksilt
                              else
                              perform  onkasa-eksilt
                           end-if
                      end-read
                   end-read
        
              end-read
             end-if.

*
 onkasa-artir.
        initialize onkasa-rec
       move hrkgir-tarih    to onkasa-tarih.
       move hrkgir-depkod   to onkasa-dep.
       read onkasa no lock invalid 
            compute onkasa-tutar-tl   = onkasa-tutar-tl + hrkgir-tl-tutar
            compute onkasa-tutar-dv   = onkasa-tutar-dv + hrkgir-dv-tutar
               write onkasa-rec invalid   continue
             end-write
            not invalid 
            compute onkasa-tutar-tl   = onkasa-tutar-tl + hrkgir-tl-tutar
            compute onkasa-tutar-dv   = onkasa-tutar-dv + hrkgir-dv-tutar
               rewrite onkasa-rec invalid 
                  continue
              end-rewrite

       end-read.
       
      

*/CORRECTION
 onkasa-corr-artir.
       initialize onkasa-rec
       move hrkgir-tarih              to onkasa-tarih.
       move hrkgir-corr-depkod        to onkasa-dep.
       read onkasa no lock invalid 
            initialize onkasa-rec
            move hrkgir-tarih         to onkasa-tarih
            move hrkgir-corr-depkod   to onkasa-dep
       end-read.
       compute onkasa-corr-tutar-tl = onkasa-corr-tutar-tl + hrkgir-tl-tutar.
       compute onkasa-corr-tutar-dv = onkasa-corr-tutar-dv + hrkgir-dv-tutar.
       rewrite onkasa-rec invalid 
               write onkasa-rec end-write
       end-rewrite.


*
 onkasa-eksilt.
       initialize onkasa-rec
       move calisma-tarihi    to onkasa-tarih.
       move hrkgir-depkod        to onkasa-dep.
       read onkasa no lock invalid 
          continue
       end-read.
       compute onkasa-tutar-tl   = onkasa-tutar-tl - hrkgir-tl-tutar.    
       compute onkasa-tutar-dv   = onkasa-tutar-dv - hrkgir-dv-tutar.    
       rewrite onkasa-rec invalid continue.


*/CORRECTION
 onkasa-corr-eksilt.
       move hrkgir-tarih              to onkasa-tarih.
       move hrkgir-corr-depkod        to onkasa-dep.
       read onkasa no lock invalid 
            continue
       end-read.
       compute onkasa-corr-tutar-tl   = onkasa-corr-tutar-tl - hrkgir-tl-tutar.    
       compute onkasa-corr-tutar-dv   = onkasa-corr-tutar-dv - hrkgir-dv-tutar.    
       rewrite onkasa-rec invalid 
               write onkasa-rec end-write
       end-rewrite.



    
*
 duzeltme-folio-bul. 
         move 0 to bulundu
         initialize konuk-rec
         move "H" to konuk-durumu
         move tarih-tasi to konuk-git-tar
         start konuk key >= konuk-git invalid 
               continue
               not invalid
               perform until fs-konuk = "10" 
                 read konuk next no lock end move "10" to fs-konuk
                     not end
                      if konuk-git-tar not = tarih-tasi or konuk-durumu not = "H"
                           move "10" to fs-konuk
                           exit perform cycle
                      end-if
                     if konuk-duzeltme not = 1 then 
                           exit perform cycle
                     end-if
                     if konuk-al-tar not = ilk-tarih(3:)
                          exit perform cycle
                     end-if
                     move 1 to bulundu
                        move konuk-rec to konu3-rec
                end-read
              end-perform 
         end-start.
         if bulundu = 0 then 
           perform duzeltme-ac
             move konuk-rec to konu3-rec
        end-if  .


        
        
        
*
 duzeltme-ac.
      close konuk
      open i-o konuk rez cast
      initialize rez-rec  konuk-rec


                  open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  stop " "
             not invalid
               add 1 to rez-oto
               add 1 to folio-oto
                  move rez-oto to rez-no 
                  rewrite genelfis-rec end-rewrite
             end-read .
           close genelfis
         

         move rez-oto to REZ-NO         
         move 1 to  REZ-TIPI  konuk-rez-tipi           

          move "I" to REZ-DURUMU    

         
             
             move tarih-tasi to  REZ-GIR-TAR  rez-cik-tar konuk-gel-tar konuk-git-tar
        move ilk-gun to  egun
        move ilk-ay  to eay
        move ilk-yil to eyil
        move etarih to  REZ-ADI  konuk-adi   
          move "FAT FARKLARI " to  REZ-ADI(10:)  konuk-adi(10:) 
  
                move ilk-gun to  egun
                move ilk-ay  to eay
                move ilk-yil to eyil
                move etarih to  REZ-ADI  konuk-adi   
          move  "C/L DUZELTMELERI" to REZ-soyadi  konuk-soyadi  
          move rezpara-banka          to rez-banka   konuk-banka.
             move rezpara-doviz       to rez-doviz       konuk-doviz           .
             move rezpara-pan-tipi    to rez-pan-tipi    konuk-pan-tipi      .
             move rezpara-odeme-tipi  to rez-odeme-tipi  konuk-odeme-tipi      .
             move rezpara-ulke        to rez-ulke        konuk-ulke           .
             move rezpara-anlasma     to rez-anlasma     konuk-anlasma       .
             move rezpara-pazar       to rez-pazar       konuk-pazar       .
             move rezpara-aygun       to rez-kur-aygun   konuk-kur-aygun     .
          

          move "K" to  REZ-K-G-B    
          move "N" to rez-vip   konuk-vip

          move "E"                  to rez-c-in
          move folio-oto to  REZ-FOLIO   KONUK-FOLIO 

          move "9998" to REZ-ODANO  konuk-odano 

       
          move "01" to  REZ-ODA-KONUMU   REZ-FIYAT-KONUMU    konuk-ODA-KONUMU   konuk-FIYAT-KONUMU      
         move tarih-tasi to  REZ-ISL-TAR.
            
          move ilk-tarih to  REZ-AL-TAR 
          move ilk-tarih(3:) to konuk-al-tar
          move 1 to    KONUK-KUR-DEGERI 
          move k-kodu-tasi to REZ-STAF KONUK-STAF         




      
          move "H" to KONUK-DURUMU   

          move "R" to  KONUK-FOL-KODU    
         
         
          move rez-no to KONUK-REZ-NO 
         
          move acenta-kodu to  KONUK-ACENTA rez-acenta
          
          move 1 to konuk-duzeltme    
        
          write rez-rec invalid stop " "
              not invalid
              write konuk-rec
                invalid stop" " 
              end-write
          end-write
              initialize cast-rec
                  move tarih-tasi to cast-tarih
                  move rez-no to cast-rez-no
                  move rez-odano        to cast-oda-no
                   move rez-buyuk        to cast-buyuk
                   move rez-kucuk        to cast-kucuk
        
                   move rez-bebek        to cast-bebek
                   move rez-free         to cast-free
                   move rez-oda-konumu   to cast-oda-konumu
                   move rez-fiyat-konumu to cast-fiyat-konumu
                   move rez-anlasma      to cast-anlasma
                   move rez-pan-tipi     to cast-pan-tipi
              write cast-rec invalid stop " " end-write

                display message box "Duzeltme Foliosu acildi"

                    open i-o romhrk yromhrk hrk2

                     initialize romhrk-rec
              move  konuk-folio    to romhrk-folio
              move  cekgir-oto   to romhrk-islem
            
                   move onkpara-city-ledger      to romhrk-depkod
                  move "B" to romhrk-ba
                  compute ROMHRK-TL-TUTAR = 0
                  compute ROMHRK-dv-TUTAR = 0
            

                 move rez-al-tar to romhrk-tarih
                 move "D" to ROMHRK-ISLEM-TIPI
                 accept romhrk-zaman from time
               move 1 to ROMHRK-ref  
                write romhrk-rec invalid stop " "
                end-write
                move romhrk-anah to hrk2-anah
                move konuk-folio to hrk2-kaynak-folio
                write hrk2-rec invalid stop " "
                end-write
                move romhrk-rec to yromhrk-rec
                 move romhrk-folio to yROMHRK-kaynak-folio 
               
                 write yromhrk-rec invalid stop " "
                 end-write
                  move romhrk-rec to hrkgir-rec
                          
              close  romhrk yromhrk hrk2


         



      close konuk rez cast
      open input konuk
      .

*
 fat-sil-gonder.
            inquire  form2-gd-1(i,ii),
                      cell-data in link-fat-no
                       call "/asya/ytl/obj/otel/fatiptal.asy" 
                    using  link-fat-no
                    on exception 
                     perform callerr-proc
                     exit paragraph
                    not on exception 
                     cancel "/asya/ytl/obj/otel/fatiptal.asy"
                  end-call
 
 
 
 
           .
*
 Form2-Gd-1-Ex-Other.
                  inquire form2-gd-1,
                      cursor-y in i
                      
                    inquire form2-gd-1(i,1),
                                 hidden-data in acenfat-anah
      evaluate key-status 
               when 3 
               when 2
                 perform Form2-Ex-Other
               WHEN 12 
               DiSPLAY MESSAGE BOX acenfat-anah
                 when 6
                 
                
                   if acenfat-folio > 0 then 
                    call "/asya/ytl/obj/otel/folio.asy" 
                    using  acenfat-folio
                    on exception 
                     perform callerr-proc
                     exit paragraph
                    not on exception 
                     cancel "/asya/ytl/obj/otel/folio.asy"
                  end-call
                    end-if
              when 11
                   if acenfat-kfolio > 0 then 
                    call "/asya/ytl/obj/otel/kfolio.asy" 
                    using  acenfat-kfolio
                    on exception 
                     perform callerr-proc
                     exit paragraph
                    not on exception 
                     cancel "/asya/ytl/obj/otel/kfolio.asy"
                  end-call
                    end-if
              when 18
                   if acenfat-kfolio > 0 then 
                     move acenfat-kfolio to konuk-folio
                     open input konuk
                     read konuk no lock invalid continue
                        not invalid
                          if konuk-rez-no > 0 then 
                        call "/asya/ytl/obj/otel/rez.asy" 
                          using  konuk-rez-no
                        on exception 
                              perform callerr-proc
                             exit paragraph
                          not on exception 
                        cancel "/asya/ytl/obj/otel/rez.asy"
                        end-call
                        end-if
                      end-read
                      close konuk
                    end-if
               when 16
                   if acenfat-kfolio > 0 then 
                     move acenfat-kfolio to konuk-folio
                     open input konuk
                     read konuk no lock invalid continue
                        not invalid
                          if konuk-rez-no > 0 then 
                        call "/asya/ytl/obj/otel/profat.asy" 
                          using   konuk-folio   konuk-rez-no
                        on exception 
                              perform callerr-proc
                             exit paragraph
                          not on exception 
                        cancel "/asya/ytl/obj/otel/profat.asy"
                        end-call
                        end-if
                      end-read
                      close konuk
                    end-if
            end-evaluate
     .
*
 Form2-Bef-Create.
     open i-o acenfat.
*
 Form2-Aft-Routine.
    exit paragraph .

 acenfat-yaz.    
     rewrite acenfat-rec invalid
             
               display message box 
                     "Kayit duzeltilemedi ..."
                     icon mb_error_icon
                     title "Hata",
     end-rewrite.
     
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to rapor-acenta.
       display  acc-acenta.
 acenta-oku.
       initialize gec-gecme.
       move "Tum Acentalar"      to adi-goster
       display lb-acenta-adi.
       if rapor-acenta not = spaces
          open input acenta
          initialize acenta-rec
          move rapor-acenta   to acenta-kodu
          read acenta        no lock invalid 
               move 1        to gec-gecme
               display message box "Acenta Kodu Tanimsiz.."
               move 4    to accept-control
               move 12 to control-id
               not invalid continue 
          end-read
          close acenta
          move acenta-adi     to adi-goster
          display lb-acenta-adi
       end-if.



     .
*
 Form2-Ex-Other. 
         
      if key-status = 3 or 2 then
       if duz-yapildi = 1 then 
         display message box " Duzeltmeler aktif olmasi icin onceki menuye donmelisiniz"
         exit paragraph
       end-if
       if cfat-no not > 0 then 
           display message box "Lutfen  Fatura no giriniz "
           exit paragraph
       end-if
        perform fatlar-olussun 
         set exit-pushed to true  
       exit paragraph
       end-if
     .
*
 fatlar-olussun.
      open i-o acenfat fatura romhrk exthrk  konuk FATDETAY  
        open input musteri doviz konu2 hrk2 depkod acenta cari
       inquire  form2-gd-1,
                       LAST-ROW in satir-say
        initialize i sonfat-sira formatlar det-ara-rec  fat-sira
       perform varying bu-satir from 2 by 1 until bu-satir > satir-say
           inquire  form2-gd-1(bu-satir,1),
                       hidden-data in acenfat-anah
                       cell-data in fat-sira
              if fat-sira > 0 then 
                 if sonfat-sira = 0 then 
                   move fat-sira to sonfat-sira
                   move 0 to fat-ekle
                   move 0 to fat-ok
                   perform until fat-ok = 1
                     add 1 to fat-ekle
                     perform fat-kont
                     if fat-ok = 0 and fat-ekle > 2
                        exit paragraph
                     end-if
                   end-perform
                 end-if
                 if sonfat-sira not = fat-sira then 
                    perform fat-bas
                     if key-status = 2
                        perform fattop-yaz
                    end-if
                    move fat-sira to sonfat-sira
                     move 0 to fat-ok
                   perform until fat-ok = 1 
                     add 1 to fat-ekle
                     perform fat-kont
                     if fat-ok = 0 and fat-ekle > 20
                        exit paragraph
                     end-if
                   end-perform
                    initialize i
                    initialize det-ara-rec formatlar
                 end-if
               add 1 to i
              read acenfat no lock invalid stop " "
               end-read
                
                  inquire  form2-gd-1(bu-satir,8)
                   cell-data in  det-ara-cari(i)
                   move acenfat-kfolio to konuk-folio 
                   read konuk no lock invalid
                     display message box "Konuk Bulunamadi" title "x"
                   end-read
                   if acenfat-peryod = 0 
                      move konuk-gel-tar  to  det-ara-girtar(i)
                      move konuk-git-tar  to  det-ara-ciktar(i)
                       move konuk-adi to  det-ara-adi(i)     
                    move konuk-soyadi to det-ara-soy(i)    
                    move konuk-odano    to  det-ara-oda(i) 
                    if konuk-voucher = spaces then
                           move "Oda:"         to   det-ara-voucher(i)(1:4) 
                           move konuk-odano    to   det-ara-voucher(i)(5:4) 
                       else
                           move konuk-odano to  det-ara-voucher(i)
                    end-if
                   end-if  
                   move konuk-doviz      to det-ara-kur-kod(i)  
                   move konuk-pan-tipi  to  det-ara-pan-kod(i)  
                   move konuk-buyuk     to  det-ara-buyuk(i) 
                   move acenfat-acenta to  det-ara-acenta(i) 
                   move konuk-kucuk     to  det-ara-kucuk(i)
                   move konuk-folio    to  det-ara-folio(i)
                   move 1 to  det-ara-adet(i)     
                   move konuk-kur-degeri to det-ara-kuru(i) 
                   move acenfat-tl-tutar  to  det-ara-tl-tut(i)
                  
                    move acenfat-per-geceleme to det-ara-geceleme(i)
                  
                    if acenfat-tip not = "2" then 
                           move 0 to det-ara-geceleme(i)
                    end-if
                    initialize musteri-rec
                    move acenfat-profil to det-ara-profil(i) m-profil
                   if musteri-no not numeric
                      move "999999992" to musteri-no
                   end-if
                     read musteri no lock invalid
                       move acenfat-acenta to acenta-kodu
                        read acenta no lock invalid
                               continue
                                    not invalid

                                        if ACENTA-MUHNO2 = spaces
                                            move acenta-muhno to cari-kodu
                                           else
                                               move acenta-muhno2 to cari-kodu
                                          end-if
                                 read cari no lock invalid
                                      initialize cari-rec
                                  end-read,
                                       perform varying ix from 1 by 1 until ix > 18
                                                       if c-vergi-no(ix:1) = spaces then 
                                                        move  c-vergi-no(ix + 1 :) to c-vergi-no(ix :) 
                                                        move  " " to c-vergi-no(20:1)
                                                       end-if
                                         end-perform 
                                      move c-unvan-1          to  musteri-unvan1(1:40)       
                                     move  c-unvan-2         to  musteri-unvan2(1:40)       
                                     move  c-adres-1         to  musteri-adres1 (1:40)      
                                     move  c-adres-2         to  musteri-adres2 (1:40)      
                                     move  c-il-ilce         to  musteri-ilce(1:20)         
                                     move  c-ulke(1:14)      to  musteri-il(1:14)           
                                     move  c-vergi-daire     to musteri-vdairesi (1:20)    
                                     move  c-vergi-no          to musteri-vno
                               
                         end-read
                        
                             not invalid
                                move   musteri-vno  to c-vergi-no         
                        
                        end-read
               
                    add  ACENFAT-TL-TUTAR       to   top-TL-TUTAR     
                    add  ACENFAT-GER-DV-TUTAR   to   top-GER-DV-TUTAR 
                    add  ACENFAT-GER-TL-TUTAR   to   top-GER-TL-TUTAR 
                    add  ACENFAT-MATRAH8        to   top-MATRAH8      
                    add  ACENFAT-MATRAH18       to   top-MATRAH18     
                    add  ACENFAT-KDV8           to   top-KDV8         
                    add  ACENFAT-KDV18          to   top-KDV18
                    move acenfat-folio to konu2-folio
                     if konuk-eb = "E" then
                      move " E/B"        to DET-ara-soy(i)(7:)
                   end-if   
                    read konu2 no lock invalid continue
                    end-read
                    if key-status = 2
                          perform fatara-yaz
                    end-if
              end-if
       
       end-perform .
        if i > 0 then 
           perform fat-bas
        if key-status = 2
           perform fattop-yaz
        end-if
        end-if
       close acenfat FATDETAY
       close musteri konuk doviz fatura  romhrk exthrk konu2 hrk2 depkod acenta cari.
*
 fat-kont.
         compute fat-no = cfat-no + fat-ekle - 1

     initialize fatura-rec
     move fat-no       to fatura-no
     move 0                    to fatura-sira
     read fatura no lock invalid
          display message box 
                  fat-no," seri numarali fatura tanimlamasi yapilmamis"
                  icon mb_error_icon
                  title "Hata"
          exit paragraph
          
         not invalid
     evaluate fatura-durumu
     when "I"
        display message box 
                fat-no," numarali fatura iptal edilmis !"
                icon mb_error_icon
                title "Hata"
        
        exit paragraph

     when "D"
        display message box 
                fat-no," seri numarali fatura daha once kesilmis !",
                new-line,
                new-line,
                "Kesilmis fatura Bilgileri"
                new-line,
                "Fatura Tarihi :",x"09",fatura-gun,"/"fatura-ay,"/",fatura-yil
                new-line,
                "Folio :",x"0909",fatura-folio,
                new-line,
                fatura-baslik-1, new-line,
                fatura-baslik-2, new-line,
                "Adres 1 :", x"09",fatura-adres-1,  new-line,
                "Adres 2 :", x"09",fatura-adres-2,  new-line,
                "Il :",      x"09",fatura-il,       new-line,
                "Ilce :",    x"09",fatura-ilce,     new-line,
                "Ulke :",    x"09",fatura-ulke,     new-line,
                "Vergi D.:", x"09",fatura-ver-da,   new-line,
                "Vergi N. :",x"09",fatura-ver-no    new-line new-line
                
           exit paragraph
        
                
     end-evaluate
     end-read
    
     move 1 to fat-ok.    
    

 fat99-yaz.
     initialize fatura-rec
    move fat-no                    to fatura-no
    move 999                          to fatura-sira
    read fatura no lock invalid
       continue
     end-read
         string fatura-aciklama delimited by "  "
              konuk-folio delimited by size
              into 
                 fatura-aciklama
           end-string
   
    write fatura-rec invalid
          rewrite fatura-rec end-rewrite
    end-write .
*/
 fatara-yaz.
      perform fat99-yaz.
       move fat-no                    to fatura-no
       move i                         to fatura-sira
        move fat-tarih                to fatura-tarihi
    move "A"                          to fatura-tipi
    move "D"                          to fatura-durumu
    move konu2-folio                  to fatura-folio
    move musteri-unvan1                    to fatura-baslik-1 
    move musteri-unvan2                    to fatura-baslik-2 
    move musteri-adres1                    to fatura-adres-1  
    move musteri-adres2                    to fatura-adres-2
    move musteri-vdairesi                  to fatura-ver-da   
    move musteri-vno                       to fatura-ver-no   
    move k-kodu-tasi                  to fatura-staf
    move ACENFAT-TL-TUTAR             to fatura-toplam   fatura-g-toplam
    move ACENFAT-MATRAH8              to fatura-matrah-8  
    move ACENFAT-MATRAH18             to fatura-matrah-18  
    move ACENFAT-KDV8                 to fatura-kdv-8   
    move ACENFAT-KDV18                to fatura-kdv-18
       compute fatura-matrah = fatura-matrah-8     + fatura-matrah-18 
       compute fatura-kdv = fatura-kdv-8    + fatura-kdv-18     
     perform fatfol-yaz.

         .
*
 fattop-yaz.
    move fat-no                to fatura-no
    move 0                     to fatura-sira
    read fatura no lock invalid
         continue
    end-read
    
    move fat-tarih                to fatura-tarihi
    move "A"                      to fatura-tipi
    move "D"                      to fatura-durumu
   
    move musteri-unvan1           to fatura-baslik-1 
    move musteri-unvan2           to fatura-baslik-2 
    move musteri-adres1           to fatura-adres-1  
    move musteri-adres2           to fatura-adres-2
    move musteri-vdairesi         to fatura-ver-da   
    move musteri-vno              to fatura-ver-no   
    move k-kodu-tasi              to fatura-staf
    move top-TL-TUTAR             to fatura-toplam   fatura-g-toplam
    move top-MATRAH8              to fatura-matrah-8  
    move top-MATRAH18             to fatura-matrah-18  
    move top-KDV8                 to fatura-kdv-8   
    move top-KDV18                to fatura-kdv-18
       compute fatura-matrah = fatura-matrah-8 + fatura-matrah-18 
       compute fatura-kdv    = fatura-kdv-8    + fatura-kdv-18     

     write fatura-rec invalid 
          rewrite fatura-rec end-rewrite
    end-write  .
         
*       
 fatfol-yaz. 
        
          initialize romhrk-rec exthrk-rec
         
          move  acenfat-folio to romhrk-folio exthrk-folio


                    move fat-no to konuk-fat-no
                     rewrite konuk-rec invalid stop "g ye bas" end-rewrite
                     initialize fatdetay-rec
                    move son-tarih to fatdetay-fat-tar
*                    if kont-fat-no > 100 then stop         " " end-if
                    move fat-no   to fatdetay-fat-no
                    move "C/L" to fatdetay-depkod  
                    move konuk-folio to fatdetay-folio
                    if k-kodu-tasi = "X   "  and function numval( fatdetay-fat-no ) = 17824 then 
                         stop " "
                    end-if
                      move acenfat-kdv to   fatdetay-kdv
                     move acenfat-tip to fatdetay-tip





                    read fatdetay no lock invalid continue
                    end-read

                       
         start romhrk key > romhrk-anah invalid
            continue
            not invalid
            perform until fs-romhrk= "10"
            read romhrk next no lock 
               end move "10" to fs-romhrk
               not end
                  if romhrk-folio > acenfat-folio
                     exit perform 
                  end-if
                  if romhrk-ref not = acenfat-pencere then 
                    exit perform cycle
                  end-if
                  move romhrk-anah to hrk2-anah
                  read hrk2 no lock invalid stop " "
                  end-read
                  if hrk2-kaynak-folio not = acenfat-kfolio
                       exit perform cycle
                  end-if
                  move romhrk-depkod to depkod-anah
                  read depkod no lock invalid
                     stop " "
                  end-read
                  if romhrk-corr-depkod not = zeroes and  romhrk-corr-depkod not = spaces then
                   
                      move romhrk-corr-depkod to depkod-anah
                  read depkod no lock invalid
                     stop " "
                  end-read
                  end-if
                  
                  if depkod-kdv not = ACENFAT-KDV
                      exit perform cycle
                  end-if
                  if depkod-tipi not =  acenfat-tip
                      exit perform cycle
                  end-if
                  if romhrk-fatura-no < 1 then 

                     move fat-no to romhrk-fatura-no
                     rewrite romhrk-rec end-rewrite
                  end-if
            end-read
            end-perform
          end-start
         
        
         start exthrk key > exthrk-anah invalid
            continue
            not invalid
            perform until fs-exthrk= "10"
            read exthrk next no lock 
               end move "10" to fs-exthrk
               not end
                  if exthrk-folio > acenfat-folio
                     exit perform 
                  end-if
                  if exthrk-ref not = acenfat-pencere then 
                    exit perform cycle
                  end-if
                   move exthrk-anah to hrk2-anah
                  read hrk2 invalid stop " "
                  end-read
                  move exthrk-depkod to depkod-anah
                  read depkod no lock invalid
                     stop " "
                  end-read
                  if exthrk-corr-depkod not = zeroes and  exthrk-corr-depkod not = spaces then
                      move exthrk-corr-depkod to depkod-anah
                  read depkod no lock invalid
                     stop " "
                  end-read
                  end-if
                  if hrk2-kaynak-folio not = acenfat-kfolio
                       exit perform cycle
                  end-if
                  if depkod-kdv not = ACENFAT-KDV
                      exit perform cycle
                  end-if
                  if depkod-tipi not =  acenfat-tip
                      exit perform cycle
                  end-if
                  if exthrk-fatura-no < 1 then 
                      move fat-no to exthrk-fatura-no
                     rewrite exthrk-rec end-rewrite
                  end-if
            end-read
            end-perform
          end-start
        


                    move konuk-fol-kodu to  fatdetay-romhrk-exthrk    
                    move acenfat-tarih to  fatdetay-isl-tar
                    accept fatdetay-kes-tar  from century-date
                    accept fatdetay-kes-zaman from time
                   
                     move acenfat-kdv to fatdetay-kdv-orani  fatdetay-kdv
                     move acenfat-tip to fatdetay-tip
*****                         if acenfat-peryod = 0 then 
*****    kamelyada cikarildi                   initialize fatdetay-fatura-matrah fatdetay-fatura-toplam
*******                                        fatdetay-fatura-toplamdv  fatdetay-fatura-matrah18
********                                      fatdetay-fatura-kdv fatdetay-fatura-kdv18
*********                          end-if
                     
                     compute fatdetay-fatura-matrah = fatdetay-fatura-matrah  + acenfat-matrah8 
                     compute fatdetay-fatura-matrah18 = fatdetay-fatura-matrah18  + acenfat-matrah18 

                    

                    compute fatdetay-fatura-toplam = fatdetay-fatura-toplam  + acenfat-tl-tutar
                      
                      

                    compute fatdetay-fatura-toplamdv = fatdetay-fatura-toplamdv  + ACENFAT-GER-DV-TUTAR

                    compute  fatdetay-fatura-kdv =  fatdetay-fatura-kdv +  ACENFAT-KDV8  
                    compute  fatdetay-fatura-kdv18 = fatdetay-fatura-kdv18  + ACENFAT-KDV18 
                      
                  write fatdetay-rec invalid rewrite fatdetay-rec end-write
       
        if acenfat-ger-islem > 0 then 
         
             move acenfat-ger-folio to romhrk-folio exthrk-folio
            move acenfat-ger-islem  to romhrk-islem exthrk-islem
           if acenfat-ger-f = "R" then
             read romhrk no lock invalid
               display message box "jdkfhdkjsfh"
               not invalid
                  move fat-no to romhrk-fatura-no
                     rewrite romhrk-rec end-rewrite
            end-read
           end-if
           if acenfat-ger-f = "E" then
             read exthrk no lock invalid
               display message box "etr5555fh"
               not invalid
                  move fat-no to exthrk-fatura-no
                     rewrite exthrk-rec end-rewrite
            end-read
           end-if
        end-if

       .
      
*
 fat-bas.
          open i-o genelfis
         move 1 to genelfis-anahtar
         read genelfis no lock invalid
            accept print-no from time
           not invalid
            add 1 to print-no
            rewrite genelfis-rec end-rewrite
          end-read
          close genelfis


              initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                       dokumer-dosya 
            set  dokumer-asya-set to true
            move print-no         to dokumer-dosya-adi
            open output dokumer
            add 1 to dokumer-anah
            write dokumer-rec

            if iki-fatura-ciksin = 0
               perform  fat-dok
            else
               perform  fat-dok
               perform  fat-dok-1
            end-if
            set dokumer-yazici-text to true
            move "H"                to dokumer-genel-baslik-yaz
            close dokumer
           
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call  



         .

*
 Form1-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         

        
         .


*
 fat-dok.
                
       move 1 to i
       initialize dokumer-rec  text-oku-rec
       open input text-oku,
       perform with test after until fs-text-oku = "10"
       initialize text-oku-2
       read text-oku next no lock end move "10" to fs-text-oku
          not end

          initialize dokumer-rec
          if text-oku-1  = "0"
             initialize text-oku-2
          end-if
          if text-oku-1  = "A"
*            if k-kodu-tasi(1:2) = "X " then stop " " end-if
            if det-ara-cari(i) not = spaces then
               initialize musteri-rec
                move  det-ara-profil(i) to m-profil
                if musteri-no not numeric
                      move "999999992" to musteri-no
                   end-if
                read musteri no lock invalid
                   move det-ara-acenta(i) to acenta-kodu
                   read acenta no lock invalid
                      continue
                      not invalid

                            if ACENTA-MUHNO2 = spaces
                             move acenta-muhno to cari-kodu
                                else
                              move acenta-muhno2 to cari-kodu
                          end-if
                         read cari no lock invalid
                          initialize cari-rec
                        end-read,
                 
                      move c-unvan-1          to  musteri-unvan1(1:40)       
                     move  c-unvan-2         to  musteri-unvan2(1:40)       
                     move  c-adres-1         to  musteri-adres1 (1:40)      
                     move  c-adres-2         to  musteri-adres2 (1:40)      
                     move  c-il-ilce         to  musteri-ilce(1:20)         
                     move  c-ulke(1:14)      to  musteri-il(1:14)           
                     move  c-vergi-daire     to musteri-vdairesi (1:20) 
                   perform varying ix from 1 by 1 until ix > 18
                       if c-vergi-no(ix:1) = spaces then 
                                move  c-vergi-no(ix + 1 :) to c-vergi-no(ix :) 
                                move  " " to c-vergi-no(20:1)
                       end-if
                   end-perform 
                       end-read
                        not invalid
                      move   musteri-vno to c-vergi-no         
                 end-read
            
              end-if
          end-if

          if text-oku-1 = "1"
          move det-ara-referans(i) to buf3
*          if buf3 > 0 then 
*             move ref-adi(buf3) to ref-adi2
*           end-if
           move fat-yil to e-yil
           move fat-ay  to e-ay
           move fat-gun to e-gun
          

            move c-vergi-no to  vergi-uzun
*             inspect text-oku-2 replacing all "[REFACIK_____________________]"            by ref-aciklama
             inspect text-oku-2 replacing all "[ACENADI_______________________________]" 
                   by musteri-unvan1(1:40) 
             inspect text-oku-2 replacing all "[ACENUNV_______________________________]"  
                   by musteri-unvan2(1:40)  
             inspect text-oku-2 replacing all "[ACENADR1______________________________]"  
                   by musteri-adres1 (1:40) 
             inspect text-oku-2 replacing all "[ACENADR2______________________________]"  
                   by musteri-adres2 (1:40) 
             inspect text-oku-2 replacing all "[ACEN-IL-ILCE______]"                     
                   by musteri-ilce(1:20) 
             inspect text-oku-2 replacing all "[ACENULKE____]"                            
                   by musteri-il(1:14)  
             inspect text-oku-2 replacing all "[ACENVDA___________]"                      
                   by musteri-vdairesi (1:20) 
             inspect text-oku-2 replacing all "[ACENVNO__________]"                       
                   by vergi-uzun(1:19)

             move fat-yil        to eyil
             move fat-ay         to eay
             move fat-gun        to egun
           
             inspect text-oku-2 replacing all "[FATTAR__]"                                
                   by etarih
          end-if
          if text-oku-1 = "2"
             if det-ara-tl-tut(i) not = zeroes

                
                inspect text-oku-2 replacing all "[VOUCHER_]" by det-ara-voucher(i)
                
                move det-ara-giryil(i)  to cin-yil
                move det-ara-giray(i)   to cin-ay
                move det-ara-girgun(i)  to cin-gun
                if det-ara-giryil(i) = zeroes
                   inspect text-oku-2 replacing all "[GIRTAR__]" by spaces
                 else  
                  inspect text-oku-2 replacing all "[GIRTAR__]" by d03-detay
                 end-if
                inspect text-oku-2 replacing all "[MUSADI__]" by det-ara-adi(i)
                move det-ara-cikyil(i)  to cout-yil
                move det-ara-cikay(i)   to cout-ay
                move det-ara-cikgun(i)  to cout-gun
                if det-ara-cikyil(i) = zeroes
                   inspect text-oku-2 replacing all "[CIKTAR__]"  by spaces
                   else
                   inspect text-oku-2 replacing all "[CIKTAR__]"  by d04-detay
                end-if   
                inspect text-oku-2 replacing all "[MUSSOY__]"  by det-ara-soy(i)
                inspect text-oku-2 replacing all "[OD]"        by det-ara-oda(i)
                if  det-ara-buyuk(i) = zeroes and det-ara-buy-kisi(i) or det-ara-geceleme(i) = 0
                inspect text-oku-2 replacing all "[B]"         by  spaces
                inspect text-oku-2 replacing all "[K]"         by  spaces
                inspect text-oku-2 replacing all "[ADET]"      by  spaces
                inspect text-oku-2 replacing all "QQ" by spaces
                 inspect text-oku-2 replacing all "x" by spaces
                                                  "+" by spaces
                                                  "=" by spaces
                inspect text-oku-2 replacing all "[BK]"        by  spaces
                
                inspect text-oku-2 replacing all "[CK]"        by  spaces
                inspect text-oku-2 replacing all "[DOV]"         by  spaces
                inspect text-oku-2 replacing all "[KURU____]"    by  spaces
                inspect text-oku-2 replacing all "[DVTUTAR__]"   by   spaces
                
                inspect text-oku-2 replacing all "[GUNFIY]"      by    spaces
                else
                move det-ara-buyuk(i)       to 3-z
                inspect text-oku-2 replacing all "[B]"         by  3-z
                move det-ara-kucuk(i)       to 3-z
                inspect text-oku-2 replacing all "[K]"         by  3-z
                move det-ara-adet(i)        to 6-z
                inspect text-oku-2 replacing all "[ADET]"      by  6-z
                move det-ara-buy-kisi(i)    to 4-z
                inspect text-oku-2 replacing all "[BK]"        by  4-z
                move det-ara-kuc-kisi(i)    to 4-z
                inspect text-oku-2 replacing all "[CK]"        by  4-z
                end-if 
                move det-ara-pan-kod(i)    to 2-x,
                inspect text-oku-2 replacing all "PP"          by  2-x

               
                move det-ara-kur-kod(i)    to doviz-kodu
                read doviz no lock invalid
                     initialize d-kisa-adi
                end-read
                 inspect text-oku-2 replacing all "QQ" by det-ara-geceleme(i)
                move d-kisa-adi       to 5-x,
                inspect text-oku-2 replacing all "[DOV]"       by  5-x
*->
                move det-ara-kuru(i)        to 10-z
                inspect text-oku-2 replacing all "[KURU____]"        by  10-z

                initialize dv-tut tl-tut  
                move det-ara-tl-tut(i) to tl-tut
                
                compute  gun-tut rounded = ( tl-tut / det-ara-kuru(i)) /  det-ara-geceleme(i)
                compute  dv-tut rounded = gun-tut *  det-ara-geceleme(i)
                
                
                if acenta-fatalti-ind > 0 then
                    compute  gun-tut rounded = 
                          (gun-tut / (100 - acenta-fatalti-ind )) * 100
                    compute  dv-tut rounded = gun-tut *  det-ara-geceleme(i)
                    compute tl-tut rounded =  gun-tut * det-ara-kuru(i) *  det-ara-geceleme(i)
                    compute tdv-tut-mat = tdv-tut-MAT + dv-tut
                    compute ttl-tut-mat = ttl-tut-MAT + tl-tut
                end-if
                 move dv-tut         to 11-z
                inspect text-oku-2 replacing all "[DVTUTAR__]"    by  11-z
                move tl-tut      to 13-z
                inspect text-oku-2 replacing all "[TLTUTAR____]"  by  13-z
                move gun-tut       to 8-z
                inspect text-oku-2 replacing all "[GUNFIY]"       by  8-z

             else
                initialize text-oku-2,
             end-if
             add 1 to i
          end-if

          if text-oku-1 = "3" or text-oku-1 = "5"
          inspect text-oku-2 replacing all  
             "[ASYA.........................................................................................]"
             by asya-text(1:95)
             move d-kisa-adi       to 5-x,
             inspect text-oku-2 replacing all "[DOV]"       by  5-x

             move top-GER-DV-TUTAR         to 11-z
             inspect text-oku-2 replacing all  "[GDVTUTAR_]"       by  11-z
              move top-GER-TL-TUTAR         to 11-z
              inspect text-oku-2 replacing all "[GTLTUTAR_]"       by  11-z
              move  top-TL-TUTAR        to 13-z
             inspect text-oku-2 replacing all "[TTLTUTAR___]"     by  13-z
             
             move top-matrah18        to 13-z
             inspect text-oku-2 replacing all "[T18KDVNET__]"     by  13-z
                
             move  top-KDV18         to 13-z
             inspect text-oku-2 replacing all "[T18KDVSI___]"     by  13-z
             
            
             move top-matrah8            to 13-z
             inspect text-oku-2 replacing all "[TTLKDVNET__]"     by  13-z
                
             move top-KDV8        to 13-z
             inspect text-oku-2 replacing all "[TTLKDVSI___]"     by  13-z
             
             if text-oku-1 =  "5"
                
                if acenta-fatalti-ind > 0 then
                   compute ttl-tut-mat-net  rounded 
                   = ( ttl-tut-mat * 100 ) /  ( cinpara-mus-kdv + 100 ) 
                   compute ind-mat = tlnet - ttl-tut-mat-net
                   move ttl-tut-mat-net         to 13-z
                  inspect text-oku-2 replacing all "[TTLINDSIZ__]"     by  13-z
                    move ind-mat         to 13-z
                  inspect text-oku-2 replacing all "[IND-TUTAR__]"     by  13-z
                
                  move acenta-fatalti-ind         to ind-z
                  inspect text-oku-2 replacing all "[IND]"     by  ind-z

              
                 else
                 initialize text-oku-2
                end-if
             end-if
          end-if

          if text-oku-1 = "4"
             initialize rakam yaziile
             move top-TL-TUTAR to rakam
             call "/asya/ytl/obj/otel/yaziile.asy" using rakam yaziile
                  on exception perform callerr-proc
                  not on exception
                  cancel "/asya/ytl/obj/otel/yaziile.asy" 
             end-call

             inspect text-oku-2 replacing all
             "[YAZI.........................................................................................]"
                                                      by yaziile(1:95)


                   
          end-if,
          if text-oku-1 = "9"
             move text-oku-2 to yaziile(1:95)
          end-if,
          
          move text-oku-2   to det-filler
          write dokumer-rec from detay
       end-read
       end-perform,
       close text-oku
 
         .
*
 fat-dok-1.
                
       move 1 to i
       initialize dokumer-rec  text-oku-rec
       open input text-oku,
       perform with test after until fs-text-oku = "10"
       initialize text-oku-2
       read text-oku next no lock end move "10" to fs-text-oku
          not end

          initialize dokumer-rec
          if text-oku-1  = "0"
             initialize text-oku-2
          end-if
          if text-oku-1  = "A"
*            if k-kodu-tasi(1:2) = "X " then stop " " end-if
            if det-ara-cari(i) not = spaces then
               initialize musteri-rec
                move  det-ara-profil(i) to m-profil
                if musteri-no not numeric
                      move "999999992" to musteri-no
                   end-if
                read musteri no lock invalid
                   move det-ara-acenta(i) to acenta-kodu
                   read acenta no lock invalid
                      continue
                      not invalid

                            if ACENTA-MUHNO2 = spaces
                             move acenta-muhno to cari-kodu
                                else
                              move acenta-muhno2 to cari-kodu
                          end-if
                         read cari no lock invalid
                          initialize cari-rec
                        end-read,
                 
                      move c-unvan-1          to  musteri-unvan1(1:40)       
                     move  c-unvan-2         to  musteri-unvan2(1:40)       
                     move  c-adres-1         to  musteri-adres1 (1:40)      
                     move  c-adres-2         to  musteri-adres2 (1:40)      
                     move  c-il-ilce         to  musteri-ilce(1:20)         
                     move  c-ulke(1:14)      to  musteri-il(1:14)           
                     move  c-vergi-daire     to musteri-vdairesi (1:20) 
                   perform varying ix from 1 by 1 until ix > 18
                       if c-vergi-no(ix:1) = spaces then 
                                move  c-vergi-no(ix + 1 :) to c-vergi-no(ix :) 
                                move  " " to c-vergi-no(20:1)
                       end-if
                   end-perform 
                        end-read
                        not invalid
                      move   musteri-vno to c-vergi-no         
                 end-read
            
              end-if
          end-if

          if text-oku-1 = "1"
          move det-ara-referans(i) to buf3
*          if buf3 > 0 then 
*             move ref-adi(buf3) to ref-adi2
*           end-if
           move fat-yil to e-yil
           move fat-ay  to e-ay
           move fat-gun to e-gun
          

            move c-vergi-no to  vergi-uzun
*             inspect text-oku-2 replacing all "[REFACIK_____________________]"            by ref-aciklama
             inspect text-oku-2 replacing all "[ACENADI_______________________________]" 
                   by musteri-unvan1(1:40) 
             inspect text-oku-2 replacing all "[ACENUNV_______________________________]"  
                   by musteri-unvan2(1:40)  
             inspect text-oku-2 replacing all "[ACENADR1______________________________]"  
                   by musteri-adres1 (1:40) 
             inspect text-oku-2 replacing all "[ACENADR2______________________________]"  
                   by musteri-adres2 (1:40) 
             inspect text-oku-2 replacing all "[ACEN-IL-ILCE______]"                     
                   by musteri-ilce(1:20) 
             inspect text-oku-2 replacing all "[ACENULKE____]"                            
                   by musteri-il(1:14)  
             inspect text-oku-2 replacing all "[ACENVDA___________]"                      
                   by musteri-vdairesi (1:20) 
             inspect text-oku-2 replacing all "[ACENVNO__________]"                       
                   by vergi-uzun(1:19)

             move fat-yil        to eyil
             move fat-ay         to eay
             move fat-gun        to egun
           
             inspect text-oku-2 replacing all "[FATTAR__]"                                
                   by etarih
          end-if
          if text-oku-1 = "2"
             if det-ara-tl-tut(i) not = zeroes

                
                inspect text-oku-2 replacing all "[VOUCHER_]" by det-ara-voucher(i)
                
                move det-ara-giryil(i)  to cin-yil
                move det-ara-giray(i)   to cin-ay
                move det-ara-girgun(i)  to cin-gun
                if det-ara-giryil(i) = zeroes
                   inspect text-oku-2 replacing all "[GIRTAR__]" by spaces
                 else  
                  inspect text-oku-2 replacing all "[GIRTAR__]" by d03-detay
                 end-if
                inspect text-oku-2 replacing all "[MUSADI__]" by det-ara-adi(i)
                move det-ara-cikyil(i)  to cout-yil
                move det-ara-cikay(i)   to cout-ay
                move det-ara-cikgun(i)  to cout-gun
                if det-ara-cikyil(i) = zeroes
                   inspect text-oku-2 replacing all "[CIKTAR__]"  by spaces
                   else
                   inspect text-oku-2 replacing all "[CIKTAR__]"  by d04-detay
                end-if   
                inspect text-oku-2 replacing all "[MUSSOY__]"  by det-ara-soy(i)
                inspect text-oku-2 replacing all "[OD]"        by det-ara-oda(i)
                if  det-ara-buyuk(i) = zeroes and det-ara-buy-kisi(i) or det-ara-geceleme(i) = 0
                inspect text-oku-2 replacing all "[B]"         by  spaces
                inspect text-oku-2 replacing all "[K]"         by  spaces
                inspect text-oku-2 replacing all "[ADET]"      by  spaces
                inspect text-oku-2 replacing all "QQ" by spaces
                 inspect text-oku-2 replacing all "x" by spaces
                                                  "+" by spaces
                                                  "=" by spaces
                inspect text-oku-2 replacing all "[BK]"        by  spaces
                
                inspect text-oku-2 replacing all "[CK]"        by  spaces
                inspect text-oku-2 replacing all "[DOV]"         by  spaces
                inspect text-oku-2 replacing all "[KURU____]"    by  spaces
                inspect text-oku-2 replacing all "[DVTUTAR__]"   by   spaces
                
                inspect text-oku-2 replacing all "[GUNFIY]"      by    spaces
                else
                move det-ara-buyuk(i)       to 3-z
                inspect text-oku-2 replacing all "[B]"         by  3-z
                move det-ara-kucuk(i)       to 3-z
                inspect text-oku-2 replacing all "[K]"         by  3-z
                move det-ara-adet(i)        to 6-z
                inspect text-oku-2 replacing all "[ADET]"      by  6-z
                move det-ara-buy-kisi(i)    to 4-z
                inspect text-oku-2 replacing all "[BK]"        by  4-z
                move det-ara-kuc-kisi(i)    to 4-z
                inspect text-oku-2 replacing all "[CK]"        by  4-z
                end-if 
                move det-ara-pan-kod(i)    to 2-x,
                inspect text-oku-2 replacing all "PP"          by  2-x

               
                move det-ara-kur-kod(i)    to doviz-kodu
                read doviz no lock invalid
                     initialize d-kisa-adi
                end-read
                 inspect text-oku-2 replacing all "QQ" by det-ara-geceleme(i)
                move d-kisa-adi       to 5-x,
                inspect text-oku-2 replacing all "[DOV]"       by  5-x
*->
                move det-ara-kuru(i)        to 10-z
                inspect text-oku-2 replacing all "[KURU____]"        by  10-z

                initialize dv-tut tl-tut  
                move det-ara-tl-tut(i) to tl-tut
                
                compute  gun-tut rounded = ( tl-tut / det-ara-kuru(i)) /  det-ara-geceleme(i)
                compute  dv-tut rounded = gun-tut *  det-ara-geceleme(i)
                
                
                if acenta-fatalti-ind > 0 then
                    compute  gun-tut rounded = 
                          (gun-tut / (100 - acenta-fatalti-ind )) * 100
                    compute  dv-tut rounded = gun-tut *  det-ara-geceleme(i)
                    compute tl-tut rounded =  gun-tut * det-ara-kuru(i) *  det-ara-geceleme(i)
                    compute tdv-tut-mat = tdv-tut-MAT + dv-tut
                    compute ttl-tut-mat = ttl-tut-MAT + tl-tut
                end-if
                 move dv-tut         to 11-z
                inspect text-oku-2 replacing all "[DVTUTAR__]"    by  11-z
                move tl-tut      to 13-z
                inspect text-oku-2 replacing all "[TLTUTAR____]"  by  13-z
                move gun-tut       to 8-z
                inspect text-oku-2 replacing all "[GUNFIY]"       by  8-z

             else
                initialize text-oku-2,
             end-if
             add 1 to i
          end-if

          if text-oku-1 = "3" or text-oku-1 = "5"
          inspect text-oku-2 replacing all  
             "[ASYA.........................................................................................]"
             by asya-text(1:95)
             move d-kisa-adi       to 5-x,
             inspect text-oku-2 replacing all "[DOV]"       by  5-x

             move top-GER-DV-TUTAR         to 11-z
             inspect text-oku-2 replacing all  "[GDVTUTAR_]"       by  11-z
              move top-GER-TL-TUTAR         to 11-z
              inspect text-oku-2 replacing all "[GTLTUTAR_]"       by  11-z
              move  top-TL-TUTAR        to 13-z
             inspect text-oku-2 replacing all "[TTLTUTAR___]"     by  13-z
             
             move top-matrah18        to 13-z
             inspect text-oku-2 replacing all "[T18KDVNET__]"     by  13-z
                
             move  top-KDV18         to 13-z
             inspect text-oku-2 replacing all "[T18KDVSI___]"     by  13-z
             
            
             move top-matrah8            to 13-z
             inspect text-oku-2 replacing all "[TTLKDVNET__]"     by  13-z
                
             move top-KDV8        to 13-z
             inspect text-oku-2 replacing all "[TTLKDVSI___]"     by  13-z
             
             if text-oku-1 =  "5"
                
                if acenta-fatalti-ind > 0 then
                   compute ttl-tut-mat-net  rounded 
                   = ( ttl-tut-mat * 100 ) /  ( cinpara-mus-kdv + 100 ) 
                   compute ind-mat = tlnet - ttl-tut-mat-net
                   move ttl-tut-mat-net         to 13-z
                  inspect text-oku-2 replacing all "[TTLINDSIZ__]"     by  13-z
                    move ind-mat         to 13-z
                  inspect text-oku-2 replacing all "[IND-TUTAR__]"     by  13-z
                
                  move acenta-fatalti-ind         to ind-z
                  inspect text-oku-2 replacing all "[IND]"     by  ind-z

              
                 else
                 initialize text-oku-2
                end-if
             end-if
          end-if

          if text-oku-1 = "4"
             initialize rakam yaziile
             move top-TL-TUTAR to rakam
             call "/asya/ytl/obj/otel/yaziile.asy" using rakam yaziile
                  on exception perform callerr-proc
                  not on exception
                  cancel "/asya/ytl/obj/otel/yaziile.asy" 
             end-call

             inspect text-oku-2 replacing all
             "[YAZI.........................................................................................]"
                                                      by yaziile(1:95)


                   
          end-if,
          if text-oku-1 = "9"
             move text-oku-2 to yaziile(1:95)
          end-if,
          
          move text-oku-2   to det-filler
          write dokumer-rec from detay
       end-read
       end-perform,
       close text-oku
 
         .
*    
 max-bul.
       open input text-oku,
       initialize max-satir
       perform with test after until fs-text-oku = "10"
       read text-oku next no lock end move "10" to fs-text-oku
            not end
              if text-oku-1 = "2"
                  initialize  apo
                 inspect text-oku-2 tallying apo for   all "[TLTUTAR____]" 
                   if apo > 0
                     add 1 to max-satir
                  end-if
              end-if
       end-read
       end-perform,
       close text-oku.


*
 acuserve-adres-aktar.
    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres       
                          
                         REFERANS-DOSYA-adres     
                         Mgenel-DOSYA-adres       
                        
                       
                

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA  
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.
    string genelfis-acuserve-dosya,
           ip-no                        delimited by low-values
           genelfis-dosya                 delimited by low-values
           into genelfis-acuserve-dosya.

    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    

    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect genelfis-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect genelfis-ACUSERVE-DOSYA    replacing  all spaces by low-values.
*
 ad-tl-Aft-Procedure.
          compute d-dv rounded = d-tl / konu2-kur-degeri
          display ad-dv
     .
*
 ad-dv-Aft-Procedure.
        compute d-tl rounded = d-dv * konu2-kur-degeri
        display ad-tl
     .

 
