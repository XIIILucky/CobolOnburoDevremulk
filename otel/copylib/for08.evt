* for08.evt
* for08.evt is generated from D:\asya\acugt.ytl\otel\for08.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
    open input genel2
    move 1 to genel2-anah 
    read genel2 no lock invalid continue
         not invalid continue
    end-read
    close genel2              
     .
*
 Form1-Aft-Initdata.                
    move tarih-tasi to tarih.
    move "O" to fol-tip.
    move "N" to rap-tip.
    move "01" to det-tip-value.
    display acc-01 acc-02 acc-03 acc-04 com-01 com-02 com-03.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
*
 Form1-Ex-Other.
    evaluate key-status
        when 1
             evaluate control-id
                 when 12
                 when 2001
                      initialize acenta-cagir
                      call "/asya/ytl/obj/otel/acenara.asy" 
                           using acenta-cagir  
                           on exception 
                              perform callerr-proc
                           not on exception
                              if acenta-cagir <> spaces
                                 move acenta-cagir to acn-kod
                                 display acc-04
                              end-if
                      end-call
                      move 4 to accept-control
                      move 12 to control-id
                 when 16
                 when 17
                      initialize acn-grup-kod
                      call "/asya/ytl/obj/otel/grupara.asy" 
                           using "A", acn-grup-kod  
                           on exception 
                              perform callerr-proc
                           not on exception
                              display acc-08
                      end-call
                      move 4 to accept-control
                      move 17 to control-id
             end-evaluate
             exit paragraph
        when 33 
             call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre 
      
        when 2      
             move det-tip-value(1:2) to det-tip
             evaluate ay 
                 when 1 when 3 when 5 when 7 when 8 when 10 when 12
                      move 31 to 31x
                      move 32 to 32x
                 when 2
                      if yil = 2004  or  yil = 2008 or  yil = 2012 or 
                         yil = 2016  or  yil = 2020  or yil = 2024  or  yil = 2028 then
                         move 29 to 31x
                         move 30 to 32x
                      else
                         move 28 to 31x
                         move 29 to 32x
                      end-if
                 when other
                      move 30 to 31x
                      move 31 to 32x
             end-evaluate        

             perform sutun-ayarla
             open input kodlar02 ulke konum doviz firma
             perform takas-dosya-yaz thru takas-dosya-yaz-exit

             initialize takas8-rec
             start takas8 key not < takas8-anahtar invalid
                   initialize mesaj-link
                   move 04 to mesaj-no
                   perform mesaj-ver
                   close takas8 kodlar02 ulke konum doviz pazartop firma
                   exit paragraph
             end-start

             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid
                  accept print-no from time
             not invalid
                  add 1 to print-no
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
             initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec dokumer-dosya

             set  dokumer-asya-set to true
             move print-no         to dokumer-dosya-adi

             open output dokumer
*/WINDOW TITLE
             initialize dokumer-rec detay
             move "W"                    to det-dokumer-20(1:)
             move "Secimli Acenta Forecast" to det-filler
             write dokumer-rec from detay
*/ BASLIKLAR
             initialize dokumer-rec detay
             move "B"                  to det-dokumer-20(1:)
             move "Secimli Acenta Forecast" to det-filler
             write dokumer-rec from detay
             initialize dokumer-rec detay
             move "B"                  to det-dokumer-20(1:)
             write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
             initialize dokumer-rec detay
             move "O"                        to det-dokumer-20(1:)
             move "E" to dokumer-oto-sayfa-basi
             move 56  to dokumer-oto-sayfa-satir
             move "|" to dokumer-detay-kolon-ayirici
             move "LLLLLLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
             move dokumer-ozellikler-rec     to det-filler
             write dokumer-rec from detay
*/ BASLIKLAR 
             initialize dokumer-rec detay
             move "D1"               to det-dokumer-20(1:)  
             move "Detay"            to det-1(1:10) 
             perform varying sayac from 1 by 1 until sayac > 31x,
                move gun-dizi(sayac) to det-1(sutun(sayac) + 1:02),    | (sutun(sayac):02)    
                move ay-dizi(sayac)  to det-1(sutun(sayac) + 3:05),    | (sutun(sayac) + 2:05)
                move "|"             to det-1(sutun(sayac) - 1:01),    | (sutun(sayac) - 1:1) 
             end-perform
             move "|"               to det-1(228:1),       | (198:1)
             move "|"               to det-1(235:1),       | (205:1)
             move "Toplam:"         to det-1(229:06)       | (199:06)
             write dokumer-rec from detay
             initialize dokumer-rec detay
             move "D2"               to det-dokumer-20(1:)     
             move "-"                to det-dokumer-20(5:1)
             move all "-"            to det-1(1:10)
             perform varying sayac from 1 by 1 until sayac > 31x,
                move all "-"         to det-1(sutun(sayac) + 1:02), | (sutun(sayac):02)
                move all "-"         to det-1(sutun(sayac) + 3:05), | (sutun(sayac) + 2:05)
                move "|"             to det-1(sutun(sayac) - 1:1),  | (sutun(sayac) - 1:1)
             end-perform
             move "|"               to det-1(228:1),    | (198:1)
             move "|"               to det-1(235:1),    | (205:1)
             move "Toplam:"         to det-1(229:06)    |(199:06)
             write dokumer-rec from detay
             open input acenta onbkodlar10
             initialize fs-takas8 x-toplam-dizi
             perform with test after until fs-takas8 = "10"
             read takas8 next no lock end move "10" to fs-takas8
             not at end               

                 initialize detay  
                 move takas8-acenta    to acenta-kodu
                 read acenta no lock invalid 
                      move acenta-kodu to acenta-adi,
                 end-read

                 move acenta-adi    to det-1(01:25)

                 move "A"           to det-dokumer-20(3:1)
                 move 144           to det-renk1
                 move "|"           to det-1(235:1) | (205:1)

                 perform varying sayac from 1 by 1 until sayac > 31x,
                    move 144           to satir-renk(sayac)
                 end-perform 
                 
                 if takas8-pazar not = spaces
                    initialize detay 
                    perform varying sayac from 1 by 1 until sayac > 31x,
                       move spaces           to satir-renk(sayac)
                    end-perform 
                    if takas8-pazar = x"FF"
                       move "Tanimsiz  " to det-1(02:10)
                    else
                       evaluate det-tip
                           when 11
                               move "O" to kodlar02-tipi
                                move takas8-pazar  to firma-kodu
                                read firma no lock invalid
                                     move all "*"  to firma-adi
                                end-read
                                move firma-kodu    to det-1(2:)
                                move "-"           to det-1(5:)
                                move firma-adi     to det-1(6:)
                           when 12
                                move takas8-pazar  to firma-kodu
                                read firma no lock invalid
                                     move all "*"  to firma-adi
                                end-read
                                move firma-adi     to det-1(3:)

                           when 2
                                move "E" to kodlar02-tipi
                                move takas8-pazar  to kodlar02-kodu
                                read kodlar02 no lock invalid
                                     move all "*"  to kodlar02-adi
                                end-read
                                move kodlar02-kodu to det-1(2:)
                                move "-"           to det-1(5:)
                                move kodlar02-adi  to det-1(6:)
                           when 3
                                move "A"           to kodlar02-tipi
                                move takas8-pazar  to kodlar02-kodu
                                read kodlar02 no lock invalid
                                     move all "*"  to kodlar02-adi
                                end-read
                                move kodlar02-kodu to det-1(2:)
                                move "-"           to det-1(5:)
                                move kodlar02-adi  to det-1(6:)
                
                           when 4
                                move takas8-pazar  to ulke-anah
                                read ulke no lock invalid
                                     move all "*"  to ulke-adi
                                end-read
                                move ulke-anah     to det-1(2:)
                                move "-"           to det-1(5:)
                                move ulke-adi      to det-1(6:)
                
                           when 5
                                move "D"           to kodlar02-tipi
                                move takas8-pazar  to kodlar02-kodu
                                read kodlar02 no lock invalid
                                     move all "*"  to kodlar02-adi
                                end-read
                                move kodlar02-kodu to det-1(2:)
                                move "-"           to det-1(5:)
                                move kodlar02-adi  to det-1(2:)
                
                           when 6
                                evaluate takas8-pazar(1:1)
                                    when 1
                                        move "1- "        to det-1
                                        move "Single"     to det-1(6:)
                                    when 2
                                        move "2- "        to det-1
                                        move "Double"     to det-1(6:)
                                    when 3
                                        move "3- "        to det-1
                                        move "Triple"     to det-1(6:)
                                    when 4
                                        move "4- "        to det-1
                                        move "Group "     to det-1(6:)
                                end-evaluate
                           when 7  
                           when 13
                                move takas8-pazar(1:2) to konum-anahtar
                                read konum no lock invalid
                                     move all "*"      to konum-adi
                                end-read
                                move konum-anahtar     to det-1(2:)
                                move "-"               to det-1(5:)
                                move konum-adi         to det-1(6:)
                             
                           when 8
                                move "B"           to kodlar02-tipi
                                move takas8-pazar  to kodlar02-kodu
                                read kodlar02 no lock invalid
                                     move all "*"  to kodlar02-adi
                                end-read
                                move kodlar02-kodu to det-1(2:)
                                move "-"           to det-1(5:)
                                move kodlar02-adi  to det-1(6:)
                           when 9
                                move takas8-pazar(1:2) to doviz-kodu
                                read doviz no lock invalid
                                     move all "*"      to d-adi-1
                                end-read
                                move doviz-kodu        to det-1(2:)
                                move "-"               to det-1(5:)
                                move d-adi-1           to det-1(6:)
                           when 10
                                evaluate takas8-pazar(5:1) 
                                    when "B"
                                         move "B->"            to det-1
                                         move "On Rezerv."     to det-1(5:)
                                    when "A"
                                         move "A->"            to det-1
                                         move "Gercek Rez"     to det-1(5:)
                                end-evaluate
                           when 14
                                initialize onbkodlar10-rec
                                move "AB"              to onbkodlar10-tipi
                                move takas8-pazar(1:2) to onbkodlar10-kodu1
                                read onbkodlar10 no lock invalid
                                    initialize onbkodlar10-rec
                                end-read
                                move onbkodlar10-adi   to det-1
                
                           when 15
                                initialize onbkodlar10-rec
                                move "AC"              to onbkodlar10-tipi
                                move takas8-pazar(1:2) to onbkodlar10-kodu1
                                read onbkodlar10 no lock invalid
                                    initialize onbkodlar10-rec
                                end-read
                                move onbkodlar10-adi   to det-1
                           when 16
                                initialize onbkodlar10-rec
                                move "AD"              to onbkodlar10-tipi
                                move takas8-pazar(1:2) to onbkodlar10-kodu1
                                read onbkodlar10 no lock invalid
                                    initialize onbkodlar10-rec
                                end-read
                                move onbkodlar10-adi   to det-1
                       end-evaluate
                    end-if
                 end-if

                 initialize toplam 
                 perform varying sayac from 1 by 1 until sayac > 31x,
                    move takas8-toplam(sayac) to toplam-z,
                    move toplam-z             to det-1(sutun(sayac):06),
                    compute toplam = toplam + takas8-toplam(sayac),
                    compute x-toplam(sayac) = x-toplam(sayac) + takas8-toplam(sayac)
                    evaluate takas8-stop(sayac) 
                        when 1 
                             move 112 to satir-renk(sayac)
                        when 2
                             move 176 to satir-renk(sayac)
                        when 3 
                             move 48  to satir-renk(sayac)
                     end-evaluate                 
                     if takas8-pazar = spaces
                        compute alt-toplam(sayac) = alt-toplam(sayac) + takas8-toplam(sayac)
                     end-if
                 end-perform   

                 move "|"            to det-1(228:01) | (198:01)
                 move toplam         to toplam-z-2
                 move toplam-z-2     to det-1(229:06) | (199:06)
                 move "|"            to det-1(235:01) | (205:1)  
                 if stop-islem = 1                        
                    move "C"                 to det-dokumer-20(3:1)
                    move "1"                 to det-dokumer-20(10:1)                                
                    move satir-renkler       to det-satir-renkler
                 end-if                        
                 write dokumer-rec from detay
              end-read
              end-perform

              perform alt-toplam-al thru alt-toplam-al-exit

              initialize detay x-son-toplam
              move "Son Toplam:" to det-1
              move "1"           to det-dokumer-20(10:1)
              perform varying xx from 1 by 1 until xx > 31x
                 if det-tip > 1 
                    compute x-toplam(xx) = x-toplam(xx) / 2,
                 end-if
                 move x-toplam(xx) to toplam-z,
                 move toplam-z     to det-1(sutun(xx):05),
                 compute x-son-toplam = x-son-toplam + x-toplam(xx),
              end-perform
              move x-son-toplam   to toplam-z-2
              move toplam-z-2     to det-1(229:05)   |(199:05)
              move "A"            to det-dokumer-20(3:1)
              move 481            to det-renk1
              move "|"            to det-1(235:1)    |(205:1)
              write dokumer-rec from detay

              initialize detay
              move "Yuzde %%..:" to det-1
              move "1"           to det-dokumer-20(10:1)
              initialize alt-yuzde-dizi son-toplam
              perform varying xx from 1 by 1 until xx > 31x,
                 if fol-tip = "P"
                    compute alt-yuzde(xx) = (x-toplam(xx) * 50) / hazir-oda(xx),
                 else
                    compute alt-yuzde(xx) = (x-toplam(xx) * 100) / hazir-oda(xx),
                 end-if
                 compute son-toplam = son-toplam + x-toplam(xx),
                 move alt-yuzde(xx)    to yuzde-goster
                 move yuzde-goster to det-1(sutun(xx):05),
              end-perform
              compute son-yuzde = (son-toplam * 100) / ( hazir-oda-toplam )
              move son-yuzde     to yuzde-goster
              move yuzde-goster  to det-1(229:05) | (199:05)
              move "A"           to det-dokumer-20(3:1)
              move 241           to det-renk1
              move "|"           to det-1(235:1)  | (205:1)
              write dokumer-rec from detay

              close dokumer
              call  dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close takas8 onbkodlar10 pazartop acenta 
                    kodlar02 ulke konum doviz firma
              delete file dokumer takas8 pazartop
    end-evaluate.
     .

 takas-dosya-yaz.
    perform takas-dosya-ac.
    open input takvim.
    initialize takvim-rec sayac tarih-dizi hazir-oda-dizi hazir-oda-ortalama
               hazir-oda-toplam hazir-oda-sayac.
    move tarih to takvim-anah.




    start takvim key not < takvim-anah invalid 
          close takvim go takas-dosya-yaz-exit,
          not invalid,
          open input rez  odalar cast grup bilbord aksiyon
          move spaces to eh,
          perform with test after until evet,
              read takvim next no lock end move "E" to eh,
                   not end,
                       if sayac > 31x,
                                     move "E" to eh,
                          else,
                                 add 1 to sayac,
                                 if sayac < 32x,
                                    perform cast-oku thru cast-oku-exit,
                                    move takvim-anah to son-tarih
                                      if det-tip = 10 
                                         perform bil-bul thru bil-bul-exit,
                                      end-if 
                                    move takvim-gun       to gun-dizi(sayac),
                                    move takvim-ay        to ay-dizi(sayac),
                                    move takvim-yil       to yil-dizi(sayac),
                                    move takvim-hazir-oda to hazir-oda(sayac),
                                    if takvim-hazir-oda not = zeroes,
                                       add 1 to hazir-oda-sayac,
                                       compute hazir-oda-ortalama = 
                                               hazir-oda-ortalama + takvim-hazir-oda,
                                       compute hazir-oda-toplam   = 
                                               hazir-oda-toplam   + takvim-hazir-oda,
                                    end-if,
                                 end-if,
                       end-if,
              end-read,
          end-perform,
    end-start.
      move tarih to takas-blok-bas-tar
    move son-tarih to takas-blok-bit-tar
    move 0 to takas-blok-fiyatli
        move 1 to takas-blok-konumlu
     if beklenen-grup    =  1
            
        open input romhrk formulhes aksiyhrk fiyatana fiyat kur cast3
       takvim2 aceanlas takvim3  grupfiy hesayr formul    gruplar konuk
     perform grup-takas-al
        
     perform gruplari-takasa-ekle
     close  romhrk formulhes aksiyhrk fiyatana fiyat kur cast3
       takvim2 aceanlas takvim3  grupfiy hesayr formul    gruplar konuk
     end-if



    close takvim rez  odalar cast grup bilbord aksiyon.   
    compute hazir-oda-ortalama = hazir-oda-ortalama / hazir-oda-sayac.

 takas-dosya-yaz-exit.
    exit.

*
 gruplari-takasa-ekle2.
  
     
     if takas-blok-konumlu = 1 then 
        move takas-blok-konum to rez-oda-konumu rez-fiyat-konumu
      if onkpara-referans-var = 1 then 
         perform ref-filtre
       if  not ref-gecti then 
           exit paragraph
       end-if
      end-if
     end-if
  
    
   
    if acn-kod not = spaces and gruplar-acenta not = acn-kod, exit paragraph
    end-if
   
    
   
   

*** Grup Filtresi

    if acn-grup-kod not = spaces
      initialize grup-rec
      set grup-acenta to true
      move acn-grup-kod to grup-kodu
      move gruplar-acenta   to grup-alt
      read grup no lock
        invalid
         exit paragraph
      end-read
    end-if
  
    
  
   
      compute geklenecek-oda = takas-blok-ayrilan-oda  - takas-blok-satilan-oda
     if geklenecek-oda < 0 then 
         move 0 to geklenecek-oda
     end-if
       compute geklenecek-pax = takas-blok-ayrilan-pax - takas-blok-satilan-pax

       if   gruplar-kalanlar-double = 1 then 
             compute geklenecek-pax = takas-blok-kalan-oda * 2
        end-if

      if geklenecek-pax < 0 then 
         move 0 to geklenecek-pax
      end-if


       compute geklenecek-chi = takas-blok-ayrilan-child - takas-blok-satilan-child

      
      if geklenecek-chi < 0 then 
         move 0 to geklenecek-chi
      end-if
****************************parçalaaaaaaa  


        move takas-blok-tarih to s1
       move  tarih        to s2
      compute  sayac = function integer-of-date(s1) -  function integer-of-date(s2) + 1
      if sayac < 1 or sayac > 31 move 1 to sayac end-if
   
   


    
    
*
    
         move 2  to  rez-s-d-t-g
        move gruplar-acenta   to rez-acenta

    initialize takas8-rec.
    move rez-acenta to takas8-acenta.
    read takas8 no lock invalid 
        continue.
    move takvim-anah to takas8-tarih(sayac).
    if fol-tip = "O" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + geklenecek-oda.
    if fol-tip = "P" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + geklenecek-pax.
    if fol-tip = "C" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + geklenecek-chi.
    
   
    write takas8-rec invalid rewrite takas8-rec end-write.

    if det-tip > 1  
       move gruplar-kaynak-1 to rez-kaynak-1
      move gruplar-kaynak-2 to rez-kaynak-2
      move gruplar-kaynak-3 to rez-kaynak-3
      move gruplar-anlasma  to rez-anlasma
      move takas-blok-konum to rez-fiyat-konumu rez-oda-konumu
      move gruplar-ulke     to rez-ulke
      move gruplar-acenta   to rez-acenta
      move gruplar-firma    to rez-firma
      move gruplar-kodu     to rez-grup-no
      move gruplar-grup-statu to rez-gr-status
      move gruplar-pazar to rez-pazar
      move gruplar-pan-tipi  to rez-pan-tipi
      move 1 to gruptan
       perform takas-detaylar-kaydet
       end-if.




*******************************************
      




 cast-oku.
    initialize cast-rec.
    move takvim-anah to cast-tarih.
    start cast key not < cast-tarih invalid continue,
        not invalid,
        move spaces to var-yok,
        perform with test after until var,
            read cast next no lock end move "v" to var-yok,
                 not end,
                 if cast-tarih > takvim-anah move "v" to var-yok,
                    else,
                     if cast-tarih not > takvim-anah,
                        initialize rez-rec,
                        move cast-rez-no to rez-no,
                        read rez no lock invalid continue,
                                     not invalid
                           if rez-gir-tar not = cast-tarih and girisler = 1
                              exit perform cycle
                           end-if

                    if filtre-var = 1 then 
                        perform filtre
                        if filtre-gecti = 1 then 
                          perform takas-kaydet thru takas-kaydet-exit
                        end-if
                      else
                        perform takas-kaydet thru takas-kaydet-exit 
                    end-if
                        end-read,
                     end-if,
                 end-if,
            end-read,
        end-perform,
    end-start.
 cast-oku-exit.
    exit.

 takas-kaydet.


    evaluate true
    when rap-tip = "N"
         if rez-durumu not = "I" go takas-kaydet-exit,
         end-if,
         if rez-k-g-b  not = "K" go takas-kaydet-exit,
         end-if,
    when rap-tip = "W"
         if rez-durumu not = "I" go takas-kaydet-exit,
         end-if,
         if rez-k-g-b      = "K" go takas-kaydet-exit,
         end-if,
    when rap-tip = "S"
         if rez-durumu not = "S" go takas-kaydet-exit,
         end-if.
    if rez-cik-tar      = takvim-anah go takas-kaydet-exit.
    if acn-kod not = spaces and rez-acenta not = acn-kod,
                                go takas-kaydet-exit.

*** Grup Filtresi

    if acn-grup-kod not = spaces
      initialize grup-rec
      set grup-acenta to true
      move acn-grup-kod to grup-kodu
      move rez-acenta   to grup-alt
      read grup no lock
        invalid
          go takas-kaydet-exit
      end-read
    end-if

*** Grup Filtresi
*   TRACE Uygulamasi Acik ise kisi sayilari cast'tan alinacak
     move 1 to eklenecek-oda
    if rezpara-trace = 1
       if rez-kisi not = cast-kisi
          move cast-kisi to rez-kisi
       end-if
       if rez-oda-konumu not = cast-oda-konumu
          move cast-oda-konumu to rez-oda-konumu
       end-if
       if rez-fiyat-konumu not = cast-fiyat-konumu
          move cast-fiyat-konumu to rez-fiyat-konumu
       end-if
       if rez-anlasma not = cast-anlasma
          move cast-anlasma to rez-anlasma
       end-if
       if rez-pan-tipi not = cast-pan-tipi
          move cast-pan-tipi to rez-pan-tipi
       end-if
         move cast-share to rez-share
           move cast-oda-no to rez-odano
                              move cast-fiyat-konumu to rez-fiyat-konumu
                              move cast-oda-konumu to rez-oda-konumu
       if rez-share = 1 then 
         
             move 0 to eklenecek-oda 
            else
              move 1 to eklenecek-oda
        end-if
      else 
          move 1 to eklenecek-oda
    end-if
    if onkpara-referans-var = 1 then 
       perform ref-filtre
       if  not ref-gecti then 
           exit paragraph
       end-if
    end-if

     if rez-odano not = spaces and 
       ( hayali-haric = 1 or dis-haric = 1 ) then 
              move rez-odano to odalar-anah
              read odalar no lock invalid continue
              not invalid
              if ( odalar-hayali = "H" and hayali-haric = 1 )  then
                       move 0 to eklenecek-oda
              end-if
               if ( dis-haric = 1 and odalar-dis = 1 )  then
                          go takas-kaydet-exit
              end-if 
              end-read
    end-if  
    
*
    evaluate true
    when rez-buyuk < 2
         move 1  to  rez-s-d-t-g
    when rez-buyuk = 2
         move 2  to  rez-s-d-t-g
    when rez-buyuk = 3
         move 3  to  rez-s-d-t-g
    when rez-buyuk > 3
         move 4  to  rez-s-d-t-g
    end-evaluate.

    initialize takas8-rec.
    move rez-acenta to takas8-acenta.
    read takas8 no lock invalid 
        continue.
    move takvim-anah to takas8-tarih(sayac).
    if fol-tip = "O" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + eklenecek-oda.
    if fol-tip = "P" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + rez-buyuk.
    if fol-tip = "C" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + rez-kucuk.
    if fol-tip = "F" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + rez-free.
    if det-tip-value(1:2) = "01"
       if stop-islem = 1
         perform stop-al
       end-if 
    end-if 

    write takas8-rec invalid rewrite takas8-rec end-write.

    if det-tip > 1 
        move 0 to gruptan
       perform takas-detaylar-kaydet.

 takas-kaydet-exit.
     exit.











 takas-detaylar-kaydet.
    if det-tip = 10
       move rez-acenta       to takas8-acenta
       move rez-acenta       to takas8-pazar
       move "A"              to takas8-pazar(5:)
       read takas8 no lock invalid 
          initialize takas8-rec
          move rez-acenta       to takas8-acenta
          move rez-acenta       to takas8-pazar
          move "A"              to takas8-pazar(5:)
       end-read
           move takvim-anah      to takas8-tarih(sayac)
           write takas8-rec invalid 
                 rewrite takas8-rec invalid continue
                 end-rewrite
           end-write
    end-if 

    initialize takas8-rec
    move rez-acenta  to takas8-acenta.
    move takvim-anah to takas8-tarih(sayac).
    if det-tip = 2 and rez-pazar = spaces 
       move x"FF" to rez-pazar 
    end-if
    evaluate det-tip
         when 02 move rez-pazar         to takas8-pazar
         when 03 move rez-pan-tipi      to takas8-pazar
         when 04 move rez-ulke          to takas8-pazar
         when 05 move rez-anlasma       to takas8-pazar
         when 06 move rez-s-d-t-g       to takas8-pazar
         when 07 move rez-oda-konumu    to takas8-pazar
         when 13  move rez-fiyat-konumu    to takas8-pazar
         when 08 move rez-odeme-tipi    to takas8-pazar
         when 09 move rez-doviz         to takas8-pazar
         when 10 move rez-acenta        to takas8-pazar
                 move "A"               to takas8-pazar(5:)
         when 11 move rez-operator      to takas8-pazar
         when 12 move rez-firma         to takas8-pazar
         when 14  move rez-kaynak-1   to takas8-pazar
         when 15  move rez-kaynak-2   to takas8-pazar
         when 16  move rez-kaynak-3   to takas8-pazar

    end-evaluate
    move rez-acenta to takas8-acenta
    read takas8 no lock invalid
         initialize takas8-rec
         evaluate det-tip
                  when 11 move rez-operator      to takas8-pazar
                  when 12 move rez-firma         to takas8-pazar
                  when 02 move rez-pazar         to takas8-pazar
                  when 03 move rez-pan-tipi      to takas8-pazar
                  when 04 move rez-ulke          to takas8-pazar
                  when 05 move rez-anlasma       to takas8-pazar
                  when 06 move rez-s-d-t-g       to takas8-pazar
                  when 07 move rez-oda-konumu    to takas8-pazar
                  when 13  move rez-fiyat-konumu    to takas8-pazar
                  when 08 move rez-odeme-tipi    to takas8-pazar
                  when 09 move rez-doviz         to takas8-pazar
                  when 10 move rez-acenta        to takas8-pazar
                          move "B"               to takas8-pazar(5:)
                 when 14  move rez-kaynak-1   to takas8-pazar
                 when 15  move rez-kaynak-2   to takas8-pazar
                 when 16  move rez-kaynak-3   to takas8-pazar
         end-evaluate
         move rez-acenta  to takas8-acenta
         move takvim-anah to takas8-tarih(sayac)
    end-read.
    if gruptan = 1
           if fol-tip = "O" compute takas8-toplam(sayac) = 
                             takas8-toplam(sayac) + geklenecek-oda 
          end-if
            if fol-tip = "P" compute takas8-toplam(sayac) = 
                                     takas8-toplam(sayac) + geklenecek-pax
           end-if 
            if fol-tip = "C" compute takas8-toplam(sayac) = 
                                     takas8-toplam(sayac) + geklenecek-chi
           end-if 

    else
        
            if fol-tip = "O" compute takas8-toplam(sayac) = 
                                     takas8-toplam(sayac) + eklenecek-oda 
            end-if
            if fol-tip = "P" compute takas8-toplam(sayac) = 
                                     takas8-toplam(sayac) + rez-buyuk 
            end-if
            if fol-tip = "C" compute takas8-toplam(sayac) = 
                                     takas8-toplam(sayac) + rez-kucuk 
            end-if
            if fol-tip = "F" compute takas8-toplam(sayac) = 
                                     takas8-toplam(sayac) + rez-free 
            end-if

            if stop-islem = 1
               perform stop-al
            end-if 
    end-if
    write takas8-rec invalid 
          rewrite takas8-rec invalid continue
          end-rewrite
    end-write.
 
    evaluate det-tip
             when 11 move rez-operator      to pazartop-anah
             when 12 move rez-firma         to pazartop-anah
             when 02 move rez-pazar         to pazartop-anah
             when 03 move rez-pan-tipi      to pazartop-anah
             when 04 move rez-ulke          to pazartop-anah
             when 05 move rez-anlasma       to pazartop-anah
             when 06 move rez-s-d-t-g       to pazartop-anah
             when 07 move rez-oda-konumu    to pazartop-anah
             when 13 move rez-fiyat-konumu    to pazartop-anah
             when 08 move rez-odeme-tipi    to pazartop-anah
             when 09 move rez-doviz         to pazartop-anah
             when 10 move rez-acenta        to pazartop-anah
         when 14  move rez-kaynak-1   to pazartop-anah
         when 15  move rez-kaynak-2   to pazartop-anah
         when 16  move rez-kaynak-3   to pazartop-anah

    end-evaluate
    read pazartop no lock invalid
         initialize pazartop-rec
         evaluate det-tip
             when 11 move rez-operator      to pazartop-anah
             when 12 move rez-firma         to pazartop-anah
             when 02 move rez-pazar         to pazartop-anah
             when 03 move rez-pan-tipi      to pazartop-anah
             when 04 move rez-ulke          to pazartop-anah
             when 05 move rez-anlasma       to pazartop-anah
             when 06 move rez-s-d-t-g       to pazartop-anah
             when 07 move rez-oda-konumu    to pazartop-anah
             when 13 move rez-fiyat-konumu    to pazartop-anah
             
             when 08 move rez-odeme-tipi    to pazartop-anah
             when 09 move rez-doviz         to pazartop-anah
             when 10 move rez-acenta        to pazartop-anah
         when 14  move rez-kaynak-1   to pazartop-anah
         when 15  move rez-kaynak-2   to pazartop-anah
         when 16  move rez-kaynak-3   to pazartop-anah

         end-evaluate
    end-read
    if gruptan = 1
       evaluate fol-tip
         when "O" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + geklenecek-oda
         when "P" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + geklenecek-pax
         when "C" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + geklenecek-chi
         
    end-evaluate

    else
    evaluate fol-tip
         when "O" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + eklenecek-oda
         when "P" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + rez-buyuk 
         when "C" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + rez-kucuk 
         when "F" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + rez-free  
    end-evaluate
    end-if.
    write pazartop-rec invalid 
          rewrite pazartop-rec invalid continue 
          end-rewrite 
    end-write.
 bil-bul.
    initialize bilbord-rec.
    move takvim-anah   to bilbord-tarih
    start bilbord key not < bilbord-anah2 invalid
          go bil-bul-exit.
 bil-bul-oku.
    read bilbord next no lock end 
         go bil-bul-exit.
    if bilbord-tarih = takvim-anah
       continue
    else 
       go bil-bul-exit
    end-if
    perform takas-bilbord-kaydet thru takas-bilbord-kaydet-exit.
       go bil-bul-oku.
 bil-bul-exit.
    exit.
 takas-bilbord-kaydet.
    initialize takas8-rec
    move bilbord-acenta to takas8-acenta.
    write takas8-rec invalid
          rewrite takas8-rec end-rewrite
    end-write.

    initialize takas8-rec
    move bilbord-acenta to takas8-acenta.
    move bilbord-acenta to takas8-pazar.
    move "B"            to takas8-pazar(5:)
    read takas8 no lock invalid
         initialize takas8-rec
         move bilbord-acenta to takas8-acenta
         move bilbord-acenta to takas8-pazar
         move "B"            to takas8-pazar(5:)
    end-read
    move bilbord-yil    to takas8-yil(sayac).
    move bilbord-ay     to takas8-ay(sayac) .
    move bilbord-gun    to takas8-gun(sayac).

    if fol-tip = "O" 
       compute takas8-toplam(sayac) = takas8-toplam(sayac) + bilbord-oda - bilbord-sat-oda
    end-if
    if fol-tip = "P" 
       compute takas8-toplam(sayac) = takas8-toplam(sayac) + bilbord-oda - bilbord-sat-oda
    end-if
    if fol-tip = "C" 
       compute takas8-toplam(sayac) = takas8-toplam(sayac) + bilbord-sat-oda 
    end-if
    if fol-tip = "F" 
        compute takas8-toplam(sayac) = takas8-toplam(sayac) + bilbord-oda - bilbord-sat-oda
    end-if
    write takas8-rec invalid 
          rewrite takas8-rec invalid continue
          end-rewrite
    end-write.
    evaluate det-tip
             when 10 move takas8-acenta       to pazartop-anah
    end-evaluate
    read pazartop no lock invalid
         initialize pazartop-rec
         evaluate det-tip
             when 10 move takas8-acenta       to pazartop-anah
         end-evaluate
    end-read
    evaluate fol-tip
         when "O" 
                  compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + bilbord-oda - bilbord-sat-oda
         when "P" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + bilbord-oda - bilbord-sat-oda
         when "C" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + bilbord-oda - bilbord-sat-oda
         when "F" compute pazartop-toplam(sayac) = 
                          pazartop-toplam(sayac) + bilbord-oda - bilbord-sat-oda
    end-evaluate.
    write pazartop-rec invalid 
          rewrite pazartop-rec invalid continue
          end-rewrite 
    end-write.
 takas-bilbord-kaydet-exit.
      exit.
 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid 
         move 1 to ekran-fis-1
    end-read.
    
    add 1 to ekran-fis-1.
 
    move ekran-fis-1(2:) to takas8-no
                        pazartop-no.
    add 1 to ekran-fis-1.
    rewrite genelfis-rec invalid 
            write genelfis-rec invalid continue
            end-write
    end-rewrite.
    close genelfis.
    open output takas8 close takas8 open i-o takas8 with mass-update.
    open output pazartop close pazartop open i-o pazartop.

*
 alt-toplam-al.
    initialize alt-toplam-dizi alt-ptoplam-dizi.

      if det-tip > 1
         initialize detay pazartop-rec
         start pazartop key not < pazartop-anah invalid
               continue
         not invalid
*         initialize detay  
*         write dokumer-rec from detay

         initialize fs-pazartop
         evaluate det-tip
             when 01 continue
             when 11 move "Operator Tp" to det-1
             when 02 move "Pazar Topl." to det-1
             when 03 move "Pansiyon T." to det-1
             when 04 move "Ulke Toplam" to det-1

             when 05 move "Anl.Tipi T." to det-1
             when 06 move "Oda Tipi T." to det-1
             when 07 move "Konum Topl." to det-1
             when 13 move "F.Kon Topl." to det-1
             when 08 move "Odeme Topl." to det-1
             when 09 move "Doviz Topl." to det-1
             when 10 move "Rez+On-Rez " to det-1
             when 12 move "Sirket/Firm" to det-1
                 when 14  move "Kaynak 1 T."   to det-1
                 when 15  move "Kaynak 2 T."   to det-1
                 when 16  move "Kaynak 3 T."   to det-1


         end-evaluate
             move "A"           to det-dokumer-20(3:1)
             move 176           to det-renk1
             move "|"           to det-1(235:1)   |(205:1)
         
         write dokumer-rec from detay

         initialize fs-pazartop
         perform with test after until fs-pazartop = "10"
               read pazartop next no lock end move "10" to fs-pazartop
               not at end
                    initialize detay
       evaluate det-tip
            when 11
                 move "O" to kodlar02-tipi
                 move pazartop-anah to kodlar02-kodu
                 read kodlar02 no lock invalid
                      move all "*" to kodlar02-adi
                 end-read
                 move kodlar02-kodu to det-1(1:)
                 move "-"           to det-1(4:)
                 move kodlar02-adi  to det-1(5:)
            when 12
                 move pazartop-anah to firma-kodu
                 read firma no lock invalid
                      move all "*" to firma-adi
                 end-read
                 move firma-kodu to det-1(1:)
                 move "-"           to det-1(4:)
                 move firma-adi  to det-1(5:)

            when 2
                 move "E" to kodlar02-tipi
                 move pazartop-anah to kodlar02-kodu
                 read kodlar02 no lock invalid
                      move all "*" to kodlar02-adi
                 end-read
                 move kodlar02-kodu to det-1(1:)
                 move "-"           to det-1(4:)
                 move kodlar02-adi  to det-1(5:)
            when 3
                 move "A" to kodlar02-tipi
                 move pazartop-anah to kodlar02-kodu
                 read kodlar02 no lock invalid
                      move all "*" to kodlar02-adi
                 end-read
                 move kodlar02-kodu to det-1(1:)
                 move "-"           to det-1(4:)
                 move kodlar02-adi  to det-1(5:)
            when 4
                 move pazartop-anah to ulke-anah
                 read ulke no lock invalid
                      move all "*" to ulke-adi
                 end-read
                 move ulke-anah     to det-1(1:)
                 move "-"           to det-1(4:)
                 move ulke-adi      to det-1(5:)
            when 5
                 move "D" to kodlar02-tipi
                 move pazartop-anah to kodlar02-kodu
                 read kodlar02 no lock invalid
                      move all "*" to kodlar02-adi
                 end-read
                 move kodlar02-kodu to det-1(1:)
                 move "-"           to det-1(4:)
                 move kodlar02-adi  to det-1(5:)
            when 6
                 evaluate pazartop-anah(1:1)
                     when 1
                         move "1- "        to det-1
                         move "Single"     to det-1(5:)
                     when 2
                         move "2- "        to det-1
                         move "Double"     to det-1(5:)
                     when 3
                         move "3- "        to det-1
                         move "Triple"     to det-1(5:)
                     when 4
                         move "4- "        to det-1
                         move "Group "     to det-1(5:)
                 end-evaluate
           when 7
           when 13
                 move pazartop-anah(1:2)  to konum-anahtar
                 read konum no lock invalid
                      move all "*" to konum-adi
                 end-read
                 move konum-anahtar to det-1(1:)
                 move "-"           to det-1(4:)
                 move konum-adi     to det-1(5:)
           when 8
                 move "B" to kodlar02-tipi
                 move pazartop-anah to kodlar02-kodu
                 read kodlar02 no lock invalid
                      move all "*" to kodlar02-adi
                 end-read
                 move kodlar02-kodu to det-1(1:)
                 move "-"           to det-1(4:)
                 move kodlar02-adi  to det-1(5:)
           when 9
                 move pazartop-anah(1:2)   to doviz-kodu
                 read doviz no lock invalid
                      move all "*" to d-adi-1
                 end-read
                 move doviz-kodu    to det-1(1:)
                 move "-"           to det-1(4:)
                 move d-adi-1       to det-1(5:)
           when 10
                 move pazartop-anah(1:4) to acenta-kodu
                 read acenta no lock invalid
                      move all "*" to acenta-adi
                 end-read
                 move acenta-kodu   to det-1(1:)
                 move "-"           to det-1(5:)
                 move acenta-adi    to det-1(6:)
           when 14
                            initialize onbkodlar10-rec
                            move "AB" to onbkodlar10-tipi
                            move pazartop-anah(1:2) to onbkodlar10-kodu1
                            read onbkodlar10 no lock
                              invalid
                                initialize onbkodlar10-rec
                            end-read
                            move onbkodlar10-adi       to det-1

           when 15
                            initialize onbkodlar10-rec
                            move "AC" to onbkodlar10-tipi
                            move pazartop-anah(1:2) to onbkodlar10-kodu1
                            read onbkodlar10 no lock
                              invalid
                                initialize onbkodlar10-rec
                            end-read
                            move onbkodlar10-adi       to det-1
           when 16
                            initialize onbkodlar10-rec
                            move "AD" to onbkodlar10-tipi
                            move pazartop-anah(1:2) to onbkodlar10-kodu1
                            read onbkodlar10 no lock
                              invalid
                                initialize onbkodlar10-rec
                            end-read
                            move onbkodlar10-adi       to det-1
       end-evaluate
       initialize son-toplam
       perform varying xx from 1 by 1 until xx > 31x,
          move pazartop-toplam(xx) to toplam-z,
          move toplam-z            to det-1(sutun(xx):05),
          compute son-toplam  = son-toplam + pazartop-toplam(xx),
          compute alt-ptoplam(xx) = alt-ptoplam(xx) + pazartop-toplam(xx) 
       end-perform
       move "|"          to det-1(228:01)  | (198:01)
       move son-toplam   to toplam-z-2
       move toplam-z-2   to det-1(229:05)  | (199:05)
       move "|"          to det-1(235:1)   | (205:1)
       write dokumer-rec from detay
       end-read
     end-perform

*     initialize det-1 
*     move "Toplam:" to det-1
*     perform varying xx from 1 by 1 until xx > 31x
*       move alt-ptoplam(xx) to toplam-z,
*       move toplam-z        to det-1(sutun(xx):05),
*       compute son-ptoplam = son-ptoplam + alt-ptoplam(xx),
*     end-perform
*     move son-ptoplam   to toplam-z-2
*     move toplam-z-2    to det-1(199:05)
*     move "A"           to det-dokumer-20(3:1)
*     move 481           to det-renk1
*     move "|"           to det-1(205:1)
*     write dokumer-rec from detay
*
*     initialize det-1 alt-yuzde-dizi
*     move "Yuzde:" to det-1
*     perform varying yy from 1 by 1 until yy > 31x,
*       compute alt-yuzde(yy) = (alt-ptoplam(yy) * 100) / hazir-oda(yy),
*       move alt-yuzde(yy) to yuzde-goster
*       move yuzde-goster  to det-1(sutun(yy):05),
*     end-perform
*     compute son-yuzde = (son-ptoplam * 100) / ( hazir-oda-toplam )
*     move son-yuzde    to yuzde-goster
*     move yuzde-goster to det-1(199:05),
*     move "A"           to det-dokumer-20(3:1)
*     move 241           to det-renk1
*     move "|"           to det-1(205:1)
*     write dokumer-rec from detay

    end-start
*    initialize detay
*    write dokumer-rec from detay
    end-if.
 alt-toplam-al-exit.
    exit.
*
 acc-04-Aft-Procedure.
     open input acenta
     if acn-kod = spaces
        if acn-grup-kod = spaces
           move "Tum Acentalar"   to acenta-adi
        end-if
     else
        move acn-kod    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 12 to control-id
        end-read
        initialize acn-grup-kod
        move "Acenta Filtresi" to grup-adi
        display acc-08 lb-acngrupadi
     end-if
     display lb-acenadi
     close acenta
     .
*
 acc-08-Aft-Procedure.
     open input grup
     if acn-grup-kod = spaces
        if acn-kod = spaces
           move "Tum Gruplar"   to grup-adi
        end-if
     else
        initialize grup-rec
        set grup-acenta to true
        move acn-grup-kod    to grup-kodu
        read grup no lock invalid
             move "Tanimsiz Acenta Grubu..." to grup-adi
             move 4 to accept-control
             move 17 to control-id
        end-read
        initialize acn-kod
        move "Grup Filtresi" to acenta-adi
        display acc-04 lb-acenadi
     end-if
     display lb-acngrupadi
     close grup.
*
 stop-al.
   
     initialize aksiyon-rec stop-durum
*     move rez-acenta          to aksiyon-acenta
     move "S"                 to aksiyon-tipi
     start aksiyon key not < aksiyon-anah invalid 
          continue 
     not invalid
     perform with test after until fs-aksiyon = "10"
     read aksiyon next no lock end move "10" to fs-aksiyon
     not at end  
          if aksiyon-tipi <> "S"
              exit perform 
          end-if 
*          if aksiyon-acenta <> rez-acenta
*              exit perform 
*          end-if 
          if AKSIYON-G-TARIH > takvim-anah or  
             AKSIYON-C-TARIH < takvim-anah 
              exit perform cycle 
          end-if 
      
          evaluate true
          when  aksiyon-pan-tipi = spaces  and  
                AKSIYON-ACENTA = spaces
                move 3 to stop-durum
          when aksiyon-pan-tipi not = spaces and 
               AKSIYON-ACENTA = spaces and 
               aksiyon-pan-tipi = cast-oda-konumu
                move 2 to stop-durum
          when aksiyon-pan-tipi not = spaces and 
               AKSIYON-ACENTA not = spaces and 
               AKSIYON-ACENTA = rez-acenta and
               aksiyon-pan-tipi = cast-oda-konumu
                 move 2 to stop-durum
          when aksiyon-pan-tipi = spaces and 
               AKSIYON-ACENTA not = spaces and 
               AKSIYON-ACENTA = rez-acenta 
                  move 2 to stop-durum
*          when other 
*                stop " "
          end-evaluate
               move stop-durum            to takas8-stop(sayac)
     end-read 
     end-perform
     end-start.

*
 Form1-Ef-1-Aft-Procedure.
      continue.
*
 sutun-ayarla.
     initialize sutun-1
     perform varying sayac from 1 by 1 until sayac > 31x,
        compute sutun(sayac) = ((sayac - 1)  * 7) + 12
     end-perform
     .



 
