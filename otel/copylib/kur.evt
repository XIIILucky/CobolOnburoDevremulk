* kur.evt
* kur.evt is generated from D:\asya\acugt.ytl\otel\kur.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM exception-procedure
     .

 Form1-Sb-1-Event-Proc.
     PERFORM Form1-Sb-1-Ev-Other
     .

 button-0103-Event-Proc.
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 Form2-Cm-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form2-Cm-1-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form2-Cm-2-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form2-Cm-2-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form3-Cm-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form3-Cm-1-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form3-Cm-1a-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form3-Cm-1a-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form3-Cm-1aa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form3-Cm-1aa-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form4-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM Form4-Gd-1-Ev-Msg-Begin-Entry
     END-EVALUATE
     .
***   start event editor code   ***
*
 Form1-Aft-Initdata.
     initialize ara-rec.
     open input kllnc.
     move k-kodu-tasi  to k-kodu
     read kllnc no lock invalid
          continue
     end-read
     if not k-ozl-isl-evet
        modify button-0106, enabled = false
     else
        modify button-0106, enabled = true
     end-if.
     close kllnc
     open input genel
     initialize genel-rec
     move 1  to genel-anahtar
     read genel no lock invalid 
         continue 
     end-read 
     close genel
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 accept-0104-Aft-Procedure.
     if key-status = 52
        move 4 to accept-control
        move 6 to control-id
        exit paragraph
     end-if.

     if key-status > 01 and key-status < 07
        exit paragraph
     end-if.

     open input takvim
     move gun     to takvim-gun
     move ay      to takvim-ay
     move yil     to takvim-yil
     read takvim no lock invalid
          move 4 to accept-control
          move 6 to control-id
          close takvim
          initialize mesaj-link
          move 13 to mesaj-no
          perform mesaj-ver
          exit paragraph
     end-read
     close takvim.

     open input banka.
     move accept-0104-value to banka-kodu
     read banka no lock invalid
          move all "*" to banka-adi
          move 4 to accept-control
          move 8 to control-id
          move banka-adi to form1-ef-1-value
          display form1-ef-1,
          display omitted beep
          close banka 
          exit paragraph
     end-read
     move banka-adi to form1-ef-1-value
     display form1-ef-1
     close banka.
     perform kur-to-ara.
     perform tablo-goster.
     modify button-0101,enabled = true
     modify button-0102,enabled = true.
     modify button-0106,enabled = false.
     modify accept-0101,enabled = false
     modify accept-0102,enabled = false
     modify accept-0103,enabled = false
     modify accept-0104,enabled = false.
     modify f1-pb      ,enabled = false.

 kur-to-ara.
     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     end-read
     add 1 to print-no
     rewrite genelfis-rec end-rewrite
     close genelfis.
     move print-no        to ara-numara.

     open output ara close ara open i-o ara.

     open input doviz kur.
     initialize doviz-rec ara-i ara-ii ara-son-i ara-son-ii
     start doviz key not < doviz-kodu invalid
           close doviz ara kur
           move 4 to accept-control
           move 6 to control-id
           exit paragraph
     not invalid
     move 1 to ara-i
     perform with test after until fs-doviz = "10" 
           read doviz next no lock end move "10" to fs-doviz
           not at end
                add 1 to ara-ii
                move doviz-kodu        to ara-doviz(ara-ii) ara-doviz-adi(ara-ii)
                move "-"               to ara-doviz-adi(ara-ii)(3:)
                move d-adi-1           to ara-doviz-adi(ara-ii)(4:)
*                initialize kur-rec
                move doviz-kodu        to kur-doviz
                move gun               to kur-gun
                move ay                to kur-ay
                move yil               to kur-yil
                move accept-0104-value to kur-banka
                read kur no lock invalid
                     initialize efektif-alis efektif-satis
                     doviz-alis doviz-satis
                end-read
                move doviz-alis        to ara-doviz-alis(ara-ii)
                move doviz-satis       to ara-doviz-satis(ara-ii)
                move efektif-alis      to ara-efektif-alis(ara-ii)
                move efektif-satis     to ara-efektif-satis(ara-ii)
                move 1                 to ara-enabled(ara-ii)
                if ara-ii = 10
                   move ara-i    to ara-anah
                   write ara-rec end-write
                   initialize ara-rec ara-ii
                   add 1 to ara-i
                end-if
           end-read
     end-perform
     end-start
     move ara-i to ara-anah.
     write ara-rec invalid rewrite ara-rec end-rewrite end-write.
     close doviz ara kur.
     move ara-i        to ara-son-i
     move ara-ii       to ara-son-ii.
     move 1 to ara-i.
     if ara-son-i > 1
        modify form1-sb-1,
               enabled = true
               visible = true
               page-size = 100 / ara-son-i
     else
        modify form1-sb-1,
               enabled = false
               visible = false
     end-if.
 tablo-goster.
     open input ara.
     move ara-i to ara-anah.
     read ara no lock invalid
          initialize ara-rec
     end-read
     close ara.
     initialize accept-02-enabled accept-03-enabled accept-04-enabled
                accept-05-enabled accept-06-enabled accept-07-enabled 
                accept-08-enabled accept-09-enabled accept-10-enabled
                accept-11-enabled.

     if ara-enabled(01) = 1 move 1 to accept-02-enabled.
     if ara-enabled(02) = 1 move 1 to accept-03-enabled.
     if ara-enabled(03) = 1 move 1 to accept-04-enabled.
     if ara-enabled(04) = 1 move 1 to accept-05-enabled.
     if ara-enabled(05) = 1 move 1 to accept-06-enabled.
     if ara-enabled(06) = 1 move 1 to accept-07-enabled.
     if ara-enabled(07) = 1 move 1 to accept-08-enabled.
     if ara-enabled(08) = 1 move 1 to accept-09-enabled.
     if ara-enabled(09) = 1 move 1 to accept-10-enabled.
     if ara-enabled(10) = 1 move 1 to accept-11-enabled.
     perform acceptleri-goster.

 acceptleri-goster.
     display
     accept-0201 accept-0202 accept-0203 accept-0204
     accept-0301 accept-0302 accept-0303 accept-0304
     accept-0401 accept-0402 accept-0403 accept-0404
     accept-0501 accept-0502 accept-0503 accept-0504
     accept-0601 accept-0602 accept-0603 accept-0604
     accept-0701 accept-0702 accept-0703 accept-0704
     accept-0801 accept-0802 accept-0803 accept-0804
     accept-0901 accept-0902 accept-0903 accept-0904
     accept-1001 accept-1002 accept-1003 accept-1004
     accept-1101 accept-1102 accept-1103 accept-1104
     label-0201  label-0202  label-0203  label-0204
     label-0205  label-0206  label-0207  label-0208
     label-0209  label-0210.
     .
*
 Form1-Bef-Create.
     perform adresleri-tasi.
*/
     open input genel.
     move 1 to genel-anahtar
     read genel no lock invalid
          initialize mesaj-link
          move 17 to mesaj-no
          perform mesaj-ver
          goback
     end-read
     close genel.

     move yil-tasi   to yil
     move ay-tasi    to ay
     move gun-tasi   to gun
     initialize ara-rec.
*
 exception-procedure.
     evaluate key-status
         when 17 
             move kur-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of kur-rec
             set link-logview-rec-size to size of kur-rec
             perform logview-call
             initialize key-status
         when 1 
              evaluate control-id
                  when 8
                  when 9
                       initialize link-banka
                       call "/asya/ytl/obj/otel/bankaara.asy"
                            using link-banka
                       on exception 
                            perform callerr-proc
                       not on exception 
                       cancel "/asya/ytl/obj/otel/bankaara.asy"
                       end-call
                       if link-banka <> 0
                          move link-banka to accept-0104-value
                          display accept-0104
                       end-if
              end-evaluate
         when 5    
              perform acu-form2-routine
              initialize key-status
         when 2
 
              
              initialize soru-deg
              perform kaydet-soru
              if soru-hayir
                 exit paragraph
              end-if

              if control-id not = 4 or 5 or 8
*/ once ekrandaki bilgiler kayit ediliyor 
              open i-o ara kur
              move ara-i to ara-anah
              rewrite ara-rec end-rewrite
              move 1 to ara-anah
              read ara end-read
              initialize ara-rec
              start ara key not < ara-anah invalid
                    continue
              not invalid
              move zeroes to fs-ara
              perform with test after until fs-ara = "10"
                      read ara next no lock end move "10" to fs-ara
                      not at end
                           perform varying i from 1 by 1 until i > 10
                                   if ara-enabled(i) = 1
                                      move gun                  to kur-gun
                                      move ay                   to kur-ay
                                      move yil                  to kur-yil
                                      move accept-0104-value    to kur-banka
                                      move ara-doviz(i)         to kur-doviz
                                      move ara-efektif-alis(i)  to efektif-alis
                                      move ara-efektif-satis(i) to efektif-satis
                                      move ara-doviz-alis(i)    to doviz-alis
                                      move ara-doviz-satis(i)   to doviz-satis
                                      move k-kodu-tasi          to doviz-staf
                                      rewrite kur-rec invalid
                                              write kur-rec end-write
                                      end-rewrite
                                          perform log-operation-kur
                                   else 
                                      exit perform
                                   end-if
                           end-perform
                      end-read
              end-perform
              end-start
              close ara kur
              delete file ara
              modify accept-0101,enabled = true
              modify accept-0102,enabled = true
              modify accept-0103,enabled = true
              modify accept-0104,enabled = true
              modify f1-pb      ,enabled = true
              move 4 to accept-control
              move 4 to control-id
              exit paragraph
              end-if
         when 3          
              initialize soru-deg
              perform sil-soru
              if soru-hayir
                 exit paragraph
              end-if

              initialize mesaj-link
              move 2 to mesaj-no
              perform mesaj-ver
              if mesaj-hayir
                 exit paragraph
              end-if
              open i-o kur
              initialize kur-rec
              move gun        to kur-gun
              move ay         to kur-ay
              move yil        to kur-yil
              move accept-0104-value to kur-banka
              start kur key not < kur-kodu invalid
                    continue
              not invalid
              initialize fs-kur
              perform with test after until fs-kur = "10"
                    read kur next no lock end move "10" to fs-kur
                    not at end
                         if kur-gun = gun and
                            kur-ay  = ay and
                            kur-yil = yil and
                            accept-0104-value = kur-banka
                            delete kur invalid continue 
                            end-delete
                            perform log-operation-kur
                         else
                            exit perform
                         end-if
                    end-read
              end-perform
              end-start
              close kur
              delete file ara
              modify accept-0101,enabled = true
              modify accept-0102,enabled = true
              modify accept-0103,enabled = true
              modify accept-0104,enabled = true
              modify f1-pb      ,enabled = true
              move 4 to accept-control
              move 4 to control-id
              exit paragraph
         when 4
              perform acu-form3-routine
              initialize key-status
         when 67
              if ara-i > 1
                 open i-o ara
                 rewrite ara-rec invalid continue end-rewrite
                 close ara
                 subtract 1 from ara-i
                 perform tablo-goster
                 modify form1-sb-1,
                        value = ara-i
              end-if
         when 68
              if ara-i < ara-son-i
                 open i-o ara
                 rewrite ara-rec invalid continue end-rewrite
                 close ara
                 add 1 to ara-i
                 perform tablo-goster
                 inquire form1-sb-1,
                         value in sayac
                         page-size in i
                 add i to sayac
                 modify form1-sb-1,
                        value = sayac
              end-if
         when 6
              initialize ara-rec
              modify accept-0101,enabled = true
              modify accept-0102,enabled = true
              modify accept-0103,enabled = true
              modify accept-0104,enabled = true
              modify f1-pb      ,enabled = true
              move 4 to accept-control
              move 4 to control-id
              exit paragraph
         when 7
              if k-ozl-isl-evet
                 perform acu-form4-routine
              end-if
     end-evaluate.
     .
*
 Form1-Sb-1-Ev-Other.
     evaluate event-type
             when msg-sb-next 
                  move 68 to key-status
                  perform exception-procedure
             when msg-sb-prev
                  move 67 to key-status
                  perform exception-procedure
     end-evaluate.
*
 accept-0101-Bef-Procedure.
     initialize accept-02-enabled accept-03-enabled accept-04-enabled
                accept-05-enabled accept-06-enabled accept-07-enabled 
                accept-08-enabled accept-09-enabled accept-10-enabled
                accept-11-enabled.
     initialize ara-rec.
     perform acceptleri-goster.
     modify button-0101,enabled = false
     modify button-0102,enabled = false.
     if k-ozl-isl-evet
        modify button-0106, enabled = true
     else
        modify button-0106,enabled = false
     end-if.
     modify form1-sb-1,visible = false.
     .
*
 Form2-Aft-Initdata.
     move yil-tasi to transfer-yil-from transfer-yil-to
     move ay-tasi  to transfer-ay-from  transfer-ay-to
     move gun-tasi to transfer-gun-from transfer-gun-to
     modify form2-cm-1,
            reset-list  = 1
            mass-update = 1
     modify form2-cm-2,
            reset-list  = 1
            mass-update = 1
     move "-Tum Bankalar"   to form2-cm-1-value
     modify form2-cm-1,item-to-add(form2-cm-1-value)
     open input banka.
     initialize banka-rec i
     start banka key not < banka-kodu invalid
           continue
     not invalid
     perform with test after until fs-banka = "10"
           read banka next no lock end move "10" to fs-banka
           not at end
                add 1 to i
                initialize form2-cm-1-value
                move banka-kodu      to form2-cm-1-value    
                move "-"             to form2-cm-1-value(3:)
                move banka-adi       to form2-cm-1-value(4:)
                modify form2-cm-1,
                       item-to-add(form2-cm-1-value)
                modify form2-cm-2,
                       item-to-add(form2-cm-1-value)
                if i = 1 
                   move banka-kodu      to form2-cm-2-value
                   move "-"             to form2-cm-2-value(3:)
                   move banka-adi       to form2-cm-2-value(4:)
                end-if
           end-read
     end-perform
     end-start
     close banka.
     move "-Tum Bankalar"   to form2-cm-1-value
     modify form2-cm-1,
            value form2-cm-1-value
            mass-update = 0
     modify form2-cm-2,
            value form2-cm-2-value
            mass-update = 0.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form2-Ex-Other.
     if key-status = 1001  or 8
        continue
     else 
        exit paragraph
     end-if.      
     initialize mesaj-link
     move 10 to mesaj-no
     perform mesaj-ver
     if mesaj-hayir
        exit paragraph.

     if transfer-tarih-from = transfer-tarih-to 
        and
        form2-cm-2-value = form2-cm-1-value
              move 4 to accept-control
              move 4 to control-id
              exit paragraph.

     open input takvim.
     move transfer-tarih-from  to takvim-anah
     read takvim no lock invalid
          move 4 to accept-control
          move 4 to control-id
          close takvim
          exit paragraph
     end-read
     move transfer-tarih-to   to takvim-anah
     read takvim no lock invalid
          move 4 to accept-control
          move 13 to control-id
          close takvim
          exit paragraph
     end-read
     close takvim.

     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     end-read
     add 1 to print-no
     rewrite genelfis-rec invalid continue end-rewrite
     close genelfis.
     move print-no to ekur-numara.
        
     open output ekur close ekur open i-o ekur.
     open i-o kur.
     initialize kur-rec
     move transfer-tarih-from  to kur-tarih
     if form2-cm-1-value not = "-Tum Bankalar" 
        move form2-cm-1-value(1:2) to kur-banka 
     end-if
     start kur key not < kur-kodu invalid
           initialize mesaj-link
           move 7 to mesaj-no
           perform mesaj-ver
     not invalid
     initialize fs-kur
     perform with test after until fs-kur = "10"
           read kur next no lock end move "10" to fs-kur
           not at end
                if kur-tarih = transfer-tarih-from
                   if (form2-cm-1-value = "-Tum Bankalar")
                      or
                      (form2-cm-1-value not = "-Tum Bankalar"
                                 and
                      Form2-Cm-2-Value(1:2) = kur-banka)
                      initialize ekur-rec
                      move kur-banka     to ekur-banka
                      move kur-doviz     to ekur-doviz
                      move doviz-alis    to ekur-doviz-alis
                      move doviz-satis   to ekur-doviz-satis
                      move efektif-alis  to ekur-efektif-alis
                      move efektif-satis to ekur-efektif-satis
                      write ekur-rec invalid
                            stop " "
                      end-write
                   end-if
                else
                   exit perform
                end-if
           end-read
     end-perform
 
      if key-status = 8
          open input takvim
          move transfer-tarih-to   to takvim-anah
          start takvim key > takvim-anah
            invalid continue
            not invalid
            perform until fs-takvim = "10"
            read takvim next no lock 
              end move "10" to fs-takvim
              not end
                move takvim-anah to transfer-tarih-to 
                display takvim-anah
                perform kur-at

            end-read
          end-perform
          end-start
          close takvim
         else
           perform kur-at
      end-if

     
     initialize mesaj-link
     move 8 to mesaj-no
     perform mesaj-ver
     move 27 to key-status
     
     end-start.

     close ekur kur.
     delete file ekur.
     .
*
 kur-at.
      initialize ekur-rec fs-kur
     start ekur key not < ekur-anah invalid
           initialize mesaj-link
           move 7 to mesaj-no
           perform mesaj-ver
     not invalid
     perform with test after until fs-ekur = "10"
           read ekur next no lock end move "10" to fs-ekur
           not at end
                initialize kur-rec
                move transfer-gun-to    to kur-gun
                move transfer-ay-to     to kur-ay
                move transfer-yil-to    to kur-yil
                move ekur-doviz         to kur-doviz
                |if form2-cm-1-value  = "-Tum Bankalar"
                   move ekur-banka      to kur-banka
                |else 
                |   move to-banka        to kur-banka
                |end-if
                move ekur-doviz-alis    to doviz-alis
                move ekur-doviz-satis   to doviz-satis
                move ekur-efektif-alis  to efektif-alis
                move ekur-efektif-satis to efektif-satis
                write kur-rec invalid
                    if key-status not = 8
                      rewrite kur-rec end-rewrite
                    end-if
                end-write
                    perform log-operation-kur
           end-read
     end-perform
     end-start .
*
 Form2-Cm-1-Ex-Ntf-Selchange.
     move form2-cm-1-value to from-banka.
     if form2-cm-1-value = "-Tum Bankalar"
        modify form2-cm-2,
               enabled = false
     else 
        modify form2-cm-2,
               enabled = true
     end-if.
     
     
     .
*
 Form2-Cm-2-Ex-Ntf-Selchange.
     move form2-cm-2-value to to-banka.
*
 form2-bef-procedure.
     initialize mesaj.
     evaluate control-id
          when 1 continue
     end-evaluate.
     modify form3-st-1-handle,
            panel-index = 1
            panel-text = mesaj.
     
     .
*
 Form3-Aft-Initdata.
     modify form3-cm-1,
            reset-list = 1
            mass-update = 1
     modify form3-cm-1a,
            reset-list = 1
            mass-update = 1
     modify form3-cm-1aa,
            reset-list = 1
            mass-update = 1.
     
     open input banka doviz.
     initialize banka-rec doviz-rec fs-doviz fs-banka
     start banka key not < banka-kodu invalid
           continue
     not invalid
     initialize i 
     perform with test after until fs-banka = "10"
           read banka next no lock end move "10" to fs-banka
           not at end
                add 1 to i
                if i = 1 
                   move banka-kodu to rapor-banka
                end-if
                initialize form3-cm-1a-value
                move banka-kodu      to form3-cm-1a-value
                move "-"             to form3-cm-1a-value(3:)
                move banka-adi       to form3-cm-1a-value(4:)
                modify form3-cm-1a,
                       item-to-add(form3-cm-1a-value)
           end-read
     end-perform
     end-start
     start doviz key not < doviz-kodu invalid 
           continue
     not invalid
     initialize i 
     perform with test after until fs-doviz = "10"
           read doviz next no lock end move "10" to fs-doviz
           not at end
                add 1 to i
                if i = 1
                   move doviz-kodu to rapor-doviz
                end-if
                move doviz-kodu      to form3-cm-1aa-value
                move "-"             to form3-cm-1aa-value(3:)
                move d-adi-1         to form3-cm-1aa-value(4:)
                modify form3-cm-1aa,
                       item-to-add(form3-cm-1aa-value)
           end-read
     end-perform
     end-start
     close banka doviz.

     move "1-Ortalama Kur Raporu"   to form3-cm-1-value
     modify form3-cm-1,item-to-add(form3-cm-1-value)
     move "2-Kur Detay Raporu   "   to form3-cm-1-value
     modify form3-cm-1,item-to-add(form3-cm-1-value)
     move rapor-banka               to form3-cm-1a-value
     move rapor-doviz               to form3-cm-1aa-value

     modify form3-cm-1,
            mass-update = 0.
     modify form3-cm-1a,
            mass-update = 0.
     modify form3-cm-1aa,
            mass-update = 0.
     move "1-Ortalama Kur Raporu"   to form3-cm-1-value
     modify form3-cm-1,value = form3-cm-1-value

     move gun-tasi          to rap-bas-gun rap-bit-gun
     move  ay-tasi          to rap-bas-ay  rap-bit-ay
     move yil-tasi          to rap-bas-yil rap-bit-yil.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form3-Cm-1a-Ex-Ntf-Selchange.
     move form3-cm-1a-value(1:2)  to rapor-banka.
     
     .
*
 Form3-Cm-1aa-Ex-Ntf-Selchange.
     move form3-cm-1aa-value(1:2)  to rapor-doviz.
     
     .
*
 Form3-Ex-Other.
     if key-status = 2001 
        continue
     else 
        exit paragraph
     end-if.

     if rap-bas-tarih > rap-bit-tarih
        move 4 to accept-control
        move 7 to control-id
        initialize mesaj-link
        move 14 to mesaj-no
        perform mesaj-ver
        exit paragraph
     end-if.

     open input takvim.
     move rap-bas-tarih  to takvim-anah
     read takvim no lock invalid
          move 4 to accept-control
          move 7 to control-id
          initialize mesaj-link
          move 13 to mesaj-no
          perform mesaj-ver
          close takvim
          exit paragraph
     end-read

     move rap-bit-tarih  to takvim-anah
     read takvim no lock invalid
          move 4  to accept-control
          move 11 to control-id
          close takvim
          initialize mesaj-link
          move 13 to mesaj-no
          perform mesaj-ver
          exit paragraph
     end-read
     close takvim.

     open i-o genelfis.
     move 1 to genelfis-anahtar.
     read genelfis no lock invalid
          accept print-no from time
     end-read
     add 1 to print-no
     rewrite genelfis-rec invalid continue end-rewrite
     close genelfis.
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
     move form3-cm-1-value(1:1) to rapor-tipi

*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     if rapor-tipi = 1
        move "Tarihleri Arasi Ortalama Kur Raporu" to det-filler
     else
        move "Tarihleri Arasi Kur Detay Raporu" to det-filler
     end-if
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:)
     if rapor-tipi = 1
        move "Tarihleri Arasi Ortalama Kur Raporu" to bas1-7
     else
        move "Tarihleri Arasi Kur Detay Raporu" to bas1-7
     end-if
     move rap-bas-gun    to bas1-1
     move rap-bas-ay     to bas1-2
     move rap-bas-yil    to bas1-3
     move rap-bit-gun    to bas1-4
     move rap-bit-ay     to bas1-5
     move rap-bit-yil    to bas1-6
     move baslik1        to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move form3-cm-1a-value  to bas2-1
     if rapor-tipi = 1 
        move form3-cm-1aa-value to bas2-2
     else
        move spaces             to bas2-2
     end-if
     move baslik2            to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O"                        to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLLLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
     if rapor-tipi = 1
        move "LRRRRRRRRRR" to dokumer-align-occ
     else 
        move "LLRRRRRRRRRRR" to dokumer-align-occ
     end-if
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR 
     initialize dokumer-rec detay ortalama-degiskenler
     move "D1"               to det-dokumer-20(1:)     
     move "Tarih"          to det-1
     if rapor-tipi = 1
        move "Doviz Alis"     to det-2
        move "Doviz Satis"    to det-3
        move "Efektif Alis"   to det-4
        move "Efektif Satis"  to det-5
        initialize det-6
        move "|" to fil-1 fil-2 fil-3 fil-4 fil-5
     else
        move "Doviz Kodu/Adi" to det-2
        move "Doviz Alis"     to det-3
        move "Doviz Satis"    to det-4
        move "Efektif Alis"   to det-5
        move "Efektif Satis"  to det-6
        move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
     end-if
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:)
     move "-"            to det-dokumer-20(5:1)
     if rapor-tipi = 1
        move all "-"  to det-1 det-2 det-3 det-4 det-5
     else
        move all "-"  to det-1 det-2 det-3 det-4 det-5 det-6
     end-if
     write dokumer-rec from detay


     open input kur doviz
     initialize kur-rec
     move rap-bas-gun        to kur-gun
     move rap-bas-ay         to kur-ay
     move rap-bas-yil        to kur-yil
     start kur key not < kur-kodu invalid
           continue
     not invalid
     initialize fs-kur yedek-tarih
     perform with test after until fs-kur = "10"
           read kur next no lock end move "10" to fs-kur
           not at end
                if kur-tarih > rap-bit-tarih 
                   exit perform
                end-if
                move 1 to islem
                if form3-cb-1-value = 1 
                   if doviz-alis = zeroes and doviz-satis = zeroes 
                      and efektif-alis = zeroes and efektif-satis = zeroes
                          move 0 to islem
                   end-if
                end-if
                if rapor-tipi = 1 
                   if rapor-banka = kur-banka and
                      rapor-doviz = kur-doviz 
                            move 1 to islem
                   else
                            move 0 to islem
                   end-if
                else
                   if rapor-banka not = kur-banka
                      move 0 to islem
                   end-if
                end-if
                if islem = 1 
                evaluate rapor-tipi
                 when 1
                   initialize detay dokumer-rec
                   move kur-gun        to egun
                   move kur-ay         to eay
                   move kur-yil        to eyil
                   move etarih         to det-1
                   move "A"            to det-dokumer-20(3:1)
                   move doviz-alis     to z-15
                   move z-15           to det-2
                   move doviz-satis    to z-15
                   move z-15           to det-3
                   move efektif-alis   to z-15
                   move z-15           to det-4
                   move efektif-satis  to z-15
                   move z-15           to det-5
                   add doviz-alis      to ortalama-doviz-alis
                   add doviz-satis     to ortalama-doviz-satis
                   add efektif-alis    to ortalama-efektif-alis
                   add efektif-satis   to ortalama-efektif-satis
                   add 1 to dokumer-anah gun-sayi
                   write dokumer-rec from detay
                 when 2
                   initialize detay dokumer-rec
                   if kur-tarih not = yedek-tarih
                      move kur-gun     to egun
                      move kur-ay      to eay
                      move kur-yil     to eyil
                      move kur-tarih   to yedek-tarih
                      move etarih      to det-1
                      move 291         to det-renk1
                      move "A"         to det-dokumer-20(3:1)
                      move "_"         to det-dokumer-20(7:1)
                      move "1"         to det-dokumer-20(10:1)
                      write dokumer-rec from detay
                      initialize detay
                  end-if
                  move "C"            to det-dokumer-20(3:1)
                  move kur-doviz      to det-2 doviz-kodu
                  read doviz no lock invalid
                       move all "*" to d-adi-1
                  end-read
                  move "-"            to det-2(3:)
                  move d-adi-1        to det-2(4:)
                  move doviz-alis     to z-15
                  move z-15           to det-3
                  move doviz-satis    to z-15
                  move z-15           to det-4
                  move efektif-alis   to z-15
                  move z-15           to det-5
                  move efektif-satis  to z-15
                  move z-15           to det-6
                  move 144            to det-renk2
                  write dokumer-rec from detay
               end-if
          end-read
    end-perform
    if rapor-tipi = 1
       initialize dokumer-rec detay
       move "-"            to det-dokumer-20(5:1)
       move all "-"  to det-1 det-2 det-3 det-4 det-5
       write dokumer-rec from detay
       initialize detay dokumer-rec
       move "A"          to det-dokumer-20(3:1)
       move 481          to det-6 det-renk1
       move "1"          to det-dokumer-20(10:1)
       move "Ortalama"   to det-1
       compute ortalama-doviz-alis     = ortalama-doviz-alis    /  gun-sayi
       move ortalama-doviz-alis    to z-15
       move z-15                   to det-2
       compute ortalama-doviz-satis    = ortalama-doviz-satis   /  gun-sayi
       move ortalama-doviz-satis   to z-15
       move z-15                   to det-3
       compute ortalama-efektif-alis   = ortalama-efektif-alis  /  gun-sayi
       move ortalama-efektif-alis  to z-15
       move z-15                   to det-4
       compute ortalama-efektif-satis  = ortalama-efektif-satis /  gun-sayi
       move ortalama-efektif-satis to z-15
       move z-15                   to det-5 
       write dokumer-rec from detay
       initialize dokumer-rec detay
       move "-"            to det-dokumer-20(5:1)
       move all "-"  to det-1 det-2 det-3 det-4 det-5
       write dokumer-rec from detay
    end-if
    end-start.

    close dokumer
    call dokumer-prog on exception
         perform callerr-proc
    not on exception
         cancel dokumer-prog
    end-call
    close kur doviz
    delete file dokumer.
    move 27 to key-status.
*
 Form3-Cm-1-Ex-Ntf-Selchange.
     inquire form3-cm-1, value in form3-cm-1-value
     move form3-cm-1-value(1:1) to rapor-tipi.
     if rapor-tipi = 1
        modify form3-cm-1a, enabled = true
        modify form3-cm-1aa,enabled = true
     else
        modify form3-cm-1a,enabled = true
        modify form3-cm-1aa,enabled = false
     end-if.
*
*
 Form3-Bef-Create.
     move yil-tasi   to rap-bas-yil rap-bit-yil
     move ay-tasi    to rap-bas-ay  rap-bit-ay
     move gun-tasi   to rap-bas-gun rap-bit-gun.

     
     .
*
 Form4-Bef-Create.
     move tarih-tasi    to sirket-transfer-tarih.
     
     .
*
 Form3-Ef-1ca-Aft-Procedure.
     initialize gec-gecme.
     open input banka
     move sirket-transfer-banka    to banka-kodu
     read banka no lock invalid
          move "Tanimsiz ..."  to banka-adi
          move 1 to gec-gecme
     end-read
     close banka.
     display form4-acc-banka-adi.
     
     .
*
 Form4-Ex-Other.
     evaluate key-status
     when 1
          if control-id = 6 or
             control-id = 11
              initialize link-banka
              call "/asya/ytl/obj/otel/bankaara.asy"
                   using link-banka
              on exception 
                   perform callerr-proc
              not on exception 
              cancel "/asya/ytl/obj/otel/bankaara.asy"
              end-call
              if link-banka <> 0
                 move link-banka to sirket-transfer-banka
                 display form4-acc-banka
              end-if
          end-if
     when 2
          perform islem
     end-evaluate.
*
 islem.
     perform Form3-Ef-1aab-Aft-Procedure.
     if gec-gecme = 1
        move 4 to accept-control
        move 7 to control-id
        exit paragraph.

     perform Form3-Ef-1ca-Aft-Procedure.
     if gec-gecme = 1
        move 4 to accept-control
        move 11 to control-id
        exit paragraph.

     inquire form4-gd-1,
             last-row in form4-ii

     if form4-ii = 1
        exit paragraph.

     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     end-read
     add 1 to print-no
     rewrite genelfis-rec invalid continue end-rewrite
     close genelfis.
     move print-no to ekur-numara.

     open output ekur close ekur open i-o ekur.
     open input kur.
     initialize kur-rec
     move sirket-transfer-tarih  to kur-tarih

     start kur key not < kur-kodu invalid
           initialize mesaj-link
           move 7 to mesaj-no
           perform mesaj-ver
           close kur ekur
           delete file ekur
           exit paragraph

     not invalid
     initialize fs-kur
     perform with test after until fs-kur = "10"
           read kur next no lock end move "10" to fs-kur
           not at end
                if kur-tarih = sirket-transfer-tarih and 
                   kur-banka = sirket-transfer-banka

                      initialize ekur-rec
                      move kur-banka to ekur-banka
                      move kur-doviz to ekur-doviz
                      move doviz-alis to ekur-doviz-alis
                      move doviz-satis to ekur-doviz-satis
                      move efektif-alis to ekur-efektif-alis
                      move efektif-satis to ekur-efektif-satis
                      write ekur-rec invalid
                            stop " "
                      end-write
                else
                   exit perform
                end-if
           end-read
     end-perform
     end-start
     close kur

     perform varying form4-i
             from 2
             by 1
             until form4-i > form4-ii

     initialize form4-eh
     inquire form4-gd-1(form4-i,1)
             hidden-data in form4-eh

     if form4-eh <> "E"
        exit perform cycle
     end-if
        
     inquire form4-gd-1(form4-i,4)
             cell-data in kur-dosya-adres
     open i-o kur
     initialize ekur-rec fs-kur
     start ekur key not < ekur-anah invalid
           initialize mesaj-link
           move 7 to mesaj-no
           perform mesaj-ver
           close kur
           exit perform
     not invalid
     perform with test after until fs-ekur = "10"
           read ekur next no lock end move "10" to fs-ekur
           not at end
                initialize kur-rec
                move sirket-transfer-tarih to kur-tarih
                move sirket-transfer-banka to kur-banka
                move ekur-doviz            to kur-doviz
                move ekur-doviz-alis       to doviz-alis
                move ekur-doviz-satis      to doviz-satis
                move ekur-efektif-alis     to efektif-alis
                move ekur-efektif-satis    to efektif-satis
                move k-kodu-tasi           to doviz-staf
                write kur-rec invalid
                      rewrite kur-rec end-rewrite
                end-write
           end-read
     end-perform
     end-start
     close kur
     end-perform.

     if mesaj-no <> 7
        initialize mesaj-link
        move 8 to mesaj-no
        perform mesaj-ver
        move 27 to key-status
     end-if.

     close ekur.
     delete file ekur.
     move isyeri-adres-tasi to kur-dosya-adres.
     
     .
*
 Form3-Ef-1aab-Aft-Procedure.
     initialize gec-gecme.
     open input takvim.
     move sirket-transfer-tarih   to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.
     if sirket-transfer-tarih <> calisma-tarihi
        move 1 to gec-gecme
        display message box
                "Onburo calisma tarihinden farkli tarih girilemez !!!"
                icon mb_Warning_icon
                title "Bilginize"
     end-if.
     
     .
*
 Form4-Aft-Initdata.
     modify Form4-Gd-1, 
            reset-grid = 1
            mass-update = 1
     move "X"    to gd-1-col-1
     move "No"   to gd-1-col-2
     move "Sirket Adi" to gd-1-col-3
     move "Kutuphane" to gd-1-col-4
     modify Form4-gd-1,
            record-to-add(Form4-gd-1-record)
     open input isyeri prosif
     initialize isyeri-rec 
     move 1 to form4-kayit
     start isyeri key not < isyeri-no invalid
           continue
     not invalid
     initialize fs-isyeri
     perform with test after until fs-isyeri = "10"
     read isyeri next no lock end move "10" to fs-isyeri
     not at end
          if isyeri-sakli <> "S"
             if isyeri-adres = isyeri-adres-tasi
                exit perform cycle
             end-if
             move k-kodu-tasi    to prosif-kim
             move "S"            to prosif-tipi
             move isyeri-no      to prosif-cob
             read prosif no lock invalid
                  continue
             not invalid
                  if prosif-giris = "H"
                     exit perform cycle
                  end-if
             end-read
             add 1 to form4-kayit
             initialize form4-gd-1-record
             move isyeri-no      to gd-1-col-2
             move isyeri-unvan   to gd-1-col-3
             move isyeri-adres   to gd-1-col-4
             modify form4-gd-1,
                    record-to-add(form4-gd-1-record)
             
             modify form4-gd-1,
                    y = form4-kayit
                    x = 1
                    bitmap = check-bmp,
                    bitmap-number = 2
                    bitmap-width = 16
                    hidden-data = "E"
          end-if
     end-read
     end-perform
     end-start.
     close isyeri prosif.
     modify form4-gd-1,
            mass-update = 0.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form4-Gd-1-Ev-Msg-Begin-Entry.
     move event-action-fail to event-action.
     inquire form4-gd-1,
             cursor-y in form4-i
     perform form4-check.
*
 form4-check.
     inquire form4-gd-1(form4-i,1),
             hidden-data in form4-eh
     if form4-eh = "E"
        move "H" to form4-eh
        move 1 to form4-bmp-no
     else
        move "E" to form4-eh
        move 2 to form4-bmp-no
     end-if.
     modify form4-gd-1(form4-i),
            x = 1
            hidden-data = form4-eh
            bitmap = check-bmp
            bitmap-number = form4-bmp-no
            bitmap-width = 16.
*
 Form1-Pb-1-Link.
         stop " "
      open input takvim
      open i-o kur
          move 20200100   to takvim-anah
          start takvim key > takvim-anah
            invalid continue
            not invalid
            perform until fs-takvim = "10"
            read takvim next no lock 
              end move "10" to fs-takvim
              not end

                if takvim-anah > 20201231
                      exit perform 
                end-if

 
                initialize kur-rec
                move TAKVIM-ANAH to KUR-TARIH
                move 01          to kur-banka
                move 02          to kur-doviz  
                move 6.90        to doviz-alis
                write kur-rec invalid
                     rewrite kur-rec end-rewrite
                end-write

                initialize kur-rec
                move TAKVIM-ANAH to KUR-TARIH
                move 01          to kur-banka
                move 01          to kur-doviz  
                move 1           to doviz-alis
                write kur-rec invalid
                     rewrite kur-rec end-rewrite
                end-write
                    ||perform log-operation-kur
            end-read
          end-perform
          end-start
       close takvim kur.

 
