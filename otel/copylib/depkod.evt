* depkod.evt
* depkod.evt is generated from D:\asya\acugt.ytl\otel\depkod.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 combo-0101-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM combo-0101-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 combo-0102-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM combo-0102-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 combo-0103-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM combo-0103-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 combo-0104-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Combo-0104-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 cb-0101-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM cb-0101-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Lb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Dblclick
           PERFORM Listbox-Eventlar
        WHEN Cmd-Goto
           PERFORM Listbox-Eventlar
        WHEN Ntf-Selchange
           PERFORM Listbox-Eventlar
        END-EVALUATE
     END-IF
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     call "c$narg" using link-var.
     perform adresleri-tasi.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read
     close genel.
     move muha-sirketi to hesap-dosya-adres.
     perform acuserve-adres-aktar
     
      .
*
 accept-0101-Bef-Procedure.
     if link-var = 1 
        exit paragraph 
     end-if 
     initialize depkod-rec depkod2-rec.
     move 1 to combo-0101-value combo-0102-value 
               combo-0103-value combo-0104-value cb-0101-value.
     move 0 to cb-0101-value cb-0102-value cb-0103-value
     display accept-0102,accept-0103,accept-0104,accept-0105,
             accept-0105A, accept-0106, accept-0107  accept-0107b  accept-0107aaa
             accept-0106a,accept-0107a, accept-0107aa,combo-0101,combo-0102,
             combo-0103,combo-0104,cb-0101,cb-0102,cb-0103 cb-0105,  cb-0102a cb-0102aa accept-0106aa, accept-0105Aa,
             lb-ref anadepa accept-dov-kod cb-0106 cb-0106aa cb-0106aaa cb-0106aab cb-0106aav  accept-0103a merdep.                                          

     modify button-0101,enabled = false
    
     perform bef-procedure.
*
 accept-0101-Aft-Procedure.
      if link-var not = 1
       if depkod-kodu = zeroes 
          modify button-0101,enabled = false         
       else 
          modify button-0101,enabled = true
          modify button-0102,enabled = true
       end-if
     end-if
     perform aft-oku.

*
 aft-oku.
     initialize depkod2-rec depkod2-okunamadi
     open input depkod depkod2.
     move depkod-anah to depkod2-anah
     read depkod no lock invalid
          if link-var not = 1
          initialize depkod-rec depkod2-rec
          inquire accept-0101,value in depkod-kodu
          move  depkod-kodu to depkod2-kodu

          move "B" to depkod-ba
          move 1   to depkod-tipi depkod-turu
          modify combo-0101,enabled = true
          modify combo-0103,enabled = true

          read depkod2 no lock invalid 
            continue 
          end-read          
          end-if
          if link-var = 1 
             modify button-0101,enabled = true
             move 1 to depkod2-okunamadi
          end-if 
     not invalid
     continue
*          modify combo-0101,enabled = false
*          modify combo-0103,enabled = false
     end-read 
       
       read depkod2 no lock invalid 
            continue
       end-read
       
      

     close depkod depkod2.
     if depkod2-alt-kate = spaces
         if depkod-ba = "B" then 
             move "01" to depkod2-alt-kate
             else

             move "06" to  depkod2-alt-kate
         end-if
     end-if
     if depkod2-ana = spaces then
        move depkod-anah to depkod2-ana
     end-if
     if depkod2-sira = spaces or zeroes then
        move depkod-anah to depkod2-sira
     end-if
     move depkod-ba          to combo-0101-value
     move depkod-turu        to combo-0102-value
     move depkod-tipi        to combo-0103-value
     move depkod-matrah-ba   to combo-0104-value
     if depkod-makbuz = "E"
        move 1 to cb-0101-value
     else 
        move 0 to cb-0101-value
     end-if.
     if depkod-mahsup-detay = "E"
        move 1 to cb-0102-value
     else 
        move 0 to cb-0102-value
     end-if.
     if depkod-fatura-takip = "E"
        move 1 to cb-0103-value
     else 
        move 0 to cb-0103-value
     end-if.
     
     perform combo-0101-Ex-Ntf-Selchange
     if depkod2-okunamadi not = 1 
        display anadepa anadep merdep sira accept-dov-kod accept-0106a katego accept-0105a accept-0107a accept-0107aa accept-0105aa accept-0106aa cb-0102a accept-0107aaa
     end-if 
     display accept-0102,accept-0103,accept-0104,accept-0105,accept-0106,
             accept-0107 , accept-0107b merdep   accept-0107aaa                         
               
             combo-0101,combo-0102,combo-0103,combo-0104,
             cb-0101 cb-0102 cb-0103 cb-0105   cb-0106 cb-0106a cb-0106aa cb-0106aaa  cb-0106aab cb-0106aav cb-0102aa
                lb-ref accept-0103a.
     perform label-doldur
     perform listbox-yer-bul.
     if i > zeroes
        modify form1-lb-1,
               selection-index = i
     end-if.
*
 doviz-oku.
     open input doviz
     initialize doviz-rec
     move depkod2-dov-kod of depkod2-rec to DOVIZ-KODU
     read doviz no lock invalid 
         continue 
     end-read 
         move d-kisa-adi       to dov-adi
     close doviz
     display lb-dov-adi
     .

*
 exception-procedure.
     
     evaluate key-status
         when 4756
               if combo-0101-value(1:1) = "B" and depkod-kodu  > 0 and depkod-kodu not = spaces 
                initialize lnk-ic-depkod-anah
                move depkod-kodu of depkod to lnk-ic-depkod-anah
                call "/asya/ytl/obj/otel/depkod.asy" using lnk-ic-depkod-anah
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/depkod.asy"
                end-if

         when 17 
             move depkod-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of depkod-rec
             set link-logview-rec-size to size of depkod-rec
             perform logview-call
             initialize key-status

         when 1  
            evaluate control-id
               when 81
                call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/dovizara.asy"
                         if doviz-cagir <> zeroes or 
                            doviz-cagir <> spaces
                            move doviz-cagir  to depkod2-dov-kod of depkod2
                                 display accept-dov-kod

                             perform doviz-oku
                         end-if
                         
                         move 4 to accept-control
                         move 81 to control-id                  
               when 5
                 initialize depkod-cagir
                 call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                    on exception perform callerr-proc
                       not on exception
                       cancel "/asya/ytl/obj/otel/depara.asy" 
                  end-call
                          move depkod-dep-kodu to depkod-kodu
               display accept-0101
               move 4 to accept-control
               move 5 to control-id
             when 28
                 initialize hesapara-link
                 move MUHA-SIRKETI  to hesapara-isyeri
                move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod-matrah-hesap
                        display accept-0105
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call

              when 29
                   initialize hesapara-link
                 move MUHA-SIRKETI  to hesapara-isyeri
                 move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod-kdv-hesap
                        display accept-0106
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call
              when 36
                   initialize hesapara-link
                 move MUHA-SIRKETI  to hesapara-isyeri
                  move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod-toplam-hesap
                        display accept-0107
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call

               when 46
                 initialize hesapara-link
                 move MUHA-SIRKETI  to hesapara-isyeri
                  move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod2-matrah-hesap
                        display accept-0105a
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call

              when 48
                   initialize hesapara-link
                   move MUHA-SIRKETI  to hesapara-isyeri
                    move genel-muha-uzak-ip to hesapara-ip-no
                   call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                          on exception 
                               perform callerr-proc
                         not on exception
                         if hesapara-hesap <> spaces 
                             move hesapara-hesap  to depkod2-kdv-hesap
                            display accept-0106a
                         end-if
                       cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call
              when 50
                   initialize hesapara-link
                 move MUHA-SIRKETI  to hesapara-isyeri
                 move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod2-toplam-hesap
                        display accept-0107a
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call

                when 72
                   initialize hesapara-link
                 move MUHA-SIRKETI  to hesapara-isyeri
                 move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod2-kasa-hesap
                        display accept-0107aa
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call
                   when 69
                 initialize hesapara-link
                 move genel-karsi-muha  to hesapara-isyeri
                  move genel-muha-uzak-ip to hesapara-ip-no
                 call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to depkod2k-matrah-hesap
                        display accept-0105aa
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call

              when 73
                   initialize hesapara-link
                   move genel-karsi-muha  to hesapara-isyeri
                    move genel-muha-uzak-ip to hesapara-ip-no
                   call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                          on exception 
                               perform callerr-proc
                         not on exception
                         if hesapara-hesap <> spaces 
                             move hesapara-hesap  to depkod2k-kdv-hesap
                            display accept-0106aa
                         end-if
                       cancel "/asya/ytl/obj/otel/hesapara.asy"
                 end-call




             end-evaluate

        when 2 
             if depkod-adi = spaces
                display omitted beep
                move 4 to accept-control
                move 8 to control-id
                exit paragraph
             end-if
             if depkod-kodu = spaces
                display omitted beep
                move 4 to accept-control
                move 5 to control-id
                exit paragraph
             end-if

             open i-o depkod depkod2 
             if cb-0102-value=1 then 
                move "E" to depkod-mahsup-detay
             else
                move "H" to depkod-mahsup-detay
             end-if

             if cb-0103-value=1 then 
                move "E" to depkod-fatura-takip
             else
                move "H" to depkod-fatura-takip
             end-if

             move k-kodu-tasi to depkod-staf
             
             if depkod2-merkez-kodu > 0 
                perform merkez-kodlama-kontrol               |firat 23/09/2020 merkod data kontrol için konuldu.
             end-if

             write depkod-rec invalid 
                   rewrite depkod-rec 
                   end-rewrite 
             end-write
              perform log-operation-depkod
             move depkod-kodu to depkod2-kodu
             if combo-0101-value(1:1) = "B"
                initialize depkod2-max-tut
             end-if 
             write depkod2-rec invalid 
                     rewrite depkod2-rec 
             end-write
             
             close depkod depkod2 
             perform listbox-yer-bul
             if i > zeroes
                  initialize form1-lb-1-value
                  modify form1-lb-1,
                         item-to-delete(i)
                  move depkod-kodu   to lb-1-col-1
                  move depkod-adi    to lb-1-col-2
                  modify form1-lb-1,
                         item-to-add(form1-lb-1-value)
             else
                initialize form1-lb-1-value
                move depkod-kodu to lb-1-col-1
                move depkod-adi  to lb-1-col-2
                modify form1-lb-1,
                       item-to-add(form1-lb-1-value)
             end-if
             move 4 to accept-control
             move 5 to control-id
        when 3
             initialize mesaj-degiskenler
             move " [ Sil Soru ] " to mmesaj-title
             move " Bu Kayit Silinecektir ............  " to mmesaj-1
             move " Emin Misiniz.....E->Evet, H->Hayir  " to mmesaj-2 
             move 2           to mmesaj-type
             move 1           to mmesaj-icon
             move 2           to mmesaj-default
             perform mmesaj-ver
             if donus-kodu = 2 
                move 4 to accept-control
                move 5 to control-id
                exit paragraph
             end-if
             perform sil-kontrol thru sil-kontrol-ex
             if evet-hayir = "H" 
                initialize mesaj-degiskenler
                move " [ UYARI ] " to mmesaj-title
                move " Bu Departman Hareket Gormus ......  " to mmesaj-1
                move " SILEMEZSINIZ......................  " to mmesaj-2 
                move 1           to mmesaj-type
                move 1           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                if k-kodu-tasi = "ASYA" and (depkod-anah = "888" or  depkod-anah = "999" )
                  continue
                  else
                                move 4 to accept-control
                                move 5 to control-id
                                exit paragraph
                end-if
             end-if 

             open i-o depkod  depkod2
             delete depkod invalid continue 
             not invalid 
             perform log-operation-depkod
             delete depkod2 invalid continue end-delete
             end-delete
             
             close depkod depkod2
             perform listbox-yer-bul
             if i > zeroes
                modify form1-lb-1,
                       item-to-delete(i)
             end-if
             move 4 to accept-control
             move 5 to control-id
        when 4
             open input depkod depkod2
             initialize depkod-rec
             start depkod key not < depkod-kodu invalid
                   initialize mesaj-link
                   move 04 to mesaj-no
                   perform mesaj-ver
                   close depkod depkod2
                   exit paragraph
             end-start
              
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Departman Kodlari Raporu " to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     move "Departman Kodlari Raporu " to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLRRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  s
     initialize dokumer-rec detay
     move "D1"         to det-dokumer-20(1:2)
     move "1"          to det-dokumer-20(10:1)
     move "Kodu"           to det-1
     move "Adi"            to det-2
     move "Calisma Sekli"  to det-3
     move "Kdv"            to det-4
     move "S.O."           to det-5
     move "Dep.Ozelligi"   to det-6
     move "Dep.Tipi"       to det-7
     move "Makbuz"         to det-8
     move "Matrah Hesap K" to det-9
     move "Kdv Hesap Kodu" to det-10
     move "Toplam Hesap K" to det-11
     move "BA.Matrah"      to det-12
     move "Matrah Hesap K" to det-19
     move "Kdv Hesap Kodu" to det-20
     move "Toplam Hesap K" to det-21
     move "Kategori"       to det-22
     move "Karsi Matrah"   to det-23
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9 fil-10 fil-11 fil-12  
                 fil-19 fil-20 fil-21 fil-22 fil-23
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-"  to det-1 det-2 det-3 det-4 det-5 det-6 det-7 det-8 
                      det-9 det-10 det-11 det-12  det-19 det-20 det-21 det-22 
                      det-19 det-20 det-21 det-22 det-23
     write dokumer-rec from detay
**************************

              initialize fs-depkod
              perform with test after until fs-depkod = "10"
                    read depkod next no lock end move "10" to fs-depkod
                    not at end
                    move depkod-anah to depkod2-anah
                    read depkod2 no lock invalid
                       continue
                      end-read

                         initialize detay
                         move depkod-kodu      to det-1
                         move depkod-adi       to det-2
                         evaluate depkod-ba
                             when "B" move "Borc"       to det-3
                                  evaluate true
                                    when turkce 
                                      evaluate depkod-turu
                                          when 1 move "Genel"        to det-6
                                          when 2 move "Correction"   to det-6
                                          when 3 move "Guest Refund" to det-6
                                          when 4 move "Paid Out"     to det-6
                                          when 5 move "Diger"        to det-6
                                      end-evaluate 
                                  end-evaluate
                             when "A" move "Alacak"     to det-3
                                      evaluate depkod-turu
                                          when 1 move "Genel"        to det-6
                                          when 2 move "Correction"   to det-6
                                          when 3 move "Nakit"        to det-6
                                          when 4 move "Kredi"        to det-6
                                          when 5 move "Kredi Karti"  to det-6
                                          when 6 move "Diger"        to det-6
                                      end-evaluate
                             when other move "Tanimsiz" to det-3
                         end-evaluate
                         move depkod-kdv         to det-4
                         evaluate depkod-tipi
                              when 1 move "Genel"   to det-7
                              when 2 move "Oda"     to det-7
                              when 3 move "Extra"   to det-7
                              when 4 move "Telefon" to det-7
                              when 5 move "Diger"   to det-7
                         end-evaluate
                         move depkod-servis-oran to det-5
                         if depkod-makbuz = "E"
                            move "Evet"             to det-8
                         else
                            move "Hayir"            to det-8
                         end-if
                         move depkod-matrah-hesap   to det-9
                         move depkod-kdv-hesap      to det-10
                         move depkod-toplam-hesap   to det-11
                         move depkod2-matrah-hesap   to det-19
                         move depkod2-kdv-hesap      to det-20
                         move depkod2-toplam-hesap   to det-21
                         evaluate  depkod2-alt-kate
                           when "01"  move "Oda Geliri"    to det-22
                           when "02"  move "Yiyecek Geliri"  to det-22
                           when "03"  move "Icecek Geliri"  to det-22
                           when "04"  move "Diger Geliri"  to det-22
                           when "05"  move "Indirim "  to det-22
                           when "06"  move "Tahsilat  "  to det-22
                           when "07"  move "Kredi  "  to det-22


                           when other move "Bos"    to det-12
                         end-evaluate

                         evaluate  depkod-matrah-ba
                           when "B"  move "Borc"    to det-12
                           when "A"  move "Alacak"  to det-12
                           when other move "Bos"    to det-12
                         end-evaluate


                         move depkod2k-matrah-hesap to det-23
                         write dokumer-rec from detay
                    end-read
              end-perform

                  initialize dokumer-rec detay
                  move "-"            to det-dokumer-20(5:1)
                  move all "-"  to det-1 det-2 det-3 det-4 det-5 det-6 det-7 det-8 
                                   det-9 det-10 det-11  det-19 det-20 det-21 det-22 det-23
                  write dokumer-rec from detay

              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close depkod depkod2
              delete file dokumer
     end-evaluate.
*
 bef-procedure.
     initialize mesaj.
     evaluate control-id
          when 5
              evaluate true
                  when turkce
                       move "Departman kodunu giriniz F1-Departman kodlari yardimi" to mesaj
                  when almanca
                       move "Departman kodunu giriniz F1-Departman kodlari yardimi" to mesaj
                  when ingilizce
                       move "Departman kodunu giriniz F1-Departman kodlari yardimi" to mesaj
              end-evaluate
          when 8
              evaluate true
                  when turkce
                       move "Departman adini giriniz         " to mesaj
                  when ingilizce
                       move "Departman adini giriniz         " to mesaj
                  when almanca
                       move "Departman adini giriniz         " to mesaj
              end-evaluate
          when 10
              evaluate true
                  when turkce
                       move "Borc/alacak                       " to mesaj
                  when ingilizce
                       move "Borc/alacak                       " to mesaj
                  when almanca
                       move "Borc/alacak                       " to mesaj
              end-evaluate
          when 12
              evaluate true
                  when turkce
                       move "Departman kdv oranini giriniz     " to mesaj
                  when ingilizce
                       move "Departman kdv oranini giriniz     " to mesaj
                  when almanca
                       move "Departman kdv oranini giriniz     " to mesaj
              end-evaluate
          when 14
              evaluate true
                  when turkce
                       move "Departman servis oranini giriniz  " to mesaj
                  when ingilizce
                       move "Departman servis oranini giriniz  " to mesaj
                  when almanca
                       move "Departman servis oranini giriniz  " to mesaj
              end-evaluate
          when 16
              evaluate true
                  when turkce
                       move "Departman ozelligini seciniz      " to mesaj
                  when ingilizce
                       move "Departman ozelligini seciniz      " to mesaj
                  when almanca
                       move "Departman ozelligini seciniz      " to mesaj
              end-evaluate
          when 25
              evaluate true
                  when turkce
                       move "Departman tipi seciniz                 " to mesaj
                  when ingilizce
                       move "Departman tipi seciniz                 " to mesaj
                  when almanca
                       move "Departman tipi seciniz                 " to mesaj
              end-evaluate
          when 28
              evaluate true
                  when turkce
                       move "Muhasebelesme Icin Matrahin Islenecegi Hesap Kodu" to mesaj
                  when ingilizce
                       move "Muhasebelesme Icin Matrahin Islenecegi Hesap Kodu" to mesaj
                  when almanca
                       move "Muhasebelesme Icin Matrahin Islenecegi Hesap Kodu" to mesaj
              end-evaluate
          when 27
              evaluate true
                  when turkce
                       move "Makbuz kesilmesini istiyorsaniz isaretleyiniz " to mesaj
                  when ingilizce
                       move "Makbuz kesilmesini istiyorsaniz isaretleyiniz " to mesaj
                  when almanca
                       move "Makbuz kesilmesini istiyorsaniz isaretleyiniz " to mesaj
              end-evaluate
          when 29
              evaluate true
                  when turkce
                       move "Muhasebelesme Icin KDV'nin  Islenecegi Hesap Kodu" to mesaj
                  when ingilizce
                       move "Muhasebelesme Icin KDV'nin  Islenecegi Hesap Kodu" to mesaj
                  when almanca
                       move "Muhasebelesme Icin KDV'nin  Islenecegi Hesap Kodu" to mesaj
              end-evaluate
          when 36
              evaluate true
                  when turkce
                       move "Muhasebelesme Icin Toplamin Islenecegi Hesap Kodu" to mesaj
                  when ingilizce
                       move "Muhasebelesme Icin Toplamin Islenecegi Hesap Kodu" to mesaj
                  when almanca
                       move "Muhasebelesme Icin Toplamin Islenecegi Hesap Kodu" to mesaj
              end-evaluate
          when 38
              evaluate true
                  when turkce
                       move "Muhasebelesmede Matrah Hanesi Nasil Hareket Gorur" to mesaj
                  when ingilizce
                       move "Muhasebelesmede Matrah Hanesi Nasil Hareket Gorur" to mesaj
                  when almanca
                       move "Muhasebelesmede Matrah Hanesi Nasil Hareket Gorur" to mesaj
              end-evaluate
          when 19
              evaluate true
                  when turkce
                       move "Departman kodunu kaydetmek icin tiklayiniz  " to mesaj
                  when ingilizce
                       move "Departman kodunu kaydetmek icin tiklayiniz  " to mesaj
                  when almanca
                       move "Departman kodunu kaydetmek icin tiklayiniz  " to mesaj
              end-evaluate
          when 20
              evaluate true
                  when turkce
                       move "Departman kodunu silmek icin tiklayiniz " to mesaj
                  when ingilizce
                       move "Departman kodunu silmek icin tiklayiniz " to mesaj
                  when almanca
                       move "Departman kodunu silmek icin tiklayiniz " to mesaj
              end-evaluate
          when 21
              evaluate true
                  when turkce
                       move "Rapor almak icin tiklayiniz      " to mesaj
                  when ingilizce
                       move "Rapor almak icin tiklayiniz      " to mesaj
                  when almanca
                       move "Rapor almak icin tiklayiniz      " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj.
*
 Form1-Aft-Initdata.

     modify combo-0101,
            reset-list  = 1
            mass-update = 1
     modify combo-0102,
            reset-list  = 1
            mass-update = 1
     modify combo-0103,
            reset-list  = 1
            mass-update = 1
     modify combo-0104,
            reset-list  = 1
            mass-update = 1

     evaluate true
         when turkce    
              modify combo-0101,item-to-add("B-Borc","A-Alacak")
              modify combo-0103,item-to-add("1-Genel","2-Oda","3-Extra","4-Telefon","5-Diger")
              modify combo-0104,item-to-add("B-Borc","A-Alacak")
         when ingilizce 
              modify combo-0101,item-to-add("B-Borc","A-Alacak")
              modify combo-0103,item-to-add("1-Genel","2-Oda","3-Extra","4-Telefon","5-Diger")
              modify combo-0104,item-to-add("B-Borc","A-Alacak")
         when almanca   
              modify combo-0101,item-to-add("B-Borc","A-Alacak")
              modify combo-0103,item-to-add("1-Genel","2-Oda","3-Extra","4-Telefon","5-Diger")
              modify combo-0104,item-to-add("B-Borc","A-Alacak")
     end-evaluate

     modify combo-0101,
            mass-update = 0
     modify combo-0102,
            mass-update = 0
     modify combo-0103,
            mass-update = 0
     modify combo-0104,
            mass-update = 0
     perform listbox-yukle.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
     if link-var = 1
        modify button-0103a , enabled = false    
        open input depkod
        initialize depkod-rec
        move lnk-depkod-anah to depkod-anah
        read depkod no lock invalid
            close depkod 
            set exit-pushed to true 
            exit paragraph 
        end-read
        close depkod

        perform accept-0101-Aft-Procedure
                initialize depkod-kullanma
        display cb-0105
        
     end-if .
*/-----------------------------\*         
*
 combo-0101-Ex-Ntf-Selchange.
     modify combo-0102,
            reset-list  = 1
            mass-update = 1
     move combo-0101-value to depkod-ba
     if depkod-ba = "B"
        evaluate true
            when turkce    modify combo-0102,item-to-add("1-Genel","2-Correction","3-Guest Refund","4-Paid Out","5-Diger")
            when ingilizce modify combo-0102,item-to-add("1-Genel","2-Correction","3-Guest Refund","4-Paid Out","5-Diger")
            when almanca   modify combo-0102,item-to-add("1-Genel","2-Correction","3-Guest Refund","4-Paid Out","5-Diger")
        end-evaluate
     else
        evaluate true
            when turkce    modify combo-0102,item-to-add("1-Genel","2-Correction","3-Nakit","4-Kredi","5-Kredi Karti","6-Diger")
            when ingilizce modify combo-0102,item-to-add("1-Genel","2-Correction","3-Nakit","4-Kredi","5-Kredi Karti","6-Diger")
            when almanca   modify combo-0102,item-to-add("1-Genel","2-Correction","3-Nakit","4-Kredi","5-Kredi Karti","6-Diger")
        end-evaluate
     end-if.
     if depkod-tipi = zeroes
        move 1 to depkod-tipi
     end-if
     modify combo-0102,
            value = depkod-tipi
            mass-update = 0.
     .
*
 combo-0102-Ex-Ntf-Selchange.
     move combo-0102-value(1:1) to depkod-turu.
     .
*
 combo-0103-Ex-Ntf-Selchange.
     move combo-0103-value(1:1) to depkod-tipi.
     .
*
 combo-0104-Ex-Ntf-Selchange.
     move combo-0104-value(1:1) to depkod-matrah-ba.
     .
*
 cb-0101-Ex-Cmd-Clicked.
     if cb-0101-value = 1
        move "E" to depkod-makbuz
     else
        move "H" to depkod-makbuz
     end-if.
     
     .
 listbox-yukle.
     modify form1-lb-1,
            reset-list  = 1
            mass-update = 1
     open input depkod depkod2
     initialize depkod-rec
     start depkod key not < depkod-kodu invalid
           continue
     not invalid
     move zeroes to fs-depkod
     perform with test after until fs-depkod = "10"
          read depkod next no lock end move "10" to fs-depkod
          not at end
               initialize form1-lb-1-value
               move depkod-kodu  to lb-1-col-1
               move depkod-adi   to lb-1-col-2
               modify form1-lb-1,
                      item-to-add(form1-lb-1-value)
          end-read
     end-perform
     end-start
     close depkod depkod2.
     initialize depkod-rec,
     modify form1-lb-1,
            mass-update = 0
            selection-index = 1
            thumb-position = 1.
     .
*
 listbox-eventlar.
     evaluate event-type
          when cmd-dblclick
               inquire form1-lb-1,value in form1-lb-1-value
               move lb-1-col-1 to depkod-kodu
               perform accept-0101-Aft-Procedure
               display accept-0101,
               move 4 to accept-control
               move 8 to control-id
               exit paragraph
          when ntf-selchange
          when cmd-goto
               inquire form1-lb-1,value in form1-lb-1-value
               move lb-1-col-1 to depkod-kodu
               display accept-0101,
               perform accept-0101-Aft-Procedure
     end-evaluate.
     
     .
 listbox-yer-bul.
      exit paragraph
     initialize durum tekrar
     perform varying i from 1 by 1 until (durum = "E" or "H")
             initialize edepkod-kodu
             modify form1-lb-1,
                    query-index = i
             inquire form1-lb-1,
                    item-value in edepkod-kodu
             if edepkod-kodu <> zeroes
                if edepkod-kodu = tekrar
                   move "E" to durum
                   exit perform
                else
                   move edepkod-kodu to tekrar
                end-if

             end-if
               
             if edepkod-kodu = zeroes
                move "H" to durum
                initialize i
                exit perform
             else
                if edepkod-kodu = depkod-kodu
                   move "E" to durum
                   exit perform
                end-if
             end-if
    end-perform.
*
 
*
 After-Proc.     
     if hesap-dosya-adres = spaces then 
         exit paragraph
         end-if.

     evaluate control-id 
       when 28
        open input hesap
            move depkod-matrah-hesap to hesap-kodu
          read hesap no lock invalid
                  modify matrah-label, COLOR = red
             move "Tanimsiz Hesap Kodu " to matrah-hesap-adi
              not invalid 
                modify matrah-label, COLOR = blue
              move hesap-adi(1:20) to matrah-hesap-adi

           end-read
        display matrah-label
          close hesap
       when 29
        open input hesap
            move depkod-kdv-hesap to hesap-kodu
          read hesap no lock invalid
              modify kdv-label, COLOR = red
              
              move "Tanimsiz Hesap Kodu " to kdv-hesap-adi
             not invalid 
              move hesap-adi(1:20) to kdv-hesap-adi
               modify kdv-label, COLOR = blue
              
          end-read
              display kdv-label
          close hesap
       when 36
        open input hesap
            move depkod-toplam-hesap to hesap-kodu
          read hesap no lock invalid
          modify toplam-label, COLOR = red
                       move "Tanimsiz Hesap Kodu " to toplam-hesap-adi
              not invalid 
              modify toplam-label, COLOR = blue
              move hesap-adi(1:20) to toplam-hesap-adi
          end-read
          display toplam-label
          close hesap
       
         when 46
        open input hesap
            move depkod2-matrah-hesap to hesap-kodu
          read hesap no lock invalid
                  modify matrah2-label, COLOR = red
             move "Tanimsiz Hesap Kodu " to matrah2-hesap-adi
              not invalid 
                modify matrah2-label, COLOR = blue
              move hesap-adi(1:20) to matrah2-hesap-adi

           end-read
        display matrah2-label
          close hesap
       when 48
        open input hesap
            move depkod2-kdv-hesap to hesap-kodu
          read hesap no lock invalid
              modify kdv2-label, COLOR = red
              
              move "Tanimsiz Hesap Kodu " to kdv2-hesap-adi
             not invalid 
              move hesap-adi(1:20) to kdv2-hesap-adi
               modify kdv2-label, COLOR = blue
              
          end-read
              display kdv2-label
          close hesap
       when 50
          open input hesap
          move depkod2-toplam-hesap to hesap-kodu
          read hesap no lock invalid
          modify toplam2-label, COLOR = red
                       move "Tanimsiz Hesap Kodu " to toplam2-hesap-adi
              not invalid 
              modify toplam2-label, COLOR = blue
              move hesap-adi(1:20) to toplam2-hesap-adi
          end-read
          display toplam2-label
          close hesap
        when 72
           open input hesap
            move depkod2-kasa-hesap to hesap-kodu
            read hesap no lock invalid
               modify matrah2-labela, COLOR = red
                       move "Tanimsiz Hesap Kodu " to kasa-hesap-adi
              not invalid 
              modify matrah2-labela, COLOR = blue
              move hesap-adi(1:20) to kasa-hesap-adi
           end-read
          display matrah2-labela
          close hesap
       end-evaluate




     .
label-doldur.
          perform doviz-oku


         if hesap-dosya-adres = spaces then 
             exit paragraph
         end-if.

         open input hesap
            move depkod-matrah-hesap to hesap-kodu
          read hesap no lock invalid
                  modify matrah-label, COLOR = red
             move "Tanimsiz Hesap Kodu " to matrah-hesap-adi
              not invalid 
                modify matrah-label, COLOR = blue
              move hesap-adi(1:20) to matrah-hesap-adi

           end-read
        display matrah-label

          move depkod-kdv-hesap to hesap-kodu
          read hesap no lock invalid
              modify kdv-label, COLOR = red
              
              move "Tanimsiz Hesap Kodu " to kdv-hesap-adi
             not invalid 
              move hesap-adi(1:20) to kdv-hesap-adi
               modify kdv-label, COLOR = blue
              
          end-read
             display kdv-label    

            move depkod-toplam-hesap to hesap-kodu
          read hesap no lock invalid
          modify toplam-label, COLOR = red
                       move "Tanimsiz Hesap Kodu " to toplam-hesap-adi
              not invalid 
              modify toplam-label, COLOR = blue
              move hesap-adi(1:20) to toplam-hesap-adi
          end-read
          display toplam-label
           

          move depkod2-matrah-hesap to hesap-kodu
          read hesap no lock invalid
                  modify matrah2-label, COLOR = red
             move "Tanimsiz Hesap Kodu " to matrah2-hesap-adi
              not invalid 
                modify matrah2-label, COLOR = blue
              move hesap-adi(1:20) to matrah2-hesap-adi

           end-read
        display matrah2-label
        
            move depkod2-kdv-hesap to hesap-kodu
          read hesap no lock invalid
              modify kdv2-label, COLOR = red
              
              move "Tanimsiz Hesap Kodu " to kdv2-hesap-adi
             not invalid 
              move hesap-adi(1:20) to kdv2-hesap-adi
               modify kdv2-label, COLOR = blue
              
          end-read
              display kdv2-label
          close hesap
      
        open input hesap
            move depkod2-toplam-hesap to hesap-kodu
          read hesap no lock invalid
          modify toplam2-label, COLOR = red
                       move "Tanimsiz Hesap Kodu " to toplam2-hesap-adi
              not invalid 
              modify toplam2-label, COLOR = blue
              move hesap-adi(1:20) to toplam2-hesap-adi
          end-read
          display toplam2-label
          close hesap.
          if depkod-ref > 0
      if depkod-ref <= max-ref then
        move ref-adi(depkod-ref)  to depkod-ref-adi
       else
        move "????????? "  to depkod-ref-adi
      end-if
      else 
       move "Tumu "  to depkod-ref-adi
     end-if
     display lb-ref.



*
sil-kontrol.
   
    move spaces to evet-hayir.
    open input onkasa.
    initialize onkasa-rec.
    move depkod-kodu to onkasa-dep.
    start onkasa key not < onkasa-anah invalid continue
        not invalid,
        perform with test after until evet,
            read onkasa next no lock end move "E" to evet-hayir,
                not end,
              if onkasa-dep not = depkod-kodu
                 exit perform cycle
              end-if
              if onkasa-tutar-tl      not = 0 or
                 onkasa-tutar-dv      not = 0 or
                 onkasa-corr-tutar-tl not = 0 or
                 onkasa-corr-tutar-dv not = 0 
                 
                 move "H" to evet-hayir,
                 exit perform
              end-if 
            end-read 
        end-perform 
    end-start.
         close onkasa.

sil-kontrol-ex.
    exit.

*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.

*
*
 acuserve-adres-aktar.

    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres       
                         |genelfis-DOSYA-adres     
                         REFERANS-DOSYA-adres     
                         mgenel-DOSYA-adres       
                         |genelfis-DOSYA-adres 
                         
                        | move "muha" to genelfis-DOSYA(16:4)
            

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           |genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           |genelfis-ACUSERVE-DOSYA  
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.

   | string genelfis-acuserve-dosya,
   |        ip-no                        delimited by low-values
   |        genelfis-dosya                 delimited by low-values
   |        into genelfis-acuserve-dosya.

    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    

    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    |inspect genelfis-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values.
    |inspect genelfis-ACUSERVE-DOSYA   replacing  all spaces by low-values.
    



  



*
 dep-after.
     if depkod-ref > 0
      if depkod-ref <= max-ref then
        move ref-adi(depkod-ref)  to depkod-ref-adi
       else
        move "????????? "  to depkod-ref-adi
      end-if
      else 
       move "Tumu "  to depkod-ref-adi
     end-if
     display lb-ref
     .
*
 merkez-kodlama-kontrol.
     open input merkod
     initialize merkod-rec 
     move "DP"                to merkod-tipi 
     move depkod2-merkez-kodu to merkod-dep-anah-kodu
     read merkod no lock invalid
          display message box "Merkez Departman Kodu Tanimlamasi Bulunamadi.." new-line
                              "Merkez Kodlama iptal edilmistir.."
          initialize depkod2-merkez-kodu
     end-read 
     close merkod
     .

 
