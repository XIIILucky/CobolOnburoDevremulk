* tez2asya.evt
* tez2asya.evt is generated from D:\asya\acugt.ytl\otel\tez2asya.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 cb-otel-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM cb-otel-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
       perform adresleri-tasi
       move tarih-tasi          to ilk-tar son-tar 
       open input genel genel2 
       initialize genel-rec 
       move 1      to genel-anahtar
       read genel no lock invalid
            continue 
       end-read
       initialize genel2-rec 
       move 1 to genel2-anah 
       read genel2 no lock invalid
            continue
       end-read
       close genel genel2
       accept system-information from system-info
     .
*
 Form1-Ex-Other.
      evaluate key-status
      when 1
         evaluate control-id
         when 18
         when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to acc-acenta-kodu xrez-acenta
                        display acc-7
                     end-if
             end-call
             move 4  to accept-control
             move 18 to control-id
              perform acenta-oku
         end-evaluate
      when 2
*           if acc-acenta-kodu = spaces
*               display message box "Pazar Kodu Baglanti Acentalari Otomatik Secilecektir."new-line
*                               title "[ Uyari ]"
*                               icon 1
*           end-if

           perform tarih-kontrol

           if hata-tarih = 1
              exit paragraph 
           else

               if os-is-unix
                 perform web-servis-cagir         
                 if web-servis-hata = 1
                    exit paragraph 
                 end-if 
               else
                  continue 
               end-if 

             initialize frame-degiskenler
             move 20              to frame-win-line
             move 20              to frame-win-pos
             move "Bekleyiniz..." to frame-title
             perform frame-ac

              open i-o tezkod02 bilbord
              open input kodlar02 konum ulke rez 

                 perform tez-rez-onizle

              close kodlar02 tezkod02 konum ulke rez bilbord 
           end-if
      when 3
           if acc-acenta-kodu = spaces
               display message box "Pazar Kodu Baglanti Acentalari Otomatik Secilecektir."new-line
                               title "[ Uyari ]"
                               icon 1
           end-if

           perform tarih-kontrol

           if hata-tarih = 1
              exit paragraph 
           else
             display message box "Aktarim Baslayacaktir."new-line
                                 "Eminmisiniz?"
                             title "[ Uyari ]"
                             icon 1
                             default 2
                             type 2
                             returning return-code 
             if return-code = 2
                exit paragraph 
             end-if

               if os-is-unix
                 perform web-servis-cagir         
                 if web-servis-hata = 1
                    exit paragraph 
                 end-if 
               else
                  continue 
               end-if 

             initialize frame-degiskenler
             move 20              to frame-win-line
             move 20              to frame-win-pos
             move "Bekleyiniz..." to frame-title
             perform frame-ac

                open i-o kodlar02  konum tezkod02 ulke rez  takvim bilbord

                  perform tez-rez-kaydet |rezervasyonlar kaydediliyor

                    display message box "Aktarim Tamamlandi."new-line
                                        "Lutfen Kontrol Ediniz."
                                    title "[ Uyari ]"
                                    icon 1

                  perform tez-rez-onizle |grid tekrardan yukleniyor.

                close kodlar02 tezkod02 konum ulke rez takvim bilbord
                if os-is-unix
                   delete file amontext fidetext
                end-if 
           end-if
      when 18
         perform rez-cagir
      end-evaluate     
     .
*
 tez-rez-onizle.
     modify Form1-St-1-handle,
            title = "Rezervasyonlar Aktariliyor..."
     modify Form1-Gd-1, RESET-GRID = 1
                        mass-update = 1
     initialize form1-gd-1-record 
     move "Voucher ID"       to gd-1-col-1
     move "CheckIn   "       to gd-1-col-2
     move "CheckOut  "       to gd-1-col-3
     move "Rez No"           to gd-1-col-4
     move "S"                to gd-1-col-5
     move "Sale Market"      to gd-1-col-6 
     move "B.Date"           to gd-1-col-7
     move "Conf.Date"        to gd-1-col-8
     move "Country"          to gd-1-col-9
     move "Region"           to gd-1-col-10
     move "Hotel"            to gd-1-col-11
     move "Romm Type"        to gd-1-col-12
     move "Pansion"          to gd-1-col-13
     move "Stay Type"        to gd-1-col-14
     move "LocalPMSID"       to gd-1-col-15
     move "Note"             to gd-1-col-16
     move "Internal Note"    to gd-1-col-17
     move "Hotel Note"       to gd-1-col-18
     move "Vip"              to gd-1-col-19
     move "P"                to gd-1-col-20

     move "1-Name"           to gd-1-col-21
     move "1-Surname"        to gd-1-col-22
     move "1-Title"          to gd-1-col-23
     move "1-Date of Birth"  to gd-1-col-24        

     move "2-Name"           to gd-1-col-25
     move "2-Surname"        to gd-1-col-26
     move "2-Title"          to gd-1-col-27
     move "2-Date of Birth"  to gd-1-col-28        

     move "3-Name"           to gd-1-col-29
     move "3-Surname"        to gd-1-col-30
     move "3-Title"          to gd-1-col-31
     move "3-Date of Birth"  to gd-1-col-32        

     move "4-Name"           to gd-1-col-33
     move "4-Surname"        to gd-1-col-34
     move "4-Title"          to gd-1-col-35
     move "4-Date of Birth"  to gd-1-col-36        

     move "5-Name"           to gd-1-col-37
     move "5-Surname"        to gd-1-col-38
     move "5-Title"          to gd-1-col-39
     move "5-Date of Birth"  to gd-1-col-40        

*     move "5-Pax Name/Surname/Title/Age"  to gd-1-col-25
*     move "6-Pax Name/Surname/Title/Age"  to gd-1-col-26
*     move "7-Pax Name/Surname/Title/Age"  to gd-1-col-27
*     move "8-Pax Name/Surname/Title/Age"  to gd-1-col-28
*     move "9-Pax Name/Surname/Title/Age"  to gd-1-col-29
*     move "10-Pax Name/Surname/Title/Age" to gd-1-col-30

     modify form1-gd-1,record-to-add(form1-gd-1-record)
     move 1               to kayit-sayi
     move 0               to uygun-kayit-sayisi 
                             hatali-kayit-sayisi 
                             bekleyen-rez-sayi
                             islenen-rez-sayi  

*     move tarih-tasi      to fidetext-adi(1:8)
*     move ".txt"          to fidetext-adi(9:4)    
     move tarih-tasi          to okunacak-dosya(1:8)
     move ".txt"              to okunacak-dosya(9:)
     move okunacak-dosya      to fidetext-adi

     move tarih-tasi          to okunacak-dosya2(1:8)
     move "2"                 to okunacak-dosya2(9:1)
     move ".txt"              to okunacak-dosya2(10:)
     move okunacak-dosya2     to amontext-adi

     open input fidetext  
     open output amontext   
     perform until fs-fidetext = "10"
     initialize fidetext-rec kayit-uygun   
     read fidetext next no lock end move "10" to fs-fidetext
     not end
          move 1 to sayac    
          initialize amontext-rec
          perform varying k from 1 by 1 until k > 50
               unstring fidetext-rec 
                        delimited by ";"
               into amontext-det(k) pointer sayac
          end-perform
          
          if amontext-det(1) <> spaces
             initialize form1-gd-1-record
             add 1                         to kayit-sayi

             move amontext-det(1)          to gd-1-col-1
                 perform rez-kayit-kontrol
             if voucher-var = 0 and 
                isle-goster = 0|voucher numarasý daha önce iþlendiyse
                  compute kayit-sayi = kayit-sayi - 1 
                  exit perform cycle 
             end-if
             if voucher-var = 1
                 add 1     to bekleyen-rez-sayi
                 compute islenen-rez-sayi = islenen-rez-sayi - 1
                 initialize rez-no
                 modify form1-gd-1(kayit-sayi),
                        row-color = 485
             end-if
             add 1                         to islenen-rez-sayi
             move rez-no                   to gd-1-col-4
             move amontext-det(2)          to gd-1-col-2
             move amontext-det(3)          to gd-1-col-3
             move amontext-det(5)          to gd-1-col-5

             move amontext-det(6)          to gd-1-col-6 
                perform pazar-kodu-hata-kontrol

             if pazar-hata-kontrol = 1|hata varsa
                modify form1-gd-1(kayit-sayi,7),
                       cell-color = 176
             end-if 

                perform ulke-kodu-hata-kontrol

             if ulke-hata-kontrol = 1|hata varsa
                modify form1-gd-1(kayit-sayi,7),
                       cell-color = 176
             end-if 

             move amontext-det(7)          to gd-1-col-7
             move amontext-det(8)          to gd-1-col-8
             move amontext-det(9)          to gd-1-col-9
             move amontext-det(10)         to gd-1-col-10
             move amontext-det(11)         to gd-1-col-11
             move amontext-det(12)         to gd-1-col-12

                  perform konum-kodu-hata-kontrol
             if konum-hata-kontrol = 1|hata varsa
                modify form1-gd-1(kayit-sayi,13),
                                cell-color = 176                
             end-if

             move amontext-det(13)         to gd-1-col-13
                  perform pansiyon-kodu-hata-kontrol
             if pansiyon-hata-kontrol = 1|hata varsa
                modify form1-gd-1(kayit-sayi,14),
                                cell-color = 176                
             end-if

             move amontext-det(14)         to gd-1-col-14
             move amontext-det(15)         to gd-1-col-15
******   ****move amontext-det(16)   deðiþiklik tarihi var koyulmadý
             move amontext-det(17)         to gd-1-col-16
             move amontext-det(18)         to gd-1-col-17
             move amontext-det(19)         to gd-1-col-18
             move amontext-det(20)         to gd-1-col-19
         
             evaluate amontext-det(25)
             when 0
                move "1"                   to gd-1-col-20             
             when 1
                move "2"                   to gd-1-col-20             
             when 2
                move "3"                   to gd-1-col-20             
             when 3
                move "4"                   to gd-1-col-20             
             when 4
                move "5"                   to gd-1-col-20             
             when 5
                move "6"                   to gd-1-col-20             
             when 6
                move "7"                   to gd-1-col-20             
             when 7
                move "8"                   to gd-1-col-20             
             when 8
                move "9"                   to gd-1-col-20             
             when 9
                move "10"                  to gd-1-col-20             
             when 10
                move "11"                  to gd-1-col-20             
             end-evaluate
         
             move amontext-det(26)         to gd-1-col-21
             move amontext-det(27)         to gd-1-col-22
             move amontext-det(28)         to gd-1-col-23
             move amontext-det(29)         to gd-1-col-24
             move amontext-det(30)         to gd-1-col-25
             move amontext-det(31)         to gd-1-col-26
             move amontext-det(32)         to gd-1-col-27
             move amontext-det(33)         to gd-1-col-28
             move amontext-det(34)         to gd-1-col-29
             move amontext-det(35)         to gd-1-col-30
             move amontext-det(36)         to gd-1-col-31
             move amontext-det(37)         to gd-1-col-32
             move amontext-det(38)         to gd-1-col-33
             move amontext-det(39)         to gd-1-col-34
             move amontext-det(40)         to gd-1-col-35
             move amontext-det(41)         to gd-1-col-36
             move amontext-det(42)         to gd-1-col-37
             move amontext-det(43)         to gd-1-col-38
             move amontext-det(44)         to gd-1-col-39
             move amontext-det(45)         to gd-1-col-40

             if konum-hata-kontrol = 0 and 
                pazar-hata-kontrol = 0 and
                pansiyon-hata-kontrol = 0 and
                ulke-hata-kontrol = 0
                modify form1-gd-1(kayit-sayi,1),
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                       bitmap-trailing = 0
                move 0         to kayit-uygun
                add 1          to uygun-kayit-sayisi
             else 
                modify form1-gd-1(kayit-sayi,1),
                       bitmap = no-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                       bitmap-trailing = 0
                move 1         to kayit-uygun                               
                add 1          to hatali-kayit-sayisi
             end-if


             modify form1-gd-1,
                    record-to-add(form1-gd-1-record)

             modify form1-gd-1(kayit-sayi,1),
                    hidden-data(kayit-uygun)|kayit-uygun sýfýr ise aktarim yapilabilir |||| kayit-uygun 1 ise hata vardýr.

             modify Form1-St-1-handle,
                    title = amontext-det(1)
             perform frame-goster
          end-if
    end-read 
    end-perform
  
    close fidetext close amontext 
    modify form1-gd-1,mass-update = 0
    modify Form1-St-1-handle,title = "Aktarim Tamamlandi".
    compute kayit-sayi = kayit-sayi - 1
    display acc-toplam acc-toplama acc-toplamaa acc-toplamaaa acc-toplamab
    perform frame-kapat.
*
 tez-rez-kaydet.

     modify Form1-St-1-handle,title = "Rezervasyonlar Aktariliyor..."
     move 1                   to kayit-sayi

     move tarih-tasi          to okunacak-dosya(1:8)
     move ".txt"              to okunacak-dosya(9:)
     move okunacak-dosya      to fidetext-adi

     move tarih-tasi          to okunacak-dosya2(1:8)
     move "2"                 to okunacak-dosya2(9:1)
     move ".txt"              to okunacak-dosya2(10:)
     move okunacak-dosya2     to amontext-adi
             
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid  
          initialize genelfis-rec
          move 1 to genelfis-anahtar
    
          move ekran-fis-1  to takas-no
          add 1 to ekran-fis-1
          write genelfis-rec invalid
                rewrite genelfis-rec invalid continue
                end-rewrite 
          end-write
      not invalid
          move ekran-fis-1  to takas-no
          add 1             to ekran-fis-1
      
                       
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis.   
     
     open input fidetext  
     open output amontext   
     perform until fs-fidetext = "10"
     initialize fidetext-rec kayit-uygun   
     read fidetext next no lock end move "10" to fs-fidetext
     not end
          move 1 to sayac    
          initialize amontext-rec
          perform varying k from 1 by 1 until k > 50
               unstring fidetext-rec 
                        delimited by ";"
               into amontext-det(k) pointer sayac
          end-perform
          
          if amontext-det(1) <> spaces
             add 1                          to kayit-sayi
              
             move amontext-det(1)           to xrez-voucher
                 perform rez-kayit-kontrol
             if voucher-var = 0
                  exit perform cycle 
             end-if

             move amontext-det(2)(1:2)      to xrez-gir-gun
             move amontext-det(2)(4:2)      to xrez-gir-ay
             move amontext-det(2)(7:4)      to xrez-gir-yil


             move amontext-det(3)(1:2)      to xrez-cik-gun
             move amontext-det(3)(4:2)      to xrez-cik-ay
             move amontext-det(3)(7:4)      to xrez-cik-yil

****************************************pazar kodu **************************************
             perform pazar-kodu-hata-kontrol
             if pazar-hata-kontrol = 1|hata varsa
                exit perform cycle 
             end-if 
             move yedek-pazar-kodu            to xrez-pazar

             if acc-acenta-kodu = spaces
                 move yedek-pazar-acenta-kodu to acc-acenta-kodu xrez-acenta                 
             end-if

****************************************pazar kodu **************************************
****************************************ulke kodu **************************************
             perform ulke-kodu-hata-kontrol
             if ulke-hata-kontrol = 1|hata varsa
                exit perform cycle 
             end-if 
             move yedek-ulke-kodu          to xrez-ulke
****************************************ulke kodu **************************************
****************************************konfirme tarihi*********************************
             move amontext-det(8)(1:2)      to xrez-al-gun
             move amontext-det(8)(4:2)      to xrez-al-ay
             move amontext-det(8)(7:4)      to xrez-al-yil
****************************************konfirme tarihi*********************************
*******************************************konum kodu*************************************
                  perform konum-kodu-hata-kontrol
             if konum-hata-kontrol = 1|hata varsa
                 exit perform cycle 
             end-if
             move yedek-konum-kodu    to xrez-fiyat-konumu xrez-oda-konumu
*******************************************konum kodu*************************************
*******************************************pansiyon kodu*************************************
                  perform pansiyon-kodu-hata-kontrol
             if pansiyon-hata-kontrol = 1|hata varsa
                exit perform cycle 
             end-if
             move yedek-pans-kodu          to xrez-pan-tipi
*******************************************pansiyon kodu*************************************
             move amontext-det(17)         to xrez-not1
                 
             open output takas close takas open i-o takas 
             if amontext-det(26) <> spaces and
                amontext-det(27) <> spaces
             initialize takas-rec

                     move amontext-det(26)            to takas-adi
                     move amontext-det(27)            to takas-soy
                     move amontext-det(28)            to takas-title
        
                     move amontext-det(29)(1:2)       to takas-d-gun
                     move amontext-det(29)(4:2)       to takas-d-ay
                     move amontext-det(29)(7:4)       to takas-d-yil
        
                     if function numval(amontext-det(29)(7:4)) <  yil-tasi - 20
                         move "1111111111"  to takas-d-anah
                     else
                         move takas-d-tar   to takas-d-anah
                     end-if 
        
                     move 1                           to takas-adi(30:1)
                       write takas-rec invalid 
                             stop " "
                       end-write                
          
             end-if 
             if amontext-det(30) <> spaces and
                amontext-det(31) <> spaces 
                 
                     initialize takas-rec 
                     move amontext-det(30)            to takas-adi
                     move amontext-det(31)            to takas-soy
        
                     move amontext-det(33)(1:2)       to takas-d-gun
                     move amontext-det(33)(4:2)       to takas-d-ay 
                     move amontext-det(33)(7:4)       to takas-d-yil
                     move 2                           to takas-adi(30:1)
                     move takas-d-tar   to takas-d-anah
                       write takas-rec invalid 
                             stop " "
                       end-write
                      
             end-if
             if amontext-det(34) <> spaces and
                amontext-det(35) <> spaces 

                     initialize takas-rec
                     move amontext-det(34)            to takas-adi
                     move amontext-det(35)            to takas-soy
                     move amontext-det(37)(1:2)       to takas-d-gun
                     move amontext-det(37)(4:2)       to takas-d-ay 
                     move amontext-det(37)(7:4)       to takas-d-yil
                     move 3                           to takas-adi(30:1)
                     move takas-d-tar   to takas-d-anah
                       write takas-rec invalid 
                             stop " "
                       end-write  

             end-if 

             if amontext-det(38) <> spaces and
                amontext-det(39) <> spaces 
                     initialize takas-rec 
        
                     move amontext-det(38)            to takas-adi
                     move amontext-det(39)            to takas-soy
                     move amontext-det(41)(1:2)       to takas-d-gun
                     move amontext-det(41)(4:2)       to takas-d-ay 
                     move amontext-det(41)(7:4)       to takas-d-yil
                     move 4                           to takas-adi(30:1)
                     move takas-d-tar   to takas-d-anah
                       write takas-rec invalid 
                             stop " "
                       end-write
                     
             end-if 
             if amontext-det(42) <> spaces and
                amontext-det(43) <> spaces
                     initialize takas-rec 
                     move amontext-det(42)            to takas-adi
                     move amontext-det(43)            to takas-soy
                     move amontext-det(45)(1:2)       to takas-d-gun
                     move amontext-det(45)(4:2)       to takas-d-ay 
                     move amontext-det(45)(7:4)       to takas-d-yil
                     move 5                           to takas-adi(30:1)
                     move takas-d-tar   to takas-d-anah
                       write takas-rec invalid 
                             stop " "
                       end-write                   
             end-if 
               
             initialize takas-rec i
*             move high-values   to takas-rec 
             start takas key not < takas-anah invalid
                 continue 
              not invalid 
              perform with test after until fs-takas = "10"
              read takas next no lock end move "10"  to fs-takas
              not at end 
                      add 1 to i
                      evaluate i
                      when 1
                             move takas-adi    to xrez-adi
                             move takas-soy    to xrez-soyadi
                             move takas-title  to xrez-title
                
                             move takas-d-gun  to d-gun1
                             move takas-d-ay   to d-ay1
                             move takas-d-yil  to d-yil1

                      when 2
                             move takas-adi         to adi2
                             move takas-soy         to soy2
                             move takas-d-gun       to d-gun2
                             move takas-d-ay        to d-ay2
                             move takas-d-yil       to d-yil2

                      when 3
                             move takas-adi         to adi3
                             move takas-soy         to soy3
                             move takas-d-gun       to d-gun3
                             move takas-d-ay        to d-ay3
                             move takas-d-yil       to d-yil3
                      when 4
                             move takas-adi         to adi4
                             move takas-soy         to soy4
                             move takas-d-gun       to d-gun4
                             move takas-d-ay        to d-ay4
                             move takas-d-yil       to d-yil4
                      when 5
                             move takas-adi         to adi5
                             move takas-soy         to soy5
                             move takas-d-gun       to d-gun5
                             move takas-d-ay        to d-ay5
                             move takas-d-yil       to d-yil5
                      end-evaluate 
              end-read 
              end-perform
             end-start
**************************************************************mami***************************
             close takas 
             delete file takas 

             if konum-hata-kontrol = 0 and 
                pazar-hata-kontrol = 0 and
                pansiyon-hata-kontrol = 0 and
                ulke-hata-kontrol = 0
                    continue 
             else 
                exit perform cycle 
             end-if

             perform rez-kaydet thru kaydet-exit
             
             modify Form1-St-1-handle,
                    title = amontext-det(1)
             perform frame-goster
          end-if
    end-read 
    end-perform
  
    close fidetext close amontext 
    modify Form1-St-1-handle,title = "Aktarim Tamamlandi".
    perform frame-kapat.

*
 pazar-kodu-hata-kontrol.
       initialize tezkod02-rec pazar-hata-kontrol yedek-pazar-kodu acc-acenta-kodu
       move amontext-det(6)          to tezkod02-entegre-kodu
       move "A"                      to tezkod02-tipi
       start tezkod02 key not < tezkod02-anah1 invalid
             move 1 to pazar-hata-kontrol
             continue 
       not invalid
       perform with test after until fs-tezkod02 = "10"
       read tezkod02 next no lock end move "10"  to fs-tezkod02
       not at end 
              if tezkod02-entegre-kodu <> amontext-det(6) or
                 tezkod02-tipi <> "A"
                  move 1 to pazar-hata-kontrol
                  exit perform 
              end-if

              initialize kodlar02-rec
              move tezkod02-asya-kodu    to kodlar02-kodu
              move "E"                   to kodlar02-tipi
              read kodlar02 no lock invalid
                   move 1 to pazar-hata-kontrol
                   exit perform 
              end-read

              move kodlar02-kodu                to yedek-pazar-kodu
              if acc-acenta-kodu = spaces
                 move tezkod02-asya-acenta-kodu to yedek-pazar-acenta-kodu xrez-acenta
              end-if 
              exit perform 
       end-read
       end-perform
       end-start
      .
*
 konum-kodu-hata-kontrol.
       initialize tezkod02-rec konum-hata-kontrol yedek-konum-kodu
       move amontext-det(12)          to tezkod02-entegre-kodu
       move "B"                       to tezkod02-tipi
       start tezkod02 key not < tezkod02-anah1 invalid
             move 1 to konum-hata-kontrol
             continue 
       not invalid
       perform with test after until fs-tezkod02 = "10"
       read tezkod02 next no lock end move "10"  to fs-tezkod02
       not at end 
              if tezkod02-entegre-kodu <> amontext-det(12) or
                 tezkod02-tipi <> "B"
                  move 1 to konum-hata-kontrol
                  exit perform 
              end-if
              call "c$justify" using tezkod02-asya-kodu , "R"
              
              initialize konum-rec
              move tezkod02-asya-kodu    to konum-anahtar
              read konum no lock invalid
                   move 1 to konum-hata-kontrol
              end-read
              move konum-anahtar         to yedek-konum-kodu
              exit perform 
       end-read
       end-perform
       end-start
      .
*
 pansiyon-kodu-hata-kontrol.
       initialize tezkod02-rec pansiyon-hata-kontrol yedek-pans-kodu
       move amontext-det(13)          to tezkod02-entegre-kodu
       move "C"                       to tezkod02-tipi
       start tezkod02 key not < tezkod02-anah1 invalid
             move 1 to pansiyon-hata-kontrol
             continue 
       not invalid
       perform with test after until fs-tezkod02 = "10"
       read tezkod02 next no lock end move "10"  to fs-tezkod02
       not at end 
              if tezkod02-entegre-kodu <> amontext-det(13) or
                 tezkod02-tipi <> "C"
                  move 1 to pansiyon-hata-kontrol
                  exit perform 
              end-if
              initialize kodlar02-rec
              move tezkod02-asya-kodu    to kodlar02-kodu
              move "A"                   to kodlar02-tipi
              read kodlar02 no lock invalid
                   move 1 to pansiyon-hata-kontrol
                   exit perform 
              end-read
              move kodlar02-kodu         to yedek-pans-kodu
              exit perform 
       end-read
       end-perform
       end-start
      .
*
 ulke-kodu-hata-kontrol.
       initialize tezkod02-rec ulke-hata-kontrol  yedek-ulke-kodu
       move amontext-det(6)          to tezkod02-entegre-kodu
       move "D"                      to tezkod02-tipi
       start tezkod02 key not < tezkod02-anah1 invalid
             move 1 to ulke-hata-kontrol
             continue 
       not invalid
       perform with test after until fs-tezkod02 = "10"
       read tezkod02 next no lock end move "10"  to fs-tezkod02
       not at end 
              if tezkod02-entegre-kodu <> amontext-det(6) or
                 tezkod02-tipi <> "D"
                  move 1 to ulke-hata-kontrol
                  exit perform 
              end-if

              initialize kodlar02-rec
              move tezkod02-asya-kodu    to ulke-anah
              read ulke no lock invalid
                   move 1 to ulke-hata-kontrol
                   exit perform 
              end-read
              move ulke-anah             to yedek-ulke-kodu
              exit perform 
       end-read
       end-perform
       end-start
      .
*
 Form1-Gd-1-Ev-Other.
      
     
     .
*
 web-servis-cagir.
      initialize yedek-cmd-user yedek-cmd-pass 
                 yedek-cmd-start-tar yedek-cmd-finish-tar

      move yedek-cb-otel-k-kodu     to yedek-cmd-user|combobox içindeki deðerden geliyor
      move yedek-cb-otel-k-sifre    to yedek-cmd-pass|combobox içindeki deðerden geliyor
 
      move ilk-gun                  to start-gun
      move ilk-ay                   to start-ay
      move ilk-yil                  to start-yil
      move start-tar                to yedek-cmd-start-tar

      move son-gun                  to finish-gun
      move son-ay                   to finish-ay
      move son-yil                  to finish-yil
      move finish-tar               to yedek-cmd-finish-tar

      inspect yedek-cmd-user        replacing trailing spaces by low-values
      inspect yedek-cmd-pass        replacing trailing spaces by low-values
      inspect yedek-cmd-start-tar   replacing trailing spaces by low-values
      inspect yedek-cmd-finish-tar  replacing trailing spaces by low-values

      move all low-values           to cmd-user 

      string cmd-user
             yedek-cmd-user         delimited by low-values
             " "                    delimited by low-values
             yedek-cmd-pass         delimited by low-values
             " "                    delimited by low-values 
             yedek-cmd-start-tar    delimited by low-values
             " "                    delimited by low-values 
             yedek-cmd-finish-tar   delimited by low-values
             " "                    delimited by low-values
             tarih-tasi             delimited by low-values 
             ".txt"                 delimited by low-values 
      into cmd-user
              
      inspect cmd-user replacing all low-values by spaces
      if os-is-unix
         call "c$system" using cmd-line,CSYS-DESKTOP 
                giving return-code

         if return-code <> 1
            display message box "Web Servis Baglantisi Kurulamadi."new-line
                                "Lutfen Tekrar Deneyiniz.."
                            title "[ Uyari ]"
                            icon 1
             move 1  to web-servis-hata
             exit paragraph 
         end-if
          
         move "@[DISPLAY]:C:\Acucorp\Acucbl701\AcuGT\pdf_temp\"  to kaynak(1:47)
         move tarih-tasi                                         to kaynak(48:8)
         move ".txt"                                             to kaynak(56:4)

         move "/asya/ytl/liste/"                                 to hedef(1:16)
         move tarih-tasi                                         to hedef(17:8)
         move ".txt"                                             to hedef(25:4)

         call "c$copy" using kaynak, 
                             hedef
                             returning return-code 
      end-if.
*
 tarih-kontrol.
     initialize hata-tarih
     if ilk-tar < tarih-tasi
        display message box "Baslangic Tarihi Onburo Calisma Tarihinden Kucuk Olamaz.."
                        title "[ Uyari ]"
                        icon 1
        move 4  to accept-control
        move 9  to control-id
        move 1  to hata-tarih
     end-if
     if son-tar < ilk-tar
          display message box "Baslangic Tarihi Bitis Tarihinden Buyuk Olamaz." new-line
                              "Lutfen Kontrol Ediniz.."
                          title "[ Uyari ]"
                          icon 1
        move 4  to accept-control
        move 9  to control-id
        move 1  to hata-tarih
     end-if

     open input takvim
     initialize takvim-rec 
     move ilk-tar              to takvim-anah
     read takvim no lock invalid
          move 1    to hata-tarih
          display message box "Baslangic Tarihi Hatali.."new-line
                              "Lutfen Kontrol Ediniz."
                          title "[ Uyari ]"
                          icon 1
        move 4  to accept-control
        move 9  to control-id
     end-read

     initialize takvim-rec 
     move son-tar              to takvim-anah
     read takvim no lock invalid
          move 1    to hata-tarih 
          display message box "Bitis Tarihi Hatali.."new-line
                              "Lutfen Kontrol Ediniz."
                          title "[ Uyari ]"
                          icon 1
        move 4  to accept-control
        move 12 to control-id

     end-read
     close takvim

      .
*
 rez-kayit-kontrol.
     initialize rez-rec voucher-var 
     move amontext-det(1)  to rez-voucher
     move "I"              to rez-durumu
     start rez key not < rez-vouc invalid
           continue 
     not invalid
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10"  to fs-rez
     not at end
            if rez-voucher <> amontext-det(1) or
               rez-durumu <> "I"
                  move 1 to voucher-var
                  exit perform 
            end-if
            move 0 to voucher-var
            exit perform 
     end-read
     end-perform      
     end-start.
*
 rez-cagir.
       inquire form1-gd-1,cursor-y in sayac
       inquire form1-gd-1(sayac,5),
               cell-data in ydk-rez
       initialize dokcagir-tasi
       set dokcagir-tasi-call-rez1    to true
       move ydk-rez                   to dokcagir-rez-no
       perform dokcagir-call
       move dokcagir-rez-no           to rez-no.
*
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 rez-fis-al.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid  
          initialize genelfis-rec
          move 1 to genelfis-anahtar
          add 1  to rez-oto
          move rez-oto to xrez-no accept-rez-no
          write genelfis-rec invalid
                rewrite genelfis-rec invalid continue
                end-rewrite 
          end-write
      not invalid
          add 1 to rez-oto 
          move rez-oto to xrez-no accept-rez-no                    
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis.

*

 rez-kaydet.


     perform rez-fis-al

     initialize rez-rec |ayný anda reze girip hata olmasýn diye :)
     move xrez-no         to rez-no
     read rez no lock invalid
          continue 
     not invalid 
         perform rez-fis-al 
     end-read
     move "1"             to xrez-tipi|ALOTMENT

*     move 0               to xrez-kucuk     |SORULACAK UNUTMA
*     move 0               to xrez-free      |SORULACAK UNUTMA
*     move 0               to xrez-bebek     |SORULACAK UNUTMA

     move 00000000        to xrez-ops-tar
     move 0               to xrez-grup-no
     move 0               to xrez-nor-indirim xrez-komisyon xrez-ozel-durum 
     move 0000            to xrez-late-zaman xrez-gel-zaman xrez-git-zaman
     move "N"             to xrez-vip
     move zeroes          to xrez-on-odeme

     initialize 1xrez-buyuk 1xrez-kucuk 1xrez-free 1xrez-bebek
                2xrez-buyuk 2xrez-kucuk 2xrez-free 2xrez-bebek
                3xrez-buyuk 3xrez-kucuk 3xrez-free 3xrez-bebek
                4xrez-buyuk 4xrez-kucuk 4xrez-free 4xrez-bebek
                5xrez-buyuk 5xrez-kucuk 5xrez-free 5xrez-bebek
                6xrez-buyuk 6xrez-kucuk 6xrez-free 6xrez-bebek
                7xrez-buyuk 7xrez-kucuk 7xrez-free 7xrez-bebek                 

                zaceanlas-1fre-ust-sinir                          
                zaceanlas-1chi-ust-sinir 
                zaceanlas-2fre-ust-sinir                          
                zaceanlas-2chi-ust-sinir 

                zaceanlas-bebek-bas-sinir 
                zaceanlas-bebek-bit-sinir                                                
 
*****     if xrez-voucher = "70127185" stop " " end-if 
     perform default-anlasma-bul
     if def-anl-bulundu = 0 
         display message box "Default Anlasma Bulunamadi..."
                         title "[ Uyari ]"
                         icon 1
         exit paragraph 
     end-if 
*     move aceanlas-1fre-ust-sinir   to zaceanlas-1fre-ust-sinir     
*     move aceanlas-2fre-ust-sinir   to zaceanlas-2fre-ust-sinir     

*     move aceanlas-1fre-ust-sinir1   to zaceanlas-1fre-ust-sinir1     
*     move aceanlas-2fre-ust-sinir1   to zaceanlas-2fre-ust-sinir1     

*     move aceanlas-1fre-ust-sinir2   to zaceanlas-1fre-ust-sinir2     
*     move aceanlas-2fre-ust-sinir2   to zaceanlas-2fre-ust-sinir2     

*     move aceanlas-1chi-ust-sinir   to zaceanlas-1chi-ust-sinir
*     move aceanlas-2chi-ust-sinir   to zaceanlas-2chi-ust-sinir
*     move aceanlas-bebek-bit-sinir  to zaceanlas-bebek-bit-sinir


 
           
     if d-tar1 <> spaces and zeroes
        move d-tar1        to yasbulson-tarih
        move xrez-gir-tar  to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit
     end-if 

     if d-tar2 <> spaces and zeroes
        move d-tar2           to yasbulson-tarih
        move xrez-gir-tar     to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit
        
     end-if 

     if d-tar3 <> spaces and zeroes
        move d-tar3        to yasbulson-tarih
        move xrez-gir-tar  to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit

     end-if 

     if d-tar4 <> spaces and zeroes
        move d-tar4        to yasbulson-tarih
        move xrez-gir-tar  to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit

     end-if 

     if d-tar5 <> spaces and zeroes
        move d-tar5        to yasbulson-tarih
        move xrez-gir-tar  to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit

     end-if 

     if d-tar6 <> spaces and zeroes
        move d-tar6        to yasbulson-tarih
        move xrez-gir-tar  to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit

     end-if 

     if d-tar7 <> spaces and zeroes
        move d-tar7        to yasbulson-tarih
        move xrez-gir-tar  to yasbulilk-tarih
        perform yas-bul
        perform yas-dagit

     end-if 
     compute xrez-buyuk = 1xrez-buyuk 
     compute xrez-kucuk = 1xrez-kucuk 
     compute xrez-free  = 1xrez-free  
     compute xrez-bebek = 1xrez-bebek 



      initialize mesaj-degiskenler gec-gecme.

      if rezpara-stops-uyari = "E" 
         perform stopsale-kontrol thru stopsale-kontrol-exit
         if rezpara-stops-gecsin = "H" and 
            stopsale-var-yok = "V" AND 
            yeni-rez = "Y" and 
            filtre-stop-kontrol = 1
              DISPLAY MESSAGE BOX "BU TARIHTE SATISA KAPALI GUN VAR" NEW-LINE
                                  "PARAMETRELER IZIN VERMEMEKTEDIR"
                              TITLE "STOP SALE "
              move 1 to gec-gecme
              go kaydet-exit
         end-if
         if stopsale-var-yok = "V" and 
            filtre-stop-kontrol = 1
            initialize mesaj-degiskenler
            move " [ SATISA KAPALI  ] "                     to mmesaj-title
            move " BU TARIHLERDE STOP-SALE TANIMLANMIS   "  to mmesaj-1
            move " STOP'A RAGMEN DEVAM ETMEK ISTERMISINIZ?" to mmesaj-2 
            move 2           to mmesaj-type
            move 1           to mmesaj-icon
            move 2           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go kaydet-exit
            end-if
         end-if
      end-if 

      if rezpara-short-uyari = "E" 
         perform short-kontrol  thru short-kontrol-exit 
         if short-var and 
            rezpara-short-gecsin = "H" and
            filtre-short-kontrol = 1 
            move 1 to gec-gecme
            exit paragraph
         end-if
      end-if 

*        move " [ Hata ] " to mmesaj-title
*        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
*        move "1000"  to  xrez-acenta

        perform acenta-oku   thru acenta-oku-exit
                if gecmez 
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
*        perform firma-oku   
*                if gecmez 
*                move "Hata Yeri : [ Firma Kodu Tanimsiz................]" to mmesaj-2
*                move 1           to mmesaj-type
*                move 3           to mmesaj-icon
*                move 1           to mmesaj-default
*                perform mmesaj-ver
*                go kaydet-exit
*                end-if


        perform banka-oku    thru banka-oku-exit
                if gecmez
                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if

        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if

        perform odeme-oku    thru odeme-oku-exit
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez
                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-gir-tar    to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-cik-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if
        if xrez-gir-tar  < tarih-tasi
           move "Hata Tipi : [ Uyumsuz Veri .......]"                to mmesaj-1
           move "Hata Yeri : [ Gecmis Tarihe Rezervasyon Girilemez]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
         end-if
        if xrez-cik-tar < xrez-gir-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if
        move "G"        to xrez-kur-aygun
        if xrez-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if
        move "K"   to xrez-k-g-b
        if xrez-k-g-b     not = "K" and not = "G" and not = "B" and not = "O"
           move "Hata Yeri : [ Kur K-G-B Tanimsiz..................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 


        move xrez-oda-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Rezervasyon Oda Konumu Tanimsiz.....]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid 
                continue
             end-read
          move xrez-fiyat-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Rezervasyon Fiyat Konumu Tanimsiz.....]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid 
                continue
             end-read

        evaluate xrez-buyuk 
        when 1
           move 1         to xrez-s-d-t-g
        when 2
           move 2         to xrez-s-d-t-g
        when 3
           move 3         to xrez-s-d-t-g
        when 4 
           move 4         to xrez-s-d-t-g
        when 5 
           move 4         to xrez-s-d-t-g
        when 6 
           move 4         to xrez-s-d-t-g
        when 7 
           move 4         to xrez-s-d-t-g
        when 8 
           move 4         to xrez-s-d-t-g
        when 9 
           move 4         to xrez-s-d-t-g
        end-evaluate

        if xrez-s-d-t-g   not = 1 and 
           xrez-s-d-t-g   not = 2 and 
           xrez-s-d-t-g   not = 3 and 
           xrez-s-d-t-g   not = 4 
           move "Hata Yeri : [ Oda Tipi Tanimsiz..[ S-D-T-G ]......]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
*        if (xrez-on-odeme not = zeroes and xrez-on-doviz = spaces) 
*           move "Hata Yeri : [ On Odeme Doviz Kodu Tanimsiz........]" to mmesaj-2
*           move 1           to mmesaj-type
*           move 3           to mmesaj-icon
*           move 1           to mmesaj-default
*           perform mmesaj-ver
*           go kaydet-exit
*        end-if 
        if xrez-buyuk  <  1 and rezpara-sifir-pax not = 1
           move "Hata Yeri : [ Buyuk Sayisi [0] Olamaz.............]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-no  <  1 
           move "Hata Yeri : [ Rezervasyon Numarasi Bos Gecilemez..]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
*        if rezpara-blokaj  = "E" 
*        perform oda-oku      thru oda-oku-exit
*                if gecmez
*                move "Hata Yeri : [ Blokaj Odasi  Tanimsiz..............]" to mmesaj-2
*                move 1           to mmesaj-type
*                move 3           to mmesaj-icon
*                move 1           to mmesaj-default
*                perform mmesaj-ver
*                go kaydet-exit
*                end-if 
*                if rezpara-blokaj-farkli = "H" and 
*                   xrez-oda-konumu not = odalar-konumu 
*                   move "Hata Yeri : [ Blokaj Odasinin Konumu Yanlis.......]" to mmesaj-2
*                   move 1           to mmesaj-type
*                   move 3           to mmesaj-icon
*                   move 1           to mmesaj-default
*                   perform mmesaj-ver
*                   go kaydet-exit
*        end-if.

*       if eski-rez and xrez-c-in = "E" 
*          initialize mesaj-degiskenler
*          move " [ Degistirilemez Rezervasyon ] " to mmesaj-title
*          move " Bu Rezervasyon C-In Yapilmis   !!! " to mmesaj-1 
*          move " Rezervasyonda Degisiklik yapilamaz " to mmesaj-2 
*          move 1           to mmesaj-type
*         move 3           to mmesaj-icon
*         move 1           to mmesaj-default
*            perform mmesaj-ver
*             go kaydet-exit
*       end-if.

*/ konfirme denetimi 
*       inquire rez-kgb-combo, value in xrez-k-g-b
*         move "K"  to xrez-k-g-b
*       if xrez-k-g-b <> "K" and yeni-rez
*          display message box 
*                  "Girmis oldugunuz rezervasyonu KONFIRME etmediniz ",new-line,
*                  "Eminmisiniz ? ",
*                  icon mb_warning_icon
*                  title "Bilginize ..."
*                  type mb_yes_no,
*                  default 2
*                  returning sunset-uyari
*          if sunset-uyari = 2
*             move 4 to accept-control
*             move 1024 to control-id
*             go kaydet-exit
*          end-if
*       end-if.

*       perform blok-kont2.
*       initialize mesaj-degiskenler
*       move " [ Kaydet Soru ] " to mmesaj-title
*       move " GIRDIGINIZ BILGILER KAYDEDILECEKTIR " to mmesaj-1.
*       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2. 
*       move 2           to mmesaj-type
*       move 1           to mmesaj-icon
*       move 1           to mmesaj-default
*       perform mmesaj-ver
*       if donus-kodu = 2 
*          go kaydet-exit
*       end-if

            open i-o genelfis
            initialize genelfis-rec
            move 1   to genelfis-anahtar
            read genelfis no lock invalid
                 continue 
            not invalid
                 add 1              to print-no
                 move print-no      to takasfiyat-no
                 rewrite genelfis-rec end-rewrite 
            end-read
            close genelfis 

            open output takasfiyat
            close takasfiyat
           open input  takvim2  kur romhrk   aksiyhrk fiyat fiyatana konuk firma
           open i-o takasfiyat
             move rez-rec to yedek-rez
             move xrez-rec to rez-rec
*            perform peryot-fiyat-bul
             move yedek-rez to rez-rec
           close takasfiyat  takvim2 kur romhrk   aksiyhrk fiyat fiyatana konuk firma
       move "Y"       to yeni-rez
       if yeni-rez = "Y" 
           accept sys-tar from century-date 
           if rez-para-isl-sistemden = 1 then
              move tarih-tasi to xrez-isl-tar  sys-tar
           else
             move sys-yil to xrez-isl-yil
             move sys-ay  to xrez-isl-ay 
             move sys-gun to xrez-isl-gun 
           end-if
       end-if. 
       move "Y" to fark-var-yok cast-fark-var-yok 
                   takvim-fark-var-yok acenhrk-fark-var-yok. 
*****if srez-durumu     not = xrez-durumu 
*****                   move "V" to fark-var-yok 
*****                   takvim-fark-var-yok acenhrk-fark-var-yok. 
*****if srez-tipi       not = xrez-tipi       move "V" to fark-var-yok. 
       if srez-acenta     not = xrez-acenta  
                          move "V" to fark-var-yok  
                          acenhrk-fark-var-yok
       end-if.
       if srez-gir-tar    not = xrez-gir-tar 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-cik-tar    not = xrez-cik-tar 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-kisi       not = xrez-kisi 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok 
       end-if.
       if srez-s-d-t-g    not = xrez-s-d-t-g 
                          move "V" to fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-k-g-b      not = xrez-k-g-b 
                          move "V" to fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok 
       end-if.
       if srez-oda-konumu not = xrez-oda-konumu 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-fiyat-konumu not = xrez-fiyat-konumu 
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-odano      not = xrez-odano 
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-bilbord-eh not = xrez-bilbord-eh 
                          move "V" to fark-var-yok 
                          move "V" to acenhrk-fark-var-yok
       end-if.
       if srez-fiyati     not = xrez-fiyati
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-anlasma    not = xrez-anlasma
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-pan-tipi   not = xrez-pan-tipi
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
      
*       if eski-rez 
*          move "I"             to xrez-durumu 
*          move k-kodu-tasi     to xrez-staf 
*          move xrez-no to rez-no
*          read rez no lock invalid
*            display message box "Hata : rezkj44"
*          end-read  
*          if rez-folio > 0 then 
*            display message box 
*            " Bu rez C/IN oldu"
*            else
*          move xrez-rec        to rez-rec 
*          move "I"             to rez-durumu
*          move mis-no to rez-profil-no
*          move ps1    to rez-profil-sirket
*          perform yanrez-kaydet
*          rewrite rez-rec invalid 
*                  write rez-rec invalid continue
*                  end-write
*          end-rewrite
*              perform log-operation-rez
*          end-if
*       end-if.
*************>Rezervasyonda cast'i etkilemeyen bilgiler degismemisse tekrar 
*************>silip yazmasin............. 
*       if eski-rez 
 

*          perform cast-sil     thru cast-sil-exit 
*          perform cast-isle    thru cast-isle-exit
*       end-if.
*       if eski-rez and acenhrk-fark-var 
*          perform acenhrk-sil  thru acenhrk-sil-exit 
*          perform acenhrk-isle thru acenhrk-isle-exit
*       end-if.
*       if eski-rez and takvim-fark-var 
*          perform takvim-sil   thru takvim-sil-exit 
*          perform takvim-isle  thru takvim-isle-exit
*       end-if.
*************> 

       if yeni-rez = "Y"
            perform hes-gonder
          move "I"             to xrez-durumu 
          move k-kodu-tasi     to xrez-staf
          move xrez-rec        to rez-rec 
          move xrez-bilbord-eh to rez-bilbord-eh
          perform cast-isle    thru cast-isle-exit 
          perform acenhrk-isle thru acenhrk-isle-exit
          perform takvim-isle  thru takvim-isle-exit 
          
          move "I"             to rez-durumu
**          move 1               to rez-online-rez
*          move mis-no to rez-profil-no
*          move ps1    to rez-profil-sirket
          perform yanrez-kaydet
          write rez-rec invalid 
                rewrite rez-rec invalid continue
                end-rewrite
          end-write
              perform log-operation-rez
       end-if.
*
 acenta-oku.
       move acc-acenta-kodu  to xrez-acenta
       open input acenta.
       initialize acenta-rec.
       move xrez-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme            
       not invalid 
*         if firma-kodu  = spaces  
            perform acen-dft-oku
*         end-if
       end-read
        if  acenta-kontenjan not = spaces 
            move acenta-kontenjan to ac-kont
        else 
          move acenta-kodu to ac-kont
        end-if
       if acenta-master not = spaces 
          move acenta-master to ac-bilb
       else 
          move acenta-kodu   to ac-bilb
        end-if
       close acenta.
       move acenta-adi       to adi-goster.
       display lb-acenta-e.
*       initialize adi-goster
*       display accept-acenta.

 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.

*
 takvim-oku.
       
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.
 takvim-oku-exit.
       exit.

 banka-oku.
       
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-banka-sabit = 1 and 
          acen-dft-banka not = xrez-banka
          display message box "Acenta icin sabit banka degeri girilmis" new-line
                              "Banka varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-banka to xrez-banka
        end-if.
       open input banka.
       initialize banka-rec.
       move xrez-banka    to banka-kodu
       read banka        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
*       move banka-adi     to adi-goster.
*       modify lb-banka-e, title = adi-goster.
*       initialize adi-goster
*       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.

 doviz-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-doviz-sabit = 1 and 
          acen-dft-doviz not = xrez-doviz
          display message box "Acenta icin sabit doviz degeri girilmis " new-line
                              "Doviz varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-doviz to xrez-doviz
        end-if.
 
 
       open input doviz.
       initialize doviz-rec.
       move xrez-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
*       move d-adi-1       to adi-goster.
*       modify lb-doviz-e, title = adi-goster.


*       initialize adi-goster
*       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.
       exit.

 ondoviz-oku.
       if xrez-on-doviz = 0 or xrez-on-doviz = spaces
          go ondoviz-oku-exit
       end-if.
       open input doviz.
       initialize doviz-rec.
       move xrez-on-doviz to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
*       move d-adi-1       to adi-goster.
*       modify lb-ondoviz-e, title = adi-goster.
*       initialize adi-goster
*       display accept-ondoviz.
 ondoviz-oku-exit.
       exit.
 ondoviz-ara-exit.
       exit.

 pansiyon-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pansiyon-sabit = 1 and 
          acen-dft-pan-tipi not = xrez-pan-tipi
          display message box "Acenta icin sabit pansiyon degeri girilmis" new-line
                              "Pansiyon varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pan-tipi to xrez-pan-tipi
        end-if.

       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xrez-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.


*       move kodlar02-adi       to adi-goster.
*       modify lb-pansiyon-e, title = adi-goster.
*       initialize adi-goster
*       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.

 odeme-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-odeme-sabit = 1 and 
          acen-dft-odeme-tipi not = xrez-odeme-tipi
          display message box "Acenta icin sabit odeme degeri girilmis" new-line
                              "odeme varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-odeme-tipi to xrez-odeme-tipi
        end-if.

       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.

*       move kodlar02-adi       to adi-goster.
*       modify lb-odeme-e, title = adi-goster.
*       initialize adi-goster
*       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.

 anlasma-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-anlasma-sabit = 1 and 
          acen-dft-anlasma not = xrez-anlasma
          display message box "Acenta icin sabit anlasma degeri girilmis" new-line
                              "Anlasma varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-anlasma to xrez-anlasma
        end-if.

       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi.
       move xrez-anlasma       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.

*       move kodlar02-adi       to adi-goster.
*       modify lb-anlasma-e, title = adi-goster.
*       initialize adi-goster
*       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.

 pazar-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pazar-sabit = 1 and 
          acen-dft-pazar not = xrez-pazar
          display message box "Acenta icin sabit pazar degeri girilmis" new-line
                              "Pazar varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pazar to xrez-pazar
        end-if.

       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move xrez-pazar         to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read .

*       move kodlar02-adi       to adi-goster.
*       modify lb-pazar-e, title = adi-goster.
*       initialize adi-goster
*       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.

 ulke-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-ulke-sabit = 1 and 
          acen-dft-ulke not = xrez-ulke 
          display message box "Acenta icin sabit ULKE  degeri girilmis" new-line
                              "ULKE  varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-ulke  to xrez-ulke 
        end-if.

       initialize ulke-rec.
       move xrez-ulke    to ulke-anah1
       read ulke         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.

*       move ulke-adi     to adi-goster.
*       modify lb-ulke-e, title = adi-goster.
*       initialize adi-goster
*       display accept-ulke.
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.
*
 oda-ara.
       exit  .
 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move xrez-odano     to odalar-anah
       read odalar         no lock invalid 
            move 1         to gec-gecme
            not invalid continue 
       end-read
       close odalar.
*       display accept-odano.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.

 cast-isle. 
          
           open input fiyat fiyatana hesayr 
           open i-o cast takasfiyat. 
           move xrez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
              go cast-isle-bitti. 
 cast-yaz-oku. 
        read takvim next no lock end go cast-isle-bitti. 
        if fs-takvim = 99 go cast-yaz-oku. 
        if takvim-anah > xrez-cik-tar go cast-isle-bitti. 
                initialize cast-rec. 
            initialize takasfiyat-rec
           move xrez-no     to  cast-rez-no
           move takvim-anah to   cast-tarih
           
           
             initialize      hesaplanan-fiyat
           if rez-gir-tar = cast-tarih and xrez-gec = 1 
            initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
           start hesayr key >= hesayr-anah invalid continue
              not invalid
              perform until fs-hesayr = "10"
                  read hesayr previous no lock end move "10" to fs-hesayr
                      not end 
                        if hesayr-rez-no = xrez-no and hesayr-tarih <= xrez-gir-tar
                          add hesayr-basilacak-tut to hesaplanan-fiyat 
                          else
                          move "10" to fs-hesayr
                        end-if
                  end-read
              end-perform
              else
               initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
               read hesayr no lock 
                      invalid 
                        continue
                  not invalid
                 move  hesayr-basilacak-tut to hesaplanan-fiyat 
               end-read
           end-if   
           if hesaplanan-fiyat = 0 then 
               move xrez-fiyati to hesaplanan-fiyat
            end-if  
        
           initialize eski-cast hesayr-rec
           read cast no lock invalid 
                 continue
                 
               not invalid
                move cast-rec to eski-cast
           end-read
               if xrez-plan not = 1 
                   move hesaplanan-fiyat     to cast-fiyati
               else
                   if cast-tarih = tarih-tasi
                       move hesaplanan-fiyat to cast-fiyati
                   end-if
               end-if
                  move hesaplanan-fiyat to cast-anlasma-fiyati
           if xrez-plan not = 1 or rez-gir-tar = cast-tarih
                   move xrez-odano        to cast-oda-no
                   move xrez-buyuk        to cast-buyuk
                   move xrez-kucuk        to cast-kucuk
        
                   move xrez-bebek        to cast-bebek
                   move xrez-free         to cast-free
                   move xrez-oda-konumu   to cast-oda-konumu
                   move xrez-fiyat-konumu to cast-fiyat-konumu
                   move xrez-anlasma      to cast-anlasma
                   move xrez-pan-tipi     to cast-pan-tipi
           end-if
       
           if takvim-anah = xrez-cik-tar
               initialize      cast-fiyati  cast-anlasma-fiyati
           end-if
           

*           move xrez-xxx          to cast-oda-adet 
*           move xrez-xxx          to cast-kisi-konaklama
        
                write cast-rec invalid 
                      rewrite cast-rec invalid continue
                      end-rewrite
                end-write
      if cast-rec not = eski-cast(1:function length(cast-rec)) then 
                perform log-operation-cast
        end-if 



            go cast-yaz-oku. 
 cast-isle-bitti. 
            close cast takasfiyat.
            close fiyat fiyatana hesayr.
 cast-isle-exit. 
     exit. 
 cast-sil. 
           open i-o cast. 
         initialize cast-rec. 
        move xrez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-sil-bitti. 
 cast-sil-oku. 
        read cast  next no lock end go cast-sil-bitti. 
        if fs-cast = 99 go cast-sil-oku. 
        if cast-rez-no > xrez-no go cast-sil-bitti. 
        if cast-rez-no = xrez-no continue
        else 
           go cast-sil-oku
        end-if.
        if cast-tarih  < xrez-gir-tar or 
           cast-tarih  > xrez-cik-tar
        continue
        else 
           go cast-sil-oku
        end-if.
        delete cast invalid 
          continue.
          perform log-operation-cast
            go cast-sil-oku. 
 cast-sil-bitti. 
         close cast. 
 cast-sil-exit. 
     exit. 
 cast-iptal. 
***********> Bu bolum silinen rezervasyonlari casta silinmis olarak isletmek 
***********> icin konulmustu iptal edildi........... 
           open i-o cast. 
        initialize cast-rec. 
        move rez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-iptal-bitti. 
 cast-ipt-oku. 
        read cast  next no lock end go cast-iptal-bitti. 
        if fs-cast = 99 go cast-ipt-oku. 
        if cast-rez-no > rez-no go cast-iptal-bitti. 
        if cast-rez-no = rez-no continue
        else 
           go cast-ipt-oku
        end-if. 
********move "S" to cast-durumu. 
        rewrite cast-rec invalid 
            continue.
         perform log-operation-cast
            go cast-ipt-oku. 
 cast-iptal-bitti. 
         close cast. 
 cast-iptal-exit. 
     exit. 
 acenhrk-isle. 
********if xrez-tipi = 1 continue else go acenhrk-isle-exit. 
        if xrez-k-g-b = "K" continue
        else 
           go acenhrk-isle-exit
        end-if. 
        open i-o acenhrk. 
 acenhrk-basla. 
         move xrez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
               go acenhrk-isle-bitti. 
 acenhrk-oku-yaz. 
         read takvim next no lock end 
              go acenhrk-isle-bitti. 
         if fs-takvim = 99 go acenhrk-oku-yaz. 
         if takvim-anah = xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
         if takvim-anah > xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
********>Bilbord rezervasyona yazsin..
         if xrez-bilbord-eh = "E" and 
            filtre-bilbord-isle = 1
               perform bilbord-isle thru bilbord-isle-exit
         end-if.
********>Bilbord rezervasyona yazsin...
         if fark-yok 
            go acenhrk-oku-yaz
         end-if
           move ac-kont to acenhrk-acenta
*****          move xrez-acenta      to acenhrk-acenta. 
          move takvim-anah        to acenhrk-tarih. 
          move xrez-fiyat-konumu  to acenhrk-oda-konumu. 
          move xrez-s-d-t-g       to acenhrk-s-d-t-g  
         read acenhrk no lock 
              invalid  
                  initialize acenhrk-rec  
                     move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g
                  move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
         end-write 
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue end-rewrite  
         end-read  
           move ac-kont to acenhrk-acenta

****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41 to acenhrk-oda-konumu  
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
           invalid  
                  initialize acenhrk-rec 
                    move ac-kont to acenhrk-acenta
****                 move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g  
                   move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write  
           not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move xrez-fiyat-konumu  to acenhrk-oda-konumu  
          move 5     to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid 
                  initialize acenhrk-rec 
                   move ac-kont to acenhrk-acenta 
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move 5     to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write 
         not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
            move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41  to acenhrk-oda-konumu  
          move 5    to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid
                  initialize acenhrk-rec  
                    move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move 5   to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                       rewrite acenhrk-rec invalid continue
                       end-rewrite
                  end-write
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue
                  end-rewrite
         end-read
         go acenhrk-oku-yaz. 
 acenhrk-isle-bitti. 
        close acenhrk .
 acenhrk-isle-exit. 
      exit. 

*
 acenhrk-sil. 
********if srez-tipi = continue else go acenhrk-sil-exit. 
        if srez-k-g-b = "K" continue
        else 
           go acenhrk-sil-exit
        end-if. 
        open i-o acenhrk . 
 acenhrk-s-basla. 
           move srez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
                 go acenhrk-sil-bitti. 
 acenhrk-oku-sil. 
        read takvim next no lock end 
             go acenhrk-sil-bitti. 
        if fs-takvim = 99 go acenhrk-oku-sil. 
        if takvim-anah = srez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
        if takvim-anah > srez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
********>Bilbord rezervasyona yazsin..
*         if srez-bilbord-eh = "E"
*            perform bilbord-sil thru bilbord-sil-exit
*         end-if.
********>Bilbord rezervasyona yazsin..
         if fark-yok 
            go acenhrk-oku-sil 
         end-if
            move ac-kont to acenhrk-acenta
*****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move srez-fiyat-konumu  to acenhrk-oda-konumu. 
           move srez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
           not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
           rewrite acenhrk-rec invalid continue end-rewrite
           end-read
             move ac-kont to acenhrk-acenta
****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move srez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
            not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
***           move srez-acenta      to acenhrk-acenta. 
             move ac-kont to acenhrk-acenta
           move takvim-anah      to acenhrk-tarih. 
           move srez-fiyat-konumu  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
          not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
*****         move srez-acenta      to acenhrk-acenta 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
           not invalid  
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek

            rewrite acenhrk-rec invalid continue end-rewrite
          end-read
          go acenhrk-oku-sil. 
 acenhrk-sil-bitti. 
          close acenhrk . 
 acenhrk-sil-exit. 
        exit. 
 takvim-isle. 
        if xrez-k-g-b = "K" 
           continue
        else 
           go takvim-isle-exit
        end-if. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-isle-exit. 
 takvim-oku-yaz. 
        read takvim next no lock end go takvim-isle-exit. 
        if fs-takvim = 99 go takvim-oku-yaz. 
        if takvim-anah = xrez-cik-tar go takvim-isle-exit. 
        if takvim-anah > xrez-cik-tar go takvim-isle-exit. 
          compute takvim-sat-oda(xrez-oda-konumu)   = 
                  takvim-sat-oda(xrez-oda-konumu)   + 1. 
          compute takvim-sat-buyuk(xrez-oda-konumu) = 
                  takvim-sat-buyuk(xrez-oda-konumu) + xrez-buyuk. 
          compute takvim-sat-kucuk(xrez-oda-konumu) = 
                  takvim-sat-kucuk(xrez-oda-konumu) + xrez-kucuk. 
          compute takvim-sat-free(xrez-oda-konumu)  = 
                  takvim-sat-free(xrez-oda-konumu)  + xrez-free. 
          compute takvim-sat-free(xrez-oda-konumu)  = 

                  takvim-sat-free(xrez-oda-konumu)  + xrez-bebek.
        rewrite takvim-rec invalid go takvim-oku-yaz. 
            go takvim-oku-yaz. 
 takvim-isle-exit. 
     exit. 

 takvim-sil. 
        if srez-k-g-b = "K" continue
        else 
           go takvim-sil-exit
        end-if. 
        move srez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-sil-exit. 
 takvim-oku-sil. 
        read takvim next no lock end go takvim-sil-exit. 
        if fs-takvim = 99 go takvim-oku-sil. 
        if takvim-anah = srez-cik-tar go takvim-sil-exit. 
        if takvim-anah > srez-cik-tar go takvim-sil-exit. 
          compute takvim-sat-oda(srez-oda-konumu)   = 
                  takvim-sat-oda(srez-oda-konumu)   - 1. 
          compute takvim-sat-buyuk(srez-oda-konumu) = 
                  takvim-sat-buyuk(srez-oda-konumu) - srez-buyuk. 
          compute takvim-sat-kucuk(srez-oda-konumu) = 
                  takvim-sat-kucuk(srez-oda-konumu) - srez-kucuk. 
          compute takvim-sat-free(srez-oda-konumu)  = 
                  takvim-sat-free(srez-oda-konumu)  - srez-free. 
          compute takvim-sat-free(srez-oda-konumu)  = 
                  takvim-sat-free(srez-oda-konumu)  - srez-bebek.
        rewrite takvim-rec invalid go takvim-oku-sil. 
            go takvim-oku-sil. 
takvim-sil-exit. 
     exit. 
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 

*
 yanrez-kaydet.
       open i-o yanrez
       initialize yanrez-rec
       move 1          to yanrez-sirano
       move rez-adi    to yanrez-adi
       move rez-soyadi to yanrez-soyadi

       perform ortak-yanrez

       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
           
    if adi2 not = spaces or 
       soy2 not = spaces then
       initialize yanrez-rec
       move 2 to yanrez-sirano
       move adi2   to yanrez-adi
       move soy2   to yanrez-soyadi
       move d-tar2 to yanrez-dog-tar

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
     else
         move rez-no      to yanrez-rezno
         move 2 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi3 not = spaces or soy3 not = spaces then
       initialize yanrez-rec
       move 3 to yanrez-sirano
       move adi3   to yanrez-adi
       move soy3   to yanrez-soyadi
       move d-tar3 to yanrez-dog-tar

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
        else
         move rez-no      to yanrez-rezno
         move 3 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi4 not = spaces or soy4 not = spaces then
       initialize yanrez-rec
       move 4 to yanrez-sirano
       move adi4   to yanrez-adi
       move soy4   to yanrez-soyadi
       move d-tar4 to yanrez-dog-tar

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 4 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi5 not = spaces or soy5 not = spaces then
       initialize yanrez-rec
       move 5 to yanrez-sirano
       move adi5   to yanrez-adi
       move soy5   to yanrez-soyadi
       move d-tar5 to yanrez-dog-tar

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 5 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi6 not = spaces or soy6 not = spaces then
       initialize yanrez-rec
       move 6 to yanrez-sirano
       move adi6   to yanrez-adi
       move soy6   to yanrez-soyadi
       move d-tar6 to yanrez-dog-tar

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 6 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if

    if adi7 not = spaces or soy7 not = spaces then
       initialize yanrez-rec
       move 7 to yanrez-sirano
       move adi7   to yanrez-adi
       move soy7   to yanrez-soyadi
       move d-tar7 to yanrez-dog-tar

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 7 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if

    close yanrez.

kaydet-exit. 
     exit. 
*
 ortak-yanrez.
      move rez-no      to yanrez-rezno
      move rez-gir-tar to yanrez-gel-tar
      move rez-cik-tar to yanrez-git-tar
      move rez-odano   to yanrez-odano.
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 hes-gonder.
      if Xrez-folio > 0 then 
*        if key-status not = 2 
            display message box "CIN olmus rezervasyon register kartindan deneyiniz" title "DIKKAT"
*            exit paragraph
*        end-if
       end-if

         initialize linkh-odahes
         move xrez-no to  linkh-rez-no     
         move 1       to linkh-nereden  
         move 0       to linkh-anl-yaz
         move 0       to linkh-cast-yaz
          call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
            
          if  "E" = xrez-eb
               continue 
*              modify eraly-booking-cb, value = 1
           else
               continue 
*              modify eraly-booking-cb, value = 0
        end-if
         
*              display ug-cb
              open input hesayr
            initialize hesayr-rec
            move  xrez-no to hesayr-rez-no
            evaluate true
               when tarih-tasi > rez-cik-tar
                  move xrez-gir-tar to hesayr-tarih
               when tarih-tasi <= rez-gir-tar
                  move xrez-gir-tar to hesayr-tarih
               when other
                  move tarih-tasi   to hesayr-tarih
            end-evaluate
             read hesayr  no lock invalid
                 continue
             not invalid
                  move hesayr-basilacak-tut to xrez-fiyati
             end-read
              if xrez-gec = 1 and 
                 tarih-tasi <= rez-gir-tar
                 initialize hesayr-rec
                  move  xrez-no     to hesayr-rez-no  
                  move xrez-gir-tar to hesayr-tarih
                  start hesayr key < hesayr-anah invalid 
                       continue
                  not invalid                      
                  read hesayr previous no lock end 
                       continue
                  not end
                       add hesayr-basilacak-tut to xrez-fiyati  
                  end-read
                  end-start
              end-if


              close  hesayr.  
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
*           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
*           move  rezpara-ulke       to acen-dft-ulke
*           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
     perform acen-dft-yukle.
*
 acen-dft-yukle.
       move acen-dft-banka        to xrez-banka
       move acen-dft-doviz        to xrez-doviz
       move acen-dft-odeme-tipi   to xrez-odeme-tipi
       if acen-dft-bilboard = 1
          move "E" to xrez-bilbord-eh       
       else
          move "H" to xrez-bilbord-eh                 
       end-if.
*       move   acen-dft-anlasma       to xrez-anlasma.
*
 default-anlasma-bul.
     open input aceanlas
     initialize aceanlas-rec def-anl-bulundu
     move xrez-acenta       to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end

         if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
            if onkpara-referans-var = 1 
               evaluate onkpara-referans-nerden
                   when 1 
                        open input konum 
                        initialize konum-rec 
                        move xrez-fiyat-konumu to konum-anahtar 
                        read konum no lock invalid
                             continue
                        end-read 
                        close konum
                        if aceanlas-referans not = spaces and aceanlas-referans not = 0
                           if konum-ref not = aceanlas-referans
                              exit perform cycle
                           end-if
                        end-if 
                   when 2
                        open input odalar 
                        initialize odalar-rec 
                        move xrez-odano to odalar-rec 
                        read odalar no lock invalid
                             continue
                        end-read 
                        close odalar 
                        if aceanlas-referans not = spaces and aceanlas-referans not = 0
                           if odalar-referans not = aceanlas-referans
                              exit perform cycle
                           end-if
                        end-if
               end-evaluate 
            end-if
         end-if   |||X

           if xrez-acenta not = aceanlas-acenta then
               move "10"      to fs-aceanlas 
           else
             if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
                xrez-gir-tar >= aceanlas-donem-bas and
                xrez-gir-tar <= aceanlas-donem-bit then 
                move 1 to def-anl-bulundu
*                if not eski-rez 
*                   display message box "Acentaya ait Anlasma Bulundu" new-line
*                                       "Anlasma tipi degistirilecektir...."
*                end-if
                move "10" to fs-aceanlas 
             end-if
           end-if
     end-read
     end-perform
     end-start
     close aceanlas

     if def-anl-bulundu = 1
*       if eski-rez and 
*          aceanlas-anlasma <> xrez-anlasma
*          move 1     to def-anl-uyumsuz
*          move aceanlas-anlasma        to ydk-aceanlas-anlasma
*          move  "Gercek Anlasma Kodu:" to deg-yazi
*               modify Form1-Pb-2, visible = true
*               modify Form1-Pb-2, title deg-anlasma 
*                                 
*          exit paragraph
*       end-if
       move "Y"                    to yeni-rez
       if yeni-rez = "Y"
          move aceanlas-anlasma     to xrez-anlasma
          move aceanlas-ear         to xrez-eb
          move aceanlas-aks-yok     to xrez-aksiyon-eh
          move aceanlas-spe-yok     to xrez-special-eh
*         perform anlasma-oku   
       
          if xrez-aksiyon-eh = "1"
             move "H"               to xrez-aksiyon-eh
          else
             move "E"               to xrez-aksiyon-eh
          end-if   
       
          if xrez-eb = "1"
             move "E"               to xrez-eb
          else
             move "H"               to xrez-eb
          end-if
       end-if 
     end-if.

*
 yas-bul.
    
     subtract yasbulson-gun from yasbulilk-gun giving yasbulfark-gun                                        
     if yasbulfark-gun < 0 then 
       subtract 1 from yasbulilk-ay  
       evaluate yasbulilk-ay
          when 1 
          when 3 
          when 5 
          when 7 
          when 8 
          when 10 
          when 0
             add 31 to yasbulfark-gun 
          when 2
             divide yasbulilk-yil by 4 giving bolum remainder kalan
             if kalan = 0 then 
                 add 29 to yasbulfark-gun 
             else
                 add 28 to yasbulfark-gun
             end-if
          when other 
             add 30 to yasbulfark-gun 
       end-evaluate
     end-if
     subtract yasbulson-ay from yasbulilk-ay giving yasbulfark-ay 
     if yasbulfark-ay < 0 then 
       add 12 to yasbulfark-ay 
       subtract 1 from yasbulilk-yil
     end-if
     subtract yasbulson-yil from yasbulilk-yil giving yasbulfark-yil 
     compute yasbulfark-yil-say  rounded  =  yasbulfark-yil
          + ( yasbulfark-ay / 12 ) + ( yasbulfark-GUN / 365 )  
     move yasbulfark-yil-say          to yasz.
 stopsale-kontrol. 
      open input aksiyhrk grup.
 stopsale-oku. 
        move "Y" to stopsale-var-yok.
        move xrez-gir-tar to takvim-anah
        start takvim key >= takvim-anah 
          invalid
          continue
           not invalid
         perform until fs-takvim = "10" or  stopsale-var-yok = "V"
          read takvim next no lock 
           end move "10" to fs-takvim
           not end 
           if takvim-anah >= xrez-cik-tar
             move "10" to fs-takvim
           else
             move "S"           to aksiyhrk-tipi
             move xrez-acenta   to aksiyhrk-acenta 
             move takvim-anah  to aksiyhrk-tarih 
             move xrez-fiyat-konumu to aksiyhrk-pan-tipi
             move 0             to aksiyhrk-gecele
             read aksiyhrk no lock invalid 
               continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
             end-read      

          initialize  aksiyhrk-pan-tipi
          read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
          end-read      

         initialize aksiyhrk-acenta
         read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
         end-read     
         move xrez-fiyat-konumu to aksiyhrk-pan-tipi
         read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
         end-read     
         initialize grup-rec
         move "A" to grup-tipi
         start grup key > grup-anah
           invalid
            continue
           not invalid
             perform until fs-grup = "10" 
              read grup next no lock 
                end move "10" to fs-grup
                not end
                 if grup-tipi not = "A" then
                     move "10" to fs-grup
                   else
                     if grup-alt = xrez-acenta 
                       
                        move grup-kodu to aksiyhrk-acenta
                        initialize  aksiyhrk-pan-tipi

                         read aksiyhrk no lock invalid 
                            continue
                         not invalid
                        
                        move "V" to stopsale-var-yok
                         exit perform 
                       end-read  
                        move xrez-fiyat-konumu to aksiyhrk-pan-tipi
                          read aksiyhrk no lock invalid 
                            continue
                         not invalid
                        
                        move "V" to stopsale-var-yok
                         exit perform 
                       end-read  
                     end-if
                 end-if
               end-read
             end-perform 
         end-start
         end-if
        end-read
        end-perform
        end-start.

 stopsale-kontrol-exit.
          if stopsale-var-yok = "V" then
            initialize mesaj-degiskenler
            move " [ Stop Sale Uyari] " to mmesaj-title
            move " Bu Acentaya Stop-Sale Cekilmis....... "  to mmesaj-1
            move " Bu Tarihlere Rezervasyon Girmeyin.... "  to mmesaj-2
            move 1           to mmesaj-type
            move 2           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            end-if
            close      aksiyhrk grup.  
*
 short-kontrol.
*            open input konum.
            initialize konum-rec short-1konum short-toplam.
            move xrez-oda-konumu   to konum-anahtar.
            read konum no lock invalid 
                 initialize konum-rec.
*            close konum.
        move "Y" to short-var-yok.
        move xrez-gir-tar to takvim-anah.
        start takvim key not < takvim-anah invalid 
              go short-kontrol-bitti.
 short-oku.
         read takvim next no lock end go short-kontrol-bitti.
         if fs-takvim = 99 go short-oku.
         if takvim-anah = xrez-cik-tar  go short-kontrol-bitti.
         if takvim-anah > xrez-cik-tar  go short-kontrol-bitti.
            initialize short-1konum short-toplam.
         compute short-1konum =  1 +
                 takvim-sat-oda(xrez-oda-konumu) .
         compute short-toplam =  1 +
                 takvim-sat-oda(1) + takvim-sat-oda(2) +
                 takvim-sat-oda(3) + takvim-sat-oda(4) +
                 takvim-sat-oda(5) + takvim-sat-oda(6) +
                 takvim-sat-oda(7) + takvim-sat-oda(8) +
                 takvim-sat-oda(9) + takvim-sat-oda(10) + 
                 takvim-sat-oda(11) + takvim-sat-oda(12) +
                 takvim-sat-oda(13) + takvim-sat-oda(14) +
                 takvim-sat-oda(15) + takvim-sat-oda(16) +
                 takvim-sat-oda(17) + takvim-sat-oda(18) +
                 takvim-sat-oda(19) + takvim-sat-oda(20) +
                 takvim-sat-oda(21) + takvim-sat-oda(22) +
                 takvim-sat-oda(23) + takvim-sat-oda(24) +
                 takvim-sat-oda(25) + takvim-sat-oda(26) +
                 takvim-sat-oda(27) + takvim-sat-oda(28) +
                 takvim-sat-oda(29) + takvim-sat-oda(30) + 
                 takvim-sat-oda(31) + takvim-sat-oda(32) +
                 takvim-sat-oda(33) + takvim-sat-oda(34) +
                 takvim-sat-oda(35) + takvim-sat-oda(36) +
                 takvim-sat-oda(37) + takvim-sat-oda(38) +
                 takvim-sat-oda(39) + takvim-sat-oda(40)



                 .
         if short-1konum > konum-hazir-oda  
            perform 1konum-shortta
                 go short-kontrol-bitti
         end-if.
         if short-toplam > takvim-hazir-oda 
            perform toplam-shortta
                 go short-kontrol-bitti
         end-if.
            go short-oku.
*
 short-kontrol-bitti.
     exit.
 short-kontrol-exit.
    exit.

*
 1konum-shortta.
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Oda Konumunuz Short'ta ] " to mmesaj-title
       move "Bu Tarihte"                           to mmesaj-1(01:10)
       move konum-adi(01:10)                       to mmesaj-1(12:10)
       move "Oda Shortta"                          to mmesaj-1(23:11)
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move konum-hazir-oda  to mmesaj-2(22:04)
       move short-1konum     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 toplam-shortta.
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Tum Konumlar Short'ta ] " to mmesaj-title
       move "Bu Tarihte Tum Konumlar Short'ta"     to mmesaj-1
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move takvim-hazir-oda to mmesaj-2(22:04)
       move short-toplam     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver.
 bilbord-isle. 
          initialize bilbord-rec.
           move ac-bilb to bilbord-acenta
          
*********          move xrez-acenta      to bilbord-acenta. 
          move takvim-anah      to bilbord-tarih. 
          move xrez-oda-konumu  to bilbord-oda-tip. 

         read bilbord no lock invalid 
              initialize bilbord-rec
              move ac-bilb to bilbord-acenta
****              move xrez-acenta      to bilbord-acenta
              move takvim-anah      to bilbord-tarih 
              move xrez-oda-konumu  to bilbord-oda-tip 
              write bilbord-rec invalid 
                    display message box "Bilborda yazilamadi hata no : bil-1001"
              end-write
         end-read.
          compute  bilbord-sat-oda   = bilbord-sat-oda   + 1. 
          compute  bilbord-sat-buyuk = bilbord-sat-buyuk + xrez-buyuk. 
         rewrite bilbord-rec invalid 
                 display message box "Bilborda yazilamdi hata no : bil-1002"
         end-rewrite.
 bilbord-isle-exit. 
      exit. 
*
 Form1-Aft-Initdata.      
      open input tezkod02 
      initialize tezkod02-rec 
      move "E"                  to tezkod02-tipi
      start tezkod02 key not < tezkod02-anah invalid
            continue 
      not invalid 
      perform with test after until fs-tezkod02 = "10"
      read tezkod02 next no lock end move "10"  to fs-tezkod02
      not at end 
              if tezkod02-tipi <> "E"
                  exit perform 
              end-if
              initialize yedek-cb-otel
              move tezkod02-kodu             to yedek-cb-otel-kodu
              move tezkod02-entegre-kodu     to yedek-cb-otel-adi
              move tezkod02-k-adi            to yedek-cb-otel-k-kodu
              move tezkod02-k-sifre          to yedek-cb-otel-k-sifre
              move yedek-cb-otel             to cb-otel-value
              modify cb-otel, ITEM-TO-ADD(cb-otel-value)
      end-read
      end-perform
      end-start
      close tezkod02
     
     .
*
 cb-otel-Ex-Ntf-Selchange.
      move cb-otel-value         to yedek-cb-otel
     .
*
 yas-dagit.
          evaluate true
          when 1xrez-buyuk < 2

                        evaluate true
                        when (yasz > zaceanlas-1chi-ust-sinir and 1xrez-kucuk = 0) or
                             (yasz > zaceanlas-2chi-ust-sinir and 1xrez-kucuk > 0)
                               add 1           to 1xrez-buyuk                                                 
                        when yasz <= zaceanlas-bebek-bit-sinir
                               add 1           to 1xrez-bebek
                        when other
                             if (yasz <= zaceanlas-2fre-ust-sinir1 and 1xrez-free = 0) or 
                                (yasz <= zaceanlas-2fre-ust-sinir2 and 1xrez-free > 0)
                                   add 1 to 1xrez-free
                             else
                                   add 1 to 1xrez-kucuk
                             end-if 
                        end-evaluate


     

          when other
             evaluate true
             when 1xrez-kucuk = 0
                        evaluate true
                        when (yasz > zaceanlas-1chi-ust-sinir and 1xrez-kucuk = 0) or
                             (yasz > zaceanlas-2chi-ust-sinir and 1xrez-kucuk > 0)
                               add 1           to 1xrez-buyuk                                                 
                        when yasz <= zaceanlas-bebek-bit-sinir
                               add 1           to 1xrez-bebek
                        when other
                             if (yasz <= zaceanlas-1fre-ust-sinir and 1xrez-free = 0) or 
                                (yasz <= zaceanlas-2fre-ust-sinir and 1xrez-free > 0)
                                   add 1 to 1xrez-free
                             else
                                   add 1 to 1xrez-kucuk
                             end-if 
                        end-evaluate

             when 1xrez-kucuk > 0
                        evaluate true
                        when (yasz > zaceanlas-1chi-ust-sinir and 1xrez-kucuk = 0) or
                             (yasz > zaceanlas-2chi-ust-sinir and 1xrez-kucuk > 0)
                               add 1           to 1xrez-buyuk                                                 
                        when yasz <= zaceanlas-bebek-bit-sinir
                               add 1           to 1xrez-bebek
                        when other
                             if (yasz <= zaceanlas-1fre-ust-sinir1 and 1xrez-free = 0) or 
                                (yasz <= zaceanlas-1fre-ust-sinir2 and 1xrez-free > 0)
                                   add 1 to 1xrez-free
                             else
                                   add 1 to 1xrez-kucuk
                             end-if 
                        end-evaluate


              end-evaluate
          end-evaluate.

 
