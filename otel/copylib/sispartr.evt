* sispartr.evt
* sispartr.evt is generated from D:\asya\acugt.ytl\otel\sispartr.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM exception-procedure
     .
***   start event editor code   ***
*
 Form1-Bef-Create.   
       perform adresleri-tasi.
*
 before-procedure.     
             .

 Form1-Aft-Initdata. 
    open i-o odalar2 fiyatind close odalar2 fiyatind   
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid
          initialize mesaj-link
          move 03 to mesaj-no
          perform mesaj-ver
    not invalid
        move cost-sirketi  to kart-dosya-adres
    end-read
    close genel.
*      
 exception-procedure. 
     evaluate key-status
          when 2 
               open output trnot
                  perform islem-yap 
               close trnot
               display  message box "Islem Bitti" new-line
                                    "Invalid-Rez : ", rez-say
*         when 3         
*             perform dep-duzelt
*         when 4
*             perform cast-duzelt    
*         when 5
*            perform rez-pazar-at
         end-evaluate. 
*
 islem-yap.
    if kur-ayir = 1
       perform doviz-al
       perform kur-al
    end-if
          
    if tanim-value  = 1 then
           perform depkod-al
           perform acenta-firma-al
           perform konum-al      
           perform oda-al
*           perform ulke-al
*           perform kaynak-al
*           perform pazar-al
    end-if

*        if fih-value = 1
*            perform fihrist-al
*        end-if 
        
    if rez-value  = 1 then 
*           open output rez konuk  ozluk  polisxml yanrez frez fextra froom  fpans
*           close rez konuk ozluk polisxml   yanrez frez fextra froom  fpans  
       perform rez-al  
       perform xyrez-al
*                perform arez-al
*               perform efolio-al
*               perform cin-yap
                                                                             
    end-if
*        if profil-value = 1 
*            perform profil-al
*        end-if 
*          if fat-val = 1
*             perform fat-pen-al
*         end-if                       
 

*          if hrk-value = 1 then 
*             move 1000000 to uuasya-sira
*             open input fdepkod  
*             open output romhrk exthrk yromhrk hrk2 folref
*             close romhrk exthrk yromhrk hrk2 folref
*                     perform hrk-al
*             close fdepkod  
*        end-if

*         if grup-al = 1
*            open output blok gruplar fgrup
*            close gruplar blok fgrup

*            perform grup-al-yeni
*            perform blok-al-yeni
*
*            perform bilbord-al 
*            perform bilhrk-al
*         end-if

*         if cast-ayir = 1
*             perform cast-al
*         end-if
*         if fiyat-yaz = 1  
*            perform cast-rez-fiy-yaz
*         end-if.
          .
*
 xiii-rezal.
    move "yrez.txt"  to fidetext-adi
*    move 1          to tmp-ulke
    open input fidetext
    open i-o rez yanrez konuk tyrez
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
       initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec 
    perform varying k from 1 by 1 until k > 100
    unstring fidetext-rec delimited by x"09"
         into amontext-det(k) pointer sayac
    end-perform

        if amontext-det(1) = spaces 
           exit perform cycle
        end-if


        if amontext-det(28) <> spaces 

        end-if
    end-read
    end-perform 
        .
*
 xyrez-al.            
    perform tyrez-dosya-ac
    stop " "
    move "yrez.txt"  to fidetext-adi
*    move 1          to tmp-ulke
    open input fidetext
    open i-o rez yanrez konuk tyrez
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
       initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec 
    perform varying k from 1 by 1 until k > 100
    unstring fidetext-rec delimited by x"09"
         into amontext-det(k) pointer sayac
    end-perform

        if amontext-det(1) = spaces 
           exit perform cycle
        end-if


        if amontext-det(28) <> spaces 
           initialize tyrez-rec        | yanrez-rec dolduruluyor... rez-oku       lck-rec
           move function numval(amontext-det(28)) to tyrez-rezno 
           move 1                                 to tyrez-sirano
*           if tyrez-rezno = 771 stop " " end-if
           read tyrez no lock invalid
                unstring amontext-det(5) delimited by "."            | yanrez-gel-tar kontrol                    
                    into tyrez-gel-gun tyrez-gel-ay tyrez-gel-yil
                
                if amontext-det(5)(9:1) = space
                   move amontext-det(5)(5:4) to tyrez-gel-yil
                else
                   if amontext-det(5)(10:1) = space
                      move amontext-det(5)(6:4) to tyrez-gel-yil
                   else
                      if amontext-det(5)(11:1) = space
                         move amontext-det(5)(7:4) to tyrez-gel-yil
                      end-if
                   end-if
                end-if

                unstring amontext-det(6) delimited by "."            | yanrez-git-tar kontrol                    
                    into tyrez-git-gun tyrez-git-ay tyrez-git-yil
                
                if amontext-det(6)(9:1) = space
                   move amontext-det(6)(5:4) to tyrez-git-yil
                else
                   if amontext-det(6)(10:1) = space
                      move amontext-det(6)(6:4) to tyrez-git-yil
                   else
                      if amontext-det(6)(11:1) = space
                         move amontext-det(6)(7:4) to tyrez-git-yil
                      end-if
                   end-if
                end-if
                move amontext-det(3) to tyrez-adi
                move amontext-det(2) to tyrez-soyadi
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                          to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                          to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                             to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                             to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100

                if amontext-det(10) <> spaces                        | rez-acenta
                   initialize facenta-rec 
                   move amontext-det(10) to facenta-fide-kodu
                   read facenta no lock invalid
                        stop " "
                        move "9998" to rez-acenta
                   not invalid
                       move facenta-asya-kodu to rez-acenta
                   end-read 
                else
                   move "9998" to rez-acenta 
                end-if


                move tyrez-gel-tar to tmp-gel-tar
                move tyrez-git-tar to tmp-git-tar
                if tyrez-rezno = 0 stop " " end-if
                write tyrez-rec invalid
                        stop " "
                end-write 
           not invalid
                unstring amontext-det(6) delimited by "."            | yanrez-git-tar kontrol                    
                    into tyrez-git-gun tyrez-git-ay tyrez-git-yil
                
                if amontext-det(6)(9:1) = space
                   move amontext-det(6)(5:4) to tyrez-git-yil
                else
                   if amontext-det(6)(10:1) = space
                      move amontext-det(6)(6:4) to tyrez-git-yil
                   else
                      if amontext-det(6)(11:1) = space
                         move amontext-det(6)(7:4) to tyrez-git-yil
                      end-if
                   end-if
                end-if
                move amontext-det(3) to tyrez-adi
                move amontext-det(2) to tyrez-soyadi
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                if tyrez-rezno = 0 stop " " end-if
                move tyrez-gel-tar to tmp-gel-tar
                move tyrez-git-tar to tmp-git-tar
                rewrite tyrez-rec invalid
                        stop " "
                end-rewrite 
           end-read
        else
           add 1 to tyrez-sirano 
           read tyrez no lock invalid
                move tmp-gel-tar     to tyrez-gel-tar
                move tmp-git-tar     to tyrez-git-tar
                move amontext-det(3) to tyrez-adi
                move amontext-det(2) to tyrez-soyadi
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                if tyrez-rezno = 0 stop " " end-if
                write tyrez-rec invalid
                      stop " "
                end-write 
           not invalid
                move tmp-gel-tar     to tyrez-gel-tar
                move tmp-git-tar     to tyrez-git-tar
                move amontext-det(3) to tyrez-adi
                move amontext-det(2) to tyrez-soyadi
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-adi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                inspect tyrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"  
                call "c$toupper" using tyrez-soyadi value 100
                if tyrez-rezno = 0 stop " " end-if
                rewrite tyrez-rec invalid
                      stop " "
                end-rewrite 
           end-read
        end-if
    end-read
    end-perform 
    close fidetext
    stop " " 
    initialize tyrez-rec 
    start tyrez key not < tyrez-anah invalid
          continue
    not invalid
    perform with test after until fs-tyrez = "10"
    read tyrez next no lock end move "10" to fs-tyrez
    not at end
        initialize rez-rec 
*        if tyrez-rezno = 771 stop " " end-if
        move tyrez-rezno to rez-no
        read rez no lock invalid
             
        not invalid
            initialize konuk-rec 
            move rez-folio to konuk-folio
            read konuk no lock invalid
                 stop " "
            not invalid
                initialize yanrez-rec 
                move tyrez-anah to yanrez-anah
                read yanrez no lock invalid
                     if yanrez-sirano = 1 
                        stop " " 
                     end-if
                     move tyrez-adi     to yanrez-adi
                     move tyrez-soyadi  to yanrez-soyadi
                     move tyrez-gel-tar to yanrez-gel-tar
*                     move tyrez-git-tar to yanrez-git-tar
                     move tyrez-gel-tar to tek-tarih
                     compute s1 = function INTEGER-OF-DATE(tek-tarih) + rez-sejour-logid    
                     compute s2 = function DATE-of-integer(s1)
                     move s2 to yanrez-git-tar

*                     if yanrez-gel-tar <> rez-gir-tar
*                        move yanrez-gel-tar to rez-gir-tar konuk-gel-tar
*                     end-if
*
*                     if yanrez-git-tar <> rez-cik-tar 
*                        move yanrez-git-tar to rez-cik-tar konuk-git-tar
*                     end-if

                     write yanrez-rec invalid
                           stop "  "
*                     not invalid
*                         rewrite rez-rec invalid
*                                 stop "  "
*                         not invalid
*                             rewrite konuk-rec invalid
*                                     stop " "
*                             end-rewrite 
*                         end-rewrite 
                     end-write 
                not invalid
                    move tyrez-gel-tar to yanrez-gel-tar
*                    move tyrez-git-tar to yanrez-git-tar
                     move tyrez-gel-tar to tek-tarih
                     compute s1 = function INTEGER-OF-DATE(tek-tarih) + rez-sejour-logid    
                     compute s2 = function DATE-of-integer(s1)
                     move s2 to yanrez-git-tar

                    if yanrez-gel-tar <> rez-gir-tar
                       move yanrez-gel-tar to rez-gir-tar konuk-gel-tar
                    end-if

                    if yanrez-git-tar <> rez-cik-tar 
                       move yanrez-git-tar to rez-cik-tar konuk-git-tar
                    end-if

                    rewrite yanrez-rec invalid
                          stop "  "
                    not invalid
                        rewrite rez-rec invalid
                                stop "  "
                        not invalid
                            rewrite konuk-rec invalid
                                    stop " "
                            end-rewrite 
                        end-rewrite 
                    end-rewrite 
                end-read
            end-read
        end-read
    end-read
    end-perform
    end-start
    close rez yanrez konuk tyrez.
*
 konuk-yaz.
    initialize konuk-rec 
    move rez-no                 to konuk-folio 
                                   ozluk-folio
    read konuk no lock invalid
         if rez-cik-tar not > tarih-tasi
            move "H"            to konuk-durumu
                                   yanrez-durumu
         else
            move "I"            to konuk-durumu
                                   yanrez-durumu
         end-if
         move "R"               to konuk-fol-kodu
         move rez-adi           to konuk-adi   
                                   ozluk-adi 
         move rez-soyadi        to konuk-soyadi 
                                   ozluk-soyadi
         move rez-s-d-t-g       to konuk-s-d-t-g 
         move rez-oda-konumu    to konuk-oda-konumu 
         move rez-odeme-tipi    to konuk-odeme-tipi 
         move rez-odano         to konuk-odano  
         move rez-no            to konuk-rez-no 
                                   ozluk-rez-no
         move rez-ulke          to konuk-ulke 
         move rez-buyuk         to konuk-buyuk  
         move rez-kucuk         to konuk-kucuk  
         move rez-bebek         to konuk-bebek 
         move rez-free          to konuk-free   
         move rez-acenta        to konuk-acenta 
         move rez-voucher       to konuk-voucher 
         move rez-nor-indirim   to konuk-nor-indirim 
         move rez-pan-tipi      to konuk-pan-tipi
         move rez-tipi          to konuk-rez-tipi 
         move rez-banka         to konuk-banka
         move rez-doviz         to konuk-doviz 
         move rez-anlasma       to konuk-anlasma
         move rez-kur-aygun     to konuk-kur-aygun
         move rez-cin-kuru      to konuk-kur-degeri
         | rez-cik-cikma extra c-in isleminde yapilmis sor..
         move rez-vip           to konuk-vip
         if rez-no-post = 1
            move "c"            to konuk-acik-kapali
         end-if 
         move rez-gir-tar       to konuk-gel-tar 
         move rez-cik-tar       to konuk-git-tar 
         move rez-grup-no       to konuk-grup-no 
         move rez-pazar         to konuk-pazar
         move rez-eb            to konuk-eb
         move rez-fiyat-fix     to konuk-fiyat-fix
         move rez-fiyat-konumu  to konuk-fiyat-konumu 
         if rez-fiyat-konumu = 0 then 
            move rez-oda-konumu to rez-fiyat-konumu
         end-if
         move rez-ug-ind          to konuk-ug-indirimi
         move rez-bilbord-eh      to konuk-bilbord-eh
         move rez-late-zaman      to konuk-late-zaman
         move rez-aksiyon-eh      to konuk-aksiyon-eh  
         move rez-share           to konuk-share       
         move rez-firma           to konuk-firma
         move rez-sharenum        to konuk-sharenum
         if konuk-durumu = "H" 
            move 1                to konuk-acik-hesap
         end-if 
         initialize rez-ucreti tl-toplam dv-toplam 
         move rez-fiyati          to konuk-dv-degeri 
         initialize kur-rec 
         move rez-banka           to kur-banka
         move rez-doviz           to kur-doviz
         move rez-gir-tar         to kur-tarih
         read kur no lock invalid 
              move 1              to konuk-kur-degeri 
         not invalid 
             move doviz-alis      to konuk-kur-degeri
         end-read 
         compute konuk-oda-tutar  
                 rounded = rez-fiyati * konuk-kur-degeri 
         if konuk-fol-kodu <> "R"
            move "E"                 to rez-c-in  
            rewrite rez-rec invalid 
                    stop " " 
            end-rewrite
         else
            move "E"                    to konuk-fol-kodu 
            move "E=>"                  to konuk-adi(01:03) 
            move rez-adi                to konuk-adi(04:17) 
            move rez-soyadi             to konuk-soyadi
            initialize konuk-rez-no konuk-kisi konuk-voucher konuk-nor-indirim 
                       konuk-kahvalti-tutar konuk-ogle-tutar konuk-aksam-tutar 
                       konuk-cik-cikma konuk-oda-tutar konuk-extbed-tutar 
                       konuk-icecek-tutar konuk-extra-tutar konuk-top-borc 
                       konuk-top-alac konuk-kur-degeri konuk-dv-degeri konuk-dv-degeri 
                       konuk-acik konuk-kartno  
            move konuk-durumu          to ozluk-durumu 
            move konuk-adi             to ozluk-adi 
            move 1                     to konuk-banka konuk-doviz 
            if konuk-odano <> spaces                                     
               move "9999"             to konuk-odano 
            end-if                      
            if konuk-acenta <> spaces                                  
               move "9998"             to konuk-acenta 
            end-if                         
         end-if       
         write konuk-rec  invalid 
               stop " " 
         not invalid
             if konuk-fol-kodu <> "R"
                add 1 to e-say 
             else
                add 1 to r-say
             end-if
         end-write

         write ozluk-rec  invalid 
               stop " " 
         end-write
         if rez-pan-tipi <> "XX"
            move konuk-durumu to yanrez-durumu
         end-if
    end-read.
*
 rez-al.      
    initialize oda-say kur-say turk-say rez-say yrez-say e-say r-say
    move "rez.txt"  to fidetext-adi
    move 1          to tmp-ulke
    open input fidetext
    open output rez ulke yanrez konuk ozluk
    close rez ulke yanrez konuk ozluk
    open i-o rez yanrez doviz facenta kodlar02 
             kur odalar konuk fkonum ulke ozluk
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring fidetext-rec delimited by x"09"
         into amontext-det(k) pointer sayac
    end-perform

        if amontext-det(1) = spaces 
           exit perform cycle
        end-if
        if amontext-det(23) = spaces 
           stop " "
        end-if

        initialize rez-rec yanrez-rec             | rez-rec dolduruluyor... ufak ufak yanrezde doluyo kardesss
        move function numval(amontext-det(23)) to rez-no yanrez-rezno
        move 1                                 to yanrez-sirano
        read rez no lock invalid        
             move 1      to rez-tipi                              | rez-tipi

             move "I"    to rez-durumu                            | rez-durumu

             if amontext-det(10) <> spaces                        | rez-acenta
                initialize facenta-rec 
                move amontext-det(10) to facenta-fide-kodu
                read facenta no lock invalid
                     stop " "
                     move "9998" to rez-acenta
                not invalid
                    move facenta-asya-kodu to rez-acenta
                end-read 
             else
                move "9998" to rez-acenta 
             end-if

             unstring amontext-det(6) delimited by "."    | rez-gir-tar                     
                 into rez-gir-gun rez-gir-ay rez-gir-yil

             if amontext-det(6)(9:1) = space
                move amontext-det(6)(5:4) to rez-gir-yil
             else
                if amontext-det(6)(10:1) = space
                   move amontext-det(6)(6:4) to rez-gir-yil
                else
                   if amontext-det(6)(11:1) = space
                      move amontext-det(6)(7:4) to rez-gir-yil
                   end-if                                
                end-if
             end-if

             move rez-gir-tar to yanrez-gel-tar

             unstring amontext-det(7) delimited by "."    | rez-cik-tar    
                 into rez-cik-gun rez-cik-ay rez-cik-yil 

             if amontext-det(7)(9:1) = space
                move amontext-det(7)(5:4) to rez-cik-yil
             else
                if amontext-det(7)(10:1) = space
                   move amontext-det(7)(6:4) to rez-cik-yil
                else
                   if amontext-det(7)(11:1) = space
                      move amontext-det(7)(7:4) to rez-cik-yil
                   end-if                                
                end-if
             end-if

             move rez-cik-tar to yanrez-git-tar

             move amontext-det(2) to rez-adi              | rez-adi    
             inspect rez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                      to x"8DA69A9E989980879FA7818D9447"  
             call "c$toupper" using rez-adi value 100
             inspect rez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                      to x"8DA69A9E989980879FA7818D9447"
             call "c$toupper" using rez-adi value 100
             
             move rez-adi to yanrez-adi

             move amontext-det(1) to rez-soyadi           | rez-soyadi
             inspect rez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                      to x"8DA69A9E989980879FA7818D9447"
             call "c$toupper" using rez-soyadi value 100
             inspect rez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                      to x"8DA69A9E989980879FA7818D9447"
             call "c$toupper" using rez-soyadi value 100
    
             move rez-soyadi to yanrez-soyadi

             move 1               to rez-banka            | rez-banka

             initialize doviz-rec                         | rez-doviz
             move amontext-det(38) to d-kisa-adi
             read doviz key is d-kisa-adi invalid
                  stop " "
             not invalid
                  move doviz-kodu  to rez-doviz           
             end-read 

             move "01"             to rez-anlasma          | rez-anlasma

             move "01"             to rez-odeme-tipi       | rez-odeme-tipi *kontrol



             if amontext-det(14) <> spaces       | rez-ulke
                if amontext-det(14) <> "TL"
                   add 1 to turk-say
                end-if
                initialize ulke-rec 
                move amontext-det(14) to ulke-adi
                inspect ulke-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"
                call "c$toupper" using ulke-adi value 100
                inspect ulke-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                         to x"8DA69A9E989980879FA7818D9447"
                call "c$toupper" using ulke-adi value 100
                read ulke key is ulke-adi invalid
                     move tmp-ulke to ulke-anah
                     write ulke-rec invalid
                           stop " "
                     not invalid
                         move ulke-anah to rez-ulke
                         add 1          to tmp-ulke
                     end-write 
                not invalid
                    move ulke-anah      to rez-ulke
                end-read
             else
                add 1 to turk-say
                initialize ulke-rec
                move "TURKIYE" to ulke-adi  
                read ulke key is ulke-adi invalid
                     move tmp-ulke to ulke-anah
                     write ulke-rec invalid
                           stop " "
                     not invalid
                         move ulke-anah to rez-ulke
                         add 1          to tmp-ulke
                     end-write 
                not invalid
                    move ulke-anah      to rez-ulke
                end-read
             end-if

             move amontext-det(31) to rez-voucher              | rez-voucher    
             
             move "G"              to rez-kur-aygun            | rez-kur-aygun
             
             move "K"              to rez-k-g-b                | rez-k-g-b

             move "N"              to rez-vip                  | rez-vip 

             | Onceki transferde "Rez-Komisyon" aktarimi yapilmamis..

             | Onceki transferde "Rez-Nor-Indirim" aktarimi yapilmamis..

             | "Rez-Cin" c-in isleminde yapilacak..

             move function numval(amontext-det(23)) to rez-folio              | rez-folio    
             move rez-folio                         to yanrez-folio-no
             move amontext-det(3)                   to rez-odano yanrez-odano | rez-odano 
   
             | "Rez-S-D-T-G" alani kisilerden sonra doluyor.. (Bkz : Rez-Buyuk)

             initialize odalar-rec                           | rez-oda-konumu
             move rez-odano          to odalar-anah
             read odalar no lock invalid
                  add 1 to oda-say
             not invalid
                 move odalar-konumu to rez-oda-konumu
             end-read

             unstring amontext-det(15) delimited by " "      | rez-kisi    
                 into rez-buyuk 
                      rez-kucuk 
                      rez-bebek
                      rez-free 
             move amontext-det(15)(7:1) to rez-free
             
             move rez-buyuk         to rez-s-d-t-g           | rez-s-d-t-g
             if rez-buyuk > 4 then 
                 move 4             to rez-s-d-t-g 
             end-if

             inspect amontext-det(16) replacing all "," by "."
             move function numval(amontext-det(16)) to rez-fiyati | rez-fiyati    

             unstring amontext-det(37) delimited by "."    | rez-isl-tar    
                 into rez-isl-gun 
                      rez-isl-ay 
                      rez-isl-yil 

             if amontext-det(37)(9:1) = space
                move amontext-det(37)(5:4) to rez-isl-yil
             else
                if amontext-det(37)(10:1) = space
                   move amontext-det(37)(6:4) to rez-isl-yil
                else
                   if amontext-det(37)(11:1) = space
                      move amontext-det(37)(7:4) to rez-isl-yil                       
                   end-if
                end-if
             end-if

             move rez-isl-tar       to rez-al-tar                | rez-al-tar   

             move amontext-det(12)  to rez-grup-adi              | rez-grup
 
             move "01"              to rez-pazar                 | rez-pazar

             move rez-oda-konumu    to rez-fiyat-konumu          | rez-fiyat-konumu

             
             initialize kur-rec                                  | rez-cin-kuru
             move rez-gir-tar to kur-tarih
             move rez-banka   to kur-banka
             move rez-doviz   to kur-doviz
             read kur no lock invalid
                  add 1 to kur-say
                  move 1         to rez-cin-kuru
             not invalid
                 move doviz-alis to rez-cin-kuru
             end-read

             move amontext-det(28) to rez-telefon-no              | rez-grup

             if amontext-det(9) <> "XX" 
                move amontext-det(9) to rez-pan-tipi          | rez-pan-tipi
                initialize kodlar02-rec                       | kodlar02 pansiyon yoksa yaziliyor.                  
                move "A"             to kodlar02-tipi
                move amontext-det(9) to kodlar02-kodu
                read kodlar02 no lock invalid
                     move amontext-det(9) to kodlar02-adi
                     write kodlar02-rec invalid
                           stop " " 
                     end-write 
                end-read
                move function numval(amontext-det(27)) to rez-sejour-logid
                write rez-rec invalid
                      stop " " 
                not invalid
                    add 1 to rez-say
                    if rez-gir-tar not > tarih-tasi
                       perform konuk-yaz
                    end-if
                end-write 
        
                write yanrez-rec invalid
                      stop " "
                not invalid
                    add 1 to yrez-say
                end-write 

             else
                perform konuk-yaz
             end-if
        end-read
    end-read
    end-perform 
*    compute kur-say = kur-say - turk-say
*    display message box "Tanimsiz Oda sayisi", oda-say
*    display message box "Tanimsiz Kur sayisi", kur-say
*    display message box "Yazilan Rezsayisi", rez-say
*    display message box "Yazilan Yanrez sayisi", yrez-say
*    display message box "Yazilan Oda Folio sayisi", r-say
*    display message box "Yazilan Ext Folio sayisi", e-say
    close fidetext
    close rez yanrez facenta fkonum kodlar02 ulke odalar doviz kur konuk.
*
 oda-al.
    move "odalar.txt"  to fidetext-adi
    open input fidetext
    open output odalar odalar2 close odalar odalar2 
    open i-o fkonum odalar odalar2 konum
*    initialize fodalar-rec 
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring fidetext-rec delimited by x"09"
         into amontext-det(k) pointer sayac
    end-perform
        if amontext-det(1) = spaces 
           exit perform cycle
        end-if
        initialize odalar-rec
        move amontext-det(1) to odalar-anah
        read odalar no lock invalid
             initialize fkonum-rec 
             move amontext-det(2) to fkonum-fide-kodu
             read fkonum no lock invalid
                  stop " "
             not invalid
                 move fkonum-asya-kodu to odalar-konumu
             end-read
             evaluate amontext-det(3)
                 when "Bakýmda"
                      move "OO" to odalar-durumu house-durumu
                 when "Dolu"
                      move "DT" to odalar-durumu house-durumu
                 when "Temiz"
                      move "VR" to odalar-durumu house-durumu
                 when "Kirli"
                      move "BK" to odalar-durumu house-durumu
                 when "Kapali"
                      move "OO" to odalar-durumu house-durumu
             end-evaluate 
             write odalar-rec invalid
                   stop " "
             not invalid
                 initialize konum-rec 
                 move odalar-konumu to konum-anahtar
                 read konum no lock invalid
                      continue
                 not invalid
                     add 1 to konum-top-oda konum-hazir-oda
                     rewrite konum-rec invalid
                             stop " " 
                     end-rewrite 
                 end-read
                 initialize odalar2-rec 
                 move odalar-anah to odalar2-uzun-no
                                     odalar2-no
                 write odalar2-rec invalid
                       stop " "
                 end-write 
             end-write 
        end-read
    end-read
    end-perform
    close fidetext
    close  odalar fkonum odalar2 konum.
*
 konum-al.
    move 1 to tmp-konum

    move "konum.txt"  to fidetext-adi
    open input fidetext
    open output konum fkonum close konum fkonum
    open i-o fkonum konum
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring fidetext-rec delimited by x"09"
         into amontext-det(k) pointer sayac
    end-perform
        if amontext-det(2) = spaces 
           exit perform cycle
        end-if
        initialize fkonum-rec 
        move amontext-det(2) to fkonum-fide-kodu 
        read fkonum no lock invalid
             move tmp-konum to fkonum-asya-kodu
             write fkonum-rec invalid
                   stop " "
             not invalid
                 add 1 to tmp-konum
             end-write 
        end-read
    end-read
    end-perform
    close fidetext
    initialize fkonum-rec 
    start fkonum key not < fkonum-asya-kodu invalid
          continue
    not invalid
    perform with test after until fs-fkonum = "10"
    read fkonum next no lock end move "10" to fs-fkonum 
    not at end 
        initialize konum-rec 
        move fkonum-asya-kodu to konum-anahtar
        read konum no lock invalid
             move 1                to konum-satis
             move fkonum-fide-kodu to konum-adi
             inspect konum-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                        to x"8DA69A9E989980879FA7818D9447"
                call "c$toupper" using konum-adi value 100
             inspect konum-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                        to x"8DA69A9E989980879FA7818D9447"
                call "c$toupper" using konum-adi value 100
             write konum-rec invalid
                   stop " "
             end-write
        end-read 
    end-read
    end-perform 
    end-start
    close fkonum konum.
*
 acenta-firma-al.
    move "acenta.txt"  to fidetext-adi
    open input fidetext
    open output facenta acenta close facenta acenta
    open i-o  facenta acenta 
    move 1 to  ydk-acenta
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform         

        if amontext-det(1) = spaces 
           exit perform cycle
        end-if

        initialize acenta-rec facenta-rec 
        move ydk-acenta      to acenta-kodu
        move amontext-det(2) to acenta-adi
        inspect acenta-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                   to x"8DA69A9E989980879FA7818D9447"
           call "c$toupper" using acenta-adi value 100
        inspect acenta-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                   to x"8DA69A9E989980879FA7818D9447"
           call "c$toupper" using acenta-adi value 100
        move amontext-det(1) to facenta-fide-kodu
        move acenta-kodu     to facenta-asya-kodu
        if acenta-adi = spaces 
           move facenta-fide-kodu to acenta-adi
        end-if
        write acenta-rec invalid 
              stop " "
        not invalid
            add 1 to ydk-acenta   
        end-write 
        write facenta-rec invalid 
            stop " "          
        end-write

    end-read
    end-perform
    close fidetext
    initialize acenta-rec
    move "9998"          to acenta-kodu
    move "OZEL ISLEMLER" to acenta-adi
    write acenta-rec end-write 
    close acenta  facenta.
    .
*
 depkod-al.
    move "depkod.txt"  to fidetext-adi
    open input fidetext
    open output depkod close depkod
    open i-o  depkod 
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end                                                     
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
        if amontext-det(1) <> spaces 
            move amontext-det(1)(1:2) to depkod-kodu
            read depkod no lock invalid
                 move amontext-det(1)(3:15) to depkod-adi
                 move amontext-det(1)(21:2) to depkod-kdv
                 move amontext-det(1)(47:1) to tmp-ba
                 evaluate tmp-ba
                     when "A"
                          move "A" to depkod-ba
                          move "B" to depkod-matrah-ba
                     when "B"
                          move "B" to depkod-ba
                          move "A" to depkod-matrah-ba
                 end-evaluate
                 inspect depkod-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                            to x"8DA69A9E989980879FA7818D9447"
                    call "c$toupper" using depkod-adi value 100
                 inspect depkod-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6A6"
                                            to x"8DA69A9E989980879FA7818D9447"
                    call "c$toupper" using depkod-adi value 100
                 write depkod-rec invalid
                       stop " "
                 end-write 
            end-read
        end-if

    end-read
    end-perform
    close fidetext depkod.
*
 kur-al.    
    move "kur.txt"  to fidetext-adi
    open input fidetext doviz
    open output kur close kur   

    open i-o kur   
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
        initialize doviz-rec 
        move amontext-det(1)(10:2) to doviz-kodu
        read doviz no lock invalid
             exit perform cycle
        end-read

                   
        if amontext-det(1) <> spaces        
           initialize kur-rec 
           move amontext-det(1)(1:2)  to kur-gun   
           move amontext-det(1)(3:2)  to kur-ay    
           move 2000                  to kur-yil   
           move amontext-det(1)(5:2)  to tmp-yil
           add tmp-yil                to kur-yil
           move 1                     to kur-banka 
           move amontext-det(1)(10:2) to kur-doviz
           read kur no lock invalid
        
                initialize dov-duz z-dov
                move amontext-det(1)(67:1)  to dov-tam
                move amontext-det(1)(68:4)  to dov-kes(1:4)
                move "0"                    to dov-kes(5:)
                move dov-duz                to z-dov
                move z-dov                  to doviz-alis
        
                initialize dov-duz z-dov
                move amontext-det(1)(79:1)  to dov-tam
                move amontext-det(1)(80:4)  to dov-kes(1:4)
                move "0"                    to dov-kes(5:)
                move dov-duz                to z-dov
                move z-dov                  to doviz-satis
        
                initialize dov-duz z-dov
                move amontext-det(1)(91:1)  to dov-tam
                move amontext-det(1)(92:4)  to dov-kes(1:4)
                move "0"                    to dov-kes(5:)
                move dov-duz                to z-dov
                move z-dov                  to efektif-satis
                
                initialize dov-duz z-dov
                move amontext-det(1)(103:1) to dov-tam
                move amontext-det(1)(104:4) to dov-kes(1:4)
                move "0"                    to dov-kes(5:)
                move dov-duz                to z-dov
                move z-dov                  to efektif-alis
        
                write kur-rec invalid 
                      stop " "  
                end-write
           end-read
        end-if
    end-read
    end-perform
    close fidetext kur doviz.

*
 doviz-al.   
    move "doviz.txt"  to fidetext-adi
    open input fidetext
    open output doviz close doviz
    open i-o doviz
    read fidetext next no lock end 
         continue
    end-read
    perform until fs-fidetext = "10"
         initialize fidetext-rec    
    read fidetext next no lock end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
                   
        if amontext-det(1) <> spaces        
           initialize doviz-rec  
           move amontext-det(1)(4:2)   to doviz-kodu
           read doviz no lock invalid
                move amontext-det(1)(1:3)  to d-kisa-adi 
                                              d-merkez-banka-kodu
                move amontext-det(1)(6:15) to d-adi-1
                inspect d-adi-1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                                        to x"8DA69A9E989980879FA7818D94"
                   call "c$toupper" using d-adi-1 value 100
                inspect d-adi-1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                                        to x"8DA69A9E989980879FA7818D94"
                   call "c$toupper" using d-adi-1 value 100
                write doviz-rec invalid
                      stop " "
                end-write
           end-read
        end-if

    end-read
    end-perform

    add 1 to doviz-kodu
    read doviz no lock invalid
         move "TL"          to d-kisa-adi d-merkez-banka-kodu
         move "TURK LIRASI" to d-adi-1
         write doviz-rec invalid
               stop " " 
         end-write 
    end-read

    close fidetext doviz.
     .
*
 rez-pazar-at.
    initialize ydk-doviz-kodu  bin-kayit  extradir
    move "rez.txt"  to fidetext-adi
    move "rez2.txt" to amontext-adi
    move 900000     to fol-sira
    open output amontext  frez  
    close frez 

    open i-o rez takvim konuk fpazar fkaynak fidetext frez

    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac

    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 


    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
      exit perform 
    not end
    move 1 to sayac
    initialize amontext-rec 
    perform varying k from 1 by 1 until k > 200 or sayac > 3000
         
    unstring    fidetext-rec delimited by x"09"                                                 
         into amontext-det(k)   pointer sayac 
    end-unstring
    end-perform

         initialize rez-rec
         move function numval(amontext-det(1)) to rez-no yanrez-rezno  | rez-no det1
         read rez no lock invalid 
              if debug = 7 stop " " end-if
         not invalid

         move function numval(amontext-det(15)) to fidpazar
         evaluate fidpazar
             when 1006
                  move "02" to rez-pazar
             when 1008
                  move "01" to rez-pazar
             when 1010
                  move "12" to rez-pazar
             when 1007
             when 1011
             when 1052
                  move "20" to rez-pazar
             when 1050
                  move "14" to rez-pazar
             when 1053
                  move "17" to rez-pazar
             when 1005
             when 1051
                  move "21" to rez-pazar
         end-evaluate
         move "060" to rez-ulke
         rewrite rez-rec end-rewrite
         end-read

         initialize konuk-rec
         move rez-folio  to konuk-folio 
         read konuk no lock invalid
             continue 
         not invalid
            move rez-pazar to konuk-pazar
            move rez-ulke  to konuk-ulke
            rewrite konuk-rec end-rewrite
         end-read         


    end-read
    end-perform              
    close amontext fidetext  fpazar fkaynak rez frez konuk .

     display message box "islem tamamalandi."

    .

*
 arez-al.
    initialize ydk-doviz-kodu  bin-kayit  extradir
    move "rez.txt"  to fidetext-adi
    move "rez2.txt" to amontext-adi
    move 900000     to fol-sira
    open output amontext rez frez konuk 
    close rez frez konuk

    open i-o rez  fodalar odalar fmarket depkod yanrez takvim acenta fshare 
             konuk ozluk  doviz prohrk 
             polisxml fpazar fkaynak facenta fkonum fidetext fdoviz ffirma firma frez

    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac

    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 


    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
      exit perform 
    not end
    move 1 to sayac
    initialize amontext-rec 
    perform varying k from 1 by 1 until k > 200 or sayac > 3000
         
    unstring    fidetext-rec delimited by x"09"                                                 
         into amontext-det(k)   pointer sayac 
    end-unstring
    end-perform
        if function numval(amontext-det(32)) = 3
            exit perform cycle 
        end-if 

    
     initialize yanrez-rec rez-rec buldum-acenta  buldum-firma

      if amontext-det(12) > 0     | rez-odano det15
         initialize fodalar-rec 
         move amontext-det(12)   to fodalar-fide-kodu
         read fodalar no lock invalid 
              if d = 1 stop "rez_odano" end-if 
         not invalid 
              initialize odalar-rec 
              move fodalar-asya-kodu  to odalar-anah
              read odalar no lock invalid 
                  if d = 1 stop "read odalar" end-if 
              not invalid 
                   move odalar-anah    to rez-odano 
              end-read 
         end-read 
      end-if 
       
        move function numval(amontext-det(1)) to rez-no yanrez-rezno  | rez-no det1
        
        call "c$justify" using amontext-det(25),"L" 
        call "c$justify" using amontext-det(26),"L"
 
       
        move   amontext-det(22)(7:2) to  rez-gir-gun   | rezgirtar det25
        move   amontext-det(22)(5:2) to  rez-gir-ay 
        move   amontext-det(22)(1:4) to  rez-gir-yil
                                                    
        move   amontext-det(23)(7:2) to  rez-cik-gun   | rezciktar det26
        move   amontext-det(23)(5:2) to  rez-cik-ay 
        move   amontext-det(23)(1:4) to  rez-cik-yil

*        if rez-cik-yil < 2013 
*           exit perform cycle 
*        end-if    

         move 11  to rez-git-saat 
         move 59  to rez-git-dak         

 

        display   rez-cik-tar rez-gir-tar    

 
         
        if function numval(amontext-det(7)) > 0
                initialize facenta-rec 
                move amontext-det(7)       to facenta-fide-kodu
                read facenta no lock invalid 
                    continue
                    move 0 to buldum-acenta
                not invalid 
                        move facenta-asya-kodu     to rez-acenta
                        move 1 to buldum-acenta
                end-read
              
        end-if 

        if function numval(amontext-det(37)) > 0
                initialize ffirma-rec zfirma
                move function numval(amontext-det(37)) to ffirma-fide-kodu
                read ffirma no lock invalid 
                      continue
                      move 0 to buldum-acenta
                not invalid 
                        move ffirma-asya-kodu         to rez-firma
                        move 1 to buldum-firma
                end-read
        end-if

        if buldum-firma = 0 and 
           buldum-acenta = 0
              move "9999"    to rez-acenta 
        end-if 

        if buldum-firma = 1 and 
           buldum-acenta = 0
              move "9999"    to rez-acenta               
        end-if 

            move amontext-det(5)               to rez-adi yanrez-adi
            move amontext-det(6)               to rez-soyadi yanrez-soyadi
 
        if rez-adi = spaces and
           rez-soyadi = spaces
              exit perform cycle 
        end-if 
        move 1                   to rez-tipi
        evaluate function numval (amontext-det (27))
           when 1
                move "I"                 to rez-durumu
           when 3
                move "S"                 to rez-durumu
        end-evaluate
       inspect rez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                               to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-adi value 100
       inspect rez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                                  to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-soyadi value 100
           if amontext-det(14) > 0
              move amontext-det(14)        to fkonum-fide-kodu
              read fkonum no lock invalid 
                   move 1            to fkonum-asya-kodu
              end-read
              move fkonum-asya-kodu   to rez-fiyat-konumu
           else
              move amontext-det(13)        to fkonum-fide-kodu
              read fkonum no lock invalid 
                   move 1            to fkonum-asya-kodu
              end-read
              move fkonum-asya-kodu   to rez-fiyat-konumu              
           end-if 

           initialize fkonum-rec
           move amontext-det(13)      to fkonum-fide-kodu
           read fkonum no lock invalid 
                move 1                to fkonum-asya-kodu
           end-read
           move fkonum-asya-kodu      to rez-oda-konumu

           move function numval (amontext-det(3))    to rez-buyuk
           move function numval (amontext-det(8))    to rez-kucuk
           move function numval (amontext-det(9))    to rez-free
           move function numval (amontext-det(10))   to rez-bebek
           initialize fdoviz-rec 
           move amontext-det(20)    to fdoviz-fide-kodu
           read fdoviz no lock invalid 
                if d = 1 stop "read fdoviz" end-if 
           not invalid 
                move fdoviz-asya-kodu   to rez-doviz 
           end-read 
  

           move amontext-det(28)(7:2) to rez-al-gun
           move amontext-det(28)(5:2) to rez-al-ay 
           move amontext-det(28)(1:4) to rez-al-yil
   

           move rez-al-tar            to REZ-ISL-TAR
           move 01                    to rez-banka
           move "K"                   to rez-k-g-b
 
           if debug = 1 stop " " end-if
           initialize fpazar-rec
           move amontext-det(15)      to fpazar-fide-kodu
           read fpazar no lock invalid 
                continue 
           not invalid 
               move fpazar-asya-kodu  to rez-pazar
           end-read 
*           move "01"                  to rez-pazar
           
           move "G"                   to REZ-KUR-AYGUN
           move 01                    to rez-anlasma
           if rez-gir-tar <= tarih-tasi
              
              move function numval(amontext-det(21))   to rez-cin-kuru
           end-if 
           if debug = 1 stop " " end-if
           initialize fkaynak-rec
           move function numval(amontext-det(18)) to fkaynak-fide-kodu
           read fkaynak no lock invalid
                continue 
           not invalid 
               move fkaynak-asya-kodu            to rez-kaynak-1
           end-read 
           if rez-pazar = 4
              move 03   to rez-odeme-tipi
           else
              move 01                    to rez-odeme-tipi
           end-if 
           

           move "FB"                  to rez-pan-tipi
           move "4"                   to rez-gr-status
           move "317"                 to rez-ulke
           inspect amontext-det(31) replacing all "." by ","

           if amontext-det(31) not = spaces and 
              amontext-det(35) = spaces and
              amontext-det(36) = spaces
                 move function numval(amontext-det(31))   to rez-fiyati
           end-if 
           if function numval(amontext-det(31)) = 0 and 
              function numval(amontext-det(35)) = 0 and
              amontext-det(36) not = spaces
                 move function numval(amontext-det(36))   to rez-fiyati
                 move "E"                to REZ-FIYAT-FIX
           end-if
           if function numval(amontext-det(31)) = 0 and 
              function numval(amontext-det(35)) not = 0  
              
                 move function numval(amontext-det(35))   to rez-fiyati
                 move "E"                                 to REZ-FIYAT-FIX
           end-if
 
           move amontext-det(25)               to rez-not1
           inspect rez-not1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-not1 value 100
           
           move amontext-det(26)                to rez-not2
           inspect rez-not2 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-not2 value 100

           move rez-buyuk                           to rez-s-d-t-g
           if rez-buyuk > 4 then 
               move 4 to rez-s-d-t-g 
           end-if
           move 1                                       to yanrez-sirano

           write yanrez-rec invalid 
                 if debug = 1 then stop " " end-if 
           end-write 
     
          write rez-rec invalid 
                if debug = 1 then stop " " end-if 
          end-write
    end-read
    end-perform              
    close amontext fidetext  fpazar fkaynak fmarket rez takvim ozluk frez fdoviz doviz yanrez  
          prohrk  konuk ffirma firma 
          depkod acenta polisxml facenta odalar fodalar fkonum fshare.
*
 cin-yap.          
     open i-o rez konuk ozluk kur kart
     open i-o frez 
     initialize rez-rec
     start rez key > rez-anah 
       invalid continue
       not invalid
       perform until fs-rez = "10" 
          read rez next no lock 
            end move "10" to fs-rez
            not end 
            if rez-gir-tar <= tarih-tasi and
               REZ-DURUMU = "I" then
                perform tek-cin
                 
            end-if
          end-read
       end-perform
      end-start
      close rez konuk ozluk frez kur kart.    
*
 tek-cin.
          initialize konuk-rec ozluk-rec
          move rez-no            to konuk-folio ozluk-folio
          perform oda-cin. 
*
 extra-cin.         
    add  1         to fol-sira
    move  fol-sira to konuk-folio ozluk-folio ozluk2-folio ffolio-asya-folio.         
          move cinpara-ext-fol-banka  to banka-kodu.     
          move cinpara-ext-fol-doviz  to doviz-kodu.                   
          move cinpara-ext-fol-ode    to kodlar02-kodu. 
          move "I"                    to konuk-durumu
          move "E"                    to konuk-fol-kodu. 
          move amontext-det(2)        to konuk-adi(04:17). 
          move amontext-det(3)        to konuk-soyadi
          move "E=>"                  to konuk-adi(01:03). 
***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar   konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno . 
          move konuk-durumu         to  ozluk-durumu. 
          move konuk-adi            to  ozluk-adi(04:17). 
          move "E=>"                to  ozluk-adi(01:03).
          move 1                    to konuk-banka konuk-doviz
          move amontext-det(4)      to konuk-gel-tar
          move amontext-det(5)      to konuk-git-tar
                                                
          move "9999"      to konuk-odano                                      
          move "9998"      to konuk-acenta
                  move "H"                 to konuk-durumu       
          move function numval(amontext-det(1))             to ffolio-fide-folio
          write ffolio-rec invalid 
              if d = 1 stop "ffolio" end-if 
          end-write 
          write konuk-rec invalid 
               rewrite konuk-rec end-rewrite 
          end-write.                         
          write ozluk-rec invalid 
              rewrite ozluk-rec end-rewrite 
          end-write.
 
*
 oda-cin.
    move rez-no              to konuk-rez-no ozluk-rez-no
    move rez-adi             to konuk-adi ozluk-adi 
    move rez-soyadi          to konuk-soyadi ozluk-soyadi
    move rez-s-d-t-g         to konuk-s-d-t-g 
    move rez-oda-konumu      to konuk-oda-konumu 
    if rez-fiyat-konumu = 0 then 
       move rez-oda-konumu   to rez-fiyat-konumu
    end-if
    move rez-fiyat-konumu    to konuk-fiyat-konumu 
    move rez-odeme-tipi      to konuk-odeme-tipi 
    move rez-odano           to konuk-odano  
    move rez-ulke            to konuk-ulke 
    move rez-buyuk           to konuk-buyuk  
    move rez-kucuk           to konuk-kucuk  
    move rez-free            to konuk-free   

    move rez-bebek           to konuk-bebek 
    move rez-acenta          to konuk-acenta 
    move rez-firma           to konuk-firma
    move rez-grup-no         to konuk-grup-no 

    move rez-voucher         to konuk-voucher 
    move rez-fiyat-konumu    to konuk-fiyat-konumu 
    move rez-nor-indirim     to konuk-nor-indirim 
    move rez-pan-tipi        to konuk-pan-tipi
    move rez-tipi            to konuk-rez-tipi 
    move rez-banka           to konuk-banka
    move rez-doviz           to konuk-doviz 
    move rez-anlasma         to konuk-anlasma
    move rez-pazar           to konuk-pazar
    move rez-share           to konuk-share
    move rez-eb              to konuk-eb
    move rez-ug-ind          to konuk-ug-indirimi
    move rez-fiyat-fix       to konuk-fiyat-fix
    move rez-kur-aygun       to konuk-kur-aygun

    move rez-cin-kuru        to konuk-kur-DEGERI
    move rez-bilbord-eh      to konuk-bilbord-eh
    move REZ-AKSIYON-EH      to konuk-AKSIYON-EH  
    move REZ-share           to konuk-share
    move rez-vip             to konuk-vip
    move rez-gir-tar         to konuk-gel-tar 
    move rez-cik-tar         to konuk-git-tar 
    move rez-sharenum        to konuk-sharenum

    if rez-no-post = 1
       move "C"  to KONUK-ACIK-KAPALI
    end-if 

    move rez-not1            to konuk-acik-1
           inspect konuk-acik-1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94" 
              call "c$toupper" using konuk-acik-1 value 100
    
    move rez-not2            to konuk-acik-2
           inspect konuk-acik-2 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using konuk-acik-2 value 100
    move rez-gel-saat        to konuk-gel-saat
    move rez-gel-dak         to konuk-gel-dakika
    move rez-late-zaman      to konuk-late-zaman

    move rez-git-saat        to konuk-git-saat
    move rez-git-dak         to konuk-git-dakika
    if  rez-cik-tar <= tarih-tasi  
       move "H"                 to konuk-durumu
    else   
       move "I"                 to konuk-durumu
    end-if
  
    if konuk-durumu = "H" 
       move 1 to konuk-acik-hesap
    end-if 
    move "R"                 to konuk-fol-kodu. 
         initialize rez-ucreti tl-toplam dv-toplam. 
*    inspect amontext-det(5) replacing all "." by ","
    move rez-fiyati          to konuk-dv-degeri 
                     
****>Ozluk Bilgileri ataniyor.....
    move rez-adres1          to ozluk-adres1 
    move konuk-folio         to rez-folio    
    move "E"                 to rez-c-in  

    rewrite rez-rec invalid 
       if debug = 1 then stop "rez" end-if  
    end-rewrite

    initialize kur-rec 
    move rez-banka   to kur-banka
    move rez-doviz   to kur-doviz
    move rez-gir-tar to kur-tarih
    read kur no lock invalid 
         continue 
    not invalid 
        move doviz-alis   to konuk-kur-degeri
    end-read 
    compute  konuk-oda-tutar  
             rounded = REZ-FIYATI * konuk-kur-degeri          

    if konuk-durumu = "I"
       initialize kart-rec 
       move konuk-rez-no          to kart-no               
       set kart-musteri     to true
       move konuk-folio     to kart-folio         
       move "I"             to kart-durumu      
       move konuk-gel-tar     to kart-cin 
       move konuk-git-tar     to kart-cot 
       move konuk-buyuk       to kart-buyuk
       move konuk-kucuk       to rez-kucuk
       move konuk-free        to rez-free
       set kart-sanal       to true
       write kart-rec invalid 
           rewrite kart-rec end-rewrite           
       end-write 
     end-if 

    write konuk-rec  invalid 
        if debug = 1 then stop "konuk" end-if 
    end-write
    write ozluk-rec  invalid 
       if debug = 1 then stop "ozluk" end-if 
    end-write
      .
*****************************************




         .    
*****************************************   
*****************************************
*

             
*
 hata-goster.
    call "c$rerr" using extend-stat text-message 1.
    move extend-stat       to fileerr-linkage-hata-no.
    move Secondary-Error   to fileerr-linkage-secondary-hata-no.
    call "c$rerrname" using fileerr-linkage-dosya-adi.
    display message box "DOSYA : ",fileerr-linkage-dosya-adi,
    x"0a0d","errrrror :",fileerr-linkage-hata-no,x"0ad0",
    "error2 :",fileerr-linkage-secondary-hata-no.
    set exit-pushed to true
    if debug = 1 then stop " " end-if
    .       

*
 fihrist-al.
 
    move "fihrist.txt"  to fidetext-adi
    move "fihrist2.txt" to amontext-adi
    open input fidetext
    open output amontext fihrist
    close fihrist 
    move 1 to xiii

     open i-o fihrist   
     initialize fihrist-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac 
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform  
      
      initialize fihrist-rec
      move xiii            to fihrist-no
      move amontext-det(1) to lck13
      perform turkce-convert
      move lck13           to fihrist-adi
      move amontext-det(2) to lck13
      perform turkce-convert
      move lck13           to fihrist-soyadi
      move amontext-det(3) to fihrist-telefon
      move amontext-det(4) to fihrist-fax
      move amontext-det(5) to fihrist-email


                
*     if amontext-det(1) not = spaces
*
*       initialize fihrist-rec 
*       move function numval(amontext-det(5))         to fihrist-no
*  
*       move amontext-det(3)                          to FIHRIST-SOYADI
*       move amontext-det(3)                          to FIHRIST-ADI
* 
*       inspect FIHRIST-SOYADI converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
*       to x"8DA69A9E989980879FA7818D94"
*              call "c$toupper" using FIHRIST-SOYADI value 100
*
*       inspect FIHRIST-ADI converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
*       to x"8DA69A9E989980879FA7818D94"
*              call "c$toupper" using FIHRIST-ADI value 100
*
*       evaluate (amontext-det(6)(1:1))
*       when 6
*           move  amontext-det(10)            to FIHRIST-fax
*       when 9
*           move amontext-det(10)             to fihrist-email
*       when 12
*           move amontext-det(10)             to fihrist-email
*       when 11
*           move amontext-det(10)             to fihrist-email
*       when 5
*           move amontext-det(10)             to FIHRIST-MOBIL-TEL
*       when 4
*           move amontext-det(10)             to FIHRIST-TELefon
*       when 3
*           move amontext-det(10)             to FIHRIST-MOBIL-TEL
*       when 1
*           move amontext-det(10)             to FIHRIST-TELefon
*       end-evaluate
*
       write fihrist-rec invalid 
             stop " " 
       not invalid 
           add 1 to xiii
       end-write 
*     end-if

*    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext fihrist  
     .
*
 profil-al.
 
    move "profil.txt"  to fidetext-adi
    move "profil2.txt" to amontext-adi
    open input fidetext
    open output amontext musteri polisxml prohrk 
    close musteri polisxml prohrk

    open i-o musteri ulke yanrez  
             rez  polisxml prohrk
    initialize musteri-rec         
    read fidetext next no lock
    end 
         continue
    end-read
    perform until fs-fidetext = "10"
             initialize fidetext-rec    
            read fidetext next no lock
            end 
            not end
            move 1 to sayac
            initialize amontext-rec
            perform varying k from 1 by 1 until k > 200 or sayac > 3000
            unstring    fidetext-rec delimited by x"09"
                 into amontext-det(k)   pointer sayac
            end-perform    
                  
     if function numval(amontext-det(15)) > 0 
        initialize musteri-rec 
        move function numval(amontext-det(15)) to musteri-no
        move isyeri-adres-tasi                 to musteri-sirket
        move amontext-det(2)                   to musteri-adi
        move amontext-det(3)                   to musteri-soyadi
        move function numval(amontext-det(4))  to musteri-kim-tcno
        move amontext-det(5)                   to musteri-b-turu
        move amontext-det(6)                   to musteri-seri-no
        move amontext-det(7)                   to musteri-baba-adi
        move amontext-det(8)                   to musteri-ana-adi
        move amontext-det(9)                   to musteri-d-yeri
        if function numval(amontext-det(13)) = 1
           move "E"                            to musteri-cinsiyet musteri-kim-cinsiyet
        else
           move "K"                            to musteri-cinsiyet musteri-kim-cinsiyet
        end-if
        move amontext-det(14)(1:4)             to musteri-dyil  
        move amontext-det(14)(5:2)             to musteri-day  
        move amontext-det(14)(7:2)             to musteri-dgun 

*          if amontext-det(15) not = spaces and 
*             amontext-det(15) not = 0
*            initialize ulke-rec 
*            move amontext-det(15)  to ulke-anah
*            read ulke no lock invalid 
*                 if d = 1 stop "ulke" end-if 
*            not invalid 
*                move ulke-anah     to musteri-ulke
*            end-read 
*          end-if 
          move "B"           to musteri-kim-medeni      
 
        write musteri-rec invalid 
              continue
        end-write 
           perform polisxml-at
        display m-profil   
     end-if

 
    end-read
    end-perform
    close fidetext 
    close amontext musteri ulke yanrez polisxml prohrk rez 
    .
 
*
 polisxml-at.
                     initialize rez-rec 
                     move function numval(amontext-det(1)) to rez-no
                     read rez no lock invalid 
                          continue 
                     not invalid
                         if rez-gr-olabilir = 0
                            move 1  to rez-gr-olabilir
                         else 
                            add 1   to rez-gr-olabilir
                         end-if 
                            rewrite rez-rec end-rewrite
                           
                             initialize yanrez-rec 
                             move rez-no            to yanrez-rezno
                             move rez-gr-olabilir   to yanrez-sirano
                             read yanrez no lock invalid
                                  move amontext-det(2) to yanrez-adi
                                  move amontext-det(3) to yanrez-soyadi
                                  move m-profil        to yanrez-profil-anah
                                  move musteri-d-tarihi to yanrez-dog-tar
                                  write yanrez-rec invalid 
                                     stop " " 
                                  end-write
                             end-read 

                     end-read 


                     initialize yanrez-rec polisxml-rec
                     move function numval(amontext-det(1)) to yanrez-rezno
                     move rez-gr-olabilir                  to yanrez-sirano
                     read yanrez no lock invalid 
                         continue 
                     not invalid                           
                             move yanrez-rezno            to polisxml-rezno
                             move rez-gr-olabilir         to polisxml-sirano
                             move m-profil          to yanrez-profil-anah
                             move musteri-d-tarihi  to yanrez-dog-tar
                              rewrite yanrez-rec end-rewrite 
   
                       move musteri-adi            to polisxml-adi
                       move musteri-soyadi            to polisxml-soyadi
                       move musteri-kim-tcno          to polisxml-tckimlikno          
                       move musteri-kim-uyruk         to polisxml-uyruk      
                       move musteri-kim-cinsiyet      to polisxml-cinsiyet   
                       move musteri-kim-medeni        to polisxml-medeni
                       string 
                         musteri-kim-adrs    delimited by "   "
                          musteri-kim-adrs1    delimited by "   "
                      
                       into polisxml-adr
                       MOVE musteri-d-tarihi          to polisxml-dog-tar
               
                       move musteri-b-turu            to polisxml-kturu         
                       move musteri-seri-no           to polisxml-kseri        
                       move musteri-baba-adi          to polisxml-babaadi       
                       move musteri-ana-adi           to polisxml-anaadi        
                       move musteri-d-yeri            to polisxml-dyeri         
                       move musteri-kim-il            to polisxml-nil         
                       move musteri-kim-ilce          to polisxml-nilce       
                       move musteri-kim-mahalle       to polisxml-nmahalle    
                       move musteri-kim-cilt          to polisxml-ncilt       
                       move musteri-kim-aile-no       to polisxml-naile    
                       move musteri-kim-sira-no       to polisxml-nsira  
                      
                       move musteri-prb-ack           to polisxml-prb
                      
                       write polisxml-rec invalid 
                         if debug = 1 stop " " end-if                                           
                       end-write 
                       perform prohrk-kaydet
                     end-read.
*
 prohrk-kaydet.                   
           initialize prohrk-rec 
           move m-profil                to prohrk-profil-anah
           move isyeri-adres-tasi       to prohrk-rez-sirket  
           move rez-no                  to prohrk-rez-no 

           move 1                       to  prohrk-rez-sira       

           move musteri-adi             to  prohrk-pro-adi       
           move musteri-soyadi          to  prohrk-pro-soyadi    
           move rez-acenta              to  prohrk-acenta       
           move rez-gir-tar             to  prohrk-gel-tar
           move rez-cik-tar             to  prohrk-git-tar
           move rez-banka               to  prohrk-banka  
           move rez-doviz               to  prohrk-doviz 
           move rez-pan-tipi            to  prohrk-pans     
           move rez-pazar               to  prohrk-pazar
           move rez-ulke                to  prohrk-ulke 
           move rez-voucher             to  prohrk-voucher
           move rez-odano               to  prohrk-odano

           accept  prohrk-duz-tarih from century-date 
           move isyeri-adres-tasi       to prohrk-rez-sirket
           move rez-no                  to prohrk-rez-no
             write prohrk-rec invalid
                 rewrite prohrk-rec end-rewrite
             end-write.
*
 hrk-al.
    move "hrk.txt"  to fidetext-adi
    move "hrk2.txt" to amontext-adi
    open input fidetext
    open output amontext   
 

     open i-o ffolio fat konuk rez ozluk  depkod yromhrk hrk2
              ozluk2   romhrk exthrk folref  
     initialize ffolio-rec konuk-rec 

     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 150 or sayac > 3000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
       display function numval(amontext-det(1))
 
       if function numval(amontext-det(3)) > 0 |rezi olanlar 
         evaluate true 
         when function numval(amontext-det(6)) not =  -1  and 
            function numval(amontext-det(15)) > 0
                  initialize romhrk-rec exthrk-rec rez-rec
                  add 1           to uuasya-sira
                  move function numval(amontext-det(3)) to rez-no
                  read rez no lock invalid
                      exit perform cycle 
                  end-read 
        
                       initialize konuk-rec
                       move rez-folio   to konuk-folio
                       read konuk no lock invalid 
                           exit perform cycle
                       end-read
                          move amontext-det(8)  to romhrk-tarih
                          move amontext-det(9)  to romhrk-zaman
                          move uuasya-sira      to romhrk-islem
                          move konuk-folio      to romhrk-folio
                          move "M"              to ROMHRK-ISLEM-TIPI
        
                          initialize fdepkod-rec 
                          move function numval (amontext-det(5))  to fdepkod-fide-kodu
                          read fdepkod no lock invalid 
                                MOVE 901        to romhrk-depkod
                          not invalid 
                              move fdepkod-asya-kodu to romhrk-depkod
                          end-read
        
                          if function numval(amontext-det(16)) = 1
                              move "B"                    to romhrk-ba
                              move function numval(amontext-det(17)) to romhrk-tl-tutar
                          else
                              move "A"                    to romhrk-ba                      
                              move function numval(amontext-det(18)) to romhrk-tl-tutar
                          end-if 

*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref

                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                 if KONUK-FOL-KODU = "R"
                                   write romhrk-rec invalid
                                        if debug = 1 stop "romhrk" end-if
                                   end-write 
                
                                  else
                                     move romhrk-rec   to exthrk-rec                 
                                     write exthrk-rec invalid 
                                        if debug = 1 stop "exthrk" end-if                    
                                     end-write 
                                  end-if
                
                                  move romhrk-anah    to hrk2-ANAH
                                  move romhrk-rec     to yromhrk-rec
                                  move romhrk-folio   to yromhrk-kaynak-folio
                                  move romhrk-folio   to hrk2-kaynak-folio
                                  move romhrk-folio  to yromhrk-folio
                                  write hrk2-rec invalid
                                     if debug = 1 stop " " end-if
                                  end-write 
                                  write yromhrk-rec invalid
                                     if debug = 1 stop " " end-if
                                  end-write
                           

                  when function numval(amontext-det(6)) = -1 and 
                     function numval(amontext-det(16)) > 1 and
                     function numval(amontext-det(18)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1          to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 603                    to romhrk-depkod                              
                                      move "B"                    to romhrk-ba
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 
                                 
                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                  
                  when function numval(amontext-det(6)) = -1 and 
                     function numval(amontext-det(16)) > 1 and
                     function numval(amontext-det(18)) > 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1          to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-depkod
                                  end-read
        
*                                      move 603                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 
                                 
                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                   

                  when function numval(amontext-det(6)) = 1 and 
                     function numval(amontext-det(16)) > 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 603                    to romhrk-depkod                              
                                      move "B"                    to romhrk-ba
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 
                                 
                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
              

                 when function numval(amontext-det(6)) = 1 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 600                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 
                                 
                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                            

                  when function numval(amontext-det(6)) < 0 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 600                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                               

                  when function numval(amontext-det(6)) < 0 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) > 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-depkod
                                  end-read
        
**                                      move 600                    to                               
                                      move "B"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 




                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                            
                  when function numval(amontext-det(6)) > 0 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(3)) to rez-no
                          read rez no lock invalid
                              exit perform cycle 
                          not invalid
                
                               initialize konuk-rec
                               move rez-folio   to konuk-folio
                               read konuk no lock invalid 
                                   exit perform cycle
                               end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 600                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
              when other
                 if d = 1 stop " " end-if 
             end-evaluate 
                if function numval(amontext-det(19)) > 0
                   if function numval(amontext-det(19)) <> function numval(amontext-det(3))
                      read rez no lock invalid 
                          continue 
                      not invalid 
                        move rez-folio  to konuk-folio
                        read konuk no lock invalid 
                           continue 
                        not invalid 
                           delete yromhrk end-delete                        
                           move konuk-folio  to yromhrk-folio
                           move romhrk-folio to yromhrk-kaynak-folio
                           move konuk-folio  to hrk2-kaynak-folio
                           write yromhrk-rec invalid 
                              if d = 1 stop " " end-if 
                           end-write 
                           rewrite hrk2-rec invalid
                              if d = 1 stop " " end-if 
                           end-rewrite 
                        end-read

                      end-read 
                      
                   end-if 
                end-if 
          else |extra folio hareketleri              
             if function numval(amontext-det(4)) > 0 
                evaluate true  
                when function numval(amontext-det(6)) not =  -1  and 
                   function numval(amontext-det(15)) > 0

                  initialize romhrk-rec exthrk-rec rez-rec ffolio-rec
                  add 1           to uuasya-sira
                  move function numval(amontext-det(4)) to ffolio-fide-folio
                  read ffolio no lock invalid 
                       if d = 1 stop "ffolio" end-if 
                  end-read  
                        initialize konuk-rec 
                        move ffolio-asya-folio  to konuk-folio
                        read konuk no lock invalid 
                             exit perform cycle 
                        end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                      MOVE 901        to romhrk-depkod
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-depkod
                                  end-read
                                  if function numval(amontext-det(16)) = 1
                                      move "B"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  else
                                      move "A"                    to romhrk-ba                      
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  end-if 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio  to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write
                              

                  when function numval(amontext-det(6)) = -1 and 
                     function numval(amontext-det(16)) > 1 and
                     function numval(amontext-det(18)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio


                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 603                    to romhrk-depkod                              
                                      move "B"                    to romhrk-ba
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                 
                  when function numval(amontext-det(6)) = -1 and 
                     function numval(amontext-det(16)) > 1 and
                     function numval(amontext-det(18)) > 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio
                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-depkod
                                  end-read
        
*                                      move 603                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                   

                  when function numval(amontext-det(6)) = 1 and 
                     function numval(amontext-det(15)) < 0 and
                     function numval(amontext-det(16)) > 1
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio
                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read
                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 603                    to romhrk-depkod                              
                                      move "B"                    to romhrk-ba
                                      move function numval(amontext-det(18)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                  

                  when function numval(amontext-det(6)) = 1 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio
                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 600                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                                
                  when function numval(amontext-det(6)) < 0 and 


                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio
                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 600                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 
                            

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                  
                 when function numval(amontext-det(6)) < 0 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) > 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio
                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-depkod
                                  end-read
        
                              
                                  move "B"                    to romhrk-ba
                                  move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                  if KONUK-FOL-KODU = "R"
                                    write romhrk-rec invalid
                                         if debug = 1 stop "romhrk" end-if
                                    end-write 
                        
                                   else
                                      move romhrk-rec   to exthrk-rec                 
                                      write exthrk-rec invalid 
                                           if debug = 1 stop "exthrk" end-if                    
                                      end-write 
                                   end-if
                        
                                   move romhrk-anah    to hrk2-ANAH
                                   move romhrk-rec     to yromhrk-rec
                                   move romhrk-folio   to yromhrk-kaynak-folio
                                   move romhrk-folio   to hrk2-kaynak-folio
                                   move romhrk-folio to yromhrk-folio
                                   write hrk2-rec invalid
                                      if debug = 1 stop " " end-if
                                   end-write 
                                   write yromhrk-rec invalid
                                      if debug = 1 stop " " end-if
                                   end-write                        
                                            
                  when function numval(amontext-det(6)) > 0 and 
                     function numval(amontext-det(16)) = 1 and
                     function numval(amontext-det(15)) < 0
                          initialize romhrk-rec exthrk-rec rez-rec
                          add 1           to uuasya-sira
                          move function numval(amontext-det(4)) to ffolio-fide-folio
                          read ffolio no lock invalid 
                               if d = 1 stop "ffolio" end-if 
                          end-read  
                                initialize konuk-rec 
                                move ffolio-asya-folio  to konuk-folio
                                read konuk no lock invalid 
                                     exit perform cycle 
                                end-read

                                  move amontext-det(8)  to romhrk-tarih
                                  move amontext-det(9)  to romhrk-zaman
                                  move uuasya-sira      to romhrk-islem
                                  move konuk-folio      to romhrk-folio
                                  move "M"              to ROMHRK-ISLEM-TIPI
                
                                  initialize fdepkod-rec 
                                  move function numval (amontext-det(5))  to fdepkod-fide-kodu
                                  read fdepkod no lock invalid 
                                       stop " "
                                  not invalid 
                                      move fdepkod-asya-kodu to romhrk-corr-depkod
                                  end-read
        
                                      move 600                    to romhrk-depkod                              
                                      move "A"                    to romhrk-ba
                                      move function numval(amontext-det(17)) to romhrk-tl-tutar
                                  
                                 
*                            if amontext-det(21) not = spaces
*                               move function numval(amontext-det(21)) to romhrk-fatura-no 
*                            end-if 
                            initialize fat-rec
                            move function numval(amontext-det(1)) to fat-zpos-id
                            move konuk-folio                      to fat-folio
                            move function numval(amontext-det(20)) to fat-pen
                            read fat no lock invalid 
                                  continue 
                            not invalid 
                                 move function numval(fat-number)  to romhrk-fatura-no
                            end-read 

                            move function numval(amontext-det(20)) to ROMHRK-ref
                             initialize folref-rec 
                             move romhrk-folio to folref-FOLIO      
                             move function numval(amontext-det(20)) to folref-ref 
                             move function numval(amontext-det(22)) to folref-profil-no
                             move "arte2012"                        to folref-profil-sirket
        
                             write folref-rec invalid 
                                rewrite folref-rec end-rewrite 
                             end-write 

                                         if KONUK-FOL-KODU = "R"
                                           write romhrk-rec invalid
                                                if debug = 1 stop "romhrk" end-if
                                           end-write 
                        
                                          else
                                             move romhrk-rec   to exthrk-rec                 
                                             write exthrk-rec invalid 
                                                  if debug = 1 stop "exthrk" end-if                    
                                             end-write 
                                          end-if
                        
                                          move romhrk-anah    to hrk2-ANAH
                                          move romhrk-rec     to yromhrk-rec
                                          move romhrk-folio   to yromhrk-kaynak-folio
                                          move romhrk-folio   to hrk2-kaynak-folio
                                          move romhrk-folio  to yromhrk-folio
                                          write hrk2-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write 
                                          write yromhrk-rec invalid
                                             if debug = 1 stop " " end-if
                                          end-write                        
                   when other
                     if d = 1 stop " " end-if 
                   end-evaluate
                         
             end-if 
       end-if  
    end-read
    end-perform
    close fidetext 
    close amontext konuk ffolio fat rez depkod  folref yromhrk hrk2 ozluk ozluk2 romhrk exthrk.
 
*
 doviz-kodu-al.
    move "doviz.txt"  to fidetext-adi
    move "doviz2.txt" to amontext-adi
    open input fidetext
    open output amontext doviz   
    open output fdoviz close fdoviz
     open i-o  fdoviz  
     initialize fdoviz-rec 
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
           initialize fdoviz-rec doviz-rec 
           move amontext-det(1) to Fdoviz-FIDE-KODU
           move function numval(amontext-det(4)) to fdoviz-asya-kodu doviz-kodu
           move amontext-det(2)                  to D-KISA-ADI D-MERKEZ-BANKA-KODU
           move amontext-det(3)                  to D-ADI-1
           move d-adi-1 to lck13
           perform turkce-convert
           move lck13 to d-adi-1
              call "c$toupper" using D-ADI-1 value 100

         write doviz-rec invalid 
            if d = 1 stop "doviz"  end-if 
         end-write 
         write fdoviz-rec invalid 
            if d = 1 stop "fdoviz"  end-if 
         end-write 


    end-read
    end-perform
    close fidetext 
    close amontext fdoviz doviz.
*
 turkce-convert.
       inspect lck13 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"

      .
*
 ulke-al.
    move "ulke.txt"  to fidetext-adi
    move "ulke2.txt" to amontext-adi
    open input fidetext
    open output amontext ulke
    open output fulke close fulke
     open i-o  fulke 
     initialize fulke-rec ulke-arttir
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
           initialize fulke-rec ulke-rec 
           add 1 to ulke-arttir
           move amontext-det(1)   to fulke-fide-kodu
           move ulke-arttir       to fulke-asya-kodu ulke-anah
           move amontext-det(5)   to ulke-adi
               inspect ulke-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using ulke-adi value 100

           move amontext-det(14)  to ULKE-akbs
           write fulke-rec invalid 
              if d = 1 stop "fulke" end-if 
           end-write 
           write ulke-rec invalid 
              if d = 1 stop "ulke" end-if 
           end-write 
    end-read
    end-perform
    close fidetext 
    close amontext fulke ulke.
*
 kaynak-al.
    move "kaynak.txt"  to fidetext-adi
    move "kaynak2.txt" to amontext-adi
    open input fidetext
    open output amontext fkaynak onbkodlar10
    close fkaynak  onbkodlar10
     open i-o  onbkodlar10 fkaynak
     initialize onbkodlar10-rec 
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
          if function numval(amontext-det(1)) > 0
             initialize kodlar02-rec fkaynak-rec
             move function numval(amontext-det(1))      to fkaynak-fide-kodu
             read fkaynak no lock invalid 
                  move amontext-det(5)                  to fkaynak-asya-kodu onbkodlar10-kodu1
                  move amontext-det(4)                  to onbkodlar10-adi
                  move "AB"                             to onbkodlar10-tipi
                  write fkaynak-rec end-write 
                  write onbkodlar10-rec end-write 
             end-read 
          end-if 
    end-read
    end-perform
    close fidetext 
    close amontext onbkodlar10 fkaynak.
*
 pazar-al.
    move "pazar.txt"  to fidetext-adi
    move "pazar2.txt" to amontext-adi
    open input fidetext
    open output amontext fpazar  
    close fpazar   
     open i-o  fpazar kodlar02
     initialize kodlar02-rec 
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
        
          if function numval(amontext-det(1)) > 0
             initialize kodlar02-rec fpazar-rec
             move amontext-det(1)               to fpazar-fide-kodu
             read fpazar no lock invalid 
                  move amontext-det(5)          to fpazar-asya-kodu kodlar02-kodu
                  move amontext-det(4)          to kodlar02-adi
                  move "E"                      to kodlar02-tipi
                  write fpazar-rec end-write
                  write kodlar02-rec invalid
                     rewrite kodlar02-rec end-rewrite 
                  end-write 
             end-read 
          end-if 
    end-read
    end-perform
    close fidetext 
    close amontext kodlar02 fpazar.
*
 efolio-al.
    move "efolio.txt"  to fidetext-adi
    move "efolio2.txt" to amontext-adi
    open input fidetext   
    open output amontext 
    open output ffolio close ffolio 
     open i-o  konuk ffolio  ozluk kur kart
     initialize konuk-rec 
     read fidetext next no lock


    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
           if function numval(amontext-det(1)) > 0               
              perform extra-cin
           end-if 
    end-read
    end-perform
    close fidetext 
    close amontext  ffolio konuk ozluk kur kart.
*
 cast-al.
    move "cast.txt"  to fidetext-adi
    move "cast2.txt" to amontext-adi
    open input fidetext
    open output amontext      
     open i-o  fblok cast rez fodalar gruplar fgrup odalar
     initialize rez-rec cast-rec hata-cast
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 1000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
            
         if function numval(amontext-det(1)) > 0
                initialize cast-rec
                move function numval(amontext-det(2))     to cast-rez-no

            unstring amontext-det(3) delimited by "." or " "
            into cast-gun cast-ay cast-yil
                 
*                move amontext-det(3)(1:2)                 to  cast-gun
*                move amontext-det(3)(4:2)                 to  cast-ay
*                move amontext-det(3)(7:4)                 to  cast-yil
*                if cast-yil < 2013
*                   exit perform cycle 
*                end-if 
                read cast no lock invalid 
                    continue
                    add 1 to hata-cast
                not invalid
                    
                    move function numval(amontext-det(6)) to cast-buyuk
                    if function numval(amontext-det(8)) > 0
                       move function numval(amontext-det(8)) to cast-sharenum
                    end-if
                    initialize fodalar-rec
                    move amontext-det(9) to fodalar-fide-kodu
                    read fodalar no lock invalid 
                       continue 
                    not invalid
                        move fodalar-asya-kodu    to cast-oda-no
                    end-read

*                    if function numval(amontext-det(13)) > 0
*                       initialize fgrup-rec
*                       move amontext-det(13)  to fgrup-fide-kodu
*                       read fgrup no lock invalid 
*                           if d = 1 stop "cast_fgrup" end-if  
*                       not invalid
*                           initialize gruplar-rec
*                           move fgrup-asya-kodu  to cast-grup gruplar-kodu
*                           read gruplar no lock invalid 
*                               continue 
*                           end-read 
*                           initialize rez-rec 
*                           move function numval(amontext-det(2)) to rez-no
*                           read rez no lock invalid 
*                                continue 
*                           not invalid 
*                               move cast-grup  to rez-grup-no
*                               move gruplar-adi to rez-grup-adi
*                               rewrite rez-rec end-rewrite 
*                           end-read 
*                            
*                       end-read 
*                    end-if

                    if function numval(amontext-det(12)) > 0
                       initialize fblok-rec
                       move amontext-det(12) to fblok-fide-kodu
                       read fblok no lock invalid 
                            continue 
                       not invalid 
                           initialize gruplar-rec
                           move fblok-asya-kodu   to gruplar-kodu
                           read gruplar no lock invalid 
                              continue 
                           not invalid 
                                move gruplar-kodu  to cast-grup
                                initialize rez-rec
                                move cast-rez-no   to rez-no
                                read rez no lock invalid 
                                     continue 
                                not invalid 
                                    move gruplar-kodu to rez-grup-no
                                    move gruplar-adi  to rez-grup-adi
                                    rewrite rez-rec end-rewrite 
                                end-read      
                                  
                           end-read 
                       end-read 
                    end-if 

                move function numval(amontext-det(16))     to cast-fiyati
                rewrite cast-rec end-rewrite 

                end-read


                display cast-rec 
         end-if 
    end-read
    end-perform
    close fidetext
    close amontext cast fgrup fblok rez gruplar fodalar odalar 
    display message box hata-cast.
*
 grup-al-yeni.
    move "grup.txt"  to fidetext-adi
    move "grup2.txt" to amontext-adi
    open input fidetext
    open output amontext      
     open i-o fgrup gruplar  ulke
     initialize rez-rec cast-rec hata-cast
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 1000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
          initialize gruplar-rec fgrup-rec
          if function numval(amontext-det(1)) > 0
             
             move function numval(amontext-det(1)) to gruplar-kodu fgrup-asya-kodu
             move amontext-det(1) to fgrup-fide-kodu
                  move amontext-det(3)  to gruplar-adi                  

                       inspect gruplar-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                       to x"8DA69A9E989980879FA7818D94"
                              call "c$toupper" using gruplar-adi value 100

                      unstring amontext-det(7)  delimited by "/" or "." or "   "
                      into    gruplar-gel-gun gruplar-gel-ay gruplar-gel-yil
        
                      unstring amontext-det(8)  delimited by "/" or "." or "   "
                      into    gruplar-git-gun gruplar-git-ay gruplar-git-yil 
*                      if gruplar-git-tar < 20130101
*                          exit perform cycle 
*                      end-if 
                      if function numval(amontext-det(10)) = 1
                         move "I"        to gruplar-durumu
                      end-if 
                    
                      move amontext-det(11) to gruplar-ulke
                      move 1               to gruplar-banka
                      move 1               to gruplar-doviz
                      move "FB" to gruplar-pan-tipi      
                      move "01" to gruplar-anlasma       
                      move "02" to gruplar-odeme         
                      move "01" to gruplar-pazar         
                      move "317" to gruplar-ulke           
                      move 4        to gruplar-grup-statu                     
                  write fgrup-rec end-write 
                  write gruplar-rec end-write 
             
          end-if 
 
    end-read
    end-perform
    close fidetext 
    close amontext fgrup gruplar ulke.
*
 blok-al-yeni.
    move "blok.txt"  to fidetext-adi
    move "blok2.txt" to amontext-adi
    open input fidetext
    open output amontext      
     open i-o fgrup gruplar  takvim ulke  fkonum blok facenta
     initialize rez-rec cast-rec hata-cast
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 1000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
          initialize gruplar-rec fgrup-rec

          if function numval(amontext-det(13)) > 0
             
             move function numval(amontext-det(13)) to gruplar-kodu fgrup-asya-kodu
             read gruplar no lock invalid
                   move amontext-det(13)        to fgrup-fide-kodu
                   initialize facenta-rec 
                   move amontext-det(7)         to facenta-fide-kodu
                   read facenta no lock invalid 
                       continue                     
                   not invalid 
                           move facenta-asya-kodu     to gruplar-acenta                         
                   end-read
                     
                     move 1               to gruplar-banka
                     move 1               to gruplar-doviz
                     move "FB" to gruplar-pan-tipi      
                     move "01" to gruplar-anlasma       
                     move "02" to gruplar-odeme         
                     move "01" to gruplar-pazar         
                     move "317" to gruplar-ulke          

                     move 4                    to gruplar-grup-statu 
                     move amontext-det(25)     to gruplar-gel-tar
                     move amontext-det(26)     to gruplar-git-tar
*                      if gruplar-git-tar < 20130101
*                          exit perform cycle 
*                      end-if 

                   move amontext-det(14)  to gruplar-adi
                       inspect gruplar-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                       to x"8DA69A9E989980879FA7818D94"
                              call "c$toupper" using gruplar-adi value 100
                   write fgrup-rec end-write 
                   write gruplar-rec end-write                   
                   
             not invalid
                   initialize facenta-rec 
                   move amontext-det(7)        to facenta-fide-kodu
                   read facenta no lock invalid 
                       continue                     
                   not invalid 
                           move facenta-asya-kodu     to gruplar-acenta                         
                   end-read
                     
                     move 1               to gruplar-banka
                     move 1               to gruplar-doviz
                     move "FB" to gruplar-pan-tipi      
                     move "01" to gruplar-anlasma       
                     move "02" to gruplar-odeme         
                     move "01" to gruplar-pazar         
                     move "317" to gruplar-ulke          

                     move 4        to gruplar-grup-statu 
                   if amontext-det(25)(1:8) < gruplar-gel-tar
                      move amontext-det(25)     to gruplar-gel-tar
                   end-if 
                   if amontext-det(26)(1:8) > gruplar-git-tar
                      move amontext-det(26)     to gruplar-git-tar
                   end-if 
                   rewrite gruplar-rec end-rewrite                  
             end-read
             initialize takvim-rec
              move amontext-det(25) to takvim-anah
              start takvim key not < takvim-anah invalid
                  continue 
              not invalid 
              perform with test after until fs-takvim = "10"
              read takvim next no lock end move "10" to fs-takvim
              not at end 
                     if takvim-anah >= amontext-det(26)
                        exit perform 
                     end-if
                     initialize blok-rec
                     move takvim-anah    to blok-tarih
                     move gruplar-kodu   to blok-kodu
                     initialize fkonum-rec
                      move amontext-det(16)        to fkonum-fide-kodu
                      read fkonum no lock invalid 
                           move 1                  to fkonum-asya-kodu
                      end-read
                      move fkonum-asya-kodu        to blok-konum
                      read blok no lock invalid 
                           continue 
                      end-read 
                           add function numval(amontext-det(2))  to blok-ayrilan-oda
                           write blok-rec invalid 
                                   rewrite blok-rec end-rewrite 
                           end-write 
                     
              end-read 
              end-perform
              end-start
          else 
              move 1 to gruplar-kodu  fgrup-asya-kodu fgrup-fide-kodu
              read gruplar no lock invalid 
                   move amontext-det(6)     to gruplar-adi
                       inspect gruplar-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                       to x"8DA69A9E989980879FA7818D94"
                              call "c$toupper" using gruplar-adi value 100


                   move amontext-det(25)     to gruplar-gel-tar
                   move amontext-det(26)     to gruplar-git-tar
                   move amontext-det(29)     to gruplar-not1
                   move amontext-det(32)     to gruplar-isl-tar              

                   initialize facenta-rec 
                   move amontext-det(7)      to facenta-fide-kodu
                   read facenta no lock invalid 
                       continue                     
                   not invalid 
                           move facenta-asya-kodu     to gruplar-acenta                         
                   end-read
                     
                     move 1               to gruplar-banka
                     move 1               to gruplar-doviz
                     move "FB" to gruplar-pan-tipi      
                     move "01" to gruplar-anlasma       
                     move "02" to gruplar-odeme         
                     move "01" to gruplar-pazar         
                     move "317" to gruplar-ulke          

                     move 4        to gruplar-grup-statu
                     write fgrup-rec end-write 
                   write gruplar-rec end-write 
              not invalid   
                   if amontext-det(25)(1:8) < gruplar-gel-tar
                      move amontext-det(25)     to gruplar-gel-tar
                   end-if 
                   if amontext-det(26)(1:8) > gruplar-git-tar
                      move amontext-det(26)     to gruplar-git-tar
                   end-if 
                   rewrite gruplar-rec end-rewrite 
              end-read
              
              initialize takvim-rec
              move amontext-det(25) to takvim-anah
              start takvim key not < takvim-anah invalid
                  continue 
              not invalid 
              perform with test after until fs-takvim = "10"
              read takvim next no lock end move "10" to fs-takvim
              not at end 
                     if takvim-anah >= amontext-det(26)
                        exit perform 
                     end-if
                     initialize blok-rec
                     move takvim-anah    to blok-tarih
                     move gruplar-kodu   to blok-kodu
                     initialize fkonum-rec
                      move amontext-det(16)        to fkonum-fide-kodu
                      read fkonum no lock invalid 
                           move 1                  to fkonum-asya-kodu
                      end-read
                      move fkonum-asya-kodu        to blok-konum
                      read blok no lock invalid 
                           continue 
                      end-read 
                           add function numval(amontext-det(2))  to blok-ayrilan-oda
                           write blok-rec invalid 
                           rewrite blok-rec end-rewrite 
                           end-write 
                     
              end-read 
              end-perform
              end-start              
            end-if 
    end-read
    end-perform
    close fidetext 
    close amontext fgrup gruplar fkonum ulke takvim blok facenta.
    .
*
 bilbord-al.
    move "bilbord.txt"  to fidetext-adi
    move "bilbord2.txt" to amontext-adi
    open input fidetext
    open output amontext      
     open i-o fgrup gruplar  ulke
     initialize rez-rec cast-rec hata-cast
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 1000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
           initialize gruplar-rec           
           if function numval(amontext-det(1)) > 0             
              move function numval(amontext-det(1)) to gruplar-kodu
              compute gruplar-kodu = function numval(amontext-det(1)) + 5000
              move grup-kodu to fgrup-asya-kodu
              move amontext-det(1) to fgrup-fide-kodu
              read gruplar no lock invalid 
                   move amontext-det(3)     to gruplar-adi
                       inspect gruplar-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
                       to x"8DA69A9E989980879FA7818D94"
                              call "c$toupper" using gruplar-adi value 100

                      unstring amontext-det(4)  delimited by "/" or "." or "   "
                      into    gruplar-gel-gun gruplar-gel-ay gruplar-gel-yil
        
                      unstring amontext-det(5)  delimited by "/" or "." or "   "
                      into    gruplar-git-gun gruplar-git-ay gruplar-git-yil
                   if amontext-det(3)(1:3) = "AKM"
                      move "0220"    TO gruplar-acenta
                   else
                      move "0006"    TO gruplar-acenta                     
                   end-if 
                     
                     move 1               to gruplar-banka
                     move 1               to gruplar-doviz
                     move "FB" to gruplar-pan-tipi      
                     move "01" to gruplar-anlasma       
                     move "02" to gruplar-odeme         
                     move "01" to gruplar-pazar         
                     move "317" to gruplar-ulke          

                     move 4        to gruplar-grup-statu
                     write fgrup-rec end-write 
                   write gruplar-rec end-write
              not invalid 
                  stop " "  
              end-read
           end-if 
 
    end-read
    end-perform
    close fidetext 
    close amontext fgrup gruplar ulke.
    .
*
 bilhrk-al.
    initialize ydk-doviz-kodu xgruplar-kodu xblok-kodu   
    move "bilhrk.txt"           to fidetext-adi
    move "bilhrk2.txt"          to amontext-adi
    open output amontext fblok     
    close fblok       
    open i-o rez  depkod yanrez  fblok blok gruplar fgrup  takvim acenta fshare 
             konuk ozluk musteri doviz prohrk  
             polisxml fkonum facenta  
             fidetext fdoviz ffirma firma frez

    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 
    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec  
    perform varying k from 1 by 1 until k > 200
    unstring  fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
           
           initialize blok-rec           
           if function numval(amontext-det(3)) > 0             
              move function numval(amontext-det(3)) to blok-kodu
              compute blok-kodu = function numval(amontext-det(3)) + 5000
              unstring amontext-det(2)  delimited by "/" or "." or "   "
              into    blok-gun blok-ay blok-yil
 
              initialize gruplar-rec
              move blok-kodu       to gruplar-kodu
              read gruplar no lock invalid 
                  continue 
              end-read 
              initialize fkonum-rec
              move amontext-det(4) to fkonum-fide-kodu
              read fkonum no lock invalid 
                 move 1   to fkonum-asya-kodu
              end-read 
                 move fkonum-asya-kodu   to blok-konum
              read blok no lock invalid 
                  move function numval(amontext-det(9))  to blok-ayrilan-oda
                  write blok-rec end-write
              not invalid 
                  continue 
              end-read

              initialize fblok-rec
              move amontext-det(1)  to fblok-fide-kodu
              read fblok no lock invalid 
                   move blok-kodu   to fblok-asya-kodu
                   write fblok-rec end-write 
              end-read 

           end-if 

    end-read
    end-perform              
    close amontext fidetext rez  fgrup gruplar fblok blok 
          takvim ozluk frez fdoviz doviz yanrez  
          prohrk   fkonum musteri konuk ffirma firma 
          depkod acenta polisxml facenta fshare. 
    .
*
 cast-rez-fiy-yaz.
    open i-o cast rez  konuk
    initialize cast-rec
    start cast key not < cast-anah invalid 
          continue 
    not invalid 
    perform with test after until fs-cast = "10"
    read cast next no lock end move "10"  to fs-cast 
    not at end           
             initialize rez-rec
             move cast-rez-no   to rez-no
             read rez no lock invalid 
                  continue 
             not invalid                
               if cast-tarih = rez-cik-tar
                   exit perform cycle 
               end-if
               if cast-tarih not = rez-gir-tar and
                  tarih-tasi <= rez-gir-tar
                     exit perform cycle 
               end-if 
               if cast-fiyati = 0
                  exit perform cycle 
               end-if
               if tarih-tasi > rez-gir-tar and
                  tarih-tasi < rez-cik-tar and
                  cast-tarih not = tarih-tasi 
                     exit perform cycle 
               end-if 
               move cast-fiyati  to rez-fiyati
               rewrite rez-rec end-rewrite 
             end-read 
            
    end-read
    end-perform
    end-start

    initialize rez-rec
    start rez key not < rez-anah invalid 
        continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end 
            initialize konuk-rec
            move rez-folio   to konuk-folio
            read konuk no lock invalid
                continue 
            not invalid
                move rez-fiyati  to konuk-oda-tutar
                compute KONUK-DV-DEGERI rounded = konuk-oda-tutar / konuk-kur-degeri
                rewrite konuk-rec end-rewrite 
            end-read 
    end-read 
    end-perform
    end-start
    close cast rez konuk
    .
*
 fat-pen-al.
    move "fat.txt"  to fidetext-adi
    move "fat2.txt" to amontext-adi
    open input fidetext
    open output amontext fat
    close fat  
     open i-o fat 
     initialize fat-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 1000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
           if function numval(amontext-det(1)) > 0
              initialize fat-rec
              move function numval(amontext-det(1))      to fat-zpos-id
                  move function numval(amontext-det(2))  to fat-folio
                  move function numval(amontext-det(4))  to fat-pen
              read fat no lock invalid 
                  move amontext-det(3)                   to fat-number
                  write fat-rec end-write 
              end-read 
           end-if 
    end-read
    end-perform
    close fidetext 
    close amontext fat.
*
 dep-duzelt.
    open i-o romhrk exthrk yromhrk hrk2 depkod depkod2
    initialize romhrk-rec exthrk-rec yromhrk-rec hrk2-rec
    start romhrk key not < romhrk-anah invalid 
       continue 
    not invalid 
    perform with test after until fs-romhrk = "10"
    read romhrk next no lock end move "10" to fs-romhrk
    not at end      
            initialize depkod-rec depkod2-rec
            move ROMHRK-CORR-DEPKOD  to DEPKOD-KODU
            read depkod no lock invalid 
               continue 
            not invalid
                
                if DEPKOD-MATRAH-HESAP not = spaces
                   initialize depkod2-rec
                   move DEPKOD-MATRAH-HESAP(2:3) to ROMHRK-CORR-DEPKOD 
                                           depkod2-anah
                   read depkod2 no lock invalid 
                       stop " " 
                   end-read
                   evaluate DEPKOD-MATRAH-HESAP(1:1)
                   when "D"   
                       move "601"   to romhrk-depkod
                   when "R"
                       move "600"   to romhrk-depkod
                   when other 
                      stop " "
                   end-evaluate 
                   rewrite romhrk-rec end-rewrite
                   move romhrk-anah   to hrk2-anah
                   read hrk2 no lock invalid 
                       stop " " 
                   end-read 
                      move romhrk-anah        to yromhrk-anah
                      move hrk2-kaynak-folio  to yromhrk-folio
                      read yromhrk no lock invalid 
                           stop " "
                      end-read 
                         move romhrk-depkod   to yromhrk-depkod
                         move romhrk-corr-depkod to yromhrk-corr-depkod 
                         rewrite yromhrk-rec end-rewrite 
                end-if 
            end-read 
    end-read 
    end-perform
    end-start

    initialize exthrk-rec  yromhrk-rec hrk2-rec
    start exthrk key not < exthrk-anah invalid 
       continue 
    not invalid 
    perform with test after until fs-exthrk = "10"
    read exthrk next no lock end move "10" to fs-exthrk
    not at end 
            initialize depkod-rec depkod2-rec
            move extHRK-CORR-DEPKOD  to depkod-anah
            read depkod no lock invalid 
               continue 
            not invalid 
                if DEPKOD-MATRAH-HESAP not = spaces
                   initialize depkod2-rec
                   move DEPKOD-MATRAH-HESAP(2:3) to extHRK-CORR-DEPKOD 
                                           depkod2-anah
                   read depkod2 no lock invalid 
                       stop " " 
                   end-read
                   evaluate DEPKOD-MATRAH-HESAP(1:1)

                   when "D"   
                       move "601"   to exthrk-depkod
                   when "R"
                       move "600"   to exthrk-depkod
                   when other 
                      stop " "
                   end-evaluate 
                   rewrite exthrk-rec end-rewrite
                   move exthrk-anah   to hrk2-anah
                   read hrk2 no lock invalid 
                       stop " " 
                   end-read 
                      move exthrk-anah        to yromhrk-anah
                      move hrk2-kaynak-folio  to yromhrk-folio
                      read yromhrk no lock invalid 
                           stop " "
                      end-read 
                         move exthrk-depkod   to yromhrk-depkod
                         move exthrk-corr-depkod to yromhrk-corr-depkod 
                         rewrite yromhrk-rec end-rewrite 
                end-if 
            end-read 
          
    end-read 
    end-perform
    end-start

    close romhrk exthrk yromhrk hrk2 depkod depkod2
    .
*
 cast-duzelt.
    move "cast.txt"  to fidetext-adi
    move "cast2.txt" to amontext-adi
    open input fidetext
    open output amontext      
     open i-o  fblok cast konuk rez fodalar gruplar fgrup odalar
     initialize rez-rec cast-rec hata-cast
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 1000
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
            
         if function numval(amontext-det(1)) > 0
             if function numval(amontext-det(2)) > 0
                initialize cast-rec
                move function numval(amontext-det(2))     to cast-rez-no                 
                move amontext-det(3)(1:2)                 to cast-gun
                move amontext-det(3)(4:2)                 to cast-ay
                move amontext-det(3)(7:4)                 to cast-yil
*                if cast-yil < 2013
*                   exit perform cycle 
*                end-if 
                read cast no lock invalid 
                     add 1 to hata-cast
                     continue 
                not invalid 
                        initialize rez-rec 
                        move function numval(amontext-det(2)) to rez-no
                        read rez no lock invalid 
                           add 1 to hata-cast
                           continue 
                        not invalid 
                            if rez-doviz not = 01
                               move function numval(amontext-det(20)) to rez-fiyati cast-fiyati
                            end-if 
                            initialize konuk-rec 
                            move rez-folio to konuk-folio
                            read konuk no lock invalid                         
                                add 1 to hata-cast
                                continue 
                            not invalid 
                               if konuk-acenta not = "0107"
                                 move  "02"  to konuk-odeme-tipi
                                 rewrite konuk-rec end-rewrite                        
                               end-if 
                            end-read 
                                 if rez-acenta not = "0107"
                                    move "02"   to rez-odeme-tipi 
                                 end-if
                
                                 rewrite rez-rec end-rewrite
         
                                 rewrite cast-rec end-rewrite 
                        end-read
                    end-read 
             end-if 


                display cast-rec 
         end-if 
    end-read
    end-perform
    close fidetext
    close amontext cast fgrup fblok konuk rez gruplar fodalar odalar.
    display message box hata-cast.
*
 Form1-Pb-1aaaaa-Link.
         perform takaslck-dosya-ac
         open i-o takaslck
         move "/asya/ytl/depesle.txt"  to txteslestirme-adi
         open input txteslestirme
         perform until fs-txteslestirme = "10" 
         initialize txteslestirme-rec
         read txteslestirme next no lock end move "10" to fs-txteslestirme
         not at end    
             if debug = "12" stop "takasayaziyom" end-if

             move txteslestirme-rec(1:3) to gel-dep 
             move txteslestirme-rec(5:3) to cor-dep 
         
             initialize takaslck-rec

                move gel-dep to takaslck-gel-dep
                move cor-dep to takaslck-cor-dep
             
             write takaslck-rec end-write

         end-read              
         end-perform
         move 1 to corr-dep-duzelt
         perform romhrk-corr-duzelt
         perform exthrk-corr-duzelt
         perform yromhrk-corr-duzelt
         move 2 to corr-dep-duzelt
         perform romhrk-corr-duzelt
         perform exthrk-corr-duzelt
         perform yromhrk-corr-duzelt
         display message box "Bakim Tamamlandi.."
         close takaslck         
         delete file takaslck.
*
 takaslck-dosya-ac.
      open input genelfis
      initialize genelfis-rec 
      move 1        to genelfis-anahtar
      read genelfis no lock invalid 
               continue
      not invalid
           add 1 to EKRAN-FIS-1
           move EKRAN-FIS-1 to takaslck-no
      end-read 
      close genelfis
      open output takaslck close takaslck

       .
*
 tyrez-dosya-ac.
      open input genelfis
      initialize genelfis-rec 
      move 1        to genelfis-anahtar
      read genelfis no lock invalid 
               continue
      not invalid
           add 1 to EKRAN-FIS-1
           move EKRAN-FIS-1 to tyrez-no
      end-read 
      close genelfis
      open output tyrez close tyrez
       .
*
 romhrk-corr-duzelt.
        open i-o romhrk 
        initialize romhrk-rec
        start romhrk key not < romhrk-anah2 invalid
              continue
        not invalid
        perform with test after until fs-romhrk = "10"
        read romhrk next no lock end move "10" to fs-romhrk
        not at end 
            if corr-dep-duzelt = 1
               if romhrk-tarih   > 20171101 or
                  romhrk-depkod <> 600
                  exit perform cycle
               end-if
               initialize takaslck-rec
               move romhrk-corr-depkod to takaslck-gel-dep
               read takaslck no lock invalid 
                    if debug = 13 stop "eslenen depkod" end-if
               not invalid
                   move takaslck-cor-dep to romhrk-corr-depkod
                   rewrite romhrk-rec end-rewrite
               end-read
            else 
               if romhrk-depkod >= 600
                  exit perform cycle
               end-if
               initialize takaslck-rec
               move romhrk-depkod to takaslck-gel-dep
               read takaslck no lock invalid 
                    if debug = 13 stop "eslenen depkod" end-if
               not invalid
                   move takaslck-cor-dep to romhrk-depkod
                   rewrite romhrk-rec end-rewrite
               end-read
            end-if
        end-read
        end-perform 
        end-start
        close romhrk 
      .
*
 exthrk-corr-duzelt.
        open i-o exthrk 
        initialize exthrk-rec
        start exthrk key not < exthrk-anah2 invalid
              continue
        not invalid
        perform with test after until fs-exthrk = "10"
        read exthrk next no lock end move "10" to fs-exthrk
        not at end 
        
*            if exthrk-tarih   > 20171101 or
*               exthrk-depkod <> 600
*               exit perform cycle
*            end-if
*            initialize takaslck-rec
*            move exthrk-corr-depkod to takaslck-gel-dep
*            read takaslck no lock invalid 
*                 if debug = 13 stop "eslenen depkod" end-if
*            not invalid
*                move takaslck-cor-dep to exthrk-corr-depkod
*                rewrite exthrk-rec end-rewrite
*            end-read
            if exthrk-islem = 1000564
               stop " "
            end-if
            if corr-dep-duzelt = 1
               if exthrk-tarih   > 20171101 or
                  exthrk-depkod <> 600
                  exit perform cycle
               end-if
               initialize takaslck-rec
               move exthrk-corr-depkod to takaslck-gel-dep
               read takaslck no lock invalid 
                    if debug = 13 stop "eslenen depkod" end-if
               not invalid
                   move takaslck-cor-dep to exthrk-corr-depkod
                   rewrite exthrk-rec end-rewrite
               end-read
            else 
               if exthrk-depkod >= 600
                  exit perform cycle
               end-if
               initialize takaslck-rec
               move exthrk-depkod to takaslck-gel-dep
               read takaslck no lock invalid 
                    if debug = 13 stop "eslenen depkod" end-if
               not invalid
                   move takaslck-cor-dep to exthrk-depkod
                   rewrite exthrk-rec end-rewrite
               end-read
            end-if





        end-read
        end-perform 
        end-start
        close exthrk 
      .
*
 yromhrk-corr-duzelt.
        open i-o yromhrk 
        initialize yromhrk-rec
        start yromhrk key not < yromhrk-anah2 invalid
              continue
        not invalid
        perform with test after until fs-yromhrk = "10"
        read yromhrk next no lock end move "10" to fs-yromhrk
        not at end 
        
            if corr-dep-duzelt = 1
               if yromhrk-tarih   > 20171101 or
                  yromhrk-depkod <> 600
                  exit perform cycle
               end-if
               initialize takaslck-rec
               move yromhrk-corr-depkod to takaslck-gel-dep
               read takaslck no lock invalid 
                    if debug = 13 stop "eslenen depkod" end-if
               not invalid
                   move takaslck-cor-dep to yromhrk-corr-depkod
                   rewrite yromhrk-rec end-rewrite
               end-read
            else 
               if yromhrk-depkod >= 600
                  exit perform cycle
               end-if
               initialize takaslck-rec
               move yromhrk-depkod to takaslck-gel-dep
               read takaslck no lock invalid 
                    if debug = 13 stop "eslenen depkod" end-if
               not invalid
                   move takaslck-cor-dep to yromhrk-depkod
                   rewrite yromhrk-rec end-rewrite
               end-read
            end-if

        end-read
        end-perform 
        end-start
        close yromhrk 
      .

*
 tarih-ayirma.
             evaluate "."                                         | rez-gir-tar                     
                 when amontext-det(6)(2:1)
                      move amontext-det(6)(1:1) to rez-gir-gun
                      evaluate "."
                          when amontext-det(6)(4:1)
                               move amontext-det(6)(3:1) to rez-gir-ay 
                               move amontext-det(6)(5:4) to rez-gir-yil
                          when amontext-det(6)(5:1)
                               move amontext-det(6)(3:2) to rez-gir-ay 
                               move amontext-det(6)(6:4) to rez-gir-yil
                      end-evaluate 
                 when amontext-det(6)(3:1)
                      move amontext-det(6)(1:2) to rez-gir-gun
                      evaluate "."
                          when amontext-det(6)(5:1)
                               move amontext-det(6)(4:1) to rez-gir-ay 
                               move amontext-det(6)(6:4) to rez-gir-yil
                          when amontext-det(6)(6:1)
                               move amontext-det(6)(4:2) to rez-gir-ay 
                               move amontext-det(6)(7:4) to rez-gir-yil
                      end-evaluate                                                    
             end-evaluate    

             evaluate "."                                         | rez-cik-tar                     
                 when amontext-det(7)(2:1)
                      move amontext-det(7)(1:1) to rez-cik-gun
                      evaluate "."
                          when amontext-det(7)(4:1)
                               move amontext-det(7)(3:1) to rez-cik-ay 
                               move amontext-det(7)(5:4) to rez-cik-yil
                          when amontext-det(7)(5:1)
                               move amontext-det(7)(3:2) to rez-cik-ay 
                               move amontext-det(7)(6:4) to rez-cik-yil
                      end-evaluate 
                 when amontext-det(7)(3:1)
                      move amontext-det(7)(1:2) to rez-cik-gun
                      evaluate "."
                          when amontext-det(7)(5:1)
                               move amontext-det(7)(4:1) to rez-cik-ay 
                               move amontext-det(7)(6:4) to rez-cik-yil
                          when amontext-det(7)(6:1)
                               move amontext-det(7)(4:2) to rez-cik-ay 
                               move amontext-det(7)(7:4) to rez-cik-yil
                      end-evaluate 
             end-evaluate    .




 
