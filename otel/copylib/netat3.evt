* netat3.evt
* netat3.evt is generated from D:\asya\acugt.ytl\otel\netat3.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 acc-ref-Exception-Proc.
     PERFORM acc-ref-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform adresleri-tasi.
     move tarih-tasi     to tarih.
        open input genel
    move 1 to genel-anahtar
    read genel no lock
      invalid
        move 3 to mesaj-no
        perform mesaj-ver
        set exit-pushed to true
      not invalid
        continue
*        move muha-sirketi to odenmez-dosya-adres
    end-read
    close genel
      call "c$narg" using link-var.
    move genel-muha-ref to ref
     if ONKPARA-REFERANS-VAR = 1 then 
       move 1 to ref-var
       else
       move 0 to ref-var
    end-if
     initialize referans-ip
        perform acuserve-adres-aktar.
     
     open input mgenel.
     move 1 to mgenel-anahtar.
     read mgenel no lock invalid
          display message box 
                  "mgenel parametre tanimsiz ..."
                  icon mb_error_icon
                  title "Hata"
                  close mgenel
                  destroy form1-handle
                  goback
     end-read.
     close mgenel.
     initialize referans-ip
    

     

     if mgenel-referans = "E" 
        move 1 to vis-1
     else
        move 0 to vis-1
     end-if.
     move 1 to enable-1
     move 0 to enable-2.
     
     .

*
 Form1-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\* 

  
     .


*
  dov-kont.
     initialize hesap-rec
                   move mahsup-hesap-kodu      to   hesap-kodu
                 read hesap no lock invalid continue
                 end-read
                   if not hesap-doviz-li
*                      initialize mahsup-banka-kodu 
*                                 mahsup-doviz-kodu 
*                                 mahsup-d-e        
*                                 mahsup-doviz-kuru  
*                                 mahsup-tutar-dv
                            continue
                   end-if  .
*
*
 acc-yil-Aft-Procedure.  
     initialize gec-gecme.
     open input takvim.
     move tarih   to takvim-anah
     read takvim no lock invalid
          move 1 to gec-gecme
     end-read
     close takvim.

     if girilemez-tarih <> zeroes 
        if tarih < girilemez-tarih
           move 1 to gec-gecme
           display message box
                   girilemez-gun,"/",girilemez-ay,"/",girilemez-yil,
                   " tarihinden onceye mahsup fisi kesilemez ....",
                   icon mb_error_icon
                   title "Hata"
        end-if
     end-if.
*
 acc-numara-Aft-Procedure.
     initialize gec-gecme.
     if numara = zeroes 
        open i-o genelfis 
        move 1 to genelfis-anahtar
        read genelfis no lock invalid
             display message box
                     "mgenel parametre'de genelfis fis tanimlamalari eksik !!!",new-line,
                     "Lutfen tanimlayiniz ..."
                     icon mb_error_icon
                     title "Hata"
                     destroy form1-handle
                     close genelfis
                     goback
        end-read
        add 1 to mahsup-oto
        move mahsup-oto to numara
        if mgenel-referans = "E"
           open i-o referans
             move ref   to referans-kodu
             move "A"   to referans-tipi
             read referans no lock invalid           
                  continue
             end-read
             add 1 to referans-fisno-ekle
             move referans-fisno-ekle   to numara
             add 6 to referans-fisno-ekle
             rewrite referans-rec end-rewrite

           close referans
        else
           add 6 to mahsup-oto
           rewrite genelfis-rec end-rewrite
        end-if
        close genelfis
        display acc-numara
     end-if.

     open input islenen.
     move numara to no-kont
     perform 6 times

     move no-kont to islenen-fis-no
     read islenen no lock invalid
          continue
     not invalid
          move 1 to gec-gecme
          display message box 
                  islenen-fis-no," numarali fis ",islenen-gun,"/",
                  islenen-ay,"/",islenen-yil," tarih kayitli",new-line,
                  "Lutfen kontrol ediniz",
                  icon mb_error_icon
                  title "Hata"
     end-read
     add 1 to no-kont 
     end-perform
     close islenen.
     
     .
*
 acc-ref-Aft-Procedure.
     initialize gec-gecme.
     if mgenel-referans = "E"
        continue else 
             exit paragraph.
     

     open input referans.
     move ref   to referans-kodu
     move "A"   to referans-tipi
     read referans no lock invalid
         initialize referans-ip
          perform acuserve-adres-aktar

          move 1 to gec-gecme
          move "Tanimsiz ..." to referans-adi
     not invalid
          
             perform acuserve-adres-aktar
         
     end-read
     close referans.
     display lb-ref.
     if referans-fisno-ekle not numeric
        move 0 to referans-fisno-ekle
     end-if.
     if nereden <> "E"
        move 0 to numara
        display acc-numara.     
     .


*
 Form1-Ex-Other.
      


     if key-status = 2001 or 
        key-status = 2002 or
        key-status = 2003 
        continue else 
             exit paragraph.
      if key-status = 2002 and 2 = 1    ||/// 16.11.2015 salih.y kaldiridii
           call "/asya/ytl/obj/otel/acfkont.asy" 
                    using  tarih 
                         on exception 
                     perform callerr-proc
                     exit paragraph
                    not on exception 
                 cancel "/asya/ytl/obj/otel/acfkont.asy"
          end-call
      end-if
     if key-status = 2001
        perform yaz-boggam
        exit paragraph.

     if key-status = 2003
        move 1 to enable-1 
        move 0 to enable-2
        modify form1-gd-1,reset-grid =1 
        display form1
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
        perform dil-ayarla-proc
*/-----------------------------\*         
        move 4 to accept-control
        move 4 to control-id
        close borc-dep alac-dep kasa-borc-dep kasa-alac-dep takas-acenta takaskar
        delete file borc-dep alac-dep  kasa-borc-dep kasa-alac-dep takas-acenta  takaskar

        exit paragraph.

*       display message box  "geldi".
     perform Acc-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 4 to control-id
        exit paragraph.

     perform Acc-Numara-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 8 to control-id
        exit paragraph.

     move "E" to nereden.
     perform Acc-Ref-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 12 to control-id
        exit paragraph.

     open i-o genelfis.
     move 1 to genelfis-anahtar.
     read genelfis no lock invalid move 1 to ekran-fis-1.
     if ekran-fis-1 > 250 move zero to ekran-fis-1.
     add 1 to ekran-fis-1.
     move ekran-fis-1 to borc-dep-no borc-fat-no.
     if ekran-fis-1 > 250 move zero to ekran-fis-1.
     add 1 to ekran-fis-1.
     move ekran-fis-1 to kasa-borc-dep-no.
     if ekran-fis-1 > 250 move zero to ekran-fis-1.
     add 1 to ekran-fis-1.
     move ekran-fis-1 to kasa-alac-dep-no.
     add 1 to ekran-fis-1.
     if ekran-fis-1 > 250 move zero to ekran-fis-1.
     add 1 to ekran-fis-1.
     move ekran-fis-1 to alac-dep-no.
     if ekran-fis-1 > 250 move zero to ekran-fis-1.
     add 1 to ekran-fis-1.
     move ekran-fis-1 to takas-acenta-no takaskar-no takas-pass-no.

     rewrite genelfis-rec invalid write genelfis-rec end-write end-rewrite.
     close genelfis.
     
     open output borc-dep   close borc-dep
     open output borc-fat close borc-fat. 
     open i-o borc-dep  with mass-update. 
     open i-o borc-fat  with mass-update.

     open output alac-dep close alac-dep open i-o alac-dep with mass-update.
     open output kasa-borc-dep close kasa-borc-dep open i-o kasa-borc-dep with mass-update.
     open output kasa-alac-dep close kasa-alac-dep open i-o kasa-alac-dep with mass-update.
     open output takas-acenta close takas-acenta open i-o takas-acenta with mass-update.
     open output takaskar close takaskar open i-o takaskar with mass-update.
      open output takas-pass close takas-pass open i-o takas-pass with mass-update.
     initialize kasa-borc-dep-rec kasa-alac-dep-rec borc-dep-rec alac-dep-rec takas-acenta-rec borc alac.

****|HAKAN|*** PROGRAMDAKÝ ARIZA YÜZÜNDEN BENÝ UÐRAÞTIRAN
**** DÝÐER PROGRAMCI ARKADAÞLARA SESLENÝYORUZ
*****
    perform fatdetay-oku
       
*********************** 2. tur ||/// 16.11.2015 salih.y kaldiridii
*
*     close borc-dep borc-fat alac-dep kasa-borc-dep kasa-alac-dep takas-acenta takaskar
*
*     if key-status = 2002
*           call "/asya/ytl/obj/otel/acfkont.asy" 
*                    using  tarih 
*                         on exception 
*                     perform callerr-proc
*                     exit paragraph
*                    not on exception 
*                 cancel "/asya/ytl/obj/otel/acfkont.asy"
*          end-call
*      end-if
*
*     open output borc-dep   close borc-dep
*     open output borc-fat close borc-fat. 
*     open i-o borc-dep  with mass-update. 
*     open i-o borc-fat  with mass-update.
*
*     open output alac-dep close alac-dep open i-o alac-dep with mass-update.
*     open output kasa-borc-dep close kasa-borc-dep open i-o kasa-borc-dep with mass-update.
*     open output kasa-alac-dep close kasa-alac-dep open i-o kasa-alac-dep with mass-update.
*     open output takas-acenta close takas-acenta open i-o takas-acenta with mass-update.
*     open output takaskar close takaskar open i-o takaskar with mass-update.
*
*     initialize kasa-borc-dep-rec kasa-alac-dep-rec borc-dep-rec alac-dep-rec takas-acenta-rec borc alac.
*
*         perform fatdetay-oku
*
*************************************
     move 0 to enable-1
     move 1 to enable-2
     display form1.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*  
        open input doviz depkod 
     modify form1-gd-1,reset-grid =1,mass-update = 1.
     move "Hesap kodu"       to gd-1-col-1
     move "Hesap adi"        to gd-1-col-2
     move "Aciklama"         to gd-1-col-3
     MOVE "Ref"              to gd-1-col-4
     move "Borc Tutar"       to gd-1-col-5
     move "Alacak Tutar"     to gd-1-col-6
     move "Doviz tutar"      to gd-1-col-7
     move "Doviz"            to gd-1-col-8
     modify form1-gd-1,record-to-add(form1-gd-1-record).

     open input hesap.
     initialize borc-dep-rec alac-dep-rec kasa-borc-dep-rec kasa-alac-dep-rec borc alac
     start borc-dep key not < borc-dep-anah2 invalid continue
     not invalid
     initialize fs-borc-dep
     perform with test after until fs-borc-dep = "10"
     read borc-dep next no lock end move "10" to fs-borc-dep
     not at end
          initialize form1-gd-1-record
          move borc-dep-hesap           to gd-1-col-1 hesap-kodu
          read hesap no lock invalid
                move BORC-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                not invalid 
                  move depkod-adi to hesap-adi(5:)
                end-read
                move depkod-kodu to hesap-adi(1:3)
               
          end-read
         
          
          move hesap-adi             to gd-1-col-2
          if borc-dep-folio > 0 then 
             move   borc-dep-folio to  gd-1-col-2(12:)
          end-if
          move borc-dep-aciklama     to gd-1-col-3
          move borc-dep-ref          to gd-1-col-4 
          if onkpara-referans-var = 1 then 
              move ref-adi(borc-dep-ref)          to gd-1-col-4
            end-if
          
          move borc-dep-tutar        to etutar
          if borc-dep-ba = "B"
             move etutar             to gd-1-col-5
          else
             move etutar             to gd-1-col-6
          end-if
          modify form1-gd-1,record-to-add(form1-gd-1-record)
          if borc-dep-ba = "B"
             add borc-dep-tutar to borc
          else
             add borc-dep-tutar to alac
          end-if
     end-read
     end-perform
     end-start
     initialize borc-dep-rec alac-dep-rec 
     
     start alac-dep key not < alac-dep-anah2 invalid continue
     not invalid
     initialize fs-alac-dep
     perform with test after until fs-alac-dep = "10"
     read alac-dep next no lock end move "10" to fs-alac-dep
     not at end
          initialize form1-gd-1-record
            
          
          move alac-dep-hesap           to gd-1-col-1 hesap-kodu
          read hesap no lock invalid
                move alac-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                  not invalid 
                  move depkod-adi to hesap-adi(5:)
                end-read
                move depkod-kodu to hesap-adi(1:3)
             
          end-read
          move hesap-adi             to gd-1-col-2
          move alac-dep-aciklama     to gd-1-col-3
          
            move alac-dep-ref          to gd-1-col-4
            
            if onkpara-referans-var = 1 then 
               
                 move ref-adi(alac-dep-ref)          to gd-1-col-4
                 
            end-if
          move alac-dep-tutar-tl     to etutar
        
          if alac-dep-ba = "B"
             move etutar             to gd-1-col-5
          else
             move etutar             to gd-1-col-6
          end-if
            move  alac-dep-tutar-dv     to etutar
             move etutar             to gd-1-col-7
               initialize doviz-rec
             move alac-dep-doviz    to doviz-kodu
             read doviz no lock invalid continue
             end-read
             move d-kisa-adi to gd-1-col-8
          modify form1-gd-1,record-to-add(form1-gd-1-record)
          if alac-dep-ba = "B"
             add alac-dep-tutar-tl to borc
          else
             add alac-dep-tutar-tl to alac
          end-if
     end-read
     end-perform
     end-start
********************* KASALAR **********************************
     start kasa-borc-dep key not < kasa-borc-dep-anah2 invalid continue
     not invalid
     initialize fs-kasa-borc-dep
     perform with test after until fs-kasa-borc-dep = "10"
     read kasa-borc-dep next no lock end move "10" to fs-kasa-borc-dep
     not at end
          initialize form1-gd-1-record
          move kasa-borc-dep-hesap           to gd-1-col-1 hesap-kodu
          read hesap no lock invalid
                move kasa-BORC-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                  not invalid 
                  move depkod-adi to hesap-adi(5:)
                end-read
                move depkod-kodu to hesap-adi(1:3)
            
          end-read
          move hesap-adi             to gd-1-col-2
          move kasa-borc-dep-aciklama     to gd-1-col-3
          move kasa-borc-dep-tutar        to etutar
          move kasa-borc-dep-ref          to gd-1-col-4
           if onkpara-referans-var = 1 then 
              move ref-adi(kasa-borc-dep-ref)          to gd-1-col-4
            end-if
          if kasa-borc-dep-ba = "B"
             move etutar             to gd-1-col-5
          else
             move etutar             to gd-1-col-6
          end-if
          modify form1-gd-1,record-to-add(form1-gd-1-record)
          if kasa-borc-dep-ba = "B"
             add kasa-borc-dep-tutar to borc
          else
             add kasa-borc-dep-tutar to alac
          end-if
     end-read
     end-perform
     end-start
            

     initialize kasa-borc-dep-rec kasa-alac-dep-rec 
     start kasa-alac-dep key not < kasa-alac-dep-anah2 invalid continue
     not invalid
     initialize fs-kasa-alac-dep
     perform with test after until fs-kasa-alac-dep = "10"
     read kasa-alac-dep next no lock end move "10" to fs-kasa-alac-dep
     not at end
          initialize form1-gd-1-record
          move kasa-alac-dep-hesap           to gd-1-col-1 hesap-kodu
          read hesap no lock invalid
                move kasa-alac-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                  not invalid 
                  move depkod-adi to hesap-adi(5:)
                end-read
                move depkod-kodu to hesap-adi(1:3)
             
          end-read
          move hesap-adi             to gd-1-col-2
          move kasa-alac-dep-aciklama     to gd-1-col-3
          move kasa-alac-dep-tutar     to etutar
            move kasa-alac-dep-ref          to gd-1-col-4
             if onkpara-referans-var = 1 then 
              move ref-adi(kasa-alac-dep-ref)          to gd-1-col-4
            end-if
          if kasa-alac-dep-ba = "B"
             move etutar             to gd-1-col-5
          else
             move etutar             to gd-1-col-6
          end-if
          modify form1-gd-1,record-to-add(form1-gd-1-record)
          if kasa-alac-dep-ba = "B"
             add kasa-alac-dep-tutar to borc
          else
             add kasa-alac-dep-tutar to alac
          end-if
     end-read
     end-perform
     end-start
     
     close hesap.
      close borc-fat delete file borc-fat
     modify form1-gd-1,
            mass-update = 0.

     compute bakiye = borc - alac
     move borc   to etutar
     modify acc-borc, value = etutar
     move alac   to etutar
     modify acc-alac, value = etutar
     move bakiye to etutar
     modify acc-bakiye, value = etutar
     if borc <> alac 
        display message box 
                "Borc/Alacak toplami esit degil", new-line 
                "Mahsuplastirirsaniz mutlaka duzeltin"
                icon mb_error_icon
                title "Hata"
                
    end-if.
    close doviz depkod.

 yaz-boggam.
     close takas-acenta.
     delete file takas-acenta.
     if combo-dovizlimi-value(1:1)  = "D"
        perform kur-bul thru kur-bul-exit
     end-if
     if borc = 0 or alac = 0
        display message box
                "Muhasebelestirilecek kayit bulunamadi ..."
                icon mb_error_icon
                title "Hata"
                move 1 to enable-1 
                move 0 to enable-2
                display form1
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
                perform dil-ayarla-proc
*/-----------------------------\*         
                move 4 to accept-control
                move 4 to control-id
                close  borc-dep alac-dep   kasa-borc-dep kasa-alac-dep 
                delete file borc-dep alac-dep kasa-borc-dep kasa-alac-dep 
                exit paragraph
      end-if.
*******>Borc Departmanlari Muhasebelesiyor.........

 
     open i-o mahsup islenen hesap depkod.
     if mah-birles = 1 then 
       open output mahsupm
       close mahsupm
       open i-o mahsupm
     end-if
     initialize borc-dep-rec alac-dep-rec fis-sira-sakla
     start borc-dep key not < borc-dep-anah2 invalid
      continue
      not invalid
     initialize fs-borc-dep
     perform with test after until fs-borc-dep = "10"
     read borc-dep next no lock end move "10" to fs-borc-dep
     not at end
      if " " not = borc-dep-corr
         move "10" to fs-borc-dep
         exit perform
       end-if
         initialize mahsup-rec 
         move tarih               to mahsup-tarih
         move numara              to mahsup-fis-no
         add  1                   to fis-sira-sakla
         move fis-sira-sakla      to mahsup-fis-sira
         move borc-dep-hesap      to mahsup-hesap-kodu
         move "A"                 to mahsup-tipi
         move borc-dep-ba         to mahsup-b-a 
         move borc-dep-tutar      to mahsup-tutar
         move borc-dep-folio to mahsup-diger-tarih
         move borc-dep-aciklama   to mahsup-aciklama 
         move ref                 to mahsup-referans
         if ref-var = 1 then 
            move borc-dep-ref to mahsup-referans
         end-if
         move k-kodu-tasi         to mahsup-staf
         move borc-dep-hesap           to  hesap-kodu
         read hesap no lock invalid
                 move BORC-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                
                end-read
                move depkod-kdv to HESAP-KDV-ORAN 
              
         end-read
        
         move HESAP-KDV-ORAN to mahsup-kdv-oran
         
         if combo-dovizlimi-value(1:1)  = "D" and 
            islem-kuru not = 0
            if mahsup-tutar <> zeroes
               move mgenel-banka  to mahsup-banka-kodu
               move mgenel-doviz  to mahsup-doviz-kodu
               move mgenel-d-e    to mahsup-d-e       
               move islem-kuru   to mahsup-doviz-kuru
               compute mahsup-tutar-dv rounded = 
                        mahsup-tutar / islem-kuru
            end-if
         end-if
          perform dov-kont
         move "O"                 to mahsup-nereden
          move borc-dep-fatura-no    to mahsup-BELGE-NO 
       
            move mahsup-rec to mahsupm-rec
            move borc-dep-kredi to mahsupm-filler
            move borc-dep-ilgili-fat-no   to mahsupm-filler(2:10)

            move borc-dep-istip           to mahsupm-filler(14:5)
            move borc-dep-depkod       to mahsupm-filler(20:3)


            initialize takas-pass-rec
              move function numval ( borc-dep-ilgili-fat-no) to takas-pass-fatno
               if borc-dep-folio > 0 then 
                 move  borc-dep-folio  to   takas-pass-folio
                 write takas-pass-rec invalid rewrite takas-pass-rec end-write
              end-if
            write mahsupm-rec invalid stop " " end-write
          
     end-read
     end-perform
     end-start
    

**************************************** kredi kartlari 108ler
     initialize borc-dep-rec alac-dep-rec 
     move "1" to borc-dep-corr

     start borc-dep key not < borc-dep-anah2 invalid
      continue
      not invalid
     initialize fs-borc-dep
     perform with test after until fs-borc-dep = "10"
     read borc-dep next no lock end move "10" to fs-borc-dep
     not at end
       if "1" not = borc-dep-corr
         move "10" to fs-borc-dep
         exit perform
       end-if
         initialize mahsup-rec 
         move tarih               to mahsup-tarih
         move numara              to mahsup-fis-no
         add  1                   to fis-sira-sakla
         move fis-sira-sakla      to mahsup-fis-sira
         move borc-dep-hesap      to mahsup-hesap-kodu
         move "A"                 to mahsup-tipi
         move borc-dep-ba         to mahsup-b-a 
         move borc-dep-tutar      to mahsup-tutar
         move borc-dep-aciklama   to mahsup-aciklama 
         move ref                 to mahsup-referans 
         if ref-var = 1 then 
            move borc-dep-ref to mahsup-referans
         end-if
         move k-kodu-tasi         to mahsup-staf 
         move borc-dep-fatura-no    to mahsup-BELGE-NO
         initialize hesap-rec
         move borc-dep-hesap           to  hesap-kodu
          move borc-dep-folio to mahsup-diger-tarih
         read hesap no lock invalid
                move BORC-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                end-read
                move depkod-kdv to HESAP-KDV-ORAN 
         end-read
         
         move HESAP-KDV-ORAN to mahsup-kdv-oran


         if combo-dovizlimi-value(1:1)  = "D" and 
            islem-kuru not = 0
            if mahsup-tutar <> zeroes
               move mgenel-banka  to mahsup-banka-kodu
               move mgenel-doviz  to mahsup-doviz-kodu
               move mgenel-d-e    to mahsup-d-e                                           
               move islem-kuru   to mahsup-doviz-kuru
               compute mahsup-tutar-dv rounded = 
                       mahsup-tutar / islem-kuru
            end-if
         end-if
              perform dov-kont
         move "O"                 to mahsup-nereden
         
            move mahsup-rec to mahsupm-rec
             move borc-dep-kredi to mahsupm-filler
             
              move borc-dep-ilgili-fat-no   to mahsupm-filler(2:10) 
              initialize takas-pass-rec
              move function numval ( borc-dep-ilgili-fat-no) to takas-pass-fatno
               if borc-dep-folio > 0 then 
                 move  borc-dep-folio  to   takas-pass-folio
                 write takas-pass-rec invalid rewrite takas-pass-rec end-write
              end-if

            move borc-dep-istip           to mahsupm-filler(14:5)
               move borc-dep-depkod       to mahsupm-filler(20:3)
            write mahsupm-rec invalid stop " " end-write
           
     end-read
     end-perform
     end-start.
    
     initialize kasa-borc-dep-rec 
     start kasa-borc-dep key not < kasa-borc-dep-anah2 invalid
              continue
              not invalid
     initialize fs-kasa-borc-dep
     perform with test after until fs-kasa-borc-dep = "10"
     read kasa-borc-dep next no lock end move "10" to fs-kasa-borc-dep
     not at end
         initialize mahsup-rec 
         move tarih                    to mahsup-tarih
         move numara                   to mahsup-fis-no
         add  1                        to fis-sira-sakla
         move fis-sira-sakla           to mahsup-fis-sira
         move kasa-borc-dep-hesap      to mahsup-hesap-kodu
         move "B"                      to mahsup-tipi
         move kasa-borc-dep-ba         to mahsup-b-a 
         move kasa-borc-dep-tutar      to mahsup-tutar
         move kasa-borc-dep-aciklama   to mahsup-aciklama 
         move ref                 to mahsup-referans 
         if ref-var = 1 then 
            move kasa-borc-dep-ref to mahsup-referans
         end-if
         move k-kodu-tasi                   to mahsup-staf   
         move kasa-borc-dep-fatura-no       to mahsup-BELGE-NO 
         initialize hesap-rec
         move kasa-borc-dep-hesap           to hesap-kodu
         read hesap no lock invalid
                move kasa-borc-dep-depkod   to depkod-kodu
                read depkod no lock invalid continue
                end-read
                move depkod-kdv to hesap-kdv-oran 
         end-read
         move HESAP-KDV-ORAN    to mahsup-kdv-oran

         if combo-dovizlimi-value(1:1)  = "D" and 
            islem-kuru not = 0
            if mahsup-tutar <> zeroes
               move mgenel-banka  to mahsup-banka-kodu
               move mgenel-doviz  to mahsup-doviz-kodu
               move mgenel-d-e    to mahsup-d-e       
               move islem-kuru    to mahsup-doviz-kuru
               compute mahsup-tutar-dv rounded = 
                       mahsup-tutar / islem-kuru
            end-if
         end-if
             perform dov-kont
             move "O"                 to mahsup-nereden        
             move mahsup-rec          to mahsupm-rec
             move KASA-borc-dep-kredi to mahsupm-filler
             initialize takas-pass-rec
             move kasa-borc-dep-ilgili-fat-no   to mahsupm-filler(2:10)
              move function numval ( kasa-borc-dep-ilgili-fat-no) to takas-pass-fatno

             
               if borc-dep-folio > 0 then 
                 move  borc-dep-folio  to   takas-pass-folio
                 write takas-pass-rec invalid rewrite takas-pass-rec end-write
              end-if



             move kasa-borc-dep-istip           to mahsupm-filler(14:5)
             move kasa-borc-dep-depkod          to mahsupm-filler(20:3)
             write mahsupm-rec invalid stop " " end-write
     end-read
     end-perform
     end-start


     

   
*******>Alacak Departmanlari Muhasebelesiyor.........
     
  
     close borc-dep kasa-borc-dep
     initialize alac-dep-rec 
     start alac-dep key not < alac-dep-anah2 invalid
      continue
      not invalid
     initialize fs-alac-dep
     perform with test after until fs-alac-dep = "10"
     read alac-dep next no lock end move "10" to fs-alac-dep
     not at end
       if alac-dep-corr not = "C" then
          
         initialize mahsup-rec 
         move tarih               to mahsup-tarih
         move numara              to mahsup-fis-no
         add  1                   to fis-sira-sakla
         move fis-sira-sakla      to mahsup-fis-sira
         SET MAHSUP-DOVIZ-KILITLI TO TRUE
         move alac-dep-hesap      to mahsup-hesap-kodu
         move "A"                 to mahsup-tipi
         move alac-dep-ba         to mahsup-b-a 
         move alac-dep-tutar-tl   to mahsup-tutar
         move alac-dep-aciklama   to mahsup-aciklama 
         move ref                 to mahsup-referans 
         if ref-var = 1 then 
            move alac-dep-ref to mahsup-referans
         end-if
         move k-kodu-tasi         to mahsup-staf
         initialize hesap-rec
         move alac-dep-hesap           to  hesap-kodu
         read hesap no lock invalid
                move alac-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                end-read
                move depkod-kdv to HESAP-KDV-ORAN 
         end-read
         move HESAP-KDV-ORAN to mahsup-kdv-oran
          if alac-dep-acenno not = spaces then
               move alac-dep-banka      to mahsup-banka-kodu
               move alac-dep-doviz      to mahsup-doviz-kodu
               move mgenel-d-e           to mahsup-d-e       
               move alac-dep-tutar-dv   to mahsup-tutar-dv
               move alac-dep-doviz-kuru to mahsup-doviz-kuru
         else
         if combo-dovizlimi-value(1:1)  = "D" and 
            islem-kuru not = 0
            if mahsup-tutar <> zeroes
               move mgenel-banka  to mahsup-banka-kodu
               move mgenel-doviz  to mahsup-doviz-kodu
               move mgenel-d-e    to mahsup-d-e       
               move islem-kuru   to mahsup-doviz-kuru
               compute mahsup-tutar-dv rounded = 
                       mahsup-tutar / islem-kuru
            end-if
         end-if
         if combo-dovizlimi-value(1:1)  = "D" and 
            alac-dep-banka  not = 0 and
            alac-dep-doviz  not = 0
            if mahsup-tutar <> zeroes
               move alac-dep-banka      to mahsup-banka-kodu
               move alac-dep-doviz      to mahsup-doviz-kodu
               move mgenel-d-e           to mahsup-d-e       
               move alac-dep-tutar-dv   to mahsup-tutar-dv
               move alac-dep-doviz-kuru to mahsup-doviz-kuru
            end-if
         end-if
         end-if
         if alac-dep-ara not = "A" then
             move alac-dep-fatura-no    to mahsup-BELGE-NO 
         end-if 
            perform dov-kont
         move "O" to mahsup-nereden



            
            move mahsup-rec to mahsupm-rec
            move alac-dep-kredi to mahsupm-filler
             move alac-dep-ilgili-fat-no   to mahsupm-filler(2:10)
            move alac-dep-istip           to mahsupm-filler(14:5)
            write mahsupm-rec invalid stop " " end-write
          
         
         end-if
     end-read
     end-perform
     end-start.

************************** alacak correctionlar
   
     initialize alac-dep-rec 
     start alac-dep key not < alac-dep-anah invalid
      continue
      not invalid
     initialize fs-alac-dep
     perform with test after until fs-alac-dep = "10"
     read alac-dep next no lock end move "10" to fs-alac-dep
     not at end
       if alac-dep-corr  = "C" then
       
         initialize mahsup-rec 
         move tarih               to mahsup-tarih
         move numara              to mahsup-fis-no
         add  1                   to fis-sira-sakla
         move fis-sira-sakla      to mahsup-fis-sira
           SET MAHSUP-DOVIZ-KILITLI TO TRUE
        
         move alac-dep-hesap      to mahsup-hesap-kodu
         move "A"                 to mahsup-tipi
         move alac-dep-ba         to mahsup-b-a 
         move alac-dep-tutar-tl   to mahsup-tutar
         move alac-dep-aciklama   to mahsup-aciklama 
         move ref                 to mahsup-referans 
         if ref-var = 1 then 
            move alac-dep-ref to mahsup-referans
         end-if
         move k-kodu-tasi         to mahsup-staf
         initialize hesap-rec
         move alac-dep-hesap           to  hesap-kodu
         read hesap no lock invalid
                 move alac-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                end-read
                move depkod-kdv to HESAP-KDV-ORAN 
         end-read
         move HESAP-KDV-ORAN to mahsup-kdv-oran
         if alac-dep-acenno not = spaces then
               move alac-dep-banka      to mahsup-banka-kodu
               move alac-dep-doviz      to mahsup-doviz-kodu
               move mgenel-d-e          to mahsup-d-e       
               move alac-dep-tutar-dv   to mahsup-tutar-dv
               move alac-dep-doviz-kuru to mahsup-doviz-kuru
         else
         if combo-dovizlimi-value(1:1)  = "D" and 
            islem-kuru not = 0
            if mahsup-tutar <> zeroes
               move mgenel-banka  to mahsup-banka-kodu
               move mgenel-doviz  to mahsup-doviz-kodu
               move mgenel-d-e    to mahsup-d-e       
               move islem-kuru   to mahsup-doviz-kuru
               compute mahsup-tutar-dv rounded = 
                       mahsup-tutar / islem-kuru
            end-if
         end-if
         if combo-dovizlimi-value(1:1)  = "D" and 
            alac-dep-banka  not = 0 and
            alac-dep-doviz  not = 0
            if mahsup-tutar <> zeroes
               move alac-dep-banka      to mahsup-banka-kodu
               move alac-dep-doviz      to mahsup-doviz-kodu
               move mgenel-d-e           to mahsup-d-e       
               move alac-dep-tutar-dv   to mahsup-tutar-dv
               move alac-dep-doviz-kuru to mahsup-doviz-kuru
            end-if
         end-if
         end-if
*         move alac-dep-fatura-no    to mahsup-BELGE-NO  
         move "O" to mahsup-nereden
                perform dov-kont
         
            move mahsup-rec to mahsupm-rec
            move alac-dep-kredi to mahsupm-filler
             move alac-dep-ilgili-fat-no   to mahsupm-filler(2:10)
            move alac-dep-istip           to mahsupm-filler(14:5)
            write mahsupm-rec invalid stop " " end-write
         
         
         end-if
     end-read
     end-perform
     end-start.
    
************************   alacak kasalar  
     


   
    
  
      
          initialize  fis-sira-sakla
     
     initialize kasa-alac-dep-rec 
     start kasa-alac-dep key not < kasa-alac-dep-anah invalid
      continue
      not invalid
     initialize fs-kasa-alac-dep
     perform with test after until fs-kasa-alac-dep = "10"
     read kasa-alac-dep next no lock end move "10" to fs-kasa-alac-dep
     not at end
         initialize mahsup-rec 
         move tarih               to mahsup-tarih
         move numara              to mahsup-fis-no
         add  1                   to fis-sira-sakla
         move fis-sira-sakla      to mahsup-fis-sira

         move kasa-alac-dep-hesap  to mahsup-hesap-kodu
         move "C"                  to mahsup-tipi
         move kasa-alac-dep-ba      to mahsup-b-a 
         move kasa-alac-dep-tutar   to mahsup-tutar
         move kasa-alac-dep-aciklama   to mahsup-aciklama 
         move ref                       to mahsup-referans 
         if ref-var = 1 then 
            move kasa-alac-dep-ref to mahsup-referans
         end-if
         move k-kodu-tasi         to mahsup-staf 
         initialize hesap-rec
         move kasa-alac-dep-hesap           to  hesap-kodu
         read hesap no lock invalid
                 move kasa-alac-DEP-DEPKOD to depkod-kodu
                read depkod no lock invalid continue
                end-read
                move depkod-kdv to HESAP-KDV-ORAN 
         end-read
         move HESAP-KDV-ORAN to mahsup-kdv-oran
         if combo-dovizlimi-value(1:1)  = "D" and 
            islem-kuru not = 0
            if mahsup-tutar <> zeroes
               move mgenel-banka  to mahsup-banka-kodu
               move mgenel-doviz  to mahsup-doviz-kodu
               move mgenel-d-e    to mahsup-d-e       
               move islem-kuru   to mahsup-doviz-kuru
               compute mahsup-tutar-dv rounded = 
                       mahsup-tutar / islem-kuru
            end-if
         end-if
         if combo-dovizlimi-value(1:1)  = "D" and 
            kasa-alac-dep-banka  not = 0 and
            kasa-alac-dep-doviz  not = 0
            if mahsup-tutar <> zeroes
               move kasa-alac-dep-banka      to mahsup-banka-kodu
               move alac-dep-doviz      to mahsup-doviz-kodu
               move mgenel-d-e           to mahsup-d-e       
               move kasa-alac-dep-tutar-dv   to mahsup-tutar-dv
               move kasa-alac-dep-doviz-kuru to mahsup-doviz-kuru
            end-if
         end-if
         move kasa-alac-dep-fatura-no    to mahsup-BELGE-NO  
         move "O" to mahsup-nereden
            perform dov-kont
          
            move mahsup-rec to mahsupm-rec
            
             move kASA-ALAC-dep-kredi to mahsupm-filler
              move kasa-alac-dep-ilgili-fat-no   to mahsupm-filler(2:10)
            move kasa-alac-dep-istip           to Mahsupm-Filler(14:5)
           
            write mahsupm-rec invalid stop " " end-write
          


         
         
     end-read
     end-perform
     end-start.
     
     
     
      
     close alac-dep mahsup kasa-alac-dep   .
     delete file alac-dep kasa-alac-dep .
     delete file borc-dep kasa-borc-dep.



     close islenen depkod.
     display message box 
             "Gunluk [ ONBURO  ] Faturalar Netsise atildi !!!".
     modify form1-gd-1,reset-grid =1 .
     move 1 to enable-1 
     move 0 to enable-2
     display form1
     move 4 to accept-control
     move 4 to control-id.
     perform dosya-at
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
*
 acc-ref-Ex-Other.
     if key-status =  1
        initialize link-referans
        call "/asya/ytl/obj/muha/refara.asy" using link-referans
             on exception 
                perform callerr-proc
        not on exception
             cancel "/asya/ytl/obj/muha/refara.asy"
        end-call
        if link-referans <> spaces
           move link-referans to ref
           display acc-ref
           move 4 to accept-control
           move 12 to control-id
        end-if
     end-if.
*
 kur-bul.
        initialize islem-kuru.
     if combo-dovizlimi-value(1:1)  = "D"
        
               
        open input kur
        initialize islem-kuru
        move tarih         to kur-tarih
        move mgenel-banka   to kur-banka
        move mgenel-doviz   to kur-doviz
        read kur no lock invalid 
         display message box "Gunluk Kur Kaydi Bulunamadi Devam Ederseniz Dovizsiz Mahsup Keser.."
                              new-line,
                              "Islem Tarihi...........:" gun "/" ay "/" yil   
                              new-line,
                              "Banka-Doviz Kodu.......:" mgenel-banka   "-" mgenel-doviz
                              title = " [ Kurlar Tanimsiz ] "
         close kur 
         exit paragraph
        end-read
        move doviz-alis to islem-kuru
        if mgenel-d-e = "D" and mgenel-a-s = "A" 
           move doviz-alis    to islem-kuru
        end-if 
        if mgenel-d-e = "D" and mgenel-a-s = "S" 
           move doviz-satis   to islem-kuru
        end-if 
        if mgenel-d-e = "E" and mgenel-a-s = "A" 
           move efektif-alis  to islem-kuru
        end-if 
        if mgenel-d-e = "E" and mgenel-a-s = "S" 
           move efektif-satis to islem-kuru
        end-if 

        if islem-kuru = 0 
           display message box "Kur Tutari [0] Olamaz, Islem Yapamazsiniz.."
                            new-line,
                            "Islem Tarihi...........:" gun "/" ay "/" yil
                            new-line,
                            "Banka-Doviz Kodu.......:" mgenel-banka   "-" mgenel-doviz
                            title = " [ Kurlar Tanimsiz ] "
          close kur 
          exit paragraph
        end-if
        close kur
     end-if.
 kur-bul-exit.
    exit.

 xx.
    
 
 
      initialize fatdetay-rec .
       move tarih to fatdetay-fat-tar.
   
    start fatdetay key not < fatdetay-anah invalid continue,
        not invalid,
        move spaces to evet-hayir,
        perform with test after until evet,
        read fatdetay next no lock end move "E" to evet-hayir,
            not end,

            

            if fatdetay-fat-tar > tarih,
                 continue
                move "E" to evet-hayir,
            end-if,

            if fatdetay-fat-tar = tarih,


                if fatdetay-depkod not = "C/L" then 
                  if fatdetay-ger-fol = 0 
                           move fatdetay-folio to fatdetay-ger-fol
                  end-if
             
                   move fatdetay-ger-fol to konuk-folio 
                        read konuk no lock invalid
                            continue
                          not invalid
                          move konuk-fol-kodu to  fatdetay-romhrk-exthrk
                        end-read
                  if fatdetay-kdv not = 88 
                    initialize fatdetay2-rec
                       move fatdetay-anah to fatdetay2-anah 
                       move 88 to fatdetay2-kdv 
                       move fatdetay-romhrk-exthrk to fatdetay2-tip
                       read fatdetay2 no lock invalid
                          move fatdetay-rec to fatdetay2-rec
                          move 88 to fatdetay2-kdv 
                          move fatdetay-romhrk-exthrk to fatdetay2-tip    
                        not invalid
                          add  fatdetay-fatura-matrah      to    fatdetay2-fatura-matrah      
                          add  fatdetay-fatura-kdv         to    fatdetay2-fatura-kdv         
                          add  fatdetay-fatura-toplam      to    fatdetay2-fatura-toplam      
                          add  fatdetay-fatura-toplamdv    to    fatdetay2-fatura-toplamdv    
                          add fatdetay-fatura-matrah18     to    fatdetay2-fatura-matrah18    
                          add  fatdetay-fatura-kdv18       to    fatdetay2-fatura-kdv18
                       end-read
                          write fatdetay2-rec invalid rewrite fatdetay2-rec end-write
                          delete fatdetay invalid continue end-delete
              end-if
            end-if
            end-if
          end-read
          end-perform
       end-start
                     
                .

 fatdetay-oku.
      open input  depkod2 depkod romhrk exthrk fatura konuk yromhrk hrk2.
      open i-o fatdetay2 fatdetay 
  
        perform xx

    initialize fatdetay-rec .
    move tarih to fatdetay-fat-tar.
   
    start fatdetay key not < fatdetay-anah invalid continue,
        not invalid,
        move spaces to evet-hayir,
        perform with test after until evet,
        read fatdetay next no lock end move "E" to evet-hayir,
            not end,
            if function numval(fatdetay-fat-no) = 44444444102255 and (k-kodu-tasi = "X   " or "ASYA")
               then stop " "
            end-if
**************** **********************
*            initialize fatura-rec
*            move function numval(fatdetay-fat-no)  to fatura-no 
*            
*            read fatura no lock invalid 
*               continue 
*               not invalid 
*               move FATURA-TARIHI to fatdetay-fat-tar
*            end-read
           
*******************
            if fatdetay-fat-tar > tarih,
                 continue
                move "E" to evet-hayir,
            end-if,
             
            if fatdetay-fat-tar = tarih,
           
                 perform fatdetay-kontrol  
                  if kont-hat = 1 
                        exit perform cycle
                      end-if
                       
                initialize depkod-rec depkod2-rec,
                move fatdetay-depkod to depkod-kodu depkod2-kodu,
                 if fatdetay-depkod = "C/L" then 
                    
*                   if function numval (fatdetay-fat-no) =  101799 and k-kodu-tasi = "X   " then 
*                       stop " " 
*                       fatdetay-fatura-toplam
*                    end-if
                    if function numval (fatdetay-islem) >  0 and < 10 
                    if fatdetay-kdv not = 99 
                     
                       initialize fatdetay2-rec
                       move fatdetay-anah to fatdetay2-anah 
                       move 99 to fatdetay2-kdv 
                       move fatdetay-romhrk-exthrk to fatdetay2-tip
                       read fatdetay2 no lock invalid
                          move fatdetay-rec to fatdetay2-rec
                           move 99 to fatdetay2-kdv 
                          move fatdetay-romhrk-exthrk to fatdetay2-tip    
                        not invalid
                          add  fatdetay-fatura-matrah      to    fatdetay2-fatura-matrah      
                          add  fatdetay-fatura-kdv         to    fatdetay2-fatura-kdv         
                          add  fatdetay-fatura-toplam      to    fatdetay2-fatura-toplam      
                          add  fatdetay-fatura-toplamdv    to    fatdetay2-fatura-toplamdv    
                          add  fatdetay-fatura-matrah18    to    fatdetay2-fatura-matrah18    
                          add  fatdetay-fatura-kdv18       to    fatdetay2-fatura-kdv18
                       end-read
                          write fatdetay2-rec invalid rewrite fatdetay2-rec end-write
                          delete fatdetay invalid 
                              continue 
                               if k-kodu-tasi = "X   " or "ASYA" then stop " " end-if
                            end-delete
                     end-if
                        end-if
                  else
*                   if function numval(fatdetay-fat-no) = 309629 and debug = 1 then 
*                      stop" " 
*                   end-if
                     if fatdetay-romhrk-exthrk = "R" 
                             continue
                          else
                               move exthrk-corr-depkod    to  romhrk-corr-depkod  
                          end-if
                      move fatdetay-depkod to depkod-kodu 
                        read depkod  no lock invalid continue
                          not invalid 
                            if depkod-turu = 2 and romhrk-corr-depkod not = spaces and   romhrk-corr-depkod not = zeroes
                                   move romhrk-corr-depkod to depkod-anah
                                       read depkod no lock invalid
                                           continue
                                    end-read 
                                  end-if
                          end-read
                            move depkod-kdv        to  fatdetay-kdv-orani                  
                          if fatdetay-romhrk-exthrk = "R" 
                          move romhrk-tl-tutar    to  fatdetay-fatura-toplam 
                          else
                               move exthrk-tl-tutar    to  fatdetay-fatura-toplam  
                          end-if
                          compute fatdetay-fatura-matrah rounded = fatdetay-fatura-toplam / (1+(depkod-kdv / 100))
                          compute fatdetay-fatura-kdv = fatdetay-fatura-toplam - fatdetay-fatura-matrah



                     
                     move fatdetay-depkod to depkod-kodu depkod2-kodu,
                   if fatdetay-romhrk-exthrk = "R" then
                        move fatdetay-islem to romhrk-islem
                        move fatdetay-folio to romhrk-folio  konuk-folio
*                         if ref-var = 1 then 
                        read konuk no lock invalid 
                            stop " "
                        end-read
*                        move xkonum-ref(konuk-fiyat-konumu) to sat-ref
*                        if   xkonum-ref(konuk-oda-konumu) not = ref then 
*                                exit perform cycle
*                        end-if
*                       end-if
                        read romhrk no lock 
                            invalid exit perform cycle
                              not invalid
                              move romhrk-corr-depkod to  depkod2-kodu
                           if function numval(fatdetay-fat-no) 
                                    not = romhrk-FATURA-NO
                            
                           exit perform cycle
                         end-if
                      end-read
                  else
                       move fatdetay-islem to exthrk-islem
                           move fatdetay-folio to exthrk-folio    konuk-folio
                            if ref-var = 1 then 
                        read konuk no lock invalid 
                           stop " "
                        end-read
                        if konuk-fiyat-konumu > 0
                           move xkonum-ref(konuk-fiyat-konumu) to sat-ref
                        end-if 
*                        if xkonum-ref(konuk-oda-konumu) not = ref then 
*                             exit perform cycle
*                        end-if

                        end-if

                        read exthrk no lock 
                          invalid exit perform cycle
                          not invalid 
                          move exthrk-corr-depkod to  depkod2-kodu
                           if function numval(fatdetay-fat-no) not = exthrk-FATURA-NO
                            exit perform cycle
                          end-if
                        end-read


                end-if
                read depkod no lock invalid continue,
                    not invalid,
                      if  depkod-TURU not = 2 then 
                            move depkod-kodu to depkod2-kodu
                            else
                            move depkod2-kodu to depkod-kodu
                            read depkod no lock invalid
                              continue

                            end-read
                           move 2 to depkod-turu
                      end-if
                      read depkod2 no lock invalid continue
                        not invalid
*                          if depkod2-matrah-hesap(1:3) not = "100"
                                perform takaslara-yaz
*                               else
*                             perform kasa-takaslara-yaz
*                          end-if
                      end-read
                end-read,
              end-if
            end-if,
        end-read,
        end-perform,
    end-start.
    perform folio-karsilik-bul2
    perform kredi-bul
     initialize    takaskar-rec     
        start takaskar key > takaskar-anah invalid
          continue
          not invalid 
          perform until fs-takaskar = "10"
               read takaskar next no lock 
                    end move "10" to fs-takaskar
                    not end
                     if takaskar-tutar not = 0 then 
                         display message box takaskar-folio " foliosunda " takaskar-ref "  pencerinden kaynaklanan" new-line
                                              takaskar-fatura " nolu fatura mahsubunda problem var "
*                         if k-kodu-tasi = "X   " or "ASYA" then stop " " end-if

                     end-if
                end-read
          end-perform
        end-start
    close fatdetay depkod depkod2 romhrk exthrk fatura konuk  fatdetay2 yromhrk hrk2.
*
 depkod-ba-duz.
     if depkod-ba = "B" 
        move "A" to  depkod-matrah-ba
        else
        move "B" to depkod-matrah-ba
    end-if.
* 
 Takaslara-Yaz.
           if ref-var = 1
             if konuk-fiyat-konumu > 0
              move xkonum-ref(konuk-fiyat-konumu) to sat-ref
             end-if 
           end-if

              evaluate true
                    when ( depkod-ba = "B" and depkod-turu not = 3 ) or ( depkod-ba = "A"  and depkod-TURU = 2 )
                         initialize borc-dep-rec,
                         if depkod-toplam-hesap not = spaces
                            and  depkod2-toplam-hesap not = spaces
                            move depkod-toplam-hesap   to borc-dep-hesap
                            move depkod-anah to borc-dep-depkod
                            perform depkod-ba-duz
                            if depkod-matrah-ba = "A"
                               move "A"   to borc-dep-ba
                            else
                               move "B"   to borc-dep-ba
                            end-if
                            
                            move depkod-toplam-hesap  to borc-dep-hesap
                            if ref-var = 1
                             move ref to borc-dep-ref
                            end-if
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "TOPLAM" to  borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                            if  depkod-TURU= 2
                                  compute borc-dep-tutar rounded = 
                                          borc-dep-tutar - fatdetay-fatura-toplam
                               else
                                  compute borc-dep-tutar rounded = 
                                          borc-dep-tutar + fatdetay-fatura-toplam
                                  move "Gunluk Gelirler Geregi" to borc-dep-aciklama
                             end-if
                               write borc-dep-rec invalid rewrite borc-dep-rec,
                               end-write,
                         
                             initialize borc-dep-rec,

                            move depkod-toplam-hesap   to borc-dep-hesap
                            perform depkod-ba-duz
                            if depkod-matrah-ba = "B"
                               move "A"   to borc-dep-ba
                            else
                               move "B"   to borc-dep-ba
                            end-if
                            
                            move depkod2-toplam-hesap   to borc-dep-hesap
                            move function numval(fatdetay-fat-no)        to borc-dep-fatura-no
                            if ref-var = 1

                             move ref to borc-dep-ref
                            if depkod-ref > 0 and < max-ref then
                               move depkod-ref to borc-dep-ref
                            end-if  end-if
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "TOP2" to borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                            if  depkod-TURU= 2
                                  compute borc-dep-tutar rounded = 
                                          borc-dep-tutar - fatdetay-fatura-toplam
                               else
                                 compute borc-dep-tutar rounded = 
                                         borc-dep-tutar + fatdetay-fatura-toplam
                                 move "Gunluk Gelirler Geregi" to borc-dep-aciklama
                            end-if
                            write borc-dep-rec invalid rewrite borc-dep-rec,
                            end-write,
                         end-if
                   |palazzo        if (depkod-matrah-hesap not = spaces or ara-bos = 1)
                    |palazzo        and  depkod2-matrah-hesap not = spaces
                      if 1=1 
                             initialize borc-dep-rec,
                            move depkod-matrah-hesap   to borc-dep-hesap
                               move depkod-anah to borc-dep-depkod
                               perform depkod-ba-duz
                                    if depkod-matrah-ba = "B"
                                          move "A"   to borc-dep-ba
                                      else
                                          move "B"   to borc-dep-ba
                                    end-if
                            
                            
                            move depkod-matrah-hesap  to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                             if ref-var = 1
                             move ref to borc-dep-ref
                            end-if    
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "T.MAT" to borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                                if  depkod-TURU= 2
                                  compute borc-dep-tutar rounded = 
                                          borc-dep-tutar - fatdetay-fatura-matrah
                               else


                                 compute borc-dep-tutar rounded =
                                         borc-dep-tutar + fatdetay-fatura-matrah
                                 move "Gunluk Gelirler Geregi" to borc-dep-aciklama
                             end-if
                                 if ara-bos not = 1 
                                    write borc-dep-rec 
                                      invalid 
                                         rewrite borc-dep-rec end-rewrite,
                                    end-write,
                                end-if
                             initialize borc-dep-rec,
                            move depkod2-matrah-hesap   to borc-dep-hesap
                          if folioat = 1 then 
                             move konuk-folio to borc-dep-folio
                          end-if
                             move depkod-anah to borc-dep-depkod
                             perform depkod-ba-duz
                            if depkod-matrah-ba = "A"
                               move "A"   to borc-dep-ba
                            else
                               move "B"   to borc-dep-ba
                            end-if
                            
                            
                            move depkod2-matrah-hesap      to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-fatura-no
                            if ref-var = 1

                             move ref to borc-dep-ref
                            if depkod-ref > 0 and < max-ref then
                               move depkod-ref to borc-dep-ref
                            end-if  end-if
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "MATR" to borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                            if  depkod-TURU= 2
                                  compute borc-dep-tutar rounded = 
                                          borc-dep-tutar - fatdetay-fatura-matrah
                               else
                                 compute borc-dep-tutar rounded = borc-dep-tutar + 
                                        fatdetay-fatura-matrah

                                 move fatdetay-fat-no  to borc-dep-aciklama    
                               
                                 move "Ft geregi"      to borc-dep-aciklama (17:)
                             end-if
                            write borc-dep-rec invalid rewrite borc-dep-rec,
                            end-write,
                         end-if
                        | palazzo if (depkod-kdv-hesap not = spaces or ara-bos = 1)
                        |palazzo    and  depkod2-kdv-hesap not = spaces
                      if depkod-kdv > 0 and DEPKOD-FATURA-TAKIP = "E"
                             initialize borc-dep-rec,
                            move depkod-kdv-hesap   to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                             perform depkod-ba-duz
                            if depkod-matrah-ba = "B"
                               move "A"   to borc-dep-ba
                            else
                               move "B"   to borc-dep-ba
                            end-if
                            
                            
                            move depkod-kdv-hesap  to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                            if ref-var = 1
                                move ref to borc-dep-ref
                            end-if
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "T.KDV" to borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                            if  depkod-TURU= 2
                                  compute borc-dep-tutar rounded = 
                                 borc-dep-tutar - fatdetay-fatura-kdv
                               else
                                 compute borc-dep-tutar rounded = 
                                 borc-dep-tutar + fatdetay-fatura-kdv
                                 move "Gunluk Gelirler Geregi" to borc-dep-aciklama
                            end-if
                                 if ara-bos not = 1 
                            write borc-dep-rec invalid rewrite borc-dep-rec,
                            end-write,
                            end-if
                              initialize borc-dep-rec,
                            move depkod2-kdv-hesap   to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                             perform depkod-ba-duz
                            if depkod-matrah-ba = "A"
                                 move "A"   to borc-dep-ba
                              else
                                 move "B"   to borc-dep-ba
                            end-if
                            
                           
                            move depkod2-kdv-hesap   to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                            move  function numval(fatdetay-fat-no)        to borc-dep-fatura-no
                            if ref-var = 1
                                move ref to borc-dep-ref
                                if depkod-ref > 0 and < max-ref then
                                    move depkod-ref to borc-dep-ref
                                end-if  
                            end-if
                            move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "KDV" to borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                               if  depkod-TURU= 2
                                  compute borc-dep-tutar rounded = 
                                 borc-dep-tutar - fatdetay-fatura-kdv
                               else
                                 compute borc-dep-tutar rounded = 
                                 borc-dep-tutar + fatdetay-fatura-kdv
                                 move fatdetay-fat-no  to borc-dep-aciklama
                                 
                                 move "Ft geregi" to borc-dep-aciklama (17:)
                                 end-if
                            write borc-dep-rec invalid rewrite borc-dep-rec,
                            end-write,
                         end-if
                          if  depkod-TURU= 2
                             move -1 to carpan 
                             else
                             move 1 to carpan
                          end-if
*                         perform karsilik-bul
                         perform karsilik-bul2       



                    end-evaluate,
          
    .   
*
************************************************************ *
*
 karsilik-bul2.
             initialize takaskar-rec
               move function numval(fatdetay-fat-no) to takaskar-fatura 
           if fatdetay-romhrk-exthrk = "R"
               move romhrk-folio to takaskar-folio
               move romhrk-ref   to takaskar-ref
             
                
             else
               move exthrk-folio to takaskar-folio
               move exthrk-ref   to takaskar-ref
          end-if
          read takaskar no lock invalid
              continue
          end-read
*          if takaskar-folio = 138869 and (k-kodu-tasi = "ASYA" or "X   ")
*          stop " "
*          end-if
****            03 fatdetay-fat-no            pic x(10).
****       03 fatdetay-kdv               pic 99v99.
***       03 fatdetay-tip               pic x.
****       03 fatdetay-depkod            pic xxx.
****       03 fatdetay-folio             pic x(8).       
****       03 fatdetay-islem             pic x(8). 




          if fatdetay-romhrk-exthrk = "R"
             
              compute  takaskar-tutar =  takaskar-tutar + (romhrk-tl-tutar * carpan )
             else
              
                compute  takaskar-tutar =  takaskar-tutar + (exthrk-tl-tutar * carpan )
            
          end-if
           write takaskar-rec invalid rewrite takaskar-rec end-write.

 
           .


*
 folio-karsilik-bul2.
        initialize    takaskar-rec     
        start takaskar key > takaskar-anah invalid
          continue
          not invalid 
          perform until fs-takaskar = "10"
               read takaskar next no lock 
                    end move "10" to fs-takaskar
                    not end
*                      if takaskar-folio = 2258019 and (k-kodu-tasi = "ASYA" or "X   ") then 
*                         stop " "
*                       end-if
                           initialize    romhrk-rec exthrk-rec
                   
                             move takaskar-folio to romhrk-folio
                             start romhrk key > romhrk-anah invalid continue
                               not invalid
                                perform until fs-romhrk = "10" 
                                       read romhrk next no lock 
                                       end move  "10" to fs-romhrk
                                       not end
                                        if  takaskar-folio not =  romhrk-folio
                                            move "10" to fs-romhrk
                                            else
                                            if romhrk-ref  = takaskar-ref 
                                            and romhrk-fatura-no =
                                             takaskar-fatura
                                              move romhrk-rec to hrkgir-rec
                                              perform fol-kar2
                                               
                                            end-if
                                            end-if
                                       end-read

                                end-perform
                             end-start
                     
                             move takaskar-folio to exthrk-folio
                             start exthrk key > exthrk-anah invalid continue
                               not invalid
                                perform until fs-exthrk = "10" 
                                       read exthrk next no lock 
                                       end move  "10" to fs-exthrk
                                       not end
                                          if  takaskar-folio not =  exthrk-folio
                                            move "10" to fs-exthrk
                                            else
                                            if exthrk-ref  = takaskar-ref 
                                              and exthrk-fatura-no =
                                             takaskar-fatura
                                              move exthrk-rec to hrkgir-rec
                                              perform fol-kar2
                                               
                                            end-if
                                            end-if
                                       end-read
                                end-perform
                             end-start


                    

               end-read
          end-perform
         end-start
           .
*
 fol-kar2.
           if hrkgir-corr-depkod not = spaces and hrkgir-corr-depkod not = zeroes
                      move -1 to carpan 
                       move hrkgir-corr-depkod to depkod-anah
                  else
                      move 1 to carpan 
                      move hrkgir-depkod to depkod-anah
             end-if
                move depkod-anah to depkod2-anah
               read depkod no lock invalid exit paragraph,
                    not invalid,
                      read depkod2 no lock invalid exit paragraph
                        not invalid
                        continue
                end-read          
             if DEPKOD-FATURA-TAKIP = "E" then
                  exit paragraph
              end-if

              if depkod-ba = "B" then 
                 compute carpan = carpan * -1
              end-if
            perform hareket-isle2

            
            compute takaskar-tutar = takaskar-tutar - ( hrkgir-tl-tutar * carpan )
            rewrite takaskar-rec invalid stop " " end-rewrite
        .
*
*
 folfat-cari-bul.
*            exit paragraph
******************************
       
            initialize bulunan-cari acenta-rec firma-rec 
            move konuk-acenta to acenta-kodu  
            move konuk-firma  to firma-kodu
            read firma no lock invalid
                      continue
            not invalid
                    if firma-muhno2 not = Spaces 
                      move  firma-muhno2 to bulunan-cari
                    end-if
            end-read
               if bulunan-cari = spaces
                   read acenta no lock invalid
                      continue
                      not invalid
                    if acenta-muhno2 not = Spaces 
                      move  acenta-muhno2 to bulunan-cari
                    end-if
                  end-read
               end-if
                
*     if bulunan-cari not = spaces                 
*         if  depkod2-matrah-hesap = spaces
*               move  bulunan-cari to  depkod2-matrah-hesap depkod-matrah-hesap  
*         end-if
*     end-if
     if bulunan-cari not = spaces                 
        if  depkod2-matrah-hesap not > " 12"
            move  bulunan-cari to  depkod2-matrah-hesap
          

            else 

          move  bulunan-cari to  depkod-matrah-hesap

       end-if
     .




*
 hareket-isle2.   
************                   if depkod-ba = "A" and depkod-turu = 4 then 

***************                        perform folfat-cari-bul


*************                  end-if
       
                          initialize borc-dep-rec,
                          if  depkod2-matrah-hesap(1:3)  = "108"
                                  move "1" to kk
                                  else  move " " to kk
                                end-if
                         if depkod-toplam-hesap not = spaces
                            and  depkod2-toplam-hesap not = spaces
                         

                             initialize borc-dep-rec,
                             if  depkod2-matrah-hesap(1:3) not = "100"
                                if  depkod2-matrah-hesap(1:3)  = "108"
                                  move "1" to kk
                                  else  move " " to kk
                                end-if
                                 move kk to  borc-dep-corr
                                move depkod-toplam-hesap   to borc-dep-hesap
                                 move depkod-anah to borc-dep-depkod
                                 perform depkod-ba-duz
                            if depkod-matrah-ba = "A"
                               move "A"   to borc-dep-ba
                            else
                               move "B"   to borc-dep-ba
                            end-if
                            move depkod-toplam-hesap  to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                            if ref-var = 1
                                   move ref to borc-dep-ref
                            end-if
                            move  hrkgir-FATURA-NO    
                                          to borc-dep-ilgili-fat-no
                            move "TOP" to borc-dep-istip
                            read borc-dep no lock invalid continue,
                            end-read,
                                 compute borc-dep-tutar rounded = 
                                 borc-dep-tutar + (hrkgir-tl-tutar * carpan)

                                 move "Gunluk Tahsilati Geregi" to borc-dep-aciklama
                            write borc-dep-rec invalid rewrite borc-dep-rec,
                            end-write,

                                initialize borc-dep-rec,
                                  move kk to  borc-dep-corr
                                  perform depkod-ba-duz
                            if depkod-matrah-ba = "B"
                               move "A"   to borc-dep-ba
                            else
                               move "B"   to borc-dep-ba
                            end-if
                            move depkod2-toplam-hesap   to borc-dep-hesap
                             move depkod-anah to borc-dep-depkod
                            move  hrkgir-FATURA-NO        to borc-dep-fatura-no


                            if ref-var = 1
                               move ref to borc-dep-ref
                               if depkod-ref > 0 and < max-ref
                                    move depkod-ref to borc-dep-ref
                                end-if
                            end-if

                             move  hrkgir-FATURA-NO    
                                          to borc-dep-ilgili-fat-no
                            move "TOP2" to borc-dep-istip

                            read borc-dep no lock invalid continue,
                            end-read,
                                 compute borc-dep-tutar rounded = 
                                 borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move hrkgir-FATURA-NO       to borc-dep-aciklama(3:6)
                                 move "ft gr tahs-"   to borc-dep-aciklama(10:)
*                                 string konuk-adi delimited by "  "
*                                       " " delimited by size
*                                        konuk-soyadi delimited by   "  "
*                                       into ad-soyad
*                                       move ad-soyad to borc-dep-aciklama(21:)
                            write borc-dep-rec invalid rewrite borc-dep-rec,
                            end-write,
                            else 
                              perform depkod-ba-duz
                              if depkod-matrah-ba = "B"
                                initialize kasa-alac-dep-rec,
                               move depkod-toplam-hesap   to KASA-alac-dep-hesap
                               perform depkod-ba-duz
                            if depkod-matrah-ba = "A"
                               move "A"   to KASA-alac-dep-ba
                            else
                               move "B"   to KASA-alac-dep-ba
                            end-if
                            move depkod-toplam-hesap  to KASA-alac-dep-hesap
                            if ref-var = 1
                               move ref to kasa-alac-dep-ref
                               
                            end-if
                            move  hrkgir-FATURA-NO    
                                          to kasa-alac-dep-ilgili-fat-no
                            move "TOP" to kasa-alac-dep-istip
                            read KASA-alac-dep no lock invalid continue,
                            end-read,
                                 compute KASA-alac-dep-tutar rounded = 
                                 KASA-alac-dep-tutar +(hrkgir-tl-tutar * carpan)
                                 move "Gunluk iadeler Geregi" to KASA-alac-dep-aciklama
                            write KASA-borc-dep-rec invalid rewrite KASA-alac-dep-rec,
                            end-write,
                                    initialize kasa-alac-dep-rec,
                                    perform depkod-ba-duz
                            if depkod-matrah-ba = "B"
                               move "A"   to kasa-alac-dep-ba
                            else
                               move "B"   to kasa-alac-dep-ba
                            end-if
                            move depkod2-toplam-hesap   to kasa-alac-dep-hesap
                            move  hrkgir-fatura-no        to kasa-alac-dep-fatura-no
                            if ref-var = 1
                               move ref to kasa-alac-dep-ref
                               if depkod-ref > 0 and < max-ref
                                    move depkod-ref to kasa-alac-dep-ref
                                end-if
                            end-if
                            move  hrkgir-FATURA-NO    
                                          to kasa-alac-dep-ilgili-fat-no
                            move "TOP2" to kasa-alac-dep-istip 
                            
                            read kasa-alac-dep no lock invalid continue,
                            end-read,
                                 compute kasa-alac-dep-tutar rounded = 
                                 kasa-alac-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move  hrkgir-fatura-no        to kasa-alac-dep-aciklama(1:)
                                 move "ft gr. iade-" to kasa-alac-dep-aciklama(10:)

*                                 string konuk-adi delimited by "  "
*                                       " " delimited by size
*                                       konuk-soyadi delimited by   "  "
*                                       into ad-soyad
*                                       move ad-soyad to kasa-alac-dep-aciklama(22:)
                            write kasa-alac-dep-rec invalid rewrite kasa-alac-dep-rec,
                            end-write,

                      else
                               initialize kasa-borc-dep-rec,
                               move depkod-toplam-hesap   to KASA-borc-dep-hesap
                               perform depkod-ba-duz
                            if depkod-matrah-ba = "A"
                               move "A"   to KASA-borc-dep-ba
                            else
                               move "B"   to KASA-borc-dep-ba
                            end-if
                            move depkod-toplam-hesap  to KASA-borc-dep-hesap
                            if ref-var = 1
                               move ref to kasa-borc-dep-ref
                               
                            end-if
                              move  hrkgir-FATURA-NO    
                                          to kasa-borc-dep-ilgili-fat-no
                            move "TOP" to kasa-borc-dep-istip
                            read KASA-borc-dep no lock invalid continue,
                            end-read,
                                 compute KASA-borc-dep-tutar rounded = 
                                 KASA-borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move "Gunluk Tahsilatlar Geregi" to KASA-borc-dep-aciklama
                            write KASA-borc-dep-rec invalid rewrite KASA-borc-dep-rec,
                            end-write,
                                    initialize kasa-borc-dep-rec,
                                    perform depkod-ba-duz
                            if depkod-matrah-ba = "B"
                               move "A"   to kasa-borc-dep-ba
                            else
                               move "B"   to kasa-borc-dep-ba
                            end-if
                            move depkod2-toplam-hesap   to kasa-borc-dep-hesap
                            move  hrkgir-fatura-no        to kasa-borc-dep-fatura-no
                            
                            if ref-var = 1
                               move ref to kasa-borc-dep-ref
                               if depkod-ref > 0 and < max-ref
                                    move depkod-ref to kasa-borc-dep-ref
                                end-if
                            end-if
                             move  hrkgir-FATURA-NO    
                                          to kasa-borc-dep-ilgili-fat-no
                            move "TOP2" to kasa-borc-dep-istip
                            read kasa-borc-dep no lock invalid continue,
                            end-read,
                                 compute kasa-borc-dep-tutar rounded = 
                                 kasa-borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move  hrkgir-fatura-no        to kasa-borc-dep-aciklama(1:)
                                 move "ft gr tahs-" to kasa-borc-dep-aciklama(10:)

*                                 string konuk-adi delimited by "  " 
*                                        " " delimited by size
*                                        konuk-soyadi delimited by "  "
*                                        into ad-soyad
*                                       move ad-soyad to kasa-borc-dep-aciklama(21:)
                            write kasa-borc-dep-rec invalid rewrite kasa-borc-dep-rec,
                            end-write,
                             end-if
                         end-if
                         
                         end-if



                         initialize borc-dep-rec,
                       |palazzo  if depkod-matrah-hesap not = spaces
                          |palazzo  and  depkod2-matrah-hesap not = spaces
                          if 1=1
                             if  depkod2-matrah-hesap(1:3) not = "100"
                              
                              initialize borc-dep-rec,
                              move kk to borc-dep-corr
                              move depkod-matrah-hesap   to borc-dep-hesap
                               move depkod-anah to borc-dep-depkod
                               perform depkod-ba-duz
                              if depkod-matrah-ba = "B"
                                   move "A"   to borc-dep-ba
                               else
                                  move "B"   to borc-dep-ba
                              end-if
                              move depkod-matrah-hesap  to borc-dep-hesap
                               move depkod-anah to borc-dep-depkod
                              if ref-var = 1
                               move ref to borc-dep-ref
                               
                              end-if
                              move  hrkgir-FATURA-NO    
                                          to borc-dep-ilgili-fat-no
                            move "T.TAH" to borc-dep-istip
                              read borc-dep no lock invalid continue,
                               end-read,
                                 compute borc-dep-tutar rounded = 
                                 borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move "Gunluk Tahsilatlar Geregi" to borc-dep-aciklama
                               write borc-dep-rec invalid rewrite borc-dep-rec,
                               end-write,

                                initialize borc-dep-rec,
                                 move kk to borc-dep-corr
                                 perform depkod-ba-duz
                                if depkod-matrah-ba = "A"
                                  move "A"   to borc-dep-ba
                                else
                                  move "B"   to borc-dep-ba
                                end-if
                                move depkod2-matrah-hesap   to borc-dep-hesap
                                 move depkod-anah to borc-dep-depkod
                                move hrkgir-fatura-no        to borc-dep-fatura-no
                              if ref-var = 1
                               move ref to borc-dep-ref
                               if depkod-ref > 0 and < max-ref
                                    move depkod-ref to borc-dep-ref
                                end-if
                               end-if

                                  move  hrkgir-FATURA-NO    
                                          to borc-dep-ilgili-fat-no
                                 move "TAH" to borc-dep-istip
                                read borc-dep no lock invalid continue,
                                end-read,
                                 compute borc-dep-tutar rounded = 
                                 borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move hrkgir-fatura-no        to borc-dep-aciklama(1:)
                                 move "ft gr tahs-" to borc-dep-aciklama(10:)
*                                 string konuk-adi delimited by "  " 
*                                        " " delimited by size
*                                         konuk-soyadi delimited by "  "
*                                        into ad-soyad
*                                       move ad-soyad to borc-dep-aciklama(21:)
                                write borc-dep-rec invalid rewrite borc-dep-rec,
                                  end-write,
                            else 
                                  initialize KASA-borc-dep-rec,
                              move depkod-matrah-hesap   to KASA-borc-dep-hesap
                               move depkod-anah to kasa-borc-dep-depkod
                               perform depkod-ba-duz
                              if depkod-matrah-ba = "B"
                                   move "A"   to KASA-borc-dep-ba
                               else
                                  move "B"   to KASA-borc-dep-ba
                              end-if
                              move depkod-matrah-hesap  to KASA-borc-dep-hesap
                               move depkod-anah to kasa-borc-dep-depkod
                              
                              if ref-var = 1
                               move ref to KASA-borc-dep-ref
                              end-if
                                move  hrkgir-FATURA-NO    
                                          to kasa-borc-dep-ilgili-fat-no
                            move "T.TAH" to kasa-borc-dep-istip
                              read KASA-borc-dep no lock invalid continue,
                               end-read,
                                 compute KASA-borc-dep-tutar rounded = 
                                 KASA-borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move "Gunluk Tahsilatlar Geregi" to KASA-borc-dep-aciklama
                               write KASA-borc-dep-rec invalid rewrite KASA-borc-dep-rec,
                               end-write,
                               
                               initialize kasa-borc-dep-rec,
                               perform depkod-ba-duz
                                 if depkod-matrah-ba = "A"
                                     move "A"   to kasa-borc-dep-ba
                                    else
                                       move "B"   to kasa-borc-dep-ba
                                  end-if
                             
                                 move depkod2-matrah-hesap   to KASA-borc-dep-hesap
                                  move depkod-anah to kasa-borc-dep-depkod
                                 move  hrkgir-fatura-no        to kasa-borc-dep-fatura-no
                              if ref-var = 1
                               move ref to KASA-borc-dep-ref
                               if depkod-ref > 0 and < max-ref
                                    move depkod-ref to KASA-borc-dep-ref
                                end-if
                               end-if

                                   move  hrkgir-FATURA-NO    
                                          to kasa-borc-dep-ilgili-fat-no
                                   move "TAH" to kasa-borc-dep-istip

                                 read kasa-borc-dep no lock invalid continue,
                                 end-read,
                                 compute kasa-borc-dep-tutar rounded = 
                                 kasa-borc-dep-tutar + (hrkgir-tl-tutar * carpan)
                                 move hrkgir-fatura-no        to kasa-borc-dep-aciklama(1:)
                                  move "ft gr tahs-" to kasa-borc-dep-aciklama(10:)
*                                 string konuk-adi delimited by "  " 
*                                        " " delimited by size
*                                        konuk-soyadi delimited by "  "
*                                        into ad-soyad
*                                       move ad-soyad to kasa-borc-dep-aciklama(21:)
                                 write kasa-borc-dep-rec invalid rewrite kasa-borc-dep-rec,
                              end-write,

                         end-if
                         
                         end-if
        
        .




        .



kacgun-bul.
       open input takvim 
       initialize takvim-rec takas-acenta-gun
        
        move konuk-gel-tar to takvim-anah
        start takvim key > takvim-anah 
            invalid
            not invalid   
             perform until fs-takvim =  "10"  
               read takvim next no lock
                  end move "10" to fs-takvim
                  not end
                  if takvim-anah < konuk-git-tar then
                      add 1 to takas-acenta-gun
                    else
                       add 1 to takas-acenta-gun
                       move "10" to fs-takvim
                  end-if
               end-read
             end-perform
         end-start
         close takvim.

*
 takas-acenta-dovizleri-bul.
       
         open input acenfat
           initialize acenfat-rec
           move tarih to acenfat-tarih
           move konuk-acenta to acenfat-acenta
             start acenfat key > acenfat-anah
                invalid continue
                not invalid
                  perform until fs-acenfat = "10"
                    read acenfat next
                       end move "10" to fs-acenfat
                       not end
                       if tarih not =  acenfat-tarih
                         or konuk-acenta not = acenfat-acenta
                          move "10" to fs-acenfat
                          else
                          if acenfat-folio = konuk-folio
                                 
                             compute tl-gunluk rounded =   (ACENFAT-tl-TUTAR / acenfat-per-geceleme )
                             compute dv-gunluk rounded =   tl-gunluk / (konuk-kur-degeri)
                             compute takas-acenta-dv-tutar =  takas-acenta-dv-tutar + 
                                                           ( dv-gunluk  * acenfat-per-geceleme )
                          end-if 
                        end-if
                    end-read

                  end-perform
             end-start
         close acenfat

        
          .

*
 kredi-karsilik.
      

       initialize borc-dep-rec,
     |palazzo  if ( depkod-matrah-hesap not = spaces   or ara-bos = 1 )
     |palazzo      and  depkod2-matrah-hesap not = spaces
        if 1=1 
             if ara-bos not = 1 then
              initialize borc-dep-rec,
              move depkod-matrah-hesap   to borc-dep-hesap
               move depkod-anah to borc-dep-depkod
               perform depkod-ba-duz
              if depkod-matrah-ba = "B"
                    move "A"   to borc-dep-ba
                  else
                       move "B"   to borc-dep-ba
              end-if
          
              move depkod-matrah-hesap  to borc-dep-hesap
               move depkod-anah to borc-dep-depkod
                 if ref-var = 1
                     move ref to borc-dep-ref
                 end-if
                  move "K" to borc-dep-kredi
                  move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                  move "T.MAT" to borc-dep-istip
                 read borc-dep no lock invalid continue,
                  end-read,
                       compute borc-dep-tutar rounded = borc-dep-tutar + 
                       (fatdetay-fatura-matrah * carpan )
                       move "Acenta faturalari Geregi" to borc-dep-aciklama
                      
                  write borc-dep-rec invalid rewrite borc-dep-rec,
                  end-write,
              end-if
                   initialize borc-dep-rec,
                  move depkod2-matrah-hesap   to borc-dep-hesap
                   move depkod-anah to borc-dep-depkod
                   perform depkod-ba-duz
                  if depkod-matrah-ba = "A"
                     move "A"   to borc-dep-ba
                  else
                     move "B"   to borc-dep-ba
                  end-if
                  move depkod2-matrah-hesap   to borc-dep-hesap
                   move depkod-anah to borc-dep-depkod
                    if folioat = 1 then 
                   move konuk-folio to borc-dep-folio
                   end-if
                  move  function numval(fatdetay-fat-no)         to borc-dep-fatura-no
                   if ref-var = 1
                     move ref to borc-dep-ref
                   end-if
                     move "K" to borc-dep-kredi
                         move "A"    to  borc-dep-fat-tip
                         move "M"    to  borc-dep-mat-tipi
                    move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "MAT" to borc-dep-istip
                  read borc-dep no lock invalid continue,
                  end-read,
                         move "A"    to  borc-dep-fat-tip
                         move "M"    to  borc-dep-mat-tipi
                         move depkod-kdv to  borc-dep-kdv   
                       compute borc-dep-tutar rounded = borc-dep-tutar + 
                       (fatdetay-fatura-matrah * carpan )
                       move fatdetay-fat-no  to borc-dep-aciklama 
                       move "Ft geregi" to borc-dep-aciklama (17:)
                      
                  write borc-dep-rec invalid rewrite borc-dep-rec,
                  end-write,
               end-if
             |palazzo    if ( depkod-kdv-hesap not = spaces or ara-bos = 1 )
            |palazzo       and  depkod2-kdv-hesap not = spaces
                if depkod-kdv > 0 and DEPKOD-FATURA-TAKIP = "E"
                     if ara-bos not = 1 then
                     initialize borc-dep-rec,
                    move depkod-kdv-hesap   to borc-dep-hesap
                     move depkod-anah to borc-dep-depkod
                     perform depkod-ba-duz
                    if depkod-matrah-ba = "B"
                       move "A"   to borc-dep-ba
                    else
                       move "B"   to borc-dep-ba
                    end-if
                    move depkod-kdv-hesap  to borc-dep-hesap
                     move depkod-anah to borc-dep-depkod
                    if ref-var = 1
                     move ref to borc-dep-ref
                   end-if
                     move "K" to borc-dep-kredi

                       move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "T.KDV" to borc-dep-istip
                    read borc-dep no lock invalid continue,
                    end-read,
                         compute borc-dep-tutar rounded = 
                         borc-dep-tutar + (fatdetay-fatura-kdv * carpan )
                         move "Gunluk Gelirler Geregi" to borc-dep-aciklama
                    write borc-dep-rec invalid rewrite borc-dep-rec,
                    end-write,
                    end-if
                      initialize borc-dep-rec,
                    move depkod2-kdv-hesap   to borc-dep-hesap
                     move depkod-anah to borc-dep-depkod
                     perform depkod-ba-duz
                    if depkod-matrah-ba = "A"
                       move "A"   to borc-dep-ba
                    else
                       move "B"   to borc-dep-ba
                    end-if
                    move depkod2-kdv-hesap   to borc-dep-hesap
                     move depkod-anah to borc-dep-depkod
                    move  function numval(fatdetay-fat-no)        to borc-dep-fatura-no
                     if ref-var = 1
                        move ref to borc-dep-ref
                     end-if
                       move "K" to borc-dep-kredi
                           move "A"    to  borc-dep-fat-tip
                           move "K"    to  borc-dep-mat-tipi
                             move  function numval(fatdetay-fat-no)    
                                          to borc-dep-ilgili-fat-no
                            move "KDV" to borc-dep-istip
                    read borc-dep no lock invalid continue,
                    end-read,
                         move "A"    to  borc-dep-fat-tip
                         move "K"    to  borc-dep-mat-tipi
                           move depkod-kdv to  borc-dep-kdv   
                         compute borc-dep-tutar rounded = 
                         borc-dep-tutar + (fatdetay-fatura-kdv * carpan )
                         move fatdetay-fat-no  to borc-dep-aciklama 
                         move "Ft geregi" to borc-dep-aciklama (17:)
                        
                    write borc-dep-rec invalid rewrite borc-dep-rec,
                    end-write,
                 end-if  .
*
 pencere-bul.
       move fatdetay-rec to fatdetay2-rec    

      


       
         
      initialize pen-hata
      initialize exthrk-rec romhrk-rec
       if fatdetay-romhrk-exthrk = "E"  then
                     initialize exthrk-rec 
                     if fatdetay-ger-fol = 0 
                           move fatdetay-folio to fatdetay-ger-fol
                      end-if
                      move fatdetay-ger-fol    to exthrk-folio
                      start exthrk key > exthrk-anah invalid continue
                          not invalid
                          perform until fs-exthrk = "10" 
                            read exthrk next no lock end move "10" to fs-exthrk
                               not end
                                  if exthrk-folio not = fatdetay-ger-fol
                                        move "10" to fs-exthrk
                                      else
                                        move exthrk-anah to hrk2-anah yromhrk-anah
                                      read hrk2  no lock invalid stop " "
                                      end-read

                                      if  hrk2-kaynak-folio not = function numval ( fatdetay-folio )
                                           exit perform cycle
                                       end-if


                                        if fatdetay-kdv not = 99 or function numval (fatdetay-islem)  not =   extHRK-ref
                                          or not (function numval (fatdetay-islem) > 0 and < 10)
                                          exit perform cycle
                                       end-if
                                        if extHRK-FATURA-NO  =  function numval (fatdetay-fat-no)
                                             if exthrk-corr-depkod not = spaces and exthrk-corr-depkod not = zeroes
                                                   move -1 to carpan 
                                                    move exthrk-corr-depkod to depkod-anah
                                               else
                                                   move 1 to carpan 
                                                   move exthrk-depkod to depkod-anah
                                              end-if
                                       
                                            read depkod  no lock invalid
                                              stop " "
                                            end-read
                                            move depkod-anah to depkod2-anah
                                            read depkod2 no lock invalid continue end-read
                                              move exthrk-tl-tutar to fatdetay-fatura-toplam
                                                COMPUTE  fatdetay-fatura-matrah ROUNDED =   fatdetay-fatura-toplam
                                                          / ((100+ DEPKOD-KDV) / 100 )
                                               COMPUTE   fatdetay-fatura-kdv  =  fatdetay-fatura-toplam - fatdetay-fatura-matrah
                                                


                                                PERFORM kredi-karsilik


                                        end-if
                                  end-if
                            end-read
                          end-perform
                      end-start


        
          else
          
                     initialize romhrk-rec 
                     if fatdetay-ger-fol = 0 
                           move fatdetay-folio to fatdetay-ger-fol
                      end-if
                      move fatdetay-ger-fol     to romhrk-folio
                      start romhrk key > romhrk-anah invalid continue
                          not invalid
                          perform until fs-romhrk = "10" 
                            read romhrk next no lock end move "10" to fs-romhrk
                               not end
                                  if romhrk-folio not = fatdetay-ger-fol
                                        move "10" to fs-romhrk
                                      else
                                       move romhrk-anah to hrk2-anah yromhrk-anah
                                      read hrk2  no lock invalid stop " "
                                      end-read

                                      if  hrk2-kaynak-folio not = function numval ( fatdetay-folio )
                                           exit perform cycle
                                       end-if
                                      if fatdetay-kdv not = 99 or function numval (fatdetay-islem)  not =   romHRK-ref
                                           or not  (function numval (fatdetay-islem) > 0 and < 10)
                                          exit perform cycle
                                       end-if
                                           if romHRK-FATURA-NO  =  function numval (fatdetay-fat-no)
                                        
                                                  if romhrk-corr-depkod not = spaces and romhrk-corr-depkod not = zeroes
                                                           move -1 to carpan 
                                                            move romhrk-corr-depkod to depkod-anah
                                                 else
                                                           move 1 to carpan 
                                                           move romhrk-depkod to depkod-anah
                                                end-if
                                       
                                           read depkod  no lock invalid
                                            stop " "
                                          end-read
                                          move depkod-anah to depkod2-anah
                                          read depkod2 no lock invalid continue end-read
                                           move romhrk-tl-tutar to fatdetay-fatura-toplam
                                          COMPUTE  fatdetay-fatura-matrah ROUNDED =   fatdetay-fatura-toplam
                                              / ((100+ DEPKOD-KDV) / 100 )
                                         COMPUTE   fatdetay-fatura-kdv  =  fatdetay-fatura-toplam - fatdetay-fatura-matrah
                                               
                                
                                
                                         PERFORM kredi-karsilik
         




                                            end-if
                                       
                                  end-if
                            end-read
                          end-perform
                      end-start
         
       end-if
             
                 initialize yromhrk-rec 
                      move fatdetay-folio    to yromhrk-folio
                      start yromhrk key > yromhrk-anah invalid continue
                          not invalid
                          perform until fs-yromhrk = "10" 
                            read yromhrk next no lock end move "10" to fs-yromhrk
                               not end
                                  if yromhrk-folio not = fatdetay-folio
                                        move "10" to fs-yromhrk
                                      else
                                      if fatdetay-kdv not = 99 
                                           and (function numval (fatdetay-islem) > 0 and < 10)
                                          exit perform cycle
                                       end-if
                                       
                                       if  yROMHRK-ISLEM-TIPI not = "D" then 
                                             exit perform cycle
                                        end-if
                                        move yromhrk-anah to romhrk-anah
                                       move yromhrk-kaynak-folio to romhrk-folio
                                       read romhrk no lock 
                                           invalid 
                                               exit perform cycle
                                       end-read
                                           if romHRK-FATURA-NO  =  function numval (fatdetay-fat-no)
                                        
                                                  if yromhrk-corr-depkod not = spaces and yromhrk-corr-depkod not = zeroes
                                                           move -1 to carpan 
                                                            move yromhrk-corr-depkod to depkod-anah
                                                 else
                                                           move 1 to carpan 
                                                           move yromhrk-depkod to depkod-anah
                                                end-if
                                       
                                           read depkod  no lock invalid
                                            stop " "
                                          end-read
                                          move depkod-anah to depkod2-anah
                                          read depkod2 no lock invalid continue end-read
                                           move yromhrk-tl-tutar to fatdetay-fatura-toplam
                                          COMPUTE  fatdetay-fatura-matrah ROUNDED =   fatdetay-fatura-toplam
                                              / ((100+ DEPKOD-KDV) / 100 )
                                         COMPUTE   fatdetay-fatura-kdv  =  fatdetay-fatura-toplam - fatdetay-fatura-matrah
                                               
                                
                                
                                         PERFORM kredi-karsilik
         




                                            end-if
                                       
                                  end-if
                            end-read
                          end-perform
                      end-start
             
        


            .
*
 kdv-duzelt.
         
          initialize borc-dep-rec 
          move "A" to borc-dep-fat-tip
          start borc-dep key > borc-dep-duz-anah
             invalid continue
             not invalid
             perform until fs-borc-dep = "10" 
                  read borc-dep next no lock 
                    end move  "10"  to fs-borc-dep
                    not  end
                      if borc-dep-fat-tip = "A" then
                        if borc-dep-fatura-no > 0 then 
                             initialize borc-fat-rec
                           move   borc-dep-fatura-no to  borc-fat-fatura-no
                           move   borc-dep-kdv       to  borc-fat-kdvoran
                          read borc-fat no lock invalid continue
                           end-read
                           evaluate borc-dep-mat-tipi 
                              when "M"
                                  add 1 to borc-fat-matrah-adet
                                   if borc-fat-matrah-adet < 40 
                                     move  borc-dep-tutar   to  borc-fat-matrah(borc-fat-matrah-adet) 
                                   end-if 
                                    add   borc-dep-tutar  to   borc-fat-matrahtop 
                                    if  borc-dep-tutar > borc-fat-matrah-max   then 
                                        move  borc-dep-tutar to  borc-fat-matrah-max
                                         move borc-dep-anah to borc-fat-matrah-anah 
                                    end-if
                              when "K" 
                                  add 1 to borc-fat-kdv-adet
                                   if borc-fat-kdv-adet < 40 
                                     move  borc-dep-tutar   to  borc-fat-kdv(borc-fat-kdv-adet) 
                                   end-if 
                                    add   borc-dep-tutar  to   borc-fat-kdvtop  
                                      if  borc-dep-tutar > borc-fat-kdv-max   then 
                                        move  borc-dep-tutar to  borc-fat-kdv-max
                                         move borc-dep-anah to borc-fat-kdv-anah 
                                    end-if

                              when other 
                                 stop " "
                            end-evaluate
                          write borc-fat-rec invalid rewrite borc-fat-rec end-write
                      end-if
                      else
                          move  "10"  to fs-borc-dep
                     end-if
                end-read 
             end-perform 
          end-start
       
          initialize borc-fat-rec
          start borc-fat key > borc-fat-anah
             invalid continue
             not invalid 
              perform until fs-borc-fat = "10" 
                read borc-fat next no lock end move "10" to fs-borc-fat
                    not end                                                                        
                        compute kdv-olmasigereken rounded = 
                               ( borc-fat-matrahtop +  borc-fat-kdvtop ) /
                                 ( ( 100 + borc-fat-kdvoran ) / 100 )
                        compute kdv-fark  =   kdv-olmasigereken - borc-fat-kdvtop
                        initialize borc-dep-rec
                        move borc-fat-kdv-anah to borc-dep-anah 
                        read borc-dep no lock invalid
                              stop " " 
                           not invalid
                              add  kdv-fark to borc-dep-tutar
                              rewrite borc-dep-rec invalid stop " " end-rewrite
                        end-read
                        initialize borc-dep-rec
                        move borc-fat-matrah-anah to borc-dep-anah 
                        read borc-dep no lock invalid
                              stop " " 
                           not invalid
                              subtract  kdv-fark from borc-dep-tutar
                              rewrite borc-dep-rec invalid stop " " end-rewrite
                        end-read



                 end-read
               end-perform
          end-start











        
            .

 kredi-bul.
******usendim ilk depkod cityledger a kalkan departmandir dedim  
      initialize depkod-rec
      start depkod   key >  depkod-anah
       invalid continue 
       not invalid 
       read depkod  next  no lock
       end-read
      end-start
      move depkod-anah to depkod2-anah
      read depkod2 no lock invalid continue end-read
    
****** hurmalar gala basýlýnca týrmaladý ugras bakalim
     
    
     

   
    open i-o  acenta.
     open input firma musteri.
    initialize fatdetay-rec.
    move tarih        to fatdetay-fat-tar.
    
    start fatdetay key not < fatdetay-anah invalid continue,
        not invalid,

       
        perform with test after until fs-fatdetay = "10",
            read fatdetay next no lock end move "10" to fs-fatdetay,
                not end,
                if fatdetay-fat-tar > tarih,
                          move "10" to fs-fatdetay
                          exit perform 
                end-if,
              
*               if function  numval (fatdetay-fat-no) = 552830 and k-kodu-tasi="ASYA" then stop "  " end-if
                if fatdetay-depkod = "C/L" then 
                  
*                       fatdetay-fatura-toplam
*                    end-if
                        
                      perform fatdetay-kontrol 
                       if kont-hat = 1 
                        exit perform cycle
                      end-if
                          
                      move fatdetay-folio to konuk-folio
                      read konuk no lock invalid 
                           exit perform cycle
                      end-read
                       initialize takas-acenta-rec,
                      
                         
                                if ref-var = 1 then 
                                  if konuk-fiyat-konumu > 0
                                     move xkonum-ref(konuk-fiyat-konumu) to sat-ref
                                  end-if 
*                                 if xkonum-ref(konuk-oda-konumu) not = ref then 
*                                         exit perform cycle
*                                     end-if

                                end-if 
                           initialize kur-rec takas-acenta-rec acenta-rec
                           move konuk-acenta    to takas-acenta-kodu 
                           move takas-acenta-kodu   to acenta-kodu

                          read acenta no lock invalid 
                               continue

                          end-read
                          
                           move konuk-banka      to  takas-acenta-banka
                           move konuk-doviz      to  takas-acenta-doviz
************************************   EARLY BOOK            
                             move konuk-gel-tar to takas-acenta-gel-tar
                             if konuk-eb = "E" or "1" then 
                                  move konuk-eb      to takas-acenta-eb
                               end-if
*                            move konuk-pazar   to takas-acenta-pazar
************************************ 
                                      
*                           if acenta-detay-mahsup = "E" then
*                               move konuk-odano to takas-acenta-odano
*                           end-if
                            move  function numval(fatdetay-fat-no)  to takas-acenta-fatura-no  
                           if ref-var = 1
                             move sat-ref to takas-acenta-ref
                           end-if
                           if konuk-firma > spaces  
                               move konuk-firma to takas-sirket-kodu
                           end-if
                           read takas-acenta no lock invalid continue
                           end-read
                           if konuk-fat-no > 0 then  
                            move konuk-folio to takas-acenta-folno

                           end-if,
                           compute takas-acenta-tl-tutar rounded =  
                          takas-acenta-tl-tutar + fatdetay-fatura-toplam
                              if konuk-kur-degeri = 0 then 
                                   move 1 to konuk-kur-degeri  
                               end-if
                               perform kacgun-bul
                             compute takas-acenta-dv-tutar rounded =  
                            takas-acenta-dv-tutar + fatdetay-fatura-toplamdv   
                              
                              move konuk-kur-degeri to takas-acenta-doviz-kuru doviz-alis
                             
                           write takas-acenta-rec invalid
                                 rewrite takas-acenta-rec end-rewrite
                           end-write,
                           move 1 to carpan
                          
                          
                               perform pencere-bul
*                           perform kredi-karsilik
                end-if
            end-read,
        end-perform,
    end-start.
    
    
   

*          perform kdv-duzelt
    move spaces to evet-hayir.
    initialize takas-acenta-rec.

    start takas-acenta key not < takas-acenta-anah invalid continue,
        not invalid,

        move spaces to evet-hayir,
        perform with test after until evet,
            read takas-acenta next no lock end move "E" to evet-hayir,
                not end,
                   initialize alac-dep-rec,
                          modify lb-1, title = takas-acenta-kodu
                   move takas-acenta-kodu   to acenta-kodu
                   read acenta no lock invalid 
              
                               display message box 
                                "Tanimsiz Acenta",
                                icon mb_error_icon
                                title "Hata"
                                move 1 to enable-1 
                                move 0 to enable-2
                                display form1
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
                                perform dil-ayarla-proc
*/-----------------------------\*         
                                move 4 to accept-control
                                move 4 to control-id
                                exit paragraph
                                close kasa-borc-dep kasa-alac-dep borc-dep alac-dep takas-acenta takaskar
                                delete file kasa-borc-dep kasa-alac-dep borc-dep alac-dep takas-acenta   takaskar
                   not invalid
*                        if  function numval(takas-acenta-fatura-no)   = 20154 then stop " " end-if
                        initialize alac-dep-rec
                         move "A"   to alac-dep-ba
                        move acenta-muhno       to alac-dep-hesap
                         if takas-sirket-kodu not = spaces 
                      
                         move takas-sirket-kodu to firma-kodu
                         read firma no lock invalid continue
                           not invalid 
                           initialize musteri-rec
                             move firma-profil-anah to m-profil
                             
                             read musteri no lock invalid continue
                                not invalid 
                                   move musteri-muhasebe-kodu to alac-dep-hesap
                              end-read
                          end-read

                        end-if




                        move takas-acenta-banka to alac-dep-banka
                        move takas-acenta-doviz to alac-dep-doviz
                        move takas-acenta-kodu  to alac-dep-acenno    | Ayni hesap noya iki acenta atilirsa - mami
                        if acenta-detay-mahsup = "E" then
                           move takas-acenta-odano to alac-dep-odano
                        end-if
                       
************************************   EARLY BOOK            
*                        move takas-acenta-gel-tar to alac-dep-gel-tar
                        move takas-acenta-eb      to alac-dep-eb
*                        move takas-acenta-pazar   to alac-dep-pazar

************************************                           
                        move takas-acenta-folno    to konuk-folio,
                           read konuk no lock invalid 
                                move spaces to konuk-adi konuk-soyadi,
                           end-read
                        if acenta-muhno2  not = spaces then 
                           move "A" to alac-dep-ara

                        end-if
                          move takas-acenta-fatura-no   to alac-dep-fatura-no
                        if ref-var = 1 then 
                            move ref to alac-dep-ref
                        end-if
                          move "K" to alac-dep-kredi
                            move  function numval(takas-acenta-fatura-no)    
                                          to alac-dep-ilgili-fat-no
                            move "KCARI" to  alac-dep-istip
                        read alac-dep no lock invalid
                           move alac-dep-fatura-no(3:)  to alac-dep-aciklama
                           move " Ft"         to alac-dep-aciklama(7:3) 
                        end-read

                        compute alac-dep-tutar-tl rounded =  
                                alac-dep-tutar-tl + takas-acenta-tl-tutar
                        compute alac-dep-tutar-dv rounded =  
                                alac-dep-tutar-dv + takas-acenta-dv-tutar
                 
                        
                        move takas-acenta-gel-tar(7:2) to alac-dep-aciklama(11:2)                        
                        move "/" to alac-dep-aciklama(13:1)                        
                        move takas-acenta-gel-tar(5:2) to alac-dep-aciklama(14:2)                        
                        move "-" to alac-dep-aciklama(16:01)
                        move gun to alac-dep-aciklama(17:2)
                        move "/" to alac-dep-aciklama(19:1)
                        move ay  to alac-dep-aciklama(20:2)
                        move acenta-adi to alac-dep-aciklama(23:10)
                        if alac-dep-eb = "E" then 
                                move "E/B" to alac-dep-aciklama(35:3)       
                        end-if
                        if acenta-detay-mahsup = "E" then
                        initialize alac-dep-aciklama
                        move gun to alac-dep-aciklama (11:2)
                        move "/" to alac-dep-aciklama(13:1)
                        move ay  to alac-dep-aciklama(14:2)
*                        move "Cikislar-" to alac-dep-aciklama(17:)
                        move acenta-kodu to alac-dep-aciklama(17:4)
                        move takas-acenta-odano to alac-dep-aciklama(22:4),
                        move konuk-adi        to alac-dep-aciklama(27:7)
                        move konuk-soyadi     to alac-dep-aciklama(35:)
                          end-if 
                        move  takas-acenta-doviz-kuru to alac-dep-doviz-kuru
                       
                        if ara-bos not = 1 then
                        write alac-dep-rec invalid
                              rewrite alac-dep-rec end-rewrite
                        end-write,
                        end-if
                        initialize alac-dep-rec
                        move "B"   to alac-dep-ba
                        move acenta-muhno2       to alac-dep-hesap
*********************** olcay degistirildi
                        if takas-sirket-kodu not = spaces 
                      
                         move takas-sirket-kodu to firma-kodu
                         read firma no lock invalid continue
                           not invalid 
                           initialize musteri-rec
                             move firma-profil-anah to m-profil
                              move firma-adi to alac-dep-aciklama(23:10)
                              if alac-dep-eb = "E" then 
                                   move "E/B" to alac-dep-aciklama(35:3)       
                               end-if
                             read musteri no lock invalid continue
                                not invalid 
                                   move musteri-muhasebe-kodu to alac-dep-hesap
                              end-read
                          end-read

                        end-if
********************************
                        move takas-acenta-banka to alac-dep-banka
                        move takas-acenta-doviz to alac-dep-doviz
                        move takas-acenta-kodu  to alac-dep-acenno    | Ayni hesap noya iki acenta atilirsa - mami
                        if acenta-detay-mahsup = "E" then
                           move takas-acenta-odano to alac-dep-odano
                        end-if

************************************   EARLY BOOK            
*                        move takas-acenta-gel-tar to alac-dep-gel-tar
                        move takas-acenta-eb      to alac-dep-eb
*                        move takas-acenta-pazar   to alac-dep-pazar

************************************                           
                        move takas-acenta-folno    to konuk-folio,
                           read konuk no lock invalid 
                                move spaces to konuk-adi konuk-soyadi,
                           end-read

                        move takas-acenta-fatura-no   to alac-dep-fatura-no
                        if ref-var = 1 then
                            if konuk-fiyat-konumu > 0
                              move xkonum-ref(konuk-fiyat-konumu) to sat-ref
                              move sat-ref to alac-dep-ref
                            end-if 
                        end-if
                         move "K" to alac-dep-kredi 
                         move  function numval(takas-acenta-fatura-no)    
                                          to alac-dep-ilgili-fat-no
                            move "CARI" to  alac-dep-istip
                        read alac-dep no lock invalid
*                        
                           move takas-acenta-fatura-no(3:)  to alac-dep-aciklama
                        
                           move " Ft"         to alac-dep-aciklama(7:3) 
                        end-read

                        compute alac-dep-tutar-tl rounded =  
                                alac-dep-tutar-tl + takas-acenta-tl-tutar
                        compute alac-dep-tutar-dv rounded =  
                                alac-dep-tutar-dv + takas-acenta-dv-tutar
                 
                        
                        move takas-acenta-gel-tar(7:2) to alac-dep-aciklama(11:2)                        
                        move "/" to alac-dep-aciklama(13:1)                        
                        move takas-acenta-gel-tar(5:2) to alac-dep-aciklama(14:2)                        
                        move "-" to alac-dep-aciklama(16:01)
                        move gun to alac-dep-aciklama(17:2)
                        move "/" to alac-dep-aciklama(19:1)
                        move ay  to alac-dep-aciklama(20:2)
                        move acenta-adi to alac-dep-aciklama(23:10)
                         if takas-sirket-kodu not = spaces 
                      
                        
                              move firma-adi to alac-dep-aciklama(23:10)
                        end-if    
                        if alac-dep-eb = "E" then 
                                move "E/B" to alac-dep-aciklama(35:3)       
                        end-if
                        if acenta-detay-mahsup = "E" then
                        initialize alac-dep-aciklama
                        move gun to alac-dep-aciklama (11:2)
                        move "/" to alac-dep-aciklama(13:1)
                        move ay  to alac-dep-aciklama(14:2)
*                        move "Cikislar-" to alac-dep-aciklama(17:)
                        move acenta-kodu to alac-dep-aciklama(17:4)
                        move takas-acenta-odano to alac-dep-aciklama(22:4),
                        move konuk-adi        to alac-dep-aciklama(27:7)
                        move konuk-soyadi     to alac-dep-aciklama(35:)
                          end-if 
                        move  takas-acenta-doviz-kuru to alac-dep-doviz-kuru
                           
                        write alac-dep-rec invalid
                              rewrite alac-dep-rec end-rewrite
                        end-write,
                        
                        if takas-acenta-eb = "E" and acenta-av-oran > 0 
                          AND ACENTA-AVANO NOT = SPACES then 
                             move "K" to alac-dep-kredi 
                           perform  acenta-avans-yaz
                        end-if
                   end-read,
            end-read,
        end-perform,
    end-start.
    close acenta 
     close firma musteri..
    


*
 acenta-avans-yaz.
          
          if alac-dep-ba = "B"
              move "A"   to alac-dep-ba
             else
              move "B"   to alac-dep-ba
          end-if
          move "C" to alac-dep-corr
*            initialize  alac-dep-fatura-no
               move  function numval(takas-acenta-fatura-no)    
                                          to alac-dep-ilgili-fat-no
                            move "EB-AV" to  alac-dep-istip
          read alac-dep no lock invalid
              initialize alac-dep-tutar-tl   
               alac-dep-tutar-dv   
               alac-dep-doviz-kuru 
               alac-dep-aciklama   
              move konuk-fat-no to alac-dep-aciklama 
              move " Ft"    to alac-dep-aciklama(7:3)
          end-read
          if acenta-av-oran > 98 then 
                  compute alac-dep-tutar-tl rounded =  alac-dep-tutar-tl + 
                                           takas-acenta-tl-tutar 
                  compute alac-dep-tutar-dv rounded =  alac-dep-tutar-dv + 
                                           takas-acenta-dv-tutar 


              else
                  compute alac-dep-tutar-tl rounded =  alac-dep-tutar-tl + 
                                        ( takas-acenta-tl-tutar * ((acenta-av-oran) / 100))
                  compute alac-dep-tutar-dv rounded =  alac-dep-tutar-dv + 
                                        ( takas-acenta-dv-tutar * (( acenta-av-oran) / 100))
          end-if               
*********************************                        
         move takas-acenta-gel-tar(7:2) to alac-dep-aciklama(11:2)                        
                        move "/" to alac-dep-aciklama(13:1)                        
                        move takas-acenta-gel-tar(5:2) to alac-dep-aciklama(14:2)                        
                        move "-" to alac-dep-aciklama(16:01)
                        move gun to alac-dep-aciklama(17:2)
                        move "/" to alac-dep-aciklama(19:1)
                        move ay  to alac-dep-aciklama(20:2)
                        move acenta-adi to alac-dep-aciklama(23:8)
                        
                       move " EB AVANSI" to alac-dep-aciklama(31:9)       
                        
*                        move alac-dep-pazar        to alac-dep-aciklama(35:2)
*                        if alac-dep-pazar not = spaces
*                                move "Knk" to alac-dep-aciklama(38:) 
*                                else 
*                                move "Extra Harcamalari" to alac-dep-aciklama(22:)       
*                        end-if
***********************************                                 
        move  takas-acenta-doviz-kuru to alac-dep-doviz-kuru
          write alac-dep-rec invalid
               rewrite alac-dep-rec end-rewrite
         end-write,
          .

          if alac-dep-ba = "B"
              move "A"   to alac-dep-ba
             else
              move "B"   to alac-dep-ba
          end-if
          move acenta-avano       to alac-dep-hesap
           move "C" to alac-dep-corr
            move  function numval(takas-acenta-fatura-no)    
                                          to alac-dep-ilgili-fat-no
                            move "EB-AV" to  alac-dep-istip
          read alac-dep no lock invalid
               initialize alac-dep-tutar-tl   
               alac-dep-tutar-dv   
               alac-dep-doviz-kuru 
               alac-dep-aciklama   
             
              move konuk-fat-no to alac-dep-aciklama 
              move " Ft"    to alac-dep-aciklama(7:3)
          end-read
          
        if  acenta-av-oran > 98
          compute alac-dep-tutar-tl rounded =  alac-dep-tutar-tl + 
                                 takas-acenta-tl-tutar 
          compute alac-dep-tutar-dv rounded =  alac-dep-tutar-dv + 
                                takas-acenta-dv-tutar 

           else

          compute alac-dep-tutar-tl rounded =  alac-dep-tutar-tl + 
                                ( takas-acenta-tl-tutar * ((acenta-av-oran) / 100))
          compute alac-dep-tutar-dv rounded =  alac-dep-tutar-dv + 
                                ( takas-acenta-dv-tutar * (( acenta-av-oran) / 100))
       end-if                 
*********************************                        
         move takas-acenta-gel-tar(7:2) to alac-dep-aciklama(11:2)                        
                        move "/" to alac-dep-aciklama(13:1)                        
                        move takas-acenta-gel-tar(5:2) to alac-dep-aciklama(14:2)                        
                        move "-" to alac-dep-aciklama(16:01)
                        move gun to alac-dep-aciklama(17:2)
                        move "/" to alac-dep-aciklama(19:1)
                        move ay  to alac-dep-aciklama(20:2)
                        move acenta-adi to alac-dep-aciklama(23:10)
                        
                       move "AVANSI" to alac-dep-aciklama(35:5)       
                        
*                        move alac-dep-pazar        to alac-dep-aciklama(35:2)
*                        if alac-dep-pazar not = spaces
*                                move "Knk" to alac-dep-aciklama(38:) 
*                                else 
*                                move "Extra Harcamalari" to alac-dep-aciklama(22:)       
*                        end-if
***********************************                                 
        move  takas-acenta-doviz-kuru to alac-dep-doviz-kuru
          write alac-dep-rec invalid
               rewrite alac-dep-rec end-rewrite
         end-write,

    .   
*
     .
*
 acc-ref-Bef-Procedure.
    initialize nereden.
*
 acuserve-adres-aktar.

    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres       
                         genelfis-DOSYA-adres     
                         REFERANS-DOSYA-adres     
                         mgenel-DOSYA-adres  
                         alsat-DOSYA-adres    
                         alsatek-DOSYA-adres    
                         genelfis-DOSYA-adres     
                         move "muha" to genelfis-DOSYA(16:4)
            

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA 
                           alsat-ACUSERVE-DOSYA 
                           alsatek-ACUSERVE-DOSYA 
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.
    string genelfis-acuserve-dosya,
           ip-no                        delimited by low-values
           genelfis-dosya                 delimited by low-values
           into genelfis-acuserve-dosya.

    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    string alsat-acuserve-dosya,
           ip-no                        delimited by low-values
           alsat-dosya                 delimited by low-values
           into alsat-acuserve-dosya.
    string alsatek-acuserve-dosya,
           ip-no                        delimited by low-values
           alsatek-dosya                 delimited by low-values
           into alsatek-acuserve-dosya.
    
    inspect cari-acuserve-dosya        replacing  all spaces by low-values
    inspect islenen-acuserve-dosya     replacing  all spaces by low-values
    inspect hesap-acuserve-dosya       replacing  all spaces by low-values
    inspect mahsup-acuserve-dosya      replacing  all spaces by low-values
    inspect genelfis-acuserve-dosya    replacing  all spaces by low-values
    inspect referans-acuserve-dosya    replacing  all spaces by low-values
    inspect mgenel-acuserve-dosya      replacing  all spaces by low-values
    inspect genelfis-acuserve-dosya    replacing  all spaces by low-values.
    inspect alsat-ACUSERVE-DOSYA       replacing  all spaces by low-values.
    inspect alsatek-ACUSERVE-DOSYA     replacing  all spaces by low-values.   
*
*
 fatdetay-kontrol.

        
                   |///  move function numval(fatdetay-folio) to konuk-folio  |||// onceki hali  16.11.2015  salih.y
                   move fatdetay-ger-fol to konuk-folio ||//konulduuu 
  
                        read konuk no lock invalid
                            continue
                          not invalid
                          move konuk-fol-kodu to  fatdetay-romhrk-exthrk
                        end-read
          
                 initialize romhrk-rec exthrk-rec  fatura-rec kont-hat
                 if fatdetay-depkod = "C/L"

                      if fatdetay-ger-fol = 0 
                           move fatdetay-folio to fatdetay-ger-fol
                     end-if

                  move fatdetay-ger-fol to konuk-folio 
                        read konuk no lock invalid
                            continue
                          not invalid
                          move konuk-fol-kodu to  fatdetay-romhrk-exthrk
                        end-read
                   if fatdetay-ger-fol = 0 
                           move fatdetay-folio to fatdetay-ger-fol
                   end-if

                   move function numval(fatdetay-fat-no)    to zz
                   move fatdetay-ger-fol to romhrk-folio  ydk-ger-folio
                   if fatdetay-romhrk-exthrk = "R"
                            start romhrk key >= ROMHRK-ANAH
                                invalid
                                   move 1 to kont-hat
                                not invalid
                              perform until fs-romhrk = "10" 
                                read romhrk  next no lock 
                                    end
                                      | move 1 to kont-hat
                                      move "10" to fs-romhrk
                                not end 

                                  |///************07.12.2015 kaya artesmi casiona faturalarý için 
                                if ydk-ger-folio <> romhrk-folio
                                        move "10" to fs-romhrk
                                        exit perform 
                                end-if
                                ||///***********

                                 initialize depkod-rec
                                move romhrk-depkod to depkod-kodu 
                                read depkod no lock invalid
                                        continue
                                end-read

                                if fatdetay-ger-fol not =  romhrk-folio
                                      move 1 to kont-hat
                                      move "10" to fs-romhrk
                                      exit perform 
                                else 
                                     if romhrk-ref = function numval(fatdetay-islem)
                                              if romhrk-ba = "A"    
                                                  if depkod-turu not = 4 and depkod-turu not = 2  
                                                          move 1 to kont-hat
                                                          exit perform
                                                  end-if
                                                       |if romhrk-fatura-no > 0    |OR 1 = 0 | LKYIA ICIN KONULDU    
                                                       |     move 1 to kont-hat
                                                       |     exit perform
                                                       |end-if
                                               end-if
                                      end-if
                              END-if
                             end-read
                             end-perform 
                            end-start
                         else
                             move romhrk-rec to exthrk-rec
                                   start exthrk key >= exthrk-ANAH 
                                invalid
                                            move 1 to kont-hat
                                              
                                not invalid
                              perform until fs-exthrk = "10" 
                                     read exthrk  next no lock 
                                           end
                                            |  move 1 to kont-hat
                                             move "10" to fs-exthrk
                                       not end 
                                        |///************07.12.2015 kaya artesmi casiona faturalarý için 
                                        if ydk-ger-folio <> exthrk-folio
                                                move "10" to fs-exthrk
                                                exit perform 
                                        end-if
                                        ||///***********
        
                                         initialize depkod-rec
                                        move exthrk-depkod to depkod-kodu 
                                        read depkod no lock invalid
                                                continue
                                        end-read

                                        if fatdetay-ger-fol not =  exthrk-folio
                                              move 1 to kont-hat
                                              move "10" to fs-exthrk
                                              exit perform 
                                        else 
                                             if exthrk-ref = function numval(fatdetay-islem)
                                                if exthrk-ba = "A"    
                                                  if depkod-turu not = 4 and depkod-turu not = 2  
                                                          move 1 to kont-hat
                                                          exit perform
                                                  end-if
                                                       |if romhrk-fatura-no > 0    |OR 1 = 0 | LKYIA ICIN KONULDU    
                                                       |     move 1 to kont-hat
                                                       |     exit perform
                                                       |end-if
                                               end-if
                                           end-if
                                      END-if
                                    end-read
                             end-perform 
                            end-start
                          end-if

                       exit paragraph
                 end-if

                 

                 move fatdetay-folio to romhrk-folio
                 move function numval(fatdetay-islem) to romhrk-islem 
                if  function numval(fatdetay-islem)  < 10 then 
                    exit paragraph
                end-if
                  move fatdetay-folio to konuk-folio
                   read konuk no lock invalid continue
                   end-read
                   move konuk-fol-kodu to  fatdetay-romhrk-exthrk
                 if fatdetay-romhrk-exthrk = "R"
                     read romhrk  no lock invalid
                          move 1 to kont-hat
                        
                       not invalid 
                       if romhrk-fatura-no not = function numval (fatdetay-fat-no)
                            move 1 to kont-hat
                            else
                            initialize depkod-rec
                            move romhrk-depkod to depkod-anah
                              read depkod no lock invalid continue end-read
                            if depkod-turu = 2 then 
                              move romhrk-corr-depkod to depkod-anah
                                 read depkod no lock invalid continue end-read

                           end-if 
                           move romhrk-tl-tutar to  fatdetay-fatura-toplam
                            compute  fatdetay-fatura-matrah   rounded =  
                                     fatdetay-fatura-toplam / ( 1 + ( depkod-kdv / 100 ) )        
                            compute fatdetay-fatura-kdv    = 
                                    fatdetay-fatura-toplam - fatdetay-fatura-matrah 
                             move romhrk-depkod to depkod-anah
                             read depkod no lock invalid continue end-read
                       end-if
                     end-read
                 else
                   move romhrk-rec to exthrk-rec
                   read exthrk  no lock invalid 
                       move 1 to kont-hat
                      
                       not invalid 
                       if exthrk-fatura-no not = function numval (fatdetay-fat-no)
                           move 1 to kont-hat
                           else
                           initialize depkod-rec
                            move exthrk-depkod to depkod-anah
                            read depkod no lock invalid continue end-read
                            if depkod-turu = 2 then 
                              move romhrk-corr-depkod to depkod-anah
                                 read depkod no lock invalid continue end-read

                           end-if 
                           move exthrk-tl-tutar to  fatdetay-fatura-toplam
                           compute  fatdetay-fatura-matrah rounded = 
                                     fatdetay-fatura-toplam / 
                                     ( 1 + ( depkod-kdv / 100))        
                           compute fatdetay-fatura-kdv = 
                                    fatdetay-fatura-toplam - 
                                    fatdetay-fatura-matrah    
                           move exthrk-depkod to depkod-anah
                           read depkod no lock invalid 
                                continue 
                           end-read                          
                       end-if
                     end-read
                 end-if
                 move function numval(fatdetay-fat-no) to fatura-no
                 read fatura no lock invalid 
                    move 1 to kont-hat                   
                 not invalid 
                    if FATURA-TARIHI not =  fatdetay-fat-tar 
                        move 1 to kont-hat                         
                    end-if
                    if fatura-durumu not = "D" then 
                        move 1 to kont-hat                            
                    end-if
                 end-read.
                  .

* 
 dosya-at.
   
*/// kayit yoksa
       
              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no 
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
*              move ilk-tarih to entegre-dosya-1
*              move ".A2N" to  entegre-dosya-2
             
**************************
     move print-no to  takas-hrk-no  takas-nhrk-no
     move k-kodu-tasi to takas-hrk-k
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Netsis Faturalar Entegrasyon Raporu2.." to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Netsis Faturalar Entegrasyon Raporu2" to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move yil        to det-filler(57:04)
    
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     move "Acenta.:"     to det-filler(01:10)
     
     
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLLLRRRLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2)     
                       move "Tarih   "     to det-1
                       move "E-f"   to   det-2
                       
                       move "Ilgili Fatura"to det-3
                       move "Islem Tipi"   to det-4
                       move "Hesap Adi "   to det-5
                      
                       move "Doviz"         to det-6
                       move "Tutar-Dv"      to det-9
                       move " Tutar"        to det-8
                       move "Hesap"         to det-7
                       move "Aciklama"      to det-10
                       move "B"             to det-11
                       move "Kdv "          to det-12
                       move "Dep"           to det-13
                       move "GirTar"        to det-gir 
                       move "CikTar"        to det-cik
                       move "Folio "        to det-folio 
                         move "Pasaport No "        to det-pasno
                       move "Misafir Adi "  to det-adi 
                       move "Voucher "      to det-voucher
                       move "VergiNo "      to det-vno 
                        move " Unvan1 " to  det-bas1      
                        move " Unvan2 " to  det-bas2     
                        move " Adres1  " to  det-adr1        
                        move " Adres2  " to  det-adr2        
                        move " Il       " to  det-il     
                        move " Ilce     " to  det-ilce       
                        move " Ulke     " to  det-ulke     
                        move " VergiDaire   " to  det-varda       
                        move " E-mail   " to  det-email   
                        move "Telefon"    to det-tel

                        move "E-Arsiv Gercek Fatura No"    to det-arsivno




     move "|" to fil-1 fil-2 fil-3 fil-4  fil-5  fil-6
                fil-7 fil-8  fil-9  Fil-10 fil-11 fil-12 fil-13 
                fil-gir fil-cik  fil-folio  fil-voucher fil-pasno fil-adi fil-vno fil-tel fil-arsivno     
     move  "|" to    fil-bas1  fil-bas2  fil-adr1 fil-adr2  fil-il   fil-ilce  fil-ulke fil-verda fil-email                   
     write dokumer-rec from detay
       initialize mahsupm-rec
                    open output entegre 
               open input depkod  doviz konuk fatura  musteri yanrez   gerfat alsat alsatek
           perform gonder
     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4  det-5 det-6 det-7
                                      det-8 det-9  det-10 det-11   det-12 det-13  det-tel
                                       det-gir  det-cik   det-folio det-pasno  det-voucher   det-adi det-vno   
     write dokumer-rec from detay
**************************
***            perform  hrk-takasal
          
       
            
            start  mahsupm  key > mahsupm-kredi
                invalid continue
                not invalid
                perform until fs-mahsupm = "10"
                     read mahsupm next end
                       move "10" to fs-mahsupm
                       not end
                    
                        initialize detay dokumer-rec
                        move mahsupm-gun  to net-gun
                        move mahsupm-ay   to net-ay
                        move mahsupm-yil  to net-yil
                        move net-tarih   to det-1
                        initialize hesap-rec
                       move mahsupm-hesap-kodu        to det-7 hesap-kodu
                       read hesap no lock invalid
                            move mahsupm-filler (20:3)   to depkod-kodu
                            read depkod no lock invalid 
                              continue
                            not invalid 
                                move depkod-adi  to hesap-adi(5:)
                            end-read                     
                                move depkod-kodu to hesap-adi(1:3)                     
                       end-read
                       move hesap-adi            to det-5
                       if  mahsupm-tutar-dv > 0 then 
                           move mahsupm-doviz-kodu to doviz-kodu
                           read doviz no lock invalid
                                initialize d-kisa-adi
                           end-read
                                move d-kisa-adi    to det-6
                       end-if
                       move mahsupm-tutar  to z-tutar
                       move z-tutar        to det-8

                       move mahsupm-tutar-dv  to z-tutar
                       move z-tutar                 to det-9

                       move  mahsupm-kdv-oran    to det-12
                       initialize konuk-rec
                      move  mahsupm-diger-tarih  to konuk-folio
                      read konuk no lock invalid continue
                      not invalid 
                       move konuk-gel-gun  to net-gun
                        move konuk-gel-ay  to net-ay
                        move konuk-gel-yil  to net-yil
                        move net-tarih   to det-gir
                        move konuk-git-gun  to net-gun
                        move konuk-git-ay  to net-ay
                        move konuk-git-yil  to net-yil
                        move net-tarih   to det-cik
                        string konuk-adi delimited by "   "
                           " " delimited by size
                           konuk-soyadi delimited by "  "
                           into det-adi
                           move konuk-folio to det-folio
                           move konuk-voucher to det-voucher
                     end-read
                       
                        initialize takas-pass-rec
                        move    function numval(mahsupm-filler(2:10))   to takas-pass-fatno
                        read takas-pass no lock invalid continue
                        end-read

                        if takas-pass-folio > 0 then 
                         if takas-pass-folio not = konuk-folio and konuk-folio > 0 and k-kodu-tasi = "ASYA" then 
                          | display message box "Pass no hatasi"
                             continue
                         end-if
                         move  takas-pass-folio to konuk-folio
                          read konuk no lock invalid continue
                          not invalid 
                            if konuk-rez-no > 0 or konuk-extra-rez-no > 0  
                               initialize yanrez-rec
                                if konuk-rez-no > 0
                                  move  konuk-rez-no to yanrez-rezno
                                  else
                                  move  konuk-extra-rez-no to yanrez-rezno
                                end-if
                                move 1 to yanrez-sirano
                                read yanrez no lock invalid continue
                                    not invalid 
                                      if yanrez-profil-no > 0 
                                         initialize musteri-rec
                                        move yanrez-profil-anah  to m-profil 
                                         read musteri no lock invalid continue
                                            not invalid 
                                              if musteri-kim-uyruk(1:2) = "TC"
                                                    continue
                                                    else
                                                 move musteri-seri-no       to det-pasno
                                             end-if 
                                         end-read
                                     end-if
                                end-read


                          end-if


                      end-read
                      end-if

                       move mahsupm-filler(2:10)   to det-3
                       if  function numval(mahsupm-filler(2:10))  > 0
                               move function numval(mahsupm-filler(2:10))   to fatura-no 
                            
                               move 0 to fatura-sira
                               read fatura no lock invalid 
                                 if k-kodu-tasi = "ASYA" or "X   " then stop " " end-if
        
                              end-read
                              
                          if fatura-E-tipi = "E" or "O" 
                             move "E" to det-2
                          end-if
                          
                          move FATURA-VER-NO to det-vno(2:)
                      end-if

                       move mahsupm-filler (14:5)   to det-4
                       move mahsupm-filler (20:3)   to det-13
                        move mahsupm-aciklama to det-10 
                        move mahsupm-b-a      to det-11
                      
                        move  FATURA-BASLIK-1  to  det-bas1      
                        move  FATURA-BASLIK-2  to  det-bas2     
                        move  FATURA-ADRES-1   to  det-adr1        
                        move  FATURA-ADRES-2   to  det-adr2        
                        move  FATURA-IL        to  det-il     
                        move  FATURA-ILCE      to  det-ilce       
                        move  FATURA-ULKE      to  det-ulke     
                        move  FATURA-VER-DA    to  det-varda       
                        move  fatura-e-mail    to  det-email 
                        move fatura-telefon    to det-tel

                     
                     initialize gerfat-rec
                     
                     move  fatura-anah to gerfat-anah
                      read gerfat no lock invalid continue
                      end-read
                      if gerfat-no-alindi = 1 
                        initialize det-arsivno
                        move gerfat-onek to det-arsivno
                        move gerfat-gerfatno to  det-arsivno(8:)
                     end-if                                        
                       

                      inspect detay converting x"989E999A80A6A78D81879F94" to
                                                  x"49534F55434767697563736F"



                      inspect detay converting  x"0D0A09" to  x"202020"
 

                       move "|" to fil-1 fil-2 fil-3 fil-4  fil-5  fil-6
                                      fil-7 fil-8  fil-9 fil-10 fil-11 fil-12 fil-13
                                         fil-gir fil-cik  fil-folio fil-pasno  fil-voucher fil-adi fil-vno  fil-tel fil-arsivno fil-arsivno
                                          move  "|" to    fil-bas1  fil-bas2  fil-adr1 fil-adr2  fil-il   fil-ilce  fil-ulke fil-verda fil-email   
                       write dokumer-rec from detay
                     
                         perform gonder
                      
             
       
            

                     
                  end-read
                end-perform
              end-start
            
               close dokumer    doviz  fatura takas-pass gerfat alsat  alsatek
               
             
            
              close entegre
                       
              move all low-values to buf
              inspect kdosya-adres replacing trailing spaces by low-values
              string  buf 
                      "@[DISPLAY]:" delimited by low-values
                       kdosya-adres   delimited by low-values
                      into buf
                      move all low-values to giden-adres
              move "/asya/ytl/liste/netentr3.asy" to  giden-adres
              inspect giden-adres replacing trailing spaces by low-values

               call "C$COPY" using  giden-adres
                      buf  giving SONUC
                    if sonuc  = 0
                      display message box buf " adresine kopyalandi"
                      else
                       display message box giden-adres "---" buf " Basarisiz Kopyalama"
                       display message box giden-adres buf
                   end-if
  
              
               close depkod  konuk  musteri yanrez
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
             
              close       mahsupm
  
              delete file        mahsupm  takas-pass
              delete file dokumer
              
    .
*
 gonder.
             call "c$justify" using det-1    "L"   
             call "c$justify" using det-2    "L"    
             call "c$justify" using det-3    "L"   
             call "c$justify" using det-4    "L"  
             call "c$justify" using det-5    "L"  
             call "c$justify" using det-6    "L"  
             call "c$justify" using det-7    "L"  
             call "c$justify" using det-8    "L"  
             call "c$justify" using det-9    "L"  
             call "c$justify" using det-10   "L"  
             call "c$justify" using det-11   "L"                                     
             call "c$justify" using det-12   "L"                                     
             call "c$justify" using det-13   "L"                                     
             call "c$justify" using det-gir       "L"                                
             call "c$justify" using det-cik       "L"                                
             call "c$justify" using det-folio     "L" 
              call "c$justify" using det-pasno   "L"                   
             call "c$justify" using det-voucher   "L"                                
             call "c$justify" using det-adi       "L"                                
             call "c$justify" using det-vno       "L"                                
             call "c$justify" using det-bas1      "L"                             
             call "c$justify" using det-bas2      "L"                             
             call "c$justify" using det-adr1      "L"                            
             call "c$justify" using det-adr2      "L"                            
             call "c$justify" using det-il        "L"                            
             call "c$justify" using det-ilce      "L"                            
             call "c$justify" using det-ulke      "L"                            
             call "c$justify" using det-varda     "L"      
             call "c$justify" using det-email     "L"     
             call "c$justify" using det-tel       "L"
              call "c$justify" using det-arsivno       "L"





        
           inspect det-1   replacing trailing spaces by low-values  
           inspect det-2   replacing trailing spaces by low-values 
           inspect det-3   replacing trailing spaces by low-values 
           inspect det-4   replacing trailing spaces by low-values 
           inspect det-5   replacing trailing spaces by low-values 
           inspect det-6   replacing trailing spaces by low-values 
           inspect det-7   replacing trailing spaces by low-values 
           inspect det-8   replacing trailing spaces by low-values 
           inspect det-9   replacing trailing spaces by low-values 
           inspect det-10  replacing trailing spaces by low-values 
           inspect det-11  replacing trailing spaces by low-values 
           inspect det-12  replacing trailing spaces by low-values 
           inspect det-13  replacing trailing spaces by low-values 
           inspect det-gir       replacing trailing spaces by low-values 
           inspect det-cik       replacing trailing spaces by low-values 
           inspect det-folio     replacing trailing spaces by low-values 
            inspect det-pasno     replacing trailing spaces by low-values 
           inspect det-voucher   replacing trailing spaces by low-values 
           inspect det-adi       replacing trailing spaces by low-values 
           inspect det-vno      replacing trailing spaces by low-values 

           inspect det-bas1      replacing trailing spaces by low-values 
           inspect det-bas2      replacing trailing spaces by low-values 
           inspect det-adr1      replacing trailing spaces by low-values 
           inspect det-adr2      replacing trailing spaces by low-values 
           inspect det-il        replacing trailing spaces by low-values 
           inspect det-ilce     replacing trailing spaces by low-values  
           inspect det-ulke     replacing trailing spaces by low-values  
           inspect det-varda     replacing trailing spaces by low-values  
           inspect det-email     replacing trailing spaces by low-values 
           inspect det-tel     replacing trailing spaces by low-values 
             inspect det-arsivno     replacing trailing spaces by low-values 
 
           inspect det-1   replacing ALL "," by "." 
           inspect det-2   replacing ALL "," by "."
           inspect det-3   replacing ALL "," by "." 
           inspect det-4   replacing ALL "," by "."
           inspect det-5   replacing ALL "," by "." 
           inspect det-6   replacing ALL "," by "." 
           inspect det-7   replacing ALL "," by "."
           inspect det-8   replacing ALL "," by "."
           inspect det-9   replacing ALL "," by "." 
           inspect det-10  replacing ALL "," by "." 
           inspect det-11  replacing ALL "," by "."     
           inspect det-12  replacing ALL "," by "."  
           inspect det-13  replacing ALL "," by "."   
           inspect det-gir      replacing ALL "," by "." 
           inspect det-cik      replacing ALL "," by "." 
           inspect det-folio    replacing ALL "," by "."     
           inspect det-voucher  replacing ALL "," by "."  
           inspect det-adi      replacing ALL "," by "."  
           inspect det-vno      replacing ALL "," by "."  

           inspect det-bas1   replacing ALL "," by "." 
           inspect det-bas2   replacing ALL "," by "." 
           inspect det-adr1   replacing ALL "," by "."     
           inspect det-adr2   replacing ALL "," by "."  
           inspect det-il     replacing ALL "," by "."  
           inspect det-ilce   replacing ALL "," by "."  
           inspect det-ulke   replacing ALL "," by "." 
           inspect det-varda replacing ALL "," by "." 
           inspect det-email replacing ALL "," by "." 
           inspect det-tel replacing ALL "," by "." 
           inspect det-pasno replacing ALL "," by "." 
           inspect det-arsivno replacing ALL "," by "." 
                         initialize  entegre-rec
                         string  "|" delimited by low-values 
                                  det-1 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-2 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-3 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-4 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-5 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-6 delimited by low-values 
                                 "| |" delimited by  low-values 
                                 det-7 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-8 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-9 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-10 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-11 delimited by low-values 
                                  "| |" delimited by low-values 
                                 det-12 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-13 delimited by low-values 
                                 "| |" delimited by low-values 
                                 det-gir      delimited by low-values      "| |" delimited by low-values 
                                 det-cik      delimited by low-values      "| |" delimited by low-values 
                                 det-folio    delimited by low-values      "| |" delimited by low-values 
                                 det-voucher  delimited by low-values      "| |" delimited by low-values 
                                 det-adi      delimited by low-values      "| |" delimited by low-values
                                 det-vno      delimited by low-values      "| |" delimited by low-values 

                                 det-bas1  delimited by low-values      "| |" delimited by low-values  
                                 det-bas2  delimited by low-values      "| |" delimited by low-values  
                                 det-adr1  delimited by low-values      "| |" delimited by low-values 
                                 det-adr2  delimited by low-values      "| |" delimited by low-values 
                                 det-il    delimited by low-values      "| |" delimited by low-values 
                                 det-ilce  delimited by low-values      "| |" delimited by low-values 
                                 det-ulke  delimited by low-values      "| |" delimited by low-values
                                 det-varda delimited by low-values      "| |" delimited by low-values 
                                 det-email delimited by low-values      "| |" delimited by low-values 
                                 det-tel delimited by low-values        "| |" delimited by low-values 
                                 det-pasno  delimited by low-values     "| |" delimited by low-values 
                                   det-arsivno  delimited by low-values      "|" delimited by low-values 
                                 into entegre-rec
                       inspect entegre-rec  replacing all low-values by spaces 
         
                               move    x"0D0A" to entegre-rec(599:2)
                                
                           write entegre-rec with no control end-write.




 
