* kfolio.evt
* kfolio.evt is generated from D:\asya\acugt.ytl\otel\kfolio.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 acc-mis-no-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .

 Form1-Gd-1-Exception-Proc.
     PERFORM Form1-Gd-1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     EVALUATE Event-Control-Id
     WHEN 14
        PERFORM Form1-Gd-1-Ev-Other
     END-EVALUATE
     .

 Form0-Event-Proc.
     .

 Form0-Exception-Proc.
     PERFORM Form0-Ex-Other
     .

 Form2-Event-Proc.
     .

 Form2-Pb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form2-Pb-1-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .
***   start event editor code   ***
*
 Form0-Bef-Create.
      call "c$narg" using link-var.
      perform adresleri-tasi.
      move 0 to dis-dov vis-dov
      open i-o genel.
      move 1 to genel-anahtar
      read genel no lock invalid
      display message box 
                   "Onburo calisma parametreleri bulunamadi",new-line,
                   "Lutfen once parametreleri tanimlayiniz"
                   icon mb_error_icon
                   title "Hata"
                   goback
      not invalid
      close genel.
      if k-kodu-tasi = "1919"
        move 1 to fat-en
    end-if .
    open i-o odalar2.


*
 Form0-Aft-Initdata.
      modify combo-folio-yeri,reset-list = 1 
                              mass-update = 1
      modify combo-rapor-tipi,reset-list = 1 
                              mass-update = 1 

      modify combo-folio-yeri,
             item-to-add("I-Inhouse","H-History")
      move "I-Inhouse" to combo-folio-yeri-value
      modify combo-rapor-tipi,
             item-to-add("T-Turk Lirasi","D-Doviz")
      move "T-Turk Lirasi" to combo-rapor-tipi-value
      modify combo-folio-yeri,mass-update = 0
                              value combo-folio-yeri-value
      modify combo-rapor-tipi,mass-update = 0
                              value combo-rapor-tipi-value.      
      move onkpara-doviz to rapor-doviz
      move onkpara-banka to rapor-banka
     
      if link-var = 1 then 
           move link-fol-no to konuk-folio
           open input konuk
           read konuk no lock 
             invalid             
               display message box "Folio Bulunamadi"
               close konuk
               set exit-pushed to true
               exit paragraph
             not invalid
               close konuk  
               perform folio-linkle
           end-read 
                   
         else
           move 4 to accept-control
           move 9 to control-id
       end-if .
       
*
 folio-linkle.
      if konuk-durumu  = "I"
         move "I-Inhouse" to combo-folio-yeri-value
        else
         move "H-History" to combo-folio-yeri-value
      end-if
      display combo-folio-yeri
      if konuk-fol-kodu = "R" 
         move "D-Doviz" to combo-rapor-tipi-value
       else
         move "D-Doviz" to combo-rapor-tipi-value
        move 0                 to rapor-folio-kuru
        move konuk-BANKA     to rapor-banka
        move konuk-doviz     to rapor-doviz
       
*         move "T-Turk Lirasi" to combo-rapor-tipi-value
      end-if   
      display combo-rapor-tipi
      move konuk-odano to rapor-oda
      move konuk-folio to rapor-folio
      display acc-oda acc-folio 
      perform after-depkod
      
         perform after-folio-kuru
         perform after-doviz
         perform after-banka
      perform tipi-after
      move 2001 to key-status
      perform form0-ex-other
           .


*
 toplu-kontrol.
       initialize gec-gecme
       
       perform after-depkod
       if dis-dov = 1 then 
         perform after-doviz
         perform after-banka
       end-if  .

*

 Form0-Ex-Other.
      evaluate key-status
           when 2001
                perform toplu-kontrol
                if gec-gecme = 0 

                    perform ekran-islem
                    if link-var= 1 then
                      
                       if esk-status = 19  or = 8 then
                          move 99999999 to link-fol-no
                          set exit-pushed to true
                          exit paragraph
                       end-if
                       if esk-status = 15  then
                          move 0 to link-fol-no
                          set exit-pushed to true
                          exit paragraph
                       end-if

                     end-if
                
                    move 4 to accept-control
                     move 9 to control-id 
                 end-if
           when 2002
                perform toplu-kontrol
                if gec-gecme = 0 

                perform liste-islem
                move 4 to accept-control
                move 9 to control-id
                end-if
         
           when 001
                evaluate control-id
                    when 9  
                    when 19  
                         perform oda-ara  thru oda-ara-exit 
                    when 10 
                    when 20 
                         perform folio-ara  thru folio-ara-exit 
                    when 14
                         perform depart-ara
                    when 21
                         perform banka-ara
                    when 22
                         perform doviz-ara
                end-evaluate
          when 2
                perform konuk-ara
      end-evaluate.

 ekran-islem.
      if rapor-folio = zeroes 
         move 4 to accept-control
         move 9 to control-id
         exit paragraph
      end-if.
      open input konuk
      initialize konuk-rec
      move rapor-folio      to konuk-folio
      read konuk no lock invalid
           close konuk
           move 4 to accept-control
           move 10 to control-id
           exit paragraph
      end-read.
      close konuk.
      if konuk-durumu <> combo-folio-yeri-value(1:1) 
         display message box 
                 "Folio ile secimdeki folio yeri birbirini tutmuyor",new-line,
                 "Devam edilsin mi ?"
                 type mb_yes_no
                 icon mb_warning_icon
                 title "Bilginize"
                 returning i
                 if i = 2 
                    move 4 to accept-control
                    move 10 to control-id
                    exit paragraph
                 end-if
      end-if.
      move konuk-odano      to rapor-oda.
      open input odalar.
      move rapor-oda        to odalar-anah
      read odalar no lock invalid
           move 4 to accept-control
           move 9 to control-id
           exit paragraph
      end-read
      close odalar.
      perform acu-form1-routine.


 liste-islem.
      
      initialize foliolzt-cagir
      move combo-rapor-tipi-value(1:1) to foliolzt-tldv-cagir
      move rapor-folio                 to foliolzt-no-cagir
      move rapor-departman             to foliolzt-depart-cagir
          
      move rapor-folio-kuru            to foliolzt-kuru-cagir
      move rapor-banka(1:2)            to foliolzt-banka-cagir
      move rapor-doviz                 to foliolzt-doviz-cagir
       compute foliolzt-pencere =  secili-tab - 1
      move 1 to foliolzt-kaynakmi
      call "/asya/ytl/obj/otel/foliolzr.asy" using foliolzt-cagir
            on exception perform callerr-proc
               not on exception
      cancel "/asya/ytl/obj/otel/foliolzr.asy" 
      end-call.
       .
*
 grid-yaz.
       open input konu2
       open i-o genelfis
         read genelfis no lock invalid
              accept ekran-fis-1 from time
         end-read
         add 1 to ekran-fis-1
         rewrite genelfis-rec invalid continue end-rewrite
         close genelfis
         move ekran-fis-1       to dep-toplam-no kdv-toplam-no
      if onkpara-folio-dep-toplam = "E"
         
         open output dep-toplam close dep-toplam
         open i-o dep-toplam mass-update
      end-if.
      if onkpara-folio-kdv-toplam = 1
         
         open output kdv-toplam close kdv-toplam
         open i-o kdv-toplam mass-update
      end-if.
      initialize borc-toplam alac-toplam tutar bakiye
      toplamlar    tlborc-toplam tlalac-toplam tltutar tlbakiye
      
      modify form1-gd-1,reset-grid = 1 mass-update = 1.
*      move "X"           to gd-1-col-0 
      move "Tarih"       to gd-1-col-1
      move "D.K"         to gd-1-col-2
      move "Departman"   to gd-1-col-3
      move "Aciklama "   to gd-1-col-4
      MOVE "KUR"         TO GD-1-COL-99
      move "Borc-D"        to gd-1-col-5
      move "Borc-TL"        to gd-1-col-105
      move "Alacak-D"      to gd-1-col-6
      move "Bakiye-D"      to gd-1-col-7
      move "Alacak-TL"      to gd-1-col-106
      move "Bakiye-TL"      to gd-1-col-107
      move "Zaman"       to gd-1-col-8
      move "Islem"       to gd-1-col-9
      move "Cek no"      to gd-1-col-10
      move "Kart"        to gd-1-col-11
      move "Staff"       to gd-1-col-12
      move "POS Kod"    to gd-1-col-13
      move "Tip"         to gd-1-col-14
      move "P"         to gd-1-col-19
      move "Hedef Folio"         to gd-1-col-20
      move "Fat No"         to gd-1-col-21
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)
             open i-o hrk2
   
    
         open input  depkod kllnc nt cast
         open input  yromhrk romhrk exthrk 
         initialize yromhrk-rec
         move rapor-folio       to yromhrk-folio
         start yromhrk key not < yromhrk-anah1 invalid
               continue
         not invalid
         initialize fs-yromhrk
         perform with test after until fs-yromhrk = "10"
         read yromhrk next no lock end move "10" to fs-yromhrk
         not at end
              if yromhrk-folio <> rapor-folio
                 move "10" to fs-yromhrk
                 exit perform 
              end-if
              
              initialize hrkgir-rec
              move yromhrk-rec        to hrkgir-rec
              move yromhrk-anah to hrk2-anah
              
              perform kgrid-yukle
              perform toplam-al
              if onkpara-folio-dep-toplam = "E"
                 perform dep-toplam-al
              end-if
              if onkpara-folio-kdv-toplam = 1
                 perform kdv-toplam-al
              end-if
           
         end-read
         end-perform
         end-start
    
      if konuk-fol-kodu = "R" then    
         move konuk-rez-no to cast-rez-no
         initialize cast-rec top-odeme
            move konuk-rez-no to cast-rez-no
         start cast  key >  cast-anah1 
            invalid continue
            not invalid
            
             modify form1-gd-1a reset-grid = 1 mass-update = 1
         move "Tarih" to gd-1-tarih
         move "Tutar" to  gd-1-tutar
         move "Toplam" to gd-1-toplam
         modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
          initialize gece-sayi

        perform with test after until fs-cast = "10"  
          read cast next no lock end move "10" to fs-cast
          not end
             if cast-rez-no not = konuk-rez-no or 
               cast-tarih >= konuk-git-tar
               move "10" to fs-cast
               else
               add 1 to gece-sayi

                move cast-gun to  gd-1-tarih(1:2)                   
                move cast-ay  to  gd-1-tarih(4:2)   
                move cast-yil to  gd-1-tarih(7:4)
                move "/" to           gd-1-tarih(3:1)   gd-1-tarih(6:1) 
                move cast-anlasma-fiyati  to z-8
                move z-8               to gd-1-tutar
               

                 compute top-odeme = top-odeme + cast-anlasma-fiyati
*                 compute top-odeme = top-odeme + xrez-fiyati 
                move  top-odeme     to z-8
                move z-8               to gd-1-toplam
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 end-if
          end-read 
        end-perform, 
        end-start, 
        end-if  
         modify form1-gd-1a  mass-update = 0
         close yromhrk romhrk exthrk depkod kllnc nt cast
      
      close hrk2
        
     
       initialize form1-gd-1-record.
     
     
      move "Toplam"               to gd-1-col-1
      move borc-toplam            to etutar
      move etutar                 to gd-1-col-5
      move alac-toplam            to etutar 
      move etutar                 to gd-1-col-6
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7
      move TLborc-toplam            to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLalac-toplam            to eTLtutar 
      move eTLtutar                 to gd-1-col-106
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)
      inquire form1-gd-1 last-row in eski-y 
      modify form1-gd-1
                    y = eski-y,

                    row-color = 257
      modify form1-gd-1
                    y = eski-y,
                    x = 10,
                    cell-color = 48
      modify form1-gd-1
                    y = eski-y,
                    x = 11,
                    cell-color = 432
      initialize form1-gd-1-record
      move "Genel Toplam"         to gd-1-col-3
      move genel-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move TLgenel-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move genel-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      move TLgenel-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute bakiye = genel-borc-toplam - genel-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7
      compute TLbakiye = TLgenel-borc-toplam - TLgenel-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Oda Toplam"           to gd-1-col-3
      move   oda-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move   TLoda-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move   oda-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      move   TLoda-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute bakiye = oda-borc-toplam - oda-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7
      compute TLbakiye = TLoda-borc-toplam - TLoda-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Extra Toplam"         to gd-1-col-3
      move extra-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move extra-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      compute bakiye = extra-borc-toplam - extra-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7

      move TLextra-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLextra-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute TLbakiye = TLextra-borc-toplam - TLextra-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Telefon Toplam"         to gd-1-col-3
      move telefon-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move telefon-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      compute bakiye = telefon-borc-toplam - telefon-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7

      move TLtelefon-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLtelefon-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute TLbakiye = TLtelefon-borc-toplam - TLtelefon-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Diger Toplam"         to gd-1-col-3
      move diger-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move diger-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      compute bakiye = diger-borc-toplam - diger-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7


      move TLdiger-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLdiger-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute TLbakiye = TLdiger-borc-toplam - TLdiger-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)


      if onkpara-folio-dep-toplam = "E"
         open input depkod
         initialize form1-gd-1-record
         move "Dep.Toplam"           to gd-1-col-1
         modify form1-gd-1,
                record-to-add(form1-gd-1-record) 
        
         inquire form1-gd-1 last-row in eski-y 
         add 1 to eski-y
          modify form1-gd-1
                    y = eski-y,
                   row-color = 257
         initialize dep-toplam-rec bakiye

         start dep-toplam key not < dep-toplam-anah invalid
               continue
         not invalid
         perform with test after until fs-dep-toplam = "10"
         read dep-toplam next no lock end move "10" to fs-dep-toplam
         not at end
              initialize form1-gd-1-record
              move dep-toplam-anah       to depkod-anah gd-1-col-2
              read depkod no lock invalid
                   move "Tanimsiz ..."   to depkod-adi
              end-read
              move depkod-adi            to gd-1-col-3
              evaluate true
                   when dep-toplam-tip = "A"
                        move dep-toplam-tutar   to etutar
                        move etutar             to gd-1-col-106
                        subtract dep-toplam-tutar from bakiye
                       
                   when dep-toplam-tip = "B"
                       move dep-toplam-tutar   to etutar
                        move etutar             to gd-1-col-105
                        add dep-toplam-tutar    to bakiye
                        
              end-evaluate
              move bakiye                       to etutar
              move etutar                       to gd-1-col-107
             
              modify form1-gd-1,
                     record-to-add(form1-gd-1-record)
         end-read
         end-perform
         end-start
         close dep-toplam depkod
         delete file dep-toplam
      end-if.
        if onkpara-folio-kdv-toplam = 1
        
         initialize form1-gd-1-record
         move "KDV Toplam"           to gd-1-col-1
          move "NET"  to gd-1-col-105
               move "KDV"                    to gd-1-col-106
               move "TOPLAM"                     to gd-1-col-107
         modify form1-gd-1,
                record-to-add(form1-gd-1-record)
                  inquire form1-gd-1 last-row in eski-y 
                  modify form1-gd-1
                    y = eski-y,

                    row-color = 257
         initialize kdv-toplam-rec bakiye
        
         start kdv-toplam key not < kdv-toplam-anah invalid
               continue
         not invalid
         perform with test after until fs-kdv-toplam = "10"
         read kdv-toplam next no lock end move "10" to fs-kdv-toplam
         not at end
              initialize form1-gd-1-record
              move kdv-toplam-anah     to  gd-1-col-3(1:2)
              move "KDV"               to  gd-1-col-3(4:)
              
              move kdv-net-tutar                      to etutar
              move etutar                       to gd-1-col-105
               move kdv-kdv-tutar                       to etutar
              move etutar                       to gd-1-col-106
               move kdv-toplam-tutar                       to etutar
              move etutar                       to gd-1-col-107
              modify form1-gd-1,
                     record-to-add(form1-gd-1-record)
         end-read
         end-perform
         end-start
         close kdv-toplam 
         delete file kdv-toplam
      end-if.
      close konu2        
      modify form1-gd-1,mass-update = 0.



*
 Form1-Aft-Initdata.
         move konuk-odano to o-kisa
        perform oda-uzat
        move o-uzun to konuk-odano-uzun
        display Form1-Ef-3baaaaaaa        
        move 1 to ilk-yukle
         initialize refler-occ
        initialize uyari
         move 1 to genelfis-anahtar
         move 0 to pencere
        perform grid-yaz
         move 0 to ilk-yukle.

       
      move konuk-fiyat-konumu to konum-anahtar
      open input konum
      read konum no lock invalid
            continue
        not invalid
            move konum-adi to acc-fkonum
            display ef-anlasmaa
      end-read
      close konum
      move "D" to kodlar02-tipi
      move KONUK-ANLASMA to kodlar02-kodu
      open input kodlar02

      read kodlar02 no lock invalid
            continue
        not invalid
            move kodlar02-adi to acc-anlasma
            display ef-anlasma
      end-read
      close kodlar02
      move gece-sayi to gece-say
      display l-gece
      perform not-goster
    
      move 4 to accept-control
      move 14 to control-id.
     


  

 not-goster.
      
      if konuk-fol-kodu = "R" 
         move 9 to link-nereden 
         move "REZ"   to  link-NOT-DOS    
         move konuk-rez-no to link-NOT-DOS-ANAH   
      else
         if konuk-extra-rez-no > 0 then
           move 10 to link-nereden 
           move "REZ"   to  link-NOT-DOS    
           move konuk-extra-rez-no to link-NOT-DOS-ANAH    
         else
           move 10 to link-nereden 
           move "KON"   to  link-NOT-DOS    
           move konuk-folio to link-NOT-DOS-ANAH    
           
         end-if

      end-if .
        


             move "K"     to  link-not-islem
             
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
             display not-ac
                           .


 toplam-al.
      if combo-rapor-tipi-value(1:1) = "T"
         move hrkgir-tl-tutar    to tutar
      else
         move hrkgir-dv-tutar    to tutar
      end-if.
      evaluate true
           when depkod-tipi = 1 and hrkgir-ba = "B"
                add tutar to genel-borc-toplam
                add TLtutar to TLgenel-borc-toplam
           when depkod-tipi = 1 and hrkgir-ba = "A"
                add tutar to genel-alac-toplam
                add TLtutar to TLgenel-alac-toplam
           when depkod-tipi = 2 and hrkgir-ba = "B"
                add tutar to oda-borc-toplam
                add TLtutar to TLoda-borc-toplam
           when depkod-tipi = 2 and hrkgir-ba = "A"
                add tutar to oda-alac-toplam
                add TLtutar to TLoda-alac-toplam
           when depkod-tipi = 3 and hrkgir-ba = "B"
                add tutar to extra-borc-toplam
                add TLtutar to TLextra-borc-toplam
           when depkod-tipi = 3 and hrkgir-ba = "A"
                add tutar to extra-alac-toplam
                add TLtutar to TLextra-alac-toplam
           when depkod-tipi = 4 and hrkgir-ba = "B"
                add tutar to telefon-borc-toplam
                add TLtutar to TLtelefon-borc-toplam
           when depkod-tipi = 4 and hrkgir-ba = "A"
                add tutar to telefon-alac-toplam
                add TLtutar to TLtelefon-alac-toplam
           when depkod-tipi = 5 and hrkgir-ba = "B"
                add tutar to diger-borc-toplam
                add TLtutar to TLdiger-borc-toplam
           when depkod-tipi = 5 and hrkgir-ba = "A"
                add tutar to diger-alac-toplam
                add TLtutar to TLdiger-alac-toplam
           when other
                display message box "uyumsuz tip---"  new-line
                        " Tipi :" depkod-tipi new-line
                        " BA   :" hrkgir-ba new-line,
                  depkod-anah,new-line,depkod-tipi
                        new-line,tutar
      end-evaluate.
 dep-toplam-al.
      initialize dep-toplam-rec
       
      move hrkgir-tl-tutar    to tutar
      if hrkgir-corr-depkod not = spaces and  not = zeroes
             move hrkgir-corr-depkod      to dep-toplam-anah
             read dep-toplam no lock invalid
               initialize dep-toplam-rec
               move hrkgir-corr-depkod  to dep-toplam-anah
               if hrkgir-ba = "B" then
                 move "A"     to dep-toplam-tip 
                 else    move "B"     to dep-toplam-tip 
               end-if
             end-read
             subtract tutar                from  dep-toplam-tutar
        else  

              move hrkgir-depkod       to dep-toplam-anah
              read dep-toplam no lock invalid
                   initialize dep-toplam-rec
                   move hrkgir-depkod  to dep-toplam-anah
                   move hrkgir-ba      to dep-toplam-tip
              end-read
              add tutar               to  dep-toplam-tutar
      end-if
      
           rewrite dep-toplam-rec invalid
              write dep-toplam-rec invalid continue end-write
      end-rewrite.
 kdv-toplam-al.

      initialize kdv-toplam-rec
      initialize tutar
      move hrkgir-tl-tutar    to tutar
      move hrkgir-depkod       to depkod-kodu
       if hrkgir-corr-depkod not = spaces and not = zeroes

             move hrkgir-corr-depkod       to depkod-kodu
        end-if
      
      read depkod no lock invalid continue end-read
      if depkod-kdv > 0 
          
              move depkod-kdv to kdv-toplam-anah
              read kdv-toplam no lock invalid
                   initialize kdv-toplam-rec
                   move depkod-kdv to kdv-toplam-anah
                  
              end-read
              if hrkgir-corr-depkod not = spaces and not = zeroes
                 subtract  hrkgir-tl-tutar            from  kdv-toplam-tutar
              else
                 add  hrkgir-tl-tutar                to kdv-toplam-tutar
              end-if
                compute tutar rounded = ( hrkgir-tl-tutar  / (100 + depkod-kdv ) ) * 100 
               if hrkgir-corr-depkod not = spaces and not = zeroes
                     compute kdv-net-tutar rounded = kdv-net-tutar -  tutar
                    else
                   compute kdv-net-tutar rounded = kdv-net-tutar +  tutar
              end-if
                if hrkgir-corr-depkod not = spaces and not = zeroes
                     compute kdv-kdv-tutar rounded =    kdv-kdv-tutar  - ( hrkgir-tl-tutar  - tutar )
                    else
                  compute kdv-kdv-tutar rounded =    kdv-kdv-tutar  + ( hrkgir-tl-tutar  - tutar )
              end-if
              rewrite kdv-toplam-rec invalid
                      write kdv-toplam-rec invalid continue end-write
              end-rewrite
      end-if.
*
 Form1-Gd-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
         move event-action-fail to event-action,
           inquire form1-gd-1, y in satir, x in sutun
              inquire Form1-Gd-1(satir,13),
                         cell-data in grid-islemno
              inquire Form1-Gd-1(satir,21),
                         cell-data in grid-fatno
              if grid-islemno > 0 then
                 if sutun = 20 then
                   inquire form1-gd-1(satir,20),
                           hidden-data in konu2-folio
                
                      call "/asya/ytl/obj/otel/folio.asy" using konu2-folio
                        on exception perform callerr-proc
                                not on exception
                         cancel "/asya/ytl/obj/otel/folio.asy" 
                   end-call      


               end-if
                  inquire Form1-Gd-1(satir,13),
                         hidden-data in hidden
                         if konuk-durumu = "H" then 
                           exit paragraph
                         end-if
                         if grid-fatno > 0 then
                         exit paragraph
                         end-if
                         if hidden(1:1) = "1" then 
                           move "0" to hidden(1:1)
                            modify form1-gd-1,
                              y = satir,
                               row-color = 0
*                    cell-color = 480
                           else
                            move "1" to hidden(1:1)
                             modify form1-gd-1,
                              y = satir,
                               row-color = 290
                         end-if
                    modify Form1-Gd-1(satir,13),
                         hidden-data = hidden
              end-if
            
        when msg-goto-cell
        when msg-goto-cell-mouse
        when msg-begin-drag
        when msg-end-drag
        when msg-goto-cell-drag
             inquire form1-gd-1,y in yeni-y
             if yeni-y < 2
                move 2 to yeni-y eski-y
             end-if
*             if eski-y > zeroes 
*                modify form1-gd-1(eski-y),
*                       x = 2
*                       row-color = 0
*                       cell-color = 0
*             end-if
             modify form1-gd-1,
                    y = yeni-y,
                    start-x = 3
                    start-y = yeni-y
                    x = 19,
                    region-color = 480
*                    cell-color = 480
             move yeni-y to eski-y
    end-evaluate.
     
     .
*
 Form1-Bef-Create.
      initialize acc-not
      move konuk-acik-1  to acc-acik-1
      move konuk-acik-2  to acc-acik-2
      initialize form1-title
      move "Folio "       to form1-title
      if konuk-durumu = "I"
         move "Inhouse ..."  to form1-title(15:)
      else




         move "History ..."  to form1-title(15:)
      end-if
      if combo-rapor-tipi-value(1:1) = "D" then
           if rapor-folio-kuru = 1 then 
               move "Folio Kuru uzerinden dovizli" to form1-title(30:) 
             else 
               move Banka-adi    to form1-title(30:)
               move "-"          to form1-title(45:1)
               move d-adi-1       to form1-title(46:)

           end-if
          else 
             move "TL fiyatlari"  to form1-title(30:)

      end-if
      open input acenta doviz kodlar02 firma yanrez
        move konuk-firma      to firma-kodu acc-firma-adi
         read firma no lock invalid
              move spaces to firma-adi
         end-read
      move "-"               to acc-firma-adi(5:)
      move firma-adi         to acc-firma-adi(6:)
      initialize yanrez-rec
      if konuk-fol-kodu = "R" then
        
        move konuk-rez-no to yanrez-rezno
        move 1           to yanrez-sirano
        read yanrez no lock invalid continue
        end-read     
       end-if 
      
      
      
      
      
      move konuk-acenta      to acenta-kodu acc-acenta-adi
      read acenta no lock invalid
           move "Tanimsiz ..." to acenta-adi
      end-read
      move "-"               to acc-acenta-adi(5:)
      move acenta-adi        to acc-acenta-adi(6:)

      move konuk-doviz       to doviz-kodu acc-doviz-adi
      read doviz no lock invalid
           move "Tanimsiz ..." to d-adi-1
      end-read
      move "-"               to acc-doviz-adi(3:)
      move d-adi-1           to acc-doviz-adi(4:)
      move konuk-kur-degeri  to e-kur-tutar
      move e-kur-tutar       to acc-cin-kuru
      move konuk-dv-degeri   to etutar
      move etutar            to acc-fiyat
      move "A"               to kodlar02-tipi
      move konuk-pan-tipi    to kodlar02-kodu acc-pansiyon-adi
      read kodlar02 no lock invalid
           move "Tanimsiz"   to kodlar02-adi
      end-read
      move "-"               to acc-pansiyon-adi(3:)
      move kodlar02-adi      to acc-pansiyon-adi(4:)
      move "B"               to kodlar02-tipi
      move konuk-odeme-tipi  to kodlar02-kodu acc-odeme-adi
      read kodlar02 no lock invalid
           move "Tanimsiz"   to kodlar02-adi
      end-read
      move ode-tipi to fol-pes
      move "-"               to acc-odeme-adi(3:)
      move kodlar02-adi      to acc-odeme-adi(4:)

      close acenta doviz kodlar02 yanrez firma.

*
 oda-ara.
      initialize oda-cagir.
      if combo-folio-yeri-value(1:1) = "I"
         move "D"   to oda-db-cagir
      end-if.
      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odaara.asy" 
       end-call.
       move odano-cagir     to rapor-oda.
 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move rapor-oda     to odalar-anah
       read odalar         no lock invalid 
            initialize rapor-oda
            not invalid continue 
       end-read
       close odalar.
       display acc-oda.
       initialize rapor-folio.
       display acc-folio.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.
*
 folio-ara.
       initialize folara-cagir
       move combo-folio-yeri-value(1:1) to folara-cagri-tipi
       move rapor-oda             to folara-odano
       call "/asya/ytl/obj/otel/folara.asy" using folara-cagir
            on exception 
            perform callerr-proc
            not on exception
         cancel "/asya/ytl/obj/otel/folara.asy"
         if folara-no-cagir <> zeroes
           move folara-no-cagir to rapor-folio
           display acc-folio
         end-if
       end-call.
 folio-ara-exit.
       exit.
     .
*
 Form0-Pb-3-Link.
*
 Form0-Pb-3a-Link.
*
 detay-goster.
     inquire form1-gd-1,
             cursor-y in form1-i
     inquire form1-gd-1 (form1-i)
             record-data in Form1-Gd-1-Record
     move gd-1-col-14 to rapor-islem-tipi
      if rapor-islem-tipi = "T" then 
     evaluate key-status
     when 2 move "S" to rapor-islem-tipi
     when 3 move "P" to rapor-islem-tipi
     end-evaluate
      end-if
     evaluate rapor-islem-tipi
       when "S"  
       when "P"
       when "T" perform Acu-Form2-Routine
     end-evaluate
     move 4  to accept-control
     move 14 to control-id
     .
*
 Form2-Aft-Create.
     evaluate rapor-islem-tipi
       when "S" perform telefon-detay-goster
       when "P" perform pos-detay-goster
       when "T" perform transfer-detay-goster
       when other perform detay-goster-kapat 
     end-evaluate
     .
*
 telefon-detay-goster.
     modify Form2-Handle, title "Telefon Ayrinti Raporu"
     modify Form2-Gd-1, visible false
     modify Form2-Fr-1, visible true
     modify Form2-Fr-2, visible true
     modify Form2-La-10, visible true
                         size    10
     modify Form2-La-11, visible true
                         column  15
     modify Form2-La-12, visible false
     modify Form2-La-20, visible true
                         size    10
     modify Form2-La-21, visible true
                         column  15
     modify Form2-La-22, visible true
                         column  20
     modify Form2-La-30, visible true
                         size    10
     modify Form2-La-31, visible true
                         column  15
     modify Form2-La-40, visible true
                         size    10
     modify Form2-La-41, visible true
                         column  15
     modify Form2-La-42, visible true
                         column  20
     modify Form2-La-50, visible true
                         size    10
     modify Form2-La-51, visible true
                         column  15
     modify Form2-La-60, visible true
                         size    10
     modify Form2-La-61, visible true
                         column  15
     modify Form2-La-62, visible false
     modify Form2-Ef-10, visible true
                         column  16
                         size    8
     modify Form2-Ef-12, visible false
     modify Form2-Ef-20, visible true
                         column  16
                         size    4
     modify Form2-Ef-22, visible true
                         column  21
                         size    6
     modify Form2-Ef-30, visible true
                         column  16
                         size    5
     modify Form2-Ef-40, visible true
                         column  16
                         size    4
     modify Form2-Ef-42, visible true
                         column  21
                         size    6
     modify Form2-Ef-50, visible true
                         column  16
     modify Form2-Ef-60, visible true
                         column  16
                         size    15
     modify Form2-Ef-62, visible false
     
     initialize teldata-rec
     open input teldata
     move gd-1-col-1(1:2) to rapor-gun
     move gd-1-col-1(4:2) to rapor-ay
     move gd-1-col-1(7:4) to rapor-yil
     move gd-1-col-9      to rapor-islem
     move gd-1-col-10      to rapor-cekno
     move rapor-tarih to teldata-tarih
     start teldata key >= teldata-anah
       invalid
         continue
       not invalid
         perform with test after until fs-teldata = "10"
           read teldata next no lock
             end
               move "10" to fs-teldata
             not at end
               if teldata-tarih   = rapor-tarih and
                  teldata-islemno = rapor-cekno and
                  teldata-tipi    = "M"

                  modify Form2-La-10, TITLE
                    "Tarih"
                  modify Form2-La-20, TITLE
                    "Oda / Folio"
                  modify Form2-La-30, TITLE
                    "Islem No"
                  modify Form2-La-40, TITLE
                    "Kontur / Zaman"
                  modify Form2-La-42, TITLE
                    "/"
                  modify Form2-La-50, TITLE
                    "Numara"
                  modify Form2-La-60, TITLE
                    "Tutar"
                    
                  move teldata-gun to egun
                  move teldata-ay  to eay
                  move teldata-yil to eyil
                  modify Form2-Ef-10, VALUE etarih
                  modify Form2-Ef-20, VALUE teldata-odano
                  modify Form2-Ef-22, VALUE teldata-folio
                  modify Form2-Ef-30, VALUE teldata-islemno
                  modify Form2-Ef-40, VALUE teldata-kontur
                  modify Form2-Ef-42, VALUE teldata-sure
                  modify Form2-Ef-50, VALUE teldata-numara
                  move teldata-satis to etutar
                  modify Form2-Ef-60, VALUE etutar
                  move "10" to fs-teldata
               end-if
           end-read
         end-perform
     end-start
     close teldata
     move 4    to accept-control
     move 1001 to control-id
     .
*
 pos-detay-goster.
     modify Form2-Handle, title "Satis Ayrinti Raporu"
     modify Form2-Gd-1, visible true
     modify Form2-Fr-1, visible false
     modify Form2-Fr-2, visible false
     modify Form2-Fr-2, visible false
     modify Form2-La-10, visible false
     modify Form2-La-11, visible false
     modify Form2-La-12, visible false
     modify Form2-La-20, visible false
     modify Form2-La-21, visible false
     modify Form2-La-22, visible false
     modify Form2-La-30, visible false
     modify Form2-La-31, visible false
     modify Form2-La-40, visible false
     modify Form2-La-41, visible false
     modify Form2-La-42, visible false
     modify Form2-La-50, visible false
     modify Form2-La-51, visible false
     modify Form2-La-60, visible false
     modify Form2-La-61, visible false
     modify Form2-La-62, visible false
     modify Form2-Ef-10, visible false
     modify Form2-Ef-12, visible false
     modify Form2-Ef-20, visible false
     modify Form2-Ef-22, visible false
     modify Form2-Ef-30, visible false
     modify Form2-Ef-40, visible false
     modify Form2-Ef-42, visible false
     modify Form2-Ef-50, visible false
     modify Form2-Ef-60, visible false
     modify Form2-Ef-62, visible false
     
     initialize cost-degiskenler p-rec costhrk-rec i
     move cost-sirketi to costhrk-dosya-adres p-dosya-alan posdep-dosya-adres
     move cost-sirketi to satkod-dosya-adres

     move stok-sirketi to depart-dosya-adres
     move gd-1-col-1(1:2) to rapor-gun
     move gd-1-col-1(4:2) to rapor-ay
     move gd-1-col-1(7:4) to rapor-yil
     move gd-1-col-9     to rapor-islem
     move gd-1-col-10      to rapor-cekno
     move rapor-yil       to costhrk-dosya-yil    p-dosya-yil   
     move rapor-ay        to costhrk-dosya-ay     p-dosya-ay
     move rapor-gun   to   p-dosya-gun  
     move rapor-tarih     to costhrk-tarih         
     move rapor-cekno     to costhrk-fis-no p-fis-no
     move "C"             to costhrk-ana-tip
     move "A"             to costhrk-alt-tip
     open input costhrk satkod depart  p posdep

 




     
     start p key >= p-alt-2
       invalid
         continue
       not invalid
         modify form2-gd-1,reset-grid = 1 mass-update = 1
         move "Kodu"        to cost-gd-kodu
         move "Recete Adi"  to cost-gd-adi
         move "Adet"        to cost-gd-mik
         move "Tutar"       to cost-gd-tl
         modify form2-gd-1, record-to-add = cost-gd-dizi
         add 1 to i
         perform with test after until fs-p = "10"
           read p next no lock
             end
               move "10" to fs-p
             not at end
               if 

                  p-fis-no  = rapor-cekno 
                

                  
                    initialize posdep-rec
                     move p-depkod to posdep-anah
                     read posdep no lock invalid
                       stop " "
                      display message box "posdep bulunamadi "  p-depkod
                     end-read
                  
                 
                     
                 

                 
                     initialize satkod-rec
                     move p-rec-kodu    to       satkod-kodu
                     move posdep-recete-ana-dep    to satkod-ana-dep
                     move posdep-recete-alt-dep     to satkod-alt-dep
                     read satkod no lock
                       invalid
                         move all "*"  to satkod-adi
                     end-read
                     move satkod-adi   to cost-gd-adi
                     move p-adet to emiktar
                     move emiktar      to cost-gd-mik
                 

                 
                     move  p-tutar-tl to cost-tl
                     move  p-tutar-dv to cost-dv
                     add p-tutar-tl to    cost-top-tl
                     add p-tutar-dv to    cost-top-dv
                     perform grid2-deger-yukle
               else
                  move "10" to fs-p
               end-if
           end-read
         end-perform

         initialize cost-gd-dizi
         modify form2-gd-1, record-to-add = cost-gd-dizi
         add 1 to i
         move all high-value to cost-gd-adi
         move "TOPLAM :"  to cost-gd-adi(13:8)
         move cost-top-tl to e-tutar
         move e-tutar     to cost-gd-tl
          move cost-top-dv to e-tutar
         move e-tutar     to cost-gd-dv
         modify form2-gd-1, record-to-add = cost-gd-dizi
                            Y             = i
                            row-color     = 432
         modify form2-gd-1,mass-update = 0
     end-start
     close costhrk satkod depart p posdep 
     move 4    to accept-control
     move 1001 to control-id
     .
*
 grid2-deger-yukle.
        move cost-tl          to e-tutar
        move e-tutar          to cost-gd-tl
         move cost-dv          to e-tutar
        move e-tutar          to cost-gd-dv
        modify form2-gd-1, record-to-add(cost-gd-dizi)
        add 1 to i
        move costhrk-rec-sira to eski-rec-sira
       
        initialize cost-tl.
     .
*
 transfer-detay-goster.
     modify Form2-Handle, title "Cek Transfer Bilgisi"
     modify Form2-Gd-1, visible false
     modify Form2-Fr-1, visible true
     modify Form2-La-10, visible true
                         size    14
     modify Form2-La-11, visible true
                         column  18
     modify Form2-La-12, visible true
                         column  23
     modify Form2-La-20, visible true
                         size    14
     modify Form2-La-21, visible true
                         column  18
     modify Form2-La-22, visible false
     modify Form2-La-30, visible true
                         size    14
     modify Form2-La-31, visible true
                         column  18
     modify Form2-La-40, visible true
                         size    14
     modify Form2-La-41, visible true
                         column  18
     modify Form2-La-42, visible true
                         column  27
     modify Form2-La-50, visible true
                         size    14
     modify Form2-La-51, visible true
                         column  18
     modify Form2-La-60, visible true
                         size    14
     modify Form2-La-61, visible true
                         column  18
     modify Form2-La-62, visible true
                         column  27
     modify Form2-Ef-10, visible true
                         column  19
                         size    4
     modify Form2-Ef-12, visible true
                         column  24
                         size    6
     modify Form2-Ef-20, visible true
                         column  19
                         size    24
     modify Form2-Ef-22, visible false
     modify Form2-Ef-30, visible true
                         column  19
                         size    24
     modify Form2-Ef-40, visible true
                         column  19
                         size    8
     modify Form2-Ef-42, visible true
                         column  28
                         size    8
     modify Form2-Ef-50, visible true
                         column  19
     modify Form2-Ef-60, visible true
                         column  19
                         size    8
     modify Form2-Ef-62, visible true
                         column  28
                         size    6
     
     initialize cektr-rec
     open input cektr
     move gd-1-col-1(1:2) to rapor-gun
     move gd-1-col-1(4:2) to rapor-ay
     move gd-1-col-1(7:4) to rapor-yil
     move gd-1-col-9      to rapor-islem
     move rapor-tarih to cektr-tarih
     start cektr key >= cektr-tarih
       invalid
         continue
       not invalid
         perform with test after until (fs-cektr = "10" or fs-cektr = "OK")
           read cektr next no lock
             end
               move "10" to fs-cektr
             not at end
               if cektr-tarih = rapor-tarih
                  if cektr-yeni-folio = rapor-folio and
                     cektr-islem      = rapor-islem

                     modify Form2-La-10, TITLE
                       "Eski Oda / Folio"
                     modify Form2-La-20, TITLE
                       "Musteri Adi"
                     modify Form2-La-30, TITLE
                       "Musteri Soyadi"
                     modify Form2-La-40, TITLE
                       "C/in - C/Out"
                     modify Form2-La-42, TITLE
                       "-"
                     modify Form2-La-50, TITLE
                       "Transferi Yapan"
                     modify Form2-La-60, TITLE
                       "Transfer Tarih / Zaman"
                     
                     open input konuk
                     move cektr-eski-folio to konuk-folio
                     read konuk no lock
                       invalid
                         move all "*" to konuk-rec
                     end-read
                     close konuk

                     open input kllnc
                     move cektr-staf  to k-kodu
                     read kllnc no lock
                       invalid
                         move all "*" to kllnc-rec
                     end-read
                     close kllnc

                     modify Form2-Ef-10, VALUE konuk-odano
                     modify Form2-Ef-12, VALUE cektr-eski-folio
                     modify Form2-Ef-20, VALUE konuk-adi
                     modify Form2-Ef-30, VALUE konuk-soyadi
                     move konuk-gel-gun to egun
                     move konuk-gel-ay  to eay
                     move konuk-gel-yil to eyil
                     modify Form2-Ef-40, VALUE etarih
                     move konuk-git-gun to egun
                     move konuk-git-ay  to eay
                     move konuk-git-yil to eyil
                     modify Form2-Ef-42, VALUE etarih
                     modify Form2-Ef-50, VALUE k-adi
                     move cektr-isl-gun to egun
                     move cektr-isl-ay  to eay
                     move cektr-isl-yil to eyil
                     modify Form2-Ef-60, VALUE etarih
                     move cektr-saat    to esaat
                     move cektr-dakika  to edakika
                     move cektr-saniye  to esaniye
                     modify Form2-Ef-62, VALUE ezaman
                  end-if
               else
                  move "10" to fs-cektr
               end-if
           end-read
         end-perform
     end-start
     close cektr
     move 4    to accept-control
     move 1001 to control-id
     .
*
 detay-goster-kapat.
     set Exit-Pushed to true
     .
*
 Form2-Pb-1-Ex-Cmd-Clicked.
     perform detay-goster-kapat
     .
*
*

*
 Form1-Gd-1-Ex-Other.
       
      initialize Form1-Gd-1-record grid-islemno
    inquire Form1-Gd-1, cursor-y in satir cursor-x in sutun
    inquire Form1-Gd-1(satir),
            record-data in form1-gd-1-record
            
    move gd-1-col-9   to grid-islemno
    evaluate event-type 
         when msg-begin-entry
             move event-action-fail to event-action,
    end-evaluate.
     evaluate key-status
     when 9 
      move key-status to  esk-status 
*     perform hrk-0
      when 19
      when 15
         move key-status to  esk-status 
         set exit-pushed to true
*      when 1055 

*              compute link-ref =  secili-tab - 1
*             call "/asya/ytl/obj/otel/folfat1.asy" 
*                 using  konuk-folio, konuk-odano, link-ref
*              on exception 
*                  perform callerr-proc
*                  exit paragraph
*              not on exception 
*                  cancel "/asya/ytl/obj/otel/folfat1.asy"
*            end-call
*             perform tum-tab-ac
        
    
       
     
     when 1
     when 2
     when 3
        perform detay-goster

     
           
     end-evaluate.
     .
*
 Form1-Aft-Create.
     move 4  to accept-control
     move 14 to control-id



     .

*
 Before-Procedurelar.
     Evaluate control-id
       when 10
         perform folio-ara  thru folio-ara-exit
     end-evaluate
     .
     .

depart-ara.
      initialize depkod-cagir
                 call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                    on exception perform callerr-proc
                       not on exception
                       cancel "/asya/ytl/obj/otel/depara.asy" 
                  end-call
                          move depkod-dep-kodu to rapor-departman
               display accept-departman
               move 4 to accept-control
               move 14 to control-id
        .


 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to rapor-banka
       display accept-banka
        move 4 to accept-control
        move 21 to control-id.
 after-banka.
       open input banka.
       initialize banka-rec.
       move rapor-banka    to banka-kodu
       read banka        no lock invalid 
            add 1        to gec-gecme
             
             move "Tanimsiz" to banka-adi
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to l-banka-adi.


       display label-banka-adi
        .
 
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to rapor-doviz
       display accept-doviz
       move 4 to accept-control
        move 22 to control-id..
 after-doviz.
       open input doviz.
       initialize doviz-rec.
       move rapor-doviz    to doviz-kodu
       read doviz         no lock invalid 
            add  1        to gec-gecme
            move "Tanimsiz" to d-adi-1
            
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to l-doviz-adi
       display label-doviz-adi.
 
 after-depkod.
    
    if rapor-departman = spaces or rapor-departman = zeroes
       move "Tm Departmanlar" to l-depkod-adi
       else
            
            open input depkod
            move rapor-departman   to depkod-anah
            read depkod no lock invalid
                 move "Tanimsiz ..." to depkod-adi
                 move 1 to gec-gecme
                 not invalid 
                continue 
            end-read
            close depkod
            move depkod-adi to l-depkod-adi
            display l-depart-adi
         end-if   
     
     .
 after-folio-kuru.
        
         if rapor-folio-kuru = 1 then 
             move 0 to dis-dov
          else 
             move 1 to dis-dov 
          end-if
           display accept-banka accept-doviz    .
           .
 
 tipi-after.
        if combo-rapor-tipi-value(1:1) = "D"
           move 1 to vis-dov
         else 
           move 0 to vis-dov 
           move 1 to dis-dov
          
        end-if
        display label-banka accept-banka label-banka-adi
                   label-doviz accept-doviz label-doviz-adi
                   label-folio-kuru
         perform after-folio-kuru
       .
 
       .



*
 Form1-Ex-Other.
      
 
     evaluate key-status



   
           
    
     when 2002
          perform toplu-kontrol
                if gec-gecme = 0 

                perform liste-islem
                move 4 to accept-control
                move 9 to control-id
                end-if
    
      when 3131 
        if konuk-fol-kodu = "R" 

         move 9 to link-nereden 
         move "REZ"   to  link-NOT-DOS    
         move konuk-rez-no to link-NOT-DOS-ANAH   
         else
         if konuk-extra-rez-no > 0 then
           move 10 to link-nereden 
           move "REZ"   to  link-NOT-DOS    
           move konuk-extra-rez-no to link-NOT-DOS-ANAH    
           else
           move 10 to link-nereden 
           move "KON"   to  link-NOT-DOS    
           move konuk-folio to link-NOT-DOS-ANAH    
           
          end-if

       end-if 
      
           move "U"     to  link-not-islem
           
           string konuk-adi delimited by "  "
                  " " delimited by size
                  konuk-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
                  display not-ac
     end-evaluate
     .

*
 konuk-ara.
      initialize konuk-cagir.
      move combo-folio-yeri-value(1:1)  to konuk-cagri-tipi
      call "/asya/ytl/obj/otel/konukara.asy" using konuk-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/konukara.asy" 
       end-call.
       move konuk-folio-cagir  to rapor-folio.
       display acc-folio. 
       open input konuk
       initialize konuk-rec
       move rapor-folio        to konuk-folio
       read konuk no lock invalid
            close konuk
            exit paragraph
       end-read
       close konuk.
       move konuk-odano        to rapor-oda.
       display acc-oda.
       move 4 to accept-control
       move 17 to control-id.




*
 Aft-Procedure.
      
            move 27 to key-status
     
     .
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form2a-Ex-Other.
        continue

     .

     .
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.












         .

*
 Form1-Pb-3-Ev-Cmd-Clicked.
      
     .
*
 Form1-Gd-1-Ev-Msg-Begin-Entry.
     
     .
*
 screen2-Ex-Other.
           evaluate key-status
            when 2
              move 1 to gon-sec
              set exit-pushed to true
             
              when other
              move 0 to gon-sec
           end-evaluate
     .
*
 hedef-bul.
      initialize romhrk-rec exthrk-rec
      move hrkgir-tarih to romhrk-tarih exthrk-tarih
      move hrkgir-depkod to romhrk-depkod exthrk-depkod
      start romhrk key = romhrk-anah2 invalid continue
         not invalid
           perform until fs-romhrk = "10"
             read romhrk next no lock end move "10" to fs-romhrk
              not end
               if romhrk-tarih not = hrkgir-tarih or
                  romhrk-depkod not = hrkgir-depkod then
                     move "10" to fs-romhrk
                   
               else
                  if romhrk-islem = yromhrk-islem then
                      move romhrk-folio to konu2-folio
                      exit paragraph
                    end-if
             end-if
            end-read
          end-perform
      end-start.
     
      start exthrk key = exthrk-anah2 invalid continue
         not invalid
           perform until fs-exthrk = "10"
             read exthrk next no lock end move "10" to fs-exthrk
              not end
               if exthrk-tarih not = hrkgir-tarih or
                  exthrk-depkod not = hrkgir-depkod then
                     move "10" to fs-exthrk
                   
               else
                  if exthrk-islem = yromhrk-islem then
                      move exthrk-folio to konu2-folio
                      exit paragraph
                    end-if
             end-if
            end-read
          end-perform
      end-start.

*
 Kgrid-Yukle.
        
          
       initialize form1-gd-1-record 
        
     initialize konu2-rec  
        perform hedef-bul

     read konu2 no lock invalid 
          
            continue
       end-read
     
      if  hrkgir-fatura-no > 0 then 
      move hrkgir-fatura-no to gd-1-col-21
      else
        move spaces to gd-1-col-21
      end-if
       move  konu2-odano to o-kisa
      perform oda-uzat

      string
        o-uzun delimited by size
     
        "-" delimited by size
        konu2-adi delimited by "  "
        " " delimited by size
        konu2-soyadi delimited by "  " 
        into text2
        end-string
        move text2 to gd-1-col-20 
      move hrkgir-gun             to egun
      move hrkgir-ay              to eay 
      move hrkgir-yil             to eyil
      move etarih                 to gd-1-col-1
      move hrkgir-depkod          to gd-1-col-2 depkod-anah
      read depkod no lock invalid
           move "Tanimsiz ..."    to depkod-adi
      end-read
      move depkod-adi             to gd-1-col-3
      MOVE  hrkgir-tl-tutar   TO TLTUTAR ETLTUTAR
      if combo-rapor-tipi-value(1:1) = "T"
         move hrkgir-tl-tutar      to etutar tutar  ETLTUTAR TLTUTAR
         MOVE 1 TO KONUK-KUR-DEGERI
      else
********************************         
        if rapor-folio-kuru =0 then 
            open input kur
            move rapor-banka(1:2) to kur-banka
            move rapor-doviz to kur-doviz
            move hrkgir-tarih to kur-tarih
            read kur no lock 
                 invalid
                 if uyari = 0 then 
                    display message box rapor-banka "---" kur-banka "--Kur bulunamadi folio-kuru alinacak"
                    move 1 to uyari
                  end-if
                 not invalid 
                evaluate true
                    when "D" = onkpara-d-e and  "A" = onkpara-a-s 
                         move doviz-alis    to konuk-kur-degeri
                    when "D" = onkpara-d-e and  "S" = onkpara-a-s 
                         move doviz-satis   to konuk-kur-degeri
                    when "E" = onkpara-d-e and  "A" = onkpara-a-s 
                         move efektif-alis  to konuk-kur-degeri
                    when "E" = onkpara-d-e and  "S" = onkpara-a-s 
                         move efektif-satis to konuk-kur-degeri
                    when other
                         move doviz-alis to konuk-kur-degeri
                 end-evaluate   
              end-read            
                 close kur       
            end-if


          
         compute   hrkgir-dv-tutar rounded =
               hrkgir-tl-tutar / konuk-kur-degeri
         move hrkgir-dv-tutar      to etutar tutar





*******************************
      end-if

      evaluate hrkgir-ba
           when "A" move etutar to gd-1-col-6
                    MOVE ETLTUTAR TO  gd-1-col-106
                    add tutar   to alac-toplam
                    subtract tutar from bakiye
                     add TLtutar   to TLalac-toplam
                    subtract TLtutar from TLbakiye
           when "B" move etutar to gd-1-col-5
                     MOVE ETLTUTAR TO  gd-1-col-105 
                    add tutar   to borc-toplam 
                    add tutar   to bakiye
                      add TLtutar   to TLborc-toplam 
                    add TLtutar   to TLbakiye
      end-evaluate.
      MOVE KONUK-KUR-DEGERI TO EKUR
      MOVE EKUR TO GD-1-COL-99
      move bakiye               to etutar
      move etutar               to gd-1-col-7
       move TLbakiye               to eTLtutar
      move eTLtutar               to gd-1-col-107
      move hrkgir-saat          to esaat
      move hrkgir-dakika        to edakika
      move hrkgir-saniye        to esaniye
      move ezaman               to gd-1-col-8
      move hrkgir-islem         to gd-1-col-9
      move hrkgir-cekno         to gd-1-col-10
      move hrkgir-kart-no       to gd-1-col-11
      move hrkgir-staf          to k-kodu
      read kllnc no lock invalid
           move "Tanimsiz ..."  to k-adi
      end-read
      move k-adi                to gd-1-col-12
      move hrkgir-pos-kodu      to gd-1-col-13
      move hrkgir-islem-tipi    to gd-1-col-14
      modify form1-gd-1,
             record-to-add(form1-gd-1-record).
        inquire form1-gd-1,
            last-row in kayit-yeri
       modify form1-gd-1(kayit-yeri,20),
            hidden-data = konu2-folio.
*
 Form0-Aft-Routine.
     close odalar2
     .

 
