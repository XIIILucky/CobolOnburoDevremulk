* pocketrp.evt
* pocketrp.evt is generated from D:\asya\acugt.ytl\otel\pocketrp.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform adresleri-tasi
     open input genel
     initialize genel-rec
     move 1  to genel-anahtar
     read genel no lock invalid
          continue 
     end-read 
     close genel.
****     ONKPARA-DOVIZ     
* 
 takvim-dunu-bul.
            
            initialize takvim-rec top-kayit hazir-oda hazir-yatak
            move tarih-tasi to takvim-anah
            start takvim key not < takvim-anah  invalid
                    continue
            not invalid
            perform until fs-takvim = "10"
            read takvim backward no lock end move "10" to fs-takvim
            not end
               add 1 to top-kayit   
               if top-kayit = 2 then
                     move takvim-anah to dun-tarih
                     move TAKVIM-HAZIR-ODA   to hazir-oda
                     move TAKVIM-HAZIR-YATAK to hazir-yatak
                     exit perform
               end-if
        
            end-read
            end-perform
            end-start
        
            .
*
 Form1-Ex-Other.
      evaluate key-status 
         when 2
            open input cast rez konuk acenta takvim gelist doviz onkasa depkod kodlar02  kur ulke 
                 perform dokumer-baslik-ayarla
            close cast rez konuk takvim gelist acenta onkasa doviz depkod kodlar02  kur ulke 
      end-evaluate
     .

* 
 isleme-basla.
            perform bigileri-oku-basla
             |||| BILGILERINI DOKUMERE YAZDIRRR
             |||dunn
            initialize ileri-tarihz

            ||||ileriye donuk 5 gunu bulll
       
            initialize takvim-rec top-kayit 
            move tarih-tasi to takvim-anah
            start takvim key not < takvim-anah  invalid
                    continue
            not invalid
            perform until fs-takvim = "10"
            read takvim next no lock end move "10" to fs-takvim
            not end
               add 1 to top-kayit   
               move takvim-anah to ileri-tarih(top-kayit)

               if top-kayit >= 11 then
                     exit perform 
               end-if
            end-read
            end-perform
            end-start

            ||||||||||||
            initialize detay
            move "ODA"    to det-1  
            move dun-oda      to z-5
            move z-5          to det-2
            compute yuzde-hesap = ( 100 * dun-oda ) /  hazir-oda 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-3
 
            |||bugun
            move bugun-oda      to z-5
            move z-5            to det-4
            compute yuzde-hesap = ( 100 * bugun-oda ) /  hazir-oda 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-5

            move ileri-tarih(2) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz

            |+
            initialize detay
            move "PAX + CHILD" to det-1
            move dun-pax   to z-5
            move z-5            to det-2
            compute yuzde-hesap = ( 100 * dun-pax ) /  hazir-yatak
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-3
            |||bugun
            move bugun-pax      to z-5
            move z-5            to det-4
            compute yuzde-hesap = ( 100 * bugun-pax ) /  hazir-yatak 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-5

            move ileri-tarih(3) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz

            initialize detay
            move "BEBEK "to det-1

            move dun-child to z-5
            move z-5       to det-2

            move bugun-child to z-5
            move z-5         to det-4            
            move ileri-tarih(4) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz
            
            initialize detay
            move "FREE "to det-1
            move dun-free to z-5
            move z-5       to det-2

            move bugun-free to z-5
            move z-5       to det-4               
            move ileri-tarih(5) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz

            |||||||||||||||||||||||||||||||||||||||||||||||||||||||
            initialize detay
            move "CIN / COUT " to det-1
            move "GUNSONU"  to det-2
            move "% GUNSONU" to det-3
            move "BEKLENEN "  to det-4
            move "% BEKLENEN " to det-5
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1) 
            move ileri-tarih(6) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz

            |||||||||||||||||||||||||||||||||| |||||||||||||||||||||||
            initialize detay
            move "CIN ODA "     to det-1
            ||dunnn
            move dun-giren-oda to z-5
            MOVE Z-5           TO DET-2
            compute yuzde-hesap = ( 100 * dun-giren-oda ) /  hazir-oda 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-3        
            ||bugun
            move bugun-girecek-oda to z-5
            MOVE Z-5           TO DET-4
            compute yuzde-hesap = ( 100 * bugun-girecek-oda ) /  hazir-oda 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-5

            move ileri-tarih(7) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz


            initialize detay
            move "CIN PAX + CHILD"     to det-1
            ||dunnn
            move dun-giren-pax to z-5
             MOVE Z-5           TO DET-2
            compute yuzde-hesap = ( 100 * dun-giren-pax ) /  hazir-yatak
            move yuzde-hesap  to z-5z
            string  "%" delimited by size
                   z-5z delimited by size
            into det-3
            ||bugun
            move bugun-girecek-pax to z-5
             MOVE Z-5           TO DET-4
            compute yuzde-hesap = ( 100 * bugun-girecek-pax ) /  hazir-yatak 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-5       
            move ileri-tarih(8) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz


           initialize detay
            move "COUT ODA "     to det-1 
            ||||dun
            move dun-cikan-oda to z-5
             MOVE Z-5           TO DET-2
            compute yuzde-hesap = ( 100 * dun-cikan-oda ) /  hazir-oda 
            move yuzde-hesap  to z-5z
            string  "%" delimited by size
                   z-5z delimited by size
            into det-3
            |||bugunnn
            move bugun-cikacak-oda to z-5
             MOVE Z-5           TO DET-4
            compute yuzde-hesap = ( 100 * bugun-cikacak-oda ) /  hazir-oda 
            move yuzde-hesap  to z-5z
            string "%" delimited by size
                   z-5z delimited by size
            into det-5       
            move ileri-tarih(9) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz



            initialize detay
            move "COUT PAX + CHILD "     to det-1 
            ||||dun
            move dun-cikan-pax to z-5
             MOVE Z-5           TO DET-2
            compute yuzde-hesap = ( 100 * dun-cikan-pax ) /  hazir-yatak
            move yuzde-hesap  to z-5z
            string  "%" delimited by size
                   z-5z delimited by size
            into det-3
            |||bugunnn
            move bugun-cikacak-pax to z-5
             MOVE Z-5           TO DET-4
            compute yuzde-hesap = ( 100 * bugun-cikacak-pax ) /  hazir-yatak 
            move yuzde-hesap  to z-5z
            string  "%" delimited by size
                   z-5z delimited by size
            into det-5  
            move ileri-tarih(10) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz


            |||||||||||||||||||||||||||||||||||||||||||||||||||||||
            initialize detay
            move "ORTALAMALAR" to det-1
            move "GUNSONU" to det-2
            move "% GUNSONU" to det-3
            move "BEKLENEN   " to det-4
            move "% BEKLENEN   " to det-5
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            move ileri-tarih(11) to  ileri-tarih-siradaki
            perform ileri-cast-oku-yaz

            |||||||||||||||||||||||||||||||||| |||||||||||||||||||||||


            initialize detay
            move "% ODA"     to det-1
            compute toplam-oda = dun-oda
            move toplam-oda to z-5
            MOVE Z-5        TO DET-2
            compute yuzde-hesap = ( 100 * toplam-oda  ) /  hazir-oda
            move yuzde-hesap  to z-5z
            string  " %" delimited by size
                   z-5z delimited by size
            into det-3

            compute toplam-oda =  bugun-girecek-oda + bugun-oda - bugun-cikacak-oda
            move toplam-oda to z-5
            MOVE Z-5        TO DET-4
            compute yuzde-hesap = ( 100 * toplam-oda ) /  hazir-oda
            move yuzde-hesap  to z-5z
            string  " %" delimited by size
                   z-5z delimited by size
            into det-5
            write dokumer-rec from detay
            |||||||||||||||||||
            move "% PAX + CHILD"     to det-1
            compute toplam-pax = dun-pax
            move toplam-pax to z-5
            MOVE Z-5        TO DET-2
            compute yuzde-hesap = ( 100 * toplam-pax  ) /  hazir-yatak
            move yuzde-hesap  to z-5z
            string  " %" delimited by size
                   z-5z delimited by size
            into det-3

            compute toplam-pax =  bugun-girecek-pax + bugun-pax - bugun-cikacak-pax
            move toplam-pax to z-5
            MOVE Z-5        TO DET-4
            compute yuzde-hesap = ( 100 * toplam-pax ) /  hazir-yatak 
            move yuzde-hesap  to z-5z
            string  " %" delimited by size
                   z-5z delimited by size
            into det-5
            write dokumer-rec from detay


             |||||||||||||||||||||||||||||||||||||||||||||||||||||||
            initialize detay
            move "ODA GELIRI" to det-1
            move "GUNSONU GLR " to det-2
            MOVE "ODA ORT"         TO DET-3
            MOVE "BEKLENEN GLR"      TO DET-4
            MOVE "ODA ORT "       TO DET-5
**************************************************************            
            move "GUNS.GLR DV" to det-6
            move "ODA ORT DV" to det-7
            MOVE "BEKL.GLR DV"         TO DET-8
            MOVE "ODA ORT DV"      TO DET-9
            move "Doviz"           to det-10

            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            write dokumer-rec from detay
            |||||||||||||||||||||||||||||||||| |||||||||||||||||||||||
            initialize kur-rec           
            move tarih-tasi  to gercek-tarih
            compute s1  = function INTEGER-OF-DATE(gercek-tarih) - 1
            compute s2  = function DATE-of-integer(s1)
            move s2          to kur-tarih
            move onkpara-doviz  to kur-doviz
            move 01             to kur-banka
            read kur no lock invalid 
                 continue 
            end-read      

            initialize detay
            move "GELIR - ORT(ODA)" to det-1
            move dun-oda-gelir to z-9
            MOVE Z-9           TO DET-2

            compute dun-oda-gelir-dv rounded = (dun-oda-gelir / doviz-alis)
            move dun-oda-gelir-dv to z-9
            move z-9              to det-6

            compute yuzde-hesap = dun-oda-gelir /  dun-oda
            move yuzde-hesap  to z-9z
            MOVE  z-9z            TO det-3

            compute yuzde-hesap = dun-oda-gelir-dv /  dun-oda
            move yuzde-hesap  to z-9z
            MOVE  z-9z            TO det-7

*******************************************************************************
            initialize kur-rec
            move onkpara-doviz  to kur-doviz
            move 01             to kur-banka
            move tarih-tasi     to kur-tarih
            read kur no lock invalid 
                 continue 
            end-read  

            move bugun-oda-gelir to z-9   
            MOVE Z-9             TO DET-4

            compute bugun-oda-gelir-dv rounded = (bugun-oda-gelir / doviz-alis)
            move bugun-oda-gelir-dv to z-9
            move z-9              to det-8

            compute yuzde-hesap =  bugun-oda-gelir / ( bugun-oda + bugun-girecek-oda - bugun-cikacak-oda )
            move yuzde-hesap  to z-9z
            MOVE  z-9z           TO det-5

            compute yuzde-hesap =  bugun-oda-gelir-dv / ( bugun-oda + bugun-girecek-oda - bugun-cikacak-oda )
            move yuzde-hesap  to z-9z
            MOVE  z-9z           TO det-9
            
            initialize doviz-rec
            move onkpara-doviz   to doviz-kodu
            read doviz no lock invalid 
                continue 
            end-read 

               move d-kisa-adi   to det-10

            write dokumer-rec from detay

            |||||||||||||||||||||||||||||||||||||||||||||||||||||||
            initialize detay
            move "PAZAR DAGILIMI" to det-1
            move "ODA"       to det-2
            MOVE "PAX + CHILD"       TO DET-3
            move "ODA (INHOUSE)"       to det-4
            MOVE "PAX+CLHD(INH)"       TO DET-5
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            write dokumer-rec from detay
            |||||||||||||||||||||||||||||||||| |||||||||||||||||||||||
      
             perform varying i from 1 by 1 until i > 20
             initialize pazar-bulundu DETAY
                    if p-Kodu(i) not = SPACES then 
                            initialize kodlar02-rec
                            move p-Kodu(i)   to kodlar02-kodu
                            move "E"             to kodlar02-tipi
                            read kodlar02 no lock invalid
                                    exit perform cycle
                            end-read
                            move kodlar02-adi  to det-1
                            move p-dun-oda(i) to z-5
                            MOVE Z-5          TO DET-2
                            move p-dun-pax(i) to z-55
                            MOVE Z-55          TO DET-3
                            move p-bugun-oda(i) to z-5
                            MOVE Z-5            TO DET-4
                            move p-bugun-pax(i) to z-55
                            MOVE Z-55           TO DET-5
                           write dokumer-rec from detay
                    end-if
              end-perform
**********************************************************************************
            |||||||||||||||||||||||||||||||||||||||||||||||||||||||
            initialize detay
            move "ULKE DAGILIMI" to det-1
            move "ODA"       to det-2
            MOVE "PAX + CHILD"       TO DET-3
            move "ODA (INHOUSE)"       to det-4
            MOVE "PAX+CLHD(INH)"       TO DET-5
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            write dokumer-rec from detay
            |||||||||||||||||||||||||||||||||| |||||||||||||||||||||||
      
             perform varying i from 1 by 1 until i > 30
             initialize ulke-bulundu DETAY
                    if u-Kodu(i) not = SPACES then 
                            initialize ulke-rec
                            move u-kodu(i)   to  ulke-anah
                            read ulke no  lock invalid 
                                continue 
                            end-read 
                               move ulke-adi    to det-1

                            move u-dun-oda(i)   to z-5
                            MOVE Z-5            TO DET-2
                            move u-dun-pax(i)   to z-55
                            MOVE Z-55           TO DET-3
                            move u-bugun-oda(i) to z-5
                            MOVE Z-5            TO DET-4
                            move u-bugun-pax(i) to z-55
                            MOVE Z-55           TO DET-5
                           write dokumer-rec from detay
                    end-if
              end-perform
           
****            |||||||||||||||||||||||||||||||||||||||||||||||||||||||
            initialize detay
            move "ACENTA DAGILIMI" to det-1
            move "ODA"       to det-2
            MOVE "PAX + CHILD"       TO DET-3
            move "ODA (INHOUSE)"       to det-4
            MOVE "PAX+CLHD(INH)"       TO DET-5
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            write dokumer-rec from detay
            |||||||||||||||||||||||||||||||||| |||||||||||||||||||||||
             perform varying i from 1 by 1 until i > 180
             initialize acenta-bulundu DETAY
                    if a-Kodu(i) not = SPACES then 
                            initialize acenta-rec
                            move a-kodu(i)   to  acenta-kodu
                            read acenta no  lock invalid 
                                continue 
                            end-read 
                               move acenta-adi    to det-1

                            move a-dun-oda(i)   to z-5
                            MOVE Z-5            TO DET-2
                            move a-dun-pax(i)   to z-55
                            MOVE Z-55           TO DET-3
                            move a-bugun-oda(i) to z-5
                            MOVE Z-5            TO DET-4
                            move a-bugun-pax(i) to z-55
                            MOVE Z-55           TO DET-5
                           write dokumer-rec from detay
                    end-if
              end-perform
              
            initialize detay
            move "MUSTERI TIPI DAGILIMI" to det-1
            move "ADI"       to det-2
            MOVE "ODA NO"       TO DET-3
            move "PAX+CLHD(INH)"       to det-4
            MOVE "C-IN TARIHI"       TO DET-5
            MOVE "C-OUT TARIHI"       TO DET-6
            move "Tipi"               to det-7
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            write dokumer-rec from detay  
            
            initialize konuk-rec
            move "I"    to konuk-durumu
            start konuk key not < konuk-oda invalid 
                  continue 
            not invalid 
            perform until fs-konuk = "10"
            read konuk next no lock end move "10"  to fs-konuk
            not at end
                  if konuk-durumu <> "I"   
                      exit perform 
                  end-if 
                  if konuk-vip = spaces
                     exit perform cycle 
                  end-if 
                  if konuk-vip = "N"
                      exit perform cycle 
                  end-if 
                  if konuk-fol-kodu = "E"
                     exit perform cycle 
                  end-if 

                  initialize detay  top-kisi
                  move konuk-soyadi   to det-1
                  move konuk-adi      to det-2
                  move konuk-odano    to det-3
                  compute top-kisi = konuk-buyuk + konuk-kucuk
                  move top-kisi   to det-4

                  move konuk-gel-gun to ezgun
                  move konuk-gel-ay to ezay
                  move konuk-gel-yil to ezyil
                  move etar           to det-5

                  move konuk-git-gun to ezgun
                  move konuk-git-ay to ezay
                  move konuk-git-yil to ezyil
                  move etar           to det-6


                  initialize kodlar02-rec 
                  move "v"       to kodlar02-tipi
                  move konuk-vip  to kodlar02-kodu
                  read kodlar02 no lock invalid
                       continue 
                  end-read 
                      move kodlar02-adi  to det-7

                  write dokumer-rec from detay
            end-read 
            end-perform
            end-start
              
              
            initialize detay
            move "PANSIYON TIPI DAGILIMI" to det-1
            move "ODA"                    to det-2
            MOVE "PAX"                    to det-3
            move "CLHD"                   to det-4
            MOVE "FREE"                   to det-5
            MOVE "BABY"                   to det-6
            move "A"          to det-dokumer-20(3:1)
            move 481          to det-renk1
            move "1"          to det-dokumer-20(10:1)
            write dokumer-rec from detay  
            
            perform varying i from 1 by 1 until i > 20
               initialize detay
               if pan-k(i) not = spaces   
                  initialize kodlar02-rec
                  move pan-k(i)  to kodlar02-kodu
                  move "A"       to kodlar02-tipi
                  read kodlar02 no lock invalid
                       move "Tanimsiz.." to kodlar02-adi
                  end-read
                  move kodlar02-adi      to det-1
                  move pan-o(i)          to z-5
                  move z-5               to det-2
                  move pan-p(i)          to z-55
                  move z-55              to det-3
                  move pan-c(i)          to z-5
                  move z-5               to det-4
                  move pan-f(i)          to z-55
                  move z-55              to det-5
                  move pan-b(i)          to z-55
                  move z-55              to det-6
                  write dokumer-rec from detay
               end-if
             end-perform
              
              
              
              .
*
 ileri-cast-oku-yaz.


           initialize cast-rec ileri-toplam
           move ileri-tarih-siradaki to CAST-TARIH 
           start cast key not < cast-anah invalid
                   continue
           not invalid
           perform until fs-cast = "10"
           read cast next no lock end move "10" to fs-cast
           not end
                  initialize pazar-bulundu  acenta-bulundu
                  if ileri-tarih-siradaki not = CAST-TARIH then
                        exit perform
                  end-if
           
                  move cast-rez-no to REZ-NO
                  read rez no lock invalid
                          initialize rez-rec
                  end-read
           
                  move rez-folio to konuk-folio
                  read konuk no lock invalid
                          initialize konuk-rec
                  end-read
           
           
                  if REZ-K-G-B not = "K" then
                        exit perform cycle
                  end-if
           
                  if REZ-DURUMU not = "I" then
                        exit perform cycle
                  end-if
           
                  if rez-cik-tar = cast-tarih then
                        exit perform cycle
                  end-if

                  add 1 to ileri-oda
                  add CAST-BUYUK to ileri-pax
                  add CAST-KUCUK to ileri-pax

           end-read
           end-perform
           end-start

             
     
               move ileri-tarih-siradaki(7:2) to det-6(1:2)
               move "/"              to det-6(3:1)
               move ileri-tarih-siradaki(5:2) to det-6(4:2)
               move "/"              to det-6(6:1)
               move ileri-tarih-siradaki(1:4) to det-6(7:4)

               move ileri-oda to z-5
               MOVE Z-5       TO DET-7
               compute yuzde-hesap =  ( 100 * ileri-oda ) / hazir-oda
               move yuzde-hesap  to z-5z
               string "%" delimited by size
                      z-5z delimited by size
               into det-8

               move ileri-pax to z-5
               MOVE Z-5       TO DET-9
               compute yuzde-hesap =  ( 100 * ileri-pax ) / hazir-yatak
               move yuzde-hesap  to z-5z
               string "%" delimited by size
                      z-5z delimited by size
               into det-10

               write dokumer-rec from detay
               |||||||||||||||||||||||||||||||||||||||||||||||||||||||


           

         .
* 
 bigileri-oku-basla.
          perform takvim-dunu-bul
          initialize dun-toplam-sayi bugun-toplam-sayi oda-gelirleri pazar-toplam pansiyon-toplam ulke-toplam acenta-toplam
          perform dun-cast-oku
          perform bugun-cast-oku
          perform gelist-oku
          |perform onkasa-oku
          .

*
 onkasa-oku.

       initialize onkasa-rec  
       move tarih-tasi  to onkasa-TARIH
       start onkasa key not <onkasa-anah invalid
                continue
       not invalid
       perform until fs-onkasa = "10"
       read onkasa next no lock end move "10" to fs-onkasa
       not end
               if onkasa-TARIH not = tarih-tasi then
                     exit perform
               end-if
               move onkasa-dep to DEPKOD-KODU
               read depkod no lock invalid
                       exit perform cycle
               end-read

               if depkod-tipi not = 2 then
                     exit perform cycle
               end-if

               compute hesap-gelir = ONKASA-TUTAR-TL - ONKASA-CORR-TUTAR-TL
               add hesap-gelir to bugun-oda-gelir
       end-read
       end-perform
       end-start




         .
*
 gelist-oku. 
       initialize gelist-rec 
       move dun-tarih  to gelist-TARIH
       start gelist key not <gelist-anah invalid
                continue
       not invalid
       perform until fs-gelist = "10"
       read gelist next no lock end move "10" to fs-gelist
       not end
               if gelist-TARIH not = dun-tarih then
                     exit perform
               end-if
               add gelist-oda to dun-oda-gelir 
       end-read
       end-perform
       end-start


         .
*
 dun-cast-oku.
          
        initialize cast-rec pazar-id ulke-id acenta-id
        move dun-tarih to CAST-TARIH 
        start cast key not < cast-anah invalid
                continue
        not invalid
        perform until fs-cast = "10"
        read cast next no lock end move "10" to fs-cast
        not end
               initialize pazar-bulundu ulke-bulundu acenta-bulundu
               if dun-tarih not = CAST-TARIH then
                     exit perform
               end-if

               move cast-rez-no to REZ-NO
               read rez no lock invalid
                       initialize rez-rec
               end-read

               move rez-folio to konuk-folio
               read konuk no lock invalid
                       initialize konuk-rec
                       exit perform cycle
               end-read


               if REZ-K-G-B not = "K" then
                     exit perform cycle
               end-if

               if REZ-DURUMU not = "I" then
                     exit perform cycle
               end-if

               if rez-cik-tar = cast-tarih then
                     add 1 to  dun-cikan-oda
                     add CAST-BUYUK to dun-cikan-pax
                     add CAST-KUCUK to dun-cikan-pax
                     exit perform cycle
               end-if

               if rez-gir-tar = cast-tarih then
                     add 1 to  dun-giren-oda
                     add CAST-BUYUK to dun-giren-pax
                     add CAST-KUCUK to dun-giren-pax
               end-if

               add 1 to dun-oda
               add CAST-BUYUK to dun-pax
               add CAST-KUCUK to dun-pax
               add CAST-BEBEK to dun-child
               add CAST-FREE  to dun-free


               if rez-pazar = spaces then 
                  stop " "  
               end-if
               perform varying i from 1 by 1 until i > 20
                    if p-kodu(i) = rez-pazar then
                       add 1          to p-dun-oda(i)
                       add CAST-BUYUK to p-dun-pax(i)
                       add CAST-KUCUK to p-dun-pax(i)
                       move 1 to pazar-bulundu
                    end-if
               end-perform
             
              if pazar-bulundu not = 1 then
                  add 1 to  pazar-id
                  move rez-pazar    to p-kodu(pazar-id)
                  move 1            to p-dun-oda(pazar-id)
                  add CAST-BUYUK    to p-dun-pax(pazar-id) 
                  add CAST-KUCUK    to p-dun-pax(pazar-id) 
              end-if

            |||||||||||||

 

***/*************************************************************************************

               if rez-ulke = spaces then stop " "  end-if
               perform varying i from 1 by 1 until i > 30
                    if u-kodu(i) = rez-ulke then
                       add 1          to u-dun-oda(i)
                       add CAST-BUYUK to u-dun-pax(i)
                       add CAST-KUCUK to u-dun-pax(i)
                       move 1 to ulke-bulundu
                    end-if
               end-perform
             
              if ulke-bulundu not = 1 then
                  add 1 to  ulke-id
                  move rez-ulke    to u-kodu(ulke-id)
                  move 1            to u-dun-oda(ulke-id)
                  add CAST-BUYUK    to u-dun-pax(ulke-id) 
                  add CAST-KUCUK    to u-dun-pax(ulke-id) 
              end-if


               if rez-acenta = spaces then stop " "  end-if
               perform varying i from 1 by 1 until i > 180
                    if a-kodu(i) = rez-acenta then
                       add 1          to a-dun-oda(i)
                       add CAST-BUYUK to a-dun-pax(i)
                       add CAST-KUCUK to a-dun-pax(i)
                       move 1 to acenta-bulundu
                    end-if
               end-perform
             
              if acenta-bulundu not = 1 then
                  add 1 to  acenta-id
                  move rez-acenta   to a-kodu(acenta-id)
                  move 1            to a-dun-oda(acenta-id)
                  add CAST-BUYUK    to a-dun-pax(acenta-id) 
                  add CAST-KUCUK    to a-dun-pax(acenta-id) 
              end-if

            |||||||||||||

        end-read
        end-perform
        end-start
         .
*
 bugun-cast-oku.
        initialize cast-rec pansiyon-id
        move tarih-tasi to CAST-TARIH 
        start cast key not < cast-anah invalid
                continue
        not invalid
        perform until fs-cast = "10"
        read cast next no lock end move "10" to fs-cast
        not end
               initialize pazar-bulundu pansiyon-bulundu ulke-bulundu acenta-bulundu
               if tarih-tasi not = CAST-TARIH then
                     exit perform
               end-if

               move cast-rez-no to REZ-NO 
               read rez no lock invalid
                       initialize rez-rec
               end-read

               move rez-folio to konuk-folio
               read konuk no lock invalid
                       initialize konuk-rec
               end-read
  

               if REZ-K-G-B not = "K" then
                     exit perform cycle
               end-if

               if REZ-DURUMU not = "I" then
                     exit perform cycle
               end-if

                if rez-cik-tar = cast-tarih and KONUK-DURUMU = "I" then
                     add 1 to bugun-cikacak-oda
                     add CAST-BUYUK to bugun-cikacak-pax
                     add CAST-KUCUK to bugun-cikacak-pax
               end-if


               if rez-gir-tar = cast-tarih and KONUK-folio = zeroes then
                     add 1 to bugun-girecek-oda
                     add CAST-BUYUK to bugun-girecek-pax
                     add CAST-KUCUK to bugun-girecek-pax
               end-if

              if rez-gir-tar = cast-tarih and KONUK-folio > 0 then
                       initialize kur-rec
                       move rez-banka       to kur-banka
                       move rez-doviz       to kur-doviz
                       move rez-gir-tar     to kur-tarih
                       read kur no lock invalid
                           continue
                       not invalid
                               compute fiyat-hesap rounded = cast-fiyati * doviz-alis
                               add fiyat-hesap to bugun-oda-gelir
                       end-read

              end-if

               if konuk-durumu not = "I" then
                     exit perform cycle
               end-if
               
               initialize kur-rec
               move rez-banka       to kur-banka
               move rez-doviz       to kur-doviz
               move rez-gir-tar     to kur-tarih
               read kur no lock invalid
                   continue
               not invalid
                       compute fiyat-hesap rounded = cast-fiyati * doviz-alis
                       add fiyat-hesap to bugun-oda-gelir
               end-read

              

               add 1          to bugun-oda
               add CAST-BUYUK to bugun-pax
               add CAST-KUCUK to bugun-child
               add CAST-BEBEK to bugun-bebek
               add CAST-FREE  to bugun-free


               perform varying i from 1 by 1 until i > 20      |pansiyon dagilim al
                  if pan-k(i) = rez-pan-tipi then
                     add 1           to pan-o(i)
                     add cast-buyuk  to pan-p(i)
                     add cast-kucuk  to pan-c(i)
                     add cast-free   to pan-f(i)
                     add cast-bebek  to pan-b(i)
                     move 1          to pansiyon-bulundu
                  end-if
               end-perform
             
              if pansiyon-bulundu not = 1 then
                  add 1             to pansiyon-id
                  add 1             to pan-o(pansiyon-id)
                  add cast-buyuk    to pan-p(pansiyon-id)
                  add cast-kucuk    to pan-c(pansiyon-id)
                  add cast-free     to pan-f(pansiyon-id)
                  add cast-bebek    to pan-b(pansiyon-id)
                  move rez-pan-tipi to pan-k(pansiyon-id)
              end-if

               ||||pazar kodunu toplama TURK нон 
 
               perform varying i from 1 by 1 until i > 20
                    if p-Kodu(i) = rez-pazar then
                       add 1          to p-bugun-oda(i)
                       add CAST-BUYUK to p-bugun-pax(i)
                       add CAST-KUCUK to p-bugun-pax(i)
                       move 1         to pazar-bulundu
                    end-if
               end-perform
             
              if pazar-bulundu not = 1 then
                  add 1            to pazar-id
                  |if pazar-id > 20 then exit perform cycle end-if
                  move 1            to p-bugun-oda(pazar-id)
                  add CAST-BUYUK    to p-bugun-pax(pazar-id)
                  add CAST-KUCUK    to p-bugun-pax(pazar-id)
                  move rez-pazar    to p-Kodu(pazar-id)
              end-if
********************************************************************************               
               perform varying i from 1 by 1 until i > 180
                    if a-kodu(i) = rez-acenta then
                       add 1          to a-bugun-oda(i)
                       add CAST-BUYUK to a-bugun-pax(i)
                       add CAST-KUCUK to a-bugun-pax(i)
                       move 1 to acenta-bulundu
                    end-if
               end-perform
             
              if acenta-bulundu not = 1 then
                  add 1 to  acenta-id
                  move rez-acenta   to a-kodu(acenta-id)
                  move 1            to a-bugun-oda(acenta-id)
                  add CAST-BUYUK    to a-bugun-pax(acenta-id) 
                  add CAST-KUCUK    to a-bugun-pax(acenta-id) 
              end-if
******************************************************************
               perform varying i from 1 by 1 until i > 99
                    if u-Kodu(i) = rez-ulke then
                       add 1          to u-bugun-oda(i)
                       add CAST-BUYUK to u-bugun-pax(i)
                       add CAST-KUCUK to u-bugun-pax(i)
                       move 1         to ulke-bulundu
                    end-if
               end-perform
             
              if ulke-bulundu not = 1 then
                  add 1            to ulke-id
                  |if pazar-id > 20 then exit perform cycle end-if
                  move 1            to u-bugun-oda(ulke-id)
                  add CAST-BUYUK    to u-bugun-pax(ulke-id)
                  add CAST-KUCUK    to u-bugun-pax(ulke-id)
                  move rez-ulke     to u-Kodu(ulke-id)
              end-if

            |||||||||||||

        end-read
        end-perform
        end-start

         .         

* 
 dokumer-baslik-ayarla.
          open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
              initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                         dokumer-dosya

              set  dokumer-asya-set to true
              move print-no         to dokumer-dosya-adi
              open output dokumer 
*/WINDOW TITLE
              move yil-tasi to eyil
              move ay-tasi  to eay
              move gun-tasi to egun
              move "Cep Raporu" to aciklama
              initialize dokumer-rec detay
              move "W"                    to det-dokumer-20(1:)
              move  ebaslik to det-filler
              write dokumer-rec from detay
*/ BASLIKLAR
              initialize dokumer-rec detay
              move "B"                  to det-dokumer-20(1:)
              move ebaslik to det-filler
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "B"                  to det-dokumer-20(1:)
              write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
              initialize dokumer-rec detay
              move "O"                        to det-dokumer-20(1:)
              move "E" to dokumer-oto-sayfa-basi
              move 56  to dokumer-oto-sayfa-satir
              move "|" to dokumer-detay-kolon-ayirici
              move "LRRRRRRRRRRRRRRRRRLLLLLLLLLL" to dokumer-align-occ
              move dokumer-ozellikler-rec     to det-filler
              write dokumer-rec from detay
*/ BASLIKLAR 
              initialize dokumer-rec detay
              move "D1"               to det-dokumer-20(1:)     
              move "ODA VE PAX SAYILARI"  to det-1
              move "DUN "                 to det-2
              move "% DUN "                to det-3
              move "BUGUN "               to det-4
              move "% BUGUN "              to det-5
              
              move "TARIH"                to det-6
              move "ODA"                  to det-7
              move "% DOL"                to det-8
              move "PAX+CHLD"                  to det-9
              move "% DOL"                to det-10

              move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 fil-7 fil-8 fil-9 fil-10
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "D2"               to det-dokumer-20(1:)     
              move "-"                to det-dokumer-20(5:1)
              move all "-" to det-1 det-2 det-3 det-4 det-5 det-6 det-7 det-8 det-9 det-10
              write dokumer-rec from detay
 
                       perform isleme-basla

              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              delete file dokumer
              set exit-pushed to true
         .
*
 Form1-Aft-Initdata.
       open input cast rez konuk doviz takvim gelist acenta onkasa kur depkod kodlar02 ulke
                 perform dokumer-baslik-ayarla
       close cast rez konuk takvim doviz gelist onkasa acenta depkod kur kodlar02  ulke
     .

 
