* webfiyat.evt
* webfiyat.evt is generated from D:\asya\acugt.ytl\otel\webfiyat.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     PERFORM Form1-Ev-Other
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     PERFORM grd1-Ev-Other
     .

 Form2-Event-Proc.
     .

 Form3-Event-Proc.
     .

 Form3-Gd-1-Event-Proc.
     PERFORM grd2-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Aft-Initdata.
         call "c$narg" using link-var.
       perform adresleri-tasi
       move tarih-tasi to bas-tar bit-tar
       add 1 to bit-ay
       display sc-tar1 sc-tar2 sc-tar3 sc-tar4 sc-tar5 sc-tar6
       open i-o webfiyat close webfiyat
        open input kllnc 
        move k-kodu-tasi to k-kodu
        read kllnc no lock invalid continue
          not invalid 
          move  k-ayrac-degistir to v-ayrac
         
        end-read
       
        close kllnc
        display ac-ayrac

         if link-var = 1 then 
           move link-acenta to txt-acenta-kodu
           display  sc-acenta



         end-if
        if link-var = 2 
           move link-acenta to txt-acenta-kodu

          move  lFIYATANA-ILK-TARIH to bas-tar 
          move  bas-tar to bit-tar
          if bit-ay = 12 
               move 1 to bit-tar
                add 1 to bit-yil
             else
                add 1 to bit-ay
          end-if

        
            display form1

           move 2001 to key-status 
           perform Form1-Ex-Other


       
          


        end-if

     .
*
 ham-bul.

         initialize webflog-rec  ham-fiyat
         move tWEBFIYAT-ACENTA     to webflog-acenta
           move tWEBFIYAT-TARIH      to webflog-tarih
           move twebfiyat-konum      to webflog-konum
           accept  WEBFLOG-LOG-TARIH  from century-date
           accept WEBFLOG-LOG-ZAMAN  from time 
           start webflog key < webflog-tek-log invalid 
                  move TWEBfiyat-fiyat to ham-fiyat
                   not invalid 
                   perform until fs-webflog = "10" 
                        read webflog backward no lock 
                             end 
                                move TWEBfiyat-fiyat to ham-fiyat
                                   move "10" to fs-webflog
                                    not end 
                                    if  webflog-fiyat =  TWEBfiyat-fiyat or   webflog-fiyat = 0
                                       continue
                                     else

                                        if  webflog-fiyat <  TWEBfiyat-fiyat 
                                             move TWEBfiyat-fiyat to ham-fiyat
                                             move "10" to fs-webflog
                                        end-if
                                           if  webflog-fiyat >  TWEBfiyat-fiyat 
                                             move webflog-fiyat to ham-fiyat
                                             move "10" to fs-webflog
                                        end-if
                                    end-if
                                  end-read
                       end-perform 
              end-start



                      .
                         
                      
         

*
 Form1-Ex-Other.
      evaluate key-status
       when 1
          if control-id = 6 then
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
                 on exception perform callerr-proc
                 not on exception
                 cancel "/asya/ytl/obj/otel/acenara.asy" 
              end-call
              move acenta-cagir    to txt-acenta-kodu  
              display sc-acenta
          end-if
          if control-id = 7 then
              initialize pansiyon-cagir
              move "A" to pansiyon-tipi-cagir
              call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
                    on exception perform callerr-proc
                       not on exception
                       cancel "/asya/ytl/obj/otel/panara.asy" 
               end-call
               move pansiyon-kodu-cagir     to txt-pansiyon-kodu 
               Display sc-pansiyon-kodu
          end-if
       when 2 
            open i-o twebfiyat webfiyat  webflog
                 initialize twebfiyat-rec   takas-satir
                 start twebfiyat key not < twebfiyat-anah invalid
                         continue
                 not invalid
                 perform until fs-twebfiyat = "10"
                 read twebfiyat next no lock end move "10" to fs-twebfiyat
                 not end
                          initialize webfiyat-rec
                          move twebfiyat-anah          to webfiyat-anah
                         |||||||||||||||||| *bos kayit gitmesin dataya diye konuldu 
                          read webfiyat no lock invalid
                                 if tWEBFIYAT-FIYAt = zeroes  then
                                        exit perform cycle
                                 end-if
                          not invalid
                                 if tWEBFIYAT-FIYAT = zeroes 
                                     if WEBFIYAT-FIYAT = zeroes then
                                         exit perform cycle
                                     end-if
                                 end-if
                          end-read
                         |||||||||||||||||
                          move twebfiyat-rec          to webfiyat-rec
                          accept tWEBFIYAT-ISL-TARIH  from century-date
                          accept tWEBFIYAT-ISL-ZAMAN  from time
                          move k-kodu-tasi            to WEBFIYAT-ISL-STAF 
                          perform ham-bul
                          if ham-fiyat > TWEBfiyat-fiyat
                              move   ham-fiyat  to webfiyat-ham-fiyat
                             else
                              move TWEBfiyat-fiyat to  webfiyat-ham-fiyat

                          end-if
                          write webfiyat-rec  invalid
                               rewrite webfiyat-rec  invalid
                                       stop " "
                                end-rewrite   
                          end-write
                          add 1 to takas-satir




                         ||| ****log kaydet
                         initialize webflog-rec
                         move tWEBFIYAT-ACENTA     to webflog-acenta
                         move tWEBFIYAT-TARIH      to webflog-tarih
                         move twebfiyat-konum      to webflog-konum
                         accept WEBFLOG-LOG-TARIH  from century-date
                         accept WEBFLOG-LOG-ZAMAN  from time 
                         MOVE TWEBfiyat-fiyat      to webflog-fiyat
                         move k-kodu-tasi          to WEBFLOG-LOG-STAF
                         
                         write webflog-rec invalid
                                 rewrite webflog-rec invalid
                                         continue
                                 end-rewrite
                         end-write
                         |||
                 end-read
                 end-perform
                 end-start
            close twebfiyat webfiyat webflog
            if takas-satir >= 1 then
                   display message box "Kayit Islemi Tamamlandi ! "
            end-if
                
       when 2003
              perform Acu-Form3-Routine
       when 2002
              modify grd1,reset-grid = 1
              delete file twebfiyat
              modify sc-acenta,enabled = true
              modify sc-pansiyon-kodu,enabled = true
              modify sc-tar1,enabled = true
              modify sc-tar2,enabled = true
              modify sc-tar3,enabled = true
              modify sc-tar4,enabled = true
              modify sc-tar5,enabled = true
              modify sc-tar6,enabled = true

              move 6 to control-id
              move 4 to accept-control
       when 2001
              
              open input acenta
                      initialize acenta-rec
                      move txt-acenta-kodu  to acenta-kodu
                      read acenta no lock invalid
                              display message box "Lutfen Tanimli Bir Acenta Giriniz ! ..."
                              icon 3
                              close acenta
                              move 6 to control-id
                              move 4 to accept-control
                              exit paragraph
                      end-read
              close acenta
                            
              open input takvim
                      initialize takvim-rec
                      move bas-tar to takvim-anah
                      read takvim no lock invalid
                              display message box "Tanimsiz Tarih Girdiniz ! ... "
                              icon 3
                              move 8 to control-id
                              move 4 to accept-control
                              close takvim
                              exit paragraph
                      end-read
                      initialize takvim-rec
                      move bit-tar to takvim-anah
                      read takvim no lock invalid
                              display message box "Tanimsiz Tarih Girdiniz ! ... "
                              icon 3
                              move 11 to control-id
                              move 4 to accept-control
                              close takvim
                              exit paragraph
                      end-read
              close takvim

              if bit-tar not >= bas-tar then
                              display message box "Baslangic Tarihi Bitis Tarihinden Buyuk Olamaz ! ... "
                              icon 3
                              exit paragraph 
              end-if

              modify sc-acenta,enabled = false
              modify sc-pansiyon-kodu,enabled = false
              modify sc-tar1,enabled = false
              modify sc-tar2,enabled = false
              modify sc-tar3,enabled = false
              modify sc-tar4,enabled = false
              modify sc-tar5,enabled = false
              modify sc-tar6,enabled = false

              open i-o genelfis
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  read genelfis no lock invalid
                          continue
                  not invalid
                          compute EKRAN-FIS-1 = EKRAN-FIS-1 + 1
                          rewrite genelfis-rec  invalid
                                  stop " "
                          end-rewrite
                          move EKRAN-FIS-1 to twebfiyat-no
                          move k-kodu-tasi to twebfiyat-k
                  end-read
              close genelfis

              open output twebfiyat
              close twebfiyat

              modify grd1,reset-grid = 1 , mass-update = 1 
              open input konum
                 initialize konum-rec kolon-say  
                 move 1 to kolon-say
                 start konum key not < konum-anahtar invalid
                         continue
                 not invalid
                 perform until fs-konum = "10"
                 read konum next no lock end move "10" to fs-konum
                 not end
                         if KONUM-WEBTE-SATIS <> 1 then
                               exit perform cycle
                         end-if
                         add 1 to kolon-say
                         modify grd1(1,1), cell-data = "Tarih"
                         modify grd1(1,kolon-say), cell-data = konum-adi
                         modify grd1(1,kolon-say), hidden-data = KONUM-ANAHTAR
                         move KONUM-ANAHTAR to web-konum-dizi(kolon-say - 1 )
                 end-read
                 end-perform
                 end-start
              close konum

              open input takvim webfiyat 
              open i-o twebfiyat
                 initialize takvim-rec satir-say
                 move 1 to satir-say
                 move bas-tar     to takvim-anah
                 start takvim key not < takvim-anah invalid
                         continue
                 not invalid
                 perform until fs-takvim = "10"
                 read takvim next no lock end move "10" to fs-takvim
                 not end

                         if takvim-anah > bit-tar
                               exit perform
                         end-if

                         add 1 to satir-say
                         initialize grd1-record
                         move takvim-gun to x-gun
                         move takvim-ay  to x-ay
                         move takvim-yil to x-yil
                         move x-tarih    to grd1-col0
                                     
                         perform varying i from 1 by 1 until i > 40
                                 if web-konum-dizi(i) = spaces then
                                       exit perform cycle
                                 end-if
                      
                                 initialize webfiyat-rec
                                 move txt-acenta-kodu     to webfiyat-acenta
                                 move takvim-anah         to WEBFIYAT-tarih
                                 move web-konum-dizi(i)   to WEBFIYAT-KONUM
                                 read webfiyat no lock invalid
                                         continue
                                 not invalid
                                        initialize twebfiyat-rec
                                        move webfiyat-rec to twebfiyat-rec
                                        write twebfiyat-rec  invalid
                                                stop " "
                                        end-write

                                        evaluate i
                                            when 1
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col1
                                            when 2
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col2
                                            when 3
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col3
                                            when 4
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col4
                                            when 5
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col5
                                            when 6
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col6
                                            when 7
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col7
                                            when 8
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col8
                                            when 9
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col9
                                            when 10
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col10
                                            when 11
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col11
                                            when 12
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col12
                                            when 13
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col13
                                            when 14
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col14
                                            when 15
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col15
                                            when 16
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col16
                                            when 17
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col17
                                            when 18
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col18
                                            when 19
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col19
                                            when 20
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col20
                                            when 21
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col21
                                            when 22
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col22
                                            when 23
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col23
                                            when 24
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col24
                                            when 25
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col25
                                            when 26
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col26
                                            when 27
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col27
                                            when 28
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col28
                                            when 29
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col29
                                            when 30
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col30
                                            when 31
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col31
                                            when 32
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col32
                                            when 33
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col33
                                            when 34
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col34
                                            when 35
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col35
                                            when 36
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col36
                                            when 37
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col37
                                            when 38
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col38
                                            when 39
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col39
                                            when 40
                                               move tWEBFIYAT-FIYAT to z-tutar move z-tutar to grd1-col40
                                        end-evaluate
                                 end-read
                         end-perform

                         modify grd1,record-to-add(grd1-record)
                         modify grd1(satir-say,1), hidden-data = takvim-anah

                 end-read
                 end-perform
                 end-start
              close takvim webfiyat twebfiyat

              modify grd1, mass-update = 0
      end-evaluate.
  
*
 sc-acenta-Aft-Procedure.
     open input acenta
        move txt-acenta-kodu to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz ..."    to txt-acenta-adi 
        not invalid
             move acenta-adi        to txt-acenta-adi  
             display lbl-acenta
        end-read
     close acenta
     .
*
 Form1-Ef-1a-Aft-Procedure.
       open input kodlar02
       initialize kodlar02-rec 
       move "A"              to kodlar02-tipi
       move txt-pansiyon-kodu    to kodlar02-kodu
       read kodlar02         no lock invalid 
               move "Tanimsiz ...."        to txt-pansiyon-adi
       not invalid 
               continue 
       end-read   
       close kodlar02
       move kodlar02-adi       to txt-pansiyon-adi
       display lbl-pansiyon.
*
 Form1-Ev-Other.
     
     .
*
 grd1-Ev-Other.
       evaluate event-type  
            when 16396
               modify grd1,start-x = 0 , start-y = 0  
            when msg-begin-entry
               modify grd1,start-x = 0 , start-y = 0
            when msg-finish-entry
               perform grid-deger-oku-yaz
       end-evaluate
     .

*
 grid-deger-oku-yaz.
            inquire grd1, x in sutun , y in satir
                 inquire grd1(satir,sutun), cell-data z-tutar
                 modify  grd1(satir,sutun), cell-data z-tutar
                 open i-o twebfiyat
                         initialize twebfiyat-rec
                         inquire grd1(satir,1), hidden-data tWEBFIYAT-TARIH 
                         inquire grd1(1,sutun), hidden-data tWEBFIYAT-konum
          
                         if tWEBFIYAT-konum = zeroes then
                               modify  grd1(satir,sutun), cell-data " "
                               close twebfiyat
                               exit paragraph
                         end-if

                         move txt-acenta-kodu       to twebfiyat-acenta
                         read twebfiyat no lock invalid
                               move z-tutar  to  tWEBFIYAT-FIYAT
                               write tWEBFIYAT-rec invalid
                                       stop " "
                               end-write
                         not invalid
                               move z-tutar  to  tWEBFIYAT-FIYAT
                               rewrite tWEBFIYAT-rec invalid
                                       stop " "
                               end-rewrite
                         end-read
                 close twebfiyat.                  
*
 Form1-Mn-1-MI-DegerAta-Link.
           perform Acu-Form2-Routine
         .
*
 Form2-Pb-1-Link.
  
          initialize st-x st-y  end-x end-y 
          inquire grd1,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 

          open i-o twebfiyat
          perform varying sutun from st-x by 1 until sutun > end-x
               perform varying satir from st-y by 1 until satir > end-y
                         move txt-deg-fiyat to z-tutar
                         initialize twebfiyat-rec
                         inquire grd1(satir,1), hidden-data tWEBFIYAT-TARIH 
                         inquire grd1(1,sutun), hidden-data tWEBFIYAT-konum
                         if tWEBFIYAT-konum = zeroes then
                                    exit perform cycle
                         end-if
                         move txt-acenta-kodu       to twebfiyat-acenta
                         read twebfiyat no lock invalid
                               move z-tutar  to  tWEBFIYAT-FIYAT
                               write tWEBFIYAT-rec invalid
                                       stop " "
                               end-write
                         not invalid
                               move z-tutar  to  tWEBFIYAT-FIYAT
                               rewrite tWEBFIYAT-rec invalid
                                       stop " "
                               end-rewrite
                         end-read
                         modify grd1(satir,sutun), cell-data z-tutar
               end-perform
          end-perform
         close twebfiyat
         set exit-pushed to true
     .
*
 Form1-Mn-1-MI-GridSeciliKopyala-Link.
          initialize st-x st-y  end-x end-y 
          inquire grd1,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 

          initialize secili-grid-dizi sec-sat-art sec-sut-art
          perform varying sutun from st-x by 1 until sutun > end-x
               add 1 to sec-sut-art
               initialize sec-sat-art
               perform varying satir from st-y by 1 until satir > end-y            
                         add 1 to sec-sat-art
                         inquire grd1(satir,sutun), cell-data z-tutar
                         move z-tutar      
                         to secili-grid-fiyat-dizi(sec-sat-art,sec-sut-art)
               end-perform
          end-perform

     .
*
 Form1-Mn-1-MI-GridSeciliYapýþtýr-Link.
 
          initialize st-x st-y  end-x end-y 
          inquire grd1,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y 
         
       if  st-x = 0 or st-x = 0 then
               display message box "Lutfen Gridden Veri Aktarilacak Alanlari Seciniz !."
               modify grd1,start-x = 0 , start-y = 0
               exit paragraph
       end-if

          compute satir-fark = (end-y + 1 ) - st-y 
          compute sutun-fark = (end-x + 1 ) - st-x 
        
                |SALIH
          open i-o twebfiyat
          perform varying i from 1 by 1 until i > satir-fark
               perform varying k from 1 by 1 until k > sutun-fark 
                        compute init-sutun = st-x - 1 
                        COMPUTE init-satir = st-y - 1
                        move secili-grid-fiyat-dizi(i,k) to z-tutar

                        initialize twebfiyat-rec
                        inquire grd1(init-satir + i ,1), hidden-data tWEBFIYAT-TARIH 
                        inquire grd1(1, init-sutun + k), hidden-data tWEBFIYAT-konum
                        if tWEBFIYAT-konum = zeroes then
                                  exit perform cycle
                        end-if
        
                        move txt-acenta-kodu       to twebfiyat-acenta
                        read twebfiyat no lock invalid
                             move z-tutar  to  tWEBFIYAT-FIYAT
                             write tWEBFIYAT-rec invalid
                                     stop " "
                             end-write
                        not invalid
                             move z-tutar  to  tWEBFIYAT-FIYAT
                             rewrite tWEBFIYAT-rec invalid
                                     stop " "
                             end-rewrite
                        end-read

                        modify grd1(init-satir + i , init-sutun + k) , cell-data = z-tutar
               end-perform
          end-perform
          close twebfiyat
          modify grd1,start-x = 0 , start-y = 0
     .
*
 Form1-Mn-1-MI-Yapistir-Link.
     if is-remote             
        perform clipboard-islem 
     else
        perform clipboard-islem-yerel
     end-if.
*
 clipboard-islem.
     modify grd1, mass-update = 1

     initialize buf
     call "@[DISPLAY]:C:\windows\system32\user32.dll" 
     on exception
           display message box "user32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph
     end-call.
     call "@[DISPLAY]:C:\windows\system32\kernel32.dll" on exception
           display message box "kernel32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "@[DISPLAY]:C:\windows\system32\msvcrt.dll" on exception
           display message box "msvcrt.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "@[DISPLAY]:OpenClipboard" using by value 0
          giving hwnd.

     call "@[DISPLAY]:GetClipboardData" using by value cf_text
                                        giving hglobal.

     call "@[DISPLAY]:GlobalLock" using by value hglobal
                                  returning ptr

     call "@[DISPLAY]:lstrlenA" using by value ptr 
                               returning boy.

     if boy > 0
     call "@[DISPLAY]:RtlMoveMemory" using by reference buf
                                     by value ptr
                                     by value boy
     end-call
     
             perform clip-to-grid
        end-if

     call "@[DISPLAY]:GlobalUnlock" using hglobal.
     call "@[DISPLAY]:CloseClipboard".
     cancel "@[DISPLAY]:user32.dll".
     cancel "@[DISPLAY]:kernel32.dll".
     cancel "@[DISPLAY]:msvcrt.dll".     
     modify grd1, mass-update = 0 
     .
*
 clipboard-islem-yerel.

      modify grd1, mass-update = 1
     initialize buf
     call "user32.dll" 
     on exception
           display message box "user32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph
     end-call      .
     call "kernel32.dll" on exception
           display message box "kernel32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "msvcrt.dll" on exception
           display message box "msvcrt.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "OpenClipboard" using by value 0
          giving hwnd.

     call "GetClipboardData" using by value cf_text
                                        giving hglobal.

     call "GlobalLock" using by value hglobal
                                  returning ptr

     call "lstrlenA" using by value ptr 
                               returning boy.

     if boy > 0
     call "RtlMoveMemory" using by reference buf
                                     by value ptr
                                     by value boy
     end-call
           
            perform clip-to-grid
        end-if
     call "GlobalUnlock" using hglobal.
     call "CloseClipboard".
     cancel "user32.dll".
     cancel "kernel32.dll".
     cancel "msvcrt.dll".
     modify grd1, mass-update = 0.

*
 clip-to-grid.


     initialize  satirm sutunm  konum-tasti tarih-tasti
            initialize sayac
            move 1 to sayac
            perform varying k 
                    from 1 
                    by 1 
                    until k > ust-occ                        
                         unstring buf delimited by x"0d0a"
                         into satirx(k)   pointer sayac
                          if sayac > 100000  then exit perform end-if
                         
                            add 1 to satirm
                         initialize sayac2
                         move 1 to sayac2
                         initialize sutunm
                         
                         perform varying l 
                                 from 1 
                                 by 1 
                                 until l > 40
                                  if ters-islem = 1 
                                  unstring satirx(k) delimited by x"09"
                                       into sutunx(l,k)   pointer sayac2
                                  else
                                      unstring satirx(k) delimited by x"09"
                                       into sutunx(k,l)   pointer sayac2
                                   end-if
                                        add 1 to sutunm 
                                   if sayac2 > 21000  then exit perform end-if
                                    
                         end-perform
            end-perform
            if ters-islem = 1 
              
               move satirm to buf333
               move sutunm to satirm
               move buf333 to sutunm
            end-if
          initialize st-x st-y  end-x end-y 
          inquire grd1,
                                        
                     cursor-x         in st-x
                     cursor-y         in st-y 

        
             compute    end-x = st-x    + sutunm  - 1 
          compute end-y = st-y + satirm  - 1    

          if  st-x = 0 or st-x = 0 then
               display message box "Lutfen Gridden Veri Aktarilacak Alanlari Seciniz !."
               modify grd1,start-x = 0 , start-y = 0
          else

                 
                   
                  compute satir-fark = (end-y + 1 ) - st-y 
                  compute sutun-fark = (end-x + 1 ) -  st-x 
               open i-o twebfiyat
                   initialize sec-sat-art sec-sut-art
                   perform varying m 
                           from 1 
                           by 1 
                           until m > satir-fark            
                           initialize grd1-record
                           move m     to zzz
                           move zzz   to grd1-col1
        
                         |  initialize satir-okundu
                         |  perform varying init from 1 by 1 until init > sutun-fark
                         |         if function numval(sutunx(m,init)) <> zeroes then
                         |                move 1 to satir-okundu
                         |         end-if
                         |  end-perform
        
                         |  if satir-okundu = zeroes then
                         |     exit perform cycle
                         | end-if
                        
                           initialize init-sutun
                           perform varying init from 1 by 1 until init > sutun-fark 
                                  compute init-sutun = init - 1 
                                  if v-ayrac = 1 
                                      inspect sutunx(m,init)
                                                  converting "," to x"01"
                                          inspect sutunx(m,init)
                                                  converting "." to ","
                                          inspect sutunx(m,init)
                                                  converting x"01" to "."


                                  end-if
                                  move function numval(sutunx(m,init) )to copy-fiyat

                                 


                                  move copy-fiyat to z-tutar
                                |   if copy-fiyat = zeroes then ***gerek kalmadi  
                                |        exit perform cycle
                                |  end-if
        
                                  initialize twebfiyat-rec
                                  inquire grd1(st-y + sec-sat-art,1), hidden-data tWEBFIYAT-TARIH 
                                  if tWEBFIYAT-TARIH not > "20000000" then 
                                    if tarih-tasti = 0 
                                       stop " "
                                     display message box "Kopyalanan Tarih  tasti " new-line 
                                                          "Kontrol ediniz.."
                                         move 1 to tarih-tasti
                                    end-if
                                        exit perform cycle
                                   end-if

                                  inquire grd1(1,st-x + init-sutun),   hidden-data tWEBFIYAT-konum
                                  if tWEBFIYAT-konum = zeroes then
                                      if konum-tasti = 0
                                     display message box "Kopyalanan Konum tasti " new-line 
                                                          "Kontrol ediniz.."
                                         move 1 to konum-tasti
                                    end-if
                                            exit perform cycle
                                  end-if
        
                                  move txt-acenta-kodu       to twebfiyat-acenta
                                  read twebfiyat no lock invalid
                                       move z-tutar  to  tWEBFIYAT-FIYAT
                                       write tWEBFIYAT-rec invalid
                                               stop " "
                                       end-write
                                  not invalid
                                       move z-tutar  to  tWEBFIYAT-FIYAT
                                       rewrite tWEBFIYAT-rec invalid
                                               stop " "
                                       end-rewrite
                                  end-read
        
                                  modify grd1(st-y + sec-sat-art ,st-x + init-sutun),cell-data = z-tutar
        
                           end-perform
                           add 1 to sec-sat-art
                   end-perform
                close twebfiyat
                modify grd1,start-x = 0 , start-y = 0.
  
*
 Form1-Mn-1-MI-Sil-Link.
        initialize st-x st-y  end-x end-y 
          inquire grd1,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 

          open i-o twebfiyat
          perform varying sutun from st-x by 1 until sutun > end-x
               perform varying satir from st-y by 1 until satir > end-y
                         move 0 to z-tutar
                         initialize twebfiyat-rec
                         inquire grd1(satir,1), hidden-data tWEBFIYAT-TARIH 
                         inquire grd1(1,sutun), hidden-data tWEBFIYAT-konum
                         if tWEBFIYAT-konum = zeroes then
                                    exit perform cycle
                         end-if
                         move txt-acenta-kodu       to twebfiyat-acenta
                         read twebfiyat no lock invalid
                               move z-tutar  to  tWEBFIYAT-FIYAT
                               write tWEBFIYAT-rec invalid
                                       stop " "
                               end-write
                         not invalid
                               move z-tutar  to  tWEBFIYAT-FIYAT
                               rewrite tWEBFIYAT-rec invalid
                                       stop " "
                               end-rewrite
                         end-read
                         modify grd1(satir,sutun), cell-data z-tutar
               end-perform
          end-perform
         close twebfiyat
     .
*
 Form2-Aft-Initdata.
      initialize txt-deg-fiyat
      display Form2-Ef-1
     .
*
 Form3-Aft-Initdata.

          open i-o  webflog
                 
                 modify grd2,reset-grid = 1
                 move "Tarih " to grd2-col1
                 move "Zaman"  to grd2-col2
                 move "Staf"   to grd2-col3
                 move "Izle"   to grd2-col4
                 modify grd2,record-to-add(grd2-record)

                 initialize webflog-rec e-tarih e-zaman   log-grid-say
                 move 1 to log-grid-say
                 MOVE txt-acenta-kodu TO WEBFLOG-ACENTA
                 start webflog key not < WEBFLOG-ANAH1 invalid
                         continue
                 not invalid
                 perform until fs-webflog = "10"
                 read webflog next no lock end move "10" to fs-webflog
                 not end
                         if WEBFLOG-ACENTA <> txt-acenta-kodu
                               exit perform  
                         end-if

                         if ( WEBFLOG-LOG-TARIH <> e-tarih or e-tarih = spaces ) or
                            ( webflog-log-zaman <> e-zaman or e-zaman = spaces ) then
                                 initialize grd2-record 
                                 move WEBFLOG-LOG-TARIH-YIL to x-yil
                                 move WEBFLOG-LOG-TARIH-ay  to x-ay
                                 move WEBFLOG-LOG-TARIH-gun to x-gun
                                 move x-tarih               to grd2-col1
        
                                 move webflog-log-zaman-saat   to x-saat
                                 move webflog-log-zaman-dakika to x-dakika
                                 move webflog-log-zaman-saniye to x-saniye
                                 move x-zaman                  to grd2-col2
        
                                 MOVE webflog-log-staf         to grd2-col3
  
                                 add 1 to log-grid-say
                                 modify grd2(log-grid-say,4),  bitmap = buyut-bmp
                                                               bitmap-number = 1
                                                               bitmap-width  = 16
                                                               color = 0 


                                 modify grd2,record-to-add(grd2-record)
                                 move WEBFLOG-ANAH    to link-deger
                                 modify grd2(log-grid-say,5) hidden-data = link-deger 
                         end-if

                         move WEBFLOG-LOG-TARIH to e-tarih
                         move webflog-log-zaman to e-zaman

                 end-read
                 end-perform
                 end-start
                 close webflog.
*
 grd2-Ev-Other.
       evaluate event-type
             when msg-begin-entry
                 move event-action-fail to event-action
             when msg-bitmap-Dblclick
                   initialize link-log-anah
                   inquire grd2, y in satir
                   inquire grd2(satir,5), hidden-data  =  link-log-anah
                   call "/asya/ytl/obj/otel/lwebfiyat.asy"  using link-log-anah
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/lwebfiyat.asy"
                   end-call
       end-evaluate
     .

 
