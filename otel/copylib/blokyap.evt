* blokyap.evt
* blokyap.evt is generated from D:\asya\acugt.ytl\otel\blokyap.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        EVALUATE Event-Control-Id
        WHEN 108
           PERFORM g-odatip1-Ev-Msg-Begin-Entry
        WHEN 116
           PERFORM Form1-G-1-Ev-Msg-Begin-Entry
        END-EVALUATE
     WHEN Msg-Heading-Clicked
        EVALUATE Event-Control-Id
        WHEN 108
           PERFORM g-odatip1-Ev-Msg-Heading-Clicked
        END-EVALUATE
     WHEN Msg-Goto-Cell
        EVALUATE Event-Control-Id
        WHEN 116
           PERFORM Form1-G-1-Ev-Msg-Goto-Cell
        END-EVALUATE
     WHEN Msg-Goto-Cell-Mouse
        EVALUATE Event-Control-Id
        WHEN 116
           PERFORM Form1-G-1-Ev-Msg-Goto-Cell
        END-EVALUATE
     WHEN Msg-Heading-Dblclick
        EVALUATE Event-Control-Id
        WHEN 116
           PERFORM Form1-G-1-Ev-Msg-Heading-Dblclick
        END-EVALUATE
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 108
           PERFORM g-odatip1-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 cb-otel-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM cb-otel-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 acc-07-Exception-Proc.
     PERFORM acen-f1
     .

 acc-viptipi-Exception-Proc.
     PERFORM vip-ara
     .

 accept-grup-Exception-Proc.
     PERFORM accept-grup-Ex-Other
     .

 Form1-Gd-3-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        EVALUATE Event-Control-Id
        WHEN 109
           PERFORM g-odatip2-Ev-Msg-Begin-Entry
        WHEN 110
           PERFORM g-odatip3-Ev-Msg-Begin-Entry
        END-EVALUATE
     WHEN Msg-Heading-Clicked
        EVALUATE Event-Control-Id
        WHEN 109
           PERFORM g-odatip2-Ev-Msg-Heading-Clicked
        WHEN 110
           PERFORM g-odatip3-Ev-Msg-Heading-Clicked
        END-EVALUATE
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 109
           PERFORM g-odatip2-Ev-Other
        WHEN 110
           PERFORM g-odatip3-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Pb-1a-Event-Proc.
     .

 Form1-Pb-1a-Exception-Proc.
     PERFORM form1-ex-other
     .

 Form1-G-2-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM Form1-G-2-Ev-Msg-Begin-Entry
     END-EVALUATE
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Goto-Cell
        PERFORM not-goster
     WHEN Msg-Goto-Cell-Mouse
        PERFORM not-goster
     WHEN Msg-Heading-Dblclick
        PERFORM startla
     WHEN Other
        PERFORM Form1-Gd-1-Ev-Other
     END-EVALUATE
     .

 Form1-Gd-1-Exception-Proc.
     PERFORM Form1-Gd-1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    move tarih-tasi to tarih bit-tar.
    open i-o castdev close castdev
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
     open i-o odalar2 close odalar2.
       open input odalar2.
*
 Form1-Pb-1-Aft-Procedure.
*                  perform takasla
         .
*
 Form1-Aft-Initdata.
    if onkpara-referans-var = 1 then
       modify cb-otel reset-list = 1 
       if hangi-ref-secildi not > 0
          move "0->Tum Komplex" to   ref-ekle
          modify cb-otel item-to-add ref-ekle
       end-if 
       perform varying ref from 1 by 1 until ref > max-ref
            if hangi-ref-secildi > 0
               if hangi-ref-secildi not = ref
                   exit perform cycle 
               end-if 
            end-if 
         move ref to ref-ekle
         move "->" to  ref-ekle(2:2)
         move ref-adi(ref) to  ref-ekle(4:)
         modify cb-otel item-to-add ref-ekle
       end-perform 
    end-if
    move "0->Tum Komplex" to  oda-ref
      if hangi-ref-secildi > 0
            move hangi-ref-secildi   to oda-ref       
      end-if 
    display cb-otel
    
     open input konum
     perform konumlar-oku.
     perform tum-yaz
    move tarih-tasi to tarih bit-tar.
    move "G" to rap-sir.
**    move "H" to rez-vip-combo-value
    display com-01 .
    perform 
    move 1 to konum-anahtar
    read konum no lock invalid 
                continue
    not invalid
       move 1         to oda1-vis
       move konum-adi to oda1-title
    end-read

    move 2 to konum-anahtar
    read konum no lock
     invalid continue 
     not invalid
     move 1 to oda2-vis
     move konum-adi to oda2-title
    end-read
    move 3 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda3-vis
     move konum-adi to oda3-title
    end-read
    move 4 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda4-vis
     move konum-adi to oda4-title
    end-read
    move 5 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda5-vis
     move konum-adi to oda5-title
    end-read
    move 6 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda6-vis
     move konum-adi to oda6-title
    end-read
    move 7 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda7-vis
     move konum-adi to oda7-title
    end-read
    move 8 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda8-vis
     move konum-adi to oda8-title
    end-read
    move 9 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda9-vis
     move konum-adi to oda9-title
    end-read
    move 10 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda10-vis
     move konum-adi to oda10-title
    end-read
    move 11 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda11-vis
     move konum-adi to oda11-title
    end-read
    move 12 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda12-vis
     move konum-adi to oda12-title
    end-read
    move 13 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda13-vis
     move konum-adi to oda13-title
    end-read
    move 14 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda14-vis
     move konum-adi to oda14-title
    end-read
    move 15 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda15-vis
     move konum-adi to oda15-title
    end-read
    move 16 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda16-vis
     move konum-adi to oda16-title
    end-read
    move 17 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda17-vis
     move konum-adi to oda17-title
    end-read
    move 18 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda18-vis
     move konum-adi to oda18-title
    end-read
    move 19 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda19-vis
     move konum-adi to oda19-title
    end-read
    move 20 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda20-vis
     move konum-adi to oda20-title
    end-read
    move 21 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda21-vis
     move konum-adi to oda21-title
    end-read
    move 21 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda21-vis
     move konum-adi to oda21-title
    end-read
    move 22 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda22-vis
     move konum-adi to oda22-title
    end-read
    move 23 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda23-vis
     move konum-adi to oda23-title
    end-read
    move 24 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda24-vis
     move konum-adi to oda24-title
    end-read
    move 25 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda25-vis
     move konum-adi to oda25-title
    end-read
    move 26 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda26-vis
     move konum-adi to oda26-title
    end-read
    move 27 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda27-vis
     move konum-adi to oda27-title
    end-read
    move 28 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda28-vis
     move konum-adi to oda28-title
    end-read
    move 29 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda29-vis
     move konum-adi to oda29-title
    end-read
    move 30 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda30-vis
     move konum-adi to oda30-title
    end-read
    move 31 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda31-vis
     move konum-adi to oda31-title
    end-read
    move 32 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda32-vis
     move konum-adi to oda32-title
    end-read
    move 33 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda33-vis
     move konum-adi to oda33-title
    end-read
    move 34 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda34-vis
     move konum-adi to oda34-title
    end-read
    move 35 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda35-vis
     move konum-adi to oda35-title
    end-read
    move 36 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda36-vis
     move konum-adi to oda36-title
    end-read
    move 37 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda37-vis
     move konum-adi to oda37-title
    end-read
    move 38 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda38-vis
     move konum-adi to oda38-title
    end-read
    move 39 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda39-vis
     move konum-adi to oda39-title
    end-read
    move 40 to konum-anahtar
    read konum no lock
     invalid continue
     not invalid
     move 1 to oda40-vis
     move konum-adi to oda40-title
    end-read
    
    exit perform
    end-perform    
    if hangi-ref-secildi > 0
       initialize konum-rec
       start konum key not < konum-anahtar invalid
             continue 
       not invalid 
       perform with test after until fs-konum = "10"
       read konum next no lock end move "10"  to fs-konum
       not at end
              initialize vis-var
              if konum-ref = hangi-ref-secildi 
                 move 1   to vis-var
              else
                 move 0   to vis-var                 
              end-if 
              evaluate konum-anahtar
              when 1
                move vis-var to oda1-vis                  
              when 2
                move vis-var to oda2-vis                  
              when 3
                move vis-var to oda3-vis                  
              when 4
                move vis-var to oda4-vis                  
              when 5
                move vis-var to oda5-vis                  
              when 6
                move vis-var to oda6-vis                  
              when 7
                move vis-var to oda7-vis                  
              when 8
                move vis-var to oda8-vis                  
              when 9
                move vis-var to oda9-vis                  
              when 10
                move vis-var to oda10-vis                  
              when 11
                move vis-var to oda11-vis                  
              when 12
                move vis-var to oda12-vis                  
              when 13
                move vis-var to oda13-vis                  
              when 14
                move vis-var to oda14-vis                  
              when 15
                move vis-var to oda15-vis                  
              when 16
                move vis-var to oda16-vis                  
              when 17
                move vis-var to oda17-vis                  
              when 18
                move vis-var to oda18-vis                  
              when 19
                move vis-var to oda19-vis                  
              when 20
                move vis-var to oda20-vis                  
              when 21
                move vis-var to oda21-vis                  
              when 22
                move vis-var to oda22-vis                  
              when 23
                move vis-var to oda23-vis                  
              when 24
                move vis-var to oda24-vis                  
              when 25
                move vis-var to oda25-vis                  
              when 26
                move vis-var to oda26-vis                  
              when 27
                move vis-var to oda27-vis                  
              when 28
                move vis-var to oda28-vis                  
              when 29
                move vis-var to oda29-vis                  
              when 30
                move vis-var to oda30-vis                  
              when 31
                move vis-var to oda31-vis                  
              when 32
                move vis-var to oda32-vis                  
              when 33
                move vis-var to oda33-vis                  
              when 34
                move vis-var to oda34-vis                  
              when 35
                move vis-var to oda35-vis                  
              when 36
                move vis-var to oda36-vis                  
              when 37
                move vis-var to oda37-vis                  
              when 38
                move vis-var to oda38-vis                  
              when 39
                move vis-var to oda39-vis                  
              when 40
                move vis-var to oda40-vis                  
              end-evaluate 
       end-read 
       end-perform
       end-start
    end-if 
    display  form1-cb-1 form1-cb-2 form1-cb-3 form1-cb-4 
    form1-cb-5 form1-cb-6 form1-cb-7 form1-cb-8 form1-cb-9   form1-cb-10
    form1-cb-11 form1-cb-12 form1-cb-13 form1-cb-14  form1-cb-15 form1-cb-16 form1-cb-17 form1-cb-18 form1-cb-19 form1-cb-20 
    form1-cb-21 form1-cb-22 form1-cb-23 form1-cb-24  form1-cb-25 form1-cb-26 form1-cb-27 form1-cb-28 form1-cb-29 form1-cb-30 
    form1-cb-31 form1-cb-32 form1-cb-33 form1-cb-34  form1-cb-35 form1-cb-36 form1-cb-37 form1-cb-38 form1-cb-39 form1-cb-40 
    close konum.
        
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
        perform takasla.
*
* 
 cb-otel-ex-ntf-selchange.
      perform varying i from 1 by 1 until max-konum < i
          if function numval(oda-ref(1:1)) > 0 and function numval(oda-ref(1:1)) not = xkonum-ref(i)
             move 0 to def-val
          else
             move 1 to def-val
          end-if
          evaluate i
                  when 1     move def-val to oda1-value
                  when 2     move def-val to oda2-value
                  when 3     move def-val to oda3-value
                  when 4     move def-val to oda4-value
                  when 5     move def-val to oda5-value
                  when 6     move def-val to oda6-value
                  when 7     move def-val to oda7-value
                  when 8     move def-val to oda8-value
                  when 9     move def-val to oda9-value
                  when 10    move def-val to oda10-value
                  when 11    move def-val to oda11-value
                  when 12    move def-val to oda12-value
                  when 13    move def-val to oda13-value
                  when 14    move def-val to oda14-value
                  when 15    move def-val to oda15-value
                  when 16    move def-val to oda16-value
                  when 17    move def-val to oda17-value
                  when 18    move def-val to oda18-value
                  when 19    move def-val to oda19-value
                  when 20    move def-val to oda20-value
                  when 21    move def-val to oda21-value
                  when 22    move def-val to oda22-value
                  when 23    move def-val to oda23-value
                  when 24    move def-val to oda24-value
                  when 25    move def-val to oda25-value
                  when 26    move def-val to oda26-value
                  when 27    move def-val to oda27-value
                  when 28    move def-val to oda28-value
                  when 29    move def-val to oda29-value
                  when 30    move def-val to oda30-value
                  when 31    move def-val to oda31-value
                  when 32    move def-val to oda32-value
                  when 33    move def-val to oda33-value
                  when 34    move def-val to oda34-value
                  when 35    move def-val to oda35-value
                  when 36    move def-val to oda36-value
                  when 37    move def-val to oda37-value
                  when 38    move def-val to oda38-value
                  when 39    move def-val to oda39-value
                  when 40    move def-val to oda40-value
  
          end-evaluate
      end-perform 

       perform takasla


        display  form1-cb-1 form1-cb-2 form1-cb-3 form1-cb-4 
    form1-cb-5 form1-cb-6 form1-cb-7 form1-cb-8 form1-cb-9   form1-cb-10
    form1-cb-11 form1-cb-12 form1-cb-13 form1-cb-14  form1-cb-15 form1-cb-16 form1-cb-17 form1-cb-18 form1-cb-19 form1-cb-20 
    form1-cb-21 form1-cb-22 form1-cb-23 form1-cb-24  form1-cb-25 form1-cb-26 form1-cb-27 form1-cb-28 form1-cb-29 form1-cb-30 
    form1-cb-31 form1-cb-32 form1-cb-33 form1-cb-34  form1-cb-35 form1-cb-36 form1-cb-37 form1-cb-38 form1-cb-39 form1-cb-40 
 
 
 
 
 
         .
 takas-yaz.
     open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
    close genelfis
    move print-no to takas-fis-no
    move k-kodu-tasi to takas-k
    open output takas
    close takas
    open i-o takas
    initialize rez-rec.   
    open input acenta rez konum kodlar02 odalar yanrez rezodablok.
    move "I" to rez-durumu.
    evaluate rap-sir
      when "G"
        move tarih to rez-gir-tar
        start rez key not < rez-gir  
          invalid close acenta rez konum kodlar02 yanrez odalar takas exit paragraph, 
        end-start
      when "C"
        move tarih to rez-cik-tar
        start rez key not < rez-cik  
          invalid close acenta rez yanrez konum kodlar02 odalar TAKAS exit paragraph, 
        end-start
    end-evaluate.
    

    perform with test after until fs-rez = "10"
      read rez next no lock end move "10" to fs-rez
        not end,
         
          if (rap-sir = "G" and rez-gir-tar < tarih) or
             (rap-sir = "G" and rez-gir-tar > bit-tar) 
             exit perform  
          end-if                         
          if (rap-sir = "C" and rez-cik-tar > tarih)
             exit perform 
          end-if                         
          if grup-no not = spaces and zeroes and grup-no not = rez-grup-no
             exit perform cycle
          end-if                         
          if acn-kod not = spaces and acn-kod not = rez-acenta
             exit perform cycle
          end-if                         
          if rez-k-g-b  not = "K" 
             exit perform cycle
          end-if
          if rez-vip not = rez-vip-combo-value and
             rez-vip-combo-value not = spaces
                exit perform cycle 
          end-if
*          evaluate true
*          when rez-vip not = rez-vip-combo-value(1:1) and 
*               (rez-vip-combo-value(1:1) not = "H" and
*                rez-vip-combo-value(1:1) not = "Z")
*                   exit perform cycle
*          when rez-vip = "N" and 
*               rez-vip-combo-value(1:1) = "Z" 
*               exit perform cycle
*         end-evaluate

          if rez-odano not = spaces and 
             blokajli-odalar-ciksin = 0
               exit perform cycle
          end-if
          if oda1-value = 0 and rez-oda-konumu = 1  
             exit perform cycle
          end-if                         
          if oda2-value = 0 and rez-oda-konumu = 2  
             exit perform cycle
          end-if                         
          if oda3-value = 0 and rez-oda-konumu = 3  
             exit perform cycle
          end-if                         
          if oda4-value = 0 and rez-oda-konumu = 4  
             exit perform cycle
          end-if                         
          if oda5-value = 0 and rez-oda-konumu = 5  
             exit perform cycle
          end-if                         
          if oda6-value = 0 and rez-oda-konumu = 6  
             exit perform cycle
          end-if                         
          if oda7-value = 0 and rez-oda-konumu = 7  
             exit perform cycle
          end-if                          
          if oda8-value = 0 and rez-oda-konumu = 8  
             exit perform cycle
          end-if                         
          if oda9-value = 0 and rez-oda-konumu = 9  
             exit perform cycle
          end-if 
          if oda10-value = 0 and rez-oda-konumu = 10 
             exit perform cycle
          end-if 
           if oda11-value = 0 and rez-oda-konumu = 11  
             exit perform cycle
          end-if                         
          if oda12-value = 0 and rez-oda-konumu = 12  
             exit perform cycle
          end-if                         
          if oda13-value = 0 and rez-oda-konumu = 13  
             exit perform cycle
          end-if                         
          if oda14-value = 0 and rez-oda-konumu = 14  
             exit perform cycle
          end-if                         
          if oda15-value = 0 and rez-oda-konumu = 15  
             exit perform cycle
          end-if                         
          if oda16-value = 0 and rez-oda-konumu = 16  
             exit perform cycle
          end-if                         
          if oda17-value = 0 and rez-oda-konumu = 17  
             exit perform cycle
          end-if                          
          if oda18-value = 0 and rez-oda-konumu = 18  
             exit perform cycle
          end-if                         
          if oda19-value = 0 and rez-oda-konumu = 19  
             exit perform cycle
          end-if  
           if oda20-value = 0 and rez-oda-konumu = 20  
             exit perform cycle
          end-if  
           if oda21-value = 0 and rez-oda-konumu = 21  
             exit perform cycle
          end-if  
           if oda22-value = 0 and rez-oda-konumu = 22  
             exit perform cycle
          end-if  
           if oda23-value = 0 and rez-oda-konumu = 23  
             exit perform cycle
          end-if  
           if oda24-value = 0 and rez-oda-konumu = 24  
             exit perform cycle
          end-if  
           if oda25-value = 0 and rez-oda-konumu = 25  
             exit perform cycle
          end-if  
           if oda26-value = 0 and rez-oda-konumu = 26  
             exit perform cycle
          end-if  
           if oda27-value = 0 and rez-oda-konumu = 27  
             exit perform cycle
          end-if  
           if oda28-value = 0 and rez-oda-konumu = 28  
             exit perform cycle
          end-if  
           if oda29-value = 0 and rez-oda-konumu = 29  
             exit perform cycle
          end-if  
           if oda30-value = 0 and rez-oda-konumu = 30  
             exit perform cycle
          end-if  
           if oda31-value = 0 and rez-oda-konumu = 31  
             exit perform cycle
          end-if  
           if oda32-value = 0 and rez-oda-konumu = 32  
             exit perform cycle
          end-if  
          if oda33-value = 0 and rez-oda-konumu = 33  
             exit perform cycle
          end-if 
          if oda34-value = 0 and rez-oda-konumu = 34  
             exit perform cycle
          end-if    
          if oda35-value = 0 and rez-oda-konumu = 35  
             exit perform cycle
          end-if    
          if oda36-value = 0 and rez-oda-konumu = 36  
             exit perform cycle
          end-if    
          if oda37-value = 0 and rez-oda-konumu = 37  
             exit perform cycle
          end-if    
          if oda38-value = 0 and rez-oda-konumu = 38  
             exit perform cycle
          end-if    
          if oda39-value = 0 and rez-oda-konumu = 39  
             exit perform cycle
          end-if    
          if oda40-value = 0 and rez-oda-konumu = 40  
             exit perform cycle
          end-if    
          if hangi-ref-secildi > 0
              initialize konum-rec 
              move rez-oda-konumu  to konum-anahtar
              read konum no lock invalid    
                    exit perform cycle 
              not invalid 
                   if konum-ref <> hangi-ref-secildi
                       exit perform cycle 
                   end-if 
              end-read 
          end-if 

*          if rez-gir-tar not = tarih exit perform cycle, end-if                         
          initialize takas-rec
          if (rez-c-in not = "E") and | (not (rez-blok-tip = 1 or 2)) ) and
             (rez-durumu = "I")  then 
              move rez-blok-tip      to takas-blok-tip
              move rez-no           to takas-no
              move rez-adi          to takas-adi
              move rez-soyadi       to takas-soyadi
              move rez-gir-yil      to takas-gir-yil 
              move rez-gir-ay       to takas-gir-ay 
              move rez-gir-gun      to takas-gir-gun 
              move rez-cik-yil      to takas-cik-yil 
              move rez-cik-ay       to takas-cik-ay 
              move rez-cik-gun      to takas-cik-gun
              if rez-gel-zaman <> spaces
                   move rez-gel-zaman    to takas-gel-zaman
              else
                   move 0000             to takas-gel-zaman 
              end-if
             
              move rez-vip          to takas-vip
              move rez-acenta       to takas-acenta

              initialize acenta-rec
              move takas-acenta     to acenta-kodu
              read acenta no lock invalid 
                   continue 
              not invalid 
                   move acenta-adi   to takas-acenta-adi
              end-read 
              move rez-voucher      to takas-voucher
              move rez-oda-konumu   to takas-oda-konumu
              move rez-fiyat-konumu to takas-fiyat-konumu
******* ***********************************************
              initialize konum-rec
              move rez-oda-konumu to  konum-anahtar
              read konum no lock invalid
                      initialize konum-adi
              end-read
              move konum-adi      to takas-oda-konumu-detay
              initialize konum-rec
              move rez-fiyat-konumu to  konum-anahtar
              read konum no lock invalid
                      initialize konum-adi
              end-read
              move konum-adi      to takas-fiyat-konumu-detay


              initialize odalar-rec
              move REZ-odano    to odalar-anah
              read odalar no lock invalid
                  continue
              not invalid
                    initialize kodlar02-rec
                    move "C" to kodlar02-tipi
                    move house-durumu to kodlar02-kodu
                    read kodlar02 no lock invalid 
                        move all spaces to gd-1-col-9-9
                     not invalid
                        move kodlar02-adi to takas-HOUSE-DURUM-DETAY
                    end-read
              end-read 

              initialize kodlar02-rec         
              move rez-oda-tipi     to kodlar02-kodu
              move "G"               to kodlar02-tipi
              read kodlar02 no lock invalid
                   move spaces to kodlar02-adi
              end-read
              move kodlar02-adi      to  takas-TIP1-DETAY

              initialize kodlar02-rec         
              move rez-oda-tipi2     to kodlar02-kodu
              move "G"               to kodlar02-tipi
              read kodlar02 no lock invalid
                   move spaces to kodlar02-adi
              end-read
              move kodlar02-adi      to  takas-TIP2-DETAY
*******************salih*******************************
              move rez-odano        to takas-odano
              move rez-buyuk        to takas-buyuk
              move rez-kucuk        to takas-kucuk
              move rez-free         to takas-free
              move rez-bebek        to takas-bebek
              move rez-not1         to takas-not1
              move rez-not2         to takas-not2
              move rez-title        to takas-title 
              move rez-gr-olabilir  to takas-gr-olabilir 
              move rez-fiyati       to takas-fiyat
              move rez-sharenum     to takas-sharenum
              move rez-oda-tipi     to takas-oda-tip1
              move rez-oda-tipi2     to takas-oda-tip2 
              move rez-oda-tipi3     to takas-oda-tip3


              
                   initialize kodlar02-rec
                   move "v"      to kodlar02-tipi
                   move rez-vip  to kodlar02-kodu
                   read kodlar02 no lock invalid
                       initialize kodlar02-rec
                   end-read
                   move kodlar02-adi to takas-vip-durum
        

              
              initialize rezodablok-rec
              move rez-odano   to rezodablok-odano
              move rez-no      to rezodablok-rezno
              read rezodablok no lock invalid 
                     continue
              not invalid
                if rezodablok-qtar > "19000000"  then 
                 if  odalar-durumu = house-ok or house-bt
                       move 1  to takas-anahtar-hazir-renk 
                 else
                       move 1  to takas-anahtar-bekle-renk 
                 end-if
               end-if 
              end-read

              initialize yanrez-rec 
              move rez-no   to yanrez-rezno
              move 2        to yanrez-sirano 
              read yanrez no lock invalid 
                  continue 
              not invalid 
                   move yanrez-adi   to takas-yan-adi
                   move yanrez-soyadi   to takas-yan-soyadi

              end-read 
                if rez-sharenum <  0 
                   move 0 to  takas-sharenum
                 end-if
              move rez-share        to takas-share
         
              write takas-rec invalid 
                   display message box "Ayni rezervasyon cift -" takas-no
              end-write
          end-if
      end-read
    end-perform.
    close rez konum kodlar02 odalar yanrez acenta rezodablok .
    close takas .
    
 acen-f1.
     if key-status = 01 
        if control-id = 12
            initialize acenta-cagir
            call "/asya/ytl/obj/otel/acenara.asy" 
                 using acenta-cagir  
                 on exception 
                    perform callerr-proc
                 not on exception
                    if acenta-cagir <> spaces
                       move acenta-cagir to acn-kod
                       display acc-07
                    end-if
            end-call
            perform acc-07-Aft-Procedure
            move 4 to accept-control
            move 4 to control-id
         end-if
         if control-id = 6 
            move k-kodu-tasi to   rezgrup2-dosya-kllnc
            open i-o genelfis
            move 1 to genelfis-anahtar
            read genelfis no lock invalid
                   move 1 to ekran-fis-1
            end-read
              add 1 to ekran-fis-1
              rewrite genelfis-rec invalid
                 write genelfis-rec end-write
              end-rewrite
            close genelfis
    
            move ekran-fis-1(2:) to    rezgrup2-dosya-no
          
            inspect rezgrup2-dosya replacing all spaces by "1"
            open input rez
            perform rezgrup2-olustur
            close rez
            perform rezgrup-ara
         end-if
      end-if.

 startla.
      
       initialize takas-rec   
       open input takas
       move event-data-1 to col-no
       if col-no = 12 or col-no = 19
          close takas
          exit paragraph 
       end-if 
       evaluate col-no
          when 1
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-anah invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-anah invalid continue end-start
            end-if
          when 2
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-adi-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-adi-key invalid continue end-start
            end-if
            when 3
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-soyadi-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-soyadi-key invalid continue end-start
            end-if
            when 4
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-gir-tar-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-gir-tar-key invalid continue end-start
            end-if
            when 5
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-gel-zaman-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-gel-zaman-key invalid continue end-start
            end-if
                                          
            when 6
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-cik-tar-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-cik-tar-key invalid continue end-start
            end-if
            
            when 7
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-acenta-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-acenta-key invalid continue end-start
            end-if
            when 8
            if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-voucher-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-voucher-key invalid continue end-start
            end-if
             when 9
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-oda-konumu-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-oda-konumu-key invalid continue end-start
            end-if
            
             when 10
              if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-odano-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-odano-key invalid continue end-start
            end-if
             when 11
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-fiyat-konumu-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-fiyat-konumu-key invalid continue end-start
            end-if
             when 13
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-buyuk-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-buyuk-key invalid continue end-start
            end-if
            when 14
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-kucuk-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-kucuk-key invalid continue end-start
            end-if
            
             when 15
              if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-free-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-free-key invalid continue end-start
            end-if
            when 16
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-bebek-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-bebek-key invalid continue end-start
            end-if
             when 17
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-not1-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-not1-key invalid continue end-start
            end-if
            when 18
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < takas-not2-key invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < takas-not2-key invalid continue end-start
            end-if
            when 20
             if sira(col-no) not = "x"
              move "x"  to     sira(col-no)
              initialize takas-rec   
              start takas key not < TAKAS-fiyat-KEY invalid continue end-start
            else 
              move " "  to     sira(col-no)
              move high-values to takas-rec
              start takas key  < TAKAS-fiyat-KEY invalid continue end-start
            end-if
            when 23
            when 24
               continue 
                      
           when other 
             display message box col-no
        end-evaluate.
        perform grid-goster.
             
 takas-start.
       
       initialize takas-rec 
    
       open input takas
        move 1 to col-no
        move "x" to sira(1)
        start takas key not < takas-gel-zaman-key  
          invalid 
             continue
        end-start.
* 
 alt-toplam-goster.

          move trez-blokaj-var to z4
           if trez-blokaj-var not = zeroes then
               move z4 to lbl-blok-var
          else
               move 0               to lbl-blok-var
          end-if 


          move trez-blokaj-yok to z4

           if trez-blokaj-yok not = zeroes then
               move z4 to lbl-blok-YOK
          else
               move 0               to lbl-blok-YOK
          end-if 
 
          compute trez-toplam = trez-blokaj-yok + trez-blokaj-var
          move trez-toplam    to z4
          if trez-toplam not = zeroes then
               move z4              to lbl-toplam
          else
               move 0               to lbl-toplam
          end-if 

          move oda-temiz     to z4
          if oda-temiz not = zeroes then
               move z4 to lbl-bos
          else
               move 0           to lbl-bos
          end-if 

          move oda-kirli        to z4
          if oda-kirli not = zeroes then
               move z4 to lbl-kirli
          else
               move 0           to lbl-kirli
          end-if 

          move oda-cout      to z4
          if oda-cout not = zeroes then
               move z4  to lbl-cout
          else
               move 0           to lbl-cout
          end-if 

          move oda-arizali   to z4
          if oda-arizali not = zeroes then
               move z4  to lbl-ariza
          else
               move 0           to lbl-ariza
          end-if 

          move oda-arizali   to z4
          if oda-arizali not = zeroes then
               move z4  to lbl-ariza
          else
               move 0           to lbl-ariza
          end-if 

          move oda-dkirli   to z4
          if oda-dkirli not = zeroes then
               move z4  to lbl-dkirli
          else
               move 0           to lbl-dkirli
          end-if 

          move oda-toplam   to z4
          if oda-toplam not = zeroes then
               move z4          to lbl-ytoplam
          else
               move 0           to lbl-ytoplam
          end-if 

          display sc-bos sc-kirli sc-cout sc-ariza sc-dkirli   
          sc-blokajli sc-blokajsiz sc-toplam sc-ytoplam 
         .
 grid-goster.
    initialize trez-alt-toplam
    modify form1-gd-1, reset-grid  = 1 mass-update = 0.
    move "Rez.No."    to gd-1-col-1
    move "Adi"        to gd-1-col-2
    move "Soyadi"     to gd-1-col-3
    move "Giris"      to gd-1-col-4
    move "Saat"       to gd-1-col-16
    move "Cikis"      to gd-1-col-5
    move "Acenta "    to gd-1-col-6
    move "Voucher"    to gd-1-col-7
    move "Konum"      to gd-1-col-8
    move "Oda   "     to gd-1-col-9   
    move "F.Konumu"   to gd-1-col-17
    move "Oda Durumu" to gd-1-col-9-9
    move "P "     to gd-1-col-10
    move "C"     to gd-1-col-11
    move "F "     to gd-1-col-12
    move "B"     to gd-1-col-121
    move "Not -1  "   to gd-1-col-13
    move "Not -2  "   to gd-1-col-14
    move "Title   "   to gd-1-col-18
    move "Vip Durumu"      to gd-1-col-26
    move "Fiyat"      to gd-1-col-19
    move "Tip1"      to gd-1-col-22
    move "Tip2"      to gd-1-col-23
    move "Y.Adi"     to gd-1-col-24
    move "Y.Soyadi"   to gd-1-col-25
    move 2 to kay-say
    if col-no < 1 or col-no >20 then move 1 to  col-no end-if 
    modify form1-gd-1,record-to-add(form1-gd-1-record)

     initialize form1-gd-1-record
     move "."               to  Gd-1-Col-1   
     move grid-occ(2)       to  Gd-1-Col-2   
     move grid-occ(3)       to  Gd-1-Col-3   
     move grid-occ(4)       to  Gd-1-Col-4   
     move grid-occ(5)       to  Gd-1-Col-16  
     move grid-occ(6)       to  Gd-1-Col-5   
     move grid-occ(7)       to  Gd-1-Col-6   
     move grid-occ(8)       to  Gd-1-Col-7   
     move grid-occ(9)       to  Gd-1-Col-8   
     move grid-occ(10)      to  Gd-1-Col-9   
     move grid-occ(11)      to  Gd-1-Col-17  
     move grid-occ(12)      to  Gd-1-Col-9-9 
     move grid-occ(13)      to  Gd-1-Col-10  
     move grid-occ(14)      to  Gd-1-Col-11  
     move grid-occ(15)      to  Gd-1-Col-12  
     move grid-occ(16)      to  Gd-1-Col-121 
     move grid-occ(17)      to  Gd-1-Col-13  
     move grid-occ(18)      to  Gd-1-Col-14  
     move grid-occ(19)      to  Gd-1-Col-18 
     move grid-occ(26)      to  Gd-1-Col-26
 
     move grid-occ(22)      to  Gd-1-Col-22
     move grid-occ(23)      to  Gd-1-Col-23 
     move grid-occ(24)      to  Gd-1-Col-24 
     move grid-occ(25)      to  Gd-1-Col-25 
               
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
     modify form1-gd-1(2),
            row-color = 480
             
             
    open input acenta konum kodlar02 odalar  
    if fs-takas not = "23" then 
    perform with test after until fs-TAKAS = "10"
      if sira(col-no) not = "x"
      read takas previous no lock end move "10" to fs-takas
         not end,
            perform tek-satir
      end-read
      else 
       read takas next no lock end move "10" to fs-takas
         not end,
            perform tek-satir
      end-read
      end-if
    end-perform
    end-if.
    close acenta takas konum kodlar02   odalar  .
    modify form1-gd-1, mass-update = 0.
 tek-satir.
        if share-ciksin  = 0 and takas-share = 1 then 
          exit paragraph
       end-if
          initialize form1-gd-1-record          
            add 1 to kay-say  
             move takas-no       to gd-1-col-1
              move takas-adi     to gd-1-col-2
              move takas-soyadi  to gd-1-col-3
              move takas-gir-yil to yil-x 
              move takas-gir-ay  to ay-x 
              move takas-gir-gun to gun-x 
              move tarih-x       to gd-1-col-4
              move takas-cik-yil to yil-x 
              move takas-cik-ay  to ay-x 
              move takas-cik-gun to gun-x 
              move tarih-x       to gd-1-col-5
     initialize kodlar02-rec         
    move takas-oda-tip1    to kodlar02-kodu
    move "G"               to kodlar02-tipi
    read kodlar02 no lock invalid
         move spaces to kodlar02-adi
    end-read
    move kodlar02-adi      to  gd-1-col-22
  

    initialize kodlar02-rec
    move "H"               to kodlar02-tipi
    move takas-oda-tip2   to kodlar02-kodu
    read kodlar02 no lock invalid
         initialize kodlar02-rec
    end-read
    move kodlar02-adi      to gd-1-col-23

    move takas-yan-adi    to gd-1-col-24
    move takas-yan-soyadi    to gd-1-col-25

              move takas-acenta  to acenta-kodu 
              read acenta no lock 
                  invalid 
                    move all "*" to acenta-adi
              end-read
             
              move acenta-adi to gd-1-col-6(1:)
              move takas-voucher to gd-1-col-7
              move takas-oda-konumu to konum-anahtar
              
              read konum no lock invalid
                   move "Tanimsiz" to konum-adi
              end-read

              move konum-adi      to gd-1-col-8(1:)
              move takas-odano    to gd-1-col-9   | aþaðýda var
             

              initialize odalar-rec
              move takas-odano    to odalar-anah
              read odalar no lock invalid
                  continue
              not invalid
                    initialize kodlar02-rec
                    
                    move "C" to kodlar02-tipi
                    move house-durumu to kodlar02-kodu
                    read kodlar02 no lock invalid 
                        move all spaces to gd-1-col-9-9
                      not invalid
                        move kodlar02-adi to gd-1-col-9-9
                    end-read
                    if genel-uzun-oda-no-kullanilsin = 1
                      
                        if odalar-uzun-no not = spaces move  odalar-uzun-no to gd-1-col-9 end-if
                    end-if
              end-read 
              move takas-buyuk    to zz
              move zz             to gd-1-col-10
              move takas-kucuk    to zz
              move zz             to gd-1-col-11
              move takas-free     to zz
              move zz             to gd-1-col-12
              move takas-bebek    to zz
              move zz             to gd-1-col-121
              move takas-not1     to gd-1-col-13
              move takas-not2     to gd-1-col-14
              move takas-title    to gd-1-col-18 
              move takas-gel-saat to gd-1-col-16
              move ":"            to gd-1-col-16(3:1)
              move takas-gel-dak  to gd-1-col-16(4:)
              move takas-vip-durum to gd-1-col-26

              move takas-fiyat    to z-15
              move z-15         to gd-1-col-19

              move takas-vip-durum to  gd-1-col-26

              if takas-oda-konumu not = takas-fiyat-konumu
                    move takas-fiyat-konumu to  konum-anahtar                  
                    read konum no lock invalid
                         move "Tanimsiz" to konum-adi
                    end-read
                    move konum-adi      to gd-1-col-17(1:)
                  else 
                     move " " to gd-1-col-17
              end-if
*************************************FÝLTRELERRRRRR000              
               if grid-occ(2) <> spaces
                     move takas-adi        to kelime
                     move grid-occ(2)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if


             if grid-occ(3) <> spaces
                     move takas-soyadi     to kelime
                     move grid-occ(3)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

              move takas-gir-yil to yil-x 
              move takas-gir-ay  to ay-x 
              move takas-gir-gun to gun-x 
               if grid-occ(4) <> spaces
                     move tarih-x          to kelime
                     move grid-occ(4)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

           
               if grid-occ(5) <> spaces
                     move takas-gel-saat     to kelime
                     move grid-occ(5)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

             move takas-cik-yil to yil-x 
              move takas-cik-ay  to ay-x 
              move takas-cik-gun to gun-x 
               if grid-occ(6) <> spaces
                     move tarih-x          to kelime
                     move grid-occ(6)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
             
               if grid-occ(7) <> spaces
                     move acenta-adi       to kelime
                     move grid-occ(7)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

                 if grid-occ(8) <> spaces
                     move takas-VOUCHER     to kelime
                     move grid-occ(8)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if


              if grid-occ(9) <> spaces
                     move takas-oda-konumu-detay            to kelime
                     move grid-occ(9)         to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
            
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

                if grid-occ(10) <> spaces
                     move takas-odano     to kelime
                     move grid-occ(10)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

                 if grid-occ(11) <> spaces
                     move takas-fiyat-konumu-detay       to kelime
                     move grid-occ(11)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
         
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
                  if grid-occ(12) <> spaces
                     move takas-house-durum-detay     to kelime
                     move grid-occ(12)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

                  if grid-occ(13) <> spaces
                     move takas-buyuk     to kelime
                     move grid-occ(13)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
                
              if grid-occ(14) <> spaces
                     move takas-KUCUK    to kelime
                     move grid-occ(14)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
                 if grid-occ(15) <> spaces
                     move takas-FREE   to kelime
                     move grid-occ(15)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
               if grid-occ(16) <> spaces
                     move takas-BEBEK     to kelime
                     move grid-occ(16)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
               if grid-occ(17) <> spaces
                     move takas-not1     to kelime
                     move grid-occ(17)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
               if grid-occ(18) <> spaces
                     move takas-not2     to kelime
                     move grid-occ(18)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
              if grid-occ(19) <> spaces 
                     move  takas-title     to kelime
                     move grid-occ(19)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

               if grid-occ(22) <> spaces 
                     move  takas-Tip1-detay     to kelime
                     move grid-occ(22)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
               if grid-occ(23) <> spaces 
                     move  takas-Tip2-detay     to kelime
                     move grid-occ(23)    to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
               if grid-occ(24) <> spaces
                     move takas-yan-adi        to kelime
                     move grid-occ(24)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if
               if grid-occ(25) <> spaces
                     move takas-yan-soyadi        to kelime
                     move grid-occ(25)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if

               if grid-occ(26) <> spaces
                     move takas-vip-durum  to kelime
                     move grid-occ(26)      to aranan-kelime
                     move 0 to aranan-i aranan-kelime-boy
                     inspect aranan-kelime tallying aranan-kelime-boy
                             for trailing spaces 
                     compute aranan-kelime-boy = function length(aranan-kelime) -
                                                 aranan-kelime-boy
        
                     inspect kelime tallying aranan-i 
                             for all aranan-kelime(1:aranan-kelime-boy)
                     if aranan-i = 0 
                        exit paragraph
                     end-if
             end-if


*************************00000000000000000000000

              if takas-odano <> spaces then
                    add 1 to trez-blokaj-var 
              else
                    add 1 to trez-blokaj-yok
              end-if

              modify form1-gd-1,
                     y = kay-say
                     x = 1
                     hidden-data = takas-oda-konumu
                     modify form1-gd-1,record-to-add(form1-gd-1-record)
            if takas-blok-tip = 1 or 2 then 
                modify form1-gd-1,
                        y = kay-say 
                        row-color 240
            else
                      if takas-vip not = "N" and  
                         takas-vip not = " "
                          modify form1-gd-1,
                                y = kay-say 
                                row-color 176
                      else
        
                               if takas-gr-olabilir = 1
                               modify form1-gd-1,
                                     y = kay-say 
                                     row-color 480
                
                               end-if 
                      end-if

            end-if
            if takas-anahtar-bekle-renk = 1
                modify form1-gd-1,y = kay-say x = 10 
                                 cell-color 43
                
            end-if 
            if takas-anahtar-hazir-renk = 1
                modify form1-gd-1,y = kay-say  x = 10 
                                 cell-color 46
                
            end-if.
 takasla.
             perform takas-yaz
             perform takas-start
             perform grid-goster 
             perform alt-toplam-goster.

******
 satir-refresh.
      
   
    modify form1-g-1  mass-update = 1
    modify g-odatip1  mass-update = 1
    modify g-odatip2  mass-update = 1
    modify g-odatip3  mass-update = 1
                open input rez takas
               initialize rez-rec

               inquire Form1-Gd-1(ii,1), cell-data in rez-no
               read rez no lock invalid 
                 inquire Form1-Gd-1(ii,1), cell-data in rez-no
               end-read
               move rez-gir-tar  to blok-bas-tar
               move rez-cik-tar  to blok-bit-tar
               move rez-no       to blok-rez-no
               
               inquire form1-gd-1(ii,9), hidden-data   in buffer-mam
             
*               move buffer-mam(1:2) to rez-oda-konumu 
               
               move "M" to oda-db-cagir
               
             close takas 
    open input odalar  cast castdev takvim kodlar02 konum acenta .
   
    perform varying i from 1 by 1 until i > 40
                
                 if oda-konum-cagir = 0 or
                    oda-konum-cagir = i
                    move 1      to konumlar-cb-secili(i)
                    else
                    move 0 to konumlar-cb-secili(i)
                 end-if
    end-perform.
     perform tum-yaz
       perform oda-tipleri-yukle.
    move 0 to blokaj-boz.
    if takas2-no not = spaces then 
    close takas2
    delete file takas2
    end-if.
    move 7  to siralama
    perform TAKAS2-olustur.

*    modify form1-G-1,
*           lines = 36.50.
    perform grid2-yukle.
  
    close rez cast castdev takvim kodlar02 odalar konum acenta .
                



     modify form1-gd-1  mass-update = 0
    
    modify g-odatip1  mass-update = 0
    modify g-odatip2  mass-update = 0
    modify g-odatip3  mass-update = 0.
*
 blok-son-kont.
      
               initialize blok-cagir
               inquire Form1-Gd-1(ii,1), hidden-data in rez-oda-konumu
               inquire Form1-Gd-1(ii,10), cell-data   in yed-oda
*               inquire Form1-Gd-1(ii,i), cell-data in new-oda
               if new-oda <> spaces 
                 open input odalar 
                 initialize odalar-rec
                 move new-oda to odalar-no
                  if genel-uzun-oda-no-kullanilsin = 1 
*                          if odalar-uzun-no > spaces 
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to odalar-no
                                  end-read
*                          end-if
                     end-if



                 read odalar no lock invalid 
                   display message box "Tanimsiz oda numarasi, lutfen kontrol ediniz..."
                   modify Form1-gd-1(ii,10), cell-data = yed-oda
                   close odalar 
                   exit paragraph
                 end-read
                 close odalar 
               end-if 
               open i-o rez takas

               initialize rez-rec
               inquire Form1-Gd-1(ii,1), cell-data in rez-no
               if rez-no = zeroes                
                  close rez takas
                  exit paragraph 
               end-if 

               move rez-no to takas-no
               read rez no lock invalid 
                 DISPLAY MESSAGE BOX  "REZ OKUNAMADI"
               end-read
               if rez-blok-tip = 1 or 2 then 
                  move yed-oda to new-oda
                  modify Form1-gd-1(ii,10), cell-data = yed-oda
                     DISPLAY MESSAGE BOX  "Kilitli Blokaj"
                      close rez takas
                  exit paragraph 

               end-if
               if genel-konum-upgrade-devrede = 1 
                   if odalar-anah not = spaces and 
                      rez-oda-konumu not = odalar-konumu   
      
                       move rez-oda-konumu to  l-eski-konum    
                       move odalar-konumu to l-yeni-konum     
                       move rez-no      to  l-rezno          
                       move rez-rec      to  l-rez-rec     
                       move 0 to  l-yapabilir     
                
                               call "/asya/ytl/obj/otel/blokupg.asy" using  l-eski-konum  l-yeni-konum l-rezno l-rez-rec  l-yapabilir      
                                    on exception perform callerr-proc
                                    not on exception
                               cancel "/asya/ytl/obj/otel/blokupg.asy" 
                               end-call
                               if k-kodu-tasi = "ASYA" or "X   "   and 1 = 0
                               display message box  "l-eski-konum    :" l-eski-konum    new-line
                                                    "l-yeni-konum    :" l-yeni-konum     new-line
                                                    "l-rezno         :" l-rezno          new-line
                                                    "l-rez-rec(1:200):" l-rez-rec(1:200)  new-line
                                                    "l-yapabilir     :" l-yapabilir        new-line
                                                    "k-kodu-tasi     :" k-kodu-tasi        new-line 
                              end-if
                        if  l-yapabilir = 0 then 
                              
                                  display message box  "Oda Upgrade yetkiniz olmamasina ragmen oda upgrade ettiniz" new-line
                                                       "rezervasyonu kaydedemessiniz"
                             
                                   move yed-oda to new-oda
                                  modify Form1-gd-1(ii,10), cell-data = yed-oda
                                    
                                      close rez takas
                                  exit paragraph 

                                end-if
                                  



                        end-if
                   end-if
               read TAKAS no lock invalid 
                 DISPLAY MESSAGE BOX  "TAKAS OKUNAMADI"
               end-read

               move new-oda to rez-odano takas-odano

                 if genel-uzun-oda-no-kullanilsin = 1 
                         
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to rez-odano takas-odano
                                  end-read
                         
                     end-if



               if rezpara-blokaj-farkli = "H" and 
                  odalar-konumu not = rez-oda-konumu
                  perform blokaj-konum-farkli thru blokaj-konum-farkli-exit 
                  modify Form1-gd-1(ii,10), cell-data = yed-oda
                  close rez takas
                  exit paragraph
               end-if
               
              
                initialize blok-cagir
               move rez-gir-tar  to blok-bas-tar 
               move rez-cik-tar  to blok-bit-tar 
               move rez-no       to blok-rez-no 
               move new-oda      to blok-oda 
              if genel-uzun-oda-no-kullanilsin = 1 
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to blok-oda
                                  end-read
                        
                     end-if
               
               call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokara.asy" 
               end-call
               
              

               if (rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H")  
               OR new-oda = Spaces THEN
                  if new-oda = yed-oda 
                    move spaces to yed-oda
                  end-if
                  move yed-oda to new-oda
                  modify Form1-gd-1(ii,10), cell-data = yed-oda
                  close rez takas
                  exit paragraph
               end-if
               move takas-no to rez-no 
               
               read rez no lock invalid 
                 display message box
                  "REZERVASYON BULUNAMADI-" rez-no
                not invalid
                  if rez-folio > 0 then 
                    display message box  "Su Anda C-In oldu" 
                    
                    modify Form1-gd-1(ii,10), cell-data = yed-oda
                    exit paragraph
                    else
                     if  odalar-konumu not = rez-oda-konumu
                         move odalar-konumu to rez-oda-konumu  takas-oda-konumu
                         display message box "Oda Konumu degistirildi"
                         title "Bilginize...."
                     end-if
                    move new-oda to rez-odano takas-odano
                     if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to rez-odano takas-odano
                                  end-read
                         else
                         move new-oda to rez-odano takas-odano
                     end-if

                    accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                    accept rez-edit-zaman from time          |                           

                    rewrite Rez-Rec invalid continue
                       not invalid
                       perform log-operation-rez

                       perform blokaj-degisim-yaz
                       
                       perform cast-duzelt thru cast-duzelt-exit
                       if rezpara-cifte-blokaj not = "E" and
                          blok-yapabilir = "E" and 
                          new-oda not = spaces
                                  move ii to cur-ii
                                  move 10  to cur-i
                                  perform grid-takas-oda-duzelt
                       end-if
                        if genel-uzun-oda-no-kullanilsin = 1
*                              stop " "
                            move rez-odano to odalar2-NO
                            read odalar2 no lock key odalar2-anah1 invalid 
                                  modify Form1-gd-1(ii,10), cell-data = rez-odano
                                  not invalid 
                                  modify Form1-gd-1(ii,10), cell-data = odalar2-uzun-no
                            end-read
                          
                        else
                       modify Form1-gd-1(ii,10), cell-data = rez-odano
                        end-if
                           



                    end-rewrite
                    move rez-no to takas-no
                    read takas no lock invalid stop " "
                       not invalid
                           move rez-odano to takas-odano
                           rewrite takas-rec invalid stop " " end-rewrite
                    end-read   
                  end-if
               end-read 
               close rez takas.




*
 Form1-Gd-1-Ex-Other.
      perform kullandi.
      if key-status = 4 then
        perform form1-ex-other
     end-if
      modify Form1-Gd-1, mass-update = 1
      perform ex2
      modify Form1-Gd-1, mass-update = 0.

*
 ex2.
      inquire Form1-Gd-1, cursor-x in i cursor-y in ii.
      if  key-status = 8
            
            if i=10 and  key-status=8 then  
               open input rez takas
               initialize rez-rec
               inquire Form1-Gd-1(ii,1), cell-data in rez-no                
               read rez no lock invalid 
                 inquire Form1-Gd-1(ii,1), cell-data in rez-no
               end-read
               move rez-gir-tar  to blok-bas-tar
               move rez-cik-tar  to blok-bit-tar
               move rez-no       to blok-rez-no
               close rez takas
               inquire form1-gd-1(ii,9), hidden-data   in buffer-mam
                move rez-odano to ydk-oda
                   if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move rez-odano        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to ydk-oda
                                  end-read
                         
                     end-if


*               move buffer-mam(1:2) to rez-oda-konumu 
               initialize oda-cagir
               move "M" to oda-db-cagir
               if key-status = 8
                  perform oda-ara2 thru oda-ara2-exit
               end-if
                if new-oda = spaces move ydk-oda to new-oda end-if 
            end-if
*           evaluate i
*             when 10
               
               perform blok-son-kont
                 if new-oda not = spaces and blokajli-odalar-ciksin = 0
                        modify Form1-gd-1,record-to-delete(ii)
                     end-if
               if rez-sharenum > 0 then
                     
               open i-o takas
               perform share-bak
               close takas
                 
                     end-if




               
      end-if
      if key-status = 18 then
          open input rez  
          inquire Form1-Gd-1(ii,1), cell-data in rez-no 
          call "/asya/ytl/obj/otel/rez.asy" 
                          using rez-no
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/rez.asy"
               end-call
         inquire Form1-Gd-1(ii,1), cell-data in rez-no
              read rez no lock invalid 
                display message box " Hata No :4556333"
                 not invalid
                 if genel-uzun-oda-no-kullanilsin = 1
                       
                            move rez-odano to odalar2-NO
                            read odalar2 no lock key odalar2-anah1 invalid 
                                  modify Form1-gd-1(ii,10), cell-data = rez-odano
                                  not invalid 
                                  modify Form1-gd-1(ii,10), cell-data = odalar2-uzun-no
                            end-read
                          
                        else
                  modify Form1-gd-1(ii,10), cell-data = rez-odano
                  end-if
              end-read
              close rez
      end-if
      if key-status = 14   then
               open input rez 
               initialize rez-rec
               inquire Form1-Gd-1(ii,1), cell-data in rez-no                 
               read rez no lock invalid 
                 display message box " Hata No :4556333"
                 not invalid
                   if rez-folio > 0 then 
                    display message box  "Daha once C-In oldu" 
                    else
                    move rez-no to konuk-rez-no
                    move   99999998 to konuk-folio
                     perform konuk-gonder 
                   end-if
               end-read
               inquire Form1-Gd-1(ii,1), cell-data in rez-no
               read rez no lock invalid 
                display message box " Hata No :4556333"
                 not invalid
                 if genel-uzun-oda-no-kullanilsin = 1
                        
                            move rez-odano to odalar2-NO
                            read odalar2 no lock key odalar2-anah1 invalid 
                                  modify Form1-gd-1(ii,10), cell-data = rez-odano
                                  not invalid 
                                  modify Form1-gd-1(ii,10), cell-data = odalar2-uzun-no
                            end-read
                        
                        else
                  modify Form1-gd-1(ii,10), cell-data = rez-odano
                  end-if
              end-read
              close rez
              if rez-folio > 0 then 
               perform varying j from 1 by 1 until j > 18           
                modify Form1-gd-1(ii,j)
                cell-color  = 79
               end-perform 
              end-if
      end-if
     .
*
 konuk-gonder.
       call "/asya/ytl/obj/otel/rezcin.asy" 
            using konuk-rez-no konuk-folio
         on exception 
             perform callerr-proc
             exit paragraph
         not on exception 
             cancel "/asya/ytl/obj/otel/rezcin.asy"
       end-call.
*
 Form1-Gd-1-Ev-Other.
    evaluate event-type 
*         when msg-goto-cell
         when msg-begin-entry
           inquire Form1-Gd-1, x in i y in ii
          evaluate i 
            when 13
            when 14
            when 10
              inquire Form1-Gd-1(ii,i) cell-data in yed-oda

            when other
             if event-data-2 not = 2
                     move event-action-fail to event-action
              end-if
          end-evaluate
         when msg-finish-entry
                 inquire Form1-Gd-1(event-data-2,event-data-1), 
                            cell-data in grid-occ(event-data-1)
                 
                   if event-data-2 = 2
                              open input takas
                              perform grid-goster
                              exit paragraph
                    end-if
           inquire Form1-Gd-1, x in i y in ii
           evaluate i
             when 13
             when 14
                 move gd-1-col-13  to rez-not1
                 move gd-1-col-14  to rez-not2
             when 10
               initialize blok-cagir
               inquire Form1-Gd-1(ii,1), hidden-data in rez-oda-konumu
               inquire Form1-Gd-1(ii,i), cell-data in new-oda
               perform outof-kontrol
               if new-oda <> spaces 
                 open input odalar 
                 initialize odalar-rec
                 move new-oda to odalar-no
                  
                 if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to odalar-no
                                  end-read
                         
                     end-if


                 read odalar no lock invalid 
                   display message box "Tanimsiz oda numarasi, lutfen kontrol ediniz..."
                   modify Form1-gd-1(ii,i), cell-data = yed-oda
                   close odalar 
                   exit paragraph              
                 end-read
                   if odalar-aktif-pasif = 1
                   display message box "Secilen oda numarasi pasif, lutfen kontrol ediniz..."
                   modify Form1-gd-1(ii,i), cell-data = yed-oda
                   close odalar 
                   exit paragraph                                   
                   end-if 
                 close odalar 
               else
                 if yed-oda not = spaces
                   open i-o odalar 
                   initialize odalar-rec
                   move yed-oda to odalar-no
                    if genel-uzun-oda-no-kullanilsin = 1 
                          if odalar-uzun-no > spaces 
                                 move yed-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to odalar-no
                                  end-read
                          end-if
                     end-if

                   read odalar no lock invalid 
                     display message box "Tanimsiz oda numarasi, lutfen kontrol ediniz..."                   
                   end-read
                   if odalar-durumu = house-bt or house-dt then 
*                   if genel-blokaj-kirli-soru = "E"                   
                      display message box yed-oda "'Nolu Oda Kirliye Alinsin Mi.?"
                                      title "[ Uyari ]"
                                      icon 1
                                      type 2
                                      default 2
                                      returning return-code
                      if return-code = 2
                         continue
                      else
                         move house-bk        to odalar-durumu
                         move house-bk        to house-durumu
                      end-if
                      rewrite odalar-rec end-rewrite
                      perform log-operation-odalar



                   end-if
***                end-if
                   close odalar 
                  end-if
               end-if
               open i-o rez takas
               initialize rez-rec
               inquire Form1-Gd-1(ii,1), cell-data in rez-no 
               move rez-no to takas-no
               read rez no lock invalid 
                 display message box "rez-okunamadi"
               end-read
               if rez-blok-tip  = 1 or 2
                  if new-oda = yed-oda 
                    move spaces to yed-oda
                  end-if
                  modify Form1-gd-1(ii,i), cell-data = yed-oda
                  close rez takas
                  display message box "Kilitli Blokaji degistiremezsiniz" title "Kilitli Blokaj"
                  exit paragraph
               end-if
              if genel-konum-upgrade-devrede = 1 
                   if odalar-anah not = spaces and 
                      rez-oda-konumu not = odalar-konumu   
      
                       move rez-oda-konumu to  l-eski-konum    
                       move odalar-konumu to l-yeni-konum     
                       move rez-no      to  l-rezno          
                       move rez-rec      to  l-rez-rec     
                       move 0 to  l-yapabilir     
                
                               call "/asya/ytl/obj/otel/blokupg.asy" using  l-eski-konum  l-yeni-konum l-rezno l-rez-rec  l-yapabilir      
                                    on exception perform callerr-proc
                                    not on exception
                               cancel "/asya/ytl/obj/otel/blokupg.asy" 
                               end-call
                               if k-kodu-tasi = "ASYA" or "X   "   and 1=0
                               display message box  "l-eski-konum    :" l-eski-konum    new-line
                                                    "l-yeni-konum    :" l-yeni-konum     new-line
                                                    "l-rezno         :" l-rezno          new-line
                                                    "l-rez-rec(1:200):" l-rez-rec(1:200)  new-line
                                                    "l-yapabilir     :" l-yapabilir        new-line
                                                    "k-kodu-tasi     :" k-kodu-tasi        new-line 
                              end-if
                        if  l-yapabilir = 0 then 
                              
                          display message box  "Oda Upgrade Yetkiniz Bulunmamaktadir..." new-line
                                               "Rezervasyon Kaydedilemedi....."
                                          title "Uyari"
                                          icon 2
                              if new-oda = yed-oda 
                                    move spaces to yed-oda
                                  end-if
                                  modify Form1-gd-1(ii,i), cell-data = yed-oda
                                  close rez takas
                                  
                                  exit paragraph
                                end-if
                                  



                        end-if
                   end-if

                 



               read takas no lock invalid 
                    display message box "rez-okunamadi"
               end-read
               move new-oda to rez-odano takas-odano
                if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to rez-odano takas-odano
                                  end-read
                         
                     end-if
               if rezpara-blokaj-farkli = "H" and 
                  odalar-konumu not = rez-oda-konumu
                  perform blokaj-konum-farkli thru blokaj-konum-farkli-exit 
                  modify Form1-gd-1(ii,i), cell-data = yed-oda
                  close rez takas
                  exit paragraph
               end-if
         
                  initialize blok-cagir
                  move rez-gir-tar  to blok-bas-tar 
                  move rez-cik-tar  to blok-bit-tar 
                  move rez-no       to blok-rez-no 
                  move new-oda      to blok-oda 
                   if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to blok-oda
                                  end-read
                         
                     end-if
                  call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                       on exception perform callerr-proc
                       not on exception
                  cancel "/asya/ytl/obj/otel/blokara.asy" 
                  end-call




          
               if (rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H" )  
                  if new-oda = yed-oda 
                    move spaces to yed-oda
                  end-if
                  modify Form1-gd-1(ii,i), cell-data = yed-oda
                  close rez takas
                  exit paragraph
               end-if
               if rez-folio = 0 then
                  if  new-oda not = spaces
                    move odalar-konumu to rez-oda-konumu
                  end-if

                    accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                    accept rez-edit-zaman from time          |                           

                    rewrite rez-rec invalid 
                        continue
                    not invalid
                     perform log-operation-rez
                     perform blokaj-degisim-yaz
                     perform cast-duzelt thru cast-duzelt-exit
                   
                     if rezpara-cifte-blokaj not = "E" and
                        blok-yapabilir = "E" and 
                        new-oda not = spaces
                            move ii to cur-ii
                            move i  to cur-i
                            perform grid-takas-oda-duzelt
                     end-if

                     modify Form1-gd-1(ii,i), cell-data = new-oda
                     move rez-no   to takas-anah
                     read takas no lock invalid
                          display message box
                                  "2kg-> Object Error"
                                  icon mb_error_icon
                                  title "Error !"
                     end-read
                     move new-oda    to  takas-odano
                      if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to takas-odano
                                  end-read
                         
                     end-if
                     rewrite takas-rec invalid 
                           display message box "takas yazamadim" 
                     end-rewrite
                     
                     if new-oda not = spaces and blokajli-odalar-ciksin = 0
                        modify Form1-gd-1,record-to-delete(ii)
                     end-if
                     if rez-sharenum > 0 then
                       perform share-bak
                     end-if
               end-rewrite
               else 
                  modify Form1-gd-1(ii,i), cell-data = yed-oda
                  display message box "oda c/In"
              end-if
              close rez takas

           end-evaluate
    end-evaluate.
* 
 share-bak.
    initialize takas-rec fs-takas
                        move rez-sharenum to takas-sharenum
                        start takas key = takas-sharenum
                           invalid continue
                           not invalid
                           perform until fs-takas = "10" 
                                 read takas next no lock end move "10" to fs-takas
                                     not end
                                     if   takas-sharenum not = rez-sharenum
                                        move "10" to fs-takas
                                        exit perform cycle
                                     end-if
                                     if  rez-no   = takas-anah
                                       exit perform cycle
                                     end-if
                                      inquire  Form1-gd-1 last-row in max-sil
                                     perform varying sii from  1 by 1 until sii > max-sil
                                       inquire  Form1-gd-1(sii,1) cell-data in s-rezno
                                       if s-rezno = takas-no then 
                                       if genel-uzun-oda-no-kullanilsin = 1
                                       
                                            move rez-odano to odalar2-NO
                                            read odalar2 no lock key odalar2-anah1 invalid 
                                                  modify Form1-gd-1(sii,10), cell-data = rez-odano
                                                  not invalid 
                                                  modify Form1-gd-1(sii,10), cell-data = odalar2-uzun-no
                                            end-read
                                             move new-oda    to  takas-odano
                                           
                        
                                                         move new-oda        to   odalar2-uzun-no
                                                         read odalar2 no lock invalid continue
                                                         not invalid
                                                         move odalar2-no to takas-odano
                                                          end-read
                                                 
                                           
                                          

                                        else
                                       
                                                          modify Form1-gd-1(sii,10),
                                          cell-data = rez-odano
                                           move new-oda    to  takas-odano
                                         
                                        end-if

                                             rewrite takas-rec invalid 
                                                   display message box "takas yazamadim" 
                                             end-rewrite
                                              
                                              if new-oda not = spaces and blokajli-odalar-ciksin = 0
                                                   modify Form1-gd-1,record-to-delete(sii)
                                              end-if
                                             exit perform
                     
                                       end-if
                                     end-perform
                                 end-read
                           end-perform
                        end-start.
*
 oda-ara.
      initialize oda-cagir.
      move rez-oda-konumu   to oda-konum-cagir.
      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
           on exception perform callerr-proc
       not on exception
      cancel "/asya/ytl/obj/otel/odaara.asy" 
      end-call.
      move odano-cagir     to o-kisa
      perform oda-uzat
      move o-uzun to  new-oda.



 oda-oku.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.
*
 oda-ara1.
******> oda-db-cagir = "M" Musait odalari cagir blokeli olmayanlari
      move rez-oda-konumu   to oda-konum-cagir.
      call "/asya/ytl/obj/otel/odaara1.asy" 
            using oda-cagir, blok-bas-tar, 
                  blok-bit-tar, blok-rez-no
           on exception perform callerr-proc
       not on exception
      cancel "/asya/ytl/obj/otel/odaara1.asy" 
      end-call.
       move odano-cagir     to  o-kisa
      perform oda-uzat
      move o-uzun to  new-oda.
     
      initialize blok-cagir.
 oda-ara1-exit.
       exit.

 oda-ara2.
******> oda-db-acagir = "M" Musait odalari cagir blokeli olmayanlari
      move rez-oda-konumu   to oda-konum-cagir.
      call "/asya/ytl/obj/otel/odaara2.asy" 
            using oda-cagir, blok-bas-tar, 
                  blok-bit-tar, blok-rez-no
           on exception perform callerr-proc
       not on exception
      cancel "/asya/ytl/obj/otel/odaara2.asy" 
      end-call.
      move odano-cagir     to  o-kisa
      perform oda-uzat
      move o-uzun to  new-oda.

      initialize blok-cagir.
 oda-ara2-exit.
       exit.
*
 cast-duzelt.
        perform new-o-kisa-bul.
        open i-o cast.
        initialize cast-rec.
        move rez-no          to cast-rez-no.
        start cast key not < cast-anah1 invalid go cast-duzelt-bitti.
 cast-duzelt-oku.
        read cast  next no lock end go cast-duzelt-bitti.
        if fs-cast = 99 go cast-duzelt-oku.
        if cast-rez-no > rez-no go cast-duzelt-bitti.
        if cast-rez-no = rez-no 
           continue
        else 
           go cast-duzelt-oku
        end-if.
        if cast-oda-no   = new-oda-k go cast-duzelt-oku.
        move new-oda-k      to cast-oda-no.
        move odalar-konumu to cast-oda-konumu
        rewrite cast-rec invalid 
            go cast-duzelt-oku. 
        perform log-operation-cast
            go cast-duzelt-oku.
 cast-duzelt-bitti.
        close cast.
 cast-duzelt-exit.
     exit.
*
 blokaj-konum-farkli. 
        initialize mesaj-degiskenler
        move " [ Blokaj Hata ] " to mmesaj-title
        move "Rezervasyon Konumu Ile Blokaj Oda." to mmesaj-1. 
        move "Konumu Farkli...Rez..:   Blok..:  " to mmesaj-2. 
        move rez-oda-konumu                       to mmesaj-2(23:1). 
        move odalar-konumu                        to mmesaj-2(33:1). 
        move 1           to mmesaj-type
        move 1           to mmesaj-icon
        move 1           to mmesaj-default
             perform mmesaj-ver.
 blokaj-konum-farkli-exit. 
     exit. 
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 acc-07-Aft-Procedure.
     open input acenta
     if acn-kod = spaces
        move "Tum Acentalar"   to acenta-adi
     else
        move acn-kod    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 21 to control-id
        end-read
     end-if
     display lb-acenadi.
     close acenta.
*
 grid-takas-oda-duzelt.
     perform varying duz-ii from 2 by 1 until duz-ii > kay-say
             inquire form1-gd-1(duz-ii,10),    | bak
                     cell-data in duz-oda
             if duz-oda <> spaces and 
                duz-oda = new-oda and
                cur-ii = duz-ii
                     inquire form1-gd-1(duz-ii,1),
                             cell-data in takas-anah
                     read takas no lock invalid
                          exit perform cycle
                     end-read
                     move spaces to takas-odano
                     rewrite takas-rec invalid
                         display message box
                                 "Blokaj duzeltme hatasi"
                                 icon mb_error_icon
                                 title "Hata !"
                     not invalid
                         modify form1-gd-1(duz-ii,10),
                                cell-data = "    "       |yapildi uzun
                     end-rewrite
             end-if
     end-perform.
*
 not-goster.
       perform kullandi.
      if event-data-2 = 2  or event-data-2 = 0  then
            modify Form1-G-1 , reset-grid = 1 , mass-update = 1
            modify Form1-G-1 ,mass-update = 0
            |perform satir-refresh
            exit paragraph
      end-if
      perform varying mi  from 1 by 1 until islemde = 0 or mi > 30 
        accept omitted before time 20
        
      end-perform
      if mi > 50 
        exit paragraph
      end-if
        modify form1-g-1  mass-update = 1
        move 1 to islemde
        move event-data-1 to i 
        move event-data-2 to ii.
        if ii not = eski-not-say   then
        modify Form1-Gd-1(eski-not-say), 
           start-x = 2
            x = 25
           region-color = 0
          move ii to eski-not-say
          modify Form1-Gd-1(ii), 
             start-x = 2
            x = 25
            start-y = ii
            y = ii
           region-color = 144
           inquire Form1-Gd-1(ii,1), cell-data in link-NOT-DOS-ANAH   
        inquire Form1-Gd-1(ii,1), cell-data in link-NOT-DOS-ANAH   
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move 4 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
                    if toplam-not  = spaces then 
                     move 0 to not-vis
                     else
                     move 1 to not-vis
                   end-if

             display not-ac not-fr
            end-if.
            if ii > 1 then
               open input rez
               initialize rez-rec
               inquire Form1-Gd-1(ii,1), cell-data in rez-no
               read rez no lock invalid 
                 inquire Form1-Gd-1(ii,1), cell-data in rez-no
               end-read
               move rez-gir-tar  to blok-bas-tar
               move rez-cik-tar  to blok-bit-tar
               move rez-no       to blok-rez-no
               evaluate ara-tip
                    when 1 
                       move rez-oda-konumu   to oda-konum-cagir
                    when 2
                        move rez-fiyat-konumu   to oda-konum-cagir
                    when 3
                        move 0 to oda-konum-cagir

               end-evaluate
              
               close rez 
                  
                 perform satir-refresh
            end-if.
           modify form1-g-1  mass-update = 0 .
           move 0 to islemde .
*
 rezgrup2-olustur.
      open i-o rezgrup2
      initialize rez-rec
       move "I" to rez-durumu
       start rez key > rez-grup invalid continue
          not invalid 
            perform until fs-rez ="10" 
                 read rez next no lock 
                    end move "10" to fs-rez
                    not end
                    if rez-durumu not = "I" then
                      move "10" to fs-rez
                      exit perform
                    end-if
                    if rez-grup-adi = spaces
                       exit perform cycle
                    end-if
                    if rez-gir-tar < tarih or
                       rez-gir-tar > bit-tar
                         exit perform cycle
                    end-if
                    if rez-grup-no > spaces or 0 then
                      initialize rezgrup2-rec                             
                      move rez-grup-no to rezgrup2-kodu
                      read rezgrup2 no lock invalid  
                         move rez-acenta   to rezgrup2-acenta
                         move rez-gir-tar  to rezgrup2-gel-tar
                         move rez-cik-tar  to rezgrup2-git-tar
                         move rez-grup-adi to rezgrup2-adi
                         write rezgrup2-rec invalid 
                               rewrite rezgrup2-rec end-rewrite 
                         end-write                           
                       end-read                                                                   
                    end-if
                  end-read

            end-perform 
      end-start
     close rezgrup2.
* 
 rezgrup-ara.
      move rezgrup2-dosya to rezgrup-cagir-dosya.      
      call "/asya/ytl/obj/otel/rezgara.asy" using rezg-cagir  rezgrup-cagir-dosya
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/rezgara.asy" 
       end-call.
       open input rezgrup2
       initialize rezgrup2-rec
       move rezg-cagir     to grup-no rezgrup2-kodu.
       read rezgrup2 no lock invalid continue
       end-read
       close rezgrup2.
       display accept-grup lb-grup-adi.
*
 accept-grup-Ex-Other.
     if key-status = 01 
         if control-id = 6 
            move k-kodu-tasi to   rezgrup2-dosya-kllnc
            open i-o genelfis
            move 1 to genelfis-anahtar
            read genelfis no lock invalid
                   move 1 to ekran-fis-1
            end-read
              add 1 to ekran-fis-1
              rewrite genelfis-rec invalid
                 write genelfis-rec end-write
              end-rewrite
            close genelfis
    
            move ekran-fis-1(2:) to    rezgrup2-dosya-no
          
            inspect rezgrup2-dosya replacing all spaces by "1"
            open input rez
            perform rezgrup2-olustur
            close rez
            perform rezgrup-ara
         end-if
      end-if.      
     
     .
*
 Form1-Pb-3-Link.
      if tum-konumlar = 0 then 
        move 1 to tum-konumlar
        move "Temizle" to p-text 
        move 1 to  oda1-value oda2-value oda3-value oda4-value oda5-value oda6-value oda7-value oda8-value oda9-value oda10-value 
                   oda11-value oda12-value oda13-value oda14-value oda15-value oda16-value oda17-value oda18-value oda19-value oda20-value 
                   oda21-value oda22-value oda23-value oda24-value oda25-value oda26-value oda27-value oda28-value oda29-value oda30-value 
                   oda31-value oda32-value oda33-value oda34-value oda35-value oda36-value oda37-value oda38-value oda39-value oda40-value 
          
        else
        move 0 to tum-konumlar
        move "Tumu" to p-text 
        move 0 to  oda1-value oda2-value oda3-value oda4-value oda5-value oda6-value oda7-value oda8-value oda9-value oda10-value 
                   oda11-value oda12-value oda13-value oda14-value oda15-value oda16-value oda17-value oda18-value oda19-value oda20-value 
                   oda21-value oda22-value oda23-value oda24-value oda25-value oda26-value oda27-value oda28-value oda29-value oda30-value 
                   oda31-value oda32-value oda33-value oda34-value oda35-value oda36-value oda37-value oda38-value oda39-value oda40-value 
         
      end-if
      display  form1-cb-1 form1-cb-2 form1-cb-3 form1-cb-4 
    form1-cb-5 form1-cb-6 form1-cb-7 form1-cb-8 form1-cb-9   form1-cb-10
    form1-cb-11 form1-cb-12 form1-cb-13 form1-cb-14  form1-cb-15 form1-cb-16 form1-cb-17 form1-cb-18 form1-cb-19 form1-cb-20 
    form1-cb-21 form1-cb-22 form1-cb-23 form1-cb-24  form1-cb-25 form1-cb-26 form1-cb-27 form1-cb-28 form1-cb-29 form1-cb-30 
    form1-cb-31 form1-cb-32 form1-cb-33 form1-cb-34  form1-cb-35 form1-cb-36 form1-cb-37 form1-cb-38 form1-cb-39 form1-cb-40     
       display p1
     .















*
 gd-odatip1-Ev-Other.
     
     .












***********************apooooooooooooooooooo**************************
*
 TAKAS2-olustur.
*     if k-kodu-tasi = "X" STOP  " KADÝRRRR" end-if
     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept ekran-fis-1 from time
     end-read
     add 1 to ekran-fis-1
     rewrite genelfis-rec invalid
             write genelfis-rec invalid continue end-write
     end-rewrite
     close genelfis.
     move ekran-fis-1(2:)          to TAKAS2-no
     move k-kodu-tasi    to takas2-k
     open output TAKAS2 close TAKAS2 
     open i-o TAKAS2 with bulk-addition.
     initialize odalar-rec cast-rec
     start odalar key not < odalar-anah 
           invalid 
                 close TAKAS2
                 delete file TAKAS2
                 display message box 
                         "Oda tanimlamalari bulunamadi !!!"
                         title "Uyari"
                         icon mb_error_icon
                         exit paragraph
     end-start.
     perform odatip-pass-kontrol.
 
     perform with test after until fs-odalar = "10"
     read odalar next no lock end move "10" to fs-odalar
     not at end
        if odalar-aktif-pasif = 1
           exit perform cycle 
        end-if 
        if odalar-hayali = "H" and gercek = 1 then 
             exit perform cycle
        end-if
          if  (konumlar-cb-secili(1) = 1 and odalar-konumu = 1) or
              (konumlar-cb-secili(2) = 1 and odalar-konumu = 2) or
              (konumlar-cb-secili(3) = 1 and odalar-konumu = 3) or
              (konumlar-cb-secili(4) = 1 and odalar-konumu = 4) or
              (konumlar-cb-secili(5) = 1 and odalar-konumu = 5) or
              (konumlar-cb-secili(6) = 1 and odalar-konumu = 6) or
              (konumlar-cb-secili(7) = 1 and odalar-konumu = 7) or
              (konumlar-cb-secili(8) = 1 and odalar-konumu = 8) or
              (konumlar-cb-secili(9) = 1 and odalar-konumu = 9) or
              (konumlar-cb-secili(10) = 1 and odalar-konumu = 10) or
              (konumlar-cb-secili(11) = 1 and odalar-konumu = 11) or
              (konumlar-cb-secili(12) = 1 and odalar-konumu = 12) or
              (konumlar-cb-secili(13) = 1 and odalar-konumu = 13) or
              (konumlar-cb-secili(14) = 1 and odalar-konumu = 14) or
              (konumlar-cb-secili(15) = 1 and odalar-konumu = 15) or
              (konumlar-cb-secili(16) = 1 and odalar-konumu = 16) or
              (konumlar-cb-secili(17) = 1 and odalar-konumu = 17) or
              (konumlar-cb-secili(18) = 1 and odalar-konumu = 18) or
              (konumlar-cb-secili(19) = 1 and odalar-konumu = 19) or
              (konumlar-cb-secili(20) = 1 and odalar-konumu = 20) or
              (konumlar-cb-secili(21) = 1 and odalar-konumu = 21) or
              (konumlar-cb-secili(22) = 1 and odalar-konumu = 22) or
              (konumlar-cb-secili(23) = 1 and odalar-konumu = 23) or
              (konumlar-cb-secili(24) = 1 and odalar-konumu = 24) or
              (konumlar-cb-secili(25) = 1 and odalar-konumu = 25) or
              (konumlar-cb-secili(26) = 1 and odalar-konumu = 26) or
              (konumlar-cb-secili(27) = 1 and odalar-konumu = 27) or
              (konumlar-cb-secili(28) = 1 and odalar-konumu = 28) or
              (konumlar-cb-secili(29) = 1 and odalar-konumu = 29) or
              (konumlar-cb-secili(30) = 1 and odalar-konumu = 30) or
              (konumlar-cb-secili(31) = 1 and odalar-konumu = 31) or
              (konumlar-cb-secili(32) = 1 and odalar-konumu = 32) or
              (konumlar-cb-secili(33) = 1 and odalar-konumu = 33) or
              (konumlar-cb-secili(34) = 1 and odalar-konumu = 34) or
              (konumlar-cb-secili(35) = 1 and odalar-konumu = 35) or
              (konumlar-cb-secili(36) = 1 and odalar-konumu = 36) or
              (konumlar-cb-secili(37) = 1 and odalar-konumu = 37) or
              (konumlar-cb-secili(38) = 1 and odalar-konumu = 38) or
              (konumlar-cb-secili(39) = 1 and odalar-konumu = 39) or
              (konumlar-cb-secili(40) = 1 and odalar-konumu = 40) 

               continue
          else
               exit perform cycle
          end-if
         
*/ Oda tip 1 kontrolu
          if odalar-tipi <> spaces
             if odatip1-pass-gec = 0
             perform varying dummy-999
                     from 1
                     by 1
                     until dummy-999 > max-odatip-occurs
                     evaluate odatip1-sec(dummy-999)
                     when "E"
                        if odatip1-tip(dummy-999) = odalar-tipi
                           initialize dummy-999
                           exit perform
                        end-if
                     when "H"
                        if odatip1-tip(dummy-999) = odalar-tipi
                           move max-odatip-occurs to dummy-999
                        end-if
                     end-evaluate
             end-perform
             if dummy-999 > max-odatip-occurs
                exit perform cycle
             end-if
             end-if
          end-if

*/ Oda tip 2 kontrolu
          if odalar-tipi2 <> spaces
             if odatip2-pass-gec = 0
             perform varying dummy-999
                     from 1
                     by 1
                     until dummy-999 > max-odatip-occurs
                     evaluate odatip2-sec(dummy-999)
                     when "E"
                        if odatip2-tip(dummy-999) = odalar-tipi2
                           initialize dummy-999
                           exit perform
                        end-if
                     when "H"
                        if odatip2-tip(dummy-999) = odalar-tipi2
                            move max-odatip-occurs to dummy-999
                        end-if
                     end-evaluate
             end-perform
             if dummy-999 > max-odatip-occurs
                exit perform cycle
             end-if
             end-if
          end-if

*/ Oda tip 3 kontrolu
          if odalar-tipi3 <> spaces 
             if odatip3-pass-gec = 0
             perform varying dummy-999
                     from 1
                     by 1
                     until dummy-999 > max-odatip-occurs
                     evaluate odatip3-sec(dummy-999)
                     when "E"
                        if odatip3-tip(dummy-999) = odalar-tipi3
                           initialize dummy-999
                           exit perform
                        end-if
                     when "H"
                       if odatip3-tip(dummy-999) = odalar-tipi3
                           move max-odatip-occurs to dummy-999
                       end-if
                     end-evaluate
             end-perform
             if dummy-999 > max-odatip-occurs
                exit perform cycle
             end-if
             end-if
          end-if
          if filt-kat not = spaces and filt-kat not = odalar-kat
                exit perform cycle
          end-if

          initialize TAKAS2-rec
          if oda-db-cagir <> spaces
             initialize blok-yapabilir2
             move "M"       to oda-dolu-bos
             move 1 to kim-cagirdi-lan-beni
             perform blok-basla
             if blok-yapabilir2 = "H"
                move "X"  to oda-dolu-bos
             end-if
             if oda-dolu-bos <> oda-db-cagir 
*                initialize oda-db-cagir |kadir 24.10.2017
                exit perform cycle
             end-if
          end-if
          if outof-cikma = 1
             if odalar-durumu = house-so
                 exit perform cycle 
             end-if 
          end-if 
          move odalar-no        to TAKAS2-oda
          if genel-uzun-oda-no-kullanilsin = 1 
             if odalar-uzun-no > spaces 

                move odalar-uzun-no        to TAKAS2-odau
          end-if
          end-if
          move odalar-konumu    to TAKAS2-oda-konumu
          move odalar-tipi      to TAKAS2-oda-tipi
          move odalar-tipi2     to TAKAS2-oda-tipi2
          move odalar-tipi3     to TAKAS2-oda-tipi3
          move odalar-durumu    to TAKAS2-oda-durumu
           
          evaluate true
           when odalar-durumu = house-BT
             move 1 to takas2-oda-durumu-bas
           when odalar-durumu = house-BK 
             move 2 to takas2-oda-durumu-bas
    
           when odalar-durumu = house-ao
             move 9 to takas2-oda-durumu-bas
           when other 
             move 5 to takas2-oda-durumu-bas
         end-evaluate
          write TAKAS2-rec
                invalid
                     continue
          end-write
     end-read
     end-perform.
     close TAKAS2.
     open input TAKAS2.

 blok-basla.
      initialize blok-yapabilir2 cast-rec 
                blokaj-boz-rez-sayi yedek-rez-no.
******************DEVRE TATILL**************************           
      if genel-devre-tatil-aktif = 1
 
           if kim-cagirdi-lan-beni = 1
              move odalar-no     to castdev-oda yedek-oda-no
           else
              move yedek-oda-no  to castdev-oda
           end-if

           initialize takvim-rec xcastdev-gecti xcast-ilk-tar-kontrol
           move 0 to xcast-ilk-tar-kontrol
           move blok-bas-tar     to takvim-anah
           start takvim key not < takvim-anah invalid 
                 continue 
           not invalid 
           perform with test after until fs-takvim = "10"
           read takvim next no lock end move "10" to fs-takvim
           not at end
                  if takvim-anah >= blok-bit-tar
                          exit perform
                  end-if

                  move 0 to xcastdev-gecti
 
                  initialize castdev-rec
                  move yedek-oda-no to castdev-oda
                  move takvim-anah  to castdev-tarih
                  read castdev no lock invalid
                         exit perform  
                  end-read

                  move 1 to xcastdev-gecti 
           end-read
           end-perform 
           end-start

************************************* kadir 27.10.2017
           if odalar-devre <> "A"
              move 1 to xcastdev-gecti
           end-if
************************************* kadir 27.10.2017
 
           if xcastdev-gecti <> 1
                 move "H" to blok-yapabilir2
                 exit paragraph
           end-if
      end-if
******************DEVRE TATILL**************************   

* kim-cagirdi-lan-beni 1=> TAKAS2-olustur
*                      2=> bozulan-blokaj-grid-yukle
     if kim-cagirdi-lan-beni = 1
        move odalar-no     to cast-oda-no yedek-oda-no
     else
        move yedek-oda-no  to cast-oda-no
     end-if
     move blok-bas-tar  to cast-tarih.  
     start cast key not < cast-anah3 invalid 
                  exit paragraph
     end-start
     initialize fs-cast
     perform with test after until fs-cast = "10"
     read cast next no lock end move "10" to fs-cast
     not at end
        
          if cast-tarih > blok-bit-tar or
             cast-oda-no > yedek-oda-no
                  exit perform
          end-if
          if cast-oda-no <> yedek-oda-no or
             cast-rez-no = blok-rez-no
             exit perform cycle
          end-if

          move cast-rez-no    to rez-no  
          read rez no lock invalid 
               exit perform cycle
          end-read
          if rez-durumu not = "I" or
            ( rez-k-g-b not = "K" and not = "O"   )
                 exit perform cycle
          end-if
          
          if rez-cik-tar = cast-tarih
             if rez-c-in = "E"
                move rez-git-zaman  to TAKAS2-git-zaman
                move 0 to TAKAS2-late
                if REZ-LATE-ZAMAN > "0800" then
                  move REZ-LATE-ZAMAN  to TAKAS2-git-zaman
                  move 1 to TAKAS2-late
                end-if
             end-if
              move "X" to TAKAS2-bastan-fit
             exit perform cycle
          end-if

          if rez-gir-tar = blok-bit-tar
             move "X" to TAKAS2-sondan-fit
             exit perform cycle
             
          end-if

          if blokaj-boz = 1
             if rez-c-in <> "E"  | and (not ( rez-blok-tip = 1 or 2 ))
                if kim-cagirdi-lan-beni = 2
                   if yedek-rez-no = zeroes
                      move rez-no   to yedek-rez-no
                      perform rez-to-grid2
                   else
                      if rez-no <> yedek-rez-no
                         perform rez-to-grid2
                         move rez-no   to yedek-rez-no
                      end-if
                   end-if
                   exit perform cycle
                end-if
                add 1 to blokaj-boz-rez-sayi
                if rez-blok-tip = 1 or 2 
                  move  rez-blok-tip to takas2-blok-tip
                end-if
                if blokaj-boz-rez-sayi = 1
                   move rez-adi         to TAKAS2-mus-adi
                   move rez-soyadi      to TAKAS2-mus-soyadi
                   move rez-acenta      to TAKAS2-acenta
                   exit perform
                end-if
             end-if
          end-if
          move "H" to blok-yapabilir2
          exit perform
     end-read
     end-perform.

 grid2-yukle.
     modify Form1-G-1, 
            reset-grid = 1
            mass-update = 1
    
     initialize form1-G-1-record
     move "Oda "        to G-1-col-1
     move "C/Out"       to G-1-col-2
     move "Konum"       to G-1-col-3
     move "Tip1"        to G-1-col-4
     move "HK Statu"    to G-1-col-41

     move "Detaylar"    to G-1-col-5
     move "Tip-2"       to G-1-col-9
     move "Tip-3"       to G-1-col-10
     move "F"           to G-1-col-11  G-1-col-12
     
     move "Tip-3"    to G-1-col-10
     modify form1-G-1,
            record-to-add(form1-G-1-record).
     modify form1-G-1(1),
            x = siralama + 1
            cell-color = 141
*     stop " "           
     move 1 to start-durum
     move low-values    to TAKAS2-rec
     evaluate siralama
     when 1  
          start TAKAS2 key not < TAKAS2-oda invalid 
                move 0 to start-durum
          end-start
     when 2  
     when 3  
          start takas2 key not < takas2-fitler invalid 
                move 0 to start-durum
          end-start
     when 4
          start takas2 key not < takas2-git-zam invalid 
                move 0 to start-durum
          end-start
     when 5
          start takas2 key not < takas2-oda-konumu invalid 
                move 0 to start-durum
          end-start
     when 6
          start takas2 key not < takas2-oda-tipi invalid 
                move 0 to start-durum
          end-start
      when 7                                |asdasd
          start takas2 key not < takas2-oda-duru invalid 
                move 0 to start-durum
          end-start
      when 8
          start takas2 key not < takas2-oda-tipi2 invalid 
                move 0 to start-durum
          end-start
       when 9
          start takas2 key not < takas2-oda-tipi3 invalid 
                move 0 to start-durum
          end-start
     end-evaluate
     if start-durum = 1
     initialize fs-takas2 
     initialize oda-temiz oda-kirli oda-arizali oda-cout oda-dkirli oda-toplam
     move 1 to kay-no
     perform with test after until fs-takas2 = "10"
     read takas2 next no lock end move "10" to fs-takas2
     not at end
         add 1 to kay-no
         perform kayit-detay-ata     
     end-read
     end-perform
     end-if.
     perform alt-toplam-goster     
     modify form1-G-1,
            mass-update = 0.
*
 grid2-yukle-ters.
     modify Form1-G-1, 
            reset-grid = 1
            mass-update = 1
    
     initialize form1-G-1-record
     move "Oda "        to G-1-col-1
     move "C/Out"       to G-1-col-2
     move "Oda Konumu"  to G-1-col-3
     move "Oda Tipi"    to G-1-col-4
     move "Oda Durumu"  to G-1-col-41
     move "Detaylar"    to G-1-col-5
     move "Tip-2"    to G-1-col-9
     move "F"    to G-1-col-11  G-1-col-12
     
     move "Tip-3"    to G-1-col-10
     modify form1-G-1,
            record-to-add(form1-G-1-record).
     modify form1-G-1(1),
            x = siralama + 1
            cell-color = 141

     move 1 to start-durum
     move high-values   to takas2-rec
     evaluate siralama
     when 1  
          start takas2 key not > takas2-oda invalid 
                move 0 to start-durum
          end-start
     when 2  
     when 3  
          start takas2 key not > takas2-fitler invalid 
                move 0 to start-durum
          end-start
     when 4
          start takas2 key not > takas2-git-zam invalid 
                move 0 to start-durum
          end-start
     when 5
          start takas2 key not > takas2-oda-konumu invalid 
                move 0 to start-durum
          end-start
     when 6
          start takas2 key not > takas2-oda-tipi invalid 
                move 0 to start-durum
          end-start
      when 7
          start takas2 key not > takas2-oda-duru invalid 
                move 0 to start-durum
          end-start
      when 8
          start takas2 key not > takas2-oda-tipi2 invalid 
                move 0 to start-durum
          end-start
       when 9
          start takas2 key not > takas2-oda-tipi3 invalid 
                move 0 to start-durum
          end-start
     end-evaluate
     if start-durum = 1
     initialize fs-takas2
     move 1 to kay-no
     perform with test after until fs-takas2 = "10"
     read takas2 previous lock end move "10" to fs-takas2
     not at end
         add 1 to kay-no
         perform kayit-detay-ata     
     end-read
     end-perform
     end-if.
     
     modify form1-G-1,
            mass-update = 0.
*
 tum-yaz.
    display konum-cb-1 konum-cb-2 konum-cb-3 konum-cb-4 konum-cb-5 konum-cb-6 konum-cb-7 konum-cb-8 konum-cb-9 konum-cb-10
            konum-cb-11 konum-cb-12 konum-cb-13 konum-cb-14 konum-cb-15 konum-cb-16 konum-cb-17 konum-cb-18 konum-cb-19 konum-cb-20
            konum-cb-21 konum-cb-22 konum-cb-23 konum-cb-24 konum-cb-25 konum-cb-26 konum-cb-27 konum-cb-28 konum-cb-29 konum-cb-30
            konum-cb-31 konum-cb-32 konum-cb-33 konum-cb-34 konum-cb-35 konum-cb-36 konum-cb-37 konum-cb-38 konum-cb-39 konum-cb-40



       .
*
 Form1-Ex-Other.
     evaluate key-status

       when 2
          if control-id = 1005
             initialize grid-ust-deg
             perform takasla
          end-if 
       when 6
           call "/asya/ytl/obj/otel/blokaj01.asy"
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokaj01.asy" 
               end-call
     
     when 4
         if tumu = 0 then
           open input konum
           move 1 to tumu
           perform varying i from 1 by 1 until i > 40
               if hangi-ref-secildi > 0
                  initialize konum-rec
                  move i   to konum-anahtar
                  read konum no lock invalid 
                       exit perform cycle 
                  not invalid
                      if konum-ref <> hangi-ref-secildi
                         exit perform cycle 
                      end-if 
                  end-read 
               end-if 
               move 1 to konumlar-cb-secili(i)
           end-perform
           close konum
           modify Form1-Pb-1a title = "F4-Sifirla"
           perform tum-yaz
         else
           open input konum
            move 0 to tumu
           perform varying i from 1 by 1 until i > 40
               if hangi-ref-secildi > 0
                  initialize konum-rec
                  move i   to konum-anahtar
                  read konum no lock invalid 
                       exit perform cycle 
                  not invalid
                      if konum-ref <> hangi-ref-secildi
                         exit perform cycle 
                      end-if 
                  end-read 
               end-if 

              move 0 to konumlar-cb-secili(i)
           end-perform
           close konum
           modify Form1-Pb-1a title = "F4-Tumu"
             perform tum-yaz
         end-if
     when 5                                               
        open input rez odalar  cast  castdev takvim kodlar02 konum acenta 
          if takas2-no not = spaces then 
             close takas2
           delete file takas2
          end-if
          
          perform takas2-olustur
          
          perform grid2-yukle
          display Form1-Fr-4
                  Form1-G-2
          if blokaj-boz = 1
             modify form1-G-1,
                    lines = 26.00
          else
             modify form1-G-1,
                    lines = 36.50
          end-if
          close rez odalar  cast castdev takvim kodlar02 konum acenta 
     end-evaluate.
     

 kayit-detay-ata.
    initialize form1-G-1-record.
    move takas2-oda         to G-1-col-1
    if takas2-odau > spaces 
    
    
    move takas2-odau         to G-1-col-1 
    move takas2-oda to G-1-ger
    
    end-if
    move takas2-git-saat    to G-1-col-2

    if takas2-git-saat = spaces continue else 
       move ":"               to G-1-col-2(3:)
    end-if
    move takas2-git-dakika  to G-1-col-2(4:)
    move takas2-oda-konumu  to konum-anahtar
    read konum no lock invalid
         move spaces to konum-adi
    end-read
    move konum-adi         to G-1-col-3.
    move takas2-oda-tipi    to kodlar02-kodu
    move "G"               to kodlar02-tipi
    read kodlar02 no lock invalid
         move spaces to kodlar02-adi
    end-read
    move kodlar02-adi      to G-1-col-4.
    move "C"               to kodlar02-tipi.
    move takas2-oda-durumu  to kodlar02-kodu.
    read kodlar02 no lock invalid
         move "Tanimsiz"   to kodlar02-adi
    end-read
    move kodlar02-adi      to G-1-col-41.
    string   takas2-mus-adi delimited by " "
             " " delimited by size
             takas2-mus-soyadi   delimited by " " 
             into   G-1-col-5
  


    initialize kodlar02-rec
    move "H"               to kodlar02-tipi
    move takas2-oda-tipi2   to kodlar02-kodu
    read kodlar02 no lock invalid
         initialize kodlar02-rec
    end-read
    move kodlar02-adi      to G-1-col-9

    initialize kodlar02-rec
    move "I"               to kodlar02-tipi
    move takas2-oda-tipi3   to kodlar02-kodu
    read kodlar02 no lock invalid
         initialize kodlar02-rec
    end-read
    move kodlar02-adi      to G-1-col-10
    move takas2-bastan-fit  to G-1-col-11
    move takas2-sondan-fit  to G-1-col-12
***********sy***
    evaluate takas2-oda-durumu
            when house-bt 
                add 1 to oda-temiz
            when house-bk
                add 1 to oda-kirli
            when house-co
                add 1 to oda-cout
            when house-ao
                add 1 to oda-arizali
            when house-dk
                add 1 to oda-dkirli
    end-evaluate 
    add 1 to oda-toplam
****************
    modify form1-G-1,
           record-to-add(Form1-G-1-record).
* eger oda kullaným disi ise cell kirmizi
    if takas2-blok-tip = 1 or 2
           modify form1-G-1(kay-no)
              row-color = 240

    else
    if takas2-oda-durumu = house-ao
       modify form1-G-1(kay-no)
              row-color = 176
    else
       if takas2-oda-durumu not = house-bt
          modify form1-G-1(kay-no)
                 row-color = 304
       end-if
    end-if
    end-if.
    if takas2-late = 1 then 

         modify form1-G-1(kay-no,5)
                 cell-color = 555

    end-if.
*
 konumlar-oku.
    initialize i konumlar-cb-bilgiler.
    perform varying i from 1 by 1 until i > 40
            move i to konum-anahtar
            read konum no lock invalid
                 continue
            not invalid
                 if hangi-ref-secildi > 0
                    if konum-ref <> hangi-ref-secildi
                        exit perform cycle 
                    end-if 
                 end-if 
                 if oda-konum-cagir = 0 or
                    oda-konum-cagir = i
                    move 1      to konumlar-cb-secili(i)
                 end-if
                 move konum-adi to konumlar-cb-title(i)
                 move 1         to konumlar-cb-visible(i)
            end-read
    end-perform.

    move 0 to blokaj-boz.
*
 Form1-G-1-Ev-Msg-Heading-Dblclick.
      open input rez odalar  cast castdev takvim  kodlar02 konum acenta 
    if event-data-1 < 2 or 
       event-data-1 > 10
          exit paragraph.
    move event-data-1   to siralama
    subtract 1 from siralama.
    if tersten = 1 then 
         move 0 to tersten
         perform grid2-yukle-ters
      else
           move 1 to tersten
         perform grid2-yukle
    end-if
      close rez odalar  cast castdev takvim kodlar02 konum acenta 
    .
*
 bozulan-blokaj-grid-yukle.
    modify form1-G-2,
           reset-grid = 1
           mass-update = 1
    initialize form1-G-2-record
    move "Rez.No"     to G-2-col-1
    move "Adi"        to G-2-col-2
    move "Soyadi"     to G-2-col-3
    move "Acenta"     to G-2-col-4
    move "C/In"       to G-2-col-5
    move "C/Out"      to G-2-col-6
    move "Oda Konumu" to G-2-col-7
    move "Pax"        to G-2-col-8
    move "Chi"        to G-2-col-9
    move "Beb"        to G-2-col-10
    move "Fre"        to G-2-col-11
    modify form1-G-2,
           record-to-add(form1-G-2-record)
    open i-o  rez cast castdev takvim  kodlar02 odalar konum acenta .
    move 2 to kim-cagirdi-lan-beni
    perform blok-basla.

    modify form1-G-2,
           mass-update = 0.
     close rez cast castdev takvim kodlar02 odalar konum acenta .
*
 rez-to-grid2.
    initialize form1-G-2-record
    move rez-no           to G-2-col-1
    move rez-adi          to G-2-col-2
    move rez-soyadi       to G-2-col-3
    move rez-acenta       to acenta-kodu
    read acenta no lock invalid
         move "Tanimsiz"  to acenta-adi
    end-read
    move acenta-adi       to G-2-col-4
    move rez-gir-gun      to egun
    move rez-gir-ay       to eay
    move rez-gir-yil      to eyil
    move etarih           to G-2-col-5
    move rez-cik-gun      to egun
    move rez-cik-ay       to eay
    move rez-cik-yil      to eyil
    move etarih           to G-2-col-6
    move rez-oda-konumu   to konum-anahtar
    read konum no lock invalid
         move "Tanimsiz"  to konum-adi 
    end-read
    move konum-adi        to G-2-col-7
    move rez-buyuk        to z-3
    move z-3              to G-2-col-8
    move rez-kucuk        to z-3
    move z-3              to G-2-col-9
    move rez-free         to z-3
    move z-3              to G-2-col-10
    move rez-bebek        to z-3
    move z-3              to G-2-col-11.

    modify form1-G-2,
           record-to-add(form1-G-2-record).

*
 Form1-G-1-Ev-Msg-Goto-Cell.
    
    inquire form1-G-1,
            record-data in form1-G-1-record.
    inquire form1-G-1,
            y in aktif-satir.
     modify form1-G-1(aktif-satir),
                     start-y = aktif-satir
                      y =  aktif-satir
                    start-x = 1
                    x = 11
                    region-color = 481
                    
    if blokaj-boz = 1
       move G-1-col-1    to yedek-oda-no
       perform bozulan-blokaj-grid-yukle.
*
 Form1-G-2-Ev-Msg-Begin-Entry.
    move event-action-fail to event-action.
     
     .
*
 Form1-G-1-Ev-Msg-Begin-Entry.
    move event-action-fail to event-action.
    inquire form1-G-1
            record-data in form1-G-1-record.
            |||||
    move G-1-col-1    to odano-cagir new-oda.
     
    if G-1-ger > spaces move     G-1-ger   to odano-cagir end-if
  |  move odano-cagir     to new-oda.
    perform outof-kontrol
    if ariza-bulundu not = 1
       perform blok-son-kont
    end-if 
      if new-oda not = spaces and blokajli-odalar-ciksin = 0
                        modify Form1-gd-1,record-to-delete(ii)
                     end-if
     if rez-sharenum > 0 then
                     
               open i-o takas
               perform share-bak
               close takas
                 
     end-if
       .

*    set exit-pushed to true.
*    call "W$keybuf" using 1, x"1b".
*
 oda-tipleri-yukle.
    initialize G-odatip1-record
               G-odatip2-record
               G-odatip3-record
               odatip-ana-dizi
               G-odatip1-yer
               G-odatip2-yer
               G-odatip3-yer
    move "Oda Tipi"        to G-odatip1-col-2
                              G-odatip2-col-2
                              G-odatip3-col-2

    initialize kodlar02-rec
    modify G-odatip1,
           reset-grid = 1
           mass-update = 1
           record-to-add(G-odatip1-record)
    modify G-odatip2,
           reset-grid = 1
           mass-update = 1
           record-to-add(G-odatip2-record)
    modify G-odatip3,
           reset-grid = 1
           mass-update = 1
           record-to-add(G-odatip2-record)
            inquire Form1-Gd-1(ii,1), cell-data in rez-no
               read rez no lock invalid 
                 inquire Form1-Gd-1(ii,1), cell-data in rez-no
               end-read
       move REZ-ODA-TIPI  to  oda-odatip1-cagir 
        move REZ-ODA-TIPI2 to  oda-odatip2-cagir 
        move REZ-ODA-TIPI3 to  oda-odatip3-cagir
    
    initialize kodlar02-rec
    move "G"         to kodlar02-tipi
    start kodlar02 key not < kodlar02-anah invalid
          continue
    not invalid
    initialize fs-kodlar02
    perform with test after until fs-kodlar02 = "10"
    read kodlar02 next no lock end move "10" to fs-kodlar02
    not at end
         initialize G-odatip1-record
                    G-odatip2-record
                    G-odatip3-record
         evaluate kodlar02-tipi
         when "G" 
                  add 1 to G-odatip1-yer
                  move kodlar02-adi        to G-odatip1-col-2
                  move kodlar02-kodu       to odatip1-tip(G-odatip1-yer)

                  modify G-odatip1,
                         record-to-add(G-odatip1-record)
                  if oda-odatip1-cagir = spaces or 
                     oda-odatip1-cagir = kodlar02-kodu 
                     move "E"       to dummy-x
                                       odatip1-sec(G-odatip1-yer)
                     modify G-odatip1(G-odatip1-yer + 1,1),
                            hidden-data = dummy-x
                            bitmap = yes-bmp
                            bitmap-number = 1
                            bitmap-width = 16
                  end-if
         when "H" 
*             stop " "
                  add 1 to G-odatip2-yer
                  move kodlar02-adi        to G-odatip2-col-2
                  move kodlar02-kodu       to odatip2-tip(G-odatip2-yer)
                  modify G-odatip2,
                         record-to-add(G-odatip2-record)
                  if oda-odatip2-cagir = spaces or 
                     oda-odatip2-cagir = kodlar02-kodu 
                     move "E"       to dummy-x
                                       odatip2-sec(G-odatip2-yer)
                     modify G-odatip2(G-odatip2-yer + 1,1),
                            hidden-data = dummy-x
                            bitmap = yes-bmp
                            bitmap-number = 1
                            bitmap-width = 16
                  end-if
         when "I" 
                  add 1 to G-odatip3-yer
                  move kodlar02-adi        to G-odatip3-col-2
                  move kodlar02-kodu       to odatip3-tip(G-odatip3-yer)
                  modify G-odatip3,
                         record-to-add(G-odatip3-record)
                  if oda-odatip3-cagir = spaces or 
                     oda-odatip3-cagir = kodlar02-kodu 
                     move "E"       to dummy-x
                                       odatip3-sec(G-odatip3-yer)
                     modify G-odatip3(G-odatip3-yer + 1,1),
                            hidden-data = dummy-x
                            bitmap = yes-bmp
                            bitmap-number = 1
                            bitmap-width = 16
                  end-if
         when other
              exit perform
         end-evaluate
    end-read
    end-perform
    end-start.
    modify G-odatip1,
           mass-update = 0
    modify G-odatip2,
           mass-update = 0
    modify G-odatip3,
           mass-update = 0.
    
*
 G-odatip1-Ev-Other.   
    evaluate event-type
    when msg-begin-entry
             
             inquire G-odatip1(event-data-2,1),
                     hidden-data in dummy-x
             move event-action-fail to event-action
             if event-data-2 > max-odatip-occurs
                exit paragraph
             end-if
             if dummy-x = space
                move "E"       to dummy-x
                modify G-odatip1(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                move "E"       to odatip1-sec(event-data-2 - 1)
             else
                move space         to dummy-x
                modify G-odatip1(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = null
                move "H"     to odatip1-sec(event-data-2 - 1)

             end-if
    end-evaluate.
     
     .
*
 G-odatip2-Ev-Other.
    evaluate event-type
    when msg-begin-entry
             inquire G-odatip2(event-data-2,1),
                     hidden-data in dummy-x
             move event-action-fail to event-action
             if event-data-2 > max-odatip-occurs
                exit paragraph
             end-if
             if dummy-x = space
                move "E"       to dummy-x
                modify G-odatip2(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                move "E"       to odatip2-sec(event-data-2 - 1)
             else
                move space         to dummy-x
                modify G-odatip2(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = null
                move "H"     to odatip2-sec(event-data-2 - 1)
             end-if
    end-evaluate.

     
     .
*
 G-odatip3-Ev-Other.
    evaluate event-type
    when msg-begin-entry
             inquire G-odatip3(event-data-2,1),
                     hidden-data in dummy-x
             move event-action-fail to event-action
             if event-data-2 > max-odatip-occurs
                exit paragraph
             end-if

             if dummy-x = space
                move "E"       to dummy-x
                modify G-odatip3(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                move "E"       to odatip3-sec(event-data-2 - 1)
             else
                move space         to dummy-x
                modify G-odatip3(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = null
                move "H"     to odatip3-sec(event-data-2 - 1)
             end-if
    end-evaluate.

*
 odatip-pass-kontrol.
*/ pas gecilecekse 
     initialize dummy-9999 | secilen kayit adedi
*/ eger hepsi secildiyse yada hic biri secilmediyse 
                odatip1-pass-gec
                odatip2-pass-gec
                odatip3-pass-gec
     perform varying dummy-999
             from 1
             by 1
             until dummy-999 > max-odatip-occurs
                   if odatip1-sec(dummy-999) = "H" or space
                      add 1 to dummy-9999
                   end-if
     end-perform
*/ hesp secili ise yada hic biri secýlý degil ise
     if dummy-9999 = 0  or 
        dummy-9999 = max-odatip-occurs
        move 1 to odatip1-pass-gec
     end-if
     initialize dummy-9999
     perform varying dummy-999
             from 1
             by 1
             until dummy-999 > max-odatip-occurs
                   if odatip2-sec(dummy-999) = "H" or space
                      add 1 to dummy-9999
                   end-if
     end-perform
     if dummy-9999 = 0 or
        dummy-9999 = max-odatip-occurs
        move 1 to odatip2-pass-gec
     end-if
     initialize dummy-9999
     perform varying dummy-999
             from 1
             by 1
             until dummy-999 > max-odatip-occurs
                   if odatip3-sec(dummy-999) = "H" or space
                      add 1 to dummy-9999
                   end-if
     end-perform
     if dummy-9999 = 0 or
        dummy-9999 = max-odatip-occurs
        move 1 to odatip3-pass-gec
     end-if.
     
     .
*
 vip-ara.   
    if control-id = 173 and key-status = 01
            initialize infox-cagir
            move "v"   to infox-tipi-cagir
            call "/asya/ytl/obj/otel/vipara.asy" using infox-cagir
               on exception perform callerr-proc
                  not on exception
            cancel "/asya/ytl/obj/otel/vipara.asy" 
            end-call
            move infox-kodu-cagir     to rez-vip-combo-value
            perform vip-goster
    end-if.
* 
 vip-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "v" to kodlar02-tipi
    move rez-vip-combo-value to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to lb-vip-adi
    display acc-viptipi lb-vip
    close kodlar02.
*
 g-odatip1-Ev-Msg-Heading-Clicked.
            modify G-odatip1 mass-update = 1
        
         
            inquire G-odatip1, last-row in max-tip1 
                            
         PERFORM varying ik from 2 by 1 until ik > max-tip1 
               if tip1-acik = 0 then   
                    move "E"       to dummy-x
                     modify G-odatip1(ik,1),
                            hidden-data = dummy-x
                            bitmap = yes-bmp
                            bitmap-number = 1
                            bitmap-width = 16
                        move space         to dummy-x
                      move "E"     to odatip1-sec(ik - 1)
                     else
                    move space     to dummy-x
                        modify G-odatip1(ik,1),
                               hidden-data = dummy-x
                               bitmap = null
                        move "H"     to odatip1-sec(ik - 1)
               end-if
        end-perform   
         if tip1-acik = 0 then          
            move 1 to tip1-acik
            else
             move 0 to tip1-acik

         end-if
               modify G-odatip1, mass-update = 0
     .
*
 g-odatip2-Ev-Msg-Heading-Clicked.
            modify G-odatip2 mass-update = 1
        
         
            inquire G-odatip2, last-row in max-tip2 
                            
         PERFORM varying ik from 2 by 1 until ik > max-tip2 
               if tip2-acik = 0 then   
                    move "E"       to dummy-x
                     modify G-odatip2(ik,1),
                            hidden-data = dummy-x
                            bitmap = yes-bmp
                            bitmap-number = 1
                            bitmap-width = 16
                        move space         to dummy-x
                      move "E"     to odatip2-sec(ik - 1)
                     else
                    move space     to dummy-x
                        modify G-odatip2(ik,1),
                               hidden-data = dummy-x
                               bitmap = null
                        move "H"     to odatip2-sec(ik - 1)
               end-if
        end-perform   
         if tip2-acik = 0 then          
            move 1 to tip2-acik
            else
             move 0 to tip2-acik

         end-if
               modify G-odatip2, mass-update = 0
     .
*
 g-odatip3-Ev-Msg-Heading-Clicked.
             modify G-odatip3 mass-update = 1
            inquire G-odatip3, last-row in max-tip3 
                            
         PERFORM varying ik from 2 by 1 until ik > max-tip3 
               if tip3-acik = 0 then   
                    move "E"       to dummy-x
                     modify G-odatip3(ik,1),
                            hidden-data = dummy-x
                            bitmap = yes-bmp
                            bitmap-number = 1
                            bitmap-width = 16
                        move space         to dummy-x
                      move "E"     to odatip3-sec(ik - 1)
                     else
                    move space     to dummy-x
                        modify G-odatip3(ik,1),
                               hidden-data = dummy-x
                               bitmap = null
                        move "H"     to odatip3-sec(ik - 1)
               end-if
        end-perform   

         if tip3-acik = 0 then          
            move 1 to tip3-acik
            else
             move 0 to tip3-acik

         end-if
               modify G-odatip3, mass-update = 0
     .
*
 g-odatip1-Ev-Msg-Begin-Entry.




             inquire G-odatip1(event-data-2,1),
                     hidden-data in dummy-x
             move event-action-fail to event-action
             if event-data-2 > max-odatip-occurs
                exit paragraph
             end-if

             if dummy-x = space
                move "E"       to dummy-x
                modify G-odatip1(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                move "E"       to odatip1-sec(event-data-2 - 1)
             else
                move space         to dummy-x
                modify G-odatip1(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = null
                move "H"     to odatip1-sec(event-data-2 - 1)
             end-if             
     .     .
*
 g-odatip2-Ev-Msg-Begin-Entry.
          inquire G-odatip2(event-data-2,1),
                     hidden-data in dummy-x
             move event-action-fail to event-action
             if event-data-2 > max-odatip-occurs
                exit paragraph
             end-if

             if dummy-x = space
                move "E"       to dummy-x
                modify G-odatip2(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                move "E"       to odatip2-sec(event-data-2 - 1)
             else
                move space         to dummy-x
                modify G-odatip2(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = null
                move "H"     to odatip2-sec(event-data-2 - 1)
             end-if


     .
*
 g-odatip3-Ev-Msg-Begin-Entry.
           inquire G-odatip3(event-data-2,1),
                     hidden-data in dummy-x
             move event-action-fail to event-action
             if event-data-2 > max-odatip-occurs
                exit paragraph
             end-if

             if dummy-x = space
                move "E"       to dummy-x
                modify G-odatip3(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = yes-bmp
                       bitmap-number = 1
                       bitmap-width = 16
                move "E"       to odatip3-sec(event-data-2 - 1)
             else
                move space         to dummy-x
                modify G-odatip3(event-data-2,1),
                       hidden-data = dummy-x
                       bitmap = null
                move "H"     to odatip3-sec(event-data-2 - 1)
             end-if
     .
*
 outof-kontrol.
     open input outof
     initialize outof-rec ariza-bulundu
     move new-oda     to outof-odano  new-oda-k
      if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to outof-odano  new-oda-k
                                  end-read
                         
                     end-if
     start outof key not < outof-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-outof = "10"
     read outof next no lock end move "10"  to fs-outof
     not at end 
            if outof-odano <> new-oda-k 
                 exit perform 
            end-if
            if outof-bas-tarih >= tarih-tasi AND
               outof-bit-tarih <= tarih-tasi
                display message box outof-odano "'Nolu Oda Blokaja Kapali." new-line
                                                "Lutfen Kontrol Ediniz." new-line
                                                "Oda Notu: " outof-aciklama                                                
                                title "Uyari"
                                icon 1
                move 1 to ariza-bulundu
            end-if
 
     end-read 
     end-perform
     end-start
     close outof
     .
*
 blokaj-degisim-yaz.
       open i-o blokd
       initialize blokd-rec 
       move tarih-tasi           to blokd-tarih
       accept blokd-zaman from time
       move rez-no          to blokd-rez-no
       read blokd no lock invalid 
           continue 
       end-read 
       move k-kodu-tasi        to blokd-k-kodu
       move rez-odano          to blokd-odano
       write blokd-rec invalid 
           rewrite blokd-rec end-rewrite 
       end-write 
       close blokd.


*
 new-o-kisa-bul.
       move new-oda to new-oda-k
      if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move new-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to new-oda-k
                                  end-read
                         
                     end-if

    .
*
 ydk-o-kisa-bul.
      move ydk-oda to ydk-oda-k
      if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move ydk-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to ydk-oda-k
                                  end-read
                         
                     end-if

     .
*
 yed-o-kisa-bul.
      move yed-oda to yed-oda-k
      if genel-uzun-oda-no-kullanilsin = 1 
                        
                                 move yed-oda        to   odalar2-uzun-no
                                 read odalar2 no lock invalid continue
                                 not invalid
                                 move odalar2-no to yed-oda-k
                                  end-read
                         
                     end-if

     .


*
 Form1-Bef-Routine.
      
     .
*
 Form1-Aft-Routine.
      close odalar2
     
     .

 
