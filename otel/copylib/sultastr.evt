* sultastr.evt
* sultastr.evt is generated from F:\asya\acugt.kaya\otel\sultastr.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM exception-procedure
     .
***   start event editor code   ***
*
 Form1-Bef-Create.   
       perform adresleri-tasi .        
*
 before-procedure.     
             .

 Form1-Aft-Initdata.     
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid
          initialize mesaj-link
          move 03 to mesaj-no
          perform mesaj-ver
    not invalid
        continue
    end-read
    close genel
    move muha-sirketi         to hesap-dosya-adres cari-dosya-adres mahsup-dosya-adres.

*      
 exception-procedure. 
     evaluate key-status
          when 2 
               open output trnot
                  perform islem-yap 
               close trnot
               display  message box "Islem Bitti"  
         end-evaluate. 
*
 islem-yap.
        if tanim-value  = 1 then 
*              perform profil-al  
*              perform akonum-al
*              perform aoda-al
*              perform adep-al
*              perform ulke-ac
              perform acenta-al
**              perform vergino-yaz 
        end-if

        if fih-value = 1
            perform fihrist-al
        end-if 
        
        if rez-value  = 1 then 
            open output rez konuk ozluk  polisxml yanrez frez fextra froom  fpans
            close rez konuk ozluk polisxml  yanrez frez fextra froom  fpans  
            open input fulke
               
               perform arez-al 
               perform cin-yap             
           close fulke                                                          
        end-if
        
        
        
*         if cin-value = 1 then 
            
*             perform cin-yap
          
*         end-if
         
         
         if eski-folio-al = 1
*            perform eski-fol
*            perform in-fol
            perform tum-folio-al
         end-if

          if hrk-value = 1 then 
             move 1000000 to uuasya-sira
             perform hrk-al
        end-if
        if hareket-ayir = 1
           perform hareket-ayir
        end-if
        if bakiye-isle = 1
            perform mahsup-borc-isle
            perform mahsup-alacak-isle
        end-if 
        if yan-value = 1 
            perform yan-al
        end-if 
           .

* 
 ulke-ac.
     open input uyruk
     open output ulke fulke
     close ulke fulke
     open i-o ulke fulke
     initialize uyruk-rec ydk-ulke
     start uyruk key not < uyruk-anah invalid
           continue
     not invalid
     perform with test after until fs-uyruk = "10"
     read uyruk next no lock end move "10" to fs-uyruk
     not at end
            add 1 to ydk-ulke
            move uyruk-kodu to fulke-fide-kodu 
            move ydk-ulke   to fulke-asya-kodu ulke-anah
            move uyruk-adi  to ulke-adi
            write ulke-rec invalid if debug = 1 then stop " " end-if end-write
            write fulke-rec invalid stop" " end-write
     end-read
     end-perform
     end-start
     close uyruk ulke fulke
    .
*
 aoda-al.
    move "odano.txt"  to fidetext-adi
    move "odano2.txt" to amontext-adi
    open input fidetext
    open output amontext odalar
     close odalar 
     open i-o odalar  fkonum
     initialize odalar-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(1) not = spaces
       
       move amontext-det(1) to odalar-anah
       move amontext-det(2) to fkonum-fide-kodu
       read fkonum no lock invalid 
            if debug = 1 then stop " " end-if
       end-read

       move fkonum-asya-kodu to odalar-konumu
       move amontext-det(3)  to odalar-tipi
       move amontext-det(4)  to house-durumu odalar-durumu
 
       move amontext-det(11) to odalar-kat



       write odalar-rec end-write 
     end-if
    write amontext-rec end-write
    end-read
    end-perform
    close fidetext close amontext odalar fkonum.
*
 acenta-al.
    move 1             to ydk-acenta ydk-firma
    move 8000000       to ydk-firma-prof ydk-acenta-prof
    move "acenta.txt"  to fidetext-adi
    move "acenta2.txt" to amontext-adi
    open input fidetext
    open output amontext firma acenta facenta ffirma
    close acenta facenta ffirma firma 

     open i-o acenta  hesap cari nt facenta ffirma musteri firma
     initialize acenta-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(1) not = spaces
         
               initialize acenta-rec 
               add 1                                         to ydk-acenta ydk-acenta-prof 
               move ydk-acenta                               to acenta-kodu

               if function numval(amontext-det(24)(1:1)) = 0
                  move 1        to acenta-munferit
               end-if 
               if function numval(amontext-det(24)(1:1)) = 1
                  move 1        to acenta-kredili
               end-if
                  initialize not-rec 
                  move "ACE"       to not-dos
                  move "Default"   to not-dos-anah
                  move acenta-kodu to not-dos-anah(8:)
                  move "01"        to acen-dft-banka
                  move "01"        to acen-dft-doviz
                  move "BB"        to acen-dft-pan-tipi
                  move "02"        to acen-dft-odeme-tipi
                  move "01"        to acen-dft-anlasma
                  move "01"        to acen-dft-pazar
                  move "209"       to acen-dft-ulke
                  move 1           to acen-dft-fix
                  move acen-dft    to not1
                 write not-rec invalid 
                       rewrite not-rec invalid continue
                       end-rewrite 
                 end-write        

               move amontext-det(1)                          to acenta-adi
               move amontext-det(3)                          to acenta-unvani
        
               inspect acenta-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using acenta-adi value 100
        
               inspect acenta-unvani converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using acenta-unvani value 100
        
               move amontext-det(1)                     to facenta-fide-kodu
               move acenta-kodu                         to facenta-asya-kodu
               write facenta-rec invalid 
                   stop " " 
               end-write

               initialize musteri-rec 
               move ydk-acenta-prof                     to musteri-no
               move isyeri-adres-tasi                   to musteri-sirket
               read musteri no lock invalid
                    move acenta-unvani                  to musteri-unvan1
                    move acenta-adi                     to musteri-adi musteri-soyadi

                    move amontext-det(4)                to musteri-adres1
               inspect musteri-adres1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-adres1 value 80

                    move amontext-det(5)                to musteri-adres2
               inspect musteri-adres2 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-adres2 value 80
                    move amontext-det(7)                to musteri-il
               inspect musteri-il converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-il value 50

                    move amontext-det(8)                to musteri-ulke
               inspect musteri-ulke converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-ulke value 50

                    move amontext-det(9)                to musteri-e-mail
               inspect musteri-e-mail converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-e-mail value 100

                    move amontext-det(11)               to musteri-tel1
                    move amontext-det(12)               to musteri-fax
                    move amontext-det(13)               to musteri-arac-model
               inspect musteri-arac-model converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-arac-model value 100

                    move amontext-det(14)               to musteri-vdairesi
               inspect musteri-vdairesi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-vdairesi value 100

                    move amontext-det(15)               to musteri-vno ACENTA-ADRESIM
                    move amontext-det(34)               to musteri-aciklama
               inspect musteri-aciklama converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using musteri-aciklama value 100

***********                   perform cari-hesap-yaz

                    write musteri-rec invalid 
                       if debug = 1 stop " " end-if                          
                    end-write 
                    move musteri-no     to acenta-profil-no
                    move musteri-sirket to acenta-profil-sirket
               end-read 

               write acenta-rec invalid 
                 if debug = 1 stop " " end-if 
               end-write       

     end-if
    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext acenta nt hesap cari 
          facenta ffirma musteri firma.
*
 adep-al.
    move "depart.txt"  to fidetext-adi
    move "depart2.txt" to amontext-adi
    open input fidetext
    open output amontext depkod 
     close depkod  

     open i-o depkod fdepkod
     initialize depkod-rec fdepkod-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(1) not = spaces
 
       move function numval(amontext-det(1))         to z-depanah
       move z-depanah                                to depkod-anah
       move amontext-det(2)                          to depkod-adi
       move function numval(amontext-det(5))         to depkod-kdv
       move "B"                                      to depkod-ba
       move 1                                        to depkod-tipi
       inspect depkod-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using depkod-adi value 30
       write depkod-rec invalid 
         if debug = 1 stop " " end-if 
       end-write 
     end-if
    write amontext-rec end-write
    end-read
    end-perform
          move 195 to depkod-kodu
          move "A" to depkod-ba
          move 2 to depkod-turu
          move 1 to depkod-tipi
          move "CORRECTION (-)  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write


          move 194 to depkod-kodu
          move "B" to depkod-ba
          move 2 to depkod-turu
          move 1 to depkod-tipi
          move "CORRECTION (+)  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

           move 191 to depkod-kodu
          move "B" to depkod-ba
          move 3 to depkod-turu
          move 1 to depkod-tipi
          move "PARA IADE  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

           move 197 to depkod-kodu
          move "A" to depkod-ba
          move 5 to depkod-turu
          move 1 to depkod-tipi
          move "VISA  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

           move 196 to depkod-kodu
          move "A" to depkod-ba
          move 3 to depkod-turu
          move 1 to depkod-tipi
          move "NAKIT  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

          move 199 to depkod-kodu
          move "A" to depkod-ba
          move 4 to depkod-turu
          move 1 to depkod-tipi
          move "CITY LEDGER  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

          move 798 to depkod-kodu
          move "A" to depkod-ba
          move 1 to depkod-turu
          move 1 to depkod-tipi
          move "TRANSFER (-)  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

          move 799 to depkod-kodu
          move "B" to depkod-ba
          move 1 to depkod-turu
          move 1 to depkod-tipi
          move "TRANSFER (+)  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

    close fidetext close amontext depkod .
*
 arez-al.
    move "gunrez.txt"  to fidetext-adi
    move "gunrez2.txt" to amontext-adi

    open output amontext rez yanrez fgrup polisxml prohrk
    close rez yanrez polisxml prohrk fgrup
    open i-o rez  ffirma fmusteri yanrez acenta musteri prohrk fgrup
             polisxml facenta fkonum fidetext

    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 
    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring  fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform     
        initialize rez-rec 
        if amontext-det(1)(1:1) = "W" or
           amontext-det(1)(1:1) = "X" 
              exit perform cycle 
        end-if 
*        if amontext-det(2)(1:1) = "X" and 
*           function numval(amontext-det(1)) = 21672           
*            move "I"               to rez-durumu
*        else 
*           if amontext-det(2)(1:1) = "X"
*               exit perform cycle 
*           end-if
*        end-if
        
     if function numval(amontext-det(2)) not > 0
        if debug = 1 stop " " end-if 
     end-if
     if function numval(amontext-det(2)) > 0        
        initialize yanrez-rec 
        move function numval(amontext-det(2)) to rez-no yanrez-rezno
        move amontext-det(8)(1:2)         to rez-gir-gun
        move amontext-det(8)(4:2)         to rez-gir-ay
        move amontext-det(8)(7:4)         to rez-gir-yil
        move amontext-det(9)(1:2)         to rez-cik-gun
        move amontext-det(9)(4:2)         to rez-cik-ay
        move amontext-det(9)(7:4)         to rez-cik-yil

        
*               initialize ffirma-rec firma-bulundu
*               move amontext-det(7)           to ffirma-fide-kodu
*               read ffirma no lock invalid
*                    continue 
*               not invalid
*                    move ffirma-asya-kodu   to rez-firma
*                    move 1                  to firma-bulundu
* 
*               end-read 

*        if firma-bulundu = 0
           initialize facenta-rec 
           move amontext-det(7)                  to facenta-fide-kodu
           read facenta no lock invalid
                  initialize acenta-rec 
                  add 1                                         to ydk-acenta 
                  move ydk-acenta                               to acenta-kodu
           
                  move "SILINMIS ACENTA"                          to acenta-adi
                  move amontext-det(7)                          to acenta-unvani
           
                  move amontext-det(7)                     to facenta-fide-kodu
                  move acenta-kodu                         to facenta-asya-kodu
                  write facenta-rec invalid 
                      stop " " 
                  end-write
           
                  write acenta-rec invalid 
                    if debug = 1 stop " " end-if 
                  end-write 
           end-read
            move facenta-asya-kodu   to rez-acenta
*        end-if 

        move amontext-det(21)    to rez-adi yanrez-adi
        move amontext-det(22)    to rez-soyadi yanrez-soyadi
        move 1                   to rez-tipi
        move "I"                 to rez-durumu

       inspect rez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-adi value 100
       inspect rez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-soyadi value 100


       inspect yanrez-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using yanrez-adi value 100

       inspect yanrez-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using yanrez-soyadi value 100

           move amontext-det(4)        to rez-odano

           move amontext-det(12)        to fkonum-fide-kodu
           read fkonum no lock invalid 
*                if debug = 1 then stop " " end-if
                move 1             to fkonum-asya-kodu
           end-read
           move fkonum-asya-kodu   to rez-fiyat-konumu

           initialize fkonum-rec
           move amontext-det(12)    to fkonum-fide-kodu
           read fkonum no lock invalid 
*                if debug = 1 then stop " " end-if
                move 1             to fkonum-asya-kodu
           end-read
           move fkonum-asya-kodu   to rez-oda-konumu

           move function numval (amontext-det(35))   to rez-buyuk
           move function numval (amontext-det(36))   to rez-kucuk
           move function numval (amontext-det(39))   to rez-bebek



           move amontext-det(14)(1:2) to rez-al-gun
           move amontext-det(14)(4:2) to rez-al-ay
           move amontext-det(14)(7:4) to rez-al-yil
           move 01                    to rez-banka
           move "K"                   to rez-k-g-b
           move amontext-det(49)      to fulke-fide-kodu
           read fulke no lock invalid 
               move 001               to fulke-asya-kodu
           end-read

           move fulke-asya-kodu       to rez-ulke
           move 01                    to rez-pazar
           move "G"                   to REZ-KUR-AYGUN
           move 01                    to rez-anlasma
           move 02                    to rez-odeme-tipi
           move amontext-det(13)      to rez-pan-tipi

           if amontext-det(28)(1:3) = "EUR"
              move 02        to rez-doviz
           end-if

           if amontext-det(28)(1:3) = "USD"
              move 03        to rez-doviz
           end-if

           if amontext-det(28) = "TL"
              move 01        to rez-doviz
           end-if

           move function numval(amontext-det(29))   to rez-fiyati

           move amontext-det(41)(1:20)              to rez-not1
           inspect rez-not1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-not1 value 100
           
           move amontext-det(41)(20:)               to rez-not2
           inspect rez-not2 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using rez-not2 value 100

           CALL "C$JUSTIFY" USING amontext-det(26), "R"
           inspect amontext-det(26) replacing all "." by ","

           move function numval(amontext-det(26))   to rez-cin-kuru
           move rez-buyuk                           to rez-s-d-t-g
           if rez-buyuk > 4 then 
               move 4 to rez-s-d-t-g 
           end-if
           inspect amontext-det(20) converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
****              call "c$toupper" using amontext-det(20) value 100

           if amontext-det(20) not = spaces
              initialize fmusteri-rec 
              move amontext-det(20)                     to fmusteri-fide-kodu
              read fmusteri no lock invalid
                   initialize musteri-rec 
                   add 1                                to musteri-no 
                   move isyeri-adres-tasi               to musteri-sirket
                   read musteri no lock invalid
                      move rez-adi                      to musteri-adi
                      move rez-soyadi                   to musteri-soyadi
                      write musteri-rec invalid
                          if debug = 1 stop " " end-if 
                      end-write
                   not invalid 
                       continue 
                   end-read

                   move musteri-no                      to fmusteri-asya-kodu
                   move amontext-det(20)                to fmusteri-fide-kodu
                   write fmusteri-rec invalid 
                       if debug = 1 stop " " end-if 
                   end-write 
              end-read 
              move fmusteri-asya-kodu                   to yanrez-profil-no
           end-if 


        move isyeri-adres-tasi                       to yanrez-profil-sirket
        move 1                                       to yanrez-sirano

*        move function numval(amontext-det(47)) to ydk-master
*        if ydk-master > 0 then 
*               move ydk-master                 to rez-grup-no
*               string rez-grup-adi delimited by " "                
*                      rez-adi    delimited by " "
*                      " "        delimited by size
*                      rez-soyadi delimited by " "
*               into rez-grup-adi
           initialize fgrup-rec
           move rez-no                             to fgrup-rez-no
           move function numval(amontext-det(6))   to fgrup-grup-no

           write fgrup-rec invalid 
              if debug = 1 stop " " end-if
           end-write 
*        end-if

        move "E"                to rez-fiyat-fix

        write yanrez-rec invalid 
              if debug = 1 then stop " " end-if 
        end-write 
        move amontext-det(1)(1:1)  to REZ-E-MAIL(1:1)
        write rez-rec invalid 
              if debug = 1 then stop " " end-if 
        end-write 
          perform polisxml-at
          perform prohrk-kaydet
     end-if    
    end-read
    end-perform              
    close amontext ffirma fidetext rez yanrez  
          prohrk fgrup musteri acenta fmusteri polisxml facenta fkonum.
*
 akonum-al.
    move "odakonum.txt" to fidetext-adi
    move "odakonu2.txt" to amontext-adi
    open input fidetext
    open output amontext konum fkonum
     close konum fkonum
     open i-o konum  fkonum
     initialize konum-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
    move amontext-det(2)                      to Fkonum-FIDE-KODU        
    move amontext-det(2)                      to konum-adi
    move function numval(amontext-det(5))     to KONUM-TOP-ODA konum-hazir-oda 

    if amontext-det(1) not = spaces and 
       amontext-det(2) not = spaces then 
            add 1                to konum-anahtar
            move amontext-det(2) to Fkonum-FIDE-KODU
            move konum-anahtar   to fkonum-asya-kodu
            write konum-rec end-write 
            write fkonum-rec invalid if debug = 1 then stop " " end-if end-write        
    end-if

    write amontext-rec end-write
    end-read
    end-perform
    close fidetext close amontext konum fkonum.


*
 cin-yap.
     open i-o rez 
     open output  konuk ozluk 
     close  konuk ozluk
     open i-o frez konuk ozluk
     initialize rez-rec
     start rez key > rez-anah 
       invalid continue
       not invalid
       perform until fs-rez = "10" 
          read rez next no lock 
            end move "10" to fs-rez
            not end

            if rez-gir-tar < tarih-tasi and
               REZ-DURUMU = "I" then
                perform tek-cin
*                PERFORM extra-cin
            end-if 
            if rez-gir-tar = tarih-tasi and 
               rez-e-mail(1:1)  not = "A" and
               REZ-DURUMU = "I" then                 
                perform tek-cin
*                 PERFORM extra-cin
            end-if 
*            if rez-durumu = "S"
*                move 504  to rez-odano
                  
*                perform tek-cin
*                PERFORM extra-cin             
*            end-if




          end-read
       end-perform
      end-start       
      close rez konuk ozluk frez
         .     
*
 tek-cin.
          move rez-no to frez-fide-rez-kodu  frez-asya-rez-kodu
          initialize konuk-rec ozluk-rec
          move fol-sira to frez-asya-rfolio-kodu konuk-folio ozluk-folio
          add 1 to fol-sira
          perform oda-cin
          move fol-sira to frez-asya-efolio-kodu
          add 1 to fol-sira
          write frez-rec invalid if debug = 1 then stop " " end-if end-write.
*
 extra-cin.         
    move  frez-asya-efolio-kodu to konuk-folio ozluk-folio ozluk2-folio.         
    move cinpara-ext-fol-banka  to banka-kodu.     
    move cinpara-ext-fol-doviz  to doviz-kodu.                   
    move cinpara-ext-fol-ode    to kodlar02-kodu. 
          move rez-no to konuk-extra-rez-no
         
          move "I"  to  konuk-durumu 
*          if konuk-git-tar <= tarih-tasi          
          if rez-e-mail(1:1) = "O"
              move "H"                   to konuk-durumu
          end-if


          move "E"                       to konuk-fol-kodu. 
          move konuk-adi(1:17)           to konuk-adi(04:17). 

          move "E=>"                     to konuk-adi(01:03). 
***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar   konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno . 
          move konuk-durumu         to  ozluk-durumu. 
          move konuk-adi            to  ozluk-adi(04:17). 
          move "E=>"                to  ozluk-adi(01:03). 
          write konuk-rec invalid if debug = 1 then stop " " end-if
          end-write.                         
          write ozluk-rec invalid if debug = 1 then stop " " end-if
          end-write.
*
 oda-cin.
    move rez-no              to konuk-rez-no ozluk-rez-no
    move rez-adi             to konuk-adi ozluk-adi 
    move rez-soyadi          to konuk-soyadi ozluk-soyadi
    move rez-s-d-t-g         to konuk-s-d-t-g 
    move rez-oda-konumu      to konuk-oda-konumu 
    if rez-fiyat-konumu = 0 then 
       move rez-oda-konumu   to rez-fiyat-konumu
    end-if
    move rez-fiyat-konumu    to konuk-fiyat-konumu 
    move rez-odeme-tipi      to konuk-odeme-tipi 
    move rez-odano           to konuk-odano  
    move rez-ulke            to konuk-ulke 
    move rez-buyuk           to konuk-buyuk  
    move rez-kucuk           to konuk-kucuk  
    move rez-free            to konuk-free   

    move rez-bebek           to konuk-bebek 
    move rez-acenta          to konuk-acenta 
    move rez-grup-no         to konuk-grup-no 
    move rez-voucher         to konuk-voucher 
    move rez-fiyat-konumu    to konuk-fiyat-konumu 
    move rez-nor-indirim     to konuk-nor-indirim 
    move rez-pan-tipi        to konuk-pan-tipi
    move rez-tipi            to konuk-rez-tipi 
    move rez-banka           to konuk-banka
    move rez-doviz           to konuk-doviz 
    move rez-anlasma         to konuk-anlasma
    move rez-pazar           to konuk-pazar
    move rez-share           to konuk-share
    move rez-eb              to konuk-eb
    move rez-ug-ind          to konuk-ug-indirimi
    move rez-fiyat-fix       to konuk-fiyat-fix
    move rez-kur-aygun       to konuk-kur-aygun
*    move rez-firma           to konuk-firma 
    move rez-cin-kuru        to konuk-kur-DEGERI
    move rez-bilbord-eh      to konuk-bilbord-eh
    move REZ-AKSIYON-EH      to konuk-AKSIYON-EH  
    move REZ-share           to konuk-share
    move rez-vip             to konuk-vip
    move rez-gir-tar         to konuk-gel-tar 
    move rez-cik-tar         to konuk-git-tar 
    move rez-not1            to konuk-acik-1
           inspect konuk-acik-1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
           to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using konuk-acik-1 value 100
    
*    move rez-not2            to konuk-acik-2
*           inspect konuk-acik-2 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
*           to x"8DA69A9E989980879FA7818D94"
*              call "c$toupper" using konuk-acik-2 value 100
    move rez-gel-saat        to konuk-gel-saat
    move rez-gel-dak         to konuk-gel-dakika
    move rez-late-zaman      to konuk-late-zaman

    move rez-git-saat        to konuk-git-saat
    move rez-git-dak         to konuk-git-dakika

    move "I"                 to konuk-durumu
*     if konuk-git-tar <= tarih-tasi
     if rez-e-mail(1:1) = "O"
         move "H"                 to konuk-durumu
     end-if


    move "R"                 to konuk-fol-kodu. 
         initialize rez-ucreti tl-toplam dv-toplam. 
    move rez-fiyati          to rez-ucreti dv-toplam konuk-dv-degeri
                     
****>Ozluk Bilgileri ataniyor.....
    move rez-adres1          to ozluk-adres1.
    move rez-adres2          to ozluk-adres2.
    move konuk-folio         to rez-folio
              
    move "E"                 to rez-c-in
    rewrite rez-rec invalid if debug = 1 then stop " " end-if  end-rewrite
    compute  konuk-oda-tutar  rounded = REZ-FIYATI * konuk-kur-degeri          
    write konuk-rec  invalid if debug = 1 then stop " " end-if end-write
    write ozluk-rec  invalid if debug = 1 then stop " " end-if end-write
      .

*****************************************




         .    
*****************************************   
*****************************************
*

             
*
 hata-goster.
    call "c$rerr" using extend-stat text-message 1.
    move extend-stat       to fileerr-linkage-hata-no.
    move Secondary-Error   to fileerr-linkage-secondary-hata-no.
    call "c$rerrname" using fileerr-linkage-dosya-adi.
    display message box "DOSYA : ",fileerr-linkage-dosya-adi,
    x"0a0d","errrrror :",fileerr-linkage-hata-no,x"0ad0",
    "error2 :",fileerr-linkage-secondary-hata-no.
    set exit-pushed to true
    if debug = 1 then stop " " end-if
    .       

*
 fihrist-al.
    move 1             to ydk-acenta
    move "fihrist.txt"  to fidetext-adi
    move "fihrist2.txt" to amontext-adi
    open input fidetext
    open output amontext fihrist
    close fihrist 

     open i-o fihrist   
     initialize fihrist-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(1) not = spaces

       initialize fihrist-rec 
       move function numval(amontext-det(1))                          to fihrist-no

       move amontext-det(2)                          to FIHRIST-SOYADI
       move amontext-det(3)                          to FIHRIST-ADI

       inspect FIHRIST-SOYADI converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using FIHRIST-SOYADI value 100

       inspect FIHRIST-ADI converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using FIHRIST-ADI value 100

       move amontext-det(12)                     to FIHRIST-TELEFON
       move amontext-det(5)                      to FIHRIST-ADRES-1
       inspect FIHRIST-ADRES-1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using FIHRIST-ADRES-1 value 100
       move amontext-det(15)                     to FIHRIST-MOBIL-TEL
       move amontext-det(16)                     to FIHRIST-fax
       move amontext-det(21)                     to FIHRIST-UNVANI
       move amontext-det(33)                     to FIHRIST-IL
       move amontext-det(34)                     to FIHRIST-ulke
       inspect FIHRIST-ulke converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using FIHRIST-ulke value 100

       move amontext-det(23)                     to FIHRIST-email
       write fihrist-rec invalid 
         if debug = 1 stop " " end-if 
       end-write 
     end-if

    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext fihrist  
     .

*
 profil-al.
    move 900000        to ydk-mus-no
    move "client.txt"  to fidetext-adi
    move "client2.txt" to amontext-adi
    open input fidetext
    open output amontext musteri fmusteri 
    close fmusteri musteri 

     open i-o musteri fmusteri  
     initialize musteri-rec  fmusteri-rec 
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 
    if amontext-det(1)(1:1) = "." or
       amontext-det(1)(1:1) = "#" or
       amontext-det(1)(1:1) = "*" or
       amontext-det(1)(1:1) = "0" 
          exit perform cycle 
    end-if             
     if amontext-det(1) not = spaces

       initialize musteri-rec 
       move isyeri-adres-tasi                 to musteri-sirket
       add 1                                  to ydk-mus-no
       move ydk-mus-no                        to musteri-no 
*       move function numval(amontext-det(1))  to 

       move amontext-det(2)                   to musteri-soyadi



       inspect musteri-soyadi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-soyadi value 100

       move amontext-det(3)                   to musteri-adi
       inspect musteri-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-adi value 100

       move amontext-det(5)                   to musteri-adres1 musteri-kim-adrs

       inspect musteri-adres1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-adres1 value 100
       inspect musteri-kim-adrs converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-kim-adrs value 100

       move amontext-det(6)                   to musteri-adres2 musteri-kim-adrs1
       inspect musteri-adres2 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-adres2 value 100
       inspect musteri-kim-adrs1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-kim-adrs1 value 100

       move amontext-det(9)                  to musteri-ilce
       inspect musteri-ilce converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-ilce value 100
 
       move amontext-det(10)                  to musteri-il
       inspect musteri-il converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-il value 100

       move amontext-det(11)                  to musteri-ulke
       move amontext-det(12)                  to musteri-tel1
       move amontext-det(13)                  to musteri-tel2       
       move amontext-det(14)                  to musteri-gsm
       move amontext-det(15)                  to musteri-fax
       move amontext-det(16)                  to musteri-kim-uyruk
       move amontext-det(18)                  to musteri-unvan1
       inspect musteri-unvan1 converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-unvan1 value 100

       move amontext-det(19)                  to musteri-vdairesi
       inspect musteri-vdairesi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-vdairesi value 100

       move amontext-det(20)                  to musteri-vno
       move amontext-det(21)(1:1)             to musteri-b-turu
       move amontext-det(22)                  to musteri-seri-no
       move amontext-det(25)                  to musteri-kim-mahalle
       inspect musteri-kim-mahalle converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-kim-mahalle value 100

       move amontext-det(26)                  to musteri-kim-ilce
       inspect musteri-kim-ilce converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-kim-ilce value 100

       move amontext-det(27)                  to musteri-kim-il
       inspect musteri-kim-il converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-kim-il value 100

       move amontext-det(28)                  to musteri-d-yeri
       inspect musteri-d-yeri converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-d-yeri value 100
       move amontext-det(29)(1:2)             to musteri-dgun
       move amontext-det(29)(4:2)             to musteri-day
       move amontext-det(29)(7:4)             to musteri-dyil
       move amontext-det(30)                  to musteri-baba-adi
       inspect musteri-baba-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-baba-adi value 100

       move amontext-det(31)                  to musteri-ana-adi
       inspect musteri-ana-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-ana-adi value 100
       move amontext-det(35)                  to musteri-aciklama
       inspect musteri-aciklama converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-aciklama value 100

       move amontext-det(36)                  to musteri-plaka
       move amontext-det(50)                  to musteri-e-mail
       inspect musteri-e-mail converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using musteri-e-mail value 100

       move amontext-det(58)(1:1)              to musteri-cinsiyet musteri-kim-cinsiyet
       move amontext-det(59)(1:1)              to musteri-kim-medeni
       move amontext-det(60)                   to musteri-kim-cilt
       move amontext-det(61)                   to musteri-kim-aile-no
       move amontext-det(62)                   to musteri-kim-sira-no
       move function numval(amontext-det(63))  to musteri-kim-tcno
       
       write musteri-rec invalid 
         if debug = 1 stop " " end-if 
       end-write 
       initialize fmusteri-rec 

       inspect amontext-det(1) converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
****              call "c$toupper" using amontext-det(1) value 100
       move musteri-no                         to fmusteri-asya-kodu
       move amontext-det(1)                    to fmusteri-fide-kodu
       write fmusteri-rec invalid
         if debug = 1 stop " " end-if              
       end-write

     end-if

    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext musteri fmusteri 
    .
*
 polisxml-at.

                     initialize musteri-rec polisxml-rec
                     move yanrez-rezno       to polisxml-rezno
                     move yanrez-sirano      to polisxml-sirano
                     move yanrez-profil-anah to m-profil
 
                     read musteri no lock invalid 
                        display "update edilecek polis kaydi yok"
                     not invalid
                          move musteri-adi            to polisxml-adi
                       move musteri-soyadi            to polisxml-soyadi
                       move musteri-kim-tcno          to polisxml-tckimlikno          
                       move musteri-kim-uyruk         to polisxml-uyruk      
                       move musteri-kim-cinsiyet      to polisxml-cinsiyet   
                       move musteri-kim-medeni        to polisxml-medeni
                       string 
                         musteri-kim-adrs    delimited by "   "
                          musteri-kim-adrs1    delimited by "   "
                      
                       into polisxml-adr
                       MOVE musteri-d-tarihi          to polisxml-dog-tar
               
                       move musteri-b-turu            to polisxml-kturu         
                       move musteri-seri-no           to polisxml-kseri        
                       move musteri-baba-adi          to polisxml-babaadi       
                       move musteri-ana-adi           to polisxml-anaadi        
                       move musteri-d-yeri            to polisxml-dyeri         
                       move musteri-kim-il            to polisxml-nil         
                       move musteri-kim-ilce          to polisxml-nilce       
                       move musteri-kim-mahalle       to polisxml-nmahalle    
                       move musteri-kim-cilt          to polisxml-ncilt       
                       move musteri-kim-aile-no       to polisxml-naile    
                       move musteri-kim-sira-no       to polisxml-nsira  
                      
                       move musteri-prb-ack           to polisxml-prb
                       write polisxml-rec invalid 
                         if debug = 1 stop " " end-if                                           
                       end-write 
                     end-read.

*
 prohrk-kaydet.                   


        initialize prohrk-rec 
        move m-profil                to prohrk-profil-anah
*        move must       to prohrk-profil-no
        move isyeri-adres-tasi       to prohrk-rez-sirket  
        move rez-no                  to prohrk-rez-no 
               



           move yanrez-sirano         to  prohrk-rez-sira       
           move musteri-adi     to  prohrk-pro-adi       
           move musteri-soyadi  to  prohrk-pro-soyadi    
           move rez-acenta      to  prohrk-acenta       
           move rez-gir-tar     to  prohrk-gel-tar
           move rez-cik-tar     to  prohrk-git-tar
           move rez-banka       to  prohrk-banka  
           move rez-doviz       to  prohrk-doviz 
           move rez-pan-tipi    to  prohrk-pans     
           move rez-pazar       to  prohrk-pazar
           move rez-ulke        to  prohrk-ulke 
           move rez-voucher     to  prohrk-voucher
           move rez-odano       to  prohrk-odano


           accept  prohrk-duz-tarih from century-date 
           move isyeri-adres-tasi       to prohrk-rez-sirket
           move rez-no             to prohrk-rez-no
             write prohrk-rec invalid
                 rewrite prohrk-rec end-rewrite
             end-write.
*
 tum-folio-al.
    move 900000        to fol-sira
    move "tumfol.txt"  to fidetext-adi
    move "tumfol2.txt" to amontext-adi
    open input fidetext
    open output amontext ffolio ozluk2
    close ffolio  ozluk2

     open i-o ffolio konuk rez acenta 
              ozluk ffirma ozluk2 odalar facenta 
     initialize ffolio-rec konuk-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
     if function numval(amontext-det(26)) > 1
        perform extra-ac2-3
     else
        perform folio-kontol 
     end-if              

    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext konuk ffolio rez ffirma acenta 
          facenta ozluk ozluk2 odalar
     .
*
 folio-kontol.
     if amontext-det(1) not = spaces
       initialize rez-rec 
       move function numval(amontext-det(21))   to rez-no
       read rez no lock invalid
***           display message box "Rez No:"rez-no " bulunamadi"new-line
***                               "Amonra Folio No  " amontext-det(1)
*           if debug = 1 stop "rez"  end-if
           move amontext-det(1)   to amontext-det(3)
           move "REZ YOK"         to konuk-soyadi
            perform extra-ac2-3 
       not invalid
           initialize konuk-rec 
           move rez-folio      to konuk-folio
           read konuk no lock invalid
              if debug = 1 stop "konuk"  end-if
           not invalid
              if rez-odano = spaces
                 move amontext-det(2) to rez-odano konuk-odano
                 rewrite rez-rec invalid stop " " end-rewrite 
                 rewrite konuk-rec invalid stop " " end-rewrite 
              end-if 
              move function numval(amontext-det(21))   to ffolio-rez 
              move konuk-folio                         to ffolio-asya-folio
              move function numval(amontext-det(1))    to ffolio-fide-folio
              move function numval(amontext-det(26))        to ffolio-tip

              if function numval(amontext-det(26)) = 1 
                   move function numval(amontext-det(23))   to ffolio-grup
              end-if

               write ffolio-rec invalid 
                 if debug = 1 stop " " end-if 
               end-write 

           end-read 
       end-read
     end-if.
*
 extra-ac2-3.
     add 1                                       to fol-sira 
     move fol-sira                               to ffolio-asya-folio 
     move ffolio-asya-folio                      to konuk-folio ozluk-folio ozluk2-folio.         
     move function numval(amontext-det(26))      to ffolio-tip
     move function numval(amontext-det(1))       to ffolio-fide-folio 

*     move amontext-det(1)                        to konuk-voucher
     if function numval(amontext-det(26)(1:1)) = 2
        move amontext-det(21)                    to konuk-voucher|amonra rez no 
     end-if 

     move cinpara-ext-fol-banka                  to banka-kodu     
     move cinpara-ext-fol-doviz                  to doviz-kodu                   
     move cinpara-ext-fol-ode                    to kodlar02-kodu 

     if amontext-det(2)(5:2) = "-A" or 
        amontext-det(2)(1:1) = "T" or
        amontext-det(2)(1:2) = "G-" or
        amontext-det(2)(1:2) = "Z-" 

        initialize odalar-rec 
        move amontext-det(2)(1:4)      to odalar-anah 
        read odalar no lock invalid
           move 9999                   to odalar-anah  
        end-read
        move odalar-anah               to konuk-odano
     else
           move 9999                   to konuk-odano   
     end-if

          move "E"                     to konuk-fol-kodu. 
          move "E=>"                   to konuk-adi(01:03) 
          
          move amontext-det(3)         to konuk-adi(04:17)
          move amontext-det(4)         to konuk-soyadi
       inspect konuk-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using konuk-adi value 100
          
          initialize  konuk-rez-no 
          konuk-kisi    konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar   konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-top-borc konuk-top-alac konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar   konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno  



          move konuk-durumu          to ozluk-durumu. 

          move amontext-det(5)(1:2)  to konuk-gel-gun
          move amontext-det(5)(4:2)  to konuk-gel-ay
          move amontext-det(5)(7:4)  to konuk-gel-yil
          move amontext-det(6)(1:2)  to konuk-git-gun
          move amontext-det(6)(4:2)  to konuk-git-ay
          move amontext-det(6)(7:4)  to konuk-git-yil

          if konuk-git-tar <= tarih-tasi          
              move "H"                 to konuk-durumu
          else
              move "I"                 to konuk-durumu             
          end-if
          
*               initialize ffirma-rec firma-bulundu
*               move amontext-det(7)           to ffirma-fide-kodu
*               read ffirma no lock invalid
*                    continue 
*               not invalid
*                    move ffirma-asya-kodu   to konuk-firma
*                    move 1                  to firma-bulundu 
*               end-read 

*        if firma-bulundu = 0
           initialize facenta-rec 
           move amontext-det(7)                  to facenta-fide-kodu
           read facenta no lock invalid
                  initialize acenta-rec 
                  add 1                                         to ydk-acenta 
                  move ydk-acenta                               to acenta-kodu
           
                  move "SILINMIS ACENTA"                          to acenta-adi
                  move amontext-det(7)                          to acenta-unvani
           
                  move amontext-det(7)                     to facenta-fide-kodu
                  move acenta-kodu                         to facenta-asya-kodu
                  write facenta-rec invalid 
                      stop " " 
                  end-write
           
                  write acenta-rec invalid 
                    if debug = 1 stop " " end-if 
                  end-write 
           end-read
            move facenta-asya-kodu   to konuk-acenta
*        end-if          
*          initialize facenta-rec 
*          move amontext-det(7) to facenta-fide-kodu
*          read facenta no lock invalid
*               if debug = 1 stop " " end-if 
*          end-read
*          move facenta-asya-kodu    to konuk-acenta

          move "AL"                 to konuk-pan-tipi
          move amontext-det(3)      to ozluk-adi(04:17). 
          move "E=>"                to ozluk-adi(01:03). 
          move 01                   to konuk-odeme-tipi
          move banka-kodu           to konuk-banka
          move 01                   to konuk-anlasma
          move 01                   to konuk-pazar
          move 001                  to konuk-ulke
          move 01                   to konuk-doviz
               write ffolio-rec invalid 
                 if debug = 1 then stop " " end-if
               not invalid

                  write konuk-rec invalid if debug = 1 then stop " " end-if
                  end-write                         
                  write ozluk-rec invalid if debug = 1 then stop " " end-if
                  end-write

               end-write 

     .
*
 hrk-al.
    move "vfolall.txt"  to fidetext-adi
    move "vfolall2.txt" to amontext-adi
    open input fidetext
    open output amontext   romhrk exthrk yromhrk hrk2
    close    romhrk exthrk yromhrk hrk2 

     open i-o ffolio konuk rez ozluk depkod yromhrk hrk2
              ozluk2 odalar facenta romhrk exthrk 
     initialize ffolio-rec konuk-rec 

     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
*      if function numval(amontext-det(2)) = 81844 stop " " end-if 
                  inspect amontext-det(15) replacing all "." by ","
                  inspect amontext-det(16) replacing all "." by ","

       if amontext-det(9)(1:2) = "T-"
            
           evaluate true
           when function numval(amontext-det(15)) > 0 or 
                function numval(amontext-det(16)) < 0
                   
                
                    if amontext-det(2) > 0       
                       initialize romhrk-rec exthrk-rec ffolio-rec
                       move function numval(amontext-det(2))        to ffolio-fide-folio
                       read ffolio no lock invalid
                            if debug = 1 stop "ffolio" end-if 
                       end-read
                           initialize konuk-rec 
                           move ffolio-asya-folio  to konuk-folio
                           read konuk no lock invalid
                                if debug = 1 stop "konuk" end-if
                           end-read                



                          add 1                       to uuasya-sira         
                          initialize romhrk-rec
                          compute romhrk-tl-tutar = function numval(amontext-det(15)) - function numval(amontext-det(16))
                          move amontext-det(5)(1:2)   to romhrk-gun
                          move amontext-det(5)(4:2)   to romhrk-ay
                          move amontext-det(5)(7:4)   to romhrk-yil
                          move uuasya-sira            to romhrk-islem
                          move konuk-folio            to romhrk-folio
                          move "M"                    to ROMHRK-ISLEM-TIPI
        

                                  
        
*                          if function numval(amontext-det(18)) > 0
                       move 799                       to romhrk-depkod
*                       move function numval(amontext-det(18)) to ROMHRK-TL-TUTAR
                       move "B"                               to romhrk-ba
*                          else
*                             move 195               to romhrk-depkod
*                             move depkod-anah       to romhrk-corr-depkod
*                             compute romhrk-tl-tutar = function numval(amontext-det(18)) * -1
*                             move "A"                               to romhrk-ba
*                          end-if
                
                          move amontext-det(6)(1:2)   to romhrk-saat
                          move amontext-det(6)(4:2)   to romhrk-dakika
                          move amontext-det(6)(7:2)   to romhrk-saniye
        
                          if KONUK-FOL-KODU = "R"
                           write romhrk-rec invalid
                                if debug = 1 stop "romhrk" end-if
                           end-write 
        
                          else
                           move romhrk-rec   to exthrk-rec  
        
        
                           write exthrk-rec invalid 
                                if debug = 1 stop "exthrk" end-if                    
                           end-write 
                          end-if
        
                          move romhrk-anah    to hrk2-ANAH
                          move romhrk-folio   to hrk2-kaynak-folio
                          move romhrk-rec     to yromhrk-rec
                          move romhrk-folio   to yromhrk-kaynak-folio
                          write hrk2-rec invalid
                             if debug = 1 stop " " end-if
                          end-write 
                          write yromhrk-rec invalid
                             if debug = 1 stop " " end-if
                          end-write 
                    end-if    
           when function numval(amontext-det(15)) < 0 or 
                function numval(amontext-det(16)) > 0
                 
                    
                    if amontext-det(2) > 0       
                       initialize romhrk-rec exthrk-rec ffolio-rec
                       move function numval(amontext-det(2))        to ffolio-fide-folio
                       read ffolio no lock invalid
                            if debug = 1 stop "ffolio" end-if 
                       end-read
                           initialize konuk-rec 
                           move ffolio-asya-folio  to konuk-folio
                           read konuk no lock invalid
                                if debug = 1 stop "konuk" end-if
                           end-read                



                          add 1                       to uuasya-sira         
                          initialize romhrk-rec
                           compute romhrk-tl-tutar = function numval(amontext-det(16)) - function numval(amontext-det(15)) 
                          move amontext-det(5)(1:2)   to romhrk-gun
                          move amontext-det(5)(4:2)   to romhrk-ay
                          move amontext-det(5)(7:4)   to romhrk-yil
                          move uuasya-sira            to romhrk-islem
                          move konuk-folio            to romhrk-folio
                          move "M"                    to ROMHRK-ISLEM-TIPI        
                                  
        
*                          if function numval(amontext-det(18)) > 0
                        move 798                       to romhrk-depkod
*                        move function numval(amontext-det(19)) to ROMHRK-TL-TUTAR
                        move "A"                               to romhrk-ba
*                          else
*                             move 195               to romhrk-depkod
*                             move depkod-anah       to romhrk-corr-depkod
*                             compute romhrk-tl-tutar = function numval(amontext-det(18)) * -1
*                             move "A"                               to romhrk-ba
*                          end-if
                
                          move amontext-det(6)(1:2)   to romhrk-saat
                          move amontext-det(6)(4:2)   to romhrk-dakika
                          move amontext-det(6)(7:2)   to romhrk-saniye
        
                          if KONUK-FOL-KODU = "R"
                           write romhrk-rec invalid
                                if debug = 1 stop "romhrk" end-if
                           end-write 
        
                          else
                           move romhrk-rec   to exthrk-rec  
        
        
                           write exthrk-rec invalid 
                                if debug = 1 stop "exthrk" end-if                    
                           end-write 
                          end-if
        
                          move romhrk-anah    to hrk2-ANAH
                          move romhrk-folio   to hrk2-kaynak-folio
                          move romhrk-rec     to yromhrk-rec
                          move romhrk-folio   to yromhrk-kaynak-folio
                          write hrk2-rec invalid
                             if debug = 1 stop " " end-if
                          end-write 
                          write yromhrk-rec invalid
                             if debug = 1 stop " " end-if
                          end-write 
                    end-if    
           when function numval(amontext-det(15)) = 0 or
                function numval(amontext-det(16)) = 0
                    exit perform cycle 
           when other
               if debug = 1 stop " " end-if 
           end-evaluate
       else
          perform gercek-hareketler
       end-if     

    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext konuk ffolio rez depkod facenta  yromhrk hrk2 ozluk ozluk2 odalar romhrk exthrk.
*
 gercek-hareketler.
    if amontext-det(2) > 0       
       initialize romhrk-rec exthrk-rec ffolio-rec
       move function numval(amontext-det(2))        to ffolio-fide-folio
       read ffolio no lock invalid
            if debug = 1 stop "ffolio" end-if 
       end-read
           initialize konuk-rec 
           move ffolio-asya-folio  to konuk-folio
           read konuk no lock invalid
                if debug = 1 stop "konuk" end-if
           end-read

       if function numval(amontext-det(15)) not = 0 
                  add 1                       to uuasya-sira         
                  initialize romhrk-rec
                  move amontext-det(5)(1:2)   to romhrk-gun
                  move amontext-det(5)(4:2)   to romhrk-ay
                  move amontext-det(5)(7:4)   to romhrk-yil
                  move uuasya-sira            to romhrk-islem
                  move konuk-folio            to romhrk-folio
                  move "M"                    to ROMHRK-ISLEM-TIPI

                          initialize depkod-rec 
                          move function numval(amontext-det(7)) to DEPKOD-KODU
                          read depkod no lock invalid 
                              if debug = 1 stop "depkod" end-if 
                          end-read
                          

                  if function numval(amontext-det(15)) > 0
                     move depkod-anah                       to romhrk-depkod
                     move function numval(amontext-det(15)) to ROMHRK-TL-TUTAR
                     move "B"                               to romhrk-ba
                  else
                     move 195               to romhrk-depkod
                     move depkod-anah       to romhrk-corr-depkod
                     compute romhrk-tl-tutar = function numval(amontext-det(15)) * -1
                     move "A"                               to romhrk-ba
                  end-if
        
                  move amontext-det(6)(1:2)   to romhrk-saat
                  move amontext-det(6)(4:2)   to romhrk-dakika
                  move amontext-det(6)(7:2)   to romhrk-saniye

                  if KONUK-FOL-KODU = "R"
                   write romhrk-rec invalid
                        if debug = 1 stop "romhrk" end-if
                   end-write 

                  else
                   move romhrk-rec   to exthrk-rec  


                   write exthrk-rec invalid 
                        if debug = 1 stop "exthrk" end-if                    
                   end-write 
                  end-if

                  move romhrk-anah    to hrk2-ANAH
                  move romhrk-folio   to hrk2-kaynak-folio
                  move romhrk-rec     to yromhrk-rec
                  move romhrk-folio   to yromhrk-kaynak-folio
                  write hrk2-rec invalid
                     if debug = 1 stop " " end-if
                  end-write 
                  write yromhrk-rec invalid
                     if debug = 1 stop " " end-if
                  end-write 
       end-if

    end-if


       if function numval(amontext-det(16)) not = 0 
                  add 1                       to uuasya-sira         
                  initialize romhrk-rec
                  move amontext-det(5)(1:2)   to romhrk-gun
                  move amontext-det(5)(4:2)   to romhrk-ay
                  move amontext-det(5)(7:4)   to romhrk-yil
                  move uuasya-sira            to romhrk-islem
                  move konuk-folio            to romhrk-folio
                  move "M"                    to ROMHRK-ISLEM-TIPI

*                          initialize depkod-rec 
*                          move function numval(amontext-det(8)) to depkod-anah
*                          read depkod no lock invalid 
*                              if debug = 1 stop " " end-if 
*                          end-read
                  evaluate true
                  when amontext-det(10)(1:2) = "KK"
                       move 197        to depkod-anah
                  when amontext-det(10)(1:3) = "EUR"
                       move 196        to depkod-anah
                  when amontext-det(10)(1:3) = "USD"
                       move 196        to depkod-anah
                  when amontext-det(10)(1:2) = "TL"
                       move 196        to depkod-anah
                  when other
                       move 199        to depkod-anah
                  end-evaluate

                  if function numval(amontext-det(16)) > 0
                     move depkod-anah                       to romhrk-depkod
                     move function numval(amontext-det(16)) to ROMHRK-TL-TUTAR
                     move "A"                               to romhrk-ba
                  else
                     move 194               to romhrk-depkod
                     move depkod-anah       to romhrk-corr-depkod
                     compute romhrk-tl-tutar = function numval(amontext-det(16)) * -1
                     move "B"                               to romhrk-ba
                  end-if
        
                  move amontext-det(6)(1:2)   to romhrk-saat
                  move amontext-det(6)(4:2)   to romhrk-dakika
                  move amontext-det(6)(7:2)   to romhrk-saniye

                  if KONUK-FOL-KODU = "R"
                   write romhrk-rec invalid
                        if debug = 1 stop "romhrk" end-if
                   end-write 
 
                  else
                   move romhrk-rec   to exthrk-rec  


                   write exthrk-rec invalid 
                        if debug = 1 stop "exthrk" end-if                    
                   end-write 
                  end-if
                  move romhrk-anah    to hrk2-ANAH
                  move romhrk-folio   to hrk2-kaynak-folio
                  move romhrk-rec     to yromhrk-rec
                  move romhrk-folio   to yromhrk-kaynak-folio
                  write hrk2-rec invalid
                     if debug = 1 stop " " end-if
                  end-write 
                  write yromhrk-rec invalid
                     if debug = 1 stop " " end-if
                  end-write
       end-if.
*
 grup-ayir.
    open i-o ffolio fgrup exthrk yromhrk hrk2 rez 
    initialize ffolio-rec fgrup-rec
    start ffolio key not < ffolio-anah invalid
          continue 
    not invalid
    perform with test after until fs-ffolio = "10"
    read ffolio next no lock end move "10"  to fs-ffolio
    not at end
            if ffolio-grup > 0
               if ffolio-fide-folio = 79688 stop " " end-if 
                perform grup-sayisi-bul
                perform hareketleri-bol
            end-if
    end-read
    end-perform
    end-start 
    close ffolio fgrup exthrk yromhrk hrk2 rez . 
*
 grup-sayisi-bul.
     initialize fgrup-rec grup-sayisi
     move ffolio-grup         to fgrup-grup-no
     start fgrup key = fgrup-grup-no invalid
           continue 
     not invalid
     perform with test after until fs-fgrup = "10"
     read fgrup next no lock end move "10"  to fs-fgrup
     not at end 
            if fgrup-grup-no = ffolio-grup
               add 1      to grup-sayisi
            else 
               move "10"  to fs-fgrup
            end-if
     end-read
     end-perform
     end-start

     .
*
 hareketleri-bol.
     initialize exthrk-rec 
     move ffolio-asya-folio  to exthrk-folio
     start exthrk key not < exthrk-anah invalid
           continue 
     not invalid
     perform with test after until fs-exthrk = "10"
     read exthrk next no lock end move "10"  to fs-exthrk
     not at end 
             if exthrk-folio = ffolio-asya-folio
                if EXTHRK-BOS(1:1) = "X"
                   exit perform cycle 
                end-if
                if exthrk-depkod > 2 
                   exit perform cycle 
                end-if 
                 move exthrk-rec  to romhrk-rec 

                 initialize yromhrk-rec hrk2-rec
                 move exthrk-anah       to yromhrk-anah hrk2-anah
                 read yromhrk no lock invalid
                     if debug = 1 stop " " end-if 
                 end-read 

                 read hrk2 no lock invalid
                     if debug = 1 stop " " end-if 
                 end-read 

                 delete hrk2 end-delete 
                 delete yromhrk end-delete 
                 delete exthrk end-delete

                 perform hareket-bol2

                     move romhrk-rec     to exthrk-rec 
                     start exthrk key not < exthrk-anah invalid
                           move "10"     to fs-exthrk 
                     not invalid
                          continue 
                     end-start
             else
                 move "10"  to fs-exthrk
             end-if 
     end-read 
     end-perform
     end-start
      .
*
 hareket-bol2.
     move exthrk-tl-tutar             to ara-tutar
     initialize fgrup-rec grup-kacinci kalan-tutar
     move ffolio-grup                 to fgrup-grup-no
     start fgrup key = fgrup-grup-no invalid
           continue 
     not invalid
     perform with test after until fs-fgrup = "10"
     read fgrup next no lock end move "10"  to fs-fgrup
     not at end 
            if fgrup-grup-no = ffolio-grup
                add  1                      to grup-kacinci
                add  1                      to uuasya-sira
                move uuasya-sira            to exthrk-islem yromhrk-islem
                compute exthrk-tl-tutar rounded = ara-tutar / grup-sayisi
                if grup-kacinci = grup-sayisi 
                   compute exthrk-tl-tutar rounded = ara-tutar - kalan-tutar
                else
                   compute kalan-tutar     rounded = kalan-tutar + (ara-tutar / grup-sayisi)
                end-if

                initialize rez-rec
                move fgrup-rez-no           to rez-no
                read rez no lock invalid
                     if debug = 1 stop " " end-if
                end-read
                                              
                initialize hrk2-rec 
                move exthrk-anah            to hrk2-anah
               
                move rez-folio              to hrk2-kaynak-folio

                move exthrk-rec             to yromhrk-rec 
                move rez-folio              to yromhrk-folio 

                write hrk2-rec invalid
                    if debug = 1 stop " " end-if 
                end-write 
                write yromhrk-rec invalid
                    if debug = 1 stop " " end-if 
                end-write 
                move "X"               TO EXTHRK-BOS
                write exthrk-rec invalid
                    if debug = 1 stop " " end-if 
                end-write
            else 
               move "10"  to fs-fgrup
            end-if
     end-read
     end-perform
     end-start 
     .
 
*
 hareket-ayir.
     open i-o konuk rez romhrk exthrk yromhrk hrk2 
     initialize konuk-rec 
     start konuk key not < konuk-anah invalid 
           continue 
     not invalid 
     perform with test after until fs-konuk = "10"
     read konuk next no lock end move "10"  to fs-konuk
     not at end 
             if konuk-fol-kodu = "E" and 
                konuk-voucher not = space
                  perform konuk-bul                 
             else
                exit perform cycle 
             end-if 
             
     end-read 
     end-perform
     end-start
     close konuk rez romhrk exthrk yromhrk hrk2 
     .
*
 konuk-bul.
      initialize rez-rec 
      move function numval(konuk-voucher)  to rez-no
      read rez no lock invalid
           if debug = 1 stop "rez" end-if 
      end-read 

      initialize exthrk-rec 
      move konuk-folio        to exthrk-folio
      start exthrk key not < exthrk-anah invalid
            continue 
      not invalid 
      perform with test after until fs-exthrk = "10"
      read exthrk next no lock end move "10"  to fs-exthrk
      not at end 
              if exthrk-folio = konuk-folio
                 delete exthrk end-delete 
                 perform rom-yaz
              else
                exit perform  
              end-if 
      end-read 
      end-perform 
      end-start.
*
 rom-yaz.
     move exthrk-rec  to romhrk-rec 
     move rez-folio   to romhrk-folio
     write romhrk-rec invalid 
        if debug = 1 stop " " end-if 
     end-write 
    .
*
 mahsup-borc-isle.
    move "bakiye.txt"  to fidetext-adi
    move "bakiye2.txt" to amontext-adi
    open input fidetext
    open output amontext  
     open i-o mahsup facenta acenta cari
     initialize mahsup-rec  ydk-mahsup-no
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
       if function numval(amontext-det(4)) = 0
          exit perform cycle 
       end-if
        initialize facenta-rec
        move amontext-det(1)  to facenta-fide-kodu
        read facenta no lock invalid
            continue  
        not invalid 
            initialize acenta-rec 
            move facenta-asya-kodu        to acenta-kodu
            read acenta no lock invalid
                 if debug = 1 stop " " end-if 
            not invalid 
                 initialize cari-rec
                 move acenta-muhno  to cari-kodu
                 read cari no lock invalid
                      if debug = 1 stop " " end-if 
                 not invalid 
                      initialize mahsup-rec 
                      move cari-kodu         to mahsup-hesap-kodu
                      move tarih-tasi        to mahsup-tarih
                      move 1                 to mahsup-fis-no
                      add 1                  to ydk-mahsup-no
                      move ydk-mahsup-no     to mahsup-fis-sira 
                      set mahsup-tipi-mahsup to true 
                      set mahsup-b-a-borc    to true 
                      move function numval(amontext-det(2))   to mahsup-tutar
                      move "Acilis Kaydi Geregi"     to mahsup-aciklama
                      write mahsup-rec invalid 
                          rewrite mahsup-rec end-rewrite  
                      end-write 
                 end-read 
            end-read 
        end-read 


    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext mahsup facenta acenta cari 
     .
*
 mahsup-alacak-isle.
    initialize ydk-mahsup-no
    move "bakiye.txt"  to fidetext-adi
    move "bakiye2.txt" to amontext-adi
    open input fidetext
    open output amontext  
     open i-o mahsup facenta acenta cari
     initialize mahsup-rec  ydk-mahsup-no
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
       if function numval(amontext-det(4)) = 0
          exit perform cycle 
       end-if
        initialize facenta-rec
        move amontext-det(1)  to facenta-fide-kodu
        read facenta no lock invalid
            continue  
        not invalid 
            initialize acenta-rec 
            move facenta-asya-kodu        to acenta-kodu
            read acenta no lock invalid
                 if debug = 1 stop " " end-if 
            not invalid 
                 initialize cari-rec
                 move acenta-muhno  to cari-kodu
                 read cari no lock invalid
                      if debug = 1 stop " " end-if 
                 not invalid 
                      initialize mahsup-rec 
                      move cari-kodu         to mahsup-hesap-kodu
                      move tarih-tasi        to mahsup-tarih
                      move 2                 to mahsup-fis-no
                      add 1                  to ydk-mahsup-no
                      move ydk-mahsup-no     to mahsup-fis-sira 
                      set mahsup-tipi-mahsup to true 
                      set mahsup-b-a-alacak    to true 
                      move function numval(amontext-det(3))   to mahsup-tutar
                      move "Acilis Kaydi Geregi"     to mahsup-aciklama
                      write mahsup-rec invalid 
                          rewrite mahsup-rec end-rewrite  
                      end-write 

                 end-read 
            end-read 
        end-read 


    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext mahsup facenta acenta cari 
     .
*
 cari-hesap-yaz.
               initialize cari-rec
               move "120.01."      to cari-kodu(1:7)
               move acenta-kodu    to cari-kodu(8:)
               move "12001"        to cari-NOKTASIZ(1:5)
               move acenta-kodu    to cari-NOKTASIZ(6:)
               move musteri-unvan1 to c-unvan-1
               move musteri-adres1 to C-ADRES-1
               move musteri-adres2 to c-adres-2
               move musteri-vdairesi to C-VERGI-DAIRE
               move musteri-vno      to C-VERGI-NO
               move musteri-fax      to C-FAX
               move musteri-tel1     to c-telefon
               move musteri-ulke     to C-ULKE
               write cari-rec invalid 
                    rewrite cari-rec end-rewrite  
               end-write 
               move cari-kodu    to musteri-muhasebe-kodu acenta-muhno 

               initialize hesap-rec
               move "120.01."      to hesap-kodu(1:7)
               move acenta-kodu    to hesap-kodu(8:)
               move "12001"        to hesap-NOKTASIZ(1:5)
               move acenta-kodu    to hesap-NOKTASIZ(6:)
               move musteri-unvan1 to hesap-adi
               set hesap-cari-islem to true 

               write hesap-rec invalid 
                    rewrite hesap-rec end-rewrite 
               end-write .
*
 vergino-yaz.
    move 1             to ydk-acenta ydk-firma
    move 8000000       to ydk-firma-prof ydk-acenta-prof
    move "acenta.txt"  to fidetext-adi
    move "acenta2.txt" to amontext-adi
    open input fidetext
    open output amontext firma acenta facenta ffirma
    close acenta facenta ffirma firma 

     open i-o acenta    nt facenta ffirma  firma
     initialize acenta-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(1) not = spaces
         
               initialize acenta-rec 
               add 1                                         to ydk-acenta ydk-acenta-prof 
               move ydk-acenta                               to acenta-kodu

               if function numval(amontext-det(24)(1:1)) = 0
                  move 1        to acenta-munferit
               end-if 
               if function numval(amontext-det(24)(1:1)) = 1
                  move 1        to acenta-kredili
               end-if
                  initialize not-rec 
                  move "ACE"       to not-dos
                  move "Default"   to not-dos-anah
                  move acenta-kodu to not-dos-anah(8:)
                  move "01"        to acen-dft-banka
                  move "01"        to acen-dft-doviz
                  move "BB"        to acen-dft-pan-tipi
                  move "02"        to acen-dft-odeme-tipi
                  move "01"        to acen-dft-anlasma
                  move "01"        to acen-dft-pazar
                  move "209"       to acen-dft-ulke
                  move 1           to acen-dft-fix
                  move acen-dft    to not1
                 write not-rec invalid 
                       rewrite not-rec invalid continue
                       end-rewrite 
                 end-write        

               move amontext-det(1)                          to acenta-adi
               move amontext-det(3)                          to acenta-unvani
               move amontext-det(15)                         to acenta-ilce
               inspect acenta-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using acenta-adi value 100
        
               inspect acenta-unvani converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
               to x"8DA69A9E989980879FA7818D94"
                      call "c$toupper" using acenta-unvani value 100
        
               move amontext-det(1)                     to facenta-fide-kodu
               move acenta-kodu                         to facenta-asya-kodu
               write facenta-rec invalid 
                     stop " " 
               end-write

               write acenta-rec invalid 
                   if debug = 1 stop " " end-if 
               end-write       

     end-if
    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext acenta nt   
          facenta ffirma  firma.
*
 yan-al.

    initialize ilk-rez-mi
    move "yan.txt"  to fidetext-adi
    move "yan2.txt" to amontext-adi
    open input fidetext
    open output amontext 
    move 1 to ilk-rez-mi
     open i-o rez yanrez 
     initialize acenta-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    move 1 to i
    initialize amontext-rec 
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(1) not = spaces
        
        initialize yanrez-rec sayac2  
        move function numval(amontext-det(1))  to yanrez-rezno 
        start yanrez key not < yanrez-anah invalid
              continue 
        not invalid 
        perform with test after until fs-yanrez = "10"
        read yanrez next no lock end move "10"  to fs-yanrez
        not at end
                if debug = 1 stop " " end-if
                move amontext-det(1)        to sayac2 
                if yanrez-rezno = function numval(amontext-det(1)) and 
                   amontext-det(1) = sayac2 
                   add  1 to sayac2
                else                   
                   add  1 to i
                   move amontext-det(2)          to yanrez-adi
                end-if 

                     move amontext-det(1)        to yanrez-rezno
                     move i                      to yanrez-sirano
                     write yanrez-rec invalid
                           stop " "
                     end-write
                   exit perform 
        end-read 
        end-perform
        end-start
     end-if
    write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext rez yanrez.

          

 
