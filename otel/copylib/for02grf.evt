* for02grf.evt
* for02grf.evt is generated from D:\asya\acugt.ytl\otel\for02grf.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 elma-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Ax-Event
        EVALUATE Event-Data-2
        WHEN TChartOnClickSeries
           PERFORM elma-Ev-OnClickSeries
        END-EVALUATE
     END-EVALUATE
     .

 Form2-Event-Proc.
     .

 Form2-Gd-1-Event-Proc.
     .

 Form2-Gd-1-Exception-Proc.
     PERFORM narg-islemler
     .
***   start event editor code   ***
*          
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.              
    open input genel2
    move 1 to genel2-anah 
    read genel2 no lock invalid continue
         not invalid continue
    end-read
    close genel2.              
     move ONKPARA-DOVIZ to butce-cev-doviz 
    if genel2-rapor-comp-durumu = spaces 
       move 2 to tumu
    else 
       move genel2-rapor-comp-durumu to tumu
    end-if
     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to ilk-tarih son-tarih.
*    if son-ay < 12 then 
*              add 1 to son-ay
*       else
*               move 1 to son-ay
*       add 1 to son-yil
*    end-if
    move 1          to ilk-gun
    move 31         to son-gun
    move 1          to reel-gecmis

    move "N" to rap-tip.
    move "P" to bol-tip
    move "O" to ok-tip
      perform Form1-Ef-1-Aft-Procedure
    display Form1-Cm-1 Form1-Cm-1a  Form1-Cb-1aa Form1-Cb-3 Form1-Cb-5
    display acc-01 acc-02 acc-03 acc-04 acc-05
            acc-06 acc-07 com-01.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
     perform grafik-yukleme-baslasin
*/-----------------------------\*         
     .
*
 Form1-Ex-Other. 
    evaluate key-status
      when 15
           modify elma,
                 @Export::@CopyToClipboardMetafile(1) 
      when 16
            modify elma,
                 @Showeditor() 
      when 11
          move tarih-tasi           to    starih
         display message box  function INTEGER-OF-DATE(starih)

           move "20120230"        to    starih
         display message box  function INTEGER-OF-DATE(starih)
           move "20120301"       to    starih
         display message box  function INTEGER-OF-DATE(starih)
      when 8 
*      modify elma,
*           @Export::@CopyToClipboardBitmap()

           modify elma,
                @Export::@ShowExport()
         when 19 
          perform raporla
         when 29 
          perform detay-raporla
      when 7
     

      
      modify elma,
           @printer::@ShowPreview()
         
*         modify elma, 
*               @PrintPanel(1)
      when 1002
         move 1         to ilk-gun 
         compute ilk-ay = ilk-ay + 1
         if ilk-ay > 12
            compute ilk-yil = ilk-yil + 1
            move 1  to ilk-ay            
         end-if 

         move 31         to son-gun
         compute son-ay = son-ay + 1
         if son-ay > 12
            compute son-yil = son-yil + 1
            move 1  to son-ay                        
         end-if 
         display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
          perform grafik-rapor
          modify elma, 
                 @Repaint()
                 visible = 1
      when 1001
         move 1         to ilk-gun 
         compute ilk-ay = ilk-ay - 1
         if ilk-ay > 12
            compute ilk-yil = ilk-yil - 1
            move 1  to ilk-ay            
         end-if 
         if ilk-ay < 1
            move 12       to ilk-ay
            compute ilk-yil = ilk-yil - 1
         end-if 
         move 31         to son-gun
         compute son-ay = son-ay - 1
         if son-ay > 12
            compute son-yil = son-yil - 1
            move 1  to son-ay                        
         end-if 
         if son-ay < 1
            move 12       to son-ay
            compute son-yil = son-yil - 1
         end-if 
         display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
          perform grafik-rapor
          modify elma, 
                 @Repaint()
                 visible = 1           
      when 1
        evaluate control-id
                when 12
                when 2001
                     initialize acenta-cagir
                     call "/asya/ytl/obj/otel/acenara.asy" 
                          using acenta-cagir  
                          on exception 
                             perform callerr-proc
                          not on exception
                             if acenta-cagir <> spaces
                                move acenta-cagir to acn-kod
                                display acc-07
                             end-if
                     end-call
                     move 4 to accept-control
                     move 12 to control-id
        end-evaluate
        exit paragraph
      when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre 
      when 2
         perform grafik-yukleme-baslasin
         move 4 to accept-control
         move 7 to control-id   
     when 27
          set exit-pushed to true
    end-evaluate.

     .

*
 grafik-yukleme-baslasin.
          perform Form1-Ef-1-Aft-Procedure
          perform grafik-rapor
          modify elma, 
                 @Repaint()
                 visible = 1          .
*
 grafik-rapor.
       



         

            move 0 to tamam
           modify elma visible = 0
             modify elma,
                    @ClearChart()
                    
       open i-o genelfis
       move 1 to genelfis-anahtar
       read genelfis no lock invalid 
            move 1 to ekran-fis-1,
       end-read
      
       add 1 to ekran-fis-1
      
       move ekran-fis-1(2:) to takas3-no takas4-no takas-no takas-detay-no takasfiyat-no takas7-no
       rewrite genelfis-rec invalid 
               write genelfis-rec invalid continue
               end-write,
       end-rewrite
       close genelfis
         open output takas7 close takas7
        open output takasfiyat close takasfiyat
        open i-o takasfiyat with mass-update.
       open i-o takas7 with mass-update.
       open output takas 
       open output takas3 
       open output takas-detay 
       close takas3 takas-detay takas
       open i-o takas3 with mass-update 
       open i-o takas-detay with mass-update
     
       open i-o takas with mass-update

       open input rez  takvim cast kodlar02 odalar grup
                 aksiyhrk fiyatind fiyat fiyatana kur konuk takvim2  aceanlas
                  romhrk  cast3 konum ulke  firma onbkodlar10 gruplar  grupfiy acenta formul,

       initialize takvim-rec eh toplam son-sira son-gr-sira
         toplam-siklik     toplam-buyuk    toplam-kucuk toplam-free toplam-gelir-gecmis
         toplam-bebek      toplam-gelir toplam-gelir-tl takas-detay-diger toplam-oda-kap
         toplam-pax-kap
        move ilk-tarih to k-ilk-tarih
       move son-tarih to k-son-tarih
       subtract onceki-yil from k-ilk-yil
       subtract onceki-yil from k-son-yil
       move tarih-tasi to gecen-yil
       subtract  onceki-yil from gecen-yil-yil

       move ilk-tarih to takvim-anah
       move 1 to buyil
       initialize eh
       start takvim key not < takvim-anah invalid continue
         not invalid
         perform with test after until evet
           read takvim next no lock end move "E" to eh
             not end
             if takvim-anah > son-tarih 
                move "E" to eh
              else
                initialize takas3-rec  
                move takvim-anah to takas3-tarih
                if Datatip(1:1) = "A" 
                   move "00" to takas3-gun
                   read takas3 no lock invalid continue end-read
                end-if
                write takas3-rec invalid rewrite takas3-rec, end-rewrite,end-write
                perform cast-oku thru cast-oku-exit
                if Datatip(1:1) = "A" 
                   move "00" to takas3-gun
                end-if
                 add takvim-hazir-oda to takas3-hazir-oda
                 add takvim-hazir-yatak to takas3-hazir-yatak
                write takas3-rec invalid rewrite takas3-rec, end-rewrite,end-write
                 add takvim-hazir-oda  to toplam-oda-kap
        
               add takvim-hazir-yatak to toplam-pax-kap
             end-if
           end-read
         end-perform
       end-start

     
    
        if beklenen-grup = 1 
       move ilk-tarih to takas-blok-bas-tar
       move son-tarih to takas-blok-bit-tar
       move 1         to takas-blok-konumlu
      
        move 1 to takas-blok-fiyatli        
       perform grup-takas-al
       perform gruplari-takasa-ekle
      end-if

       ||| burda takas3 startlanýp kadv-haric islem yapýlacak firat 


        move 0 to buyil
       move isyeri-adres-tasi to mevcut-sirket son-sirket

       if onceki-yil > 0 then 

                  move k-ilk-tarih to takvim-anah
      
               start takvim key not < takvim-anah invalid continue
                 not invalid
                 move "H" to eh
                 perform with test after until evet
                   read takvim next no lock end move "E" to eh
                     not end
                     if takvim-anah > k-son-tarih 
                        move "E" to eh
                      else
                      if takvim-sirket not > "00000000" then
                            move isyeri-adres-tasi to mevcut-sirket
                            else
                           move takvim-sirket to mevcut-sirket

                       end-if
                       if mevcut-sirket not = son-sirket
                            close  rez   cast  odalar grup gruplar  grupfiy
                                         aksiyhrk fiyatind fiyat fiyatana kur konuk formul aceanlas
                                          romhrk  cast3 konum ulke  firma onbkodlar10 acenta,
                           

                             move mevcut-sirket to  rez-dosya-adres cast-dosya-adres grup-dosya-adres aksiyhrk-dosya-adres
                                    fiyat-dosya-adres fiyatana-dosya-adres kur-dosya-adres konuk-dosya-adres  acenta-dosya-adres
                                        romhrk-dosya-adres kodlar02-dosya-adres cast3-dosya-adres konum-dosya-adres formul-dosya-adres
                                        ulke-dosya-adres acenta-dosya-adres onbkodlar10-dosya-adres gruplar-dosya-adres grupfiy-dosya-adres,
                                        aceanlas-dosya-adres
                            open input rez   cast odalar grup  gruplar  grupfiy  formul
                                         aksiyhrk fiyatind fiyat fiyatana kur konuk  acenta aceanlas
                                          romhrk  cast3 konum ulke  firma onbkodlar10,
                           move mevcut-sirket to son-sirket
                       end-if




                        initialize takas3-rec  
                        move takvim-anah to takas3-tarih
                        add onceki-yil to takas3-yil
                         if Datatip(1:1) = "A" 
                           move "00" to takas3-gun
                        end-if
                        read takas3 no lock invalid 
                           stop " "
                        end-read
                     
                        perform cast-oku thru cast-oku-exit
                         if Datatip(1:1) = "A" 
                           move "00" to takas3-gun
                        end-if
                        write takas3-rec invalid rewrite takas3-rec, end-rewrite,end-write
                        
                     end-if
                   end-read
                 end-perform
               end-start










       end-if


         if mevcut-sirket not = isyeri-adres-tasi
               close  rez   cast  odalar grup  gruplar  grupfiy   acenta aceanlas
                                         aksiyhrk fiyatind fiyat fiyatana kur konuk  formul
                                          romhrk  cast3 konum ulke  firma onbkodlar10,

               move isyeri-adres-tasi to  rez-dosya-adres cast-dosya-adres grup-dosya-adres aksiyhrk-dosya-adres
                      fiyat-dosya-adres fiyatana-dosya-adres kur-dosya-adres konuk-dosya-adres    acenta-dosya-adres
                          romhrk-dosya-adres kodlar02-dosya-adres cast3-dosya-adres konum-dosya-adres   formul-dosya-adres
                          ulke-dosya-adres acenta-dosya-adres onbkodlar10-dosya-adres gruplar-dosya-adres grupfiy-dosya-adres,
                           aceanlas-dosya-adres
              open input rez   cast odalar grup  acenta  formul aceanlas
                                         aksiyhrk fiyatind fiyat fiyatana kur konuk  gruplar  grupfiy
                                          romhrk  cast3 konum ulke  firma onbkodlar10,
                         
           end-if

     initialize takas-detay-rec
     move high-values to takas-detay-siklik
  
     move 0 to son-gr-sira
     start takas-detay key < takas-detay-siklik invalid continue
       not invalid
           perform until fs-takas-detay = "10"
                  read takas-detay backward no lock 
                         end move "10" to fs-takas-detay
                         not end 
*                           if takas-detay-sira = max-detay 
*                                move max-detay to  takas-detay-gr-sira
*                                move max-detay to  takas-yer(takas-detay-gr-sira)
*                             else
*                              add   1 to son-gr-sira
*                              move  son-gr-sira      to takas-detay-gr-sira
*                              move  takas-detay-sira to  takas-yer(takas-detay-gr-sira)
*                              rewrite takas-detay-rec invalid stop " " end-rewrite
*                          end-if
                           if takas-detay-sira = max-detay 
                                move max-detay to  takas-detay-gr-sira
                                move max-detay to  takas-yer(takas-detay-gr-sira)
                             else
                              add   1 to son-gr-sira
                              move  son-gr-sira      to takas-detay-gr-sira
                              move  takas-detay-sira to  takas-yer(takas-detay-gr-sira)
                              rewrite takas-detay-rec invalid stop " " end-rewrite
                          end-if
                  end-read
           end-perform
     end-start
       close rez  odalar takvim takvim2 cast kodlar02  grup takas
       close aksiyhrk fiyatind fiyat fiyatana kur konuk  gruplar  grupfiy acenta
                  romhrk  cast3 konum ulke  firma onbkodlar10 formul aceanlas,

              initialize takas3-rec
              start takas3 key not < takas3-tarih invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close takas3
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
    
      open input kodlar02  konum acenta ulke
*********************************
         if ok-tip = "O" or "T"
          move 1 to max-seri
           if bol-tip not = spaces
              compute max-seri = son-sira

            end-if

        else
          move 4 to max-seri

        end-if
                move 0 to tamam
            modify elma visible = 0

                        
            modify elma,
                    @ClearChart()
                    @Header::@Text::Clear()
                    @RemoveAllSeries(),
                    @SetTheme(ctWindowsXp,cpdefault)
                    @Axis::@Bottom::@Labels::@MultiLine(1)
                    @Axis::@Bottom::@Labels::@Angle(270)
                    @Zoom::@Enable(0)
                    @visible(0)
        
         perform varying i from 0 by 1 until i >  max-seri
             compute alen = -10 + (i * 15)
               modify elma,
                    @AddSeries(@scBar),  | bar
                    @ASeries(i)::@Clear()
                    @Aseries(i)::@Asbar()::@StackGroup (2) 
                    @Aseries(i)::@Asbar()::@Multibar(@mbStacked)
                  
            Use elma @Aseries(i),
              
                 modify ^@Marks::@Style(@Smsvalue)                        
                        ^@Marks::@Gradient::@Visible(1)
                        ^@Marks::@Symbol::@Visible(1)
                        ^@Marks::@Arrow::@Visible(1)
                        ^@Marks::@font::@size(6)  
                        ^@Marks::@ArrowLength(alen)  

            end-Use 
             if i= max-seri then  modify elma, @Aseries(i)::@color('&H00ABCDEF') end-if

         end-perform 
          if onceki-yil > 0 and ok-tip not = "K" then 
                  compute i = max-seri + 1 
                  compute alen = -50 + (i * 30)
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H00000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(2) 
                            @ASeries(i)::@asfastline()::@linepen::@style(0) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
                                ^@Marks::@font::@size(6)  
        
                              
                    end-Use 
                  compute i = max-seri + 2 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                            @ASeries(i)::@Color('&H000AA00') 
                            @ASeries(i)::@asfastline()::@linepen::@width(3) 
                            @ASeries(i)::@asfastline()::@linepen::@style(0) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
                                ^@Marks::@font::@size(6)     
                              
                    end-Use 
                   compute i = max-seri + 3 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                            @ASeries(i)::@Color('&H30000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(2) 
                            @ASeries(i)::@asfastline()::@linepen::@style(1) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
                                ^@Marks::@font::@size(6)  
                              
                    end-Use 
                     modify elma, aSeries(i)::Active(0)
                   compute i = max-seri + 4 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                            @ASeries(i)::@Color('&H40000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(2) 
                            @ASeries(i)::@asfastline()::@linepen::@style(2) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
                                 ^@Marks::@font::@size(6)  
                              
                    end-Use  ,
                     modify elma, aSeries(i)::Active(0)
                     compute i = max-seri + 5 
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                            @ASeries(i)::@Color('&H50000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(1) 
                            @ASeries(i)::@asfastline()::@linepen::@style(2) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
                                ^@Marks::@font::@size(6)  
                              
                    end-Use 
                     modify elma, aSeries(i)::Active(0)
                    compute i = max-seri + 6
                      modify elma,
                            @AddSeries(@scFastLine),  | bar
                            @ASeries(i)::@Clear()
                           @ASeries(i)::@Color('&H60000000') 
                            @ASeries(i)::@asfastline()::@linepen::@width(1) 
                            @ASeries(i)::@asfastline()::@linepen::@style(2) 
                    Use elma @Aseries(i),
                      
                         modify ^@Marks::@Style(@Smsvalue)                        
                                ^@Marks::@Gradient::@Visible(1)
                                ^@Marks::@Symbol::@Visible(1)
                                ^@Marks::@Arrow::@Visible(1)
                               ^@Marks::@font::@size(6)  
                              
                    end-Use 
                     modify elma, aSeries(i)::Active(0)
           end-if             
            
         
       
          
              initialize fs-takas3 top6  siratut
              perform with test after until fs-takas3 = "10"
                    read takas3 next no lock end move "10" to fs-takas3
                    not at end
                         if Datatip(1:1) = "A" 
                            if takas3-tarih(1:6) > son-tarih(1:6)
                                   move "10" to fs-takas3
                                   exit perform
                            end-if
                           else
                            if takas3-tarih > son-tarih
                                   move "10" to fs-takas3
                                   exit perform
                            end-if
                          end-if
                         initialize dokumer-rec detay z-goster 
                      
                        
                         perform detay-ata

                         perform toplam-al

                         move takas3-gun         to egun
                         move takas3-ay          to eay
                         move takas3-yil         to eyil

                
                  move takas3-gun to grf-gun
                  move takas3-ay to grf-ay
                  move takas3-yil to grf-yil
                 move siratut to takas3-sira
                 rewrite takas3-rec invalid stop " " end-rewrite
                 add 1 to siratut
                 if ok-tip = "O" or "T" 
                   compute bos-oda = TAKAS3-HAZIR-ODA - g-takas3-oda

                   
                      if bol-tip not = spaces
                         perform varying ii from 0 by 1 until ii > son-sira - 1 
                            move  takas-yer( ii + 1 ) to iii
                            modify elma, aSeries(ii)::add(G-TAKAS3-DETAY(iii),grf-tarih,@clTeeColor)
                         end-perform
                         

                      else 
                         modify elma, aSeries(0)::add(g-takas3-oda,grf-tarih,@clTeeColor)
                    end-if
                    if bos-oda < 0 then 
                        modify elma, aSeries(max-seri)::add(bos-oda,grf-tarih,'&H000000FF')     
                    else
                         modify elma, aSeries(max-seri)::add(bos-oda,grf-tarih,'&H00ABCDEF')     
                    end-if
                    if onceki-yil > 0 and ok-tip not = "K" then 
                          modify elma, aSeries(max-seri)::Active(0)
                          compute i = max-seri + 1 
                                modify elma, aSeries(i)::add(gk-takas3-oda,grf-tarih, '&H0000000') 
                          compute i = max-seri + 2 
                                modify elma, aSeries(i)::add(gk1-takas3-oda,grf-tarih,'&H000FF00')  
                        compute i = max-seri + 3 
                                modify elma, aSeries(i)::add(gk2-takas3-oda,grf-tarih, '&H3000000') 
                                
                         compute i = max-seri + 4 
                                modify elma, aSeries(i)::add(gk3-takas3-oda,grf-tarih, '&H4000000')
                                 
                        compute i = max-seri + 5 
                                modify elma, aSeries(i)::add(gk4-takas3-oda,grf-tarih, '&H5000000')
                                
                      compute i = max-seri + 6 
                                modify elma, aSeries(i)::add(gk5-takas3-oda,grf-tarih, '&H6000000')
                                 
                    end-if          


                  else
                    compute bos-oda = TAKAS3-HAZIR-yatak - g-takas3-pax - g-takas3-child - g-takas3-free - g-takas3-bebek
                    modify elma, aSeries(0)::add(g-takas3-pax,grf-tarih,@clTeeColor)
                    modify elma, aSeries(1)::add(g-takas3-child,grf-tarih,@clTeeColor)
                   modify elma, aSeries(2)::add(g-takas3-free,grf-tarih,@clTeeColor)
                   modify elma, aSeries(3)::add(g-takas3-bebek,grf-tarih,@clTeeColor)
                    modify elma, aSeries(4)::add(bos-oda,grf-tarih,@clTeeColor)                       
               end-if
             end-read
              end-perform
              if  siratut > 32   or max-seri > 15 or onceki-yil > 0
               perform varying i from 0 by 1 until i > max-seri - 1   
                       modify elma,
                            @Aseries(i)::@Marks()::@visible(0)
                         

               end-perform    
               if siratut > 32 

                modify elma,
                            @Aseries(max-seri)::@Marks()::@visible(0)
                         
                end-if
              end-if
               
                    
                    
                    
                    
                if ok-tip = "O"    
                    
                      if bol-tip not = spaces
                         perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                              evaluate bol-tip
                                  when "T" 
                                    if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                             evaluate  takas-detay-asya-kodu(1:2)
                                                 when "00"
                                                      move "Kendi Konaklamalari" to detay-adi
                                                 when  other 
                                                     move "Transferle Gelenler" to detay-adi
                                             end-evaluate
                                              
                                          
                                     end-if


                                  when "S" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                             evaluate  takas-detay-asya-kodu(1:2)
                                                 when "01"
                                                   move "Son Hafta Satislari" to detay-adi
                                                 when "02"
                                                   move "8-14 gun once Satislari" to detay-adi
                                                 when "03"
                                                   move "15-21 gun once Satislari" to detay-adi
                                                when "04"
                                                   move "22-28 gun once Satislari" to detay-adi
                                                when "05"
                                                   move "29-35 gun once Satislari" to detay-adi
                                                when "06"
                                                   move "36-42 gun once Satislari" to detay-adi
                                                when "07"
                                                   move "43-49 gun once Satislari" to detay-adi
                                                when "08"
                                                   move "50-56 gun once Satislari" to detay-adi
                                                 when "09"
                                                   move "57-63 gun once Satislari" to detay-adi
                                                 when "10"
                                                   move "64-70 gun once Satislari" to detay-adi
                                                 when "11"
                                                   move "71-77 gun once Satislari" to detay-adi
                                                when  other 
                                                   move "Daha onceki Satislar" to detay-adi
                                             end-evaluate
                                              
                                          
                                     end-if
                                  when "P" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to kodlar02-kodu
                                              move "E"  to kodlar02-tipi
                                              read kodlar02 no lock invalid continue
                                             end-read
                                           move kodlar02-adi to detay-adi
                                     end-if
                                   when "R" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Anlasmalar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to kodlar02-kodu
                                              move "D"  to kodlar02-tipi
                                              read kodlar02 no lock invalid continue
                                             end-read
                                           move kodlar02-adi to detay-adi
                                     end-if
                                    when "F" 
                                    when "O"
                                      if ii = max-detay - 1 then 
                                             move "Diger Konumlar" to detay-adi
                                        else
                                              move function numval(takas-detay-asya-kodu) to konum-anahtar
                                              read konum no lock invalid continue
                                             end-read


                                           move konum-adi to detay-adi
                                     end-if
                                   when "A"
                                      if ii = max-detay - 1 then 
                                             move "Diger Acentalar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to acenta-kodu
                                              read acenta no lock invalid continue
                                             end-read
                                           move acenta-adi to detay-adi
                                     end-if
                                   when "U"
                                      if ii = max-detay - 1 then 
                                             move "Diger Ulkeler" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to ulke-anah
                                              read ulke no lock invalid continue
                                             end-read
                                           move ulke-adi to detay-adi
                                     end-if
                                       
                               end-evaluate
                              move takas-detay-o to z-5
                              move z-5 to detay-adi(16:)
                              move takas-detay-p to z-pax
                              move z-pax to  detay-adi(24:)
                              if kdv-haric = 1   
                                 compute takas-detay-t = takas-detay-t / 1.08
                              end-if 
                              compute ort rounded = takas-detay-t /  takas-detay-p
                              move ort           to z-ort
                              move z-ort         to detay-adi(34:)
                              move takas-detay-t to z-tutar
                              move z-tutar       to detay-adi(42:)
                             modify elma  @ASeries(ii)::@Title(detay-adi)
                          
                         end-perform
                      else 
                         modify elma  @ASeries(0)::@Title("Dolu Odalar")
                    end-if     
                       


                     modify elma  @ASeries(max-seri)::@Title("Bos Odalar")
                     
                     if onceki-yil > 0 then
                         compute i = max-seri + 1 
                           initialize detay-adi
                          move "OnceGerceklesen" to detay-adi(1:) 
    
                              move takas-detay-ok to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk /  TAKAS-DETAY-pk
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk to z-tutar
                              move z-tutar to  detay-adi(42:)
                        
                         modify elma  @ASeries(i)::@Title(detay-adi)
                          compute i = max-seri + 2 
                           initialize detay-adi
                         
                          move "Once Bugun" to detay-adi(1:) 

                              move takas-detay-ok1 to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk1 to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk1 /  TAKAS-DETAY-pk1
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk1 to z-tutar
                              move z-tutar to  detay-adi(42:)

                         modify elma  @ASeries(i)::@Title(detay-adi)
                         compute i = max-seri + 3 
                           initialize detay-adi
                         
                          move "Once son 15 gun" to detay-adi(1:)
                           move gk2-takas3-oda to z-5
                              move takas-detay-ok2 to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk2 to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk2 /  TAKAS-DETAY-pk2
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk2 to z-tutar
                              move z-tutar to  detay-adi(42:)
                         modify elma  @ASeries(i)::@Title(detay-adi)
                        compute i = max-seri + 4 
                           initialize detay-adi
                          move onceki-yil  to detay-adi(1:)
                          move "Once son 30 gun" to detay-adi(1:)
                           move gk3-takas3-oda to z-5
                              move takas-detay-ok3 to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk3 to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk3 /  TAKAS-DETAY-pk3
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk3 to z-tutar
                              move z-tutar to  detay-adi(42:)
                         modify elma  @ASeries(i)::@Title(detay-adi)
                        compute i = max-seri + 5 
                           initialize detay-adi
                         
                        move "Once son 60 gun" to detay-adi(1:)
                           move gk4-takas3-oda to z-5
                              move takas-detay-ok4 to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk4 to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk4 /  TAKAS-DETAY-pk4
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk4 to z-tutar
                              move z-tutar to  detay-adi(42:)
                         modify elma  @ASeries(i)::@Title(detay-adi)
                        compute i = max-seri + 6 
                           initialize detay-adi
                         
                          move "Once son 90 gun" to detay-adi(1:)
                           move gk5-takas3-oda to z-5
                              move takas-detay-ok5 to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk5 to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk5 /  TAKAS-DETAY-pk5
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk5 to z-tutar
                              move z-tutar to  detay-adi(42:)
                         modify elma  @ASeries(i)::@Title(detay-adi)
                          evaluate siratut
                            when <  33
                                modify elma  @Aspect::@Chart3DPercent(3)

                            when other
                                modify elma  @Aspect::@Chart3DPercent(1)
            
                         
                         end-evaluate
                        
                     end-if
                     else
                         modify elma  @ASeries(0)::@Title("Pax")
                         modify elma  @ASeries(1)::@Title("Child")
                         modify elma  @ASeries(2)::@Title("Free")
                         modify elma  @ASeries(3)::@Title("Bebek")
                         modify elma  @ASeries(4)::@Title("Bos Yatak")
                end-if
   
            
                 modify elma  @legend::@font()::@name("Courier New")
                 modify elma  @legend::@Alignment(2)
                  modify elma  @legend::@CustomPosition(1)
                      modify elma  @legend::PositionUnits(0)
                    modify elma  @legend::@toppercent(2)
                     modify elma  @legend::@LeftPercent(38)
                      modify elma  @legend::CheckBoxes(1)
                      modify elma  @legend::@ColorWidth(15)
                      modify elma  @legend::@font::@size(7)
                    modify elma  @legend::@Vertspacing(-4)
                    if onceki-yil > 0 
                          modify elma  @panel::@MarginTop(22)
                    else
                       modify elma  @panel::@MarginTop(14)
                   end-if
                modify elma  @Header::@font::@size(15)
                 modify elma  @Header::@font::@bold(1)
                modify elma  @Header::@CustomPosition(1)
                modify elma  @subHeader::@CustomPosition(1)
                modify elma  @Header::@top(15)
                modify elma  @Header::@Left(32)
                modify elma  @subHeader::@top(50)
                modify elma  @subHeader::@Left(24)
                initialize baslik altbaslik1 altbaslik2
                evaluate   true
                  when ok-tip = "K"
                        move "PAX CHILD FREE BEBEK ANALIZ" to baslik
                  when ok-tip = "O" 
                  when ok-tip = "T"
                     evaluate bol-tip
                         when "P" 
                            move "PAZAR DAGILIMLARI ANALIZ" to baslik
                         when "S" 
                            move "SATIS TARIHI ANALIZ " to baslik
                         when "F"
                             move "SATIS KONUMLARI ANALIZ" to baslik
                         when "U"
                             move "ULKE DAGILIMLARI ANALIZ" to baslik
                         when "O"
                             move "ODA KONUMLARI DOLULUK ANALIZ" to baslik
                         when "R"
                             move "SATIZ ANLASMA KODLARI ANALIZ" to baslik
                         when "A"
                              move "ACENTA KONAKLAMALARI ANALIZ" to baslik
                         when "U" 
                              move "ULKE KONAKLAMALARI ANALIZ"   to baslik
                     end-evaluate
                end-evaluate

                   modify elma  @Header::@text::@Add(baslik)
                move " Oda:" to altbaslik1
                          
                move toplam-siklik to z-5 
                  move z-5                     to altbaslik1(6:)
                 
                compute yuzde-s rounded =  ( toplam-siklik / toplam-oda-kap) * 100
                move yuzde-s to yuzde-z
                move "(%      )"  to altbaslik1(15:)
                move yuzde-z to  altbaslik1(17:6)
               
                move " Pax:"                   to altbaslik1(24:)
                 move toplam-buyuk to z-7 
                move z-7                     to altbaslik1(29:)
                move " Child:"                 to altbaslik1 (40:)
                 move toplam-kucuk to z-5 
                move z-5                     to altbaslik1 (48:)
                move " Free:"                  to altbaslik1(58:)
                 move toplam-free to z-5 
                move z-5                     to altbaslik1(65:)
                move " Bebek:"                 to altbaslik1(75:)
                   move toplam-bebek to z-5 
                move z-5                     to altbaslik1(82:)
                evaluate ychild(1:1) 
                         when 1 
                          compute toplam-pax = toplam-buyuk + ( toplam-kucuk / 2 ) 
                         when 0
                          compute toplam-pax = toplam-buyuk 
                         when 2 
                            compute toplam-pax = toplam-buyuk + toplam-kucuk + toplam-free 
                         when 3
                           compute toplam-pax = toplam-buyuk + toplam-kucuk + toplam-free + toplam-bebek
                         when 4
                           compute toplam-pax = toplam-buyuk + ( toplam-kucuk / 1 ) 
                         when other
                              compute toplam-pax = toplam-buyuk + ( toplam-kucuk / 2 ) 
                 end-evaluate

                                                                             
*                 if kdv-haric = 1                                           |firat 29/04/2021 %1 kdv için kaldýrýldý.
*                    compute toplam-gelir = toplam-gelir / 1.08              |
*                    compute toplam-gelir-tl = toplam-gelir-tl / 1.08        |
*                    compute toplam-gelir-gecmis = toplam-gelir-gecmis / 1.08|
*                 end-if 
              
                   move toplam-pax to z-pax 
                move z-pax                   to altbaslik2(1:)
                compute ort rounded = toplam-gelir / toplam-pax

                move toplam-gelir to z-tutar

                move ort to z-ort


                compute cevrim-kuru-tl rounded =  toplam-gelir-tl / toplam-gelir-gecmis
                display his-kur


                move yil-tasi to eyil
                move ay-tasi  to eay
                move gun-tasi to egun
                move etarih     to kur-yazi(1:10)
                move "-Oncesi Ort. Kur"       to kur-yazi(11:)
                display lb-kur-yazi
                compute yuzde-s rounded =  ( toplam-pax / toplam-pax-kap) * 100
                move yuzde-s to yuzde-z
                move "(%      )"  to altbaslik2(11:)
                move yuzde-z to  altbaslik2(13:6)


                move "pax geceleme X pp" to altbaslik2(23:)
                move z-ort               to altbaslik2(42:)
                move kur-adi(1:6)             to altbaslik2(50:)
                move "="                  to altbaslik2(56:)
                move z-tutar                to altbaslik2(58:)
                move kur-adi(1:6)             to altbaslik2(72:)
                modify elma  @SubHeader::@text::@Add(altbaslik1)
               modify elma  @SubHeader::@text::@Add(altbaslik2)
               modify elma  @SubHeader::@font::@size(8)    
             modify elma @visible(1)
             modify elma visible = 1 
              close  kodlar02  konum ulke acenta
              move 1 to tamam

*              call dokumer-prog on exception
*                   perform callerr-proc
*              not on exception
*                   cancel dokumer-prog
*              end-call
             
              close takas3  takas-detay    takasfiyat takas7
             .

* 
 cast-oku.
    initialize cast-rec var-yok.
    move takvim-anah to cast-tarih.
    start cast key not < cast-tarih invalid continue
      not invalid
        perform with test after until var
          read cast next no lock end move "V" to var-yok
            not end
              if cast-tarih > takvim-anah
                move "V" to var-yok
               else
                initialize rez-rec
                move cast-rez-no to rez-no
                read rez no lock invalid continue
                  not invalid
                    if filtre-var = 1 then 
                        perform filtre
                        if filtre-gecti = 1 then                           
                          perform takas-kaydet thru takas-kaydet-exit
                           initialize takas-rec 
                          move cast-tarih       to takas-tarih
                          move cast-rez-no      to takas-rez-no
                          move rez-acenta       to takas-acenta 
                          read takas no lock invalid 
                            write takas-rec  invalid 
                                stop " "
                            end-write
                          end-read 
                        end-if
                      else
                          perform takas-kaydet thru takas-kaydet-exit
                       
                          initialize takas-rec 
                          move cast-tarih       to takas-tarih
                          move cast-rez-no      to takas-rez-no
                          move rez-acenta       to takas-acenta 
                          read takas no lock invalid 
                            write takas-rec  invalid 
                                stop " "
                            end-write
                          end-read 

                    end-if                    
                end-read
              end-if
          end-read
        end-perform
    end-start.
 cast-oku-exit.
    exit.
*
 TAKAS-KAYDET.
    if rez-durumu not = "I"
       go takas-kaydet-exit
    end-if
    if rez-k-g-b not = "K" and "O"
       go takas-kaydet-exit
    end-if
*** Grup Filtresi
    if tumu > 1 then
       move "B" to kodlar02-tipi
       move rez-odeme-tipi to kodlar02-kodu
       read kodlar02 no lock invalid 
            move spaces to kodlar02-adi
       end-read
       if ( ode-tipi = "D" or  ode-tipi = "F" or  ode-tipi = "O")   and tumu = 2 then
           go takas-kaydet-exit
       end-if
       if ( ode-tipi not = "D" and ode-tipi not = "F" and ode-tipi not = "O") and tumu = 3 then
          go takas-kaydet-exit
       end-if
    end-if
*   TRACE Uygulamasi Acik ise kisi sayilari cast'tan alinacak
    move 1 to eklenecek-oda
    if rez-kisi not = cast-kisi
       move cast-kisi to rez-kisi
    end-if
    move cast-share to rez-share
    move cast-oda-no       to rez-odano
    move cast-fiyat-konumu to rez-fiyat-konumu
    move cast-oda-konumu   to rez-oda-konumu
    if rez-share = 1 then 
       move 0 to eklenecek-oda 
    else
       move 1 to eklenecek-oda
    end-if
    if onkpara-referans-var = 1 then 
       perform ref-filtre
       if not ref-gecti then 
          exit paragraph
       end-if
    end-if    


    initialize takas7-rec cevrilmis-deger cevrilmis-tl
    move cast-tarih to takas7-tarih
    move rez-no     to takas7-rez
       
***************************************
    move rez-no  to takasfiyat-rez-no
    move takvim-anah to takasfiyat-tarih
    read takasfiyat no lock invalid
         perform peryot-fiyat-bul
         if rez-cik-tar  = takvim-anah then 
            initialize pax-sayisi
         end-if
         perform varying jj from 1 by 1 until  jj > 200
            if fiyatt-tar(jj) = takvim-anah
               if gercek-cin-kuru = 1 then 
                  compute cevrilmis-tl rounded = 
                          fiyatt-fiy(jj) * fiyatt-kur(jj)
                  if rez-doviz = butce-cev-doviz  then 
                     move  fiyatt-fiy(jj) to cevrilmis-deger
                  else
                     compute cevrilmis-deger rounded =  
                             fiyatt-fiy(jj) * 
                             fiyatt-kur(jj) / 
                             fiyatt-kurcev(jj)

                  end-if
               else
                  compute cevrilmis-tl rounded =  
                          fiyatt-fiy(jj) * fiyatt-kur(jj)  
                  if rez-doviz = butce-cev-doviz  then 
                     move  fiyatt-fiy(jj) to cevrilmis-deger
                   else
                     compute cevrilmis-deger rounded =  
                             fiyatt-fiy(jj) * 
                             fiyatt-kur(jj) / 
                             fiyatt-kurcev(jj)
                   end-if

                      
               end-if
               move fiyatt-fiy(jj) to  takasfiyat-fiyat
            end-if
         end-perform  
      not invalid 
          if rez-cik-tar  = takvim-anah then 
             initialize pax-sayisi
          end-if
          if gercek-cin-kuru = 1 then 
             compute cevrilmis-deger rounded =  
                     takasfiyat-fiyat * 
                     takasfiyat-kur / 
                     takasfiyat-kurcev 
             compute cevrilmis-tl rounded =  
                     takasfiyat-fiyat * 
                     takasfiyat-kur
             if rez-doviz = butce-cev-doviz 
                move  takasfiyat-fiyat to cevrilmis-deger
             else
                compute cevrilmis-deger rounded =  
                        takasfiyat-fiyat * 
                        takasfiyat-kur / 
                        takasfiyat-kurcev 
             end-if
          else
             compute cevrilmis-deger =  
                     takasfiyat-fiyat *  
                     takasfiyat-kur / 
                     takasfiyat-kurcev 
             compute cevrilmis-tl rounded =  
                     takasfiyat-fiyat *  
                     takasfiyat-kur
             if rez-doviz = butce-cev-doviz
                move  takasfiyat-fiyat to cevrilmis-deger
             else
                compute cevrilmis-deger rounded =  
                        takasfiyat-fiyat * 
                        takasfiyat-kur / 
                        takasfiyat-kurcev 
             end-if
          end-if
                    
      end-read

      if rez-odano not = spaces and 
        ( hayali-haric = 1 or dis-haric = 1 ) then 
        move rez-odano to odalar-anah
        read odalar no lock invalid 
             continue
        not invalid
            if ( odalar-hayali = "H" and hayali-haric = 1 )  then
               move 0 to eklenecek-oda
            end-if
            if ( dis-haric = 1 and odalar-dis = 1 )  then
               exit paragraph
            end-if 
        end-read
     end-if  
     evaluate ychild 
         when 1 
         compute pax-sayisi = rez-buyuk + ( rez-kucuk / 2 )
         when 0
         compute pax-sayisi = rez-buyuk
         when 2 
         compute pax-sayisi = rez-buyuk +  rez-kucuk  + rez-free
         when 3
         compute pax-sayisi = rez-buyuk +  rez-kucuk  + rez-free + rez-bebek
         when 4
         compute pax-sayisi = rez-buyuk +  rez-kucuk 
         when other
         compute pax-sayisi = rez-buyuk + ( rez-kucuk / 2 )   
      end-evaluate
      if buyil not = 1 
         if takvim-anah <=  rez-cik-tar and  takvim-anah >= rez-gir-tar then
            if takvim-anah = rez-cik-tar
               initialize eklenecek-oda rez-buyuk rez-kucuk rez-free rez-bebek  pax-sayisi
            end-if
            compute gk-takas3-oda   = gk-takas3-oda   + eklenecek-oda,   
            compute gk-takas3-pax   = gk-takas3-pax   + rez-buyuk,       
            compute gk-takas3-child = gk-takas3-child + rez-kucuk,       
            compute gk-takas3-free  = gk-takas3-free  + rez-free,        
            compute gk-takas3-bebek = gk-takas3-bebek + rez-bebek, 
            add eklenecek-oda to takas-detay-ok
            compute takas-detay-pk  = takas-detay-pk   + pax-sayisi
            compute takas-detay-tk =  takas-detay-tk + cevrilmis-deger
            compute takas-detay-tk-tl =  takas-detay-tk-tl + cevrilmis-tl
            compute gk-takas3-p  = gk-takas3-p   + pax-sayisi
            compute gk-takas3-t =  gk-takas3-t + cevrilmis-deger 
             compute gk-takas3-t-tl =  gk-takas3-t-tl + cevrilmis-tl
            if rez-al-yil < 2000 then 
               move rez-isl-tar to rez-al-tar
            end-if    
            if gecen-yil >= rez-al-tar
               compute gk1-takas3-oda   = gk1-takas3-oda   + eklenecek-oda,   
               compute gk1-takas3-pax   = gk1-takas3-pax   + rez-buyuk,       
               compute gk1-takas3-child = gk1-takas3-child + rez-kucuk,       
               compute gk1-takas3-free  = gk1-takas3-free  + rez-free,        
               compute gk1-takas3-bebek = gk1-takas3-bebek + rez-bebek, 
               compute gk1-takas3-p  = gk1-takas3-p   + pax-sayisi
               compute gk1-takas3-t =  gk1-takas3-t + cevrilmis-deger 
               compute gk1-takas3-t-tl =  gk1-takas3-t-tl + cevrilmis-tl
               add eklenecek-oda to takas-detay-ok1
               compute takas-detay-pk1  = takas-detay-pk1 +  pax-sayisi
               compute takas-detay-tk1 =  takas-detay-tk1 + cevrilmis-deger 
               compute takas-detay-tk1-tl =  takas-detay-tk1-tl + cevrilmis-tl
            end-if
            move rez-al-tar to starih
            move takvim-anah to s2tarih
            if function INTEGER-OF-DATE(s2tarih) - function INTEGER-OF-DATE(starih) > 15
               compute gk2-takas3-oda   = gk2-takas3-oda   + eklenecek-oda,   
               compute gk2-takas3-pax   = gk2-takas3-pax   + rez-buyuk,       
               compute gk2-takas3-child = gk2-takas3-child + rez-kucuk,       
               compute gk2-takas3-free  = gk2-takas3-free  + rez-free,        
               compute gk2-takas3-bebek = gk2-takas3-bebek + rez-bebek, 
               compute gk2-takas3-p  = gk2-takas3-p   + pax-sayisi
               compute gk2-takas3-t =  gk2-takas3-t + cevrilmis-deger 
               compute gk2-takas3-t-tl =  gk2-takas3-t-tl + cevrilmis-tl
               add eklenecek-oda to takas-detay-ok2
               compute takas-detay-pk2  = takas-detay-pk2 + pax-sayisi
               compute takas-detay-tk2 =  takas-detay-tk2 + cevrilmis-deger 
               compute takas-detay-tk2-tl =  takas-detay-tk2-tl + cevrilmis-tl
            end-if
            if function INTEGER-OF-DATE(s2tarih) - function INTEGER-OF-DATE(starih) > 30
               compute gk3-takas3-oda   = gk3-takas3-oda   + eklenecek-oda,   
               compute gk3-takas3-pax   = gk3-takas3-pax   + rez-buyuk,       
               compute gk3-takas3-child = gk3-takas3-child + rez-kucuk,       
               compute gk3-takas3-free  = gk3-takas3-free  + rez-free,        
               compute gk3-takas3-bebek = gk3-takas3-bebek + rez-bebek, 
               compute gk3-takas3-p  = gk3-takas3-p + pax-sayisi
               compute gk3-takas3-t =  gk3-takas3-t + cevrilmis-deger   
               compute gk3-takas3-t-tl =  gk3-takas3-t-tl + cevrilmis-tl
               add eklenecek-oda to takas-detay-ok3
               compute takas-detay-pk3  = takas-detay-pk3   + pax-sayisi
               compute takas-detay-tk3 =  takas-detay-tk3 + cevrilmis-deger 
               compute takas-detay-tk3-tl =  takas-detay-tk3-tl + cevrilmis-tl
            end-if
            if function INTEGER-OF-DATE(s2tarih) - function INTEGER-OF-DATE(starih) > 60
               compute gk4-takas3-oda   = gk4-takas3-oda   + eklenecek-oda,   
               compute gk4-takas3-pax   = gk4-takas3-pax   + rez-buyuk,       
               compute gk4-takas3-child = gk4-takas3-child + rez-kucuk,       
               compute gk4-takas3-free  = gk4-takas3-free  + rez-free,        
               compute gk4-takas3-bebek = gk4-takas3-bebek + rez-bebek, 
               compute gk4-takas3-p  = gk4-takas3-p   + pax-sayisi
               compute gk4-takas3-t =  gk4-takas3-t + cevrilmis-deger   
               compute gk4-takas3-t-tl =  gk4-takas3-t-tl + cevrilmis-tl
               add eklenecek-oda to takas-detay-ok4
               compute takas-detay-pk4  = takas-detay-pk4   + pax-sayisi    
               compute takas-detay-tk4 =  takas-detay-tk4 + cevrilmis-deger  
               compute takas-detay-tk4-tl =  takas-detay-tk4-tl + cevrilmis-tl
            end-if
            if function INTEGER-OF-DATE(s2tarih) - function INTEGER-OF-DATE(starih) > 90
               compute gk5-takas3-oda   = gk5-takas3-oda   + eklenecek-oda,   
               compute gk5-takas3-pax   = gk5-takas3-pax   + rez-buyuk,       
               compute gk5-takas3-child = gk5-takas3-child + rez-kucuk,       
               compute gk5-takas3-free  = gk5-takas3-free  + rez-free,        
               compute gk5-takas3-bebek = gk5-takas3-bebek + rez-bebek, 
               compute gk5-takas3-p  = gk5-takas3-p   + pax-sayisi     
               compute gk5-takas3-t =  gk5-takas3-t + cevrilmis-deger 
               compute gk5-takas3-t-tl =  gk5-takas3-t-tl + cevrilmis-tl
               add eklenecek-oda to takas-detay-ok5
               compute takas-detay-pk5  = takas-detay-pk5   + pax-sayisi
               compute takas-detay-tk5 =  takas-detay-tk5 + cevrilmis-deger  
               compute takas-detay-tk5-tl =  takas-detay-tk5-tl + cevrilmis-tl
            end-if
         end-if  
      end-if .

      if buyil = 1 
         if takvim-anah <=  rez-cik-tar and  takvim-anah >= rez-gir-tar then
            if takvim-anah = rez-cik-tar
               initialize eklenecek-oda rez-buyuk rez-kucuk rez-free rez-bebek pax-sayisi
            end-if
            compute g-takas3-oda   = g-takas3-oda   + eklenecek-oda,   
            compute g-takas3-pax   = g-takas3-pax   + rez-buyuk,       
            compute g-takas3-child = g-takas3-child + rez-kucuk,       
            compute g-takas3-free  = g-takas3-free  + rez-free,        
            compute g-takas3-bebek = g-takas3-bebek + rez-bebek, 
            compute g-takas3-p  = g-takas3-p   + pax-sayisi
            compute g-takas3-t  = g-takas3-t   + cevrilmis-deger 
            compute g-takas3-t-tl  = g-takas3-t-tl   + cevrilmis-tl
            if bol-tip not = spaces
               initialize takas-detay-rec
               evaluate bol-tip
                   when "P" 
                   move rez-pazar to takas-detay-asya-kodu
                   when "S" 
                   move  REZ-AL-TAR to  satdate
                   move function integer-of-date(satdate) to  satint
                   move tarih-tasi to budate
                   move function integer-of-date(budate) to  buint
                   evaluate  buint  - satint
                       when -100 thru 7    move "01" to  takas-detay-asya-kodu
                       when 8 thru 14      move "02" to  takas-detay-asya-kodu
                       when 15 thru 21     move "03" to  takas-detay-asya-kodu
                       when 22 thru 28     move "04" to  takas-detay-asya-kodu
                       when 29 thru 35     move "05" to  takas-detay-asya-kodu
                       when 36 thru 42     move "06" to  takas-detay-asya-kodu
                       when 43 thru 49     move "07" to  takas-detay-asya-kodu
                       when 50 thru 56     move "08" to  takas-detay-asya-kodu
                       when 57 thru 63     move "09" to  takas-detay-asya-kodu
                       when 64 thru 70     move "10" to  takas-detay-asya-kodu
                       when 71 thru 77     move "11" to  takas-detay-asya-kodu
                       when other           move "12" to  takas-detay-asya-kodu
                   end-evaluate
                   when "F"
                   move rez-fiyat-konumu to takas-detay-asya-kodu 
                   when "O"
                   move rez-oda-konumu to takas-detay-asya-kodu
                   when "A"
                   move rez-acenta to takas-detay-asya-kodu
                   when "R"
                   move rez-anlasma to takas-detay-asya-kodu
                   when "U"
                   move rez-ulke    to takas-detay-asya-kodu
                   when "T" 
                   if rez-gel-sirket > "00" then 
                      move "00" to takas-detay-asya-kodu
                   else
                      move "11" to takas-detay-asya-kodu
                   end-if
               end-evaluate
               read takas-detay no lock invalid 
                    if son-sira <  max-detay then 
                       add 1 to son-sira
                    else
                       initialize takas-detay-rec
                       move son-sira     to takas-detay-sira
                       read takas-detay key takas-detay-sira invalid 
                            stop " "
                       end-read
                    end-if
                    move son-sira     to takas-detay-sira
               end-read
               add eklenecek-oda to takas-detay-siklik
               add eklenecek-oda to takas-detay-o
               if bol-tip = "S" 
                  compute s3 = function numval(takas-detay-asya-kodu) 
                  move s3 to takas-detay-siklik
               end-if
               compute takas-DETAY-p  = takas-DETAY-p   + pax-sayisi
               compute takas-DETAY-t =  takas-DETAY-t + cevrilmis-deger 
               compute takas-DETAY-t-tl =  takas-DETAY-t-tl + cevrilmis-tl
               compute G-TAKAS3-DETAY(takas-detay-sira)  = G-TAKAS3-DETAY(takas-detay-sira)   + eklenecek-oda,  
               compute g-takas3-DETAY-p(takas-detay-sira)  = g-takas3-DETAY-p(takas-detay-sira)   + pax-sayisi
               compute g-takas3-DETAY-t(takas-detay-sira) =  g-takas3-DETAY-t(takas-detay-sira) + cevrilmis-deger  
               compute g-takas3-DETAY-t-tl(takas-detay-sira) =  g-takas3-DETAY-t-tl(takas-detay-sira) + cevrilmis-tl
               write takas-detay-rec invalid rewrite takas-detay-rec end-write
            end-if
         end-if  
         add eklenecek-oda to toplam-siklik
         add rez-buyuk to toplam-buyuk       
         add rez-kucuk to toplam-kucuk
         add rez-free to toplam-free
         add rez-bebek to toplam-bebek

*         add cevrilmis-deger    to toplam-gelir         |firat 29/04/2021 %1 kdv için kaldýrýldý.
*         if cast-tarih < tarih-tasi                     |
*            add cevrilmis-deger to toplam-gelir-gecmis  |
*            add cevrilmis-tl    to toplam-gelir-tl      |
*         end-if                                         |
  
         if kdv-haric = 1                                             |firat 29/04/2021 %1 kdv için eklendi
            move cast-tarih        to kdv-rap-tarih                   |
            perform genel2-cinkdv-ayarla                              |   
            compute cevrilmis-deger rounded =                         |
                    cevrilmis-deger / ((100 + cinpara-mus-kdv)/100)   |
            add cevrilmis-deger    to toplam-gelir                    |
            if cast-tarih < tarih-tasi                                |
               compute cevrilmis-deger rounded =                      |
                       cevrilmis-deger / ((100 + cinpara-mus-kdv)/100)|
               add cevrilmis-deger to toplam-gelir-gecmis             |
               compute cevrilmis-tl rounded =                         |
                       cevrilmis-tl / ((100 + cinpara-mus-kdv)/100)   |
               add cevrilmis-tl    to toplam-gelir-tl                 |
            end-if                                                    |
         else                                                         |
            add cevrilmis-deger    to toplam-gelir                    |
            if cast-tarih < tarih-tasi                                |
               add cevrilmis-deger to toplam-gelir-gecmis             |
               add cevrilmis-tl    to toplam-gelir-tl                 |
            end-if                                                    |
         end-if                                                       |
      end-if .

 takas-kaydet-exit.
      exit
         .
************************************
*
 gruplari-takasa-ekle2.
  
     
     if takas-blok-konumlu = 1 then 
     move takas-blok-konum to rez-oda-konumu rez-fiyat-konumu
      if onkpara-referans-var = 1 then 
       perform ref-filtre
       if  not ref-gecti then 
           exit paragraph
       end-if
      end-if
     end-if
  
    
   
   
    
    
    if tumu > 1 then
          move "B" to kodlar02-tipi
          move gruplar-odeme  to kodlar02-kodu
          read kodlar02 no lock invalid 
              move spaces to kodlar02-adi
          end-read
         if ( ode-tipi = "D" or  ode-tipi = "F" or  ode-tipi = "O")   and tumu = 2 then
          exit paragraph
          end-if
          if ( ode-tipi not = "D" and ode-tipi not = "F" and ode-tipi not = "O") and tumu = 3 then
            exit paragraph
          end-if
    end-if
   

*** Grup Filtresi

   

     move takas-blok-tarih to takas3-tarih
     read takas3 no lock invalid stop " " end-read 


       compute geklenecek-oda = takas-blok-ayrilan-oda  - takas-blok-satilan-oda
     if geklenecek-oda < 0 then 
         move 0 to geklenecek-oda
     end-if
      compute geklenecek-pax = takas-blok-ayrilan-pax - takas-blok-satilan-pax 
       if   gruplar-kalanlar-double = 1 then 
             compute geklenecek-pax = takas-blok-kalan-oda * 2
        end-if
     if geklenecek-pax < 0 then 
         move 0 to geklenecek-pax
     end-if 

                
                

          if gruplar-doviz = butce-cev-doviz  then 
                           move  takas-blok-kalan-tutar to cevrilmis-deger
                  else
                           move tarih-tasi to kur-tarih
                           move "01" to kur-banka
                           move gruplar-doviz to kur-doviz
                           read kur no lock invalid
                              move 1 to doviz-alis
                           end-read
                          
                              compute cevrilmis-deger rounded = takas-blok-kalan-tutar * 
                                  doviz-alis / cevrim-kur-sayisal

              end-if
     
           
           compute g-takas3-oda   = g-takas3-oda   + geklenecek-oda,   
           compute g-takas3-pax   = g-takas3-pax   + geklenecek-pax,       
           
           
           
           compute g-takas3-p  = g-takas3-p   + geklenecek-pax
           compute g-takas3-t  = g-takas3-t   + cevrilmis-deger
      if bol-tip not = spaces
             initialize takas-detay-rec
              evaluate bol-tip
                 when "P" 
                       move gruplar-pazar to takas-detay-asya-kodu

                 when "S" 
                   move  gruplar-satis-tar to  satdate
                   move function integer-of-date(satdate) to  satint
                   move tarih-tasi to budate
                   move function integer-of-date(budate) to  buint
                  evaluate  buint  - satint
                      when -100 thru 7    move "01" to  takas-detay-asya-kodu
                      when 8 thru 14      move "02" to  takas-detay-asya-kodu
                      when 15 thru 21     move "03" to  takas-detay-asya-kodu
                      when 22 thru 28     move "04" to  takas-detay-asya-kodu
                      when 29 thru 35     move "05" to  takas-detay-asya-kodu
                      when 36 thru 42     move "06" to  takas-detay-asya-kodu
                      when 43 thru 49     move "07" to  takas-detay-asya-kodu
                      when 50 thru 56     move "08" to  takas-detay-asya-kodu
                      when 57 thru 63     move "09" to  takas-detay-asya-kodu
                      when 64 thru 70     move "10" to  takas-detay-asya-kodu
                      when 71 thru 77     move "11" to  takas-detay-asya-kodu
                     when other           move "12" to  takas-detay-asya-kodu
                  end-evaluate
                 when "F"
                     move takas-blok-konum to takas-detay-asya-kodu 
                 when "O"
                     move takas-blok-konum to takas-detay-asya-kodu
                 when "A"
                     move gruplar-acenta to takas-detay-asya-kodu
                 when "R"
                     move gruplar-anlasma to takas-detay-asya-kodu
                 when "U"
                     move gruplar-ulke    to takas-detay-asya-kodu
                when "T" 
                  if  REZ-gel-sirket > "00" then move "00" to takas-detay-asya-kodu
                      else
                         move "11" to takas-detay-asya-kodu
                 end-if
               end-evaluate
                read takas-detay no lock invalid 
                         if son-sira <  max-detay then 
                              add 1 to son-sira
                              else
                             initialize takas-detay-rec
                           move son-sira     to takas-detay-sira
                           read takas-detay key takas-detay-sira invalid stop " "
                           end-read
                         end-if
                          move son-sira     to takas-detay-sira
                 end-read

               add geklenecek-oda to takas-detay-siklik
               add geklenecek-oda to takas-detay-o
                if   bol-tip = "S" 
                   compute   s3    =  function numval(takas-detay-asya-kodu) 
                  move s3 to takas-detay-siklik

                end-if
             

            end-if 

               
               compute takas-DETAY-p  = takas-DETAY-p   + geklenecek-pax
               compute takas-DETAY-t =  takas-DETAY-t + cevrilmis-deger
               compute G-TAKAS3-DETAY(takas-detay-sira)  = G-TAKAS3-DETAY(takas-detay-sira)   + geklenecek-oda,  
               compute g-takas3-DETAY-p(takas-detay-sira)  = g-takas3-DETAY-p(takas-detay-sira)   + geklenecek-pax
               compute g-takas3-DETAY-t(takas-detay-sira) =  g-takas3-DETAY-t(takas-detay-sira) + cevrilmis-deger
                  write takas-detay-rec invalid rewrite takas-detay-rec end-write
    
  
       add geklenecek-oda to toplam-siklik
      add geklenecek-pax to toplam-buyuk       
      add rez-kucuk to toplam-kucuk
       add rez-free to toplam-free
       add rez-bebek to toplam-bebek
       add cevrilmis-deger to toplam-gelir

         rewrite takas3-rec invalid write takas3-rec end-rewrite.
          
   
     












     
       



     
   
 toplam-al.
    
    compute top4-oda = top4-oda + g-takas3-oda 
    compute top4-pax = top4-pax + g-takas3-pax
    compute top4-chi = top4-chi + g-takas3-child
    compute top4-fre = top4-fre + g-takas3-free
    compute top4-beb = top4-beb + g-takas3-bebek.

 detay-ata.
****************
                        
                         move g-takas3-oda   to z-goda
                         move g-takas3-pax   to z-gpax
                         move g-takas3-child to z-gchi
                         move g-takas3-free  to z-gfre
                         move g-takas3-bebek to z-gbeb

                         initialize top5 oda-yuzde
                         move takas3-hazir-oda to top5-top
                         move top5-top       to z-mevcut
*                         move z-goster       to det-1(110:04)
                         compute top5-bos = takas3-hazir-oda - g-takas3-oda
                         compute top6-kal = top6-kal + g-takas3-oda
                         move top5-bos       to z-bosoda
*                         move z-goster-1     to det-1(119:04)
                         compute oda-yuzde = (g-takas3-oda * 100) / takas3-hazir-oda
                         move oda-yuzde      to z-yuzde
*                         move z-2            to det-1(132:06)

                         compute top6-top = top6-top + top5-top
                         compute top6-bos = top6-bos + top5-bos
                         compute top6-hzr = top6-hzr + takas3-hazir-oda
 

    



                         .
*
 acc-07-Aft-Procedure.
     open input acenta
     if acn-kod = spaces
        move "Tum Acentalar"   to acenta-adi
     else
        move acn-kod    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 12 to control-id
        end-read
     end-if
     display lb-acenadi.
     close acenta. 
     
     .
*
 elma-Ev-OnClickSeries.
     call "c$geteventdata" using event-control-handle, myseriesindex,myvalueindex,0,0,0,0,0 
*          inquire elma,aseries(myseriesindex)::@name in acenta-adi.
***          display message box myvalueindex. 
     perform Acu-Form2-Routine
          .
*
 elma-Ev-OnMouseEnterSeries.
   
     
     .
*
 Form2-Aft-Initdata.
      initialize grid-occ(1)  grid-occ(2)  
                 grid-occ(3)  grid-occ(4)  
                 grid-occ(5)  grid-occ(6) 
                 grid-occ(7)  grid-occ(8)  
                 grid-occ(9)  grid-occ(14) 
                 grid-occ(15) grid-occ(16) 
                 grid-occ(17) grid-occ(18) 
      display acc-1301 acc-1302 
              acc-1303 acc-1304 
              acc-1305 acc-1306 
              acc-1307 acc-1308 
              acc-1309 acc-1314 
              acc-1315 acc-1316
              acc-1317 acc-1318  
      perform grid-yukle
     .
*
 Form1-Ef-1-Aft-Procedure.
          open input kur doviz 
         move butce-cev-doviz to DOVIZ-KODU
         read doviz no lock invalid
            display message box  "Tanimsiz Doviz Girdiniz"
            move "Tanimsiz " to d-kisa-adi
         end-read
         move  d-kisa-adi to kur-adi

        move tarih-tasi to kur-tarih
        move "87" to kur-banka
        if merkez = 1 then 
          move "01" to kur-banka
        end-if
        move doviz-kodu to kur-doviz
           read kur no lock invalid
                move 1 to merkez
                display Form1-Cb-1
                move "01" to kur-banka
                read kur no lock invalid
                  move 1 to doviz-alis
                end-read
            end-read
           move doviz-alis to cevrim-kuru  cevrim-kur-sayisal
         display kdov adov ikur
        close kur doviz
     .
*
 dokcagir-call.
  
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
  
*
 narg-islemler.
      inquire Form2-Gd-1 cursor-y in satir-yer
    evaluate key-status
 
    when 20
    when 21
    when 6
    when 11
    when 16
    when 17
    when 14
         open input konuk 
          perform test after until not (konuk-folio  = 99999999 or konuk-folio  = 0)  
              open input rez
              inquire Form2-Gd-1(satir-yer,1) 
                      cell-data in rez-no
              read rez no lock invalid 
                   display message box 
                           "Rez okunamadi" 
                   close rez 
                   exit perform
              not invalid
                  if rez-folio = 0 then 
                     if rez-gir-tar = tarih-tasi or key-status = 16
                        move 99999998 to konuk-folio
                     else      
                        display message box 
                                "Rezervasyon C/IN olmamis" 
                        close rez 
                        exit perform
                     end-if  
                  else
                     move rez-folio to konuk-folio
                  end-if
              end-read
              close rez
       
         read konuk no lock invalid 
              evaluate true
              when konuk-folio = 99999998 and key-status = 14 
                   display message box 
                           "C/In Islemi Yapacaksiniz. Emin Misiniz? ",
                           icon mb_warning_icon
                           title "Bilginize ..."
                           type mb_yes_no,
                           default 2
                           returning uyari
                   if uyari = 1
**************************> rezcin.asy
                      move rez-no                 to konuk-rez-no
                      initialize dokcagir-tasi
                      set dokcagir-tasi-call-cin2 to true
                      move konuk-rez-no           to dokcagir-konuk-rez-no      
                      move konuk-folio            to dokcagir-konuk-folio
                      perform dokcagir-call
                      move dokcagir-konuk-rez-no  to konuk-rez-no
                      move dokcagir-konuk-folio   to konuk-folio

                   end-if
              when konuk-folio = 99999998 and  key-status = 16 
**************************> PROFORMA CALL
                   initialize dokcagir-tasi
                   set dokcagir-tasi-call-proforma2  to true
                   move rez-no                       to dokcagir-rez-no
                   move konuk-folio                  to dokcagir-konuk-folio
                   perform dokcagir-call
                   move dokcagir-rez-no              to rez-no
                   move dokcagir-konuk-folio         to konuk-folio
              when other
                   display message box "Bagli register karti bulunamadi"
              end-evaluate
         not invalid
             if key-status = 16 then 
                 if konuk-fol-kodu not = "R" then
                    display message box "Lutfen Oda Folyosu Seciniz"
                 else
*********************> profat.asy
                    initialize dokcagir-tasi
                    set dokcagir-tasi-call-proforma2   to true
                    move rez-no                        to dokcagir-rez-no
                    move konuk-folio                   to dokcagir-konuk-folio
                    perform dokcagir-call
                    move dokcagir-rez-no               to rez-no
                    move dokcagir-konuk-folio          to konuk-folio
                 end-if
             end-if

             if key-status = 21 then 
                if konuk-fol-kodu not = "R" then
                   display message box 
                           "Lutfen Oda Folyosu Seciniz"
                else
**************************> ozlukgir.asy
                   initialize dokcagir-tasi
                   set dokcagir-tasi-call-ozlukgir1 to true
                   move konuk-folio                 to dokcagir-konuk-folio
                   perform dokcagir-call
                   move dokcagir-konuk-folio        to konuk-folio
                end-if
             end-if

             if key-status = 14 then
**********************> rezcin.asy
                initialize dokcagir-tasi
                set dokcagir-tasi-call-cin2          to true
                move konuk-rez-no                    to dokcagir-konuk-rez-no      
                move konuk-folio                     to dokcagir-konuk-folio
                perform dokcagir-call
                move dokcagir-konuk-folio            to konuk-folio
                move dokcagir-konuk-rez-no           to konuk-rez-no
             end-if

             if key-status = 6 then
**************************> folio.asy
                initialize dokcagir-tasi
                set dokcagir-tasi-call-folio1      to true
                move konuk-folio                   to dokcagir-konuk-folio
                perform dokcagir-call
                move dokcagir-konuk-folio          to konuk-folio
             end-if
                 
             if key-status = 11
                initialize dokcagir-tasi
                set dokcagir-tasi-call-kfolio     to true
                move konuk-folio                   to dokcagir-konuk-folio
                perform dokcagir-call
                move dokcagir-konuk-folio          to konuk-folio
             end-if

             if key-status = 20 then
                if konuk-durumu = "H" then
                   display message box "Oda C/out Olmus"
                else
********************> cout.asy
                   initialize dokcagir-tasi
                   set dokcagir-tasi-call-cout2 to true
                   move konuk-odano             to dokcagir-konuk-odano
                   move konuk-folio             to dokcagir-konuk-folio
                   perform dokcagir-call
                   move dokcagir-konuk-odano    to konuk-odano
                   move dokcagir-konuk-folio    to konuk-folio
                end-if
             end-if
        end-read
       
         if konuk-folio = 99999999 then
            add 1 to satir-yer
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if

         if konuk-folio = 0 and satir-yer > 2 then
            subtract 1 from satir-yer 
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if
         end-perform

         close konuk 
              
        

    when 18 
         open input rez 
           
        
         perform test after until not (rez-no  = 99999999 or rez-no  = 0)  
         
              inquire Form2-Gd-1(satir-yer,1) 
                      cell-data in rez-no
        

         read rez no lock invalid 
              display message box 
                      "Bagli rezervasyon bulunamadi"
              exit perform 
         not invalid
**************************> rez.asy
             initialize dokcagir-tasi
             set dokcagir-tasi-call-rez1   to true
             move rez-no                   to dokcagir-rez-no
             perform dokcagir-call
             move dokcagir-rez-no          to rez-no
         end-read

         if rez-no = 99999999 then
            add 1 to satir-yer
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if

         if rez-no = 0 and satir-yer > 2 then
            subtract 1 from satir-yer 
            modify Form2-Gd-1 cursor-y = satir-yer   
         end-if
         end-perform
         close rez
     

     end-evaluate.
*
 raporla.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi 
     open output dokumer 
     open input takas3 
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Grafik Forecast Verileri" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Grafik Forecast Verileri" to det-filler
     move "ilk Tarih:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "                " to det-filler
     move "Son Tarih:"     to det-filler(41:10)
     move son-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move son-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move son-yil        to det-filler(57:04)
     write dokumer-rec from detay
     

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2) 
     move "Tarih "              to  det-tarih 
     move "Oda     "            to det-oda1  
     move "Doluluk"             to det-yuzde1 
     move "Pax     "            to det-pax1 
     move "Pax Ort "            to det-paxort1
     move "Oda Ort "            to det-odaort1
     move "Tutar   "            to det-tutar1 
     move "Onceki Bugun"        to det-ara1
     move "Tarih "              to det-tarih 
     move "Oda     "            to det-oda2 
     move "Doluluk"             to det-yuzde2 
     move "Pax     "            to det-pax2 
     move "Pax Ort "            to det-paxort2
     move "Oda Ort "            to det-odaort2
     move "Tutar   "            to det-tutar2 
     move "Onceki Gerc "        to det-ara2
     move "Oda     "            to det-oda3 
     move "Doluluk "            to det-yuzde3 
     move "Pax     "            to det-pax3 
     move "Pax Ort "            to det-paxort3
     move "Oda Ort "            to det-odaort3
     move "Tutar   "            to det-tutar3   
      
        move "|" to fil-0 fil-1  fil-2 fil-3  fil-4   fil-5  fil-6  fil-11  fil-12  fil-13  
        fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 fil-24 fil-25  fil-26 
        fil-27 fil-28            
     write dokumer-rec from detay
     move ilk-tarih to takas3-tarih
       if Datatip(1:1) = "A" 
                   move "00" to takas3-gun
        end-if
     start takas3 key >= takas3-tarih invalid move "10" to fs-takas3
     end-start
    

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
    move "|" to fil-0 fil-1  fil-2 fil-3  fil-4   fil-5  fil-6  fil-11  fil-12  fil-13  
        fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 fil-24 fil-25  fil-26 
        fil-27 fil-28   
     write dokumer-rec from detay
  
**************************
        
     perform  until fs-takas3 = "10"
     read takas3 next no lock end move "10" to fs-takas3
     not at end
          if takas3-tarih > son-tarih
               exit perform
          end-if

          initialize dokumer-rec detay 
 
          move takas3-gun        to egun
          move takas3-ay         to eay
          move takas3-yil        to eyil
          move etarih             to det-tarih

          move  G-TAKAS3-ODA to zy-oda
          move zy-oda        to det-oda1

         compute yuzde-s rounded = ( G-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde1

          move G-TAKAS3-p to zy-pax
          move zy-pax to det-pax1
          compute ort rounded = G-TAKAS3-t / G-TAKAS3-ODA
          move ort to zy-ort
          move zy-ort to det-odaort1

          compute ort rounded = G-TAKAS3-t / G-TAKAS3-p
          move ort to zy-ort
          move zy-ort to det-paxort1

          move G-TAKAS3-t to zy-tutar
          move zy-tutar   to det-tutar1

****************************************
          move  Gk-TAKAS3-ODA to zy-oda
          move zy-oda        to det-oda2

         compute yuzde-s rounded = ( Gk-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde2

          move Gk-TAKAS3-p to zy-pax
          move zy-pax to det-pax2
          compute ort rounded = Gk-TAKAS3-t / Gk-TAKAS3-ODA
          move ort to zy-ort
          move zy-ort to det-odaort2

          compute ort rounded = Gk-TAKAS3-t / Gk-TAKAS3-p
          move ort to zy-ort
          move zy-ort to det-paxort2

          move Gk-TAKAS3-t to zy-tutar
          move zy-tutar   to det-tutar2

*******************************************
          move  Gk1-TAKAS3-ODA to zy-oda
          move zy-oda        to det-oda3

         compute yuzde-s rounded = ( Gk1-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde3

          move Gk1-TAKAS3-p to zy-pax
          move zy-pax to det-pax3
          compute ort rounded = Gk1-TAKAS3-t / Gk-TAKAS3-ODA
          move ort to zy-ort
          move zy-ort to det-odaort3

          compute ort rounded = Gk1-TAKAS3-t / Gk-TAKAS3-p
          move ort to zy-ort
          move zy-ort to det-paxort3

          move Gk1-TAKAS3-t to zy-tutar
          move zy-tutar   to det-tutar3









         move "|" to   fil-0   fil-1   fil-2  fil-3  fil-4   fil-5  fil-6  fil-11 
                       fil-12  fil-13  fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 
                       fil-24  fil-25  fil-26 fil-27 fil-28    
*          move takas-sabah-adet to z-kahtop
*          move z-kahtop         to det-2

*          move takas-ogle-adet to z-ogltop
*          move z-ogltop         to det-3

*          move takas-aksam-adet to z-akstop
*          move z-akstop         to det-4

          write dokumer-rec from detay
           end-read
     end-perform
    
              initialize dokumer-rec detay 
          
          move "TOPLAM "           to det-tarih


          move takas-detay-ok to z-5
                              move z-5 to detay-adi(16:)
                              move TAKAS-DETAY-pk to z-pax
                              move z-pax to  detay-adi(24:)
                              compute ort rounded = TAKAS-DETAY-tk /  TAKAS-DETAY-pk
                              move ort        to z-ort
                              move z-ort to detay-adi(34:)
                              move TAKAS-DETAY-tk to z-tutar
                              move z-tutar to  detay-adi(42:)



          move  toplam-siklik to zy-oda
          move zy-oda        to det-oda1
            compute yuzde-s rounded =  ( toplam-siklik / toplam-oda-kap) * 100
        
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde1

          move toplam-pax to zy-pax
          move zy-pax to det-pax1
          compute ort rounded = toplam-gelir / toplam-siklik
          move ort to zy-ort
          move zy-ort to det-odaort1

          compute ort rounded = toplam-gelir / toplam-pax
          move ort to zy-ort
          move zy-ort to det-paxort1

          move toplam-gelir to zy-tutar
          move zy-tutar   to det-tutar1

****************************************
          move  takas-detay-ok to zy-oda
          move zy-oda        to det-oda2

         compute yuzde-s rounded = ( takas-detay-ok / toplam-oda-kap )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde2

          move TAKAS-DETAY-pk to zy-pax
          move zy-pax to det-pax2
          compute ort rounded = TAKAS-DETAY-tk / takas-detay-ok
          move ort to zy-ort
          move zy-ort to det-odaort2

          compute ort rounded = TAKAS-DETAY-tk / TAKAS-DETAY-pk
          move ort to zy-ort
          move zy-ort to det-paxort2

          move TAKAS-DETAY-tk to zy-tutar
          move zy-tutar   to det-tutar2

*******************************************
          move  takas-detay-ok1 to zy-oda
          move zy-oda        to det-oda3

         compute yuzde-s rounded = ( takas-detay-ok1 / toplam-oda-kap )  * 100
          move yuzde-s to zy-yuzde 
          move zy-yuzde to det-yuzde3

          move TAKAS-DETAY-pk1 to zy-pax
          move zy-pax to det-pax3
          compute ort rounded = TAKAS-DETAY-tk1 / takas-detay-ok1
          move ort to zy-ort
          move zy-ort to det-odaort3

          compute ort rounded = TAKAS-DETAY-tk1 / TAKAS-DETAY-pk1
          move ort to zy-ort
          move zy-ort to det-paxort3

          move TAKAS-DETAY-tk1 to zy-tutar
          move zy-tutar   to det-tutar3

                     move "T"          to det-dokumer-20(1:1)
                          move "A"          to det-dokumer-20(3:1)
                         move 481 to det-renk1
                         move "1"          to det-dokumer-20(10:1)







         move "|" to   fil-0   fil-1   fil-2  fil-3  fil-4   fil-5  fil-6  fil-11 
                       fil-12  fil-13  fil-14 fil-15 fil-16  fil-21 fil-22 fil-23 
                       fil-24  fil-25  fil-26 fil-27 fil-28    
*          move takas-sabah-adet to z-kahtop
*          move z-kahtop         to det-2

*          move takas-ogle-adet to z-ogltop
*          move z-ogltop         to det-3

*          move takas-aksam-adet to z-akstop
*          move z-akstop         to det-4

          write dokumer-rec from detay  
   

     close dokumer
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     close takas3
     delete file dokumer . 
*


  detay-raporla.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi 
     open output dokumer 
     open input takas3 
*/WINDOW TITLE
     open input   kodlar02  konum ulke acenta takas-detay
     initialize dokumer-rec detay2
     move "W"                  to det2-dokumer-20(1:)
     move "Grafik Forecast Verileri" to det2-filler
     write dokumer-rec from detay2
*/ BASLIKLAR
     initialize dokumer-rec detay2
     move "1"          to det2-dokumer-20(10:1)
     move "B"                  to det2-dokumer-20(1:1)
     move "Grafik Forecast Verileri" to det2-filler
        write dokumer-rec from detay2
    
    

     initialize dokumer-rec detay2
     move "1"          to det2-dokumer-20(10:1)
     move "B"                  to det2-dokumer-20(1:1)
     move "                " to det2-filler
      move "ilk Tarih:"     to det2-filler(41:10)
     move ilk-gun        to det2-filler(51:02)
     move "/"            to det2-filler(53:01)
     move ilk-ay         to det2-filler(54:02)
     move "/"            to det2-filler(56:01)
     move ilk-yil        to det2-filler(57:04)
     move "Son Tarih:"     to det2-filler(61:10)
     move son-gun        to det2-filler(71:02)
     move "/"            to det2-filler(73:01)
     move son-ay         to det2-filler(74:02)
     move "/"            to det2-filler(76:01)
     move son-yil        to det2-filler(77:04)
     write dokumer-rec from detay2
     

     

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay2
     move "O" to det2-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det2-filler
     write dokumer-rec from detay2
*/ BASLIKLAR  
 
     initialize dokumer-rec detay2 
     move "1"          to det2-dokumer-20(10:1)
     move "D1"                          to det2-dokumer-20(1:2) 
     move "Tarih "              to  det2-tarih 

       perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                              evaluate bol-tip
                                  when "T" 
                                    if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                             evaluate  takas-detay-asya-kodu(1:2)
                                                 when "00"
                                                      move "Kendi Konaklamalari" to detay-adi
                                                 when  other 
                                                     move "Transferle Gelenler" to detay-adi
                                             end-evaluate
                                              
                                          
                                     end-if


                                  when "S" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                             evaluate  takas-detay-asya-kodu(1:2)
                                                 when "01"
                                                   move "Son Hafta Satislari" to detay-adi
                                                 when "02"
                                                   move "8-14 gun once Satislari" to detay-adi
                                                 when "03"
                                                   move "15-21 gun once Satislari" to detay-adi
                                                when "04"
                                                   move "22-28 gun once Satislari" to detay-adi
                                                when "05"
                                                   move "29-35 gun once Satislari" to detay-adi
                                                when "06"
                                                   move "36-42 gun once Satislari" to detay-adi
                                                when "07"
                                                   move "43-49 gun once Satislari" to detay-adi
                                                when "08"
                                                   move "50-56 gun once Satislari" to detay-adi
                                                 when "09"
                                                   move "57-63 gun once Satislari" to detay-adi
                                                 when "10"
                                                   move "64-70 gun once Satislari" to detay-adi
                                                 when "11"
                                                   move "71-77 gun once Satislari" to detay-adi
                                                when  other 
                                                   move "Daha onceki Satislar" to detay-adi
                                             end-evaluate
                                              
                                          
                                     end-if
                                  when "P" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Pazarlar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to kodlar02-kodu
                                              move "E"  to kodlar02-tipi
                                              read kodlar02 no lock invalid continue
                                             end-read
                                           move kodlar02-adi to detay-adi
                                     end-if
                                   when "R" 
                                      if ii = max-detay - 1 then 
                                             move "Diger Anlasmalar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to kodlar02-kodu
                                              move "D"  to kodlar02-tipi
                                              read kodlar02 no lock invalid continue
                                             end-read
                                           move kodlar02-adi to detay-adi
                                     end-if
                                    when "F" 
                                    when "O"
                                      if ii = max-detay - 1 then 
                                             move "Diger Konumlar" to detay-adi
                                        else
                                              move function numval(takas-detay-asya-kodu) to konum-anahtar
                                              read konum no lock invalid continue
                                             end-read
                                           move konum-adi to detay-adi
                                     end-if
                                   when "A"
                                      if ii = max-detay - 1 then 
                                             move "Diger Acentalar" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to acenta-kodu
                                              read acenta no lock invalid continue
                                             end-read
                                           move acenta-adi to detay-adi
                                     end-if
                                   when "U"
                                      if ii = max-detay - 1 then 
                                             move "Diger Ulkeler" to detay-adi
                                        else
                                              move takas-detay-asya-kodu to ulke-anah
                                              read ulke no lock invalid continue
                                             end-read
                                           move ulke-adi to detay-adi
                                     end-if
                                       
                               end-evaluate
              move detay-adi           to  det2-oda1(ii + 1 )
              move "|"                 to  fil2-1(ii + 1 )
        end-perform 
      move "TOPLAM   "            to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
     move "Yuzde "            to det2-yuzde( ii + 2 )
  
      
        move "|" to fil2-0 det2-fil(ii + 2 )  
     write dokumer-rec from detay2
     move ilk-tarih to takas3-tarih
      if Datatip(1:1) = "A" 
                   move "00" to takas3-gun
                  
        end-if
     start takas3 key >= takas3-tarih invalid move "10" to fs-takas3
     end-start
    

     initialize dokumer-rec detay2
     move "D2"           to det2-dokumer-20(1:2)
     move "-"            to det2-dokumer-20(5:1)
        perform varying ii from 0 by 1 until ii > son-sira - 1
            
              move  all "-"        to det2-oda1(ii + 1)
              move "|"                 to  fil2-1(ii + 1 )

          end-perform 
          
         move  all "-"      to det2-oda1(ii + 1)
          move "|"                 to  fil2-1(ii + 1)

        
           move all "-"  to det2-yuzde(ii + 2 )

              move "|" to fil2-0 det2-fil(ii + 2 ) 

    
     write dokumer-rec from detay2
  
**************************
        
     perform  until fs-takas3 = "10"
     read takas3 next no lock end move "10" to fs-takas3
     not at end
          if takas3-tarih > son-tarih
               exit perform
          end-if
         
                             



          initialize dokumer-rec detay2 
 
          move takas3-gun        to egun
          move takas3-ay         to eay
          move takas3-yil        to eyil
          move etarih             to det2-tarih


          perform varying ii from 0 by 1 until ii > son-sira - 1
              move  takas-yer( ii + 1 ) to iii
             move   G-TAKAS3-DETAY(iii)  to zy-oda
              move zy-oda        to det2-oda1(ii + 1)
              move "|"                 to  fil2-1(ii + 1 )

          end-perform 
           move  G-TAKAS3-ODA to zy-oda
          move zy-oda        to det2-oda1(ii + 1)
          move "|"                 to  fil2-1(ii + 1)

         compute yuzde-s rounded = ( G-TAKAS3-ODA / TAKAS3-HAZIR-ODA )  * 100
           move  yuzde-s to zy-yuzde
           move zy-yuzde  to det2-yuzde(ii + 2 )

              move "|" to fil2-0 det2-fil(ii + 2 ) 

                      
          write dokumer-rec from detay2
           end-read
     end-perform
       
         initialize dokumer-rec detay2 
          move "TOP. ODA"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                      move takas-detay-o to zY-ODA
                     move zy-oda        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        MOVE TOPLAM-Siklik TO zY-ODA
        move zy-oda        to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
        compute yuzde-s rounded =  ( toplam-siklik / toplam-oda-kap) * 100
        move yuzde-s to yuzde-z   
        move yuzde-z  to det2-yuzde(ii + 2 )
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2  
   
          initialize dokumer-rec detay2 
          move "TOP. PAX"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                      move TAKAS-DETAY-p to zY-pax
                     move zy-pax        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        MOVE TOPLAM-buyuk TO zY-ODA
        move zy-oda        to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
        compute yuzde-s rounded =  ( toplam-pax / toplam-pax-kap) * 100
        move yuzde-s to yuzde-z   
        move yuzde-z  to det2-yuzde(ii + 2 )
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 

          initialize dokumer-rec detay2 
          move "TOP. PP"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                     compute ort rounded =  TAKAS-DETAY-t / TAKAS-DETAY-p
                      move ort to zY-ort
                     move zy-ort        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        compute ort rounded =  toplam-gelir / toplam-pax
        move ort to zY-ort
        move zy-ort       to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
       
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 

                initialize dokumer-rec detay2 
          move "ODA ORT "           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                     compute ort rounded =  TAKAS-DETAY-t / TAKAS-DETAY-o
                      move ort to zY-ort
                     move zy-ort        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

        compute ort rounded =  toplam-gelir / TOPLAM-Siklik
        move ort to zY-ort
        move zy-ort       to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
       
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 
       

      
          initialize dokumer-rec detay2 
          move "TOP. GELIR"           to det2-tarih
          perform varying ii from 0 by 1 until ii > son-sira - 1
                              move  takas-yer( ii + 1 ) to iii
                               move iii to takas-detay-sira 
                                     read takas-detay key   takas-detay-sira invalid 
                                           stop " "           
                                         
                                      end-read
                    
                      move TAKAS-DETAY-t to zY-tutar
                     move zY-tutar        to det2-oda1(ii + 1)
                       move "|"                 to  fil2-1(ii + 1 )
        end-perform 

     
        move toplam-gelir to zY-tutar
        move zY-tutar     to det2-oda1(ii + 1)
        move "|"                  to  fil2-1(ii + 1 )
        move "|"                 to  fil2-1(ii + 1 )
        move "|" to fil2-0 det2-fil(ii + 2 ) 
       
        move 481 to det2-renk1(ii + 2 )
        move "T"          to det2-dokumer-20(1:1)
        move "A"          to det2-dokumer-20(3:1)
        move "1"          to det2-dokumer-20(10:1)
       write dokumer-rec from detay2 

        

        close  kodlar02  konum ulke acenta takas-detay

     close dokumer
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     close takas3
     delete file dokumer . 
*
 aft-yukle.
     perform grid-yukle.  
*
 grid-yukle.
      open input takas  takas3 konum rez firma 
                 acenta kodlar02 doviz
         initialize takas3-rec toplam-kayit doviz-toplari
                    toplam-buyuk toplam-kucuk 
                    toplam-free  toplam-bebek
        move myvalueindex to takas3-sira
        read takas3 key takas3-sira  invalid stop " "
        end-read
        move takas3-yil  to grf-yil
        move takas3-ay   to grf-ay
        move takas3-gun  to grf-gun
        
     
       move grf-yil to takas-yil
       move grf-ay  to takas-ay
       move grf-gun to takas-gun
      move "Rapor Tarihi:" to baslik-val(1:14)
      move grf-gun    to egun
      move grf-gun            to baslik-val(14:2)
      move "/"             to baslik-val(16:1)
      move grf-ay          to baslik-val(17:2)
      move "/"             to baslik-val(19:1)
      move grf-yil         to baslik-val(20:4)

      modify fr-baslik, TITLE = baslik-val

      modify form2-gd-1,mass-update = 1
                        reset-grid = 1
      initialize form2-gd-1-record
      move "Rez No"         to gd-1-col-1
      move "Adi"            to gd-1-col-2
      move "Soyadi"         to gd-1-col-3
      move "C/In Tarihi"    to gd-1-col-4
      move "C/out Tarihi"   to gd-1-col-5
      move "Acenta Adi"     to gd-1-col-6
      move "Pansiyon"       to gd-1-col-7
      move "Pazar"          to gd-1-col-8
      move "Oda"            to gd-1-col-8-1
      move "P"              to gd-1-col-9
      move "C"              to gd-1-col-10
      move "F"              to gd-1-col-11
      move "B"              to gd-1-col-12
      move "Fiyat"          to gd-1-col-13
      move "Doviz"          to gd-1-col-14  
      move "Sat.Tar"        to gd-1-col-15 
      move "O.Konumu"       to gd-1-col-16
      move "F.Konumu"       to gd-1-col-17 
      move "Firma Adi"      to gd-1-col-18
      modify form2-gd-1,record-to-add(form2-gd-1-record)
     
      initialize takas-rec    


       open input cast 
       move grf-yil to takas-yil
       move grf-ay  to takas-ay
       move grf-gun to takas-gun
  
      start takas key not < takas-anahtar invalid
          continue 
      not invalid 
      perform with test after until fs-takas = "10"
      read takas next no lock end move "10"  to fs-takas 
      not at end
               if takas-yil <> grf-yil or
                  takas-ay  <> grf-ay  or
                  takas-gun <> grf-gun
                     exit perform 
               end-if

               if acn-kod not = spaces and 
                  takas-acenta not = acn-kod
                     exit perform cycle
               end-if 

               initialize rez-rec
               move takas-rez-no         to rez-no
               read rez no lock invalid
                    exit perform cycle
               end-read
              
               if takas-tarih >= rez-cik-tar
                   exit perform cycle 
               end-if

               if rez-durumu not = "I"
                    exit perform cycle 
               end-if
               initialize cast-rec
               MOVE TAKAS-TARIH to cast-tarih
               move takas-rez-no to cast-rez-no
               read cast no lock invalid
                  continue
               end-read
               if takas-tarih < tarih-tasi
                     move cast-basilan-fiyat to rez-fiyati
                     else
                     move CAST-FIYATI to rez-fiyati
               end-if
               move cast-kisi to rez-kisi
               move cast-oda-no to rez-odano
          


               initialize form2-gd-1-record
               move takas-rez-no      to gd-1-col-1
               move rez-adi           to gd-1-col-2
               move rez-soyadi        to gd-1-col-3

               move rez-gir-gun       to egun
               move rez-gir-ay        to eay
               move rez-gir-yil       to eyil
               move etarih            to gd-1-col-4
               move rez-al-gun       to egun
               move rez-al-ay        to eay
               move rez-al-yil       to eyil
               move etarih            to gd-1-col-15
               move rez-cik-gun       to egun
               move rez-cik-ay        to eay
               move rez-cik-yil       to eyil
               move etarih            to gd-1-col-5

               initialize acenta-rec 
               move rez-acenta        to acenta-kodu
               read acenta no lock invalid
                   move "Tanimsiz..."  to acenta-adi
               end-read 
                   move acenta-adi     to gd-1-col-6

               initialize kodlar02-rec 
               move "A"                to kodlar02-tipi
               move rez-pan-tipi       to kodlar02-kodu
               read kodlar02 no lock invalid 
                    move "***"         to kodlar02-adi
               end-read 
                    move kodlar02-adi  to gd-1-col-7

               initialize kodlar02-rec 
               move "E"                to kodlar02-tipi
               move rez-pazar          to kodlar02-kodu
               read kodlar02 no lock invalid 
                    move "***"         to kodlar02-adi
               end-read 
                    move kodlar02-adi  to gd-1-col-8

               move rez-odano          to gd-1-col-8-1

               if rez-firma not = spaces
                  initialize firma-rec
                  move rez-firma       to firma-kodu
                  read firma no lock invalid 
                      move "Hata-"     to firma-adi
                  end-read                       
                      move firma-adi   to gd-1-col-18
               end-if 
               move rez-buyuk          to z-tek
               move z-tek              to gd-1-col-9
               move rez-kucuk          to z-tek
               move z-tek              to gd-1-col-10
               move rez-free           to z-tek
               move z-tek              to gd-1-col-11
               move rez-bebek          to z-tek
               move z-tek              to gd-1-col-12

               move rez-fiyati         to e-tut
               move e-tut              to gd-1-col-13


               initialize doviz-rec
               move rez-doviz          to doviz-kodu
               read doviz no lock invalid 
                    move "***"         to d-kisa-adi
               end-read 
                    move d-kisa-adi    to gd-1-col-14
               if cast-oda-konumu > 0
                  initialize konum-rec
                  move cast-oda-konumu    to konum-anahtar
                  read konum no lock invalid
                      move "Hata-"     to konum-adi
                  end-read                          
                      move konum-adi   to gd-1-col-16
               end-if 
               if cast-fiyat-konumu > 0
                  initialize konum-rec
                  move cast-fiyat-konumu    to konum-anahtar
                  read konum no lock invalid
                      move "Hata-"     to konum-adi
                  end-read                          
                      move konum-adi   to gd-1-col-17
               end-if 

               perform filt-kontrol
               if gec = 0
                  add 1   to toplam-kayit
                  compute toplam-buyuk = toplam-buyuk + rez-buyuk                   
                  compute toplam-kucuk = toplam-kucuk + rez-kucuk
                  compute toplam-free  = toplam-free  + rez-free                   
                  compute toplam-bebek = toplam-bebek + rez-bebek
                  perform varying xiii from 1 by 1 until xiii > 13
                          if top-dov(1) = spaces 
                             move d-kisa-adi to top-dov(1)
                             move rez-fiyati to top-rl(1)
                             exit perform 
                          end-if
                          if top-dov(xiii) = d-kisa-adi
                             compute top-rl(xiii) = top-rl(xiii) + rez-fiyati
                             exit perform 
                          end-if
                          if top-dov(xiii) = spaces 
                             move d-kisa-adi to top-dov(xiii)
                             move rez-fiyati to top-rl(xiii)
                             exit perform 
                          end-if
                  end-perform 
*                  compute top-reel     = top-reel     + rez-fiyati

                  modify form2-gd-1,record-to-add(form2-gd-1-record)
               end-if
      end-read 
      end-perform
      end-start   
      close cast    
               initialize form2-gd-1-record
               move "Toplam--->"           to gd-1-col-1
               move toplam-kayit           to ztoplam
               move ztoplam                to gd-1-col-2

               move toplam-buyuk           to ztoplam
               move ztoplam                to gd-1-col-9

               move toplam-kucuk           to ztoplam
               move ztoplam                to gd-1-col-10

               move toplam-free            to ztoplam
               move ztoplam                to gd-1-col-11

               move toplam-bebek           to ztoplam
               move ztoplam                to gd-1-col-12

               if top-dov(1) <> spaces 
                  move top-rl(1)   to z-8
                  move z-8         to gd-1-col-13
                  move top-dov(1)  to gd-1-col-14
               end-if
               modify form2-gd-1,record-to-add(form2-gd-1-record)
               modify form2-gd-1(toplam-kayit + 2,1),row-color = 481
               perform varying xiii from 2 by 1 until xiii > 13
                       if top-dov(xiii) = spaces 
                          exit perform 
                       end-if
                       initialize form2-gd-1-record
                       move top-rl(xiii)    to z-8
                       move z-8             to gd-1-col-13
                       move top-dov(xiii)   to gd-1-col-14
                       add xiii to toplam-kayit  
                       subtract 1 from toplam-kayit
                       modify form2-gd-1,record-to-add(form2-gd-1-record)
                       modify form2-gd-1(toplam-kayit + 2,1),row-color = 481
                       add 1 to toplam-kayit  
                       subtract xiii from toplam-kayit
               end-perform 

      close takas rez acenta konum firma 
            kodlar02 doviz takas3
      modify form2-gd-1,mass-update = 0
      .
*
 filt-kontrol.
      initialize gec 
      if grid-occ(1) <> spaces
         move rez-no         to kelime
         move grid-occ(1)    to aranan-kelime
         move 0              to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0 
            move 1 to gec 
            exit paragraph
         end-if
      end-if       

      if grid-occ(2) <> spaces
         move function upper-case(rez-adi) to kelime
         move function upper-case(grid-occ(2))  to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
      
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0 
            move 1 to gec 
            exit paragraph
         end-if
      end-if
      
      if grid-occ(3) <> spaces
         move function upper-case(rez-soyadi)   to kelime
         move function upper-case(grid-occ(3))  to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
      
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0 
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(4) <> spaces
         move gd-1-col-4        to kelime
         move grid-occ(4)       to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
      
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0 
            move 1 to gec 
            exit paragraph
         end-if
      end-if
      if grid-occ(5) <> spaces
         move gd-1-col-5        to kelime
         move grid-occ(5)       to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
      
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0                 
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(6) <> spaces  
         move function upper-case(acenta-adi) to kelime
         move function upper-case(grid-occ(6))  to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
      
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0                 
            move 1 to gec 
            exit paragraph
         end-if
      end-if
      if grid-occ(7) <> spaces
         move function upper-case(gd-1-col-7)  to kelime
         move function upper-case(grid-occ(7)) to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(8) <> spaces
         move function upper-case(gd-1-col-8)  to kelime
         move function upper-case(grid-occ(8)) to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(9) <> gd-1-col-8-1 and spaces  
            move 1 to gec 
            exit paragraph
      end-if

      if grid-occ(14) <> spaces
         move function upper-case(gd-1-col-14)      to kelime
         move function upper-case(grid-occ(14))       to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(15) <> spaces
         move function upper-case(gd-1-col-15)      to kelime
         move function upper-case(grid-occ(15))       to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(16) <> spaces
         move function upper-case(gd-1-col-16)      to kelime
         move function upper-case(grid-occ(16))       to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(17) <> spaces
         move function upper-case(gd-1-col-17)      to kelime
         move function upper-case(grid-occ(17))     to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if

      if grid-occ(18) <> spaces
         move function upper-case(gd-1-col-18)     to kelime
         move function upper-case(grid-occ(18))       to aranan-kelime
         move 0 to aranan-i aranan-kelime-boy
         inspect aranan-kelime tallying aranan-kelime-boy
                 for trailing spaces 
         compute aranan-kelime-boy = function length(aranan-kelime) -
                                     aranan-kelime-boy
         inspect kelime tallying aranan-i 
                 for all aranan-kelime(1:aranan-kelime-boy)
         if aranan-i = 0              
            move 1 to gec 
            exit paragraph
         end-if
      end-if
      .
*
 genel2-cinkdv-ayarla. 
     if genel2-kdv-gecerlilik-tar not = spaces and 
        genel2-kdv-gecerlilik-tar not = zeroes
*        if kdv-rap-tarih < genel2-kdv-gecerlilik-tar or kdv-rap-tarih > 20201231  |firat 15/12/2020 düzeltme
*        if kdv-rap-tarih < genel2-kdv-gecerlilik-tar or kdv-rap-tarih >= 20210601 |firat 26/04/2021 düzeltme
*             if kdv-rap-tarih < genel2-kdv-gecerlilik-tar or kdv-rap-tarih >= 20210630
            if genel2-kdv-bit-tar = spaces or genel2-kdv-bit-tar = zeroes then
                   move 20210731 to genel2-kdv-bit-tar
            end-if
         if kdv-rap-tarih < genel2-kdv-gecerlilik-tar or kdv-rap-tarih >= genel2-kdv-bit-tar 
           move 8 to CINPARA-MUS-KDV
        else
           move 1 to CINPARA-MUS-KDV
        end-if
        if  kdv-rap-tarih >= 20230710
                   move 10 to CINPARA-MUS-KDV
                end-if
     end-if.

*
 Form1-Pb-3ba-Link.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          add 1 to ekran-fis-1
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis

     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer

*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                    to det-dokumer-20(1:)
     move "KVKK Sorgu Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "B"                    to det-dokumer-20(1:)
     move "KVKK Sorgu Raporu" to det-filler
     write dokumer-rec from detay
     initialize dokumer-rec detay
     move "B"                    to det-dokumer-20(1:)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O"                    to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR 
     initialize dokumer-rec detay
     move "D1"                  to det-dokumer-20(1:)    
     inquire Form2-Gd-1(1,1),
             cell-data det-tarih
     move all "|" to fil-0  
     write dokumer-rec from detay

     inquire Form2-Gd-1,last-row in son-satir
     perform varying xii from 2 by 1 until xii > son-satir 
         initialize dokumer-rec detay
         inquire Form2-Gd-1(xii,1),
                 cell-data det-tarih
         move all "|" to fil-0  
         write dokumer-rec from detay
     end-perform 



     initialize dokumer-rec detay
     move "D2"         to det-dokumer-20(1:)     
     move "-"          to det-dokumer-20(5:1)
     move all "-" to det-tarih  
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "-"          to det-dokumer-20(5:1)
     move all "-" to det-tarih  
     write dokumer-rec from detay

     close dokumer
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     delete file dokumer     .

 
