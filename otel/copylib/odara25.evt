* odara25.evt
* odara25.evt is generated from F:\asya\acugt.kaya\otel\odara25.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-End-Heading-Drag
        PERFORM Acu-combo-oda-durumu-Content
     WHEN Msg-Goto-Cell
        PERFORM oda-git
     WHEN Msg-Goto-Cell-Mouse
        PERFORM oda-git
     WHEN Msg-Grid-Rbutton-Up
        PERFORM sag-tus-basildi
     WHEN Other
        PERFORM Form1-Gd-1-Ev-Other
     END-EVALUATE
     .

 Form1-Gd-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Goto
           PERFORM oda-git
        END-EVALUATE
     ELSE
        PERFORM Form1-Gd-1-Ex-Other
     END-IF
     .

 Form1-Cb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-blokaj-oda-Event-Proc.
     .

 Form1-Cb-1a-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1b-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1ab-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-bos-temiz-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-blokajli-temiz-oda-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Ef-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Ntf-Changed
        EVALUATE Event-Control-Id
        WHEN 29
           PERFORM Form1-Ef-ack1-Ev-Ntf-Changed
        WHEN 30
           PERFORM Form1-Ef-ack1-Ev-Ntf-Changed
        END-EVALUATE
     END-EVALUATE
     .

 kart1-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM kart1-acc-Ev-Cmd-Goto
     END-EVALUATE
     .

 kart2-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM kart2-acc-Ev-Cmd-Goto
     END-EVALUATE
     .

 kart3-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM kart3-acc-Ev-Cmd-Goto
     END-EVALUATE
     .

 tek-ac-Event-Proc.
     .

 Form0-Event-Proc.
     .

 form0-exception-proc.
     PERFORM Form0-Ex-Other
     .

 Screen1-Event-Proc.
     .

 Screen2-Event-Proc.
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form4-Gd-1-Event-Proc.
     PERFORM Form4-Gd-1-Ev-Other
     .

 Form5-Event-Proc.
     .

 Form5-Exception-Proc.
     PERFORM Form5-Ex-Other
     .
***   start event editor code   ***
*--------------------------------------
*    genel icin mesaj konulacak
*    toplam oda sag tarafta takvimden alinacak ...
*    okumada problem var ........ 0116 ornegi ...
*--------------------------------------
 Form0-Bef-Create.
     perform adresleri-tasi.
     open input genel.
     move 1 to genel-anahtar
     read genel no lock invalid
          continue
     end-read
     close genel.
      move cost-sirketi of genel to cst-genel-dosya-adres
                                  kart-dosya-adres
                                  odenmez-dosya-adres

*                                  genelfis-dosya-adres
*                                  errorlog-dosya-adres
*                                  takvim-dosya-adres  
     move 0 to calisma.
*
 Form0-Aft-Initdata.
     open input doviz kur
     move ONKPARA-DOVIZ to doviz-kodu
     read doviz no lock invalid
          move "Tanimsiz" to d-kisa-adi
     end-read
     move d-adi-1 to extra-dov-adi
     move onkpara-doviz to kur-doviz
     move onkpara-banka  to kur-banka
     move tarih-tasi    to kur-tarih
     read kur no lock invalid
             move 1 to gunluk-kur
         not invalid move doviz-alis to gunluk-kur
     end-read
     close doviz kur
 
     initialize combo-oda-konumu-value combo-oda-tipi-value
     combo-oda-durumu-value acc-oda-kapasite-value
     combo-oda-tipi2-value combo-oda-tipi3-value. 

     modify combo-oda-konumu, reset-list = 1 mass-update = 1.
     modify combo-oda-durumu, reset-list = 1 mass-update = 1.
     modify combo-oda-tipi  , reset-list = 1 mass-update = 1.
     modify combo-oda-tipi2  , reset-list = 1 mass-update = 1.
     modify combo-oda-tipi3  , reset-list = 1 mass-update = 1.

     modify combo-oda-konumu,item-to-add("00-Hepsi")
     modify combo-oda-durumu,item-to-add("__-Hepsi")
     modify combo-oda-tipi,item-to-add("00-Hepsi")
     modify combo-oda-tipi2,item-to-add("00-Hepsi")
     modify combo-oda-tipi3,item-to-add("00-Hepsi")

     open input konum
     initialize konum-rec 
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          initialize combo-oda-konumu-value
          move konum-anahtar     to combo-oda-konumu-value
          move "-"               to combo-oda-konumu-value(3:)
          move konum-adi         to combo-oda-konumu-value(4:)
          modify combo-oda-konumu,item-to-add(combo-oda-konumu-value)
     end-read
     end-perform
     end-start.
     close konum.

     open input kodlar02.
     initialize kodlar02-rec
     move "C"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "C"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-durumu-value
                move kodlar02-kodu   to combo-oda-durumu-value
                move "-"             to combo-oda-durumu-value(3:)
                move kodlar02-adi    to combo-oda-durumu-value(4:)
                modify combo-oda-durumu,item-to-add(combo-oda-durumu-value)
             end-if
     end-read
     end-perform
     end-start.

     initialize kodlar02-rec
     move "G"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "G"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-tipi-value
                move kodlar02-kodu   to combo-oda-tipi-value
                move "-"             to combo-oda-tipi-value(3:)
                move kodlar02-adi    to combo-oda-tipi-value(4:)
                modify combo-oda-tipi,item-to-add(combo-oda-tipi-value)
             end-if
     end-read
     end-perform
     end-start.
     
     initialize kodlar02-rec
     move "H"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "H"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-tipi2-value
                move kodlar02-kodu   to combo-oda-tipi2-value
                move "-"             to combo-oda-tipi2-value(3:)
                move kodlar02-adi    to combo-oda-tipi2-value(4:)
                modify combo-oda-tipi2,item-to-add(combo-oda-tipi2-value)
             end-if
     end-read
     end-perform
     end-start.
     
     initialize kodlar02-rec
     move "I"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "I"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-tipi2-value
                move kodlar02-kodu   to combo-oda-tipi3-value
                move "-"             to combo-oda-tipi3-value(3:)
                move kodlar02-adi    to combo-oda-tipi3-value(4:)
                modify combo-oda-tipi3,item-to-add(combo-oda-tipi3-value)
             end-if
     end-read
     end-perform
     end-start.
     
      close kodlar02.
     move "00-Hepsi"        to combo-oda-konumu-value
     move "__-Hepsi"       to combo-oda-durumu-value
     move "00-Hepsi"       to combo-oda-tipi-value
     
     move "00-Hepsi"       to combo-oda-tipi2-value
     
     move "00-Hepsi"       to combo-oda-tipi3-value
     
     modify combo-oda-konumu,
            mass-update = 0
            value = combo-oda-konumu-value
     modify combo-oda-durumu,
            mass-update = 0
            value = combo-oda-durumu-value
     modify combo-oda-tipi,
            mass-update = 0
            value = combo-oda-tipi-value.
     modify combo-oda-tipi2,
            mass-update = 0
            value = combo-oda-tipi2-value.
     modify combo-oda-tipi3,
            mass-update = 0
            value = combo-oda-tipi3-value.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         

 Form0-Ex-Other.
    if key-status = 2001
       inquire cb-hayali-odalar, value in hayali-eh
       perform acu-form1-routine
    end-if.
*
 Form1-Aft-Initdata.
     
   
                                  
    move 1 to bos-oda-cb blokaj-oda-cb cout-oda-cb
    cin-oda-cb arizali-oda-cb arizali-dolu-oda-cb
    bos-temiz-oda-cb blokajli-temiz-oda-cb.
    display cb-bos-oda cb-blokaj-oda cb-cout-oda
    cb-cin-oda cb-arizali-oda cb-arizali-dolu-oda
    cb-bos-temiz-oda cb-blokajli-temiz-oda.

    perform gride-yukle.
    perform rez-durum-bul.
*/sadece bir kere yukleme icin yapildi
    initialize durum-dizi.
    add 1 to calisma.
    if calisma = 1 
    open input kodlar02
    move "C"   to kodlar02-tipi
    start kodlar02 key not < kodlar02-anah invalid
          continue
    not invalid
    initialize fs-kodlar02
    move 1000 to 4-hane
    perform with test after until fs-kodlar02 = "10"
    read kodlar02 next no lock end move "10" to fs-kodlar02
    not at end
         if kodlar02-tipi = "C"
            initialize x-20
            move kodlar02-kodu     to x-20
            move "\t"              to x-20(3:)
            move kodlar02-adi      to x-20(5:5)

            initialize durum-sayi
            compute durum-sayi = 4-hane - 1000 + 1
            move kodlar02-kodu to durum-kodu(durum-sayi)

            if 4-hane <> 1000
            call "w$menu" using wmenu-add,
                                sub-handle-1,
                                0,
                                0,
                                x-20,
                                4-hane
            else
            call "w$menu" using wmenu-change,
                                sub-handle-1,
                                1000,
                                0,
                                x-20,
                                1000
            end-if
            add 1 to 4-hane
         else
            move "10" to fs-kodlar02
            exit perform
         end-if
    end-read
    end-perform
    end-start
    close kodlar02
    end-if.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 gride-yukle.
      modify form1-gd-1,mass-update = 1 reset-grid = 1 
     perform  grid-yeniden-bol.
       modify form1-gd-1,mass-update = 1 reset-grid = 1 
    modify progress-bar-1, fill-percent = 0.
    open i-o genelfis.
    move 1 to genelfis-anahtar
    read genelfis no lock invalid
         accept ekran-fis-1 from time
    end-read
    add 1 to ekran-fis-1
    rewrite genelfis-rec invalid
            write genelfis-rec invalid continue end-write
    end-rewrite
    close genelfis.

    move ekran-fis-1 (2:)         to takas-no

    open output takas close takas 
    open i-o takas with bulk-addition.
    open input odalar.
    initialize i odalar-rec odalar-ana-dizi toplamlar
    start odalar key not < odalar-anah invalid
          modify form1-gd-1,mass-update = 1
***          display message box "mass-update = 1"
          close odalar 
          exit paragraph
    not invalid
    perform with test after until fs-odalar = "10"
    read odalar next no lock end move "10" to fs-odalar
    not at end
         if odalar-no = spaces
            exit perform cycle
         end-if
        
         if combo-oda-konumu-value(1:2) <> odalar-konumu and 
            combo-oda-konumu-value(1:2) <> "00"
            exit perform cycle
         end-if
         if acc-oda-kapasite-value <> odalar-kapasite(1:2) and
            acc-oda-kapasite-value <> 0
            exit perform cycle
         end-if
         if combo-oda-durumu-value(1:2) <> odalar-durumu and
            combo-oda-durumu-value(1:2) <> "__"
            exit perform cycle
         end-if
         if combo-oda-tipi-value(1:2) <> odalar-tipi and
            combo-oda-tipi-value(1:2) <> "00"
            exit perform cycle
         end-if
         if combo-oda-tipi2-value(1:2) <> odalar-tipi2 and
            combo-oda-tipi2-value(1:2) <> "00"
            exit perform cycle
         end-if
         if combo-oda-tipi3-value(1:2) <> odalar-tipi3 and
            combo-oda-tipi3-value(1:2) <> "00"
            exit perform cycle
         end-if
         if hayali-eh = 0
            if odalar-hayali = "H"
               exit perform cycle
            end-if
         end-if
         initialize takas-rec
         move odalar-no        to takas-oda
         move odalar-durumu    to takas-oda-durumu
        
         write takas-rec invalid 
            display message box "Hata 3555" 
         end-write
         add 1 to toplam-oda
    end-read
    end-perform
    end-start

    if i > 0
       modify form1-gd-1,
              record-to-add(odalar-ana-dizi)
    end-if.
    
    open input rez cast konuk.
    initialize cast-rec rez-rec
    move tarih-tasi          to cast-tarih
    start cast key not < cast-anah invalid
          continue
    not invalid
*    accept eski-t from time 
    initialize fs-cast
    perform with test after until fs-cast = "10"
    
    read cast next no lock end move "10" to fs-cast
    not at end
         add 1 to kayit 
         if cast-tarih > tarih-tasi
            move "10" to fs-cast
            exit perform
         end-if
         if cast-tarih not > tarih-tasi
            move cast-rez-no  to rez-no
            read rez no lock invalid 
                 exit perform cycle
            end-read
*            if rez-cik-tar = tarih-tasi then 
*               move rez-folio to konuk-folio
*               read konuk no lock invalid continue
*               end-read
*            end-if
            if rez-durumu = "I" and rez-c-in <> "E" and 
               rez-k-g-b = "K" 
               move cast-oda-no     to  odalar-no takas-oda
               initialize takas-dbl
               read takas no lock invalid
                 continue
                 not invalid
                  if takas-rez > 0 or takas-folio > 0 then
                     move cast-rez-no to takas-dbl
                      
       
                     write takas-rec  invalid 
                       display message box "Cakisma var Oda No:" takas-oda
                     end-write
                  end-if
               end-read
               read odalar no lock invalid exit perform cycle
               end-read
               move cast-rez-no     to takas-rez
               move "B"             to takas-durumu
               move odalar-durumu   to takas-oda-durumu
               move rez-adi         to takas-adi     
               move rez-soyadi      to takas-soyadi
                
       
               rewrite takas-rec invalid 
                    continue
               end-rewrite
            end-if
            if rez-durumu = "I" and rez-c-in <> "E" and 
               rez-k-g-b = "O" 
               move cast-oda-no     to  odalar-no takas-oda
               read odalar no lock invalid exit perform cycle
               end-read
               initialize takas-dbl
               read takas no lock invalid
                 continue
                 not invalid
                  if takas-rez > 0 or takas-folio > 0 then
                     move cast-rez-no to takas-dbl
                      
       
                     write takas-rec  invalid
                     display message box "3Cakisma var Oda No:" takas-oda
                     end-write
                  end-if
               end-read
               move cast-rez-no     to takas-rez
               move "H"             to takas-durumu
               move odalar-durumu   to takas-oda-durumu
               move rez-adi         to takas-adi     
               move rez-soyadi      to takas-soyadi
                
       
               rewrite takas-rec 
                invalid 
                 write takas-rec
               end-rewrite
            end-if
         end-if
    end-read
    end-perform
    end-start.
    close rez cast konuk.
*    accept yeni-t from time
*    display messaGe box eski-t yeni-t "---" kayit
*        accept yeni-t from time
    open input konuk ozluk.
    initialize konuk-rec
    move "I"      to konuk-durumu
    start konuk key not < konuk-oda invalid
          continue
    not invalid
    initialize fs-konuk
    perform with test after until fs-konuk = "10"
    read konuk next no lock end move "10" to fs-konuk
    not at end

       
         if konuk-durumu = "I" and konuk-fol-kodu = "R"
            initialize takas-rec
            move konuk-odano      to takas-oda odalar-anah
            read odalar no lock invalid
                  exit perform cycle
            end-read
            initialize takas-dbl
               read takas no lock invalid
                 continue
                 not invalid
                  if takas-rez > 0 or takas-folio > 0 then
                     move konuk-rez-no to takas-dbl
                      
       
                     write takas-rec  invalid  
                      display message box "5Cakisma Var Oda No:" takas-oda
                     end-write
                  end-if
               end-read

            move konuk-folio to ozluk-folio
            read ozluk no lock invalid continue
            not invalid
              move ozluk-plaka to takas-plaka
            end-read
            move konuk-rez-no      to takas-rez
            move konuk-folio       to takas-folio
            move konuk-adi         to takas-adi     
            move konuk-soyadi      to takas-soyadi
            move "C"               to takas-durumu
            if konuk-git-tar = calisma-tarihi
               move "Q"            to takas-durumu
            end-if
             move odalar-durumu   to takas-oda-durumu
              
       
            rewrite takas-rec
              invalid  
                write takas-rec
            end-rewrite
         end-if
    end-read
    end-perform
    end-start
    close konuk odalar ozluk
    modify form1-gd-1,mass-update = 1 reset-grid = 1 
*          display message box "mass-update = 1 reset-grid = 1 "
   
    initialize takas-rec
    start takas key not < takas-oda-anah invalid
          continue
    not invalid
    initialize fs-takas i odalar-ana-dizi yer-y
               oda-durum-toplamlari
    move 1 to i
    perform with test after until fs-takas = "10"
*       add 1 to i
      if i > max-oda-sayi2
         perform grid-satir-yaz
         move 1 to i
      else
         read takas next no lock end move "10" to fs-takas
           not at end
            initialize donus
           if takas-oda = spaces
              exit perform cycle
           end-if
           if takas-folio <> 0
               if sadece-bos-cb = 1
                move 1 to donus
              end-if
              add 1 to toplam-satilan
              else 
               add 1 to sadece-bos-sayi
           end-if
           if donus = 1 
              exit perform cycle
           end-if
           if takas-folio = 0 and takas-rez <> 0
              add 1 to toplam-blokaj
           end-if
           perform cb-degerlendir
           if donus = 1 
              exit perform cycle
           end-if
           
           move takas-oda       to odalar-dizi(i)
           move takas-dbl       to dbl-dizi(i)
           add 1 to i
        end-read
        end-if
    end-perform
    end-start.
    if i > 0
       perform grid-satir-yaz 
    end-if
    modify form1-gd-1,mass-update = 0.
*    display message box    "modify form1-gd-1,mass-update = 0"
    open input takvim.
    move tarih-tasi         to takvim-anah
    read takvim no lock invalid
         display message box 
                 "Tarih bulunamadi ...."
                 icon mb_Error_icon
                 title "Hata",
                 initialize takvim-rec
    end-read
    close takvim.
    move takvim-hazir-oda     to satilabilir
    compute kullanim-disi = takvim-top-oda - satilabilir.
    display acc-100 acc-101 acc-102 acc-103 acc-104 acc-105
    acc-106 acc-107 acc-107a.
*    display acc-toplam-satilan
*            acc-toplam-blokaj.

*    display        acc-toplam-oda.
     .
*
 Form1-Gd-1-Ev-Msg-Begin-Drag.
    initialize eski-x eski-y
    modify form1-gd-1,cursor-frame-width = 3
    inquire form1-gd-1,
            cursor-y in i
            cursor-x in ii
    inquire form1-gd-1(i,ii),cell-data in tasi-oda.
*
 Form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
    if eski-x = 0 and eski-y = 0
       continue
    else
       inquire form1-gd-1(eski-y,eski-x),
               hidden-data in cell-hidden
       modify form1-gd-1,(eski-y,eski-x),
               cell-data = cell-oda
               
    end-if.
    move event-data-1       to ii eski-x
    move event-data-2       to i  eski-y
    modify form1-gd-1(i,ii),cell-data = tasi-oda.
*
 Form1-Gd-1-Ev-Msg-End-Drag.
    display message box "Tasindi .....".
    initialize tasi-oda.
    modify form1-gd-1,cursor-frame-width = 2.
     .
*
 Form1-Gd-1-Ex-Other.
    if key-status > 1000 and key-status < 1050
       initialize durum-sayi
       compute durum-sayi = key-status - 1000 + 1
       inquire form1-gd-1,
             cursor-y in i
             cursor-x in ii
       inquire form1-gd-1(i,ii),
             hidden-data = cell-hidden
             cell-data in temp-oda
       perform konum-degistir thru konum-degistir-exit
    end-if 
    evaluate key-status
        when 001 continue
        when 004 perform cagir-bosdolu
        when 005 perform Form1-Cb-1aa-Ex-Cmd-Clicked
    end-evaluate.
 rez-durum-bul.
    open input rez konuk.
    initialize rez-rec
    move tarih-tasi      to rez-gir-tar
    move "I"             to rez-durumu
    start rez key not < rez-gir invalid
          continue
    not invalid
    initialize fs-rez
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end
         if rez-gir-tar > tarih-tasi or rez-durumu <> "I" 
            move "10" to fs-rez
            exit perform
         end-if
         if rez-k-g-b <> "K"
            exit perform cycle
         end-if
         if  rez-folio  > 0     
              add 1                         to ger-cin-oda
              add rez-buyuk,rez-kucuk   to ger-cin-pax
         end-if
         add 1                    to gel-bek-oda
         add rez-buyuk rez-kucuk  to gel-bek-pax
    end-read
    end-perform
    end-start.

    initialize rez-rec
    move tarih-tasi      to rez-cik-tar
    move "I"             to rez-durumu
    start rez key not < rez-cik invalid
          continue
    not invalid
    initialize fs-rez
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end
         if rez-cik-tar > tarih-tasi
            move "10" to fs-rez
            exit perform
         end-if
         if rez-durumu <> "I" or rez-k-g-b <> "K"
            exit perform cycle
         end-if
         move  rez-folio       to konuk-folio
         read konuk no lock invalid
              move "I"        to konuk-durumu
         end-read
         if konuk-durumu = "H"
            add 1                       to ger-cout-oda
            add konuk-buyuk konuk-kucuk to ger-cout-pax
         end-if
         add 1                   to git-bek-oda
         add rez-buyuk rez-kucuk to git-bek-pax
    end-read
    end-perform
    end-start.
    close rez konuk.
*    accept eski-t from time
*    display message box  yeni-t eski-t "---" kayit
    compute doluluk-1 rounded = 
            (toplam-satilan  * 100) / satilabilir
    compute doluluk-2 rounded = 
            ((toplam-satilan + ger-cin-oda - ger-cout-oda) * 100) / satilabilir
    compute doluluk-3 rounded = 
            ((toplam-satilan + gel-bek-oda - ger-cin-oda - git-bek-oda + ger-cout-oda) * 100) / satilabilir
*    display acc-1 acc-2 acc-3 acc-4 acc-5 acc-6 acc-7
*    acc-8 acc-9 acc-10 acc-11 acc-12 acc-14
      .
 cb-degerlendir.
    initialize donus.
    if cout-oda-cb = 0
       if takas-durumu = "Q"
          move 1 to donus
          add 1 to cout-oda-sayi
          exit paragraph
       end-if
    else
       if takas-durumu = "Q"
          add 1 to cout-oda-sayi
          exit paragraph
       end-if
    end-if.
    if cin-oda-cb = 0
       if takas-durumu = "C"
          move 1 to donus
          add  1 to dolu-oda-sayi
          exit paragraph
       end-if
    else
       if takas-durumu = "C"
          add  1 to dolu-oda-sayi
          exit paragraph
       end-if
    end-if.

    if blokajli-temiz-oda-cb = 0
       if takas-durumu = "B" and
          takas-oda-durumu = house-bt
                move 1 to donus
                add 1 to blokajlitemiz-oda-sayi
                exit paragraph
       end-if
    else
       if takas-durumu = "B" and 
          takas-oda-durumu = house-bt
          add 1 to blokajlitemiz-oda-sayi
       end-if
    end-if

    if blokaj-oda-cb = 0
       if takas-durumu = "B" and 
          takas-oda-durumu <> house-bt
          move 1 to donus
          add 1 to blokajlikirli-oda-sayi
          exit paragraph
       end-if
    else
       if takas-durumu = "B" and
          takas-oda-durumu <> house-bt
          add 1 to blokajlikirli-oda-sayi
       end-if
    end-if.

    if bos-temiz-oda-cb = 0
       if takas-oda-durumu = house-bt and
          takas-durumu <> "B"
          add 1 to bostemiz-oda-sayi
          move 1 to donus
          exit paragraph
       end-if
    else
       if takas-oda-durumu = house-bt and 
          takas-durumu <> "B" 
          add 1 to bostemiz-oda-sayi
       end-if
    end-if
    if arizali-dolu-oda-cb = 0  
       if takas-oda-durumu = house-ao and
          takas-durumu <> spaces   and takas-durumu not = "Q"
                add 1 to arizalidolu-oda-sayi
                move 1 to donus
                exit paragraph
       end-if
    else
       if takas-oda-durumu = house-ao and
          takas-durumu <> spaces  and takas-durumu not = "Q"
                add 1 to arizalidolu-oda-sayi
                exit paragraph
    end-if.
    if arizali-oda-cb = 0
       if takas-oda-durumu = house-ao  
          add 1 to arizalibos-oda-sayi
          move 1 to donus
          exit paragraph
       end-if
    else
       if takas-oda-durumu = house-ao 
          add 1 to arizalibos-oda-sayi
          exit paragraph
       end-if
    end-if.
    if bos-oda-cb = 0 and 
       takas-oda-durumu <> house-bt
       move 1 to donus
       add 1 to boskirli-oda-sayi
       exit paragraph
    else
       if takas-oda-durumu <> house-bt
          add 1 to boskirli-oda-sayi
       end-if
    end-if.
*
 Form1-Cb-1aa-Ex-Cmd-Clicked.
     close takas.
     delete file takas.
     
    perform gride-yukle.
    perform rez-durum-bul.
*
 Form1-Gd-1-Ev-Msg-Begin-Entry.
    move event-action-fail   to event-action. 
*
 konum-degistir.
       if temp-oda = spaces 
          go konum-degistir-exit
       end-if.

      open i-o odalar.
      initialize odalar-rec.
      move temp-oda    to odalar-anah.
      read odalar no lock invalid 
           close odalar go konum-degistir-exit
           not invalid  continue
      end-read.
       move durum-kodu(durum-sayi) to odalar-durumu
                                      house-durumu .
       rewrite odalar-rec invalid continue.
       close odalar.
 konum-degistir-exit.
      exit.
     .
 grid-satir-yaz.
    add 1 to yer-y
    modify form1-gd-1,record-to-add(odalar-ana-dizi)
    perform varying i from 1 by 1 until i > max-oda-sayi2
      move odalar-dizi(i)   to takas-oda
      move dbl-dizi(i) to takas-dbl
      read takas no lock invalid
          continue
        not invalid
          initialize renk
          move oda-bos-temiz-renk   to renk
          if takas-oda-durumu = house-bt
             move oda-bos-temiz-renk-1  to renk
          end-if
          modify form1-gd-1(yer-y,i),
                 cell-color = renk
          if takas-durumu = "B" 
             move oda-blokaj-renk to renk
             if takas-oda-durumu = house-bt
                move oda-blokaj-renk-1  to renk
             end-if
          end-if
          if takas-durumu = "C"
             move oda-cin-renk    to renk
          end-if
          if takas-durumu = "Q"
             move oda-cout-renk   to renk
          end-if
          
          if takas-oda-durumu = house-ao and  
          takas-durumu = spaces
             move oda-ariza-renk  to renk
          end-if
          if takas-oda-durumu = house-ao and 
             takas-durumu <> spaces  and takas-durumu not = "Q"
             move oda-arizali-dolu-renk to renk
          end-if
          if takas-durumu = "H"
           
             move oda-hu-renk  to renk
          end-if
          initialize cell-hidden

          move takas-oda       to cell-oda
          move takas-rez       to cell-rez
          move takas-folio     to cell-folio
          move takas-durumu    to cell-durumu
          move takas-oda-durumu to cell-oda-durumu
          move yer-y            to takas-y
          move i                to takas-x
           
       
          rewrite takas-rec 
             invalid
             display message box " Hata : 123998"
          end-rewrite
          modify form1-gd-1(yer-y,i),
                 cell-color = renk
                 hidden-data = cell-hidden
                 
      end-read
    end-perform
    initialize odalar-ana-dizi
    move 1 to i
    .
 cagir-bosdolu.
    initialize bosdolu-cagir
    move combo-oda-konumu-value to bosdolu-ilk-konum
                                   bosdolu-son-konum
*    move combo-oda-tipi-value   to bosdolu-ilk-tip
*                                   bosdolu-son-tip
    call "/asya/ytl/obj/otel/bosdolu.asy"
      using bosdolu-cagir
      on exception 
        perform callerr-proc
      not on exception
        cancel "/asya/ytl/obj/otel/bosdolu.asy"
    end-call
    .
*
*
 Form1-Ex-Other.
     evaluate key-status
        when 4 perform cagir-bosdolu
        when 2341
            perform acu-Form3-routine 
        when 5
        perform Form1-Cb-1aa-Ex-Cmd-Clicked
        when 1235
             call "/asya/ytl/obj/otel/kart.asy" 
                        using ext-fol-no
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/kart.asy"
                    end-call 
                    perform kartlari-goster
        when 554
            call "/asya/ytl/obj/otel/tekrack1.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/tekrac1.asy"
                    end-call
       when 555
            call "/asya/ytl/obj/otel/blokyap.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/blokyap.asy"
                    end-call
        when 556
            call "/asya/ytl/obj/otel/gelrez.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/gelrez.asy"
                    end-call
         when 557
            call "/asya/ytl/obj/otel/gitrez.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/gitrez.asy"
                    end-call
         when 558
            call "/asya/ytl/obj/otel/blokaj01.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/blokaj01.asy"
                    end-call             
     end-evaluate.
*
 Form1-Gd-1-Ev-Other.
    evaluate event-type 
      when msg-begin-entry
         move ext-fol-no to konuk-folio
           open input konuk
             read konuk no lock 
               invalid continue
                not  invalid
                       perform ortalama-kur-bul
              end-read
              close konuk
        move event-action-fail   to event-action
     when Msg-Goto-Cell-Mouse
     when Msg-Goto-Cell
    end-evaluate.
     .
*
 oda-git.
        if not (event-data-1 > 0 and event-data-1< 22
           and event-data-2 > 0 and event-data-1 < 50)
             exit paragraph
        end-if
        if event-type = 3 exit paragraph end-if 
        if bekle = 1
*            wait for last thread test only status in thread-status
*            if thread-status not = 99 then 
*              display message box thread-status
*             end-if
              exit paragraph
*            display message box bekle 
         end-if
        move  1 to bekle
          perform oda-git2  
*        display message box bekle
        initialize bekle
      . 
*
 oda-git2.
        initialize ext-bakiye-tl ext-bakiye-dov
         initialize rom-bakiye-tl rom-bakiye-dov 
*         display message box event-type "----" event-control-id 
*        inquire Form1-Gd-1, cursor-x in i cursor-y in ii
*        accept omitted before ime 0
         inquire form1-gd-1(event-data-2, event-data-1), 
               cell-data = oda-num
               hidden-data = cell-hidden

        move event-data-2    to ariza-i
        move event-data-1    to ariza-ii

        initialize odalar-rec
        open input odalar
        move oda-num to odalar-no
        read odalar no lock invalid continue
          not invalid
            initialize kodlar02-rec
            open input kodlar02
            move "C" to kodlar02-tipi
            move house-durumu to kodlar02-kodu
            read kodlar02 no lock invalid move all spaces to oda-drm
              not invalid
                move kodlar02-adi to oda-drm
            end-read
            initialize kodlar02-rec
           move "G" to kodlar02-tipi
           move odalar-tipi to kodlar02-kodu
           read kodlar02 no lock invalid
              continue 
           end-read
           move kodlar02-adi to oda-tipi-1
           
           initialize kodlar02-rec
           move "H" to kodlar02-tipi
           move odalar-tipi2 to kodlar02-kodu
           read kodlar02 no lock invalid
              continue 
           end-read
           move kodlar02-adi to oda-tipi-2

           initialize kodlar02-rec
           move "I" to kodlar02-tipi
           move odalar-tipi3 to kodlar02-kodu
           read kodlar02 no lock invalid
              continue 
           end-read
           move kodlar02-adi to oda-tipi-3
            
            close kodlar02
        end-read
        close odalar
        display Form1-Ef-1aaaa
        display Form1-Ef-ack1 Form1-Ef-ack2
        Form1-Ef-tip1 Form1-Ef-tip2 Form1-Ef-tip3
        initialize oda-acik-girildi
        perform oda-bil-update
      . 
*
 sag-tus-basildi.
*     perform oda-git
      call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 1
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 12
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 21
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 20
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 8
      call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 23
      
      call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 18
      if cell-folio > 0 then 
        move "Register K\tCtrl-N"  to x-20
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 6
      call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 21
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 8
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 7
        
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 11
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 5
        if cell-durumu = "Q" then 
           call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 20
          else 
           call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 12
        end-if
        else
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 6
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 7
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 11
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 5
        if cell-rez > 0
           move "Check-In\tCtrl-N" to x-20
          else
           move "WalkIn C/In\tCtrl-N" to x-20
           call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 1
                  call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 23
        end-if
     end-if
     call "w$menu" using wmenu-change,
                                Form1-Mn-1-Handle,
                                14,
                                0,
                                x-20,
                                14
     call "w$menu" using wmenu-show
     .
*
 bulunana-git.
        modify form1-gd-1
            cursor-x = takas-x
            cursor-y = takas-y
         .
         move takas-x to event-data-1
         move takas-y to event-data-2
         perform oda-git2
         .
*
 oda-ara.
     if ara-oda not = spaces then 
        move ara-oda to takas-oda 
        read takas no lock 
            invalid
              display message box takas-oda 
               " nolu oda rack de bulunamadi"
            not invalid
                perform bulunana-git
        end-read
     end-if
      .
*
 adi-yok.    
    display message box "Adi " ara-adi(1:ara-adi-u) 
       " ile baslayan baska oda bulunamadi".
*
 plaka-yok.
    display message box "Plakasi " ara-plaka(1:ara-plaka-u) 
       " ile baslayan baska oda bulunamadi".
*
 soyadi-yok.
    display message box "Soyadi " ara-soyadi(1:ara-soyadi-u) 
       " ile baslayan baska oda bulunamadi".
*
 adi-ara.
     initialize adi-bitti
     if ara-adi not = spaces then 
        
        perform varying ara-adi-u from 20 by -1 
          until ara-adi(ara-adi-u:1) not = space
           if ara-adi-u = 1 then 
               exit perform
           end-if
        end-perform  

        move ara-adi to takas-adi 
        start takas key >= takas-adi
          invalid
            perform adi-yok
            move 1 to adi-bitti
            not invalid
               perform sonraki-adi
        end-start
      end-if.
*
plaka-ara.
     initialize plaka-bitti
     if ara-plaka not = spaces then 
        
        perform varying ara-plaka-u from 15 by -1 
          until ara-plaka(ara-plaka-u:1) not = space
           if ara-plaka-u = 1 then 
               exit perform
           end-if
        end-perform  

        move ara-plaka to takas-plaka 
        start takas key >= takas-plaka
          invalid
            perform plaka-yok
            move 1 to plaka-bitti
            not invalid
               perform sonraki-plaka
        end-start
      end-if.
*
 soyadi-ara.
     initialize soyadi-bitti
     if ara-soyadi not = spaces then 
        
        perform varying ara-soyadi-u from 20 by -1 
          until ara-soyadi(ara-soyadi-u:1) not = space
           if ara-soyadi-u = 1 then 
               exit perform
           end-if
        end-perform  
       
        move ara-soyadi to takas-soyadi 
        start takas key >= takas-soyadi
          invalid
            perform soyadi-yok
            move 1 to soyadi-bitti
            not invalid
               perform sonraki-soyadi
        end-start
      end-if
      .
*
 sonraki-adi.
     if adi-bitti = 1 then 
        perform adi-ara
       else 
         read takas next no lock 
           end 
             perform adi-yok
             move 1 to adi-bitti
           not end
             if takas-adi(1:ara-adi-u) not = 
                ara-adi(1:ara-adi-u) 
                perform adi-yok
                move 1 to adi-bitti
                else
                 perform bulunana-git
             end-if
         end-read
      end-if.  
*
 sonraki-soyadi.
     if soyadi-bitti = 1 then 
        perform soyadi-ara
       else 
         read takas next no lock 
           end 
             perform soyadi-yok
             move 1 to soyadi-bitti
           not end
             if takas-soyadi(1:ara-soyadi-u) not = 
                ara-soyadi(1:ara-soyadi-u) 
                perform soyadi-yok
                move 1 to soyadi-bitti
                else
                 perform bulunana-git
             end-if
         end-read
      end-if.
*
 sonraki-plaka.
     if plaka-bitti = 1 then 
        perform plaka-ara
       else 
         read takas next no lock 
           end 
             perform plaka-yok
             move 1 to plaka-bitti
           not end
             if takas-plaka(1:ara-plaka-u) not = 
                ara-plaka(1:ara-plaka-u) 
                perform plaka-yok
                move 1 to plaka-bitti
                else
                 perform bulunana-git
             end-if
         end-read
      end-if.
*
 pop-up-exception.
    
     inquire form1-gd-1,
                     cursor-y in i
                     cursor-x in ii
             
     inquire form1-gd-1(i,ii),
                     hidden-data = cell-hidden
                     cell-data in temp-oda
         if temp-oda = spaces
                exit paragraph
             end-if
         
     evaluate key-status
        
        when 100
           open i-o odalar
       
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          if cell-folio  = 0 
              move  HOUSE-BT  to ODALAR-DURUMU
              move HOUSE-BT     to HOUSE-DURUMU 
              else
               move  HOUSE-DT  to ODALAR-DURUMU
                move HOUSE-DT     to HOUSE-DURUMU 
              
            end-if  
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
        close odalar   
          
         
        when 101
          open i-o odalar
       
            read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          if cell-folio  = 0 
              move  HOUSE-BK  to ODALAR-DURUMU
               move HOUSE-BK    to HOUSE-DURUMU 
              
              else
               move  HOUSE-DK  to ODALAR-DURUMU
                move HOUSE-DK     to HOUSE-DURUMU 
              
            end-if  
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
        close odalar   
          
          

        when 102
          open i-o odalar
       
          read odalar no lock invalid
             display message box "Lutfen oda seciniz" title " "
              not invalid
           
          
               move  HOUSE-AO  to ODALAR-DURUMU  HOUSE-DURUMU 
              
            
              rewrite odalar-rec invalid stop " " end-rewrite
            end-read
            close odalar   
           
           
           
        when 1
             initialize aramayap
             move 1 to vis-ara2
             move 0 to vis-ara1 vis-ara3 vis-ara4
             perform acu-form2-routine
             if aramayap= 1  then
              perform adi-ara
            end-if
            move 1 to control-value
            move 4 to accept-control
        when 3
            evaluate true 
              when vis-ara2 = 1 
                  perform sonraki-adi
              when vis-ara1 = 1 
                  perform oda-ara
              when vis-ara3 = 1 
                  perform sonraki-soyadi
              when vis-ara4 = 1 
                  perform sonraki-plaka

            end-evaluate   
         when   23 
           move "U"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move rez-anah to link-NOT-DOS-ANAH  
               
            move 1 to link-nereden 
           string rez-adi delimited by "  "
                  " " delimited by size
                  rez-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
                  display not-ac
        when 15
             initialize aramayap
             move 1 to vis-ara1
             move 0 to vis-ara2 vis-ara3 vis-ara4
             perform acu-form2-routine
              if aramayap= 1  then
              perform oda-ara
              end-if
              move 1 to control-value
            move 4 to accept-control
        when 16
             initialize aramayap
             move 1 to vis-ara4
             move 0 to vis-ara2 vis-ara1 vis-ara3
             perform acu-form2-routine
              if aramayap= 1  then
              perform plaka-ara
              end-if
              move 1 to control-value
              move 4 to accept-control
        when 19
             initialize aramayap
             move 1 to vis-ara3
             move 0 to vis-ara2 vis-ara1 vis-ara4
             perform acu-form2-routine
              if aramayap= 1  then
              perform soyadi-ara
              end-if
              move 1 to control-value
            move 4 to accept-control
        when 14
          if cell-rez > 0 then
            if cell-folio = 0 then 
              move 99999998 to cell-folio
            end-if
             call "/asya/ytl/obj/otel/rezcin.asy" 
                 using cell-rez, cell-folio
               on exception 
                perform callerr-proc
                 exit paragraph
               not on exception 
               cancel "/asya/ytl/obj/otel/rezcin.asy"
             end-call
           else
              call "/asya/ytl/obj/otel/rezcin.asy" 
                 using cell-rez, cell-folio, temp-oda
               on exception 
                perform callerr-proc
                 exit paragraph
               not on exception 
               cancel "/asya/ytl/obj/otel/rezcin.asy"
             end-call
           end-if
          when 11
               if konuk-durumu = "I" and 
                  calisma-tarihi <= konuk-git-tar and 
                  calisma-tarihi >= konuk-gel-tar
                     call "/asya/ytl/obj/otel/cekgir.asy" using ext-fol-no
                           on exception perform callerr-proc
                           not on exception
                               cancel "/asya/ytl/obj/otel/cekgir.asy" 
                     end-call
                  end-if
         when 6
          if cell-folio > 0 then 
           call "/asya/ytl/obj/otel/folio.asy" 
            using  cell-folio
            on exception 
             perform callerr-proc
             exit paragraph
            not on exception 
             cancel "/asya/ytl/obj/otel/folio.asy"
          end-call
          end-if
         when 7
           if cell-folio > 0 then 
          call "/asya/ytl/obj/otel/folio.asy" 
            using  ext-fol-no
            on exception 
             perform callerr-proc
             exit paragraph
            not on exception 
             cancel "/asya/ytl/obj/otel/folio.asy"
          end-call
          end-if
 
         when 12
         when 20
          call "/asya/ytl/obj/otel/cout.asy" 
            using temp-oda, cell-folio
            on exception 
             perform callerr-proc
             exit paragraph
            not on exception 
             cancel "/asya/ytl/obj/otel/cout.asy"
           end-call
          when 8
             call "/asya/ytl/obj/otel/odadegis.asy" 
                using temp-oda
                  on exception 
                     perform callerr-proc
                     exit paragraph
                  not on exception 
               cancel "/asya/ytl/obj/otel/odadegis.asy"
              end-call
           when 21
             call "/asya/ytl/obj/otel/uzatma.asy" 
                using temp-oda
                  on exception 
                     perform callerr-proc
                     exit paragraph
                  not on exception 
               cancel "/asya/ytl/obj/otel/uzatma.asy"
              end-call
*         when 001
*             if cell-folio <> 0
*                call "/asya/ytl/obj/otel/folinfo.asy" using cell-folio
*                     on exception 
*                        perform callerr-proc
*                     not on exception
*                        cancel "/asya/ytl/obj/otel/folinfo.asy"
*                end-call
*             
*             else
*              
*             if cell-rez <> 0
*                call "/asya/ytl/obj/otel/rezinfo.asy" using cell-rez
*                    on exception 
*                        perform callerr-proc
*                     not on exception
*                        cancel "/asya/ytl/obj/otel/rezinfo.asy"
*                end-call
*             end-if
*             end-if
    end-evaluate.
*
 oda-bil-update.
      evaluate true  
            when cell-folio <> 0
                 move 1 to oda-vis
                 perform oda-bilgi-fol
            when cell-rez <> 0
                 move 1 to oda-vis
                 perform oda-bilgi-fol
             when other
               move 0 to oda-vis
               open input konum 
               move odalar-konumu to konum-anahtar
                read konum no lock 
                     invalid move "**********" to konum-adi
                  end-read
                 move konum-adi to oda-knm
                 move odalar-aciklama1 to oda-ack1
               move odalar-aciklama2 to oda-ack2
                close konum
    end-evaluate.
    perform bilgi-yaz.

 bilgi-yaz.
     display form1-fr-2a.
     display form1-la-1a.
     display form1-ef-oda.
     display Form1-Ef-ack1 Form1-Ef-ack2
     display Form1-Ef-odaa
     display form1-ef-folio
     display form1-ef-adi
     display form1-ef-soyadi
     display form1-ef-adi2
     display form1-ef-soyadi2
     display form1-ef-gg
     display form1-ef-ga
     display form1-ef-gy  form1-ef-g1 form1-ef-g2
     form1-ef-g3 form1-ef-g4 form1-ef-g3a form1-ef-g4a
     display Form1-a-safe
     display Form1-a-anah
     display form1-ef-cg
     display form1-ef-ca
     display form1-ef-cy
     display form1-ef-acenta
     display form1-ef-ulke
     display form1-ef-buyuk
     display form1-ef-kucuk
     display form1-ef-free
     display form1-ef-bebek
     display form1-ef-voucher
     display form1-ef-pans
     display form1-ef-ode
     display form1-ef-banka
     display form1-ef-doviz
     display form1-ef-dv-toplam
     display form1-ef-cin-kuru
     display form1-ef-tl-toplam
     display form1-ef-not1
     display form1-ef-not2
     display form1-ef-fiyat-konumu
     display form1-ef-oda-konumu
     display accept-rom-tl
     display accept-rom-dov
     display accept-ext-tl
     display accept-ext-dov
     display rom-doviz-adi
     display ext-doviz-adi 

     move "Extra Folyo Bakiyesi (Gunluk Kur)" to ext-tit
      move ONKPARA-DOVIZ to doviz-kodu
     open input doviz
     read doviz no lock invalid continue 
     end-read
     close doviz
     
     move d-kisa-adi to extra-dov-adi
     display   ext-doviz-adi
     display  form1-fr-3a
      move all low-values to toplam-ariza
       perform teknik-bak
       display tek-ac.

      if eski-oda not = odalar-no then 
        move odalar-no to eski-oda
         initialize toplam-not
      
     if cell-rez > 0 or ( cell-folio > 0 and konuk-rez-no > 0 ) then
           move 3 to link-nereden 
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           if cell-rez > 0
                move cell-rez to link-not-dos-anah
              else
              move konuk-rez-no to link-NOT-DOS-ANAH   
            end-if
           move 3 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
        end-if
             display not-ac
       end-if
     .
 oda-bilgi-fol.
      initialize ozluk-rec
     open input rez 
     if cell-folio > 0 then 
             open input konuk ozluk
             move cell-folio         to konuk-folio ozluk-folio
             read konuk no lock invalid
                  display message box 
                          cell-folio," numarali folio bulunamadi ..." new-line
                          "Lutfen F5 ile racki tazeleyiniz"
                          icon mb_error_icon,
                          title "Hata"
                          close konuk  rez  ozluk
                          exit paragraph
                   not invalid
                      perform extra-kont
                      move cell-folio         to konuk-folio ozluk-folio
                       read konuk no lock end-read
                       read ozluk no lock end-read
             close ozluk
             end-read
             close konuk
             move konuk-rez-no to rez-anah
             read rez no lock 
                invalid display message box "Rezervasyon bulunamadi"
             end-read
              move  "Konuk Bilgileri" to frm-tit
              move  "Folio No :"   to fol-tit
         else
             move "Blokaj Bilgileri" to frm-tit
             move "Rez No :"         to  fol-tit
             move cell-rez to rez-no
             read rez no lock 
                invalid display message box "Rezervasyon bulunamadi"
             end-read
             initialize konuk-kur-degeri toplam-tutar 
             move rez-acenta        to konuk-acenta
             move rez-no            to konuk-folio
             move rez-adi           to konuk-adi
             move rez-soyadi        to konuk-soyadi
             move rez-gir-tar       to konuk-gel-tar
             move rez-gel-zaman     to konuk-gel-zaman
             move rez-cik-tar       to konuk-git-tar
             move rez-ulke          to konuk-ulke
             move rez-buyuk         to konuk-buyuk
             move rez-kucuk         to konuk-kucuk
             move rez-free          to konuk-free
             move rez-bebek         to konuk-bebek
             move rez-voucher       to konuk-voucher
             move rez-pan-tipi      to konuk-pan-tipi
             move rez-odeme-tipi    to konuk-odeme-tipi
             move rez-banka         to konuk-banka
             move rez-doviz         to konuk-doviz
             move rez-fiyati        to konuk-dv-degeri
             move rez-odano         to konuk-odano
             move rez-fiyat-konumu  to konuk-fiyat-konumu 
     end-if
     close rez.
     open input konum
     move konuk-fiyat-konumu to konum-anahtar
     read konum no lock 
        invalid move "**********" to konum-adi
     end-read
     move konum-adi to fiyat-knm
     move odalar-konumu to konum-anahtar
     read konum no lock 
        invalid move "**********" to konum-adi
     end-read
     move konum-adi to oda-knm
     move odalar-aciklama1 to oda-ack1
     move odalar-aciklama2 to oda-ack2
     close konum
     if odalar-konumu = konuk-fiyat-konumu then 
       move 517 to color-fiyat
        else
       move 176 to color-fiyat
       end-if
     open input ulke.
     move konuk-ulke      to ulke-anah
     
     read ulke no lock invalid
     
          move "Tanimsiz" to ulke-adi
     end-read
     close ulke.
     open input acenta
     move konuk-acenta    to acenta-anahtar
     read acenta no lock invalid
          move "Tanimsiz" to acenta-adi
     end-read
    
     close acenta.
     open input banka
     move konuk-banka     to banka-kodu
     read banka no lock invalid
          move "Tanimsiz" to banka-adi
     end-read
     close banka.
     open input doviz
     move konuk-doviz     to doviz-kodu 
     read doviz no lock invalid
          move "Tanimsiz" to d-kisa-adi
     end-read
     move d-kisa-adi to oda-dov-adi
     
     close doviz.
     if cell-folio > 0 then 
     compute toplam = konuk-oda-tutar + konuk-extbed-tutar +
                      konuk-kahvalti-tutar + konuk-ogle-tutar +
                      konuk-aksam-tutar + konuk-icecek-tutar +
                      konuk-extra-tutar
     move toplam      to toplam-tutar

     compute rom-bakiye-tl = konuk-top-borc - konuk-top-alac
     compute rom-bakiye-dov rounded = rom-bakiye-tl / konuk-kur-degeri

     end-if
     open input kodlar02 odalar.
     move konuk-odeme-tipi        to kodlar02-kodu
     move "B"                     to kodlar02-tipi
     read kodlar02 no lock invalid
          move "Tanimsiz"         to kodlar02-adi
     end-read
     move kodlar02-adi            to odeme-adi.
     
     close odalar kodlar02.
*
extra-kont.
         initialize ext-fol-no
         move "I" to konuk-durumu
                   move konuk-odano   to tmp-oda
                   move konuk-gel-tar to tmp-gel-tar
                   move konuk-git-tar to tmp-git-tar  
                     start konuk key = konuk-oda 
                        invalid 
                           continue
                        not invalid
                           perform until  fs-konuk = "10"
                           read konuk next no lock 
                                 end move "10"  to fs-konuk
                             not end
                               if konuk-odano not = tmp-oda
                                move "10"  to fs-konuk
                                else
                                   if konuk-gel-tar = tmp-gel-tar and
                                      konuk-git-tar = tmp-git-tar and 
                                      konuk-fol-kodu not = "R" then
                                         move konuk-folio to ext-fol-no
                                         compute ext-bakiye-tl = konuk-top-borc - konuk-top-alac
                                         
                                         compute ext-bakiye-dov rounded = ext-bakiye-tl / gunluk-kur
                                         move konuk-folio to ext-fol-no
                                          perform  kartlari-goster
                                         move "10"  to fs-konuk
                                  end-if
                            end-if
                        end-read
                    end-perform
          end-start.
*
 kartlari-goster.
           initialize onb-hata
         open input kart.
         if onb-hata = 1 then 
           initialize onb-hata
           exit paragraph
         end-if
         initialize kart-rec kart-no1 kart-no2 kart-no3
         move ext-fol-no to kart-folio
         start kart key >= kart-folio
          invalid continue
          not invalid 
          perform varying kart-say from 1 by 1 until 
                 fs-kart = "10" or kart-say > 3
             read kart next no lock 
               end move "10" to fs-kart 
               not end
                if kart-folio not = ext-fol-no
                    move "10" to fs-kart 
                    else
                   evaluate kart-say
                      when 1
                         move kart-no to kart-no1
                      when 2
                          move kart-no to kart-no2
                      when 3
                          move kart-no to kart-no3 
                   end-evaluate
               end-if
             end-read
          end-perform
        end-start 
        display kart1-acc kart2-acc kart3-acc
        close kart.
*
 ortalama-kur-bul.
     if ext-bakiye-dov not = 0  then 
     open input kur exthrk
     initialize kur-rec top-ort-dov
     move ext-bakiye-tl to kalan-odeme-tl
     
     move konuk-banka to kur-banka
     move konuk-doviz to kur-doviz doviz-kodu
     initialize exthrk-rec 
     move ext-fol-no to exthrk-rec
     start exthrk key > exthrk-anah1
         invalid continue
         not invalid 
         perform until fs-exthrk = "10"
            read exthrk next no lock
              end move "10" to fs-exthrk
              not end
                 if exthrk-folio <> ext-fol-no
                      move "10" to fs-exthrk
                   else
                    if exthrk-ba = "B"
                      move exthrk-tarih to kur-tarih
                           read kur no lock invalid 
                              display message box 
                               "Arada kur kaydi silinmis"
                               move 1 to doviz-alis
                           end-read 
                      if exthrk-tl-tutar > konuk-TOP-ALAC
                         subtract konuk-top-alac from exthrk-tl-tutar   
                         initialize konuk-top-alac
                         if kalan-odeme-tl > exthrk-tl-tutar
                              subtract exthrk-tl-tutar 
                                 from  kalan-odeme-tl
                             else 
                               move kalan-odeme-tl to exthrk-tl-tutar
                               initialize kalan-odeme-tl 
                          end-if  
                              compute top-ort-dov rounded = 
                                    top-ort-dov +
                                   ((exthrk-tl-tutar - konuk-top-alac)
                                    / doviz-alis )
                         else
                               subtract exthrk-tl-tutar 
                                    from konuk-top-alac   
                       end-if
                     end-if
                 end-if
            end-read       
         end-perform
     end-start  
     if kalan-odeme-tl > konuk-top-alac  then
     move tarih-tasi to kur-tarih
            read kur no lock invalid 
                 display message box 
                 "Arada kur kaydi silinmis"
                    move 1 to doviz-alis
              end-read 
             compute top-ort-dov rounded = 
                          top-ort-dov +
                        ((kalan-odeme-tl - konuk-top-alac)
                          / doviz-alis )
     end-if                 
     close kur exthrk
     move  top-ort-dov to ext-bakiye-dov
     move "Extra Folyo Bakiyesi (Ort. Kur)" to ext-tit
     open input doviz
     read doviz no lock invalid continue 
     end-read
     close doviz
     
     move d-kisa-adi to extra-dov-adi
     display accept-ext-dov form1-fr-3a   ext-doviz-adi
     end-if
     .
*
 Screen1-Ef-1-Aft-Procedure.
      move 1 to aramayap
      set exit-pushed to true
     .
*
 takas-kapat.
     close takas.
     delete file takas.
     .
*
 Form3-Aft-Initdata.
      initialize status-deg
     open input konuk kodlar02
     initialize konuk-rec
     move "I" to konuk-durumu
     start konuk key > konuk-oda 
      invalid
            continue
      not invalid
        perform until fs-konuk  = "10"
         read konuk next no lock 
            end 
              move "10" to fs-konuk
            not end 
              if konuk-durumu not = "I" then 
                  move "10" to fs-konuk
                else
                  if konuk-fol-kodu = "R" then
                    add 1           to v-oda4
                    add konuk-buyuk to v-pax4
                    add konuk-kucuk to v-chi4
                    add konuk-free  to v-fre4
                    add konuk-bebek to v-beb4

                    move "B" to KODLAR02-TIPI
                    move konuk-odeme-tipi to kodlar02-kodu
                    read kodlar02 no lock invalid initialize kodlar02-rec
                    end-read
                    if ode-posting = "H"
                       add 1 to v-coda4
                       add konuk-buyuk to v-cpax4
                       add konuk-kucuk to v-cchi4
                       add konuk-free  to v-cfre4
                       add konuk-bebek to v-cbeb4
                    end-if 
                  end-if   
               end-if
            end-read
        end-perform
     end-start 
     
     open input rez
     initialize rez-rec
     move "I" to rez-durumu
     move tarih-tasi to rez-gir-tar
     start rez key >= rez-gir 
        invalid continue
        not invalid
          perform  until fs-rez = "10"
            read rez next no lock
               end 
                 move "10" to fs-rez
               not end
                 if rez-durumu not = "I" or
                    rez-gir-tar not = tarih-tasi then
                      move "10" to fs-rez
                    else
                      move "B" to KODLAR02-TIPI
                      move rez-odeme-tipi to kodlar02-kodu
                      read kodlar02 no lock invalid initialize kodlar02-rec
                      end-read
                      if rez-folio > 0 then 
                          add 1           to v-oda2
                          add rez-buyuk to v-pax2
                          add rez-kucuk to v-chi2
                          add rez-free  to v-fre2
                          add rez-bebek to v-beb2
                          if ode-posting = "H" 
                            add 1           to v-coda2
                            add rez-buyuk to v-cpax2
                            add rez-kucuk to v-cchi2
                            add rez-free  to v-cfre2
                            add rez-bebek to v-cbeb2
                          end-if
                        else
                          add 1           to v-oda5
                          add rez-buyuk to v-pax5
                          add rez-kucuk to v-chi5
                          add rez-free  to v-fre5
                          add rez-bebek to v-beb5
       
                          if ode-posting = "H" 
                            add 1           to v-coda5
                            add rez-buyuk to v-cpax5
                            add rez-kucuk to v-cchi5
                            add rez-free  to v-cfre5
                            add rez-bebek to v-cbeb5
                          end-if
                      end-if
                 end-if
             end-read
          end-perform
     end-start
    
     initialize rez-rec
     move "I" to rez-durumu
     move tarih-tasi to rez-cik-tar
     start rez key >= rez-cik 
        invalid continue
        not invalid
          perform  until fs-rez = "10"
            read rez next no lock
               end 
                 move "10" to fs-rez
               not end
                 if rez-durumu not = "I" or
                    rez-cik-tar not = tarih-tasi then
                      move "10" to fs-rez
                    else
                      move "B" to KODLAR02-TIPI
                      move rez-odeme-tipi to kodlar02-kodu
                      read kodlar02 no lock invalid initialize kodlar02-rec
                      end-read
                      move rez-folio to konuk-folio
                      move "I"       to konuk-durumu
                      read konuk no lock
                        invalid
                          continue
*                         display message box "Hata 4532j" new-line
*                            rez-no
                       end-read
                        if konuk-durumu not  = "I"
                           add 1           to v-oda3
                          add rez-buyuk   to v-pax3
                          add rez-kucuk   to v-chi3
                          add rez-free    to v-fre3
                          add rez-bebek  to v-beb3
                          if ode-posting = "H" 
                            add 1           to v-coda3
                            add rez-buyuk to v-cpax3
                            add rez-kucuk to v-cchi3
                            add rez-free  to v-cfre3
                            add rez-bebek to v-cbeb3
                          end-if
                          else
                          add 1           to v-oda6
                          add rez-buyuk   to v-pax6
                          add rez-kucuk   to v-chi6
                          add rez-free    to v-fre6
                          add rez-bebek   to v-beb6
       
                          if ode-posting = "H" 
                            add 1           to v-coda6
                            add rez-buyuk to v-cpax6
                            add rez-kucuk to v-cchi6
                            add rez-free  to v-cfre6
                            add rez-bebek to v-cbeb6
                          end-if
                      end-if
                 end-if
             end-read
          end-perform
     end-start
     close rez konuk kodlar02
     move v-oda2   to oda2   display l-oda2 
     move v-pax2   to pax2   display l-pax2
     move v-chi2   to chi2   display l-chi2
     move v-fre2   to fre2   display l-fre2
     move v-beb2   to beb2   display l-beb2
     move v-coda2  to coda2  display l-coda2 
     move v-cpax2  to cpax2  display l-cpax2
     move v-cchi2  to cchi2  display l-cchi2
     move v-cfre2  to cfre2  display l-cfre2
     move v-cbeb2  to cbeb2  display l-cbeb2

     move v-oda3   to oda3   display l-oda3 
     move v-pax3   to pax3   display l-pax3
     move v-chi3   to chi3   display l-chi3
     move v-fre3   to fre3   display l-fre3
     move v-beb3   to beb3   display l-beb3
     move v-coda3  to coda3  display l-coda3 
     move v-cpax3  to cpax3  display l-cpax3
     move v-cchi3  to cchi3  display l-cchi3
     move v-cfre3  to cfre3  display l-cfre3
     move v-cbeb3  to cbeb3  display l-cbeb3

     move v-oda4   to oda4   display l-oda4 
     move v-pax4   to pax4   display l-pax4
     move v-chi4   to chi4   display l-chi4
     move v-fre4   to fre4   display l-fre4
     move v-beb4   to beb4   display l-beb4
     move v-coda4  to coda4  display l-coda4 
     move v-cpax4  to cpax4  display l-cpax4
     move v-cchi4  to cchi4  display l-cchi4
     move v-cfre4  to cfre4  display l-cfre4
     move v-cbeb4  to cbeb4  display l-cbeb4

     move v-oda5   to oda5   display l-oda5 
     move v-pax5   to pax5   display l-pax5
     move v-chi5   to chi5   display l-chi5
     move v-fre5   to fre5   display l-fre5
     move v-beb5   to beb5   display l-beb5
     move v-coda5  to coda5  display l-coda5 
     move v-cpax5  to cpax5  display l-cpax5
     move v-cchi5  to cchi5  display l-cchi5
     move v-cfre5  to cfre5  display l-cfre5
     move v-cbeb5  to cbeb5  display l-cbeb5

     move v-oda6   to oda6   display l-oda6 
     move v-pax6   to pax6   display l-pax6
     move v-chi6   to chi6   display l-chi6
     move v-fre6   to fre6   display l-fre6
     move v-beb6   to beb6   display l-beb6
     move v-coda6  to coda6  display l-coda6 
     move v-cpax6  to cpax6  display l-cpax6
     move v-cchi6  to cchi6  display l-cchi6
     move v-cfre6  to cfre6  display l-cfre6
     move v-cbeb6  to cbeb6  display l-cbeb6

     compute v-oda1 = v-oda4 - v-oda2 + v-oda3 
     compute v-pax1 = v-pax4 - v-pax2 + v-pax3 
     compute v-chi1 = v-chi4 - v-chi2 + v-chi3 
     compute v-fre1 = v-fre4 - v-fre2 + v-fre3 
     compute v-beb1 = v-beb4 - v-beb2 + v-beb3 
     compute v-dol1 rounded = (v-oda1 / satilabilir) * 100
     compute v-dol4 rounded = (v-oda4 / satilabilir) * 100
     compute v-coda1 = v-coda4 - v-coda2 + v-coda3 
     compute v-cpax1 = v-cpax4 - v-cpax2 + v-cpax3 
     compute v-cchi1 = v-cchi4 - v-cchi2 + v-cchi3 
     compute v-cfre1 = v-cfre4 - v-cfre2 + v-cfre3 
     compute v-cbeb1 = v-cbeb4 - v-cbeb2 + v-cbeb3 

     compute v-oda7 = v-oda4 - v-oda6 + v-oda5 
     compute v-pax7 = v-pax4 - v-pax6 + v-pax5 
     compute v-chi7 = v-chi4 - v-chi6 + v-chi5 
     compute v-fre7 = v-fre4 - v-fre6 + v-fre5 
     compute v-beb7 = v-beb4 - v-beb6 + v-beb5 
     compute v-dol7 rounded = (v-oda7 / satilabilir) * 100

     compute v-coda7 = v-coda4 - v-coda6 + v-coda5 
     compute v-cpax7 = v-cpax4 - v-cpax6 + v-cpax5 
     compute v-cchi7 = v-cchi4 - v-cchi6 + v-cchi5 
     compute v-cfre7 = v-cfre4 - v-cfre6 + v-cfre5 
     compute v-cbeb7 = v-cbeb4 - v-cbeb6 + v-cbeb5 

     move v-oda1   to oda1   display l-oda1 
     move v-pax1   to pax1   display l-pax1
     move v-chi1   to chi1   display l-chi1
     move v-fre1   to fre1   display l-fre1
     move v-beb1   to beb1   display l-beb1
     move v-coda1  to coda1  display l-coda1 
     move v-cpax1  to cpax1  display l-cpax1
     move v-cchi1  to cchi1  display l-cchi1
     move v-cfre1  to cfre1  display l-cfre1
     move v-cbeb1  to cbeb1  display l-cbeb1
     move v-dol1   to dol1   display l-dol1
     move v-dol4   to dol4   display l-dol4
     move v-oda7   to oda7   display l-oda7 
     move v-pax7   to pax7   display l-pax7
     move v-chi7   to chi7   display l-chi7
     move v-fre7   to fre7   display l-fre7
     move v-beb7   to beb7   display l-beb7
     move v-coda7  to coda7  display l-coda7 
     move v-cpax7  to cpax7  display l-cpax7
     move v-cchi7  to cchi7  display l-cchi7
     move v-cfre7  to cfre7  display l-cfre7
     move v-cbeb7  to cbeb7  display l-cbeb7
     move v-dol7   to dol7   display l-dol7
     .
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
************* ARIZA OLAYI
 arizali-islem.
    perform acu-Form5-routine.
    move 4 to accept-control
    move 1 to control-id.
*
 Form4-Aft-Initdata.
    modify Form4-gd-1,
           reset-grid  = 1 
           mass-update = 1 
    move "Oda"          to gd-3-col-1
    move "Tarih"        to gd-3-col-2
    move "Zaman"        to gd-3-col-3
    move "Kullanici"    to gd-3-col-4
    move "Sorun"        to gd-3-col-5
    modify Form4-gd-1,
           record-to-add(Form4-gd-1-record)
    open input teknik kllnc.
    initialize teknik-rec
    move cell-oda          to teknik-odano
    move " "               to teknik-ok
    start teknik key not < teknik-alt-1 invalid
          continue
    not invalid
    initialize fs-teknik
    perform with test after until fs-teknik = "10"
    read teknik next no lock end move "10" to fs-teknik
    not at end
         if teknik-ok = "E" or 
            teknik-odano <> cell-oda  
            move "10" to fs-teknik
            exit perform
         end-if
         initialize Form4-gd-1-record
         move teknik-odano        to gd-3-col-1
         move teknik-sorun-yil    to eyil
         move teknik-sorun-ay     to eay 
         move teknik-sorun-gun    to egun
         move etarih              to gd-3-col-2
         move teknik-sorun-saat   to esaat
         move teknik-sorun-dakika to edakika
         move teknik-sorun-saniye to esaniye
         move ezaman              to gd-3-col-3
         move teknik-sorun-staf   to k-kodu
         read kllnc no lock invalid
              move "Tanimsiz ..." to k-adi
         end-read
         move k-adi               to gd-3-col-4
         move teknik-sorun        to gd-3-col-5
         modify Form4-gd-1,
                record-to-add(Form4-gd-1-record)
    end-read
    end-perform
    end-start
    close teknik kllnc.
    modify Form4-gd-1,
           mass-update = 0.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form4-Ex-Other.
    if key-status <> 2001
       exit paragraph.
    if teknik-aciklama = spaces
       move 4 to accept-control
       move 4 to control-id
       exit paragraph.
    open i-o teknik odalar.
    initialize teknik-rec
    move tarih-tasi           to teknik-sorun-tar
    accept teknik-sorun-zaman from time
    move cell-oda             to teknik-odano
    move k-kodu-tasi          to teknik-sorun-staf
    move teknik-aciklama      to teknik-sorun
    write teknik-rec invalid
          rewrite teknik-rec end-rewrite
    end-write.
    move cell-oda         to odalar-anah
    read odalar no lock invalid 
                        continue
                not invalid
         move house-ao      to odalar-durumu house-durumu
         rewrite odalar-rec invalid continue
         end-rewrite
    end-read.
    close teknik odalar.
    move house-ao             to cell-oda-durumu
    move oda-ariza-renk       to renk
    modify form1-gd-1(ariza-i,ariza-ii),
           hidden-data = cell-hidden
           cell-color = renk
    display message box
            "Teknik problem kaydedilmistir ..."
            title "Bilginize ...".

    set exit-pushed to true.
*
 Form4-Bef-Create.
    initialize teknik-aciklama.
*
 Form4-Gd-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
             move event-action-fail to event-action
    end-evaluate.
*
 Form4-Aft-Procedure.
     .
*
 form3-acc17-Aft-Procedure.
     initialize gec-gecme form3-ariza-adi
     if takip-durum-kodu = spaces
        exit paragraph.
     open input grup.
     initialize grup-rec
     set grup-hk-ts                to true
     move takip-durum-kodu   to grup-alt
     read grup no lock invalid
          move 1 to gec-gecme
          move "Tanimsiz ...."     to grup-adi
     end-read
     move grup-adi                 to form3-ariza-adi
     if grup-turu <> "A" 
        move "Ariza kodu gecersiz ..." to form3-ariza-adi
        move 1 to gec-gecme
     end-if.
     close grup.
     display form3-acc18.
     .
*
 form3-acc15-Aft-Procedure.
    initialize gec-gecme form3-ariza-grup-adi
    if takip-fis-sira <> 0 or takip-durum-grup-kodu = spaces
       exit paragraph.
     open input grup.
     initialize grup-rec
     set grup-hk-ts                      to true
     move takip-durum-grup-kodu          to grup-kodu.
     read grup no lock invalid
          move "Tanimsiz ..."            to grup-adi
          move 1 to gec-gecme
     end-read
     move grup-adi                       to form3-ariza-grup-adi
     close grup.
     display form3-acc16.
     .
*
 Form5-Ex-Other.
     if key-status <> 2 
        exit paragraph.

     perform form3-acc15-Aft-Procedure.
     if gec-gecme = 1
        move 4 to accept-control
        move 27 to control-id
        exit paragraph.

     perform form3-acc17-Aft-Procedure.
     if gec-gecme = 1
        move 4 to accept-control
        move 51 to control-id
        exit paragraph.

     open i-o takip odalar.
     set takip-tip-teknik         to true
     move "O"                     to takip-odami-depmi
     move "A"                     to takip-acik-kapali
     accept takip-ilk-tarih from century-date
     accept takip-ilk-zaman from time
     move k-kodu-tasi             to takip-ilk-staf
     move "O"                     to takip-kayit-kaynak
     move k-kodu-tasi             to takip-staf
     move cell-oda                to takip-oda-dep-no
     move form3-combo-oncelik-value(1:1)  to takip-oncelik-durumu

     write takip-rec invalid
           Display message box 
                   "Ariza kaydedilemedi",new-line,
                   "Lutfen Tekrar deneyiniz ..."
                   icon mb_Error_icon
                   title "Hata"
                   close takip odalar
                   exit paragraph
     end-write

     move cell-oda         to odalar-anah
     read odalar no lock invalid 
          continue
     not invalid
*****> ISTEK UZERINE KALDIRILDI          move house-ao      to odalar-durumu house-durumu
*          rewrite odalar-rec invalid 
*                  continue
*          end-rewrite
          continue
     end-read
     close odalar takip.
****> ISTEK UZERINE KALDIRILDI     move house-ao             to cell-oda-durumu
****     move oda-ariza-renk       to renk
****     modify form1-gd-1(ariza-i,ariza-ii),
****            hidden-data = cell-hidden
****            cell-color = renk
     display message box
             "Teknik problem kaydedilmistir ..."
             title "Bilginize ...".

     set exit-pushed to true.
     .
*
 Form5-Bef-Create.
     perform teknik-servis-fis-al.
     initialize takip-rec
     move hk-tk-servis-no         to takip-fis-no
     move 0                       to takip-fis-sira.
     open input kllnc
     move k-kodu-tasi             to k-kodu
     read kllnc no lock invalid
          move "Tanimsiz ...."    to k-adi k-soyadi
     end-read
     move all low-values          to takip-bildiren
     move "2"                     to form3-combo-oncelik-value(1:1)
     inspect k-adi    replacing trailing spaces by low-values
     inspect k-soyadi replacing trailing spaces by low-values
     string takip-bildiren,
            k-adi delimited by low-values
            " " delimited by low-values
            k-soyadi delimited by spaces
            into takip-bildiren
     inspect takip-bildiren replacing trailing spaces 
             by low-values
     close kllnc.
*
 teknik-servis-fis-al.
     open i-o genelfis.
     move 1 to genelfis-anahtar.
     read genelfis no lock invalid
          display message box 
                  "Onburo calisma parametresi tanimsiz ..."
                  icon mb_error_icon
                  title "Hata"
                  goback
     end-read
     add 1 to hk-tk-servis-no
     rewrite genelfis-rec end-rewrite.
     close genelfis.
     .
*
 Form1-Ef-ack1-Ev-Ntf-Changed.
          move 1 to oda-acik-girildi.
*
 odalar-yaz.
        if oda-acik-girildi = 1 then 
        open i-o odalar
       
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          move oda-ack1 to odalar-aciklama1
          move oda-ack2 to odalar-aciklama2
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
        close odalar 
        initialize  oda-acik-girildi
        end-if
     .
*
 teknik-bak.
    open input kllnc  
    open input takip grup
    initialize takip-rec 
    set takip-tip-teknik to true
    move "A"             to takip-acik-kapali
    move odalar-no to takip-oda-dep-no
    start takip key not < takip-alt-5 invalid
          continue
    not invalid
    initialize fs-takip
    perform with test after until fs-takip = "10"
    read takip next no lock end move "10" to fs-takip
    not at end
           if not takip-tip-teknik or 
              not takip-acik or
              odalar-no <> takip-oda-dep-no
                  exit perform
           end-if
           if takip-fis-sira = 0 and 
              takip-odami-depmi = "O"
              move takip-ilk-gun       to egun
              move takip-ilk-ay        to eay
              move takip-ilk-yil       to eyil
              move takip-ilk-saat      to esaat
              move takip-ilk-dakika    to edakika
              move takip-ilk-saniye    to esaniye
              move takip-ilk-staf             to k-kodu
              read kllnc no lock invalid
                   move "Tanimsiz..."       to k-adi
                  k-soyadi
              end-read
              inspect k-adi replacing trailing spaces 
                      by low-values
              inspect k-soyadi replacing trailing spaces 
                      by low-values
               if takip-durum-kodu <> spaces  and takip-durum1-aciklamalar1 = spaces
                 initialize grup-rec
                 set grup-hk-ts             to true
                 move takip-durum-kodu      to grup-alt
                 read grup no lock invalid
                      move "Tanimsiz Ariza kodu"   to grup-adi
                 end-read
               
                 move grup-adi           to takip-durum1-aciklamalar1
              end-if       
                     move toplam-ariza to etoplam-ariza
                     move all low-values to toplam-ariza
              string 
                     "  "  delimited by low-values,
                     etarih(1:5) delimited by low-values,
                     "-"    delimited by low-values,
                     ezaman delimited by low-values,
                     "-"    delimited by low-values,
                     k-soyadi delimited by low-values
                     x"0D0A" delimited by spaces
                     takip-durum1-aciklamalar1  delimited by "    "
                     x"0D0A" delimited by spaces
                      etoplam-ariza delimited by low-values,
                     into toplam-ariza
           end-if
      end-read
      end-perform
      end-start
      close takip kllnc grup.
*
     .
*
 kart1-acc-Ev-Cmd-Goto.
        if kart-no1 not = spaces
           call "/asya/ytl/obj/otel/kart.asy" 
                        using ext-fol-no, kart-no1
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/kart.asy"
                    end-call   
          perform kartlari-goster
        end-if
     .
*
 kart2-acc-Ev-Cmd-Goto.
     if kart-no2 not = spaces
            call "/asya/ytl/obj/otel/kart.asy" 
                        using ext-fol-no, kart-no2
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/kart.asy"
                    end-call   
               perform kartlari-goster
        end-if
     .
*
 kart3-acc-Ev-Cmd-Goto.
     if kart-no3 not = spaces
             call "/asya/ytl/obj/otel/kart.asy" 
                        using ext-fol-no, kart-no3
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/kart.asy"
                    end-call   
                 perform kartlari-goster
        end-if
     .



 grid-yeniden-bol.
     
     evaluate max-oda-sayi2
       when 10
*           modify form1-gd-1,
*             data-columns    = 0
*             display-columns = 0
*             font = Arial9B
*           modify form1-gd-1,
*              data-columns    = (1,5, 9,13,17,21,25,29,33,37,41,45,49,53,57,61,65,69)
*              display-columns = (1,6,11,16,21,26,31,36,41,46,51,56,61,66,71,76,81,86)
             modify form1-gd-1,
                 virtual-width = 50
       when 10
*           modify form1-gd-1,
*             data-columns    = 0
*             display-columns = 0
*             font = Arial9B
*           modify form1-gd-1,
*              data-columns    = (1,5, 9,13,17,21,25,29,33,37,41,45,49,53,57,61,65,69)
*              display-columns = (1,6,11,16,21,26,31,36,41,46,51,56,61,66,71,76,81,86)
             modify form1-gd-1,
                 virtual-width = 50
         when 14
               modify form1-gd-1,
                 virtual-width = 70
         when 25
               modify form1-gd-1,
                 virtual-width = 125
       end-evaluate       .
*
 Form2-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
*
 Form5-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .

 
