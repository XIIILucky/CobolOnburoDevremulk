* odemegir.evt
* odemegir.evt is generated from D:\asya\acugt.ytl\otel\odemegir.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 grd1-Event-Proc.
     PERFORM grd1-Ev-Other
     .

 grd1-Exception-Proc.
     PERFORM grd1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
        perform adresleri-tasi
        open i-o genelfis
        move 1 to genelfis-anahtar
        read genelfis no lock invalid
                continue
        not invalid
            add 1 to  EKRAN-FIS-1
            move EKRAN-FIS-1 to  takas-no  takastop-no
            rewrite genelfis-rec  invalid
                    stop " "
            end-rewrite
        end-read
        close genelfis
        move k-kodu-tasi to takastop-k takas-k
        move tarih-tasi to ilk-tar
        open i-o onodeme close onodeme 
        open output takas  takastop
        close takas takastop
     .
*
 Form1-Ex-Other.
      evaluate key-status
          when 1
               if control-id = 41 then
                  initialize rezara-cagir
                  call "/asya/ytl/obj/otel/rezara.asy" 
                       using rezara-cagir
                             on exception 
                                perform callerr-proc
                             not on exception
                  cancel "/asya/ytl/obj/otel/rezara.asy"
                  end-call
                  if rezara-rez-no-cagir <> spaces
                     move rezara-rez-no-cagir to  rez-no-val
                  else
                    initialize  rez-no-val
                  end-if
                  display acc-1313
               end-if
               if control-id = 50 then
                  initialize grup-cagir-tipi grup-cagir  
                  move "A" to grup-cagir-tipi
                  call "/asya/ytl/obj/otel/grupara.asy" 
                       using grup-cagir-tipi, grup-cagir
                             on exception 
                                perform callerr-proc
                             not on exception
                  cancel "/asya/ytl/obj/otel/grupara.asy"
                  end-call
                  if grup-cagir <> spaces
                     move grup-cagir to  acenta-grup-kodu
                  else
                    initialize  acenta-grup-kodu
                  end-if
                  display acc-07
               end-if
               if control-id = 29 then
                  initialize depkod-cagir
                  call "/asya/ytl/obj/otel/depara.asy" 
                       using depkod-cagir
                             on exception 
                                perform callerr-proc
                             not on exception
                  cancel "/asya/ytl/obj/otel/depara.asy"
                  end-call
                  if depkod-dep-kodu <> spaces
                     move depkod-dep-kodu to  dep-kodu
                  else
                    initialize  dep-kodu
                  end-if
                  display Form1-Ef-1
               end-if
               if control-id = 44 then
                  initialize depkod-cagir
                  call "/asya/ytl/obj/otel/depara.asy" 
                       using depkod-cagir
                             on exception 
                                perform callerr-proc
                             not on exception
                  cancel "/asya/ytl/obj/otel/depara.asy"
                  end-call
                  if depkod-dep-kodu <> spaces
                     move depkod-dep-kodu to  dep-kod-satir
                  else
                    initialize dep-kod-satir
                  end-if
                  display acc-1313a
               end-if
               if control-id = 13 then
                  initialize pazar-cagir
                  move "E"   to pazar-tipi-cagir
                  call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
                        on exception perform callerr-proc
                           not on exception
                           cancel "/asya/ytl/obj/otel/pazarara.asy" 
                  end-call
                  move pazar-kodu-cagir     to pazar-kodu
                  display Form1-Ef-1a
               end-if
               if control-id = 22 then
                  initialize doviz-cagir
                  call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
                        on exception perform callerr-proc
                           not on exception
                           cancel "/asya/ytl/obj/otel/dovizara.asy" 
                  end-call
                  move doviz-cagir     to doviz-kodux
                  display Form1-Ef-1aa
               end-if
               if control-id = 23 then
                  initialize acenta-cagir
                  call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
                       on exception perform callerr-proc
                          not on exception
                          cancel "/asya/ytl/obj/otel/acenara.asy" 
                  end-call
                  move acenta-cagir     to acenta-kodu
                  display Form1-Ef-1aaa
               end-if
          when 4
               perform raporla
          when 100  | listele buton
               initialize hata-var
               if hata-var = 1 then
                     exit paragraph
               end-if
                
               perform odeme-baslik-yukle
          when 101
               initialize hata-var
               perform odeme-baslik-yukle
          when 102
               initialize hata-var
               if hata-var = 1 then
                  exit paragraph
               end-if
               perform odeme-baslik-yukle
          when 103
               initialize hata-var
               if hata-var = 1 then
                  exit paragraph
               end-if
               modify grd1, ,reset-grid = 1
               open output takas close takas
               modify Form1-Ef-1 , enabled = true
          when 1301
               if rez-okunamadi = 1
                  display message box "Rezervasyon no tanimsiz kontrol ediniz..."
                  exit paragraph
               end-if
               perform satir-ekle
               move  3 to liste-turu                                        | liste-turu = 3 --> Eklenen Satirlar listesi
          when 1302
               perform odeme-baslik-yukle
          when 1303
               perform odeme-liste-kaydet
          when 1304
               perform odeme-baslik-yukle
               perform onodeme-listesi-yukle
               move  2 to liste-turu                                        | liste-turu = 2 --> On odemeli Rezervasyonlar listesi
          when 1305
               perform odeme-baslik-yukle
               perform acenta-grup-yukle
               move  1 to liste-turu                                        | liste-turu = 1 --> Acenta Grup Rezervasyonlari listesi
          when 1306
               perform onodeme-folio-bas
      end-evaluate
     .
*
 acenta-grup-yukle.
      open input grup rez doviz konuk onodeme depkod
      move "A" to grup-tipi
      move acenta-grup-kodu to grup-kodu
      start grup key not < grup-anah invalid
            continue
      not invalid
      perform with test after until fs-grup = "10"
      read grup next no lock end move "10" to fs-grup
      not at end
          
          if grup-tipi <> "A" or 
             grup-kodu <> acenta-grup-kodu
             exit perform 
          end-if
         
          initialize rez-rec
          move "I"       to rez-durumu
          move grup-alt  to rez-acenta
          start rez key not < rez-acen invalid
                continue
          not invalid
          perform with test after until fs-rez = "10" 
          read rez next no lock end move "10" to fs-rez
          not at end 
              
              if rez-acenta <> grup-alt
                 exit perform 
              end-if

              initialize doviz-rec konuk-rec onodeme-rec depkod-rec tanimsizlar-cetesi
              move rez-doviz          to doviz-kodu
              read doviz no lock invalid
                   move 1 to doviz-tanimsiz
              end-read
        
              move dep-kod-satir to depkod-kodu
              read depkod no lock invalid
                   continue
              end-read

              if rez-folio <> 0
                 move rez-folio       to konuk-anah
                 read konuk no lock invalid
                      move 1 to folio-tanimsiz
                 end-read
              end-if
               
              move rez-no        to onodeme-rez-no
              move depkod-kodu   to onodeme-dep-kod
              read onodeme no lock invalid
                   move 1 to onodeme-tanimsiz
              end-read

              initialize grd1-record   
              move rez-no                to grd1-col-1
              move rez-adi               to grd1-col-2
              move rez-soyadi            to grd1-col-3
              move rez-gir-gun           to xgun
              move rez-gir-ay            to xay
              move rez-gir-yil           to xyil
              move xtarih                to grd1-col-4
              move rez-cik-gun           to xgun
              move rez-cik-ay            to xay
              move rez-cik-yil           to xyil
              move xtarih                to grd1-col-5
              move acenta-adi            to grd1-col-6  
              move rez-buyuk             to z-kisi
              move z-kisi                to grd1-col-7
              move rez-kucuk             to z-kisi
              move z-kisi                to grd1-col-15
              move rez-free              to z-kisi
              move z-kisi                to grd1-col-16
              move rez-odano             to grd1-col-17
              move rez-doviz             to grd1-col-12
              move d-kisa-adi            to grd1-col-14
              move depkod-kodu           to grd1-col-11
              if onodeme-tanimsiz <> 1
                 move onodeme-tarih-gun     to xgun
                 move onodeme-tarih-ay      to xay
                 move onodeme-tarih-yil     to xyil
                 move xtarih                to grd1-col-18
                   initialize ztutar
                 move onodeme-bas-tut       to ztutar
                 move ztutar                to grd1-col-8             
        
                   initialize ztutar
                 move onodeme-basilan-tutar to ztutar
                 move ztutar                to grd1-col-9
                 move onodeme-dep-kod       to grd1-col-11
              end-if
              evaluate folio-tanimsiz 
                  when 0 
                       move "Hayir"      to grd1-col-10
                  when 1             
                       move "Evet"       to grd1-col-10
              end-evaluate
              modify grd1, record-to-add(grd1-record)
              add 1 to grid-satir-say  
              modify grd1(grid-satir-say,2),
                           hidden-data = onodeme-anah
          end-read
          end-perform 
          end-start
      end-read
      end-perform
      end-start
      close grup rez doviz konuk onodeme depkod


     .
*
 satir-ekle.
      open input rez doviz acenta konuk 
      open i-o onodeme
      initialize rez-rec 
             onodeme-rec 
              acenta-rec
               doviz-rec
               konuk-rec
      tanimsizlar-cetesi
      move rez-no-val     to rez-no
                     onodeme-rez-no
      read rez no lock invalid
           move 1 to rez-tanimsiz
      end-read


      move rez-acenta         to acenta-kodu
      read acenta no lock invalid
           move 1 to acenta-tanimsiz
      end-read

      move rez-doviz          to doviz-kodu
      read doviz no lock invalid
           move 1 to doviz-tanimsiz
      end-read


      if rez-folio <> 0
         move rez-folio       to konuk-anah
         read konuk no lock invalid
              move 1 to folio-tanimsiz
         end-read
      end-if
 
      if dep-kod-satir = 0
         display message box "Lutfen onodeme departman kodunu kontrol ediniz."
         exit paragraph
      end-if
      move dep-kod-satir to onodeme-dep-kod
      read onodeme no lock invalid
           move 1 to onodeme-tanimsiz
      end-read
      initialize grd1-record   
      move rez-no                to grd1-col-1
      move rez-adi               to grd1-col-2
      move rez-soyadi            to grd1-col-3
      move rez-gir-gun           to xgun
      move rez-gir-ay            to xay
      move rez-gir-yil           to xyil
      move xtarih                to grd1-col-4
      move rez-cik-gun           to xgun
      move rez-cik-ay            to xay
      move rez-cik-yil           to xyil
      move xtarih                to grd1-col-5
      move acenta-adi            to grd1-col-6  
      move rez-buyuk             to grd1-col-7
      move rez-kucuk             to grd1-col-15
      move rez-free              to grd1-col-16
      move rez-odano             to grd1-col-17
      move rez-doviz             to grd1-col-12
      move d-kisa-adi            to grd1-col-14
      move dep-kod-satir         to grd1-col-11
      if onodeme-tanimsiz <> 1
         move onodeme-tarih-gun     to xgun
         move onodeme-tarih-ay      to xay
         move onodeme-tarih-yil     to xyil
         move xtarih                to grd1-col-18
           initialize ztutar
         move onodeme-bas-tut       to ztutar
         move ztutar                to grd1-col-8             

           initialize ztutar
         move onodeme-basilan-tutar to ztutar
         move ztutar                to grd1-col-9
         move onodeme-dep-kod       to grd1-col-11
      end-if
      evaluate folio-tanimsiz 
          when 0 
               move "Hayir"      to grd1-col-10
          when 1             
               move "Evet"       to grd1-col-10
      end-evaluate
      modify grd1, record-to-add(grd1-record)
      add 1 to grid-satir-say  
      modify grd1(grid-satir-say,2),
                   hidden-data = onodeme-anah
      close rez doviz acenta konuk onodeme
      .

*
 kontrol.
     open input takvim 
     move x-tar to takvim-anah 
     read takvim no lock invalid
           display message box "Lutfen Gecerli Bir Odeme Tarihi Giriniz!..."
           close takvim                
           move 1 to hata-var   
           exit paragraph
     end-read
     close takvim
     
          .

*
 Form1-Ef-1-Aft-Procedure.
    open input depkod
    initialize depkod-rec
    move dep-kodu    to depkod-kodu
    read depkod no lock  invalid
         modify lbl-dep-adi , title = "Tanimsiz..."
    not invalid
           modify lbl-dep-adi , title = depkod-adi
    end-read
    close depkod
     .


*
 grd1-Ev-Other.
      evaluate event-type
         when msg-begin-entry
             evaluate event-data-1 
                 when 9 
                 when 10
                      continue
                 when other
                      if event-data-1 = 14 and liste-turu = 1
                         exit paragraph
                      end-if
                      move event-action-fail to event-action
                      inquire grd1,(event-data-2,2),
                              hidden-data in hidden-onodeme-anah
                      move hidden-onodeme-anah(1:8) to rez-no-val
                      move hidden-onodeme-anah(9:3) to dep-kod-satir
                      display acc-1313 acc-1313a
                      perform Acc-1313-Aft-Procedure

             end-evaluate
      end-evaluate .
*
 grd1-Ex-Other.
      evaluate key-status
         when 6
             initialize link-fol-no
              inquire grd1, cursor-y in  grid-satir
              inquire grd1(grid-satir,17),cell-data  = link-fol-no
              if link-fol-no <> zeroes then

                       initialize dokcagir-tasi
                       set dokcagir-tasi-call-folio1      to true
                       move link-fol-no                   to dokcagir-konuk-folio
                         call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
                                  on exception 
                                     perform callerr-proc
                                  not on exception
                                     cancel "/asya/ytl/obj/otel/dokcagir.asy"
                         end-call
                else
                       display message box "Rez C/in Olmamis !"
               end-if
             when 18
                      initialize link-rez-no
                      inquire grd1, cursor-y in  grid-satir
                      inquire grd1(grid-satir,1),cell-data  = link-rez-no
        
                      initialize dokcagir-tasi
                      set dokcagir-tasi-call-rez1   to true
                      move link-rez-no              to dokcagir-rez-no
                         call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
                                  on exception 
                                     perform callerr-proc
                                  not on exception
                                     cancel "/asya/ytl/obj/otel/dokcagir.asy"
                         end-call
         
        
      end-evaluate.
*
 Form1-Ef-1a-Aft-Procedure.
        open input kodlar02
               initialize kodlar02-rec
               move "E"                to kodlar02-tipi
               move pazar-kodu         to kodlar02-kodu
               read kodlar02         no lock invalid 
                           modify bl-pazar , title = "Tanimsiz..." 
               end-read
                modify bl-pazar , title =  kodlar02-adi
       close kodlar02
     .

*
 raporla.

               open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
              initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                         dokumer-dosya

              set  dokumer-asya-set to true
              move print-no         to dokumer-dosya-adi
              open output dokumer
*/WINDOW TITLE
              initialize dokumer-rec detay
              move "W"                    to det-dokumer-20(1:)
              move "Gala Islemleri Raporu" to det-filler
              write dokumer-rec from detay
*/ BASLIKLAR
              initialize dokumer-rec detay
              move "B"                  to det-dokumer-20(1:)
              move "Gala Islemleri Raporu" to det-filler
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "B"                  to det-dokumer-20(1:)
              write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
              initialize dokumer-rec detay
              move "O"                        to det-dokumer-20(1:)
              move "E" to dokumer-oto-sayfa-basi
              move 56  to dokumer-oto-sayfa-satir
              move "|" to dokumer-detay-kolon-ayirici
              move "LLLLLLLLLLLRRRRRRRRLLLLL" to dokumer-align-occ
              move dokumer-ozellikler-rec     to det-filler
              write dokumer-rec from detay
*/ BASLIKLAR 
              initialize dokumer-rec detay
              move "D1"               to det-dokumer-20(1:)     
              move "Rez.No"           to det-1
              move "Oda"              to det-2
              move "Rez.Adi"          to det-3
              move "Rez.Soyadi"       to det-4
              move "C/In Tar."        to det-5
              move "C/Out Tar."       to det-6
              move "C/In"             to det-7
              move "Acenta"           to det-8
              move "Buyuk"           to det-9
              move "Kucuk"           to det-10
              move "Free"            to det-11
              move "Gala Tutar"           to det-12
              move "Basilan Tut."           to det-13
              move "Doviz"           to det-14
              move all "|" to fil-1 fil-2 fil-3 fil-4  fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11 fil-12 fil-13 fil-14
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "D2"               to det-dokumer-20(1:)     
              move "-"                to det-dokumer-20(5:1)
              move all "-" to det-1 det-2 det-3 det-4 det-5 det-6 det-7 det-8 det-9 det-10 det-11 det-12 det-13 det-14
              write dokumer-rec from detay
          

                 initialize odeme-sayi
                    perform varying i from 2 by 1 until i > xgrid-sayisi

                          initialize detay
                          inquire grd1(i,1),cell-data = det-1  
                          inquire grd1(i,2),cell-data = det-2
                          inquire grd1(i,3),cell-data = det-3 
                          inquire grd1(i,4),cell-data = det-4 
                          inquire grd1(i,5),cell-data = det-5 
                          inquire grd1(i,6),cell-data = det-6 
                          inquire grd1(i,7),cell-data = det-7 
                          inquire grd1(i,8),cell-data = det-8 
                          inquire grd1(i,9),cell-data = det-9 
                          inquire grd1(i,10),cell-data = det-10 
                          inquire grd1(i,11),cell-data = det-11 
                          inquire grd1(i,12),cell-data = det-12 
                          inquire grd1(i,13),cell-data = det-13                         
                          inquire grd1(i,14),cell-data = det-14 

                                  write dokumer-rec from detay
                   end-perform

              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
  
              delete file dokumer.

*
 acc-1313-Aft-Procedure.
      open input rez
      initialize rez-rec rez-okunamadi
      move rez-no-val to rez-bilgi-rez-no
                         rez-no 
      read rez no lock invalid
           move 1 to rez-okunamadi
           move "Tanimsiz..." to rez-bilgi
      not invalid
          move rez-adi    to rez-bilgi-adi
          move rez-soyadi to rez-bilgi-soyadi
          move rez-acenta to rez-bilgi-acenta
          evaluate rez-durumu 
              when "H"
                   move "History" to rez-bilgi-durumu
              when "I"
                   move "Inhouse" to rez-bilgi-durumu
          end-evaluate 
          move rez-odano  to rez-bilgi-odano
          move rez-folio  to rez-bilgi-folio
      end-read
      modify Form1-La-4, TITLE = rez-bilgi
      close rez
     .
*
 Form1-Aft-Initdata.
     open input genel
     initialize genel-rec
     move 1 to genel-anahtar
     read genel no lock invalid
          continue
     end-read
     move donem-sonu-yil to ilk-yil
                            son-yil
     display acc-03
             acc-06
             
     close genel
     perform Odeme-Baslik-Yukle
     perform onodeme-listesi-yukle

     .
*
 odeme-liste-kaydet.
         open i-o onodeme doviz rez kur
         initialize odeme-sayi
         perform varying i from 2 by 1 until i > grid-satir-say

            
                initialize onodeme-rec
                inquire grd1(i,1),cell-data   =  onodeme-rez-no
                inquire grd1(i,14),cell-data  =  onodeme-dep-kod
                read onodeme no lock invalid
                     continue
                end-read

                inquire grd1(i,9), cell-data = xiii-tar
                move xiii-gun to onodeme-tarih-gun 
                                 x-gun
                move xiii-ay  to onodeme-tarih-ay
                                 x-ay
                move xiii-yil to onodeme-tarih-yil
                                 x-yil
                inquire grd1(i,10),cell-data = onodeme-bas-tut 
                inquire grd1(i,11),cell-data = onodeme-basilan-tutar
                inquire grd1(i,13),cell-data = onodeme-doviz-kodu
                perform Kontrol
                if hata-var <> 1
                   initialize kur-rec rez-rec
                   move onodeme-rez-no to rez-no
                   read rez no lock invalid
                        continue
                   end-read
     
                   move rez-banka          to kur-banka
                   move onodeme-doviz-kodu to kur-doviz
                   move xiii-tar           to kur-tarih
                   read kur no lock invalid
                        continue
                   end-read

                   compute onodeme-bas-tut-tl = onodeme-bas-tut * doviz-alis
                    
                end-if
                write onodeme-rec invalid
                      rewrite onodeme-rec invalid
                              stop " "
                      end-rewrite
               end-write
               add 1 to odeme-sayi
         end-perform
         close onodeme doviz rez kur
         if odeme-sayi > 0 then
                display message box "Islem Tamamlandi !"
         end-if
        
         .
*
 onodeme-listesi-yukle.
     open input onodeme rez acenta doviz konuk 
     open output takastop close takastop
     open i-o takastop
     initialize onodeme-rec tanimsizlar-cetesi
     start onodeme key not < onodeme-anah invalid
           continue
     not invalid
     perform with test after until fs-onodeme = "10"
     read onodeme next no lock end move "10" to fs-onodeme
     not at end
         initialize rez-rec
         move onodeme-rez-no     to rez-no
         read rez no lock invalid
              move 1 to rez-tanimsiz
         end-read
         move ilk-gun to x-gun
         move ilk-ay  to x-ay
         move ilk-yil to x-yil
         move son-gun to y-gun
         move son-ay  to y-ay
         move son-yil to y-yil
         evaluate cmb-filt-tip(1:2)
             when "01"
                  if rez-gir-tar < x-tar or
                     rez-gir-tar > y-tar
                     exit perform cycle
                  end-if
             when "02"
                  if rez-cik-tar < x-tar or
                     rez-cik-tar > y-tar
                     exit perform cycle
                  end-if
             when "03"
                  if onodeme-tarih <> zeroes or 
                     onodeme-tarih <> spaces
                     if onodeme-tarih < x-tar or
                        onodeme-tarih > y-tar
                        exit perform cycle
                     end-if
                  end-if
         end-evaluate 
         initialize acenta-rec
         move rez-acenta         to acenta-kodu
         read acenta no lock invalid
              move 1 to acenta-tanimsiz
         end-read

         initialize doviz-rec
         move onodeme-doviz-kodu to doviz-kodu
         read doviz no lock invalid
              move 1 to doviz-tanimsiz
         end-read
         
         if rez-folio <> 0
            initialize konuk-rec
            move rez-folio       to konuk-anah
            read konuk no lock invalid
                 move 1 to folio-tanimsiz
            end-read
         end-if
 
         initialize grd1-record   
         move onodeme-rez-no        to grd1-col-1
         move rez-adi               to grd1-col-2
         move rez-soyadi            to grd1-col-3
         move rez-gir-gun           to xgun
         move rez-gir-ay            to xay
         move rez-gir-yil           to xyil
         move xtarih                to grd1-col-4
         move rez-cik-gun           to xgun
         move rez-cik-ay            to xay
         move rez-cik-yil           to xyil
         move xtarih                to grd1-col-5
         move onodeme-tarih-gun     to xgun
         move onodeme-tarih-ay      to xay
         move onodeme-tarih-yil     to xyil
         move xtarih                to grd1-col-18
         move acenta-adi            to grd1-col-6  
         move rez-buyuk             to z-kisi
         move z-kisi                to grd1-col-7
         move rez-kucuk             to z-kisi
         move z-kisi                to grd1-col-15
         move rez-free              to z-kisi
         move z-kisi                to grd1-col-16
         move rez-odano             to grd1-col-17
         initialize ztutar
         move onodeme-bas-tut       to ztutar
         move ztutar                to grd1-col-8
         initialize ztutar
         move onodeme-basilan-tutar to ztutar
         move ztutar                to grd1-col-9
         move onodeme-doviz-kodu    to grd1-col-12
         move d-kisa-adi            to grd1-col-14
         move onodeme-dep-kod       to grd1-col-11
         evaluate folio-tanimsiz 
             when 0 
                  move "Hayir"      to grd1-col-10
             when 1             
                  move "Evet"       to grd1-col-10
         end-evaluate

         initialize takastop-rec                                        |toplamlarý al.
         move onodeme-doviz-kodu to takastop-doviz-kodu
         move rez-acenta         to takastop-acenta-kodu
         read takastop no lock invalid
              continue
         end-read
         add rez-buyuk             to takastop-pax
         add rez-kucuk             to takastop-child
         add onodeme-bas-tut       to takastop-tutar
         add onodeme-basilan-tutar to takastop-basilan
         add 1                     to takastop-oda

         write takastop-rec invalid
               rewrite takastop-rec end-rewrite
         end-write
         
         modify grd1, record-to-add(grd1-record)
         add 1 to grid-satir-say  
         modify grd1(grid-satir-say,2),
                      hidden-data = onodeme-anah
     end-read
     end-perform
     end-start
     
     initialize grd1-record d-top
     move "Toplam" to grd1-col-1
     compute t-rez = grid-satir-say - 1
     move t-rez    to z5
     move z5       to grd1-col-17
     move "T.Rez"  to grd1-col-10
     move grid-satir-say    to row-sayi
     add 1 to row-sayi
     modify grd1, record-to-add(grd1-record)
     modify grd1(row-sayi), ROW-COLOR = 112

     initialize takastop-rec d-rez-top d-pax-top d-child-top
     start takastop key not < takastop-anah invalid
           continue
     not invalid       
     perform with test after until fs-takastop = "10" 
     read takastop next no lock end move "10" to fs-takastop
     not at end
         compute row-sayi = row-sayi - 1
         if row-sayi > grid-satir-say
            if old-doviz <> takastop-doviz-kodu
               initialize grd1-record doviz-rec
               move old-doviz to doviz-kodu 
               read doviz no lock invalid
                 continue
               end-read
               move d-top-oda     to z5
               move z5            to grd1-col-10
               move d-top-tutar   to ztutar
               move ztutar        to grd1-col-8
               move d-top-basilan to ztutar
               move ztutar        to grd1-col-9
               move d-top-pax     to z-kisi
               move z-kisi        to grd1-col-7
               move d-top-child   to z-kisi
               move z-kisi        to grd1-col-15
               move "<--"         to grd1-col-6(1:3)
               move d-kisa-adi    to grd1-col-6(4:3)
               move "-TOPLAM-->"  to grd1-col-6(7:)  
               modify grd1, record-to-add(grd1-record)
               add 2 to row-sayi 
               modify grd1(row-sayi,7), cell-color = 481
               modify grd1(row-sayi,8), cell-color = 481
               modify grd1(row-sayi,9), cell-color = 481
               modify grd1(row-sayi,10), cell-color = 481
               modify grd1(row-sayi,11), cell-color = 481
               modify grd1(row-sayi,12), cell-color = 481
               modify grd1(row-sayi,13), cell-color = 481
               modify grd1(row-sayi,14), cell-color = 481
               modify grd1(row-sayi,15), cell-color = 481
               modify grd1(row-sayi,16), cell-color = 481
               modify grd1(row-sayi,17), cell-color = 481
               modify grd1(row-sayi,18), cell-color = 481
               modify grd1(row-sayi,19), cell-color = 481
               subtract 2 from row-sayi
               initialize d-top
            end-if
         end-if
         add 1 to row-sayi
         initialize acenta-rec
         move takastop-acenta-kodu to acenta-kodu
         read acenta no lock invalid
              continue
         end-read


         initialize grd1-record
         move takastop-oda     to z5
         move z5               to grd1-col-10
         move acenta-kodu      to acen-kod
         move acenta-adi       to acen-ad
         move acen             to grd1-col-6
         move takastop-pax     to z-kisi
         move z-kisi           to grd1-col-7
         move takastop-child   to z-kisi
         move z-kisi           to grd1-col-15
         move takastop-tutar   to ztutar
         move ztutar           to grd1-col-8
         move takastop-basilan to ztutar
         move ztutar           to grd1-col-9
         add takastop-tutar    to d-top-tutar
         add takastop-pax      to d-top-pax
         add takastop-child    to d-top-child
         add takastop-basilan  to d-top-basilan
         add takastop-oda      to d-top-oda
         initialize doviz-rec
         move takastop-doviz-kodu to doviz-kodu
         read doviz no lock invalid       
              continue
         end-read

         move d-kisa-adi      to grd1-col-14

         modify grd1, record-to-add(grd1-record)
         add 1 to row-sayi
*         move takastop-acenta to old-acenta
         move takastop-doviz-kodu  to old-doviz

     end-read
     end-perform 
     end-start

     initialize grd1-record doviz-rec
     move old-doviz to doviz-kodu 
     read doviz no lock invalid
       continue
     end-read
     
     move d-top-oda     to z5
     move z5            to grd1-col-10
     move d-top-tutar   to ztutar
     move ztutar        to grd1-col-8
     move d-top-basilan to ztutar
     move ztutar        to grd1-col-9
     move d-top-pax     to z-kisi
     move z-kisi        to grd1-col-7
     move d-top-child   to z-kisi
     move z-kisi        to grd1-col-15
     move "<--"         to grd1-col-6(1:3)
     move d-kisa-adi    to grd1-col-6(4:3)
     move "-TOPLAM-->"  to grd1-col-6(7:)  
     modify grd1, record-to-add(grd1-record)

     add 2 to row-sayi 
     modify grd1(row-sayi,7), cell-color = 481
     modify grd1(row-sayi,8), cell-color = 481
     modify grd1(row-sayi,9), cell-color = 481
     modify grd1(row-sayi,10), cell-color = 481
     modify grd1(row-sayi,11), cell-color = 481
     modify grd1(row-sayi,12), cell-color = 481
     modify grd1(row-sayi,13), cell-color = 481
     modify grd1(row-sayi,14), cell-color = 481
     modify grd1(row-sayi,15), cell-color = 481
     modify grd1(row-sayi,16), cell-color = 481
     modify grd1(row-sayi,17), cell-color = 481
     modify grd1(row-sayi,18), cell-color = 481
     modify grd1(row-sayi,19), cell-color = 481
     close onodeme rez acenta doviz konuk takastop.
*
 odeme-baslik-yukle.
    initialize grd1-record
    modify grd1,reset-grid = 1 
    move "Rez No "         to grd1-col-1
    move "Rez Adi "        to grd1-col-2
    move "Rez Soyadi"      to grd1-col-3
    move "Giris Tar."      to grd1-col-4
    move "Cikis Tar."      to grd1-col-5
    move "Acenta."         to grd1-col-6
    move "Buyuk"           to grd1-col-7
    move "Kucuk"           to grd1-col-15
    move "Free"            to grd1-col-16
    move "Oda"             to grd1-col-17
    move "Odeme Tar."      to grd1-col-18
    move "Odeme Tut."      to grd1-col-8
    move "Basilan Tut."    to grd1-col-9
    Move "C-in"            to grd1-col-10
    Move "DK"              to grd1-col-11
    Move "Doviz"           to grd1-col-14
    move 1                 to grid-satir-say
    modify grd1 , record-to-add(grd1-record).
*
 acc-1313a-Aft-Procedure.
     open input depkod
     initialize depkod-rec
     move dep-kod-satir to depkod-kodu
     read depkod no lock invalid
          modify Form1-La-4a, TITLE = "Tanimsiz..."
     not invalid
          modify Form1-La-4a, TITLE = depkod-adi
     end-read
     close depkod
     .
*
 acc-07-Aft-Procedure.
     open input grup
     initialize grup-rec
     move "A"              to grup-tipi
     move acenta-grup-kodu to grup-kodu
     read grup no lock invalid
          modify form1-la-grup-adi, title = "Tanimsiz..."
     not invalid
          modify form1-la-grup-adi, title = grup-adi
     end-read
     close grup.
* 
 onodeme-folio-bas.
         open i-o onodeme doviz rez kur
         initialize odeme-sayi
         perform varying i from 2 by 1 until i > grid-satir-say
            
                initialize onodeme-rec rez-rec
                inquire grd1(i,1), cell-data = onodeme-rez-no
                inquire grd1(i,14),cell-data = onodeme-dep-kod
                read onodeme no lock invalid
                     continue
                end-read
                move onodeme-rez-no to rez-no 
                read rez no lock invalid
                     continue
                end-read

                inquire grd1(i,9), cell-data = xiii-tar
                move xiii-gun to onodeme-tarih-gun 
                                 x-gun
                move xiii-ay  to onodeme-tarih-ay
                                 x-ay
                move xiii-yil to onodeme-tarih-yil
                                 x-yil
                inquire grd1(i,10),cell-data = onodeme-bas-tut 
                inquire grd1(i,11),cell-data = onodeme-basilan-tutar
                inquire grd1(i,13),cell-data = onodeme-doviz-kodu
                perform Kontrol
                if hata-var <> 1
                   initialize kur-rec rez-rec
                   move onodeme-rez-no to rez-no
                   read rez no lock invalid
                        continue
                   end-read
     
                   move rez-banka          to kur-banka
                   move onodeme-doviz-kodu to kur-doviz
                   move x-tar              to kur-tarih
                   read kur no lock invalid
                        continue
                   end-read

                   compute onodeme-bas-tut-tl = onodeme-bas-tut * doviz-alis
                                                       
                   compute onodeme-fark = onodeme-bas-tut - onodeme-basilan-tutar
                   if onodeme-fark = 0 
                      exit perform cycle
                   end-if

                end-if
                add 1 to odeme-sayi
                initialize onodeme-yazilamadi
                perform Onodeme-Yaz
                if onodeme-yazilamadi <> 1
                   move onodeme-bas-tut to onodeme-basilan-tutar
                   rewrite onodeme-rec invalid
                           continue
                   end-rewrite
                end-if
                    
         end-perform
         close onodeme doviz rez kur
         if odeme-sayi > 0 then
                display message box "Islem Tamamlandi !"
         end-if
      .
*
 onodeme-yaz.
     initialize onodeme-hata konuk-rec
     open i-o exthrk yromhrk hrk2 konuk 
     move genel-onodeme-odano to  konuk-odano           
     move "I" to       konuk-durumu  
     start konuk key = konuk-oda invalid 
          move "Folio Uyumsuz " to onodeme-hata  
     not invalid 
     perform until fs-konuk = "10" 
     read konuk next no lock end move "Folio Yok " to onodeme-hata move "10" to fs-konuk
     not end

        if "I" = konuk-durumu or genel-onodeme-odano = konuk-odano then 
           if konuk-fol-kodu = "E" and konuk-adi(1:3)="WEB"
              move konuk-folio to onodeme-folio
              perform onfolio-ok
              exit perform 
           end-if
        else
           move "Folio Yok " to onodeme-hata move "10" to fs-konuk
        end-if

     end-read
     end-perform 
     close exthrk yromhrk hrk2 konuk 
      .
*
 onfolio-ok.
     initialize hrk2-rec exthrk-rec yromhrk-rec
     move onodeme-tarih to kur-tarih t9
     move rez-banka to kur-banka
     move rez-doviz to kur-doviz
     read kur no lock invalid 
          move function date-of-integer(function integer-of-date(t9) + 1 ) to kur-tarih
          read kur no lock invalid
               move 1 to doviz-alis 
          end-read
     end-read
     move kur-tarih to yromhrk-kur-tarih
 
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          initialize genelfis-rec 
          move 1 to genelfis-anahtar
          not invalid continue 
     end-read
     add 1 to cekgir-oto
     rewrite genelfis-rec invalid 
             write genelfis-rec end-write 
     end-rewrite
     close genelfis.
     
     move konuk-folio     to exthrk-folio 
                             yromhrk-kaynak-folio  
 
     move cekgir-oto      to exthrk-islem
     move "W"             to exthrk-islem-tipi 
                             yromhrk-islem-tipi 
  
     move onodeme-tarih   to exthrk-tarih  
                             yromhrk-tarih

     move onodeme-dep-kod to exthrk-depkod 
                             yromhrk-depkod   
    
     move "A"             to exthrk-ba 
                             yromhrk-ba

     move onodeme-bas-tut to exthrk-dv-tutar  
                             yromhrk-dv-tutar

     compute exthrk-tl-tutar rounded = doviz-alis * exthrk-dv-tutar 
 
     move exthrk-tl-tutar to yromhrk-tl-tutar
     accept exthrk-zaman from time
     move exthrk-zaman    to yromhrk-zaman
     move 1               to exthrk-ref
     move "WEB "          to exthrk-staf  
                             hrk2-staf 
                             yromhrk-staf
     
     move exthrk-anah      to hrk2-anah  
                              yromhrk-anah

     move konuk-folio      to hrk2-kaynak-folio
     move rez-no           to yromhrk-rez-no
     move doviz-alis       to yromhrk-kur-degeri
     move 1                to yromhrk-dovizli-kk    
     move exthrk-dv-tutar  to yromhrk-doviz-tut      
     move exthrk-dv-tutar  to hrk2-ger-dv-tutar      
     move rez-banka        to hrk2-ger-banka      
     move rez-doviz        to hrk2-ger-doviz  
                              yromhrk-doviz-kodu     
      
     write exthrk-rec invalid 
           move 1 to onodeme-yazilamadi
     not invalid 
         move 0 to onodeme-yazilamadi
         write yromhrk-rec invalid 
               move 1 to onodeme-yazilamadi
         not invalid 
             move 0 to onodeme-yazilamadi
             write hrk2-rec invalid 
                   move 1 to onodeme-yazilamadi
             not invalid
                 move 0 to onodeme-yazilamadi
             end-write
         end-write
     end-write
     
     open i-o onkasa
     initialize onkasa-rec
     move exthrk-tarih    to onkasa-tarih.
     move exthrk-depkod   to onkasa-dep.
     read onkasa no lock invalid 
          continue
     end-read
     compute onkasa-tutar-tl   = onkasa-tutar-tl + exthrk-tl-tutar
     compute onkasa-tutar-dv   = onkasa-tutar-dv + exthrk-dv-tutar
     rewrite onkasa-rec invalid 
             write onkasa-rec end-rewrite
     close onkasa
     move rez-doviz to doviz-kodu
     read doviz no lock invalid 
          move "Tanimsiz " to d-kisa-adi
     end-read
     move onodeme-bas-tut to z-dov
     string 
            "OO:"      delimited by size                                 
            z-dov      delimited by size
            d-kisa-adi delimited by "  "
            " "        delimited by size
            rez-adi    delimited by "  " 
            " "        delimited by size
            rez-soyadi delimited by "  "
            "-"        delimited by size
            rez-no     delimited by "  "               
       into form-acik
     

     if form-acik not = spaces then
        open i-o nt
        initialize not-rec
        if konuk-fol-kodu = "R"
           move  "RHR"      to not-dos
           move romhrk-anah to not-dos-anah 

           else
           move  "EHR"      to not-dos
           move exthrk-anah to not-dos-anah 

        end-if
        move form-acik to not1
        write not-rec invalid
              continue
        end-write
        close nt
     end-if   .



 
