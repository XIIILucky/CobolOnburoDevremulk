* blokajy1.evt
* blokajy1.evt is generated from D:\asya\acugt.ytl\otel\blokajy1.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 kart1-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM kart1-acc-Ev-Cmd-Goto
     END-EVALUATE
     .

 kart2-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM kart2-acc-Ev-Cmd-Goto
     END-EVALUATE
     .

 kart3-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM kart3-acc-Ev-Cmd-Goto
     END-EVALUATE
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Drag
        PERFORM fgd-Ev-Msg-Begin-Drag
     WHEN Msg-End-Drag
        PERFORM fgd-Ev-Msg-End-Drag
     WHEN Msg-Goto-Cell
        PERFORM oda-git
     WHEN Msg-Goto-Cell-Mouse
        PERFORM oda-git
     WHEN Msg-Grid-Rbutton-Up
        PERFORM sag-tus-basildi
     WHEN Other
        PERFORM fgd-Ev-Other
     END-EVALUATE
     .

 Screen1-Event-Proc.
     .

 screen2-Event-Proc.
     .

 screen2-Pb-1-Exception-Proc.
     PERFORM screen2-Pb-1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
   
    open input genel
    initialize genel-rec
    move 1  to genel-anahtar
    read genel no lock invalid
       continue 
    end-read 
    close genel
    move 1 to ilk-gelis 
    move 1 to rack-oto-tazele casttan
     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to ilk-tarih.
   
    display acc-01 acc-02 acc-03 
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
*
 Form1-Ex-Other.
    evaluate key-status
      when 2 
        modify fgd reset-grid = 1 mass-update = 1 
         perform takas-dosya-yaz
        perform grid-yaz
      modify fgd  mass-update = 0  
      


     .
 grid-yaz.
       move renk-1 to renk
       initialize kolon-renkler
       
       initialize takas-rec   oda-sayi son-oda  son-kisi
         move 4 to kayit-sayi
       move 0 to son-satir
       move spaces  to son-oda
       MOVE "ODALAR " to  GD-1(1)
       perform  varying bu-int from ilk-integer by 1 until bu-int > son-integer
           move function date-of-integer(bu-int) to bu-date
           move bu-date to bu-tarih
           move bu-ay to e-ay
           move bu-gun to e-gun
           move bu-yil to e-yil
           compute i = bu-int - ilk-integer + 2 
           move e-tarih to gd-1( i )
           if bu-tarih = tarih-tasi then 
              move i to bugun-kolon
           end-if

       end-perform 
       modify fgd num-col-headings = 5
       modify fgd record-to-add ( gd-rec)

        initialize gd-rec
        modify fgd(1) row-font = Arial11B 
        MOVE "Bos Oda " to  GD-1(1)
        perform varying k1 from 2 by 1 until k1 > 28
             move bos-oda-say(k1) to z-sayi
             move z-sayi to gd-1(k1)
        end-perform 
        modify fgd record-to-add ( gd-rec)


        initialize gd-rec
        MOVE "Bos Erkek Yatak" to  GD-1(1)
        perform varying k1 from 2 by 1 until k1 > 28
               move bos-erk-say(k1) to z-sayi
               move z-sayi to gd-1(k1)
        end-perform 
        modify fgd record-to-add ( gd-rec)
                   
        initialize gd-rec        
        MOVE "Bos Bayan Yatak" to  GD-1(1)
        perform varying k1 from 2 by 1 until k1 > 28
               move bos-kad-say(k1) to z-sayi
               move z-sayi to gd-1(k1)
        end-perform 
        modify fgd record-to-add ( gd-rec)
        
        initialize gd-rec
        move "Blokajsiz Rez"  to gd-1(1)
        perform varying k1 from 2 by 1 until k1 > 28
             move bos-cast-say(k1) to z-sayi
             move z-sayi to gd-1(k1)
        end-perform 

        modify fgd(2) row-font = Small-font
        modify fgd(3) row-font = Small-font
        modify fgd(4) row-font = Small-font

       start takas key > takas-satir-sutun invalid continue
          not invalid 
          perform until fs-takas = "10"
            read takas next no lock end 
                  
                   modify fgd record-to-add ( gd-rec)
                   initialize gd-rec
                   MOVE TAKAS-ODA TO GD-1(1)
                   if genel-paylas-oda not = 1
                      move  takas-oda-aciklama-1 to GD-1(1)(6:)
                   end-if
                   move "10" to fs-takas
              not end
              
               if takas-satir not = son-satir
                  
                  add 1 to kayit-sayi 
                  modify fgd record-to-add (gd-rec)
                 
                    modify fgd(kayit-sayi) row-font = Small-font
                  evaluate son-kisi
                   when 1
                      modify fgd(kayit-sayi,1) cell-font = Arial11B
                    when other
                      modify fgd(kayit-sayi,1) cell-font = Small-Font
                  end-evaluate
                  






                  if kayit-sayi > 4 
                   if son-oda = spaces then   move takas-oda to son-oda end-if
                  modify fgd(kayit-sayi) row-color = renk

                 
                  if takas-oda not = son-oda
                      if renk = renk-1 
                        move renk-2 to renk
                        else
                        move renk-1 to renk
                      end-if

                     move takas-oda to son-oda
                     add 1 to oda-sayi
                  end-if
                  end-if
                   initialize gd-rec
                    evaluate takas-kisi 
                      when 1  | when  2 when  3 when 4
                        MOVE TAKAS-ODA TO GD-1(1)
                        
                        move  takas-oda-aciklama-1 to GD-1(1)(6:)
                       
                      when 2
                      move "-" to  GD-1(1)(5:)
                      move  takas-oda-aciklama-2 to  GD-1(1)(6:)
                      when 3
                       move "-" to  GD-1(1)(5:)
                       move  takas-oda-aciklama-3 to  GD-1(1)(6:)
                      when 4
                       move "-" to  GD-1(1)(5:)
                       move   " " to  GD-1(1) (6:)
                    when other 
                         move "-----" to gd-1(1)(5:)
                   end-evaluate
                    

                  move takas-satir to son-satir
                  perform varying k1 from 2 by 1 until k1 > 28
                     if kolon-dolu-yatak(k1) = 1 then 
                        modify fgd(kayit-sayi,k1),
                         bitmap = doluyatak
                         bitmap-width = 32
                         bitmap-number = 1
                     end-if
                     if kolon-bos-yatak(k1) = 1 then 
                          modify fgd(kayit-sayi,k1),
                         bitmap = bosyatak
                         bitmap-width = 32
                         bitmap-number = 1
                     end-if
                     if kolon-renk(k1) > 0 then 
                           if kolon-in (k1) = 1
                             
                             modify fgd(kayit-sayi,k1) cell-color = kolon-renk(k1) cell-font = Arial8B
                           else
                           modify fgd(kayit-sayi,k1) cell-color = kolon-renk(k1)    cell-font = Arial8
                           end-if
                           else
                          if kolon-in (k1) = 1
                         modify fgd(kayit-sayi,k1) cell-font = Arial8B
                         else
                           modify fgd(kayit-sayi,k1) cell-font = Arial8
                         end-if
                     end-if
                  end-perform
                  initialize kolon-renkler



               end-if
                 if takas-sutun = 1 then stop " " end-if
                 if takas-adi(1:5) = "....." then 
                   move 1 to kolon-bos-yatak(takas-sutun)
                 end-if
                 if takas-adi(1:5) = "=====" then 
                   move 1 to kolon-dolu-yatak(takas-sutun)
                 end-if
                 evaluate true
                     
                     when  takas-r-cin = 1 
                        if takas-bayan = 1 
                           move r-cin-b to  kolon-renk(takas-sutun)
                        else
                            move r-cin to  kolon-renk(takas-sutun)
                        end-if
                     when  takas-r-cout = 1    
                        if takas-bayan = 1 
                           move r-cout-b to  kolon-renk(takas-sutun)
                        else
                            move r-cout to  kolon-renk(takas-sutun)
                        end-if
                     when  takas-r-inh = 1   
                        if takas-bayan = 1 
                           move r-inh-b to  kolon-renk(takas-sutun)
                        else
                            move r-inh to  kolon-renk(takas-sutun)
                        end-if
                     when  takas-r-blk = 1     
                        if takas-bayan = 1 
                           move r-blk-b to  kolon-renk(takas-sutun)
                        else
                            move r-blk to  kolon-renk(takas-sutun)
                        end-if
                     when  takas-r-his = 1   
                         if takas-bayan = 1 
                           move r-his-b to  kolon-renk(takas-sutun)
                        else
                            move r-his to  kolon-renk(takas-sutun)
                        end-if


                 end-evaluate

                
                 if takas-inhouse = 1 
                    
                    move 1 to kolon-in(takas-sutun)
                 end-if
                     
                    move takas-adi to gd-1(takas-sutun)
                    move takas-inhouse to satir-inhouse(takas-sutun)
                    move takas-bayan   to satir-bayan(takas-sutun)
                    move takas-kisi to son-kisi
          end-read
          if takas-rez-no = 0 and takas-paylas = 0 and takas-oda-dolu = 1  and takas-bag-rez > 0
          initialize takas-rez-rec
            move takas-bag-rez to takas-rez-rezno
            read takas-rez no lock invalid move 999999999 to takas-rez-satir1 takas-rez-sutun1
            end-read
            if takas-rez-satir1 > takas-satir then move  takas-satir to  takas-rez-satir1 end-if
            if takas-rez-satir2 < takas-satir then move  takas-satir to  takas-rez-satir2 end-if
            if takas-rez-sutun1 > takas-sutun then move  takas-sutun to  takas-rez-sutun1 end-if
            if takas-rez-sutun2 < takas-sutun then move  takas-sutun to  takas-rez-sutun2 end-if
            write takas-rez-rec invalid rewrite takas-rez-rec end-write



          end-if
          if takas-rez-no > 0 then 
            initialize takas-rez-rec
            move takas-rez-no to takas-rez-rezno
            read takas-rez no lock invalid move 999999999 to takas-rez-satir1 takas-rez-sutun1
            end-read
            if takas-rez-satir1 > takas-satir then move  takas-satir to  takas-rez-satir1 end-if
            if takas-rez-satir2 < takas-satir then move  takas-satir to  takas-rez-satir2 end-if
            if takas-rez-sutun1 > takas-sutun then move  takas-sutun to  takas-rez-sutun1 end-if
            if takas-rez-sutun2 < takas-sutun then move  takas-sutun to  takas-rez-sutun2 end-if
            write takas-rez-rec invalid rewrite takas-rez-rec end-write
         end-if
       end-perform  

       modify fgd x = bugun-kolon Y=1   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 152
          modify fgd x = bugun-kolon Y=2   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 152
          modify fgd x = bugun-kolon Y=3   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 152
          modify fgd x = bugun-kolon Y=4   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 152
          modify fgd x = bugun-kolon Y=5   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 152
         .
 takas-dosya-yaz.
    if ilk-gelis not = 1 
    CLOSE TAKAS   takas-rez 
    
      else
      move 0 to ilk-gelis
     open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no 
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
    end-if
             move print-no         to takas-dno   takas-rez-dno
    move k-kodu-tasi to takas-k takas-rez-k
    open output takas with mass-update takas-rez with mass-update.
    close takas takas-rez 
    open i-o takas  with mass-update  takas-rez  with mass-update.
     OPEN input cast konuk rez outof odalar yanrez
       perform takas-olustur.
           
   
      close cast konuk rez outof odalar yanrez.
     .
   
 takas-olustur.
     accept zaman4 from time 
     move ilk-tarih to ilk-date
     move function integer-of-date(ilk-date) to ilk-integer
     add 26 to ilk-integer giving son-integer
     initialize odalar-rec
     move 6 to satir-yeri

     evaluate sir(1:1)
     when 0
             start odalar key > odalar-anah1
                invalid continue
             end-start

     when 1
             start odalar key > odalar-anah
                invalid continue
             end-start
        
     end-evaluate 

        perform until fs-odalar = "10"
          read odalar next no lock end move "10" to fs-odalar
            not end
              if ( odalar-hayali = "H" or "E" or "1") or odalar-dis = 1 then
               exit perform cycle
             end-if
             if onkpara-referans-var = 1 then  
                 move odalar-konumu to rez-oda-konumu cast-oda-konumu
                 move fiyat-ref   to rez-fiyat-konumu cast-fiyat-konumu
                 perform ref-filtre
                  if  not ref-gecti then 
                      exit perform cycle 
                  end-if
               end-if      
             move ilk-integer to h1-integer
              if ODALAR-KAPASITE = 0 then move 2 to ODALAR-KAPASITE end-if
                        perform varying i1 from 1 by 1 until i1 >  ODALAR-KAPASITE 
                        if i1 > 1 and  genel-paylas-oda not = 1
                       exit perform 
                    end-if
                         move 2 to sutun-yeri
                       perform varying h1-integer from ilk-integer by 1 until  h1-integer > son-integer
                      
                                 initialize takas-rec 
                                 move 1 to takas-rez-yok
                                  
                                move odalar-anah to  TAKAS-ODA  
                                move i1 to  TAKAS-KISI   
                                move h1-integer to  TAKAS-GUN          
                                 move satir-yeri to TAKAS-SATIR
                                move sutun-yeri to TAKAS-SUTUN
                                 move xkonum-adi(odalar-konumu) to takas-oda-aciklama-1
                                 move ODALAR-aciklama1 to  takas-oda-aciklama-2
                                move ODALAR-aciklama2 to  takas-oda-aciklama-3
                                 write takas-rec invalid continue end-write
                                  add 1 to sutun-yeri
                         end-perform 
                        
                  add 1 to satir-yeri  
            end-perform 
         end-read
        end-perform
      


      move function date-of-integer(son-integer ) to son-date
      move son-date to son-tarih

     accept zaman5 from time 
     initialize cast-rec rack-hatalar   kolon-veri
     move ilk-tarih to cast-tarih 
       start cast key > cast-anah invalid continue
         not invalid 
           perform until fs-cast = "10"
               read cast next no lock end move "10" to fs-cast
                  not end
                     
                    if cast-tarih > son-tarih
                      exit perform 
                    end-if
                    initialize yanrez-rec rez-rec
                    move cast-rez-no to rez-no  yanrez-rezno
                    read rez no lock invalid 
                      stop " " 
                    end-read
                     if onkpara-referans-var = 1 then  
                        
                         perform ref-filtre
                          if  not ref-gecti then 
                              exit perform cycle 
                          end-if
                     end-if     
                     if rez-cik-tar = cast-tarih  then 
                           exit perform cycle
                     end-if
                     if rez-durumu = "I"  and 
                            rez-k-g-b = "K" 
                            continue
                            else
                            exit perform cycle
                      end-if
                      initialize takas-rec
                    
                    perform varying ek-kisi from 0 by 1 until ek-kisi > 9
                    if ek-kisi > 1 and  genel-paylas-oda not = 1
                       exit perform 
                    end-if
                    move cast-tarih to s1 
                    move function integer-of-date(s1)  to  TAKAS-GUN
                    move cast-oda-no  to takas-oda 
                    compute  TAKAS-KISI = ek-kisi + 1 
                    read takas no lock invalid 
****                      display message box " Hataaaaa"
                         if rez-odano = spaces then 
                          if cast-tarih < rez-cik-tar
                           

                             compute yer3 = takas-gun - ilk-integer + 2  
                           add 1 to bos-cast-say(yer3)
                          end-if
                           if cast-tarih = rez-gir-tar and genel-paylas-oda = 1 
                              move cast-yil to e-yil
                              move cast-ay to e-ay
                              move cast-gun to e-gun


                         
                            
                            string rack-hatalar delimited by "        "
                                 e-tarih delimited by size 
                                 " girisli " delimited by size
                                rez-no delimited by size 
                                " nolu rez " delimited by size
                                rez-Adi delimited by "  "
                                " " delimited by size
                                rez-soyadi delimited by "  "
                               
                                " isimli misafirin BLOKAJI YOK" delimited by size
                                new-line delimited by size
                                into rack-hatalar
                         
                           end-if
                         else
                         if cast-tarih >= tarih-tasi and rez-odano > spaces and genel-paylas-oda = 1
                         move cast-yil to e-yil
                         move cast-ay to e-ay
                         move cast-gun to e-gun
                          string rack-hatalar delimited by "        "
                                rez-odano delimited by size 
                                " nolu odada " delimited by size
                                rez-no delimited by size 
                                " nolu rez " delimited by size
                                rez-adi delimited by "  "
                                " " delimited by size
                                rez-soyadi delimited by "  "
                                e-tarih delimited by size 
                                "tarihinde oda kapasitesi asimi" delimited by size
                                new-line delimited by size
                                into rack-hatalar
                          end-if
                          end-if
                       exit perform 
                    
                     not invalid 
                     if takas-rez-no = 0 then exit perform end-if
                    end-read
                    end-perform
                        
                   
                    

                    perform varying i1 from 1 by 1 until  i1 > rez-buyuk + rez-kucuk
                    if i1 > 1 and  genel-paylas-oda not = 1
                       exit perform 
                    end-if
                    initialize yanrez-rec
                    move i1 to yanrez-sirano
                    move rez-no to  yanrez-rezno
                    read yanrez no lock invalid move "ISIMSIZ" to yanrez-adi
                    end-read
                    if yanrez-adi = Spaces  move "ISIMSIZ" to yanrez-adi end-if

                    initialize takas-rec
                    

                    move cast-tarih to s1 
                    move function integer-of-date(s1)  to  TAKAS-GUN
                    move cast-oda-no  to takas-oda 
                   compute  TAKAS-KISI   = i1 + ek-kisi

                    read takas no lock 
                    invalid 
                     if rez-odano not =  spaces and cast-tarih >=tarih-tasi and genel-paylas-oda = 1
                        move cast-yil to e-yil
                         move cast-ay to e-ay
                         move cast-gun to e-gun
                       string rack-hatalar delimited by "        "
                                rez-odano delimited by size 
                                " nolu odada " delimited by size
                                rez-no delimited by size 
                                " nolu rez " delimited by size
                                rez-adi delimited by "  "
                                " " delimited by size
                                rez-soyadi delimited by "  "
                                e-tarih delimited by size 
                                "tarihinde oda kapasitesi asimi" delimited by size
                                new-line delimited by size
                                into rack-hatalar
                     end-if
                     exit perform cycle
                    end-read
                    


                    string yanrez-adi delimited by "  " 
                      " " delimited by size
                      yanrez-soyadi delimited by "  "
                      into takas-adi
                      end-string
                   MOVE  yanrez-adi TO TAKAS-ADI-GER
                   MOVE yanrez-soyadi TO TAKAS-SOYADI-ger
                    move rez-no to TAKAS-REZ-NO
                    move i1 to takas-sno
                    move rez-folio to takas-folio konuk-folio
                     move rez-c-in to takas-c-in
                    move rez-gir-tar to takas-gir-tar
                    move rez-cik-tar to takas-cik-tar
                     if rez-paylas-oda not = 1 then 
                       move 0 to rez-paylas-oda
                     end-if
                    move rez-paylas-oda  to takas-paylas
                   
                    move cast-sharenum to takas-sharenum
                    move rez-cik-tar to s2
                    if genel-paylas-oda = 1
                    if rez-title(1:3) = "BYN" or rez-title(1:5)= "BAYAN" or rez-title(1:2)="MS" or rez-title(1:3) = "MRS" 
                    then move 1 to takas-bayan end-if
                    end-if
                     if function integer-of-date(s2) - function integer-of-date(s1)  < 2 
                        move 1 to takas-cout
                     end-if
                     if rez-gir-tar = cast-tarih 
                        move 1 to takas-cin
                     end-if
                     move 0 to takas-rez-yok
                    if rez-folio > 0 then 
                      move rez-folio to konuk-folio
                      read konuk no lock invalid 
                         stop  " "
                       end-read
                       if konuk-durumu = "I" then 
                         move 1 to takas-inhouse
                          if takas-cik-tar = tarih-tasi 
                           
                                 move 1 to takas-r-cout
                                 else
                                 move 1 to takas-r-inh
                       end-if

                         else
                        move 1 to takas-r-his
                         move 0 to takas-inhouse
                       end-if
                       else
                       if takas-gir-tar = tarih-tasi 
                         move 1 to takas-r-cin
                         else
                         move 1 to takas-r-blk
                       end-if
                       move 0 to takas-inhouse
                     end-if
                   
                     rewrite takas-rec 
                         invalid 
                         move cast-yil to e-yil
                         move cast-ay to e-ay
                         move cast-gun to e-gun
                             string rack-hatalar delimited by "        "
                                takas-oda delimited by size 
                                " nolu odada " delimited by size
                                 e-tarih  delimited by size

                                " tarihinde veri yazilamiyor" delimited by size
                                new-line delimited by size
                                into rack-hatalar
                     end-rewrite
                     end-perform 
               end-read     



           end-perform 
        end-start 
         accept zaman6 from time 
  
        initialize takas-rec   hata-verildi son-gun son-oda       oda-bayan
        move 2 to oda-dolu
       
        start takas key > takas-oda-tek invalid continue
          not invalid 
            perform until fs-takas = "10" 
                  read takas next no lock end move "10" to fs-takas
                     not end
*                       if takas-oda = "203 " then stop " " end-if
                       if takas-gun not = son-gun or takas-oda not = son-oda
                          if oda-dolu = 0 then  
                            compute yer3 = son-gun - ilk-integer + 2 
                            add 1 to bos-oda-say(yer3)

                          end-if
                          move 7 to paylas-durumu  oda-bayan
                          move takas-gun to son-gun
                          move takas-oda to son-oda
                          move 0 to oda-dolu 
                        end-if
                        if paylas-durumu = 7 
                             move takas-paylas to paylas-durumu
                             
                        end-if
                         if oda-bayan = 7 
                             move Takas-bayan to oda-bayan
                             
                        end-if
                        if takas-rez-no not = 0
                                  
                                  if paylas-durumu not = takas-paylas  then 
                                     string rack-hatalar delimited by "        "
                                        takas-oda delimited by size 
                                        " nolu odada Hatali Paylasim " delimited by size
                                        takas-adi delimited by "   "
                                      
                                        new-line delimited by size
                                        into rack-hatalar
        

                                  end-if
                                  if oda-bayan not = takas-bayan then 
                                    
                                     string rack-hatalar delimited by "        "
                                        takas-oda delimited by size 
                                        " nolu odada BAYAN ERKEK  " delimited by size
                                        takas-adi delimited by "   "
                                      
                                        new-line delimited by size
                                        into rack-hatalar

                                  end-if

                                  move takas-bayan to oda-bayan
                                  move 1 to oda-dolu  takas-oda-dolu
                                  move takas-rez-no to son-rez
                          else
                          move oda-dolu  to takas-oda-dolu
                           move paylas-durumu to takas-paylas

                           compute yer3 = takas-gun - ilk-integer + 2 
                           if oda-dolu = 1 and paylas-durumu = 1  then 
                           if oda-bayan = 1 then 
                             add 1 to bos-kad-say(yer3)
                             else
                              add 1 to bos-erk-say(yer3)
                           end-if
                           end-if
                        end-if
                        if  takas-rez-no = 0 and takas-oda-dolu = 1 
                                if  takas-rez-no = 0 and takas-paylas = 1 and takas-oda-dolu = 1 
                                   move son-rez to takas-share-bag-rez
                                  move "....................." to takas-adi
                                end-if
                                if takas-rez-no = 0 and takas-paylas = 0 and takas-oda-dolu = 1 
                                   move son-rez to takas-bag-rez
                                  move "=================" to takas-adi
                                end-if

                              move son-rez to rez-no
                              read rez no lock invalid stop " "
                              end-read
                              
                              if rez-folio > 0 then 
                              move rez-folio to konuk-folio
                              read konuk no lock invalid 
                                 stop  " "
                               end-read
                                       if konuk-durumu = "I" then 
                                         move 1 to takas-inhouse
                                          if rez-cik-tar = tarih-tasi 
                                           
                                                 move 1 to takas-r-cout
                                                 else
                                                 move 1 to takas-r-inh
                                       end-if
                
                                         else
                                        move 1 to takas-r-his
                                      
                                       end-if
                               else
                                       if rez-gir-tar = tarih-tasi 
                                         move 1 to takas-r-cin
                                         else
                                         move 1 to takas-r-blk
                                       end-if
                             
                             end-if
                     end-if
                       rewrite takas-rec invalid stop " " end-rewrite


                  end-read
            end-perform 
        
          if rack-hatalar not = spaces and hata-goster = 1
                display message box rack-hatalar
          end-if
          .
*
 oda-git.
       
      initialize takas-rec
      inquire fgd,
                     y in takas-satir
                     x in takas-sutun
        if eski-sutun not = bugun-kolon
        modify fgd x = eski-sutun Y=1   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 0
           modify fgd x = eski-sutun Y=2   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 0
           modify fgd x = eski-sutun Y=3   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 0
           modify fgd x = eski-sutun Y=4   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 0
          modify fgd x = eski-sutun Y=5   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 0
        end-if
          modify fgd x = 1 Y=eski-satir   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 0
         MOVE takas-satir to eski-satir
         move takas-sutun to eski-sutun
         if takas-sutun not = bugun-kolon
        modify fgd x = takas-sutun Y=1   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 176
           modify fgd x = takas-sutun Y=2   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 176
           modify fgd x = takas-sutun Y=3   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 176
           modify fgd x = takas-sutun Y=4   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 176
           modify fgd x = takas-sutun Y=5   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 176
        end-if
          modify fgd x = 1 Y=takas-satir   |x= bugun-kolon   start-x = bugun-kolon  start-y = 1 y =5 
          cell-color = 176
         


       read takas  key takas-satir-sutun  
         invalid stop " "
       end-read
       move takas-gun to bu-int
       move function date-of-integer(bu-int) to bu-date
       move bu-date to bu-tarih .
       move takas-folio to EXT-FOL-NO .
       perform oda-git2
      

*          modify fgd x= takas-rez-sutun2  start-x = takas-rez-sutun1  start-y = takas-rez-satir1 y = takas-rez-satir2 region-color = 0
       initialize takas-rez-rec
       move takas-rez-no to takas-rez-rezno 
       if takas-rez-no = 0 
         move takas-bag-rez to takas-rez-rezno 
       end-if
         
         read takas-rez no lock invalid
       
         modify fgd x= takas-sutun  start-x = takas-sutun  start-y = takas-satir y = takas-satir region-color = 172
       not invalid 
         modify fgd x= takas-rez-sutun2  start-x = takas-rez-sutun1  start-y = takas-rez-satir1 y = takas-rez-satir2 region-color = 172
       end-read


       .


 
 
       
*
 sag-tus-basildi.
      perform oda-git
      call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 1
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 12
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 21
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 20
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 8
      call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 23
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 148
      
     
      if takas-rez-no > 0 then 
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 578
            call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 8
      else
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 578
         
     end-if
      if takas-rez-no > 0 and takas-folio not > 0 and bu-tarih = tarih-tasi then 
          
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 173
      else
         
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 173
     end-if

      call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 18
      if takas-folio > 0 then 
        move "Register K\tCtrl-N"  to x-20
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 579
        
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 6
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 21
       
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 7
       
      
        if takas-cik-tar = tarih-tasi then 
           call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 20
          else 
            continue
*           call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 12
        end-if
        else
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 6
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 7
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 11
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 5
        if takas-rez-no > 0 and takas-gir-tar = tarih-tasi 
           move "Check-In\tCtrl-N" to x-20
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 148
                 
        else
         if takas-rez-no = 0 and tarih-tasi = bu-tarih

           move "WalkIn C/In\tCtrl-N" to x-20
           call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 1
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 23
          end-if
        end-if
        
       call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 579
          

     end-if
     call "w$menu" using wmenu-change,
                                Form1-Mn-1-Handle,
                                14,
                                0,
                                x-20,
                                14
     call "w$menu" using wmenu-show
     .


*
 pop-up-exception.
     inquire fgd,    cursor-y in i
                     cursor-x in ii
             
    
      
     evaluate key-status
         when 169
           if takas-rez-no not > 0 then 
             display message box " Blokajsiz Oda OK giremezsiniz" new-line 
                                 " Odayi temizlemeyi deneyin...." new-line
                                  title "Blokajsiz oda"
           end-if
           open i-o odalar
                
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
            if house-ok not = spaces 
              move House-ok to odalar-durumu house-durumu
              move takas-rez-no to house-ok-rezno
              else
                if takas-folio  = 0 
              move  HOUSE-BT  to ODALAR-DURUMU
              move HOUSE-BT   to HOUSE-DURUMU 
              else
               move  HOUSE-DT to ODALAR-DURUMU
               move HOUSE-DT  to HOUSE-DURUMU 
              
               end-if 
            end-if
 
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
          perform log-operation-odalar
              
        close odalar   
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if           
        when 100
           open i-o odalar
       
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          if takas-folio  = 0 
              move  HOUSE-BT  to ODALAR-DURUMU



              move HOUSE-BT   to HOUSE-DURUMU 
              else
               move  HOUSE-DT to ODALAR-DURUMU
               move HOUSE-DT  to HOUSE-DURUMU 
              
            end-if 
********************* kapý kilit kapi kilit wolfex delphin yildirim yýldýrým 
*              call "c$system" using "C:\Users\MAMI-W7\Desktop\Project2.exe 1011 SOFTWARE",CSYS-DESKTOP 
*                giving return-code
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
          perform log-operation-odalar
        close odalar   
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
          
         
        when 101
          open i-o odalar
       
            read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          if takas-folio  = 0 
              move  HOUSE-BK  to ODALAR-DURUMU
               move HOUSE-BK    to HOUSE-DURUMU 
              
          else
               move  HOUSE-DK  to ODALAR-DURUMU
                move HOUSE-DK     to HOUSE-DURUMU 
              
            end-if 
        
          rewrite odalar-rec invalid stop " " end-rewrite
              perform log-operation-odalar
          end-read
        close odalar   
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
          
          

        when 102
          open i-o odalar
       
          read odalar no lock invalid
             display message box "Lutfen oda seciniz" title " "
              not invalid
           
          
               move  HOUSE-AO  to ODALAR-DURUMU  HOUSE-DURUMU 
              
            
              rewrite odalar-rec invalid stop " " end-rewrite
                  perform log-operation-odalar
            end-read
            close odalar
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

            when 579
              
           if takas-rez-no > 0 and takas-folio not > 0 then 
                 move takas-rez-no to rez-anah
                 open i-o rez
                 read rez no lock invalid 
                     display message box "Okunamadi"
                     not invalid
                     if rez-tam-blok = 1 then 
                     move 0 to rez-tam-blok
                     else
                     move 1 to rez-tam-blok

                    end-if
                end-read

                accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                accept rez-edit-zaman from time          |                           

                rewrite rez-rec invalid display message box "Rez Yazilamadi --Hata no :4555555"
                  end-rewrite
                close rez
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

           end-if

        when 578
          if takas-rez-no > 0 then 
             call "/asya/ytl/obj/otel/renkata.asy" 
                           using rez-no
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/renkata.asy"
                    end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
           
          end-if
         
          
        when 1699
           initialize link-wakeup-hepsi
           move takas-rez-no        to  link-wakeup-rezno
           move takas-oda        to  link-wakeup-odano
           if takas-rez-no > 0
             call "/asya/ytl/obj/otel/wakeup.asy" 
                           using link-wakeup-hepsi
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/wakeup.asy"
                    end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
           
           end-if
        when 170

         if telpara-dishat-ac-kapa = 1 
             initialize telayarq-dosya-adi  telayarq-rec
             move takas-oda to telayarq-dosya-adi
             move ".may"   to telayarq-dosya-adi(5:4)
             open output telayarq  
      
             move takas-oda to telayarq-odano   
             if takas-folio > 0 then 
                 move takas-folio to     telayarq-folio
                 move konuk-adi to  telayarq-adi
                 move konuk-soyadi to  telayarq-soy
             end-if

             accept telayar-tarih from century-date 
             accept telayar-saat from time 
              move telayar-saat to telayarq-saat 
              move telayar-tarih to telayarq-tarih  
             
              move "A " to  telayarq-islem

                 if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
             move  telayarq-odano(2:) to telayarq-odano(1:)
             move " " to   telayarq-odano(4:1) 
          end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
               write telayarq-rec  end-write
               close telayarq
         end-if 
        
         
        when 171
          initialize telayarq-dosya-adi  telayarq-rec
          move konuk-odano to telayarq-dosya-adi
          move ".may" to telayarq-dosya-adi(5:4)
          open output telayarq  
          move konuk-odano to telayarq-odano   
          if konuk-folio > 0 then 
             move konuk-folio to     telayarq-folio
          end-if
           accept telayar-tarih from century-date 
          accept telayar-saat from time 
           move telayar-saat to telayarq-saat 
          move telayar-tarih to telayarq-tarih  
           move "K " to  telayarq-islem 
              if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
             move  telayarq-odano(2:) to telayarq-odano(1:)
             move " " to   telayarq-odano(4:1) 
          end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
            write telayarq-rec  end-write
            close telayarq
          
        WHEN 103
            
         if  telpara-dishat-ac-kapa = 1 then 
              open input telkod
             initialize telayarq-dosya-adi telayar-rec telayarq-rec
        if function numval(takas-oda) < 1000
             move takas-oda to telayarq-dosya-adi(1:3)
             move ".tay" to telayarq-dosya-adi(4:4)
          else 
            move takas-oda to telayarq-dosya-adi
            move ".tay" to telayarq-dosya-adi(5:4)

          end-if              
             
*             move takas-oda to telayarq-dosya-adi
*             move ".tay" to telayarq-dosya-adi(5:4)


             open output telayarq  
             open i-o telayar
***             move takas-oda to telayarq-odano  telayar-odano 
                if TELPARA-dishat-ac-kapa-dahili = 1
             initialize telkod-rec kayit-var
             start telkod key not < telkod-anah invalid 
                 continue 
             not invalid 
             perform with test after until fs-telkod = "10"
             read telkod next no lock end move "10" to fs-telkod
             not at end 
                     if tel-onb-oda = takas-oda
                         move TEL-ODA to telayarq-odano  telayar-odano
                         move 1       to kayit-var
                     else
                        exit perform cycle 
                     end-if 
             end-read 
             end-perform
             end-start
             if kayit-var not = 1
               move takas-oda to telayarq-odano  telayar-odano 
             end-if 
          else
                move takas-oda to telayarq-odano  telayar-odano 
          end-if 

             if takas-folio > 0 then 
                 move takas-folio to  telayar-folio   telayarq-folio
                 move konuk-adi to telayar-adi telayarq-adi
                 move konuk-soyadi to telayar-soy telayarq-soy
             end-if
             accept telayar-tarih from century-date 
             accept telayar-saat from time 
              move telayar-saat  to telayarq-saat 
              move telayar-tarih to telayarq-tarih  
             
              move "A " to telayar-islem telayarq-islem
              
              if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
                 move  telayarq-odano(2:) to telayarq-odano(1:)
                 move " " to   telayarq-odano(4:1) 
              end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
              write telayar-rec invalid continue end-write
               write telayarq-rec  end-write
               close telayarq

                if function numval(takas-oda) < 1000
                    move ".may" to telayarq-dosya-adi(4:4)
                  else 
                move ".may" to telayarq-dosya-adi(5:4)
        
                  end-if 
               

               if takas-folio > 0
                  move konuk-adi to telayar-adi telayarq-adi
                  move konuk-soyadi to telayar-soy telayarq-soy
              end-if 
               open output telayarq 
               write telayarq-rec  end-write
               close telayar telkod telayarq
         end-if          
         WHEN 104
          
         if  TELPARA-dishat-ac-kapa = 1 then 
          open input telkod
          initialize telayarq-dosya-adi telayar-rec telayarq-rec

        if function numval(takas-oda) < 1000
             move takas-oda to telayarq-dosya-adi(1:3)
             move ".tay" to telayarq-dosya-adi(4:4)
          else 
            move takas-oda to telayarq-dosya-adi
            move ".tay" to telayarq-dosya-adi(5:4)

          end-if 
*          move takas-oda to telayarq-dosya-adi
*          move ".tay" to telayarq-dosya-adi(5:4)


          open output telayarq  
          open i-o telayar
                if TELPARA-dishat-ac-kapa-dahili = 1
             initialize telkod-rec kayit-var
             start telkod key not < telkod-anah invalid 
                 continue 
             not invalid 
             perform with test after until fs-telkod = "10"
             read telkod next no lock end move "10" to fs-telkod
             not at end 
                     if tel-onb-oda = takas-oda
                         move TEL-ODA to telayarq-odano  telayar-odano
                         move 1       to kayit-var
                     else
                        exit perform cycle 
                     end-if 
             end-read 
             end-perform
             end-start
             if kayit-var not = 1
               move takas-oda to telayarq-odano  telayar-odano 
             end-if 
          else
                move takas-oda to telayarq-odano  telayar-odano 
          end-if 

          


          if takas-folio > 0 then 
             move takas-folio to  telayar-folio   telayarq-folio
          end-if
           accept telayar-tarih from date 
          accept telayar-saat from time 
           move telayar-saat to telayarq-saat 
          move telayar-tarih to telayarq-tarih  
           move "K " to telayar-islem telayarq-islem 
              if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
             move  telayarq-odano(2:) to telayarq-odano(1:)
             move " " to   telayarq-odano(4:1) 
          end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
           write telayar-rec invalid continue end-write
            write telayarq-rec  end-write
            close telayarq
***            move ".may" to telayarq-dosya-adi(5:4)
                if function numval(takas-oda) < 1000
                    move ".may" to telayarq-dosya-adi(4:4)
                else 
                   move ".may" to telayarq-dosya-adi(5:4)        
                end-if 
            open output telayarq 
            write telayarq-rec  end-write
            close telkod telayar telayarq
           end-if
        when 1
           
             initialize aramayap
             move 1 to vis-ara2
             move 0 to vis-ara1 vis-ara3 vis-ara4
             perform acu-form2-routine
             if aramayap= 1  then
              perform adi-ara
            end-if
            move 4 to accept-control
            move 69 to control-value
        when 3
            evaluate true 
              when vis-ara2 = 1 
                  perform sonraki-adi
              when vis-ara1 = 1 
                  perform oda-ara
              when vis-ara3 = 1 
                  perform sonraki-soyadi
              when vis-ara4 = 1 
                  perform sonraki-plaka

            end-evaluate   
         when   17 
           move "U"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move rez-anah to link-NOT-DOS-ANAH  
               
            move 1 to link-nereden 
           string rez-adi delimited by "  "
                  " " delimited by size
                  rez-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
                  display not-ac
        when 15
             initialize aramayap
             move 1 to vis-ara1
             move 0 to vis-ara2 vis-ara3 vis-ara4
             perform acu-form2-routine
              if aramayap= 1  then
                 perform oda-ara
              end-if
              move 1 to control-value
            move 4 to accept-control
        when 16
             initialize aramayap
             move 1 to vis-ara4
             move 0 to vis-ara2 vis-ara1 vis-ara3
             perform acu-form2-routine
              if aramayap= 1  then
                 perform plaka-ara
              end-if
              move 1 to control-value
              move 4 to accept-control
        when 19
             initialize aramayap
             move 1 to vis-ara3
             move 0 to vis-ara2 vis-ara1 vis-ara4
             perform acu-form2-routine
              if aramayap= 1  then
              perform soyadi-ara
              end-if
              move 1 to control-value
            move 4 to accept-control

       when 18 
          
           
            if takas-rez-no > 0 or  takas-bag-rez > 0
               
                    initialize dokcagir-tasi
                     set dokcagir-tasi-call-rez1   to true
                     move takas-rez-no                   to dokcagir-rez-no
                     if takas-rez-no = 0 then 
                       move takas-bag-rez to dokcagir-rez-no
                     end-if
                     perform dokcagir-call
                     move dokcagir-rez-no          to rez-no 
                                        
             else
             
              perform share-seri-bul
               if takas-share-bag-rez > 0 
                 perform shareli1
                 else
                  perform  shareli2
                  
               end-if
                           
            end-if 
            
              if rack-oto-tazele = 1
                
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

        when 14
            
          if takas-rez-no > 0 then
            if takas-folio = 0  
                    if takas-gir-tar = tarih-tasi then 
                      move 99999998 to takas-folio
                    
                   
      
                    initialize dokcagir-tasi
                    set dokcagir-tasi-call-cin2    to true
                    move takas-rez-no                  to dokcagir-konuk-rez-no
                    move takas-folio                to dokcagir-konuk-folio
                    perform dokcagir-call
                    move dokcagir-konuk-folio      to takas-folio
                    move dokcagir-konuk-rez-no     to takas-rez-no
                    if rack-oto-tazele = 1
                         perform Form1-Cb-1aa-Ex-Cmd-Clicked
                      end-if
                    else
                      display message box "CIN gunu gelmemis" title "HATA"
                     end-if
             
            else
              initialize dokcagir-tasi
                    set dokcagir-tasi-call-cin2    to true
                    move takas-rez-no                  to dokcagir-konuk-rez-no
                    move takas-folio                to dokcagir-konuk-folio
                    perform dokcagir-call
                    move dokcagir-konuk-folio      to takas-folio
                    move dokcagir-konuk-rez-no     to takas-rez-no
                    if rack-oto-tazele = 1
                         perform Form1-Cb-1aa-Ex-Cmd-Clicked
                      end-if
                     
        
                 

          else
           
**************************> CIN CALL 3 PARAMETRELI CAGIRMA
            initialize dokcagir-tasi
            set dokcagir-tasi-call-cin3    to true
            move takas-rez-no                  to dokcagir-konuk-rez-no
            move takas-folio                to dokcagir-konuk-folio
            move takas-oda                to dokcagir-konuk-odano
            perform dokcagir-call
            move dokcagir-konuk-folio      to takas-folio
            move dokcagir-konuk-rez-no     to takas-rez-no
            move dokcagir-konuk-odano      to takas-oda
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

          end-if
          when 11
               if takas-folio > 0 and 
                  calisma-tarihi <= konuk-git-tar and 
                  calisma-tarihi >= konuk-gel-tar
**************cekgir.asy
                  initialize dokcagir-tasi
                  set dokcagir-tasi-call-kfolio  to true
                  move takas-folio                to dokcagir-konuk-folio 
                  
                  perform dokcagir-call
                 
              end-if
         when 6
          if takas-folio > 0 then 
           call "/asya/ytl/obj/otel/folio.asy" 
            using  takas-folio
            on exception 
             perform callerr-proc
             exit paragraph
            not on exception 
             cancel "/asya/ytl/obj/otel/folio.asy"
          end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

          end-if
        
 
         when 12
         when 20
**************************> cout.asy
          if takas-folio > 0 and takas-inhouse = 1  and takas-cik-tar = tarih-tasi then 
              initialize dokcagir-tasi
              set dokcagir-tasi-call-cout2   to true
              move takas-oda                  to dokcagir-konuk-odano
              move takas-folio                to dokcagir-konuk-folio
              perform dokcagir-call
              move dokcagir-konuk-odano      to takas-oda
              move dokcagir-konuk-folio      to takas-folio
                 call "w$keybuf" using 3 end-call 
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if
              else
              display message box "COUT icin uyumsuz oda" title "HATA"
            end-if
          when 8
          if takas-folio = 0 then 
              perform acu-form3-routine
              initialize key-status
               move 4 to accept-control
                move 69 to control-value
               if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
            else
            if takas-inhouse = 1 then 
**************************> odadegis.asy
              initialize dokcagir-tasi
              set dokcagir-tasi-call-odadegis1  to true
              move takas-oda                     to dokcagir-konuk-odano
              perform dokcagir-call
              move dokcagir-konuk-odano         to takas-oda
             
              else
                 display message box "Cout olmus odayi Room Chane yapamazsiniz" title "HATAA"
             end-if
             end-if
           when 21
**************************> uzatma.asy
            if takas-inhouse = 1 then 
              initialize dokcagir-tasi
              set dokcagir-tasi-call-uzatma1    to true
              move takas-oda                     to dokcagir-konuk-odano
              perform dokcagir-call
              move dokcagir-konuk-odano         to takas-oda
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
              else
                if takas-folio = 0
                   display message box "Ctrl-R ile rezervasyonu acip uzatma kýsaltma yapabilirsiniz" title "HATA"
                else
                  display message box "Sadece Inhouse Odalara Uzatma/Kisaltma yapilabilir" title "HATA"
                end-if
              end-if

    end-evaluate.
*
 Form1-Cb-1aa-Ex-Cmd-Clicked.
      
      inquire fgd x in son-x y in son-y vscroll-pos in son-vscroll-pos   hscroll-pos in son-hscroll-pos 
      cursor-x in son-cursor-x
      cursor-y in son-cursor-y
       modify fgd reset-grid = 1 mass-update = 1 
         accept zaman1  from time 
         perform takas-dosya-yaz
          accept zaman2  from time 
        perform grid-yaz
         accept zaman3  from time 
      modify fgd  mass-update = 0  
*      display message box zaman1 new-line
*        
*          zaman4 new-line
*          zaman5 new-line
*          zaman6 new-line
*       
*          zaman2 new-line
*
*
*        zaman3
        modify fgd 
          x = son-cursor-x  
          y = son-cursor-y 
        
      cursor-x = son-cursor-x
      cursor-y = son-cursor-y
       modify fgd 
       vscroll-pos = son-vscroll-pos 
         hscroll-pos = son-hscroll-pos  
          move 4 to accept-control
          move 69 to control-id
       perform  oda-git
       
       
              
              .
*
*
 Screen1-Ef-1-Aft-Procedure.
      move 1 to aramayap
      set exit-pushed to true
      .
*
 bulunana-git.
        modify fgd
            cursor-x = takas-sutun
            cursor-y = takas-satir
         .
         move takas-sutun to event-data-1
         move takas-satir to event-data-2
         perform oda-git2
        
         .
*
 oda-ara.
     if ara-oda not = spaces then 
       initialize takas-rec
        move ara-oda to takas-oda 
        start takas key >= takas-anah invalid display message box takas-oda 
               " nolu oda rack de bulunamadi"
          not invalid
        read takas next no lock 
            end
              display message box takas-oda 
               " nolu oda rack de bulunamadi"
            not end
                perform bulunana-git
        end-read
        end-start
     end-if
      .
*
 adi-yok.    
    display message box "Adi " ara-adi(1:ara-adi-u) 
       " ile baslayan baska oda bulunamadi".
*
 plaka-yok.
    display message box "Plakasi " ara-plaka(1:ara-plaka-u) 
       " ile baslayan baska oda bulunamadi".
*
 soyadi-yok.
    display message box "Soyadi " ara-soyadi(1:ara-soyadi-u) 
       " ile baslayan baska oda bulunamadi".
*
 adi-ara.
     initialize adi-bitti
     if ara-adi not = spaces then 
        
        perform varying ara-adi-u from 20 by -1 
          until ara-adi(ara-adi-u:1) not = space
           if ara-adi-u = 1 then 
               exit perform
           end-if
        end-perform  

        move ara-adi to takas-adi-ger 
        start takas key >= takas-adi-ger
          invalid
            perform adi-yok
            move 1 to adi-bitti
            not invalid
               perform sonraki-adi
        end-start
      end-if.
*
plaka-ara.
     initialize plaka-bitti
     if ara-plaka not = spaces then 
        
        perform varying ara-plaka-u from 15 by -1 
          until ara-plaka(ara-plaka-u:1) not = space
           if ara-plaka-u = 1 then 
               exit perform
           end-if
        end-perform  

        move ara-plaka to takas-plaka 
        start takas key >= takas-plaka
          invalid
            perform plaka-yok
            move 1 to plaka-bitti
            not invalid
               perform sonraki-plaka
        end-start
      end-if.
*
 soyadi-ara.
     initialize soyadi-bitti
     if ara-soyadi not = spaces then 
        
        perform varying ara-soyadi-u from 20 by -1 
          until ara-soyadi(ara-soyadi-u:1) not = space
           if ara-soyadi-u = 1 then 
               exit perform
           end-if
        end-perform  
       
        move ara-soyadi to takas-soyadi-ger
        start takas key >= takas-soyadi-ger
          invalid
            perform soyadi-yok
            move 1 to soyadi-bitti
            not invalid
               perform sonraki-soyadi
        end-start
      end-if
      .
*
 sonraki-adi.
     if adi-bitti = 1 then 
        perform adi-ara
       else 
         read takas next no lock 
           end 
             perform adi-yok
             move 1 to adi-bitti
           not end
             if takas-adi-ger(1:ara-adi-u) not = 
                ara-adi(1:ara-adi-u) 
                perform adi-yok
                move 1 to adi-bitti
                else
                 
                 perform bulunana-git
             end-if
         end-read
      end-if.  
*
 sonraki-soyadi.
     if soyadi-bitti = 1 then 
        perform soyadi-ara
       else 
         read takas next no lock 
           end 
             perform soyadi-yok
             move 1 to soyadi-bitti
           not end
             if takas-soyadi-ger(1:ara-soyadi-u) not = 
                ara-soyadi(1:ara-soyadi-u) 
                perform soyadi-yok
                move 1 to soyadi-bitti
                else
                
                 perform bulunana-git
             end-if
         end-read
      end-if.
*
 sonraki-plaka.
     if plaka-bitti = 1 then 
        perform plaka-ara
       else 
         read takas next no lock 
           end 
             perform plaka-yok
             move 1 to plaka-bitti
           not end
             if takas-plaka(1:ara-plaka-u) not = 
                ara-plaka(1:ara-plaka-u) 
                perform plaka-yok
                move 1 to plaka-bitti
                else
                 perform bulunana-git
             end-if
         end-read
      end-if.
*
*
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
     on exception 
        perform callerr-proc
     not on exception
        cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
    .
*
 fgd-Ev-Other.
     evaluate event-type 
      when msg-begin-entry
*   space e bastý   
           
         
        move event-action-fail   to event-action
     when Msg-Goto-Cell-Mouse
     when Msg-Goto-Cell
    end-evaluate.
     .
*
*
 kart1-acc-Ev-Cmd-Goto.
        if kart-no1 not = spaces
***************KART CALL
           initialize dokcagir-tasi
           set dokcagir-tasi-call-kart2   to true
           move ext-fol-no                to dokcagir-konuk-folio
           move kart-no1                  to dokcagir-rez-extra-kart
           perform dokcagir-call
           move dokcagir-konuk-folio      to ext-fol-no
           move dokcagir-rez-extra-kart   to kart-no1

           perform kartlari-goster
        end-if
     .
*
 kart2-acc-Ev-Cmd-Goto.
     if kart-no2 not = spaces
***************KART CALL
           initialize dokcagir-tasi
           set dokcagir-tasi-call-kart2   to true
           move ext-fol-no                to dokcagir-konuk-folio
           move kart-no2                  to dokcagir-rez-extra-kart
           perform dokcagir-call
           move dokcagir-konuk-folio      to ext-fol-no
           move dokcagir-rez-extra-kart   to kart-no2

           perform kartlari-goster
        end-if
     .
*
 kart3-acc-Ev-Cmd-Goto.
     if kart-no3 not = spaces
***************KART CALL
           initialize dokcagir-tasi
           set dokcagir-tasi-call-kart2   to true
           move ext-fol-no                to dokcagir-konuk-folio
           move kart-no3                  to dokcagir-rez-extra-kart
           perform dokcagir-call
           move dokcagir-konuk-folio      to ext-fol-no
           move dokcagir-rez-extra-kart   to kart-no3
           perform kartlari-goster
        end-if
     .
*
*
 kartlari-goster.
        
           initialize onb-hata
         open input kart.
         if onb-hata = 1 then 
           initialize onb-hata
           exit paragraph
         end-if
         initialize kart-rec kart-no1 kart-no2 kart-no3
            kart-ind1 kart-ind2 kart-ind3
         move ext-fol-no to kart-folio
         start kart key >= kart-folio
          invalid continue
          not invalid 
          perform varying kart-say from 1 by 1 until 
                 fs-kart = "10" or kart-say > 3
             read kart next no lock 
               end move "10" to fs-kart 
               not end
                if kart-folio not = ext-fol-no
                    move "10" to fs-kart 
                    else
                   evaluate kart-say
                      when 1
                         move kart-no to kart-no1
                         if kart-ind > 0 then 
                              string "%", kart-ind ,
                                into kart-ind1

                         end-if
                      when 2
                          move kart-no to kart-no2
                          if kart-ind > 0 then 
                              string "%", kart-ind ,
                                into kart-ind2

                         end-if
                      when 3
                          move kart-no to kart-no3
                          if kart-ind > 0 then 
                              string "%", kart-ind ,
                                into kart-ind3

                         end-if
                   end-evaluate
               end-if
             end-read
          end-perform
        end-start 
        display kart1-acc kart2-acc kart3-acc kartind1-acc kartind2-acc kartind3-acc  Form1-Pb-5
        close kart.


*******************
*
 oda-git2.
        initialize ext-bakiye-tl ext-bakiye-dov
         initialize rom-bakiye-tl rom-bakiye-dov 
*         display message box event-type "----" event-control-id 
*        inquire Form1-Gd-1, cursor-x in i cursor-y in ii
*        accept omitted before ime 0
        move takas-oda to  oda-num
         

       

        initialize odalar-rec
        open input odalar
        move oda-num to odalar-no
        read odalar no lock invalid continue
          
           
        end-read
         
        close odalar
         perform oda-bil-update
     
     
        .
        
**************
*
 oda-bil-update.
        move takas-folio to konuk-folio
        initialize geceleme  
      evaluate true  
            when takas-folio > 0
                 move 1 to oda-vis
                 perform oda-bilgi-fol
                 perform geceleme-bul
            when takas-rez-no > 0
                 move 0 to v-nopost
                 move 1 to oda-vis
                 perform oda-bilgi-fol
                 perform geceleme-bul
             when other
               move 0 to oda-vis  v-vip
                move 0 to v-nopost
               open input konum 
               move odalar-konumu to konum-anahtar
                read konum no lock 
                     invalid move "**********" to konum-adi
                  end-read
               
                close konum
    end-evaluate.
    perform bilgi-yaz.

 bilgi-yaz.
*     if k-kisi-goremez = 1 then 
*       initialize konuk-buyuk
*       
*     end-if
*     if k-kodu-tasi = "ASYA" and konuk-buyuk = 0 then 
*         stop " "
*
*     end-if
        initialize ad-soyadlar
        open input yanrez
   
     string konuk-adi delimited by "   "
            "-" delimited by size
            konuk-soyadi delimited by "  "
            into ad-soyad(1)
     move konuk-rez-no to yanrez-rezno
     move 2 to yanrez-sirano siradaki
     read yanrez no lock invalid 
       continue
       not invalid 
       add 1 to siradaki
       string yanrez-adi  delimited by "   "
            "-" delimited by size
            yanrez-soyadi delimited by "  "
            into ad-soyad(2)
          end-string
             move konuk-rez-no to yanrez-rezno
             move 3 to yanrez-sirano 
             read yanrez no lock invalid 
               continue
               not invalid 
               add 1 to siradaki
               string yanrez-adi  delimited by "   "
                    "-" delimited by size
                    yanrez-soyadi delimited by "  "
                    into ad-soyad(3)
        
               end-string
                       move konuk-rez-no to yanrez-rezno
                     move 4 to yanrez-sirano 
                     read yanrez no lock invalid 
                       continue
                       not invalid 
                       add 1 to siradaki
                       string yanrez-adi  delimited by "   "
                            "-" delimited by size
                            yanrez-soyadi delimited by "  "
                            into ad-soyad(4)
                
                       end-string

                  end-read
           end-read
    end-read
      close yanrez .
*     string OZLUK-YANI-ADI1 delimited by "   "
*            " " delimited by size
*            OZLUK-YANI-soy1 delimited by "  "
*            into ad-soyad(2)
*        if ad-soyad2 = spaces then 
*           move 2 to siradaki
*           else
*           move 3 to siradaki
*        end-if
  
        
     
     
     if konuk-mini-ok = 1     then 
        move 1 to mini-ok
        else
        move 0 to mini-ok
     end-if
     if konuk-acik-kapali = "C"
       move 1 to v-nopost
       else
       move 0 to v-nopost
     end-if
     display a-minibar
     display form1-fr-2a.
     display form1-la-1a.
   
  
     
     display form1-ef-folio
     display form1-geceleme
     display form1-ef-adi  
     display kart1-acc kart2-acc kart3-acc  Form1-Pb-5
     display form1-ef-adi2
     display form1-ef-adi3
     display form1-ef-adi4
     display form1-ef-adi5

     display form1-ef-gg
     display form1-ef-ga
     display form1-ef-gy  form1-ef-g1 form1-ef-g2
     form1-ef-g3 form1-ef-g4 form1-ef-g3a form1-ef-g4a
     display Form1-a-safe
     display acc-vip
     display Form1-a-anah
     display form1-ef-cg
     display form1-ef-ca
     display form1-ef-cy
     display form1-ef-acenta
     display form1-ef-ulke
     display form1-ef-buyuk
     display form1-ef-kucuk
     display form1-ef-free
     display form1-ef-bebek
     display form1-ef-voucher
     display form1-ef-pans
     display form1-ef-ode
     display form1-ef-banka
     display form1-ef-doviz
     display form1-ef-dv-toplam
     display form1-ef-cin-kuru
     display form1-ef-tl-toplam
     display form1-ef-not1
     display form1-ef-not2
     display form1-ef-fiyat-konumu
    
     display l-nopost
    
    
   
     
   
     

      if eski-oda not = odalar-no then 
        move odalar-no to eski-oda
         initialize toplam-not
      
     if takas-rez-no > 0 or ( takas-folio > 0 and konuk-rez-no > 0 ) then
           move 3 to link-nereden 
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           if takas-rez-no > 0
                move takas-rez-no to link-not-dos-anah
              else
              move konuk-rez-no to link-NOT-DOS-ANAH   
            end-if
           move 3 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
        end-if
             display not-ac
       end-if
     .
 oda-bilgi-fol.
      initialize ozluk-rec
     open input rez yanrez 
     if takas-folio > 0 then 
             open input konuk ozluk
             move takas-folio         to konuk-folio ozluk-folio
             read konuk no lock invalid
                  display message box 
                          takas-folio," numarali folio bulunamadi ..." new-line
                          "Lutfen F5 ile racki tazeleyiniz"
                          icon mb_error_icon,
                          title "Hata"
                          close konuk  rez  ozluk yanrez
                          exit paragraph
                   not invalid
                     
                    
                      move takas-folio         to konuk-folio ozluk-folio
                       read konuk no lock end-read
                       read ozluk no lock end-read
             close ozluk
             end-read
             close konuk
             move konuk-rez-no to rez-anah
             read rez no lock 
                invalid display message box "Rezervasyon bulunamadi"
             end-read
                move  rez-no to yanrez-rezno
            
                 move 2 to yanrez-sirano
                 read yanrez no lock invalid
                    
                     continue
                    not invalid 
                     move yanrez-adi to OZLUK-YANI-ADI1
                      move yanrez-soyadi to OZLUK-YANI-soy1
                  end-read
              move  "Konuk Bilgileri" to frm-tit
              move  "Folio No :"   to fol-tit
         else
             move "Blokaj Bilgileri" to frm-tit
             move "Rez No :"         to  fol-tit
             move takas-rez-no to rez-no
             read rez no lock 


                invalid display message box "Rezervasyon bulunamadi"
             end-read
            
             initialize konuk-kur-degeri toplam-tutar kart-no1 kart-no2 kart-no3
             move rez-acenta        to konuk-acenta
             move rez-no            to konuk-folio
             move rez-adi           to konuk-adi
             move rez-soyadi        to konuk-soyadi
             move rez-gir-tar       to konuk-gel-tar
             move rez-gel-zaman     to konuk-gel-zaman
             move rez-cik-tar       to konuk-git-tar
             move rez-ulke          to konuk-ulke
             move rez-buyuk         to konuk-buyuk
             move rez-kucuk         to konuk-kucuk
             move rez-free          to konuk-free
             move rez-bebek         to konuk-bebek
             move rez-voucher       to konuk-voucher
             move rez-pan-tipi      to konuk-pan-tipi
             move rez-odeme-tipi    to konuk-odeme-tipi
             move rez-banka         to konuk-banka
             move rez-doviz         to konuk-doviz
             move rez-fiyati        to konuk-dv-degeri
             move rez-odano         to konuk-odano
             move rez-fiyat-konumu  to konuk-fiyat-konumu 
             move rez-vip           to konuk-vip
             move rez-no        to konuk-rez-no
             move rez-firma         to konuk-firma
             move rez-sharenum to konuk-sharenum  
                   move  rez-no to yanrez-rezno
            
                 move 2 to yanrez-sirano
                 read yanrez no lock invalid
                    
                     continue
                    not invalid 
                     move yanrez-adi to OZLUK-YANI-ADI1
                      move yanrez-soyadi to OZLUK-YANI-soy1
                  end-read


     end-if



     close rez yanrez.
     move 1 to v-vip

     open input kodlar02 
     initialize kodlar02-rec
     move "v"       to kodlar02-tipi
     move konuk-vip to kodlar02-kodu
     read kodlar02 no lock invalid
          move "*"  to kodlar02-adi
     end-read

        if konuk-vip = " "
           move "NORMAL"   to d-vip
        else
           move kodlar02-adi to d-vip
        end-if
     close kodlar02
*     Evaluate konuk-vip
*            when  "N"  move 0 to v-vip
*            when  "V"  move "VIP" to d-vip
*            when  "T"  move "TOP VIP" to d-vip
*            when  "B"  move "BALAYI" to d-vip
*            when  "G"  move "GRepeat" to d-vip
*            when  "1"  move "VIP 1" to d-vip
*            when  "2"  move "VIP 2" to d-vip
*            when  "3"  move "VIP 3" to d-vip       
*      end-evaluate

     open input konum
     move konuk-fiyat-konumu to konum-anahtar
     read konum no lock 
        invalid move "**********" to konum-adi
     end-read
     move konum-adi to fiyat-knm
    
     close konum
     if odalar-konumu = konuk-fiyat-konumu then 
       move 517 to color-fiyat
        else
       move 176 to color-fiyat
       end-if
     open input ulke.
     move konuk-ulke      to ulke-anah
     
     read ulke no lock invalid
     
          move "Tanimsiz" to ulke-adi
     end-read
     close ulke.
     
     open input acenta firma
     move konuk-acenta    to acenta-anahtar
     read acenta no lock invalid
          move "Tanimsiz" to acenta-adi
     end-read    
     close acenta.
     if konuk-firma not = spaces 
        initialize firma-rec
        move konuk-firma   to firma-kodu
        read firma no lock invalid 
             continue 
        not invalid 
            move firma-adi to acenta-adi
            modify Form1-La-1ab,title = "Firma :"
        end-read
     else 
       modify Form1-La-1ab,title = "Acenta :"
     end-if 
     close firma

     open input banka
     move konuk-banka     to banka-kodu
     read banka no lock invalid
          move "Tanimsiz" to banka-adi
     end-read
     close banka.
     
     open input doviz
     move konuk-doviz     to doviz-kodu 
     read doviz no lock invalid
          move "Tanimsiz" to d-kisa-adi
     end-read
     move d-kisa-adi to oda-dov-adi     
     close doviz.

     if takas-folio > 0 then 
           compute toplam = konuk-oda-tutar + konuk-extbed-tutar +
                      konuk-kahvalti-tutar + konuk-ogle-tutar +
                      konuk-aksam-tutar + konuk-icecek-tutar +
                      konuk-extra-tutar
     move toplam      to toplam-tutar

     compute rom-bakiye-tl = konuk-top-borc - konuk-top-alac
     compute rom-bakiye-dov rounded = rom-bakiye-tl / konuk-kur-degeri

     end-if
     open input kodlar02 odalar.
     move konuk-odeme-tipi        to kodlar02-kodu
     move "B"                     to kodlar02-tipi
     read kodlar02 no lock invalid
          move "Tanimsiz"         to kodlar02-adi
     end-read
     move kodlar02-adi            to odeme-adi.
     
     close odalar kodlar02.
*
 geceleme-bul.

 
         .

************************
*
 Form1-Aft-Routine.
    if ilk-gelis not = 1 CLOSE TAKAS   takas-rez 
    delete file takas takas-rez
    end-if

     .
*
 fgd-Ev-Msg-Begin-Drag.
      initialize st-x st-y   end-x end-y
      move event-data-2 to st-y 
      move event-data-1 to st-x

     .
*
 fgd-Ev-Msg-End-Drag.
      move event-data-2 to end-y 
      move event-data-1 to end-x
     .
*
 fgd-Ev-Cmd-Goto.
     display message box "x     ".
     .


*
 fis-al.
      open i-o genelfis
      initialize genelfis-rec 
      move 2     to genelfis-anahtar
      read genelfis no lock invalid
           display message box "Genel Parametre Tanimsiz..."
                           title "[ Uyari ]"
                           icon 1
               close genelfis
           exit paragraph
      not invalid
          add 1                 to share-no
          rewrite genelfis-rec end-rewrite 
      end-read 
      close genelfis.
*
 form3-Bef-Initdata.
      open input rez
      move takas-rez-no to rez-no 
      read rez no lock invalid continue
      end-read
      close rez


     
     .
*
 form3-Aft-Initdata.
      move 0 to kontrol-ok
      

      initialize bl-deg-ac
      open input rez
          move takas-rez-no to rez-no 
        read rez no lock invalid continue
        end-read
        string rez-odano delimited by size
          " nolu Odada " delimited by size
          rez-adi delimited by  "  "
           " " delimited by size
          rez-soyadi delimited by "  "
          into bl-deg-ac
          display form3
       close rez
      if rez-paylas-oda  > 0 then 
        move 1 to v-ekle v-boz
        move 1 to vis-boz
        else
        move 0 to v-ekle v-boz
        move 0 to vis-boz
      end-if
       display form3





     .
*
 screen2-Ef-1-Aft-Procedure.
    perform oda-kont
     
     .
*
*
 oda-kont.
    
      move yeni-oda to odalar-no 
      open input odalar
     read odalar no lock invalid 
       move 1 to  kontrol-ok
       move "Tanimsiz Oda No " to kontrol-aciklama
     end-read
     if genel-paylas-oda = 1
     if odalar-kapasite < 1 then move 2 to odalar-kapasite
     end-if
     if odalar-kapasite < rez-buyuk + rez-kucuk + rez-free
        move 1 to  kontrol-ok
       move "Oda kapasitesinden buyuk rez " to kontrol-aciklama

     end-if
     else
     move 9 to odalar-kapasite
     end-if

     close odalar
      open input cast arez
      if rez-paylas-oda not = 1 then 
         initialize   cast-rec
          move rez-gir-tar to cast-tarih
           start cast key > cast-anah  invalid continue
              not invalid
               perform until fs-cast = "10"
                read cast next no lock end move "10" to fs-cast
                  not end
                    if cast-tarih >= rez-cik-tar 
                       move "10" to fs-cast
                       exit perform
                    end-if
                     if cast-oda-no  = yeni-oda
                       move cast-rez-no to arez-no
                       read arez no lock invalid stop " " 
                       end-read
                       if arez-cik-tar = cast-tarih
                         continue
                         else
                          move cast-yil to e-yil
                          move cast-ay to e-ay
                          move cast-gun to e-gun
                            move 1 to  kontrol-ok
                          string e-tarih delimited by size
                             "tarihinde oda dolu  Rezno:"  delimited by size
                             arez-no delimited by size
                             " " delimited by  size
                              new-line delimited by size
                             arez-adi delimited by "  "
                             " " delimited by  size
                             arez-soyadi delimited by "  "
                             into  kontrol-aciklama
                           exit perform 
    
                        
                       end-if 
                    end-if
                end-read
               end-perform
           end-start
          else
           initialize   cast-rec  dolu-yat-gun eski-tar
          move rez-gir-tar to cast-tarih
           start cast key > cast-anah  invalid continue
              not invalid
               perform until fs-cast = "10"
                read cast next no lock end move "10" to fs-cast
                  not end
                    if cast-tarih >= rez-cik-tar 
                       move "10" to fs-cast
                       exit perform
                    end-if
                    if eski-tar not = cast-tarih
                        move 0 to  dolu-yat-gun
                        move cast-tarih  to   eski-tar
                    end-if
                         
                     if cast-oda-no  = yeni-oda
                       move cast-rez-no to arez-no
                       read arez no lock invalid stop " " 
                       end-read
                      
                       if arez-cik-tar = cast-tarih
                         continue
                         else
                          if arez-paylas-oda not = 1 then 
                            move cast-yil to e-yil
                          move cast-ay to e-ay
                          move cast-gun to e-gun
                            move 1 to  kontrol-ok
                          string e-tarih delimited by size
                             "tarihinde Paylasimsiz  dolu  Rezno:"  delimited by size
                             arez-no delimited by size
                             " " delimited by  size
                              new-line delimited by size
                             arez-adi delimited by "  "
                             " " delimited by  size
                             arez-soyadi delimited by "  "
                             into  kontrol-aciklama
                           exit perform 


                          else
                          add 1 to dolu-yat-gun
                          if dolu-yat-gun > odalar-kapasite
                                  move cast-yil to e-yil
                                  move cast-ay to e-ay
                                  move cast-gun to e-gun
                                    move 1 to  kontrol-ok
                                  string e-tarih delimited by size
                                     "tarihinde Oda Kapasite Asimi Oda Kapasitesi:"  delimited by size
                                     odalar-kapasite delimited by size
                                     " " delimited by  size
                                      new-line delimited by size
                                     "Toplam Dolu Yatak :" delimited by "  "
                                    
                                     dolu-yat-gun delimited by "  "
                                     into  kontrol-aciklama
                                   exit perform 
                            end-if
                          end-if
                       end-if 
                    end-if
                end-read
               end-perform
           end-start



     end-if
     close cast arez
     if kontrol-ok = 1 then 
         display message box kontrol-aciklama


     end-if
         . 

    
*
 screen2-Pb-1-Ex-Other.
      evaluate key-status

         when 2
           perform oda-kont
            
           if kontrol-ok = 1 
               display message box kontrol-aciklama
             else
              if rez-paylas-oda not = 1
               perform tek-oda-degis
                else
                perform tek-yatak-degis
              end-if
           end-if
          set  exit-pushed to true
      end-evaluate.



*
 tek-oda-degis.
      move yeni-oda to rez-odano
      move odalar-konumu to rez-oda-konumu
      open i-o rez cast

      accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
      accept rez-edit-zaman from time          |                           

      rewrite rez-rec invalid stop " " end-rewrite
      move rez-gir-tar to cast-tarih
      move rez-no to cast-rez-no
      start cast key = CAST-ANAH1 invalid stop " "
        not invalid
          perform until fs-cast = "10"
               read cast next no lock end move "10" to fs-cast
                 not end
                   if rez-no = cast-rez-no 
                       move yeni-oda to cast-oda-no
                       move odalar-konumu to cast-oda-konumu
                       rewrite cast-rec invalid stop " " end-rewrite
                       else
                      move "10" to fs-cast 

                   end-if

               end-read
          end-perform
      end-start
      close rez cast



             .
*
 tek-yatak-degis.
   
       perform  tek-oda-degis.
       move k-kodu-tasi to takas-shareler-k
       move rez-odano to takas-shareler-dno
       open i-o  rez 
       perform share-al
       
       open output takas-shareler  close takas-shareler open i-o takas-shareler
       open i-o cast arez acast konuk
       move rez-no to TAKAS-shareler-rezno
       move rez-gir-tar to s-ilk-tar
       move rez-cik-tar to s-son-tar
       write TAKAS-shareler-rec invalid stop " " end-write
       perform with test after until tum-share-ok = 1
         move 1 to tum-share-ok
         move s-ilk-tar to acast-tarih
         move rez-odano to acast-oda-no
           initialize fs-acast
         start acast key >= aCAST-ANAH2 invalid stop " "
             not invalid
            perform  until fs-acast = "10"
               read acast next no lock end move "10" to fs-acast
                 not end 

                    if acast-tarih >= s-son-tar 
                       move "10" to fs-acast 
                       exit perform cycle
                    end-if
                    if  acast-oda-no not = rez-odano
                         exit perform cycle
                    end-if 
                    move acast-rez-no to arez-no
                    read arez no lock invalid stop " "
                    end-read
                     if arez-durumu  = "S" then
                              exit perform cycle
                      end-if
                    if arez-cik-tar = acast-tarih then 
                      exit perform cycle
                    end-if
                    move arez-no to TAKAS-shareler-rezno
                    read takas-shareler no lock
                       invalid
                          if arez-gir-tar > tarih-tasi 
                             move arez-gir-tar to s-ilk-tar
                             else
                             move tarih-tasi to s-ilk-tar
                          end-if
                          move  arez-cik-tar to s-son-tar
                           move 0 to tum-share-ok
                          write takas-shareler-rec invalid stop " " end-write
                         move rez-sharenum to arez-sharenum
                        
                         rewrite arez-rec invalid stop " " end-rewrite
                         if arez-folio  > 0 then
                           move arez-folio to konuk-folio
                           read konuk no lock invalid stop " " 
                           end-read
                             move rez-sharenum to konuk-sharenum
                            rewrite konuk-rec invalid stop " " end-rewrite
                         end-if
                         initialize cast-rec
                         move arez-no to cast-rez-no
                         start cast key >= cast-anah1   invalid stop " "
                             not invalid
                               perform until fs-cast = "10"
                                 read cast next no lock end move "10" to fs-cast
                                   not end 
                                          if cast-rez-no not = arez-no
                                             move "10" to fs-cast
                                             else
                                              move arez-sharenum to cast-sharenum
                                              rewrite cast-rec invalid stop " " end-rewrite

                                          end-if
                                  end-read
                               end-perform 
                          end-start
                    end-read

 


               end-read
            end-perform 
        end-start
       end-perform
      
       close cast arez acast konuk
       initialize takas-shareler
       start takas-shareler key > takas-shareler-anah invalid continue
         not invalid 
           perform until fs-takas-shareler = "10"
                read takas-shareler next no lock end move "10" to fs-takas-shareler
                  not end
                    move takas-shareler-rezno to rez-no 
                    read rez no lock invalid stop " " end-read
                    
                    perform share-koy-kont
                  end-read
           end-perform
       end-start
       close rez   close takas-shareler
       delete file takas-shareler



          .

*
 share-koy-kont.
****** kural .
****** kontrol edilecek rez kaydi cagrýlmadan okunmus ve kaydedilmis olmali
******* arez.lib acast.lib takvim2.lib sel tfd de olmali  rez acik olmali
       
       open i-o arez  acast konu2
       open input takvim2
       initialize ana-oda-verildi arez-rec
        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
        move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
 

      
       initialize ana-oda-verildi acast-rec  share-odalar
         move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
        move rez-sharenum to acast-sharenum
        move tarih-tasi to acast-tarih
             initialize fs-acast
       start acast key >= acast-anah6 
               invalid continue
          not invalid
          perform until fs-acast = "10" 
              read acast next no lock end 
                     move "10" to fs-acast
                 not end
                    if rez-sharenum not = acast-sharenum 
                        move "10" to fs-acast
                        exit perform cycle
                    end-if
                    move acast-rez-no to arez-no 
                    read arez no lock invalid 
                          display message  box "Hata Bakim icin arayiniz Castttt "
                     end-read
                            if arez-durumu  = "S" then
                              exit perform cycle
                            end-if

                             if acast-tarih > son-share-tar
                                move  acast-tarih to son-share-tar
                             end-if
                              if acast-tarih < ilk-share-tar
                                move  acast-tarih to ilk-share-tar
                             end-if

                                perform varying ish from 1 by 1 until ish > sodasay or ish > 20 
                                    if share-oda(ish) = acast-oda-no
                                      exit perform 
                                    end-if
                                end-perform
                                 if ish > sodasay then 
                                     if ish >= 20 then
                                          display message box "20 den fazla oda bagladiniz"
                                       else
                                             move acast-oda-no to share-oda(ish)
                                             move ish to  sodasay
                                            
                                     end-if
                                 end-if
              end-read
          end-perform 
       end-start
       initialize fs-takvim2 takvim2-rec
       move ilk-share-tar to takvim2-anah 
       
       start takvim2 key >= takvim2-anah invalid continue
         not invalid 
         perform until fs-takvim2 = "10"
             read takvim2 next no lock end move "10" to fs-takvim2 
               not end
               if takvim2-anah > son-share-tar 
                   move "10" to fs-takvim2 
                   exit perform cycle
                end-if
             end-read
                perform varying ish  from 1 by 1 until ish > sodasay or ish > 20 
                  initialize ana-oda-verildi acast-rec   fs-acast
                  move takvim2-anah to acast-tarih
                  move rez-sharenum to acast-sharenum
                  move share-oda(ish) to acast-oda-no
                  move high-values to acast-fiyati  acast-buyuk

                  start acast key < acast-anah6 invalid 
                          continue
                     not invalid
                       perform until fs-acast = "10" 
                           read acast previous no lock  
                               end
                                move "10" to fs-acast
                                if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                                  else
                                                  display message box "Hataaaaa"
                                               end-if
                                  end-if
                                not end
        if   takvim2-anah not = acast-tarih  or
             rez-sharenum not = acast-sharenum  or
             share-oda(ish) not = acast-oda-no
               move "10" to fs-acast
                if ana-oda-verildi not = 1 
                  read   acast next no lock 
                  end   display message box "Hataaaaa"
                  exit perform cycle
                  end-read
                      if   takvim2-anah not = acast-tarih  or
                             rez-sharenum not = acast-sharenum  or
                             share-oda(ish) not = acast-oda-no
                          display message box "Share Edilmis kayitlarda kesintisiz konaklama yok" new-line 
                                               "Dikkatinize "
                          if k-kodu-tasi = "X   " or "ASYA" then stop " "  end-if 
                           exit perform cycle
                     end-if
                      move 1 to  ana-oda-verildi
                       if  acast-share not = 0
                            move 0 to acast-share
                          rewrite acast-rec invalid stop " " end-rewrite
                          else

                          display message box "Hataaaaa"
                       end-if
                 end-if
               exit perform cycle
        end-if
                               move acast-rez-no to arez-no
                                move acast-rez-no to arez-no 
                                    read arez no lock invalid 
                                      display message  box "Hata Bakim icin arayiniz Castttt "
                                          end-read
                                            if arez-durumu  = "S" then
                                                  display message box "Silinmis Share gorunuyor"
                                                  exit perform cycle
                                                  
                                            end-if
                                   if arez-cik-tar <= acast-tarih
                                       if  acast-share not = 1
                                            move 1 to acast-share
                                            rewrite acast-rec invalid stop " " end-rewrite
                                       end-if
                                    else
                                        if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                              end-if
                                        else
                                                 if  acast-share not = 1
                                                       move 1 to acast-share
                                                      rewrite acast-rec invalid stop " " end-rewrite
                                                 end-if
                                  end-if
                             end-if

                           end-read
                       end-perform
                  end-start
                end-perform 
        end-perform
      end-start
      initialize arez-rec fs-arez

        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
       start arez key >= aREZ-anah-share invalid continue
          not invalid
          perform until fs-arez = "10" 
              read arez next no lock end 
                       
                     move "10" to fs-arez
                 not end
                    if rez-sharenum not = arez-sharenum  
                     
                            move "10" to fs-arez
                        exit perform cycle
                    end-if
                    if  arez-durumu not = "I"
                       exit perform cycle
                    end-if
                    if arez-cik-tar < tarih-tasi 
                         exit perform cycle
                    end-if
                    if arez-gir-tar <= tarih-tasi
                       move   tarih-tasi to acast-tarih
                       move   arez-no   to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                                      if arez-folio > 0 then 
                                       move arez-folio to konu2-folio
                                       read konu2 no lock invalid continue
                                       not invalid
                                          move acast-share to konu2-share
                                          rewrite konu2-rec invalid continue end-rewrite
                                       end-read

                                     end-if
                             end-if
                             
                       end-read
                        else
                        move   arez-gir-tar  to acast-tarih
                         move   arez-no        to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                               
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                             end-if
                       end-read


                   end-if
              end-read
          end-perform 
       end-start
       read rez no lock invalid 
            stop " " 
       end-read

     close arez acast takvim2 konu2. 

*
 shareli2.
              if  share-edilemez = 1 then 
                    exit paragraph
                   end-if
           initialize xrez-rec 
                  move takas-oda to xrez-odano 
                  move function date-of-integer(takas-gun) to d5
                  add  st-x -2  to ilk-integer giving s5 
                   move function date-of-integer(s5) to d5
                   add  end-x -1 to ilk-integer giving s6 
                   move function date-of-integer(s6) to d6
                   move "0001" to xrez-acenta
                          if d5 >= tarih-tasi and d6 > d5
        
                             move d5 to xrez-gir-tar 
                             move d6 to xrez-cik-tar
        
        
        
                             else
                            move   tarih-tasi to  xrez-gir-tar
                   move tarih-tasi to d6
                   compute s6 = function integer-of-date(d6) + 1
                   move function date-of-integer(s6)  to d6
                   move d6 to  xrez-cik-tar
                          end-if
                  
                        initialize xrez-c-in xrez-folio
                        move high-values to xrez-staf-bos
                        initialize rez-link
                            initialize rlink-rez-no   rlink-gelen-sharenum
                                   move xrez-rec to  rlink-gelen-rec 
                                  
                             call "/asya/ytl/obj/otel/rez.asy" 
                                   using rlink-rez-no rlink-gelen-rec  rlink-gelen-sharenum
                                   on exception 
                                   perform callerr-proc
                                   exit paragraph
                                   not on exception 
                                 cancel "/asya/ytl/obj/otel/rez.asy"
                              end-call

                              .
*
  share-seri-bul.       
                 initialize  share-edilemez 
        
               move function date-of-integer(takas-gun) to d5
                  add  st-x -2  to ilk-integer giving s5 
                   move function date-of-integer(s5) to d5
                   add  end-x -1 to ilk-integer giving s6 
                   move function date-of-integer(s6) to d6
                
                  if d5 >= tarih-tasi and d6 > d5

                     move d5 to xrez-gir-tar 
                     move d6 to xrez-cik-tar



                     else

                   move   tarih-tasi to  xrez-gir-tar
                   move tarih-tasi to d6
                   compute s6 = function integer-of-date(d6) + 1
                   move function date-of-integer(s6)  to d6
                   move d6 to  xrez-cik-tar
                  
                  end-if .
            open i-o cast rez acast arez 
            move xrez-gir-tar to cast-tarih
            move takas-oda  to cast-oda-no
            start cast key >= cast-anah3 invalid continue
              not invalid
                perform until fs-cast = "10"
                  read cast next no lock end move "10" to fs-cast
                    not end

                     if cast-tarih >= xrez-cik-tar or takas-oda  not = cast-oda-no
                         move "10" to fs-cast
                        else
                        
                          move cast-rez-no to rez-no
                          read rez no lock invalid stop " "
                            end-read
                            if rez-durumu = "S" then 
                             exit perform cycle
                            end-if
                            if rez-cik-tar = cast-tarih 
                              exit perform cycle
                            end-if
                            if rez-paylas-oda not = 1 then 
                              move 1 to share-edilemez
                              display message box "Arada Paylasimsiz Konaklama var" new-line 
                                                 rez-adi rez-soyadi
                              exit perform
                            end-if
                            move rez-no to takas-share-bag-rez
                            if  rez-sharenum not  > 0 then
                                  perform fis-al
                                 move share-no to cast-sharenum
                                 rewrite cast-rec invalid stop " " end-rewrite
                                
                                 move share-no to rez-sharenum

                                 accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                                 accept rez-edit-zaman from time          |                           

                                 rewrite rez-rec  invalid stop " " end-rewrite
                                 if rez-folio > 0 then 
                                  move rez-folio to konuk-folio
                                  read konuk no lock invalid stop " " end-read
                                  move  share-no to konuk-sharenum
                                  rewrite konuk-rec  invalid stop " " end-rewrite
                                 end-if
                                 initialize acast-rec
                                 move rez-no to acast-rez-no 
                                 move tarih-tasi to acast-tarih
                                 start acast key >= acast-anah1 invalid continue
                                   not invalid 
                                     perform until fs-acast = "10"
                                       read acast next no lock end move "10" to fs-acast
                                         not end
                                       if acast-rez-no not = rez-no move  "10" to fs-acast 
                                         else 
                                           move    share-no to acast-sharenum
                                           rewrite acast-rec invalid stop " " end-rewrite
                                        end-if
                                        end-read
                                     end-perform
                                 end-start


                            END-if 
                            if  rez-sharenum > 0 then 
                            if XREZ-SHARENUM = 0 
                               move rez-sharenum to xrez-sharenum
                               else
                               move high-values to  xrez-sharenum 
                            end-if
                            end-if
                            
                       |gecmis deðimeyecek

                     end-if
                 end-read
               end-perform
             end-start
             close cast  rez   acast arez
             .




*
 share-al.
       perform fis-al
         move share-no  to rez-sharenum   

         accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
         accept rez-edit-zaman from time          |                           

         rewrite rez-rec invalid stop " " end-rewrite 
        
       open i-o cast 
    

     initialize cast-rec 
     move rez-no                 to cast-rez-no
     if tarih-tasi > rez-gir-tar
       move tarih-tasi to cast-tarih
       else
       move rez-gir-tar to cast-tarih
     end-if
     start cast key not < cast-anah1 invalid
          continue 
     not invalid
     perform with test after until fs-cast = "10"
     read cast next no lock end move "10"  to fs-cast 
     not at end
            if cast-rez-no <> rez-no
                exit perform 
            end-if 
               move share-no to cast-sharenum
               rewrite cast-rec end-rewrite 
     end-read 
     end-perform
     end-start
     close cast.

*
 share-deg.
    
      initialize acast-rec
      
         move tarih-tasi to acast-tarih
     
        move cast-oda-no to acast-oda-no

            
          start acast key >= aCAST-ANAH3 invalid continue
               not invalid
                 perform until fs-acast ="10"
                   read acast next no lock end move "10" to fs-acast
                       not end
                       if acast-oda-no not = cast-oda-no  
                         move "10" to fs-acast
                          else
                                   if  cast-sharenum = acast-sharenum
                                             move xrez-sharenum to acast-sharenum
                                             rewrite acast-rec invalid stop " " end-rewrite
                                              move acast-rez-no to arez-no 
                                              read arez no lock invalid stop " "
                                                exit perform cycle
                                              end-read
                                              if arez-sharenum =  cast-sharenum
                                                 move xrez-sharenum to arez-sharenum
                                                 rewrite arez-rec invalid stop " " end-rewrite
                                                 if arez-folio > 0 then
                                                    
                                                   move arez-folio to konuk-folio
                                                   read konuk no lock invalid stop " " exit perform cycle
                                                   end-read
                                                  
                                                   if konuk-sharenum =  cast-sharenum
                                                         move xrez-sharenum to konuk-sharenum
                                                         rewrite konuk-rec invalid stop " " end-rewrite
                                                   end-if
                                                end-if
                                              end-if
                                   end-if
                       end-if
                   end-read
                end-perform
          end-start

       .
  
*
 shareli1.
                 
                   if  share-edilemez = 1 then 
                    exit paragraph
                   end-if
                  
                  if xrez-sharenum  = 0 or high-values then    
                    perform fis-al
                    move share-no to xrez-sharenum
                  end-if

              
               

                   
                 open i-o cast rez  acast arez konuk  
            initialize cast-rec
            move xrez-gir-tar to cast-tarih
            move takas-oda  to cast-oda-no
            start cast key >= cast-anah3 invalid continue
              not invalid
                perform until fs-cast = "10"
                  read cast next no lock end move "10" to fs-cast
                    not end

                     if cast-tarih >= xrez-cik-tar or takas-oda  not = cast-oda-no
                         move "10" to fs-cast
                        else
                        
                          move cast-rez-no to rez-no
                          read rez no lock invalid stop " "
                            end-read
                            if rez-durumu = "S" then 
                             exit perform cycle
                            end-if
                            if rez-cik-tar = cast-tarih 
                              exit perform cycle
                            end-if
                            if cast-sharenum = 0 then 
                                 perform fis-al
                                 move share-no to cast-sharenum
                                 rewrite cast-rec invalid stop " " end-rewrite
                                 move cast-rez-no to arez-no 
                                 read arez no lock invalid  stop " " exit perform cycle end-read
                                 move share-no to arez-sharenum
                                 rewrite arez-rec  invalid stop " " end-rewrite
                                 if arez-folio > 0 then
                                   
                                  move arez-folio to konuk-folio
                                  read konuk no lock invalid stop " " end-read
                                  move  share-no to konuk-sharenum
                                  rewrite konuk-rec  invalid stop " " end-rewrite
                                 end-if
                                 initialize acast-rec
                                 move arez-no to acast-rez-no 
                                 move tarih-tasi to acast-tarih
                                 start acast key >= acast-anah1 invalid continue
                                   not invalid 
                                     perform until fs-acast = "10"
                                       read acast next no lock end move "10" to fs-acast
                                         not end
                                       if acast-rez-no not = arez-no move  "10" to fs-acast 
                                         else 
                                           move    share-no to acast-sharenum
                                           rewrite acast-rec invalid stop " " end-rewrite
                                        end-if
                                        end-read
                                     end-perform
                                 end-start

                            end-if
                            if cast-sharenum not = xrez-sharenum
                                
                               perform share-deg
                            end-if
                            
                            
                       |gecmis deðimeyecek

                     end-if
                 end-read
               end-perform
             end-start
           

              initialize rez-rec 
                 move takas-share-bag-rez to rez-no
                 read rez no lock 
                 invaliD display message box "Hata 258933633"
                    exit paragraph
                 end-read
               
                 
                  move 1 to rez-paylas-oda
                 
                  if rez-folio > 0 then 
                 
                        move rez-folio to konuk-folio
                        read konuk no lock invalid stop "  "
                        not invalid
                            move 1  to konuk-paylas-oda
                            move REZ-SHARENUM to konuk-sharenum
                            rewrite konuk-rec invalid stop " " end-rewrite
                        end-read
                  

                  end-if
                  CLOSE REZ cast arez acast konuk
                
               
                 move  rez-rec to xrez-rec
                  move function date-of-integer(takas-gun) to d5
                  add  st-x -2  to ilk-integer giving s5 
                   move function date-of-integer(s5) to d5
                   add  end-x -1 to ilk-integer giving s6 
                   move function date-of-integer(s6) to d6
                   move "0001" to xrez-acenta
                  if d5 >= tarih-tasi and d6 > d5

                     move d5 to xrez-gir-tar 
                     move d6 to xrez-cik-tar



                     else

                   move   tarih-tasi to  xrez-gir-tar
                   move tarih-tasi to d6
                   compute s6 = function integer-of-date(d6) + 1
                   move function date-of-integer(s6)  to d6
                   move d6 to  xrez-cik-tar
                  
                  end-if
                           move tarih-tasi to xrez-al-tar
                           move 0 to xrez-buyuk xrez-kucuk xrez-free xrez-bebek
                           xrez-fiyati
                           initialize xrez-c-in xrez-folio
                           initialize rez-link
                            initialize rlink-rez-no   rlink-gelen-sharenum
                                   move xrez-rec to  rlink-gelen-rec
                                 
                                  MOVE XREZ-SHARENUM TO  rlink-gelen-sharenum
                                 
                             call "/asya/ytl/obj/otel/rez.asy" 
                                   using rlink-rez-no rlink-gelen-rec  rlink-gelen-sharenum
                                   on exception 
                                   perform callerr-proc
                                   exit paragraph
                                   not on exception 
                                 cancel "/asya/ytl/obj/otel/rez.asy"
                              end-call
                   .

 
