* formul.evt
* formul.evt is generated from D:\asya\acugt.ytl\otel\formul.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form2-Lb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Dblclick
           PERFORM Listbox-Eventlar
        WHEN Cmd-Goto
           PERFORM Listbox-Eventlar
        WHEN Ntf-Selchange
           PERFORM Listbox-Eventlar
        END-EVALUATE
     END-IF
     .

 Form1-Gd-1-Event-Proc.
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     call "c$narg" using link-var.
     perform adresleri-tasi.

 listbox-eventlar.
     evaluate event-type
          when cmd-dblclick
               inquire form2-lb-1,
                       value in form2-lb-1-value
               move 4 to accept-control
               move 18 to control-id
               exit paragraph
          when ntf-selchange
          when cmd-goto
               inquire form2-lb-1,value in form2-lb-1-value
               inquire form2-lb-1,selection-index in secili-satir
     end-evaluate.
*
 Form1-Ex-Other.
     evaluate key-status
         when 17 
             move formul-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of formul-rec
             set link-logview-rec-size to size of formul-rec
             perform logview-call
             initialize key-status
     when 1
       if control-id = 16 
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
                 on exception perform callerr-proc
                 not on exception
                 cancel "/asya/ytl/obj/otel/acenara.asy" 
             end-call
             move acenta-cagir     to acc-1-val
             display acc-1
             move 4  to accept-control
             move 16 to control-id          
             perform acenta-oku
       end-if
     when 3003
        perform siralama-kaydet
     when 3004
          modify form2-lb-1,query-index = secili-satir
          inquire form2-lb-1,item-value in form2-lb-1-value
          if lb-2-col-3 not = "K"
             modify form2-lb-1,query-index = secili-satir
             inquire form2-lb-1,item-value in form2-lb-1-value
             move "K"          to lb-2-col-3
             modify form2-lb-1, item-to-delete(secili-satir)
             modify form2-lb-1, insertion-index = secili-satir
                                item-to-add(form2-lb-1-value)    
          else
             modify form2-lb-1,query-index = secili-satir
             inquire form2-lb-1,item-value in form2-lb-1-value
             move " "          to lb-2-col-3
             modify form2-lb-1, item-to-delete(secili-satir)
             modify form2-lb-1, insertion-index = secili-satir
                                item-to-add(form2-lb-1-value)               
          end-if 
     when 3001
          inquire form2-lb-1,
                  selection-index in i
          if i < 2 
             exit paragraph
          end-if
          modify form2-lb-1,query-index = i - 1
          inquire form2-lb-1,item-value in form2-lb-1-value
          modify form2-lb-1, item-to-delete(i - 1)
          modify form2-lb-1, insertion-index = i
                             item-to-add(form2-lb-1-value)    
           perform ornek-goster
     when 3002
          inquire form2-lb-1,
                  selection-index in i
          if i = 13
             exit paragraph
          end-if
          modify  form2-lb-1, query-index = i + 1
          inquire form2-lb-1, item-value in form2-lb-1-value
          modify  form2-lb-1, item-to-delete(i + 1)
          modify  form2-lb-1, insertion-index = i
                              item-to-add(form2-lb-1-value)
         perform ornek-goster
     when 3005
          open i-o acenta formul
          initialize acenta-rec 
          move acc-1-val to acenta-kodu 
          read acenta no lock invalid
               display message box "Tanimsiz acenta kodu silme islemi iptal edilecektir.."
               close acenta formul
               exit paragraph
          end-read
          initialize formul-rec 
          move acc-1-val to formul-acenta
          move acc-3-val to formul-sira 
          read formul no lock invalid
               display message box "Kayitli formul bulunamadi.."
               close acenta formul
               exit paragraph
          not invalid
              display message box acenta-adi, "- acentasinin ", acc-3-val, "- sirasinda ki formulu silinecektir."new-line
                                  "Emin misiniz...?"
                            title "[Bildirim]"
                             type 2
                             icon 2
                        returning return-code
              if return-code = 2
                 display message box "Islem Iptal edildi.." 
                 close acenta formul
                 exit paragraph
              else
                 delete formul end-delete
                 display message box "Silme islemi tamamlandi.." 
                 perform log-operation-formul
              end-if
          end-read
          close acenta formul
     when 3006
          perform raporla
     when 3007
          perform kumule-bakim-yap     ||firat 12/11/2019 kümüle bakýmý için yapýldý
     end-evaluate     
     .
*
 siralama-kaydet.    
     display message box "Formul Kaydedilecek Eminmisiniz..."
                     title "[ Uyari ]"
                     icon 1
                     type 2
                     default 2
                     returning donus
     if donus = 2
        exit paragraph
     end-if
     if bas-tar not = zeroes 
        open input takvim
        initialize takvim-rec
        move bas-tar      to takvim-anah
        read takvim no lock invalid
             display message box "Hatali Baslangic Tarihi Girdiniz..."
                             title "Uyari"
                             icon 1
             close takvim
             exit paragraph 
        end-read
        close takvim
     end-if 
     if bit-tar not = zeroes 
        open input takvim
        initialize takvim-rec
        move bit-tar      to takvim-anah
        read takvim no lock invalid
             display message box "Hatali Bitis Tarihi Girdiniz..."
                             title "Uyari"
                             icon 1
             close takvim
             exit paragraph 
        end-read
        close takvim
     end-if 

     open i-o formul
     initialize formul-rec i
     move acc-1-val           to formul-anah
     move acc-3-val           to formul-sira 
     read formul no lock invalid
          initialize formul-rec 
     end-read
        move acc-1-val           to formul-anah
        move acc-3-val           to formul-sira
        move bas-tar             to formul-bas-tar
        move bit-tar             to formul-bit-tar
        move sec(1:1)            to formul-tip
        perform varying i
                  from 1
                  by 1
                  until i > 13
                         initialize form2-lb-1-value
                         inquire form2-lb-1(i), item-value in form2-lb-1-value                         
                         evaluate lb-2-col-2
                         when "OZEL INDIRIM"                            
                             move i       to  formul-ind-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-ind-kumule
                             else
                                move 0    to formul-ind-kumule
                             end-if 
                         when "EB INDIRIMI"
                             move i       to  formul-eb-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-eb-kumule
                             else
                                move 0    to formul-eb-kumule
                             end-if 
                         when "UZUN GECELEME"
                             move i       to  formul-ug-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-ug-kumule
                             else 
                                move 0    to formul-ug-kumule
                             end-if 
                         when "OZEL DURUM INDIRIMI"
                             move i       to  formul-ozl-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-ozl-kumule
                             else 
                                move  0   to formul-ozl-kumule
                             end-if 
                         when "AKSIYON 1"                                 
                             move i       to  formul-aks1-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-aks1-kumule
                             else
                                move  0   to formul-aks1-kumule
                             end-if 
                         when "AKSIYON 2"
                             move i       to  formul-aks2-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-aks2-kumule
                             else
                                move 0    to formul-aks2-kumule
                             end-if 
                         when "SPECIAL OFFER 1"
                             move i       to  formul-so1-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-so1-kumule
                             else
                                move 0    to formul-so1-kumule
                             end-if 
                         when "SPECIAL OFFER 2"
                             move i       to  formul-so2-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-so2-kumule
                             else
                                move 0    to formul-so2-kumule
                             end-if 
                         when "KATALOG KATKI PAYI"
                             move i       to  formul-kkp-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-kkp-kumule
                             else
                                move 0    to formul-kkp-kumule
                             end-if 
                         when "KICK BACK"
                             move i       to  formul-kb-sira
                             if lb-2-col-3 = "K"
                                move 1    to  formul-kb-kumule
                             else
                                move 0    to formul-kb-kumule
                             end-if 
                         when "--Fat.Matrah-" 
                               move i       to  formul-fm-sira
                              
                         when "--MO.Matrah-"  
                               move i       to  formul-mo-sira
                              
                         when "KOMISYON"
                             move i         to  formul-kom-sira
                             if lb-2-col-3 = "K"
                                move 1    to formul-kom-kumule
                             else
                                move 0    to formul-kom-kumule
                             end-if 
                         end-evaluate

        write formul-rec invalid 
            rewrite formul-rec end-rewrite 
        end-write        

        perform log-operation-formul

        end-perform
     close formul
     modify Form2-Lb-1, RESET-LIST = 1
     initialize bas-tar bit-tar sec
     display acc-4 acc-5 acc-6 acc-7 acc-8 acc-9 cb-secenek
     move 4  to accept-control
     move 16 to control-id

     .
*
 acenta-oku.     
     open input acenta 
     initialize acenta-rec
     
     move acc-1-val           to acenta-kodu
     if acenta-kodu = spaces 
       move "OTEL DEFAULT"   to acc-2-val
       else
     read acenta no lock invalid
          move 4  to accept-control
           move 16 to control-id
          move "Tanimsiz Acenta Adi..."  to acc-2-val
          not invalid
          move acenta-adi                 to acc-2-val
     end-read
        
      end-if
     close acenta
     display acc-2
       .
*
 acc-1-Aft-Procedure.
     perform acenta-oku
     perform siralama-oku     
     .
*
 goster.
     move formul-bas-tar          to bas-tar
     move formul-bit-tar          to bit-tar
     move formul-tip              to sec 
           perform varying i 
                    from 1
                    by 1
                    until i > 13
                      initialize form2-lb-1-value
                      evaluate true 
                      when i = formul-ind-sira
                          move i                             to lb-2-col-1
                          move "OZEL INDIRIM"                to lb-2-col-2
                          if formul-ind-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-eb-sira
                          move i                             to lb-2-col-1
                          move "EB INDIRIMI"                 to lb-2-col-2
                          if formul-eb-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-ug-sira
                          move i                             to lb-2-col-1
                          move "UZUN GECELEME"               to lb-2-col-2
                          if formul-ug-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-ozl-sira
                          move i                             to lb-2-col-1
                          move "OZEL DURUM INDIRIMI"         to lb-2-col-2
                          if formul-ozl-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-aks1-sira
                          move i                             to lb-2-col-1
                          move "AKSIYON 1"                   to lb-2-col-2
                          if formul-aks1-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-aks2-sira
                          move i                             to lb-2-col-1
                          move "AKSIYON 2"                   to lb-2-col-2
                          if formul-aks2-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-so1-sira
                          move i                             to lb-2-col-1
                          move "SPECIAL OFFER 1"             to lb-2-col-2
                          if formul-so1-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-so2-sira
                          move i                             to lb-2-col-1
                          move "SPECIAL OFFER 2"             to lb-2-col-2
                          if formul-so2-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-kkp-sira
                          move i                             to lb-2-col-1
                          move "KATALOG KATKI PAYI"          to lb-2-col-2
                          if formul-kkp-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-kom-sira
                          move i                             to lb-2-col-1
                          move "KOMISYON"                    to lb-2-col-2
                          if formul-kom-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)


                     when i = formul-kb-sira
                          move i                             to lb-2-col-1
                          move "KICK BACK"            to lb-2-col-2
                          if formul-kb-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-fm-sira
                          move i                             to lb-2-col-1
                          move "--Fat.Matrah-"          to lb-2-col-2
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      when i = formul-mo-sira
                          move i                             to lb-2-col-1
                          move "--MO.Matrah-"                  to lb-2-col-2
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)

                        
                      end-evaluate
                end-perform 
                      if formul-ind-sira <  1
                          move 0                             to lb-2-col-1
                          move "OZEL INDIRIM"                to lb-2-col-2
                          if formul-ind-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 

                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      end-if
                      if formul-eb-sira <  1
                          move 0                             to lb-2-col-1
                          move "EB INDIRIMI"                 to lb-2-col-2
                          if formul-eb-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                     end-if
                      if formul-ug-sira <  1
                          move 0                             to lb-2-col-1
                          move "UZUN GECELEME"               to lb-2-col-2
                          if formul-ug-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                     end-if
                      if formul-ozl-sira <  1
                          move 0                            to lb-2-col-1
                          move "OZEL DURUM INDIRIMI"         to lb-2-col-2
                          if formul-ozl-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      end-if
                      if formul-aks1-sira <  1
                          move 0                         to lb-2-col-1
                          move "AKSIYON 1"                   to lb-2-col-2
                          if formul-aks1-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      end-if
                      if formul-aks2-sira <  1
                          move 0                          to lb-2-col-1
                          move "AKSIYON 2"                   to lb-2-col-2
                          if formul-aks2-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                       end-if
                      if formul-so1-sira <  1
                          move 0                            to lb-2-col-1
                          move "SPECIAL OFFER 1"             to lb-2-col-2
                          if formul-so1-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                      end-if
                      if formul-so2-sira <  1
                          move 0                                to lb-2-col-1
                          move "SPECIAL OFFER 2"             to lb-2-col-2
                          if formul-so2-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                       end-if
                      if formul-kkp-sira <  1
                          move 0                              to lb-2-col-1
                          move "KATALOG KATKI PAYI"          to lb-2-col-2
                          if formul-kkp-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                       end-if
                      if formul-kom-sira <  1
                          move 0                               to lb-2-col-1
                          move "KOMISYON"                    to lb-2-col-2
                          if formul-kom-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)                          
                      end-if
                      if formul-kb-sira <  1
                          move 0                             to lb-2-col-1
                          move "KICK BACK"            to lb-2-col-2
                          if formul-kb-kumule = 1
                             move "K"                        to lb-2-col-3
                          else
                             move " "                        to lb-2-col-3
                          end-if 
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                       end-if
                      if formul-fm-sira <  1
                          move 0                              to lb-2-col-1
                          move "--Fat.Matrah-"          to lb-2-col-2
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                       end-if
                      if formul-mo-sira <  1
                          move 0                            to lb-2-col-1
                          move "--MO.Matrah-"                  to lb-2-col-2
                          modify Form2-Lb-1, ITEM-TO-ADD(form2-lb-1-value)
                         
                      end-if.

*
 siralama-oku.
     modify Form2-Lb-1, RESET-LIST = 1
     open input formul
     initialize formul-rec i 
     move acc-1-val        to formul-anah
     move acc-3-val        to formul-sira
     read formul no lock invalid
       initialize formul-anah
       read formul no lock invalid          
           perform default-siralama-yukle
       not invalid
           perform goster
       end-read
     not invalid        
           perform goster         
     end-read
           perform ornek-goster
     close formul
     display acc-4 acc-5 acc-6 acc-7 acc-8 acc-9 cb-secenek.
*
 default-siralama-yukle.
     modify Form2-Lb-1, RESET-LIST = 1                        
     initialize i
     perform varying i
               from 1
               by 1
               until i > 13
                 move i                        to lb-2-col-1

                 evaluate i
                 when 1
                    move "OZEL INDIRIM"        to lb-2-col-2
                 when 2
                    move "EB INDIRIMI"         to lb-2-col-2
                 when 3
                    move "UZUN GECELEME"       to lb-2-col-2
                 when 4
                    move "OZEL DURUM INDIRIMI" to lb-2-col-2
                 when 5
                    move "AKSIYON 1"           to lb-2-col-2
                 when 6
                    move "AKSIYON 2"           to lb-2-col-2
                 when 7
                    move "SPECIAL OFFER 1"     to lb-2-col-2
                 when 8
                    move "SPECIAL OFFER 2"     to lb-2-col-2
                 when 9
                    move "KATALOG KATKI PAYI"  to lb-2-col-2
                 when 10 
                    move "KICK BACK"           to lb-2-col-2
                 when 11 
                    move "--Fat.Matrah-"       to lb-2-col-2 
                 when 12 
                    move "--MO.Matrah-"        to lb-2-col-2
                 when 13
                    move "KOMISYON"            to lb-2-col-2
                   
                 end-evaluate
                 move " "                      to lb-2-col-3
                 modify Form2-Lb-1,ITEM-TO-ADD(Form2-Lb-1-Value)
                
     end-perform
      perform ornek-goster
     .
*
 Form1-Aft-Initdata.
     open i-o formul close formul
     initialize ornek-rec
     move "Ornek " to ornek-2
     move "Fark" to  ornek-3
     move "Kalan " to ornek-4
     modify ornek-gd(1) record-data = ornek-rec
     initialize ornek-rec
     move "Ham Fiyat" to ornek-1
     move 100  to    ornek-ham
     move ornek-ham   to z-tut
     move z-tut to ornek-2
    
     move z-tut to ornek-4
    
     modify ornek-gd(2) record-data = ornek-rec 
     if link-var = 1
        move link-acenta to acc-1-val
        display acc-1
        perform acc-1-Aft-Procedure
        
        move 4 to accept-control
        move 5 to control-id
     end-if
     if k-kodu-tasi <> "ASYA" 
        modify button-0213, visible = 0
     end-if
*     if k-kodu-tasi = "ASYA" or "X   "           ||firat 12/11/2019 kümüle bakýmý için yapýldý
*        modify button-0215, visible = 1
*                            enabled = 1
*     end-if
     .

*
 ornek-goster.
      move ornek-ham          to son-fiyat 
      perform varying i
                  from 1
                  by 1
                  until i > 13
                         inquire form2-lb-1(i), item-value in form2-lb-1-value                         
                         evaluate lb-2-col-2
                         when "OZEL INDIRIM"
                             initialize ornek-rec 
                             compute ara-fiyat rounded = son-fiyat * (100 - 10)  / 100
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                            
                             move lb-2-col-2 to ornek-1
                             move 10   to z-ind
                             move z-ind    to ornek-2
                            modify ornek-gd(i + 2) record-data = ornek-rec 
                         when "EB INDIRIMI"
                             move i       to  formul-eb-sira
                              initialize ornek-rec 
                              compute ara-fiyat rounded = son-fiyat * (100 - 12.5)  / 100
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move lb-2-col-2 to ornek-1
                             move 12.5   to z-ind 
                             move z-ind     to ornek-2
                            modify ornek-gd(i + 2) record-data = ornek-rec 
                         when "UZUN GECELEME"
                             move i       to  formul-ug-sira
                              initialize ornek-rec
                               compute ara-fiyat rounded = son-fiyat * (100 - 21)  / 100
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4  
                              move lb-2-col-2 to ornek-1
                             move 21   to z-ind 
                             move z-ind     to ornek-2
                            modify ornek-gd(i + 2) record-data = ornek-rec 
                         when "OZEL DURUM INDIRIMI"
                             move i       to  formul-ozl-sira
                             initialize ornek-rec 
                              compute ara-fiyat rounded = son-fiyat * ( 91.25 )  / 100
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move lb-2-col-2 to ornek-1
                             move 91.25   to z-ozel
                             move z-ozel     to ornek-2
                            modify ornek-gd(i + 2) record-data = ornek-rec 


                         when "AKSIYON 1"                                 
                             move i       to  formul-aks1-sira

                              initialize ornek-rec 
                               compute ara-fiyat rounded = son-fiyat * (100 - 15)  / 100
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move lb-2-col-2 to ornek-1
                             move "%15"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 
                         when "AKSIYON 2"
                             move i       to  formul-aks2-sira
                             initialize ornek-rec 
                              compute ara-fiyat rounded = son-fiyat * (6/7 )
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                             move lb-2-col-2 to ornek-1
                              move "7=6"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 

                         when "SPECIAL OFFER 1"
                              move i       to  formul-so1-sira
                              initialize ornek-rec 
                               compute ara-fiyat rounded = son-fiyat - 3

                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move lb-2-col-2 to ornek-1
                              move "3"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 

                         when "SPECIAL OFFER 2"
                             move i       to  formul-so2-sira
                              initialize ornek-rec 
                               compute ara-fiyat rounded = son-fiyat - 5
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move lb-2-col-2 to ornek-1
                              move "5"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 
                         when "KATALOG KATKI PAYI"
                             move i       to  formul-kkp-sira
                               initialize ornek-rec 
                                compute ara-fiyat rounded = son-fiyat * (1000 - 3)  / 1000
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                               move lb-2-col-2 to ornek-1
                              move "3"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 

                         when "KICK BACK"  
                              move i       to  formul-kb-sira
                              initialize ornek-rec 
                               compute ara-fiyat rounded = son-fiyat * (1000 - 5)  / 1000
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move lb-2-col-2 to ornek-1
                              move "5"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 

                         when "--Fat.Matrah-" 
                             move i       to  formul-fm-sira
                              initialize ornek-rec 
                              move lb-2-col-2 to ornek-1
                              move son-fiyat to z-tut
                              move z-tut     to ornek-4
                             move "--------"    to ornek-2 ornek-3
                             modify ornek-gd(i + 2) record-data = ornek-rec 
                         when "--MO.Matrah-" 
                             move i       to  formul-mo-sira
                               initialize ornek-rec
                               move lb-2-col-2 to ornek-1
                               move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move "--------"    to ornek-2 ornek-3
                             modify ornek-gd(i + 2) record-data = ornek-rec    
                         
                  
                             
                         when "KOMISYON"
                             move i       to  formul-kom-sira
                                initialize ornek-rec 
                                move lb-2-col-2 to ornek-1
                                    compute ara-fiyat rounded = son-fiyat * (100 - 10)  / 100
                             compute ind-fiyat =  ara-fiyat - son-fiyat
                             move ara-fiyat to son-fiyat
                             move ind-fiyat to z-ind
                             move z-ind     to ornek-3
                             move son-fiyat to z-tut
                              move z-tut     to ornek-4
                              move "10"    to ornek-2
                             modify ornek-gd(i + 2) record-data = ornek-rec 
                         end-evaluate
          end-perform
            .
*
 Raporla.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer

*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                    to det-dokumer-20(1:)
     move "Formul Hesaplama Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "B"                    to det-dokumer-20(1:)
     move "Formul Hesaplama Raporu" to det-filler
     write dokumer-rec from detay
     initialize dokumer-rec detay
     move "B"                    to det-dokumer-20(1:)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O"                    to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LRRLLLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR 
     initialize dokumer-rec detay
     move "D1"                  to det-dokumer-20(1:)     
     move "AKodu"               to det-1
     move "Acenta Adi"          to det-2
     move "Sr"                  to det-3
     move "Bas Tarihi"          to det-4 
     move "Bit Tarihi"          to det-5 
     move "T Baz"               to det-6 
     move "Sira 1"              to det-8 
     move "Sira 2"              to det-10 
     move "Sira 3"              to det-12 
     move "Sira 4"              to det-14 
     move "Sira 5"              to det-16 
     move "Sira 6"              to det-18 
     move "Sira 7"              to det-20 
     move "Sira 8"              to det-22 
     move "Sira 9"              to det-24 
     move "Sira 10"             to det-26 
     move "Sira 11"             to det-28 
     move "Sira 12"             to det-30 
     move "Sira 13"             to det-32 
     move "K"                   to det-7  det-9  det-11 det-13 det-15
                                   det-17 det-19 det-21 det-23 det-25
                                   det-27 det-29 det-31  
     move all "|" to fil-1  fil-2  fil-3  fil-4  fil-5  
                     fil-6  fil-7  fil-8  fil-9  fil-10 
                     fil-11 fil-12 fil-13 fil-14 fil-15  
                     fil-16 fil-17 fil-18 fil-19 fil-20 
                     fil-21 fil-22 fil-23 fil-24 fil-25  
                     fil-26 fil-27 fil-28 fil-29 fil-30 
                     fil-31 fil-32
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"         to det-dokumer-20(1:)     
     move "-"          to det-dokumer-20(5:1)
     move all "-" to det-1  det-2  det-3  det-4  det-5  
                     det-6  det-7  det-8  det-9  det-10 
                     det-11 det-12 det-13 det-14 det-15
                     det-16 det-17 det-18 det-19 det-20 
                     det-21 det-22 det-23 det-24 det-25
                     det-26 det-27 det-28 det-29 det-30
                     det-31 det-32
     write dokumer-rec from detay

     open i-o formul
     open input acenta
     initialize formul-rec  
     if acc-1-val <> spaces
        move acc-1-val to formul-acenta  
     end-if
     if acc-3-val <> spaces
        move acc-3-val to formul-sira
     end-if
     start formul key not < formul-anahtar invalid
           continue
     not invalid
     perform with test after until fs-formul = "10"
     read formul next no lock end move "10" to fs-formul
     not at end

         if acc-1-val <> spaces and formul-acenta
            exit perform  
         end-if
         if acc-3-val <> spaces and formul-sira
            exit perform cycle
         end-if

         initialize acenta-rec 
         move formul-acenta to acenta-kodu 
         read acenta no lock invalid
              move "*************" to acenta-adi
         end-read 

         initialize dokumer-rec detay
         move acenta-kodu to det-1 
         move acenta-adi  to det-2 
         move formul-sira to det-3

         move formul-bas-tar(7:2) to det-4(1:)
         move "/"                 to det-4(3:)
         move formul-bas-tar(5:2) to det-4(4:)
         move "/"                 to det-4(6:)
         move formul-bas-tar(1:4) to det-4(7:)

         move formul-bit-tar(7:2) to det-5(1:)
         move "/"                 to det-5(3:)
         move formul-bit-tar(5:2) to det-5(4:)
         move "/"                 to det-5(6:)
         move formul-bit-tar(1:4) to det-5(7:)

         if formul-tip = "S"
            move "Satis" to det-6
         else
            move "Giris" to det-6
         end-if

         perform varying fi from 1 by 1 until fi > 13
            initialize det-ind det-ind-kum
            evaluate fi
                when formul-ind-sira
                     move "OZEL INDIRIM"        to det-ind
                     if formul-ind-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-eb-sira
                     move "EB INDIRIMI"         to det-ind
                     if formul-eb-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-ug-sira
                     move "UZUN GECELEME"       to det-ind  
                     if formul-ug-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-ozl-sira
                     move "OZEL DUR IND" to det-ind
                     if formul-ozl-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-aks1-sira
                     move "AKSIYON 1"           to det-ind
                     if formul-aks1-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-aks2-sira
                     move "AKSIYON 2"           to det-ind
                     if formul-aks2-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-so1-sira
                     move "SPEC OFFER 1"     to det-ind
                     if formul-so1-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-so2-sira
                     move "SPEC OFFER 2"     to det-ind
                     if formul-so2-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-kkp-sira
                     move "KAT. K PAYI"  to det-ind
                     if formul-kkp-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-kb-sira
                     move "KICK BACK"           to det-ind
                     if formul-kb-kumule = 1
                        move "K" to det-ind-kum
                     end-if
                when formul-fm-sira        
                     move "--Fat.Matrah-"       to det-ind 
                when formul-mo-sira       
                     move "--MO.Matrah-"        to det-ind 
                when formul-kom-sira
                     move "KOMISYON"            to det-ind
                     if formul-kom-kumule = 1
                        move "K" to det-ind-kum
                     end-if
            end-evaluate
            evaluate fi
                when 1
                     move det-ind-kum to det-7
                     move det-ind     to det-8
                when 2
                     move det-ind-kum to det-9
                     move det-ind     to det-10
                when 3
                     move det-ind-kum to det-11
                     move det-ind     to det-12
                when 4
                     move det-ind-kum to det-13
                     move det-ind     to det-14
                when 5
                     move det-ind-kum to det-15
                     move det-ind     to det-16
                when 6
                     move det-ind-kum to det-17
                     move det-ind     to det-18
                when 7
                     move det-ind-kum to det-19
                     move det-ind     to det-20
                when 8
                     move det-ind-kum to det-21
                     move det-ind     to det-22
                when 9
                     move det-ind-kum to det-23
                     move det-ind     to det-24
                when 10
                     move det-ind-kum to det-25
                     move det-ind     to det-26
                when 11
                     move det-ind-kum to det-27
                     move det-ind     to det-28
                when 12
                     move det-ind-kum to det-29
                     move det-ind     to det-30
                when 13
                     move det-ind-kum to det-31
                     move det-ind     to det-32
            end-evaluate
         end-perform 

         write dokumer-rec from detay

     end-read 
     end-perform 
     end-start 
     close formul acenta

     initialize dokumer-rec detay
     move "-"          to det-dokumer-20(5:1)
     move all "-" to det-1  det-2  det-3  det-4  det-5  det-6  det-7
                     det-8  det-9  det-10 det-11 det-12 det-13 det-14
                     det-15
     write dokumer-rec from detay

     close dokumer
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     delete file dokumer.                             
*
 kumule-bakim-yap.
     stop " " 
     open i-o formul 
     initialize formul-rec 
     start formul key not < formul-anah invalid
           continue
     not invalid
     perform with test after until fs-formul = "10"
     read formul next no lock end move "10" to fs-formul
     not at end       
         if formul-acenta = "0080" stop " " end-if

         initialize sira-tablo
         perform kumule-bas-sira-bul
         if kumule-basla-sira < 1
            exit perform cycle
         else
            perform kumuleler-oncesi-sirala
            perform kumuleler-sirala
            perform kumuleler-sonrasi-sirala
         end-if 

         if ind-sira = 0 or eb-sira = 0 or ug-sira = 0 or
            ozl-sira = 0 or aks1-sira = 0 or aks2-sira = 0 or
            so1-sira = 0 or so2-sira = 0 or kkp-sira = 0 or
            kb-sira = 0 or kom-sira = 0 or fm-sira = 0 or
            mo-sira = 0 
            stop " " 
         end-if
         move ind-sira  to formul-ind-sira
         move eb-sira   to formul-eb-sira
         move ug-sira   to formul-ug-sira
         move ozl-sira  to formul-ozl-sira
         move aks1-sira to formul-aks1-sira
         move aks2-sira to formul-aks2-sira
         move so1-sira  to formul-so1-sira
         move so2-sira  to formul-so2-sira
         move kkp-sira  to formul-kkp-sira
         move kb-sira   to formul-kb-sira
         move kom-sira  to formul-kom-sira
         move fm-sira   to formul-fm-sira       
         move mo-sira   to formul-mo-sira     
         rewrite formul-rec invalid
                 stop " "
         end-rewrite 

     end-read
     end-perform 
     end-start
     close formul
     .
*
 kumule-bas-sira-bul.
     initialize kumule-basla-sira
     perform varying i from 1 by 1 until i > 13
        evaluate i
            when formul-ind-sira  
                 if formul-ind-kumule = 1 
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-eb-sira
                 if formul-eb-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-ug-sira
                 if formul-ug-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-ozl-sira
                 if formul-ozl-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-aks1-sira
                 if formul-aks1-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-aks2-sira
                 if formul-aks2-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-so1-sira
                 if formul-so1-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-so2-sira
                 if formul-so2-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-kkp-sira
                 if formul-kkp-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-kb-sira
                 if formul-kb-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
            when formul-kom-sira
                 if formul-kom-kumule = 1
                    move i to kumule-basla-sira
                    exit perform
                 end-if
        end-evaluate
     end-perform 
     .
*
 kumuleler-oncesi-sirala.
     initialize kumule-sira
     move 1  to kumule-sira
     perform varying i from 1 by 1 until i = kumule-basla-sira

        evaluate i
            when formul-ind-sira
                 if formul-ind-kumule = 0
                    move kumule-sira to ind-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-eb-sira
                 if formul-eb-kumule = 0
                    move kumule-sira to eb-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-ug-sira
                 if formul-ug-kumule = 0
                    move kumule-sira to ug-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-ozl-sira
                 if formul-ozl-kumule = 0
                    move kumule-sira to ozl-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-aks1-sira
                 if formul-aks1-kumule = 0
                    move kumule-sira to aks1-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-aks2-sira
                 if formul-aks2-kumule = 0
                    move kumule-sira to aks2-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-so1-sira
                 if formul-so1-kumule = 0
                    move kumule-sira to so1-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-so2-sira
                 if formul-so2-kumule = 0
                    move kumule-sira to so2-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-kkp-sira
                 if formul-kkp-kumule = 0
                    move kumule-sira to kkp-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-kb-sira
                 if formul-kb-kumule = 0
                    move kumule-sira to kb-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-kom-sira
                 if formul-kom-kumule = 0
                    move kumule-sira to kom-sira
                     add 1           to kumule-sira 
                 end-if
            when formul-fm-sira        
            when formul-mo-sira       
                 continue
        end-evaluate
     end-perform 
     if kumule-sira not = kumule-basla-sira 
        continue
     end-if
     .

*
 kumuleler-sirala.
         perform varying i from kumule-basla-sira by 1 until i > 13
            evaluate i
                when formul-ind-sira
                     if formul-ind-kumule = 1
                        move kumule-sira to ind-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-eb-sira
                     if formul-eb-kumule = 1
                        move kumule-sira to eb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ug-sira
                     if formul-ug-kumule = 1
                        move kumule-sira to ug-sira               
                         add 1           to kumule-sira 
                     end-if
                when formul-ozl-sira
                     if formul-ozl-kumule = 1
                        move kumule-sira to ozl-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks1-sira
                     if formul-aks1-kumule = 1
                        move kumule-sira to aks1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks2-sira
                     if formul-aks2-kumule = 1
                        move kumule-sira to aks2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so1-sira
                     if formul-so1-kumule = 1
                        move kumule-sira to so1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so2-sira
                     if formul-so2-kumule = 1
                        move kumule-sira to so2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kkp-sira
                     if formul-kkp-kumule = 1
                        move kumule-sira to kkp-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kb-sira
                     if formul-kb-kumule = 1
                        move kumule-sira to kb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kom-sira
                     if formul-kom-kumule = 1
                        move kumule-sira to kom-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-fm-sira        
                when formul-mo-sira       
                     continue
            end-evaluate
         end-perform 
    .
*
 kumuleler-sonrasi-sirala.
         add 1 to kumule-basla-sira
         perform varying i from kumule-basla-sira by 1 until i > 13
            evaluate i
                when formul-ind-sira
                     if formul-ind-kumule = 0
                        move kumule-sira to ind-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-eb-sira
                     if formul-eb-kumule = 0
                        move kumule-sira to eb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ug-sira
                     if formul-ug-kumule = 0
                        move kumule-sira to ug-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ozl-sira
                     if formul-ozl-kumule = 0
                        move kumule-sira to ozl-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks1-sira
                     if formul-aks1-kumule = 0
                        move kumule-sira to aks1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks2-sira
                     if formul-aks2-kumule = 0
                        move kumule-sira to aks2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so1-sira
                     if formul-so1-kumule = 0
                        move kumule-sira to so1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so2-sira
                     if formul-so2-kumule = 0
                        move kumule-sira to so2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kkp-sira
                     if formul-kkp-kumule = 0
                        move kumule-sira to kkp-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kb-sira
                     if formul-kb-kumule = 0
                        move kumule-sira to kb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kom-sira
                     if formul-kom-kumule = 0
                        move kumule-sira to kom-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-fm-sira        
                     move kumule-sira to fm-sira       
                      add 1           to kumule-sira 
                when formul-mo-sira       
                     move kumule-sira to mo-sira     
                      add 1           to kumule-sira 
            end-evaluate
         end-perform 
         subtract 1 from kumule-basla-sira
     .
*
 yedekler.
         initialize kumule-sira
         move 1  to kumule-sira
         perform varying i from 1 by 1 until i > 13

            evaluate i
                when formul-ind-sira
                     if formul-ind-kumule = 1
                        move kumule-sira to ind-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-eb-sira
                     if formul-eb-kumule = 1
                        move kumule-sira to eb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ug-sira
                     if formul-ug-kumule = 1
                        move kumule-sira to ug-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ozl-sira
                     if formul-ozl-kumule = 1
                        move kumule-sira to ozl-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks1-sira
                     if formul-aks1-kumule = 1
                        move kumule-sira to aks1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks2-sira
                     if formul-aks2-kumule = 1
                        move kumule-sira to aks2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so1-sira
                     if formul-so1-kumule = 1
                        move kumule-sira to so1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so2-sira
                     if formul-so2-kumule = 1
                        move kumule-sira to so2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kkp-sira
                     if formul-kkp-kumule = 1
                        move kumule-sira to kkp-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kb-sira
                     if formul-kb-kumule = 1
                        move kumule-sira to kb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kom-sira
                     if formul-kom-kumule = 1
                        move kumule-sira to kom-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-fm-sira        
                when formul-mo-sira       
                     continue
            end-evaluate
         end-perform 

         perform varying i from 1 by 1 until i > 13

            evaluate i
                when formul-ind-sira
                     if formul-ind-kumule = 0
                        move kumule-sira to ind-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-eb-sira
                     if formul-eb-kumule = 0
                        move kumule-sira to eb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ug-sira
                     if formul-ug-kumule = 0
                        move kumule-sira to ug-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-ozl-sira
                     if formul-ozl-kumule = 0
                        move kumule-sira to ozl-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks1-sira
                     if formul-aks1-kumule = 0
                        move kumule-sira to aks1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-aks2-sira
                     if formul-aks2-kumule = 0
                        move kumule-sira to aks2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so1-sira
                     if formul-so1-kumule = 0
                        move kumule-sira to so1-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-so2-sira
                     if formul-so2-kumule = 0
                        move kumule-sira to so2-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kkp-sira
                     if formul-kkp-kumule = 0
                        move kumule-sira to kkp-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kb-sira
                     if formul-kb-kumule = 0
                        move kumule-sira to kb-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-kom-sira
                     if formul-kom-kumule = 0
                        move kumule-sira to kom-sira
                         add 1           to kumule-sira 
                     end-if
                when formul-fm-sira        
                     move kumule-sira to fm-sira       
                      add 1           to kumule-sira 
                when formul-mo-sira       
                     move kumule-sira to mo-sira     
                      add 1           to kumule-sira 
            end-evaluate
         end-perform 

         move ind-sira  to formul-ind-sira
         move eb-sira   to formul-eb-sira
         move ug-sira   to formul-ug-sira
         move ozl-sira  to formul-ozl-sira
         move aks1-sira to formul-aks1-sira
         move aks2-sira to formul-aks2-sira
         move so1-sira  to formul-so1-sira
         move so2-sira  to formul-so2-sira
         move kkp-sira  to formul-kkp-sira
         move kb-sira   to formul-kb-sira
         move kom-sira  to formul-kom-sira
         move fm-sira   to formul-fm-sira       
         move mo-sira   to formul-mo-sira     
         rewrite formul-rec invalid
                 stop " "
         end-rewrite 
     .

 
