* rezbul2.evt
* rezbul2.evt is generated from D:\asya\acugt.ytl\otel\rezbul2.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Cb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1a-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1a-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aaa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aaaa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaaaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aaaaa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaaaaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aaaaaa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaaaaaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aaaaaaa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 combo-toplamlar-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM combo-toplamlar-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form3-Gd-1-Event-Proc.
     PERFORM Form3-Gd-1-Ev-Other
     .

 Form4-Event-Proc.
     .

 Form4-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM Form4-Gd-1-Ev-Msg-Begin-Entry
     END-EVALUATE
     .

 Form5-Event-Proc.
     .

 Form6-Event-Proc.
     .

 Form6-Exception-Proc.
     PERFORM Form6-Ex-Other
     .

 Form6-Gd-1-Event-Proc.
     PERFORM Form6-Gd-1-Ev-Other
     .

 Form7-Event-Proc.
     .

 Form7-Exception-Proc.
     PERFORM Form7-Ex-Other
     .
***   start event editor code   ***
* 1-Check box rapordan deger geldigi zaman renk ve
*   disable enable
* 2-duzenle'de silme'de hata var ...
****************************************************
 Form1-Bef-Create.
     perform adresleri-tasi.
     move tarih-tasi       to bas-islem-tarih
                              bit-islem-tarih
                              bas-cin-tarih
                              bit-cin-tarih
                              bas-cout-tarih
                              bit-cout-tarih.
      open input genel
     move 1 to genel-anahtar
     read genel no lock invalid
          initialize mesaj-link
          move 03 to mesaj-no
          perform mesaj-ver
     not invalid
         continue
     end-read
     close genel
       .
*
 Form1-Cb-1-Ex-Cmd-Clicked.
     display acc-bas-numara acc-bit-numara.
     if ilk-secilen = zeroes
        move 1 to ilk-secilen
        perform cb-renklendir
     else 
        if numara-eh = 0
           if ilk-secilen = 1
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.
*
 Form1-Cb-1a-Ex-Cmd-Clicked.
     display acc-bas-islem-gun acc-bas-islem-ay acc-bas-islem-yil
             acc-bit-islem-gun acc-bit-islem-ay acc-bit-islem-yil.
     if ilk-secilen = zeroes
        move 2 to ilk-secilen
        perform cb-renklendir
     else 
        if islem-tarih-eh = 0
           if ilk-secilen = 2
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Cb-1aa-Ex-Cmd-Clicked.
     display acc-bas-acenta acc-bit-acenta.
     if ilk-secilen = zeroes
        move 3 to ilk-secilen
        perform cb-renklendir
     else 
        if acenta-eh = 0
           if ilk-secilen = 3
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Cb-1aaa-Ex-Cmd-Clicked.
     display acc-bas-musteri-adi acc-bit-musteri-adi.
     if ilk-secilen = zeroes
        move 4 to ilk-secilen
        perform cb-renklendir
     else 
        if musteri-adi-eh = 0
           if ilk-secilen = 4
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Cb-1aaaa-Ex-Cmd-Clicked.
     display acc-bas-musteri-soy acc-bit-musteri-soy.
     if ilk-secilen = zeroes
        move 5 to ilk-secilen
        perform cb-renklendir
     else 
        if musteri-soyadi-eh = 0
           if ilk-secilen = 5
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Cb-1aaaaa-Ex-Cmd-Clicked.
     display acc-bas-cin-gun acc-bas-cin-ay acc-bas-cin-yil
             acc-bit-cin-gun acc-bit-cin-ay acc-bit-cin-yil.
     if ilk-secilen = zeroes
        move 6 to ilk-secilen
        perform cb-renklendir
     else 
        if c-in-tarih-eh = 0
           if ilk-secilen = 6
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Cb-1aaaaaa-Ex-Cmd-Clicked.
     display acc-bas-cout-gun acc-bas-cout-ay acc-bas-cout-yil
             acc-bit-cout-gun acc-bit-cout-ay acc-bit-cout-yil.
     if ilk-secilen = zeroes
        move 7 to ilk-secilen
        perform cb-renklendir
     else 
        if c-out-tarih-eh = 0
           if ilk-secilen = 7
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Cb-1aaaaaaa-Ex-Cmd-Clicked.
     display acc-bas-voucher acc-bit-voucher.
     if ilk-secilen = zeroes
        move 8 to ilk-secilen
        perform cb-renklendir
     else 
        if voucher-eh = 0
           if ilk-secilen = 8
              move 99 to ilk-secilen
              perform cb-renklendir
           end-if
        end-if
     end-if.

*
 Form1-Ex-Other.
     if key-status = 2001
        perform acu-form2-routine
        exit paragraph
     end-if.

     if key-status = 2002 or key-status = 2003 or key-status = 2 or key-status = 7 or
        key-status = 2004
        continue
     else
        exit paragraph
     end-if.
     if key-status = 2004
        perform acu-form6-routine
        exit paragraph
     end-if.

     if numara-eh = 0 and islem-tarih-eh = 0 and
        acenta-eh = 0 and musteri-adi-eh = 0 and
        musteri-soyadi-eh = 0 and c-in-tarih-eh = 0 and
        c-out-tarih-eh = 0 and voucher-eh = 0
            display message box 
                    "Raporu alabilmeniz icin ana secimlerden birini secmek zorundasiniz !!!"
                    icon mb_warning_icon
                    title "Uyari"
                    move 4 to accept-control
                    move 12 to control-id
                    exit paragraph
     end-if.

     perform Acc-Bit-Numara-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 21 to control-id
        exit paragraph.

     perform Acc-Bas-Islem-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 22 to control-id
        exit paragraph.

     perform Acc-Bit-Islem-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 25 to control-id
        exit paragraph.

     perform Acc-Bas-Acenta-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 28 to control-id
        exit paragraph.

     perform Acc-Bit-Acenta-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 29 to control-id
        exit paragraph.

     perform Acc-Bit-Musteri-Adi-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 31 to control-id
        exit paragraph.

     perform Acc-Bit-Musteri-Soy-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 33 to control-id
        exit paragraph.

     perform Acc-Bas-Cin-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 34 to control-id
        exit paragraph.

     perform Acc-Bit-Cin-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 37 to control-id
        exit paragraph.

     perform Acc-Bas-Cout-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 40 to control-id
        exit paragraph.

     perform Acc-Bit-Cout-Yil-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 43 to control-id
        exit paragraph.

     perform Acc-Bit-Voucher-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 47 to control-id
        exit paragraph.

     perform Acc-Bas-Banka-Kodu-Aft-Procedure.
     if gec-gecme = 1  
        move 4 to accept-control
        move 54 to control-id
        exit paragraph.

     perform Acc-Bas-Doviz-Kodu-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 58 to control-id
        exit paragraph.

     perform Acc-Bas-Anlasma-Kodu-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 62 to control-id
        exit paragraph.

     perform Acc-Bas-Odeme-Kodu-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 66 to control-id
        exit paragraph.

     perform Acc-Bas-Ulke-Kodu-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 74 to control-id
        exit paragraph.

     perform Acc-Bas-Pazar-Kodu-Aft-Procedure.
     if gec-gecme = 1 
        move 4 to accept-control
        move 82 to control-id
        exit paragraph.

     perform Acc-Bas-Pansiyon-Kodu-Aft-Procedure.
     if gec-gecme = 1
        move 0 to gayriresmi
        move 4 to accept-control
        move 70 to control-id
        exit paragraph.
       if key-status = 2 or key-status = 7 then 
            move 2002 to rapor-sekil 
            if key-status = 7 then 
                  move 1 to gayriresmi 
               else
                  move 0 to gayriresmi
             end-if
        else
             move key-status to rapor-sekil
         end-if.
     if dokumere-yolla 
        perform dokumer-islem
     else
        perform duzenle-islem
     end-if.
     initialize esleme-i.

     exit paragraph.
*
 Form1-Aft-Initdata.
     initialize degiskenler degiskenler-1.
     modify combo-rezervasyon-turu, reset-list = 1
                                    mass-update = 1
     modify combo-musteri-turu,     reset-list = 1
                                    mass-update = 1
     modify combo-rezervasyon-durumu, reset-list = 1
                                      mass-update = 1
     modify combo-kur-tipi,         reset-list = 1
                                    mass-update = 1
     modify combo-rezervasyon-turu,
     item-to-add("0-Hepsi","1-Alotment","2-It","3-Fit","4-Grup")
     modify combo-rezervasyon-turu,
     item-to-add("5-Munferit","6-Walk-in","7-Sirket/Firma","8-Ozel")
     move "0-Hepsi" to combo-rezervasyon-turu-value

     modify combo-musteri-turu,
     item-to-add("N-Normal","V-Vip","T-Top Vip","H-Hepsi")
     move "N-Normal" to combo-musteri-turu-value

     modify combo-rezervasyon-durumu,
     item-to-add("I-Icerdeki","S-Silinmis ")
     move "I-Icerdeki" to combo-rezervasyon-durumu-value.

     modify combo-kur-tipi,
     item-to-add("H-Hepsi","G-Gunluk","A-Aybasi")
     move "H-Hepsi" to combo-kur-tipi-value

*/ form2 => degiskenleri
     move "0-Hepsi" to combo-oda-tipi-value
     move "0-Hepsi" to combo-oda-konumu-value
     move "0-Degistirme" to combo-oda-konumu-value-a
     move "H-Hepsi" to combo-rezervasyon-k-w-value
     move "Hepsi"   to combo-kullanici-kodu-value
     move 1         to cin-rezler-ciksin 
     move 0         to eb-rezler-ciksin
     move 0         to eb-de-aksiyon-hesaplama
     move "A-Toplamsiz"  to combo-toplamlar-value

*/ Raporlarin isimleri aliniyor ...
     open input rapor.
     initialize rapor-rec
     move "A"         to rapor-tipi
     start rapor key not < rapor-anahtar invalid
           continue
     not invalid
     initialize fs-rapor i
     perform with test after until fs-rapor = "10"
     read rapor next no lock end move "10" to fs-rapor
     not at end
          if rapor-tipi = "A" 
             initialize rapor-baslik
             move rapor-no       to rapor-baslik
             move "-"            to rapor-baslik(5:)
             move rapor-adi      to rapor-baslik(6:)
             add 1 to i
             if i = 1 
                move rapor-baslik to gecici-rapor-baslik
             end-if
            
          else
             move "10" to fs-rapor
             exit perform
          end-if
     end-read
     end-perform
     end-start
     close rapor.

     modify combo-rezervasyon-turu, mass-update = 0
                                    value combo-rezervasyon-turu-value
     modify combo-musteri-turu,     mass-update = 0
                                    value combo-musteri-turu-value
     modify combo-rezervasyon-durumu,mass-update = 0 
                                    value combo-rezervasyon-durumu-value
     modify combo-kur-tipi,         mass-update = 0
                                    value combo-kur-tipi-value.
     modify combo-oda-tipi,         mass-update = 0
                                    value combo-oda-tipi-value.
           .
*
 acc-bit-numara-Aft-Procedure.
     initialize gec-gecme
     if numara-eh = 0 
        exit paragraph.
     if bas-numara <> 0 and bit-numara <> 0
        if bas-numara > bit-numara 
           move 1 to gec-gecme
           exit paragraph
        end-if
     end-if.
     .
*
 acc-bas-islem-yil-Aft-Procedure.
     initialize gec-gecme.
     if islem-tarih-eh = 0
        exit paragraph.
     if bas-islem-tarih <> 0
        open input takvim
        move bas-islem-tarih      to takvim-anah
        read takvim no lock invalid
             move 1 to gec-gecme
        end-read
        close takvim
     end-if.
*
 acc-bit-islem-yil-Aft-Procedure.
     initialize gec-gecme.
     if islem-tarih-eh = 0
        exit paragraph.
     if bit-islem-tarih <> 0
        open input takvim
        move bit-islem-tarih      to takvim-anah
        read takvim no lock invalid
             move 1 to gec-gecme
        end-read
        close takvim
     end-if.

     if bas-islem-tarih <> 0 and bit-islem-tarih <> 0
        if bas-islem-tarih > bit-islem-tarih
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-bas-acenta-Aft-Procedure.
     initialize gec-gecme.
     if acenta-eh = 0
        exit paragraph.

     if bas-acenta <> spaces
        open input acenta 
        move bas-acenta  to acenta-kodu
        read acenta no lock invalid 
             move "Tanimsiz" to acenta-adi
             move 1 to gec-gecme
        end-read
        close acenta
     else
        move "Tumu ... " to acenta-adi
     end-if.
     display lb-bas-acenta-adi.
*
 acc-bit-acenta-Aft-Procedure.
     initialize gec-gecme.
     if acenta-eh = 0
        exit paragraph.

     if bit-acenta = spaces
        move "Tumu ..." to acenta-adi
        display lb-bit-acenta-adi
        exit paragraph.

     open input acenta
     move bit-acenta to acenta-kodu
     read acenta no lock invalid
          move "Tanimsiz ..."  to acenta-adi
          move 1 to gec-gecme
     end-read
     close acenta.
     display lb-bit-acenta-adi.

     if bas-acenta <> spaces and bit-acenta <> spaces
        if bas-acenta > bit-acenta
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-degis-acenta-Aft-Procedure.
     if degis-acenta <> spaces
        open input acenta 
        move degis-acenta  to acenta-kodu
        read acenta no lock invalid 
             move "Tanimsiz" to acenta-adi
             move 4 to accept-control
             move 28 to control-id
             display lb-degis-acenta-adi
        end-read
        close acenta
     else
        move "Degistirme ... " to acenta-adi
     end-if.
     display lb-degis-acenta-adi.
*
 acc-bit-musteri-adi-Aft-Procedure.
     initialize gec-gecme.
     if musteri-adi-eh = 0
        exit paragraph.
     if bas-musteri-adi <> spaces and bit-musteri-adi <> spaces
        if bas-musteri-adi > bit-musteri-adi
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-bit-musteri-soy-Aft-Procedure.
     initialize gec-gecme.
     if musteri-soyadi-eh = 0 
        exit paragraph.
     if bas-musteri-soy <> spaces and bit-musteri-soy <> spaces
        if bas-musteri-soy > bit-musteri-soy
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-bas-cin-yil-Aft-Procedure.
     initialize gec-gecme.
     if c-in-tarih-eh = 0
        exit paragraph.
     if bas-cin-tarih <> 0
        open input takvim
        move bas-cin-tarih      to takvim-anah
        read takvim no lock invalid
             move 1 to gec-gecme
        end-read
        close takvim
     end-if.
*
 acc-bit-cin-yil-Aft-Procedure.
     initialize gec-gecme.
     if c-in-tarih-eh = 0
        exit paragraph.
     if bit-cin-tarih <> 0
        open input takvim
        move bit-cin-tarih      to takvim-anah
        read takvim no lock invalid
             move 1 to gec-gecme
        end-read
        close takvim
     end-if.

     if bas-cin-tarih <> 0 and bas-cin-tarih <> 0
        if bas-cin-tarih > bit-cin-tarih
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-bas-cout-yil-Aft-Procedure.
     initialize gec-gecme.
     if c-out-tarih-eh = 0
        exit paragraph.
     if bas-cout-tarih <> 0
        open input takvim
        move bas-cout-tarih      to takvim-anah
        read takvim no lock invalid
             move 1 to gec-gecme
        end-read
        close takvim
     end-if.
*
 acc-bit-cout-yil-Aft-Procedure.
     initialize gec-gecme.
     if c-out-tarih-eh = 0
        exit paragraph.
     if bit-cout-tarih <> 0
        open input takvim
        move bit-cout-tarih      to takvim-anah
        read takvim no lock invalid
             move 1 to gec-gecme
        end-read
        close takvim
     end-if.

     if bas-cout-tarih <> 0 and bas-cout-tarih <> 0
        if bas-cout-tarih > bit-cout-tarih
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-bit-voucher-Aft-Procedure.
     initialize gec-gecme.
     if voucher-eh = 0 
        exit paragraph.
     if bas-voucher <> 0 and bit-voucher <> 0
        if bas-voucher > bit-voucher
           move 1 to gec-gecme
        end-if
     end-if.
*
 acc-bas-banka-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-banka-kodu <> 0
        open input banka
        move bas-banka-kodu   to banka-kodu
        read banka no lock invalid
             move 1 to gec-gecme
             move "Tanimsiz ..." to banka-adi
        end-read
        close banka
     else
        move "Tumu ..."  to banka-adi
     end-if.
     display lb-banka-adi.
*
 acc-bas-doviz-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-doviz-kodu <> 0
        open input doviz
        move bas-doviz-kodu   to doviz-kodu
        read doviz no lock invalid
             move 1 to gec-gecme
             move "Tanimsiz ..."  to d-adi-1
        end-read
        close doviz
     else
        move "Tumu ..." to d-adi-1
     end-if.
     display lb-doviz-adi.
*
 acc-bas-anlasma-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-anlasma-kodu <> spaces
        open input kodlar02
        move "D"              to kodlar02-tipi
        move bas-anlasma-kodu to kodlar02-kodu
        read kodlar02 no lock invalid
             move "Tanimsiz ..." to kodlar02-adi
             move 1 to gec-gecme
        end-read
        close kodlar02
     else
        move "Tumu ..."       to kodlar02-adi
     end-if.
     display lb-anlasma-adi.
*
 acc-bas-odeme-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-odeme-kodu <> spaces
        open input kodlar02
        move "B"              to kodlar02-tipi
        move bas-odeme-kodu   to kodlar02-kodu
        read kodlar02 no lock invalid
             move "Tanimsiz ..." to kodlar02-adi
             move 1 to gec-gecme
        end-read
        close kodlar02
     else
        move "Tumu ..."       to kodlar02-adi
     end-if.
     display lb-odeme-adi.
*
 acc-bas-ulke-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-ulke-kodu <> spaces
        open input ulke
        move bas-ulke-kodu   to ulke-anah
        read ulke no lock invalid
             move "Tanimsiz ..." to ulke-adi
             move 1 to gec-gecme
        end-read
        close ulke
     else
        move "Tumu ..." to ulke-adi
     end-if.
     display lb-ulke-adi.
*
 acc-bas-pazar-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-pazar-kodu <> spaces 
        open input kodlar02
        move "E"              to kodlar02-tipi
        move bas-pazar-kodu   to kodlar02-kodu
        read kodlar02 no lock invalid
             move "Tanimsiz ..." to kodlar02-adi
             move 1 to gec-gecme
        end-read
        close kodlar02
     else
        move "Tumu ..."       to kodlar02-adi
     end-if.
     display lb-pazar-adi.
*
 acc-bas-pansiyon-kodu-Aft-Procedure.
     initialize gec-gecme.
     if bas-pansiyon-kodu <> spaces
        open input kodlar02
        move "E"                 to kodlar02-tipi
        move bas-pansiyon-kodu   to kodlar02-kodu
        read kodlar02 no lock invalid
             move "Tanimsiz ..." to kodlar02-adi
             move 1 to gec-gecme
        end-read
        close kodlar02
     else
        move "Tumu ..."       to kodlar02-adi
     end-if.
     display lb-pansiyon-adi.
     .
*
 Form2-Aft-Initdata.
     modify combo-oda-tipi,          reset-list = 1 mass-update = 1.
     modify combo-oda-konumu,        reset-list = 1 mass-update = 1.
     modify combo-rezervasyon-e-b,   reset-list = 1 mass-update = 1.
     modify combo-rezervasyon-k-w,   reset-list = 1 mass-update = 1.
     modify combo-kullanici-kodu,    reset-list = 1 mass-update = 1.
     modify combo-toplamlar,         reset-list = 1 mass-update = 1.
     modify combo-oda-tipi,
     item-to-add("0-Hepsi","1-Single","2-Double","3-Double","4-Triple")
     modify combo-oda-konumu,
     item-to-add("0-Hepsi")
     modify combo-rezervasyon-e-b,
     item-to-add("0-Dahil","1-Sadece","2-Cikmasin")
     modify combo-rezervasyon-k-w,
     item-to-add("H-Hepsi","K-Konfirme","B-Beklemede")
     modify combo-kullanici-kodu,
     item-to-add("Hepsi").
     modify combo-toplamlar,
     item-to-add("A-Toplamsiz","B-Pazar","C-Pansiyon","D-Ulke","E-Anlasma")
     modify combo-toplamlar,
     item-to-add("F-Oda tipi","G-Oda konumu","H-Odeme kodu","I-Doviz kodu")
     modify combo-toplamlar,
     item-to-add("J-Erken rezervasyon","K-Acenta")

     open input konum
     initialize konum-rec
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          initialize temp-x
          move konum-anahtar to temp-x
          move "-"           to temp-x(2:)
          move konum-adi     to temp-x(3:)
          modify combo-oda-konumu,
                 item-to-add(temp-x)
     end-read
     end-perform
     end-start
     close konum.

     move combo-kullanici-kodu-value to temp-x-50
     open input kllnc
     initialize kllnc-rec
     start kllnc key not < k-kodu invalid
           continue
     not invalid
     initialize fs-kllnc
     perform with test after until fs-kllnc = "10"
     read kllnc next no lock end move "10" to fs-kllnc
     not at end
          initialize combo-kullanici-kodu-value
          string k-adi delimited by space
                 " "   delimited by size 
                 k-soyadi delimited by size 
                 into combo-kullanici-adi
          move k-kodu          to combo-kullanici-no
          modify combo-kullanici-kodu,
                 item-to-add(combo-kullanici-kodu-value)
     end-read
     end-perform
     end-start
     close kllnc.
     move temp-x-50  to combo-kullanici-kodu-value

     modify combo-oda-tipi,     mass-update = 0
                                value combo-oda-tipi-value.
     modify combo-oda-konumu,   mass-update = 0
                                value combo-oda-konumu-value.
     modify combo-rezervasyon-k-w,   mass-update = 0
                                value combo-rezervasyon-k-w-value.
     modify combo-rezervasyon-e-b,   mass-update = 0
                                value eb-rezler-ciksin
     modify combo-kullanici-kodu,   mass-update = 0
                                 value combo-kullanici-kodu-value.
     modify combo-toplamlar     ,   mass-update = 0
                                 value combo-toplamlar-value.

     if combo-toplamlar-value(1:1) = "A"
        modify form2-pb-2,enabled = false
     else
        modify form2-pb-2,enabled = true
     end-if.

 dokumer-islem.
     open i-o genelfis.
     move 1 to genelfis-anahtar.
     read genelfis no lock invalid
          accept print-no from time
     end-read
     add 1 to print-no
     rewrite genelfis-rec invalid continue end-rewrite
     close genelfis.
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move rapor-baslik   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move rapor-baslik   to det-filler
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RLLRRRRRRRRLLLLLRRRLLLLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
     move "Rez.no"           to det-1
     move "Adi"              to det-2
     move "Soyadi"           to det-3
     move "Pax"              to det-4
     move "Chi"              to det-5
     move "Free"             to det-6
     move "C/in"             to det-7
     move "C/out"            to det-8
     move "Rez.T"            to det-9
     move "Odeme"            to det-10
     move "Acenta"           to det-11
     move "Ulke"             to det-12
     move "Voucher"          to det-13
     move "Anlas"            to det-14
     move "Bn"               to det-15
     move "Dv"               to det-16
     move "Rez.Fiyati"       to det-17
     move "Gun"               to det-18
     move "Toplam Rez.Fiyati" to det-19
     move "Indirim Tutari"    to det-191
     move "Kalan Tutar"       to det-192
     move "Acenta Komisyonu"  to det-193
     move "Ara Acenta Kom  "  to det-194
     move "Ana Acenta Kom  "  to det-195
     move "Otele Kalan Net "  to det-196
     move "Pazar"            to det-20
     move "X"                to det-21
     move "Pk"               to det-22
     move "K"                to det-23
     move "Konum"            to det-24
     move "Tip"              to det-25
     move "Oda"              to det-26
     move "Grup"             to det-27
     move "IO"               to det-28
     move "KO"               to det-29
     move "Staff"            to det-30
     move "|" to fil-1 fil-2 fil-3 fil-4
     fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
     fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
     fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195 
     fil-196 fil-20 fil-21 fil-22 fil-23
     fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
     fil-30
     
******        if sadece-ozet = 0 then
        write dokumer-rec from detay
*****        end-if

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4
     det-5 det-6 det-7 det-8 det-9 det-10 det-11
     det-12 det-13 det-14 det-15 det-16 det-17
     det-18 det-19 det-191 det-192 det-193 det-194 det-195 
     det-20 det-21 det-22 det-23
     det-24 det-25 det-26 det-27 det-28 det-29
     det-30

****        if sadece-ozet = 0 then
        write dokumer-rec from detay
*****        end-if
*********************************
     perform islem.
     perform ozet-islem
     close dokumer takas takas2
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     delete file dokumer takas takas2.
 ozet-islem.
     initialize dokumer-rec detay
**     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4
     det-5 det-6 det-7 det-8 det-9 det-10 det-11
     det-12 det-13 det-14 det-15 det-16 det-17
     det-18 det-19 det-191 det-192 det-193 det-194 det-195 
     det-20 det-21 det-22 det-23
     det-24 det-25 det-26 det-27 det-28 det-29
     det-30
        write dokumer-rec from detay 

                  initialize dokumer-rec detay
        move "ACENTA"                 to det-2
        move "OZETI"                to det-3
        
        move "|" to fil-1 fil-2 fil-3 fil-4
        fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
        fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
        fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195 fil-196  fil-20 fil-21 fil-22 fil-23
        fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
        fil-30

        write dokumer-rec from detay

                  initialize dokumer-rec detay 
     move "Ac.Kodu"           to det-1
     move "Acenta"              to det-2
    
     move "Pax"              to det-4
     move "Chi"              to det-5
     move "Free"             to det-6
     move "Pax-Gc "             to det-7
     move "Chi-Gc"            to det-8
     move "Fre-Gc"            to det-9
     move "Oda-Gc"            to det-18
     move "Toplam Rez.Fiyati" to det-19
     move "Indirim Tutari"    to det-191
     move "Kalan Tutar"       to det-192
     move "Acenta Komisyonu"  to det-193
     move "Ara Acenta Kom  "    to det-194
     move "Ana Acenta Kom  "   to det-195
     move "Otele Kalan Net "   to det-196
     move "Rez-Tp"             to det-26 
     move "|" to fil-1 fil-2 fil-3 fil-4
     fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
     fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
     fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195  fil-196 
     fil-20 fil-21 fil-22 fil-23
     fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
     fil-30
     

        write dokumer-rec from detay










             initialize dokumer-rec detay   toplam
     open input acenta
     initialize takas2-rec 
     start takas2 key > takas2-anahtar
        invalid continue
        not invalid
           perform until fs-takas2 = "10"
             read takas2 next 
                 at end
                    move "10" to fs-takas2
                 not end
                    perform ozet-detay-ata
             end-read
           end-perform
     end-start
     close acenta
     initialize dokumer-rec detay
        move "-"            to det-dokumer-20(5:1)
        move all "-" to det-1 det-2 det-3 det-4
        det-5 det-6 det-7 det-8 det-9 det-10 det-11
        det-12 det-13 det-14 det-15 det-16 det-17
        det-18 det-19 det-191 det-192 det-193 det-194 det-195
        det-20 det-21 det-22 det-23
        det-24 det-25 det-26 det-27 det-28 det-29
        det-30
*****        if sadece-ozet = 0 then
        write dokumer-rec from detay
**********        end-if
        initialize dokumer-rec detay
        move "Genel"                 to det-2
        move "Toplam"                to det-3
        move t-oda                   to 4-z   
        move 4-z                     to det-26
        move t-pax                   to 4-z
        move 4-z                     to det-4
        move t-chi                   to 4-z
        move 4-z                     to det-5
        move t-fre                   to 4-z
        move 4-z                     to det-6
        move t-g-pax                 to 6-z
        move 6-z                     to det-7
        move t-g-chi                 to 6-z
        move 6-z                     to det-8
        move t-g-fre                 to 6-z  
        move 6-z                     to det-9
        move t-tutar                 to 15-z
        move 15-z                    to det-19
        move t-indirim               to 15-z
        move 15-z                    to det-191
        move t-kalan                 to 15-z
        move 15-z                    to det-192
        move t-acenta                to 15-z
        move 15-z                    to det-193
        move t-acenta2                  to 15-z
        move 15-z                    to det-194
        move t-acenta3                  to 15-z
        move 15-z                    to det-195

        move t-Otel                  to 15-z
        move 15-z                    to det-196
        move t-g-oda                 to 4-z
        move 4-z                     to det-18
        
        move "A"          to det-dokumer-20(3:1)
       
        move "1"          to det-dokumer-20(10:1)
        move "|" to fil-1 fil-2 fil-3 fil-4
        fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
        fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
        fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195 
         fil-196 fil-20 fil-21 fil-22 fil-23
        fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
        fil-30
******        if sadece-ozet = 0 then
        write dokumer-rec from detay
******        end-if
        initialize dokumer-rec detay
        move "-"            to det-dokumer-20(5:1)
        move all "-" to det-1 det-2 det-3 det-4






        det-5 det-6 det-7 det-8 det-9 det-10 det-11
        det-12 det-13 det-14 det-15 det-16 det-17
        det-18 det-19 det-191 det-192 det-193 det-194
        det-195 det-20 det-21 det-22 det-23
        det-24 det-25 det-26 det-27 det-28 det-29
        det-30
*****        if sadece-ozet = 0 then
        write dokumer-rec from detay
******        end-if



        .
     
*
 duzenle-islem.
     perform acu-form3-routine.
     close takas takas2 
     delete file takas takas2.

 
     
 islem.
     initialize toplam.
     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          move 1 to ekran-fis-1
     end-read
     add 1 to ekran-fis-1
     rewrite genelfis-rec invalid
             write genelfis-rec end-write
     end-rewrite
     close genelfis.
     move k-kodu-tasi         to takas-k  takas2-k
     move ekran-fis-1(2:)     to takas-no takas2-no
     open output takas close takas open i-o takas with mass-update.
     open output takas2 close takas2 open i-o takas2 with mass-update.

     open input rez kodlar02 acenta ulke konum kllnc
                fiyat fiyatana aksiyhrk konuk romhrk.
     initialize rez-rec fs-rez
     move combo-rezervasyon-durumu-value(1:1)  to rez-durumu
     evaluate true
          when ilk-secilen = 1
               move bas-numara to rez-anah
               start rez key not < rez-anah invalid
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 2
               move bas-islem-tarih   to rez-isl-tar
               start rez key not < rez-isl invalid
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 3 
               move bas-acenta to rez-acenta 
               start rez key not < rez-acen invalid
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 4
               move bas-musteri-adi to rez-adi
               start rez key not < rez-ad invalid 
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 5
               move bas-musteri-soy to rez-soyadi
               start rez key not < rez-soy invalid 
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 6
               move bas-cin-tarih to rez-gir-tar
               start rez key not < rez-gir invalid 
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 7
               move bas-cout-tarih to rez-cik-tar
               start rez key not < rez-cik invalid 
                     move "89" to fs-rez
               end-start
          when ilk-secilen = 8
               move bas-voucher  to rez-voucher
               start rez key not < rez-vouc invalid 
                     move "89" to fs-rez
               end-start
     end-evaluate.

     if fs-rez = "89"
           display message box
                   "Kayit bulunamadi ..."
           close rez kodlar02 acenta ulke konum kllnc takas
                 fiyat fiyatana aksiyhrk
           delete file takas
           exit paragraph.

     initialize fs-rez
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10" to fs-rez
     not at end

          if ilk-secilen not = 01 
             if combo-rezervasyon-durumu-value(1:1) <> rez-durumu
                move "10" to fs-rez
                exit perform
             end-if
          end-if 
          if ilk-secilen = 01 and bit-numara not = 0
             if rez-anah > bit-numara 
                move "10" to fs-rez
                exit perform
             end-if
          end-if
          if ilk-secilen = 02 and bit-islem-tarih not = 0
             if rez-isl-tar > bit-islem-tarih
                move "10" to fs-rez
                exit perform
             end-if
          end-if
          if ilk-secilen = 03 and bit-acenta not = spaces
             if rez-acenta > bit-acenta
                move "10" to fs-rez
                exit perform 
             end-if
          end-if
          if ilk-secilen = 04 and bit-musteri-adi not = spaces
             if rez-adi > bit-musteri-adi
                move "10" to fs-rez
                exit perform
             end-if
          end-if
          if ilk-secilen = 05 and bit-musteri-soy not = spaces
             if rez-soyadi > bit-musteri-soy
                move "10" to fs-rez
                exit perform
             end-if
          end-if
          if ilk-secilen = 06 and bit-cin-tarih not = 0
             if rez-gir-tar > bit-cin-tarih
                move "10" to fs-rez
                exit perform
             end-if
          end-if
          if ilk-secilen = 07 and bit-cout-tarih not = 0
             if rez-cik-tar > bit-cout-tarih
                move "10" to fs-rez
                exit perform
             end-if
          end-if
          if ilk-secilen = 08 and bit-voucher not = spaces
             if rez-voucher > bit-voucher
                move "10" to fs-rez
                exit perform
             end-if
          end-if
*/ ana filtreler tekrar sorgulaniyor ...
*-------------------------------------------------------
          if numara-eh > 0
             if (bas-numara <> 0 and rez-anah < bas-numara) or
                (bit-numara <> 0 and rez-anah > bit-numara)
                     exit perform cycle
             end-if
          end-if
          if islem-tarih-eh > 0
             if (bas-islem-tarih <> 0 and rez-isl-tar < bas-islem-tarih) or
                (bit-islem-tarih <> 0 and rez-isl-tar > bit-islem-tarih)
                   exit perform cycle
             end-if
          end-if
          if acenta-eh > 0
             if (bas-acenta <> spaces and rez-acenta < bas-acenta) or 
                (bit-acenta <> spaces and rez-acenta > bit-acenta)
                   exit perform cycle
             end-if
          end-if
          if musteri-adi-eh > 0
             if (bas-musteri-adi <> spaces and rez-adi < bas-musteri-adi) or
                (bit-musteri-adi <> spaces and rez-adi > bit-musteri-adi)   
                     exit perform cycle
             end-if
          end-if
          if musteri-soyadi-eh > 0
             if (bas-musteri-soy <> spaces and rez-soyadi < bas-musteri-soy) or
                (bit-musteri-soy <> spaces and rez-soyadi > bit-musteri-soy)   
                     exit perform cycle
             end-if
          end-if
          if c-in-tarih-eh > 0
             if (bas-cin-tarih <> 0 and rez-gir-tar < bas-cin-tarih) or
                (bit-cin-tarih <> 0 and rez-gir-tar > bit-cin-tarih)
                     exit perform cycle
             end-if
          end-if
          if c-out-tarih-eh > 0
             if (bas-cout-tarih <> 0 and rez-cik-tar < bas-cout-tarih) or
                (bit-cout-tarih <> 0 and rez-cik-tar > bit-cout-tarih)
                     exit perform cycle
             end-if
          end-if
          if voucher-eh > 0
             if (bas-voucher <> spaces and rez-voucher < bas-voucher) or 
                (bit-voucher <> spaces and rez-voucher > bit-voucher)
                     exit perform cycle                 
             end-if
          end-if
*/ yardimci filtreler sorgulaniyor ... 
*-------------------------------------------------------
          if combo-rezervasyon-turu-value(1:1) <> 0
             if combo-rezervasyon-turu-value(1:1) <> rez-tipi
                exit perform cycle
             end-if
          end-if
          if bas-grup-kodu <> spaces
             if bas-grup-kodu <> rez-grup-no
                exit perform cycle
             end-if
          end-if
          if combo-kur-tipi-value(1:1) <> "H"
             if combo-kur-tipi-value(1:1) <> rez-kur-aygun
                exit perform cycle
             end-if
          end-if
          if bas-banka-kodu <> 0
             if bas-banka-kodu > rez-banka or 
                bas-banka-kodu < rez-banka
                    exit perform cycle
             end-if
          end-if
          if rapor-ref <> 0
             move rez-oda-konumu to konum-anahtar
             read konum no lock invalid continue
             end-read
            if  rapor-ref not = konum-ref
                    exit perform cycle
             end-if
          end-if
          if bas-doviz-kodu <> 0
             if bas-doviz-kodu > rez-doviz or 
                bas-doviz-kodu < rez-doviz
                    exit perform cycle
             end-if
          end-if
          if bas-anlasma-kodu <> spaces
             if bas-anlasma-kodu > rez-anlasma or 
                bas-anlasma-kodu < rez-anlasma
                     exit perform cycle
             end-if
          end-if
          if bas-odeme-kodu <> spaces
             if bas-odeme-kodu > rez-odeme-tipi or 
                bas-odeme-kodu < rez-odeme-tipi
                     exit perform cycle
             end-if
          end-if
          if bas-ulke-kodu <> spaces
             if bas-ulke-kodu > rez-ulke or 
                bas-ulke-kodu < rez-ulke
                     exit perform cycle
             end-if
          end-if
          if bas-pazar-kodu <> spaces
             if bas-pazar-kodu > rez-pazar or 
                bas-pazar-kodu < rez-pazar
                     exit perform cycle
             end-if
          end-if
          if bas-pansiyon-kodu <> spaces
             if bas-pansiyon-kodu > rez-pan-tipi or 
                bas-pansiyon-kodu < rez-pan-tipi
                     exit perform cycle
             end-if
          end-if
*          if combo-musteri-turu-value(1:1) = "N" or 
*             combo-musteri-turu-value(1:1) = rez-vip
*             continue
*          else 
*             exit perform cycle
*          end-if
          if ((rez-vip = "N" or rez-vip = " ") and cb-nor-v = 0 ) or
             ((rez-vip   not = "N" and rez-vip not = " ") and cb-vip2-v = 0)
              exit perform cycle
          end-if

*/ gelismis filtreler sorgulaniyor
*-------------------------------------------------------
          if combo-oda-tipi-value(1:1) <> "0" 
             if combo-oda-tipi-value(1:1) <> rez-s-d-t-g
                   exit perform cycle
             end-if
          end-if
          if combo-oda-konumu-value(1:1) <> "0"
             if combo-oda-konumu-value(1:1) <> rez-oda-konumu
                exit perform cycle
             end-if
          end-if
          if combo-kullanici-no <> spaces 
             if combo-kullanici-no <> rez-staf
                exit perform cycle
             end-if
          end-if
          if combo-rezervasyon-k-w-value(1:1) <> "H"
             if combo-rezervasyon-k-w-value(1:1) <> rez-k-g-b
                exit perform cycle
             end-if
          end-if
          if cin-rezler-ciksin = 0
             if rez-c-in = "E"
                exit perform cycle
             end-if
          end-if
          evaluate eb-rezler-ciksin
*/ sadece ebler cikiyor
          when 1
               if rez-eb <> "E"
                  exit perform cycle
               end-if
*/ ebler cikmasin
          when 2
               if rez-eb = "E"
                  exit perform cycle
               end-if
          end-evaluate
          if buyuk-sayi <> 0
             if buyuk-sayi <> rez-buyuk
                exit perform cycle
             end-if
          end-if
          if kucuk-sayi <> 0
             if kucuk-sayi <> rez-kucuk
                exit perform cycle
             end-if
          end-if
          if free-sayi <> 0
             if free-sayi <> rez-free
                exit perform cycle
             end-if
          end-if
          if komisyon-orani <> 0
             if komisyon-orani <> rez-komisyon
                exit perform cycle
             end-if
          end-if
          if indirim-orani <> 0
             if indirim-orani <> rez-nor-indirim
                exit perform cycle
             end-if
          end-if
             
*-------------------------------------------------------
          perform detay-ata
     end-read
     end-perform.
     if dokumere-yolla 
        perform liste-toplam
     end-if

     close rez kodlar02 acenta ulke konum kllnc
           fiyat fiyatana aksiyhrk konuk romhrk.
 
 ozet-detay-ata.

        move takas2-acenta           to det-1 acenta-kodu
        
        read acenta no lock invalid
             move "Tanimsiz"   to acenta-adi
        end-read
        
        move acenta-adi              to det-2
        move acenta-adi(9:)          to det-3
        move takas2-pax              to 4-z
        move 4-z                     to det-4
        move takas2-child            to 4-z
        move 4-z                     to det-5
        move takas2-free             to 4-z
        move 4-z                     to det-6
      
        move takas2-g-pax            to 6-z
        move 6-z                     to det-7
        move takas2-g-child          to 6-z
        move 6-z                     to det-8
        move takas2-g-free           to 6-z
        move 6-z                     to det-9
        move takas2-g-oda            to 4-z
        move 4-z                     to det-18
        move takas2-oda            to 4-z
        move 4-z                     to det-26
      
        
        

        

        move takas2-indirim-tutar           to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-191
        
       
        
        
        move takas2-top-rez-fiyati   to temp-sayi
        
        move temp-sayi               to 15-z
        move 15-z                    to det-19
        
        
    
                            
        move takas2-kalan-tutar      to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-192
        move takas2-acenta-kom       to temp-sayi        
        move temp-sayi               to 15-z
        move 15-z                    to det-193
        move takas2-acenta2-kom      to temp-sayi        
        move temp-sayi               to 15-z
        move 15-z                    to det-194
        move takas2-acenta3-kom      to temp-sayi        
        move temp-sayi               to 15-z
        move 15-z                    to det-195
        
        
        
        move takas2-otel-net         to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-196
                

        
        compute t-oda   = t-oda   + takas2-oda
        compute t-pax   = t-pax   + takas2-pax
        compute t-chi   = t-chi   + takas2-child
        compute t-fre   = t-fre   + takas2-free
        compute t-g-oda = t-g-oda + takas2-g-oda
        compute t-g-pax = t-g-pax + takas2-g-pax
        compute t-g-chi = t-g-chi + takas2-g-child
        compute t-g-fre = t-g-fre + takas2-g-free
        compute t-tutar   = t-tutar + takas2-top-rez-fiyati
        compute t-indirim = t-indirim + takas2-indirim-tutar
        compute t-kalan   = t-kalan + takas2-kalan-tutar
        compute t-acenta  = t-acenta + takas2-acenta-kom
        compute t-acenta2  = t-acenta2 + takas2-acenta2-kom
        compute t-acenta3  = t-acenta3 + takas2-acenta3-kom


        compute t-otel    = t-otel + takas2-otel-net



        move "A"          to det-dokumer-20(3:1)
        move 481          to det-renk1
        move "1"          to det-dokumer-20(10:1)
        move "|" to fil-1 fil-2 fil-3 fil-4
        fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
        fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
        fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195 
         fil-196 fil-20 fil-21 fil-22 fil-23
        fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
        fil-30
           write dokumer-rec from detay
        
 
            .
       
 detay-ata.
     if dokumere-yolla
        initialize dokumer-rec detay
        move rez-anah                to det-1
        move rez-adi                 to det-2
        move rez-soyadi              to det-3
        move rez-buyuk               to 4-z
        move 4-z                     to det-4
        move rez-kucuk               to 4-z
        move 4-z                     to det-5
        move rez-free                to 4-z
        move 4-z                     to det-6
        move rez-gir-gun             to egun
        move rez-gir-ay              to eay
        move rez-gir-yil             to eyil
        move etarih                  to det-7
        move rez-cik-gun             to egun
        move rez-cik-ay              to eay
        move rez-cik-yil             to eyil
        move etarih                  to det-8
        evaluate rez-tipi
             when 1  move "Alotment" to det-9
             when 2  move "It"       to det-9
             when 3  move "Fit"      to det-9
             when 4  move "Grup"     to det-9
             when 5  move "Munferit" to det-9
             when 6  move "Walk/in"  to det-9
             when 7  move "Sirket"   to det-9
             when 8  move "Ozel"     to det-9
        end-evaluate
        move rez-odeme-tipi          to kodlar02-kodu
        move "B"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"  to kodlar02-adi
        end-read
        move kodlar02-adi            to det-10
        move rez-acenta              to acenta-anahtar
        read acenta no lock invalid
             move "Tanimsiz"   to acenta-adi
        end-read
        move acenta-adi              to det-11
        move rez-ulke                to ulke-anah
        read ulke no lock invalid 
             move "Tanimsiz"         to ulke-adi
        end-read
        move ulke-adi                to det-12
        move rez-voucher             to det-13
        move rez-anlasma             to kodlar02-kodu
        move "D"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"     to kodlar02-adi
        end-read
        move kodlar02-adi            to det-14
        move rez-banka               to det-15
        move rez-doviz               to det-16
        move rez-fiyati              to 15-z
        move 15-z                    to det-17
        move rez-gir-tar             to g-bul-ilk-tarih
        move rez-cik-tar             to g-bul-son-tarih
        perform g-bul thru g-bul-exit
        move g-bul-gun-sayisi        to 4-z
        move 4-z                     to det-18

        if gayriresmi = 1 then 
           add 1 to ilk
           move rez-acenta to buffer-acenta acenta-kodu
           move "AL" to acenta-kodu(1:2)
           read acenta no lock invalid
                if ilk not = 1 then
                   Move 1 to ilk
                  display message box "Bu acentanin alternatifi yok"
                end-if
              not invalid
                move acenta-kodu   to  rez-acenta
           end-read
        end-if

        perform peryot-fiyat-bul

        if gayriresmi = 1 then 
           move buffer-acenta to rez-acenta
        end-if
        perform  acenta-komisyon-oran

        compute kalan-tutar = top-rez-fiyati
        compute indirim-tutar rounded = 
        ( kalan-tutar / (100 - REZ-NOR-INDIRIM) ) * REZ-NOR-INDIRIM
        move indirim-tutar     to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-191
        
       
        
        if top-rez-fiyati <> zeroes
           move top-rez-fiyati    to temp-sayi
        else
           compute temp-sayi = g-bul-gun-sayisi * rez-fiyati
        end-if
        
         if kalan-tutar > 0 then 
            compute top-rez-fiyati =
             kalan-tutar + indirim-tutar
             move top-rez-fiyati to temp-sayi
        end-if 
        compute t-tutar   = t-tutar + top-rez-fiyati
        move temp-sayi               to 15-z
        move 15-z                    to det-19
        
        
    
                            
        move kalan-tutar             to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-192
        move acenta-kom              to temp-sayi        
        move temp-sayi               to 15-z
        move 15-z                    to det-193
        move acenta2-kom             to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-194
        move acenta3-kom             to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-195
        
        
        move otel-net                to temp-sayi
        move temp-sayi               to 15-z
        move 15-z                    to det-196
                

        
        move rez-pazar               to kodlar02-kodu
        move "E"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"      to kodlar02-adi
        end-read
        move kodlar02-adi            to det-20
        move rez-eb                  to det-21
        move rez-pan-tipi            to det-22
        move rez-kur-aygun           to det-23
        move rez-oda-konumu          to konum-anahtar
        read konum no lock invalid
             move "Tanimsiz" to konum-adi
        end-read
        move konum-adi               to det-24
        evaluate rez-s-d-t-g
             when 1 move "Single"    to det-25
             when 2 move "Double"    to det-25
             when 3 move "Triple"    to det-25
             when 4 move "Grup"      to det-25
        end-evaluate
        move rez-odano               to det-26
        move rez-grup-no             to det-27
        move rez-nor-indirim         to 2-z
        move 2-z                     to det-28
        move rez-komisyon            to det-29
        move rez-staf                to k-kodu
        read kllnc no lock invalid
             move "Tanimsiz"     to k-adi
        end-read
        move k-adi                   to det-30
        compute t-oda   = t-oda   + 1
        compute t-pax   = t-pax   + rez-buyuk
        compute t-chi   = t-chi   + rez-kucuk
        compute t-fre   = t-fre   + rez-free
        add indirim-tutar   to t-indirim
        add kalan-tutar     to t-kalan
        add acenta-kom      to t-acenta
        add acenta2-kom      to t-acenta2
        add acenta3-kom      to t-acenta3

        add otel-net        to t-otel
        add g-bul-gun-sayisi to t-g-oda
        move "|" to fil-1 fil-2 fil-3 fil-4
        fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
        fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
        fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195 
         fil-196 fil-20 fil-21 fil-22 fil-23
        fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
        fil-30
        initialize takas2-rec
        move rez-acenta to takas2-acenta
        read takas2 no lock invalid continue end-read
        add 1           to takas2-oda
        add rez-buyuk   to takas2-pax 
        add rez-kucuk   to takas2-child
        add rez-free    to takas2-free
        add g-bul-gun-sayisi to takas2-g-oda
        compute takas2-g-pax   = takas2-g-pax 
              + ( rez-buyuk * g-bul-gun-sayisi )
        compute takas2-g-child   = takas2-g-child
              + ( rez-kucuk * g-bul-gun-sayisi )
        compute takas2-g-free  = takas2-g-free 
              + ( rez-free * g-bul-gun-sayisi )
        add top-rez-fiyati to takas2-top-rez-fiyati
        add indirim-tutar  to takas2-indirim-tutar
        add kalan-tutar    to takas2-kalan-tutar
        Add acenta-kom     to takas2-acenta-kom
        Add acenta2-kom     to takas2-acenta2-kom
        Add acenta3-kom     to takas2-acenta3-kom
        
        add otel-net       to takas2-otel-net



        write takas2-rec 
          invalid rewrite takas2-rec end-rewrite 
        end-write
        
        if sadece-ozet = 0 then 
           write dokumer-rec from detay
        end-if
     else
        initialize form3-gd-1-record        move rez-anah                to gd-1-col-1
        move rez-adi                 to gd-1-col-2
        move rez-soyadi              to gd-1-col-3
        move rez-buyuk               to 4-z
        move 4-z                     to gd-1-col-4
        move rez-kucuk               to 4-z
        move 4-z                     to gd-1-col-5
        move rez-free                to 4-z
        move 4-z                     to gd-1-col-6
        move rez-gir-gun             to egun
        move rez-gir-ay              to eay
        move rez-gir-yil             to eyil
        move etarih                  to gd-1-col-7
        move rez-cik-gun             to egun
        move rez-cik-ay              to eay
        move rez-cik-yil             to eyil
        move etarih                  to gd-1-col-8
        evaluate rez-tipi
             when 1  move "Alotment" to gd-1-col-9
             when 2  move "It"       to gd-1-col-9
             when 3  move "Fit"      to gd-1-col-9
             when 4  move "Grup"     to gd-1-col-9
             when 5  move "Munferit" to gd-1-col-9
             when 6  move "Walk/in"  to gd-1-col-9
             when 7  move "Sirket"   to gd-1-col-9
             when 8  move "Ozel"     to gd-1-col-9
        end-evaluate
        move rez-odeme-tipi          to kodlar02-kodu
        move "B"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"  to kodlar02-adi
        end-read
        move kodlar02-adi            to gd-1-col-10
        move rez-acenta              to acenta-anahtar
        read acenta no lock invalid
             move "Tanimsiz"   to acenta-adi
        end-read
        move acenta-adi              to gd-1-col-11
        move rez-ulke                to ulke-anah
        read ulke no lock invalid 
             move "Tanimsiz"         to ulke-adi
        end-read
        move ulke-adi                to gd-1-col-12
        move rez-voucher             to gd-1-col-13
        move rez-anlasma             to kodlar02-kodu
        move "D"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"     to kodlar02-adi
        end-read
        move kodlar02-adi            to gd-1-col-14
        move rez-banka               to gd-1-col-15
        move rez-doviz               to gd-1-col-16
        move rez-fiyati              to 15-z
        move 15-z                    to gd-1-col-17
        move rez-gir-tar             to g-bul-ilk-tarih
        move rez-cik-tar             to g-bul-son-tarih
        perform g-bul thru g-bul-exit
        move g-bul-gun-sayisi        to 4-z
        move 4-z                     to gd-1-col-18
        perform peryot-fiyat-bul
        if top-rez-fiyati <> zeroes
           move top-rez-fiyati    to temp-sayi
        else
           compute temp-sayi = g-bul-gun-sayisi * rez-fiyati
        end-if
        move temp-sayi               to 15-z
        move 15-z                    to gd-1-col-19
        move rez-pazar               to kodlar02-kodu
        move "E"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"      to kodlar02-adi
        end-read
        move kodlar02-adi            to gd-1-col-20
        move rez-eb                  to gd-1-col-21
        move rez-pan-tipi            to gd-1-col-22
        move rez-kur-aygun           to gd-1-col-23
        move rez-oda-konumu          to konum-anahtar
        read konum no lock invalid
             move "Tanimsiz" to konum-adi
        end-read
        move konum-adi               to gd-1-col-24
        evaluate rez-s-d-t-g
             when 1 move "Single"    to gd-1-col-25
             when 2 move "Double"    to gd-1-col-25
             when 3 move "Triple"    to gd-1-col-25
             when 4 move "Grup"      to gd-1-col-25
        end-evaluate
        move rez-odano               to gd-1-col-26
        move rez-grup-no             to gd-1-col-27
        move rez-nor-indirim         to 2-z
        move 2-z                     to gd-1-col-28
        move rez-komisyon            to gd-1-col-29
        move rez-staf                to k-kodu
        read kllnc no lock invalid
             move "Tanimsiz"     to k-adi
        end-read
        move k-adi                   to gd-1-col-30

        modify form3-gd-1,
               record-to-add(form3-gd-1-record)
        initialize takas-rec
        if combo-toplamlar-value(1:1) <> "A"
           evaluate combo-toplamlar-value(1:1)
               when "B"  move rez-pazar        to takas-anahtar1
               when "C"  move rez-pan-tipi     to takas-anahtar1
               when "D"  move rez-ulke         to takas-anahtar1
               when "E"  move rez-anlasma      to takas-anahtar1
               when "F"  move rez-s-d-t-g      to takas-anahtar1
               when "G"  move rez-oda-konumu   to takas-anahtar1
               when "H"  move rez-odeme-tipi   to takas-anahtar1
               when "I"  move rez-doviz        to takas-anahtar1
               when "J"  move rez-eb           to takas-anahtar1
               when "K"  move rez-acenta       to takas-anahtar1
           end-evaluate
           move low-values                     to takas-anahtar2
           read takas no lock invalid 
                continue
           end-read
           add rez-buyuk         to takas-pax
           add rez-kucuk         to takas-child
           add rez-free          to takas-free
           add temp-sayi         to takas-fiyat 
           add 1                 to takas-adet
           write takas-rec invalid
                 rewrite takas-rec end-rewrite
           end-write
           if esleme-i > 0
              initialize takas-rec
              evaluate combo-toplamlar-value(1:1)
                  when "B"  move rez-pazar        to takas-anahtar1
                  when "C"  move rez-pan-tipi     to takas-anahtar1
                  when "D"  move rez-ulke         to takas-anahtar1
                  when "E"  move rez-anlasma      to takas-anahtar1
                  when "F"  move rez-s-d-t-g      to takas-anahtar1
                  when "G"  move rez-oda-konumu   to takas-anahtar1
                  when "H"  move rez-odeme-tipi   to takas-anahtar1
                  when "I"  move rez-doviz        to takas-anahtar1
                  when "J"  move rez-eb           to takas-anahtar1
                  when "K"  move rez-acenta       to takas-anahtar1
              end-evaluate

              evaluate esleme-i
                  when 01 move rez-acenta       to takas-anahtar2
                  when 02 move rez-pan-tipi     to takas-anahtar2
                  when 03 move rez-anlasma      to takas-anahtar2
                  when 04 move rez-oda-konumu   to takas-anahtar2
                  when 05 move rez-doviz        to takas-anahtar2
                  when 06 move rez-pazar        to takas-anahtar2
                  when 07 move rez-ulke         to takas-anahtar2
                  when 08 move rez-s-d-t-g      to takas-anahtar2
                  when 09 move rez-odeme-tipi   to takas-anahtar2
                  when 10 move rez-eb           to takas-anahtar2
              end-evaluate
              read takas no lock invalid 
                   continue
              end-read
              add rez-buyuk         to takas-pax
              add rez-kucuk         to takas-child
              add rez-free          to takas-free
              add temp-sayi         to takas-fiyat 
              add 1                 to takas-adet
              write takas-rec invalid
                    rewrite takas-rec end-rewrite
              end-write
           end-if
        end-if
     end-if.

 liste-toplam.
     set dokumere-yolla to true.
     if dokumere-yolla
        initialize dokumer-rec detay
        move "-"            to det-dokumer-20(5:1)
        move all "-" to det-1 det-2 det-3 det-4
        det-5 det-6 det-7 det-8 det-9 det-10 det-11
        det-12 det-13 det-14 det-15 det-16 det-17
        det-18 det-19 det-191 det-192 det-193 det-194 det-195
        det-20 det-21 det-22 det-23
        det-24 det-25 det-26 det-27 det-28 det-29
        det-30
*****        if sadece-ozet = 0 then
        write dokumer-rec from detay
**********        end-if
        initialize dokumer-rec detay
        move "Genel"                 to det-2
        move "Toplam"                to det-3
        move t-oda                   to 4-z   
        move 4-z                     to det-26
        move t-pax                   to 4-z
        move 4-z                     to det-4
        move t-chi                   to 4-z
        move 4-z                     to det-5
        move t-fre                   to 4-z
        move 4-z                     to det-6
        move t-tutar                 to 15-z
        move 15-z                    to det-19
        move t-indirim               to 15-z
        move 15-z                    to det-191
        move t-kalan                 to 15-z
        move 15-z                    to det-192
        move t-acenta                to 15-z
        move 15-z                    to det-193
        move t-acenta2                  to 15-z
        move 15-z                    to det-194
        move t-acenta3                  to 15-z
        move 15-z                    to det-195
        move t-Otel                  to 15-z
        move 15-z                    to det-196
        move t-g-oda                 to 4-z
        move 4-z                     to det-18
        
        move "A"          to det-dokumer-20(3:1)
        move 481          to det-renk1
        move "1"          to det-dokumer-20(10:1)
        move "|" to fil-1 fil-2 fil-3 fil-4
        fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
        fil-12 fil-13 fil-14 fil-15 fil-16 fil-17
        fil-18 fil-19 fil-191 fil-192 fil-193 fil-194 fil-195 
         fil-196 fil-20 fil-21 fil-22 fil-23
        fil-24 fil-25 fil-26 fil-27 fil-28 fil-29
        fil-30
******        if sadece-ozet = 0 then
        write dokumer-rec from detay
******        end-if
        initialize dokumer-rec detay
        move "-"            to det-dokumer-20(5:1)
        move all "-" to det-1 det-2 det-3 det-4
        det-5 det-6 det-7 det-8 det-9 det-10 det-11
        det-12 det-13 det-14 det-15 det-16 det-17
        det-18 det-19 det-191 det-192 det-193 det-194
        det-195 det-20 det-21 det-22 det-23
        det-24 det-25 det-26 det-27 det-28 det-29
        det-30
*****        if sadece-ozet = 0 then
        write dokumer-rec from detay
******        end-if
     end-if.

*
 Form3-Aft-Initdata.
     if combo-toplamlar-value(1:1) = "A"
        modify button-toplamlar,enabled = false
     else
        modify button-toplamlar,enabled = true
     end-if.
     modify form3-gd-1,
            reset-grid  = 1 
            mass-update = 1
     initialize form3-gd-1-record
     move "Rez.no"           to gd-1-col-1
     move "Adi"              to gd-1-col-2
     move "Soyadi"           to gd-1-col-3
     move "Pax"              to gd-1-col-4
     move "Chi"              to gd-1-col-5
     move "Free"             to gd-1-col-6
     move "C/in"             to gd-1-col-7
     move "C/out"            to gd-1-col-8
     move "Rez.T"            to gd-1-col-9
     move "Odeme"            to gd-1-col-10
     move "Acenta"           to gd-1-col-11
     move "Ulke"             to gd-1-col-12
     move "Voucher"          to gd-1-col-13
     move "Anlas"            to gd-1-col-14
     move "Bn"               to gd-1-col-15
     move "Dv"               to gd-1-col-16
     move "Rez.Fiyati"       to gd-1-col-17
     move "Gun"              to gd-1-col-18
     move "Toplam Rez.Fiyati" to gd-1-col-19
     move "Pazar"            to gd-1-col-20
     move "X"                to gd-1-col-21
     move "Pk"               to gd-1-col-22
     move "K"                to gd-1-col-23
     move "Konum"            to gd-1-col-24
     move "Tip"              to gd-1-col-25
     move "Oda"              to gd-1-col-26
     move "Grup"             to gd-1-col-27
     move "IO"               to gd-1-col-28
     move "KO"               to gd-1-col-29
     move "Staff"            to gd-1-col-30.
     modify form3-gd-1,
            record-to-add(form3-gd-1-record).

     perform islem.

     modify form3-gd-1,
            mass-update = 0.
*
 Form3-Gd-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
             move event-action-fail to event-action
             exit paragraph
        when msg-goto-cell
        when msg-goto-cell-mouse
        when msg-begin-drag
        when msg-end-drag
        when msg-goto-cell-drag
             inquire form3-gd-1,y in yeni-y
             if yeni-y < 2
                move 2 to yeni-y eski-y
             end-if
             if eski-y > zeroes 
                modify form3-gd-1(eski-y),
                       x = 2
                       row-color = 0
                       cell-color = 0
             end-if
             modify form3-gd-1,
                    y = yeni-y,
                    x = 2,
                    row-color = 480
                    cell-color = 480
             move yeni-y to eski-y
    end-evaluate.
*
 Form4-Aft-Initdata.
    open input acenta ulke kodlar02 konum doviz.
    modify form4-gd-1,reset-grid = 1 mass-update = 1 
    initialize form4-gd-1-record
    move "Kodu"       to gd-4-col-1
    move "Adi"        to gd-4-col-2
    move "Pax"        to gd-4-col-3
    move "Child"      to gd-4-col-4
    move "Free"       to gd-4-col-5
    move "Rez.Fiyati" to gd-4-col-6
    modify form4-gd-1,
           record-to-add(form4-gd-1-record)
    initialize takas-rec
    start takas key not < takas-anahtar invalid
          continue
    not invalid
    initialize fs-takas esleme-kayit-sayi
    perform with test after until fs-takas = "10"
    read takas next no lock end move "10" to fs-takas
    not at end
         initialize form4-gd-1-record
         move takas-anahtar1      to gd-4-col-1
         evaluate combo-toplamlar-value(1:1)
              when "B"
                   move takas-anahtar1 to kodlar02-kodu
                   move "E"           to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"  to kodlar02-adi
                   end-read
                   move kodlar02-adi  to gd-4-col-2
              when "C"
                   move takas-anahtar1 to kodlar02-kodu
                   move "A"           to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"  to kodlar02-adi
                   end-read
                   move kodlar02-adi     to gd-4-col-2
              when "D"
                   move takas-anahtar1    to ulke-anah
                   read ulke no lock invalid
                        move "Tanimsiz"  to ulke-adi
                   end-read
                   move ulke-adi         to gd-4-col-2
              when "E"
                   move takas-anahtar1    to kodlar02-kodu
                   move "D"              to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"  to kodlar02-adi
                   end-read
                   move kodlar02-adi     to gd-4-col-2
              when "F"
                   evaluate takas-anahtar1(1:1)
                       when "1" move "Single"   to gd-4-col-2
                       when "2" move "Double"   to gd-4-col-2
                       when "3" move "Triple"   to gd-4-col-2
                       when "4" move "Grup"     to gd-4-col-2
                   end-evaluate
              when "G"
                   move takas-anahtar1           to konum-anahtar
                   read konum no lock invalid
                        move "Tanimsiz"         to konum-adi
                   end-read
                   move konum-adi               to gd-4-col-2
              when "H"
                   move takas-anahtar1           to kodlar02-kodu
                   move "B"                     to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"         to kodlar02-adi
                   end-read
                   move kodlar02-adi            to gd-4-col-2
              when "I"
                   move takas-anahtar1           to doviz-kodu
                   read doviz no lock invalid
                        move "Tanimsiz"         to d-adi-1
                   end-read
                   move d-adi-1                 to gd-4-col-2
              when "J"
                   evaluate takas-anahtar1(1:1)
                       when "E" move "Erken  Rezervasyon"   to gd-4-col-2
                       when "H" move "Normal Rezervasyon"   to gd-4-col-2
                       when other move "Normal Rezervasyon"   to gd-4-col-2
                   end-evaluate
              when "K"
                   move takas-anahtar1           to acenta-kodu
                   read acenta no lock invalid
                        move "Tanimsiz"         to acenta-adi
                   end-read
                   move acenta-adi              to gd-4-col-2
         end-evaluate

         if takas-anahtar2 <> low-values and esleme-i <> 0
            initialize form4-gd-1-record
            evaluate esleme-i
                when 01
                   move takas-anahtar2           to acenta-kodu
                   read acenta no lock invalid
                        move "Tanimsiz"          to acenta-adi
                   end-read
                   move acenta-adi                to gd-4-col-2
                when 02
                   move takas-anahtar2 to kodlar02-kodu
                   move "A"           to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"  to kodlar02-adi
                   end-read
                   move kodlar02-adi     to gd-4-col-2
                when 03
                   move takas-anahtar2    to kodlar02-kodu
                   move "D"              to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"  to kodlar02-adi
                   end-read
                   move kodlar02-adi     to gd-4-col-2
                when 04
                   move takas-anahtar2           to konum-anahtar
                   read konum no lock invalid
                        move "Tanimsiz"         to konum-adi
                   end-read
                   move konum-adi               to gd-4-col-2
                when 05
                   move takas-anahtar2           to doviz-kodu
                   read doviz no lock invalid
                        move "Tanimsiz"         to d-adi-1
                   end-read
                   move d-adi-1                 to gd-4-col-2
                when 06
                   move takas-anahtar2 to kodlar02-kodu
                   move "E"           to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"  to kodlar02-adi
                   end-read
                   move kodlar02-adi  to gd-4-col-2
                when 07
                   move takas-anahtar2    to ulke-anah
                   read ulke no lock invalid
                        move "Tanimsiz"  to ulke-adi
                   end-read
                   move ulke-adi         to gd-4-col-2
                when 08
                   evaluate takas-anahtar2(1:1)
                       when "1" move "Single"   to gd-4-col-2
                       when "2" move "Double"   to gd-4-col-2
                       when "3" move "Triple"   to gd-4-col-2
                       when "4" move "Grup"     to gd-4-col-2
                   end-evaluate
                when 09
                   move takas-anahtar2           to kodlar02-kodu
                   move "B"                     to kodlar02-tipi
                   read kodlar02 no lock invalid
                        move "Tanimsiz"         to kodlar02-adi
                   end-read
                   move kodlar02-adi            to gd-4-col-2
                when 10
                   evaluate takas-anahtar2(1:1)
                       when "E" move "Erken  Rezervasyon"   to gd-4-col-2
                       when "H" move "Normal Rezervasyon"   to gd-4-col-2
                       when other move "Normal Rezervasyon"   to gd-4-col-2
                   end-evaluate
            end-evaluate
         end-if
         move takas-pax          to 5-z
         move 5-z                to gd-4-col-3
         move takas-child        to 5-z
         move 5-z                to gd-4-col-4
         move takas-free         to 5-z
         move 5-z                to gd-4-col-5
         move takas-fiyat        to 15-z
         move 15-z               to gd-4-col-6
         add 1 to esleme-kayit-sayi
         modify form4-gd-1,
                record-to-add(form4-gd-1-record)
         if esleme-i <> 0
            if takas-anahtar2 <> low-values
                modify form4-gd-1(esleme-kayit-sayi + 1)
                       x = 3
                       row-color = 480
                       cell-color = 480
            end-if
         end-if
    end-read
    end-perform
    end-start
    modify form4-gd-1,
           mass-update = 0.
    close acenta ulke kodlar02 konum doviz.
*
 Form3-Ex-Other.
    if key-status = 1 or 2 or 3 or 4 or 5 or 6 or 8
       continue
    else 
       exit paragraph
    end-if.

    evaluate key-status
       when 1 
            inquire form3-gd-1,cursor-y in form3-gd-y
            inquire form3-gd-1(form3-gd-y,1),
                    record-data in form3-gd-1-record
                    hidden-data in dummy
            if dummy <> "E"
               open input rez
               move gd-1-col-1      to rez-anah
               read rez no lock invalid
                    continue
               not invalid
               if rez-c-in <> "E"
                  modify form3-gd-1(form3-gd-y,1)
                         hidden-data = "E"
                         bitmap = check-bmp
                         bitmap-number = 2 
                         bitmap-width = 16
                         bitmap-trailing = 1
               end-if
               end-read
               close rez
            else
               modify form3-gd-1(form3-gd-y,1),
                      bitmap = null
                      hidden-data = "H"
            end-if
       when 2 
            inquire form3-gd-1,
                    last-row in esleme-kayit-sayi
            if esleme-kayit-sayi = 1 
               exit paragraph
            end-if
            open input rez
            initialize frame-degiskenler
            move esleme-kayit-sayi to frame-kayit-sayi
            move 20                to frame-win-line
            move 20                to frame-win-pos
            move "Bekleyiniz..."   to frame-title
            perform frame-ac
            perform varying form3-gd-y from 2 by 1 until form3-gd-y > esleme-kayit-sayi
                    perform frame-goster
                    inquire form3-gd-1(form3-gd-y,1),
                            record-data in form3-gd-1-record
                            hidden-data in dummy
                    evaluate dummy
                        when "E"
                             modify form3-gd-1(form3-gd-y,1),
                                    hidden-data = "H"
                                    bitmap = null
                        when other
                             move gd-1-col-1 to rez-anah
                             read rez no lock invalid
                                  continue
                             not invalid
                             if rez-c-in <> "E"
                                modify form3-gd-1(form3-gd-y,1),
                                       hidden-data = "E"
                                       bitmap = check-bmp
                                       bitmap-number = 2 
                                       bitmap-width = 16
                                       bitmap-trailing = 1 
                             end-if
                             end-read
                    end-evaluate
            end-perform
            perform frame-kapat
            close rez
       when 3
            open i-o rez takvim acenhrk cast
            inquire form3-gd-1,
                    last-row in sil-son
            initialize frame-degiskenler
            move sil-son           to frame-kayit-sayi
            move 20                to frame-win-line
            move 20                to frame-win-pos
            move "Siliniyor ..."   to frame-title
            perform frame-ac

            perform varying sil-i from 2 by 1 until sil-i > sil-son
                    perform frame-goster
                    initialize sil-eh
                    inquire form3-gd-1(sil-i,1),
                            hidden-data in sil-eh
                    if sil-eh <> "E"
                       exit perform cycle
                    end-if
                    inquire form3-gd-1(sil-i,2),
                            cell-data in rez-anah
                    read rez no lock invalid
                         exit perform cycle
                    end-read
                    evaluate rez-durumu
                       when "I"
                            perform acenhrk-takvim-sil
                            move "S"            to rez-durumu
                            move k-kodu-tasi    to rez-staf
                            accept rez-isl-tar  from century-date
                             
                            accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                            accept rez-edit-zaman from time          |                           
                
                            rewrite rez-rec end-rewrite
                       when "S"
                            perform cast-iptal
                            delete rez invalid continue end-delete
                    end-evaluate
            end-perform
            close rez takvim acenhrk cast
            perform frame-kapat
            set exit-pushed to true
       when 5
            if combo-toplamlar-value(1:1) <> "A"
               perform acu-form4-routine
            end-if
       when 6
            open i-o rez 
            open input aksiyhrk fiyat fiyatana
            inquire form3-gd-1,
                    last-row in sil-son
            initialize frame-degiskenler
            move sil-son           to frame-kayit-sayi
            move 20                to frame-win-line
            move 20                to frame-win-pos
            move "Hesaplaniyor."   to frame-title
            perform frame-ac

            perform varying sil-i from 2 by 1 until sil-i > sil-son
                    perform frame-goster
                    initialize sil-eh
                    inquire form3-gd-1(sil-i,1),
                            hidden-data in sil-eh
                    if sil-eh <> "E"
                       exit perform cycle
                    end-if
                    inquire form3-gd-1(sil-i,2),
                            cell-data in rez-anah
                    read rez no lock invalid
                         exit perform cycle
                    end-read
                        perform peryot-fiyat-bul-1 

                        move ilk-rez-fiyati to rez-fiyati
                        move k-kodu-tasi    to rez-staf
                         
                        accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                        accept rez-edit-zaman from time          |                           
                
                        rewrite rez-rec end-rewrite
            end-perform
            close rez aksiyhrk fiyat fiyatana
            perform frame-kapat
            set exit-pushed to true
       when 8 
        perform acu-form7-routine
        exit paragraph
    end-evaluate.
*
 Form2-Ex-Other.
    if key-status = 5001
       perform acu-form5-routine
    end-if.
*
 combo-toplamlar-Ex-Ntf-Selchange.
    if combo-toplamlar-value(1:1) = "A"
       modify form2-pb-2,enabled = false
    else
       modify form2-pb-2,enabled = true
    end-if.
*
 Form4-Gd-1-Ev-Msg-Begin-Entry.
    move event-action-fail to event-action.
*
 cb-renklendir.
    evaluate ilk-secilen
         when 01  modify cb-numara,color = 5 
                  move 2 to numara-eh
         when 02  modify cb-islem-tarihi,color = 5 
                  move 2 to islem-tarih-eh
         when 03  modify cb-acenta,color = 5 
                  move 2 to acenta-eh
         when 04  modify cb-musteri-adi,color = 5 
                  move 2 to musteri-adi-eh
         when 05  modify cb-musteri-soyadi,color = 5 
                  move 2 to musteri-soyadi-eh
         when 06  modify cb-cin-tarihi,color = 5 
                  move 2 to c-in-tarih-eh
         when 07  modify cb-cout-tarihi,color = 5 
                  move 2 to c-out-tarih-eh
         when 08  modify cb-voucher,color = 5 
                  move 2 to voucher-eh
         when 99
                  if numara-eh = 1 
                     move 01 to ilk-secilen
                  else
                  if islem-tarih-eh = 1 
                     move 02 to ilk-secilen
                  else
                  if acenta-eh = 1 
                     move 03 to ilk-secilen
                  else
                  if musteri-adi-eh = 1 
                     move 04 to ilk-secilen
                  else
                  if musteri-soyadi-eh = 1 
                     move 05 to ilk-secilen
                  else
                  if c-in-tarih-eh = 1
                     move 06 to ilk-secilen
                  else
                  if c-out-tarih-eh = 1 
                     move 07 to ilk-secilen
                  else
                  if voucher-eh = 1 
                     move 08 to ilk-secilen
                  end-if
                  end-if
                  end-if
                  end-if
                  end-if
                  end-if
                  end-if
                  end-if
                  modify cb-numara,      color = 2 
                  modify cb-islem-tarihi,color  = 2
                  modify cb-acenta      ,color  = 2
                  modify cb-musteri-adi ,color  = 2
                  modify cb-musteri-soyadi,color  = 2
                  modify cb-cin-tarihi,color  = 2
                  modify cb-cout-tarihi,color  = 2
                  modify cb-voucher    ,color  = 2
                  if ilk-secilen = 99
                     move 0 to ilk-secilen
                  end-if
                  if ilk-secilen <> 0  
                     perform cb-renklendir
                  end-if
         when other
              exit paragraph
    end-evaluate.
*
 Form6-Aft-Initdata.
    modify form6-gd-1,
           mass-update = 1 
           reset-grid  = 1
    initialize form6-gd-1-record
    move "No."       to gd-6-col-1
    move "Rapor adi" to gd-6-col-2
    modify form6-gd-1,
           record-to-add(form6-gd-1-record)

    open input rapor
    initialize rapor-rec
    move "A"   to rapor-tipi
    start rapor key not < rapor-anahtar invalid
          continue
    not invalid
    initialize fs-rapor
    perform with test after until fs-rapor = "10"
    read rapor next no lock end move "10" to fs-rapor
    not at end
         if rapor-tipi <> "A"
            move "10" to fs-rapor
            exit perform
         end-if
         initialize form6-gd-1-record
         move rapor-no         to gd-6-col-1
         move rapor-adi        to gd-6-col-2



         modify form6-gd-1,
                record-to-add(form6-gd-1-record)
    end-read
    end-perform
    end-start

    close rapor.

    modify form6-gd-1,
           mass-update = 0.
     .
*
 Form6-Ef-1-Aft-Procedure.
     if rapor-no = zeroes 
        modify button-0101,enabled = false
        modify button-0102,enabled = false
     else 
        modify button-0101,enabled = true
        modify button-0102,enabled = true
     end-if.
     open input rapor.
     move "A"      to rapor-tipi
     read rapor no lock invalid
          initialize rapor-adi rapor-gelecek
     end-read
     display accept-0102.
     close rapor.
*
 Form6-Ef-1-Bef-Procedure.
     initialize rapor-rec.
     display accept-0102.
     modify button-0101,enabled = false
     modify button-0102,enabled = false.
*
 Form6-Ex-Other.
     evaluate key-status
           when 7
           when 2
              if numara-eh = 0 and islem-tarih-eh = 0 and
                acenta-eh = 0 and musteri-adi-eh = 0 and
                musteri-soyadi-eh = 0 and c-in-tarih-eh = 0 and
                c-out-tarih-eh = 0 and voucher-eh = 0
                    display message box 
                            "Raporu kaydedebilmeniz icin ana secimlerden birini secmek zorundasiniz !!!"
                            icon mb_warning_icon
                            title "Uyari"
                            move 4 to accept-control
                            move 5 to control-id
                            exit paragraph
              end-if
              open i-o rapor
              move "A" to rapor-tipi
              read rapor no lock invalid
                   continue
              end-read
              move numara-eh         to rapor-cb-1
              move islem-tarih-eh    to rapor-cb-2
              move acenta-eh         to rapor-cb-3
              move musteri-adi-eh    to rapor-cb-4
              move musteri-soyadi-eh to rapor-cb-5
              move c-in-tarih-eh     to rapor-cb-6
              move c-out-tarih-eh    to rapor-cb-7
              move voucher-eh        to rapor-cb-8
              write rapor-rec invalid
                    rewrite rapor-rec end-rewrite
              end-write
              close rapor
              initialize rapor-rec
              display accept-0101 accept-0102
              move 4 to accept-control
              move 4 to control-id
              perform Form6-Aft-Initdata
         when 3
              open i-o rapor
              move "A" to rapor-tipi
              delete rapor invalid continue end-delete
              close rapor
              initialize rapor-rec
              display accept-0101 accept-0102
              move 4 to accept-control
              move 4 to control-id
              perform Form6-Aft-Initdata
     end-evaluate.
*
 Form6-Gd-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
             move event-action-fail to event-action
             inquire form6-gd-1,y in form6-y
             inquire form6-gd-1(form6-y),
                     record-data in form6-gd-1-record
             move gd-6-col-1     to rapor-no
             display accept-0101
             perform Form6-Ef-1-Aft-Procedure
             move 4 to accept-control
             move 4 to control-id
             exit paragraph
        when msg-goto-cell
        when msg-goto-cell-mouse
        when msg-begin-drag
        when msg-end-drag
        when msg-goto-cell-drag
             inquire form6-gd-1,y in form6-yeni-y
             if form6-yeni-y < 2
                move 2 to form6-yeni-y form6-eski-y
             end-if
             if form6-eski-y > zeroes 
                modify form6-gd-1(form6-eski-y),
                       x = 2
                       row-color = 0
                       cell-color = 0
             end-if
             modify form6-gd-1,
                    y = form6-yeni-y,
                    x = 2,
                    row-color = 480
                    cell-color = 480
             move form6-yeni-y to form6-eski-y
    end-evaluate.
*
 
 acenhrk-takvim-sil.
     if rez-k-g-b <> "K"
        exit paragraph
     end-if
     initialize takvim-rec
     move rez-gir-tar to takvim-anah
     start takvim key not < takvim-anah invalid
           continue
     not invalid
     initialize fs-takvim
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
          if takvim-anah = rez-cik-tar or 
             takvim-anah > rez-cik-tar
                 move "10" to fs-takvim
                 exit perform
          end-if
          compute takvim-sat-oda(rez-oda-konumu)   =
                  takvim-sat-oda(rez-oda-konumu)   - 1
          compute takvim-sat-buyuk(rez-oda-konumu) =
                  takvim-sat-buyuk(rez-oda-konumu) - rez-buyuk
          compute takvim-sat-kucuk(rez-oda-konumu) =
                  takvim-sat-kucuk(rez-oda-konumu) - rez-kucuk
          compute takvim-sat-free(rez-oda-konumu)  =
                  takvim-sat-free(rez-oda-konumu)  - rez-free
          rewrite takvim-rec invalid continue end-rewrite

          move rez-acenta       to acenhrk-acenta
          move takvim-anah      to acenhrk-tarih
          move rez-oda-konumu   to acenhrk-oda-konumu
          move rez-s-d-t-g      to acenhrk-s-d-t-g
          read acenhrk invalid 
               exit perform cycle
          end-read
          compute acenhrk-sat-oda   = acenhrk-sat-oda   - 1
          compute acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk
          compute acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk
          compute acenhrk-sat-free  = acenhrk-sat-free  - rez-free
          rewrite acenhrk-rec invalid continue end-rewrite
     end-read
     end-perform
     end-start.

 cast-iptal.
     initialize cast-rec
     move rez-no          to cast-rez-no
     start cast key not < cast-anah1 invalid
           continue
     not invalid
     initialize fs-cast
     perform with test after until fs-cast = "10"
     read cast next no lock end move "10" to fs-cast
     not at end
          if cast-rez-no > rez-no
             move "10" to fs-cast
             exit perform
          end-if
          if cast-rez-no <> rez-no
             exit perform cycle
          end-if
          delete cast end-delete
          perform log-operation-cast
     end-read
     end-perform
     end-start.

 peryot-fiyat-bul.
     open input takvim
     initialize aksiyhrk-rec aksiyon-durumu
     move "A"              to aksiyhrk-tipi
     move rez-acenta       to aksiyhrk-acenta
     move rez-gir-tar      to aksiyhrk-tarih
     move rez-pan-tipi     to aksiyhrk-pan-tipi
     move g-bul-gun-sayisi to aksiyhrk-gecele
     read aksiyhrk no lock invalid
          continue
     not invalid
          set aksiyon-var to true
     end-read

     move rez-fiyati    to ilk-rez-fiyati

     initialize g-bul-gun-sayisi
                takvim-rec top-rez-fiyati
                kalan-tutar acenta-kom
                acenta2-kom acenta3-kom   otel-net
     move rez-gir-tar   to takvim-anah
     start takvim key not < takvim-anah
           invalid
                move 1 to g-bul-gun-sayisi
     not invalid
     initialize fs-takvim
****     if rez-no = 1994 then stop " " end-if
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
                   
          if takvim-anah = rez-cik-tar
             if takvim-anah < tarih-tasi and 
               anlasmadan-hesapla = 0  then
                  perform basilan-bul
               end-if
             move "10" to fs-takvim
             exit perform cycle
          end-if

          if takvim-anah not > rez-cik-tar
             if takvim-anah < tarih-tasi and 
               anlasmadan-hesapla = 0  then
                  perform basilan-bul
               else
                 if takvim-anah < rez-cik-tar then 
                 perform fiyat-bul 
                        thru fiyat-bul-exit
                  if oda-fiyati = 0 then 
                    move rez-fiyati to  oda-fiyati 
                  end-if
                 compute top-rez-fiyati = 
                     top-rez-fiyati + oda-fiyati 
                 end-if
             end-if
            
               add 1 to g-bul-gun-sayisi
             
          else
             move "10" to fs-takvim
          end-if
     end-read
     end-perform.

     close takvim.
***********     ****mami

     
     
     
     
     
     .
 basilan-bul.

     move rez-folio to konuk-folio
     read konuk no lock 
         invalid
*              display message 
*                   rez-no, " nolu rezervasyon foliosu bulunamadi"
                continue
         not invalid 
              if konuk-kur-degeri = 0 then
                  move 1 to konuk-kur-degeri 
              end-if
     end-read
     initialize romhrk-rec 
         
     move takvim-anah to romhrk-tarih
     move konuk-folio to romhrk-folio
     
     start romhrk key >= romhrk-anah1 
          invalid continue 
          not invalid
             read romhrk next 
                 at end move "10" to fs-romhrk
             end-read
             perform until fs-romhrk = "10" or
                     romhrk-tarih not = takvim-anah or
                     romhrk-folio not = konuk-folio 
                     evaluate romhrk-depkod
                        when 1
                          compute top-rez-fiyati rounded =
                              top-rez-fiyati + ( romhrk-tl-tutar / 
                                konuk-kur-degeri)    
                        when 2
                         compute top-rez-fiyati rounded =
                              top-rez-fiyati + ( romhrk-tl-tutar / 
                                konuk-kur-degeri)    
                        when 3
                         compute top-rez-fiyati rounded =
                              top-rez-fiyati + ( romhrk-tl-tutar / 
                                konuk-kur-degeri)    
*                        when 66
******************* son anda cikan indirimler ilaydan dslecek
*                            
*                          compute ilay-kom rounded =   
*                            ilay-kom - ( romhrk-tl-tutar / 
*                                konuk-kur-degeri) 
                      end-evaluate
                  
                  read romhrk next 
                      at end move "10" to fs-romhrk
                  end-read
             end-perform 
     end-start.
     
 peryot-fiyat-bul-1.
     open input takvim
     move rez-fiyati    to ilk-rez-fiyati

     initialize g-bul-gun-sayisi
                takvim-rec top-rez-fiyati
     move rez-gir-tar   to takvim-anah
     start takvim key not < takvim-anah
           invalid
                move 1 to g-bul-gun-sayisi
     not invalid
     initialize fs-takvim
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
          if takvim-anah = rez-cik-tar
             move "10" to fs-takvim
             exit perform cycle
          end-if
          if takvim-anah not > rez-cik-tar
             add 1 to g-bul-gun-sayisi
          else
             move "10" to fs-takvim
          end-if
     end-read
     end-perform.

     close takvim.
     initialize aksiyhrk-rec aksiyon-durumu
     move "A"              to aksiyhrk-tipi
     move rez-acenta       to aksiyhrk-acenta
     move rez-gir-tar      to aksiyhrk-tarih
     move rez-pan-tipi     to aksiyhrk-pan-tipi
     move g-bul-gun-sayisi to aksiyhrk-gecele
     read aksiyhrk no lock invalid
          continue
     not invalid
          set aksiyon-var to true
     end-read.
*****>Ayni yer perform edildigi icin giris tarihindeki fiyati bulmasi icin konuldu
        move rez-gir-tar   to takvim-anah.
*****>Ayni yer perform edildigi icin giris tarihindeki fiyati bulmasi icin konuldu
     perform fiyat-bul thru fiyat-bul-exit.

 fiyat-bul.
    if rez-fiyat-fix = "E"
       go fiyat-bulundu
    end-if.

     move 0 to oda-fiyati. 
     move rez-acenta        to fiyat-acenta. 
     move takvim-anah       to fiyat-tarih. 
     move rez-tipi          to fiyat-rez-tipi. 
     move rez-pan-tipi      to fiyat-pan-tipi. 
     move rez-banka         to fiyat-banka. 
     move rez-doviz         to fiyat-doviz. 
     move rez-anlasma       to fiyat-anlasma. 
     move rez-buyuk         to fiyat-buyuk.
     move rez-kucuk         to fiyat-kucuk.
     read fiyat no lock invalid
          go fiyat-bulundu.
     move fiyat-acenta    to fiyatana-acenta. 
     move fiyat-bas-tarih to fiyatana-ilk-tarih.
     move fiyat-bit-tarih to fiyatana-son-tarih.
     move fiyat-rez-tipi  to fiyatana-rez-tipi. 
     move fiyat-pan-tipi  to fiyatana-pan-tipi. 
     move fiyat-banka     to fiyatana-banka. 
     move fiyat-doviz     to fiyatana-doviz. 
     move fiyat-anlasma   to fiyatana-anlasma. 
     move fiyat-buyuk     to fiyatana-buyuk.
     move fiyat-kucuk     to fiyatana-kucuk.
     read fiyatana no lock invalid 
          go fiyat-bulundu.

     move fiyatana-oda-fiyati(rez-oda-konumu) to oda-fiyati. 

     if rez-fiyat-konumu not = spaces and
        rez-fiyat-konumu not = zeroes
        move fiyatana-oda-fiyati(rez-fiyat-konumu) to oda-fiyati 
     end-if

*/********* 
       if rez-nor-indirim not = 0 
       compute oda-fiyati = 
              (((oda-fiyati * rez-nor-indirim) / 100) - oda-fiyati)
       end-if.
*/Early booking orani var ve early booking uygulanacak ise 
     if rez-eb = "E" and fiyatana-eb-oran not = 0 
     compute oda-fiyati = 
            (((oda-fiyati * fiyatana-eb-oran) / 100) - oda-fiyati)
     end-if.
     
*/Kick back
     if fiyatana-kick-back not = 0 
     compute oda-fiyati = 
            (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
     end-if. 

 aksiyonlu-uyar. 
*     if rez-eb = "E" and fiyatana-eb-oran not = 0 
*        and eb-de-aksiyon-hesaplama = 1
*        set aksiyon-yok to true
*     end-if

     if rez-aksiyon-eh = "H" 
        set aksiyon-yok to true
     else
        if rez-eb = "E" and fiyatana-eb-oran not = 0 
           and eb-de-aksiyon-hesaplama = 1
           set aksiyon-yok to true
        end-if
     end-if

     if aksiyon-var
     compute oda-fiyati = ((oda-fiyati * aksiyhrk-ode) / aksiyhrk-gecele). 
*****if oda-fiyati <> rez-fiyati 
        move oda-fiyati  to ilk-rez-fiyati.
 aksiyonlu-uyar-exit. 
     exit. 

 fiyat-bulundu. 
 fiyat-bul-exit. 
     exit.
*
 Form7-Ex-Other.
    evaluate key-status
       when 2010 
            open i-o rez 
            inquire form3-gd-1,
                    last-row in sil-son
            initialize frame-degiskenler
            move sil-son           to frame-kayit-sayi
            move 20                to frame-win-line
            move 20                to frame-win-pos
            move "Hesaplaniyor."   to frame-title
            perform frame-ac

            perform varying sil-i from 2 by 1 until sil-i > sil-son
                    perform frame-goster
                    initialize sil-eh
                    inquire form3-gd-1(sil-i,1),
                            hidden-data in sil-eh
                    if sil-eh <> "E"
                       exit perform cycle
                    end-if
                    inquire form3-gd-1(sil-i,2),
                            cell-data in rez-anah
                    read rez no lock invalid
                         exit perform cycle
                    end-read
                        initialize acen-degis yeni-konum
                        if degis-acenta not = spaces
                           move degis-acenta to rez-acenta
                           move 1 to acen-degis
                        end-if

                        inquire combo-oda-konumu-a value in yeni-konum
                        if yeni-konum not = 0 
                           move yeni-konum to rez-oda-konumu
                           move 2 to acen-degis
                        end-if
                        if acen-degis not = 0
                            
                           accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                           accept rez-edit-zaman from time          |                           
                
                           rewrite rez-rec end-rewrite
                        end-if
            end-perform
            close rez 
            perform frame-kapat
            set exit-pushed to true
       when 2009 
            set exit-pushed to true
     .
*
 Form7-Aft-Initdata.
     modify combo-oda-konumu,        reset-list = 1 mass-update = 1.
     modify combo-oda-konumu-a,
     item-to-add("0-Degistirme")

     open input konum
     initialize konum-rec
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          initialize temp-x
          move konum-anahtar to temp-x
          move "-"           to temp-x(2:)
          move konum-adi     to temp-x(3:)
          modify combo-oda-konumu-a,
                 item-to-add(temp-x)
     end-read
     end-perform
     end-start
     close konum.
     modify combo-oda-konumu-a,   mass-update = 0
                                value combo-oda-konumu-value-a.
     
     .

*
 komisyon-aksiyon. 
   
         initialize aksiyhrk-rec.
         move "K"             to aksiyhrk-tipi.
         move rez-acenta   to aksiyhrk-acenta. 
         move takvim-anah  to aksiyhrk-tarih. 
         move rez-pan-tipi to aksiyhrk-pan-tipi.
         move 0               to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
              initialize aksiyhrk-ode
         end-read
   
         .
 acenta-komisyon-oran.
         initialize acenta-koms  son-kom
         move rez-acenta to acenta-kodu 
         perform varying i from 1 by 1 until (i = 4 or acenta-kodu = spaces)
         read acenta no lock 
            invalid display message box "Hata No :kara38872acen"
         end-read
         move acenta-kom-orani to kom(i) son-kom
         move acenta-rap-sira to acenta-kodu
         end-perform
         if kom(3) = 0 then
           if kom(2) = 0 then
             move kom(1) to kom(3)
             move 0 to kom(1)
             else
             move kom(2) to kom(3)
             move kom(1) to kom(2)
             move 0 to kom(1)
           end-if
         end-if 
*         if REZ-NOR-INDIRIM > kom(1)
*            compute REZ-NOR-INDIRIM  =  REZ-NOR-INDIRIM -  kom(1)
*            move 0 to   kom(1)
*            if   REZ-NOR-INDIRIM > kom(2)
*                compute REZ-NOR-INDIRIM  =  REZ-NOR-INDIRIM -  kom(2)
*                      move 0 to   kom(2)
*                     if   REZ-NOR-INDIRIM > kom(3)
*                           move 0 to   kom(3)
*                         else 
*                          compute kom(3)  =  kom(3) - REZ-NOR-INDIRIM 
*                       end-if
*                   else
*                  compute kom(2)  =  kom(2) - REZ-NOR-INDIRIM 
*               end-if
*              else
*                compute kom(1)  =  kom(1) - REZ-NOR-INDIRIM 
*          end-if
         move REZ-NOR-INDIRIM  to kom-ind 
         if komis-dahil = 1 then 
         initialize acenta-kom acenta2-kom acenta3-kom
         if  kom(1) > kom-ind

          compute acenta-kom rounded = (( top-rez-fiyati/(100 - rez-nor-indirim) * 100 )) * ( kom(1) - kom-ind ) /100
           initialize kom-ind
             else 
             subtract kom(1) from kom-ind
          end-if
         if  kom(2) > kom-ind

         compute acenta2-kom rounded = ((top-rez-fiyati /(100 - rez-nor-indirim) * 100)) * ( kom(2) -  kom(1)  - kom-ind  ) /100
          initialize kom-ind
          else 
             subtract kom(2) from kom-ind

         end-if
         if  kom(3) > kom-ind

         compute acenta3-kom rounded = ((top-rez-fiyati /(100 - rez-nor-indirim) * 100)) * ( kom(3) - kom(2) - kom-ind  ) /100
         end-if
         compute otel-net rounded = top-rez-fiyati - (acenta-kom + acenta2-kom + acenta3-kom)


         else
         compute  top-rez-fiyati rounded =  top-rez-fiyati / (100 - rez-nor-indirim) * 100 / (100 - son-kom) * 100 
         compute acenta-kom rounded      = top-rez-fiyati /(100 - rez-nor-indirim) * 100  * kom(1)/100
         compute acenta2-kom rounded     = top-rez-fiyati /(100 - rez-nor-indirim) * 100 * (kom(2)-kom(1))/100
         compute acenta3-kom rounded     = top-rez-fiyati /(100 - rez-nor-indirim) * 100 * (kom(3)-kom(2))/100
*        stop " "
            compute top-rez-fiyati rounded = top-rez-fiyati * ( 100 - rez-nor-indirim ) / 100

         if son-kom <  rez-nor-indirim
              compute otel-net rounded = top-rez-fiyati 

           else
              compute otel-net rounded = top-rez-fiyati - (acenta-kom + acenta2-kom + acenta3-kom)
         end-if
         end-if
         .
         
         
         .
 
