* profrap.evt
* profrap.evt is generated from D:\asya\acugt.ytl\otel\profrap.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
    open input kllnc
    initialize kllnc-rec
    move k-kodu-tasi to k-kodu
    read kllnc no lock invalid 
       continue 
    end-read 
    close kllnc
     .
*
 Form1-Bef-Initdata. 
     .
*
 ekran-goster.
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-07 com-01.
     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to bu-tarih takvim-anah
    open input takvim 
    start takvim key > takvim-anah
       invalid continue
       not invalid
        read takvim next end continue
         not end move takvim-anah to yarin-tarih
        end-read
        read takvim previous end continue
         not end move takvim-anah to dun-tarih
        end-read
        read takvim previous end continue
         not end move takvim-anah to dun-tarih
        end-read
    end-start
      initialize takvim-rec
     start takvim key > takvim-anah
       invalid continue
       not invalid
        read takvim next end continue
         not end move takvim-anah to takvimilk
        end-read
    end-start
      move "99999999"  to  takvim-rec
     start takvim key < takvim-anah
       invalid continue
       not invalid
        read takvim previous end continue
         not end move takvim-anah to takvimson
        end-read
    end-start


    close takvim
    move tarih-tasi to bu-tarih
    display acc-01aa acc-02aa acc-03aa
    perform inhouse-ayar
    move "A" to rap-sir.
    move "A" to det-tip.
    move "E" to cin-oda.
    perform ekran-goster.
     .
*
*
 cout-ayar.
   
   


    
    move takvimilk    to ilk-tarih
    move takvimson    to son-tarih
    move bu-tarih  to cik-son-tarih cik-ilk-tarih
  
    
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a

         .
*
 cin-ayar.
     
      move takvimilk    to cik-ilk-tarih
      move takvimson    to cik-son-tarih
       move bu-tarih  to ilk-tarih son-tarih
       
    
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a
          


         .
*
 inhouse-ayar.
     open input takvim
     move bu-tarih to takvim-anah
     start takvim key > takvim-anah
         invalid continue
         not invalid
         read takvim next no lock end continue
            not end move takvim-anah to sonraki-tarih
         end-read
         read takvim previous no lock end continue
            not end move takvim-anah to onceki-tarih
         end-read
        read takvim previous no lock end continue
            not end move takvim-anah to onceki-tarih
         end-read
     end-start
     close takvim
       move onceki-tarih to son-tarih 
      move takvimilk     to ilk-tarih
      move takvimson     to cik-son-tarih
      move bu-tarih      to son-tarih 
      move sonraki-tarih to cik-ilk-tarih
       
    
       display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a
   



          .



      
*
 Form1-Ex-Other.
*///// paragrapf devam etttigi icin 
*///// key statusten sonra exit paragraph koymali
    evaluate key-status
      when 11
        perform cout-ayar
      when 10
        perform cin-ayar
      when 9
        perform inhouse-ayar

      when 1
        evaluate control-id
        when 43
            initialize pazar-cagir
            move "R"   to pazar-tipi-cagir
            call "/asya/ytl/obj/otel/rehara.asy"
              using pazar-cagir
              on exception
                 perform callerr-proc
              not on exception
                 cancel "/asya/ytl/obj/otel/rehara.asy" 
            end-call
            move pazar-kodu-cagir     to rehber-kodu
            display acc-rehber
            perform rehber-goster
        when 12
        when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to acn-kod
                        display acc-07
                     end-if
             end-call
             move 4 to accept-control
             move 12 to control-id
        end-evaluate
        exit paragraph
       when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre
              
       when 2
        perform ekran-takas1-al thru ekran-takas1-al-exit
        open input acenta konum yanrez  prohrk musteri    
        initialize takas1-rec 
        move 1 to kayit-varmi
        evaluate rap-sir
          when "A"
            start takas1 key not < takas1-anah-1 invalid 
                  move 0 to kayit-varmi
            end-start
          when "B"
            start takas1 key not < takas1-anah-2 invalid 
                  move 0 to kayit-varmi
            end-start
          when "C"
            start takas1 key not < takas1-anah-3 invalid 
                  move 0 to kayit-varmi
            end-start
          when "D"
            start takas1 key not < takas1-anah-4 invalid 
                  move 0 to kayit-varmi
            end-start
          when "E"
            start takas1 key not < takas1-anah-5 invalid 
                  move 0 to kayit-varmi
            end-start

        end-evaluate
*/// kayit yoksa
        if kayit-varmi = 0
           move 4 to mesaj-no
           perform mesaj-ver
           close acenta konum kodlar02 odalar yanrez prohrk musteri   
           close takas1 
           delete file takas1
           exit paragraph
        end-if

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Profil Kontrol Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Profil Kontrol Raporu" to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"          to det-dokumer-20(10:1)
     move "Acenta.:"     to det-filler(01:10)
     if acn-kod = spaces 
        move "Tum Acentalar" to det-filler(11:)
     else
        move acn-kod to acenta-kodu
        read acenta no lock invalid continue
        not invalid
        move acenta-adi      to det-filler(11:)
        end-read
     end-if
     if cb-nor-v not = 1 then 
         move "G.REPEAT VE VIP MISAFIRLER" TO  det-filler(35:) 
     end-if
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LRLLLLLLLLLRRRRRLLLLLLLLLLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay cinsiyet-icmal
     move "1"                           to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2)     
     move "C/in Tarih"                  to det-1
     move "Saat"                        to det-24
     move "C/Out Tar."                  to det-17
     move "Rez. No."                    to det-2
     move "Sira"                        to det-9
     move "Acenta Adi"                  to det-10
     move "Adi       "                  to det-3
     move "Soyadi    "                  to det-4
     move "Tel No"                      to det-11
     move "E-mail Adres"                to det-111
     move "Rez E-mail"                to det-112
     move "Register E-mail"                to det-113
     move "Blok"                        to det-5
     move "Profil No"                   to det-51
     move "Pax"                         to det-6
     move "Chi"                         to det-7
     move "Fre"                         to det-8
     move "Beb"                         to det-88
     move "Re#"                         to det-19
     move "H.D.G.S"                     to det-19-19
     move "Kart No"                     to det-221
     move "Tc No"                   to det-225
     move "Kontak"                      to det-257
     move "Pas. No"                     to det-226
     move "GSM No"                      to det-22
     move "Adres"                       to det-23
     move "Ilce"                        to det-23i
     move "IL"                          to det-23s
     move "Uyruk"                       to det-23y
     move "Ulke"                        to det-23u
     move "Dogum Tarihi"                to det-231
     move "Evlilik Tarihi"              to det-232
     move "Mevcut Kart"                 to det-13
     move "Hak Ettigi Kart"             to det-16
     move "Rz. Tipi "                   to det-18
     move "Puan"                        to det-12
     move "C/I"                         to det-20
     move "Fiyat"                       to det-211
     move "Dov"                         to det-222
     move "Aciklama"                    to det-21
     move "Plaka"                       to det-25
     move "Isl.Tarihi"                  to det-26
     move "Grup"                        to det-27
     move "Tipi"                        to det-28
     move "Kbl Tarihi"                  to det-29
     move "Cinsiyet"                    to det-30
*     move "Plaka"                       to det-14

     move "|" to fil-1  fil-2  fil-3  fil-4  fil-5  
                 fil-6  fil-7  fil-8  fil-9  fil-10
                 fil-11 fil-12 fil-13 |fil-14              
                 fil-16 fil-17 fil-18 fil-19 fil-20
                 fil-21 fil-22 fil-23 fil-24 fil-25 
                 fil-26 fil-27 fil-28 fil-29  fil-30
                 fil-19-19 fil-221 fil-225 fil-226 
                 fil-257 fil-211 fil-222 fil-23s 
                 fil-23i fil-23u fil-23y fil-231 
                 fil-232 fil-51 fil-88 fil-111 fil-112 fil-113
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1  det-2  det-3  det-4  det-5
                     det-6  det-7  det-8  det-9  det-10
                     det-11 det-12 det-13 |det-14 
                     det-16 det-17 det-18 det-19 det-20
                     det-21 det-22 det-23 det-24 det-25
                     det-26 det-27 det-28 det-29 det-30
                     det-88 det-111 det-211 det-222  det-112 det-113
                     det-221 Det-225 det-226 det-257
                     det-19-19 det-23s det-23u det-23y 
                     det-231 det-232 det-51
                 
     write dokumer-rec from detay

**************************
              open input ozluk karttip rezweb
              initialize fs-takas1
              perform with test after until fs-takas1 = "10"
                read takas1 next no lock end move "10" to fs-takas1
                  not at end
                  initialize dokumer-rec detay
                  move takas1-gun         to gun-x 
                  move takas1-ay          to ay-x 
                  move takas1-yil         to yil-x 
                  move "/"                to fil-1x fil-2x
                  move tarih-x            to det-1
                  move takas1-rez-no      to det-2
                  move takas1-adi         to det-3
                  move takas1-soyadi      to det-4
                  move takas1-gel-saat    to saat-x
                  move takas1-gel-dak     to dak-x
                  move zaman-x            to det-24
                  initialize odalar-rec
                  move takas1-oda         to det-5 odalar-anah
                  read odalar no lock invalid 
                       continue
                  end-read
                  if odalar-uzun-no not = spaces
                     move odalar-uzun-no to det-5
                  end-if
         
 



                  move takas1-pax         to det-6
                  move takas1-chi         to det-7
                  move takas1-free        to det-8
                  move takas1-bebek       to det-88
                  move takas1-rez-mail to det-112
                  move takas1-register-mail to det-113
                  move takas1-acenta to acenta-kodu
                  read acenta no lock invalid move all "*" to acenta-adi
                    not invalid move acenta-adi to det-10
                  end-read
              
                  move takas1-oda-konumu to konum-anahtar
                  read konum no lock invalid move all "*" to konum-adi,end-read

                  move takas1-fiy-konumu to konum-anahtar
                  read konum no lock invalid move all "*" to konum-adi,end-read
                  initialize kodlar02-rec
                  move "v"    to kodlar02-tipi
                  move takas1-vip to kodlar02-kodu
                  read kodlar02 no lock invalid
                       move all "*" to kodlar02-adi                      
                  end-read
                     if takas1-vip = " "
                        move "NORMAL"         to det-28
                     else   
                        move kodlar02-adi      to det-28
                     end-if

                  move takas1-cik-gun     to gun-x
                  move takas1-cik-ay      to ay-x
                  move takas1-cik-yil     to yil-x
                  move tarih-x           to det-17
                  
                  move takas1-rez-tipi    to det-18
                 
                  move takas1-c-in        to det-20
                  move takas1-not         to det-21
                  move takas1-fiyat       to z-7
                  move z-7                to det-211 
                  move takas1-doviz       to det-222
                  move takas1-grup        to det-27

                  move takas1-isl-gun         to gun-x 
                  move takas1-isl-ay          to ay-x 
                  move takas1-isl-yil         to yil-x 
                  move "/"                to fil-1x fil-2x
                  move tarih-x            to det-26
                  move 1 to z-sira
                  move z-sira               to det-9
                  move takas1-anl-gun         to gun-a
                  move takas1-anl-ay          to ay-a 
                  move takas1-anl-yil         to yil-a 
                  move "/"                to fil-1a fil-2a
                  move tarih-a            to det-29
                  
                  move "|" to fil-1  fil-2  fil-3  fil-4  fil-5  
                              fil-6  fil-7  fil-8  fil-9  fil-10
                              fil-11 fil-12 fil-13 |fil-14              
                              fil-16 fil-17 fil-18 fil-19 fil-20
                              fil-21 fil-22 fil-23 fil-24 fil-25 
                              fil-26 fil-27 fil-28 fil-29  fil-30
                              fil-19-19 fil-221 fil-225 fil-226 
                              fil-257 fil-211 fil-222 fil-23s 
                              fil-23i fil-23u fil-23y fil-231 
                              fil-232 fil-51 fil-88 fil-111  fil-112 fil-113
                  initialize yanrez-rec
                  move takas1-rez-no          to yanrez-rezno
                  move 1 to yanrez-sirano
                  read yanrez no lock invalid
                       continue
                  end-read
                  perform gel-say-bul
                  move 0 to mail-yok adres-yok tel-yok
                  perform profil-oku
                  initialize ozluk-rec
                  move takas1-folio to ozluk-folio
                  read ozluk no lock invalid
                       continue
                  not invalid
                      move ozluk-plaka   to det-25
                  end-read 

                  evaluate musteri-kim-cinsiyet       |firat tolga cöm istegi  18/05/2021
                      when "E"
                           move "Erkek" to det-30
                           add 1 to erkek-icmal
                      when "K" 
                           move "Kadin" to det-30
                           add 1 to kadin-icmal
                  end-evaluate

                  if regde-bak = 1 then
                     if mail-yok = 1 or adres-yok = 1 or tel-yok then 
                        if takas1-folio > 0 then
                           move takas1-folio to ozluk-folio
                           read ozluk no lock invalid
                                continue
                           not invalid
                               move ozluk-telno to det-11
                               if det-11 = spaces
                                  move takas1-telefon-no to det-11
                               end-if 
                               move OZLUK-E-MAIL to det-111
                               if ozluk-adres1 not = spaces or ozluk-adres2 not = spaces 
                                  string  ozluk-adres1 delimited by "   "
                                       " " delimited by size
                                       ozluk-adres2 delimited by "   "
                                         " " delimited by size
                                       ozluk-ilce   delimited by "   "
                                        " " delimited by size
                                   into det-23
                                  move ozluk-ilce  to det-23i
                                  move ozluk-il  to det-23s
                                  move ozluk-ulke  to det-23u
                               end-if                                  
                               if det-111 not = spaces 
                                  move 0 to mail-yok
                               end-if
                               if det-23  not = spaces
                                  move 0 to adres-yok
                               end-if
                               if det-11  not = spaces
                                  move 0 to tel-yok
                               end-if
                        
                           end-read
                        end-if
                     end-if
                  end-if

                   move gel-say     to z-say
                   move z-say       to det-19

                   move musteri-gecmis-kalis-sayisi   to z-say
                   move z-say       to det-19-19

                   move yanrez-profil-no  to det-51
                   
                   initialize karttip-rec
                   move musteri-kart-tipi-2   to karttip-kodu
                   read karttip no lock invalid 
                       continue 
                   not invalid 
                       move karttip-adi       to det-16
                   end-read 

                   initialize karttip-rec
                   move musteri-kart-tipi    to karttip-kodu
                   read karttip no lock invalid 
                       continue 
                   not invalid 
                       move karttip-adi              to det-13
                   end-read 
                   if musteri-kazanilan-puan > 0
                      move musteri-kazanilan-puan       to z8
                      move z8                           to det-12
                   end-if                   |||frt...
                   initialize rezweb-rec 
                   move takas1-rez-no to rezweb-rezno
                   read rezweb no lock invalid
                        continue
                   not invalid
                       if rezweb-email <> spaces 
                          move rezweb-email to det-111
                          initialize mail-yok
                       end-if
                   end-read 

                   perform plaka-doldur
                   if det-25 = spaces 
                      move musteri-plaka to det-25
                   end-if
                   

                  evaluate true
                      when adres-yok = 1 and sadece-adres = 1 
                           continue
                      when mail-yok = 1 and sadece-mail = 1 
                           continue
                      when tel-yok = 1 and sadece-tel = 1 
                           continue
                          when kvkk-izinli = 0 and kvkk-bilgi-paylas = 1
                               continue                           
                      when other
                           write dokumer-rec from detay
                  end-evaluate
                 
                  if yan-goster = 1
                     perform yan-detay-ata
                  end-if
                end-read
              end-perform

              

              initialize dokumer-rec detay
              move "-"            to det-dokumer-20(5:1)
              move all "-" to det-1  det-2  det-3  det-4  det-5
                              det-6  det-7  det-8  det-9  det-10
                              det-11 det-12 det-13 |det-14 
                              det-16 det-17 det-18 det-19 det-20
                              det-21 det-22 det-23 det-24 det-25
                              det-26 det-27 det-28 det-29 det-30
                              det-88 det-111 det-211 det-222 det-112 det-113
                              det-221 Det-225 det-226 det-257
                              det-19-19 det-23s det-23u det-23y 
                              det-231 det-232 det-51
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "Toplam" to det-2
              move genel-oda to det-5 
              move genel-pax to det-6
              move genel-chi to det-7
              move genel-fre to det-8
              move genel-beb to det-88

              move "|" to fil-1  fil-2  fil-3  fil-4  fil-5  
                          fil-6  fil-7  fil-8  fil-9  fil-10 
                          fil-11 fil-12 fil-13 |fil-14        
                          fil-16 fil-17 fil-18 fil-19 fil-20 
                          fil-21 fil-22 fil-23 fil-24 fil-25 
                          fil-26 fil-27 fil-28 fil-29 fil-30       
                          fil-19-19 fil-221 fil-225 fil-226  
                          fil-257 fil-211 fil-222 fil-23s    
                          fil-23i fil-23u fil-23y fil-231    
                          fil-232 fil-51 fil-88 fil-111  fil-112 fil-113    

              move "A"          to det-dokumer-20(3:1)
              move 481          to det-renk1
              move "1"          to det-dokumer-20(10:1)
              write dokumer-rec from detay

              initialize dokumer-rec detay
              move "Toplam Erkek" to det-4
              move erkek-icmal    to z-4 
              move z-4            to det-5 

              move "|" to fil-1  fil-2  fil-3  fil-4  fil-5  
                          fil-6  fil-7  fil-8  fil-9  fil-10 
                          fil-11 fil-12 fil-13 |fil-14        
                          fil-16 fil-17 fil-18 fil-19 fil-20 
                          fil-21 fil-22 fil-23 fil-24 fil-25 
                          fil-26 fil-27 fil-28 fil-29  fil-30       
                          fil-19-19 fil-221 fil-225 fil-226  
                          fil-257 fil-211 fil-222 fil-23s    
                          fil-23i fil-23u fil-23y fil-231    
                          fil-232 fil-51 fil-88 fil-111   fil-112 fil-113   

              move "A"          to det-dokumer-20(3:1)
              move 481          to det-renk1
              move "1"          to det-dokumer-20(10:1)
              write dokumer-rec from detay

              initialize dokumer-rec detay
              move "Toplam Kadin" to det-4
              move kadin-icmal    to z-4 
              move z-4            to det-5 

              move "|" to fil-1  fil-2  fil-3  fil-4  fil-5  
                          fil-6  fil-7  fil-8  fil-9  fil-10 
                          fil-11 fil-12 fil-13 |fil-14        
                          fil-16 fil-17 fil-18 fil-19 fil-20 
                          fil-21 fil-22 fil-23 fil-24 fil-25 
                          fil-26 fil-27 fil-28 fil-29  fil-30       
                          fil-19-19 fil-221 fil-225 fil-226  
                          fil-257 fil-211 fil-222 fil-23s    
                          fil-23i fil-23u fil-23y fil-231    
                          fil-232 fil-51 fil-88 fil-111 fil-112 fil-113

              move "A"          to det-dokumer-20(3:1)
              move 481          to det-renk1
              move "1"          to det-dokumer-20(10:1)
              write dokumer-rec from detay



              initialize dokumer-rec detay
              move "-"            to det-dokumer-20(5:1)
              move all "-" to det-1  det-2  det-3  det-4  det-5
                              det-6  det-7  det-8  det-9  det-10
                              det-11 det-12 det-13 |det-14 
                              det-16 det-17 det-18 det-19 det-20
                              det-21 det-22 det-23 det-24 det-25
                              det-26 det-27 det-28 det-29 det-30
                              det-88 det-111 det-211 det-222 det-112 det-113
                              det-221 Det-225 det-226 det-257
                              det-19-19 det-23s det-23u det-23y 
                              det-231 det-232 det-51
              write dokumer-rec from detay
               close ozluk rezweb
              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close takas1 acenta karttip konum kodlar02 odalar yanrez  prohrk musteri  
              delete file takas1 
              delete file dokumer
    end-evaluate.
*
 plaka-doldur.
    move 1 to  xson-sira 
    if genel-plaka not = 1
       move ozluk-plaka to det-25
    else
       open i-o plaka
       initialize plaka-rec
       move takas1-folio  to plaka-folio   
        add 1     to plaka-sira  
       read plaka no lock invalid 
            continue 
       not invalid 
           if plaka-text <> spaces 
              perform plaka-ekle 
           end-if
       end-read
        add 1     to plaka-sira  
       read plaka no lock invalid 
            continue 
       not invalid 
           if plaka-text <> spaces 
              perform plaka-ekle 
           end-if
       end-read
        add 1     to plaka-sira  
       read plaka no lock invalid 
            continue 
       not invalid 
           if plaka-text <> spaces 
              perform plaka-ekle 
           end-if
       end-read
        add 1     to plaka-sira  
       read plaka no lock invalid 
            continue 
       not invalid 
           if plaka-text <> spaces 
              perform plaka-ekle 
           end-if
       end-read
       close plaka
    end-if
     .
*
 plaka-ekle.
    initialize xi
    perform varying xi from 1 by 1 until xi > 20
       if plaka-text(xi:2) = spaces 
          subtract 1 from xi 
          exit perform
       end-if
    end-perform 
    if xi > (40 - xson-sira)
       exit paragraph
    end-if
    move plaka-text(1:xi) 
                     to det-25(xson-sira:xi)
    if xson-sira < xi
       move xi to xson-sira
    else 
       add xi  to xson-sira
    end-if
    add 1            to xson-sira 
    move ","         to det-25(xson-sira:1)
    add 1            to xson-sira 
     .
*
 profil-oku.
          move 0 to kvkk-izinli
        initialize musteri-rec
       move yanrez-profil-sirket  to musteri-sirket  
       move yanrez-profil-no      to   musteri-no
        initialize det-23 det-23s det-23u  det-23y det-111
       read musteri no lock invalid 
            continue
       not invalid
           move musteri-puan-kart-no  to det-221
           move musteri-arac-model to det-257
         if musteri-gizlilik = 1 or k-kvkk-bilgileri-gorebilir = 1
          if musteri-kim-uyruk  = "TC   " 
               if musteri-kim-tcno <> spaces  
                   move musteri-kim-tcno to det-225
               end-if
          else
              move musteri-seri-no to det-226
          end-if

          
          move musteri-gsm    to det-22
          move musteri-tel1   to det-11
          move musteri-e-mail to det-111
          initialize det-23 det-23s det-23u det-23y
          if musteri-kis-adrs not = spaces
              string  musteri-kis-adrs delimited by "   "
               " " delimited by size
               musteri-kis-adrs1 delimited by "   "
               into det-23

          else
            string  musteri-adres1 delimited by "   "
                " " delimited by size
               musteri-adres2 delimited by "   "
              
               into det-23 
         
          end-if
       

             if musteri-kis-il(1:10) = spaces and musteri-kis-il(11:1) <> spaces
                      initialize musteri-kis-il(11:1)
             end-if

              
             move  musteri-kis-il to det-23s
             move  musteri-kis-ilce to det-23i
   

             if musteri-dyil > 1900 then 
                 move musteri-dgun     to gun-x
                  move musteri-day      to ay-x
                  move musteri-dyil     to yil-x
                  move tarih-x           to det-231
             end-if
             if musteri-eyil > 1900
                   move musteri-egun     to gun-x
                  move musteri-eay      to ay-x
                  move musteri-eyil     to yil-x
                  move tarih-x           to det-232
             end-if
           end-if
        end-read
                   
                  open input ulke
                   initialize ulke-rec
                   move musteri-ulke to ULKE-ANAH1
                   read ulke no lock invalid        
                           continue
                   not invalid
                              move  ulke-adi  to det-23u
                   end-read
                 close ulke
 
                  open input uyruk
                   initialize uyruk-rec
                   move musteri-kim-uyruk to uyruk-KODU
                   read uyruk no lock invalid        
                           continue
                   not invalid
                              move  uyruk-adi1  to det-23y
                   end-read
                 close uyruk 

           if det-111 = spaces and det-112 = spaces and det-113 = space
              move 1 to mail-yok
           end-if
           if det-23 = spaces
              move 1 to adres-yok
           end-if
           if spaces = det-11 and det-257
              move 1 to tel-yok
           end-if
           if kvkk-bilgi-paylas = 1 
              if musteri-gizlilik = 1 
                   move 1 to kvkk-izinli
              end-if 
           end-if 
        .
* 
 gel-say-bul.
        initialize gel-say
        
        initialize prohrk-rec 
       
        move yanrez-profil-sirket   to prohrk-profil-sirket
        move yanrez-profil-no       to prohrk-profil-no
        start prohrk key not < prohrk-anah invalid
              continue
        not invalid
        perform with test after until fs-prohrk = "10"
        read prohrk next no lock end move "10"   to fs-prohrk
        not at end
               if prohrk-profil-no <> yanrez-profil-no or
                  prohrk-profil-sirket <> yanrez-profil-sirket 
                     move "10"   to fs-prohrk
                     exit perform
               end-if
             
             
               if prohrk-rez-durumu not = "S"
 
                 
                   add 1 to gel-say
               end-if

        end-read
        end-perform
        end-start.

 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid move 1 to ekran-fis-1.

    add 1 to ekran-fis-1.
 
    move ekran-fis-1(2:) to takas1-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    open output takas1 close takas1 open i-o takas1 with mass-update.

*
 ekran-takas1-al.
    perform takas-dosya-ac.
    initialize  rez-rec tarih-topla tarih-x genel-topla konum-dizi.
    move ilk-tarih to rez-gir-tar.
    move "I"       to rez-durumu.
    open input rez banka doviz kodlar02 odalar grup takvim konuk.
    start rez key not < rez-gir invalid 
         close rez  banka doviz grup takvim yanrez konuk
         initialize mesaj-link
         move 17 to mesaj-no
         perform mesaj-ver
         go ekran-takas1-al-exit.
 ekran-takas1-oku.
    read rez next no lock end 
         close rez banka doviz grup takvim konuk
         go ekran-takas1-al-exit.
         
    if fs-rez = 99 go ekran-takas1-oku.
    if rez-durumu not = "I" 
       close rez banka doviz grup  takvim konuk
       go ekran-takas1-al-exit.
    if rez-gir-tar > son-tarih 
       close rez banka doviz grup takvim  konuk
       go ekran-takas1-al-exit.
    if rez-cik-tar < cik-ilk-tarih go ekran-takas1-oku.
    if rez-cik-tar > cik-son-tarih go ekran-takas1-oku.

    if acn-kod not = spaces and rez-acenta not = acn-kod
                            go ekran-takas1-oku.
    if rez-k-g-b  not = "K" go ekran-takas1-oku.


*    if ( rez-vip = "V" and cb-vip-v = 0 ) or 
*       ( rez-vip = "T" and cb-top-v = 0 ) or
*       ( rez-vip = "B" and cb-bal-v = 0 ) or
*       ( rez-vip = "G" and cb-tek-v = 0 ) or
*       ( rez-vip = "1" and cb-vip1-v = 0 ) or
*       ( rez-vip = "2" and cb-vip2-v = 0 ) or
*       ( rez-vip = "3" and cb-vip3-v = 0 ) or
*       (( rez-vip = "N" or rez-vip= " " )  and cb-nor-v = 0 ) then
*                           go ekran-takas1-oku.
      if ((rez-vip = "N" or rez-vip = " ") and cb-nor-v = 0 ) or
         ((rez-vip   not = "N" and rez-vip not = " ") and cb-vip2-v = 0)
         go ekran-takas1-oku.

***************[><]
    
    if filtre-var = 1 then       
       perform filtre
       if filtre-gecti not = 1 then 
             go ekran-takas1-oku
       end-if
    end-if

    if onkpara-referans-var = 1 then
     
       perform ref-filtre
       if  not ref-gecti then 
           go ekran-takas1-oku
       end-if
    end-if
    if rapor-grup not = zeroes and 
       rapor-grup not = rez-grup-no 
           go ekran-takas1-oku
    end-if
    if rehber-kodu not = spaces and
       rehber-kodu not = rez-rehber
           go ekran-takas1-oku
    end-if

      perform yanrez-profil-bul
      if profil-var = 1 and 
         cm1-val(1:1) = "G"         
          go ekran-takas1-oku
      end-if

      if profil-yok = 1 and 
         cm1-val(1:1) = "S"
          go ekran-takas1-oku
      end-if


***************[><]
*/
*/IF TARIH-X = ZEROES MOVE REZ-GIR-TAR TO TARIH-X.
*/IF REZ-GIR-TAR = TARIH-X CONTINUE ELSE PERFORM EKRAN-TARIH-TOPLAM
*/                                       INITIALIZE TARIH-TOPLA
*/                         MOVE REZ-GIR-TAR TO TARIH-X.

    initialize takas1-rec.
    if onkpara-referans-var = 1 then
      move xkonum-ref(rez-oda-konumu) to takas1-ref
    end-if
    move rez-gir-tar    to takas1-tarih.
    move rez-gel-zaman  to takas1-gel-zaman.
    move rez-isl-tar    to takas1-isl-tar.
    move rez-al-tar     to takas1-anl-tar
    move rez-no         to takas1-rez-no.
    read takas1 no lock invalid continue.
    move rez-acenta     to takas1-acenta.
    move rez-pazar      to takas1-pazar.
    move rez-odano      to takas1-oda.
    move rez-oda-konumu to takas1-oda-konumu.
    move rez-fiyat-konumu to takas1-fiy-konumu.
    move rez-s-d-t-g    to takas1-s-d-t-g.
    move rez-adi        to takas1-adi.
    move rez-soyadi     to takas1-soyadi.
    move rez-pan-tipi   to takas1-pan-tipi.
    move rez-odeme-tipi to takas1-odeme-tipi.
    move rez-anlasma    to takas1-anlasma.
    move rez-buyuk      to takas1-pax.
    move rez-kucuk      to takas1-chi.
    move rez-free       to takas1-free.
    move rez-bebek      to takas1-bebek.
    move rez-tipi       to takas1-rez-tipi.
    move rez-cik-tar    to takas1-cik-tarih.
    move rez-voucher    to takas1-voucher.
    move rez-c-in       to takas1-c-in.
    move rez-grup-no    to takas1-grup.
**    move rez-eb         to takas1-eb
    move rez-isl-tar    to takas1-isl-tar
    move rez-vip        to takas1-vip
    move rez-fiyati     to z-7
    move z-7            to takas1-fiyat


     move rez-mail-adr to takas1-rez-mail

    perform gece-bul
    move rez-odano to odalar-no
        read odalar no lock invalid continue
          not invalid
            initialize kodlar02-rec
            
            move "C" to kodlar02-tipi
            move house-durumu to kodlar02-kodu
            read kodlar02 no lock invalid move all spaces to takas1-oda-durumu
              not invalid
                move kodlar02-adi to takas1-oda-durumu
            end-read
            
            
        end-read
    initialize konuk-rec
    move rez-folio to takas1-folio  konuk-folio
    read konuk no lock invalid
        continue 
    end-read 
    move konuk-telefon-no to takas1-telefon-no
    move konuk-mail-adr to takas1-register-mail
    move rez-banka      to banka-kodu
       read banka no lock invalid
            move all "*" to banka-adi
       end-read
       move rez-doviz      to doviz-kodu
       read doviz no lock invalid
            move all "*" to d-kisa-adi
       end-read  
       move d-kisa-adi to takas1-doviz
    if det-tip = "A"
       move rez-not1    to takas1-not
      
       move rez-not2  to takas1-not(21:)           
       
    else
       
       initialize takas1-not
       move banka-adi    to yeni-detay-1
       move d-kisa-adi   to yeni-detay-2
       move rez-fiyati   to z-15
       move z-15         to yeni-detay-3
       move yeni-detay   to takas1-not
    end-if.

    compute genel-oda = genel-oda + 1
    compute genel-pax = genel-pax + rez-buyuk.
    compute genel-chi = genel-chi + rez-kucuk.
    compute genel-fre = genel-fre + rez-free.
    compute genel-beb = genel-beb + rez-bebek.
    write takas1-rec invalid rewrite takas1-rec.
    go ekran-takas1-oku.
 ekran-takas1-al-exit.
    exit.
*
 gece-bul.
      initialize takas1-geceleme 
      move rez-gir-tar to takvim-anah
      start takvim key >= takvim-anah
      invalid
      continue
      not invalid
      perform until fs-takvim = "10"
            read takvim next no lock end move "10" to fs-takvim
              not end
                if takvim-anah < rez-cik-tar
                  add 1 to takas1-geceleme
                  else
                  move "10" to fs-takvim
                end-if
             end-read      
      end-perform
      end-start .
*
 Form1-Aft-Procedure.
    
*
 Form1-Bef-Procedure.
*
 acc-07-Aft-Procedure.
     open input acenta
     if acn-kod = spaces
        move "Tum Acentalar"   to acenta-adi
     else
        move acn-kod    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 12 to control-id
        end-read
     end-if
     display lb-acenadi.
     close acenta.
*
 yan-detay-ata.
     initialize yanrez-rec
     move takas1-rez-no          to yanrez-rezno
     start yanrez key not < yanrez-anah invalid
           continue
     not invalid
     perform with test after until fs-yanrez = "10"
     read yanrez next no lock end move "10"  to fs-yanrez
     not at end
            initialize dokumer-rec detay
            if yanrez-rezno <> takas1-rez-no
               exit perform
            end-if

            move yanrez-sirano to z-sira
            move z-sira        to det-9



            evaluate yanrez-sirano 
            when 2
            if yanrez-profil-no = zeroes and
               yanrez-profil-sirket = spaces and
               cm1-val(1:1) = "G"
                 exit perform cycle
            end-if

                move yanrez-rezno      to det-2
                move yanrez-adi        to det-3
                move yanrez-soyadi     to det-4
                initialize odalar-rec
                move yanrez-odano      to det-5 odalar-anah
                read odalar no lock invalid 
                     continue
                end-read
                if odalar-uzun-no not = spaces
                   move odalar-uzun-no to det-5
                end-if


                move yanrez-profil-no  to det-51
                 move 0 to mail-yok adres-yok tel-yok
                perform gel-say-bul
                perform profil-oku
              
                   move gel-say     to z-say
                   move z-say       to det-19

                move musteri-plaka  to det-25   
                  evaluate musteri-kim-cinsiyet       |firat tolga cöm istegi  18/05/2021
                      when "E"
                           move "Erkek" to det-30
                           add 1 to erkek-icmal
                      when "K" 
                           move "Kadin" to det-30
                           add 1 to kadin-icmal
                  end-evaluate

                perform dok-yaz
                initialize dokumer-rec detay
               
            when 3
                move yanrez-rezno     to det-2
                move yanrez-adi       to det-3
                move yanrez-soyadi    to det-4
                initialize odalar-rec
                move yanrez-odano     to det-5 odalar-anah
                read odalar no lock invalid 
                     continue
                end-read
                if odalar-uzun-no not = spaces
                   move odalar-uzun-no to det-5
                end-if


                move yanrez-profil-no  to det-51
                 move 0 to mail-yok adres-yok tel-yok
                perform gel-say-bul
                  perform profil-oku
                   move gel-say     to z-say
                   move z-say       to det-19
                move musteri-plaka  to det-25   
                  evaluate musteri-kim-cinsiyet       |firat tolga cöm istegi  18/05/2021
                      when "E"
                           move "Erkek" to det-30
                           add 1 to erkek-icmal
                      when "K" 
                           move "Kadin" to det-30
                           add 1 to kadin-icmal
                  end-evaluate

                 perform dok-yaz
                initialize dokumer-rec detay
               
            when 4
                move yanrez-rezno     to det-2
                move yanrez-adi       to det-3
                move yanrez-soyadi    to det-4
                initialize odalar-rec
                move yanrez-odano     to det-5 odalar-anah
                read odalar no lock invalid 
                     continue
                end-read
                if odalar-uzun-no not = spaces
                   move odalar-uzun-no to det-5
                end-if


                 move yanrez-profil-no  to det-51
                  move 0 to mail-yok adres-yok tel-yok
                 perform gel-say-bul
                  perform profil-oku
                   move gel-say     to z-say
                   move z-say       to det-19
                move musteri-plaka  to det-25   
                  evaluate musteri-kim-cinsiyet       |firat tolga cöm istegi  18/05/2021
                      when "E"
                           move "Erkek" to det-30
                           add 1 to erkek-icmal
                      when "K" 
                           move "Kadin" to det-30
                           add 1 to kadin-icmal
                  end-evaluate

               perform dok-yaz
                initialize dokumer-rec detay
               
            when 5
                move yanrez-rezno     to det-2
                move yanrez-adi       to det-3
                move yanrez-soyadi    to det-4
                initialize odalar-rec
                move yanrez-odano     to det-5
                read odalar no lock invalid 
                     continue
                end-read
                if odalar-uzun-no not = spaces
                   move odalar-uzun-no to det-5
                end-if


                 move gel-say     to z-say
                   move z-say       to det-19
                 move yanrez-profil-no  to det-51
                  move 0 to mail-yok adres-yok tel-yok
                 perform gel-say-bul
                  perform profil-oku
                move musteri-plaka  to det-25   
                  evaluate musteri-kim-cinsiyet       |firat tolga cöm istegi  18/05/2021
                      when "E"
                           move "Erkek" to det-30
                           add 1 to erkek-icmal
                      when "K" 
                           move "Kadin" to det-30
                           add 1 to kadin-icmal
                  end-evaluate

                perform dok-yaz
                initialize dokumer-rec detay
               
                
            end-evaluate

*            if (spaces = det-11 and det-257 ) and sadece-tel = 1            |21/05/2020 firat sadece telefon eklemesi
*               exit perform cycle 
*            end-if

     end-read
     end-perform
     end-start
     .
*
 dok-yaz.
      evaluate true
          when adres-yok = 1 and sadece-adres = 1 
               continue
          when mail-yok = 1 and sadece-mail = 1 
               continue
          when tel-yok = 1 and sadece-tel = 1 
               continue
          when kvkk-izinli = 0 and kvkk-bilgi-paylas = 1
               continue
          when other
               write dokumer-rec from detay
      end-evaluate.
* 
 rehber-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "R" to kodlar02-tipi
    move rehber-kodu to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to lb-reh-value
    if rehber-kodu = spaces
       move "Tum Rehber" to lb-reh-value
    end-if
    display lb-rehber
    close kodlar02.
*
 acc-rehber-Aft-Procedure.
    perform rehber-goster.
     
     .
*
 yanrez-profil-bul.
     open input yanrez
     initialize yanrez-rec profil-var profil-yok
     move rez-no          to yanrez-rezno
     start yanrez key not < yanrez-anah invalid
           continue
     not invalid
     perform with test after until fs-yanrez = "10"
     read yanrez next no lock end move "10"  to fs-yanrez
     not at end
            if yanrez-rezno <> rez-no
               exit perform
            end-if
                    if yanrez-profil-no = zeroes and
                       yanrez-profil-sirket = spaces and
                       cm1-val(1:1) = "G" or 
                       yanrez-profil-sirket = "00000000"
                         move 1 to profil-var
                    end-if

                    if yanrez-profil-no not = zeroes and
                       yanrez-profil-sirket not = spaces and
                       cm1-val(1:1) = "S"or 
                       yanrez-profil-sirket = "00000000" 
                         move 1 to profil-yok
                    end-if

            evaluate yanrez-sirano 
            when 2
                    if yanrez-profil-no = zeroes and
                       yanrez-profil-sirket = spaces and
                       cm1-val(1:1) = "G" or 
                       yanrez-profil-sirket = "00000000"
                         move 1 to profil-var
                    end-if
                    if yanrez-profil-no not = zeroes and
                       yanrez-profil-sirket not = spaces and
                       cm1-val(1:1) = "S" or 
                       yanrez-profil-sirket = "00000000"

                         move 1 to profil-yok
                    end-if

            when 3
                    if yanrez-profil-no = zeroes and
                       yanrez-profil-sirket = spaces and
                       cm1-val(1:1) = "G" or 
                       yanrez-profil-sirket = "00000000" 

                         move 1 to profil-var
                    end-if
                    if yanrez-profil-no not = zeroes and
                       yanrez-profil-sirket not = spaces and
                       cm1-val(1:1) = "S" or 
                       yanrez-profil-sirket = "00000000"

                         move 1 to profil-yok
                    end-if

               
            when 4
                    if yanrez-profil-no = zeroes and
                       yanrez-profil-sirket = spaces and
                       cm1-val(1:1) = "G" or 
                       yanrez-profil-sirket = "00000000"

                         move 1 to profil-var
                    end-if
                    if yanrez-profil-no not = zeroes and
                       yanrez-profil-sirket not = spaces and
                       cm1-val(1:1) = "S" or 
                       yanrez-profil-sirket = "00000000" 

                         move 1 to profil-yok
                    end-if

               
            when 5
                    if yanrez-profil-no = zeroes and
                       yanrez-profil-sirket = spaces and
                       cm1-val(1:1) = "G" or 
                       yanrez-profil-sirket = "00000000"
                   

                         move 1 to profil-var
                    end-if
                    if yanrez-profil-no not = zeroes and
                       yanrez-profil-sirket not = spaces and
                       cm1-val(1:1) = "S" or 
                       yanrez-profil-sirket = "00000000" 
                    

                         move 1 to profil-yok
                    end-if                               
            end-evaluate


     end-read
     end-perform
     end-start
     close yanrez
     .


 
