* gruplog.evt
* gruplog.evt is generated from D:\asya\acugt.ytl\otel\gruplog.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-Form1-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form1-Ta-1-Value
        MOVE 0 TO Form1-Pg-1-Visible, Form1-Pg-2-Visible,
            Form1-Pg-3-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form1-Pg-1-Visible
        WHEN 2
           MOVE 1 TO Form1-Pg-2-Visible
        WHEN 3
           MOVE 1 TO Form1-Pg-3-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form1
        PERFORM Form1-Ta-1-Aft-Tabchg-Display
     END-EVALUATE
     .

 Acu-Form3-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form3-Ta-1-Value
        MOVE 0 TO Form3-Pg-1-Visible, Form3-Pg-2-Visible,
            Form3-Pg-3-Visible, Form3-Pg-4-Visible, Form3-Pg-5-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form3-Pg-1-Visible
        WHEN 2
           MOVE 1 TO Form3-Pg-2-Visible
        WHEN 3
           MOVE 1 TO Form3-Pg-3-Visible
        WHEN 4
           MOVE 1 TO Form3-Pg-4-Visible
        WHEN 5
           MOVE 1 TO Form3-Pg-5-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form3
        PERFORM Form3-Ta-1-Aft-Tabchg-Display
     END-EVALUATE
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Gd-2-Event-Proc.
     EVALUATE Event-Control-Id
     WHEN 6
        PERFORM Form1-Gd-3-Ev-Other
     WHEN 10
        PERFORM Form1-Gd-2-Ev-Other
     END-EVALUATE
     .

 Form1-Gd-4-Event-Proc.
     PERFORM Form1-Gd-4-Ev-Other
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form3-Ta-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM Form3-Ta-1-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 Form3-Gd-1-Event-Proc.
     PERFORM Form3-Gd-1-Ev-Other
     .

 Form3-Gd-2-Event-Proc.
     PERFORM Form3-Gd-2-Ev-Other
     .

 Form3-Gd-2-Exception-Proc.
     .

 Form3-Gd-3-Event-Proc.
     PERFORM Form3-Gd-3-Ev-Other
     .

 Form3-Gd-4-Event-Proc.
     PERFORM Form3-Gd-4-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform icyetki-kontrol
     call "c$narg" using link-var.
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read
     close genel.
     open input kllnc
     initialize kllnc-rec 
     move k-kodu-tasi         to k-kodu
     read kllnc no lock invalid 
           display message box "Kullanici Bulunamadi..."
                           title "[ Uyari ]"
                           icon 1
              close kllnc
              exit paragraph 
     end-read 
     close kllnc
     perform read-genelfis.

     move ekran-fis-1     to xbloklog-dosya-no.

     open  i-o rez  takvim.
       
     initialize gec-gecme dondur-baba.


     

       .
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka gruplog-banka.
     move rezpara-doviz       to xrez-doviz gruplog-doviz.
     move rezpara-pan-tipi    to xrez-pan-tipi gruplog-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi gruplog-odeme.
     move rezpara-ulke        to xrez-ulke gruplog-ulke.
     move rezpara-anlasma     to xrez-anlasma gruplog-anlasma.
     move rezpara-pazar       to xrez-pazar gruplog-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil gruplog-gel-yil gruplog-git-yil.
     move calis-ay            to xrez-gir-ay  xrez-cik-ay gruplog-gel-ay gruplog-git-ay.
     move calis-gun           to xrez-gir-gun xrez-cik-gun gruplog-gel-gun gruplog-git-gun.
     move "4"                 to xrez-gr-status.
 default-ata.
*************Default Degerler Ataniyor.........
        continue.
 

*
 Form1-Aft-Initdata.
     open i-o gruplog bloklog close bloklog gruplog
     initialize konumlar-sayi

     move 1 to satistami
     perform load-konum
     
*     move 0 to satistami
*     perform load-konum

     
     perform grid-reset.

     perform default-gecerli-konum   
     perform konumlar-to-cb

     perform rez-parametre-ata
     perform default-ata
     perform gun-bul
     perform form-update

*     perform acenta-oku   thru acenta-oku-exit

     perform banka-oku    thru banka-oku-exit
     perform doviz-oku    thru doviz-oku-exit
     perform firma-oku
     
     perform pansiyon-oku thru pansiyon-oku-exit
     perform odeme-oku    thru odeme-oku-exit
     perform anlasma-oku  thru anlasma-oku-exit
     perform pazar-oku    thru pazar-oku-exit
     perform ulke-oku     thru ulke-oku-exit.
     if link-gruplog-kodu > 0
        move link-gruplog-kodu        to grup-no
        display accept-grup-kodu
        
        move 1 to control-id
        move 4 to accept-control 
        perform Aft-Procedure
        modify accept-grup-kodu,enabled = false
      
     end-if 
      
     exit paragraph.



         
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 okunan-goster.
*************Formu Goster............
           perform gun-bul
           perform form-update
************Degerleri Oku
            perform acenta-oku   thru acenta-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            perform doviz-oku    thru doviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform firma-oku 
               perform not-goster
          
     .
*
 Aft-Procedure.
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
      initialize gec-gecme.
      evaluate control-id
      when 1
         move 0 to y-rez
           if key-status = 52
               exit paragraph
            end-if 
        if grup-no = zeroes
           perform fis-al
           move 1 to y-rez
        end-if

        delete file xbloklog          
          perform gruplog-oku
        delete file takas 

      when 1016
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform banka-oku thru banka-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1017
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform doviz-oku thru doviz-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1018
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform pansiyon-oku thru pansiyon-oku-exit
            if gecmez
               exit paragraph
            end-if 
**********>Kontrat kontrolu....Alotment Rezervasyonar icin...
**********>Aksiyon ve stop-sale kontrolu
**********>KONTROLLER-2. 
             
       when 1019
            if key-status = 52
               exit paragraph
            end-if 
          
            initialize gec-gecme
            perform odeme-oku thru odeme-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1020
            if key-status = 52
               exit paragraph
            end-if 
          
            initialize gec-gecme
            perform anlasma-oku thru anlasma-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1021
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform pazar-oku thru pazar-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1022
            if key-status = 52
               exit paragraph
            end-if 
         
            initialize gec-gecme
            perform ulke-oku thru ulke-oku-exit
            if gecmez
               exit paragraph
            end-if 
        when 1004
        when 1005
        when 1006
            if son-baslangic-tarih <> xrez-gir-tar or 
               son-bitis-tarih <> xrez-cik-tar 
               if xrez-gir-tar < xrez-cik-tar
                  perform load-mygrid
                  move xrez-gir-tar         to son-baslangic-tarih
                  move xrez-cik-tar         to son-bitis-tarih
               end-if
            end-if
        when 1009
        when 1010
        when 1011
            if xrez-gir-tar > xrez-cik-tar 
               display omitted beep
               exit paragraph
            end-if
            if son-bitis-tarih <> xrez-cik-tar 
               perform load-mygrid
               move xrez-cik-tar         to son-bitis-tarih
            end-if
      end-evaluate.
      .
*
 exception-procedure.     
        if key-status = 17
             move gruplog-dosya        to link-logview-dosya-adi
             set link-logview-pointer  to address of gruplog-rec
             set link-logview-rec-size to size of gruplog-rec
             perform logview-call
             initialize key-status
        end-if        
        if key-status  = 3131
            perform mesaj-gonder
        end-if.

*
 acenta-oku.
       open input acenta.
       initialize acenta-rec.
       move xrez-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            perform acen-dft-oku
            
       end-read
       close acenta.
       move acenta-adi     to adi-goster.
      
       modify lb-acenta-e, title = adi-goster.
       initialize adi-goster
       display accept-acenta.
             if y-rez = 1 then
               perform acen-dft-yukle
            end-if   .

 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.

*
*
 firma-oku.
       open input firma.
       initialize firma-rec.
       move xrez-firma   to firma-kodu
       read firma        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            perform firma-dft-oku
       end-read
        
       
       close firma.
       move firma-adi     to sirket-goster.
       
       
       display accept-sirket lb-sirket.
        if y-rez = 1 then
               perform acen-dft-yukle
            end-if   .



*
 takvim-oku.
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.
 takvim-oku-exit.
       exit.







*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to xrez-banka.
 banka-oku.
       
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-banka-sabit = 1 and 
          acen-dft-banka not = xrez-banka
          display message box "Acenta icin sabit banka degeri girilmis" new-line
                              "Banka varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-banka to xrez-banka
        end-if.
       open input banka.
       initialize banka-rec.
       move xrez-banka    to banka-kodu
       read banka        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to adi-goster.
       modify lb-banka-e, title = adi-goster.
       initialize adi-goster
       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-doviz.
 doviz-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-doviz-sabit = 1 and 
          acen-dft-doviz not = xrez-doviz
          display message box "Acenta icin sabit doviz degeri girilmis " new-line
                              "Doviz varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-doviz to xrez-doviz
        end-if.
 
 
       open input doviz.
       initialize doviz-rec.
       move xrez-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-doviz-e, title = adi-goster.
       initialize adi-goster
       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.
       exit.

*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to xrez-pan-tipi.
 pansiyon-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pansiyon-sabit = 1 and 
          acen-dft-pan-tipi not = xrez-pan-tipi
          display message box "Acenta icin sabit pansiyon degeri girilmis" new-line
                              "Pansiyon varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pan-tipi to xrez-pan-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xrez-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pansiyon-e, title = adi-goster.
       initialize adi-goster
       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odemeara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-odeme-tipi.
 odeme-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-odeme-sabit = 1 and 
          acen-dft-odeme-tipi not = xrez-odeme-tipi
          display message box "Acenta icin sabit odeme degeri girilmis" new-line
                              "odeme varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-odeme-tipi to xrez-odeme-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-odeme-e, title = adi-goster.
       initialize adi-goster
       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy" 
       end-call.
       move infox-kodu-cagir     to xrez-anlasma.
 anlasma-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-anlasma-sabit = 1 and 
          acen-dft-anlasma not = xrez-anlasma
          display message box "Acenta icin sabit anlasma degeri girilmis" new-line
                              "Anlasma varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-anlasma to xrez-anlasma
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi.
       move xrez-anlasma       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-anlasma-e, title = adi-goster.
       initialize adi-goster
       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/pazarara.asy" 
       end-call.
       move pazar-kodu-cagir     to xrez-pazar.
 pazar-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pazar-sabit = 1 and 
          acen-dft-pazar not = xrez-pazar
          display message box "Acenta icin sabit pazar degeri girilmis" new-line
                              "Pazar varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pazar to xrez-pazar
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move xrez-pazar         to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pazar-e, title = adi-goster.
       initialize adi-goster
       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ulkeara.asy" 
       end-call.
       move ulke-cagir     to xrez-ulke.
 ulke-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-ulke-sabit = 1 and 
          acen-dft-ulke not = xrez-ulke 
          display message box "Acenta icin sabit ULKE  degeri girilmis" new-line
                              "ULKE  varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-ulke  to xrez-ulke 
        end-if.
       open input ulke.
       initialize ulke-rec.
       move xrez-ulke    to ulke-anah1
       read ulke         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close ulke.
       move ulke-adi     to adi-goster.
       modify lb-ulke-e, title = adi-goster.
       initialize adi-goster
       display accept-ulke.
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.

*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form1-Aft-Routine.
     close rez takvim .
     .
*
 gun-bul.
     initialize gun-s
     move xrez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= xrez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      
                      end-if 
                end-read
             end-perform  
     end-start.
     move gun-s to gun-say
*     display la-gun
      .

     .
*******************************************************************
************ mesaj receiving olayi *******************************
 form-update.

        
        display
            accept-grup-adi
            accept-grup-kodu
            grst-acc
            accept-acenta 
            accept-gir-gun 
            accept-gir-ay 
            accept-gir-yil 
            accept-gir-saat 
            accept-gir-dakika 
            accept-cik-gun 
            accept-cik-ay 
            accept-sirket
            accept-cik-yil 
            accept-cik-saat 
            accept-cik-dakika 
            accept-banka 
            accept-doviz 
            accept-anlasma
            accept-pansiyon 
            accept-odeme 
            accept-pazar 
            accept-ulke 
            accept-not1
            accept-not2
            accept-kur
            accept-ind-orani
            accept-skur
            accept-room-kdv
            accept-extra-kdv
            .
*
*
 firma-dft-oku.
      open input nt
     initialize not-rec 
     move "FIR" to not-dos
     move "Default" to not-dos-anah.
     move firma-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
      

     
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke     
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
      .

*

     .
*


       .
*
 fis-al.
     open i-o genelfis
     initialize genelfis-rec 
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          initialize genelfis-rec
          move 1 to genelfis-anahtar
          write genelfis-rec end-write
     end-read
          add 1 to grup-oto
          rewrite genelfis-rec end-rewrite                 
     close genelfis
     move grup-oto          to grup-no
     display accept-grup-kodu.

*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move xrez-kaynak-1 to onbkodlar10-kodu1
    read onbkodlar10 no lock invalid
        initialize onbkodlar10-rec
    end-read
        move onbkodlar10-adi to kaynak1-tipi-goster
        display acc-kaynak1 lb-kaynak1
    close onbkodlar10.

 kaynak2-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AC" to onbkodlar10-tipi
    move xrez-kaynak-2 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak2-tipi-goster
    display acc-kaynak2 lb-kaynak2
    close onbkodlar10.

 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AD" to onbkodlar10-tipi
    move xrez-kaynak-3 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak3-tipi-goster
    display acc-kaynak3 lb-kaynak3
    close onbkodlar10.


*****************************************************************************
*****************************************************************************
********************************YENÝ BÖLÜM***********************************
*****************************************************************************
*****************************************************************************
*                                                               
 grid-reset.
 
     initialize form1-gd-2-record gmami
     move "       "                     to g1
     perform varying mamii from 1 by 1 until mamii > apo-5
           move "Oda   "       to g21(mamii) 
           move "Pax    "    to g22(mamii) 
           move "Satilan"     to g23(mamii) 
           move "Kalan   "  to g24(mamii)
      end-perform
     modify form1-gd-2,
            reset-grid = 1
            mass-update = 1
            record-to-add(gmami)
          
        
*/ konum bilgileri
    perform varying mamii from 1 by 1 until mamii > apo-5 
      
     modify form1-gd-2(1,( mamii * 4 ) - 2 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 4 ) - 1 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 4 ) - 0 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 4 ) + 1 ) hidden-data = gecerli-konum-kod(mamii)
     end-perform                 


     initialize form1-gd-2-record gmami
     move "Tarih"                     to g1
     perform varying mamii from 1 by 1 until mamii > apo-5
           move gecerli-konum-adi(mamii)       to g21(mamii) g22(mamii) g23(mamii) g24(mamii)
      end-perform
     modify form1-gd-2,
            
            mass-update = 1
            record-to-add(gmami)
           
           modify form1-gd-2 num-col-headings = 2 
*/ konum bilgileri
    perform varying mamii from 1 by 1 until mamii > apo-5 
      
     modify form1-gd-2(1,( mamii * 4 ) - 2 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 4 ) - 1 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 4 ) - 0 ) hidden-data = gecerli-konum-kod(mamii)
     modify form1-gd-2(1,( mamii * 4 ) + 1 ) hidden-data = gecerli-konum-kod(mamii)
     end-perform                                      
    .

*
 load-konum.
     open input konum
     initialize konum-rec
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          if konum-satis <> satistami
             exit perform cycle
          end-if
          add 1 to konumlar-sayi
          move konum-anahtar         to occ-konum-kod(konumlar-sayi)   
          move konum-adi             to occ-konum-adi(konumlar-sayi)   
          move konum-satis           to occ-konum-satis(konumlar-sayi)
          
     end-read
     end-perform
     end-start.
     close konum.

 default-gecerli-konum. 
    perform varying i 
            from 1
            by 1
            until i > apo-5
              
            move  occ-konum-kod(i)     to gecerli-konum-kod(i)
            move  occ-konum-adi(i)     to gecerli-konum-adi(i)
            move  1                    to gecerli-konum-secildimi(i)
                                          occ-konum-secildimi(i)
     end-perform.
*
 gruplog-oku.
     initialize gruplog-rec xgruplog-rec
       
     open i-o gruplog
     move link-gruplog-kodu                   to gruplog-kodu
     move link-gruplog-tarih                  to gruplog-log-tar
     move link-gruplog-zaman                  to gruplog-log-zaman
     read gruplog no lock invalid
          initialize gruplog-rec
          move link-gruplog-kodu              to gruplog-kodu
          perform rez-parametre-ata
          set kayit-yok             to true
     not invalid
            set kayit-var             to true
     end-read
     close gruplog.

     move gruplog-adi       to grup-adi
     move gruplog-firma     to xrez-firma       
     move gruplog-acenta    to xrez-acenta     
     move gruplog-gel-tar   to xrez-gir-tar    
     move gruplog-git-tar   to xrez-cik-tar    
     move gruplog-banka     to xrez-banka      
     move gruplog-doviz     to xrez-doviz      
     move gruplog-pan-tipi  to xrez-pan-tipi   
     move gruplog-odeme     to xrez-odeme-tipi 
     move gruplog-anlasma   to xrez-anlasma    
     move gruplog-pazar     to xrez-pazar      
     move gruplog-ulke      to xrez-ulke       
     move gruplog-not1      to xrez-not1       
     move gruplog-not2      to xrez-not2 
     move gruplog-grup-statu to xrez-gr-status
     move gruplog-kaynak-1   to xrez-kaynak-1
     move gruplog-kaynak-2   to xrez-kaynak-2
     move gruplog-kaynak-3   to xrez-kaynak-3
     move gruplog-kur        to xrez-cin-kuru
     move gruplog-extra-ind  to xrez-extra-ind
     move gruplog-skur       to XREZ-UG-IND
     move gruplog-room-kdv-yok  to room-kdv-yok      
     move gruplog-extra-kdv-yok to extra-kdv-yok

     perform okunan-goster.
     perform bloklog2xbloklog.
     perform load-mygrid. 

*
 accept-grup-kodu-Bef-Procedure.
     initialize kayit-durum.
*

 load-mygrid.
     if kayit-yok
        perform load-mygrid-kayitsiz
     else
        perform load-mygrid-kayitli
     end-if.
*
 load-mygrid-kayitli.
      
     perform kirpma-varmi-kontrol
     initialize mesajcan
     if kirpma-bastan-var
        move kirpma-bastan-durum       to mesajcan
     end-if

     move x"0a0d"                      to mesajcan(149:)
     if kirpma-sondan-var
        move kirpma-sondan-durum       to mesajcan(151:)
     end-if

     if kirpma-bastan-var or
        kirpma-sondan-var
               display message box mesajcan
               title "Bilginize"
               icon mb_warning_icon
     end-if



     open i-o xbloklog
     perform girili-konumlari-al


     perform grid-reset
     perform konumlar-to-cb

     modify Form1-Gd-2,
            mass-update = 1


     perform satilan-kalan-doldur

     initialize i ii takvim-rec
     open input takas 
     move xrez-gir-tar     to takvim-anah
     start takvim key not < takvim-anah invalid
           display message box 
                   "Gecersiz Tarih veya Takvim bilgileri olusturulmamis !!!"
                   icon mb_error_icon
                   title "Bilgi"
           close takvim
           exit paragraph
     end-start
     move 2 to i
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
          if takvim-anah = xrez-cik-tar
             exit perform 
          end-if

          initialize form1-gd-2-record gmami renk
          move takvim-gun                 to egun gizli-gun
          move takvim-ay                  to eay  gizli-ay
          move takvim-yil                 to eyil gizli-yil
          move etarih                     to g1
                  
          perform varying inx-i
                  from 1
                  by 1
                  until inx-i > apo-5

                  initialize xbloklog-rec
                  move grup-no                    to xbloklog-kodu
                  move takvim-anah                to xbloklog-tarih
                  move gecerli-konum-kod(inx-i)   to xbloklog-konum
                  move link-gruplog-tarih         to xbloklog-log-tar
                  move link-gruplog-zaman         to xbloklog-log-zaman
                  read xbloklog no lock invalid
                       continue 
                  end-read

                  initialize takas-rec
                  move takvim-anah              to takas-anahtar
                  move gecerli-konum-kod(inx-i) to takas-konum
                  read takas no lock invalid 
                       continue 
                  end-read 
                  move takas-satilan-adet   to xbloklog-satilan-oda 

                   
                  if xbloklog-ayrilan-oda <> 0 or
                     xbloklog-satilan-oda <> 0 or
                     xbloklog-ayrilan-pax <> 0

                    
                          move xbloklog-ayrilan-oda  to 4z
                          move 4z                 to g21(inx-i)

                          move xbloklog-ayrilan-pax  to 4z
                          move 4z                 to g22(inx-i)
                          move xbloklog-satilan-oda  to 4z
                          move 4z                 to g23(inx-i)
                          compute xbloklog-kalan-oda = 
                                  xbloklog-ayrilan-oda -
                                  xbloklog-satilan-oda
                          move xbloklog-kalan-oda    to 4z
                          move 4z                 to  g24(inx-i)
                          if xbloklog-kalan-oda < 0                              
                             modify form1-gd-2(i + 1,(inx-i * 4) + 1),cell-color = 176
                          end-if 
                    
                     rewrite xbloklog-rec invalid 
                         write xbloklog-rec end-write 
                     end-rewrite 
                  end-if
          end-perform
          
          modify form1-gd-2,
                 record-to-add(gmami)
          add 1 to i
          modify form1-gd-2(i,1)
                 hidden-data = gizli-bilgi
     end-read
     end-perform

     modify form1-gd-2,
            mass-update = 0.

     close xbloklog takas .
*
 load-mygrid-kayitsiz.

     perform grid-reset.

     perform konumlar-to-cb

    
     modify Form1-Gd-2,
            mass-update = 1
     initialize i ii takvim-rec

     move xrez-gir-tar     to takvim-anah
     start takvim key not < takvim-anah invalid
           display message box 
                   "Gecersiz Tarih veya Takvim bilgileri olusturulmamis !!!"
                   icon mb_error_icon
                   title "Bilgi"
           close takvim
           exit paragraph
     end-start
     move 2 to i
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
          if takvim-anah = xrez-cik-tar
             exit perform 
          end-if
          initialize form1-gd-2-record gmami
          move takvim-gun                 to egun gizli-gun
          move takvim-ay                  to eay  gizli-ay
          move takvim-yil                 to eyil gizli-yil
          move etarih                     to gd-2-col-1
          modify form1-gd-2,
                 record-to-add(form1-gd-2-record)
          add 1 to i
          modify form1-gd-2(i,1)
                 hidden-data = gizli-bilgi
     end-read
     end-perform

     modify form1-gd-2,
            mass-update = 0.
    
*
 read-genelfis.
     open i-o genelfis.
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
              move 1 to ekran-fis-1
     end-read
     add 1 to ekran-fis-1
     rewrite genelfis-rec invalid
             write genelfis-rec end-write
     end-rewrite
     close genelfis.

*
 bloklog2xbloklog.
     open output xbloklog close xbloklog
     open i-o bloklog xbloklog.
     initialize bloklog-rec
     move link-gruplog-kodu         to bloklog-kodu
*     move link-gruplog-tarih        to bloklog-log-tar
*     move link-gruplog-zaman        to bloklog-log-zaman
     start bloklog key not < bloklog-anahtar invalid
           continue
     not invalid
     initialize fs-bloklog
     perform with test after until fs-bloklog = "10"
     read bloklog next no lock end move "10" to fs-bloklog
     not at end
          if link-gruplog-kodu <> bloklog-kodu 
                exit perform 
          end-if
          if link-gruplog-tarih <> bloklog-log-tar or
             link-gruplog-zaman <> bloklog-log-zaman
                exit perform cycle 
          end-if 
          move bloklog-rec   to xbloklog-rec
          write xbloklog-rec
     end-read
     end-perform
     end-start
     close bloklog xbloklog.

*
 Form1-Gd-2-Ev-Other.
     evaluate event-type
     when msg-cANCEL-entry

           

     when msg-finish-entry

 
     end-evaluate.
*
 kirpma-varmi-kontrol.
    initialize kirpma-bastan-durum kirpma-sondan-durum 
    open i-o xbloklog
*/ kayit olnuþ baþlangýç tarihinden yeni basþlangýç tarihine kadar kontrol
    if xrez-gir-tar > xgruplog-gel-tar
      initialize xbloklog-rec
      start xbloklog key not < xbloklog-anahtar invalid
            continue
      not invalid
      initialize fs-xbloklog
      perform with test after until fs-xbloklog = "10"
      read xbloklog next no lock end move "10" to fs-xbloklog
      not at end
           if xbloklog-tarih < xrez-gir-tar
              set kirpma-bastan-var to true
              exit perform
           end-if
      end-read
      end-perform
      end-start
    end-if.


*/ kayit olnuþ baþlangýç tarihinden yeni basþlangýç tarihine kadar kontrol
    if xrez-cik-tar < xgruplog-git-tar
      initialize xbloklog-rec
      start xbloklog key not < xbloklog-anahtar invalid
            continue
      not invalid
      initialize fs-xbloklog
      perform with test after until fs-xbloklog = "10"
      read xbloklog next no lock end move "10" to fs-xbloklog
      not at end
           if xbloklog-tarih >= xrez-cik-tar and 
              xbloklog-tarih <= xgruplog-git-tar
              set kirpma-sondan-var to true
              exit perform
           end-if
      end-read
      end-perform
      end-start
    end-if.

    close xbloklog.




*
 Form2-Ex-Other.
    evaluate key-status
    when 27        
    end-evaluate 
     .

*
 dondur-baba.
    add 1 to dondur-baba.
    evaluate dondur-baba
    when 1 modify form1-st-1-handle,panel-index = 1 panel-text = "|"
    when 2 modify form1-st-1-handle,panel-index = 1 panel-text = "/"
    when 3 modify form1-st-1-handle,panel-index = 1 panel-text = "-"
    when 4 modify form1-st-1-handle,panel-index = 1 panel-text = "\"
    when other
         move 0 to dondur-baba
    end-evaluate.
*
 konumlar-to-cb.

    perform varying i
            from 0
            by 1
            until i > 10
            after ii
            from 1
            by 1
            until ii > 4

            compute 2hane = (i * 4) + ii
            if occ-konum-satis(2hane) = 1 
              move 0 to buldum2
             perform varying mamii from 1 by 1 until mamii > apo-5
               if occ-konum-kod(2hane) = gecerli-konum-kod(mamii) then  
                  move 1 to buldum2
                  exit perform 
              end-if
              end-perform
                if buldum2 = 1 
                  move 1 to occ-konum-secildimi(2hane)
                  modify form1-gd-3(i + 1, ii),
                         cell-data = occ-konum-adi(2hane)
                         bitmap = check-bmp
                         bitmap-width = 16
                         bitmap-number = 2
                         hidden-data = occ-konumlar-occurs(2hane)


               else
                  move 0 to occ-konum-secildimi(2hane)
                  modify form1-gd-3(i + 1, ii),
                         cell-data = occ-konum-adi(2hane)
                         bitmap = check-bmp
                         bitmap-width = 16
                         bitmap-number = 1
                         hidden-data = occ-konumlar-occurs(2hane)
               end-if
           
            end-if



    end-perform.
    

    
*
 Form1-Gd-3-Ev-Other.

    evaluate event-type
    when Msg-Bitmap-Clicked 
     
         initialize occ-konumlar-occurs(99)
         inquire form1-gd-3(event-data-2,event-data-1),
                 hidden-data in occ-konumlar-occurs(99)
         if occ-konum-secildimi(99) = 1
            perform konum-cikar
         else
            perform konum-ekle
         end-if
    when msg-begin-entry
         move event-action-fail to event-action
    end-evaluate.

*
 konum-ekle.
    move 0 to iii
    perform varying i
            from 1
            by 1
            until i > konumlar-sayi
                 if occ-konum-secildimi(i) = 1
                    add 1 to iii
                 end-if
    end-perform.

    if iii >= apo-5
       display message box 
               "Tablo'ya Max.  "
               apo-5
               " konum ekleyebilirsiniz !!!"
               icon mb_warning_icon
               title "Bilginize ..."
    else
       move 1 to occ-konum-secildimi(99)
       modify form1-gd-3(event-data-2,event-data-1)
              hidden-data = occ-konumlar-occurs(99)
              bitmap  = check-bmp
              bitmap-number = 2
              bitmap-width = 16
       
       perform varying i
               from 1
               by 1
               until i > konumlar-sayi
               if occ-konum-kod(99) = occ-konum-kod(i) 
                  move 1 to occ-konum-secildimi(i)
                  exit perform 
               end-if
       end-perform
       initialize yedek-konum
       perform varying iii
               from 1
               by 1
               until iii > apo-5
               if gecerli-konum-kod(iii) = spaces
                  if occ-konum-kod(i) = yedek-konum
                      exit perform cycle 
                  end-if 
                  move occ-konum-kod(i)         to gecerli-konum-kod(iii) yedek-konum
                  move occ-konum-adi(i)         to gecerli-konum-adi(iii)
                  move 1                        to gecerli-konum-secildimi(iii)
               end-if
       end-perform


       perform grid-reset
       set girilen-bulma to true
       perform load-mygrid
       initialize girilen-bulayimmi


    end-if.
*
 konum-cikar.
    open input xbloklog
    initialize xbloklog-rec
    start xbloklog key not < xbloklog-anahtar invalid
          continue
    not invalid
    initialize fs-xbloklog
    perform with test after until fs-xbloklog = "10"
    read xbloklog next no lock end move "10" to fs-xbloklog
    not at end
         if xbloklog-konum = occ-konum-kod(99)
            close xbloklog
            display message box 
                    "Secimi kaldirmaya calistiginiz konum :",occ-konum-kod(99)," kodu ",x"0a0d",
                    xbloklog-gun,"/",xbloklog-ay,"/",xbloklog-yil , " tarihinde hareket gormus"
                    icon mb_error_icon
                    title "Bilginize "
            exit paragraph
          end-if
    end-read
    end-perform
    end-start
    close xbloklog.


    move 0 to occ-konum-secildimi(99)
    modify form1-gd-3(event-data-2,event-data-1)
           hidden-data = occ-konumlar-occurs(99)

           bitmap  = check-bmp
           bitmap-number = 1
           bitmap-width = 16

    perform varying i
            from 1
            by 1
            until i > konumlar-sayi



            if occ-konum-kod(99) = occ-konum-kod(i) 
               move 0 to occ-konum-secildimi(i)
               exit perform 
            end-if
    end-perform

    perform varying iii
            from 1
            by 1
            until iii > apo-5
            if gecerli-konum-kod(iii) = occ-konum-kod(99)
               initialize gecerli-konumlar-occurs(iii)
               exit perform 
            end-if
    end-perform


    perform grid-reset
    perform load-mygrid

     .


*
 girili-konumlari-al.
     if girilen-bulma
        exit paragraph.

     initialize gecerli-konumlar
     perform varying i
             from 1
             by 1
             until i > konumlar-sayi
             move 0 to occ-konum-data-bilgi(i)
                       occ-konum-secildimi(i)
     end-perform


     initialize xbloklog-rec
     start xbloklog key not < xbloklog-kodu invalid
           continue
     not invalid
     initialize fs-xbloklog
     perform with test after until fs-xbloklog = "10"
     read xbloklog next no lock end move "10" to fs-xbloklog
     not at end
          perform varying i
                  from 1
                  by 1
                  until i > konumlar-sayi
                  if occ-konum-kod(i) = xbloklog-konum
                     move 1 to occ-konum-data-bilgi(i)
                     exit perform
                  end-if
          end-perform
     end-read
     end-perform
     end-start.


     move 0 to ii
     perform varying i
             from 1
             by 1
             until i > konumlar-sayi
             if occ-konum-data-bilgi(i) = 1
                add 1 to ii
                move occ-konum-kod(i) to gecerli-konum-kod(ii)
                move occ-konum-adi(i) to gecerli-konum-adi(ii)
                move 1                to occ-konum-secildimi(i)
                move occ-konum-secildimi(i) to gecerli-konum-secildimi(ii)
             end-if   
     end-perform.
*
 Form1-Mn-1-MI-RezervasyonOlustur-Link.
          open input gruplog
          initialize gruplog-rec
          move grup-no  to gruplog-kodu
          read gruplog no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplog 
                 exit paragraph
          end-read 
          close gruplog
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
        
*          if st-x <> end-x 
*             display message box 
*                     "Birden fazla kolon secemezsiniz !"
*                     icon mb_warning_icon
*                     title "Hata"
*             exit paragraph
*          end-if.

          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 

          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp              to gruplog-gel-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to gruplog-git-tar

          initialize takvim-rec
          move gruplog-git-tar   to takvim-anah
          start takvim key > takvim-anah invalid 
              continue 
          not invalid 
          read takvim next no lock end continue 
          not at end               
               move takvim-anah to gruplog-git-tar
          end-read 
          end-start 
          inquire form1-gd-2(1,st-x),
                  hidden-data in temp

          move temp              to gruplog-adi(99:2)|oda konumu
          move gruplog-rec       to link-rez-grup-rec

          if gruplog-gel-tar > gruplog-git-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if 

          call "/asya/ytl/obj/otel/rez.asy" 
                        using  link-rez-no link-gelen-rec link-gelen-sharenum link-rez-grup-rec 
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/rez.asy"
          end-call

          move 1 to control-id
          move 4 to accept-control
          perform Aft-Procedure.

*
 kaynak1-ara.
    initialize kaynak-cagir.
    move "AB"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk1ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk1ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-1
    perform kaynak1-goster
    .

 kaynak2-ara.
    initialize kaynak-cagir.
    move "AC"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk2ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk2ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-2
    perform kaynak2-goster
    .
 kaynak3-ara.
    initialize kaynak-cagir.
    move "AD"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk3ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk3ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-3
    perform kaynak3-goster
    . 
*
 break-tablosu.
    initialize link-hepsi
    move high-values   to gelen-break
    move xrez-pan-tipi to gelen-break(7:2)
    move grup-no       to gelen-break(1:6)
    move xrez-doviz    to gelen-doviz

    call "/asya/ytl/obj/otel/break.asy" using link-hepsi
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/break.asy" 
    end-call
    initialize link-hepsi 
     .


*
 Form1-Gd-4-Ev-Other.
    evaluate event-type
    when msg-begin-entry
  
    end-evaluate
     
     .
*
 satilan-kalan-doldur.
     open i-o genelfis cast
     initialize genelfis-rec 
     move 1             to genelfis-anahtar
     read genelfis no lock invalid 
          continue 
     not invalid
          add 1 to ekran-fis-1 
          move ekran-fis-1    to takas-no
          rewrite genelfis-rec end-rewrite 
     end-read 
     close genelfis
     open output takas close takas open i-o takas 
             
     initialize rez-rec 
     move grup-no       to rez-grup-no
     move "I"           to rez-durumu
     start rez key not < rez-grup invalid 
          continue 
     not invalid 
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10"  to fs-rez
     not at end 
            if rez-grup-no <> grup-no or
               rez-durumu <> "I"
                exit perform 
            end-if 

            initialize takas-rec takvim-rec
            move rez-gir-tar    to takvim-anah 
            start takvim key not < takvim-anah invalid 
                  continue 
            not invalid 
            perform with test after until fs-takvim = "10"
            read takvim next no lock end move "10"  to fs-takvim
            not at end
                   if takvim-anah >= rez-cik-tar
                       exit perform 
                   end-if 
                   initialize cast-rec
                   move takvim-anah      to cast-tarih
                   move rez-no           to cast-rez-no
                   read cast no lock invalid 
                        continue 
                   not invalid 
                        if cast-share = 0
                           initialize takas-rec 
                           move takvim-anah      to takas-anahtar
                           move rez-fiyat-konumu to takas-konum
                           read takas no lock invalid
                                move 1        to takas-satilan-adet
                                write takas-rec end-write 
                           not invalid 
                                add 1         to takas-satilan-adet 
                                rewrite takas-rec end-rewrite 
                           end-read                            
                        end-if 
                   end-read 
            end-read 
            end-perform
            end-start

     end-read 
     end-perform
     end-start
     close  takas cast
     .
*
 Form1-Mn-1-MI-GelmesiBeklenenler-Link.
          open input gruplog
          initialize gruplog-rec
          move grup-no  to gruplog-kodu
          read gruplog no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplog 
                 exit paragraph
          end-read 
          close gruplog
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 
        
          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp       to link-ilk-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to link-son-tar                 
          move gruplog-kodu      to link-grup-no 
                                                
          if link-ilk-tar > link-son-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if 

          call "/asya/ytl/obj/otel/ggelrez.asy" 
                        using  link-gelrez-hepsi
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/ggelrez.asy"
          end-call
          move 1 to control-id
          move 4 to accept-control
          perform Aft-Procedure.
*
 Form1-Mn-1-MI-LogGoruntuleyici-Link.
     move gruplog-kodu         to bloklog-kodu
     inquire form1-gd-2(1,event-data-2),
               hidden-data in bloklog-konum
     move bloklog-dosya        to link-logview-dosya-adi
     set link-logview-pointer  to address of bloklog-rec
     set link-logview-rec-size to size of bloklog-rec
     perform logview-call
     initialize key-status
       
     
     .
*
 sil-rez-kontrol. 
    initialize rez-rec buldum
    move grup-no           to rez-grup-no
    move "I"               to rez-durumu
    start rez key not < REZ-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"  to fs-rez
    not at end 
           if rez-durumu <> "I" or
              rez-grup-no <> grup-no
                 exit perform
           end-if 
              move 1 to buldum
    end-read 
    end-perform
    end-start

    
     .








*
 Form1-Mn-1-MI-GrupIslemleri-Link.
     
          open input gruplog
          initialize gruplog-rec
          move grup-no  to gruplog-kodu
          read gruplog no lock invalid 
               display message box "Grup Kaydedilmeden Rezervasyon Acilamaz..."
                               title "Uyari"
                               icon 1
                  close gruplog 
                 exit paragraph
          end-read 
          close gruplog
          
          initialize st-x st-y 
                     end-x end-y 
          inquire form1-gd-2,
                     start-x          in st-x
                     start-y          in st-y                     
                     cursor-x         in end-x
                     cursor-y         in end-y.
          if st-x = 0 
             move end-x       to st-x
          end-if 
          if st-y = 0 
             move end-y       to st-y
          end-if 
        
          inquire form1-gd-2(st-y,1),                 
                  hidden-data in temp 
          move temp              to link-ilk-tar
          inquire form1-gd-2(end-y,1),                 
                  hidden-data in temp
 
          move temp              to link-son-tar
          inquire form1-gd-2(1,st-x),
                  hidden-data in temp

          move temp              to gruplog-adi(99:2)|oda konumu
          move gruplog-rec       to link-rez-grup-rec
          move gruplog-kodu      to link-grup-no 
                                                
          if link-ilk-tar > link-son-tar
              display message box "Giris Tarihi - Cikis Tarihinden Buyuk Olamaz..." new-line 
                                  "Lutfen Kontrol Ediniz.."
                              title "Secim Hatasi"
                              icon 1
               exit paragraph 
          end-if

          perform acu-form3-routine.
          move 1 to control-id
          move 4 to accept-control
          perform Aft-Procedure.
          
*
 Form3-Aft-Initdata.
       initialize takvim-rec
       move link-son-tar   to takvim-anah
       start takvim key > takvim-anah invalid 
           continue 
       not invalid 
       read takvim next no lock end continue 
       not at end               
            move takvim-anah to link-son-tar
       end-read 
       end-start
       
       initialize takvim-rec
       move tarih-tasi      to takvim-anah
       read takvim no lock invalid 
            display message box "Tarih Bulunamadi.!!!"
                            title "Uyari"
                            icon 1
                 
       not invalid 
           
             perform form3-baslik-yukle
             initialize p m
             perform varying p
                       from 1
                       by 1
                       until p > ust-occ
                       initialize form3-gd-1-record
                       add 1             to m
                       move m            to zzz
                         
                       move zzz          to gd-5-col-1

                       move link-ilk-tar to gruplog-gel-tar
                       move link-ilk-gun to egun
                       move link-ilk-ay  to eay
                       move link-ilk-yil to eyil
                       move etarih       to gd-5-col-8 

                       move link-son-tar to gruplog-git-tar
                       move link-son-gun to egun
                       move link-son-ay  to eay
                       move link-son-yil to eyil
                       move etarih       to gd-5-col-9

                       
                       modify form3-gd-1,
                       record-to-add(form3-gd-1-record)

             end-perform
       end-read 
       modify form3-gd-1,mass-update = 0
        
     
     .
*
 form3-baslik-yukle.
     modify form3-gd-1,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-1-record
     move "Sira"              to gd-5-col-1
     move "[1].Kisi Adi"      to gd-5-col-2
     move "[1].Kisi Soyadi"   to gd-5-col-3
     move "[2].Kisi Adi"      to gd-5-col-4
     move "[2].Kisi Soyadi"   to gd-5-col-5
     move "[3].Kisi Adi"      to gd-5-col-6
     move "[3].Kisi Soyadi"   to gd-5-col-7
     move "C/In Tarihi    "   to gd-5-col-8
     move "C/Out tarihi   "   to gd-5-col-9
     modify form3-gd-1,record-to-add(form3-gd-1-record)
      .
*
 Form3-Gd-1-Ev-Other.
     evaluate event-type
     when msg-finish-entry
          evaluate event-data-1
          when 2
              modify form3-gd-1,cursor-Y event-data-2 
                                cursor-X 3
          when 3             
              modify form3-gd-1,cursor-Y event-data-2 + 1
                                cursor-X 2
          end-evaluate
     end-evaluate
     
     .
*
 Form3-Ex-Other.
     evaluate key-status
     when 2
        perform toplu-rez-olustur
     when 3
        perform temiz-oda-cin-yap
        perform form3-tab3-grid-baslik-yukle
        perform gelecek-rez-bul
     when 4
        perform tum-oda-cin-yap
        perform form3-tab3-grid-baslik-yukle
        perform gelecek-rez-bul
     when 6
        evaluate Form3-Ta-1-Value
        when 4
          initialize sayac
          inquire form3-gd-4,cursor-y in sayac
          inquire form3-gd-4(sayac,1),
               cell-data in ydk-rez
           initialize rez-rec
           move ydk-rez   to rez-no
           read rez no lock invalid 
               continue 
           not invalid 
               move rez-folio   to ydk-konuk-folio
               perform folio-cagir               
           end-read 
             
        end-evaluate 
     when 7

     end-evaluate
     
     .
*
 grup-cout.
    open input acenta doviz konuk 
               romhrk firma cast odalar kodlar02
    initialize rez-rec
    move tarih-tasi       to rez-cik-tar
    move "I"              to rez-durumu
    start rez key not < REZ-cik invalid 
          continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end 
          if rez-durumu <> "I" or
             rez-cik-tar <> tarih-tasi
                exit perform 
          end-if
          if rez-grup-no <> gruplog-kodu
              exit perform cycle 
          end-if
          initialize konuk-rec
          move rez-folio   to konuk-folio
          read konuk no lock invalid 
               exit perform cycle 
          not invalid 
              if konuk-durumu = "H"
                  exit perform cycle 
              else                 
                   
                  if folio-bakiye not = 0
                     exit perform cycle 
                  end-if                   
                  perform cout-prog-cagir                 
              end-if 
          end-read 
    end-read 
    end-perform
    end-start
    close acenta doviz romhrk 
          firma cast odalar kodlar02 konuk       
     .
*
 cout-prog-cagir.
    initialize dokcagir-tasi
    set dokcagir-tasi-call-cout2    to true
    move rez-odano                  to dokcagir-konuk-odano
    move konuk-folio                to dokcagir-konuk-folio
    move 1                          to dokcagir-toplu
    perform dokcagir-call
    move dokcagir-konuk-odano      to rez-odano
    move dokcagir-konuk-folio      to rez-folio
     
*       call "w$keybuf" using 3 end-call

     .
*
 temiz-oda-cin-yap.
     if title-temiz-adet = spaces 
        display message box "C/In Yapilacak Temiz Oda Bulunamadi..."
                        title "Uyari"
                        icon 1
        exit paragraph 
     end-if 
     display message box title-temiz-adet " 'Adet Temiz Oda C/in Yapilacaktir..." new-line
                                     "Eminmisiniz.!!!"
                     title "Uyari"
                     icon 1
                     type 2
                     default 2
                     returning return-code 
     if return-code = 2
         exit paragraph 
     end-if

     open input  odalar 
     initialize rez-rec
     move tarih-tasi       to rez-gir-tar
     move "I"              to rez-durumu
     start rez key not < REZ-GIR invalid 
           continue 
     not invalid 
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10" to fs-rez
     not at end 
           if rez-durumu <> "I" or
              rez-gir-tar <> tarih-tasi
                 exit perform 
           end-if
           if rez-grup-no <> gruplog-kodu
               exit perform cycle 
           end-if 
           if rez-odano = spaces
               exit perform cycle
           end-if 
           if rez-c-in = "E"
              exit perform cycle 
           end-if 
           if rez-folio > 0
               exit perform cycle 
           end-if 
*/KAÇIÞ YOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK :)
           initialize odalar-rec 
           move rez-odano   to odalar-anah
           read odalar no lock invalid 
                exit perform cycle 
           not invalid 
               if house-durumu not = house-bt|sadece temiz oda c/in yapiliyor.
                   exit perform cycle 
               end-if 
           end-read 
              perform cin-prog-cagir
     end-read 
     end-perform
     end-start
     close  odalar 
     
     .
*
 tum-oda-cin-yap.
     if title-oda-adet = spaces 
        display message box "C/In Yapilacak Oda Bulunamadi..."
                        title "Uyari"
                        icon 1
        exit paragraph 
     end-if 
     display message box title-oda-adet " 'Adet Oda C/in Yapilacaktir..." new-line
                                     "Eminmisiniz.!!!"
                     title "Uyari"
                     icon 1
                     type 2
                     default 2
                     returning return-code 
     if return-code = 2
         exit paragraph 
     end-if

     open input  odalar 
     initialize rez-rec
     move tarih-tasi       to rez-gir-tar
     move "I"              to rez-durumu
     start rez key not < REZ-GIR invalid 
           continue 
     not invalid 
     perform with test after until fs-rez = "10"
     read rez next no lock end move "10" to fs-rez
     not at end 
           if rez-durumu <> "I" or
              rez-gir-tar <> tarih-tasi
                 exit perform 
           end-if
           if rez-grup-no <> gruplog-kodu
               exit perform cycle 
           end-if 
           if rez-odano = spaces
               exit perform cycle
           end-if 
           if rez-c-in = "E"
              exit perform cycle 
           end-if 
           if rez-folio > 0
               exit perform cycle 
           end-if 
*/KAÇIÞ YOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK :)
           initialize odalar-rec 
           move rez-odano   to odalar-anah
           read odalar no lock invalid 
                exit perform cycle 
           not invalid 
               continue  
           end-read 
              perform cin-prog-cagir
     end-read 
     end-perform
     end-start
     close  odalar
     .
*
 cin-prog-cagir. 
    if rez-folio = 0 then 
      move 99999997 to rez-folio
    end-if
    initialize dokcagir-tasi
    set dokcagir-tasi-call-cin2    to true
    move rez-no                    to dokcagir-konuk-rez-no      
    move rez-folio                 to dokcagir-konuk-folio
    perform dokcagir-call
    move dokcagir-konuk-rez-no     to rez-no
    move dokcagir-konuk-folio      to rez-folio       
     .
*
 toplu-rez-olustur.
       initialize takvim-rec
       move tarih-tasi      to takvim-anah
       read takvim no lock invalid 
            display message box "Tarih Bulunamadi.!!!"
                            title "Uyari"
                            icon 1                 
       not invalid             
             initialize p m occ-sayi link-toplu-adlar
             perform varying p
                       from 1
                       by 1
                       until p > ust-occ                               
                          add 1 to m
                          if m = 1
                             exit perform cycle 
                          end-if 
                          inquire form3-gd-1(m),
                                  record-data in form3-gd-1-record
                          if gd-5-col-2 = spaces
                             exit perform cycle 
                          end-if 
                          add 1              to occ-sayi
                          move gd-5-col-2    to link-toplu-grup-adi1(occ-sayi)
                          move gd-5-col-3    to link-toplu-grup-soy1(occ-sayi)

                          move gd-5-col-4    to link-toplu-grup-adi2(occ-sayi)
                          move gd-5-col-5    to link-toplu-grup-soy2(occ-sayi)

                          move gd-5-col-6    to link-toplu-grup-adi3(occ-sayi)
                          move gd-5-col-7    to link-toplu-grup-soy3(occ-sayi)
             end-perform
                move gruplog-rec       to link-rez-grup-rec
             perform toplu-rez-cagir
       end-read. 
*
 toplu-rez-cagir.          
          call "/asya/ytl/obj/otel/rez.asy" 
                        using  link-rez-no link-gelen-rec link-gelen-sharenum 
                               link-rez-grup-rec link-toplu-adlar
*                               link-toplu-grup-adi1 link-toplu-grup-soy1
*                               link-toplu-grup-adi2 link-toplu-grup-soy2
*                               link-toplu-grup-adi3 link-toplu-grup-soy3
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/rez.asy"
          end-call    
     .
*
 Form3-Mn-1-MI-Yapistir-Link.
     perform form3-baslik-yukle.
     call "c$sleep" using 2.
     if is-remote
             
        perform clipboard-islem 
     else
        perform clipboard-islem-yerel
     end-if.        

*
 clipboard-islem.
     initialize buf
     call "@[DISPLAY]:C:\windows\system32\user32.dll" 
     on exception
           display message box "user32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph
     end-call      .
     call "@[DISPLAY]:C:\windows\system32\kernel32.dll" on exception
           display message box "kernel32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "@[DISPLAY]:C:\windows\system32\msvcrt.dll" on exception
           display message box "msvcrt.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "@[DISPLAY]:OpenClipboard" using by value 0
          giving hwnd.

     call "@[DISPLAY]:GetClipboardData" using by value cf_text
                                        giving hglobal.

     call "@[DISPLAY]:GlobalLock" using by value hglobal
                                  returning ptr

     call "@[DISPLAY]:lstrlenA" using by value ptr 
                               returning boy.

     if boy > 0
     call "@[DISPLAY]:RtlMoveMemory" using by reference buf
                                     by value ptr
                                     by value boy
     end-call
            initialize sayac
            move 1 to sayac
            perform varying k 
                    from 1 
                    by 1 
                    until k > ust-occ                        
                         unstring buf delimited by x"0d0a"
                         into satir(k)   pointer sayac
                         
                         if satir(k) = spaces
                            exit perform cycle 
                         end-if 

                         initialize sayac2
                         move 1 to sayac2
                         perform varying l 
                                 from 1 
                                 by 1 
                                 until l > 10
                                  unstring satir(k) delimited by x"09"
                                       into sutun(k,l)   pointer sayac2                                                                           
                         end-perform
            end-perform
           perform form3-baslik-yukle 
           perform varying m 
                   from 1 
                   by 1 
                   until m >= k            
                   initialize form3-gd-1-record
                   move m     to zzz
                   move zzz   to gd-5-col-1

                   move sutun(m,1)                         to gd-5-col-2
                   move sutun(m,2)                         to gd-5-col-3
                   move sutun(m,3)                         to gd-5-col-4
                   
                   move sutun(m,4)                         to gd-5-col-5 
                   move sutun(m,5)                         to gd-5-col-6

                   move sutun(m,6)                         to gd-5-col-7

                   move link-ilk-tar to gruplog-gel-tar
                   move link-ilk-gun to egun
                   move link-ilk-ay  to eay
                   move link-ilk-yil to eyil
                   move etarih       to gd-5-col-8 
           
                   move link-son-tar to gruplog-git-tar
                   move link-son-gun to egun
                   move link-son-ay  to eay
                   move link-son-yil to eyil
                   move etarih       to gd-5-col-9

                   modify form3-gd-1,
                          record-to-add(form3-gd-1-record)
           
           end-perform
     call "@[DISPLAY]:GlobalUnlock" using hglobal.
     call "@[DISPLAY]:CloseClipboard".
     cancel "@[DISPLAY]:user32.dll".
     cancel "@[DISPLAY]:kernel32.dll".
     cancel "@[DISPLAY]:msvcrt.dll".     
     modify form3-gd-1,
            mass-update = 0 
     .
*
 clipboard-islem-yerel.
     initialize buf
     call "user32.dll" 
     on exception
           display message box "user32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph
     end-call      .
     call "kernel32.dll" on exception
           display message box "kernel32.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "msvcrt.dll" on exception
           display message box "msvcrt.dll bulunamadi ..."
           icon mb_error_icon
           title "Hata"
           exit paragraph.
     call "OpenClipboard" using by value 0
          giving hwnd.

     call "GetClipboardData" using by value cf_text
                                        giving hglobal.

     call "GlobalLock" using by value hglobal
                                  returning ptr

     call "lstrlenA" using by value ptr 
                               returning boy.

     if boy > 0
     call "RtlMoveMemory" using by reference buf
                                     by value ptr
                                     by value boy
     end-call
            initialize sayac
            move 1 to sayac
            perform varying k 
                    from 1 
                    by 1 
                    until k > ust-occ                        
                         unstring buf delimited by x"0d0a"
                         into satir(k)   pointer sayac
                         
                         if satir(k) = spaces
                            exit perform cycle 
                         end-if 

                         initialize sayac2
                         move 1 to sayac2
                         perform varying l 
                                 from 1 
                                 by 1 
                                 until l > 10
                                  unstring satir(k) delimited by x"09"
                                       into sutun(k,l)   pointer sayac2                                                                           
                         end-perform
            end-perform
           perform form3-baslik-yukle 
           perform varying m 
                   from 1 
                   by 1 
                   until m >= k            
                   initialize form3-gd-1-record
                   move m     to zzz
                   move zzz   to gd-5-col-1

                   move sutun(m,1)                         to gd-5-col-2
                   move sutun(m,2)                         to gd-5-col-3
                   move sutun(m,3)                         to gd-5-col-4
                   
                   move sutun(m,4)                         to gd-5-col-5 
                   move sutun(m,5)                         to gd-5-col-6

                   move sutun(m,6)                         to gd-5-col-7

                   move link-ilk-tar to gruplog-gel-tar
                   move link-ilk-gun to egun
                   move link-ilk-ay  to eay
                   move link-ilk-yil to eyil
                   move etarih       to gd-5-col-8 
           
                   move link-son-tar to gruplog-git-tar
                   move link-son-gun to egun
                   move link-son-ay  to eay
                   move link-son-yil to eyil
                   move etarih       to gd-5-col-9

                   modify form3-gd-1,
                          record-to-add(form3-gd-1-record)
           
           end-perform

     call "GlobalUnlock" using hglobal.
     call "CloseClipboard".
     cancel "user32.dll".
     cancel "kernel32.dll".
     cancel "msvcrt.dll".
     modify form3-gd-1,mass-update = 0.

*
 Form3-Ta-1-Ev-Cmd-Tabchanged.

     
     .
*
 form3-tab2-grid-baslik-yukle.
     modify form3-gd-2,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-2-record
     move "Rez No"   to gd-6-col-1
     move "Adi"      to gd-6-col-2
     move "Soyadi"   to gd-6-col-3
     move "C/In Tarihi" to gd-6-col-4
     move "C/Out Tarihi" to gd-6-col-5
     move "Firma"        to gd-6-col-6
     move "Acenta"       to gd-6-col-7
     move "Pax"          to gd-6-col-8
     move "Child"        to gd-6-col-9
     move "Pansiyon"     to gd-6-col-10
     move "Fiyat"        to gd-6-col-11
     move "DV"           to gd-6-col-12
     move "#"            to gd-6-col-13
     move "C/In"         to gd-6-col-14
     modify form3-gd-2,
           record-to-add(form3-gd-2-record)
     .
*
 form3-tab3-grid-baslik-yukle.
     modify form3-gd-3,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-3-record
     move "Rez No"         to gd-7-col-1
     move "Adi"            to gd-7-col-2
     move "Soyadi"         to gd-7-col-3
     move "C/In Tarihi"    to gd-7-col-4
     move "C/Out Tarihi"   to gd-7-col-5
     move "Firma"          to gd-7-col-6
     move "Acenta"         to gd-7-col-7
     move "Pax"            to gd-7-col-8
     move "Child"          to gd-7-col-9
     move "Pansiyon"       to gd-7-col-10
     move "Oda No/Durumu"  to gd-7-col-11
     move "DV"             to gd-7-col-12
     move "#"              to gd-7-col-13
     move "C/In"           to gd-7-col-14
     modify form3-gd-3,
           record-to-add(form3-gd-3-record)
     .
*
 form3-tab4-grid-baslik-yukle.
     modify form3-gd-4,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-4-record
     move "Rez No"         to gd-8-col-1
     move "Adi"            to gd-8-col-2
     move "Soyadi"         to gd-8-col-3
     move "C/In Tarihi"    to gd-8-col-4
     move "C/Out Tarihi"   to gd-8-col-5
     move "Firma"          to gd-8-col-6
     move "Acenta"         to gd-8-col-7
     move "Pax"            to gd-8-col-8
     move "Child"          to gd-8-col-9
     move "Pansiyon"       to gd-8-col-10
     move "Oda No/Durumu"  to gd-8-col-11
     move "DV"             to gd-8-col-12
     move "#"              to gd-8-col-13
     move "C/In"           to gd-8-col-14
     move "Bakiye[TL]"     to gd-8-col-15    
     modify form3-gd-4,
           record-to-add(form3-gd-4-record).
*
 form3-tab5-grid-baslik-yukle.
     modify form3-gd-9,reset-grid = 1
                       mass-update = 1
     initialize form3-gd-9-record
     move "Rez No"         to gd-9-col-1
     move "Adi"            to gd-9-col-2
     move "Soyadi"         to gd-9-col-3
     move "C/In Tarihi"    to gd-9-col-4
     move "C/Out Tarihi"   to gd-9-col-5
     move "Firma"          to gd-9-col-6
     move "Acenta"         to gd-9-col-7
     move "Pax"            to gd-9-col-8
     move "Child"          to gd-9-col-9
     move "Pansiyon"       to gd-9-col-10
     move "Oda No/Durumu"  to gd-9-col-11
     move "DV"             to gd-9-col-12
     move "#"              to gd-9-col-13
     move "C/In"           to gd-9-col-14
*     move "Bakiye[TL]"     to gd-9-col-15    
     modify form3-gd-9,
           record-to-add(form3-gd-9-record)
     .
*
 acilmis-rezervasyon-bul.

    open input firma acenta doviz cast
    initialize rez-rec 
               toplam-oda-sayisi toplam-kisi-sayi
    move 1                to toplam-kayit-sayi
    move gruplog-kodu     to rez-grup-no
    move "I"              to rez-durumu
    start rez key not < rez-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"   to fs-rez
    not at end
           if rez-grup-no <> gruplog-kodu or 
              rez-durumu <> "I"
                 exit perform 
           end-if 

           initialize form3-gd-2-record
           move rez-no          to gd-6-col-1
           move rez-adi         to gd-6-col-2
           move rez-soyadi      to gd-6-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-6-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-6-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-6-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-6-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-6-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-6-col-9
           move rez-pan-tipi    to gd-6-col-10
           move rez-fiyati      to etutar
           move etutar          to gd-6-col-11
           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-6-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-6-col-13
                     add 1      to toplam-oda-sayisi
                else
                     move 0     to gd-6-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move rez-c-in        to gd-6-col-14

           modify form3-gd-2,
                  record-to-add(form3-gd-2-record)

           if rez-c-in = "E"
              modify form3-gd-2(toplam-kayit-sayi),
                  row-color = 176
           end-if 
    end-read 
    end-perform
    end-start

    close firma acenta doviz cast

    initialize form3-gd-2-record
    move "Toplam->"       to gd-6-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-6-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-6-col-8

    modify form3-gd-2,
       record-to-add(form3-gd-2-record)

    modify form3-gd-2(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-2,
       mass-update = 0

     .
*
 silinmis-rez-yukle.
    open input firma acenta doviz cast
    initialize rez-rec 
               toplam-oda-sayisi toplam-kisi-sayi
    move 1                to toplam-kayit-sayi
    move gruplog-kodu     to rez-grup-no
    move "S"              to rez-durumu
    start rez key not < rez-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"   to fs-rez
    not at end
           if rez-grup-no <> gruplog-kodu or 
              rez-durumu <> "S"
                 exit perform 
           end-if 

           initialize form3-gd-9-record
           move rez-no          to gd-9-col-1
           move rez-adi         to gd-9-col-2
           move rez-soyadi      to gd-9-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-9-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-9-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-9-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-9-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-9-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-9-col-9
           move rez-pan-tipi    to gd-9-col-10
           move rez-fiyati      to etutar
           move etutar          to gd-9-col-11
           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-9-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-9-col-13
                     add 1      to toplam-oda-sayisi
                else
                     move 0     to gd-9-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move rez-c-in        to gd-9-col-14

           modify form3-gd-9,
                  record-to-add(form3-gd-9-record)
 
    end-read 
    end-perform
    end-start

    close firma acenta doviz cast

    initialize form3-gd-9-record
    move "Toplam->"       to gd-9-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-9-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-6-col-8

    modify form3-gd-9,
       record-to-add(form3-gd-9-record)

    modify form3-gd-9(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-9,
       mass-update = 0

     .
*
 gelecek-rez-bul.
    open input acenta doviz firma cast odalar kodlar02
    initialize rez-rec
               toplam-oda-sayisi toplam-kisi-sayi temiz-oda-adet
               toplam-oda-adet 
    move 1                to toplam-kayit-sayi
    move tarih-tasi       to rez-gir-tar
    move "I"              to rez-durumu
    start rez key not < REZ-GIR invalid 
          continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end 
          if rez-durumu <> "I" or
             rez-gir-tar <> tarih-tasi
                exit perform 
          end-if
          if rez-grup-no <> gruplog-kodu
              exit perform cycle 
          end-if 
 
           initialize form3-gd-3-record
           move rez-no          to gd-7-col-1
           move rez-adi         to gd-7-col-2
           move rez-soyadi      to gd-7-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-7-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-7-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-7-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-7-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-7-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-7-col-9
           move rez-pan-tipi    to gd-7-col-10
*           move rez-fiyati      to etutar
*           move etutar          to gd-7-col-11
           initialize odalar-rec
           move rez-odano       to odalar-anah
           read odalar no lock invalid 
               continue
           not invalid 
            initialize kodlar02-rec
            move "C"          to kodlar02-tipi
            move house-durumu to kodlar02-kodu
            read kodlar02 no lock invalid 
                continue 
            end-read
               string gd-7-col-11
                     odalar-no  delimited by "    "
                     "-"        delimited by size
                     kodlar02-adi delimited by size 
               into gd-7-col-11 

           end-read 

           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-7-col-12

           initialize cast-rec
           move rez-gir-tar     to cast-tarih
           move rez-no          to cast-rez-no
           read cast no lock invalid 
                continue 
           not invalid 
                if cast-share = 0
                     move 1     to gd-7-col-13
                     add 1      to toplam-oda-sayisi
                       if house-durumu = house-bt and 
                          rez-c-in not = "E"
                          add 1 to temiz-oda-adet
                       end-if
                       if rez-c-in not = "E"
                          add 1 to toplam-oda-adet
                       end-if 
                else
                     move 0     to gd-7-col-13
                end-if 
           end-read
           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move REZ-C-IN        to gd-7-col-14
           modify form3-gd-3,
                  record-to-add(form3-gd-3-record)          
           if REZ-C-IN = "E"
              modify form3-gd-3(toplam-kayit-sayi),
                   row-color = 176
           end-if 
    end-read 
    end-perform
    end-start
    close acenta doviz firma cast odalar kodlar02
    initialize form3-gd-3-record
    move "Toplam->"       to gd-7-col-1
    move toplam-oda-sayisi to zzz
    move zzz               to gd-7-col-13
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-7-col-8

    modify form3-gd-3,
       record-to-add(form3-gd-3-record)

    modify form3-gd-3(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form3-gd-3,
       mass-update = 0
    move temiz-oda-adet  to title-temiz-adet
    move toplam-oda-adet to title-oda-adet
    
    modify bt-temiz,
           title = bt-title
    modify bt-hepsi,
           title = hepsi-title
     .

*
 Form3-Ta-1-Aft-Tabchg-Display.

     
     .
*
 Form3-Gd-2-Ev-Other.
    evaluate event-type
    when msg-begin-entry
       move event-action-fail to event-action
       inquire form3-gd-2(event-data-2,1),
               cell-data in ydk-rez
  
    end-evaluate     
    .
*
 Form3-Gd-4-Ev-Other.
    evaluate event-type
    when msg-begin-entry
       move event-action-fail to event-action
       inquire form3-gd-4(event-data-2,1),
               cell-data in ydk-rez
    

    end-evaluate     
    .
*
 rez-cagir.
      initialize dokcagir-tasi
      set dokcagir-tasi-call-rez1    to true
      move ydk-rez                   to dokcagir-rez-no
      perform dokcagir-call
      move dokcagir-rez-no           to rez-no.
*
 dokcagir-call.
      call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
           on exception 
              perform callerr-proc
           not on exception
              cancel "/asya/ytl/obj/otel/dokcagir.asy"
      end-call.
*
 Form3-Gd-3-Ev-Other.
    evaluate event-type
    when msg-begin-entry
       move event-action-fail to event-action
       inquire form3-gd-3(event-data-2,1),
               cell-data in ydk-rez
       if ydk-rez = 0 or 
          ydk-rez = spaces 
            exit paragraph 
       end-if 

       perform rez-cagir
    end-evaluate     
    .
*
 Form3-Mn-2-MI-SeciliSatirSil-Link.
           .

      
*
 Form3-Mn-2-MI-GrubaBagliTumRezervasyonlariSila-Link. 
           .
*
 route-prog-cagir.
         string  gruplog-kodu delimited by size
                 gruplog-adi delimited by "   "
         into rout-text
         move xrez-gir-tar to routsec-gir-tar
         move "G"          to rout-tip
         move gruplog-kodu to rout-rez-no(1) 
         call "/asya/ytl/obj/otel/routsec.asy" 
              using link-rout
              on exception 
              perform callerr-proc
              exit paragraph
              not on exception 
         cancel "/asya/ytl/obj/otel/routsec.asy"
         end-call

        .         
*
 folio-cagir.
       initialize dokcagir-tasi
       set dokcagir-tasi-call-folio1      to true
       move ydk-konuk-folio               to dokcagir-konuk-folio
       perform dokcagir-call
       move dokcagir-konuk-folio          to konuk-folio.

*
 Form1-Ta-1-Aft-Tabchg-Display.      
       .
*
 Form1-Gd-1-Ev-Other.
      evaluate event-type
      when msg-begin-entry
              move event-action-fail to event-action
      end-evaluate.
*
 mesaj-gonder.
        move grup-no to  link-NOT-DOS-ANAH   
     if link-not-dos-anah not = spaces then
        move "U"     to link-not-islem
        move "GRU"   to link-NOT-DOS    
        move 89      to link-nereden 
           string grup-adi
           " grubuna " delimited by size
           into link-dosya-aciklamasi

           call "/asya/ytl/obj/otel/mesajgir.asy" 
                 using link-not
                  on exception 
                  perform callerr-proc
                  exit paragraph
                not on exception 
                  cancel "/asya/ytl/obj/otel/mesajgir.asy"
            end-call

            move  link-not-donus  to  toplam-not
            display not-ac
            exit paragraph 
     end-if.
**
 not-goster.
         initialize toplam-not
          move grup-no to  link-NOT-DOS-ANAH   
       if link-not-dos-anah not = spaces  then
           move "K"     to  link-not-islem
           move "GRU"   to  link-NOT-DOS    
           move 89 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
         end-if
         display not-ac .




 
