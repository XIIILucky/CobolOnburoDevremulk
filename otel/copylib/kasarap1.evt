* kasarap1.evt
* kasarap1.evt is generated from D:\asya\acugt.ytl\otel\kasarap1.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
       open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
**********************************************************************pdf conv
    call "c$narg" using link-var
**********************************************************************pdf conv
    
    move cost-sirketi to CGENEL-DOSYA-ADRES PKODLAR-DOSYA-ADRES
 
    open input cgenel
    initialize cgenel-rec
    move 1     to cgenel-anahtar
    read cgenel no lock invalid 
        continue        
    end-read 
    close cgenel
    if hangi-ref-secildi > 0
            move hangi-ref-secildi  to rapor-ref
    end-if
     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to tarih.
    display acc-01 acc-02 acc-03.
**********************************************************************pdf conv
    if link-var > 0 
        move forlink-bas-tarih to tarih
        move 2 to key-status
        perform Form1-Ex-Other       
    end-if 
**********************************************************************pdf conv
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form1-Ex-Other.
    evaluate key-status
      when 2
               

       
       open input depkod onkasa onavans doviz onkasar
       if rapor-ref = 0 then 
              perform takas-aktar thru takas-aktar-exit
         else 
            call "/asya/ytl/obj/otel/onkinitr.asy" on exception
                   perform callerr-proc
              not on exception
                   cancel "/asya/ytl/obj/otel/onkinitr.asy"
              end-call 
            perform takasr-aktar thru takasr-aktar-exit
         end-if
            initialize fiyat-ref-external
          move rapor-ref to oda-ref-external

              initialize duzen-rec
              start duzen key not < duzen-sira invalid continue,end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Gunluk Kasa Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Gunluk Kasa Raporu"   to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move gun            to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ay             to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move yil            to det-filler(57:04)
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RLRRLRRRRRRRRRRRRLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
     MOVE "Dep"                            TO det-1
     MOVE "Departman          "            TO det-2
     MOVE "Tutar          "                TO det-3
     MOVE "Dep"                            TO det-4
     MOVE "Departman         "             TO det-5
     MOVE "Tutar          "                TO det-6
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
     write dokumer-rec from detay
*********************************

              initialize fs-duzen
              perform with test after until fs-duzen = "10"
                read duzen next no lock end move "10" to fs-duzen
                  not at end

                  perform liste-detay-ata
                  write dokumer-rec from detay
                end-read
              end-perform
              perform liste-toplam
              close dokumer
**********************************************************************pdf conv
              if link-var > 0 
                 perform pdf-olustur                  
                 string dokumer-dosya(17:4) delimited by "    "
                        ".pdf"              delimited by size     
                into forlink-donus-dosya-adi
              else
                 call dokumer-prog on exception
                      perform callerr-proc
                 not on exception
                      cancel dokumer-prog
                 end-call
              end-if
**********************************************************************pdf conv
              close duzen depkod onavans onkasa doviz onkasar
              delete file dokumer duzen
**********************************************************************pdf conv
              if link-var > 0 
                 set exit-pushed to true
              end-if 
**********************************************************************pdf conv
    end-evaluate.
     .
*
 pdf-olustur.
    initialize pdf-link-tum
    move dokumer-dosya               to pdf-dokumer-adres
    call "/asya/ytl/obj/otel/dok2pdf.asy" using  pdf-link-tum 
       on exception 
          perform callerr-proc
          exit paragraph
    not on exception
    cancel "/asya/ytl/obj/otel/dok2pdf.asy"
    end-call.
*
 takas-aktar.
    perform takas-dosya-ac.
    initialize onavans-rec borc-sira alac-sira borc-nakit alac-nakit.
      initialize dov-boz-rec dov-boz-toplam.
    move tarih to onavans-tarih.
    initialize onavans-kim.
    if ONKPARA-REFERANS-VAR = 1 
     perform varying i from 1 by 1 until i > max-ref
       move i to onavans-ref
         read onavans no lock invalid 
             continue,
                     not invalid
                         initialize takas-rec
                         move "A"           to takas-ba,
                         move "A"           to takas-tipi,
                         move 994           to takas-kodu,
                         read takas no lock invalid continue end-read
                         add onavans-avans-tl to takas-tutar,
                         compute borc-nakit = borc-nakit + onavans-avans-tl,
                         write takas-rec invalid rewrite takas-rec,end-write,

                           initialize takas-rec
                         move "B"           to takas-ba
                         move "A"           to takas-tipi,
                         move 995           to takas-kodu,
                         read takas no lock invalid continue end-read
                         add onavans-avans-tl to takas-tutar,
                         compute alac-nakit = alac-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,
**************************************************************************
                         if onavans-doviz-kodu-1 > 0 and onavans-doviz-1 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-1 to takas-kodu(4:2) takas3-doviz                  
                                 move  onavans-doviz-1 to takas-tutar takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-1 to takas-kodu(4:2),                   
                                 move  onavans-doviz-1 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if
 
                         if onavans-doviz-kodu-2 > 0 and onavans-doviz-2 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-2 to takas-kodu(4:2), takas3-doviz                  
                                 move  onavans-doviz-2 to takas-tutar, takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-2 to takas-kodu(4:2),                   
                                 move  onavans-doviz-2 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if 
                         if onavans-doviz-kodu-3 > 0 and onavans-doviz-3 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-3 to takas-kodu(4:2), takas3-doviz                  
                                 move  onavans-doviz-3 to takas-tutar, takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-3 to takas-kodu(4:2),                   
                                 move  onavans-doviz-3 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if 

                        perform onavans-elangir
***************************************************************************** 
                           initialize takas-rec
                         move "A"           to takas-ba,
                         move "A"           to takas-tipi,
                         move 997           to takas-kodu,
                         read takas no lock invalid continue end-read
                         add onavans-gelir-tl to takas-tutar,
                         compute borc-nakit = borc-nakit + takas-tutar,
                         
                         write takas-rec invalid rewrite takas-rec,end-write,

                           initialize takas-rec
                         move "B"           to takas-ba
                         move "A"           to takas-tipi,
                         move 998           to takas-kodu,
                         read takas no lock invalid continue end-read
                         move onavans-gider-tl to takas-tutar,
                         compute alac-nakit = alac-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write
                end-read
 




     end-perform
      else

    read onavans no lock invalid continue,
                     not invalid

**************************************************************************

                         if onavans-doviz-kodu-1 > 0 and onavans-doviz-1 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-1 to takas-kodu(4:2) takas3-doviz                  
                                 move  onavans-doviz-1 to takas-tutar takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-1 to takas-kodu(4:2),                   
                                 move  onavans-doviz-1 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if
 
                         if onavans-doviz-kodu-2 > 0 and onavans-doviz-2 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-2 to takas-kodu(4:2), takas3-doviz                  
                                 move  onavans-doviz-2 to takas-tutar, takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-2 to takas-kodu(4:2),                   
                                 move  onavans-doviz-2 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if 
                         if onavans-doviz-kodu-3 > 0 and onavans-doviz-3 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-3 to takas-kodu(4:2), takas3-doviz                  
                                 move  onavans-doviz-3 to takas-tutar, takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-3 to takas-kodu(4:2),                   
                                 move  onavans-doviz-3 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if 

                       
*****************************************************************************
                         move "A"           to takas-ba,
                         move "A"           to takas-tipi,
                         move 994           to takas-kodu,
                         move onavans-avans-tl to takas-tutar,
                         compute borc-nakit = borc-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,
                         move "B"           to takas-ba
                         move "A"           to takas-tipi,
                         move 995           to takas-kodu,
                         move onavans-avans-tl to takas-tutar,
                         compute alac-nakit = alac-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,
                            perform onavans-elangir

                         move "A"           to takas-ba,
                         move "A"           to takas-tipi,
                         move 997           to takas-kodu,
                         move onavans-gelir-tl to takas-tutar,
                         compute borc-nakit = borc-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,
                         move "B"           to takas-ba
                         move "A"           to takas-tipi,
                         move 998           to takas-kodu,
                         move onavans-gider-tl to takas-tutar,
                         compute alac-nakit = alac-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write
                  end-read
    end-if                     
                         
                         .
  
    move tarih to dov-boz-tarih.
    open input dov-boz.
    start dov-boz key not < dov-boz-anah invalid continue,
        not invalid,
        move spaces to evet-hayir,
        perform with test after until evet,
            read dov-boz next no lock end move "E" to evet-hayir,
                not end,
               
                if dov-boz-tarih > tarih
                           move "E" to evet-hayir,
                end-if,
                if dov-boz-durumu = "S" 
                   exit perform cycle
                end-if
                if dov-boz-tarih not > tarih,
                if DOV-BOZ-ALIS-SATIS = 1 then
                   compute dov-boz-toplam = dov-boz-toplam - dov-boz-net-tl-tutar 
                else
                 if onkpara-dovboz-komisyon-bas = 1 then
******************yeniden bak
                      compute dov-boz-toplam = dov-boz-toplam + dov-boz-net-tl-tutar 
                     else
                       compute dov-boz-toplam = dov-boz-toplam + dov-boz-net-tl-tutar,
               end-if
               end-if
               initialize takas3-rec
                   move dov-boz-doviz    to  takas3-doviz
                   read takas3 invalid continue end-read
                  
                    if DOV-BOZ-ALIS-SATIS = 1 then
                       subtract dov-boz-dv-tutar from takas3-miktar
                       subtract dov-boz-tl-tutar from takas3-miktart
                    else
                       add dov-boz-dv-tutar to takas3-miktar 
                       add dov-boz-tl-tutar to takas3-miktart
                    end-if
                   write takas3-rec invalid rewrite takas3-rec,end-write
************** compute dov-boz-toplam = dov-boz-toplam + dov-boz-tl-tutar,
                end-if,
            end-read,
        end-perform,
    end-start.
    close dov-boz.
    open i-o pkodlar
    compute alac-nakit = alac-nakit + dov-boz-toplam.
    move "B"              to takas-ba.
    move "B"              to takas-tipi.
    move 996              to takas-kodu.
    
    move dov-boz-toplam   to takas-tutar.
    write takas-rec invalid rewrite takas-rec,end-write.
    initialize depkod-rec.
    start depkod key not < depkod-kodu invalid go takas-aktar-exit,
        not invalid,
        move spaces to evet-hayir,
        perform with test after until evet,
            read depkod next no lock end move "E" to evet-hayir,
                not end,
                if outlet-haric = 1
                    initialize pkodlar-rec outlet-var
                    start pkodlar key not < pkodlar-anahtar invalid
                            continue
                    not invalid
                    perform until fs-pkodlar = "10"
                    read pkodlar next no lock end move "10" to fs-pkodlar
                    not end
                              if pkodlar-odeme-tipi-onb-dep = depkod-anah then
                                    move 1 to outlet-var
                                    exit perform
                              end-if
                    end-read
                    end-perform
                    end-start

                    if outlet-var = 1
                       exit perform cycle 
                    end-if
                end-if
                if visa-haric = 1
                     if depkod-ba = "A" and depkod-turu = 5
                        exit perform cycle
                    end-if
                end-if
                initialize takas-rec,
                move depkod-ba                      to takas-ba,
                move depkod-kodu                    to takas-kodu,
                evaluate true,
                    when depkod-ba = "B" and depkod-turu = 3
                                             move "X" to takas-tipi,
                    when depkod-ba = "B" and depkod-turu = 4
                                             move "X" to takas-tipi,
                    when depkod-ba = "A" and depkod-turu = 3
                                             move "X" to takas-tipi,
                    when depkod-ba = "A" and depkod-turu = 5
                                             move "X" to takas-tipi,
                end-evaluate,
                initialize onkasa-rec,
                move tarih to onkasa-tarih,
                move depkod-kodu to onkasa-dep,
                read onkasa no lock invalid continue,
                     not invalid move onkasa-tutar-tl to takas-tutar,
                end-read,
                evaluate true,
                    when depkod-ba = "B" and depkod-turu = 3
                         write takas-rec invalid rewrite takas-rec,end-write,
                    when depkod-ba = "B" and depkod-turu = 4
                         write takas-rec invalid rewrite takas-rec,end-write,
                    when depkod-ba = "A" and depkod-turu = 3
                         write takas-rec invalid rewrite takas-rec,end-write,
                    when depkod-ba = "A" and depkod-turu = 5
                         write takas-rec invalid rewrite takas-rec,end-write,
                end-evaluate,
                if depkod-ba = "A" and depkod-turu = 5,
                    initialize takas-rec,
                    move "B"                            to takas-ba,
                    move depkod-kodu                    to takas-kodu,
                    move "X" to takas-tipi,
                    initialize onkasa-rec,
                    move tarih to onkasa-tarih,
                    move depkod-kodu to onkasa-dep,
                    read onkasa no lock invalid continue,
                         not invalid move onkasa-tutar-tl to takas-tutar,
                    end-read,
                    write takas-rec invalid rewrite takas-rec,end-write,
                end-if,
                evaluate true,
                    when depkod-ba = "B" and depkod-turu = 3
                    compute alac-nakit = alac-nakit + takas-tutar,
                    when depkod-ba = "B" and depkod-turu = 4
                    compute alac-nakit = alac-nakit + takas-tutar,
                    when depkod-ba = "A" and depkod-turu = 3
                    compute borc-nakit = borc-nakit + takas-tutar,
                end-evaluate,
            end-read,
        end-perform,
    end-start.
    close pkodlar
    perform duzenle thru duzenle-exit.
 takas-aktar-exit.
    exit.
 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid move 1 to ekran-fis-1.
   
    add 1 to ekran-fis-1.
   
    move ekran-fis-1(2:) to takas-no takas3-no takas4-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    open output takas close takas open i-o takas with mass-update.
    open output takas4 close takas4 open i-o takas4 with mass-update.
    open output takas3 close takas3 open i-o takas3 with mass-update.

    initialize takas-rec takas3-rec.
 duzen-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid move 1 to ekran-fis-1.
   
    add 1 to ekran-fis-1.
    move ekran-fis-1(2:) to duzen-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    open output duzen close duzen open i-o duzen with mass-update.
    initialize duzen-rec.
 duzenle.
    perform duzen-dosya-ac.
    initialize takas-rec borc-top alac-top.
    start takas key not < takas-anahtar invalid continue,
        not invalid,
        move spaces to evet-hayir,
        move 0 to borc-sira alac-sira,
        perform with test after until evet,
            read takas next no lock end move "E" to evet-hayir,
                not end,
           
                initialize duzen-rec,
                 
                evaluate true
                when takas-ba = "A"
                     add 1            to borc-sira,
                     move borc-sira   to duzen-sira,
                     read duzen no lock invalid continue,end-read,
                     move takas-kodu  to duzen-borc-kodu,
                     move takas-tutar to duzen-borc-tutar,
                     write duzen-rec invalid rewrite duzen-rec,end-write,
                      if takas-kodu(1:3) not = 993 | dovizler toplama ilave olmasýn
                          compute borc-top = borc-top + takas-tutar,
                      end-if
                     
                when takas-ba = "B"
                     add 1            to alac-sira,
                     move alac-sira   to duzen-sira,
                     read duzen no lock invalid continue,end-read,
                     move takas-kodu  to duzen-alac-kodu,
                     move takas-tutar to duzen-alac-tutar,
                     write duzen-rec invalid rewrite duzen-rec,end-write,
                     if takas-kodu(1:3) not = 993 | dovizler toplama ilave olmasýn
                        compute alac-top = alac-top + takas-tutar,
                     end-if 
                end-evaluate,
            end-read,
        end-perform,
    end-start.
    
 duzenle-exit.
    exit.
 liste-detay-ata.
    initialize dokumer-rec detay.
        
    if duzen-borc-kodu > 0
            move duzen-borc-kodu(3:)                to det-1 depkod-kodu
            read depkod no lock invalid 
                move spaces to depkod-adi
            end-read 
            move depkod-adi                         to det-2     
            move duzen-borc-tutar                   to z-1
            move z-1                                to det-3
    end-if
    if duzen-alac-kodu > 0
            move duzen-alac-kodu(3:)                to det-4 depkod-kodu
            read depkod no lock invalid 
               move spaces to depkod-adi
            end-read
            move depkod-adi                         to det-5
            move duzen-alac-tutar                   to z-1
            move z-1                                to det-6
    end-if
     
    move spaces to fil-1 fil-4.
    if duzen-borc-kodu = 994 move spaces  to det-1
                             move "TL Kasa avansi" to det-2.
    if duzen-borc-kodu(1:3) = "993" 
            move spaces  to det-1
            initialize doviz-rec
            move duzen-borc-kodu(4:2)  to doviz-kodu
            read doviz no lock invalid 
                  continue 
            end-read
            initialize det-2
            move d-kisa-adi    to det-2(1:5)
            move "Kasa avansi" to det-2(7:)
    end-if 
    if duzen-alac-kodu(1:3) = "993" 
            move spaces  to det-4
            initialize doviz-rec
            move duzen-alac-kodu(4:2)  to doviz-kodu
            read doviz no lock invalid 
                  continue 
            end-read
            initialize det-5
            move d-kisa-adi    to det-5(1:5)
            move "Kasa avansi" to det-5(7:)
    end-if

    if duzen-borc-kodu = 997 move spaces  to det-1
                             move "Onburo disi gelir" to det-2.
    if duzen-alac-kodu = 995 move spaces  to det-4
                             move "TL Kasa avansi" to det-5.
    if duzen-alac-kodu = 996 move spaces  to det-4
                             move "Doviz" to det-5.
    if duzen-alac-kodu = 998 move spaces  to det-4
                             move "Onburo disi gider" to det-5.
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 .

 liste-toplam.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
    write dokumer-rec from detay

    initialize dokumer-rec detay
    move "Borc Toplam   :"  to det-2.
    move "Alacak Toplam:"   to det-5.
    move borc-top           to z-1.      
    move z-1                to det-3.
    move alac-top           to z-1.
    move z-1                to det-6.
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6.
    write dokumer-rec from detay.

    initialize dokumer-rec detay
*    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
    write dokumer-rec from detay


    initialize dokumer-rec detay bakiye.
    move "Kasa nakit    :"  to det-2.
         compute bakiye = (borc-nakit - alac-nakit) + onavans-avans-tl
         move bakiye to z-1,
         move z-1    to det-3
    move "KASA TOPLAM"  to det-6
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6.
    write dokumer-rec from detay.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
    write dokumer-rec from detay.
*    initialize dokumer-rec detay
*    move "-"            to det-dokumer-20(5:1)
*    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
*    write dokumer-rec from detay

    initialize dokumer-rec detay bakiye.
    move "Muhasebe devir:"  to det-2.
         compute bakiye = borc-top - alac-top,
         move bakiye to z-1,
         move z-1    to det-3,

         move bakiye to z-1,
         move z-1    to det-5(1:22),

         move "TL"  to det-5(23:)

         move " TL"  to det-4

    compute bakiye = bakiye + onavans-avans-tl
         move bakiye to z-1,
         move z-1    to det-6,

    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6.
    write dokumer-rec from detay.

     initialize takas3-rec
    start takas3 key not < takas3-doviz invalid continue
        not invalid
        move spaces to evet-hayir
        perform with test after until evet
            read takas3 next no lock end move "E" to evet-hayir
                not end
                initialize dokumer-rec detay doviz-rec

                move takas3-doviz to  doviz-kodu
                read doviz no lock invalid 
                     initialize d-kisa-adi,end-read
                move d-kisa-adi    to det-4
                move takas3-miktar to z-1
                move z-1           to det-3
                move d-kisa-adi    to det-2(1:4)
                move "Tahsilat"    to det-2(5:)

                move takas3-miktart to z-1
                move z-1            to det-5(1:22)

                move "TL"           to det-5(23:)

                compute takas3-mik2 = takas3-mik2 + takas3-miktar
                move takas3-mik2 to z-1
                move z-1           to det-6

                move "A"          to det-dokumer-20(3:1)
                move 481          to det-renk1
                move "1"          to det-dokumer-20(10:1)
                move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                write dokumer-rec from detay
            end-read
        end-perform




    end-start.
    if kk-icmal = 1
       


       perform kredi-karti-detay
    end-if 

    close takas takas3 takas4.
    delete file takas takas3 takas4.
*
 kredi-karti-detay.
    open input yromhrk depkod
    initialize yromhrk-rec depkod-rec tkk-tl
    move  tarih to yromhrk-tarih
    start yromhrk key not < yROMHRK-ANAH2 invalid 
         continue 
    not invalid 
    perform until fs-yromhrk = "10"
    read yromhrk next no lock end move "10" to fs-yromhrk
    not at end 
           if yromhrk-tarih <> tarih
               exit perform 
           end-if
           initialize depkod-rec 
           move yromhrk-depkod  to depkod-anah
           read depkod no lock invalid 
                continue 
           not invalid 
               if depkod-ba = "A" and depkod-turu = 5
*                  if yromhrk-dovizli-kk  = 1
                      perform dkk
*                  else                         
*                      add yromhrk-tl-tutar to tkk-tl
*                  end-if
               end-if            
           end-read 
    end-read 
    end-perform
    end-start
    close yromhrk 
    open input doviz
    initialize takas4-rec 
    start takas4 key not < takas4-doviz invalid
        continue 
    not invalid 
    perform until fs-takas4 = "10"
    read takas4 next no lock end move "10" to fs-takas4
    not at end 
                initialize dokumer-rec detay doviz-rec

                move takas4-doviz3 to  doviz-kodu
                read doviz no lock invalid 
                     initialize d-kisa-adi,end-read
                move d-kisa-adi    to det-4


                initialize depkod-rec
                move takas4-doviz2 to depkod-anah
                read depkod no lock invalid 
                  continue 
                end-read



                move takas4-miktar to z-1
                move z-1           to det-3

                move depkod-adi    to det-2
                

                                move takas4-tutar to z-1
                move z-1            to det-5(1:22)

                move "TL"           to det-5(23:)

 

                move "A"          to det-dokumer-20(3:1)
                move 112          to det-renk1
                move "1"          to det-dokumer-20(10:1)
                move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                write dokumer-rec from detay             
    end-read 
    end-perform
    end-start
      close doviz depkod
    .
*
 dkk.
                   initialize takas4-rec
                   move yromhrk-doviz-kodu    to takas4-doviz3
                   move yromhrk-depkod        to takas4-doviz2
***                   takas4-doviz 
                  
                   read takas4 invalid continue end-read      
                   add yromhrk-doviz-tut to takas4-miktar  
                   add yromhrk-tl-tutar  to takas4-tutar  
                      
                   write takas4-rec invalid rewrite takas4-rec,end-write.
     .
*
 xxxx.
*
 onavans-elangir.
    
      open i-o kasagir kur.
      initialize kasagir-rec onavans-gelir-tl   onavans-gider-tl
      move tarih to kasagir-tarih
      start kasagir key >= kasagir-tarih
             invalid continue
             not invalid 
             perform until fs-kasagir = "10"
               read kasagir next no lock end move "10" to fs-kasagir
                   not end 
                     if kasagir-tarih not = tarih 
                          move "10" to fs-kasagir
                          else
                           if kasagir-tip = "G"  
                              move tarih to kur-tarih
                              move kasagir-doviz-kodu to kur-doviz
                              move "01" to kur-banka
                              read kur no lock invalid
                                  move 1 to doviz-alis   
                                  initialize takas3-rec
                                   move kasagir-doviz-kodu    to  takas3-doviz
                                   read takas3 invalid continue end-read
                                   add kasagir-tutar to takas3-miktar 
                                   add kasagir-tutar to takas3-miktart
                                   write takas3-rec invalid rewrite takas3-rec end-write
                                   compute dov-boz-toplam rounded = dov-boz-toplam + (kasagir-tutar * doviz-alis)
                              not invalid 
                                if doviz-alis = 1 then 
                                  continue
                                 else
                                  initialize takas3-rec
                                   move kasagir-doviz-kodu    to  takas3-doviz
                                   read takas3 invalid continue end-read
                                   add kasagir-tutar to takas3-miktar 
                                   add kasagir-tutar to takas3-miktart
                                     write takas3-rec invalid rewrite takas3-rec end-write
                                  compute dov-boz-toplam rounded = dov-boz-toplam + (kasagir-tutar * doviz-alis)
                                end-if
                              end-read
                              compute  onavans-gelir-tl rounded = onavans-gelir-tl + (kasagir-tutar * doviz-alis)
        
                           end-if
                           if kasagir-tip = "C"  
                              move tarih to kur-tarih
                              move kasagir-doviz-kodu to kur-doviz
                              move "01" to kur-banka
                              read kur no lock invalid
                                  move 1 to doviz-alis   
                                  initialize takas3-rec
                                   move kasagir-doviz-kodu    to  takas3-doviz
                                   read takas3 invalid continue end-read
                                   subtract kasagir-tutar from takas3-miktar 
                                   subtract kasagir-tutar from takas3-miktart
                                     write takas3-rec invalid rewrite takas3-rec end-write
                                      compute dov-boz-toplam rounded = dov-boz-toplam - (kasagir-tutar * doviz-alis)
                              not invalid 
                                if doviz-alis = 1 then 
                                  continue
                                 else
                                  initialize takas3-rec
                                   move kasagir-doviz-kodu    to  takas3-doviz
                                   read takas3 invalid continue end-read
                                  subtract kasagir-tutar from  takas3-miktar 
                                  subtract kasagir-tutar from takas3-miktart
                                    write takas3-rec invalid rewrite takas3-rec end-write
                                       compute dov-boz-toplam rounded = dov-boz-toplam - (kasagir-tutar * doviz-alis)
                                end-if
                              end-read
                              compute  onavans-gider-tl rounded = onavans-gider-tl + (kasagir-tutar * doviz-alis)
        
                           end-if
                     end-if
               end-read
            end-perform 
      end-start

     close kasagir kur.

       
                            .
*
 takasr-aktar.
    open input konum konuk odalar.
    perform takas-dosya-ac.
    initialize onavans-rec borc-sira alac-sira borc-nakit alac-nakit.
      initialize dov-boz-rec dov-boz-toplam.
         MOVE RAPOR-REF TO ONAVANS-REF
            move tarih to onavans-tarih.
            initialize onavans-kim.
            read onavans no lock invalid 
               continue,
                     not invalid
                         move "A"           to takas-ba,
                         move "A"           to takas-tipi,
                         move 994           to takas-kodu,
                         move onavans-avans-tl to takas-tutar,
                         compute borc-nakit = borc-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,
                         move "B"           to takas-ba
                         move "A"           to takas-tipi,
                         move 995           to takas-kodu,
                         move onavans-avans-tl to takas-tutar,
                         compute alac-nakit = alac-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,

                         if onavans-doviz-kodu-1 > 0 and onavans-doviz-1 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-1 to takas-kodu(4:2) takas3-doviz                  
                                 move  onavans-doviz-1 to takas-tutar takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-1 to takas-kodu(4:2),                   
                                 move  onavans-doviz-1 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if
 
                         if onavans-doviz-kodu-2 > 0 and onavans-doviz-2 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-2 to takas-kodu(4:2), takas3-doviz                  
                                 move  onavans-doviz-2 to takas-tutar, takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-2 to takas-kodu(4:2),                   
                                 move  onavans-doviz-2 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if 
                         if onavans-doviz-kodu-3 > 0 and onavans-doviz-3 > 0
                                 initialize takas-rec
                                 move "B"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-3 to takas-kodu(4:2), takas3-doviz                  
                                 move  onavans-doviz-3 to takas-tutar, takas3-mik2
                                 write takas3-rec invalid rewrite takas3-rec,end-write,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                                 initialize takas-rec
                                 move "A"           to takas-ba
                                 move "A"           to takas-tipi,
                                 move 993           to takas-kodu(1:3)
                                 move onavans-doviz-kodu-3 to takas-kodu(4:2),                   
                                 move  onavans-doviz-3 to takas-tutar,
                                 write takas-rec invalid rewrite takas-rec,end-write,

                         end-if 
                         perform onavans-elangir



                         move "A"           to takas-ba,
                         move "A"           to takas-tipi,
                         move 997           to takas-kodu,
                         move onavans-gelir-tl to takas-tutar,
                         compute borc-nakit = borc-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write,
                         move "B"           to takas-ba
                         move "A"           to takas-tipi,
                         move 998           to takas-kodu,
                         move onavans-gider-tl to takas-tutar,
                         compute alac-nakit = alac-nakit + takas-tutar,
                         write takas-rec invalid rewrite takas-rec,end-write.




  
    move tarih to dov-boz-tarih.
    open input dov-boz.
    start dov-boz key not < dov-boz-anah invalid continue,
        not invalid,
        move spaces to evet-hayir,
        perform with test after until evet,
            read dov-boz next no lock end move "E" to evet-hayir,
                not end,
                if dov-boz-tarih > tarih
                           move "E" to evet-hayir,
                end-if,
                if dov-boz-durumu = "S" 
                   exit perform cycle
                end-if
                if dov-boz-tarih not > tarih,
                initialize konuk-rec
                move dov-boz-folio to konuk-folio
                   perform ref-bul
                 if konum-ref = rapor-ref then
*****************************************  
              if onkpara-dovboz-komisyon-bas = 1 then
******************yeniden bak
                      compute dov-boz-toplam = dov-boz-toplam + dov-boz-tl-tutar
                     else
                       compute dov-boz-toplam = dov-boz-toplam + dov-boz-net-tl-tutar,
               end-if                 
                 
                   initialize takas3-rec
                   move dov-boz-doviz    to  takas3-doviz
                   read takas3 invalid continue end-read
                   add dov-boz-dv-tutar to takas3-miktar 
                   add dov-boz-tl-tutar to takas3-miktart
                   write takas3-rec invalid rewrite takas3-rec,end-write
************** compute dov-boz-toplam = dov-boz-toplam + dov-boz-tl-tutar,
                 end-if,
                end-if,
            end-read,
        end-perform,
    end-start.
    close dov-boz.
    compute alac-nakit = alac-nakit + dov-boz-toplam.
    move "B"              to takas-ba.
    move "B"              to takas-tipi.
    move 996              to takas-kodu.
    move dov-boz-toplam   to takas-tutar.
    write takas-rec invalid rewrite takas-rec,end-write.
    initialize depkod-rec.
    start depkod key not < depkod-kodu invalid go takasr-aktar-exit,
        not invalid,
        move spaces to evet-hayir,
        perform with test after until evet,
            read depkod next no lock end move "E" to evet-hayir,
                not end,
                initialize takas-rec,
                move depkod-ba                      to takas-ba,
                move depkod-kodu                    to takas-kodu,
                evaluate true,
                    when depkod-ba = "B" and depkod-turu = 3
                                             move "X" to takas-tipi,
                    when depkod-ba = "B" and depkod-turu = 4
                                             move "X" to takas-tipi,
                    when depkod-ba = "A" and depkod-turu = 3
                                             move "X" to takas-tipi,
                    when depkod-ba = "A" and depkod-turu = 5
                                             move "X" to takas-tipi,
                end-evaluate,
                initialize onkasar-rec,
                move rapor-ref to onkasar-ref
                move tarih to onkasar-tarih,
                move depkod-kodu to onkasar-dep,
                read onkasar no lock invalid continue,
                     not invalid move onkasar-tutar-tl to takas-tutar,
                end-read,
                evaluate true,
                    when depkod-ba = "B" and depkod-turu = 3
                         write takas-rec invalid rewrite takas-rec,end-write,
                    when depkod-ba = "B" and depkod-turu = 4
                         write takas-rec invalid rewrite takas-rec,end-write,
                    when depkod-ba = "A" and depkod-turu = 3
                         write takas-rec invalid rewrite takas-rec,end-write,
                    when depkod-ba = "A" and depkod-turu = 5
                         write takas-rec invalid rewrite takas-rec,end-write,
                end-evaluate,
                if depkod-ba = "A" and depkod-turu = 5,
                    initialize takas-rec,
                    move "B"                            to takas-ba,
                    move depkod-kodu                    to takas-kodu,
                    move "X" to takas-tipi,
                    initialize onkasar-rec,
                                    move rapor-ref to onkasar-ref
                    move tarih to onkasar-tarih,
                    move depkod-kodu to onkasar-dep,
                    read onkasar no lock invalid continue,
                         not invalid move onkasar-tutar-tl to takas-tutar,
                    end-read,
                    write takas-rec invalid rewrite takas-rec,end-write,
                end-if,
                evaluate true,
                    when depkod-ba = "B" and depkod-turu = 3
                    compute alac-nakit = alac-nakit + takas-tutar,
                    when depkod-ba = "B" and depkod-turu = 4
                    compute alac-nakit = alac-nakit + takas-tutar,
                    when depkod-ba = "A" and depkod-turu = 3
                    compute borc-nakit = borc-nakit + takas-tutar,
                end-evaluate,
            end-read,
        end-perform,
    end-start.
    perform duzenle thru duzenle-exit.
 takasr-aktar-exit.
    close konum konuk odalar.
    
*
 ref-bul.
           read konuk no lock invalid 
                continue
           end-read
           evaluate onkpara-referans-nerden     
              when 2  
                MOVE KONUK-ODAno TO odalar-anah
                READ odalar NO LOCK INVALID
                      DISPLAY MESSAGE BOX "oda-KONUK-23644"
                END-READ  
                move odalar-referans to konum-ref

              when other   
                MOVE KONUK-ODA-KONUMU TO KONUM-ANAHTAR
                READ KONUM NO LOCK INVALID
                      DISPLAY MESSAGE BOX "kasa-KONUK-23644   " dov-boz-folio
                END-READ
           end-evaluate
                .
*
 Form1-Ef-1-Aft-Procedure.
     if hangi-ref-secildi > 0
       if hangi-ref-secildi not = rapor-ref
            move hangi-ref-secildi  to rapor-ref
            display Form1-Ef-1
       end-if 
    end-if 
            .

 
