* webrez.evt
* webrez.evt is generated from D:\asya\acugt.ytl\otel\webrez.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Gd-1-Event-Proc.
     .
***   start event editor code   ***
*
 Form1-Bef-Create.    
     call "c$narg" using link-var.
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open input genel genel2
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read

     initialize genel2-rec 
     move 1 to genel2-anah 
     read genel2 no lock invalid
          continue 
     end-read 

     close genel genel2.
     move CALISMA-TARIHI to tarih-tasi  
     perform ozel-durum-bul
     
     move "2500" to web-acenta.

     perform konum-ata.
      open extend wlog.                                                                                  
     .
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka.
     move rezpara-doviz       to xrez-doviz.
     move rezpara-pan-tipi    to xrez-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi.
     move rezpara-ulke        to xrez-ulke.
     move rezpara-anlasma     to xrez-anlasma.
     move rezpara-pazar       to xrez-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil xrez-al-yil rez-al-yil    .
     move calis-ay            to xrez-gir-ay  xrez-cik-ay  xrez-al-ay  rez-al-ay  .
     move calis-gun           to xrez-gir-gun xrez-cik-gun xrez-al-gun rez-al-gun.

           move "4" to xrez-statu
   
            move "1" to xrez-tipi 
     
            move rezpara-k-g-b to xrez-k-g-b 
     
            move "N" to xrez-vip 

           
     
       .
 konum-ata.
*************Konumlar Yukleniyor.......
     perform doviz-karsilik-bul
 
     open i-o konum konumek .
     initialize konum-rec tmp-sayi konumlar.
     start konum key not < konum-anahtar invalid 
           continue
     not invalid 
     initialize fs-konum

     if link-var > 0 then 
       move 1 to d 
       move  gweb-gelen-otel to web-gelen-otel
     end-if
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
      if KONUM-WEBTE-SATIS = 1 then 
        if onkpara-referans-var = 1 then 
          if onkpara-referans-nerden = 1
           if function upper-case(web-gelen-otel(1:3)) not = 
              function upper-case(ref-adi(konum-ref)(1:3))
              exit perform cycle
           end-if
          end-if 
        end-if
*//**************para birimine göre konumlar cikmasin
        initialize konumek-rec
        move konum-anahtar to konumek-anahtar
        read konumek no lock invalid 
            continue 
        not invalid           

             if konumek-web-eur = 1 
                if  konumek-dv-1 > 0                     
                 if xrez-doviz = konumek-dv-1
                     exit perform cycle 
                 end-if
                end-if
             end-if
             if konumek-web-usd = 1 
                if  konumek-dv-2 > 0
                 if xrez-doviz = konumek-dv-2
                     exit perform cycle 
                 end-if
                end-if
             end-if
             if konumek-web-tl = 1
                if konumek-dv-3 > 0
                 if xrez-doviz = konumek-dv-3
                     exit perform cycle 
                 end-if
                end-if
             end-if
             if konumek-web-gbp = 1 
                if konumek-dv-4 > 0
                 if xrez-doviz = konumek-dv-4
                     exit perform cycle 
                 end-if
                end-if
             end-if
                            
        end-read 
*//**************para birimine göre konumlar cikmasin
        add 1              to tmp-sayi
        move KONUM-ANAHTAR to wkonum-no(tmp-sayi)
        move konum-adi     to wkonum-adi(tmp-sayi)
      end-if
     end-read
     end-perform
     end-start
     close konum konumek.
*
 Form1-Aft-Initdata.
*/-----------------------------\*    
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     
    
     initialize rez-rec xrez-rec yan-deg. 
   
      copy "konumoku.prc".
     if link-var >= 1 then
         
          move gweb-tipxx    to      web-tipxx
          move gweb-debug  to    web-debug 
          move gweb-rec    to    web-rec
          move gweb2-rec   to    web2-rec
         if web-debug = 1 then 
           perform def-doldur2
           display message box   "ok"
          end-if 
           
            Perform islem
            open i-o weblog
            initialize weblog-rec
            move  web-ip to  weblog-ip-anah
            accept weblog-tarih from century-date
            accept  ara-zaman from time
            move ara-zaman to weblog-zaman 
            move xrez-no to weblog-hata-aciklama

            move web-rec to weblog-rec2
            | write weblog-rec invalid rewrite weblog-rec end-write
           close weblog
****               display message box   function length(weblog-rec),"---------------",  weblog-zaman
          if web-debug = 1 then 
                     perform ekran-yaz
                 
          end-if 
           move web-tipxx    to   gweb-tipxx
          move web-debug  to   gweb-debug 
          move web-rec    to    gweb-rec
          move web2-rec   to gweb2-rec

            

          set exit-pushed to true
        else
        perform def-doldur

     end-if .
     
*
 def-doldur2.
         initialize  g-rec
         move   "DATA " to gc1
         move "DEGER" to gc2
         perform varying i from 1 by 1 until i > 10
           move i to gd-o(i)
         end-perform 
         modify g1(1) record-data = g-rec
           initialize  g-rec
         move   "web-gelen-bastar " to gc1
               move "Otel" to gd-o(1)
         move "Kamelya" to gd-o(2)
         move web-gelen-bastar to gc2
         modify g1(2) record-data = g-rec
              initialize  g-rec
         move   "web-gelen-bittar" to gc1
         move web-gelen-bittar to gc2
         modify g1(3) record-data = g-rec
              initialize  g-rec
           move   "web-gelen-pax" to gc1
         move web-gelen-pax to gc2
         modify g1(4) record-data = g-rec
                initialize  g-rec
         move   "web-gelen-chi" to gc1
         move web-gelen-chi to gc2
         modify g1(5) record-data = g-rec
               initialize  g-rec
          move   "web-gelen-free" to gc1
         move web-gelen-free to gc2
           
         modify g1(6) record-data = g-rec

         initialize  g-rec
         move   "WEB GIDEN" to gc1
         move "xxxxxxxx" to gc2
         modify g1(7) record-data = g-rec 
          perform ekran-yaz .



     .
*
 def-doldur.
         initialize  g-rec
         move   "DATA " to gc1
         move "DEGER" to gc2
         perform varying i from 1 by 1 until i > 10
           move i to gd-o(i)
         end-perform 
         modify g1(1) record-data = g-rec
           initialize  g-rec
         move   "web-gelen-bastar " to gc1
                  move "Otel" to gd-o(1)
         move "Kamelya" to gd-o(2)
        
        
         move tarih-tasi to   gc2(1:8)
         modify g1(2) record-data = g-rec
              initialize  g-rec
         move   "web-gelen-bittar" to gc1
      
          move tarih-tasi to gc2(1:8)
          move "1.yas " to gd-o(1)
         move "2.yas " to gd-o(2)
          move "3.yas " to gd-o(3)
           move "4.yas " to gd-o(4)
            move "5.yas " to gd-o(5)
         modify g1(3) record-data = g-rec
              initialize  g-rec
              move   "web-gelen-pax" to gc1
             move "2" to gc2
       

         modify g1(4) record-data = g-rec
                initialize  g-rec
         move   "web-gelen-chi" to gc1
         move "0" to gc2
         modify g1(5) record-data = g-rec
               initialize  g-rec
          move   "web-gelen-free" to gc1
         move "0" to gc2
          move "Doviz" to  gd-o(1)
          move "Ulke" to  gd-o(2)
         move "Acenta" to gd-o(3)
      
         modify g1(6) record-data = g-rec
              initialize  g-rec
        move   "web-doviz " to gc1
      
       
          
           move web-doviz  to  gd-o(1)
           move "DE"        to   gd-o(2)
           move web-acenta to  gd-o(3)
           move web-ulke   to  gd-o(4)
         modify g1(7) record-data = g-rec
         initialize  g-rec
         move   "WEB GIDEN" to gc1
         move "xxxxxxxx" to gc2
         modify g1(8) record-data = g-rec 
          perform ekran-yaz .


*
  ekran-yaz.
      
         if web-ulke not = spaces 
   
           move web-doviz  to  gd-o(1)
           move web-ulke       to   gd-o(2)
           move web-acenta to  gd-o(3)
           move web-ulke   to  gd-o(4)
           move xrez-buyuk  to   gd-o(5)
           move xrez-kucuk to   gd-o(6)
            move xrez-free  to   gd-o(7)
             move xrez-bebek  to   gd-o(8)
         modify g1(7) record-data = g-rec
         end-if


          initialize  g-rec
         move   "WEB GIDEN" to gc1
         move "xxxxxxxx" to gc2
        perform varying i from 1 by 1 until i > 10
           move web-konum-kodu(i) to gd-o(i)
         end-perform 
         modify g1(8) record-data = g-rec 

               initialize  g-rec
          move   "web-konum-adi" to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-konum-adi(i) to gd-o(i)
         end-perform 
         modify g1(9) record-data = g-rec
         initialize  g-rec
           move   "web-musait-oda-sayisi" to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-musait-oda-sayisi(i) to z-sayi
           move z-sayi to gd-o(i)
         end-perform 
         modify g1(10) record-data = g-rec
           initialize  g-rec
         move   "oda-fiyati 1 " to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-gunluk(i,45) to z-para
           move z-para to gd-o(i)
         end-perform 
         modify g1(11) record-data = g-rec
             initialize  g-rec
         move   "web-oda-fiyati-toplam"    to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-toplam(i) to z-para
           move z-para to gd-o(i)

            move web-oda-fiyati-toplam(i) to z-para
           move z-para to gd-o(i)

         end-perform 
          modify g1(12) record-data = g-rec
               initialize  g-rec
         move   "HAM TOPLAM"    to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-toplam(i) to z-para
           move z-para to gd-o(i)

            move web-oda-fiyati-ham-toplam(i) to z-para
           move z-para to gd-o(i)

         end-perform 

         modify g1(13) record-data = g-rec
               initialize  g-rec
         move   "oda-fiyati 2 " to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-gunluk(i,2) to z-para
           move z-para to gd-o(i)
         end-perform 
           modify g1(14) record-data = g-rec
               initialize  g-rec
         move   "oda-ham 1 " to gc1
         move "    " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-gunluk-ham(i,1) to z-para
          
           move z-para to gd-o(i)
         end-perform 
           modify g1(15) record-data = g-rec


           initialize  g-rec
       
         move " 1   " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-gunluk-ind-tut(i,1,1) to z-para
           move z-para to gd-o(i)
         end-perform 
           modify g1(16) record-data = g-rec
         initialize  g-rec
     
         move " 2   " to gc2
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-gunluk-ind-tut(i,2,1) to z-para
           move z-para to gd-o(i)
         end-perform 
           modify g1(17) record-data = g-rec
            initialize  g-rec
         move  web-oda-fiyati-ind-adi(1,1) to gc1
         move " Toplam   " to gc2
         
         perform varying i from 1 by 1 until i > 10
           move web-oda-fiyati-ind-tut(i,1) to z-para
           move z-para to gd-o(i)
         end-perform 
           modify g1(18) record-data = g-rec
              initialize  g-rec
           move "RATE" to gc2
             
            
           modify g1(19) record-data = g-rec
                initialize  g-rec
           move "Oran 1"  to gc2
            perform varying i from 1 by 1 until i > 10
             move web-rate-carpan(i,1) to z-para move z-para to gd-o(i)
             end-perform
             
            
           modify g1(20) record-data = g-rec
                initialize  g-rec
           move "Aciklama"  to gc2
            perform varying i from 1 by 1 until i > 10
             move web-rate-adi(i,2) to  gd-o(i)
             end-perform
            move "koodu"  to gc2
            perform varying i from 1 by 1 until i > 10
             move web-rate-kodu(i,2) to  gd-o(i)
            end-perform
               
            
           modify g1(22) record-data = g-rec
        .
*        
 anlasma-bul.   
       open input acenta
         move xrez-acenta  to acenta-kodu 
          read acenta no lock invalid 
               continue
          end-read

          if acenta-rate-acenta > spaces
             move acenta-rate-acenta to acenta-kodu 
             read acenta no lock invalid
                move xrez-acenta to  xREZ-RATE-ACENTA
             not invalid 
                move acenta-kodu to xREZ-RATE-ACENTA xrez-acenta ||| long beach ramazan 10-12-2019
             end-read
          else
                move xrez-acenta to  xREZ-RATE-ACENTA
          end-if
            move xrez-acenta  to acenta-kodu 
            read acenta no lock invalid continue
            end-read
        close acenta 

     initialize aceanlas-rec def-anl-bulundu
     move xREZ-RATE-ACENTA        to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end

                             |||X 

           if xREZ-RATE-ACENTA not =  aceanlas-acenta then
               move "10" to fs-aceanlas 
           else
*              if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
*                 if onkpara-referans-var = 1 
*                    evaluate onkpara-referans-nerden
*                        when 1 
*                             open input konum 
*                             initialize konum-rec 
*                             move xrez-fiyat-konumu to konum-anahtar 
*                             read konum no lock invalid
*                                  continue
*                             end-read 
*                             close konum
*                             if konum-ref not = aceanlas-referans and aceanlas-referans not = 0
*                                exit perform cycle
*                             end-if
*                        when 2
*                             open input odalar 
*                             initialize odalar-rec 
*                             move xrez-odano to odalar-rec 
*                             read odalar no lock invalid
*                                  continue
*                             end-read 
*                             close odalar 
*                             if odalar-referans not = aceanlas-referans  and aceanlas-referans not = 0
*                                exit perform cycle
*                             end-if
*                    end-evaluate 
*                 end-if
*              end-if  
            if aceanlas-tutar-sira > 0 and  aceanlas-tutar-sira <= 9
             
             if xkonum-tutar-sira(xrez-fiyat-konumu) not = aceanlas-tutar-sira
               exit perform  cycle
              end-if
           end-if
             if aceanlas-haftatek > "9" then 
                   move 0 to    aceanlas-haftatek 
             end-if
             if aceanlas-sart-var-online = 1 or aceanlas-hs = 1 or 
               aceanlas-min-max-var = 1 or aceanlas-haftatek > 0 then 
                    perform ace-takvim
              end-if
             if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
                xrez-gir-tar >= aceanlas-donem-bas and
                xrez-gir-tar <= aceanlas-donem-bit 
                and 
                (aceanlas-min-max-var not = 1 or                                
                  (ace-top-gece >= aceanlas-min-gece and 
                    ace-top-gece <= aceanlas-max-gece )                                  
                    ) and 
                ( aceanlas-hs not = 1  or ace-hs-var = 1  ) and 
                 (aceanlas-sart-var-online not = 1 or 
                  (ace-sart-gece >= aceanlas-sart-min-gece and 
                    ace-sart-gece <= aceanlas-sart-max-gece ))  


                move 1 to def-anl-bulundu
                  move aceanlas-anlasma     to xrez-anlasma
                  move aceanlas-ear         to xrez-eb
                  move aceanlas-aks-yok     to xrez-aksiyon-eh
                  move aceanlas-spe-yok     to xrez-special-eh
                   if aceanlas-ear= 1 move "E" to xrez-eb
                  else     move "H" to xrez-eb
                      end-if
                 if aceanlas-spe-yok= 1 or "H" then move "H" to xREZ-SPECIAL-EH
                         else     move "E" to xREZ-SPECIAL-EH
                      end-if
               if aceanlas-aks-yok = 1 move "H" to xrez-AKSIYON-EH
                         else     move "E" to xrez-AKSIYON-EH
                end-if
               move "10" to fs-aceanlas 
             end-if
           end-if
     end-read
     end-perform
     end-start
      .
       

*
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move web-acenta to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.

       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
       if acen-dft-early= 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if .
       
*
 Exception-Procedure.
     evaluate key-status 
         when 2
              inquire g1(2) record-data in g-rec
              move gc2      to web-gelen-bastar
              move gd-o(2)  to web-gelen-otel
              inquire g1(3) record-data in g-rec
              move gc2      to web-gelen-bittar
              inquire g1(4) record-data in g-rec
              move function numval(gc2)     to web-gelen-pax
              move function numval(gd-o(1)) to web-gelen-cocuk-yas(1)
              move function numval(gd-o(2)) to web-gelen-cocuk-yas(2)
              move function numval(gd-o(3)) to web-gelen-cocuk-yas(3)
              move function numval(gd-o(4)) to web-gelen-cocuk-yas(4)
              move function numval(gd-o(5)) to web-gelen-cocuk-yas(5)
              inquire g1(5) record-data in g-rec
              move function numval(gc2)     to web-gelen-chi 
              inquire g1(6) record-data in g-rec
              move function numval(gc2)     to web-gelen-free
              inquire g1(7) record-data in g-rec
              move  gc2    to  web-doviz  
              move gd-o(2) to web-ulke
              move 1 to web-tipxx 
              move 0 to web-debug
           
              call "/asya/ytl/obj/otel/webrez.asy" 
                     using   web
                     on exception 
                     perform callerr-proc
                     exit paragraph
                     not on exception 
                cancel "/asya/ytl/obj/otel/webrez.asy"
              end-call
       
              
*         perform islem
              perform ekran-yaz
     end-evaluate
     .
 islem.             
     perform konum-ata
     initialize xrez-rec
     perform rez-parametre-ata 
*     move 52384 to  web-rez-no
*     stop " " 
    if function numval(web-rez-no) > 0 then
      open input rez
        move function numval(web-rez-no) to rez-no
        read rez no lock invalid
         move tarih-tasi to gelen-al-tar
       not invalid 
          move rez-al-tar to gelen-al-tar
     end-read
     close rez
     else
        move tarih-tasi to gelen-al-tar
     end-if
     move gelen-al-tar to xrez-al-tar lnk2-al-tar
     move 99998888 to xrez-no


     ||29.02.2020 STONE ICIN EKLENDI SALIH
     perform ozel-durum-bul
     ||29.02.2020 STONE ICIN EKLENDI SALIH

        open i-o genelfis
             move 5 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 5 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no 
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to  rez-oto
                  
                  move rez-oto to xrez-no 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
       move "9999" to xrez-no(1:4)


       initialize web-giden
       open input ulke uyrukweb doviz 
       open i-o aceuyruk
   
         move web-gelen-bastar  to xrez-gir-tar
         move web-gelen-bittar  to xrez-cik-tar
         move web-gelen-pax     to xrez-buyuk
         move web-gelen-chi     to xrez-kucuk
          
         move web-ulke to uyrukweb-web-kodu
         read uyrukweb no lock key  uyrukweb-web-kodu  invalid 
              move rezpara-web-ulke to xrez-ulke
         not invalid 
              move uyrukweb-ulke to xrez-ulke
         end-read

         initialize ulke-rec
         move xrez-ulke to ULKE-ANAH
         read ulke no lock invalid 
           move  rezpara-web-ulke to ULKE-ANAH
           read ulke no lock invalid 
               move  rezpara-web-ulke to ULKE-ANAH
                 display message box " Defult ulke yok"                 
           end-read           
         end-read
*/******************************stone group için / ramazan       
         initialize aceuyruk-rec
         move uyrukweb-kodu        to aceuyruk-uyruk
         start aceuyruk key not < aceuyruk-anah1 invalid 
              continue 
         not invalid 
         perform until fs-aceuyruk = "10"
         read aceuyruk next no lock end move "10" to fs-aceuyruk
         not at end 
                  if aceuyruk-uyruk <> uyrukweb-kodu
                      exit perform 
                  end-if 
                  if xrez-gir-tar >= aceuyruk-k-bas-tar   and
                     xrez-gir-tar < aceuyruk-k-bit-tar  
                        move aceuyruk-acenta to ulke-web-acenta
                        exit perform 
                  end-if 
         end-read 
         end-perform
         end-start
*/******************************stone group için / ramazan
         move ulke-web-acenta to web-acenta
         move web-acenta      to xrez-acenta


         perform acen-dft-oku
         move xrez-doviz to doviz-kodu
         read doviz no lock invalid 
            continue
         not invalid
            move d-kisa-adi to web-doviz
         end-read
       close ulke uyrukweb doviz aceuyruk


       move web-gelen-free     to xrez-free
       
       open input aceanlas yassinir 


       perform anlasma-bul
    
     if def-anl-bulundu = 1
           move aceanlas-anlasma to xrez-anlasma web-anlasma
           open input kodlar02
           move "D" to kodlar02-tipi
           move xrez-anlasma to kodlar02-kodu
           read kodlar02 no lock invalid continue
           end-read
           close kodlar02
           move kodlar02-adi to web-anlasma-adi
     else           
         display message box "Gecerli Anlasma girisi bulunamadi"
         move 1 to hata-oldu 
     end-if.  
      initialize  lnk2.
       move gelen-al-tar to lnk2-al-tar
         move xrez-gir-tar   to lnk2-gir-tar  
    move  xrez-cik-tar  to lnk2-cik-tar  
      move xrez-acenta  to  lnk2-acenta
      move xrez-anlasma to  lnk2-anlasma
      perform varying pi from 1 by 1 until pi > xrez-buyuk
              move 50 to lnk2-yas(pi)
      end-perform 
       open input acenta  nt kodlar02
          move xrez-acenta to acenta-kodu
          read acenta no lock invalid 
              continue
          not invalid  
*/*********lonicera için eklendi                    
               initialize not-rec 
               move "ACE" to not-dos
               move "Default" to not-dos-anah
               move xrez-acenta to not-dos-anah(8:)
               read nt no lock invalid
                    continue   
               not invalid   
                    move not1 to acen-dft
                    if acen-dft-ozl-drm-sabit > 0                                  
                       initialize kodlar02-rec
                       move "Z"   to kodlar02-tipi
                       move acen-dft-ozl-drm to kodlar02-kodu
                       read kodlar02 no lock invalid
                           continue
                       not invalid 
                              move kodlar02-sayisal   to def-carpan
                              compute  def-carpan rounded = def-carpan / 100
                              move acen-dft-ozl-drm to xREZ-OZEL-DURUM
                       end-read                    
                    end-if 
                end-read 
*/*********lonicera için eklendi                   
          end-read
       close acenta nt kodlar02   
      perform varying zi from pi by 1 until  zi > 8
          compute ai = zi - pi + 1 
          if ai not > 5 
         if web-gelen-cocuk-yas(ai) > 0 then 
           
            move web-gelen-cocuk-yas(ai)  to   lnk2-yas(zi)
         end-if

         end-if
     end-perform 
      
      perform link2
      close aceanlas yassinir
     
      if genel-ogretmenevi-online = 1
          move web-gelen-pax     to myassinir-pax
          move web-gelen-chi     to myassinir-chi
      end-if 

      move myassinir-pax  to xrez-buyuk   web-gelen-pax   
      move myassinir-chi  to xrez-kucuk   web-gelen-chi 
      move myassinir-fre  to xrez-free    web-gelen-free 
      move myassinir-beb  to xrez-bebek   web-gelen-bebek
      
      if genel-ogretmenevi-online = 1
         if  xrez-buyuk = 0
             move 1 to xrez-buyuk
         end-if 
      end-if 

      perform kontenjan2-kont 
      perform kontenjan-kont
 
     if genel-ogretmenevi-online = 1
        if web-gelen-pax = 0
            move 0 to xrez-buyuk
        end-if 
     end-if 

     perform fiyat-kont
     initialize  gcol
     open input konum konumek
     perform varying i from 1 by 1 until i > tmp-sayi 
      if wkonum-no(i) > 0 then 
        continue
        else
        exit perform cycle
      end-if
      if gcol > 19 then
         exit perform cycle
      end-if
         add 1 to gcol
           move wkonum-no(i)                to web-konum-kodu(gcol)
       move wkonum-adi(i)               to web-konum-adi(gcol)          
       move wkonum-musait-oda-sayisi(i) to web-musait-oda-sayisi(gcol) 
       move wkonum-adi(i)               to web-konum-adi(gcol) 



*************************************************
      open input aceanlas yassinir
       move  wkonum-no(i) to link2-fiyat-konumu 
        perform link2
      close aceanlas yassinir
      if genel-ogretmenevi-online = 1
          move web-gelen-pax     to myassinir-pax
          move web-gelen-chi     to myassinir-chi
      end-if      
      move  myassinir-pax  to xrez-buyuk   web-gelen-pax  
 
      move myassinir-chi  to xrez-kucuk    web-gelen-chi 
      move myassinir-fre  to xrez-free     web-gelen-free 
      move myassinir-beb  to xrez-bebek    web-gelen-bebek




***************************************************
       move def-carpan to web-rate-carpan(gcol,2)
       move 1 to web-rate-carpan(gcol,1)

      if wkonum-gece(i) < 1 and def-carpan < 1   
*****           move 0 to web-musait-oda-sayisi(gcol) 
         move "Minumum 3 gece konaklamalar icin gecerlidir"   to web-rate-adi(gcol,2)
      else
       if genel-web-stil NOT = "D"
          move spaces   to web-rate-adi(gcol,2)
       END-IF
      end-if
     
      if acenta-minumum-geceleme > 0 and 
         acenta-minumum-geceleme > wkonum-gece(i)      
           move acenta-minumum-geceleme to z
           initialize web-rate-adi(gcol,1) web-rate-adi(gcol,2),  web-rate-adi(gcol,3)
***            move 0 to web-musait-oda-sayisi(gcol) 
           string 
            "Minumum "    delimited by size
            z delimited by size
            " gece konaklamalar icin gecerlidir" delimited by size
           into web-rate-adi(gcol,1) 
           move web-rate-adi(gcol,1) to web-rate-adi(gcol,2) , web-rate-adi(gcol,3)

      end-if
      if genel-web-stil = "D" then 
        move  0.93 to web-rate-carpan(gcol,3)   
***        move  299.88 to web-rate-cekilecek(gcol,3)        
         move 3 to web-rate-kodu(gcol,3)
       end-if    
*/******************************************************************************************
    OPEN input aceanlas

     initialize aceanlas-rec def-anl-bulundu 
     move web-acenta        to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end

           if xrez-acenta not =  aceanlas-acenta then
               move "10" to fs-aceanlas 
           else
*              if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
*                 if onkpara-referans-var = 1 
*                    evaluate onkpara-referans-nerden
*                        when 1 
*                             open input konum 
*                             initialize konum-rec 
*                             move xrez-fiyat-konumu to konum-anahtar 
*                             read konum no lock invalid
*                                  continue
*                             end-read 
*                             close konum
*                             if aceanlas-referans not = spaces and aceanlas-referans not = 0
*                                if konum-ref not = aceanlas-referans
*                                   exit perform cycle
*                                end-if
*                             end-if 
*                        when 2
*                             open input odalar 
*                             initialize odalar-rec 
*                             move xrez-odano to odalar-rec 
*                             read odalar no lock invalid
*                                  continue
*                             end-read 
*                             close odalar 
*                             if aceanlas-referans not = spaces and aceanlas-referans not = 0
*                                if odalar-referans not = aceanlas-referans
*                                   exit perform cycle
*                                end-if
*                             end-if
*                    end-evaluate 
*                 end-if
*              end-if   |||X
            if aceanlas-tutar-sira > 0 and  aceanlas-tutar-sira <= 9              
               continue 
           end-if
             if aceanlas-haftatek > "9" then 
                   move 0 to    aceanlas-haftatek 
             end-if
             if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
               ((xrez-gir-tar >= aceanlas-donem-bas and xrez-gir-tar <= aceanlas-donem-bit) or 
               (xrez-cik-tar > aceanlas-donem-bas and xrez-cik-tar < aceanlas-donem-bit))
                   move 1    to def-anl-bulundu                  
                   move "10" to fs-aceanlas 
             end-if

           end-if
     end-read
     end-perform
     end-start
     close aceanlas  
***************************************************************************************************
      if def-anl-bulundu = 1
              if aceanlas-sart-var-online = 1
                 if (ace-sart-gece >= aceanlas-sart-min-gece and ace-sart-gece <= aceanlas-sart-max-gece ) or 
                     (genel-web-stil = "D" and ace-top-gece >= aceanlas-sart-min-gece and  ace-top-gece <= aceanlas-sart-max-gece)
                       move "10" to fs-aceanlas 
                 else
                   if genel-web-stil not = "D"  
                      initialize s2
                      
                     if xrez-gir-tar >= aceanlas-sart-bas   
                              move xrez-gir-tar      to gercek-gir-tar
                              move xrez-cik-tar to gercek-cik-tar 
                              if gercek-gir-tar not = gercek-cik-tar
                                      compute s1 = function INTEGER-OF-DATE(gercek-cik-tar) - 
                                                   function INTEGER-OF-DATE(gercek-gir-tar)                           
                                      if  aceanlas-sart-min-gece >= s1
                                              compute s2 =  aceanlas-sart-min-gece 
                                      end-if
                                      
                              else
                                      move aceanlas-sart-min-gece  to s2
                              end-if 
                      end-if
                  

                    ||||||||bayram sonuna etkileyen peryott|||||||||||||||
                    if xrez-gir-tar >= aceanlas-sart-bas and  
                       xrez-cik-tar >= aceanlas-sart-bit  
                        initialize s2
                        move xrez-gir-tar to gercek-gir-tar
                        move xrez-cik-tar to gercek-cik-tar                          
                        compute s1 = function INTEGER-OF-DATE(gercek-cik-tar) - 
                                     function INTEGER-OF-DATE(gercek-gir-tar)
              
                        if aceanlas-sart-min-gece > s1 
                          compute s2 = aceanlas-sart-min-gece                                                             
                       end-if 
                    end-if
                    |||||||||||||||||

                    if s2 > 0
                            move s2                     to z
                            move aceanlas-sart-max-gece to z1
                            initialize web-rate-adi(gcol,1) web-rate-adi(gcol,2)
****                     move 0 to web-musait-oda-sayisi(gcol)    
                            string 
                             "Minumum "    delimited by size
                             z delimited by size
                             " Maximum " delimited by size
                             z1 delimited by size 
                             " gece konaklamalar icin gecerlidir" delimited by size
                            into web-rate-adi(gcol,1) 
                            move web-rate-adi(gcol,1) to web-rate-adi(gcol,2)  web-rate-adi(gcol,3)
                    end-if
                  else
                   move aceanlas-sart-min-gece  to s2

                   move s2 to z
                       string 
                            "Minumum "    delimited by size
                            z delimited by size
                            " gece konaklamalar icin gecerlidir" delimited by size
                           into web-rate-adi(gcol,1) 
                      move  web-rate-adi(gcol,1) to web-rate-adi(gcol,2)  web-rate-adi(gcol,3)
                  end-if 
                 end-if       
              end-if 
      end-if



      move 1 to web-rate-kodu(gcol,1)
      move 2 to web-rate-kodu(gcol,2)

******************************************

     
      initialize konumek-rec
      move  wkonum-no(i) to konum-anahtar konumek-anahtar
       read konum no lock invalid continue
          not invalid 
          read konumek no lock invalid
            continue
          end-read             
          if konumek-cocuk-yok = 1 
            if xrez-kucuk +
                 xrez-free + xrez-bebek > 0  or web-gelen-chi  + web-gelen-free +  web-gelen-bebek > 0
                  move 0 to web-musait-oda-sayisi(gcol)    wkonum-musait-oda-sayisi(i)
              move " Cocuksuz Oda         " to   wkonum-adi(i)  web-konum-adi(gcol) 
                  perform varying ig from 1 by 1 until ig > 50
                    move 2 to  wkonum-oda-fiyati(i,ig)                  
                                wkonum-oda-fiyati-gunluk-ham(i,ig) 
                               


                    move 0 to  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,1)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,5) 
                end-perform 
             end-if
          end-if 
          
          if KONUM-MAX-KAPASITE  <  xrez-buyuk + xrez-kucuk +
                 xrez-free |   + xrez-bebek LONÝCERA ÝÇÝN
              move 0 to web-musait-oda-sayisi(gcol)    wkonum-musait-oda-sayisi(i)
              move " Oda Max. Kapasitesi Asildi. " to   wkonum-adi(i)  web-konum-adi(gcol) 
                  perform varying ig from 1 by 1 until ig > 50
                    move 2 to  wkonum-oda-fiyati(i,ig)                  
                                wkonum-oda-fiyati-gunluk-ham(i,ig) 
                               


                    move 0 to  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,1)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,5) 
                end-perform 

          end-if
          if KONUM-MAX-PAX  <  xrez-buyuk
              move 0 to web-musait-oda-sayisi(gcol)    wkonum-musait-oda-sayisi(i)
              move " Oda Max. Adult Kapasite Asildi. " to   wkonum-adi(i)  web-konum-adi(gcol) 
                  perform varying ig from 1 by 1 until ig > 50
                    move 3 to  wkonum-oda-fiyati(i,ig)                  
                                wkonum-oda-fiyati-gunluk-ham(i,ig)         
                              


                    move 0 to  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,1)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,5)                               
                end-perform 

          end-if
          if konumek-kisi-bebek  <  xrez-buyuk + xrez-kucuk +
                 xrez-free  +   xrez-bebek  and   konumek-kisi-bebek > 1
              move 0 to web-musait-oda-sayisi(gcol)    wkonum-musait-oda-sayisi(i)
              move " Oda BebekMax. Kapasitesi Asildi. " to   wkonum-adi(i)  web-konum-adi(gcol) 
                  perform varying ig from 1 by 1 until ig > 50
                    move 2 to  wkonum-oda-fiyati(i,ig)                  
                                wkonum-oda-fiyati-gunluk-ham(i,ig) 
                               


                    move 0 to  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,1)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)  
                               wkonum-oda-fiyati-gunluk-ind-tut(i,ig,5) 
                end-perform 

          end-if
      end-read
                 move  wkonum-oda-fiyati-ind-tut(i,1)  to    web-oda-fiyati-ind-tut(gcol,1)    
                 move  wkonum-oda-fiyati-ind-adi(i,1)  to    web-oda-fiyati-ind-adi(gcol,1) 
                 move  wkonum-oda-fiyati-ind-tut(i,2)  to    web-oda-fiyati-ind-tut(gcol,2)    
                 move  wkonum-oda-fiyati-ind-adi(i,2)  to    web-oda-fiyati-ind-adi(gcol,2) 
                 move  wkonum-oda-fiyati-ind-tut(i,3)  to    web-oda-fiyati-ind-tut(gcol,3)    
                 move  wkonum-oda-fiyati-ind-adi(i,3)  to    web-oda-fiyati-ind-adi(gcol,3) 
                 move  wkonum-oda-fiyati-ind-tut(i,4)  to    web-oda-fiyati-ind-tut(gcol,4)    
                 move  wkonum-oda-fiyati-ind-adi(i,4)  to    web-oda-fiyati-ind-adi(gcol,4) 
                 move  wkonum-oda-fiyati-ind-tut(i,5)  to    web-oda-fiyati-ind-tut(gcol,5)    
                 move  wkonum-oda-fiyati-ind-adi(i,5)  to    web-oda-fiyati-ind-adi(gcol,5) 
                
       perform varying ig from 1 by 1 until ig > 50
            move  wkonum-oda-fiyati(i,ig)                    to   web-oda-fiyati-gunluk(gcol,ig) 
            move  wkonum-oda-fiyati-gunluk-ham(i,ig)         to   web-oda-fiyati-gunluk-ham(gcol,ig)
          
            move  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,1)  to  web-oda-fiyati-gunluk-ind-tut(gcol,ig,1)
        
            move  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)  to  web-oda-fiyati-gunluk-ind-tut(gcol,ig,2)
          


            move  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)  to  web-oda-fiyati-gunluk-ind-tut(gcol,ig,3)
           
            move  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)  to  web-oda-fiyati-gunluk-ind-tut(gcol,ig,4)
         
            move  wkonum-oda-fiyati-gunluk-ind-tut(i,ig,5)  to  web-oda-fiyati-gunluk-ind-tut(gcol,ig,5)
      end-perform 
       move    wkonum-oda-fiyati-toplam(i)         to   web-oda-fiyati-toplam(gcol)  
       move    wkonum-oda-fiyati-ham-toplam(i)     to   web-oda-fiyati-ham-toplam(gcol)
       if  web-musait-oda-sayisi(gcol) > 0
         if genel-web-stil = "D" and web-rate-adi(gcol,1)(1:7) not = "Minumum" then 
             move "salih" to web-rate-ek(gcol,1) web-rate-ek(gcol,2)  web-rate-ek(gcol,3)

             compute  web-rate-cekilecek(gcol,3) rounded =  web-oda-fiyati-gunluk(gcol,1) * web-rate-carpan(gcol,3)
             compute  web-rate-cekilecek(gcol,2) rounded =  web-oda-fiyati-toplam(gcol) * web-rate-carpan(gcol,2)
             
           
       end-if
       end-if
         
      
      end-perform 
      close konum konumek
      .
*
 kenar-yaz.    
            move xrez-gir-tar to takvim-anah
            initialize ig 
            start takvim key = takvim-anah
                invalid
                  move 1 to hata-oldu 
                  not invalid
                  perform until fs-takvim = "10"
                    read takvim next no lock
                      end move "10" to fs-takvim
                      not end
                      if takvim-anah >= xrez-cik-tar 

                      
                         move "10" to fs-takvim
                         exit perform cycle
                       end-if
                     
                      evaluate true
                          when takvim-anah < gercek-gir-tar
                               move 45 to ig
                      
                          when  takvim-anah >= gercek-cik-tar 
                                move   takvim-anah to starih
                                compute s1 =  (function INTEGER-OF-DATE(starih))
                                compute s2 =  (function INTEGER-OF-DATE(gercek-cik-tar))
                                compute ig = 46 + s1 - s2
                                if ig > 50 then move 50 to ig end-if

                          when other 
                               exit perform cycle
                      end-evaluate
                 
                    
         

                    initialize hesayr-rec
                    move  xrez-no    to hesayr-rez-no
                    move takvim-anah to hesayr-tarih
                      
                      read hesayr  no lock invalid
                          MOVE 0  TO wkonum-oda-fiyati(i,ig)  wkonum-oda-fiyati-gunluk-ham(i,ig)
                                   wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)  
                                      wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,2) 
                                         wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,3)  
                                            wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,4)  
                        not invalid
                         if wkonum-oda-fiyati2(i,ig)  = 1 
                             
                               MOVE 1  TO wkonum-oda-fiyati(i,ig)  wkonum-oda-fiyati-gunluk-ham(i,ig)
                                   wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)  
                                      wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,2) 
                                         wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,3)  
                                            wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,4)  


                         else
                            if  hesayr-basilacak-tut not > 0 then 
                          
                               MOVE 0  TO wkonum-oda-fiyati(i,ig)  wkonum-oda-fiyati-gunluk-ham(i,ig)
                                   wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)  
                                      wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,2) 
                                         wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,3)  
                                            wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,4)  
                             else
                    
                  
                                  move  hesayr-basilacak-tut    to  wkonum-oda-fiyati(i,ig)
                                  move  hesayr-ham-fiyat      to   wkonum-oda-fiyati-gunluk-ham(i,ig)
                                move hesayr-eb-tut   to  wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)   
                                 move "Erken Rezervasyon "  to  wkonum-oda-fiyati-gunluk-ind-adi(i ,ig,1)      wkonum-oda-fiyati-ind-adi(i ,1)   
                                 move  hesayr-ug-tut   to   wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)        
                                 move "Uzun Geceleme "     to   wkonum-oda-fiyati-gunluk-ind-adi(i,ig,2)     wkonum-oda-fiyati-ind-adi(i,2)      
                                 move hesayr-aks1-tut    to   wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)       
                                 move  "Son Gece Indirimi"    to   wkonum-oda-fiyati-gunluk-ind-adi(i,ig,3)     wkonum-oda-fiyati-ind-adi(i,3)   
                                move  hesayr-so1-tut    to   wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)          
                                move "Bonus "       to   wkonum-oda-fiyati-gunluk-ind-adi(i,ig,4)     wkonum-oda-fiyati-ind-adi(i,4)    
                              
                    
                       end-if
                       end-if
                    end-read
                            
                       end-read 
               end-perform 
             move ig to wkonum-gece(i)
         end-start 
                    .
*
 fiyat-kont.
    open input hesayr takvim
    move xrez-gir-tar to gercek-gir-tar
    move xrez-cik-tar to gercek-cik-tar 
    
       
    
       perform varying i from 1 by 1 until i > tmp-sayi
      if wkonum-no(i) > 0 then 
        continue
        else
        exit perform cycle
      end-if
       open input aceanlas yassinir
       move  wkonum-no(i) to link2-fiyat-konumu 
        perform link2
      close aceanlas yassinir
        if genel-ogretmenevi-online = 1
           
          move web-gelen-pax     to myassinir-pax
          move web-gelen-chi     to myassinir-chi
      end-if    
      move  myassinir-pax  to xrez-buyuk   web-gelen-pax     web-rate-bos(i,1)(1:1)  
 
      move myassinir-chi  to xrez-kucuk    web-gelen-chi     web-rate-bos(i,1)(2:1)  
      move myassinir-fre  to xrez-free     web-gelen-free     web-rate-bos(i,1)(3:1) 
      move myassinir-beb  to xrez-bebek    web-gelen-bebek    web-rate-bos(i,1)(4:1)  

************************************************************************
        if web-ip(1:6) not = "1.1.1." then 
      compute s1  =    function INTEGER-OF-DATE(gercek-gir-tar) - 1 
      compute s2 = function DATE-of-integer(s1)
       move s2 to xrez-gir-tar

       compute s1  =    function INTEGER-OF-DATE(gercek-cik-tar) - 1
      compute s2 = function DATE-of-integer(s1)
       move s2 to xrez-cik-tar
      


         move wkonum-no(i) to xrez-oda-konumu xrez-fiyat-konumu
         initialize linkh-odahes  wkonum-data(i)
         move xrez-no to  linkh-rez-no     
         move 9 to linkh-nereden  
         move 0 to linkh-anl-yaz
         move 0 to linkh-cast-yaz

          call "/asya/ytl/obj/otel/odahes.asy" 
                        using xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
          end-call
            
              perform kenar-yaz
     
                       
           compute s1  =    function INTEGER-OF-DATE(gercek-gir-tar) + 5 
      compute s2 = function DATE-of-integer(s1)
       move s2 to xrez-gir-tar
       if xrez-gir-tar >  gercek-cik-tar then 
         move gercek-cik-tar to xrez-gir-tar
       end-if
       compute s1  =    function INTEGER-OF-DATE(gercek-cik-tar) + 5
      compute s2 = function DATE-of-integer(s1)
       move s2 to xrez-cik-tar
      


         move wkonum-no(i) to xrez-oda-konumu xrez-fiyat-konumu
         initialize linkh-odahes 
         move xrez-no to  linkh-rez-no     
         move 9 to linkh-nereden  
         move 0 to linkh-anl-yaz
         move 0 to linkh-cast-yaz

          call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
          end-call
            
              perform kenar-yaz
                    
        end-if               
  
*************************************************
       move  gercek-gir-tar    to xrez-gir-tar 
        move  gercek-cik-tar    to xrez-cik-tar
      move wkonum-no(i) to xrez-oda-konumu xrez-fiyat-konumu
         initialize linkh-odahes  
         move xrez-no    to linkh-rez-no     
         move 9         to linkh-nereden  
         move 0         to linkh-anl-yaz
         move 0         to linkh-cast-yaz

          call "/asya/ytl/obj/otel/odahes.asy" 
                        using   xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
            
         
            move xrez-gir-tar to takvim-anah
            initialize ig 
            start takvim key = takvim-anah
                invalid
                  move 1 to hata-oldu 
                  not invalid
                  perform until fs-takvim = "10"
                    read takvim next no lock
                      end move "10" to fs-takvim
                      not end
                      if takvim-anah >= xrez-cik-tar 
                      
                         move "10" to fs-takvim
                         exit perform cycle
                       end-if
           
                      add 1 to ig
                    initialize hesayr-rec
                    move  xrez-no to hesayr-rez-no
                    move takvim-anah to hesayr-tarih
                      
                      read hesayr  no lock invalid
                      
                         move "Fiyat Yok " to   wkonum-adi(i)
                                  initialize wkonum-musait-oda-sayisi(i)
                                  MOVE 0  TO wkonum-oda-fiyati(i,ig)  wkonum-oda-fiyati-gunluk-ham(i,ig)
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)  
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,2) 
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,3)  
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,4) 
                                             hesayr-basilacak-tut 

                         

                        not invalid

                         if wkonum-oda-fiyati2(i,ig)  = 1 
                                       move "Bos Oda Yok" to   wkonum-adi(i)        
                                       MOVE 1  TO wkonum-oda-fiyati(i,ig)  wkonum-oda-fiyati-gunluk-ham(i,ig)
                                           wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)  
                                              wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,2) 
                                                 wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,3)  
                                                    wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,4)  
        

                         else
                              if  hesayr-basilacak-tut not > 0 then  
                                  move "Fiyat Yok " to   wkonum-adi(i)
                                  initialize wkonum-musait-oda-sayisi(i)
                                  MOVE 0  TO wkonum-oda-fiyati(i,ig)  wkonum-oda-fiyati-gunluk-ham(i,ig)
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)  
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,2) 
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,3)  
                                             wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,4) 
                                             hesayr-basilacak-tut 
                              else                                      
                                 move  hesayr-basilacak-tut    to  wkonum-oda-fiyati(i,ig)                                                                                                          
                                 move  hesayr-ham-fiyat      to   wkonum-oda-fiyati-gunluk-ham(i,ig)                                                                                 
                                 move hesayr-eb-tut   to  wkonum-oda-fiyati-gunluk-ind-tut(i ,ig,1)   
                                 add hesayr-eb-tut   to   wkonum-oda-fiyati-ind-tut(i ,1)    
                                 move "Erken Rezervasyon "  to  wkonum-oda-fiyati-gunluk-ind-adi(i ,ig,1)      wkonum-oda-fiyati-ind-adi(i ,1)   
                                
                                 move  hesayr-ug-tut   to   wkonum-oda-fiyati-gunluk-ind-tut(i,ig,2)        
                                 add  hesayr-ug-tut   to   wkonum-oda-fiyati-ind-tut(i,2)       
                                 move "Uzun Geceleme "     to   wkonum-oda-fiyati-gunluk-ind-adi(i,ig,2)     wkonum-oda-fiyati-ind-adi(i,2)      
                              
                                 move hesayr-aks1-tut    to   wkonum-oda-fiyati-gunluk-ind-tut(i,ig,3)       
                                 add hesayr-aks1-tut    to   wkonum-oda-fiyati-ind-tut(i,3)                                                                       
                                 move  "Son Gece Indirimi"    to   wkonum-oda-fiyati-gunluk-ind-adi(i,ig,3)     wkonum-oda-fiyati-ind-adi(i,3)   
                                                                                            
                                 move  hesayr-so1-tut    to   wkonum-oda-fiyati-gunluk-ind-tut(i,ig,4)          
                                 add  hesayr-so1-tut    to   wkonum-oda-fiyati-ind-tut(i,4)                                                                      
                                 move "Bonus "       to   wkonum-oda-fiyati-gunluk-ind-adi(i,ig,4)     wkonum-oda-fiyati-ind-adi(i,4)                  
                    
                              end-if
                       end-if

                   add   hesayr-basilacak-tut   to  wkonum-oda-fiyati-toplam(i)
                   add    hesayr-ham-fiyat      to    wkonum-oda-fiyati-ham-toplam(i)

                    end-read
          end-read 
          end-perform 
             move ig to wkonum-gece(i)
         end-start


       end-perform
       if genel-ogretmenevi-online = 1
         initialize web-gelen-chi
         compute web-gelen-pax = xrez-buyuk + xrez-kucuk 
       end-if
              close  hesayr takvim.
            
*
 kontenjan-kont.
          
      open input acenhrk takvim  
      open i-o webkont
      perform varying i from 1 by 1 until i > tmp-sayi
      if wkonum-no(i) > 0 then 
       move 999 to   wkonum-musait-oda-sayisi(i)
        else
        exit perform cycle
      end-if
*       initialize  wkonum-data2(i)
        move xrez-acenta to acenhrk-acenta
        move xrez-buyuk to  ACENHRK-S-D-T-G 
      
            initialize kont-gece
            move xrez-gir-tar to takvim-anah
            start takvim key = takvim-anah
                invalid
                    move 1 to hata-oldu 
                  not invalid
                  perform until fs-takvim = "10"
                    read takvim next no lock
                      end move "10" to fs-takvim
                      not end
                      if takvim-anah >= xrez-cik-tar 
                         move "10" to fs-takvim
                         exit perform cycle
                       end-if
                         add 1 to kont-gece   
******************************************  stop kontrol *************************
                         move 0 to stoplu
                         move  wkonum-no(i)to xrez-fiyat-konumu
                        perform stop-kontrol
                         if stoplu = 1 
                           
                              initialize wkonum-musait-oda-sayisi(i)
                                move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                exit perform cycle
                          end-if

*************************************************************
                       


                       move xrez-buyuk to  ACENHRK-S-D-T-G 
                        move wkonum-no(i) to ACENHRK-ODA-KONUMU  
                       move takvim-anah to acenhrk-tarih
                         if ACENHRK-S-D-T-G  > 4 move 4 to  ACENHRK-S-D-T-G end-if
                        read acenhrk no lock invalid 
                                initialize wkonum-musait-oda-sayisi(i)
                                move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                exit perform cycle
                              not invalid
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                       initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)  wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                      else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if

                       end-read
                       move 5 to ACENHRK-S-D-T-G

*************************************  yeni kontenjan girisi
                   

                       read acenhrk no lock invalid 
                                   initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                              not invalid
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                        initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if
                       end-read
               
                      if acenta-yfiyat = 1 then
                       initialize webkont-rec
                       move wkonum-no(i) to WEBKONT-KONUM
                       move takvim-anah to WEBKONT-TARIH
                       MOVE xrez-acenta  to  WEBKONT-ACENTA 
                       READ WEBKONT NO LOCK INVALID 
                            CONTINUE
                       END-READ
                   
                     if acenhrk-sat-oda >= WEBKONT-KONTENJAN 
                                        initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  WEBKONT-KONTENJAN - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                       end-if
                       end-if
                     


                       move 41 to ACENHRK-ODA-KONUMU
            
                       read acenhrk no lock invalid 
                              initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)  wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                              not invalid
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                        initialize wkonum-musait-oda-sayisi(i) 
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)  wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if
                       end-read
                       move wkonum-no(i) to ACENHRK-ODA-KONUMU 
                        read acenhrk no lock invalid 
                              initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)   wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                              not invalid
                              
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                       initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)   wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if
                       end-read
                       end-read
                    end-perform 
                  end-start
      end-perform 
       close acenhrk takvim webkont.
    .
*
*
 kontenjan2-kont.

      move xrez-gir-tar to gercek-gir-tar
      move xrez-cik-tar to gercek-cik-tar 
    
          


   
         compute s1  =    function INTEGER-OF-DATE(gercek-gir-tar) - 1 
         compute s2 = function DATE-of-integer(s1)
       move function DATE-of-integer(function INTEGER-OF-DATE(gercek-gir-tar) - 1  ) to xrez-gir-tar

       move function DATE-of-integer(function INTEGER-OF-DATE(gercek-cik-tar) + 5  ) to xrez-cik-tar

     
************************************************************************

      compute s1  =    function INTEGER-OF-DATE(gercek-gir-tar) - 1 
      compute s2 = function DATE-of-integer(s1)
       move s2 to xrez-gir-tar
       compute s1  =    function INTEGER-OF-DATE(gercek-cik-tar) + 5
      compute s2 = function DATE-of-integer(s1)
       move s2 to xrez-cik-tar
      


    
                     
                  


                 


     




************** ********************************************************
          
      open input acenhrk takvim 
      open i-o webkont
      perform varying i from 1 by 1 until i > tmp-sayi
      if wkonum-no(i) > 0 then 
       move 999 to   wkonum-musait-oda-sayisi(i)
        else
        exit perform cycle
      end-if
       initialize  wkonum-data2(i)
        move xrez-acenta to acenhrk-acenta
        move xrez-buyuk to  ACENHRK-S-D-T-G 
      
            initialize kont-gece
            move xrez-gir-tar to takvim-anah
            start takvim key = takvim-anah
                invalid
                    move 1 to hata-oldu 
                  not invalid
                  perform until fs-takvim = "10"
                    read takvim next no lock
                      end move "10" to fs-takvim
                      not end
                      if takvim-anah >= xrez-cik-tar 
                         move "10" to fs-takvim
                         exit perform cycle
                       end-if  
                           evaluate true
                          when takvim-anah < gercek-gir-tar
                               move 45 to kont-gece
                      
                          when  takvim-anah >= gercek-cik-tar 
                                move   takvim-anah to starih
                                compute s1 =  (function INTEGER-OF-DATE(starih))
                                compute s2 =  (function INTEGER-OF-DATE(gercek-cik-tar))
                                compute kont-gece = 46 + s1 - s2
                                if kont-gece > 50 then move kont-gece to ig end-if

                          when other 
                               exit perform cycle
                         end-evaluate
                 
                          
******************************************  stop kontrol *************************
                         move 0 to stoplu
                         move  wkonum-no(i)to xrez-fiyat-konumu
                        perform stop-kontrol
                         if stoplu = 1 
                           
                              initialize wkonum-musait-oda-sayisi(i)
                                move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                exit perform cycle
                          end-if

*************************************************************
                       


                       move xrez-buyuk to  ACENHRK-S-D-T-G 
                        move wkonum-no(i) to ACENHRK-ODA-KONUMU  
                       move takvim-anah to acenhrk-tarih
                         if ACENHRK-S-D-T-G  > 4 move 4 to  ACENHRK-S-D-T-G end-if
                        read acenhrk no lock invalid 
                                initialize wkonum-musait-oda-sayisi(i)
                                move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                exit perform cycle
                              not invalid
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                       initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)  wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                      else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if

                       end-read
                       move 5 to ACENHRK-S-D-T-G
                       read acenhrk no lock invalid 
                                   initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                              not invalid
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                        initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if
                       end-read
                       if acenta-yfiyat = 1 then
                       initialize webkont-rec
                       move wkonum-no(i) to WEBKONT-KONUM
                       move takvim-anah to WEBKONT-TARIH
                       MOVE xrez-acenta  to  WEBKONT-ACENTA 
                       READ WEBKONT NO LOCK INVALID 
                            CONTINUE
                       END-READ
                   
                     if acenhrk-sat-oda >= WEBKONT-KONTENJAN 
                                        initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece) wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  WEBKONT-KONTENJAN - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                       end-if
                       end-if



                       move 41 to ACENHRK-ODA-KONUMU
            
                       read acenhrk no lock invalid 
                              initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)  wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                              not invalid
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                        initialize wkonum-musait-oda-sayisi(i) 
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)  wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if
                       end-read
                       move wkonum-no(i) to ACENHRK-ODA-KONUMU 
                        read acenhrk no lock invalid 
                              initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)   wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                              not invalid
                              
                              if acenhrk-sat-oda >= acenhrk-kontrat-oda 
                                       initialize wkonum-musait-oda-sayisi(i)
                                       move 1 to wkonum-oda-fiyati(i,kont-gece)   wkonum-oda-fiyati2(i,kont-gece)
                                       exit perform cycle
                                       else
                                      if wkonum-musait-oda-sayisi(i) >  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                         compute wkonum-musait-oda-sayisi(i) =  acenhrk-kontrat-oda - acenhrk-sat-oda  
                                      end-if
                              end-if
                       end-read
                       end-read
                    end-perform 
                  end-start
      end-perform 
       close acenhrk takvim webkont.
      
       move  gercek-gir-tar    to xrez-gir-tar 
        move  gercek-cik-tar    to xrez-cik-tar
    .


*
 stop-kontrol. 
      open input aksiyhrk grup.
 
          MOVE 0 TO STOPLU
       
             move "S"           to aksiyhrk-tipi
             move xrez-acenta   to aksiyhrk-acenta 
             move takvim-anah  to aksiyhrk-tarih 
             move xrez-fiyat-konumu to aksiyhrk-pan-tipi
             move 0             to aksiyhrk-gecele
             read aksiyhrk no lock invalid 
               continue
              not invalid
                  move 1 to stoplu
               
             end-read      

          initialize  aksiyhrk-pan-tipi
          read aksiyhrk no lock invalid 
              continue
              not invalid
                   move 1 to stoplu
          end-read      

         initialize aksiyhrk-acenta
         read aksiyhrk no lock invalid 
              continue
              not invalid
                   move 1 to stoplu
         end-read     
         move xrez-fiyat-konumu to aksiyhrk-pan-tipi
         read aksiyhrk no lock invalid 
              continue
              not invalid
                   move 1 to stoplu
         end-read 
    

*         initialize grup-rec
*         move "A" to grup-tipi
*         start grup key > grup-anah
*           invalid
*            continue
*           not invalid
*             perform until fs-grup = "10" 
*              read grup next no lock 
*                end move "10" to fs-grup
*                not end
*                 if grup-tipi not = "A" then
*                     move "10" to fs-grup
*                   else
*                     if grup-alt = xrez-acenta 
*                       
*                        move grup-kodu to aksiyhrk-acenta
*                        initialize  aksiyhrk-pan-tipi
*
*                         read aksiyhrk no lock invalid 
*                            continue
*                         not invalid
*                        
*                            move 1 to stoplu
*                         exit perform 
*                       end-read  
*                        move xrez-fiyat-konumu to aksiyhrk-pan-tipi
*                          read aksiyhrk no lock invalid 
*                            continue
*                         not invalid
*                        
*                           move 1 to stoplu
*                         exit perform 
*                       end-read  
*                     end-if
*                 end-if
*               end-read
*             end-perform 
*         end-start
         close  aksiyhrk grup
       .
*
 Form1-Aft-Routine.
      close wlog.
     .
 l-yaz.
      continue.
 eski-yaz.
      continue.
 yeni-yaz.
    continue.
 a-yaz.
     continue.

*
 ace-takvim.
        open input takvim3
        initialize     ace-sart-gece  ace-hs-var  ace-top-gece
        move xrez-gir-tar to takvim3-anah 
        start takvim3 key >= takvim3-anah invalid continue
           not invalid 
           perform until fs-takvim3  = "10" 
                 read takvim3 next no lock end move "10" to fs-takvim3
                     not end 
                       if takvim3-anah >=  xrez-cik-tar
                         move "10" to fs-takvim3
                         else
                            add 1 to ace-top-gece 
                            if takvim3-gun-adi = 5 or 6 then 
                               move 1 to ace-hs-var 
                            end-if
                            if takvim3-anah >= aceanlas-sart-bas and 
                               takvim3-anah <= aceanlas-sart-bit
                               add 1 to ace-sart-gece                               
                            end-if
                       end-if
                 end-read
           end-perform
           if aceanlas-sart-haric = 1 then 
               compute ace-top-gece =  ace-top-gece  -  ace-sart-gece
           end-if
           if aceanlas-anlasma-oncelik > 0
               move ace-top-gece to ace-sart-gece
           end-if 
           close takvim3.
*
 doviz-karsilik-bul.
       open input ulke uyrukweb doviz             
         move web-ulke to uyrukweb-web-kodu
         read uyrukweb no lock key  uyrukweb-web-kodu  invalid 
              move rezpara-web-ulke to xrez-ulke
         not invalid 
              move uyrukweb-ulke to xrez-ulke
         end-read

         initialize ulke-rec
         move xrez-ulke to ULKE-ANAH
         read ulke no lock invalid 
           move  rezpara-web-ulke to ULKE-ANAH
           read ulke no lock invalid 
               move  rezpara-web-ulke to ULKE-ANAH
                 display message box " Defult ulke yok"                 
           end-read           
         end-read               
         move ulke-web-acenta      to xrez-acenta web-acenta
         perform acen-dft-oku         
       close ulke uyrukweb doviz
       if xrez-doviz > 0
          open input kodlar02
          initialize kodlar02-rec
          move "Z"         to kodlar02-tipi
          start kodlar02 key not < kodlar02-anah invalid 
              continue 
          not invalid 
          perform until fs-kodlar02 = "10"
          read kodlar02 next no lock end move "10"   to fs-kodlar02
          not at end
               if kodlar02-tipi <> "Z"
                   exit perform
               end-if                
               if kodlar02-web-dov-kod > 0 and kodlar02-web-dov-kod not = spaces
                 if kodlar02-web-dov-kod = xrez-doviz
                   if kodlar02-kodu not = "91"
                      move kodlar02-sayisal   to def-carpan
                      compute def-carpan rounded = def-carpan / 100                  
                   end-if 
                 end-if 
               end-if 
          end-read 
          end-perform
          end-start
          close kodlar02
       end-if 
       
       .
*
 ozel-durum-bul.
      open input kodlar02     
      initialize kodlar02-rec
      move 91 to  kodlar02-kodu
      move "Z" to kodlar02-tipi
      read kodlar02 no lock invalid
         continue
      not invalid 
          move kodlar02-sayisal   to def-carpan
      compute  def-carpan rounded = def-carpan / 100
      end-read

      ||29.02.2020 STONE ICIN EKLENDI SALIH
     

      initialize kodlar02-rec
      move "Z"         to kodlar02-tipi
      start kodlar02 key not < kodlar02-anah invalid 
          continue 
      not invalid 
      perform until fs-kodlar02 = "10"
      read kodlar02 next no lock end move "10"   to fs-kodlar02
      not at end
           if kodlar02-tipi <> "Z"
               exit perform
           end-if                
           if kodlar02-web not = spaces and  kodlar02-web = 1 
             if kodlar02-ozel-durum-onli-bas-yil > 0 and kodlar02-ozel-durum-onli-bit-yil > 0
                     move 20                               to onli-ozl-bas-yil(1:2) onli-ozl-bit-yil(1:2) 
                     move kodlar02-ozel-durum-onli-bas-yil to onli-ozl-bas-yil(3:2)
                     move kodlar02-ozel-durum-onli-bas-ay  to onli-ozl-bas-ay
                     move kodlar02-ozel-durum-onli-bas-gun to onli-ozl-bas-gun

                     move kodlar02-ozel-durum-onli-bit-yil to onli-ozl-bit-yil(3:2)
                     move kodlar02-ozel-durum-onli-bit-ay  to onli-ozl-bit-ay
                     move kodlar02-ozel-durum-onli-bit-gun to onli-ozl-bit-gun

                     if gelen-al-tar not = zeroes and gelen-al-tar >= onli-ozl-bas-tar and gelen-al-tar <= onli-ozl-bit-tar
                         if kodlar02-kodu not = "91"
                             move kodlar02-sayisal   to def-carpan
                             compute def-carpan rounded = def-carpan / 100 
                         end-if 
                     end-if
             end-if
           end-if 
      end-read 
      end-perform
      end-start
      ||29.02.2020 STONE ICIN EKLENDI SALIH
      close kodlar02.

 
