* rezcin.evt
* rezcin.evt is generated from D:\asya\acugt.ytl\otel\rezcin.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-tab-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form1-Ta-1-Value
        MOVE 0 TO tab-s-1-visible, tab-s-2-visible, tab-s-3-visible,
            tab-s-4-visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO tab-s-1-visible
        WHEN 2
           MOVE 1 TO tab-s-2-visible
        WHEN 3
           MOVE 1 TO tab-s-3-visible
        WHEN 4
           MOVE 1 TO tab-s-4-visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form1
*       After-Tabchg-Display
     END-EVALUATE
     .

 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 acc-mis-no-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-mis-no-Ev-Cmd-Goto
     END-EVALUATE
     .

 accept-odano-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Changed
           PERFORM accept-odano-Ex-Ntf-Changed
        END-EVALUATE
     ELSE
        PERFORM Exception-Procedure
     END-IF
     .

 accept-odano-uzun-Exception-Proc.
     PERFORM Exception-Procedure
     .

 liste-post-cb-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM liste-post-cb-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 liste-cik-cb-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM liste-cik-cb-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 accept-gir-gun-Exception-Proc.
     PERFORM accept-gir-gun-Ex-Other
     .

 fiyat-konumu-combo-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM fiyat-after
        END-EVALUATE
     END-IF
     .

 fix-fiyat-cb-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM fix-fiyat-cb-Ev-Cmd-Clicked
     END-EVALUATE
     .

 fix-fiyat-cb-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM fix-fiyat-cb-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 xx.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM eraly-booking-cb-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 aks-cb-Event-Proc.
     PERFORM aks-Cmd-Clicked
     .

 aks-cb-Exception-Proc.
     PERFORM aks-cb-Ex-cmd-clicked
     .

 tab-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM tab-1-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 bilbord-cb-Exception-Proc.
     PERFORM bilbord-cb-Ex-Cmd-Clicked
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        EVALUATE Event-Control-Id
        WHEN 302
           PERFORM gf-Ev-Msg-Begin-Entry
        WHEN 208
           PERFORM Form1-Gd-1a-Ev-Msg-Begin-Entry
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Pb-5-Exception-Proc.
     PERFORM grup-islemleri
     .

 accept-tel-no-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM accept-tel-no-Ev-Cmd-Goto
     END-EVALUATE
     .

 accept-mail-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM accept-mail-Ev-Cmd-Goto
     END-EVALUATE
     .

 Form1-Gd-2-Event-Proc.
     PERFORM gd2-Ev-Other
     .

 acc-pno2-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno2-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno3-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno3-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno4-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno4-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno5-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno5-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno6-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno6-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno7-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno7-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno8-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno8-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno9-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno9-Ev-Cmd-Goto
     END-EVALUATE
     .

 gec-girisaaa-Exception-Proc.
     PERFORM spe-cb-ex-cmd-clicked
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 screen2-Event-Proc.
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form5-Event-Proc.
     .

 Form5-Exception-Proc.
     PERFORM Form5-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     move 1 to share-en
      perform icyetki-kontrol
     call "c$narg" using link-var.
     perform adresleri-tasi.
*    move tus-yetkileri   to tus-kodlari.
     open i-o ulkeek close ulkeek
     open input genel 
     open i-o genel2
     move 1 to genel-anahtar
     read genel no lock invalid 
          continue
     end-read
     move 1 to genel2-anah
     read genel2 no lock invalid 
         continue
     end-read
     close genel genel2.
      open i-o odalar2 
      if genel-uzun-oda-no-kullanilsin = 1 
         move 1 to vis-uzun      move 0 to vis-kisa 
      else
         move 1 to vis-kisa    move 0 to vis-uzun
      end-if

     move muha-sirketi to hesap-dosya-adres.
     open input kllnc
     move k-kodu-tasi to k-kodu
     read kllnc no lock invalid stop " "
     end-read
      move  k-muh-sup to k1-muh-sup
     move  k-fiy-sup  to k1-fiy-sup
     close kllnc

     if genel-fiks-yok = 1 then
        if k-fix-fiyat-etkin = 0 or space        | firat 30/07/2020 delphine
           move 0 to vis-fiy-acik
        else 
           move 1 to vis-fiy-acik
        end-if
     else
        move 1 to vis-fiy-acik
     end-if
     perform  acuserve-adres-aktar.
     initialize xkonuk-rec konuk-rec rez-rec islkilit-acik-kapali
     open  i-o rez konuk ozluk ozluk2.
     initialize gec-gecme.
     if k-kodu-tasi = "ASYA" or "X   " then
       move 1 to asyami
     end-if

  
     .
*                     

 cin-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xkonuk-banka.
     move rezpara-doviz       to xkonuk-doviz.
     move rezpara-pan-tipi    to xkonuk-pan-tipi.
     move rezpara-odeme-tipi  to xkonuk-odeme-tipi.
     move rezpara-ulke        to xkonuk-ulke.
     move rezpara-anlasma     to xkonuk-anlasma.
     move calis-yil           to xkonuk-gel-yil xkonuk-git-yil  
        move calis-yil(3:2) to xkonuk-al-yil
     move calis-ay            to xkonuk-gel-ay  xkonuk-git-ay   xkonuk-al-ay.
     move calis-gun           to xkonuk-gel-gun xkonuk-git-gun  xkonuk-al-gun.
     move 1 to xkonuk-buyuk xkonuk-fiyat-konumu
     display accept-buyuk accept-banka accept-doviz accept-pansiyon
              accept-odeme  accept-anlasma accept-pazar accept-ulke accept-sehir.
   

 default-ata.
*************Default Degerler Ataniyor.........
     if xkonuk-vip = spaces then 
     modify konuk-vip-combo, 
            value = "N"
            mass-update = 0
            move "N" to xkonuk-vip konuk-vip-combo-value
      end-if   
            if rezpara-aygun = "A" move 2 to rb-degisken-1
            else                   move 1 to rb-degisken-1
            end-if.
     modify kur-tipi-rb-1, group-value = rb-degisken-1.
     perform konum-ata thru konum-ata-exit
    
     move ilk-konum to  fiyat-konumu-combo-value
     display fiyat-konumu-combo
     .

 konum-ata.
*************Konumlar Yukleniyor.......
     
     modify fiyat-konumu-combo, 
                            reset-list  = 1
                            mass-update = 1.
     open input konum.
     initialize konum-rec tmp-sayi ilk-konum.
     start konum key not < konum-anahtar invalid 
           continue
     not invalid 
     initialize fs-konum
     perform until fs-konum = "10"
             read konum next no lock end move "10" to fs-konum
             not at end
                  add 1 to tmp-sayi
                  
                  initialize  fiyat-konumu-combo-value
                  move konum-anahtar     to fiyat-konumu-combo-value
                  move "->"              to fiyat-konumu-combo-value(3:)
                  move konum-adi         to fiyat-konumu-combo-value(5:) 
                  modify fiyat-konumu-combo,
                         item-to-add(fiyat-konumu-combo-value)
                  if tmp-sayi = 1
                      move fiyat-konumu-combo-value     to ilk-konum
                     add 1 to tmp-sayi
                  end-if 
             end-read
     end-perform
     end-start
     close konum.
     move ilk-konum  to fiyat-konumu-combo-value 
     modify fiyat-konumu-combo, 
            mass-update = 0.
 konum-ata-exit.
      exit.
*
 Form1-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*        

     initialize musteriden-geldi basa-gitme
     evaluate link-var 
        when 3
               move "2->Walk-In        " to cin-tipi-combo-value
               display cin-tipi-combo
               perform cin-tipi-combo-Aft-Procedure
               move 1003 to control-id
               move 3 to control-value
               perform   bef-procedure
               move link-fol-no to xkonuk-folio
               perform   aft-procedure
               if genel-uzun-oda-no-kullanilsin = 1 
             move 226 to control-id 
           else
          move 1004 to control-id 
          end-if
               
               move 4 to control-value
               perform   bef-procedure
               move link-oda-no to xkonuk-odano
               display accept-odano
               perform xkonuk-oda-uzat
               if genel-uzun-oda-no-kullanilsin = 1 
             move 226 to control-id 
           else
          move 1004 to control-id 
          end-if
               
               move 4 to accept-control                   
        when 2 
            perform cin-tipi-combo-Bef-Procedure  
            if link-fol-no = 99999998 or 99999997 then
                move 0 to oto-yazma
               move 1 to cin-tipi-combo-value
               perform cin-tipi-combo-Aft-Procedure
               move 1002 to control-id
               move 2 to control-value
               perform   bef-procedure
                if  gecmez
                  move 1 to oto-yazma
               end-if
               move link-rezno to xkonuk-rez-no
               perform   aft-procedure
                if  gecmez
                  move 1 to oto-yazma
               end-if
               if genel-uzun-oda-no-kullanilsin = 1 
                     move 226 to control-id 
                   else
                  move 1004 to control-id 
                  end-if
              
               move 4 to accept-control 
              
                if  link-fol-no =  99999997
                 move 1 to oto-gec
                  perform   aft-procedure
                   if  gecmez
                     move 1 to oto-yazma
                 end-if
                 move 1005 to control-id
                 
                 if oto-yazma not = 1 
                    move 2 to key-status
                    perform  exception-procedure
                end-if
               
                  call "w$keybuf" using 1,x"1B" end-call
               end-if
            else               
               move "2->Walk-In        " to cin-tipi-combo-value
               display cin-tipi-combo
               perform cin-tipi-combo-Aft-Procedure
               move 1003 to control-id
               move 3 to control-value
               perform   bef-procedure
               move link-fol-no to xkonuk-folio
                
               perform   aft-procedure
               move 1020 to control-id
               move 4 to accept-control
         end-if
      when other
          perform ekran-sifirla
   end-evaluate

      move xkonuk-rez-no     to xrez-no 
      move xkonuk-buyuk      to buyuk-sayisi
      move xkonuk-kucuk      to kucuk-sayisi
      perform dosya-kilit-kontrol

 
     if xkonuk-fol-kodu = "E"
         modify Form1-Pb-2,visible = false
     end-if 
*     if k-kodu-tasi not = "ASYA"                 |||| 31/08/2019 adam eve iþlem için kapatýldý. açýldý
*         modify Form1-Pb-2,visible = false
*     end-if  
     .   
*
 button-ac.     
        modify accept-gir-gun enabled = true
        modify accept-gir-ay  enabled = true
        modify accept-gir-yil enabled = true
        modify accept-gir-saat enabled = true
        modify accept-gir-dakika enabled = true
        modify accept-cik-gun enabled = true
        modify accept-cik-ay  enabled = true
        modify accept-cik-yil enabled = true
        modify accept-rezno   enabled = true
        modify accept-folio   enabled = true
        if genel-uzun-oda-no-kullanilsin = 1
          move 1 to vis-uzun
          modify accept-odano-uzun   enabled = true
         else
          move 1 to vis-kisa
           modify accept-odano   enabled = true
        end-if
        modify fix-fiyat-cb   enabled = true
        modify accept-buyuk   enabled = true
        modify accept-kucuk   enabled = true
        modify accept-free    enabled = true
        modify accept-bebek   enabled = true
     

        modify accept-oda-tutar-tl      enabled = true
        modify accept-kahvalti-tutar-tl enabled = true
        modify accept-ogle-tutar-tl     enabled = true
        modify accept-aksam-tutar-tl    enabled = true
        modify accept-icecek-tutar-tl   enabled = true
        modify accept-extra-tutar-tl    enabled = true
        modify accept-toplam-tutar-tl   enabled = true
        modify accept-gunluk-kur        enabled = true
       .
 button-ac-exit.
      exit.

*
 ekran-sifirla.
     initialize rez-rec xrez-rec 
                konuk-rec xkonuk-rec
                ozluk-rec xozluk-rec
                ozluk2-rec.
     initialize kayit-izni.
     initialize bos-tutar.
     initialize odeme-var.
     initialize tutar-degiskenler.
     initialize staf-adi staf-soyadi.
     initialize mis-no ps1 pno2 ps2 pno3 ps3 pno4 ps4 || XIIILucky 09/07/2019
                pno5   ps5 pno6 ps6 pno7 ps7 pno8 ps8 pno9 ps9
*************Buttonlar Disable ediliyor.......
     modify button-odaara       enabled = false.
     modify button-acenara      enabled = false.
     modify button-anlasmaara   enabled = false.
     modify button-bankaara     enabled = false.
     modify button-dovizara     enabled = false.
     modify button-pansiyonara  enabled = false.
     modify button-odemeara     enabled = false.
     modify button-anlasmaara   enabled = false.
     modify button-pazarara     enabled = false.
     modify button-ulkeara      enabled = false.
    
     modify liste-cik-cb value = 0.
*************Acceptler Disable ediliyor.......

*************Formu Goster............
     display form1.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*    

*
 cin-tipi-combo-Bef-Procedure.  
     if basa-gitme = 1
         move 4 to accept-control
         move 1021 to control-id 
       exit paragraph 
     end-if 
     perform button-ac thru button-ac-exit.
     modify cin-tipi-combo, 
            value = "1"
            mass-update = 0.
            move "1" to cin-tipi-combo-value .
     evaluate true
         when turkce
              move "Islem Tipini Seciniz 1->Rezervasyonlu 2->Walk-In 3->Extra Check-In..." to mesaj
         when almanca
              move " " to mesaj
         when ingilizce
              move " " to mesaj
     end-evaluate.
     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj.
*
 cin-tipi-combo-Aft-Procedure.
     if basa-gitme = 1
         move 4    to accept-control
         move 1021 to control-id 
          
     end-if 
     inquire cin-tipi-combo, value in cin-tipi
     move cin-tipi to cin-tipi-combo-value
     modify cin-tipi-combo, 
            mass-update = 0.

     if cinpara-kur-duzelt not = "E"
        modify accept-gunluk-kur   enabled = false
     end-if.

     evaluate  cin-tipi 
      when 1
        modify accept-gir-gun enabled = false
        modify accept-gir-ay  enabled = false
        modify accept-gir-yil enabled = false
        modify accept-gir-saat enabled = false
        modify accept-gir-dakika enabled = false
        modify accept-cik-gun enabled = false
        modify accept-cik-ay  enabled = false
        modify accept-cik-yil enabled = false
        modify accept-folio   enabled = false
 

*        modify fix-fiyat-cb   enabled = false
        move 4     to accept-control
        move 1002  to control-id
      when 2
        modify accept-gir-saat enabled = false
        modify accept-gir-dakika enabled = false
        modify accept-rezno   enabled = false
        move 4     to accept-control
        move 1003  to control-id
      when 3
        modify accept-gir-saat enabled = false
        modify accept-gir-dakika enabled = false
        modify accept-rezno   enabled = false
        modify accept-buyuk   enabled = false
        modify accept-kucuk   enabled = false
        modify accept-free    enabled = false
        modify accept-bebek   enabled = false
        move 4     to accept-control
        move 1003  to control-id

      when other
        modify accept-gir-saat enabled = false
        modify accept-gir-dakika enabled = false
        modify accept-rezno   enabled = false
        move 4     to accept-control
        move 1003  to control-id
     end-evaluate.
     initialize gec-gecme.
*
 rez-oku.
     move xkonuk-rez-no to rez-no
     read rez no lock invalid 
          initialize rez-rec xrez-rec 
              move 1 to gec-gecme
              exit paragraph
              perform ekran-sifirla
              move cin-tipi     to cin-tipi-combo-value
          not invalid 
              if rez-gir-tar not = tarih-tasi  
                 initialize mesaj-degiskenler
                 move " [ Bugun Gelmesi Beklenmiyor ] " to mmesaj-title
                 move "Giris gunu uymuyor    " to mmesaj-1
                 move "Rezervasyon giris tarihini degistiriniz...." to mmesaj-2
                 move 1           to mmesaj-type
                 move 3           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 move 1 to gec-gecme
                 exit paragraph     
              end-if
              if rez-durumu not = "I"
                 initialize mesaj-degiskenler
                 move " [ Silinmis Rezervasyon ] " to mmesaj-title
                 move "Silinmis Rezervasyon Check-In Yapilamaz    " to mmesaj-1
                 move "Rezervasyon Nosunu degistiriniz...." to mmesaj-2
                 move 1           to mmesaj-type
                 move 3           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 move 1 to gec-gecme
                 exit paragraph     
              end-if
               if REZ-K-G-B not = "K"
                 initialize mesaj-degiskenler
                 move " [ Not Konfirme Rezervasyon ] " to mmesaj-title
                 move "Konfirme olmayan Rezervasyon Check-In Yapilamaz    " to mmesaj-1
                 move "Rezervasyonu Konfirme ediniz......" to mmesaj-2
                 move 1           to mmesaj-type
                 move 3           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 move 1 to gec-gecme
                 exit paragraph     
              end-if
              if rez-c-in = "E"
                 initialize mesaj-degiskenler
                 move " [ Check-In Yapilmis ] " to mmesaj-title
                 move "Secmis Oldugunuz Rezervasyon Check-In Yapilmis" to mmesaj-1
                 move "Rezervasyon Nosunu degistiriniz...." to mmesaj-2
                 move 1           to mmesaj-type
                 move 3           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 move 1 to gec-gecme
                 exit paragraph
              end-if
              move rez-rec to xrez-rec
              move rez-oda-konumu to eski-oda-konum
     end-read.
                move  REZ-OZEL-DURUM-CAR   to  yREZ-OZEL-DURUM-CAR 
                move  REZ-OZEL-DURUM       to  yREZ-OZEL-DURUM     
                move  REZ-ozel-tip         to  yREZ-ozel-tip  
                move rez-git-sirket to  yrez-git-sirket
                move rez-gel-sirket to  yrez-gel-sirket
     perform rez-to-konuk thru rez-to-konuk-exit
     move xkonuk-odano  to ydk-odano
     perform fiyat-hesapla thru fiyat-hesapla-exit. 
     perform kur-bul thru kur-bul-exit
       if gecmez exit paragraph
       end-if.
     if xrez-on-odeme not = 0
       continue   



     end-if 
     perform default-ata
     perform okunan-goster
             initialize gec-gecme.
*
 fiyat-hesapla. 
       move 0 to kur-bulundu
        if cinpara-kur-duzelt  = "E" and xkonuk-kur-degeri not = 0 
           move xkonuk-kur-degeri  to doviz-alis
             move 1 to kur-bulundu
        end-if
         if kur-bulundu = 0 then  
              if rez-grup-no > 0 then
                open input gruplar kur  
                move xkonuk-grup-no to gruplar-kodu
                read gruplar no lock invalid continue
                not invalid 
                if gruplar-kur > 0 and 
                   gruplar-doviz = xkonuk-doviz then 
                     move gruplar-kur to doviz-alis
                     move 1 to kur-bulundu

                else
                    if gruplar-sabit-tarih-kur = 1
                       if gruplar-sabit-kur-tarih <= xkonuk-gel-tar and 
                          gruplar-doviz = xkonuk-doviz
                          initialize kur-rec 
                          move gruplar-sabit-kur-tarih to kur-tarih
                          move gruplar-banka           to kur-banka
                          move gruplar-doviz           to kur-doviz
                          read kur no lock invalid 
                               continue 
                          not invalid 
                               move 1 to kur-bulundu
                          end-read 
                       end-if 
                    else 
                          initialize kur-rec 
                          move xkonuk-gel-tar to kur-tarih
                          move xkonuk-banka           to kur-banka
                          move xkonuk-doviz           to kur-doviz
                          read kur no lock invalid 
                               continue 
                          not invalid 
                               move 1 to kur-bulundu
                          end-read 
                    end-if 
                end-if
                end-read
                close gruplar kur 
              end-if
      end-if

       if kur-bulundu = 0 then  
        if rez-cin-kuru > 0 and rez-cin-kuru < 100 and xkonuk-kur-degeri = 0 then
          move rez-cin-kuru to doviz-alis
            move 1 to kur-bulundu
         end-if
       end-if


       if kur-bulundu = 0 then 
         open input kur
         move xkonuk-gel-yil      to kur-yil
         move xkonuk-gel-ay       to kur-ay
         move xkonuk-gel-gun      to kur-gun
         if xkonuk-gec-giris = 1 then
           open input takvim
           move xkonuk-gel-tar to takvim-anah
           start takvim key = takvim-anah
             invalid   continue
             not invalid
                read takvim previous no lock  end continue end-read
                read takvim previous no lock  end continue end-read
                move takvim-anah to kur-tarih
            end-start
            close takvim
         end-if

         move xkonuk-banka        to kur-banka 
         move xkonuk-doviz        to kur-doviz 
         if xkonuk-kur-aygun = "A" then
            move 01 to kur-gun 
         end-if
         
         Read Kur no lock invalid 
             close kur 
             initialize mesaj-degiskenler
             move " [ Kurlar Hatali ] " to mmesaj-title
             move "Istenilen Tarihte Kur Kaydi Yok    " to mmesaj-1
             move "Banka:    Doviz:    Tar:  /  /     " to mmesaj-2
             move kur-banka        to mmesaj-2(07:02)
             move kur-doviz        to mmesaj-2(17:02) 
             move kur-gun          to mmesaj-2(25:02) 
             move kur-ay           to mmesaj-2(28:02) 
             move kur-yil          to mmesaj-2(31:04) 
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             move 1 to gec-gecme
           
             exit paragraph
           not invalid continue
         end-read

        if  doviz-alis = 0       
            close kur 
             initialize mesaj-degiskenler
             move " [ Kurlar Hatali ] " to mmesaj-title
             move "Istenilen Tarihte Kur Kaydi Yok    " to mmesaj-1
             move "Banka:    Doviz:    Tar:  /  /     " to mmesaj-2
             move kur-banka        to mmesaj-2(07:02)
             move kur-doviz        to mmesaj-2(17:02) 
             move kur-gun          to mmesaj-2(25:02) 
             move kur-ay           to mmesaj-2(28:02) 
             move kur-yil          to mmesaj-2(31:04) 
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             move 1 to gec-gecme
             exit paragraph
        end-if
      
        close kur 
*******>Konuk Kartindaki kuru almasi icin konuldu 
**      if cinpara-peryot-kuru = "R" and xkonuk-kur-degeri not = 0 
       
        end-if .
        
*******>Konuk Kartindaki kuru almasi icin konuldu 
********if xkonuk-kur-degeri = 0
        
            move doviz-alis          to xkonuk-kur-degeri
********end-if 
        
*******>Kuruslu Rakam Ciktiginda Dogru Dovizi Bulmasi Icin Konuldu
        initialize tl-toplam-kuruslu.
        compute tl-toplam-kuruslu rounded = rez-ucreti * doviz-alis. 
*        if tl-toplam-kuruslu(13:2) not = 00 
*           compute tl-toplam-kuruslu = tl-toplam-kuruslu + 1
*        end-if.
        move tl-toplam-kuruslu to tl-toplam. 

*        compute tl-toplam   = rez-ucreti * doviz-alis. 
            initialize tl-oda   tl-kahvalti tl-ogle tl-aksam tl-icecek 
                                tl-extra    tl-extra-bed 
                       dv-oda   dv-kahvalti dv-ogle dv-aksam dv-icecek 
                                dv-extra    dv-extra-bed. 
            if tl-toplam = 0 
               go fiyat-hesapla-exit
            end-if. 

        move rez-ucreti to xkonuk-dv-degeri
        if cinpara-breakdown = "H" 
           initialize xkonuk-kahvalti-tutar xkonuk-ogle-tutar
                      xkonuk-aksam-tutar    xkonuk-icecek-tutar
                      xkonuk-extra-tutar    xkonuk-extbed-tutar
           move tl-toplam to xkonuk-oda-tutar 
           move dv-toplam to dv-oda 
           if cinpara-dag-komisyondan = "E"
              perform komisyon-dagit
              perform xkonuk-ata
           end-if
           go fiyat-hesapla-exit 
        end-if.
           open input kodlar02. 
           move "A"                to kodlar02-tipi. 
           move xkonuk-pan-tipi    to kodlar02-kodu. 
       read kodlar02 no lock invalid 
            close kodlar02 
             initialize mesaj-degiskenler
             move " [ Pansiyon Kodu Hatali ] " to mmesaj-title
             MOVE "Istenilen Pansiyon Tipi Tanimsiz   " to mmesaj-1 
             MOVE "Pansiyon Kodu..:                   " to mmesaj-2
             move kodlar02-kodu    to mmesaj-2(20:02) 
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             move 1 to gec-gecme
             exit paragraph
           not invalid continue
       end-read.
       close kodlar02. 

       open input dagilim. 
       move xkonuk-doviz to dagilim-anahtar. 
       read dagilim  no lock invalid 
            close dagilim  
             initialize mesaj-degiskenler
             move " [ Breakdown Hatali ] " to mmesaj-title
             move "Istenilen Doviz Kodunda Breakd.YOK " to mmesaj-1
             move "Doviz... Kodu..:                   " to mmesaj-2 
             move dagilim-anahtar    to mmesaj-2(20:02) 
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             move 1 to gec-gecme
             exit paragraph
           not invalid continue
       end-read.
       close dagilim. 

    if pan-kahvalti = "X" 
       compute tl-kahvalti rounded = ((( xkonuk-buyuk * dagilim-kahvalti ) + 
                             ( xkonuk-kucuk * dagilim-kahvalti / 2 )) 
                             *  doviz-alis ) 
       compute dv-kahvalti rounded = (( xkonuk-buyuk * dagilim-kahvalti ) + 
                             ( xkonuk-kucuk * dagilim-kahvalti / 2 )). 
*/  -> Kahvalti Kontrol 
    initialize tl-kontrol dv-kontrol. 
    compute tl-kontrol = tl-kontrol + tl-kahvalti. 
    compute dv-kontrol = dv-kontrol + dv-kahvalti. 
    if (tl-kontrol > tl-toplam) or (dv-kontrol > dv-toplam) 
       compute tl-kontrol  = tl-kontrol - tl-kahvalti 
       compute dv-kontrol  = dv-kontrol - dv-kahvalti 
       compute tl-kahvalti = tl-toplam  - tl-kontrol 
       compute dv-kahvalti = dv-toplam  - dv-kontrol 
       go xkonuk-ata. 
    if pan-ogle = "X" 
       compute tl-ogle rounded    = ((( xkonuk-buyuk * dagilim-ogle     ) + 
                             ( xkonuk-kucuk * dagilim-ogle     / 2 )) 
                             *  doviz-alis ) 
       compute dv-ogle rounded    = (( xkonuk-buyuk * dagilim-ogle     ) + 
                             ( xkonuk-kucuk * dagilim-ogle     / 2 )). 
*/  -> Ogle Kontrol 
    compute tl-kontrol = tl-kontrol + tl-ogle. 
    compute dv-kontrol = dv-kontrol + dv-ogle. 
    if (tl-kontrol > tl-toplam) or (dv-kontrol > dv-toplam) 
       compute tl-kontrol  = tl-kontrol - tl-ogle 
       compute dv-kontrol  = dv-kontrol - dv-ogle 
       compute tl-ogle     = tl-toplam  - tl-kontrol 
       compute dv-ogle     = dv-toplam  - dv-kontrol 
       go xkonuk-ata. 
    if pan-aksam     = "X" 
       compute tl-aksam rounded   = ((( xkonuk-buyuk * dagilim-aksam    ) + 
                             ( xkonuk-kucuk * dagilim-aksam    / 2 )) 
                             *  doviz-alis ) 
       compute dv-aksam rounded   = (( xkonuk-buyuk * dagilim-aksam    ) + 
                             ( xkonuk-kucuk * dagilim-aksam    / 2 )). 
*/  -> Aksam Kontrol 
    compute tl-kontrol = tl-kontrol + tl-aksam. 
    compute dv-kontrol = dv-kontrol + dv-aksam. 
    if (tl-kontrol > tl-toplam) or (dv-kontrol > dv-toplam) 
       compute tl-kontrol  = tl-kontrol - tl-aksam 
       compute dv-kontrol  = dv-kontrol - dv-aksam 
       compute tl-aksam    = tl-toplam  - tl-kontrol 
       compute dv-aksam    = dv-toplam  - dv-kontrol 
       go xkonuk-ata. 
    if pan-icecek    = "X" 
       compute tl-icecek rounded  = ((( xkonuk-buyuk * dagilim-icecek   ) + 
                             ( xkonuk-kucuk * dagilim-icecek   / 2 )) 
                             *  doviz-alis ) 
       compute dv-icecek rounded  = (( xkonuk-buyuk * dagilim-icecek   ) + 
                             ( xkonuk-kucuk * dagilim-icecek   / 2 )). 
*/  -> Icecek Kontrol 
    compute tl-kontrol = tl-kontrol + tl-icecek. 
    compute dv-kontrol = dv-kontrol + dv-icecek. 
    if (tl-kontrol > tl-toplam) or (dv-kontrol > dv-toplam) 
       compute tl-kontrol  = tl-kontrol - tl-icecek 
       compute dv-kontrol  = dv-kontrol - dv-icecek 
       compute tl-icecek   = tl-toplam  - tl-kontrol 
       compute dv-icecek   = dv-toplam  - dv-kontrol 
       go xkonuk-ata. 
    if pan-extra     = "X" 
       compute tl-extra rounded   = ((( xkonuk-buyuk * dagilim-extra    ) + 
                             ( xkonuk-kucuk * dagilim-extra    / 2 )) 
                             *  doviz-alis ) 
       compute dv-extra rounded   = (( xkonuk-buyuk * dagilim-extra    ) + 
                             ( xkonuk-kucuk * dagilim-extra    / 2 )). 
*/  -> Extra Kontrol 
    compute tl-kontrol = tl-kontrol + tl-extra. 
    compute dv-kontrol = dv-kontrol + dv-extra. 
    if (tl-kontrol > tl-toplam) or (dv-kontrol > dv-toplam) 
       compute tl-kontrol  = tl-kontrol - tl-extra 
       compute dv-kontrol  = dv-kontrol - dv-extra 
       compute tl-extra    = tl-toplam  - tl-kontrol 
       compute dv-extra    = dv-toplam  - dv-kontrol 
       go xkonuk-ata. 
    if pan-oda = "X" 
       compute tl-oda = tl-toplam - tl-kahvalti - tl-ogle - tl-aksam - 
                        tl-icecek - tl-extra 
       compute dv-oda = dv-toplam - dv-kahvalti - dv-ogle - dv-aksam - 
                        dv-icecek - dv-extra. 
    if tl-oda < 0 
       initialize mesaj-degiskenler
       move " [ Breakdown Hatali ] " to mmesaj-title
       move "Breakdown Fiyatlari Rezervasyon    " to mmesaj-1
       move "fiyatindan Buyuk.........          " to mmesaj-2 
       move 1           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if cinpara-breakdown-cik = "E" 
          move 1 to gec-gecme
          exit paragraph
       end-if
    end-if.


 xkonuk-ata. 
    move tl-oda        to xkonuk-oda-tutar      tl-oda-z. 
    move tl-kahvalti   to xkonuk-kahvalti-tutar tl-kahvalti-z. 
    move tl-ogle       to xkonuk-ogle-tutar     tl-ogle-z. 
    move tl-aksam      to xkonuk-aksam-tutar    tl-aksam-z. 
    move tl-icecek     to xkonuk-icecek-tutar   tl-icecek-z. 
    move tl-extra      to xkonuk-extra-tutar    tl-extra-z. 
 fiyat-hesapla-exit. 
      exit. 
*
 yeni-fiyat-al-1. 
    initialize tl-toplam dv-toplam. 
    move rez-ucreti to rez-fiyati dv-toplam xkonuk-dv-degeri. 


    perform fiyat-hesapla thru fiyat-hesapla-exit. 
    move xkonuk-oda-tutar         to tl-goster tl-oda-z. 
    move xkonuk-kahvalti-tutar    to tl-goster tl-kahvalti-z. 
    move xkonuk-ogle-tutar        to tl-goster tl-ogle-z. 
    move xkonuk-aksam-tutar       to tl-goster tl-aksam-z. 
    move xkonuk-icecek-tutar      to tl-goster tl-icecek-z. 
    move xkonuk-extra-tutar       to tl-goster tl-extra-z. 
    initialize tl-toplam 
    compute tl-toplam = xkonuk-oda-tutar .
*la butik ramazan    + xkonuk-kahvalti-tutar + 
*                        xkonuk-extbed-tutar + xkonuk-ogle-tutar  + 
*                        xkonuk-aksam-tutar  + xkonuk-icecek-tutar  + 
*                        xkonuk-extra-tutar. 
    move tl-toplam               to tl-goster tl-toplam-z. 
    move xkonuk-dv-degeri        to dv-goster dv-toplam-z. 
    move xkonuk-kur-degeri       to dv-goster islem-kuru-z. 

    move dv-oda                  to dv-goster dv-oda-z. 
    move dv-kahvalti             to dv-goster dv-kahvalti-z. 
    move dv-ogle                 to dv-goster dv-ogle-z. 
    move dv-aksam                to dv-goster dv-aksam-z. 
    move dv-icecek               to dv-goster dv-icecek-z. 
    move dv-extra                to dv-goster dv-extra-z. 
    move dv-toplam               to dv-goster dv-toplam-z. 

****>Degisen Rakamlari Goster
    display  accept-oda-tutar-tl      .
    display  accept-kahvalti-tutar-tl .
    display  accept-ogle-tutar-tl     .
    display  accept-aksam-tutar-tl    .
    display  accept-icecek-tutar-tl   .
    display  accept-extra-tutar-tl    .
    display  accept-toplam-tutar-tl   .

    display  accept-toplam-tutar-dv   .
    display  accept-gunluk-kur        .

    display  accept-oda-tutar-dv      .
    display  accept-kahvalti-tutar-dv .
    display  accept-ogle-tutar-dv     .
    display  accept-aksam-tutar-dv    .
    display  accept-icecek-tutar-dv   .
    display  accept-extra-tutar-dv    .
    display  accept-toplam-tutar-dv   .
 yeni-fiyat-al-exit. 
    exit. 
*
 kur-bul. 
         initialize kur-bulundu
         if cinpara-kur-duzelt  = "E" and 
           xkonuk-kur-degeri not = 0 
           move xkonuk-kur-degeri  to doviz-alis
           move 1                  to kur-bulundu
        end-if .
*******>Konuk Kartindaki kuru almasi icin konuldu 



         if kur-bulundu = 0  
        if xkonuk-grup-no > 0 then 
            open input gruplar kur
                move xkonuk-grup-no to gruplar-kodu
                read gruplar no lock invalid 
                     continue
                not invalid 
                if gruplar-kur > 0 and gruplar-doviz = xkonuk-doviz then 
                     move gruplar-kur to doviz-alis
                     move 1 to kur-bulundu
                else
                    if gruplar-sabit-tarih-kur = 1
                       if gruplar-sabit-kur-tarih <= xkonuk-gel-tar and 
                          gruplar-doviz = xkonuk-doviz
                          initialize kur-rec 
                          move gruplar-sabit-kur-tarih to kur-tarih
                          move gruplar-banka           to kur-banka
                          move gruplar-doviz           to kur-doviz
                          read kur no lock invalid 
                               continue 
                          not invalid 
                               move 1 to kur-bulundu
                          end-read 
                       end-if 
                    else 
                          initialize kur-rec 
                          move xkonuk-gel-tar         to kur-tarih
                          move xkonuk-banka           to kur-banka
                          move xkonuk-doviz           to kur-doviz
                          if xkonuk-kur-aygun = "A" move 01 to kur-gun end-if
                          read kur no lock invalid 
                               continue 
                          not invalid 
                               move 1 to kur-bulundu
                          end-read                       
                    end-if 
                end-if
                end-read
              close gruplar kur
        end-if 
        end-if.
        
        if kur-bulundu = 0 
        if rez-cin-kuru > 0 and rez-cin-kuru < 100 and xkonuk-kur-degeri = 0 then
          move rez-cin-kuru to doviz-alis
        end-if
        end-if .
        if kur-bulundu = 0
          open input kur
        move xkonuk-gel-yil      to kur-yil takvim-yil
        move xkonuk-gel-ay       to kur-ay  takvim-ay
        move xkonuk-gel-gun      to kur-gun takvim-gun
        
        if xkonuk-gec-giris = 1 then
        open input takvim
          start takvim key = takvim-anah
            invalid 
             display message box "takvim start hatasi:188345"
           not invalid
            read takvim previous 
              end
                   display message box "takvim start hatasi:15555"
              not end
                read takvim previous  
                     end
                        display message box "takvim start hatasi:15555"
                     not end
                       move takvim-yil      to kur-yil 
                       move takvim-ay       to kur-ay 
                       move takvim-gun      to kur-gun 
                end-read
             end-read
         end-start
          
         if  xkonuk-kur-degeri  = 0 
           display message box "Konuk Gec Giris yaptigi icin"  new-line
                            kur-gun "/" kur-ay "/" kur-yil " tarihli kur alinmistir"
                            new-line "Bilginize ..............."
                            title "GEC GIRIS UYARISI"
         end-if
         close takvim
        end-if 

        move xkonuk-banka        to kur-banka 
        move xkonuk-doviz        to kur-doviz 
        if xkonuk-kur-aygun = "A" move 01 to kur-gun end-if 
        read kur no lock invalid 
             close kur 
             initialize mesaj-degiskenler
             move " [ Kurlar Tanimsiz ] " to mmesaj-title
             move "Girdiginiz Tarihe Kur Kaydi....."  to mmesaj-1
             move "....BULUNAMADI.................."  to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             move 1 to gec-gecme
             exit paragraph
                 not invalid continue
        end-read
 
*******>Konuk Kartindaki kuru almasi icin konuldu 
*       if cinpara-peryot-kuru = "R" and 
        close kur
        end-if  . 
        
        move doviz-alis    to xkonuk-kur-degeri. 
                  if doviz-alis = 0 
                   
                     initialize mesaj-degiskenler
                     move " [ Kurlar Tanimsiz ] " to mmesaj-title
                     move "Girdiginiz Tarihe Kur Kaydi....."  to mmesaj-1
                     move "....BULUNAMADI.................."  to mmesaj-2
                     move 1           to mmesaj-type
                     move 3           to mmesaj-icon
                     move 1           to mmesaj-default
                     perform mmesaj-ver
                     move 1 to gec-gecme
                     exit paragraph
                  end-if.
            

********compute tl-toplam   = rez-ucreti * doviz-alis. 
      initialize tl-toplam dv-toplam dv-oda dv-kahvalti dv-ogle dv-aksam 
                 dv-icecek dv-extra. 
    move xkonuk-oda-tutar         to tl-goster tl-oda-z. 
    move xkonuk-kahvalti-tutar    to tl-goster tl-kahvalti-z. 
    move xkonuk-ogle-tutar        to tl-goster tl-ogle-z. 
    move xkonuk-aksam-tutar       to tl-goster tl-aksam-z. 
    move xkonuk-icecek-tutar      to tl-goster tl-icecek-z. 
    move xkonuk-extra-tutar       to tl-goster tl-extra-z. 
    initialize tl-toplam 
    compute tl-toplam = xkonuk-oda-tutar .
*la butik ramazan    + xkonuk-kahvalti-tutar + 
*                        xkonuk-extbed-tutar + xkonuk-ogle-tutar  + 
*                        xkonuk-aksam-tutar  + xkonuk-icecek-tutar  + 
*                        xkonuk-extra-tutar. 
    move tl-toplam               to tl-goster tl-toplam-z. 

    compute dv-toplam  rounded = tl-toplam         / xkonuk-kur-degeri. 
*    compute dv-oda      rounded = xkonuk-oda-tutar           / xkonuk-kur-degeri. 
    compute dv-kahvalti rounded = xkonuk-kahvalti-tutar      / xkonuk-kur-degeri. 
    compute dv-ogle     rounded = xkonuk-ogle-tutar          / xkonuk-kur-degeri. 
    compute dv-aksam    rounded = xkonuk-aksam-tutar         / xkonuk-kur-degeri. 
    compute dv-icecek   rounded = xkonuk-icecek-tutar        / xkonuk-kur-degeri. 
    compute dv-extra    rounded = xkonuk-extra-tutar         / xkonuk-kur-degeri. 
    compute dv-oda rounded = dv-toplam .
*    - dv-kahvalti - dv-ogle - dv-aksam - 
*                           dv-icecek - dv-extra. 

    move xkonuk-dv-degeri        to dv-goster dv-toplam-z. 
    move xkonuk-kur-degeri       to dv-goster islem-kuru-z. 

    move dv-oda                  to dv-goster dv-oda-z. 
    move dv-kahvalti             to dv-goster dv-kahvalti-z. 
    move dv-ogle                 to dv-goster dv-ogle-z. 
    move dv-aksam                to dv-goster dv-aksam-z. 
    move dv-icecek               to dv-goster dv-icecek-z. 
    move dv-extra                to dv-goster dv-extra-z. 
    move dv-toplam               to dv-goster dv-toplam-z. 
            move dv-toplam    to xkonuk-dv-degeri. 

******>Degerleri Goster
    display  accept-oda-tutar-tl      .
    display  accept-kahvalti-tutar-tl .
    display  accept-ogle-tutar-tl     .
    display  accept-aksam-tutar-tl    .
    display  accept-icecek-tutar-tl   .
    display  accept-extra-tutar-tl    .
    display  accept-toplam-tutar-tl   .

    display  accept-toplam-tutar-dv   .
    display  accept-gunluk-kur        .

    display  accept-oda-tutar-dv      .
    display  accept-kahvalti-tutar-dv .
    display  accept-ogle-tutar-dv     .
    display  accept-aksam-tutar-dv    .
    display  accept-icecek-tutar-dv   .
    display  accept-extra-tutar-dv    .
    display  accept-toplam-tutar-dv   .

 kur-bul-exit. 
    exit. 
*
 rez-to-konuk.
         initialize srez-bilgi. 
    move rez-no              to xkonuk-rez-no. 
    move rez-adi             to xkonuk-adi.
    move rez-paylas-oda      to xkonuk-paylas-oda
    move rez-soyadi          to xkonuk-soyadi. 
    move rez-s-d-t-g         to xkonuk-s-d-t-g srez-s-d-t-g.
    move rez-rehber          to xkonuk-rehber
    move rez-oda-konumu      to xkonuk-oda-konumu srez-oda-konumu. 
    if rez-fiyat-konumu = 0 then 
       move rez-oda-konumu   to rez-fiyat-konumu
    end-if
    move rez-fiyat-konumu    to xkonuk-fiyat-konumu srez-fiyat-konumu. 
    move rez-odeme-tipi      to xkonuk-odeme-tipi. 
    move rez-odano           to xkonuk-odano srez-odano. 
    move rez-ulke            to xkonuk-ulke. 
    move rez-buyuk           to xkonuk-buyuk  srez-buyuk. 
*    move rez-profil-no       to xkonuk-profil-no

    move rez-firma           to xkonuk-firma
    move rez-kucuk           to xkonuk-kucuk  srez-kucuk. 
    move rez-free            to xkonuk-free   srez-free. 

    move rez-bebek           to xkonuk-bebek  srez-bebek.
    move rez-acenta          to xkonuk-acenta srez-acenta. 
    move rez-grup-no         to xkonuk-grup-no. 
    move rez-voucher         to xkonuk-voucher. 
    move rez-fiyat-konumu    to xkonuk-fiyat-konumu .
    move rez-nor-indirim     to xkonuk-nor-indirim. 
    move rez-pan-tipi        to xkonuk-pan-tipi. 
    move rez-tipi            to xkonuk-rez-tipi. 
    move rez-banka           to xkonuk-banka. 
    move rez-doviz           to xkonuk-doviz. 
    move rez-anlasma         to xkonuk-anlasma.
    move rez-gec             to xkonuk-gec-giris.
    move rez-room-kdv-yok    to xkonuk-room-kdv-yok
    move rez-extra-kdv-yok   to xkonuk-extra-kdv-yok
    move rez-telefon-no      to xkonuk-telefon-no
    move rez-kaynak-1        to xkonuk-kaynak-1
    move rez-kaynak-2        to xkonuk-kaynak-2
    move rez-kaynak-3        to xkonuk-kaynak-3
    move rez-sehir           to xkonuk-sehir
    if  rez-no-post = 1
       move "C"   to xkonuk-acik-kapali
       else
          move "O"   to xkonuk-acik-kapali
    end-if
*    move  2000               to rez-al-yil
    move rez-al-tar(3:)      to xkonuk-al-tar.
  
     if xkonuk-al-yil  < "01" then 
                move rez-al-yil(3:) to xkonuk-al-yil
                 if xkonuk-al-yil  < "01" then 
                       move rez-isl-yil(3:) to xkonuk-al-yil
                 end-if
              end-if   
    move rez-plan            to xkonuk-plan.
    move rez-dig-plan        to xkonuk-dig-plan
   
    move rez-OPERATOR        to xkonuk-OPERATOR. 
    move rez-pazar           to xkonuk-pazar.
    move rez-share           to xkonuk-share
    move rez-eb              to xkonuk-eb.
    move rez-ug-ind          to xkonuk-ug-indirimi
    move rez-fiyat-fix       to xkonuk-fiyat-fix.
    move rez-fix-anl         to xkonuk-fix-anl.
    move rez-special-eh      to xkonuk-special-eh 
    move rez-paylas-oda        to xkonuk-paylas-oda
    move rez-kur-aygun       to xkonuk-kur-aygun. 
    move rez-bilbord-eh      to xkonuk-bilbord-eh
    move REZ-AKSIYON-EH      to xKONUK-AKSIYON-EH  
    move REZ-share           to xKONUK-share
    move rez-vip             to xkonuk-vip. 
    move rez-gir-tar         to xkonuk-gel-tar. 
    move rez-al-tar(3:)          to xkonuk-al-tar.
    if xkonuk-al-yil  < "01" then 
                move rez-al-yil(3:) to xkonuk-al-yil
                 if xkonuk-al-yil  < "01" then 
                       move rez-isl-yil(3:) to xkonuk-al-yil
                 end-if
              end-if   
    move rez-cik-tar         to xkonuk-git-tar. 
    move rez-not1            to xkonuk-acik-1. 
    move rez-not2            to xkonuk-acik-2. 
    move rez-gel-saat        to xkonuk-gel-saat.
    move rez-gel-dak         to xkonuk-gel-dakika.
    move rez-late-zaman      to xkonuk-late-zaman

    move rez-git-saat        to xkonuk-git-saat.
    move rez-git-dak         to xkonuk-git-dakika.

    move "I"                 to xkonuk-durumu. 
    move "R"                 to xkonuk-fol-kodu. 
         initialize rez-ucreti tl-toplam dv-toplam. 
    move rez-fiyati          to rez-ucreti dv-toplam xkonuk-dv-degeri
                                srez-fiyati. 
****>Ozluk Bilgileri ataniyor.....
    move rez-adres1          to xozluk-adres1.
    move rez-adres2          to xozluk-adres2.
    move rez-e-mail          to xozluk-e-mail.
    move rez-sharenum to xkonuk-sharenum  .
*    move rez-telno           to xozluk-telno.
         
 rez-to-konuk-exit.
     exit.
*
 share-edilebilir-mi.
  
     move 1 to share-en
     if genel-paylas-oda = 1
         if xkonuk-paylas-oda = 1
            move 1 to share-en
          else
           move 0 to share-en
        end-if
        else
        move 1 to share-en
     end-if
     display button-sila
     .
*
*
 onay-kontrol.
      modify f-onay,
            reset-grid = 1
       open i-o onay
        move "ONAYLAR" to  f-1
                    modify f-onay,record-to-add(f-rec)
                    move 1 to onay-no
       initialize onay-rec
       set CIN-ONAY to true
       move xrez-no to  ONAY-ANAHTAR
       start onay key >= onay-id invalid continue
           not invalid 
           perform until fs-onay = "10"
             read onay next no lock end move "10" to fs-onay
                not end 
                 if (not CIN-ONAY ) or function numval(onay-anahtar) not =  xrez-no
                  move "10" to fs-onay
                  exit perform 
                  else
                    add 1 to  onay-no
                     move "CIN ONAYI "  to  f-1
                    modify f-onay, record-to-add(f-rec)
                    modify f-onay(onay-no, 2) hidden-data = ONAY-rec 
                    modify f-onay(onay-no, 1) hidden-data = ONAY-ID 
                    evaluate true
                           
                          when  ONAY-VERILDI 
                             move 152 to o-renk
                          when       ONAY-IPTAL 
                             move 176 to o-renk
                          when       onay-uygulandi 
                              move 80  to o-renk
                          when other
                            move 0 to o-renk
                    end-evaluate
                    if o-renk > 0
                     modify  f-onay(onay-no,1) row-color = o-renk
                    end-if
                     move 1 to vis-fo
                    
                 end-if  
              end-read 
              end-perform 
        end-start

       close onay.



*
 okunan-goster.

        move 0 to vis-fo
       
     if genel-onay = 1 
       perform onay-kontrol
       
       display f-onay
     end-if


     perform gel-yaz  perform git-yaz
     if "H" = xkonuk-aksiyon-eh
         move 1 to aks-yok
         else
         move 0 to aks-yok
     end-if
     display aks-cb

     if xkonuk-vip = spaces 
         move "N" to xkonuk-vip
     end-if
     move xkonuk-vip to konuk-vip-combo-value
     
     modify konuk-vip-combo, 
            value = konuk-vip-combo-value
            mass-update = 0.
    open input konum
       move xkonuk-fiyat-konumu to fiyat-konumu-combo-value
                               konum-anahtar
    read konum no lock invalid 
    initialize fiyat-konumu-combo-value
    move konum-anahtar     to fiyat-konumu-combo-value
    move "->"              to fiyat-konumu-combo-value(3:)
    move "Hata"            to fiyat-konumu-combo-value(5:)
    modify fiyat-konumu-combo,
            item-to-add(fiyat-konumu-combo-value)
     
     not invalid
*****>Fiyat konumu icin oku
     
     move konum-anahtar     to fiyat-konumu-combo-value
    move "->"              to fiyat-konumu-combo-value(3:)
    move konum-adi         to fiyat-konumu-combo-value(5:)
     end-read 
    modify fiyat-konumu-combo,
            value fiyat-konumu-combo-value mass-update = 0
    display fiyat-konumu-combo 
     move  xkonuk-oda-konumu  to konum-anahtar  
       read konum no lock invalid 
        initialize tmp-oda-konumu
    move konum-anahtar     to  tmp-oda-konumu
    move "->"              to  tmp-oda-konumu(3:)
    move "Hata"            to  tmp-oda-konumu(5:)
    not invalid 
       move konum-anahtar     to  tmp-oda-konumu
    move "->"              to  tmp-oda-konumu(3:)
    move konum-adi           to  tmp-oda-konumu(5:)
    
     end-read 
      display accept-oda-konumu
     close konum

     if xozluk-kim-turu = 0 move "1" to xozluk-kim-turu
     end-if
     move xozluk-kim-turu to kim-tipi-combo-value
     modify kim-tipi-combo, 
            value = kim-tipi-combo-value
            mass-update = 0.

    evaluate true
         when xkonuk-kur-aygun = "G" move "1" to rb-degisken-1
         when xkonuk-kur-aygun = "A" move "2" to rb-degisken-1
    end-evaluate
     modify kur-tipi-rb-1, GROUP-VALUE = rb-degisken-1.
    if xkonuk-cik-cikma = "E"
       set liste-cik to true
    else
       set liste-cikma to true
    end-if
      perform acenta-oku  thru acenta-oku-exit 
     if xKONUK-ACIK-KAPALI  = "C"
      move 1 to nopost-status
    else
      move 0 to  nopost-status
    end-if
    if xkonuk-fiyat-fix = "E"
       modify fix-fiyat-cb, value = 1
    else
       modify fix-fiyat-cb, value = 0
    end-if
    if xkonuk-bilbord-eh = "E"
       modify bilbord-cb, value = 1
    else
       modify bilbord-cb, value = 0
    end-if
    if xkonuk-eb = "E"
       modify eraly-booking-cb, value = 1
    else
       modify eraly-booking-cb, value = 0
    end-if

         initialize sifre-devrede        
     if genel2-kvkk-perdeleme-yil > 0

        open input kllnc
        initialize kllnc-rec
        move k-kodu-tasi to k-kodu
        read kllnc no lock invalid
           continue 
        not invalid 
            if k-kvkk-yetki  = "K"
                    
               move tarih-tasi to gercek-tarih-tasi
               compute s1 = function INTEGER-OF-DATE(gercek-tarih-tasi) - genel2-kvkk-perdeleme-yil 
               compute s2 = function DATE-of-integer(s1)
               if xkonuk-git-tar < s2
                
                  initialize sifreli-text
                  move xkonuk-adi to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xkonuk-adi

                  initialize sifreli-text
                  move xkonuk-soyadi to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xkonuk-soyadi
                   move 1 to sifre-devrede
               end-if 
            end-if 
        end-read 
       close kllnc
     end-if 
   

    perform yanrez-oku 
    open input takvim
     perform gun-bul
     close takvim
      
       if munferitmi = 1 
         initialize link-t
         move xkonuk-rez-no to Lnk-rez
          call "/asya/ytl/obj/otel/onodebul.asy" using link-t
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/onodebul.asy" 
       end-call




        move  lnk-kalan to z-alinacak
        move 1 to vis-web-odeme
        if lnk-kalan > 0 
        initialize   web-text(2)  web-text(1) web-text(3) 
       move  "GIRISDE ODEMELI KONAKLAMA" to web-text(1) 
        string z-alinacak " " d-kisa-adi delimited by size into web-text(2) 
        move "DAHA ODEME ALMALISINIZ" to web-text(3)
          move 176 to web-color
        else
               initialize   web-text(2)  web-text(1) web-text(3) 
                move  lnk-odeme to z-alinacak
       move  "ODEME OK" to web-text(1) 
        string z-alinacak " " d-kisa-adi delimited by size into web-text(2) 
        move "ODEME ALINMIS ODEME OK" to web-text(3)
       
        move  112 to web-color 
       end-if
     else



     if yrez-ozel-durum  > 91 then
        move 1 to vis-web-odeme
        else
        move 0 to vis-web-odeme
     end-if
     end-if





*************Formu Goster............
     display form1.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*    

************Degerleri Oku
            perform acenta-oku thru acenta-oku-exit
            |//31.05.2018 acenta adi okumadigi icin koyuldu salih
            perform firma-oku   thru firma-oku-exit
            perform op-goster
            perform rehber-goster
            perform vip-goster
            perform vip-turu-goster
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform sehir-oku    thru sehir-oku-exit
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            display accept-anlasmaa
            display plaka
            perform ozel-after
*********Tutarlari goster...........
    move xkonuk-oda-tutar         to tl-goster. 
    modify accept-oda-tutar-tl       value = tl-goster.
    move xkonuk-kahvalti-tutar    to tl-goster. 
    modify accept-kahvalti-tutar-tl  value = tl-goster.
    move xkonuk-ogle-tutar        to tl-goster. 
    modify accept-ogle-tutar-tl      value = tl-goster.
    move xkonuk-aksam-tutar       to tl-goster. 
    modify accept-aksam-tutar-tl      value = tl-goster.
    move xkonuk-icecek-tutar      to tl-goster. 
    modify accept-icecek-tutar-tl      value = tl-goster.
    move xkonuk-extra-tutar       to tl-goster. 
    modify accept-extra-tutar-tl      value = tl-goster.
    initialize tl-toplam 
    compute tl-toplam = xkonuk-oda-tutar .
*    + xkonuk-kahvalti-tutar + 
*                        xkonuk-extbed-tutar + xkonuk-ogle-tutar  + 
*                        xkonuk-aksam-tutar  + xkonuk-icecek-tutar  + 
*                        xkonuk-extra-tutar. 
    move tl-toplam               to tl-goster. 
    modify accept-toplam-tutar-tl      value = tl-goster.

    move xkonuk-dv-degeri        to dv-goster. 
    modify accept-toplam-tutar-dv       value = dv-goster.

    move xkonuk-kur-degeri       to islem-kuru-z. 
    display accept-gunluk-kur.

    move dv-oda                  to dv-goster. 
    modify accept-oda-tutar-dv       value = dv-goster.
    move dv-kahvalti             to dv-goster. 
    modify accept-kahvalti-tutar-dv       value = dv-goster.
    move dv-ogle                 to dv-goster. 
    modify accept-ogle-tutar-dv       value = dv-goster.
    move dv-aksam                to dv-goster. 
    modify accept-aksam-tutar-dv       value = dv-goster.
    move dv-icecek               to dv-goster. 
    modify accept-icecek-tutar-dv       value = dv-goster.
    move dv-extra                to dv-goster. 
    modify accept-extra-tutar-dv       value = dv-goster.
    move dv-toplam               to dv-goster. 
    modify accept-toplam-tutar-dv       value = dv-goster.
    modify fr-folio-kodu                title = xkonuk-fol-kodu.
    perform birles-goster
    
    if xkonuk-fol-kodu = "R" then 
          move 0 to bagli-vis  bagli-rez
       else
          move 1 to bagli-vis
          move xkonuk-extra-rez-no to bagli-rez
    end-if
    perform bagli-goster
     if xkonuk-rez-no > 0 then        
        if konuk-kayit-durumu  = "E" 
             move 2 to link-nereden 
           else
             move 8 to link-nereden 
          end-if
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move xkonuk-rez-no to link-NOT-DOS-ANAH   

                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
             display not-ac
         end-if
         perform share-edilebilir-mi
     .
*
 
*
 fix-fiyat-cb-Ev-Cmd-Clicked.
     initialize sayi
     inquire fix-fiyat-cb, value in sayi
     if sayi = 0 move "H" to xkonuk-fiyat-fix
     else        move "E" to xkonuk-fiyat-fix
     end-if.
*
 fix-fiyat-cb-Ex-Cmd-Clicked.
     initialize sayi
     inquire fix-fiyat-cb, value in sayi
     if sayi = 0 move "H" to xkonuk-fiyat-fix
     else        move "E" to xkonuk-fiyat-fix
     end-if.
*
  tab-1-Ev-Cmd-Tabchanged.
    inquire tab-1 value in form1-ta-1-value
    move 0 to tab-s-1-visible tab-s-2-visible 
              tab-s-3-visible tab-s-4-visible p1-vis
    display tab-s-1 
    display tab-s-2 
    display tab-s-4 
    display tab-s-3
    display tab-1
    if form1-ta-1-value = 1
       move 1 to tab-s-1-visible 
       display tab-s-1
    end-if 
    if form1-ta-1-value = 2
       move 1 to tab-s-2-visible
       display tab-s-2
    end-if 
    if form1-ta-1-value = 4
       move 1 to tab-s-4-visible p1-vis
       display tab-s-4 gd2
    end-if 
    if form1-ta-1-value = 3
*       if xrez-on-doviz not = 0 or xrez-on-doviz not = spaces
*          perform toplam-odeme-bul thru  toplam-odeme-bul-exit
*       end-if
       move 1 to tab-s-3-visible
       display tab-s-3
    end-if 
    move event-action-ignore to event-action.

* eraly-booking-cb-Ex-Cmd-Clicked.
*        evaluate control-id
*         when 224
*              inquire eraly-booking-cb, value in sayi
*              if sayi = 1 move "E" to xkonuk-eb
*                 else     move "H" to xkonuk-eb
*              end-if
*        end-evaluate.
     .
*                                  
 bef-procedure.
     
     move control-value    to sonraki-kontrol
     move control-id       to sonraki-id
     perform kullandi.
*     display message box "o-k->" onceki-kontrol, new-line
*                         "S-k->" sonraki-kontrol, new-line
*                         "O-id->" onceki-id, new-line
*                         "S-Id->" sonraki-id, new-line
*                         "key-->" key-status new-line
*                         "gec-gecme-->" gec-gecme.
***>Onceki Kontrole gidebilsin ama sonrakine gidemesin....
*     if gecmez
*        if sonraki-kontrol not = 1
*           if sonraki-kontrol > onceki-kontrol
*              move 4         to accept-control
*              move onceki-id to control-id
*              exit paragraph
*           end-if
*        end-if
*     end-if
     evaluate control-id
       when 1002
         
            if key-status = 1 and xkonuk-rez-no not = 0
               perform rez-oku
               perform folio-numarasi-al
            else
               perform ekran-sifirla
            end-if

            if link-var  = 1 and cin-tipi = 1
               move link-rezno to xkonuk-rez-no
               modify accept-rezno
               perform rez-oku
               perform folio-numarasi-al
            end-if
          
       when 1003
            if cin-tipi not = 1 
               if key-status = 1 and xkonuk-folio not = 0
                  exit paragraph
               end-if

               perform ekran-sifirla
******Parametredeki degerler ataniyor......

               move cinpara-ext-fol-banka  to xkonuk-banka
               move cinpara-ext-fol-doviz  to xkonuk-doviz
               move cinpara-ext-fol-pan    to xkonuk-pan-tipi
               move cinpara-ext-fol-ode    to xkonuk-odeme-tipi
               move cinpara-ext-fol-ulke   to xkonuk-ulke
               
*               move rezpara-banka          to xkonuk-banka
*               move rezpara-doviz          to xkonuk-doviz
*               move rezpara-pan-tipi       to xkonuk-pan-tipi
*               move rezpara-odeme-tipi     to xkonuk-odeme-tipi
*               move rezpara-ulke           to xkonuk-ulke
               move rezpara-pazar          to xkonuk-pazar
               move rezpara-anlasma        to xkonuk-anlasma
               move cinpara-ext-fol-aygun  to xkonuk-kur-aygun
               
               perform default-ata

               move calis-yil           to xkonuk-gel-yil xkonuk-git-yil 
               move calis-yil(3:2)      to xkonuk-al-yil
               move calis-ay            to xkonuk-gel-ay  xkonuk-git-ay  xkonuk-al-ay
               move calis-gun           to xkonuk-gel-gun xkonuk-git-gun  xkonuk-al-gun
                 open input takvim
             move   tarih-tasi to takvim-anah
             start takvim key > takvim-anah invalid continue
               not invalid
               read takvim next no lock end continue
               end-read
             end-start
             move takvim-anah to xkonuk-git-tar
             close takvim
               display accept-gir-gun 
               display accept-gir-ay  
               display accept-gir-yil 
               display accept-cik-gun 
               display accept-cik-ay  
               display accept-cik-yil 
                       initialize fiyat-degiskenler 
               perform  cin-parametre-ata
                       initialize gec-gecme 
            end-if
            
            modify accept-gir-gun enabled = true
            modify accept-gir-ay  enabled = true
            modify accept-gir-yil enabled = true
            modify accept-gir-saat enabled = true
            modify accept-gir-dakika enabled = true
            modify accept-cik-gun enabled = true
            modify accept-cik-ay  enabled = true
            modify accept-cik-yil enabled = true
            if genel-uzun-oda-no-kullanilsin = 1
                 move 1 to vis-uzun
                  modify accept-odano-uzun   enabled = true
                 else
                   move 1 to vis-kisa
                   modify accept-odano   enabled = true
           end-if
           
  

            modify accept-buyuk   enabled = true
            modify accept-kucuk   enabled = true
            modify accept-free    enabled = true
            modify accept-bebek   enabled = true
       when 226    
       when 1004
           if  xrez-blok-tip = 1 or 2 and xrez-odano not = spaces then 
                perform Aft-procedure 
                if genel-uzun-oda-no-kullanilsin = 1
                 move 0 to vis-uzun
                  modify accept-odano-uzun   enabled = false
                 else
                  move 0 to vis-kisa
                   modify accept-odano   enabled = false
                end-if
                 

                else
                if genel-uzun-oda-no-kullanilsin not = 1
                 modify button-odaara enabled = true
                end-if

           end-if 
       when 1022
            modify button-acenara enabled = true
       when 1027
            modify button-bankaara enabled = true
       when 1028
            modify button-dovizara enabled = true
       when 1029
            modify button-pansiyonara enabled = true
       when 1030
            modify button-odemeara enabled = true
       when 1031
            modify button-anlasmaara enabled = true
       when 1032
            modify button-pazarara enabled = true
       when 1033
            modify button-ulkeara enabled = true
     
       when 2001
            move dv-toplam to rez-fiyati rez-ucreti yeni-fiyat

     end-evaluate.

     initialize mesaj.
     evaluate control-id
          when 1001
              evaluate true
                  when turkce
                       move "Islem Tipini Seciniz 1->Rezervasyonlu 2->Walk-In 3->Extra Check-In..." to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1002
              evaluate true
                  when turkce
                       move "Check-In Yapmak Istediginiz Rezervasyonu Seciniz Enter->Bugun Gelecek Rez.Ara........." to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1003
              evaluate true
                  when turkce
                       move "Gormek Istediginiz Folioyu Seciniz F1->Ara...Enter->Yeni Check-In icin folio secer" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 226
          when 1004
              evaluate true
                  when turkce
                       move "Oda Numarasi Seciniz...F1->Oda Arar..." to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj.
*
 Aft-Procedure.
      if musteriden-geldi = 1
         move 4      to accept-control
         move 1021   to control-id
         move 0      to musteriden-geldi
         move 1      to basa-gitme
         
      end-if 
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
      initialize gec-gecme.
      evaluate control-id
      when 217 
          perform gel-yaz
      when 218
        perform git-yaz
       when 49
            move 2    to hangi-profil
            perform profil-goster
       when 65
            move 3    to hangi-profil
            perform profil-goster
       when 163
            move 4    to hangi-profil
            perform profil-goster
       when 168
            move 5    to hangi-profil
            perform profil-goster
       when 181
            move 6    to hangi-profil
            perform profil-goster
       when 186
            move 7    to hangi-profil
            perform profil-goster
       when 280
            move 8    to hangi-profil
            perform profil-goster
       when 285
            move 9    to hangi-profil
            perform profil-goster

       when 1002
            move 0 to vis-web-odeme display a1
            initialize gec-gecme
            if key-status = 52
               exit paragraph
            end-if 
            if cin-tipi = 1 
                if xkonuk-rez-no = 0
                   perform rez-ara thru rez-ara-exit
                end-if
             perform rez-oku
             if gecer
                perform folio-numarasi-al
             end-if
             if gecmez
                exit paragraph
             end-if
            end-if
       when 1003
            initialize gec-gecme   move 0 to vis-web-odeme display a1
                       konuk-kayit-durumu
                       ozluk-kayit-durumu
                       konuk-rec ozluk-rec ozluk2-rec
            if key-status = 52
               exit paragraph
            end-if 
            if cin-tipi = 2
               move "R"   to xkonuk-fol-kodu
               modify fr-folio-kodu title = xkonuk-fol-kodu
            end-if

            if cin-tipi = 3
               move "E"   to xkonuk-fol-kodu
               modify fr-folio-kodu title = xkonuk-fol-kodu
            end-if

            if xkonuk-folio not = 0
               move xkonuk-folio  to konuk-folio
               read konuk no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Kayit Bulunamadi ] " to mmesaj-title
                    move "Girdiginiz Folio Numarasinda   " to mmesaj-1 
                    move "Kayit Yok ....................." to mmesaj-2 
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver
                    move 1 to gec-gecme
                    exit paragraph
              not invalid continue
                  perform staf-oku-goster
              end-read
            end-if

            if xkonuk-folio = 0
               perform folio-numarasi-al
            end-if
*****************
            move xkonuk-folio  to konuk-folio
            read konuk no lock invalid 
                 move "Y"           to konuk-kayit-durumu 
            not invalid
                 move "E"           to konuk-kayit-durumu 
                 move xkonuk-folio  to ozluk-folio ozluk2-folio
                 read ozluk2 no lock invalid continue end-read
                 read ozluk no lock invalid 
                      move "Y" to ozluk-kayit-durumu 
                 not invalid 
                     move "E" to ozluk-kayit-durumu
                     move ozluk-rec   to xozluk-rec
                 end-read
                 if genel-plaka not = 1
                    move ozluk-plaka to plaka
                 else
                    open i-o plaka
                    initialize plaka-rec
                    move xkonuk-folio  to PLAKA-FOLIO   
                    move 1 to plaka-sira  
                    read plaka  no lock invalid 
                         continue 
                    not invalid 
                        move plaka-text to plaka
                    end-read
                    move 2 to plaka-sira  
                    read plaka  no lock invalid continue not invalid move plaka-text to plaka2 end-read
                    move 3 to plaka-sira  
                    read plaka  no lock invalid continue not invalid move plaka-text to plaka3 end-read
                    move 4 to plaka-sira  
                    read plaka  no lock invalid continue not invalid move plaka-text to plaka4 end-read
                    close plaka
                 end-if
                 move konuk-rec   to xkonuk-rec
                 initialize srez-bilgi
                 move xkonuk-oda-konumu    to srez-oda-konumu
                 move xkonuk-fiyat-konumu  to srez-fiyat-konumu
                 move xkonuk-dv-degeri     to srez-fiyati
                 move xkonuk-odano         to srez-odano 
                 move xkonuk-s-d-t-g       to srez-s-d-t-g
                 move xkonuk-buyuk         to srez-buyuk 
                 move xkonuk-kucuk         to srez-kucuk 
                 move xkonuk-free          to srez-free 
                 move xkonuk-bebek         to srez-bebek
                 move xkonuk-acenta        to srez-acenta
                 perform kur-bul thru kur-bul-exit
                 perform default-ata
                 if konuk-rez-no > 0 then 
                    move konuk-rez-no to rez-anah
                    read rez no lock invalid  
                         continue
                    not invalid
                        move rez-git-sirket to  yrez-git-sirket
                        move rez-gel-sirket to  yrez-gel-sirket
                        move  REZ-OZEL-DURUM-CAR   to  yREZ-OZEL-DURUM-CAR 
                        move  REZ-OZEL-DURUM       to  yREZ-OZEL-DURUM     
                        move  REZ-ozel-tip         to  yREZ-ozel-tip       
                        initialize rezek-rec
                        move rez-no to rezek-no 
                        open i-o rezek
                        read rezek no lock invalid
                             continue
                        end-read
                        close rezek
                    end-read
                 end-if
                 if xkonuk-al-tar  < "100000" then 
                    move rez-al-tar(3:) to xkonuk-al-tar
                    if xkonuk-al-tar  < "100000" then 
                       move rez-isl-tar(3:) to xkonuk-al-tar
                    end-if
                 end-if   

                 perform okunan-goster
                 initialize gec-gecme
            end-read
            if konuk-kayit-durumu = "E"
               modify accept-gir-gun    enabled = false
               modify accept-gir-ay     enabled = false
               modify accept-gir-yil    enabled = false
               modify accept-gir-saat   enabled = false
               modify accept-gir-dakika enabled = false
               modify accept-cik-gun    enabled = false
               modify accept-cik-ay     enabled = false
               modify accept-cik-yil    enabled = false
              
                if genel-uzun-oda-no-kullanilsin = 1
                move 0 to vis-kisa
                 
                  modify accept-odano-uzun   enabled = false
                 else
                   move 0 to vis-uzun
                   modify accept-odano   enabled = false
                end-if
   
       
               if cinpara-pax-degis = "H"  and
                  xkonuk-gel-tar
                  not = tarih-tasi
                  modify accept-buyuk   enabled = false
                  modify accept-kucuk   enabled = false
                  modify accept-free    enabled = false
                  modify accept-bebek   enabled = false
               end-if

            end-if
            if cin-tipi = 3
               modify accept-buyuk   enabled = false
               modify accept-kucuk   enabled = false
               modify accept-free    enabled = false
               modify accept-bebek   enabled = false

               modify accept-oda-tutar-tl      enabled = false
               modify accept-kahvalti-tutar-tl enabled = false
               modify accept-ogle-tutar-tl     enabled = false
               modify accept-aksam-tutar-tl    enabled = false
               modify accept-icecek-tutar-tl   enabled = false
               modify accept-extra-tutar-tl    enabled = false
               modify accept-toplam-tutar-tl   enabled = false
               modify accept-gunluk-kur        enabled = false
            end-if
            if konuk-rez-no > 0 then 
             move konuk-rez-no to rez-anah
             read rez no lock invalid  continue
             not invalid
                move  REZ-OZEL-DURUM-CAR   to  yREZ-OZEL-DURUM-CAR 
                move  REZ-OZEL-DURUM       to  yREZ-OZEL-DURUM     
                move  REZ-ozel-tip         to  yREZ-ozel-tip       
                  move rez-git-sirket to  yrez-git-sirket
                  move rez-gel-sirket to  yrez-gel-sirket
              end-read
             end-if

             move xkonuk-buyuk      to buyuk-sayisi
             move xkonuk-kucuk      to kucuk-sayisi


*            if gecmez
*               exit paragraph
*            end-if                      
       when 226
       when 1004
*********Oda No gir....
            if key-status = 52
               exit paragraph
            end-if 
            modify button-odaara enabled = false
            perform oda-after
**********>Short Kontrol.......
**********>KONTROLLER-4. 
*            if rezpara-short-uyari = "E" 
*               perform short-kontrol  thru short-kontrol-exit 
*               if short-var and rezpara-short-gecsin = "H"  
*                  move 1 to gec-gecme
*                  exit paragraph
*               end-if
*            end-if 


*******Giris Tarihi Kontrol......... 
       when 1012
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xkonuk-gel-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move "Girdiginiz Tarih Tanimsiz......."  to mmesaj-1
              move "Tekrar Deneyiniz................"  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xkonuk-gel-tar not = calisma-tarihi 
*              if k-kodu-tasi = "ASYA" AND isyeri-adres-tasi(1:5) = "kinac"
*                continue
*                else
              move 1 to gec-gecme
              initialize mesaj-degiskenler
              move " [ Yanlis Tarih ] " to mmesaj-title
              move "Check-In Tarihi Onburo Calisma Tarihinden"  to mmesaj-1
              move "Farkli Olamaz..Tarihi Degistirin........."  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
*              end-if
            end-if
            move gun-gun(takvim-gun-adi) to adi-goster
            modify lb-gel-gun-e title = adi-goster
            initialize adi-goster
            perform ara-mesaj
*******Cikis Tarihi Kontrol......... 
       when 1017
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xkonuk-git-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move "Girdiginiz Tarih Tanimsiz......."  to mmesaj-1
              move "Tekrar Deneyiniz................"  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xkonuk-git-tar < xkonuk-gel-tar
              move 1 to gec-gecme
              initialize mesaj-degiskenler
              move " [ Yanlis Tarih ] " to mmesaj-title
              move "Cikis Tarihi Giris Tarihinden Kucuk Olamaz."  to mmesaj-1
              move "Tarihi Degistirin.........................."  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if
            move gun-gun(takvim-gun-adi) to adi-goster
            modify lb-git-gun-e title = adi-goster
            initialize adi-goster
            perform ara-mesaj
       when 1020
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            if rezpara-adi-bosgec = "H" and xkonuk-adi = spaces 
               move 1 to gec-gecme
               initialize mesaj-degiskenler
               move " [ Musteri-Adi Bos ] " to mmesaj-title
               move "Musterinin Adini Bos Gecmek Icin .........."  to mmesaj-1
               move "Onburo Calisma Parametreleri Uygun Degil..."  to mmesaj-2
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               move 1 to gec-gecme
               exit paragraph
            end-if 
       when 1021
           if basa-gitme = 1
               exit paragraph
           end-if 
           if oto-gec = 1 then 
             exit paragraph
           end-if
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            if rezpara-soyadi-bosgec = "H" and xkonuk-soyadi = spaces 
               move 1 to gec-gecme
               initialize mesaj-degiskenler
               move " [ Musteri-Soyadi Bos ] " to mmesaj-title
               move "Musterinin Soyadini Bos Gecmek Icin........"  to mmesaj-1
               move "Onburo Calisma Parametreleri Uygun Degil..."  to mmesaj-2
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               move 1 to gec-gecme
               exit paragraph
            end-if 
            if xkonuk-fol-kodu = "R"
               modify tab-1, value = 4
               move 4  to form1-ta-1-value
               perform tab-1-Ev-Cmd-Tabchanged 
               move 1 to p1-vis            
               modify gd2,mass-update = 1
                          reset-grid = 1
                display gd2
                   move 1  to hangi-profil
                  perform profil-goster 
                move 0 to accept-control
            end-if 
**********>Eski Musteri ve Mukerrer Rezervasyon Kontrolu......
**********>KONTROLLER-1. 
*            if rezpara-eskimus-ara = "E" 
*               perform eskimus-ara  thru eskimus-ara-exit
*            end-if
*            if rezpara-mukerrer-ara = "E" and rezpara-isimden-ara 
*               perform mukerrer-isimden thru mukerrer-isimden-exit
*               if rezpara-mukerrer-gecsin = "H" 
*                   move 1 to gec-gecme
*                   exit paragraph
*               end-if
*            end-if 
             open input karalist            
             move "M" to karalist-tipi 
             move xkonuk-adi    to karalist-adi 
             move xkonuk-soyadi to karalist-soyadi 
             read karalist no lock invalid 
                continue
             not invalid 
                 display message box  "Misafir Kara Liste Uyarisi" new-line new-line new-line
                                      "Devam Etmeniz Durumunda Log kayitlarina Kullanici Kodunuz islenecektir." new-line new-line new-line new-line
                                 title "Uyari"
                                 icon 1
             end-read
             close karalist 
       when 1022
            if key-status = 52
               exit paragraph
            end-if 
            modify button-acenara enabled = false
            initialize gec-gecme
            perform acenta-oku thru acenta-oku-exit

            if acen-kara-list = 1
               display message box "Secmis oldugunuz acenta kara listede.." new-line
                                   "Lutfen Farkli Bir Acenta Kodu Giriniz.."
                               title "Uyari"
                               icon 1
                move 4    to accept-control
                move 1022 to control-id 
                exit paragraph 
            end-if 
            if gecmez
               exit paragraph
            end-if
            if konuk-kayit-durumu = "Y" then
             if xkonuk-firma = spaces
                if cin-tipi-combo-value(1:1) = 2
                   perform acen-dft-yukle
                end-if 
             end-if
            end-if


            if gecmez
               exit paragraph
            end-if
            perform ara-mesaj
       when 1044
            perform firma-oku thru firma-oku-exit
             if firma-rate not = spaces 
               if xkonuk-acenta  = spaces 
                      if konuk-kayit-durumu = "Y" then
                           if xkonuk-firma not = spaces
                              if cin-tipi-combo-value(1:1) = 2
                                perform firma-dft-yukle
                              end-if 
                            end-if
                      end-if
                   move firma-rate to xkonuk-acenta
                   display accept-acenta
                   else
                    display message box "Default Rate Koduna Uymamaktasiniz"

                end-if
                else
                 if gecmez
                    continue  

                 else
                     if konuk-kayit-durumu = "Y" then
                           if xkonuk-firma not = spaces
                              perform firma-dft-yukle
                            end-if
                      end-if
                 end-if 
               
            end-if
            perform ara-mesaj



       when 1023
            if key-status = 52
               exit paragraph
            end-if 
            evaluate true      
              when xkonuk-buyuk < 2 move "1" to xkonuk-s-d-t-g 
              when xkonuk-buyuk = 2 move "2" to xkonuk-s-d-t-g 
              when xkonuk-buyuk = 3 move "3" to xkonuk-s-d-t-g 
              when xkonuk-buyuk > 3 move "4" to xkonuk-s-d-t-g
            end-evaluate
**********>Kontenjan Kontrolu....
**********>KONTROLLER-5. 
*            if rezpara-kont-uyari = "E" and xrez-tipi = 1 
*               perform kontenjan-kontrol  thru kontenjan-kontrol-exit 
*               if kontj-yok and rezpara-kont-gecsin = "H" 
*                  move 1 to gec-gecme
*                  exit paragraph
*               end-if, 
*            end-if 

       when 1027
            if key-status = 52
               exit paragraph
            end-if 
            modify button-bankaara enabled = false
            initialize gec-gecme
            perform banka-oku thru banka-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1028
            if key-status = 52
               exit paragraph
            end-if 
            modify button-dovizara enabled = false
            initialize gec-gecme
            perform doviz-oku thru doviz-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1029
            if key-status = 52
               exit paragraph
            end-if 
            modify button-pansiyonara enabled = false
            initialize gec-gecme
            perform pansiyon-oku thru pansiyon-oku-exit
            if gecmez
               exit paragraph
            end-if 
**********>Kontrat kontrolu....Alotment Rezervasyonar icin...
**********>Aksiyon ve stop-sale kontrolu
**********>KONTROLLER-2. 
*            if xrez-tipi = 1 
*               move "V" to kontrat-var-yok 
*               perform kontrat-kontrol  thru kontrat-kontrol-exit 
*               if kontrat-var-yok = "Y" 
*                  move 1 to gec-gecme
*                  exit paragraph 
*               end-if 
*            end-if
*            if rezpara-stops-uyari = "E" 
*               perform stopsale-kontrol thru stopsale-kontrol-exit
*               if rezpara-stops-gecsin = "H" and 
*                  stopsale-var-yok = "V"
*                  move 1 to gec-gecme
*                  exit paragraph
*               end-if
*            end-if 
*            perform aksiyon-kontrol  thru aksiyon-kontrol-exit 

       when 1030
            if key-status = 52
               exit paragraph
            end-if 
            modify button-odemeara enabled = false
            initialize gec-gecme
            perform odeme-oku thru odeme-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1031
            if key-status = 52
               exit paragraph
            end-if 
            modify button-anlasmaara enabled = false
            initialize gec-gecme
            perform anlasma-oku thru anlasma-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1032
            if key-status = 52
               exit paragraph
            end-if 
            modify button-pazarara enabled = false
            initialize gec-gecme
            perform pazar-oku thru pazar-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1033
            if key-status = 52
               exit paragraph
            end-if 
            modify button-ulkeara enabled = false
            initialize gec-gecme
            perform ulke-oku thru ulke-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 144
            if key-status = 52
               exit paragraph
            end-if 
            
            
            perform sehir-oku thru sehir-oku-exit
       when 200
            if key-status = 52
               exit paragraph
            end-if 
            perform vip-goster
            
       when 144
            if key-status = 52
               exit paragraph
            end-if 
            perform op-goster
            
       when 1034
**********>Mukerrer Rezervasyon Kontrolu......Voucherden...
**********>KONTROLLER-3. 
*            initialize gec-gecme
*            if rezpara-mukerrer-ara = "E" and rezpara-voucherden-ara 
*               perform mukerrer-voucherden thru mukerrer-voucherden-exit 
*               if rezpara-mukerrer-gecsin = "H"
*                  move 1 to gec-gecme
*                  exit paragraph
*               end-if 
*            end-if

       when 1035 continue
********Liste cik-cikma
       when 1036 continue
********Early Booking

       when 1037
       when 1038
            if rb-degisken-1 = "1"
               move "G" to xkonuk-kur-aygun 
            else 
               move "A" to xkonuk-kur-aygun 
            end-if

       when 1039 continue
            move konuk-vip-combo-value to xkonuk-vip

       when 2001
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-oda-z   to xkonuk-oda-tutar
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2002
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-kahvalti-z   to xkonuk-kahvalti-tutar
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2003
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-ogle-z   to xkonuk-ogle-tutar
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2004
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-aksam-z   to xkonuk-aksam-tutar
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2005
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-icecek-z   to xkonuk-icecek-tutar
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2006
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-extra-z   to xkonuk-extra-tutar
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2007
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move tl-toplam-z   to tl-toplam
            perform kur-bul  thru kur-bul-exit
            if gecmez
               exit paragraph
            end-if

       when 2008
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move dv-toplam to rez-ucreti yeni-fiyat
            move islem-kuru-z to xkonuk-kur-degeri
            perform kur-bul  thru kur-bul-exit
            perform yeni-fiyat-al-1   thru yeni-fiyat-al-exit
            if gecmez
               exit paragraph
            end-if

       when 3006
           if oto-gec = 1 then 
             exit paragraph
           end-if
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xkonuk-gel-ay    to gel-ay 
            move xkonuk-gel-gun   to gel-gun 
            move xkonuk-git-ay    to git-ay 
            move xkonuk-git-gun   to git-gun 
            move xozluk-dogum-ay  to dog-ay 
            move xozluk-dogum-gun to dog-gun 
            if dog-ay-gun not < gel-ay-gun and 
               dog-ay-gun < git-ay-gun 
               initialize mesaj-degiskenler
               move " [ Dogum Gunu Uyari ] " to mmesaj-title
               move " !!! DOGUM GUNUNDE OTELDE !!! "    to mmesaj-1 
               move "                   "   to mmesaj-2 
               move 1           to mmesaj-type
               move 1           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
            end-if 

      
      end-evaluate
*****yanrez karalist kontrol    firat 30/01/2020
      evaluate control-id
         when 49
         when 65
         when 163
         when 168
         when 181
         when 186
         when 280
         when 285
              move hangi-profil to klist-yan-kac
              perform yanrez-karalist-kontrol
      end-evaluate
***************      
      .
*
 rehber-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "R" to kodlar02-tipi
    move xkonuk-rehber to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to reh-goster
    display acc-rehber lb-rehber
    close kodlar02.
* 
 op-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "O" to kodlar02-tipi
    move xkonuk-operator to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to op-goster
    display acc-operator lb-operator
    close kodlar02.

*
 op-ara.
    initialize pazar-cagir.
    move "O"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/opara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/opara.asy" 
    end-call
    move pazar-kodu-cagir     to xkonuk-operator
    perform op-goster
    .
*
 vip-ara.
    initialize infox-cagir
    move "v"   to infox-tipi-cagir
    call "/asya/ytl/obj/otel/vipara.asy" using infox-cagir
       on exception perform callerr-proc
          not on exception
    cancel "/asya/ytl/obj/otel/vipara.asy" 
    end-call
    move infox-kodu-cagir     to xkonuk-vip
    perform vip-goster.
* 
 vip-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "v" to kodlar02-tipi
    move xkonuk-vip to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to lb-vip-adi
    display acc-viptipi lb-vip
    close kodlar02.
    .
*
 rehber-ara.
    initialize pazar-cagir.
    move "O"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/rehara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/rehara.asy" 
    end-call
    move pazar-kodu-cagir     to xkonuk-rehber
    perform rehber-goster.

*
 ortak-yanrez.
      move konuk-rez-no    to yanrez-rezno
      move konuk-gel-tar   to yanrez-gel-tar
      move konuk-git-tar   to yanrez-git-tar
      move konuk-odano     to yanrez-odano.
*
 yanrez-kaydet.
    if konuk-rez-no not > 0 then 
       exit paragraph 
    end-if 
    open i-o yanrez
    initialize yanrez-rec
       move 1 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move konuk-adi        to yanrez-adi
       move konuk-soyadi     to yanrez-soyadi
       move xozluk-dogum-tar to yanrez-dog-tar
       move mis-no           to yanrez-profil-no
       move ps1              to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez

     if adi2 = spaces and soy2  = spaces  
         then
*          move xozluk-yani-adi1   to adi2   
*          move xozluk-yani-soy1   to  soy2 
        continue 
    end-if
     if adi3 = spaces and soy3  = spaces 
         then

*          move xozluk-yani-adi2   to adi3  
*          move xozluk-yani-soy2   to soy3 
           continue 
    end-if
    if adi2 not = spaces or soy2 not = spaces then
          
       initialize yanrez-rec
       move 2 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi2   to yanrez-adi    xozluk-yani-adi1
       move soy2   to yanrez-soyadi    xozluk-yani-soy1
       move d-tar2 to yanrez-dog-tar
       move pno2   to yanrez-profil-no
       move ps2    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
     else
         move  konuk-rez-no      to yanrez-rezno
          
         move 2 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
             end-read
    end-if
    if adi3 not = spaces or soy3 not = spaces then
       initialize yanrez-rec
       move 3 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi3   to yanrez-adi     xozluk-yani-adi2
       move soy3   to yanrez-soyadi  xozluk-yani-soy2
       move d-tar3 to yanrez-dog-tar
       move pno3   to yanrez-profil-no
       move ps3    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
        else
         move  konuk-rez-no      to yanrez-rezno
         move 3 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
             end-read
    end-if
    if adi4 not = spaces or soy4 not = spaces then
       initialize yanrez-rec
       move 4 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi4   to yanrez-adi
       move soy4   to yanrez-soyadi
       move d-tar4 to yanrez-dog-tar
       move pno4   to yanrez-profil-no
       move ps4    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move  konuk-rez-no      to yanrez-rezno


         move 4 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
             end-read
    end-if

    if adi5 not = spaces or soy5 not = spaces then
       initialize yanrez-rec
       move 5 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi5   to yanrez-adi
       move soy5   to yanrez-soyadi
       move d-tar5 to yanrez-dog-tar
       move pno5   to yanrez-profil-no
       move ps5    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move konuk-rez-no      to yanrez-rezno
         move 5 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
             end-read
    end-if
    if adi6 not = spaces or soy6 not = spaces then
       initialize yanrez-rec
       move 6 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi6   to yanrez-adi
       move soy6   to yanrez-soyadi
       move d-tar6 to yanrez-dog-tar
       move pno6   to yanrez-profil-no
       move ps6    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move konuk-rez-no      to yanrez-rezno
         move 6 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
             end-read
    end-if
    if adi7 not = spaces or soy7 not = spaces then
       initialize yanrez-rec
       move 7 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi7   to yanrez-adi
       move soy7   to yanrez-soyadi
       move d-tar7 to yanrez-dog-tar
       move pno7   to yanrez-profil-no
       move ps7    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move konuk-rez-no      to yanrez-rezno
         move 7 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if

    if adi8 not = spaces or soy8 not = spaces then
       initialize yanrez-rec
       move 8 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi8   to yanrez-adi
       move soy8   to yanrez-soyadi
       move d-tar8 to yanrez-dog-tar
       move pno8   to yanrez-profil-no
       move ps8    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move konuk-rez-no      to yanrez-rezno
         move 8 to yanrez-sirano
          read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if

    if adi9 not = spaces or soy9 not = spaces then
       initialize yanrez-rec
       move 9 to yanrez-sirano
       move konuk-rez-no    to yanrez-rezno
       read yanrez no lock invalid continue end-read
 
       move adi9   to yanrez-adi
       move soy9   to yanrez-soyadi
       move d-tar9 to yanrez-dog-tar
       move pno9   to yanrez-profil-no
       move ps9    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec 
             end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move konuk-rez-no      to yanrez-rezno
         move 9 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if

    close yanrez.
*
 yanrez-oku.
        initialize yan-deg tum-yas kk.
        if xkonuk-rez-no not > 0 then 
           exit paragraph 
        end-if       
        open input yanrez
        move xkonuk-rez-no to yanrez-rezno
        start yanrez key > yanrez-anah
         invalid
            continue
         not invalid 
           perform until fs-yanrez = "10"
              read yanrez next no lock
                 end 
                   move "10" to fs-yanrez
                 not end
                   if yanrez-rezno not = xkonuk-rez-no
                      move "10" to fs-yanrez
                      else
                      evaluate yanrez-sirano
                         when 1
                           move yanrez-profil-no to mis-no
                           move yanrez-profil-sirket to ps1
                           display acc-ps1 acc-mis-no
                           
                         when 2
                           move yanrez-adi      to  adi2
                           move yanrez-soyadi   to  soy2
                           move yanrez-dog-tar  to  d-tar2    
                           move yanrez-profil-no to pno2
                           move yanrez-profil-sirket to ps2

                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi2 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi2

                                  initialize sifreli-text
                                  move soy2 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy2
                           end-if 
                           display acc-ps2
                          if xozluk-yani-adi1 = spaces then 
                            move  adi2     to xozluk-yani-adi1
                          end-if
                          if xozluk-yani-soy1 = spaces then 
                            move  soy2     to xozluk-yani-soy1
                          end-if
                         when 3
                           move yanrez-adi      to  adi3
                           move yanrez-soyadi   to  soy3
                           move yanrez-dog-tar  to  d-tar3 
                           move yanrez-profil-no to pno3
                           move yanrez-profil-sirket to ps3


                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi3 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi3

                                  initialize sifreli-text
                                  move soy3 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy3
                           end-if 

                           display acc-ps3
                           if xozluk-yani-adi2 = spaces then 
                            move  adi3     to xozluk-yani-adi2
                          end-if
                          if xozluk-yani-soy2 = spaces then 
                            move  soy3     to xozluk-yani-soy2
                          end-if
                         when 4
                           move yanrez-adi      to  adi4
                           move yanrez-soyadi   to  soy4
                           move yanrez-dog-tar  to  d-tar4 
                           move yanrez-profil-no to pno4
                           move yanrez-profil-sirket to ps4


                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi4 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi4

                                  initialize sifreli-text
                                  move soy4 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy4
                           end-if 

                           display acc-ps4
                         when 5
                           move yanrez-adi      to  adi5
                           move yanrez-soyadi   to  soy5
                           move yanrez-dog-tar  to  d-tar5 
                           move yanrez-profil-no to pno5
                           move yanrez-profil-sirket to ps5

                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi5 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi5

                                  initialize sifreli-text
                                  move soy5 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy5
                           end-if 


                           display acc-ps5
                         when 6
                           move yanrez-adi      to  adi6
                           move yanrez-soyadi   to  soy6
                           move yanrez-dog-tar  to  d-tar6 
                           move yanrez-profil-no to pno6
                           move yanrez-profil-sirket to ps6


                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi6 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi6

                                  initialize sifreli-text
                                  move soy6 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy6
                           end-if 

                           display acc-ps6
                         when 7
                           move yanrez-adi      to  adi7
                           move yanrez-soyadi   to  soy7
                           move yanrez-dog-tar  to  d-tar7 
                           move yanrez-profil-no to pno7
                           move yanrez-profil-sirket to ps7

                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi7 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi7

                                  initialize sifreli-text
                                  move soy7 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy7
                           end-if 


                           display acc-ps7
                         when 8
                           move yanrez-adi      to  adi8
                           move yanrez-soyadi   to  soy8
                           move yanrez-dog-tar  to  d-tar8 
                           move yanrez-profil-no to pno8
                           move yanrez-profil-sirket to ps8

                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi8 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi8

                                  initialize sifreli-text
                                  move soy8 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy8
                           end-if 


                           display acc-ps8
                         when 9
                           move yanrez-adi      to  adi9
                           move yanrez-soyadi   to  soy9
                           move yanrez-dog-tar  to  d-tar9 
                           move yanrez-profil-no to pno9
                           move yanrez-profil-sirket to ps9

                           if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi9 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi9

                                  initialize sifreli-text
                                  move soy9 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy9
                           end-if 

                           display acc-ps9
                     end-evaluate
                     add 1                to kk 
                     if kk < 10
                        move yanrez-dog-tar  to tum-doglar(kk)
                     end-if
                   end-if
              end-read
           end-perform
        end-start.
        close yanrez.
*
 exception-procedure.
      perform kullandi.
      if key-status = 11
      set exit-pushed to true
        
     
       call "w$keybuf" using 1,x"1D" end-call
        exit paragraph
      end-if
      if key-status = 4574
         perform reg-kart-yazdir
      end-if 
      if key-status = 4559
              perform zarfdok-hazirla 
      end-if 
      if key-status = 258
            call "/asya/ytl/obj/otel/ysinir.asy" 
                       using xkonuk-rez-no
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/ysinir.asy"
             end-call
      end-if
       if key-status = 7

       if konuk-kayit-durumu not = "Y" and  konuk-durumu not = "H" and konuk-fol-kodu not = "E"
         perform share-form-cagir
       end-if
     end-if 
         if key-status = 4
            if konuk-kayit-durumu not = "Y" and  konuk-durumu not = "H" and konuk-fol-kodu not = "E"
              perform cogalt
           end-if
        end-if 
      if key-status = 118 then
         if konuk-fol-kodu = "R"     
            perform extra-ac thru extra-ac-exit
            display message box "Extra folio Acildi" title "Bilginize .........."
         end-if 
      end-if
      if  key-status = 3502 then
         perform acu-screen2-routine
      end-if
      if key-status = 3289
         perform kredi-karti-cagir
      end-if 
      if key-status = 4585
         perform onodeme-iptal
      end-if 
      if key-status = 4784    
         if rez-folio > 0                 
            if rez-c-in = "E"
               if rez-onodeme-var = 1
                     display message box "On Odeme Islenecektir..." new-line
                                         "Eminmisiniz?"
                                     title "Uyari"
                                     icon 1
                                     type 2
                                     default 2
                                     returning return-code 
                     if return-code = 2
                        exit paragraph 
                     end-if
                          perform on-odeme-yaz |yeni on odeme sekli
               end-if         
            end-if 
         end-if 

      end-if 
      if key-status = 1178
         perform folio-git
      end-if 
     if key-status = 3133 then
            initialize link-rout
            if xkonuk-fol-kodu = "R" 
              move xkonuk-rez-no to rout-rez-no(1)
               else
               move "F" to rout-tip
               move xkonuk-folio to rout-rez-no(1)
            end-if
            if rout-rez-no(1) = 0 then
             display message box "Herhangi bir konaklanmaya bagli olmayan folio"
             exit paragraph


            end-if
             string  xrez-no delimited by size
                     xrez-adi delimited by "   "
                     xrez-soyadi delimited by "  " 
                     into rout-text
                     move xkonuk-gel-tar to routsec-gir-tar
                  call "/asya/ytl/obj/otel/routsec.asy" 
                       using link-rout
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routsec.asy"
                  end-call
     end-if
     if key-status = 3187 then
            initialize link-rout
            if xkonuk-fol-kodu = "R" 
                  move xkonuk-rez-no to rklink-rez-no
               else
                 if xkonuk-extra-rez-no > 0 then 
                      move xkonuk-extra-rez-no to rklink-rez-no
                 end-if
             end-if
            

            
                  call "/asya/ytl/obj/otel/routkont.asy" 
                       using rklink-rez-no xkonuk-folio
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routkont.asy"
                  end-call
     end-if
     if link-var= 2 then
       if key-status = 19  then
          move 99999999 to link-fol-no
          set exit-pushed to true
          exit paragraph
       end-if

       if key-status = 15  then
          move 0 to link-fol-no
          set exit-pushed to true
          exit paragraph
       end-if
     end-if
      if key-status = 7 and 
         (control-id = 1004 or control-id = 226) 
        perform oda-arah
        initialize key-status
     end-if
     if key-status = 8 and 
        (control-id = 1004 or control-id = 226)
        perform oda-ara2
        initialize key-status
     end-if

     if key-status = 5555    or 
        key-status = 16
          if ((control-id = 1020 or
               control-id = 1021) and key-status = 16) or 
               control-id = 160
             move xkonuk-adi         to aranacak-adi  
             move xkonuk-soyadi      to aranacak-soyadi
             move mis-no             to bulunan-profil-no
             move ps1                to bulunan-profil-sirket
             move 1 to yan-kac
             perform profil-cagir
          end-if

          if ((control-id = 48 or
             control-id = 49) and key-status = 16) or 
             control-id = 54
            move 2        to yan-kac
            move adi2     to aranacak-adi
            move soy2     to aranacak-soyadi 
            move pno2     to bulunan-profil-no
            move ps2      to bulunan-profil-sirket
            move d-tar2   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 64 or
             control-id = 65) and key-status = 16) or 
             control-id = 73
            move 3        to yan-kac
            move adi3     to aranacak-adi 
            move soy3     to aranacak-soyadi
            move pno3     to bulunan-profil-no
            move ps3      to bulunan-profil-sirket 
            move d-tar3   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 164 or
             control-id = 163) and key-status = 16) or 
             control-id = 74
            move 4        to yan-kac
            move adi4     to aranacak-adi 
            move soy4     to aranacak-soyadi 
            move pno4     to bulunan-profil-no
            move ps4      to bulunan-profil-sirket
            move d-tar4   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 167 or
             control-id = 168) and key-status = 16) or 
             control-id = 174
            move 5        to yan-kac
            move adi5     to aranacak-adi 
            move soy5     to aranacak-soyadi 
            move pno5     to bulunan-profil-no
            move ps5      to bulunan-profil-sirket
            move d-tar5  to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 182 or
             control-id = 181) and key-status = 16) or 
             control-id = 175
            move 6        to yan-kac
            move adi6     to aranacak-adi 
            move soy6     to aranacak-soyadi
            move pno6     to bulunan-profil-no
            move ps6      to bulunan-profil-sirket 
            move d-tar6   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 185 or
             control-id = 186) and key-status = 16) or 
             control-id = 192
            move 7        to yan-kac
            move adi7     to aranacak-adi 
            move soy7     to aranacak-soyadi 
            move pno7     to bulunan-profil-no
            move ps7      to bulunan-profil-sirket
            move d-tar7   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if

          if ((control-id = 281 or
             control-id = 280) and key-status = 16) or 
             control-id = 276
            move 8        to yan-kac
            move adi8     to aranacak-adi 
            move soy8     to aranacak-soyadi 
            move pno8     to bulunan-profil-no
            move ps8      to bulunan-profil-sirket
            move d-tar8   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if

          if ((control-id = 285 or
             control-id = 284) and key-status = 16) or 
             control-id = 291
            move 9        to yan-kac
            move adi9     to aranacak-adi 
            move soy9     to aranacak-soyadi 
            move pno9     to bulunan-profil-no
            move ps9      to bulunan-profil-sirket
            move d-tar9   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
     end-if

********* eger donuste yeniden okunmassan karisikliga sebeb olur 
********* saglam kafa ile test edilmesi lazim **** mami
**********************************************

     if key-status = 18  and xkonuk-rez-no not = 0 then
        initialize dokcagir-tasi
        move xkonuk-rez-no              to rez-no
        set dokcagir-tasi-call-rez1     to true
        move rez-no                     to dokcagir-rez-no
        perform dokcagir-call
        move dokcagir-rez-no            to rez-no
        exit paragraph
      end-if             
********************************************
     move control-id to gidis-id
     if key-status = 3131 and xkonuk-rez-no > 0 then
           move "U"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move xkonuk-rez-no to link-NOT-DOS-ANAH  
            if konuk-kayit-durumu  = "E" 
             move 2 to link-nereden 
           else
             move 8 to link-nereden 
          end-if
           string xkonuk-adi delimited by "  "
                  " " delimited by size
                  xkonuk-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" using link-not
                        on exception 
                           perform callerr-proc
                           exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/mesajgir.asy"
                   end-call
              
                    move  link-not-donus  to  toplam-not
                  display not-ac
      exit paragraph 
     end-if
     
     if key-status = 4555
        if rez-dev-uye-no not = zeroes
           move  rez-dev-uye-no to link-uye-no 
           call "/asya/ytl/obj/otel/devmulk.asy" 
                        using  link-uye-no
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                cancel "/asya/ytl/obj/otel/devmulk.asy"
           end-call
        end-if  
     end-if 


     evaluate key-status
          when 17 
             move konuk-dosya         to link-logview-dosya-adi
             

              
             set link-logview-pointer  to address of konuk-rec
             set link-logview-rec-size to size of konuk-rec
             perform logview-call
             initialize key-status

            
         when 1 
            evaluate control-id
             when 158
                perform rehber-ara
             when 200
                perform vip-ara
             when 158
                perform op-ara
             when 4234
               initialize hesapara-link
               move MUHA-SIRKETI  to hesapara-isyeri
                move genel-muha-uzak-ip to hesapara-ip-no
                call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to ozluk2-cari
                        display ac-cari
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
                end-call
             when 151
                 initialize folara-cagir  
                 move "I" to folara-cagri-tipi
                 move "R" to folara-fol-kodu
                 call "/asya/ytl/obj/otel/folara3.asy" using folara-cagir
                  on exception 
                     perform callerr-proc
                  not on exception
                     if folara-no-cagir <> zeroes 
                        move folara-no-cagir  to ozluk2-birles-folio
                        display form1-ef-birles
                     end-if
                  cancel "/asya/ytl/obj/otel/folara3.asy"
             end-call
              when  1002
                    if cin-tipi = 1
                       perform rez-ara    thru rez-ara-exit
                    end-if
              
              when 1236
                  perform ozel-ara
              when  1003
                    perform konuk-ara    thru konuk-ara-exit
              when 226
              when  1004
                     perform oda-ara2
                      initialize key-status
            |  when  1020
            |        perform kon-ara      thru kon-ara-exit
              
              when  1022
                    perform acenta-ara   thru acenta-ara-exit
              when  1044
                    perform firma-ara   thru firma-ara-exit
              when  1027
                    perform banka-ara    thru banka-ara-exit
              when  1028
                    perform doviz-ara    thru doviz-ara-exit
              when  1029
                    perform pansiyon-ara thru pansiyon-ara-exit
              when  1030
                    perform odeme-ara    thru odeme-ara-exit
              when  1031
                    perform anlasma-ara  thru anlasma-ara-exit
              when  1032
                    perform pazar-ara    thru pazar-ara-exit
              when  1033
                    perform ulke-ara     thru ulke-ara-exit
              when  144
                    perform sehir-ara     thru sehir-ara-exit
              when  2001
                    perform fiyat-degis
              when  240
                    perform kaynak1-ara
              when  239
                    perform kaynak2-ara
              when  235
                    perform kaynak3-ara

            end-evaluate

         when 2 
              perform dosya-kilit-kontrol

              if extra-sil = 1 then 
                display message box " Silinen extrayi kaydedemessiniz" title
                " DIKKAT"
                      exit paragraph
              end-if
*/********************alba side derya istegi************-*/-*/-*/-*/-*/-*/-*/-*/-*/-*/
              open input aceanlas
              initialize yas-tanimi-yok aceanlas-rec
              move xkonuk-acenta  to aceanlas-acenta
              move xkonuk-anlasma to aceanlas-anlasma
              start aceanlas key not < aceanlas-anah invalid
                    continue
              not invalid
              perform with test after until fs-aceanlas = "10"      
              read aceanlas next no lock end move "10" to fs-aceanlas
              not at end

                  if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
                     if onkpara-referans-var = 1 
                        evaluate onkpara-referans-nerden
                            when 1 
                                 open input konum 
                                 initialize konum-rec 
                                 move xkonuk-fiyat-konumu to konum-anahtar 
                                 read konum no lock invalid
                                      continue
                                 end-read 
                                 close konum
                                 if aceanlas-referans not = spaces and aceanlas-referans not = 0
                                    if konum-ref not = aceanlas-referans
                                       exit perform cycle
                                    end-if
                                 end-if 
                            when 2
                                 open input odalar 
                                 initialize odalar-rec 
                                 move xkonuk-odano to odalar-rec 
                                 read odalar no lock invalid
                                      continue
                                 end-read 
                                 close odalar 
                                 if aceanlas-referans not = spaces and aceanlas-referans not = 0
                                    if odalar-referans not = aceanlas-referans
                                       exit perform cycle
                                    end-if
                                 end-if
                        end-evaluate 
                     end-if
                  end-if   |||X

                  if xkonuk-anlasma <> aceanlas-anlasma or 
                     xkonuk-acenta  <> aceanlas-acenta
                     exit perform 
                  end-if
                  if aceanlas-yassinir <> spaces 
                     move 1 to yas-tanimi-yok 
                  end-if
              end-read
              end-perform
              end-start
              close aceanlas
              if yas-tanimi-yok = 1
                 open input yassinir aceanlas
                 initialize  lnk2 tum-y
                 move xkonuk-acenta  to  lnk2-acenta
                 move xkonuk-anlasma to  lnk2-anlasma
               
                 perform yastan-bul             
                 perform link2
                 
                 close yassinir aceanlas
        
        
                 if myassinir-pax <> xkonuk-buyuk or
                    myassinir-chi <> xkonuk-kucuk or
                    myassinir-fre <> xkonuk-free  or
                    myassinir-beb <> xkonuk-bebek
                  
                    display message box "Yas sinir tanimlamasina gore olmasi gereken" new-line
                                        "kisi sayisi dagilimi asagidaki gibidir.." new-line
                                        myassinir-pax, " / ", myassinir-chi, " / ", myassinir-fre , " / ", myassinir-beb new-line
                                        "Lutfen kontrol ediniz.."
                 end-if
              end-if
*/********************delphin tolga comertoglu istegi***-*/-*/-*/-*/-*/-*/-*/-*/-*/-*/
              if genel-fiks-yok = 1 and xkonuk-fol-kodu = "R"
                 if k-fix-fiyat-etkin = 0 or space                                       | firat 30/07/2020 delphine
                    if xkonuk-buyuk < buyuk-sayisi
                       display message box "Pax Sayisi Dusurulemez..." new-line
                                           "Lutfen yetkili personel ile irtibata geciniz..."
                                       title "Uyari"
                                       icon 1
                       exit paragraph 
                    end-if 
                    if xkonuk-KuCuk < kucuk-sayisi
                       display message box "Cocuk Sayisi Dusurulemez..." new-line
                                           "Lutfen yetkili personel ile irtibata geciniz..."
                                     title "Uyari"
                                      icon 1
                       exit paragraph 
                    end-if
                 end-if
              end-if 
*/********************delphin tolga comertoglu istegi*/*/*/*/*-/*/-/-*/-*/-/-*/-*/-*/-*/-*/-*/
              if control-id = 1004  or 226
                 perform Aft-Procedure
              end-if
              if gecmez
                 exit paragraph
              end-if
              initialize pre-cin-ok
              perform oda-after


               if xkonuk-fol-kodu = "R" 
               if xkonuk-plan not = 1 then 
                     if k1-fiy-sup not = 1 
                             display message box "Fiyat Supervisor degilsiniz"  new-line 
                                         "fiyat hesaplamasi yapilmadi" title "   "                            
                         else
                           perform hes-gonder
                      end-if
                    else
                    display message box "Planlama Yapilmis konaklama kaydi"  new-line 
                                         "fiyat hesaplamasi yapilmadi" title "   " 
               end-if
              end-if

            initialize t-kisi girilen-kisi
            compute t-kisi = xkonuk-buyuk + xkonuk-kucuk + xkonuk-free + xkonuk-bebek
            
                 if adi2 not = spaces and soy2 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi3 not = spaces and soy3 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi4 not = spaces and soy4 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi5 not = spaces and soy5 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi6 not = spaces and soy6 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi7 not = spaces and soy7 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi8 not = spaces and soy8 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi9 not = spaces and soy9 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 add 1 to girilen-kisi

               if girilen-kisi > t-kisi |and xiii-hata-ver = 1
                   if t-kisi = 0 then 
                      if genel2-sifir-pax-izin-verme = 1
                         display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                             "Girilen isim sayisi :" girilen-kisi new-line
                                             "0 Pax giris yaptiniz" new-line
                                             "Islem Iptal Edildi.."
                                       title "Uyari"
                                        icon 1
                         move 1 to gec-gecme
                         exit paragraph
                      else
                         display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                             "Girilen isim sayisi :" girilen-kisi new-line
                                             "0 Pax giris yaptiniz"
                                       title "Uyari"
                                        icon 1
                      end-if
                   else
                       display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                           "Girilen isim sayisi :" girilen-kisi new-line
                                           "Fazla Sayida isim girisi yaptiniz.." new-line
                                           "Islem Iptal Edildi.."
                                       title "Uyari"
                                       icon 1
                        move 1 to gec-gecme
                        exit paragraph
                  end-if
               end-if 
                
               if t-kisi > 9                                                      ||| firat ramazan abi istedi 24/08/2019
                  display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                      "Sisteme 9 dan fazla kisi girilememektedir." new-line
                                      "Islem Iptal Edildi.." new-line
                                      "Asya-Soft Ile Iletisime Geciniz.."
                                  title "Uyari"
                                  icon 1
                   move 1 to gec-gecme
                   exit paragraph
               end-if

               initialize rez-rec
               if xkonuk-fol-kodu = "R"
                 move xkonuk-rez-no   to rez-no 
               else
                 move xkonuk-extra-rez-no   to rez-no
               end-if 
               
               read rez no lock invalid 
                   continue 
               not invalid 
                    if rez-durumu = "S" 
                       display message box "Silinen Rezervasyon C-In'e Alinamaz..."
                                       title "Uyari"
                                       icon 1
                             
                         move 1 to gec-gecme
                         exit paragraph 
                    end-if 
               end-read      

              open input kllnc
              initialize kllnc-rec 
              move k-kodu-tasi to k-kodu
              read kllnc no lock invalid
                   continue
              not invalid
                  if k-ccenter-user = 1 
                     if k-ccenter-supervisor = 0 
                        display message box "Ccenter yetkilendirmesi ;" new-line
                                            "Supervisor olmayan kullanici kayit yapamaz.."
                        close kllnc 
                        exit paragraph
                     else
                        initialize konuk-rec 
                        move xkonuk-folio  to konuk-folio
                        read konuk no lock invalid continue end-read 
         
                        move xkonuk-acik-1 to konuk-acik-1 rez-not1
                        move xkonuk-acik-2 to konuk-acik-2 rez-not2
                         
                        accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                        accept rez-edit-zaman from time          |                           
                
                        rewrite rez-rec end-rewrite 
                        perform log-operation-rez
                        rewrite konuk-rec end-rewrite 
                        perform log-operation-konuk
                        display message box "Ccenter yetkilendirmesi ;" new-line
                                            "Yalnizca notlar kaydedilmistir.."
                        close kllnc 
                        exit paragraph                        
                     end-if
                  end-if
              end-read 
              close kllnc
              if rez-cin-kuru not > 0
                 open input kur
                 initialize kur-rec 
                 move xkonuk-gel-tar to kur-tarih
                 move xkonuk-banka   to kur-banka
                 move xkonuk-doviz   to kur-doviz 
                 read kur no lock invalid
                      display message box "Giris tarihi kuru tanimsiz.."
                 not invalid 
                     if xkonuk-kur-degeri <> doviz-alis
                        display message box "C-in kuru uyusmuyor.." new-line
                                            "Kuru silip Enter'a basarak duzeltebilirsiniz.."
                     end-if
                 end-read 
                 close kur
              end-if
              if genel2-cin-mail-tel-zorunlu = 1
                 open input yanrez musteri
                 initialize yanrez-rec cep-mail-hata
                 move xkonuk-rez-no to yanrez-rezno 
                 move 1             to yanrez-sirano
                 read yanrez no lock invalid
                      move 1 to cep-mail-hata
                 not invalid
                     if yanrez-profil-sirket = spaces 
                        move 1 to cep-mail-hata
                     else
                        initialize musteri-rec 
                        move yanrez-profil-sirket to musteri-sirket 
                        move yanrez-profil-no     to musteri-no
                        read musteri no lock invalid
                             move 1 to cep-mail-hata
                        not invalid
                            if musteri-e-mail = spaces 
                               move 2 to cep-mail-hata
                            end-if
                            if musteri-gsm = spaces and 
                               musteri-tel1 = spaces and 
                               musteri-tel2 = spaces and
                               musteri-tel3 = spaces and 
                               musteri-fax  = spaces and 
                               xkonuk-telefon-no = spaces 
                               move 3 to cep-mail-hata                      
                            end-if
                        end-read
                     end-if
                 end-read 
                 close yanrez musteri
                 if cep-mail-hata > 0
                    evaluate cep-mail-hata
                        when 1
                             display message box "Telefon ve mail parametresi icin profil bulunamadi." new-line
                                                 "C-in islemi iptal edilmistir..."
                                           title "Uyari"
                                            icon 1
                        when 2
                             display message box "C-in esnasinda mail zorunludur." new-line
                                                 "C-in islemi iptal edilmistir..."
                                           title "Uyari"
                                            icon 1
                        when 3
                             display message box "C-in esnasinda telefon no zorunludur." new-line
                                                 "C-in islemi iptal edilmistir..."
                                           title "Uyari"
                                            icon 1
                    end-evaluate 
                    exit paragraph
                 end-if
              end-if
              perform kaydet thru kaydet-exit
              
         when 8
            if k1-fiy-sup not = 1 
              display message box "Fiyat Supervisor yetkisine sahip olmaniz gerekmektedir"  new-line
                                  "Kullanici kodu tanimlama - Gelismis butonu ile tanimlayabilirsiniz" new-line
                                  title "SUPERVISOR YETKISINE SAHIP DEGILSINIZ"
              else
                      display message box "Gecmis istatistikleri degistirmek uzeresiniz."  new-line
                                  "Emin misiniz?" new-line
                                  title "ISTATISTIK TALEBI"   icon 2 default 2 type 2 giving sonuc
                              if sonuc not  = 1 then 
                                exit paragraph
                              end-if
                    if konuk-rez-no > 0 and konuk-durumu = "I"  then
                      open i-o cast
                      initialize cast-rec
                      move konuk-rez-no to cast-rez-no
                      start cast key > CAST-ANAH1 
                           invalid 
                             continue
                           not invalid
                           perform until fs-cast = "10" 
                                read cast next no lock  
                                    end 
                                       move "10" to fs-cast
                                    not end 
                                       if cast-rez-no = konuk-rez-no 
                                            
                                                   move xkonuk-buyuk to cast-buyuk
                                                   move xkonuk-kucuk to cast-kucuk
                                                   move xkonuk-fiyat-konumu to CAST-FIYAT-KONUMU
                                                   move xkonuk-pan-tipi to CAST-PAN-TIPI  
                                                   move xkonuk-anlasma to cast-anlasma
                                                   move xkonuk-sharenum to cast-sharenum
                                                     move xkonuk-grup-no      to cast-grup
                                                   rewrite cast-rec invalid stop " " end-rewrite
                                             
                                       end-if
                                 end-read
                           end-perform 
                       end-start
                       close cast
                    end-if
            end-if
         when 3 
              move xkonuk-rez-no     to xrez-no  
              perform dosya-kilit-kontrol

              if konuk-kayit-durumu = "E"
                 perform sil    thru sil-exit
              end-if
              if donus-kodu = 1
                 call "w$keybuf" using 1,x"1B" end-call 
              end-if 
         WHEN 6
              if rezpara-trace = 1 and 
                 xkonuk-fol-kodu = "R"
*                if k1-fiy-sup not = 1 then  
*                   display message box "Bu kullanici Fiyat Supervisor  degildir" title "Dikkat"
*                else
                    call "/asya/ytl/obj/otel/cast2.asy" 
                    using xkonuk-rez-no xkonuk-plan  xkonuk-dig-plan
                    on exception 
                    perform callerr-proc
                    exit paragraph
                    not on exception 
                    cancel "/asya/ytl/obj/otel/cast2.asy"
                    end-call
                    display Form1-Pb-4

                    move xKONUK-FOLIO to KONUK-FOLIO 
                    read konuk no lock invalid 
                         continue
                    not invalid
                        if xkonuk-plan not = konuk-plan or xkonuk-dig-plan  not = konuk-dig-plan 
                           move xkonuk-plan to konuk-plan
                           move xkonuk-dig-plan to konuk-dig-plan 
                           rewrite konuk-rec invalid 
                                   continue 
                           not invalid 
                               if xkonuk-rez-no > 0 then 
                                  move xkonuk-rez-no to rez-no
                                  read rez no lock invalid 
                                       continue
                                  not invalid
                                      move xkonuk-plan to rez-plan
                                      move xkonuk-dig-plan to rez-dig-plan 

                                      accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                                      accept rez-edit-zaman from time          |                           
                
                                      rewrite rez-rec invalid 
                                              continue 
                                      end-rewrite
                    
                                  end-read
                               end-if
                           end-rewrite
                           display Form1-Pb-4
                        end-if  
                    end-read

*                end-if
                 exit paragraph 
              end-if
         when 5
              open input kllnc
              initialize kllnc-rec 
              move k-kodu-tasi   to k-kodu
              read kllnc no lock invalid 
                   continue          
              end-read
              close kllnc

              if k-kvkk-bilgileri-gorebilir = 0
                 display message box "Kullanici kvkk yetkisi yoktur."
                 exit paragraph
              end-if

              if konuk-rez-no > 0 then  
              move konuk-rez-no to xml-rez-no
              move konuk-folio  to xml-fol-no
               call "/asya/ytl/obj/otel/polisxml.asy"  using xml-cagir       
                    not on exception  
                    cancel "/asya/ytl/obj/otel/polisxml.asy"
              end-call
              cancel "/asya/ytl/obj/otel/polisxml.asy"
              end-if
     end-evaluate.

*********************KONTROLLER*********************
*
 kaydet.
    
    if cin-tipi = 3
       move 1 to xkonuk-s-d-t-g
    end-if.
    if konuk-kayit-durumu = "Y" and cin-tipi not = 1
       move 6 to xkonuk-rez-tipi
    end-if.
    if konuk-kayit-durumu not = "E" and cin-tipi = 3
       move "E" to xkonuk-fol-kodu
    end-if.
 kaydet-kontrol. 
        if xkonuk-gel-tar = xkonuk-git-tar
           display message box "REZERVASYON GIRIS-CIKIS TARIHLERI AYNI " new-line new-line 
                               "DEVAM ETMEK ISTER MISINIZ...?"
                           title "Uyari"
                           icon 1
                           type 2
                           default 2
                           returning donus-kodu
           if donus-kodu = 2
              move 1 to gec-gecme
              go kaydet-exit
           end-if 
        end-if 

*****>Silinmis folio'ya dokunma.... 
      if xkonuk-durumu = "H" 
         initialize mesaj-degiskenler
         move " [ DIKKAT ] " to mmesaj-title
         move "Bu Folio Check Out Olmus......." to mmesaj-1 
         move "Degistiremezsiniz......!!!!!!!!" to mmesaj-2 
         move 1           to mmesaj-type
         move 1           to mmesaj-icon
         move 1           to mmesaj-default
         perform mmesaj-ver
         open input kllnc
      initialize kllnc-rec 
      move k-kodu-tasi   to k-kodu
      read kllnc no lock invalid 
        continue          
      end-read
      close kllnc
         if K-muh-SUP = 1 or ( k-kodu-tasi = "ASYA" or "X   ") then 
           display message box "Sadece kaynak1 kaynak2 kaynak3 cari anlasma eb gecgiris aksiyon uygulanmasin ve fiyat konumu kaydedilecek" title "sadece kisitli alanlarda"
            move xkonuk-rez-no       to rez-no  
           
           read rez no lock invalid 
                continue
                not invalid
                    move xkonuk-room-kdv-yok  to konuk-room-kdv-yok   
                                                 rez-room-kdv-yok
                    move xkonuk-extra-kdv-yok to konuk-extra-kdv-yok 
                                                 rez-extra-kdv-yok
                    move xkonuk-acenta        to konuk-acenta    
                                                 rez-acenta
                    move xkonuk-doviz         to konuk-doviz   
                                                 rez-doviz
                    move xkonuk-kur-degeri    to konuk-kur-degeri
                    move xkonuk-free          to konuk-free 
                                                 rez-free
                    move xkonuk-bebek         to konuk-bebek 
                                                 rez-bebek
                    move xkonuk-anlasma       to konuk-anlasma 
                                                 rez-anlasma
                    move xkonuk-eb            to konuk-eb 
                                                 rez-eb
                    move xkonuk-gec-giris     to konuk-gec-giris 
                                                 rez-gec
                    
                    move xkonuk-plan          to konuk-plan  
                                                 rez-plan
                    move xkonuk-dig-plan      to konuk-dig-plan 
                                                 rez-dig-plan
                    move xkonuk-aksiyon-eh    to konuk-aksiyon-eh 
                                                 rez-aksiyon-eh
                    move xkonuk-fiyat-konumu  to konuk-fiyat-konumu 
                                                 rez-fiyat-konumu
                    move xkonuk-anlasma       to rez-anlasma
                    move xkonuk-sehir         to konuk-sehir
                                                 rez-sehir
                    move 2000                 to rez-al-yil
                    move xkonuk-al-tar        to rez-al-tar(3:)
                    move xkonuk-operator      to rez-operator 
                                                 konuk-operator
                    move yrez-ozel-durum-car  to rez-ozel-durum-car 
                    move yrez-ozel-durum      to rez-ozel-durum     
                    move yrez-ozel-tip        to rez-ozel-tip   
                    move yrez-git-sirket      to rez-git-sirket
                    move yrez-gel-sirket      to rez-gel-sirket
                    move yrez-bavel           to rez-bavel             
                    move xkonuk-voucher       to rez-voucher 
                                                 konuk-voucher
                    move xkonuk-pazar         to rez-pazar 
                                                 konuk-pazar
                    move xkonuk-kaynak-1      to konuk-kaynak-1 rez-kaynak-1
                    move xkonuk-kaynak-2      to konuk-kaynak-2 rez-kaynak-2
                    move xkonuk-kaynak-3      to konuk-kaynak-3 rez-kaynak-3
                    move xkonuk-odeme-tipi    to konuk-odeme-tipi rez-odeme-tipi
                    move xkonuk-ulke          to konuk-ulke rez-ulke
                    move xkonuk-proforma      to konuk-proforma
                     
                    accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                    accept rez-edit-zaman from time          |                           
                
                  rewrite rez-rec invalid
                      continue
                  not invalid

                    rewrite konuk-rec  invalid continue end-rewrite
                    rewrite ozluk2-rec invalid continue end-rewrite
                  
                  end-rewrite                   
              end-read
         end-if
         go kaydet-exit
      end-if.
        initialize mesaj-degiskenler gec-gecme.
        move " [ Hata ] " to mmesaj-title
        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
        perform oda-oku   thru oda-oku-exit
                if gecmez 
                move "Hata Yeri : [ Oda No Tanimsiz.....................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go Kaydet-exit
                end-if 
         if konuk-kayit-durumu = "Y"
                 perform blok-kont2
                 if not gecmez
                  perform dolu-oda-kontrol thru dolu-oda-kontrol-exit 
                 end-if
               if gecmez
                  initialize xkonuk-odano
                  move ydk-odano to xkonuk-odano
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
                      go kaydet-exit
                      else
                        move xkonuk-odano to ydk-odano
               end-if
            
         end-if
            if gecmez 
                move "Hata Yeri : [ Oda No Uyumsuz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
               
                else
                  move xkonuk-odano to ydk-odano
                end-if 
        perform acenta-oku   thru acenta-oku-exit
                if gecmez 
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform banka-oku    thru banka-oku-exit
                if gecmez
                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform odeme-oku    thru odeme-oku-exit
                initialize extra-tel-ac
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
                move ode-tipi to extra-tel-ac
        perform firma-oku  
                initialize extra-tel-ac
                if gecmez
                move "Hata Yeri : [ Firma    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
                move ode-tipi to extra-tel-ac
        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez

                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
      if konuk-kayit-durumu = "Y"
        move xkonuk-gel-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xkonuk-git-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        if xkonuk-git-tar < xkonuk-gel-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 

        if xkonuk-gel-tar <> tarih-tasi

           move "Hata Yeri : [ Giris Tarihi Uyumsuz ...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
      end-if
        if xkonuk-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if                 
******************************************************************************************************** ilgaz icin yapildi 02.11.2017 firat
*        if genel-kaynak3-zorunlu = 3 and ( isyeri-adres-tasi = "ilgaz017" or isyeri-adres-tasi = "ilgazz17" )
*              stop " "
*           if xkonuk-kaynak-3 = spaces or xkonuk-kaynak-3 = zero
*              move "Hata Yeri : [ Kaynak 3 Tanimsiz...................]" to mmesaj-2
*              move 1           to mmesaj-type
*              move 3           to mmesaj-icon
*              move 1           to mmesaj-default
*              perform mmesaj-ver
*              go kaydet-exit
*           end-if
*        end-if                 
************************************************************************************************************
        if  cin-tipi not = 3 and 
            odalar-durumu not = house-bt and 
            konuk-kayit-durumu = "Y" and
            k-kirli-odaya-cin-yapamaz = 1  
             display message box "Kirli Odaya C/IN Yapamazsiniz !"new-line
                                 "Bu Islem Icin Yetkiniz Yoktur"
             icon 3
             title "[ Oda Durum Kirli ]"
             go kaydet-exit
        end-if

        open input konum
        move xkonuk-oda-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Oda Konumu Tanimsiz.................]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid continue
             end-read
             close konum

           initialize onay-uygulandi-yaz
            
           if GENEL-devremulk = 1
               perform devremulk-guncel-borc-sorgula
               move link-devremulk-no to z-uye-no
               
                   if  link-guncel-borc >= 1 then
                           initialize uyari-mesaj
                           move link-devremulk-no to z-uye-no
                           move link-guncel-borc to z-borc
                           string "Rezervasyon Sahibinin Devremulk Sozlesmesine Ait " delimited by size
                           z-borc delimited by size
                           " TL GUNCEL Borcu Bulunmaktadir ! , Devam Etmek Istiyormusunuz ?" delimited by size
                           "  -------- Devremulk Uye No : " delimited by size
                           z-uye-no delimited by size
                           into uyari-mesaj
                           display message box uyari-mesaj
                           icon 3
                           type 2
                           default 2
                           returning return-code 
                           if return-code not = 1 then
                                go kaydet-exit
                                else
                                if genel-onay = 1 and  konuk-kayit-durumu = "Y"
                                          perform onay-takip
                                          if not  onay-verildi 
                                            go kaydet-exit
                                              else
                                            move 1 to onay-uygulandi-yaz
                                          end-if
                                end-if

                           end-if
                           
                   end-if
                   if  link-aidat-borc-tl >= 1 then
                           initialize uyari-mesaj
                           move link-devremulk-no to z-uye-no
                           move link-aidat-borc-tl to z-borc
                           string "Rezervasyon Sahibinin Devremulk Sozlesmesine Ait " delimited by size
                           z-borc delimited by size
                           " TL AIDAT Borcu Bulunmaktadir ! , Devam Etmek Istiyormusunuz ?" delimited by size
                           "  -------- Devremulk Uye No : " delimited by size






                           z-uye-no delimited by size
                           into uyari-mesaj
                           display message box uyari-mesaj
                           icon 3
                           type 2
                           default 2

                           returning return-code 
                           if return-code not = 1 then
                                go kaydet-exit
                                 else
                                 if genel-onay = 1 and  konuk-kayit-durumu = "Y"
                                          perform onay-takip
                                          if not  onay-verildi 
                                            go kaydet-exit
                                            else
                                            move 1 to onay-uygulandi-yaz
                                          end-if
                                end-if
                           end-if
                   end-if
        end-if 


        if xkonuk-s-d-t-g   not = 1 and not = 2 and not = 3 and not = 4 
           evaluate true      
              when xkonuk-buyuk < 2 move "1" to xkonuk-s-d-t-g 
              when xkonuk-buyuk = 2 move "2" to xkonuk-s-d-t-g 
              when xkonuk-buyuk = 3 move "3" to xkonuk-s-d-t-g 
              when xkonuk-buyuk > 3 move "4" to xkonuk-s-d-t-g
            end-evaluate
        end-if 
        
       
          if oto-gec not = 1 then 
        if birles-vis = 1 and birles-oda = spaces then 
          display message box "Birlesen Hayali odalarda Gercek Oda Foliosunu Belirtmeniz Onerilir"
           title "DIKKAT" icon 1
        end-if
        end-if
*        if xkonuk-buyuk  <  1 
*           move "Hata Yeri : [ Buyuk Sayisi [0] Olamaz.............]" to mmesaj-2
*           move 1           to mmesaj-type
*           move 3           to mmesaj-icon
*           move 1           to mmesaj-default
*           perform mmesaj-ver
*           go kaydet-exit
*        end-if 
       if oto-gec = 1
          move 1 to donus-kodu 
       else
          initialize mesaj-degiskenler
          move " [ Kaydet Soru ] " to mmesaj-title
          move " GIRDIGINIZ BILGILER KAYDEDILECEKTIR " to mmesaj-1
          move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2
          move 2           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
       end-if
       if genel-konum-upgrade-devrede = 1 and xkonuk-fol-kodu = "R" 
          if eski-oda-konum not = spaces  and  eski-oda-konum <> odalar-konumu
             move eski-oda-konum to  l-eski-konum    
             move odalar-konumu to l-yeni-konum     
             move xrez-no      to  l-rezno          
             move xrez-rec      to  l-rez-rec     
             move 0 to  l-yapabilir     
             call "/asya/ytl/obj/otel/blokupg.asy" using  l-eski-konum  l-yeni-konum l-rezno l-rez-rec  l-yapabilir      
                  on exception perform callerr-proc
             not on exception
                 cancel "/asya/ytl/obj/otel/blokupg.asy" 
             end-call
*               display message box  "l-eski-konum    :" l-eski-konum    new-line
*                                    "l-yeni-konum    :" l-yeni-konum     new-line
*                                    "l-rezno         :" l-rezno          new-line
*                                    "l-rez-rec(1:200):" l-rez-rec(1:200)  new-line
*                                    "l-yapabilir     :" l-yapabilir        new-line
*                                    "k-kodu-tasi     :" k-kodu-tasi        new-line
             if l-yapabilir = 0 then 
                display message box "Oda Upgrade yetkiniz olmamasina ragmen oda upgrade ettiniz" new-line
                                    "CIN islemi Gerceklesmedi" title "KAYIT EDILMEDI .. YETKISIZ KULLANICI"
                go kaydet-exit
             end-if
          end-if
       end-if
       if donus-kodu = 2 
          go kaydet-exit
       end-if
        if ( xkonuk-buyuk not = konuk-buyuk or
             xkonuk-kucuk not = konuk-kucuk or 
             xkonuk-free  not = konuk-free  or
             xkonuk-bebek not = konuk-bebek ) and
           ( xkonuk-gel-tar < tarih-tasi )  then 
             move xkonuk-gel-gun to egun
             move xkonuk-gel-ay  to eay
             move xkonuk-gel-yil to eyil
*                  display message box
*                  
*                  " DIKKAT  " new-line
*                  etarih
*                  "  tarihinde C/In olmus odanin" new-line
*                  " kisi sayisini degistirdiniz " new-line
*                  " Gecmise dogru istatistikler otomatik " new-line
*                  " olarak degistirelecektir .. "         new-line
*                  " Devam etmek istemisiniz  ...E->Evet, H->Hayir  "new-line
*                   type 2, icon 1 , default 2,  
*                   title " [ Kaydet Soru ] " 
*                   giving donus-kodu
*                  
*                  if donus-kodu = 2 
*                    go kaydet-exit
*                  end-if
                    
                   open i-o nt
   
                    initialize not-rec
                    move "kll"    to NOT-DOS
                    move "kredi-ist1  "  to not-dos-anah
              
                    move tarih-tasi  to NOT-DOS-ANAH (15:)
                    move 01 to not-sira
                    perform until fs-not = "10" or not-sira > 90 
                    read nt no lock 
                       invalid
                         add 1 to not-sira
                       not invalid 
                         move "10" to fs-not
                    end-read
                    end-perform 
                    string   etarih delimited by "hhjhjjh"
                             " girisli "   delimited by "hhjhjjh"
                             konuk-folio(3:)  delimited by "hhjhjjh"
                             " nolu "      delimited by "hhjhjjh"
                             konuk-adi   delimited by " "
                             " " delimited by "c" 
                             konuk-soyadi  delimited by "     "
                             " foliosunda "   delimited by "hhjhjjh"
                             k-kodu-tasi        delimited by "hhjhjjh"

                             " tarafindan kisi sayisi degistirildi" delimited by "hhjhjjh"
                             into not1

                             write not-rec invalid continue end-write
                             add 1 to not-sira
                        display message box not1  new-line 
                                       " mesaji Gelir kontrol LOG a kaydedildi." 
                        initialize not1
                      string    etarih   delimited by "hhjhjjh"
                             " tarihine kadar kisi istatistikleri otomatik olarak degistirildi Kontrol ediniz" 
                             delimited by "hhjhjjh"
                             into not1
                       write not-rec invalid continue end-write
                      close nt    
                end-if 
       .
 kaydet-rez-kontrol. 
**********>Rezervasyonlu Check-In degilse rez dosyasiyla isi yoktur...
       if cin-tipi not = 1 
          go kaydet-rez-kontrol-exit
       end-if. 
**********>Ayni anda bir rezervasyon iki kisi tarafindan C-In Yapilamasin 
       if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R" 
          continue
       else 
          go kaydet-rez-kontrol-exit
       end-if. 
       move xkonuk-rez-no   to rez-no. 
       read rez no lock invalid 
            go kaydet-rez-kontrol-exit. 
       if rez-c-in = "E" 
          move "Hata Yeri : [ Bu Oda C-In Yapilmis................]" to mmesaj-2
          move 1           to mmesaj-type
          move 3           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          go kaydet-exit
       end-if 
       .
 kaydet-rez-kontrol-exit. 
    if konuk-kayit-durumu not = "E" 
       accept sys-zaman from time 
       move sys-saat               to xkonuk-gel-saat 
       move sys-dakika             to xkonuk-gel-dakika 
       move sys-saniye             to xkonuk-gel-saniye
       move k-kodu-tasi to xkonuk-cin-staf
    end-if   . 
    initialize konuk-rec. 
    initialize ozluk-rec . 
         
    if konuk-kayit-durumu not = "E" 
       move "I"                    to xkonuk-durumu 
    end-if.

    if konuk-kayit-durumu not = "E" and cin-tipi not = 3
       move "R"                    to xkonuk-fol-kodu
    end-if. 

    move k-kodu-tasi   to xkonuk-staf.
    if bagli-vis = 1 then

    move bagli-rez to xkonuk-extra-rez-no
    end-if
    move xkonuk-rec    to konuk-rec.
    
     if konuk-kayit-durumu = "Y" 
             move mis-no         to konuk-profil-no
             move rez-kredi-kart to konuk-kredi-kart
             write konuk-rec invalid go kaydet-exit 
                             not invalid 
                      perform log-operation-konuk
               if onay-uygulandi-yaz = 1 
               open i-o onay
                   set onay-uygulandi to true
                    move k-kodu-tasi to ONAY-uyg-STAF
                                                accept ONAY-uyg-TARIH from century-date 
                                                accept ONAY-uyg-zaman  from time
                   rewrite  onay-rec invalid write onay-rec end-rewrite
                 close onay
                 initialize onay-uygulandi-yaz
              end-if    
            if genel-web-stil not = "D"
               if konuk-fol-kodu = "R" and konuk-gel-tar = konuk-git-tar then 
                  perform  Form1-Pb-8-Link
               end-if
             end-if

            if cinpara-ext-fol-ac not = "E" 
                  
                   if cinpara-kartsiz-pos = 1 then 
                            move konuk-folio(2:) to REZ-EXTRA-KART
                            perform extra-kart-tanimla
                   else
                      if rez-extra-kart not = spaces
                         perform extra-kart-tanimla
                      end-if
                      if rez-extra-kart2 not = spaces
                          perform extra-kart-tanimla2
                      end-if
                   end-if
   
            end-if
              
                    
             if xkonuk-fol-kodu = "R"
                 if  TELPARA-dishat-ac-kapa = 1 then 
                    perform hat-ac
                 end-if
                perform odalar-isle   thru odalar-isle-exit 
              end-if
             if oto-gec not = 1
               display message box "C/In islemi Basariyla Tamamlandi..."
                                 title "[ Uyari ]"
                                 icon 1
             end-if 
     end-if.
       

          if konuk-kayit-durumu = "E" 
*             move mis-no        to konuk-profil-no
             rewrite konuk-rec invalid go kaydet-exit
                               not invalid  
                     perform log-operation-konuk  
                  
*                 display message box "Duzeltme islemi Basariyla Tamamlandi..."
*                                 title "[ Uyari ]"
*                                 icon 1

             
          end-if.    

          if genel-plaka not = 1
              move plaka to xozluk-plaka
              else
                open i-o plaka
                initialize plaka-rec
                  move xkonuk-folio  to PLAKA-FOLIO   
                 move 1 to plaka-sira move plaka to plaka-text perform plaka-yaz 
                 move 2 to plaka-sira move plaka2 to plaka-text perform plaka-yaz 
                 move 3 to plaka-sira move plaka3 to plaka-text perform plaka-yaz 
                 move 4 to plaka-sira move plaka4 to plaka-text perform plaka-yaz 
                close plaka


            end-if
         
        
              perform ozluk-isle   thru ozluk-isle-exit. 
           
***********>Rezervasyonlu check-in ise rezervasyon ve casti duzelt...
            if ( xkonuk-fol-kodu = "R" or xkonuk-fol-kodu = "G" )
               and cin-tipi = 1
                   perform rez-isle     thru rez-isle-exit 
                   perform cast-isle    thru cast-isle-exit 
                   perform takvim-isle  thru takvim-isle-exit
            end-if. 
***********>Register Kartta Rezervasyonu Etkileyen Degisiklikleri Olursa Duzeltsin
            if konuk-kayit-durumu = "E" and xkonuk-fol-kodu = "R" 
                   perform rez-isle     thru rez-isle-exit 
                   perform cast-isle    thru cast-isle-exit 
                   perform takvim-isle  thru takvim-isle-exit
            end-if. 
***********>Walk-in check-in ise rezervasyon ve cast olusturuluyor...
            if konuk-kayit-durumu = "Y" and 
               xkonuk-fol-kodu = "R"  and cin-tipi = 2   
                  
               perform rez-olustur     thru rez-olustur-exit 
               perform cast-olustur    thru cast-olustur-exit 
               perform takvim-olustur  thru takvim-olustur-exit
*/*/*/RAMAZAN ANKARA ALBA OTEL ICIN KOYULDU
               perform hes-gonder
               move xkonuk-rec  to konuk-rec
               rewrite konuk-rec end-rewrite 
               perform log-operation-konuk
*/*/*/RAMAZAN ANKARA ALBA OTEL ICIN KOYULDU
            end-if. 
***********>..........
***********>Otomatik slip versin..
            if konuk-rez-no > 0 
              then 
              
             if oto-gec not = 1  
              
              perform yanrez-kaydet
             end-if
           end-if 
            if konuk-kayit-durumu = "Y" and 
               xkonuk-fol-kodu = "R" or xkonuk-fol-kodu = "G" 
               perform oto-slip     thru oto-slip-exit
            end-if. 
***********>.....
***********>Otomatik register karti  versin..
          if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R" 
             if cinpara-reg-varmi = "E" OR cinpara-reg-varmi = "e" 
                perform regist-ver 
             end-if, 
             END-if
***********>.....
       
          if rez-sharenum > 0 then 
                  perform share-koy-kont
           end-if .
*********[]  EXTRA-TEL-AC = "B" 
          if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R" 
          
          move konuk-pan-tipi to tampon-pan-tipi
          if genel-eski-on-odeme-devrede  = 1
             if  rez-on-odeme > 0 
                  perform on-odeme-isle |eski on odeme sekli
             end-if
          end-if 
             if rez-onodeme-var = 1
                 perform on-odeme-yaz |yeni on odeme sekli
             end-if 
             perform extra-ac  thru extra-ac-exit
             perform tel-ac  thru tel-ac-exit
          end-if.
          if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R"  and konuk-grup-no > 0 
              open i-o gruplar
            
                        move xkonuk-grup-no to gruplar-kodu
                        read gruplar no lock invalid continue
                        not invalid 
                        if gruplar-kur = 0 and 
                           gruplar-doviz = xkonuk-doviz and 
                           gruplar-skur = 1  then 
                             move xkonuk-kur-degeri to gruplar-kur
                             rewrite gruplar-rec invalid continue end-rewrite
                         end-if
                        end-read
                        close gruplar

          end-if
          if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R"   and genel-oto-kapi = 1 
***            perform kapi-karti-gonder
            continue | kirman için kaldýrýldý.Ramazan
          end-if
      

          if konuk-fol-kodu = "R" and genel2-kvkk-sorgu = 1 
             perform kvkk-belge-kayit
          end-if
          
          if link-var = 2 then 
              move 99999999 to link-fol-no
              set exit-pushed to true
              go kaydet-exit
          end-if.
           perform ekran-sifirla.
          if cin-tipi = 1
             move 4    to accept-control
             move 1002 to control-id
          else
             move 4    to accept-control
             move 1003 to control-id
          end-if.

       go kaydet-exit. 
 ozluk-isle. 
            
            initialize ozluk-rec. 
          move xozluk-folio to ozluk-folio. 
          read ozluk no lock invalid 
                             move "Y" to ozluk-kayit-durumu 
         not invalid 
                             move "E" to ozluk-kayit-durumu. 
          move xkonuk-folio        to xozluk-folio. 
          move xkonuk-durumu       to xozluk-durumu. 
          move xkonuk-adi          to xozluk-adi. 
          move xkonuk-soyadi       to xozluk-soyadi.
          move kim-tipi-combo-value to xozluk-kim-turu
          move k-kodu-tasi         to xozluk-staf. 
          move xozluk-rec          to ozluk-rec. 
          if ozluk-kayit-durumu = "Y"
              
             write ozluk-rec invalid
               rewrite ozluk-rec 
               
            end-write      
                   perform log-operation-ozluk
          end-if.
          if ozluk-kayit-durumu = "E" 
              
             rewrite ozluk-rec invalid 
               write ozluk-rec 
            end-write 
                   perform log-operation-ozluk
          end-if.

          write ozluk2-rec  invalid 
                rewrite ozluk2-rec 
                end-rewrite
          end-write.
               perform log-operation-ozluk2.
 ozluk-isle-exit. 
    exit. 
*********>Rezervasyonlu Check-in'de rezervasyonu duzelt
*
 fiyat-after.
       move fiyat-konumu-combo-value(1:2) to xkonuk-fiyat-konumu
      .
* 
 rez-isle.
        
       initialize bilbord-duzelt
       move xkonuk-rez-no       to rez-no. 
       read rez no lock invalid 
            go rez-isle-exit.
       if rez-bilbord-eh = " " then 
           move "H" to rez-bilbord-eh 
       end-if
       if xkonuk-bilbord-eh = " " then
          move "H" to xkonuk-bilbord-eh
       end-if
       if xkonuk-bilbord-eh not = rez-bilbord-eh then 
          move 1 to bilbord-duzelt
          if rez-bilbord-eh = "E" then
             perform bilbord-dus
          end-if
       end-if
       move xkonuk-bilbord-eh to rez-bilbord-eh
       move xkonuk-dv-degeri    to rez-fiyati.
       move xkonuk-folio        to rez-folio. 
       move xkonuk-odano        to rez-odano. 
       move "E"                 to rez-c-in. 
       move xkonuk-adi          to rez-adi.
       move xkonuk-paylas-oda   to rez-paylas-oda
       move xkonuk-rehber       to rez-rehber
       move xkonuk-soyadi       to rez-soyadi. 
       move xkonuk-s-d-t-g      to rez-s-d-t-g.
       move xkonuk-oda-konumu   to rez-oda-konumu. 
       move xkonuk-fiyat-konumu to rez-fiyat-konumu. 
       move xkonuk-odeme-tipi   to rez-odeme-tipi. 
       move xkonuk-odano        to rez-odano. 
       move xkonuk-ulke         to rez-ulke. 
       move xkonuk-buyuk        to rez-buyuk. 
       move xkonuk-kucuk        to rez-kucuk. 
       move xkonuk-free         to rez-free. 
       move xkonuk-bebek        to rez-bebek.
       move xkonuk-rez-tipi     to rez-tipi
       move xkonuk-share        to rez-share.           
       move xkonuk-aksiyon-eh   to rez-aksiyon-eh.
       move xkonuk-acenta       to rez-acenta. 
       move xkonuk-grup-no      to rez-grup-no.
       move xkonuk-gel-saat     to rez-gel-saat.
       move 2000 to rez-al-yil
       move xkonuk-al-tar       to rez-al-tar(3:).
       move xkonuk-gel-dakika   to rez-gel-dak.
       move xkonuk-git-saat     to rez-git-saat.
       move xkonuk-git-dakika   to rez-git-dak.
       move xkonuk-fiyat-konumu to rez-fiyat-konumu
       move xkonuk-voucher      to rez-voucher. 
       move xkonuk-nor-indirim  to rez-nor-indirim. 
       move xkonuk-pan-tipi     to rez-pan-tipi. 
       move xkonuk-banka        to rez-banka. 
       move xkonuk-doviz        to rez-doviz.
       move xkonuk-gel-tar      to rez-gir-tar
       move xkonuk-git-tar      to rez-cik-tar
       move xkonuk-pazar        to rez-pazar.
       move xkonuk-eb           to rez-eb
       move xkonuk-ug-indirimi  to rez-ug-ind
       move xkonuk-anlasma      to rez-anlasma.
       move xkonuk-gec-giris            to rez-gec
       
       if xkonuk-acik-kapali = "C"
          move 1 to rez-no-post
          else
          move 0 to rez-no-post
       end-if
       move xkonuk-plan         to rez-plan.
       move xkonuk-dig-plan     to rez-dig-plan.
       move xkonuk-al-tar       to rez-al-tar(3:)
       move xkonuk-OPERATOR     to rez-OPERATOR.
       move  yREZ-OZEL-DURUM-CAR   to REZ-OZEL-DURUM-CAR 
       move  yREZ-OZEL-DURUM       to  REZ-OZEL-DURUM     
       move  yREZ-ozel-tip         to  REZ-ozel-tip 
         move yrez-git-sirket to  rez-git-sirket
         move yrez-gel-sirket to  rez-gel-sirket
       move xkonuk-firma        to rez-firma
       move xkonuk-kur-aygun    to rez-kur-aygun. 
       move xkonuk-vip          to rez-vip. 
       move xkonuk-acik-1       to rez-not1. 
       move xkonuk-acik-2       to rez-not2.
       move xkonuk-fiyat-fix    to rez-fiyat-fix.
       move xkonuk-fix-anl      to rez-fix-anl.
       move xkonuk-special-eh   to rez-special-eh
       move xkonuk-paylas-oda   to rez-paylas-oda
       move xozluk-adres1       to rez-adres1.
       move xozluk-adres2       to rez-adres2.
       move xozluk-e-mail       to rez-e-mail.
*       move xkonuk-profil-no    to rez-profil-no
       move xkonuk-kaynak-1      to rez-kaynak-1
       move xkonuk-kaynak-2      to rez-kaynak-2
       move xkonuk-kaynak-3      to rez-kaynak-3
       move xkonuk-telefon-no   to rez-telefon-no
       move xkonuk-sehir        to rez-sehir 

       move xkonuk-late-zaman         to rez-late-zaman.
       if rez-bilbord-eh = "E" and bilbord-duzelt = 1  then
             perform bilbord-ekle
       end-if

       if pre-cin-ok = 1
          move 1                 to rez-pre-cin
       end-if
        
       accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
       accept rez-edit-zaman from time          |                           
       
       rewrite rez-rec invalid 
            continue
       end-rewrite.
           perform log-operation-rez
           perform blokaj-degisim-yaz.
 rez-isle-exit. 
    exit. 

 cast-isle. 

 cast-isle-basla.
           
          open i-o cast break. 
         initialize cast-rec.
         open input hesayr
        move calisma-tarihi  to cast-tarih.
        move rez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid 
              go cast-isle-bitti. 
 cast-isle-oku. 
        read cast  next no lock end go cast-isle-bitti. 
        if fs-cast = 99 go cast-isle-oku. 
        if cast-tarih  > xkonuk-git-tar go cast-isle-bitti.
        if cast-rez-no > xkonuk-rez-no 
           go cast-isle-bitti
        end-if. 
        if cast-rez-no = xkonuk-rez-no 
           continue
        else 
           go cast-isle-oku
        end-if. 
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 
 
         
           
           
             initialize      hesaplanan-fiyat eski-cast
           if xkonuk-gel-tar = cast-tarih and xkonuk-gec-giris = 1  and xKONUK-FIYAT-FIX not = "E"  
             initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
           start hesayr key >= hesayr-anah invalid continue
              not invalid
              perform until fs-hesayr = "10"
                  read hesayr previous no lock end move "10" to fs-hesayr
                      not end 
                        if hesayr-rez-no = xkonuk-rez-no and hesayr-tarih <= xkonuk-gel-tar
                          add hesayr-basilacak-tut to hesaplanan-fiyat 
                          else
                          move "10" to fs-hesayr
                        end-if
                  end-read
              end-perform
              else
               initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
               read hesayr no lock invalid continue
                  not invalid
                 move  hesayr-basilacak-tut to hesaplanan-fiyat 
               end-read
           end-if   
           if hesaplanan-fiyat = 0 then 
               move xKONUK-DV-DEGERI to hesaplanan-fiyat
            end-if  
               
                   move cast-rec to eski-cast
          
*******               if xkonuk-gec-giris not = 1 
****                   move hesaplanan-fiyat to cast-fiyati
****                   else
****                   if cast-tarih = tarih-tasi
                   if xkonuk-plan not = 1 
                       move hesaplanan-fiyat to cast-fiyati
                   end-if

*****                   end-if
******                end-if
                  move hesaplanan-fiyat to cast-anlasma-fiyati
            
               if tarih-tasi = cast-tarih
                  if xkonuk-dv-degeri not = hesaplanan-fiyat 
                    display message box " Anlasma Fiyatlarindan Farkli bir Fiyat girdiniz " new-line 
                                        " Sadece Bugun girdiginiz fiyat basilacaktir"  new-line 
                                        " Tum konaklama boyunca bu fiyatin uygulanamsini " new-line 
                                        " isterseniz. Fix fiyat tikini tiklayip HESAP tusuna basiniz" new-line
                                        new-line
                                        " F6 --- Konaklama boyunca uygulanacak fiyatlar " new-line 
                      move xkonuk-dv-degeri to cast-fiyati
                 end-if
              end-if
  
             
                 move xkonuk-anlasma      to cast-anlasma
                
                 if xkonuk-pans-plan not = 1
                     move xkonuk-pan-tipi     to cast-pan-tipi
                  else
                     if cast-pan-tipi   = spaces
                       move xkonuk-pan-tipi     to cast-pan-tipi          
                     end-if 
                  end-if

                  if xkonuk-fkonum-plan not = 1
                     move xkonuk-fiyat-konumu to cast-fiyat-konumu
                  else
                     if cast-fiyat-konumu = zeroes 
                        move xkonuk-fiyat-konumu to cast-fiyat-konumu                        
                     end-if 
                  end-if

                  if xkonuk-oda-plan not = 1
                        move xkonuk-odano        to cast-oda-no
                        move xkonuk-oda-konumu   to cast-oda-konumu
                     
                  else
                     if cast-oda-no = spaces 
                        move xkonuk-odano        to cast-oda-no
                        move xkonuk-oda-konumu   to cast-oda-konumu
                     end-if 
                  end-if
          if xkonuk-kisi-plan not = 1 or  tarih-tasi = cast-tarih 
               
                 move xkonuk-buyuk        to cast-buyuk
                 move xkonuk-kucuk        to cast-kucuk
                 move xkonuk-bebek        to cast-bebek
                 move xkonuk-free         to cast-free
               
                
         end-if
             
             move xkonuk-sharenum to cast-sharenum
               move xkonuk-grup-no      to cast-grup
          if cast-tarih = xkonuk-git-tar
               initialize      cast-fiyati  cast-anlasma-fiyati
           end-if
          
           perform break-mami
          rewrite cast-rec invalid 
                       go cast-isle-oku
                      end-rewrite
               
      if cast-rec not = eski-cast(1:function length(cast-rec)) then 
                perform log-operation-cast
        end-if 

            go cast-isle-oku. 
 cast-isle-bitti. 
             close cast hesayr break. 
 cast-isle-exit. 
     exit. 
 takvim-isle. 
         if srez-buyuk not = xkonuk-buyuk go takvim-isle-basla. 
         if srez-kucuk not = xkonuk-kucuk go takvim-isle-basla. 
         if srez-free  not = xkonuk-free  go takvim-isle-basla. 
         if srez-bebek not = xkonuk-bebek go takvim-isle-basla. 
         if srez-oda-konumu  not = xkonuk-oda-konumu 
            go takvim-isle-basla. 
            go takvim-isle-exit. 
 takvim-isle-basla. 
        open i-o takvim.
        move xkonuk-gel-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-isle-bitti.
 takvim-oku-yaz. 
        read takvim next no lock end 
             go takvim-isle-bitti.
        if fs-takvim = 99 go takvim-oku-yaz. 
        if takvim-anah = xkonuk-git-tar 
           go takvim-isle-bitti
        end-if. 
        if takvim-anah > xkonuk-git-tar 
           go takvim-isle-bitti
        end-if. 
          compute takvim-sat-buyuk(xkonuk-oda-konumu) = 
                  takvim-sat-buyuk(xkonuk-oda-konumu) + 
                  xkonuk-buyuk. 
          compute takvim-sat-buyuk(srez-oda-konumu) = 
                  takvim-sat-buyuk(srez-oda-konumu) - 
                  srez-buyuk. 
          compute takvim-sat-kucuk(xkonuk-oda-konumu) = 
                  takvim-sat-kucuk(xkonuk-oda-konumu) + 
                  xkonuk-kucuk. 
          compute takvim-sat-kucuk(srez-oda-konumu) = 
                  takvim-sat-kucuk(srez-oda-konumu) - 
                  srez-kucuk. 

          compute takvim-sat-free(xkonuk-oda-konumu) = 
                  takvim-sat-free(xkonuk-oda-konumu) + 
                  xkonuk-free. 
          compute takvim-sat-free(xkonuk-oda-konumu) = 
                  takvim-sat-free(xkonuk-oda-konumu) + 
                  xkonuk-bebek.
          compute takvim-sat-free(srez-oda-konumu) = 
                  takvim-sat-free(srez-oda-konumu) - 
                  srez-free. 
          compute takvim-sat-free(srez-oda-konumu) = 
                  takvim-sat-free(srez-oda-konumu) - 
                  srez-bebek.
        rewrite takvim-rec invalid go takvim-oku-yaz. 
            go takvim-oku-yaz. 
 takvim-isle-bitti.
        close takvim.
 takvim-isle-exit.
      
      exit. 
************>Walk-in Check-in'de rezervasyon ve cast olusturuluyor.....
*
 rez-olustur. 
 oto-fis-al. 
    initialize rez-fisi. 
    open i-o genelfis. 
    move 1 to genelfis-anahtar. 
    read genelfis no lock invalid 
         initialize genelfis-rec 
         move 1 to genelfis-anahtar
         not invalid continue
    end-read. 
    add 1 to rez-oto. 
    move rez-oto to rez-fisi. 
    rewrite genelfis-rec invalid
            write genelfis-rec invalid continue
            end-write 
    end-rewrite. 
    close genelfis. 
 oto-fis-al-exit. 
    exit. 
 rez-olustur-basla. 
        
            initialize rez-rec. 
            move rez-fisi   to rez-no. 
            read rez no lock invalid initialize rez-rec 
                             move rez-fisi   to rez-no 
                         not invalid go oto-fis-al
            end-read. 
          move 6                    to rez-tipi. 
          move "I"                  to rez-durumu. 
          move xkonuk-acenta        to rez-acen-anah.
          move xkonuk-firma         to rez-firma
          move xkonuk-gel-tar       to rez-gir-tar. 
          move xkonuk-git-tar       to rez-cik-tar.
          move xkonuk-al-tar        to rez-al-tar(3:).
          move xkonuk-adi           to rez-adi. 
          move xkonuk-paylas-oda    to rez-paylas-oda
          move xkonuk-soyadi        to rez-soyadi.
          move xkonuk-al-tar        to rez-al-tar(3:).
          move xkonuk-banka         to rez-banka. 
          move xkonuk-doviz         to rez-doviz. 
          move xkonuk-odeme-tipi    to rez-odeme-tipi. 
          move xkonuk-pan-tipi      to rez-pan-tipi. 
          move xkonuk-ulke          to rez-ulke. 
          move xkonuk-voucher       to rez-voucher. 
          move xkonuk-kur-aygun     to rez-kur-aygun. 
          move "K"                  to rez-k-g-b. 
          move xkonuk-vip           to rez-vip. 
          move xkonuk-share         to rez-share. 

          move xkonuk-nor-indirim   to rez-nor-indirim. 
          move "E"                  to rez-c-in. 
          move xkonuk-folio         to rez-folio. 
          move xkonuk-odano         to rez-odano. 
          move xkonuk-s-d-t-g       to rez-s-d-t-g. 
          move xkonuk-oda-konumu    to rez-oda-konumu 
          move xkonuk-fiyat-konumu  to rez-fiyat-konumu 
          move xkonuk-buyuk         to rez-buyuk. 
          move xkonuk-kucuk         to rez-kucuk. 
          move xkonuk-free          to rez-free. 
          move xkonuk-bebek         to rez-bebek.
          move xkonuk-bilbord-eh    to rez-bilbord-eh. 
          move xkonuk-dv-degeri     to rez-fiyati. 
 
          move calisma-tarihi       to rez-isl-tar rez-ops-tar. 
          move xkonuk-gel-saat      to rez-gel-saat. 
          move xkonuk-gel-dakika    to rez-gel-dak.
          move xkonuk-git-saat      to rez-git-saat. 
          move xkonuk-git-dakika    to rez-git-dak.

          move xkonuk-grup-no       to rez-grup-no. 
          move xkonuk-fiyat-fix     to rez-fiyat-fix.
          move xkonuk-fix-anl      to rez-fix-anl.
          move xkonuk-special-eh     to rez-special-eh
          move xkonuk-paylas-oda   to rez-paylas-oda
          move xozluk-adres1        to rez-adres1. 
          move xozluk-adres2        to rez-adres2. 




          move xozluk-e-mail        to rez-e-mail. 
*          move xozluk-telno         to rez-telno.
          move xkonuk-acik-1        to rez-not1. 
          move xkonuk-acik-2        to rez-not2. 
          move k-kodu-tasi          to rez-staf. 
          move xkonuk-anlasma       to rez-anlasma.
          move xkonuk-plan          to rez-plan.
          move xkonuk-dig-plan      to rez-dig-plan
          move xkonuk-gec-giris     to rez-gec
          move xkonuk-sehir         to rez-sehir
          if xkonuk-acik-kapali = "C"
              move 1 to rez-no-post
          else
             move 0 to rez-no-post
         end-if
          move 2000 to rez-al-yil
          move xkonuk-al-tar to rez-al-tar(3:)
          MOVE XKONUK-OPERATOR      TO REZ-OPERATOR.
          move xkonuk-pazar         to rez-pazar. 
          move xkonuk-share         to rez-share
          move xkonuk-late-zaman    to rez-late-zaman
*          move xkonuk-profil-no     to rez-profil-no
          move xkonuk-firma         to rez-firma
          move xkonuk-telefon-no   to rez-telefon-no

           
          accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
          accept rez-edit-zaman from time          |                           
          
         write rez-rec invalid go rez-olustur-bitti
                       not invalid
               perform log-operation-rez
         end-write.
         move xkonuk-folio   to konuk-folio. 
         read konuk no lock invalid go rez-olustur-bitti. 
         move rez-no    to konuk-rez-no xkonuk-rez-no. 
         rewrite konuk-rec invalid continue
         end-rewrite.
             perform log-operation-konuk
             perform blokaj-degisim-yaz.
 rez-olustur-bitti. 
 rez-olustur-exit. 
    exit. 
 cast-olustur. 
           open i-o cast break. 
           open input takvim.
        move xkonuk-gel-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go cast-olustur-bitti. 
 cast-olustur-oku. 
        read takvim next no lock end go cast-olustur-bitti. 
        if fs-takvim = 99 go cast-olustur-oku. 
        if takvim-anah > xkonuk-git-tar 
           go cast-olustur-bitti
        end-if. 
                initialize cast-rec. 
           move takvim-anah         to cast-tarih. 
           move xkonuk-rez-no       to cast-rez-no. 
 
           move xkonuk-odano        to cast-oda-no. 
           move xkonuk-buyuk        to cast-buyuk
           move xkonuk-kucuk        to cast-kucuk
           move xkonuk-bebek        to cast-bebek
           move xkonuk-free         to cast-free 
           if cast-tarih < xkonuk-git-tar
              move xkonuk-dv-degeri    to cast-fiyati
           end-if
           move xkonuk-oda-konumu   to cast-oda-konumu
           move xkonuk-fiyat-konumu to cast-fiyat-konumu
           move xkonuk-anlasma      to cast-anlasma
           move xkonuk-pan-tipi     to cast-pan-tipi
           move xkonuk-sharenum     to cast-sharenum
             move xkonuk-grup-no      to cast-grup
           perform break-mami
       write cast-rec invalid 
              rewrite cast-rec invalid continue
              end-rewrite 
        end-write. 
           perform log-operation-cast
            go cast-olustur-oku. 
 cast-olustur-bitti. 
      close cast break takvim. 
 cast-olustur-exit. 
      exit. 
 takvim-olustur. 
        open i-o takvim.
        move xkonuk-gel-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-olustur-bitti.
 takvim-olustur-oku. 
        read takvim next no lock end 
             go takvim-olustur-bitti.
        if fs-takvim = 99 go takvim-olustur-oku. 
        if takvim-anah = xkonuk-git-tar 
           go takvim-olustur-bitti
        end-if. 
        if takvim-anah > xkonuk-git-tar 
           go takvim-olustur-bitti
        end-if. 
 
      compute takvim-sat-oda(xkonuk-oda-konumu)   = 
              takvim-sat-oda(xkonuk-oda-konumu)   + 1. 
      compute takvim-sat-buyuk(xkonuk-oda-konumu) = 
              takvim-sat-buyuk(xkonuk-oda-konumu) + xkonuk-buyuk. 
      compute takvim-sat-kucuk(xkonuk-oda-konumu) = 
              takvim-sat-kucuk(xkonuk-oda-konumu) + xkonuk-kucuk. 
      compute takvim-sat-free(xkonuk-oda-konumu)  = 
              takvim-sat-free(xkonuk-oda-konumu)  + xkonuk-free. 
      compute takvim-sat-free(xkonuk-oda-konumu)  = 
              takvim-sat-free(xkonuk-oda-konumu)  + xkonuk-bebek.
       rewrite takvim-rec invalid go takvim-olustur-oku. 
          go takvim-olustur-oku. 
 takvim-olustur-bitti.
      close takvim.
 takvim-olustur-exit. 
      exit. 
************>Walk-in Check-in'de rezervasyon ve cast olusturuluyor.....
*
 odalar-isle. 
             open i-o odalar. 
             move xkonuk-odano  to odalar-no. 
             read odalar no lock invalid close odalar go odalar-isle-exit. 
*        Clup ersan da cin yapilmis odalar yenide listede ikmasin diye huose-durumu eklendi MUHAMMED
             move cinpara-cin-house   to odalar-durumu house-durumu.  

             rewrite odalar-rec invalid continue 
             end-rewrite. 
                     perform log-operation-odalar.
             close odalar. 
 odalar-isle-exit. 
       exit. 
 extra-ac. 
        if cinpara-ext-fol-ac = "E" 
           continue
        else 
           go extra-ac-exit
        end-if. 
 extra-kacdefa. 
        perform extra-fol-ac thru extra-fol-ac-exit 
                cinpara-ext-fol-adet times. 
        go extra-ac-exit. 
 extra-fol-ac. 
 extra-fol-no. 
    initialize gecici-fol-no. 
    open i-o genelfis. 
    move 1 to genelfis-anahtar. 
    read genelfis no lock invalid 
         initialize genelfis-rec 
         move 1 to genelfis-anahtar
         not invalid continue
    end-read. 
    add 1 to folio-oto. 
    move folio-oto to gecici-fol-no. 
    rewrite genelfis-rec invalid write genelfis-rec. 
    close genelfis. 
          move gecici-fol-no to konuk-folio. 
          read konuk no lock invalid continue, 
                         not invalid go extra-fol-no. 
          move gecici-fol-no to ozluk-folio. 
          read ozluk no lock invalid continue, 
                         not invalid go extra-fol-no. 
 extra-fol-no-bitti. 
          initialize konuk-rec ozluk-rec. 
          move xkonuk-rec    to konuk-rec. 
          
          move xozluk-rec    to ozluk-rec.
 
          move gecici-fol-no to konuk-folio ozluk-folio ozluk2-folio. 
         open input banka. 
    move cinpara-ext-fol-banka to banka-kodu. 
    read banka  no lock invalid continue, 
                    not invalid move cinpara-ext-fol-banka  to konuk-banka. 
         close      banka. 
         open input doviz. 
    move cinpara-ext-fol-doviz  to doviz-kodu. 
    read doviz  no lock invalid continue, 
                    not invalid move cinpara-ext-fol-doviz  to konuk-doviz. 
         close      doviz. 
         open input kodlar02. 
    move "A"           to kodlar02-tipi. 
    move    tampon-pan-tipi to kodlar02-kodu    
         read kodlar02  no lock invalid continue, 
                     not invalid 
                     move    tampon-pan-tipi to konuk-pan-tipi
        end-read                    
                    
*    move cinpara-ext-fol-pan to konuk-pan-tipi.
*    move cinpara-ext-fol-pan to kodlar02-kodu. 
*    read kodlar02  no lock invalid continue, 
*                    not invalid move cinpara-ext-fol-pan to konuk-pan-tipi. 
    move "B"             to kodlar02-tipi. 
    move cinpara-ext-fol-ode  to kodlar02-kodu. 
    read kodlar02  no lock invalid continue, 
                    not invalid move cinpara-ext-fol-ode to konuk-odeme-tipi. 
         close      kodlar02. 
         open input ulke. 
    move cinpara-ext-fol-ulke    to ulke-anah1. 
    read ulke      no lock invalid continue, 
                    not invalid move cinpara-ext-fol-ulke to konuk-ulke. 
         close      ulke. 
          move rez-no to konuk-extra-rez-no 

          move "I"  to  konuk-durumu. 
          move "E"  to konuk-fol-kodu. 
          move xkonuk-adi           to konuk-adi(04:17). 
          move "E=>"                to konuk-adi(01:03). 
***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar  konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno konuk-firma. 
          move "I"  to  ozluk-durumu. 
          move xkonuk-adi           to ozluk-adi(04:17). 
          move "E=>"                to ozluk-adi(01:03). 
          write konuk-rec invalid continue
          end-write.
                perform log-operation-konuk.
           
          write ozluk-rec invalid continue
          end-write.
                perform log-operation-ozluk. 
          write ozluk2-rec invalid continue
          end-write.
*          if rez-extra-kart not = spaces
*            perform extra-kart-tanimla
*            else
 
 
                   if cinpara-kartsiz-pos = 1 then 
                            move konuk-folio(2:) to REZ-EXTRA-KART
                            perform extra-kart-tanimla
                   else
                        if rez-extra-kart not = spaces
                         perform extra-kart-tanimla
                        end-if
                         if rez-extra-kart2 not = spaces
                          perform extra-kart-tanimla2
                        end-if
                    end-if
                     
          


          
*          end-if
*          if rez-extra-kart2 not = spaces
*            perform extra-kart-tanimla2
*          end-if.
            .    
 extra-fol-ac-exit. 
      exit. 
 extra-ac-exit. 
    exit. 
 tel-ac. 
        if cinpara-tel-fol-ac = "E" 
           continue
        else 
           go tel-ac-exit
        end-if. 
 tel-kacdefa. 
        perform tel-fol-ac thru tel-fol-ac-exit 
                cinpara-tel-fol-adet times. 
        go tel-ac-exit. 
 tel-fol-ac. 
 tel-fol-no. 
    initialize gecici-fol-no. 
    open i-o genelfis. 
    move 1 to genelfis-anahtar. 
    read genelfis no lock invalid 
         initialize genelfis-rec 
         move 1 to genelfis-anahtar
         not invalid continue
    end-read. 
    add 1 to folio-oto. 
    move folio-oto to gecici-fol-no. 
    rewrite genelfis-rec invalid write genelfis-rec. 
    close genelfis. 
          move gecici-fol-no to konuk-folio. 
          read konuk no lock invalid continue, 
                         not invalid go tel-fol-no. 
          move gecici-fol-no to ozluk-folio. 
          read ozluk no lock invalid continue, 
                         not invalid go tel-fol-no. 
 tel-fol-no-bitti. 
          initialize konuk-rec ozluk-rec. 
          move xkonuk-rec    to konuk-rec. 
          move xozluk-rec    to ozluk-rec. 
          move gecici-fol-no to konuk-folio ozluk-folio. 
         open input banka. 
    move cinpara-ext-fol-banka to banka-kodu. 
    read banka  no lock invalid continue, 
                    not invalid move cinpara-ext-fol-banka  to konuk-banka. 
         close      banka. 
         open input doviz. 
    move cinpara-ext-fol-doviz  to doviz-kodu. 
    read doviz  no lock invalid continue, 
                    not invalid move cinpara-ext-fol-doviz  to konuk-doviz. 
         close      doviz. 
         open input kodlar02. 
    move "A"           to kodlar02-tipi. 
    move cinpara-ext-fol-pan to kodlar02-kodu. 
    read kodlar02  no lock invalid continue, 
                   not invalid move cinpara-ext-fol-pan to konuk-pan-tipi. 
    move "B"             to kodlar02-tipi. 
    move cinpara-ext-fol-ode  to kodlar02-kodu. 
    read kodlar02  no lock invalid continue, 
                    not invalid move cinpara-ext-fol-ode to konuk-odeme-tipi. 
         close      kodlar02. 
         open input ulke. 
    move cinpara-ext-fol-ulke    to ulke-anah1. 
    read ulke      no lock invalid continue, 
                    not invalid move cinpara-ext-fol-ulke to konuk-ulke. 
         close      ulke. 
          move "I"  to  konuk-durumu. 
          move "T"  to  konuk-fol-kodu. 
          move xkonuk-adi           to konuk-adi(04:17). 
          move "T=>"                to konuk-adi(01:03). 
***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher    konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar  konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno konuk-firma. 
          move "I"  to  ozluk-durumu. 
          move xkonuk-adi           to ozluk-adi(04:17). 
          move "T=>"                to ozluk-adi(01:03). 
          move plaka to ozluk-plaka
          write konuk-rec invalid continue
          end-write.
                perform log-operation-konuk.
          write ozluk-rec invalid continue 
          end-write.
                perform log-operation-ozluk.
 tel-fol-ac-exit. 
      exit. 
 tel-ac-exit. 
    exit. 
 islem-bitti.
 kaydet-exit.
    exit.
*
 sil. 
 sil-kontrol.
     
     if xkonuk-durumu = "H" 
        initialize mesaj-degiskenler
        move " [ HATA  ] " to mmesaj-title
        move "Bu Folio Check Out Olmus......." to mmesaj-1 
        move "SILEMEZSINIZ...........!!!!!!!!" to mmesaj-2 
        move 1           to mmesaj-type
        move 1           to mmesaj-icon
        move 1           to mmesaj-default
        perform mmesaj-ver
        go sil-exit
     end-if.
        initialize gec-gecme.
     
        perform r-kayit-ara   thru r-kayit-ara-exit       
        perform e-kayit-ara   thru e-kayit-ara-exit
        perform y-kayit-ara   thru y-kayit-ara-exit

     if gecmez
        initialize mesaj-degiskenler
        move " [ HATA  ] " to mmesaj-title
        move "Bu Folioda Hareket Var........." to mmesaj-1 
        move "SILEMEZSINIZ...........!!!!!!!!" to mmesaj-2 
        move 1           to mmesaj-type
        move 1           to mmesaj-icon
        move 1           to mmesaj-default
        perform mmesaj-ver
        go sil-exit
     end-if.
       if extra-sil = 1 then 
         move 1 to dy 
         else
         move 2 to dy
       end-if
*/*********ramazan eklemne
       if k-kodu-tasi not = "ASYA" and k-kodu-tasi not = "X   " 
       if xkonuk-gel-tar < tarih-tasi
          initialize mesaj-degiskenler
          move " [ HATA  ] " to mmesaj-title
          move "Gecmis Tarihli Folio Iptal........." to mmesaj-1 
          move "EDILEMEZ...........!!!!!!!!"         to mmesaj-2 
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          go sil-exit          
       end-if
       end-if 
*/*********ramazan eklemne 
       initialize mesaj-degiskenler
       move " [ Sil Soru ] " to mmesaj-title
       move " BU C/IN IPTAL EDILECEKTIR.............. " to mmesaj-1.
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2. 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move dy          to mmesaj-default
       perform mmesaj-ver
      
       
       if donus-kodu = 1
               perform Acu-Form3-Routine
        
               if neden-silindi = spaces
                  display message box "Silme Nedeni Girilmeden Devam edilemez.." new-line
                                      "Islem iptal edildi.." new-line
                                      "Tekrar deneyiniz.!!!"  
                                  title "Uyari"
                                  icon 1
                    go sil-exit
                    set exit-pushed to true 
               end-if 
       end-if
       if donus-kodu = 1
        if  ONKPARA-MAIL-DEP > 0 then perform extsil-gonder end-if
           move "Sil" to  l-depozit-ana(1:3)
         call "/asya/ytl/obj/otel/depozit.asy" 
                         using  konuk-folio, l-depozit-ana
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/depozit.asy"
                    end-call  
       end-if
       if donus-kodu = 2 
         if extra-sil = 1   then 
            display message box "Oda folio sunda CIN iptal ettiniz" new-line
                                 "Extra inhouse da kalmaktadir " new-line 
                                 "Inhouse listesinden iptal etmeniz gerekmektedir" title "DIKKAT" 
                                 set exit-pushed to true

         end-if
         go sil-exit
       else
         
           if extra-sil = 1   then
              set exit-pushed to true
           end-if
                       
       end-if.

 sil-rez-sil. 
     if xkonuk-fol-kodu = "R" 
        continue
     else 
        go sil-rez-sil-bitti
     end-if. 
        initialize rez-rec. 
        move xkonuk-rez-no   to rez-no. 
        read rez no lock invalid go sil-rez-sil-bitti. 
        initialize   rez-folio rez-c-in. 
         
        accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
        accept rez-edit-zaman from time          |                           
        
        rewrite rez-rec invalid continue
        end-rewrite.
                perform log-operation-rez.

 sil-rez-sil-bitti. 
 
******>Konuk Oku......
        move xkonuk-folio    to konuk-folio ozluk-folio ozluk2-folio. 
        read konuk no lock invalid 
             initialize mesaj-degiskenler
             move " [ HATA  ] " to mmesaj-title
             move "Konuk Kaydi Okunamadi.........." to mmesaj-1 
             move "...... !!!!!..................." to mmesaj-2 
             move 1           to mmesaj-type
             move 1           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             go sil-exit
            not invalid continue
        end-read.
******>Konuk Sil......
        delete konuk invalid 
             initialize mesaj-degiskenler
             move " [ HATA  ] " to mmesaj-title
             move "Konuk Kaydi Silinemedi........." to mmesaj-1 
             move "Ayni anda Baska Terminal Sildi." to mmesaj-2 
             move 1           to mmesaj-type
             move 1           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             go sil-exit
            not invalid continue
                perform log-operation-konuk
                perform silinen-konuk 
        end-delete.
***************************06.07.2015***********************
         open i-o odalar 
         move konuk-odano  to odalar-no 
         read odalar no lock 
          invalid 
            close odalar
          not invalid
             move HOUSE-BK   to odalar-durumu house-durumu  
             rewrite odalar-rec invalid continue
             end-rewrite
             perform log-operation-odalar
         end-read  
         close odalar
         
         
**********************************************
******>Ozluk Oku......
        read ozluk no lock invalid 
            continue
            not invalid continue
        end-read.
******>Ozluk Sil......
        delete ozluk invalid 
            continue
            not invalid continue
                perform log-operation-ozluk
        end-delete.
******>Ozluk2 Sil......
        delete ozluk2 invalid 
           continue 
        end-delete
      



     if xkonuk-fol-kodu = "R" and rez-tipi = 6 
        continue
     else 
        go sil-bitti
     end-if. 
*******>Walk-in Check-in ise rezervasyonuda sil....
        move xkonuk-rez-no   to rez-no. 
        read rez no lock invalid 
             go sil-bitti. 
        delete rez invalid continue
        end-delete.
               perform log-operation-rez.

        if xkonuk-fol-kodu = "R" 
           perform takvim-sil thru takvim-sil-exit 
           perform cast-sil   thru cast-sil-exit
        end-if.
 sil-bitti.
     if xkonuk-fol-kodu = "R" 
         if TELPARA-dishat-ac-kapa = 1 then 
            perform hat-kapat
         end-if
       add 1  to konuk-folio
       read konuk no lock 
         invalid exit paragraph
         not invalid
         if konuk-extra-rez-no =  xkonuk-rez-no
           move konuk-folio to xkonuk-folio
           display accept-folio
           move 1003 to control-id
           perform aft-procedure
            display message box "C/IN iptal ettiginiz folionun extra foliosu iptal edilecektir" new-line
                            "Bir sonraki soruya EVET demeyi atlamayin"
            move 1 to extra-sil
            move 3 to key-status
            perform Exception-Procedure               
            call "w$keybuf" using 1,x"0B" end-call
            move 4    to accept-control
            move 1010 to control-id
           
            else 
              move 4    to accept-control
              move 1003 to control-id
           end-if
         end-read
         else
         move 4    to accept-control
         move 1003 to control-id
        
          if     extra-sil = 1   then 
           
                                 set exit-pushed to true
              end-if

      end-if

   

      
           .
 Sil-Exit. 
    exit.
*
 takvim-sil. 
 takvim-sil-basla. 
        open i-o takvim.
        move xkonuk-gel-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-sil-bitti.

 takvim-sil-oku. 
        read takvim next no lock end 
             go takvim-sil-bitti.
        if fs-takvim = 99 go takvim-sil-oku. 
        if takvim-anah = xkonuk-git-tar 
           go takvim-sil-bitti
        end-if. 
        if takvim-anah > xkonuk-git-tar 
           go takvim-sil-bitti
        end-if. 
 
      compute takvim-sat-oda(xkonuk-oda-konumu) = 
              takvim-sat-oda(xkonuk-oda-konumu) - 1. 
      compute takvim-sat-buyuk(xkonuk-oda-konumu) = 
              takvim-sat-buyuk(xkonuk-oda-konumu) - xkonuk-buyuk. 
      compute takvim-sat-kucuk(xkonuk-oda-konumu) = 
              takvim-sat-kucuk(xkonuk-oda-konumu) - xkonuk-kucuk. 
      compute takvim-sat-free(xkonuk-oda-konumu) = 
              takvim-sat-free(xkonuk-oda-konumu) - xkonuk-free. 
      compute takvim-sat-free(xkonuk-oda-konumu) = 
              takvim-sat-free(xkonuk-oda-konumu) - xkonuk-bebek.
        rewrite takvim-rec invalid go takvim-sil-oku. 
            go takvim-sil-oku. 
 takvim-sil-bitti.
      close takvim.
 takvim-sil-exit. 
     exit. 
*
 cast-sil. 
          open i-o cast. 
         initialize cast-rec. 
        move xkonuk-rez-no    to cast-rez-no. 
        start cast key not < cast-anah1 invalid 
              go cast-sil-bitti. 
 cast-sil-oku. 
        read cast  next no lock end go cast-sil-bitti. 
        if fs-cast = 99 go cast-sil-oku. 
        if   cast-rez-no > xkonuk-rez-no 
             go cast-sil-bitti
        end-if. 
        if cast-rez-no = xkonuk-rez-no 
           continue
        else 
           go cast-sil-oku
        end-if.        
        
        delete cast invalid 
           go cast-sil-oku. 
          perform log-operation-cast
            go cast-sil-oku. 
 cast-sil-bitti. 
             close cast. 
 cast-sil-exit. 
     exit. 
*
 r-kayit-ara. 
        open input romhrk. 
        initialize romhrk-rec. 
        move xkonuk-folio   to romhrk-folio. 
        move spaces         to romhrk-islem. 
        start romhrk key not < romhrk-anah invalid 
              go r-kayit-ara-bitti. 
 r-kayit-oku. 
        read  romhrk next no lock end go r-kayit-ara-bitti. 
        if fs-romhrk = 99 go r-kayit-oku. 
        if romhrk-folio > xkonuk-folio  go r-kayit-ara-bitti. 
        if romhrk-folio = xkonuk-folio 
           continue
        else 
           go r-kayit-oku
        end-if. 
           move 1 to gec-gecme. 
 r-kayit-ara-bitti. 
        close      romhrk. 
 r-kayit-ara-exit. 
     exit. 
 e-kayit-ara. 
        open input exthrk. 
        initialize exthrk-rec. 
        move xkonuk-folio   to exthrk-folio. 
        move spaces         to exthrk-islem. 
        start exthrk key not < exthrk-anah invalid 
              go e-kayit-ara-bitti. 
 e-kayit-oku. 
        read  exthrk next no lock end go e-kayit-ara-bitti. 
        if fs-exthrk = 99 go e-kayit-oku. 
        if exthrk-folio > xkonuk-folio  go e-kayit-ara-bitti. 
        if exthrk-folio = xkonuk-folio 
           continue
        else 
           go e-kayit-oku
        end-if. 
           move 1 to gec-gecme. 
 e-kayit-ara-bitti. 
        close      exthrk. 
 e-kayit-ara-exit. 
       exit. 

*
 y-kayit-ara. 
        open input yromhrk. 
        initialize yromhrk-rec. 
        move xkonuk-folio   to yromhrk-folio. 
        move spaces         to yromhrk-islem. 
        start yromhrk key not < yromhrk-anah invalid 
              go y-kayit-ara-bitti. 
 y-kayit-oku. 
        read  yromhrk next no lock end go y-kayit-ara-bitti. 
        if fs-yromhrk = 99 go y-kayit-oku. 
        if yromhrk-folio > xkonuk-folio  go y-kayit-ara-bitti. 
        if yromhrk-folio = xkonuk-folio 
           continue
        else 
           go y-kayit-oku
        end-if. 
           move 1 to gec-gecme. 
 y-kayit-ara-bitti. 
        close      yromhrk. 
 y-kayit-ara-exit. 
     exit. 
*
 oto-slip. 
*         if cinpara-oto-slip  = "E" 
*                  DISPLAY WINDOW POP-UP BOS-PEN 
*         CALL "/asya/obj/otel/slip-oto.cob" USING LINK-TASI KONUK-FOLIO 
*         ON EXCEPTION MOVE 1 TO MESAJ-DEGISKEN 
*            PERFORM HATA-01 THRU HATA-01-EXIT CLOSE WINDOW BOS-PEN 
*         NOT ON EXCEPTION CLOSE WINDOW BOS-PEN 
*            CANCEL "/asya/obj/otel/slip-oto.cob". 
 oto-slip-exit. 
    exit. 
*
 xon-odeme-isle. 
*    if rez-on-odeme = zeroes  go on-odeme-isle-exit. 
*    if rez-on-odeme = 202020202  go on-odeme-isle-exit. 
*    DISPLAY WINDOW BOXED,SHADOW,ERASE,NO WRAP, NO SCROLL, 
*    LEFT TITLE "[ß]" 

*    LINE 10 COL 20 SIZE 40 LINES 03 COLOR PALET-12,POP-UP AREA IS PENCERE-2. 
*    DISPLAY "On Odeme Departmani:" AT 0202. 
*    initialize dep-sor. 
 on-odeme-depart-al. 
*    SET ENVIRONMENT "CURSOR_MODE" TO "1". 
*    MOVE 0 TO TUS. 
*    ACCEPT DEP-SOR AUTO PROMPT UPDATE CONVERT 
*           LINE 02 COL 22 COLOR PALET-08 ON EXCEPTION TUS PERFORM TUS-AL. 
*    DISPLAY DEP-SOR AT 0222 COLOR PALET-12. 
*    EVALUATE TRUE 
*        WHEN TUS = 27 CLOSE WINDOW PENCERE-2 GO ON-ODEME-ISLE-EXIT 
*        WHEN TUS = 01 
*                  DISPLAY WINDOW POP-UP BOS-PEN 
*                  MOVE SPACES TO DEPKOD-CAGIR CAGRI-TIPI 
*            CALL "/asya/obj/otel/depara.cob" 
*                  USING LINK-TASI DEPKOD-CAGIR CAGRI-TIPI 
*         ON EXCEPTION MOVE 1 TO MESAJ-DEGISKEN 
*            PERFORM HATA-01 THRU HATA-01-EXIT CLOSE WINDOW BOS-PEN 
*         NOT ON EXCEPTION CLOSE WINDOW BOS-PEN 
*            CANCEL "/asya/obj/otel/depara.cob" 
*            MOVE DEPKOD-DEP-KODU TO dep-sor,END-CALL 
*    END-EVALUATE. 
*    OPEN INPUT DEPKOD. 
*    INITIALIZE DEPKOD-REC. 
*    MOVE DEP-SOR TO DEPKOD-KODU. 
*    READ DEPKOD NO LOCK INVALID CLOSE DEPKOD GO ON-ODEME-DEPART-AL. 
*    CLOSE DEPKOD. 
*    IF DEPKOD-BA = "B" GO ON-ODEME-DEPART-AL. 
*    DISPLAY DEPKOD-ADI AT 0222. 
*    MOVE 20 TO SEC-KODU. 
*    MOVE "   On Odeme Kaydet ?   " TO SEC(SEC-KODU). 
*    MOVE "E" TO SEC-TARAF. 
*    PERFORM SEC THRU SEC-EXIT. 
*    IF SECIM NOT = "E" CLOSE WINDOW PENCERE-2 GO ON-ODEME-ISLE-EXIT. 
*    CLOSE WINDOW PENCERE-2. 
*    OPEN I-O GENELFIS. 
*    MOVE 1 TO GENELFIS-ANAHTAR. 
*    READ GENELFIS NO LOCK INVALID 
*         INITIALIZE GENELFIS-REC MOVE 1 TO GENELFIS-ANAHTAR. 
*    ADD 1 TO CEKGIR-OTO. 
*    MOVE CEKGIR-OTO TO ROMHRK-ISLEM. 
*    REWRITE GENELFIS-REC INVALID WRITE GENELFIS-REC END-WRITE. 
*    CLOSE GENELFIS. 
*    OPEN I-O ROMHRK. 
*    INITIALIZE ROMHRK-REC. 
*    MOVE "O"           TO ROMHRK-ISLEM-TIPI. 
*    MOVE KONUK-FOLIO   TO ROMHRK-FOLIO. 
*    MOVE DEPKOD-KODU   TO ROMHRK-DEPKOD. 
*    MOVE CEKGIR-OTO    TO ROMHRK-ISLEM. 
*    MOVE DEPKOD-BA     TO ROMHRK-BA. 
*    MOVE KONUK-GEL-TAR TO ROMHRK-TARIH. 
*    MOVE REZ-ON-ODEME  TO ROMHRK-DV-TUTAR. 
*    OPEN INPUT KUR 
*    MOVE KONUK-BANKA   TO KUR-BANKA 
*    MOVE REZ-ON-DOVIZ  TO KUR-DOVIZ 
*    READ KUR NO LOCK INVALID 
*         MOVE 20      TO UYARI-KODU 
*         MOVE FS-KUR  TO UYARI-FS 
*         MOVE "kur"   TO UYARI-DOSYA 
*         MOVE "Istenilen Dovize Ait Kur Yok"   TO UYARI(UYARI-KODU) 
*         PERFORM UYARI THRU UYARI-EXIT  
*         MOVE 1 TO DOVIZ-ALIS DOVIZ-SATIS 
*                   EFEKTIF-ALIS EFEKTIF-SATIS 
*    END-READ 
*    COMPUTE ROMHRK-TL-TUTAR = REZ-ON-ODEME * DOVIZ-ALIS 
* 
*    INITIALIZE ISLEM-KURU. 
*    MOVE CALISMA-TARIHI  TO KUR-TARIH. 
*    MOVE ONKPARA-BANKA   TO KUR-BANKA. 
*    MOVE ONKPARA-DOVIZ   TO KUR-DOVIZ. 
*    READ KUR NO LOCK INVALID CLOSE KUR ROMHRK GO ON-ODEME-ISLE-EXIT. 
*       MOVE DOVIZ-ALIS TO ISLEM-KURU. 
*    IF ONKPARA-D-E = "D" AND ONKPARA-A-S = "A" MOVE DOVIZ-ALIS    TO ISLEM-KURU.
*    IF ONKPARA-D-E = "D" AND ONKPARA-A-S = "S" MOVE DOVIZ-SATIS   TO ISLEM-KURU.
*    IF ONKPARA-D-E = "E" AND ONKPARA-A-S = "A" MOVE EFEKTIF-ALIS  TO ISLEM-KURU.
*    IF ONKPARA-D-E = "E" AND ONKPARA-A-S = "S" MOVE EFEKTIF-SATIS TO ISLEM-KURU.
*    IF ISLEM-KURU = 0  
*       MOVE 20      TO UYARI-KODU 
*       MOVE FS-KUR  TO UYARI-FS 
*       MOVE "kur"   TO UYARI-DOSYA 
*       MOVE "Istenilen Dovize Ait Kur Yok"   TO UYARI(UYARI-KODU) 
*       PERFORM UYARI THRU UYARI-EXIT  
*       CLOSE KUR ROMHRK GO ON-ODEME-ISLE-EXIT.  


*    CLOSE KUR. 
* 
*            INITIALIZE ROMHRK-DV-TUTAR. 
*    COMPUTE ROMHRK-DV-TUTAR = ROMHRK-TL-TUTAR / ISLEM-KURU.  
*    ACCEPT ROMHRK-ZAMAN FROM TIME. 
*    MOVE K-KODU-TASI   TO ROMHRK-STAF. 
*    WRITE ROMHRK-REC INVALID CONTINUE. 
*    CLOSE ROMHRK. 
*  
*    MOVE ROMHRK-FOLIO TO KONUK-FOLIO 
*    READ KONUK NO LOCK INVALID CONTINUE 
*         NOT INVALID 
*            COMPUTE KONUK-TOP-ALAC = KONUK-TOP-ALAC + ROMHRK-TL-TUTAR 
*            REWRITE KONUK-REC END-REWRITE, 
*    END-READ. 
* ONKASA-ARTIR.
*       OPEN I-O ONKASA.
*       MOVE ROMHRK-TARIH    TO ONKASA-TARIH.
*       MOVE ROMHRK-DEPKOD   TO ONKASA-DEP.
*       READ ONKASA NO LOCK INVALID GO ONKASA-YENI-ISLE.
*       COMPUTE ONKASA-TUTAR-TL   = ONKASA-TUTAR-TL + ROMHRK-TL-TUTAR.
*       COMPUTE ONKASA-TUTAR-DV   = ONKASA-TUTAR-DV + ROMHRK-DV-TUTAR.
*       REWRITE ONKASA-REC INVALID WRITE ONKASA-REC END-REWRITE.
*       CLOSE ONKASA.
*       GO ONKASA-ARTIR-EXIT.
* ONKASA-YENI-ISLE.
*            INITIALIZE ONKASA-REC.
*       MOVE ROMHRK-TARIH    TO ONKASA-TARIH.
*       MOVE ROMHRK-DEPKOD   TO ONKASA-DEP.
*       MOVE ROMHRK-TL-TUTAR TO ONKASA-TUTAR-TL.
*       MOVE ROMHRK-DV-TUTAR TO ONKASA-TUTAR-DV.
*       WRITE ONKASA-REC INVALID REWRITE ONKASA-REC END-WRITE.
*       CLOSE ONKASA.
* ONKASA-ARTIR-EXIT.
*       EXIT.
 xon-odeme-isle-exit. 
    exit. 
 regist-ver. 
*    IF CINPARA-REG-FIS = "E" OR 
*       CINPARA-REG-FIS = "e" 
*       MOVE 20 TO SEC-KODU 
*       MOVE " Register Formu Ciksinmi?" TO SEC(SEC-KODU) 
*       MOVE "E" TO SEC-TARAF 
*       PERFORM SEC THRU SEC-EXIT 
*       IF SECIM = "E" 
*         MOVE XKONUK-FOLIO TO LINK-FOLIO 
*         DISPLAY WINDOW POP-UP BOS-PEN 
*         CALL "/asya/obj/otel/register.cob" USING LINK-TASI LINK-BILGI 
*         ON EXCEPTION MOVE 1 TO MESAJ-DEGISKEN 
*         PERFORM HATA-01 THRU HATA-01-EXIT 
*         CLOSE WINDOW BOS-PEN 
*         NOT ON EXCEPTION 
*         CANCEL "/asya/obj/otel/register.cob" 
*         CLOSE WINDOW BOS-PEN 
*         END-CALL 
*       END-IF 
*      ELSE 
*         MOVE XKONUK-FOLIO TO LINK-FOLIO 
*         DISPLAY WINDOW POP-UP BOS-PEN 
*         CALL "/asya/obj/otel/register.cob" USING LINK-TASI LINK-BILGI 
*         ON EXCEPTION MOVE 1 TO MESAJ-DEGISKEN 
*         PERFORM HATA-01 THRU HATA-01-EXIT 
*         CLOSE WINDOW BOS-PEN 
*         NOT ON EXCEPTION 
*         CANCEL "/asya/obj/otel/register.cob" 
*         CLOSE WINDOW BOS-PEN 
*         END-CALL 
*    END-IF. 
 regist-ver-exit. 
    exit.
*
*
 oda-arah.
     initialize blok-cagir
     move "M" to oda-db-cagir
     move xkonuk-oda-konumu  to oda-konum-cagir.
     move xkonuk-gel-tar     to    blok-bas-tar
     move xkonuk-git-tar     to    blok-bit-tar
     move xkonuk-rez-no      to  blok-rez-no
      call "/asya/ytl/obj/otel/odaarah.asy" 
           using oda-cagir, blok-bas-tar, 
                 blok-bit-tar, blok-rez-no
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/odaarah.asy" 
      end-call.
      move odano-cagir     to xkonuk-odano
      display accept-odano
      perform xkonuk-oda-uzat
      initialize blok-cagir.
*
 oda-ara2.
     initialize blok-cagir
     move "M" to oda-db-cagir
     move xkonuk-oda-konumu  to oda-konum-cagir.
     move xkonuk-gel-tar     to    blok-bas-tar
     move xkonuk-git-tar     to    blok-bit-tar
     move xkonuk-rez-no      to  blok-rez-no
      call "/asya/ytl/obj/otel/odaara2.asy" 
           using oda-cagir, blok-bas-tar, 
                 blok-bit-tar, blok-rez-no
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/odaara2.asy" 
      end-call.
      move odano-cagir     to xkonuk-odano
      display accept-odano
      perform xkonuk-oda-uzat
      initialize blok-cagir.
*
 kontrol-bolumu. 
************=======> Bu Bolum Cesitli Kontrollar Icindir    <====*********** 
*
*
 blok-kont2.
          
          perform oda-oku thru oda-oku-exit
            if gecmez
               initialize xkonuk-odano
                  move   ydk-odano  to xkonuk-odano 
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
                  exit paragraph
            end-if 
            add 1 to debug
      









          
               initialize blok-cagir 
               move xkonuk-gel-tar    to blok-bas-tar 
               move xkonuk-git-tar    to blok-bit-tar 
               move xkonuk-rez-no     to blok-rez-no 
               move xkonuk-odano      to blok-oda 
               if cin-tipi = 2 and konuk-kayit-durumu = "Y" then 
                   move  xkonuk-sharenum   to blok-sharenum
               end-if
               call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokara.asy" 
               end-call
               if rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H" 
                  initialize xkonuk-odano
                  move   ydk-odano  to xkonuk-odano 
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
                  exit paragraph
               end-if
             
           .

 dolu-oda-kontrol.
        
            initialize konuk-rec gec-gecme. 
              if xkonuk-odano  = spaces 
                    go dolu-oda-kontrol-exit
              end-if
              initialize blok-cagir 
               move rez-gir-tar    to blok-bas-tar 
               move rez-cik-tar    to blok-bit-tar 
               move rez-no         to blok-rez-no 
               move xkonuk-odano      to blok-oda 
               call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokara.asy" 
               end-call
              if rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H" 
                  initialize xkonuk-odano
                  move ydk-odano to xkonuk-odano
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
                  go dolu-oda-kontrol-exit
               end-if
                move xkonuk-odano to ydk-odano 
            initialize konuk-rec gec-gecme. 
            move "I"            to konuk-durumu. 
            move xkonuk-odano   to konuk-odano. 
         start konuk key not < konuk-oda 
               invalid initialize gec-gecme
               go dolu-oda-kontrol-exit. 
 dolu-oda-oku. 
        
           read konuk next no lock end go dolu-oda-kontrol-exit. 
           if fs-konuk = 99 go dolu-oda-oku. 
           if konuk-odano > xkonuk-odano go dolu-oda-kontrol-exit. 
           if konuk-durumu not = "I" go dolu-oda-kontrol-exit. 
           if konuk-odano = xkonuk-odano  and  konuk-sharenum = xkonuk-sharenum 
              move 1 to dolu-share
              string konuk-adi delimited by "   "
               " " delimited by size
               konuk-soyadi delimited " " 
                  into dolu-adi
             
          end-if
           if konuk-odano = xkonuk-odano  and ((  konuk-share not  = 1  and 
                xkonuk-share not  = 1  )  or konuk-sharenum not = xkonuk-sharenum  )
              continue
           else 
              go dolu-oda-kontrol-exit
           end-if. 

           if 
              cin-tipi <> "3" 
              initialize mesaj-degiskenler
              move " [ Dolu Oda Secildi ] " to mmesaj-title
              move "F:         G:  /  /     C:  /  /    " to mmesaj-1 
              move konuk-folio         to mmesaj-1(03:08) 
              move konuk-gel-gun       to mmesaj-1(14:02) 
              move konuk-gel-ay        to mmesaj-1(17:02) 
              move konuk-gel-yil       to mmesaj-1(20:04) 
              move konuk-git-gun       to mmesaj-1(27:02) 
              move konuk-git-ay        to mmesaj-1(30:02) 
              move konuk-git-yil       to mmesaj-1(33:04) 
              move konuk-adi(01:15)    to mmesaj-2(01:15) 
              move konuk-soyadi(01:15) to mmesaj-2(17:15) 
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
              if CINPARA-DOLU-ODAYA not = "E" 
              move 1 to gec-gecme
              end-if
           end-if.

          
              if cin-tipi <> "3"
                 initialize mesaj-degiskenler
                 move " [ Dolu Oda Secildi ] " to mmesaj-title
                 move "Dolu Odaya C/In !!"    to mmesaj-1 
                 move "    Enter Devam    "   to mmesaj-2 
                 move 1           to mmesaj-type
                 move 3           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
              end-if .
          
 dolu-oda-kontrol-exit. 
     exit. 
*
 folio-numarasi-al. 
    open i-o genelfis. 
    move 1 to genelfis-anahtar. 
    read genelfis no lock invalid 
          initialize genelfis-rec 
          move 1 to genelfis-anahtar
    end-read. 
    add 1 to folio-oto. 
    move folio-oto to xkonuk-folio. 
    rewrite genelfis-rec invalid write genelfis-rec. 
    close genelfis. 
    move xkonuk-folio    to konuk-folio. 
         read konuk no lock 
              invalid move "Y" to konuk-kayit-durumu 
          not invalid move "E" to konuk-kayit-durumu
              if cin-tipi = 1
                 initialize mesaj-degiskenler
                 move " [ Folio Numarasi Yanlis ] " to mmesaj-title
                 move "Verilen Folio Numarasinda Kayit   " to mmesaj-1 
                 move "Var Folio No Degistirin..         " to mmesaj-2
                 move xkonuk-folio     to mmesaj-2(25:08)
                 move 1           to mmesaj-type
                 move 3           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 move 1 to gec-gecme
              end-if
         end-read. 
        display accept-folio.


********>Rezervasyon asamasindaki kontrolller
********>Walk-in Check-in'de bu kontrollerin 
********>olup-olmamasi dusunulecek..................
 kontrat-kontrol. 
            move "V" to kontrat-var-yok. 
         if xrez-tipi = 1 
            continue
         else 
            go kontrat-kontrol-exit
         end-if.
         open input acenhrk. 
 kontrat-basla. 
          initialize acenhrk-rec. 
          move xrez-acenta  to acenhrk-acenta. 
          move xrez-gir-tar to acenhrk-tarih. 
          start acenhrk key not < acenhrk-anah invalid 
                go kontrat-yok. 
 kontrat-oku. 
         read acenhrk  next no lock end 
              go kontrat-yok. 
         if fs-acenhrk   = 99 go kontrat-oku. 
         if acenhrk-acenta  = xrez-acenta 
            continue
         else 
            go kontrat-yok
         end-if. 
         if acenhrk-tarih not > xrez-gir-tar 
            continue
         else 
            go kontrat-yok
         end-if. 
         if acenhrk-kontrat-oda = 0 go kontrat-oku. 
            close acenhrk. 
            go kontrat-kontrol-exit. 
 kontrat-yok. 
            move "Y" to kontrat-var-yok. 
            close acenhrk. 
            initialize mesaj-degiskenler
            move "Bu Acentanin Bu Tarihlerde Kontrati YOK...."  to mmesaj-1
            move "Rezervasyon Tipini Degistirin.............."  to mmesaj-2
            move " [ Kontrat Uyari] " to mmesaj-title
            move 1           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver.
 kontrat-kontrol-exit. 
     exit. 
 aksiyon-kontrol. 
         open input aksiyhrk takvim. 
         initialize aksiyon-varsa gun-sayi. 
 aksiyon-basla. 
          move xrez-gir-tar to takvim-anah. 
          start takvim key not < takvim-anah invalid 
                close aksiyhrk takvim
                go aksiyon-kontrol-exit. 
 aksiyon-oku. 
         read takvim   next no lock end go ak-bak. 
         if fs-takvim   = 99 go aksiyon-oku. 
         if takvim-anah = xrez-cik-tar go ak-bak. 
         if takvim-anah > xrez-cik-tar go ak-bak. 
         add 1 to gun-sayi. 
         go aksiyon-oku. 
 ak-bak. 
         move "A"           to aksiyhrk-tipi.
         move xrez-acenta   to aksiyhrk-acenta. 
         move xrez-gir-tar  to aksiyhrk-tarih. 
         move xrez-pan-tipi to aksiyhrk-pan-tipi.
         move gun-sayi      to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
             close aksiyhrk takvim go aksiyon-kontrol-exit. 
            initialize mesaj-degiskenler
            move "Aksiyona Tabi Acenta                       "  to mmesaj-1
            move "Geceleme..:"   to mmesaj-2(01:12)


            move aksiyhrk-gecele to mmesaj-2(12:02)
            move "Tahsil....:"   to mmesaj-2(15:12)
            move aksiyhrk-ode(1:2)    to mmesaj-2(26:02)
            move " [ Aksiyon Uyari] " to mmesaj-title
            move 1           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver.
            move "V"  to aksiyon-var-yok. 
            move aksiyhrk-gecele   to ak-gece. 

            move aksiyhrk-ode      to ak-tahsil. 
            close      aksiyhrk takvim. 
 aksiyon-kontrol-exit. 
      exit. 
 stopsale-kontrol. 
      open input aksiyhrk.
 stopsale-oku. 
         move "Y" to stopsale-var-yok.
         move "S"           to aksiyhrk-tipi.
         move xrez-acenta   to aksiyhrk-acenta. 
         move xrez-gir-tar  to aksiyhrk-tarih. 
         move xrez-pan-tipi to aksiyhrk-pan-tipi.
         move 0             to aksiyhrk-gecele.
         read aksiyhrk no lock invalid 
              close aksiyhrk go stopsale-kontrol-exit. 
            initialize mesaj-degiskenler
            move "Bu Acentaya Stop-Sale Cekilmis......."  to mmesaj-1
            move "Bu Tarihlere Rezervasyon Girmeyin...."  to mmesaj-2
            move " [ Stop Sale Uyari] " to mmesaj-title
            move 1           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default

            perform mmesaj-ver.
            move "V" to stopsale-var-yok.
            close      aksiyhrk.
 stopsale-kontrol-exit. 
      exit.
*
 eskimus-ara. 
        move "I"          to rez-durumu. 
        move xrez-soyadi  to rez-soyadi. 
       start rez key not < rez-soy invalid 
             go eskimus-ara-exit. 
 eskimus-oku. 
         read rez next no lock end go eskimus-ara-exit. 
         if fs-rez = 99 go eskimus-oku. 
         if rez-soyadi > xrez-soyadi go eskimus-ara-exit. 
         if rez-durumu not = "I" go eskimus-ara-exit. 
         if rez-soyadi = xrez-soyadi and rez-adi = xrez-adi 
            continue
         else 
            go eskimus-oku
         end-if. 
         if rez-no   =   xrez-no     go eskimus-oku. 
            initialize mesaj-degiskenler
            move " [ Eski Musteri Uyari ] " to mmesaj-title
            move "DAHA ONCE GELMIS...Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type

            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go eskimus-ara-exit
            end-if
         go eskimus-oku. 
 eskimus-ara-exit. 
     exit. 
 mukerrer-isimden. 
        move "I"          to rez-durumu. 
        move xrez-soyadi  to rez-soyadi. 
       start rez key not < rez-soy invalid 
             go mukerrer-isimden-exit. 
 mukerrer-isim-oku. 
         read rez next no lock end go mukerrer-isimden-exit. 
         if fs-rez = 99 go mukerrer-isim-oku. 

         if rez-soyadi > xrez-soyadi go mukerrer-isimden-exit. 
         if rez-durumu not = "I" go mukerrer-isimden-exit. 
         if rez-soyadi = xrez-soyadi and rez-adi = xrez-adi 
            and rez-acenta = xrez-acenta 
            continue
         else 
            go mukerrer-isim-oku
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-isim-oku. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-isimden-exit
            end-if
         go mukerrer-isim-oku. 
 mukerrer-isimden-exit. 
      exit. 
 mukerrer-voucherden. 
        move "I"          to rez-durumu. 
        move xrez-voucher to rez-voucher. 
       start rez key not < rez-vouc invalid go mukerrer-voucherden-exit. 
 mukerrer-vouc-oku. 
         read rez next no lock end go mukerrer-voucherden-exit. 
         if fs-rez = 99 go mukerrer-vouc-oku. 
         if rez-voucher > xrez-voucher go mukerrer-voucherden-exit. 
         if rez-durumu not = "I" go mukerrer-voucherden-exit. 
         if rez-voucher = xrez-voucher 
            continue
         else 
            go mukerrer-vouc-oku
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-vouc-oku. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-voucherden-exit
            end-if
         go mukerrer-vouc-oku. 
 mukerrer-voucherden-exit. 
      exit. 
*
 short-kontrol.
            open input konum.
            initialize konum-rec short-1konum short-toplam.
            move xrez-oda-konumu   to konum-anahtar.
            read konum no lock invalid 
                 initialize konum-rec.
            close konum.
            open input takvim.
        move "Y" to short-var-yok.
        move xrez-gir-tar to takvim-anah.
        start takvim key not < takvim-anah invalid 
              go short-kontrol-bitti.
 short-oku.
         read takvim next no lock end go short-kontrol-bitti.
         if fs-takvim = 99 go short-oku.
         if takvim-anah = xrez-cik-tar  go short-kontrol-bitti.
         if takvim-anah > xrez-cik-tar  go short-kontrol-bitti.
            initialize short-1konum short-toplam.
         compute short-1konum =  1 +
                 takvim-sat-oda(xrez-oda-konumu)  .
         compute short-toplam =  1 +
                 takvim-sat-oda(1) + takvim-sat-oda(2) +
                 takvim-sat-oda(3) + takvim-sat-oda(4) +
                 takvim-sat-oda(5) + takvim-sat-oda(6) +
                 takvim-sat-oda(7) + takvim-sat-oda(8) +
                 takvim-sat-oda(9) .
         if short-1konum > konum-hazir-oda  
            perform 1konum-shortta
              if donus-kodu = 2 
                 go short-kontrol-bitti
              end-if
         end-if.

         if short-toplam > takvim-hazir-oda 
            perform toplam-shortta
              if donus-kodu = 2 
                 go short-kontrol-bitti
              end-if
         end-if.
            go short-oku.
*
 1konum-shortta.
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Oda Konumunuz Short'ta ] " to mmesaj-title
       move "Bu Tarihte"                           to mmesaj-1(01:10)
       move konum-adi(01:10)                       to mmesaj-1(12:10)
       move "Oda Shortta"                          to mmesaj-1(23:11)
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move konum-hazir-oda  to mmesaj-2(22:04)
       move short-1konum     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 toplam-shortta.
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Tum Konumlar Short'ta ] " to mmesaj-title
       move "Bu Tarihte Tum Konumlar Short'ta"     to mmesaj-1
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move takvim-hazir-oda to mmesaj-2(22:04)
       move short-toplam     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
 short-kontrol-bitti.
       close takvim.
 short-kontrol-exit.
    exit.

*
 kontenjan-kontrol. 
        open  input acenhrk takvim. 
        move "V" to kontj-var-yok. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah 
              invalid go kontenjan-kontrol-bitti. 
 kontj-oku. 
         read takvim next no lock end 
              go kontenjan-kontrol-bitti. 
         if fs-takvim = 99 go kontj-oku. 
         if takvim-anah = xrez-cik-tar 
            go kontenjan-kontrol-bitti
         end-if. 
         if takvim-anah > xrez-cik-tar 
            go kontenjan-kontrol-bitti
         end-if. 
         initialize acenhrk-rec. 
         move xrez-acenta       to acenhrk-acenta. 
         move takvim-anah       to acenhrk-tarih. 
         move rezpara-kont-tipi to acenhrk-s-d-t-g. 
         if rezpara-kont-tipi = 0 
            move xrez-s-d-t-g   to acenhrk-s-d-t-g
         end-if. 
         move xrez-fiyat-konumu to acenhrk-oda-konumu. 
         read acenhrk no lock invalid 
              perform kontenjani-dolu. 
         if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
            perform kontenjani-dolu
            if donus-kodu = 2 
               go kontenjan-kontrol-bitti
            end-if
         end-if.
         go kontj-oku. 
 kontenjani-dolu. 
       move "Y" to kontj-var-yok. 
       initialize mesaj-degiskenler
       move " [ Kontenjan Hata ] " to mmesaj-title
       move "Bu Tarihte Bu Acentanin Kon.Yok"      to mmesaj-1. 
       move "Tarih:  /  /     Kon:      Sat:     " to mmesaj-2. 
       move takvim-gun                             to mmesaj-2(07:02). 
       move takvim-ay                              to mmesaj-2(10:02). 
       move takvim-yil                             to mmesaj-2(13:04). 
       move acenhrk-kontrat-oda                    to mmesaj-2(22:04). 
       move acenhrk-sat-oda                        to mmesaj-2(32:04). 

       move 2           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
 kontenjan-kontrol-bitti. 
          close acenhrk takvim. 
 kontenjan-kontrol-exit. 
    exit. 
*
 blok-kontrol.
           initialize gec-gecme
           open input cast.
        move xrez-gir-tar   to cast-tarih.
        move xrez-odano     to cast-oda-no.
        start cast key not < cast-anah3 invalid 
              go blok-kontrol-bitti.
 blok-kontrol-oku.
        read cast next no lock end 
             go blok-kontrol-bitti.
        if fs-cast = 99 go blok-kontrol-oku.
        if cast-tarih  > xrez-cik-tar   go blok-kontrol-bitti.
        if cast-tarih  = xrez-cik-tar   go blok-kontrol-bitti.
        if cast-oda-no > xrez-odano     go blok-kontrol-bitti.
        if cast-oda-no = xrez-odano  
           continue
        else 
           go blok-kontrol-oku
        end-if.
        if cast-rez-no = xrez-no go blok-kontrol-oku.
           initialize mesaj-degiskenler
           move " [ DIKKAT ] " to mmesaj-title
           move "Girdiginiz Oda Bu Tarihte Blokeli  " to mmesaj-1
           move "Tarih..:  /  /                     " to mmesaj-2
           move cast-gun     to mmesaj-2(09:02)
           move cast-ay      to mmesaj-2(12:02)
           move cast-yil     to mmesaj-2(15:04)

           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
             perform mmesaj-ver
             .
 blok-kontrol-bitti.
            close cast.
 blok-kontrol-exit.
     exit.
*
* fiyat-bul. 
*        open input fiyat fiyatana. 
*        move 0 to oda-fiyati. 
*        move xrez-acenta        to fiyat-acenta. 
*        move xrez-gir-tar       to fiyat-tarih. 
*        move xrez-tipi          to fiyat-rez-tipi. 
*        move xrez-pan-tipi      to fiyat-pan-tipi. 
*        move xrez-banka         to fiyat-banka. 
*        move xrez-doviz         to fiyat-doviz. 
*        move xrez-anlasma       to fiyat-anlasma. 
*        move xrez-buyuk         to fiyat-buyuk.
*        move xrez-kucuk         to fiyat-kucuk.
*        read fiyat no lock invalid go fiyat-bulundu.
* 
*             move fiyat-acenta    to fiyatana-acenta. 
*             move fiyat-bas-tarih to fiyatana-ilk-tarih.
*             move fiyat-bit-tarih to fiyatana-son-tarih.
*             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
*             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
*             move fiyat-banka     to fiyatana-banka. 
*             move fiyat-doviz     to fiyatana-doviz. 
*             move fiyat-anlasma   to fiyatana-anlasma. 
*             move fiyat-buyuk     to fiyatana-buyuk.
*             move fiyat-kucuk     to fiyatana-kucuk.
*             read fiyatana no lock invalid go fiyat-bulundu.
*
*       move fiyatana-oda-fiyati(xrez-oda-konumu) to oda-fiyati. 
**/********* 
*       if xrez-nor-indirim not = 0 
*       compute oda-fiyati = 
*              (((oda-fiyati * xrez-nor-indirim) / 100) - oda-fiyati)
*       end-if.
**/Early booking orani var ve early booking uygulanacak ise 
*       if xrez-eb = "E" and fiyatana-eb-oran not = 0 
*       compute oda-fiyati = 
*              (((oda-fiyati * fiyatana-eb-oran) / 100) - oda-fiyati)
*       end-if. 
**/Kick-back orani
*       if fiyatana-kick-back <> 0 
*       compute oda-fiyati = 
*              (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
*       end-if. 
*       move oda-fiyati to xrez-fiyati. 
* aksiyonlu-uyar. 
*       if aksiyon-var continue
*       else go fiyat-bulundu
*       end-if. 
*       move oda-fiyati to xrez-fiyati. 
*            initialize mesaj-degiskenler
*            move " [ Aksiyon Fiyati ] " to mmesaj-title
*            move "Anlasma Fiyati:"      to mmesaj-1(01:15). 
*            move oda-fiyati             to oda-fiyati-z. 
*            move oda-fiyati-z           to mmesaj-1(16:20). 
*            move "Aksiyon Fiyati:"      to mmesaj-2(01:15). 
*            compute oda-fiyati = ((oda-fiyati * aksiyhrk-ode) / aksiyhrk-gecele). 
*            move oda-fiyati            to oda-fiyati-z. 
*            move oda-fiyati-z          to mmesaj-2(16:20). 
*
*            move 1           to mmesaj-type
*            move 3           to mmesaj-icon
*            move 1           to mmesaj-default
*             perform mmesaj-ver.
* aksiyonlu-uyar-exit. 
*       exit. 
* fiyat-bulundu. 
*       move oda-fiyati to xrez-fiyati.
*       close      fiyat fiyatana. 
* fiyat-bul-exit. 
*      exit. 
********>................!!!!!!!!!!!!!!!!!!!
********>................!!!!!!!!!!!!!!!!!!!
********>................!!!!!!!!!!!!!!!!!!!
*********************KONTROLLER*********************
***********Aramalar.........
*
 konuk-ara.
      initialize konuk-cagir.
      move "I"   to konuk-cagri-tipi
      call "/asya/ytl/obj/otel/konukara.asy"  using konuk-cagir 
          on exception
             perform callerr-proc
          not on exception
      cancel "/asya/ytl/obj/otel/konukara.asy" 
      end-call.
      move konuk-folio-cagir  to xkonuk-folio.
      display accept-folio.
 konuk-ara-exit.
       exit.
****
* kon-ara.
*      initialize konuk-cagir
*      move "H"   to konuk-cagri-tipi
*      call "/asya/ytl/obj/otel/konara.asy"
*        using konuk-cagir
*        on exception
*           perform callerr-proc
*        not on exception
*      cancel "/asya/ytl/obj/otel/konara.asy" 
*      end-call
*      stop " "
*      perform ozluk-aktar
*      .
* kon-ara-exit.
*       exit.
*                                    
*                                    
 rez-ara.
      initialize rez-cagir.
      move "I"   to rez-cagri-tipi
      call "/asya/ytl/obj/otel/rezgetir.asy" using rez-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/rezgetir.asy" 
       end-call.
       move rez-no-cagir  to xkonuk-rez-no.
       display accept-rezno.
 rez-ara-exit.
       exit.
*
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/acenara.asy" 
      end-call.
      move acenta-cagir     to xkonuk-acenta.
 acenta-oku.
       open input acenta.
       initialize acenta-rec acen-kara-list.
       move xkonuk-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            if firma-kodu  = spaces
                perform acen-dft-oku
           end-if
       end-read
       close acenta.
       if acenta-kara-liste = 1
          move 1  to acen-kara-list
          move 1        to gec-gecme
       end-if 
       move acenta-adi     to adi-goster.
       modify lb-acenta-e, title = adi-goster.
       initialize adi-goster
        if acenta-munferit = 1 
         move 1 to munferitmi
         else
          move 0 to munferitmi
        end-if 
       display accept-acenta b1 b2.


 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.
*
 firma-ara.
      initialize firma-cagir.
      call "/asya/ytl/obj/otel/firmara.asy" using firma-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/firmara.asy" 
      end-call.
      move firma-cagir     to xkonuk-firma.
 firma-oku.
       open input firma.
       initialize firma-rec.
       move xkonuk-firma   to firma-kodu
       read firma        no lock invalid
         if firma-kodu = spaces

          if acenta-tipi = 3 
            move 1        to gec-gecme
            
            
          end-if
          else
           move 1 to gec-gecme
         end-if
          
            not invalid  
            perform firma-dft-oku
       end-read
       close firma.

       move firma-adi     to adi-goster.
       modify lb-firma, title = adi-goster.
       initialize adi-goster
       display accept-firma.

 firma-oku-exit.
       exit.
 firma-ara-exit.
       exit.
*
 takvim-oku.
       open input takvim.
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close takvim.
 takvim-oku-exit.
       exit.
*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/bankaara.asy" 
      end-call.
      move banka-cagir     to xkonuk-banka.
 banka-oku.
       open input banka.
       initialize banka-rec.
       move xkonuk-banka    to banka-kodu
       read banka         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to adi-goster.
       modify lb-banka-e, title = adi-goster.
       initialize adi-goster
       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/dovizara.asy" 
      end-call.
      move doviz-cagir     to xkonuk-doviz.
 doviz-oku.
       open input doviz.
       initialize doviz-rec.
       move xkonuk-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-doviz-e, title = adi-goster.
       initialize adi-goster
       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.
       exit.
*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
           on exception perform callerr-proc
           not on exception
           cancel "/asya/ytl/obj/otel/panara.asy" 
      end-call.
      move pansiyon-kodu-cagir     to xkonuk-pan-tipi.
 pansiyon-oku.
       open input kodlar02.
       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xkonuk-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pansiyon-e, title = adi-goster.
       initialize adi-goster
       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/odemeara.asy" 
      end-call.
      move odeme-kodu-cagir     to xkonuk-odeme-tipi.
 odeme-oku.
       open input kodlar02.
       initialize kodlar02-rec.
       move "B"              to kodlar02-tipi.
       move xkonuk-odeme-tipi  to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-odeme-e, title = adi-goster.
       initialize adi-goster
       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
           on exception perform callerr-proc


           not on exception
      cancel "/asya/ytl/obj/otel/infoxara.asy" 
      end-call.
      move infox-kodu-cagir     to xkonuk-anlasma.
 anlasma-oku.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"              to kodlar02-tipi.
       move xkonuk-anlasma     to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-anlasma-e, title = adi-goster.
       initialize adi-goster
       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/pazarara.asy" 
      end-call.
      move pazar-kodu-cagir     to xkonuk-pazar.
 pazar-oku.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"              to kodlar02-tipi.
       move xkonuk-pazar       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pazar-e, title = adi-goster.
       initialize adi-goster
       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/ulkeara.asy" 
      end-call.
      move ulke-cagir     to xkonuk-ulke.
 ulke-oku.
       open input ulke ulkeek.
       initialize ulke-rec.
       move xkonuk-ulke    to ulke-anah1 ulkeek-anah1
       read ulke         no lock invalid 
            move 1       to gec-gecme
            not invalid continue 
       end-read              

       read ulkeek no lock invalid
            move low-values to ulkeek-dft-pazar
       end-read 

       if ulkeek-dft-pazar <> low-values and spaces 
          move ulkeek-dft-pazar       to xkonuk-pazar
          perform pazar-oku         thru pazar-oku-exit
       end-if

       close ulke ulkeek.
       move ulke-adi     to adi-goster.
       modify lb-ulke-e, title = adi-goster.
       initialize adi-goster
       display accept-ulke.
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.
*
 sehir-ara.
      initialize sehir-cagir.
      call "/asya/ytl/obj/otel/sehara.asy" using sehir-cagir

           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/sehara.asy" 
      end-call.
      move sehir-cagir     to xkonuk-sehir.
 sehir-oku.
       open input sehir.
       initialize sehir-rec.
       move xkonuk-sehir    to sehir-anah1
       read sehir         no lock invalid 
            
             move "Tanimsiz Sehir " to sehir-adi
       end-read
       close sehir.
       move sehir-adi     to adi-goster.
       modify lb-sehir-e, title = adi-goster.
       initialize adi-goster
       display accept-sehir.
 sehir-oku-exit.
       exit.
 sehir-ara-exit.
       exit.

 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move xkonuk-odano     to odalar-anah
       read odalar         no lock invalid 
            move 1         to gec-gecme
       not invalid 
        if odalar-aktif-pasif = 1
            move 1         to gec-gecme
        end-if 
         if odalar-hayali= "H" then
               move 1 to birles-vis
               else
               
               move 0 to birles-vis
            end-if
            display bir1 form1-ef-birles form1-birles-oda form1-birles-adi

            
             
       end-read
       close odalar.
       display accept-odano.
       perform xkonuk-oda-uzat.
 oda-oku-exit.
       exit.

*
 fiyat-degis.
     if key-status <> 1
        exit paragraph
     end-if.
    
     move rez-fiyati    to yeni-fiyat.
*********walkin cinde fiyat bul mami
           if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R"  
               and cin-tipi = 2 
               
               perform aksiyon-kontrol  thru aksiyon-kontrol-exit 
               open input takvim
               perform fiyat-bul thru fiyat-bul-exit 
               close takvim
              move oda-fiyati to yeni-fiyat
           end-if

     initialize form2-donus.
     
     perform acu-form2-routine.
     if form2-donus <> 1
        move 4 to accept-control
        move 2001 to control-id
        initialize key-status
        exit paragraph
     end-if.

     move yeni-fiyat   to rez-ucreti rez-fiyati
     initialize key-status
     perform yeni-fiyat-al-1 thru yeni-fiyat-al-exit.  
     move 4 to accept-control.
     move 2001 to control-id.
*
 Form2-Ex-Other.
     if key-status = 2 
        move 1 to form2-donus
        set exit-pushed to true
     end-if.
 staf-oku-goster.
      open input kllnc.
      initialize kllnc-rec staf-adi staf-soyadi
      move konuk-staf   to k-kodu
      read kllnc no lock invalid continue
           not invalid
      move k-adi     to staf-adi
      move k-soyadi  to staf-soyadi
      end-read.
      close kllnc.
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
*
* ozluk-aktar.
*      initialize ozluk-rec
* *     move konuk-folio-cagir to ozluk-folio ozluk2-folio
* *
*      perform ozluk-oku
*      
*      read ozluk no lock
*        invalid
*          continue
*        NOT INVALID
*           move ozluk-adi    to xkonuk-adi
*           move ozluk-soyadi to xkonuk-soyadi
*           move ozluk-rec    to xozluk-rec
*           perform ozluk-goster
*      end-read
*       move ozluk-plaka to plaka
*       display accept-plaka
*    
*       move xkonuk-folio to xozluk-folio ozluk2-folio
*      .
**
* ozluk-oku.
*      read ozluk no lock
*        invalid
*          continue
*      end-read
*      read ozluk2 no lock
*        invalid
*          continue
*      end-read
*      .
*
* ozluk-goster.
*      move ozluk-kim-turu to kim-tipi-combo-value
*     
*      display accept-adi
*              accept-soyadi
*              kim-tipi-combo
*              accept-kimlok-no
*              accept-adres1b
*              accept-dog-gun
*              accept-dog-ay
*              accept-dog-yil
*              accept-adres1ba
*              accept-ver-gun
*              accept-ver-ay
*              accept-ver-yil
*              accept-adres1c
*              accept-adres1
*              accept-adres2 
*              accept-adres2a 
*              accept-adres2aa 
*              accept-adres2aaa
*
*
*              accept-telefon
*              accept-email
*              accept-evl-gun
*              accept-evl-ay
*              accept-evl-yil
*              accept-ozl-gun
*              accept-ozl-ay
*              accept-ozl-yil
*              accept-plaka     accept-plaka accept-plaka accept-plaka4
*             
*              accept-tel-no
*              fat-frame fat-1 fat-2 fat-3 fat-4 
*              fat-5 fat-6 fat-7 fat-8
*      .
*
 komisyon-dagit. 
    perform komisyon-aksiyon
    compute dv-oda rounded = ((dv-toplam / (100 - xkonuk-nor-indirim)) * 100) * 0.65
    if dv-oda > dv-toplam
       move dv-toplam to dv-oda
    else
     compute dv-kahvalti rounded = ((dv-toplam / (100 - xkonuk-nor-indirim)) * 100) * (aksiyhrk-ode / 100)
     if dv-toplam <= dv-oda + dv-kahvalti
        compute dv-kahvalti = dv-toplam - dv-oda
     else 
        compute dv-ogle = dv-toplam - dv-oda - dv-kahvalti
     end-if
    end-if.

    initialize tl-oda tl-kahvalti tl-ogle. 
    compute tl-oda rounded = dv-oda * doviz-alis
    compute tl-kahvalti rounded = dv-kahvalti * doviz-alis
    if tl-toplam <= tl-oda + tl-kahvalti
       compute tl-kahvalti = tl-toplam - tl-oda
    else 
       compute tl-ogle = tl-toplam - tl-oda - tl-kahvalti
    end-if.
      .
*
 komisyon-aksiyon. 
         open input aksiyhrk.
         initialize aksiyhrk-rec.
         move "K"             to aksiyhrk-tipi.
         move xkonuk-acenta   to aksiyhrk-acenta. 
         move xkonuk-gel-tar  to aksiyhrk-tarih. 
         move xkonuk-pan-tipi to aksiyhrk-pan-tipi.
         move 0               to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
              initialize aksiyhrk-ode
         end-read
         close aksiyhrk.
         .
*
 Form1-Aft-Routine.
     close rez konuk ozluk ozluk2 ODALAR2
     perform kilit-aft-routine.

 eraly-booking-cb-Ex-Cmd-Clicked.
                      
         inquire eraly-booking-cb, value in sayi
              if sayi = 1 move "E" to xkonuk-eb
                  else     move "H" to xkonuk-eb
              end-if
     .
*
 liste-cik-cb-Ex-Cmd-Clicked.
     initialize sayi
     inquire liste-cik-cb, value in cik-cikma-status
     if liste-cikma move "H" to xkonuk-cik-cikma
     else           move "E" to xkonuk-cik-cikma
     end-if.
     .
*
*
*
 liste-post-cb-Ex-Cmd-Clicked.
       initialize sayi
     inquire liste-post-cb, value in nopost-status
     if nopost-cikma move "C" to xkonuk-acik-kapali
     else           move "O" to xkonuk-acik-kapali
     end-if.
     .
     .
* 
 oda-after.
           initialize gec-gecme
            perform oda-oku thru oda-oku-exit
            if gecmez 
               initialize xkonuk-odano
                  move ydk-odano to xkonuk-odano
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
            end-if
          
            if cin-tipi not = 1 
               move odalar-konumu to xkonuk-oda-konumu 
            end-if
              if not gecmez
            if cin-tipi = 2 and konuk-kayit-durumu = "Y" and
               xkonuk-fol-kodu = "R"
               
               move odalar-konumu to xkonuk-fiyat-konumu  fiyat-konumu-combo-value
               display fiyat-konumu-combo
             end-if
             end-if
            if cin-tipi = 1 and
               odalar-konumu not = xkonuk-oda-konumu 
               
               if cinpara-farkli-konuma-cin not = "E"
               initialize mesaj-degiskenler
               move " [ Oda Konumu Hatali ] " to mmesaj-title
               move "Rezervasyondaki Oda Konumu Ile " to mmesaj-1 
               move "Sectiginiz Odanin Konumu Farkli" to mmesaj-2 
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               initialize xkonuk-odano
                  move ydk-odano to xkonuk-odano
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
                   move 1 to gec-gecme
                
               end-if
            end-if
            move odalar-konumu to  xkonuk-oda-konumu 
            if konuk-kayit-durumu = "Y" 
              if xKONUK-FOL-KODU not = "E" 
                 perform blok-kont2           
                 if not gecmez
                 perform dolu-oda-kontrol thru dolu-oda-kontrol-exit
                 end-if
              end-if
               
               if gecmez
                  initialize xkonuk-odano
                  move ydk-odano to xkonuk-odano
                  display accept-odano
                  perform xkonuk-oda-uzat
                  move 1 to gec-gecme
                  exit paragraph
               else
                  move xkonuk-odano to ydk-odano
               end-if

               if genel-dolu-pm-cin-kontrol not = 1
                  perform dolu-extra-kontrol
               end-if

            end-if
            if oto-gec = 1
               exit paragraph
            end-if
            
            if cin-tipi not = 3 and 
               odalar-durumu not = house-bt and 
               konuk-kayit-durumu = "Y"
               if dolu-share  = 1 
                  initialize mesaj-degiskenler
                  move " [ Ayni Odaya Share ] " to mmesaj-title
                  move "Sectiginiz Oda Baska bir misafir ile Share  " to mmesaj-1 
                  move dolu-adi  to mmesaj-2               
                  move "Devam Etmek Istiyormusunuz E->Evet H->Hayir" to mmesaj-3 
                  move 2           to mmesaj-type
                  move 3           to mmesaj-icon
                  move 1           to mmesaj-default
                  perform mmesaj-ver
                  if donus-kodu = 2 
                     move 1 to gec-gecme
                     exit paragraph
                  end-if
               else
                  if genel-precin-aktif = 1 
                     initialize mesaj-degiskenler
                     move " [ Oda Hazir Degil ] " to mmesaj-title
                     move "Sectiginiz Odanin Statusu      " to mmesaj-1 
                     move "CHECK/IN Icin Uygun Degil Kontrol Ediniz.."  to mmesaj-2 
                     move "PRE-CHECK/IN Islemi ile Devam Etmek Istiyormusunuz E->Evet H->Hayir" to mmesaj-3 
                     move 2           to mmesaj-type
                     move 3           to mmesaj-icon
                     move 1           to mmesaj-default
                     perform mmesaj-ver
                     if donus-kodu = 2 
                        move 1 to gec-gecme
                        exit paragraph
                     else 
                        move 1 to pre-cin-ok
                     end-if
                  else
                     initialize mesaj-degiskenler
                     move " [ Oda Hazir Degil ] " to mmesaj-title
                     move "Sectiginiz Odanin Statusu      " to mmesaj-1 
                     move "CHECK/IN Icin Uygun Degil Kontrol Ediniz.."  to mmesaj-2 
                     move "Devam Etmek Istiyormusunuz E->Evet H->Hayir" to mmesaj-3 
                     move 2           to mmesaj-type
                     move 3           to mmesaj-icon
                     move 1           to mmesaj-default
                     perform mmesaj-ver
                     if donus-kodu = 2 
                        move 1 to gec-gecme
                        exit paragraph
                     end-if
                  end-if
               end-if
            end-if              
          
         
           .
 fiyat-bul.
        open input fiyat fiyatana. 
        move 0 to oda-fiyati. 
        move xkonuk-acenta        to fiyat-acenta. 
        move xkonuk-gel-tar       to fiyat-tarih. 
        move xkonuk-rez-tipi         to fiyat-rez-tipi. 
        move xkonuk-pan-tipi      to fiyat-pan-tipi. 
        move xkonuk-banka         to fiyat-banka. 
        move xkonuk-doviz         to fiyat-doviz. 
        move xkonuk-anlasma       to fiyat-anlasma. 
        move xkonuk-buyuk         to fiyat-buyuk.
        move xkonuk-kucuk         to fiyat-kucuk.
        read fiyat no lock invalid go fiyat-bulundu.
 
             move fiyat-acenta    to fiyatana-acenta. 
             move fiyat-bas-tarih to fiyatana-ilk-tarih.
             move fiyat-bit-tarih to fiyatana-son-tarih.
             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
             move fiyat-banka     to fiyatana-banka. 
             move fiyat-doviz     to fiyatana-doviz. 
             move fiyat-anlasma   to fiyatana-anlasma. 
             move fiyat-buyuk     to fiyatana-buyuk.
             move fiyat-kucuk     to fiyatana-kucuk.

             read fiyatana no lock invalid go fiyat-bulundu.
           
********>Early Booking kontrol
             perform eb-varsa-uyar.
             perform ug-varsa-uyar.
             perform cift-indirim-uyar.
       move fiyatana-oda-fiyati(xkonuk-fiyat-konumu) to oda-fiyati. 

*/********* 
       if xkonuk-nor-indirim not = 0 
       compute oda-fiyati = 
              (((oda-fiyati * xkonuk-nor-indirim) / 100) - oda-fiyati)
       end-if.
*/Early booking orani var ve early booking uygulanacak ise 
       if xkonuk-eb = "E" and fiyatana-eb-oran not = 0 
       compute oda-fiyati = 
              (((oda-fiyati * (fiyatana-eb-oran +( fiyatana-eb-kusur / 100) )) / 100) - oda-fiyati)
       end-if. 
       if  fiyatana-ug-oran not = 0 and gun-s >= fiyatana-ug-geceleme 
           and xkonuk-ug-indirimi = 1 then  
       compute oda-fiyati = 
              (((oda-fiyati * (fiyatana-ug-oran + (fiyatana-ug-kusur / 100))) / 100) - oda-fiyati)
       end-if. 
       
*/Kick back orani
       if fiyatana-kick-back <> 0
       compute oda-fiyati  = 
              (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
       end-if.
       move oda-fiyati to xrez-fiyati. 
       compute xrez-fiyati rounded = oda-fiyati * 1.
 aksiyonlu-uyar. 
       if aksiyon-var 
          continue
       else 
          go fiyat-bulundu
       end-if. 
            initialize mesaj-degiskenler
            move " [ Aksiyon Fiyati ] " to mmesaj-title
            move "Anlasma Fiyati:"      to mmesaj-1(01:15). 
            move oda-fiyati             to oda-fiyati-z. 
            move oda-fiyati-z           to mmesaj-1(16:20). 
            move "Aksiyon Fiyati:"      to mmesaj-2(01:15). 
            if aksiyhrk-sondan = 1 and fiyatana-fiks = 0 
                and Xkonuk-FIYAT-FIX not = "E"  then 
                  perform aksiyon-toplam-bul
                else 
                  compute aksiyonlu-toplam = 
                            oda-fiyati * aksiyhrk-ode
            end-if
*            if xkonuk-aksiyon-eh not = "H"
               
               compute oda-fiyati rounded = ((aksiyonlu-toplam) / aksiyhrk-gecele)
               move oda-fiyati            to oda-fiyati-z
*            else
*               compute oda-fiyati-z = ((aksiyonlu-toplam) / aksiyhrk-gecele)
*            end-if.
************move oda-fiyati            to oda-fiyati-z. 
            move oda-fiyati-z          to mmesaj-2(16:20). 

            move 1           to mmesaj-type
            move 1           to mmesaj-icon
            move 1           to mmesaj-default
             perform mmesaj-ver.
 aksiyonlu-uyar-exit. 
       exit. 
 fiyat-bulundu. 
       move oda-fiyati to xrez-fiyati.
       compute xrez-fiyati rounded = oda-fiyati * 1.
       close      fiyat fiyatana. 
 fiyat-bul-exit. 
       exit. 
*
 cift-indirim-uyar.
    perform gun-bul
    if xkonuk-ug-indirimi = 1 
       if not (fiyatana-ug-oran > 0 and gun-s >= fiyatana-ug-geceleme) 
           display message box
               " Uzun geceleme indirimini kapsamiyor ve kaldirilacak "
               move 0 to xkonuk-ug-indirimi
                      display eraly-booking-cba
        end-if
    end-if
    if xkonuk-eb = "E" 
       if  not (fiyatana-eb-oran > 0 )
           display message box
               " EB indirimini kapsamiyor ve kaldirilacak "
                      modify eraly-booking-cb, value = 0
                      move "H" to xkonuk-eb
        end-if
    end-if
    initialize ind-sayi
    
    if aksiyon-var    add 1 to ind-sayi end-if
    if xkonuk-ug-indirimi = 1    add 1 to ind-sayi end-if
    if xkonuk-eb = "E"  add 1 to ind-sayi end-if
    if ind-sayi > 1 then 
        display message box 
             "Bu Rezervasyon icin Aksiyon - Uzun Geceleme - EB indirimlerinden " new-line
             "en az 2 tanesi uygulanmis kontrol ediniz."
       end-if.
*
 ug-varsa-uyar.
      if fiyatana-ug-oran > 0 and gun-s >= fiyatana-ug-geceleme 
          and xkonuk-ug-indirimi = 0 then 
               initialize mesaj-degiskenler
                   move " [ Uzun Geceleme Indirimini Kapsayan Rez ] " to mmesaj-title
                   move " Bu Rezervasyon Uzun Geceleme Indirimi Sartlarini Sagliyor  " to mmesaj-1
                   move " UZUN GECELEME SECENEGI CHECH EDILSIN MI ?? " to mmesaj-2 
                   move " ..... [ E->Check Et H->Check Iptal I->Iptal ]  ........ " to mmesaj-3 
                   move 4           to mmesaj-type
                   move 1           to mmesaj-icon
                   move 3           to mmesaj-default
                   perform mmesaj-ver
                   if donus-kodu = 1
                      move 1 to xkonuk-ug-indirimi
                      display eraly-booking-cba
                   end-if
      end-if .
*
 eb-varsa-uyar.
                accept sys-tar from century-date 
                   move sys-yil to xrez-isl-yil
                   move sys-ay  to xrez-isl-ay 
                   move sys-gun to xrez-isl-gun 
                if fiyatana-eb-oran not = 0 
                   and sys-tar not < fiyatana-eb-bas-tarih  and
                       sys-tar not > fiyatana-eb-bit-tarih  and xkonuk-eb not = "E"   
                   initialize mesaj-degiskenler
                   move " [ Early Booking Rezervasyon ] " to mmesaj-title
                   move " GIRDIGINIZ RERVASYON BU TARIH ITIBARIYLE E/B ICERIYOR.. " to mmesaj-1
                   move " EARLY BOOKING SECENEGI CHECH EDILSIN MI  ............?? " to mmesaj-2 
                   move " ..... [ E->Check Et H->Check Iptal I->Iptal ]  ........ " to mmesaj-3 
                   move 4           to mmesaj-type
                   move 1           to mmesaj-icon
                   move 3           to mmesaj-default
                   perform mmesaj-ver
                   if donus-kodu = 1
                      modify eraly-booking-cb, value = 1
                      move "E" to xkonuk-eb
                   end-if
                end-if 
           . 
 eb-varsa-uyar-exit.
    exit.
 gun-bul.
     initialize gun-s

     move Xkonuk-gel-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= Xkonuk-git-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      end-if 
                end-read
              end-perform  
      end-start.
      move gun-s to gun-say
      display la-gun
      .
*
 aksiyon-toplam-bul.
        initialize aksiyonlu-toplam
        move xkonuk-gel-tar to takvim-anah
        start takvim key not < takvim-anah 
           invalid 
              display message box "Takvim Bulunamadi"
            not invalid 
                perform varying i from 1 by 1 until i > aksiyhrk-ode
                 read takvim next no lock
                    end 
                       exit perform
                   not end 
                     perform gunluk-bul
                     add oda-fiyati to aksiyonlu-toplam
                  end-read  
                 end-perform
         end-start.
          .
*
 gunluk-bul.
        move 0 to oda-fiyati. 
        move xkonuk-acenta        to fiyat-acenta. 
        move takvim-anah          to fiyat-tarih. 
        move xkonuk-rez-tipi      to fiyat-rez-tipi. 
        move xkonuk-pan-tipi      to fiyat-pan-tipi. 
        move xkonuk-banka         to fiyat-banka. 
        move xkonuk-doviz         to fiyat-doviz. 
        move xkonuk-anlasma       to fiyat-anlasma. 
        move xkonuk-buyuk         to fiyat-buyuk.
        move xkonuk-kucuk         to fiyat-kucuk.
        read fiyat no lock invalid 
        close fiyat fiyatana
        exit paragraph.
 
             move fiyat-acenta    to fiyatana-acenta. 
             move fiyat-bas-tarih to fiyatana-ilk-tarih.
             move fiyat-bit-tarih to fiyatana-son-tarih.
             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
             move fiyat-banka     to fiyatana-banka. 
             move fiyat-doviz     to fiyatana-doviz. 
             move fiyat-anlasma   to fiyatana-anlasma. 
             move fiyat-buyuk     to fiyatana-buyuk.
             move fiyat-kucuk     to fiyatana-kucuk.
             read fiyatana no lock invalid 
             close fiyat fiyatana
             exit paragraph .

       move fiyatana-oda-fiyati(xkonuk-fiyat-konumu) to oda-fiyati. 
*/********* 
       if xkonuk-nor-indirim not = 0 
       compute oda-fiyati = 
              (((oda-fiyati * xkonuk-nor-indirim) / 100) - oda-fiyati)
       end-if.
*/Early booking orani var ve early booking uygulanacak ise 
       if xkonuk-eb = "E" and fiyatana-eb-oran not = 0 
       compute oda-fiyati = 
              (((oda-fiyati * fiyatana-eb-oran) / 100) - oda-fiyati)
       end-if. 
*/Kick back orani
       if  fiyatana-ug-oran not = 0 and gun-s > fiyatana-ug-geceleme  
           and xkonuk-ug-indirimi =1 then
       compute oda-fiyati = 
              (((oda-fiyati * fiyatana-ug-oran) / 100) - oda-fiyati)
       end-if. 
       
       if fiyatana-kick-back <> 0
       compute oda-fiyati  = 
              (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
       end-if.
*
 bilbord-dus. 
      open i-o bilbord takvim. 
  
      move rez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
            continue
         not invalid
         perform until fs-takvim = "10"
           read takvim next no lock end 
                   move "10" to fs-takvim
                not end
                 if takvim-anah >= rez-cik-tar 
                    move "10" to fs-takvim
                 else
                   initialize bilbord-rec
                   move rez-acenta      to bilbord-acenta 
                   move takvim-anah      to bilbord-tarih 
                   move rez-fiyat-konumu  to bilbord-oda-tip 
                   read bilbord no lock invalid 
                       initialize bilbord-rec
                       move rez-acenta      to bilbord-acenta
                       move takvim-anah      to bilbord-tarih 
                       move rez-fiyat-konumu  to bilbord-oda-tip 
                       write bilbord-rec invalid 
                           display message box "Bilborda yazilamadi hata no : bil-1001"
                       end-write
                    end-read
                    if bilbord-sat-oda > 0
                      compute  bilbord-sat-oda   = bilbord-sat-oda   - 1
                    end-if 
                    if bilbord-sat-buyuk > 0
                       compute  bilbord-sat-buyuk = bilbord-sat-buyuk - srez-buyuk
                    end-if 
                    rewrite bilbord-rec invalid 
                         display message box "Bilborda yazilamdi hata no : bil-1002"
                    end-rewrite
                end-if
              end-read
            end-perform
         end-start
      close bilbord takvim.
*

 bilbord-ekle. 
      open i-o bilbord takvim. 
      move rez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
            continue
         not invalid
         perform until fs-takvim = "10"
           read takvim next no lock end 
                   move "10" to fs-takvim
                not end
               
                 if takvim-anah >= rez-cik-tar 
                    move "10" to fs-takvim
                 else
                   initialize bilbord-rec
                   move rez-acenta      to bilbord-acenta 
                   move takvim-anah      to bilbord-tarih 
                   move rez-fiyat-konumu  to bilbord-oda-tip

                   read bilbord no lock invalid 
                       initialize bilbord-rec
                       move rez-acenta      to bilbord-acenta
                       move takvim-anah      to bilbord-tarih 
                       move rez-fiyat-konumu  to bilbord-oda-tip 
                       write bilbord-rec invalid 
                           display message box "Bilborda yazilamadi hata no : bil-1001"
                       end-write
                    end-read
                    compute  bilbord-sat-oda   = bilbord-sat-oda   + 1 
                    compute  bilbord-sat-buyuk = bilbord-sat-buyuk + rez-buyuk
                    rewrite bilbord-rec invalid 
                         display message box "Bilborda yazilamdi hata no : bil-1002"
                    end-rewrite
                end-if
              end-read
            end-perform
         end-start
      close bilbord takvim.
*
*
 bilbord-cb-Ex-Cmd-Clicked.
    
       if key-status = 5464 
       evaluate control-id
         when 95
              inquire bilbord-cb, value in sayi
              if sayi = 1 move "E" to xkonuk-bilbord-eh
                 else     move "H" to xkonuk-bilbord-eh
              end-if
        end-evaluate
        else 
        perform exception-procedure
        end-if.
     .
*
*
 Form1-Ef-1b-Ev-Ntf-Changed.
     .
*
 aks-Cmd-Clicked.
        if aks-yok = 1 then 
           move "H" to xkonuk-aksiyon-eh
        else 
           move "E" to xkonuk-aksiyon-eh
       end-if
     .
********************* kart.asy
 extra-kart-tanimla.
     if cost-sirketi not = spaces 
        initialize dokcagir-tasi
        set dokcagir-tasi-call-kart3   to true
        move konuk-folio               to dokcagir-konuk-folio
        move rez-extra-kart            to dokcagir-rez-extra-kart
        move "1"                       to dokcagir-kart-filler
        perform dokcagir-call
        move dokcagir-konuk-folio      to konuk-folio
        move dokcagir-rez-extra-kart   to rez-extra-kart
      end-if
         .
 extra-kart-tanimla2.
     if cost-sirketi not = spaces
        initialize dokcagir-tasi
        set dokcagir-tasi-call-kart3   to true
        move konuk-folio               to dokcagir-konuk-folio
        move rez-extra-kart2           to dokcagir-rez-extra-kart
        move "1"                       to dokcagir-kart-filler
        perform dokcagir-call
        move dokcagir-konuk-folio      to konuk-folio
        move dokcagir-rez-extra-kart   to rez-extra-kart2
        end-if.
         .

 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 hat-ac.
     open input telkod 
     initialize telayarq-dosya-adi telayar-rec telayarq-rec
*      move xkonuk-odano to telayarq-dosya-adi
*      move ".tay"       to telayarq-dosya-adi(5:4)
     if function numval(xkonuk-odano) < 1000
        move xkonuk-odano to telayarq-dosya-adi(1:3)
        move ".tay" to telayarq-dosya-adi(4:4)
     else 
       move xkonuk-odano to telayarq-dosya-adi
       move ".tay" to telayarq-dosya-adi(5:4)

     end-if 

     open output telayarq  
     open i-o telayar
     if TELPARA-dishat-ac-kapa-dahili = 1
        initialize telkod-rec kayit-var
        start telkod key not < telkod-anah invalid 
            continue 
        not invalid 
        perform with test after until fs-telkod = "10"
        read telkod next no lock end move "10" to fs-telkod
        not at end 
                if tel-onb-oda = xkonuk-odano
                    move TEL-ODA to telayarq-odano  telayar-odano
                    move 1       to kayit-var
                else
                   exit perform cycle 
                end-if 
        end-read 
        end-perform
        end-start
        if kayit-var not = 1 
           move xkonuk-odano to telayarq-odano  telayar-odano 
        end-if 
     else
        move xkonuk-odano to telayarq-odano  telayar-odano 
     end-if 
     if xkonuk-folio > 0 then 
        move xkonuk-folio to  telayar-folio   telayarq-folio
     end-if

     move xkonuk-adi  to telayar-adi telayarq-adi
     move xkonuk-soyadi  to telayar-soy telayarq-soy
     
     accept telayar-tarih from century-date 
     accept telayar-saat from time 
     move telayar-saat to telayarq-saat 
     move telayar-tarih to telayarq-tarih  

     if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
        move  telayarq-odano(2:) to telayarq-odano(1:)
        move " " to   telayarq-odano(4:1) 
     end-if
      if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
        move  telayar-odano(2:) to telayar-odano(1:)
        move " " to   telayar-odano(4:1) 
     end-if
     move "A " to telayar-islem telayarq-islem 
     write telayar-rec invalid continue end-write
     write telayarq-rec  end-write
     close telayarq

     if function numval(konuk-odano) < 1000
        move ".may" to telayarq-dosya-adi(4:4)
     else 
        move ".may" to telayarq-dosya-adi(5:4)
     end-if 
       
     open output telayarq 
     write telayarq-rec  end-write
     close telayar telkod telayarq.
* 
 hat-kapat.
     open input telkod
     initialize telayarq-dosya-adi telayar-rec telayarq-rec
*     move xkonuk-odano to telayarq-dosya-adi
*     move ".tay" to telayarq-dosya-adi(5:4)
     if function numval(xkonuk-odano) < 1000
        move xkonuk-odano to telayarq-dosya-adi(1:3)
        move ".tay" to telayarq-dosya-adi(4:4)
     else 
       move xkonuk-odano to telayarq-dosya-adi
       move ".tay" to telayarq-dosya-adi(5:4)
     end-if 

     open output telayarq  
     open i-o telayar
     if TELPARA-dishat-ac-kapa-dahili = 1
        initialize telkod-rec kayit-var
        start telkod key not < telkod-anah invalid 
            continue 
        not invalid 
        perform with test after until fs-telkod = "10"
        read telkod next no lock end move "10" to fs-telkod
        not at end 
                if tel-onb-oda = xkonuk-odano
                    move TEL-ODA to telayarq-odano  telayar-odano
                    move 1       to kayit-var
                else
                   exit perform cycle 
                end-if 
        end-read 
        end-perform
        end-start

        if kayit-var not = 1
           move xkonuk-odano to telayarq-odano  telayar-odano 
        end-if 

     else                    
        move xkonuk-odano to telayarq-odano  telayar-odano 
     end-if  

     if xkonuk-folio > 0 then 
        move xkonuk-folio to  telayar-folio   telayarq-folio
     end-if

     accept telayar-tarih from date 
     accept telayar-saat from time 
     move telayar-saat to telayarq-saat 
     move telayar-tarih to telayarq-tarih  
     move "K " to telayar-islem telayarq-islem 

     if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
         move  telayarq-odano(2:) to telayarq-odano(1:)
         move " " to   telayarq-odano(4:1) 
     end-if

     if TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
        move  telayar-odano(2:) to telayar-odano(1:)
        move " " to   telayar-odano(4:1) 
     end-if

     write telayar-rec invalid continue end-write
     write telayarq-rec  end-write
     close telayarq

     if function numval(xkonuk-odano) < 1000
        move ".may" to telayarq-dosya-adi(4:4)
     else 
        move ".may" to telayarq-dosya-adi(5:4)
     end-if             

     open output telayarq 
     write telayarq-rec  end-write
     close telayar telkod telayarq .

*
 silinen-konuk.
      open i-o skonuk nt
      move konuk-rec to skonuk-rec
      move tarih-tasi to skonuk-otel-tar
      accept skonuk-gercek-tar from century-date
      accept skonuk-gercek-zaman from time
      move k-kodu-tasi to skonuk-silen-staf
      write skonuk-rec invalid rewrite skonuk-rec end-write

        initialize not-rec
            move  "SKN"      to NOT-DOS
           move skonuk-anah to  NOT-DOS-ANAH 
          
           read nt no lock invalid 
                initialize not1
           end-read
           move neden-silindi to not1 
   
             write not-rec invalid 
                 continue 
             end-write

      close skonuk nt.


*
 acuserve-adres-aktar.

    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres       
                         
                         REFERANS-DOSYA-adres     
                         mgenel-DOSYA-adres       
                       
                        
            

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA  
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.
  
    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    

    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values
    . 
 cari-after.
        if ozluk2-cari = spaces then 
            initialize label-cari
            display l-cari
            else
             if muha-sirketi = spaces exit paragraph end-if
                open input hesap cari
              move    ozluk2-cari  to hesap-kodu cari-kodu
              read hesap no lock invalid 
                modify l-cari color = 33037
                move "Tanimsiz  Hesap" to hesap-adi
                not invalid 
                modify l-cari color = 33034
                if ozluk2-fat-unvan-1  = spaces and ozluk2-fat-unvan-1  = spaces
                   read cari no lock invalid 
                      continue
                     not invalid
                     move C-UNVAN-1        to    OZLUK2-FAT-UNVAN-1     
                     move C-UNVAN-2        to    OZLUK2-FAT-UNVAN-2     
                     move C-ADRES-1        to    OZLUK2-FAT-ADRES-1     
                     move C-ADRES-2        to    OZLUK2-FAT-ADRES-2     
                     move  C-IL-ILCE       to    OZLUK2-FAT-IL-ILCE     
                     move  C-ULKE          to    OZLUK2-FAT-ULKE        
                     move  C-VERGI-DAIRE   to    OZLUK2-FAT-VERGI-DAIRE 
                     move  C-VERGI-NO      to    OZLUK2-FAT-VERGI-NO    
                    
                     display fat-1 fat-2 fat-3 fat-4 fat-5 fat-6 fat-7 fat-8
         
                    end-read
                end-if
             end-read
             move hesap-adi to label-cari
              display l-cari
              close hesap cari
      end-if        
              
              
              .
*
 bagli-goster.
       
      if bagli-rez = zeros
         initialize bagli-oda bagli-adi 
         display bagli-oda-acc bagli-adi-acc

         else
         move bagli-rez to rez-no
         
         read rez no lock invalid
            initialize   bagli-rez

           initialize bagli-oda bagli-adi 
            display bagli-rez-acc bagli-oda-acc bagli-adi-acc
            not invalid
              move rez-odano to bagli-oda
              string rez-adi delimited by "  "
                 " " delimited by size
                 rez-soyadi delimited by "  "
                 into bagli-adi
              
         end-read
         
         
      end-if
       display bagli-oda-acc bagli-adi-acc bagli-rez-acc bir1a
     .
*
*
 birles-goster.
     perform oda-oku
      if birles-oda = zeros
         initialize birles-oda birles-adi 
         display form1-birles-oda form1-birles-adi
         else
         move ozluk2-birles-folio to konuk-folio
         
         read konuk no lock invalid
            initialize   ozluk2-birles-folio

           initialize birles-oda birles-adi   
            display form1-birles-oda form1-birles-adi form1-ef-birles
            not invalid
              move konuk-odano to birles-oda
              string konuk-adi delimited by "  "
                 " " delimited by size
                 konuk-soyadi delimited by "  "
                 into birles-adi
              display form1-birles-oda form1-birles-adi
         end-read
         move xkonuk-folio to konuk-folio
         read konuk no lock invalid
            continue

           
         end-read
         
      end-if .
     
*
 ozel-after.
       open input kodlar02.
       initialize kodlar02-rec.
       move "Z"                to kodlar02-tipi.
       move yrez-ozel-durum    to kodlar02-kodu
       read kodlar02         no lock invalid 
            continue
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to ozel-adi-goster.
       modify lb-anlasma-ea,   title = ozel-adi-goster.
       move kodlar02-sayisal   to yrez-ozel-durum-car
       move kodlar02-ozl-tipi  to yREZ-ozel-tip 
       display accept-anlasma.


     .
*
 ozel-ara.
      initialize odeme-cagir.
      move "Z"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/ozelara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ozelara.asy" 
       end-call.
       move odeme-kodu-cagir     to yrez-ozel-durum.
       display accept-anlasmaa.
*
 Form2-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*    

*
 git-yaz.
      if yrez-git-sirket not = spaces 
           open input isyeri
                  move yrez-git-sirket to isyeri-no
                  read isyeri no lock invalid
                    continue
                    not invalid
                    move ISYERI-UNVAN to git-sir-adi
                    display lb-git

                  end-read
         close isyeri 
         end-if.


*
 gel-yaz.
       if yrez-gel-sirket not = spaces 
          open input isyeri
                  move yrez-gel-sirket to isyeri-no
                  read isyeri no lock invalid
                    continue
                    not invalid
                    move ISYERI-UNVAN to gel-sir-adi
                    display lb-gel

                  end-read
         close isyeri
         end-if.     
     .
*
 AD-DEG.
      EVALUATE CONTROL-ID
        
           

         WHEN 63
            
            

            move 3    to hangi-profil
            perform profil-goster
         when 66
            
            move 4    to hangi-profil
            perform profil-goster
         when 75
            move 5    to hangi-profil
            perform profil-goster

         when 170
            move 6    to hangi-profil
            perform profil-goster
         when 178
            move 7    to hangi-profil
            perform profil-goster
         when 281
            move 8    to hangi-profil
            perform profil-goster
         when 284
            move 9    to hangi-profil
            perform profil-goster

        
        

      END-EVALUATE
     .
 on-odeme-isle.     
    OPEN I-O GENELFIS. 
    MOVE 1 TO GENELFIS-ANAHTAR. 
    READ GENELFIS NO LOCK INVALID 
         INITIALIZE GENELFIS-REC MOVE 1 TO GENELFIS-ANAHTAR. 
    ADD 1 TO CEKGIR-OTO. 
    MOVE CEKGIR-OTO TO ROMHRK-ISLEM. 
    REWRITE GENELFIS-REC INVALID WRITE GENELFIS-REC END-WRITE. 
    CLOSE GENELFIS. 
    OPEN I-O ROMHRK hrk2 yromhrk. 
    INITIALIZE ROMHRK-REC. 
    MOVE "H"           TO ROMHRK-ISLEM-TIPI. 
    move konuk-folio to romhrk-folio
    move tarih-tasi to romhrk-tarih
    MOVE ONKPARA-DEPOZIT      TO ROMHRK-DEPKOD. 
    MOVE CEKGIR-OTO    TO ROMHRK-ISLEM. 
    MOVE "A"           TO ROMHRK-BA. 
    compute romhrk-tl-tutar rounded = rez-on-odeme * konuk-kur-degeri
    open input kur
     MOVE tarih-tasi TO KUR-TARIH. 
      MOVE ONKPARA-BANKA   TO KUR-BANKA. 
      MOVE ONKPARA-DOVIZ   TO KUR-DOVIZ. 
      READ KUR NO LOCK INVALID 
         move 1 to doviz-alis
         end-read
    COMPUTE ROMHRK-DV-TUTAR rounded = ROMHRK-TL-TUTAR / doviz-alis.  
    ACCEPT ROMHRK-ZAMAN FROM TIME. 
    MOVE K-KODU-TASI   TO ROMHRK-STAF. 
    WRITE ROMHRK-REC INVALID CONTINUE. 
      move ROMHRK-REC  to yromhrk-rec
         move hrk2-data to yromhrk-data
         write yromhrk-rec invalid stop " " end-write 

          move romhrk-anah to hrk2-anah
          move yromhrk-folio to hrk2-kaynak-folio
          write hrk2-rec end-write




    CLOSE ROMHRK yromhrk hrk2. 
     close kur
    
        compute    xKONUK-TOP-ALAC = xKONUK-TOP-ALAC + ROMHRK-TL-TUTAR 

       OPEN I-O ONKASA.
       MOVE ROMHRK-TARIH    TO ONKASA-TARIH.
       MOVE ROMHRK-DEPKOD   TO ONKASA-DEP.
       READ ONKASA NO LOCK INVALID 
          MOVE ROMHRK-TL-TUTAR TO ONKASA-TUTAR-TL
          MOVE ROMHRK-DV-TUTAR TO ONKASA-TUTAR-DV
           WRITE ONKASA-REC INVALID REWRITE ONKASA-REC END-WRITE
           not invalid
      COMPUTE ONKASA-TUTAR-TL   = ONKASA-TUTAR-TL + ROMHRK-TL-TUTAR
       COMPUTE ONKASA-TUTAR-DV   = ONKASA-TUTAR-DV + ROMHRK-DV-TUTAR
       REWRITE ONKASA-REC INVALID WRITE ONKASA-REC END-REWRITE
        end-read

       CLOSE ONKASA.
       display message box "On odeme islendi" new-line
                           "Kontrol Ediniz.."
                       title "Uyari"
                       icon 1.

*
 profil-cagir.
       move xkonuk-rez-no                   to aranan-rez-no
       move isyeri-adres-tasi         to bulunan-rez-sirketi
       
       call "/asya/ytl/obj/otel/profbul.asy" using profbul-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/profbul.asy" 
       end-call
       if secildi = 9 
            move 4 to accept-control
            move 1021 to control-id
            exit paragraph 
       end-if
       perform ortak-profil-yaz
       if secildi not = 9
                   move 4 to accept-control
            move 1021 to control-id
            exit paragraph 
       end-if .
*
 ortak-profil-yaz.
    
      if secildi = 5 then 
         
         perform yanrez-oku

       end-if      
       if secildi = 1 or 
          secildi = 2 OR 
          secildi = 3
          open i-o yanrez
          initialize yanrez-rec
          move xkonuk-rez-no            to yanrez-rezno
          move yan-kac            to yanrez-sirano
          read yanrez no lock invalid
              continue
          end-read
           if secildi = 2
             initialize musteri-rec         
          end-if

          if secildi = 1 or secildi = 3                
            move bulunan-profil-sirket to musteri-sirket   
            move bulunan-profil-no     to musteri-no
            open input musteri
              read musteri no lock invalid
                  display message box "Lutfen Ant-Bim Bilgisayari Arayiniz.." 
                                  title "[ uyari ]"
                                  icon 1
              not invalid


                  move musteri-adi to yanrez-adi 
                  move musteri-soyadi to yanrez-soyadi 
                  move musteri-d-tarihi to yanrez-dog-tar
              end-read
              close musteri 
          end-if
         
          evaluate yan-kac
          when 1
            move bulunan-profil-no       to mis-no yanrez-profil-no
            move bulunan-profil-sirket   to ps1    yanrez-profil-sirket
           
            move xkonuk-adi                           to yanrez-adi  
            move xkonuk-soyadi                        to yanrez-soyadi

               if secildi = 1 or secildi = 3  
                 move musteri-adi to xkonuk-adi yanrez-adi
                 move musteri-soyadi to xkonuk-soyadi yanrez-soyadi 
*                 move musteri-gelis-sayisi to xkonuk-gelis-sayisi  
               end-if
            move yanrez-adi                        to   xkonuk-adi
            move yanrez-soyadi                      to  xkonuk-soyadi 
            display acc-mis-no acc-ps1 accept-adi accept-soyadi accept-gelis-sayisi
          when 2
              move bulunan-profil-no       to pno2 yanrez-profil-no    
              move bulunan-profil-sirket   to ps2  yanrez-profil-sirket
              if secildi = 1 or secildi = 3 
                 move yanrez-adi                        to   adi2         
                 move yanrez-soyadi                      to   soy2 
                move yanrez-dog-tar  to d-tar2
             end-if
            display acc-pno2  acc-ps2    l-d-gun2 l-d-ay2 l-d-yil2 l-adi2 l-soy2
          when 3
            move bulunan-profil-no       to pno3 yanrez-profil-no    
            move bulunan-profil-sirket   to ps3  yanrez-profil-sirket
             if secildi = 1 or secildi = 3
            move  yanrez-adi     to adi3                           
            move  yanrez-soyadi to   soy3
             move yanrez-dog-tar  to d-tar3 
             end-if 
            display acc-pno3 acc-ps3   l-d-gun3 l-d-ay3 l-dyil3  l-adi3 l-soy3
          when 4
            move bulunan-profil-no       to pno4  yanrez-profil-no    
            move bulunan-profil-sirket   to ps4   yanrez-profil-sirket
             if secildi = 1 or secildi = 3
            move  yanrez-adi     to adi4                           
            move  yanrez-soyadi to   soy4 
             move yanrez-dog-tar  to d-tar4
             end-if
            display acc-pno4 acc-ps4   l-d-gun4 l-d-ay4 l-d-yil4 l-adi4 l-soy4
          when 5
            move bulunan-profil-no       to pno5  yanrez-profil-no    
            move bulunan-profil-sirket   to ps5   yanrez-profil-sirket
             if secildi = 1 or secildi = 3
             move  yanrez-adi     to adi5                           
             move  yanrez-soyadi to   soy5 
              move yanrez-dog-tar  to d-tar5
              end-if
            display acc-pno5 acc-ps5  l-d-gun5 l-d-ay5 l-d-yil5  l-adi5 l-soy5
          when 6
            move bulunan-profil-no       to pno6  yanrez-profil-no    
            move bulunan-profil-sirket   to ps6   yanrez-profil-sirket
              if secildi =1 or secildi = 3
            move  yanrez-adi     to adi6                          
            move  yanrez-soyadi to   soy6 
            move yanrez-dog-tar  to d-tar6
            end-if
            display acc-pno6  acc-ps6  l-d-gun6 l-d-ay6 l-d-yil6   l-adi6 l-soy6
          when 7
            move bulunan-profil-no       to pno7  yanrez-profil-no    
            move bulunan-profil-sirket   to ps7   yanrez-profil-sirket
              if secildi =1 or secildi = 3
            move  yanrez-adi     to adi7                           
            move  yanrez-soyadi to   soy7
            move yanrez-dog-tar  to d-tar7
            end-if
            display acc-pno7 acc-ps7 l-d-gun7 l-d-ay7 l-d-yil7 l-adi7 l-soy7
          when 8
            move bulunan-profil-no       to pno8  yanrez-profil-no    
            move bulunan-profil-sirket   to ps8   yanrez-profil-sirket
              if secildi =1 or secildi = 3
            move  yanrez-adi     to adi8                           
            move  yanrez-soyadi to   soy8
            move yanrez-dog-tar  to d-tar8
            end-if
            display acc-pno8 acc-ps8 l-d-gun8 l-d-ay8 l-d-yil8 l-adi8 l-soy8
          when 9
            move bulunan-profil-no       to pno9  yanrez-profil-no    
            move bulunan-profil-sirket   to ps9   yanrez-profil-sirket
              if secildi =1 or secildi = 3
            move  yanrez-adi     to adi9                           
            move  yanrez-soyadi to   soy9
            move yanrez-dog-tar  to d-tar9
            end-if
            display acc-pno9 acc-ps9 l-d-gun9 l-d-ay9 l-d-yil9 l-adi9 l-soy9
          end-evaluate
              write yanrez-rec invalid rewrite yanrez-rec end-rewrite end-write 
              perform log-operation-yanrez
         close yanrez 
       end-if.


*
 acc-mis-no-Ev-Cmd-Goto.
        if ps1 = zeroes or ps1 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id
             exit paragraph
        end-if

        initialize mis-cagir
        move mis-no to mis-no-cagir2
        move ps1    to mis-sirket-cagir
        move 2      to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 1     to yan-kac
      
       if mis-kayit = 1 
            move 1 to secildi
            move mis-sirket-cagir       to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
            perform ortak-profil-yaz
       end-if
       move 1  to musteriden-geldi.
        
*
 acc-pno2-Ev-Cmd-Goto.
        if ps2 = zeroes or ps2 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno2 to mis-no-cagir2
        move ps2  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 2     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno3-Ev-Cmd-Goto.
        if ps3 = zeroes or ps3 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno3 to mis-no-cagir2
        move ps3  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 3     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno4-Ev-Cmd-Goto.
        if ps4 = zeroes or ps4 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno4 to mis-no-cagir2
        move ps4  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 4     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno5-Ev-Cmd-Goto.
        if ps5 = zeroes or ps5 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno5 to mis-no-cagir2
        move ps5  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 5     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2         to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno6-Ev-Cmd-Goto.
        if ps6 = zeroes or ps6 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno6 to mis-no-cagir2
        move ps6  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 6     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno7-Ev-Cmd-Goto.
        if ps7 = zeroes or ps7 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno7 to mis-no-cagir2
        move ps7  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 7     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
           perform ortak-profil-yaz
       end-if.
*
 acc-pno8-Ev-Cmd-Goto.
        if ps8 = zeroes or ps8 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno8 to mis-no-cagir2
        move ps8  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 8     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
           perform ortak-profil-yaz
       end-if.
*
 acc-pno9-Ev-Cmd-Goto.
        if ps9 = zeroes or ps9 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             move 4 to accept-control
             move 1020 to control-id

             exit paragraph
        end-if

        initialize mis-cagir
        move pno9 to mis-no-cagir2
        move ps9  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 9     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
           perform ortak-profil-yaz
       end-if.
  
*
 hes-gonder.
    if key-status not = 2 then 
     Display message box
     new-line   new-line "Anlasma fiyatlarini yeniden hesaplamak uzeresiniz" new-line
                          "Bu islem Bugun ve ileride basilacak fiyatlari degistirecektir        " new-line   new-line
                           new-line
                          "Devam etmek istediginize emin misiniz ? " title "UYARI" icon 2 type 2 
                          default 2 giving sonuc
            if sonuc = 2 then 
              exit paragraph
           end-if
     end-if
     if xkonuk-rez-no > 0 then 
         move xkonuk-rez-no to rez-no       
        read rez no lock invalid 
            display message box "Rezervasyon Okunamadi"

        end-read       
          move rez-rec to xrez-rec
           perform x-r
           if konuk-kayit-durumu = "Y" and xkonuk-fol-kodu = "R"  
               and cin-tipi = 2 
                  move 1              to xrez-tipi
           end-if 
        initialize linkh-odahes
        move xrez-no to  linkh-rez-no     
         move 2 to linkh-nereden  
         move 1 to linkh-anl-yaz
        
*         if XREZ-FIYAT-FIX not = "E"
           move  0 to linkh-cast-yaz
*         end-if
          call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc

                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
          MOVE XREZ-EB        TO XKONUK-EB
          MOVE XREZ-UG-IND   TO XKONUK-UG-INDIRIMI
          if  "E" = xrez-eb
              modify eraly-booking-cb, value = 1
           else
              modify eraly-booking-cb, value = 0
          end-if
         
           display  eraly-booking-cba
     end-if
           
       
              open input cast

            initialize cast-rec
            move  xkonuk-rez-no to cast-rez-no
            evaluate true
               when tarih-tasi >= xkonuk-git-tar
                open input takvim
                 move xkonuk-git-tar to takvim-anah 
                 start takvim key = takvim-anah invalid continue
                   not invalid
                     read takvim next no lock end continue end-read
                     read takvim previous no lock end continue end-read
                     move takvim-anah to  cast-tarih
                 end-start
                 close takvim
               when tarih-tasi < rez-gir-tar
                  move xkonuk-gel-tar to cast-tarih
               when other
                  move tarih-tasi to cast-tarih
            end-evaluate
            
              read cast  no lock invalid
                continue
                not invalid
               
                   
              move CAST-ANLASMA-FIYATI to xKONUK-DV-DEGERI
              move xKONUK-DV-DEGERI    to rez-ucreti yeni-fiyat
           
              perform kur-bul  thru kur-bul-exit
              perform yeni-fiyat-al-1   thru yeni-fiyat-al-exit
              end-read
              close  cast
         

     .
*
 x-r.
       move xkonuk-bilbord-eh   to xrez-bilbord-eh
       move xkonuk-dv-degeri    to xrez-fiyati.
       move xkonuk-folio        to xrez-folio. 
       move xkonuk-odano        to xrez-odano. 
       move "E"                 to xrez-c-in. 
       move xkonuk-adi          to xrez-adi.
       move xkonuk-paylas-oda   to xrez-paylas-oda
       move xkonuk-rehber       to xrez-rehber
       move xkonuk-soyadi       to xrez-soyadi. 
       move xkonuk-s-d-t-g      to xrez-s-d-t-g.
       move xkonuk-oda-konumu   to xrez-oda-konumu. 
       move xkonuk-fiyat-konumu to xrez-fiyat-konumu. 
       move xkonuk-odeme-tipi   to xrez-odeme-tipi. 
       move xkonuk-odano        to xrez-odano. 
       move xkonuk-ulke         to xrez-ulke. 
       move xkonuk-buyuk        to xrez-buyuk. 
       move xkonuk-kucuk        to xrez-kucuk. 
       move xkonuk-free         to xrez-free. 
       move xkonuk-bebek        to xrez-bebek.
       move xkonuk-rez-tipi     to xrez-tipi
       move xkonuk-share        to xrez-share.           
       move xkonuk-aksiyon-eh   to xrez-aksiyon-eh.
       move xkonuk-acenta       to xrez-acenta. 
       move 2000                to  xrez-al-yil
       move xkonuk-al-tar       to     xrez-al-tar(3:)
       move xkonuk-grup-no      to xrez-grup-no.
       move xkonuk-gel-saat     to xrez-gel-saat.
       move xkonuk-gel-dakika   to xrez-gel-dak.
       move xkonuk-git-saat     to xrez-git-saat.
       move xkonuk-git-dakika   to xrez-git-dak.
       move xkonuk-fiyat-konumu to xrez-fiyat-konumu
       move xkonuk-voucher      to xrez-voucher. 
       move xkonuk-nor-indirim  to xrez-nor-indirim. 
       move xkonuk-pan-tipi     to xrez-pan-tipi. 
       move xkonuk-banka        to xrez-banka. 
       move xkonuk-doviz        to xrez-doviz. 
       move xkonuk-pazar        to xrez-pazar.
       move xkonuk-eb           to xrez-eb
       move xkonuk-ug-indirimi  to xrez-ug-ind
       move xkonuk-anlasma      to xrez-anlasma.
       move xkonuk-gec-giris            to xrez-gec
       move xkonuk-vip-oto-degis to xrez-vip-oto-degis
       move xkonuk-sehir        to xrez-sehir
       if xkonuk-acik-kapali = "C"
          move 1 to xrez-no-post
          else
          move 0 to xrez-no-post
       end-if
       move xkonuk-plan         to xrez-plan.
       move xkonuk-dig-plan to xrez-dig-plan 
       move xkonuk-OPERATOR     to xrez-OPERATOR.
       move  yREZ-OZEL-DURUM-CAR   to xREZ-OZEL-DURUM-CAR 
       move  yREZ-OZEL-DURUM       to  xREZ-OZEL-DURUM     
       move  yREZ-ozel-tip         to  xREZ-ozel-tip 
       move yrez-git-sirket to  xrez-git-sirket
       move yrez-gel-sirket to  xrez-gel-sirket
       move xkonuk-firma        to xrez-firma
       move xkonuk-kur-aygun    to xrez-kur-aygun. 
       move xkonuk-vip          to xrez-vip. 
       move xkonuk-acik-1       to xrez-not1. 
       move xkonuk-acik-2       to xrez-not2.
       move xkonuk-fiyat-fix    to xrez-fiyat-fix.
       move xkonuk-fix-anl      to xrez-fix-anl.
       move xkonuk-special-eh   to xrez-special-eh
       move xkonuk-paylas-oda to xrez-paylas-oda
       move xozluk-adres1       to xrez-adres1.
       move xozluk-adres2       to xrez-adres2.
       move xozluk-e-mail       to xrez-e-mail.
*       move xkonuk-profil-no    to xrez-profil-no .
       move xkonuk-telefon-no   to xrez-telefon-no.

*

 det-gonder.
            if xkonuk-rez-no > 0 then 

               move xkonuk-rez-no to rez-no
               
              read rez no lock invalid 
                 display message box "Rezervasyon Okunamadi"

              end-read 
   
              move rez-rec to xrez-rec
               call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xrez-no   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/hesayr.asy"
         end-call
        end-if
     .
*

 Form1-Pb-4-Link.
       move 0 to xKONUK-plan
       display Form1-Pb-4
     .
*
*
 pr-oda-kaldir.
          move 0 to xkonuk-oda-plan
       display Form1-Pb-4a
     .
*
 pr-kisi-kaldir.
          move 0 to xkonuk-kisi-plan
       display Form1-Pb-4aa
     .
*
 pr-pan-kaldir.
         move 0 to xkonuk-pans-plan
       display Form1-Pb-4aaaa
     .

*
 pr-fkonum-kaldir.
        move 0 to xkonuk-fkonum-plan
       display Form1-Pb-4aaa
     .
*

 Form1-Gd-1a-Ev-Msg-Begin-Entry.
 
             set event-action to event-action-fail
             call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xkonuk-rez-no   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                     cancel "/asya/ytl/obj/otel/hesayr.asy"
             end-call
          .

*
 screen2-Aft-Routine.
       move function numval(z-aylik-tut) to  rezek-aylik-fiyat
       move function numval(z-aidat-tut) to  rezek-aidat-fiyat

      open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
     .

*
 screen2-Bef-Routine.
      if xkonuk-rez-no > 0  then 

          initialize   z-aylik-tut z-aidat-tut
            move   rezek-aylik-fiyat   to z-aylik-tut
            move   rezek-aidat-fiyat   to z-aidat-tut
            else
         display message box "Aylik Fiyat Girilemez"
         set exit-pushed to true
      end-if
     .
*
 accept-gir-gun-Ex-Other.
     if key-status = 05 then
  
       if k-kodu-tasi = "ASYA" and isyeri-adres-tasi(1:5) ="kinac" 
       
        modify accept-gir-gun enabled = true
        modify accept-gir-ay  enabled = true
        modify accept-gir-yil enabled = true
        
       end-if
       END-if
     .
*
 gd2-Ev-Other.
     
     .
*
 profil-goster.
     if xkonuk-fol-kodu not = "R"
           exit paragraph 
     end-if 
     move 4  to kac-adet
 
     evaluate hangi-profil
     when 1
         move xkonuk-adi    to musteri-adi-filtre
         move xkonuk-soyadi to musteri-soy-filtre
     when 2
         move adi2    to musteri-adi-filtre
         move soy2 to musteri-soy-filtre
     when 3
         move adi3    to musteri-adi-filtre
         move soy3 to musteri-soy-filtre
     when 4
         move adi4    to musteri-adi-filtre
         move soy4 to musteri-soy-filtre
     when 5
         move adi5    to musteri-adi-filtre
         move soy5 to musteri-soy-filtre
     when 6
         move adi6    to musteri-adi-filtre
         move soy6 to musteri-soy-filtre
     when 7
         move adi7    to musteri-adi-filtre
         move soy7 to musteri-soy-filtre
     when 8
         move adi8    to musteri-adi-filtre
         move soy8 to musteri-soy-filtre
     when 9
         move adi9    to musteri-adi-filtre
         move soy9 to musteri-soy-filtre

     end-evaluate
     if musteri-adi-filtre(2:) = spaces and
        musteri-soy-filtre(2:) = spaces 
          exit paragraph 
     end-if 
     perform baslik-yukle
     perform profile-eslesen-ara
     perform profile-grid
     if hangi-profil = 1       
       open input prohrk musteri
       perform gel-say-bul
  
       if gel-say > 1
          move 1   to xkonuk-vip-turu
          perform vip-turu-goster 
          move gel-say to xkonuk-gelis-sayisi
          display accept-gelis-sayisi
          if xkonuk-vip = "N" or " "
             move "G"   to xkonuk-vip 
             move 1     to xkonuk-vip-oto-degis
             display acc-viptipi
             perform vip-goster
          else
             if xkonuk-vip-oto-degis = 0 and xkonuk-vip = "G"
                move "N"       to xkonuk-vip 
                display acc-viptipi
                perform vip-goster                           
             end-if 
          end-if 
       else 
          if xkonuk-vip-oto-degis = 1 and xkonuk-vip = "G"
             move "N"       to xkonuk-vip 
             display acc-viptipi
             perform vip-goster            
          end-if 
       end-if
       if gel-say = 1
          move 2   to xkonuk-vip-turu
          perform vip-turu-goster        
          move gel-say to xkonuk-gelis-sayisi
          display accept-gelis-sayisi
       end-if         
       close prohrk  musteri
     end-if .

* 
 gel-say-bul.       
     initialize prohrk-rec gel-say       
     move ps1           to prohrk-profil-sirket
     move mis-no        to prohrk-profil-no
     start prohrk key not < prohrk-anah invalid
           continue
     not invalid
     perform with test after until fs-prohrk = "10"
     read prohrk next no lock end move "10"   to fs-prohrk
     not at end
            if prohrk-profil-no <> mis-no or
               prohrk-profil-sirket <> ps1 
                  move "10"   to fs-prohrk
                  exit perform
            end-if
            if prohrk-profil-no = 0
               exit perform cycle 
            end-if 
            if prohrk-profil-sirket = spaces
                exit perform cycle 
            end-if 
            if prohrk-rez-durumu not = "S"
                add 1 to gel-say
            end-if
            initialize musteri-rec xmusteri-gecmis-kalis-sayisi
*            move prohrk-profil-anah to m-profil    |firat m-profil bos gorunuyor.. 17/08/2020
            move prohrk-profil-sirket to musteri-sirket 
            move prohrk-profil-no     to musteri-no
            read musteri no lock invalid
                 initialize xmusteri-gecmis-kalis-sayisi 
            not invalid 
                 move musteri-gecmis-kalis-sayisi to xmusteri-gecmis-kalis-sayisi
            end-read 
     end-read
     end-perform
     end-start
     compute gel-say = gel-say + xmusteri-gecmis-kalis-sayisi
    .
*
 profile-eslesen-ara.
    open i-o genelfis
    move 1 to genelfis-anahtar
    read genelfis no lock invalid
         accept print-no from time
    not invalid
         add 1 to print-no
         rewrite genelfis-rec end-rewrite
    end-read
    close genelfis
    move print-no to takasp-dno
    move k-kodu-tasi to takasp-k
    open output takasp close takasp         
    open input  musteri 
    open i-o takasp
    initialize  musteri-rec c5 aranan
    move musteri-adi-filtre(1:kac-adet)    to musteri-adi(1:kac-adet)
    start musteri key not < musteri-ilk invalid
          continue
    not invalid
    perform with test after until fs-musteri = "10"
    read musteri next no lock end move "10" to fs-musteri
    not at end
            initialize takasp-rec
            if musteri-sirket = spaces or 
               musteri-no = zeroes
                 exit perform cycle
            end-if
            if musteri-silindi = 1
                 exit perform cycle 
            end-if 

            if musteri-adi(1:kac-adet) not = musteri-adi-filtre(1:kac-adet)
               move "10"   to fs-musteri
            end-if 
            if musteri-adi(1:10) = musteri-adi-filtre(1:10) and
               musteri-soyadi(1:10) = musteri-soy-filtre(1:10) and
               musteri-adi not = spaces and
               musteri-soyadi not = spaces 
                 move 1   to xrez-gr-olabilir takasp-tam-uyum
                 
            end-if 
             initialize c1 c2 c3 c4  c6 puan
            move musteri-adi         to aranan
            move musteri-adi-filtre           to aranacak

            if musteri-adi-filtre not = spaces
               perform ada-gore
            end-if 
             initialize c1 c2 c3 c4  c6  
            move musteri-soyadi         to aranan

            move musteri-soy-filtre        to aranacak

            if musteri-soy-filtre not = spaces
               perform ada-gore
            end-if 
      
        if puan > 0
           add 1               to c5
            
           move m-profil       to takasp-anah
           move puan           to takasp-puan
           move musteri-adi    to takasp-adi
           move musteri-soyadi to takasp-soyadi
           move musteri-ulke   to takasp-ulke
           move musteri-d-tarihi        to takasp-d-tarih
           move musteri-gelis-sayisi    to takas-p-gel-sayi
           move musteri-kazanilan-puan  to takasp-gercek-puan
           move musteri-kart-tipi       to takasp-kart-tipi
           write takasp-rec invalid 
              rewrite takasp-rec end-rewrite 
           end-write 
        end-if 

     end-read
    end-perform
    end-start
    close  musteri .
    close takasp.


*
 ada-gore.
        inspect aranan tallying c1 for trailing spaces
        compute c2 = 20 - c1
        initialize c1
        inspect aranacak tallying c1 for trailing spaces
        compute c3 = 20 - c1 

        move 0 to c4
        inspect aranan(1:c3) tallying c4 for all aranacak(1:c3)
        if c4 > 0
           add 10000 to puan
           if c2 = c3 
               add 10000 to puan
           end-if 
        end-if 

        move 0 to c4
        inspect aranan(1:3) tallying c4 for all aranacak(1:3)
        if c4 > 0
           add 3000 to puan
        end-if

        move 0 to c4
        inspect aranan tallying c4 for all aranacak(1:c3)
        if c4 > 0
           add 5000 to puan
        end-if 

        perform varying i 
                  from 1
                  by 1
                  until i > c3 - 2
                      move 0   to c4 
                      inspect aranan tallying c4 for all aranacak(i:3)
                      if c4 > 0
                        if i = 1
                           add 300 to puan
                        end-if 
                          add 100 to puan
                      end-if 
        end-perform

        perform varying i 
                  from 1
                  by 1
                  until i > c3 - 1
                      move 0   to c4 
                      inspect aranan tallying c4 for all aranacak(i:2)
                      if c4 > 0
                        if i = 1
                           add 100 to puan
                        end-if 
                          add 10 to puan
                      end-if 
        end-perform.

     
*
 profile-grid.
    open input takasp ulke
    initialize takasp-rec 
    move 1  to satir
    move high-values to takasp-puan
    start takasp key not > takasp-puan invalid 
         continue 
    not invalid 
    perform until fs-takasp = "10"  
    read takasp previous no lock end move "10"  to fs-takasp
    not at end 
            add 1                to satir
            if satir > 40
                exit perform 
            end-if 
            initialize gd2-rec
            move takasp-no       to gd-2-col-1
            move takasp-adi      to gd-2-col-2
            move takasp-soyadi   to gd-2-col-3
            if takasp-d-yil > 1900
               move takasp-d-yil    to eyil
               move takasp-d-ay     to eay
               move takasp-d-gun    to egun
               move etarih          to gd-2-col-4
            end-if 

            move takas-p-gel-sayi   to z-gel-sayi
            move z-gel-sayi         to gd-2-col-5

            move takasp-gercek-puan     to z-puan
            move z-puan          to gd-2-col-6
            move takasp-kart-tipi to gd-2-col-7
            move takasp-sirket   to gd-2-col-8
            modify gd2,record-to-add(gd2-rec)
            if takasp-tam-uyum = 1
               modify gd2(satir),row-color = 176
            end-if 
    end-read 
    end-perform
    end-start
    close takasp ulke
    modify gd2,mass-update = 0
    delete file takasp.

*
 baslik-yukle.
     modify gd2,
            reset-grid = 1
            mass-update = 1            
     move "P.No"        to gd-2-col-1
     move "Adi"         to gd-2-col-2
     move "Soyadi"      to gd-2-col-3
     move "D.Tarihi"    to gd-2-col-4
     move "G.S"        to gd-2-col-5
     move "Puan"         to gd-2-col-6

     move "K.Tip"       to gd-2-col-7
     move "Sirket"      to gd-2-col-8
     modify gd2,record-to-add(gd2-rec).
*
 link-pop.
      display message box control-id
     .
*
*
 share-koy-kont.
       
****** kural .
****** kontrol edilecek rez kaydi cagrýlmadan okunmus ve kaydedilmis olmali
******* arez.lib acast.lib takvim2.lib sel tfd de olmali  rez acik olmali
       
       open i-o arez  acast konu2
       open input takvim2
       initialize ana-oda-verildi arez-rec
        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
        move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
 

      
       initialize ana-oda-verildi acast-rec  share-odalar
         move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
        move rez-sharenum to acast-sharenum
        move tarih-tasi to acast-tarih
               initialize fs-acast
       start acast key >= acast-anah6 
               invalid continue
          not invalid
          perform until fs-acast = "10" 
              read acast next no lock end 
                     move "10" to fs-acast
                 not end
                    if rez-sharenum not = acast-sharenum 
                        move "10" to fs-acast
                        exit perform cycle
                    end-if
                    move acast-rez-no to arez-no 
                    read arez no lock invalid 
                          display message  box "Hata Bakim icin arayiniz Castttt "
                     end-read
                            if arez-durumu  = "S" then
                              exit perform cycle
                            end-if

                             if acast-tarih > son-share-tar
                                move  acast-tarih to son-share-tar
                             end-if
                              if acast-tarih < ilk-share-tar
                                move  acast-tarih to ilk-share-tar
                             end-if

                                perform varying ish from 1 by 1 until ish > sodasay or ish > 20 
                                    if share-oda(ish) = acast-oda-no
                                      exit perform 
                                    end-if
                                end-perform
                                 if ish > sodasay then 
                                     if ish >= 20 then
                                          display message box "20 den fazla oda bagladiniz"
                                       else
                                             move acast-oda-no to share-oda(ish)
                                             move ish to  sodasay
                                            
                                     end-if
                                 end-if
              end-read
          end-perform 
       end-start
       initialize fs-takvim2 takvim2-rec
       move ilk-share-tar to takvim2-anah 
       
       start takvim2 key >= takvim2-anah invalid continue
         not invalid 
         perform until fs-takvim2 = "10"
             read takvim2 next no lock end move "10" to fs-takvim2 
               not end
               if takvim2-anah > son-share-tar 
                   move "10" to fs-takvim2 
                   exit perform cycle
                end-if
             end-read
                perform varying ish  from 1 by 1 until ish > sodasay or ish > 20 
                  initialize ana-oda-verildi acast-rec   fs-acast
                  move takvim2-anah to acast-tarih
                  move rez-sharenum to acast-sharenum
                  move share-oda(ish) to acast-oda-no
                  move high-values to acast-fiyati  acast-buyuk

                  start acast key < acast-anah6 invalid 
                          continue
                     not invalid
                       perform until fs-acast = "10" 
                           read acast previous no lock  
                               end
                                move "10" to fs-acast
                                if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                                  else
                                                  display message box "Hataaaaa"
                                               end-if
                                  end-if
                                not end
        if   takvim2-anah not = acast-tarih  or
             rez-sharenum not = acast-sharenum  or
             share-oda(ish) not = acast-oda-no
               move "10" to fs-acast
                if ana-oda-verildi not = 1 
                  read   acast next no lock 
                  end   display message box "Hataaaaa"
                  exit perform cycle
                  end-read
                      if   takvim2-anah not = acast-tarih  or
                             rez-sharenum not = acast-sharenum  or
                             share-oda(ish) not = acast-oda-no
                          |display message box "Hataaaaa25666"
                          if k-kodu-tasi = "X   " or "ASYA" then stop " "  end-if 
                           exit perform cycle
                     end-if
                      move 1 to  ana-oda-verildi
                       if  acast-share not = 0
                            move 0 to acast-share
                          rewrite acast-rec invalid stop " " end-rewrite
                          else
                          display message box "Hataaaaa"
                       end-if
                 end-if
               exit perform cycle
        end-if
                               move acast-rez-no to arez-no
                                move acast-rez-no to arez-no 
                                    read arez no lock invalid 
                                      display message  box "Hata Bakim icin arayiniz Castttt "
                                          end-read
                                            if arez-durumu  = "S" then
                                                  display message box "Silinmis Share gorunuyor"
                                                  exit perform cycle
                                                  
                                            end-if
                                   if arez-cik-tar <= acast-tarih
                                       if  acast-share not = 1
                                            move 1 to acast-share
                                            rewrite acast-rec invalid stop " " end-rewrite
                                       end-if
                                    else
                                        if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share


                                                  rewrite acast-rec invalid stop " " end-rewrite
                                              end-if
                                        else
                                                 if  acast-share not = 1
                                                       move 1 to acast-share
                                                      rewrite acast-rec invalid stop " " end-rewrite
                                                 end-if
                                  end-if
                             end-if

                           end-read
                       end-perform
                  end-start
                end-perform 
        end-perform
      end-start
      initialize arez-rec fs-arez

        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
       start arez key >= aREZ-anah-share invalid continue
          not invalid
          perform until fs-arez = "10" 
              read arez next no lock end 
                       
                     move "10" to fs-arez
                 not end
                    if rez-sharenum not = arez-sharenum  
                     
                            move "10" to fs-arez
                        exit perform cycle
                    end-if
                    if  arez-durumu not = "I"
                       exit perform cycle
                    end-if
                    if arez-cik-tar < tarih-tasi 
                         exit perform cycle
                    end-if
                    if arez-gir-tar <= tarih-tasi
                       move   tarih-tasi to acast-tarih
                       move   arez-no   to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                                      if arez-folio > 0 then 
                                       move arez-folio to konu2-folio
                                       read konu2 no lock invalid continue
                                       not invalid
                                          move acast-share to konu2-share
                                          rewrite konu2-rec invalid continue end-rewrite
                                       end-read

                                     end-if
                             end-if
                       end-read
                        else
                        move   arez-gir-tar  to acast-tarih
                         move   arez-no        to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                             end-if
                       end-read


                   end-if
              end-read
          end-perform 
       end-start
       read rez no lock invalid stop " " 
       end-read

     close arez acast takvim2 konu2. 
*
*
 share-form-cagir.
      move xkonuk-rez-no  to link-share-rez-no
      call "/asya/ytl/obj/otel/share.asy" 
           using link-share-rez-no
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
      cancel "/asya/ytl/obj/otel/share.asy"
      end-call
      move link-share-rez-no to rez-no 
       read rez no lock invalid stop " " 
         not invalid
         move rez-sharenum to xkonuk-sharenum
         move rez-share    to xkonuk-share
         display gec-girisaa
      end-read
    
       .
*
*
 kapi-karti-gonder.
     if oto-gec not = 1 then 
              initialize link-kapi-hepsi
              move xkonuk-odano     to link-kapi-odano
              move 1                to link-kapi-nereden
              move xkonuk-buyuk     to link-kapi-kisi-sayisi
              move xkonuk-rez-no    to link-kapi-rez-no
              call "/asya/ytl/obj/otel/kapikart.asy" 
                           using link-kapi-hepsi
                           on exception 
                           perform callerr-proc
                           exit paragraph
                           not on exception 
                 cancel "/asya/ytl/obj/otel/kapikart.asy"
              end-call
     end-if
     .
*
 grup-islemleri.
          if xkonuk-grup-no = 0 then 
              initialize gruplar-cagir
                    call "/asya/ytl/obj/otel/gruplara.asy" using gruplar-cagir xkonuk-gel-tar  xkonuk-git-tar 1
                         on exception perform callerr-proc
                         not on exception
                    cancel "/asya/ytl/obj/otel/gruplara.asy" 
                    end-call
                    if gruplar-cagir > 0 then 
                    move gruplar-cagir   to xkonuk-grup-no
                    display accept-grup-kodu
                     display message box " Misafir sectiginiz gruba dahil edildi  " new-line
                                "Kaydettiginizde gecerli olacaktir  " new-line
                               " Fiyat ve Breakdown degisecektir. " new-line 
                               " Kontrol Ediniz    " new-line
                   end-if
                    
             else
             initialize xkonuk-grup-no
              display accept-grup-kodu
              display message box " Misafir grup disina cikarildi  " new-line
                                "Kaydettiginizde gecerli olacaktir  " new-line
                               " Fiyat ve Breakdown degisecektir. " new-line 
                               " Kontrol Ediniz    " new-line
          end-if
       
       
     .
*
*
 cogalt.
      
       if xkonuk-folio = 0 then
          display message box " Kaydetmediginiz Rezervasyonu cogaltamassiniz " title "YENI KAYIT "
          exit paragraph
       end-if
       open input arez
       move xkonuk-rez-no to arez-no
       read arez no lock invalid 
          close arez
          display message box " Kaydetmediginiz Rezervasyonu cogaltamassiniz " title "YENI KAYIT "
          exit paragraph
       end-read
         close arez
          initialize rez-link
           initialize rlink-rez-no   rlink-gelen-sharenum
           if arez-gir-tar < tarih-tasi
             move tarih-tasi to arez-gir-tar
           end-if
           move spaces to arez-c-in
           move 0 to arez-folio arez-sharenum  arez-share
           if arez-kart-no1 not = spaces and 
              arez-kart-no2 not = spaces and 
              arez-kart-no3 not = spaces and 
              arez-kart-no4 not = spaces
                initialize arez-kredi-kart
           end-if           
           move spaces to arez-odano
           move arez-sharenum to rlink-gelen-sharenum
           move arez-rec to  rlink-gelen-rec 
           move arez-no to rlink-rez-no

         call "/asya/ytl/obj/otel/rez.asy" 
           using rlink-rez-no rlink-gelen-rec  rlink-gelen-sharenum
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
               cancel "/asya/ytl/obj/otel/rez.asy"
         end-call   .

*
 ara-mesaj.
             if xkonuk-folio > 0  then
              move 1       to link-nereden 
              move "F"     to  link-not-islem
              move "REZ"   to  link-NOT-DOS    
              move xkonuk-acenta  to link-not-dos-anah   
              move xkonuk-gel-tar to link-not-dos-anah(5:8)  
              move xkonuk-git-tar to link-not-dos-anah(13:8)  
              move xkonuk-firma  to  link-not-dos-anah(22:8)  
              move 1 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                        using link-not
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/mesajgir.asy"
                   end-call
                move  link-not-donus  to  toplam-not
               display not-ac
             end-if.
*
 kredi-karti-cagir.
      if konuk-folio > 0
         initialize link-kkart
         move konuk-folio   to link-kkart-folio
         move "F"           to link-kkart-nereden
                   call "/asya/ytl/obj/otel/kkarti.asy" 
                        using link-kkart
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/kkarti.asy"

                   end-call

           initialize konuk-rec
           move link-kkart-folio  to konuk-folio
           read konuk no lock invalid 
               continue 
           end-read 
              move konuk-kredi-kart to xkonuk-kredi-kart
      end-if 
      .
*
 reg-kart-yazdir.
    if konuk-fol-kodu = "R"
    initialize rez-cagir
    move konuk-rez-no   to rez-cagir
    call "/asya/ytl/obj/otel/regfisy.asy" using rez-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/regfisy.asy" 
    end-call
    end-if.             
*
 dolu-extra-kontrol.
      initialize konuk-rec extra-oda-buldum
      move "I"            to konuk-durumu
      move xkonuk-odano of xkonuk-rec to konuk-odano
      start konuk key not < konuk-oda invalid 
          continue 
      not invalid 
      perform with test after until fs-konuk = "10"
      read konuk next no lock end move "10" to fs-konuk
      not at end 
             if konuk-durumu <> "I"
                 exit perform 
             end-if 
             if konuk-odano <> xkonuk-odano of xkonuk-rec
                 exit perform 
             end-if 
             if konuk-fol-kodu = "R"
                 exit perform cycle 
             end-if
            
             move 1 to extra-oda-buldum
      end-read 

      end-perform
      end-start
      if extra-oda-buldum = 1 and 
         cin-tipi-combo-value(1:1) = 3
          display message box "Sectiginiz PM Dolu..." new-line
                              "Kontrol Ediniz."
                          title "Uyari"
                          icon 1
          move 1 to gec-gecme
          move 4    to accept-control
           if genel-uzun-oda-no-kullanilsin = 1 
             move 226 to control-id 
           else
          move 1004 to control-id 
          end-if
      end-if 
      .
*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move xkonuk-kaynak-1 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak1-tipi-goster
    display acc-kaynak1 lb-kaynak1
    close onbkodlar10.

 kaynak2-goster.

    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AC" to onbkodlar10-tipi
    move xkonuk-kaynak-2 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak2-tipi-goster
    display acc-kaynak2 lb-kaynak2
    close onbkodlar10.

 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AD" to onbkodlar10-tipi
    move xkonuk-kaynak-3 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak3-tipi-goster
    display acc-kaynak3 lb-kaynak3
    close onbkodlar10.

*
 kaynak1-ara.
    initialize kaynak-cagir.
    move "AB"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk1ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk1ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xkonuk-kaynak-1
    perform kaynak1-goster
    .

 kaynak2-ara.
    initialize kaynak-cagir.
    move "AC"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk2ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk2ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xkonuk-kaynak-2
    perform kaynak2-goster
    .
 kaynak3-ara.
    initialize kaynak-cagir.
    move "AD"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk3ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk3ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xkonuk-kaynak-3
    perform kaynak3-goster
    .
* 
 devremulk-guncel-borc-sorgula.
           if xkonuk-rez-no = zeroes then exit paragraph end-if
          open i-o donhrk
          initialize donhrk-rec
          start donhrk key not < donhrk-anah invalid
                  continue
          not invalid
          perform until fs-donhrk = "10"
          read donhrk next no lock end move "10" to fs-donhrk
          not end
                if donhrk-rez-no = xkonuk-rez-no   or
                   donhrk-rez-no-2 = xkonuk-rez-no or
                   donhrk-rez-no-3 = xkonuk-rez-no or
                   donhrk-rez-no-4 = xkonuk-rez-no or
                   donhrk-rez-no-5 = xkonuk-rez-no then

                        initialize link-guncel-borc link-aidat-borc-tl link-aidat-borc-dv link-devremulk-no
                        move donhrk-devremulk-no to link-devremulk-no
                        call "/asya/ytl/obj/otel/devgunsor.asy" using link-devremulk-no link-guncel-borc link-aidat-borc-tl link-aidat-borc-dv
                                    on exception perform callerr-proc
                                not on exception
                        cancel "/asya/ytl/obj/otel/devgunsor.asy" 
                        end-call
                end-if

               
                  |||||| link-guncel-borc > 0 then guncel borcu vardýr uyarýsý verecekkkkkkkkk
          end-read
          end-perform
          end-start

        close donhrk
         .


* 
 vip-turu-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "z"           to kodlar02-tipi
    move xkonuk-vip-turu to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi  to lb-vip-turu-adi
    display acc-vipturu  lb-vip-turu
    close kodlar02.
*
 zarfdok-hazirla.
      open input yanrez
      initialize link-zarf
      perform varying i from 1 by 1 until i > 7
              initialize yanrez-rec
              move rez-no to yanrez-rezno
              move i      to yanrez-sirano
              read yanrez no lock invalid
                      continue
              not invalid
                if yanrez-adi <> spaces or yanrez-soyadi <> spaces then

                        MOVE rez-no TO link-zarf-rez-no   
                        add 1 to link-zarf-kacinci                                    
                        move yanrez-sirano to link-zarf-yan-id
     
                        call "/asya/ytl/obj/otel/zarfdok1.asy" using link-zarf
                                 on exception perform callerr-proc
                                 not on exception
                        cancel "/asya/ytl/obj/otel/zarfdok1.asy" 
                        end-call
                       
                end-if
              end-read
        end-perform 
        close yanrez.
*
 on-odeme-yaz.
      open i-o konu2 hrk2 exthrk romhrk yromhrk  cektr nt
      initialize konu2-rec onodeme-sorun-yok
      move "I"                 to konu2-durumu
      move genel-onodeme-odano to konu2-odano
      start konu2 key not < konu2-oda invalid 
           continue 
      not invalid 
      perform with test after until fs-konu2 = "10"
      read konu2  next no lock end move "10" to fs-konu2
      not at end 
              if konu2-odano <> genel-onodeme-odano 
                 exit perform 
              end-if 
              if konu2-durumu <> "I"
                 exit perform 
              end-if 
                perform exthrk-oku
      end-read 
      end-perform
      end-start
      close konu2 exthrk romhrk yromhrk  hrk2  cektr  nt
      if onodeme-sorun-yok = 1
         display message box "On Odeme Islendi." new-line
                             "Lutfen Kontrol Ediniz."
                         title "Uyari"
                         icon 1
      end-if 
    .
genelfis-cekgir.
    open i-o genelfis. 
             MOVE 1 TO GENELFIS-ANAHTAR. 
    READ GENELFIS NO LOCK INVALID 
         INITIALIZE GENELFIS-REC MOVE 1 TO GENELFIS-ANAHTAR. 
    ADD 1 TO CEKGIR-OTO. 
   
    REWRITE GENELFIS-REC INVALID WRITE GENELFIS-REC END-WRITE. 
    CLOSE GENELFIS. 

* 
 derle-acik.
          

         if form-acik not = spaces then
           
               initialize not-rec
               
                  move  "EHR"      to NOT-DOS
                  move exthrk-anah to  NOT-DOS-ANAH 

              
               move form-acik to not1

              write not-rec invalid
                continue
              end-write
          
          
         end-if   .

*
 exthrk-oku.
    
    initialize exthrk-rec 
    move konu2-folio    to exthrk-folio
    start exthrk key not < EXTHRK-ANAH1 invalid 
          continue 
    not invalid 
    perform with test after until fs-exthrk = "10"
    read exthrk next no lock end move "10" to fs-exthrk
    not at end 
            if exthrk-folio <> konu2-folio
                exit perform 
            end-if

            initialize yromhrk-rec
            move exthrk-anah   to yromhrk-anah
            read yromhrk no lock invalid
                 exit perform cycle 
            not invalid
                 if yromhrk-rez-no = xkonuk-rez-no  and yromhrk-derle-kaydi not = 1 and yromhrk-derle-kaydi not = 2
                 
                    initialize hrk2-rec
                    move exthrk-anah  to hrk2-ANAH
                    read hrk2 no lock invalid 
                         exit perform cycle 
                    not invalid 
****************************************************************
      if GENEL-ONODEME-DOV-DERLE = 1 then
       move  exthrk-anah to yedek-anah
    
     if yromhrk-dovizli-kk = 1 and yromhrk-doviz-kodu = xkonuk-doviz and yromhrk-doviz-tut > 0 then 
        compute derle-fark rounded = yromhrk-doviz-tut * xkonuk-kur-degeri - exthrk-tl-tutar
        if derle-fark > 1 or derle-fark < -1
           if derle-fark >  exthrk-tl-tutar / 3 or  derle-fark <  -1 * exthrk-tl-tutar / 3 
             display message box "Onodemede Coook buyuk doviz degerlemesi " new-line 
                            "Doviz derlemesi yapildi Lutfen Muhasebeden onay aliniz "

             end-if
            compute  yromhrk-kur-degeri rounded =  xkonuk-kur-degeri
            move  yromhrk-doviz-tut to zdov
            move  xkonuk-kur-degeri to zkur
            move  exthrk-tl-tutar to ztl
            string 
                 "Onodeme Doviz Deg.:" delimited by size 
                 xkonuk-rez-no delimited by size 
                 xkonuk-adi delimited by "    "
                 " " delimited by size
                 xkonuk-soyadi  delimited by "    "
                 "--(" delimited by size
                 zdov delimited by size
                 " X " delimited by size
                  zkur delimited by size
                  ") - " delimited by size
                  ztl delimited by size
                 
            into form-acik
           
             add derle-fark to exthrk-tl-tutar
            
             add derle-fark to yromhrk-tl-tutar

             rewrite exthrk-rec invalid display message box "HAAAAAATAAAA"
                 not invalid rewrite yromhrk-rec  invalid display message box "HAAAAAATAAAA"
                    not invalid
                      move derle-fark to exthrk-tl-tutar yromhrk-tl-tutar
                      initialize   yromhrk-kur-degeri        yromhrk-kk-onay-kodu    
                             yromhrk-doviz-kodu   yromhrk-dovizli-kk   yromhrk-doviz-tut
                   

                               perform  genelfis-cekgir
                            MOVE CEKGIR-OTO TO extHRK-ISLEM
                             yromhrk-islem hrk2-ISLEM
                      if derle-fark > 0
                        move   exthrk-depkod to exthrk-corr-depkod yromhrk-corr-depkod
                         move   ONKPARA-CORR-ARTI  to exthrk-depkod yromhrk-depkod 
                        
                         move "B" to exthrk-ba yromhrk-ba
                                initialize onkasa-rec
                         OPEN I-O ONKASA
                               MOVE exthrk-TARIH    TO ONKASA-TARIH
                               MOVE exthrk-DEPKOD   TO ONKASA-DEP
                               READ ONKASA NO LOCK INVALID continue
                                 
                              
                              end-read
                              COMPUTE ONKASA-TUTAR-TL   = ONKASA-TUTAR-TL - derle-fark
                              COMPUTE ONKASA-CORR-TUTAR-TL   = ONKASA-CORR-TUTAR-TL + derle-fark
                               REWRITE ONKASA-REC INVALID WRITE ONKASA-REC END-REWRITE
                          CLOSE ONKASA



                        else
                         
                          move   exthrk-depkod to  exthrk-depkod yromhrk-depkod 
                           initialize  exthrk-corr-depkod yromhrk-corr-depkod
                    end-if
                     move 1 to yromhrk-derle-kaydi
                        write exthrk-rec invalid display message box "HAAAAAATAAAA"
                         not invalid write yromhrk-rec invalid display message box "HAAAAAATAAAA"
                         not invalid write hrk2-rec  invalid display message box "HAAAAAATAAAA"
                         not invalid move derle-fark to sz-tut 
                          perform  derle-acik
                         display message box "Doviz degerlemesi yapildi -" sz-tut
                        end-write end-write end-write
                        
                     perform    kambiyo-bul
                    if kambi-depkod > spaces

                          if derle-fark > 0
                            move    yromhrk-corr-depkod to yromhrk-derkar-depkod
                            move 1 to yromhrk-derkar-corr
                            else
                              move    yromhrk-depkod to yromhrk-derkar-depkod
                            move 0 to yromhrk-derkar-corr
                          end-if
                          perform  genelfis-cekgir
                            MOVE CEKGIR-OTO TO extHRK-ISLEM
                             yromhrk-islem hrk2-ISLEM
                         move kambi-depkod to exthrk-depkod yromhrk-depkod
                          initialize  exthrk-corr-depkod yromhrk-corr-depkod
                         move  depkod-ba to  exthrk-ba yromhrk-ba    
                        move tarih-tasi to exthrk-tarih yromhrk-tarih 
                          move 2 to yromhrk-derle-kaydi
                          


                        write exthrk-rec invalid display message box "HAAAAAATAAAA"
                         not invalid write yromhrk-rec invalid display message box "HAAAAAATAAAA"
                         not invalid write hrk2-rec  invalid display message box "HAAAAAATAAAA"
                         not invalid  perform  derle-acik
                        end-write end-write end-write
                           initialize onkasa-rec
                           OPEN I-O ONKASA
                               MOVE exthrk-TARIH    TO ONKASA-TARIH
                               MOVE exthrk-DEPKOD   TO ONKASA-DEP
                               READ ONKASA NO LOCK INVALID continue
                               end-read   
                               if derle-fark < 0 then
                               compute derle-fark = -1 * derle-fark
                             
                              end-if
                                COMPUTE ONKASA-TUTAR-TL   = ONKASA-TUTAR-TL + derle-fark
                               REWRITE ONKASA-REC INVALID WRITE ONKASA-REC END-REWRITE
                          CLOSE ONKASA

                    end-if  
             end-rewrite 
        end-if 
     end-if
     initialize exthrk-anah yromhrk-rec hrk2-rec
      move yedek-anah to exthrk-anah yromhrk-anah hrk2-anah
      read exthrk no lock invalid display message box "HAAAAAATAAAA" exit perform cycle 
        not invalid 
         
        
         read yromhrk no lock invalid
              display message box "HAAAAAATAAAA" exit perform cycle 
         not invalid
                 read hrk2 no lock invalid 
                     display message box "HAAAAAATAAAA" exit perform cycle 
                 end-read
          end-read
     end-read
     
     end-if

                            delete exthrk invalid 
                                 continue 
                            end-delete  

                            initialize romhrk-rec 
                            move exthrk-rec   to romhrk-rec 
                            move xkonuk-folio to romhrk-folio
                            


                            write romhrk-rec invalid 
                                  continue 
                            end-write
****************************************************************      

                            delete yromhrk invalid 
                                continue 
                            end-delete
                            
                            move exthrk-rec        to yromhrk-ust-data                           
                            move xkonuk-folio      to yromhrk-folio yROMHRK-kaynak-folio
                            move xkonuk-rez-no     to yromhrk-rez-no
                            move rez-cin-kur-tar   to yromhrk-kur-tarih
                            move rez-cin-kuru      to yromhrk-kur-degeri
                            
                            write yromhrk-rec invalid
                                 continue 
                            end-write
****************************************************************
                            delete hrk2 invalid 
                                continue 
                            end-delete 

                            initialize hrk2-rec 
                            move exthrk-anah   to hrk2-anah                                                       
                            move xkonuk-folio  to hrk2-kaynak-folio hrk2-folio
                            move k-kodu-tasi   to hrk2-STAF
                            write hrk2-rec invalid 
                                continue 
                            end-write  
****************************************************************
                            initialize cektr-rec
                            move exthrk-folio    to cektr-eski-folio
                            move xkonuk-folio    to cektr-yeni-folio
                            move 1               to cektr-on-odeme
                             
                                    
                                       initialize not-rec
                                        move  "EHR"     to NOT-DOS
                                         move exthrk-anah to  NOT-DOS-ANAH 
                                           read nt no lock invalid continue
                                           end-read
                                          move  "RHR"     to NOT-DOS
                                          move romhrk-anah to  NOT-DOS-ANAH 
                                            
                                      write not-rec invalid
                                       rewrite  not-rec
                                      end-write
                                  
                                   
                                 
                            perform cektr-kaydet
                            perform main-duz
                            move 1   to onodeme-sorun-yok
                    end-read  
                 end-if 
            end-read 
    end-read 
    end-perform
    end-start.

*
*
 kambiyo-bul.
     initialize depkod-rec kambi-depkod
        move "KAM   " to depkod-adi
        open input depkod
        start depkod key > depkod-adi
                invalid 
                   continue
               not invalid 
            perform until fs-depkod = "10"
              read depkod next no lock end move "10" to fs-depkod
                    not end
                    if depkod-adi(1:5) = "KAMBI"  then 
                       if derle-fark > 0
                          if depkod-ba ="A"
                            move depkod-anah to kambi-depkod
                             move "10" to fs-depkod
                          end-if
                       else
                         if depkod-ba ="B"
                            move depkod-anah to kambi-depkod
                             move "10" to fs-depkod
                          end-if


                       end-if
                    end-if
             end-read
           end-perform
         end-start
        close depkod .
*
 main-duz.
                   move xkonuk-folio to ozluk-folio
                       read ozluk  no lock invalid
                         continue
                       end-read
                            if ozluk-ilk-har > "20000000"  
                                if 
                               ozluk-ilk-har > romhrk-tarih

                                 move romhrk-tarih to ozluk-ilk-har
                                 rewrite ozluk-rec invalid write ozluk-rec end-rewrite
                                 end-if
                                 else
                                    move romhrk-tarih to ozluk-ilk-har
                                 rewrite ozluk-rec invalid write ozluk-rec end-rewrite
                            end-if
                           if ozluk-son-har-tar > "20000000"  
                                if 
                               ozluk-son-har-tar < romhrk-tarih

                                 move romhrk-tarih to ozluk-son-har-tar
                                 rewrite ozluk-rec invalid write ozluk-rec end-rewrite
                                 end-if
                                 else
                                    move romhrk-tarih to ozluk-son-har-tar
                                 rewrite ozluk-rec invalid write ozluk-rec end-rewrite
                            end-if

                     .
*
 onodeme-iptal.
    display message box "On Odeme Geri Alinacaktir." new-line
                        "Eminmisiniz?" new-line new-line
                        "Alinacak Oda Numarasi: " genel-onodeme-odano
                    title "Uyari"
                    icon 1
                    type 2
                    default 2
                    returning return-code 
    if return-code = 2
        exit paragraph 
    end-if
      
      open i-o konu2 hrk2 exthrk romhrk yromhrk cektr


      initialize konu2-rec  onodeme-folio
      move "I"                 to konu2-durumu
      move genel-onodeme-odano to konu2-odano
      start konu2 key not < konu2-oda invalid 
           continue 
      not invalid 
      perform with test after until fs-konu2 = "10"
      read konu2  next no lock end move "10" to fs-konu2
      not at end 
              if konu2-odano <> genel-onodeme-odano 
                 exit perform 
              end-if 
              if konu2-durumu <> "I"
                 exit perform 
              end-if 
              move konu2-folio    to onodeme-folio
              exit perform 
      end-read 
      end-perform
      end-start
           perform romhrk-oku           
      close konu2 exthrk romhrk yromhrk  hrk2  cektr
      display message box "On Odeme Foliosuna Geri Alindi." new-line
                          "Lutfen Kontrol Ediniz."
                      title "Uyari"
                      icon 1
    .
*
 romhrk-oku.
    initialize romhrk-rec
    move konuk-folio    to romhrk-folio
    start romhrk key not < romhrk-anah1 invalid 
          continue 
    not invalid 
    perform with test after until fs-romhrk = "10"
    read romhrk next no lock end move "10" to fs-romhrk
    not at end 
            if romhrk-folio <> konuk-folio
                exit perform 
            end-if

            initialize yromhrk-rec
            move romhrk-anah   to yromhrk-anah
            read yromhrk no lock invalid
                 exit perform cycle 
            not invalid
                 if yromhrk-rez-no = konuk-rez-no
                    initialize hrk2-rec
                    move yromhrk-anah  to hrk2-ANAH
                    read hrk2 no lock invalid 
                         exit perform cycle 
                    not invalid 
****************************************************************
                            delete romhrk invalid 
                                 continue 
                            end-delete  
                             
                            initialize exthrk-rec 
                            move romhrk-rec    to exthrk-rec 
                            move onodeme-folio to exthrk-folio
                            write exthrk-rec invalid 
                                  continue 
                            end-write
****************************************************************      

                            delete yromhrk invalid 
                                continue 
                            end-delete
                            
                            
                            move romhrk-rec    to yromhrk-ust-data
                            move onodeme-folio to yromhrk-folio yROMHRK-kaynak-folio
                            
                            write yromhrk-rec invalid
                                 continue 
                            end-write
****************************************************************
                            delete hrk2 invalid 
                                continue 
                            end-delete 

                            initialize hrk2-rec 
                            move romhrk-anah   to hrk2-anah                                                       
                            move onodeme-folio  to hrk2-kaynak-folio hrk2-folio
                            move k-kodu-tasi   to hrk2-STAF
                            write hrk2-rec invalid 
                                continue 
                            end-write  
****************************************************************
                            initialize cektr-rec
                            move konuk-folio     to cektr-eski-folio
                            move exthrk-folio    to cektr-yeni-folio
                            move 2               to cektr-on-odeme
                            perform cektr-kaydet 
                    end-read  
                 end-if 
            end-read 
    end-read 
    end-perform
    end-start.
*
 cektr-kaydet.

    move exthrk-islem                            to cektr-islem
    move exthrk-islem-tipi                       to cektr-islem-tipi
    move exthrk-islem-tipi2                      to cektr-islem-tipi2
    move tarih-tasi                              to cektr-isl-tarih
    move exthrk-tarih                            to cektr-tarih
    move exthrk-corr-depkod                      to cektr-corr-depkod
    move exthrk-depkod                           to cektr-depkod
    move exthrk-ba                               to cektr-ba
    move exthrk-tl-tutar                         to cektr-tl-tutar
    move exthrk-dv-tutar                         to cektr-dv-tutar
    move exthrk-zaman                            to cektr-zaman
    accept zaman from time
    move zaman                                   to cektr-zaman
    move exthrk-kart-no                          to cektr-kart-no
    move exthrk-cekno                            to cektr-cekno
    move exthrk-pos-kodu                         to cektr-pos-kodu    
    move exthrk-staf                             to cektr-staf
    move k-kodu-tasi                             to cektr-staf
    write cektr-rec invalid rewrite cektr-rec,end-write.
*
 folio-git.
       initialize dokcagir-tasi
       set dokcagir-tasi-call-folio1      to true
       move xkonuk-folio                  to dokcagir-konuk-folio
       perform dokcagir-call
       move dokcagir-konuk-folio          to konuk-folio.
    .
*
 firma-dft-oku.
      open input nt
     initialize not-rec 
     move "FIR" to not-dos
     move "Default" to not-dos-anah.
     move firma-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke

           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 firma-dft-yukle.
       move   acen-dft-banka         to xkonuk-banka
       move   acen-dft-doviz         to xkonuk-doviz
       move   acen-dft-pan-tipi      to xkonuk-pan-tipi
       move   acen-dft-odeme-tipi    to xkonuk-odeme-tipi
       move   acen-dft-anlasma       to xkonuk-anlasma
       move   acen-dft-ulke          to xkonuk-ulke
      
       move   acen-dft-pazar         to xkonuk-pazar
       if acen-dft-early= 1 move "E" to xkonuk-eb
                 else     move "H" to xkonuk-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xkonuk-bilbord-eh
                 else     move "H" to xkonuk-bilbord-eh
              end-if
       modify eraly-booking-cb, value = acen-dft-early
       modify fix-fiyat-cb, value = acen-dft-fix
       modify aks-cb, value = acen-dft-aksiyon-yok
       modify bilbord-cb, value = acen-dft-bilboard 
       modify spe-cb, value = acen-dft-special-yok
       perform eraly-booking-cb-Ex-Cmd-Clicked
       perform fix-fiyat-cb-Ex-Cmd-Clicked
       perform bilbord-cb-Ex-Cmd-Clicked
       perform spe-cb-Ex-Cmd-Clicked

       perform aks-cb-Ex-Cmd-Clicked
          
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke    
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit.

*

*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.

     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-yukle.
       move   acen-dft-banka         to xkonuk-banka
       move   acen-dft-doviz         to xkonuk-doviz
       move   acen-dft-pan-tipi      to xkonuk-pan-tipi
       move   acen-dft-odeme-tipi    to xkonuk-odeme-tipi
       move   acen-dft-anlasma       to xkonuk-anlasma
       move   acen-dft-ulke          to xkonuk-ulke
        if   acen-dft-vip not = spaces then
           move   acen-dft-vip          to xkonuk-vip
       end-if
       move   acen-dft-pazar         to xkonuk-pazar
       if acen-dft-early= 1 move "E" to xkonuk-eb
                 else     move "H" to xkonuk-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xkonuk-bilbord-eh
                 else     move "H" to xkonuk-bilbord-eh
              end-if
       modify eraly-booking-cb, value = acen-dft-early
       modify fix-fiyat-cb, value = acen-dft-fix
       modify aks-cb, value = acen-dft-aksiyon-yok
       modify bilbord-cb, value = acen-dft-bilboard 
       modify spe-cb, value = acen-dft-special-yok
       perform eraly-booking-cb-Ex-Cmd-Clicked
       perform fix-fiyat-cb-Ex-Cmd-Clicked
       perform bilbord-cb-Ex-Cmd-Clicked
       perform spe-cb-Ex-Cmd-Clicked

       perform aks-cb-Ex-Cmd-Clicked
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke    Form1-Pb-4 acc-viptipi
                 perform vip-goster
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit

            .
*
 spe-cb-ex-cmd-clicked.
         inquire spe-cb, value in sayi
          if xkonuk-acenta = not-dos-anah(8:4) and
                  acen-dft-specialyok-sabit = 1 and 
                  acen-dft-special-yok not = sayi
                  display message box "Acenta icin Special degeri girilmis  " new-line
                                      "Aksiyon varsayilan degerine degistirildi"
                                      title "Bilginize"
                    modify spe-cb, value =  acen-dft-special-yok
             
              
        end-if.
     .
*
 aks-cb-ex-cmd-clicked.
      evaluate control-id
         when 135

              inquire aks-cb, value in sayi
              if sayi = 1 move "H" to xkonuk-aksiyon-eh
                 else     move "E" to xkonuk-aksiyon-eh
              end-if
        end-evaluate.
          if xkonuk-acenta = not-dos-anah(8:4) and
          acen-dft-aksiyonyok-sabit = 1 and 
          acen-dft-aksiyon-yok not = sayi
          display message box "Acenta icin Aksiyon degeri girilmis  " new-line
                              "Aksiyon varsayilan degerine degistirildi"
                              title "Bilginize"
            modify aks-cb, value =  acen-dft-aksiyon-yok
             
              if acen-dft-aksiyon-yok = 1 move "E" to xkonuk-aksiyon-eh
                 else                 move "H" to xkonuk-aksiyon-eh
              end-if
        end-if.
     .
*
 blokaj-degisim-yaz.
       open i-o blokd
       initialize blokd-rec 
       move tarih-tasi           to blokd-tarih
       accept blokd-zaman from time
       move rez-no          to blokd-rez-no
       read blokd no lock invalid 
           continue 
       end-read 
       move k-kodu-tasi        to blokd-k-kodu
       move rez-odano          to blokd-odano
       write blokd-rec invalid 
           rewrite blokd-rec end-rewrite 
       end-write 
       close blokd.
*
 accept-oda-tutar-dv-Ev-Cmd-Goto.
****      display message box "LUTFEN Doviz Tutarlarini TL Tutar Bolumunde F1 i tuslayip giriniz..." title "F1 ile giriniz"
      move 4 to accept-control
      move 2001 to control-id. 
*
 Form3-Ex-Other.
     evaluate key-status
     when 2 
        if neden-silindi = spaces
           display message box "Silme Nedeni Yazilmadan Devam edilemez.."
                           title "Uyari"
                           icon 1
             exit paragraph 
        else
           set exit-pushed to true
        end-if 
     when 27
        if neden-silindi = spaces
           display message box "Silme Nedeni Yazilmadan Devam edilemez.."
                           title "Uyari"
                           icon 1
             move 3 to key-status
             
             exit paragraph 
        else
           set exit-pushed to true
        end-if         
     end-evaluate.
*
 Form1-Pb-7-Link.
 
         if NOT (k-kodu-tasi = "ASYA" OR K-KODU-TASI = "X   ")
              EXIT PARAGRAPH
         END-IF
    





      initialize konuk-rec i
      move "I"            to konuk-durumu
      start konuk key not < konuk-oda invalid 
          continue 
      not invalid 
      perform with test after until fs-konuk = "10"
      read konuk next no lock end move "10" to fs-konuk
      not at end 
             if konuk-durumu <> "I"
                 exit perform 
             end-if 
          
             if konuk-fol-kodu <> "E"
                 exit perform cycle 
             end-if

*             if konuk-fol-kodu <> "R"
*                 exit perform cycle 
*             end-if

    
             initialize rez-rec
             move KONUK-EXTRA-REZ-NO to rez-no
             read rez no lock invalid
                  exit perform cycle
             end-read

*             initialize rez-rec
*             move konuk-rez-no to rez-no
*             read rez no lock invalid
*                   exit perform cycle
*             end-read
        
             if rez-extra-kart <> spaces or rez-extra-kart <> zeroes
                open input genel
                move 1 to genel-anahtar
                read genel no lock invalid 
                     continue
                not invalid 
                     continue
                end-read
                close genel                     
                move cost-sirketi of genel to kart-dosya-adres
                open input kart
                initialize kart-rec
                move REZ-EXTRA-KART to kart-no
                read kart no lock invalid
                     continue
*                not invalid
*                    close kart
*                    exit perform cycle
                end-read
                close kart
             end-if
             
             move konuk-folio(2:) to REZ-EXTRA-KART
             perform extra-kart-tanimla
       
              

             accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
             accept rez-edit-zaman from time          |                           
             
             rewrite rez-rec invalid
                     continue
             end-rewrite

             rewrite konuk-rec invalid
                     continue
             end-rewrite
             add 1 to i
      end-read 
      end-perform
      end-start

      display message box i " adet extra kart acildi"
     .
*
 extsil-gonder.
        if CINPARA-EXT-FOL-ADET > 0 and CINPARA-EXT-FOL-AC = "E" and konuk-fol-kodu = "R" then
         exit paragraph
      end-if
        move "Sil" to l-bos(1:3)
          move ONKPARA-MAIL-DEP OF GENEL  to e-dep(1) 
         call "/asya/ytl/obj/otel/extsat.asy" using konuk-odano konuk-folio e-dep(1) e-sat(1) l-bos
          on exception perform callerr-proc
             not on exception
        cancel "/asya/ytl/obj/otel/extsat.asy" 
         end-call.  
*
 acc-viptipi-Aft-Procedure.
     perform vip-goster
     .
*
 plaka-yaz.

      if plaka-text = spaces
                    read plaka  no lock invalid continue not invalid delete plaka invalid continue end-delete end-read
                    else
                   rewrite plaka-rec invalid write plaka-rec end-rewrite
                 end-if
                 .
*
  onay-takip.      



            open i-o onay 
 

            
                        initialize onay-rec
                        set  CIN-ONAY to true
                         move xrez-no to  ONAY-ANAHTAR
                         read onay no lock invalid 




                         set  ONAY-BEKLER to true
                       
                        
             
                             
                             
                           
                                  string  xrez-adi delimited by "   "
                                          " " delimited by size
                                         xrez-soyadi delimited by "   "
                                          new-line  delimited by size
                                          "ait devremulk rezervasyon borcu oldugu halde CIN Talebi"  delimited by size
                                         
                                          into onay-text

                                        move k-kodu-tasi to ONAY-IST-STAF
                                        accept ONAY-IST-TARIH from century-date 
                                        accept ONAY-IST-zaman  from time


                                       write onay-rec invalid continue
                                          rewrite onay-rec end-write
                                          display message box onay-text new-line 
                                              "Onay talebi girilmistir"
                                        not invalid 
                                        if not ONAY-VERILDI  then 
                                            display message box "Onaylanmamis CIN Talebi " title "Onayla"

                                        end-if


                                end-read
                              
                                        close  onay 
                                .       
*
 gf-Ev-Msg-Begin-Entry.
     
      if  event-data-2 > 1
          
         inquire f-onay(event-data-2,1)  hidden-data in ONAY-id 
         if ONAY-rec not = spaces
         open i-o onay
         read onay no lock invalid
             perform onay-getir
             not invalid 
            
             if ONAY-VERILDI 
                 perform onay-getir
             else
               perform onay-getir
             end-if

        end-read
        close onay
        else
           perform onay-getir
        end-if


         
     
    end-if
     set event-action to event-action-fail
     .
* 
 onay-getir.
     inquire f-onay(event-data-2,1)  hidden-data in link-onay 
                  call "/asya/ytl/obj/otel/onaygir.asy" 
                       using link-onay 
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/onaygir.asy"
                  end-call .
*
*
 xkonuk-oda-uzat.  
            move  xkonuk-odano to o-kisa 
            perform oda-uzat
            move o-uzun to xkonuk-odano-uzun.
            display accept-odano-uzun.
*
 xkonuk-oda-kisalt.  
      if genel-uzun-oda-no-kullanilsin = 1
            move  xkonuk-odano-uzun  to o-uzun
            perform oda-kisalt
            move o-kisa to   xkonuk-odano
             display accept-odano
       end-if .
*
 accept-odano-Ex-Ntf-Changed.
     perform xkonuk-oda-kisalt
     .
*
 Form1-Pb-8-Link.
      call "/asya/ytl/obj/otel/posting.asy" using konuk-folio , 1
                 on exception perform callerr-proc
                    not on exception
                       cancel "/asya/ytl/obj/otel/posting.asy" 
           end-call
     .
*
 l-yaz.
      continue.
 eski-yaz.
      continue.
 yeni-yaz.
    continue.
 a-yaz.
     continue.

*
 yastan-bul.    
    initialize pi ai zi coklar2
    perform varying pi 
            from 1 
            by 1 
            until pi > xkonuk-buyuk  
                 if pi >= 8
                    exit perform 
                 end-if 
                 move 50 to lnk2-yas(pi)   
    end-perform 

    perform varying zi from pi by 1 until  zi > 8
        compute ai = zi - pi + 1 
        if ai not > 5                        
          if tum-doglar(ai)(1:4) > 1900
            move xrez-gir-tar     to gbugun
            move tum-doglar(ai)  to gdogtar
            initialize yasbulfark-yil-say
            perform gyas-hes-pro       
            initialize str-yas               
            move yasz         to str-yas
            if function numval(yasz) < 1
               move 1         to str-yas
            end-if 
            call "c$justify" using str-yas,"L"
            move function numval(str-yas(1:2)) to lnk2-yas(zi) cocuk-yas2(zi)               
          else
*            if ai = 1                                     | bonadea da ki hata için degistirildi 22/2/2019 firt
*               move 99 to lnk2-yas(1) cocuk-yas2(1)
*            end-if 
            evaluate ai 
                when 1 
                     move 99 to lnk2-yas(1) cocuk-yas2(1)
                when 2
                     if adi2 <> spaces 
                        move 99 to lnk2-yas(2) cocuk-yas2(2)
                     end-if
                when 3
                     if adi3 <> spaces 
                        move 99 to lnk2-yas(3) cocuk-yas2(3)
                     end-if
                when 4
                     if adi4 <> spaces 
                        move 99 to lnk2-yas(4) cocuk-yas2(4)
                     end-if
                when 5
                     if adi5 <> spaces 
                        move 99 to lnk2-yas(5) cocuk-yas2(5)
                     end-if
            end-evaluate 
          end-if               
        end-if
     end-perform 
        sort C22 descending KEY cocuk-yas2
        move coklar2  to lnk2-yaslar.
*
 btn-kol-bandi-Link.
     initialize link-bant-rez-no
     move xrez-no to link-bant-rez-no
     if link-bant-rez-no = zeroes
          move xkonuk-rez-no to link-bant-rez-no 
     end-if
     call "/asya/ytl/obj/otel/banttanm.asy" 
                using link-bant-rez-no 
                on exception 
                perform callerr-proc
                exit paragraph
                not on exception 
     cancel "/asya/ytl/obj/otel/banttanm.asy"
     end-call
     .
*
 btn-late-cout-Link.
     initialize link-late-rez-no
     move xrez-no    to link-late-rez-no
     move xrez-odano to link-late-odano
     move "O"        to link-late-nereden
     call "/asya/ytl/obj/otel/lateacik.asy" 
          using link-late-rez-no, 
                link-late-odano, 
                link-late-nereden 
          on exception 
          perform callerr-proc
          exit paragraph
          not on exception 
     cancel "/asya/ytl/obj/otel/lateacik.asy"
     end-call
     .
*
 yanrez-karalist-kontrol.                                      |firat 30/01/2020 karaliste kontrol ekleme
            evaluate klist-yan-kac
            when 2
                   MOVE adi2 TO ykara-isim
                   move soy2 to ykara-soyisim
            when 3
                   MOVE adi3 TO ykara-isim
                   move soy3 to ykara-soyisim
            when 4
                   MOVE adi4 TO ykara-isim
                   move soy4 to ykara-soyisim
            when 5
                   MOVE adi5 TO ykara-isim
                   move soy5 to ykara-soyisim
            when 6
                   MOVE adi6 TO ykara-isim
                   move soy6 to ykara-soyisim
            when 7
                   MOVE adi7 TO ykara-isim
                   move soy7 to ykara-soyisim
            when 8
                   MOVE adi8 TO ykara-isim
                   move soy8 to ykara-soyisim
            when 9
                   MOVE adi9 TO ykara-isim
                   move soy9 to ykara-soyisim
            when other 
                   exit paragraph
            END-EVALUATE
            if ykara-isim = spaces or ykara-soyisim = spaces
                  exit paragraph
            end-if
            open input karalist            
              move "M" to karalist-tipi 
              move ykara-isim    to karalist-adi 
              move ykara-soyisim to karalist-soyadi 
              read karalist no lock invalid 
                  continue
              not invalid 
                   display message box  karalist-adi " " karalist-soyadi " Misafir Kara Listede.." new-line
                                        "Aciklama : " KARALIST-ACK-1 new-line
                                        "Aciklama : " KARALIST-ACK-2 new-line
                                        "Islem iptal edildi."
                                   title "Uyari"
                                   icon 2
                   close karalist
                   
                   move 1 to gec-gecme
                   exit paragraph
              end-read
            close karalist.
*
 kvkk-belge-kayit.
     initialize kvkk-cagir
     move konuk-rez-no to kvkk-cagir-giden-rez
     call "/asya/ytl/obj/otel/kvkkgir.asy" 
                using kvkk-cagir 
                on exception 
                perform callerr-proc
                exit paragraph
                not on exception 
     cancel "/asya/ytl/obj/otel/kvkkgir.asy"
     end-call
     .

 
*
 accept-tel-no-Ev-Cmd-Goto.
     if genel2-gelismis-telefon = 1 
        perform Acu-Form4-Routine
        display accept-tel-no
     end-if
     .
*
 Form4-Ex-Other.
     evaluate key-status 
         when 2
              if tel-telno <> spaces 
                 move tum-tel to xkonuk-telefon-no
              end-if
              set exit-pushed to true
     end-evaluate
     .
*
 Form4-Aft-Initdata.
     initialize tum-tel
     move xkonuk-telefon-no to tum-tel
     display acc-tel-ulke acc-tel-bolge acc-tel-telno
     .
*
 accept-mail-Ev-Cmd-Goto.
     exit paragraph
     if xkonuk-durumu = "H" 
        perform Acu-Form5-Routine
        display accept-mail
     end-if
     .
*
 Form5-Ex-Other.
     evaluate key-status 
         when 2
              if hist-mail <> spaces 
                 initialize konuk-rec 
                 move xkonuk-folio to konuk-folio 
                 read konuk no lock invalid
                      continue
                 not invalid
                     move hist-mail to konuk-mail-adr xkonuk-mail-adr
                     rewrite konuk-rec invalid
                        stop " " 
                     end-rewrite 
                     perform log-operation-konuk
                 end-read 
              end-if
              set exit-pushed to true
     end-evaluate
     .
*
 sifreleme-yap.
                  unstring sifreli-text delimited by " " into
                           kelimem(1)
                           kelimem(2)
                           kelimem(3)
                           kelimem(4)
                           kelimem(5)
                           kelimem(6)
                           kelimem(7)
                           kelimem(8)
                           kelimem(9)
                           kelimem(10)
                  
                  inspect kelime-occurs replacing all spaces by low-values
                  
                  perform varying r
                  from 1
                  by 1
                  until r > 10
                  
                     initialize word-length
                     perform varying word-length
                     from 1 
                     by 1
                     until word-length > 50
                        if kelimem(r)(word-length:1) = low-values 
                           exit perform  
                        end-if
                     end-perform 
                     compute word-length = word-length - 3
                  
                     if kelimem(r) <> low-values                        
                        move all "*" to kelimem(r)(3:word-length)
                     end-if
                  end-perform                                                                                                                   
                  
                  initialize sifreli-text
                  move low-values                 to sifreli-text
                  
                  perform varying r
                  from 1
                  by 1
                  until r > 10
                      string sifreli-text 
                             kelimem(r) delimited by low-values
                             " "       delimited by low-values
                             into sifreli-text
                  end-perform
                  inspect sifreli-text replacing all low-values by spaces.

 
