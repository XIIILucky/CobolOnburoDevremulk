* fiymus.evt
* fiymus.evt is generated from D:\asya\acugt.ytl\otel\fiymus.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM exception-procedure
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.

     .
*
 Form1-Ef-1-Aft-Procedure.
       initialize gec-gecme
       if rapor-acenta = spaces
          modify lb-acen-adi, title = "Tum Acentalar"
          exit paragraph.
       open input acenta
       move rapor-acenta to acenta-kodu
       read acenta no lock invalid 
                   modify lb-acen-adi, title = "Tanimsiz Acenta"
                   move 4 to accept-control
                   move 4 to control-id
                   move 1 to gec-gecme
        not invalid
            modify lb-acen-adi, title = acenta-adi
        end-read
        close acenta.
     .
*
 before-procedure.
      
     .
 Form1-Aft-Initdata.
     move "01" to det-tip-value.
     initialize rapor-acenta.     
     display form1.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .
 exception-procedure.
     evaluate key-status
        when 1
        evaluate control-id
        when 41
            initialize gruplar-cagir
            call "/asya/ytl/obj/otel/gruplara.asy" using gruplar-cagir
                 on exception perform callerr-proc
                 not on exception
            cancel "/asya/ytl/obj/otel/gruplara.asy" 
            end-call
            if gruplar-cagir > 0 then 
               move gruplar-cagir   to rapor-grup
               display Form1-Ef-1aa
           
            end-if
        when 4
        when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to rapor-acenta
                        display form1-ef-1
                     end-if
             end-call
             move 4 to accept-control
             move 12 to control-id
        when 12
        when 13
             initialize firma-cagir
             call "/asya/ytl/obj/otel/firmara.asy" 
                  using firma-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if firma-cagir <> spaces
                        move firma-cagir to rapor-firma
                        display accept-0102
                     end-if
             end-call
             move 4 to accept-control
             move 14 to control-id
           
        end-evaluate
        exit paragraph

         when 2 
            
              perform Form1-Ef-1-Aft-Procedure  
              perform accept-0102-Aft-Procedure
              if gec-gecme = 0
                 
                 perform takas-yaz
                 perform rapor-ver
              end-if
     end-evaluate.

 rapor-ver.
              open input tkonuk kodlar02 cast firma malzeme 
                         takastop romhrk rez doviz acenta odalar 
              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi    
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Fiyat Kontrol Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Fiyat Kontrol Raporu"   to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move gun-tasi       to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ay-tasi        to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move yil-tasi       to det-filler(57:04)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Acenta....:"           to det-filler(01:13)
     move rapor-acenta            to det-filler(15:04)
     move "<->"                   to det-filler(20:03)
     if rapor-acenta  = spaces
        move "Tum Acentalar.."    to det-filler(25:20)
     else
*********open input acenta********************
        initialize acenta-rec  
        move rapor-acenta   to acenta-kodu
        read acenta no lock invalid 
             move all "*" to acenta-adi  
                        not invalid continue
        end-read
*********close acenta************************
        move acenta-adi           to det-filler(25:20)
     end-if
     move "Rapor Tipi..:"          to det-filler(50:15)
     if rb-degisken-1 = 1
        move "Fiyatlar Konuk Kartindan"     to det-filler(65:)
     else
        move "Fiyatlar Foliodan      "      to det-filler(65:)
     end-if
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Firma....:"           to det-filler(01:14)
     move rapor-firma            to det-filler(15:04)
     move "<->"                   to det-filler(20:03)
     if rapor-firma  = spaces
        move "Tum Firma.."    to det-filler(25:20)
     else
*********open input acenta********************
        initialize firma-rec  
        move rapor-firma   to firma-kodu
        read firma no lock invalid 
             move all "*" to firma-adi  
                        not invalid continue
        end-read
*********close acenta************************
        move firma-adi           to det-filler(25:20)
     end-if
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLLLLLRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
     move "Oda"             to det-01
     move "#"               to det-01-01
     move "Adi"             to det-02
     move "Soyadi"          to det-03
     move "Pax"             to det-04
     move "Chi"             to det-05
     move "Free"            to det-06
     move "Beb."            to det-066
     move "PK"              to det-07
     move "OK"              to det-08
     move "Acenta"          to det-09
     move "Firma"           to det-090
     move "Grup"            to det-099
     move "C/In"            to det-091
     move "C/out"           to det-092
     move "DK"              to det-10
     move "[DV] Toplam"     to det-11
     move "Kur"             to det-111
     move "[TL] Toplam"     to det-12
     move "Isl.T"           to det-121 
     move "Kbl Tar"            to det-122
     move "Oda Tutar"       to det-13
     move "Doviz"           to det-14
     move "Kahvalti"        to det-15
     move "Ogle  "          to det-16
     move "Aksam "          to det-17
     move "Coffe Break"     to det-18
     move "Diger"           to det-19
     move "Folio"           to det-folio
     move "|" to fil-01 fil-01-01 fil-02 fil-03 fil-04 fil-05 fil-06
                 fil-066 fil-07 fil-08 fil-09 fil-090 fil-091 fil-092 fil-121 
                 fil-10 fil-11 fil-12 fil-19 fil-099 fil-111        fil-122
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-18  fil-folio

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-01 det-01-01 det-02 det-03 det-04 det-05 det-06
                     det-066 det-07 det-08 det-09 det-090  det-099 det-111
                     det-091 det-092 det-121 det-122 det-10 det-11 det-12 det-19
                     det-13 det-14 det-15 det-16 det-17 det-18 det-folio
    move "|" to fil-01 fil-01-01 fil-02 fil-03 fil-04 fil-05 fil-06
                 fil-066 fil-07 fil-08 fil-09 fil-090 fil-091 fil-092 fil-121 
                 fil-10 fil-11 fil-12 fil-19 fil-099 fil-111      fil-122
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-18  fil-folio
     write dokumer-rec from detay
*********************************
          if det-tip-value(1:2) not = "01"
              initialize takastop-rec genel-share
              move det-tip-value(1:2) to takastop-tip
              start takastop key not < takastop-anah invalid 
                   continue 
              not invalid 
              perform with test after until fs-takastop = "10"
              read takastop next no lock end move "10" to fs-takastop
              not at end
                      if takastop-tip <> det-tip-value(1:2) 
                         exit perform 
                      end-if 

                      initialize dokumer-rec detay 
                      evaluate det-tip-value(1:2)
                      when "02"                          
                          initialize firma-rec 
                          move takastop-alt-anah  to firma-kodu
                          read firma no lock invalid
                               move "     "  to firma-adi
                          end-read 
                               move firma-adi     to det-090
                      when "03"                      
                          initialize acenta-rec 
                          move takastop-alt-anah  to acenta-kodu
                          read acenta no lock invalid
                               move "     "  to acenta-adi
                          end-read 
                               move acenta-adi     to det-09
                      when "04"
                           
                          initialize doviz-rec 
                          move function numval(takastop-alt-anah)  to doviz-kodu
                          read doviz no lock invalid
                               move "     "  to D-KISA-ADI
                          end-read 
                               move D-KISA-ADI     to det-14
                      when "05"
                          initialize kodlar02-rec 
                          move "A"               to kodlar02-tipi
                          move takastop-alt-anah to kodlar02-kodu
                          read kodlar02 no lock invalid 
                              move "    "        to kodlar02-adi 
                          end-read 
                              move kodlar02-kodu  to det-07
                      end-evaluate

                             move takastop-oda   to eoda-toplam
                             move eoda-toplam    to det-01
                             move takastop-pax   to eoda-toplam
                             move eoda-toplam    to det-04
                             move takastop-chi   to eoda-toplam
                             move eoda-toplam    to det-05
                             move takastop-fre   to eoda-toplam
                             move eoda-toplam    to det-06
                             move takastop-beb   to eoda-toplam
                             move eoda-toplam    to det-066
                             move takastop-share-adet to eoda-toplam
                             move eoda-toplam    to det-02

                             move takastop-dv-degeri to etutar-dv
                             move etutar-dv          to det-11

                             move takastop-oda-tutar to etutar-tl
                             move etutar-tl          to det-12 det-13

                             move takastop-kah to etutar-dv
                             move etutar-dv          to det-15
                             move takastop-ogle to etutar-dv
                             move etutar-dv          to det-16
                             move takastop-aksam to etutar-dv
                             move etutar-dv          to det-17

                             move takastop-cafe to etutar-dv
                             move etutar-dv          to det-18

                             move takastop-diger to etutar-dv
                             move etutar-dv          to det-19

                             move "|" to fil-01 fil-01-01 fil-02 fil-03 fil-04 fil-05 fil-06
                              fil-066 fil-07 fil-08 fil-09  fil-090   fil-19  fil-111
                               fil-091 fil-092 fil-121 fil-122 fil-10 fil-11 fil-12  fil-099
                              fil-13 fil-14 fil-15 fil-16 fil-17 fil-18 fil-folio
                            move "|" to fil-01 fil-01-01 fil-02 fil-03 fil-04 fil-05 fil-06
                 fil-066 fil-07 fil-08 fil-09 fil-090 fil-091 fil-092 fil-121 fil-122
                 fil-10 fil-11 fil-12 fil-19 fil-099 fil-111
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-18  fil-folio
                             move "A"          to det-dokumer-20(3:1)
                             move 481          to det-renk1
                             move "1"          to det-dokumer-20(10:1)
                      
                      write dokumer-rec from detay
                      
                          perform detay-yaz 
                      

              end-read 
              end-perform
              end-start
            else 
              perform detay-yaz
            end-if 
                if rapor-bilgi-yok not = 1
                    perform genel-toplam
                end-if 
               close  dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              if rapor-bilgi-yok not = 1
                  close takastop  tkonuk kodlar02 cast firma  malzeme odalar
                    romhrk rez doviz acenta
              end-if 
               
              delete file dokumer tkonuk takastop. 
*
 detay-yaz.
     initialize rapor-bilgi-yok
     evaluate det-tip-value(1:2)
     when "01"
                      initialize tkonuk-rec  
                      move "I"   to tkonuk-durumu
                      start tkonuk key not < tkonuk-oda invalid
                            initialize mesaj-link
                            move 04 to mesaj-no
                            perform mesaj-ver
                            close tkonuk kodlar02 dokumer doviz 
                                  takastop cast romhrk firma rez acenta malzeme odalar
                            move 1  to rapor-bilgi-yok
                            exit paragraph
                      end-start
       
     when "02"
                      initialize tkonuk-rec 
                      move "I"   to tkonuk-durumu
                      move takastop-alt-anah   to tkonuk-firma
                      start tkonuk key not < tkonuk-fir invalid
                            initialize mesaj-link
                            move 04 to mesaj-no
                            perform mesaj-ver
                            close tkonuk kodlar02 dokumer doviz malzeme
                                  takastop cast romhrk firma rez acenta odalar
                                  move 1  to rapor-bilgi-yok
                            exit paragraph
                      end-start
     when "03"
                      initialize tkonuk-rec
                      move "I"   to tkonuk-durumu
                      move takastop-alt-anah   to tkonuk-acenta
                      start tkonuk key not < tkonuk-acen invalid
                            initialize mesaj-link
                            move 04 to mesaj-no
                            perform mesaj-ver
                            close tkonuk kodlar02 takastop dokumer malzeme
                                  doviz cast romhrk firma rez acenta odalar
                                  move 1  to rapor-bilgi-yok
                            exit paragraph
                      end-start
     when "04"
                      initialize tkonuk-rec
                      move "I"                 to tkonuk-durumu
                      move function numval(takastop-alt-anah)   to tkonuk-doviz
                      start tkonuk key not < tkonuk-dovi invalid
                            initialize mesaj-link
                            move 04 to mesaj-no
                            perform mesaj-ver
                            close tkonuk kodlar02 takastop dokumer malzeme
                                  cast doviz romhrk firma rez acenta odalar
                                  move 1  to rapor-bilgi-yok
                            exit paragraph
                      end-start
     when "05"
                      initialize tkonuk-rec
                      move "I"                 to tkonuk-durumu
                      move takastop-alt-anah   to tkonuk-pan-tipi
                      start tkonuk key not < tkonuk-pan invalid
                            initialize mesaj-link
                            move 04 to mesaj-no
                            perform mesaj-ver
                            close tkonuk kodlar02 takastop dokumer malzeme
                                  cast doviz romhrk firma rez acenta odalar
                                  move 1  to rapor-bilgi-yok
                            exit paragraph
                      end-start
     end-evaluate
         initialize  toplamlar gen-toplam  gen-toplam-dv  
         perform with test after until fs-tkonuk = "10"
         read tkonuk next no lock end move "10" to fs-tkonuk
         not at end 
                evaluate det-tip-value(1:2)
                when "01"
                   if tkonuk-durumu <> "I"
                       exit perform 
                   end-if 
                when "02"
                   if tkonuk-firma <> takastop-alt-anah or
                      tkonuk-durumu <> "I"
                          exit perform 
                   end-if
                when "03"
                   if tkonuk-acenta <> takastop-alt-anah or
                      tkonuk-durumu <> "I"
                          exit perform 
                   end-if
                when "04"
                   if tkonuk-doviz <> function numval(takastop-alt-anah) or
                      tkonuk-durumu <> "I"
                          exit perform 
                   end-if
                when "05"
                   if tkonuk-pan-tipi <>  takastop-alt-anah or
                      tkonuk-durumu <> "I"
                          exit perform 
                   end-if
                  
                end-evaluate
                         initialize dokumer-rec detay konuk-toplam odalar-anah
                         if tkonuk-fol-kodu = "R"
                            initialize cast-rec
                            move tarih-tasi        to cast-tarih
                            move tkonuk-rez-no      to cast-rez-no
                            read cast no lock invalid
                                continue 
                            not invalid 
                               if cast-share = 1
                                  move 0           to det-01-01
                               else
                                  move 1           to det-01-01            
                                   
                               end-if                               
                            end-read 
                         end-if 

                         move tkonuk-odano       to det-01 odalar-anah
                         read odalar no lock invalid
                              continue
                         end-read
                         if odalar-uzun-no not = spaces
                            move odalar-uzun-no to det-01
                         end-if
                         move tkonuk-adi         to det-02
                         move tkonuk-soyadi      to det-03
                         move tkonuk-buyuk       to det-04
                         move tkonuk-kucuk       to det-05
                         move tkonuk-free        to det-06
                         move tkonuk-bebek       to det-066
                         move tkonuk-pan-tipi    to det-07
                         if tkonuk-GRUP-NO > zeroes 
                            move tkonuk-GRUP-NO     to det-099
                         end-if 
                         move tkonuk-kur-degeri  to ekur
                         move ekur               to det-111
                         move tkonuk-odeme-tipi  to det-08
                         move tkonuk-acenta to acenta-kodu
                         read acenta no lock invalid
                             continue
                         end-read
                         move acenta-adi to det-09 

                         initialize firma-rec 
                         move tkonuk-firma       to firma-kodu
                         read firma no lock invalid
                              continue 
                         end-read 
                              move firma-adi     to det-090
                         move tkonuk-gel-gun     to gun-for
                         move tkonuk-gel-ay      to ay-for
                         move tar-for            to det-091
                         move tkonuk-git-gun     to gun-for
                         move tkonuk-git-ay      to ay-for
                         
                         move tar-for            to det-092
                         move tkonuk-rez-no      to rez-no
                         read rez no lock invalid
                            continue
                         end-read
                         move rez-isl-gun       to gun-for
                         move rez-isl-ay        to ay-for
                         move tar-for           to det-121

                         move rez-al-gun       to egun
                         move rez-al-ay        to eay
                         move rez-al-yil       to eyil
                         move etar             to det-122

**                         move tar-for           to det-122

                         move tkonuk-dv-degeri  to etutar-dv
                         move etutar-dv         to det-11
                         move tkonuk-oda-tutar  to etutar-tl
                         move etutar-tl         to det-12  det-13

                        move tkonuk-folio       to  det-folio
                        move tkonuk-doviz       to det-10
                        initialize doviz-rec
                        move tkonuk-doviz       to doviz-kodu
                        read doviz no lock invalid 
                            continue 
                        not invalid 
                            move d-kisa-adi     to det-14
                        end-read 
                            perform varying i from 1 by 1 until i > 16
                              if i = 16
                                 exit perform 
                              end-if
                              initialize malzeme-rec
                              move cast-br-malzeme-kodu(i) to malzeme-kodu
                              move tkonuk-doviz             to malzeme-doviz-kodu
                              read malzeme no lock invalid 
                                   continue 
                              not invalid 
                                  evaluate malzeme-grup-tipi
                                  when 1
                                     move cast-br-malzeme-tut(i) to etutar-dv
                                     move etutar-dv             to det-15
                                  when 2
                                     move cast-br-malzeme-tut(i) to etutar-dv
                                     move etutar-dv             to det-16
                                  when 3
                                     move cast-br-malzeme-tut(i) to etutar-dv
                                     move etutar-dv              to det-17
                                  when 4
                                     move cast-br-malzeme-tut(i) to etutar-dv
                                     move etutar-dv              to det-18
                                  when 5
                                     move cast-br-malzeme-tut(i) to etutar-dv
                                     move etutar-dv              to det-19                                     
                                  end-evaluate 
                              end-read 
                            end-perform 
             move "|" to fil-01 fil-01-01 fil-02 fil-03 fil-04 fil-05 fil-06
              fil-066 fil-07 fil-08 fil-09  fil-090  fil-19 fil-111
               fil-091 fil-092 fil-121 fil-122 fil-10 fil-11 fil-12 fil-099
              fil-13 fil-14 fil-15 fil-16 fil-17 fil-18 fil-folio

                        write dokumer-rec from detay

         end-read 
         end-perform.
*
 genel-toplam.
      initialize dokumer-rec detay
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-01 det-01-01 det-02 det-03 det-04 det-05 det-06
                     det-066 det-07 det-08 det-09 det-090  det-099 det-111
                     det-091 det-092 det-121 det-122 det-10 det-11 det-12 det-19
                     det-13 det-14 det-15 det-16 det-17 det-18 det-folio

      write dokumer-rec from detay
      initialize takastop-rec
      move 99            to takastop-tip
      move "GENELTOPLAM" to takastop-alt-anah
      read takastop no lock invalid 
           continue
      not invalid 
             initialize dokumer-rec detay 
             move "|" to fil-01 fil-01-01 fil-02 fil-03 fil-04 fil-05 fil-06
              fil-066 fil-07 fil-08 fil-09  fil-090  fil-19 fil-111
               fil-091 fil-092 fil-121 fil-122 fil-10 fil-11 fil-12 fil-099
              fil-13 fil-14 fil-15 fil-16 fil-17 fil-18 fil-folio

             move takastop-oda   to eoda-toplam
             move eoda-toplam    to det-01
             move takastop-pax   to eoda-toplam
             move eoda-toplam    to det-04
             move takastop-chi   to eoda-toplam
             move eoda-toplam    to det-05
             move takastop-fre   to eoda-toplam
             move eoda-toplam    to det-06
             move takastop-beb   to eoda-toplam
             move eoda-toplam    to det-066      
             move takastop-share-adet to eoda-toplam
             move eoda-toplam    to det-02

             move takastop-dv-degeri to etutar-dv
             move etutar-dv          to det-11

             move takastop-oda-tutar to etutar-tl
             move etutar-tl          to det-12  det-13
             move takastop-kah to etutar-dv
             move etutar-dv          to det-15
             move takastop-ogle to etutar-dv
             move etutar-dv          to det-16
             move takastop-aksam to etutar-dv
             move etutar-dv          to det-17

             move takastop-cafe to etutar-dv
             move etutar-dv          to det-18
             move takastop-diger to etutar-dv
             move etutar-dv          to det-19

             move "A"          to det-dokumer-20(3:1)
             move 176          to det-renk1
             move "1"          to det-dokumer-20(10:1)
             write dokumer-rec from detay           
      end-read.

*
 accept-0102-Aft-Procedure.
       initialize gec-gecme
       if rapor-firma = spaces
          modify lb-firma-adi, title = "Tum Firmalar"
          exit paragraph.
       open input firma
       move rapor-firma to firma-kodu
       read firma no lock invalid 
                   modify lb-firma-adi, title = "Tanimsiz Firma"
                   move 4 to accept-control
                   move 4 to control-id
                   move 1 to gec-gecme
        not invalid
            modify lb-firma-adi, title = firma-adi
        end-read
        close firma.     
     .
*
 takas-yaz.
    open i-o genelfis
    initialize genelfis-rec
    move 1  to genelfis-anahtar
    read genelfis no lock invalid 
        continue
    not invalid
         add 1              to ekran-fis-1
         move ekran-fis-1   to tkonuk-no takastop-no
         rewrite genelfis-rec end-rewrite 
    end-read 
    close genelfis

    open output tkonuk takastop close tkonuk takastop

    open i-o tkonuk konuk takastop cast malzeme odalar
    initialize konuk-rec
    move "I"         to konuk-durumu
    start konuk key not < konuk-oda invalid 
         continue 
    not invalid 
    perform with test after until fs-konuk = "10"
    read konuk next no lock end move "10" to fs-konuk
    not at end 
           if konuk-durumu <> "I"
               exit perform 
           end-if
           move konuk-oda-konumu   to rez-oda-konumu
           move konuk-fiyat-konumu to rez-fiyat-konumu
           if onkpara-referans-var = 1 then 
              perform ref-filtre
              if not ref-gecti then 
                exit perform cycle
              end-if
           end-if
           
           if konuk-fol-kodu not = "R" 
              exit perform cycle
           end-if
           if rapor-acenta not = spaces and
              konuk-acenta not = rapor-acenta
              exit perform cycle 
           end-if
           if rapor-firma not = spaces and
              konuk-firma not = rapor-firma
              exit perform cycle 
           end-if
           if rapor-voucher not = spaces and
              konuk-voucher not = rapor-voucher
                exit perform cycle 
           end-if
           if rapor-grup not = zeroes    and
              konuk-grup-no not = rapor-grup 
                 exit perform cycle 
           end-if 
         initialize takastop-rec 
         evaluate det-tip-value(1:2)           
             when 02 move konuk-firma         to takastop-alt-anah
             when 03 move konuk-acenta        to takastop-alt-anah
             when 04 move konuk-doviz         to takastop-alt-anah
             when 05 move konuk-pan-tipi      to takastop-alt-anah
         end-evaluate

             move det-tip-value(1:2)          to takastop-tip
             read takastop no lock invalid 
                   move 1           to takastop-oda
                   move konuk-buyuk to takastop-pax
                   move konuk-kucuk to takastop-chi
                   move konuk-free  to takastop-fre
                   move konuk-bebek to takastop-beb
                   move konuk-dv-degeri to takastop-dv-degeri
                   move KONUK-ODA-TUTAR to takastop-oda-tutar

                   if konuk-fol-kodu = "R"
                      initialize cast-rec
                      move tarih-tasi        to cast-tarih
                      move konuk-rez-no      to cast-rez-no
                      read cast no lock invalid
                          continue 
                      not invalid 
                              if cast-share = 1
                                 move 0           to takastop-share-adet
                              else                                          
                                 move 1           to takastop-share-adet
                              end-if
                            perform varying i from 1 by 1 until i > 16
                              if i = 16
                                 exit perform 
                              end-if
                              initialize malzeme-rec
                              move cast-br-malzeme-kodu(i) to malzeme-kodu
                              move konuk-doviz             to malzeme-doviz-kodu
                              read malzeme no lock invalid 
                                   continue 
                              not invalid 
                                  evaluate malzeme-grup-tipi
                                  when 1
                                     move cast-br-malzeme-tut(i) to takastop-kah
                                  when 2
                                     move cast-br-malzeme-tut(i) to takastop-ogle
                                  when 3
                                     move cast-br-malzeme-tut(i) to takastop-aksam
                                  when 4                                  
                                     move cast-br-malzeme-tut(i) to takastop-cafe
                                  when 5
                                     move cast-br-malzeme-tut(i) to takastop-diger
                                  end-evaluate 
                              end-read 
                            end-perform                                
                      end-read 
                   end-if                    
                   write takastop-rec end-write 
             not invalid 
                   add 1           to takastop-oda 
                   add konuk-buyuk to takastop-pax
                   add konuk-kucuk to takastop-chi
                   add konuk-free  to takastop-fre
                   add konuk-bebek to takastop-beb
                   add konuk-dv-degeri to takastop-dv-degeri
                   add KONUK-ODA-TUTAR to takastop-oda-tutar

                   if konuk-fol-kodu = "R"
                      initialize cast-rec
                      move tarih-tasi        to cast-tarih
                      move konuk-rez-no      to cast-rez-no
                      read cast no lock invalid
                          continue 
                      not invalid 
                              if cast-share = 1
                                 add 0           to takastop-share-adet
                              else                                          
                                 add 1           to takastop-share-adet
                              end-if
                            perform varying i from 1 by 1 until i > 16
                              if i = 16
                                 exit perform 
                              end-if
                              initialize malzeme-rec
                              move cast-br-malzeme-kodu(i) to malzeme-kodu
                              move konuk-doviz             to malzeme-doviz-kodu
                              read malzeme no lock invalid 
                                   continue 
                              not invalid 
                                  evaluate malzeme-grup-tipi
                                  when 1
                                     add cast-br-malzeme-tut(i) to takastop-kah
                                  when 2
                                     add cast-br-malzeme-tut(i) to takastop-ogle
                                  when 3
                                     add cast-br-malzeme-tut(i) to takastop-aksam
                                  when 4                                  
                                     add cast-br-malzeme-tut(i) to takastop-cafe
                                  when 5
                                     add cast-br-malzeme-tut(i) to takastop-diger
                                  end-evaluate 
                              end-read 
                            end-perform                                
                      end-read 
                   end-if                    
                   rewrite takastop-rec end-rewrite 
             end-read 
                perform genel-toplam-takas-yaz
             move konuk-rec        to tkonuk-rec
             write tkonuk-rec invalid 
                continue 
             end-write
 
    end-read 
    end-perform
    end-start
    close tkonuk konuk takastop cast malzeme odalar.
*
 genel-toplam-takas-yaz.
*/genel toplam almak için
             initialize takastop-rec 
             move 99            to takastop-tip
             move "GENELTOPLAM" to takastop-alt-anah
             read takastop no lock invalid 
                   move 1           to takastop-oda
                   move konuk-buyuk to takastop-pax
                   move konuk-kucuk to takastop-chi
                   move konuk-free  to takastop-fre
                   move konuk-bebek to takastop-beb
                   move konuk-dv-degeri to takastop-dv-degeri
                   move KONUK-ODA-TUTAR to takastop-oda-tutar
                   if konuk-fol-kodu = "R"
                      initialize cast-rec
                      move tarih-tasi        to cast-tarih
                      move konuk-rez-no      to cast-rez-no
                      read cast no lock invalid
                          continue 
                      not invalid 
                          if cast-share = 1
                             move  0           to takastop-share-adet
                          else                                          
                             move 1            to takastop-share-adet
                          end-if
                          perform varying i from 1 by 1 until i > 16
                            if i = 16
                               exit perform 
                            end-if
                            initialize malzeme-rec
                            move cast-br-malzeme-kodu(i) to malzeme-kodu
                            move konuk-doviz             to malzeme-doviz-kodu
                            read malzeme no lock invalid 
                                 continue 
                            not invalid 
                                evaluate malzeme-grup-tipi
                                when 1
                                   move cast-br-malzeme-tut(i) to takastop-kah
                                when 2
                                   move cast-br-malzeme-tut(i) to takastop-ogle
                                when 3
                                   move cast-br-malzeme-tut(i) to takastop-aksam
                                when 4                                  
                                   move cast-br-malzeme-tut(i) to takastop-cafe
                                when 5
                                   move cast-br-malzeme-tut(i) to takastop-diger
                                end-evaluate 
                            end-read 
                          end-perform 
                               
                      end-read 
                   end-if
                   write takastop-rec end-write 
             not invalid 
                   add 1           to takastop-oda 
                   add konuk-buyuk to takastop-pax
                   add konuk-kucuk to takastop-chi
                   add konuk-free  to takastop-fre
                   add konuk-bebek to takastop-beb
                   add konuk-dv-degeri to takastop-dv-degeri
                   add KONUK-ODA-TUTAR to takastop-oda-tutar

                   if konuk-fol-kodu = "R"
                      initialize cast-rec
                      move tarih-tasi        to cast-tarih
                      move konuk-rez-no      to cast-rez-no
                      read cast no lock invalid
                          continue 
                      not invalid 
                         if cast-share = 1
                            add 0           to takastop-share-adet
                         else                                          
                            add 1           to takastop-share-adet
                         end-if 
                         perform varying i from 1 by 1 until i > 16
                           if i = 16
                              exit perform 
                           end-if
                           initialize malzeme-rec
                           move cast-br-malzeme-kodu(i) to malzeme-kodu
                           move konuk-doviz             to malzeme-doviz-kodu
                           read malzeme no lock invalid 
                                continue 
                           not invalid 
                               evaluate malzeme-grup-tipi
                               when 1
                                  add cast-br-malzeme-tut(i) to takastop-kah
                               when 2
                                  add cast-br-malzeme-tut(i) to takastop-ogle
                               when 3
                                  add cast-br-malzeme-tut(i) to takastop-aksam
                               when 4                                  
                                  add cast-br-malzeme-tut(i) to takastop-cafe
                               when 5
                                  add cast-br-malzeme-tut(i) to takastop-diger
                               end-evaluate 
                           end-read 
                         end-perform 
                              
                      end-read 
                   end-if
                   rewrite takastop-rec end-rewrite 
             end-read .
*/genel toplam almak için

 
