* profatin.evt
* profatin.evt is generated from D:\asya\acugt.ytl\otel\profatin.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Cb-1ab-Exception-Proc.
     PERFORM Form1-Cb-1ab-Ex-Cmd-Clicked
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
    call "c$narg" using link-var.
    if link-var > 0 then move 0 to vis-lab end-if
    move genel-printer-filtre to text-oku-filtre.
    move tarih-tasi to fatt-tarih

     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to ilk-tarih son-tarih.
    move yil-tasi to ilk-cik-yil son-cik-yil
    add 1 to son-cik-yil
    move 1 to ilk-cik-ay ilk-cik-gun
    move 31 to son-cik-gun
    move 12 to son-cik-ay
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a.
    if link-var > 0 then 
       set peryot-hesapla to true 
       move 2 to key-status
       perform form1-ex-other
       set exit-pushed to true
    end-if .
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form1-Ex-Other.
    evaluate key-status
      when 1
        evaluate control-id
        when 12
        when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to acn-kod
                        display acc-07
                     end-if
             end-call
             move 4 to accept-control
             move 12 to control-id
        end-evaluate
        exit paragraph
      when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre
              
      when 2
            
           
            if link-var = 0 then
             open input takvim
            move ilk-tarih  to takvim-anah
            read takvim no lock invalid
                 initialize mesaj-link
                 move 13 to mesaj-no perform mesaj-ver
                 move 4 to accept-control move 4 to control-id
                 close takvim exit paragraph 
             not invalid continue
            end-read
            move son-tarih  to takvim-anah
            read takvim no lock invalid
                 initialize mesaj-link
                 move 13 to mesaj-no perform mesaj-ver
                 move 4 to accept-control move 8 to control-id
                 close takvim exit paragraph 
             not invalid continue
            end-read
            close takvim
           end-if
        open input konuk kur doviz konum rez takvim kodlar02 odalar
          open input  aksiyhrk fiyat fiyatana grup
        initialize konuk-rec toplam ara-toplam
        evaluate link-var 
            when  1 
               perform tek-konuk-takas
            when  2 
               perform tek-rez-takas
            when other
               perform takas-aktar thru takas-aktar-exit 
        end-evaluate
              initialize takas-rec toplam kont-eb-ayrisayfa 
                         kont-git-tar gece-say doviz-kontrol
              move "F" to kont-eb-ayrisayfa
              start takas key not < takas-kodu invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close konuk takas kur doviz kodlar02  grup
                   close aksiyhrk fiyat fiyatana takvim rez konum odalar
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya gt-toplam

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Acenta Proforma Acenta Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Acenta Proforma Acenta Raporu"   to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Acenta....:"           to det-filler(01:)
     move acn-kod                 to det-filler(15:04)
     move "<->"                   to det-filler(20:03)
     if acn-kod       = spaces
        move "Tum Acentalar.."    to det-filler(25:20)
     else
        open input acenta
        initialize acenta-rec  
        move acn-kod        to acenta-kodu
        read acenta no lock invalid 
             move all "*" to acenta-adi  
                        not invalid continue
        end-read
        close acenta
        move acenta-adi           to det-filler(25:20)
     end-if

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RRLLRRRRLLRRRRLRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
     move "Oda "               to det-1
     move "Rez No "           to det-2
     if link-var = 2 then 
     move "Rez.No  "           to det-2
     end-if
     move "Adi       "         to det-3
     move "Soyadi    "         to det-4
     move "Pax "               to det-5
     move "Chi."               to det-6
     move "Free"               to det-7
     move "Beb "               to det-77
     move "Check/In  "         to det-8
     move "Check/Out "         to det-9
     move "Gece"               to det-10
     move "Ode"                to det-100
     move "EB"                 to det-101
     move "Kic"                to det-102
     move "KKP"                to det-104
     move "Spc"                to det-105
     move "Ozl"                to det-106
     move "An"                 to det-200
     move "Kon"                to det-201
     move "UG"                 to det-103
     move "Voucher "           to det-11
     move "TL.  Tutar     "    to det-12
     move "DV.  Tutar    "     to det-13
     move "TL.  Toplam    "    to det-14 
     move "DV.  Toplam   "     to det-15
     move "Dvz"                to det-16
     move "Doviz degeri"       to det-17
     move "Isle"               to det-49
     move "Per Pax      "      to det-pax
     move "pax toplam "        to det-pat
     move "Kisi Say."          to det-ucr
     move "Tutar "             to det-pac
     move "SS farki "          to det-sin
     move "3rd ind "           to det-3rd
     move "Cocuk ind"          to det-chi
     MOVE "HAM FIYAT  "        TO DET-HAM
     MOVE "EB LER "            TO DET-EB
     MOVE "UG DE "             TO DET-UG
     MOVE "KICK  "             TO DET-KICK
     MOVE "KKP     "           TO DET-KKP
     MOVE "AKS     "           TO DET-AKS
     MOVE "SPE  "              TO DET-SPE
     MOVE "SONDAN"             TO DET-SON


    
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-12 
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-49 
                 fil-pax fil-pat fil-ham fil-eb fil-ug fil-kick 
                 fil-kkp fil-aks fil-spe fil-son
                 fil-ucr fil-pac fil-sin fil-3rd fil-chi

                 fil-100 fil-101 fil-102 fil-103 
                 fil-104 fil-105 fil-106 fil-200 fil-201
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                  det-7 det-77 det-8 det-9 det-10 det-11 det-12 
                  det-13 det-14 det-15 det-16 det-17 det-49 
                 det-pax det-pat det-ham DET-eb det-ug det-kick 
                 det-kkp det-aks det-spe det-son
                  det-100 det-101 det-102 det-103
                  det-104 det-105 det-106 det-200 det-201
     write dokumer-rec from detay
*********************************
              
              initialize fs-takas doviz-kontrol gece-say kont-git-tar
                         kont-gel-tar kont-acenta kont-eb-ayrisayfa
                            move "F" to kont-eb-ayrisayfa
              perform with test after until fs-takas = "10"
                    
                    read takas next no lock end move "10" to fs-takas
                    not at end
                       
                      if doviz-kontrol = zeroes 
                         move takas-doviz to doviz-kontrol,
                      end-if
                      if gece-say      = zeroes 
                         move takas-gece  to gece-say,
                      end-if
                      if kont-git-tar      = zeroes 
                         move takas-git-tar  to kont-git-tar,
                      end-if
                      if kont-gel-tar      = zeroes 
                         move takas-gel-tar  to kont-gel-tar,
                      end-if
                      if kont-acenta      = spaces 
                         move takas-acenta  to kont-acenta
                      end-if
*                      

                      if kont-eb-ayrisayfa     = "F"  
                         move takas-eb-ayrisayfa  to kont-eb-ayrisayfa
                      end-if
                      if  kont-gel-tar = takas-gel-tar and kont-acenta = takas-acenta          
                      if  kont-git-tar = takas-git-tar and doviz-kontrol = takas-doviz 
                        and takas-eb-ayrisayfa = kont-eb-ayrisayfa 
                        then continue
                        else perform liste-ara-toplam,
                             initialize ara-toplam,
                             if ( kont-git-tar not = takas-git-tar and cout-ayri-v  = 1) or 
                                (takas-eb-ayrisayfa not = kont-eb-ayrisayfa and eb-ayri-v =1) then 
                               initialize dokumer-rec detay
                               move "-" to det-1
                               move "P" to det-dokumer-20(5:1)
                              if sayfa-basi-v = 1  then 
                                write dokumer-rec from detay
                             end-if
                             end-if
                             move takas-eb-ayrisayfa to kont-eb-ayrisayfa
                             move takas-git-tar to kont-git-tar
                             move takas-doviz to doviz-kontrol,
                       end-if
                      else
                           perform liste-ara-toplam,
                             initialize ara-toplam
                              perform liste-toplam
                              initialize toplam,
                              initialize dokumer-rec detay
                               move "-" to det-1
                               move "P" to det-dokumer-20(5:1)
                             if sayfa-basi-v = 1  then 
                               write dokumer-rec from detay                          
                             end-if
                             move takas-eb-ayrisayfa to kont-eb-ayrisayfa
                             move takas-gel-tar to kont-gel-tar
                             move takas-acenta to  kont-acenta,
                             move takas-git-tar to kont-git-tar 
                             move takas-doviz   to doviz-kontrol
                       end-if
                      
                      perform detay-ata
                      write dokumer-rec from detay
                    end-read
              end-perform
              perform liste-ara-toplam
              perform liste-toplam
              perform g-liste-toplam 
              close dokumer
              if link-var > 0 then 
                        set dokumer-grid to true
              end-if
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close konuk takas kur doviz rez takvim kodlar02 odalar
              close konum aksiyhrk fiyat fiyatana
              delete file dokumer
***********************************************
******  f7 ile fatura basacak isallah
***************************************
    
     .

 takas-aktar.



    perform takas-dosya-ac.
    move "I" to rez-durumu
  
    move ilk-tarih to takvim-anah
    start takvim key <= takvim-anah  
     invalid
           move takvim-anah to ilk-start-tarih
     not invalid
        read takvim previous no lock end-read
        read takvim previous no lock 
          at end
            move takvim-anah to ilk-start-tarih
          not end
           move takvim-anah to ilk-start-tarih
         end-read
    end-start
    
    move son-tarih to takvim-anah
    start takvim key >= takvim-anah
        invalid
           move takvim-anah to son-start-tarih
        
        not invalid
        read takvim next no lock end-read
        read takvim next no lock 
          at end
            move takvim-anah to son-start-tarih
          not end
           move takvim-anah to son-start-tarih
         end-read
    end-start
    



    move ilk-start-tarih   to rez-gir-tar
    start rez key not < rez-gir 
      invalid 
          continue
      not invalid
          read rez next no lock
          end-read    
          perform until fs-rez = "10" or rez-durumu not  = "I" 
             or rez-gir-tar > son-start-tarih
               
                 if rez-folio > 0 then 
                   move rez-folio to konuk-folio
                   read konuk no lock 
                     invalid continue
                     not invalid
                     if konuk-gec-giris = 1 then
                        move rez-gir-tar to takvim-anah
                        start takvim key <= takvim-anah  
                         invalid
                           move takvim-anah to rez-gir-tar
                        
                        not invalid
                        read takvim previous no lock end-read
                        read takvim previous no lock 
                          at end
                            move takvim-anah to rez-gir-tar
                          not end
                           move takvim-anah to rez-gir-tar
                         end-read
                        end-start
                                     
                     
                     end-if
                    end-read    
                  end-if
                  
                 if ( rez-acenta = acn-kod or acn-kod = spaces ) 
                    and rez-gir-tar >= ilk-tarih 
                    and rez-gir-tar <= son-tarih
                    and rez-cik-tar >= ilk-cik-tarih
                    and rez-cik-tar <= son-cik-tarih
                    move "B" to kodlar02-tipi
                    move rez-odeme-tipi to kodlar02-kodu
                    read kodlar02 no lock invalid
                     move spaces to kodlar02-REC
                    end-read
                  if ode-posting not = "H" and 
                  ( rez-odano = rapor-odano or rapor-odano = spaces )
                          if rapor-ref not = 0 
                             perform ref-bul
                           end-if
                           if rapor-ref = 0 or rapor-ref = konum-ref then  
                             if filtre-var = 1 then 
                                    perform filtre
                                 if filtre-gecti  = 1 then 
                                  perform  tek-rez-yaz
                                   end-if
                                 else
                                   perform  tek-rez-yaz
                              end-if
                           end-if
                  end-if
                 end-if
              read rez next no lock
                  end move "10" to fs-rez
              end-read
           end-perform
    end-start.
           .
 takas-aktar-exit.
    exit.

*
 ref-bul.
     MOVE rez-ODA-KONUMU TO KONUM-ANAHTAR
       READ KONUM NO LOCK INVALID
         DISPLAY MESSAGE BOX "kasa-KONUK-23644"
       END-READ.

*
 gece-al.
    initialize takas-gece takvim-rec.
    move rez-gir-tar to takvim-anah.
*    open input takvim
    start takvim key not < takvim-anah invalid move 1 to takas-gece continue,

        not invalid,
        move spaces to var-yok,
        perform with test after until var,
            read takvim next no lock end move "V" to var-yok,

                not end,

                evaluate true
                    when takvim-anah = rez-cik-tar move "V" to var-yok,
                    when takvim-anah > rez-cik-tar move "V" to var-yok,
                    when takvim-anah not > rez-cik-tar,
                         add 1 to takas-gece,
                end-evaluate,
            end-read,
        end-perform,
    end-start
*    close takvim
    .

 gece-al-exit.
    exit.
 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid move 1 to ekran-fis-1.
 
    add 1 to ekran-fis-1.
   
    move ekran-fis-1(2:) to takas-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    
    open output takas 
    close takas 
    open i-o takas with mass-update.
    initialize takas-rec.
 liste-ara-toplam.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                  det-7 det-77 det-8 det-9 det-10 det-11 det-12 
                  det-13 det-14 det-15 det-16 det-17 det-49 
                 det-pax det-pat det-ham DET-eb det-ug det-kick 
                 det-kkp det-aks det-spe det-son
                  det-100 det-101 det-102 det-103
                  det-104 det-105 det-106 det-200 det-201
    write dokumer-rec from detay
    initialize dokumer-rec detay
    move "- Toplam -" to det-3.
    move a-oda        to z-goster.
    move z-goster     to det-1.
    move a-pax        to z-goster.
    move z-goster     to det-5.
    move a-chi        to z-goster.
    move z-goster     to det-6.
    move a-fre        to z-goster.
    move z-goster     to det-7.
    move a-beb        to z-goster.
    move z-goster     to det-77.
    move a-tl-tutar   to z-1.
    move z-1          to det-12.
    move a-dv-tutar   to z-2.
    move z-2          to det-13.
    move a-tl-toplam  to z-1.
    move z-1          to det-14.
    move a-dv-toplam  to z-2.
    move z-2          to det-15.
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-12 
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-49 
                 fil-pax fil-pat fil-ham fil-eb fil-ug fil-kick 
                 fil-kkp fil-aks fil-spe fil-son
                 fil-100 fil-101 fil-102 fil-103 
                 fil-104 fil-105 fil-106 fil-200 fil-201
                 fil-ucr fil-pac fil-sin fil-3rd fil-chi
    perform acenta-yaz
    write dokumer-rec from detay.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-1 det-2 det-3 det-4 det-5 det-6
                  det-7 det-77 det-8 det-9 det-10 det-11 det-12 
                  det-13 det-14 det-15 det-16 det-17 det-49 
                 det-pax det-pat det-ham DET-eb det-ug det-kick 
                 det-kkp det-aks det-spe det-son
                  det-100 det-101 det-102 det-103
                  det-104 det-105 det-106 det-200 det-201
                   det-ucr det-pac det-sin det-3rd det-chi
    write dokumer-rec from detay.
 detay-ata.
    initialize dokumer-rec detay odalar-rec
    if takas-peryod = 0 then
    move takas-oda           to det-1 odalar-anah
    read odalar no lock invalid 
         continue
    end-read
    if odalar-uzun-no not = spaces
       move odalar-uzun-no to det-1
    end-if
    move takas-folio         to det-2
    move takas-adi           to det-3
    move takas-soyadi        to det-4
    move takas-pax           to z-goster
    move z-goster            to det-5
    move takas-chi           to z-goster
    move z-goster            to det-6
    move takas-fre           to z-goster
    move z-goster            to det-7
    move takas-beb           to z-goster
    move z-goster            to det-77
    move takas-isl      to det-49
    move "/"            to det-49(3:1)
    move takas-isl(3:2)      to det-49(4:2)
    move takas-anlasma to det-200
    move takas-konum   to det-201
    move takas-gel-gun       to xgun
    move takas-gel-ay        to xay
    move takas-gel-yil       to xyil
    move xtarih to det-8
    move takas-git-gun       to xgun
    move takas-git-ay        to xay
    move takas-git-yil       to xyil
    move xtarih to det-9
    end-if
    move takas-gece          to det-10.
    move takas-ode           to ind-z
    move ind-z              to det-100.
    move takas-eb            to ind-z
    move ind-z          to det-101.
    move takas-kick          to z-goster-3.
    move z-goster-3          to det-102.
    move takas-kick2         to z-goster-3.
    move z-goster-3          to det-104.
    move takas-special          to z-goster-3.
    move z-goster-3          to det-105.
    move takas-ozel          to z-goster-2.
    move z-goster-2          to det-106.
    move takas-ug            to z-goster-2.
    move z-goster-2          to det-103.
    move takas-voucher       to det-11.
    move takas-tl-tutar      to z-1.
    move z-1                 to det-12.
    move takas-dv-tutar      to z-2.
    move z-2                 to det-13.
    compute takas-dv-PER-PAX  rounded = takas-dv-PER-PAX  / 2
    compute takas-dv-ucr = takas-pax + takas-chi
    move takas-dv-ucr        to z-goster
    move z-goster            to det-ucr
    compute takas-dv-pac rounded = takas-dv-per-pax * takas-dv-ucr * takas-gece
    if takas-pax = 1           
       compute takas-dv-sin =  ( takas-dv-PAX-TOPLAM - ( takas-dv-PER-PAX * takas-pax ) ) *takas-gece

       else 
       compute takas-dv-3rd = (( takas-dv-PER-PAX * takas-pax ) -  takas-dv-PAX-TOPLAM) * takas-gece

    end-if
    
     compute takas-dv-chi = ( takas-dv-PAX-TOPLAM + 
                           ( takas-chi * takas-dv-PER-PAX )  
                             - takas-dv-HAM  ) * takas-gece

    move takas-dv-pac           to z-2.
    move z-2                    to det-pac
    move takas-dv-sin           to z-2.
    move z-2                    to det-sin
    move takas-dv-3rd           to z-2.
    move z-2                    to det-3rd
    move takas-dv-chi           to z-2.
    move z-2                    to det-chi


    move takas-dv-PER-PAX     to z-2.
    move z-2                 to det-PAX
    move takas-dv-PAX-TOPLAM    to z-2.
    move z-2                 to det-PAT
    move takas-dv-HAM      to z-2 HAM-FIYAT.
    move z-2                 to det-HAM

    MOVE TAKAS-DV-EB    TO SON-FIYAT
    COMPUTE TAKAS-DV-EB = ( HAM-FIYAT - SON-FIYAT ) * takas-gece
    MOVE SON-FIYAT TO HAM-FIYAT


    move takas-dv-EB      to z-2.
    move z-2                 to det-EB
     MOVE TAKAS-DV-ug    TO SON-FIYAT
    COMPUTE TAKAS-DV-ug = ( HAM-FIYAT - SON-FIYAT ) * takas-gece
    MOVE SON-FIYAT TO HAM-FIYAT
    move takas-dv-UG      to z-2.
    move z-2                 to det-UG
    MOVE TAKAS-DV-kick   TO SON-FIYAT
    COMPUTE TAKAS-DV-kick = ( HAM-FIYAT - SON-FIYAT ) * takas-gece
    MOVE SON-FIYAT TO HAM-FIYAT
    move takas-dv-KICK     to z-2.
    move z-2                 to det-KICK
    MOVE TAKAS-DV-kkp   TO SON-FIYAT
    COMPUTE TAKAS-DV-kkp = ( HAM-FIYAT - SON-FIYAT ) * takas-gece
    MOVE SON-FIYAT TO HAM-FIYAT
    move takas-dv-KKP      to z-2.
    move z-2                 to det-KKP
    MOVE TAKAS-DV-aks   TO SON-FIYAT
    COMPUTE TAKAS-DV-aks = ( HAM-FIYAT - SON-FIYAT ) * takas-gece
    MOVE SON-FIYAT TO HAM-FIYAT
    move takas-dv-AKS      to z-2.
    move z-2                 to det-AKS
    MOVE TAKAS-DV-spe TO SON-FIYAT
    COMPUTE TAKAS-DV-spe = ( HAM-FIYAT - SON-FIYAT ) * takas-gece
    MOVE SON-FIYAT TO HAM-FIYAT
    move takas-dv-SPE     to z-2.
    move z-2                 to det-SPE
*    MOVE TAKAS-DV-son   TO SON-FIYAT
*    COMPUTE TAKAS-DV-son = HAM-FIYAT - SON-FIYAT
*    MOVE SON-FIYAT TO HAM-FIYAT
    move takas-dv-SON    to z-2.
    move z-2                 to det-SON




    initialize doviz-rec.
    move takas-doviz         to doviz-kodu.   
         read doviz no lock invalid move all "*******" to d-kisa-adi. 
              move d-kisa-adi   to det-16.
    move takas-dv-degeri     to z-22.
    move z-22                to det-17.
   
**** Düzelt !!!

*    initialize takas-tl-toplam takas-dv-toplam.
*    compute takas-tl-toplam = takas-tl-tutar * takas-gece.
*    compute takas-dv-toplam = takas-dv-tutar * takas-gece.
    move takas-tl-toplam     to z-1.
    move z-1                 to det-14.
    move takas-dv-toplam     to z-2.
    move z-2                 to det-15.
    if takas-peryod = 0 then
    compute t-oda       = t-oda       + 1
    compute t-pax       = t-pax       + takas-pax
    compute t-chi       = t-chi       + takas-chi
    compute t-fre       = t-fre       + takas-fre
    compute t-beb       = t-beb       + takas-beb
    end-if
    compute t-tl-tutar  = t-tl-tutar  + takas-tl-tutar.
    compute t-dv-tutar  = t-dv-tutar  + takas-dv-tutar.
    compute t-tl-toplam = t-tl-toplam + takas-tl-toplam.
    compute t-dv-toplam = t-dv-toplam + takas-dv-toplam.
    if takas-peryod = 0 then 
    compute a-oda       = a-oda       + 1
    compute a-pax       = a-pax       + takas-pax
    compute a-chi       = a-chi       + takas-chi
    compute a-fre       = a-fre       + takas-fre
    compute a-beb       = a-beb       + takas-beb
    end-if
    compute a-tl-tutar  = a-tl-tutar  + takas-tl-tutar.
    compute a-dv-tutar  = a-dv-tutar  + takas-dv-tutar.
    compute a-tl-toplam = a-tl-toplam + takas-tl-toplam.
    compute a-dv-toplam = a-dv-toplam + takas-dv-toplam.
    move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-12 
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-49 
                 fil-pax fil-pat fil-ham fil-eb fil-ug fil-kick 
                 fil-kkp fil-aks fil-spe fil-son
                 fil-100 fil-101 fil-102 fil-103 
                 fil-104 fil-105 fil-106 fil-200 fil-201 
                  fil-ucr fil-pac fil-sin fil-3rd fil-chi.
       open input acenta
       move kont-acenta to acenta-kodu 
       read acenta no lock invalid continue
       end-read
*       move acenta-adi(1:10) to det-8
*       move acenta-adi(11:1) to fil-8
*       move acenta-adi(12:)  to det-9
       close acenta





        .


 liste-toplam.
    
    initialize dokumer-rec detay

    move "Acenta Top" to det-3.
    add t-oda to gt-oda
    add t-pax to gt-pax
    add t-chi to gt-chi
    add t-fre to gt-fre
    add t-beb to gt-beb
    add t-tl-tutar  to gt-tl-tutar
    add t-dv-tutar  to gt-dv-tutar
    add t-tl-toplam to gt-tl-toplam
    add t-dv-toplam to gt-dv-toplam



    move t-oda        to z-goster.
    move z-goster     to det-1.
    move t-pax        to z-goster.
    move z-goster     to det-5.
    move t-chi        to z-goster.
    move z-goster     to det-6.
    move t-fre        to z-goster.
    move z-goster     to det-7.
    move t-beb        to z-goster.
    move z-goster     to det-77.
    move t-tl-tutar   to z-1.
    move z-1          to det-12.
    move t-dv-tutar   to z-2.
    move z-2          to det-13.
    move t-tl-toplam  to z-1.
    move z-1          to det-14.
    move t-dv-toplam  to z-2.
    move z-2          to det-15.
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-12 
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-49 
                 fil-pax fil-pat fil-ham fil-eb fil-ug fil-kick 
                 fil-kkp fil-aks fil-spe fil-son
                 fil-100 fil-101 fil-102 fil-103 
                 fil-104 fil-105 fil-106 fil-200 fil-201
                  fil-ucr fil-pac fil-sin fil-3rd fil-chi
    perform acenta-yaz     
    write dokumer-rec from detay.
    initialize dokumer-rec detay
*****************************************
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                  det-7 det-77 det-8 det-9 det-10 det-11 det-12 
                  det-13 det-14 det-15 det-16 det-17 det-49 
                 det-pax det-pat det-ham DET-eb det-ug det-kick 
                 det-kkp det-aks det-spe det-son
                  det-100 det-101 det-102 det-103
                  det-104 det-105 det-106 det-200 det-201
                   det-ucr det-pac det-sin det-3rd det-chi
    write dokumer-rec from detay.
*
 g-liste-toplam.
    
    initialize dokumer-rec detay

    move "Genel Top." to det-3.
    move gt-oda        to z-goster.
    move z-goster     to det-1.
    move gt-pax        to z-goster.
    move z-goster     to det-5.
    move gt-chi        to z-goster.
    move z-goster     to det-6.
    move gt-fre        to z-goster.
    move z-goster     to det-7.
    move gt-beb        to z-goster.
    move z-goster     to det-77.
    move gt-tl-tutar   to z-1.
    move z-1          to det-12.
    move gt-dv-tutar   to z-2.
*    move z-2          to det-13.
    move gt-tl-toplam  to z-1.
    move z-1          to det-14.
    move gt-dv-toplam  to z-2.


    move z-2          to det-15.
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-12 
                 fil-13 fil-14 fil-15 fil-16 fil-17 fil-49 
                 fil-pax fil-pat fil-ham fil-eb fil-ug fil-kick 
                 fil-kkp fil-aks fil-spe fil-son
                 fil-100 fil-101 fil-102 fil-103 
                 fil-104 fil-105 fil-106 fil-200 fil-201
                  fil-ucr fil-pac fil-sin fil-3rd fil-chi

    write dokumer-rec from detay.
    initialize dokumer-rec detay
*****************************************
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                  det-7 det-77 det-8 det-9 det-10 det-11 det-12 
                  det-13 det-14 det-15 det-16 det-17 det-49 
                 det-pax det-pat det-ham DET-eb det-ug det-kick 
                 det-kkp det-aks det-spe det-son
                  det-100 det-101 det-102 det-103
                  det-104 det-105 det-106 det-200 det-201
                   det-ucr det-pac det-sin det-3rd det-chi
    write dokumer-rec from detay.
*
 acc-07-Aft-Procedure.
      open input acenta
      if acn-kod = spaces 
        move "Tum Acentalar" to acenta-adi
      else 
      move acn-kod    to acenta-kodu
      read acenta no lock invalid
           move "Tanimsiz Acenta ..." to acenta-adi
           move 4 to accept-control
           move 12 to control-id
      end-read
      end-if.
      display lb-acenadi.
      close acenta. 
     
     .
*
 peryot-fiyat-bul.
*     open input rez
*     initialize rez-rec
     
*     move konuk-rez-no to rez-no
*     read rez no lock
*       invalid
*         continue
*     end-read
*     close rez
      move rez-odeme-tipi          to kodlar02-kodu
        move "B"                     to kodlar02-tipi
        read kodlar02 no lock invalid
             move "Tanimsiz"  to kodlar02-adi
        end-read
       
      if ode-posting = "H" then        
          initialize top-rez-fiyati    takas-dv-tutar
                      takas-tl-tutar   takas-dv-toplam
                        takas-tl-toplam
                       
          exit paragraph
      end-if 
     move rez-gir-tar             to g-bul-ilk-tarih
     move rez-cik-tar             to g-bul-son-tarih
     perform G-BUL-ILK-TAR-OKU thru islem-bitti

     perform gun-bul2.
          initialize aksiyhrk-rec aksiyon-durumu special-varsa
     if rez-special-eh = 1
       set special-yok to true
       else


     initialize aksiyhrk-rec special-var-yok
     move "O"              to aksiyhrk-tipi
     move rez-acenta       to aksiyhrk-acenta
     move rez-gir-tar      to aksiyhrk-tarih
     move rez-pan-tipi     to aksiyhrk-pan-tipi
     move g-bul-gun-sayisi to aksiyhrk-gecele

     read aksiyhrk no lock
       invalid
         continue
       not invalid
         set special-var to true
         move aksiyhrk-gecele   to special-gece 
         move aksiyhrk-hes-tipi to special-hes-tipi
            move aksiyhrk-ekle     to special-ekle
         move aksiyhrk-ode      to special-tahsil 
     end-read
      end-if

      initialize aksiyhrk-rec aksiyon-durumu
     if rez-aksiyon-eh = "H" 
       set aksiyon-yok to true
       else

    
     move "A"              to aksiyhrk-tipi
     move rez-acenta       to aksiyhrk-acenta
     move rez-gir-tar      to aksiyhrk-tarih
     move rez-pan-tipi     to aksiyhrk-pan-tipi
     move g-bul-gun-sayisi to aksiyhrk-gecele

     read aksiyhrk no lock
       invalid
         continue
       not invalid
         set aksiyon-var to true
     end-read
     move aksiyhrk-ode  to takas-ode
     end-if
     move rez-fiyati    to ilk-rez-fiyati son-rez-fiyati

     initialize g-bul-gun-sayisi kacinci-gece
                     takvim-rec
                top-rez-fiyati
                fiyatana-rec
     move rez-gir-tar   to takvim-anah
     start takvim key >= takvim-anah
       invalid
         move 1 to g-bul-gun-sayisi
       not invalid
         initialize fs-takvim
         perform with test after
                 until fs-takvim = "10"
           read takvim next no lock
             end
               move "10" to fs-takvim
             not at end
               if takvim-anah = rez-cik-tar
                  move "10" to fs-takvim
                  exit perform cycle
               end-if
               if takvim-anah < rez-cik-tar
                  
                     
                  perform fiyat-bul thru fiyat-bul-exit
                  if takvim-anah = rez-gir-tar 
                      and fiyatana-fiks = 1 then
                           move "E" to rez-fiyat-fix 
                  end-if
                   move takas-ind to yedek2
                  if son-rez-fiyati not  = ilk-rez-fiyati and g-bul-gun-sayisi > 0
*                       if rez-no = 280 then stop " "  end-if
                       move  yedek-takas to takas-ind
                       move  g-bul-gun-sayisi to takas-gece
                       compute takas-dv-tutar = top-rez-fiyati / g-bul-gun-sayisi
                       compute takas-tl-tutar rounded = takas-dv-tutar * takas-dv-degeri
                       move top-rez-fiyati to  takas-dv-toplam
                       compute takas-tl-toplam rounded = takas-dv-toplam * takas-dv-degeri
                       
                     write takas-rec invalid 
                            rewrite takas-rec,
                     end-write
                      move yedek2 to takas-ind
                       add 1 to takas-peryod             
                        initialize g-bul-gun-sayisi top-rez-fiyati
                        
                      
                  end-if
                  move ilk-rez-fiyati to son-rez-fiyati
                  add 1 to g-bul-gun-sayisi  kacinci-gece
                    
*                       if rez-no = 280 then stop " "  end-if
                        move takas-ind to yedek-takas
                        
                  if kacinci-gece > aksiyhrk-ode and aksiyon-var and aksiyhrk-sondan = 1 then
                  if special-var
                     if special-ekle = 1 then move -1 to special-eksi-car
                     else move 1 to special-eksi-car
                     end-if
                     evaluate special-hes-tipi
                       when 1
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) * (rez-buyuk + ( rez-kucuk / 2 ) ) / special-gece)
                                 * special-eksi-car )
                       when 2
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) * (rez-buyuk + ( rez-kucuk ) ) / special-gece)
                                  * special-eksi-car )
                       when 3
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) / special-gece)
                                  * special-eksi-car )
                       when 4
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) * rez-buyuk)
                                  * special-eksi-car )
                       when 5
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) * (rez-buyuk + ( rez-kucuk / 2 ) ) )
                                  * special-eksi-car )
                       when 6
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) * (rez-buyuk + ( rez-kucuk ) ) )
                                  * special-eksi-car )
                       when 7
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil))
                                  * special-eksi-car )
        
                       when other
                           compute top-rez-fiyati rounded = top-rez-fiyati - 
                                 (((special-tahsil) * rez-buyuk / special-gece)
                                  * special-eksi-car )
                      end-evaluate 



                     
      
                   end-if
                  else
                      compute top-rez-fiyati
                        = top-rez-fiyati + ilk-rez-fiyati
                  end-if
               else
                  move "10" to fs-takvim
               end-if                
           end-read
         end-perform
     end-start
     
     
     if top-rez-fiyati <> zeroes
        continue
     else
        if takas-peryod = 0 then 
        compute top-rez-fiyati
              = g-bul-gun-sayisi * rez-fiyati
         end-if
     end-if
     .
*
 fiyat-bul.
      
     move 0 to oda-fiyati
     move rez-acenta        to fiyat-acenta
     move takvim-anah       to fiyat-tarih
     move rez-tipi          to fiyat-rez-tipi
     move rez-pan-tipi      to fiyat-pan-tipi
     move rez-banka         to fiyat-banka
     move rez-doviz         to fiyat-doviz
     move rez-anlasma       to fiyat-anlasma
     move rez-buyuk         to fiyat-buyuk
     move rez-kucuk         to fiyat-kucuk
     read fiyat no lock
       invalid
         go fiyat-bulundu
     end-read
     move fiyat-acenta    to fiyatana-acenta
     move fiyat-bas-tarih to fiyatana-ilk-tarih
     move fiyat-bit-tarih to fiyatana-son-tarih
     move fiyat-rez-tipi  to fiyatana-rez-tipi
     move fiyat-pan-tipi  to fiyatana-pan-tipi
     move fiyat-banka     to fiyatana-banka
     move fiyat-doviz     to fiyatana-doviz
     move fiyat-anlasma   to fiyatana-anlasma
     move 2 to fiyatana-buyuk
     move 0 to fiyatana-kucuk
     read fiyatana no lock
       invalid 
         continue
     end-read
     move fiyatana-oda-fiyati(rez-fiyat-konumu) to takas-dv-per-pax
     
     move fiyat-buyuk     to fiyatana-buyuk
     read fiyatana no lock
       invalid 
         continue
     end-read
     move fiyatana-oda-fiyati(rez-fiyat-konumu) to takas-dv-pax-toplam

     move fiyat-kucuk     to fiyatana-kucuk
     read fiyatana no lock
       invalid 
         go fiyat-bulundu
     end-read
     if rez-fiyat-fix = "E"
        go fiyat-bulundu
     end-if

     move fiyatana-oda-fiyati(rez-fiyat-konumu) to oda-fiyati takas-dv-ham

     if rez-fiyat-konumu not = spaces and
        rez-fiyat-konumu not = zeroes
        move fiyatana-oda-fiyati(rez-fiyat-konumu) to oda-fiyati
     end-if

*/********* 
     if rez-nor-indirim not = 0 
        compute oda-fiyati rounded = 
              (((oda-fiyati * rez-nor-indirim) / 100) - oda-fiyati)
     end-if
*/Early booking orani var ve early booking uygulanacak ise 
      
     if rez-eb = "E" and fiyatana-eb-oran not = 0 
        
        move fiyatana-eb-oran to takas-eb(1:2)
        move fiyatana-eb-kusur to takas-eb(3:2)
     compute oda-fiyati rounded = 
            (((oda-fiyati * (fiyatana-eb-oran +( fiyatana-eb-kusur / 100) )) / 100) - oda-fiyati)
     end-if
     move oda-fiyati to takas-dv-eb
     if  fiyatana-ug-oran not = 0 and gun-s >= fiyatana-ug-geceleme 
           and rez-ug-ind = 1 then  
            move fiyatana-ug-oran to takas-ug
       compute oda-fiyati rounded = 
              (((oda-fiyati * (fiyatana-ug-oran + (fiyatana-ug-kusur / 100))) / 100) - oda-fiyati)
       end-if. 
       move oda-fiyati to takas-dv-ug
        if rez-ozel-durum-car > 0
       move rez-ozel-durum to takas-ozel
       
       compute oda-fiyati rounded = 
              (oda-fiyati * rez-ozel-durum-car) / 100
       end-if.
*/Kick back
     if fiyatana-kick-back not = 0 
        move fiyatana-kick-back to takas-kick
        compute oda-fiyati rounded = 
            (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
     end-if
        move oda-fiyati to takas-dv-kick
     . 
     
      
       if fiyatana-kick-back2 <> 0
        move fiyatana-kick-back2 to takas-kick2
       compute oda-fiyati rounded = 
              (((oda-fiyati * fiyatana-kick-back2) / 1000) - oda-fiyati)
       end-if.
        move oda-fiyati to takas-dv-kkp.
       

 aksiyonlu-uyar. 
     if rez-aksiyon-eh = "H" 
        set aksiyon-yok to true
        initialize takas-ode
*     else
*        if rez-eb = "E" and fiyatana-eb-oran not = 0
*           set aksiyon-yok to true
*        end-if
     end-if

     if aksiyon-var
       
        if aksiyhrk-sondan not = 1 then 
          compute oda-fiyati rounded = ((oda-fiyati * aksiyhrk-ode) / aksiyhrk-gecele)
           
          end-if   
        end-if
      if rez-special-eh = 1 
        set special-yok to true
        initialize special-tahsil
*     else
*        if rez-eb = "E" and fiyatana-eb-oran not = 0
*           set aksiyon-yok to true
*        end-if
     end-if
      move oda-fiyati to takas-dv-aks
     if special-var

         if special-ekle = 1 then move -1 to special-eksi-car
             else move 1 to special-eksi-car
             end-if
             evaluate special-hes-tipi
               when 1
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (rez-buyuk + ( rez-kucuk / 2 ) ) / special-gece)
                         * special-eksi-car )
               when 2
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (rez-buyuk + ( rez-kucuk ) ) / special-gece)
                          * special-eksi-car )
               when 3
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) / special-gece)
                          * special-eksi-car )
               when 4
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * rez-buyuk)
                          * special-eksi-car )
               when 5
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (rez-buyuk + ( rez-kucuk / 2 ) ) )
                          * special-eksi-car )
               when 6
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (rez-buyuk + ( rez-kucuk ) ) )
                          * special-eksi-car )
               when 7
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil))
                          * special-eksi-car )

               when other
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * rez-buyuk / special-gece)
                          * special-eksi-car )
              end-evaluate 
          
               move  special-tahsil to takas-special
     end-if
      move oda-fiyati to takas-dv-spe
*****if oda-fiyati <> rez-fiyati 
     move oda-fiyati  to ilk-rez-fiyati.
     .
 aksiyonlu-uyar-exit. 
     exit.
 fiyat-bulundu. 
        if rez-eb = "E" and fiyatana-eb-oran not = 0 
             move fiyatana-eb-oran to takas-eb(1:2)
             move fiyatana-eb-kusur to takas-eb(3:2)
        END-if.
        if  fiyatana-ug-oran not = 0 and gun-s >= fiyatana-ug-geceleme 
           and rez-ug-ind = 1 then  
            move fiyatana-ug-oran to takas-ug
       
       end-if. 
     
 fiyat-bul-exit. 
     exit
     .
*
 gun-bul2.
     initialize gun-s

     move rez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= rez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      end-if 
                end-read


              end-perform  
      end-start.
     .
*
 tek-konuk-takas.
 
    perform takas-dosya-ac.
 
    initialize konuk-rec.

      move gelen-folio to konuk-folio

      read konuk  no lock 
        invalid 
         display message box "Folio Bulunamadi"
         not invalid
                         initialize takas-rec
                         move konuk-gel-tar  to takas-gel-tar
                         move konuk-git-tar  to takas-git-tar
                         move konuk-folio    to takas-folio
                         move konuk-acenta to takas-acenta
                         move konuk-eb      to takas-eb-ayrisayfa
                         
                         read takas no lock invalid continue,end-read
                         move konuk-odano    to takas-oda
                         move konuk-adi      to takas-adi
                         move konuk-soyadi   to takas-soyadi
                         move konuk-buyuk    to takas-pax
                         move konuk-kucuk    to takas-chi
                         move konuk-free     to takas-fre
                         move konuk-bebek    to takas-beb
                         move konuk-voucher  to takas-voucher
                         perform gece-al thru gece-al-exit
                         compute takas-tl-tutar = konuk-oda-tutar          +
                                 konuk-extbed-tutar + konuk-kahvalti-tutar +
                                 konuk-ogle-tutar   + konuk-aksam-tutar    +
                                 konuk-icecek-tutar + konuk-extra-tutar
                         move konuk-doviz        to takas-doviz 

         move konuk-gel-yil      to kur-yil 
         move konuk-gel-ay       to kur-ay 
         move konuk-gel-gun      to kur-gun 
         move konuk-banka        to kur-banka 
         move konuk-doviz        to kur-doviz 
         if konuk-kur-aygun = "A" move 01 to kur-gun  end-if
         read kur no lock invalid move 1 to doviz-alis end-read
         if  doviz-alis = 0       move 1 to doviz-alis   end-if
         move doviz-alis          to takas-dv-degeri
          MOVE KONUK-KUR-DEGERI TO TAKAS-DV-DEGERI
              compute takas-dv-tutar = takas-tl-tutar / takas-dv-degeri

         if peryot-hesapla
            perform peryot-fiyat-bul
            move  g-bul-gun-sayisi to takas-gece
            compute takas-dv-tutar = top-rez-fiyati / g-bul-gun-sayisi
            compute takas-tl-tutar = takas-dv-tutar * takas-dv-degeri
            move    top-rez-fiyati to  takas-dv-toplam
            compute takas-tl-toplam rounded = takas-dv-toplam * takas-dv-degeri
                       
         else
            move konuk-dv-degeri to takas-dv-tutar
                       
         end-if

         write takas-rec invalid 
               rewrite takas-rec,
         end-write
         end-read.
               .
*
 Tek-Rez-Takas.
 
    perform takas-dosya-ac.
    
    initialize rez-rec.

      move gelen-rez to rez-anah
*      open input rez
      
      read rez  no lock 
        invalid 
*         close rez
         display message box "Rezervasyon Bulunamadi"
         not invalid 
*                         close rez
                      perform tek-rez-yaz               
         end-read.
               .
 
*
 Form1-Cb-1ab-Ex-Cmd-Clicked.
       display Form1-Cb-1aa Form1-Cb-1a
     .
*
 tek-rez-yaz.
         initialize takas-rec
                 move rez-gir-tar  to takas-gel-tar konuk-gel-tar
                         move rez-cik-tar  to takas-git-tar konuk-git-tar
                         move rez-no    to takas-folio konuk-rez-no
                         move rez-acenta to takas-acenta konuk-acenta
                         if rez-eb = "E" then 
                             move rez-eb      to takas-eb-ayrisayfa
                         end-if
                         read takas no lock invalid continue,end-read
                         move rez-odano    to takas-oda konuk-odano
                         move rez-adi      to takas-adi konuk-adi
                         move rez-anlasma  to takas-anlasma konuk-anlasma
                         move REZ-ISL-TAR(5:4)  to takas-isl
                         move rez-fiyat-konumu to konum-anahtar
                         read konum no lock invalid 
                            initialize konum-adi
                           
                         end-read
                         move rez-not1 to takas-not 
                         move rez-not2 to takas-not(21:)
                         move konum-adi to takas-konum
                         move rez-soyadi   to takas-soyadi konuk-soyadi
                         move rez-buyuk    to takas-pax konuk-buyuk
                         move rez-kucuk    to takas-chi konuk-kucuk
                         move rez-free     to takas-fre konuk-free
                         move rez-bebek    to takas-beb konuk-bebek
                         move rez-voucher  to takas-voucher konuk-voucher
                         
                         perform gece-al thru gece-al-exit
                         compute takas-tl-tutar = konuk-oda-tutar          +
                                 konuk-extbed-tutar + konuk-kahvalti-tutar +
                                 konuk-ogle-tutar   + konuk-aksam-tutar    +
                                 konuk-icecek-tutar + konuk-extra-tutar
                         move rez-doviz        to takas-doviz konuk-doviz 
        
         move konuk-gel-yil      to kur-yil takvim-yil 
         move konuk-gel-ay       to kur-ay  takvim-ay 
         move konuk-gel-gun      to kur-gun takvim-gun 
         move rez-banka      to kur-banka konuk-banka  
         move Rez-Doviz        to kur-doviz konuk-doviz
         if rez-cin-kuru > 0 and rez-cin-kuru <100 then 
             move rez-cin-kuru to doviz-alis ,
           else
         
         if rez-kur-aygun = "A" move 01 to kur-gun end-if 
         start takvim key <= takvim-anah 
          invalid continue
          not invalid
            move 0 to doviz-bulundu
           perform until doviz-bulundu = 1 or fs-takvim= "10"
            read takvim previous 
              at end move "10" to fs-takvim
              not end
               move takvim-anah to kur-tarih
               read kur no lock 
                   invalid continue
                   not invalid move 1 to doviz-bulundu
                   
               end-read
             end-read
            end-perform
         end-start
        
         end-if
         if  doviz-alis = 0       move 1 to doviz-alis  end-if
         move doviz-alis          to takas-dv-degeri
          MOVE doviz-alis to KONUK-KUR-DEGERI  TAKAS-DV-DEGERI
              compute takas-dv-tutar = takas-tl-tutar / takas-dv-degeri

         if peryot-hesapla
            perform peryot-fiyat-bul
            move  g-bul-gun-sayisi to takas-gece
            compute takas-dv-tutar = top-rez-fiyati / g-bul-gun-sayisi
            compute takas-tl-tutar = takas-dv-tutar * takas-dv-degeri
            move top-rez-fiyati to  takas-dv-toplam
            compute takas-tl-toplam rounded = takas-dv-toplam * takas-dv-degeri
                       
         else
            move konuk-dv-degeri to takas-dv-tutar
         end-if
         write takas-rec invalid 
               rewrite takas-rec,
         end-write.


*
*
 acenta-yaz.
       open input acenta
       move kont-acenta to acenta-kodu 
       read acenta no lock invalid continue
       end-read
       move acenta-adi(1:8) to det-3
       move acenta-adi(9:1) to fil-8
       move acenta-adi(10:)  to det-4
       close acenta





        .
 
