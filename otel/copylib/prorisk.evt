* prorisk.evt
* prorisk.evt is generated from D:\asya\acugt.ytl\otel\prorisk.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
    call "c$narg" using link-var.
    if link-var > 0 then move 0 to vis-lab end-if
    move genel-printer-filtre to text-oku-filtre.
    move tarih-tasi to fatt-tarih
     move 1 to reel-gecmis

     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to    takvim-anah.
    open input takvim 
     move 1 to reel-gecmis
    start takvim key > takvim-anah
       invalid continue
       not invalid
        read takvim next end continue
         not end move takvim-anah to yarin-tarih
        end-read
        read takvim previous end continue
         not end move takvim-anah to dun-tarih
        end-read
        read takvim previous end continue
         not end move takvim-anah to dun-tarih
        end-read
    end-start
      initialize takvim-rec
     start takvim key > takvim-anah
       invalid continue
       not invalid
        read takvim next end continue
         not end move takvim-anah to takvimilk
        end-read
    end-start
      move "99999999"  to  takvim-rec
     start takvim key < takvim-anah
       invalid continue
       not invalid
        read takvim previous end continue
         not end move takvim-anah to takvimson
        end-read
    end-start


    close takvim
    move yarin-tarih  to ilkayar-tarih
    move dun-tarih to dilk-tar 
    move takvimilk    to ilk-tarih
    move takvimson    to son-tarih
    move yarin-tarih  to son-cik-tarih ilk-cik-tarih
    move yil-tasi     to ilk-cik-yil son-cik-yil
    move 1 to reel-gecmis
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a
            acc-01c acc-02c acc-03c cb-reel
            acc-01b acc-02b acc-03b.
     if k-kodu-tasi = "ASYA" or "X   " then 
          move 1 to v-eski
         display a-eksi
    end-if.
    if link-var > 0 then 
       set peryot-hesapla to true 
      
       move 2 to key-status
       perform form1-ex-other
       set exit-pushed to true
    end-if. 
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 cout-ayar.
    move dun-tarih to dilk-tar 
    move takvimilk    to ilk-tarih
    move takvimson    to son-tarih
    move ilkayar-tarih  to son-cik-tarih ilk-cik-tarih
  
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a
            acc-01c acc-02c acc-03c cb-reel
            acc-01b acc-02b acc-03b.
         .
*
 cin-ayar.
      move ilkayar-tarih to dilk-tar 
      move takvimilk    to ilk-cik-tarih
      move takvimson    to son-cik-tarih
      move ilkayar-tarih  to ilk-tarih son-tarih
    
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a
            acc-01c acc-02c acc-03c cb-reel
            acc-01b acc-02b acc-03b. 
         .
*
 inhouse-ayar.
     open input takvim
     move ilkayar-tarih to takvim-anah
     start takvim key > takvim-anah
         invalid continue
         not invalid
         read takvim next no lock end continue
            not end move takvim-anah to sonraki-tarih
         end-read
         read takvim previous no lock end continue
            not end move takvim-anah to onceki-tarih
         end-read
        read takvim previous no lock end continue
            not end move takvim-anah to onceki-tarih
         end-read
     end-start
     close takvim
       move onceki-tarih to dilk-tar 
      move takvimilk     to ilk-tarih
      move takvimson     to son-cik-tarih
      move ilkayar-tarih to son-tarih 
      move sonraki-tarih to ilk-cik-tarih
       
    
      display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a
            acc-01c acc-02c acc-03c cb-reel
            acc-01b acc-02b acc-03b. 
          .
*
 Form1-Ex-Other.
    evaluate key-status
      when 1
        evaluate control-id
        when 12
        when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to acn-kod
                        display acc-07
                     end-if
             end-call
             move 4 to accept-control
             move 12 to control-id
        when 33
        when 36
            perform grup-ara
        end-evaluate
        exit paragraph

      when 50
        perform cout-ayar
      when 51
        perform cin-ayar
      when 52
        perform inhouse-ayar
      when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre
              
      when 2
            
              
            if link-var = 0 then
             open input takvim
            move ilk-tarih  to takvim-anah
            read takvim no lock invalid
                 initialize mesaj-link
                 move 13 to mesaj-no perform mesaj-ver
                 move 4 to accept-control move 4 to control-id
                 close takvim exit paragraph 
             not invalid continue
            end-read
            move son-tarih  to takvim-anah
            read takvim no lock invalid
                 initialize mesaj-link
                 move 13 to mesaj-no perform mesaj-ver
                 move 4 to accept-control move 8 to control-id
                 close takvim exit paragraph 
             not invalid continue
            end-read
            close takvim
           end-if
        open input konuk kur doviz konum grup rez  takvim kodlar02 yanrez firma acenta
          open input  aksiyhrk fiyat fiyatana romhrk takvim2 cast  cast3 odalar
        initialize konuk-rec toplam ara-toplam
        evaluate link-var
 
            when  1 
               display message box "Bu sekilde baglanti yapilamaz"
            when  2 
               perform tek-rez-takas
            when other
               perform takas-aktar thru takas-aktar-exit 
        end-evaluate
             
              start takas key not < takas-kodu invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close konuk takas firma grup kur acenta doviz kodlar02 romhrk takvim2 cast cast3  yanrez
                   close aksiyhrk fiyat fiyatana takvim rez  konum gtakas ggunler takasfiyat odalar
                         ggunler2
                   delete file takas 
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya 

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Grup Detay Fiyat Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Grup Detay Fiyat Raporu"   to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Acenta....:"           to det-filler(01:)
     move acn-kod                 to det-filler(15:04)
     move "<->"                   to det-filler(20:03)
     if acn-kod       = spaces
        move "Tum Acentalar.."    to det-filler(25:20)
     else
       
        initialize acenta-rec  
        move acn-kod        to acenta-kodu
        read acenta no lock invalid 
             move all "*" to acenta-adi  
                        not invalid continue
        end-read
       
        move acenta-adi           to det-filler(25:20)
     end-if

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RRLLRRRRLLRRRRLRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
     move "Oda "               to det-3
     move "Rez No "           to det-4
     move "Grup"               to det-1
     move "Grupadi"            to det-1gadi 
     move "Sirket "             to det-sirket 
     move "Kodu"                to det-acen-kod
     move "Acenta"             to det-acenta
     move "Adi Soyadi  "         to det-5
     move "Pax "               to det-11
     move "Chi."               to det-12
     
     move "Check/In  "         to det-6
     move "Check/Out "         to det-7
     move "O.Gec"              to det-8
     move "P.Gec"              to det-9
     move "O.Kon"              to det-okonum
     move "F.Kon"              to det-fkonum
     move "Toplam TL"   to det-sayi(1)
     move "Toplam DOV"  to det-sayi(2)
     move "--"    to det-pax(1)
     move "Pax"    to det-pax(2)
     initialize ggunler-rec
     start ggunler key > ggunler-kodu invalid continue
       not invalid
        perform varying ii from 1 by 1 until ii > 19 or fs-ggunler = "10"
          read ggunler next
            end move "10" to fs-ggunler
            not end
               move ggunler-tarih(1:4) to xyil 
               move ggunler-tarih(5:2) to xay
               move ggunler-tarih(7:2) to xgun
               move xtarih             to det-sayi( ii + 2 )
               move "Pax"              to det-pax  ( ii + 2 )
         end-read
       end-perform
    end-start
     move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-11 fil-12  fil-1gadi fil-sirket fil-acenta fil-acen-kod
                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                 fil-sayi(21) 
                 fil-pax(1) fil-pax(2) fil-pax(3) fil-pax(4) fil-pax(5) 
                 fil-pax(6) fil-pax(7) fil-pax(8) fil-pax(9) fil-pax(10) 
                 fil-pax(11) fil-pax(12) fil-pax(13) fil-pax(14) fil-pax(15) 
                 fil-pax(16) fil-pax(17) fil-pax(18) fil-pax(19) fil-pax(20) 
                 fil-pax(21) fil-okonum fil-fkonum
                 
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1   det-3 det-4 det-5 det-6
                 det-7 det-8 det-9  det-11 det-12     det-1gadi det-sirket det-acenta det-acen-kod
                 det-sayi(1) det-sayi(2) det-sayi(3) det-sayi(4) det-sayi(5) 
                 det-sayi(6) det-sayi(7) det-sayi(8) det-sayi(9) det-sayi(10) 
                 det-sayi(11) det-sayi(12) det-sayi(13) det-sayi(14) det-sayi(15) 
                 det-sayi(16) det-sayi(17) det-sayi(18) det-sayi(19) det-sayi(20) 
                 det-sayi(21) det-okonum det-fkonum
     write dokumer-rec from detay
*********************************
             if   sade-uyumsuz  = 1 then 
               
              initialize fs-gtakas  gtakas-rec 
                          kont-grup 
               move high-values to gtakas-rec
             start gtakas key < gtakas-kodu-2 invalid continue
             not invalid       
              perform with test after until fs-gtakas = "10"
                    
                    read gtakas previous no lock end move "10" to fs-gtakas
                    not at end
                      
                     if gtakas-anlasma = 1 then 
                           move gtakas-top-tutdov   to son-tutar
                           move gtakas-rezno        to son-rezno  rez-no
                           else
                             move gtakas-rezno        to  rez-no
                           read rez no lock invalid continue
                           end-read
                          if  (gtakas-rezno  =  son-rezno  and   son-tutar not =  gtakas-top-tutdov) 
                             or REZ-FIYAT-FIX  = "E" then 
                                
                                move 1 to gtakas-uyumsuz
                               rewrite gtakas-rec invalid 
                                   continue
                               end-rewrite
                         end-if
                       
                        
                     end-if
                   
                     
                     
                    
                    
                      
                    end-read
              end-perform
          end-start   
           end-if
            initialize fs-gtakas  gtakas-rec 
                          kont-grup 
           start gtakas key > gtakas-kodu-2 invalid continue
             not invalid       
              perform with test after until fs-gtakas = "10"
                    
                    read gtakas next no lock end move "10" to fs-gtakas
                    not at end
                    if   sade-uyumsuz  = 1     
                      if gtakas-uyumsuz not = 1 and gtakas-anlasma not = 1                         
                        read gtakas  next no lock end move "10" to fs-gtakas
                          not end
                             if gtakas-anlasma = 1 
                               exit perform cycle
                             end-if
                         end-read
                      end-if
                     end-if
                      if kont-grup      = spaces 
                         move gtakas-grup  to kont-grup
                      end-if
                      
                      perform detay-ata

                      
                    end-read
              end-perform
          end-start   
              
              perform g-liste-toplam 
             perform  g-liste-toplam2
              close dokumer
              if link-var > 0 then 
                        set dokumer-grid to true
              end-if
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close konuk takas gtakas ggunler grup ggunler2 takasfiyat kur doviz rez  takvim kodlar02
              close konum aksiyhrk fiyat fiyatana romhrk takvim2 cast   cast3 yanrez acenta firma odalar
              delete file dokumer takas gtakas ggunler ggunler2 takasfiyat

    end-evaluate.
     .

 takas-aktar.



    perform takas-dosya-ac.
    move "I" to rez-durumu
  
    move ilk-tarih to takvim-anah
    start takvim key <= takvim-anah  
     invalid
           move takvim-anah to ilk-start-tarih
     not invalid
        read takvim previous no lock end-read
        read takvim previous no lock 
          at end
            move takvim-anah to ilk-start-tarih
          not end
           move takvim-anah to ilk-start-tarih
         end-read
    end-start
    
    move son-tarih to takvim-anah
    start takvim key >= takvim-anah
        invalid
           move takvim-anah to son-start-tarih
        
        not invalid
        read takvim next no lock end-read
        read takvim next no lock 
          at end
            move takvim-anah to son-start-tarih
          not end
           move takvim-anah to son-start-tarih
         end-read
    end-start
    



    move ilk-start-tarih   to rez-gir-tar
   
    start rez key not < rez-gir 
      invalid 
          continue
      not invalid
            
          perform until fs-rez = "10" 
             or rez-gir-tar > son-start-tarih
                 read rez next no lock
                  end move "10" to fs-rez
              end-read
                if sade-cin = 1 and rez-folio not > 0 then 
                  exit perform cycle
                end-if
                if rez-durumu not = "I"
                  exit perform cycle
               end-if
                 if rez-folio > 0 then 
                   move rez-folio to konuk-folio
                   read konuk no lock 
                     invalid continue
                     not invalid
                     if konuk-gec-giris = 1 then
                        move rez-gir-tar to takvim-anah
                        start takvim key <= takvim-anah  
                         invalid
                           move takvim-anah to rez-gir-tar
                        
                        not invalid
                        read takvim previous no lock end-read
                        read takvim previous no lock 
                          at end
                            move takvim-anah to rez-gir-tar
                          not end
                           move takvim-anah to rez-gir-tar
                         end-read
                        end-start
                                     
                     
                     end-if
                    end-read    
                  end-if
                  
                 if ( rez-acenta = acn-kod or acn-kod = spaces ) 
                    and rez-gir-tar >= ilk-tarih 
                    and rez-gir-tar <= son-tarih
                    and rez-cik-tar >= ilk-cik-tarih
                    and rez-cik-tar <= son-cik-tarih
                    move "B" to kodlar02-tipi
                    move rez-odeme-tipi to kodlar02-kodu
                    read kodlar02 no lock invalid
                     move spaces to kodlar02-REC
                    end-read
                  if ode-posting not = "H" and                   
                  ( REZ-GRUP-NO = rapor-grup or rapor-grup = spaces or 0 )
                  if onkpara-referans-var = 1 then 
                     perform ref-filtre
                     if   ref-gecti then 
                         if filtre-var = 1 then 
                            perform filtre
                               if filtre-gecti  = 1 then 
                                   perform  tek-rez-yaz
                                end-if
                              else
                           perform  tek-rez-yaz
                          end-if

                     end-if
                     else
                         if filtre-var = 1 then
                            perform filtre
                               if filtre-gecti  = 1 then 
                                   perform  tek-rez-yaz
                                end-if
                              else
                           perform  tek-rez-yaz
                          end-if
                     end-if

*                          if rapor-ref not = 0 
*                             perform ref-bul
*                           end-if
*                           if rapor-ref = 0 or rapor-ref = konum-ref then  
*                             if filtre-var = 1 then 
*                                    perform filtre
*                                 if filtre-gecti  = 1 then 
*                                  perform  tek-rez-yaz
*                                   end-if
*                                 else
*                                   perform  tek-rez-yaz
*                              end-if
*                           end-if
                  end-if
                 end-if
              
           end-perform
    end-start.
  
    move dilk-tar to takvim-anah
    start takvim key >= takvim-anah 
        invalid continue
        not invalid
        perform varying ii from 1 by 1 until ii > 19 or fs-takvim = "10"
            read takvim next no lock end move "10" to fs-takvim
                not end
                  initialize ggunler-rec
                  initialize ggunler2-rec
                  move takvim-anah to ggunler-tarih  ggunler2-tarih dson-tar
                  move ii to ggunler-sira ggunler2-sira
                  write ggunler-rec invalid stop " " end-write
                  move "1" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "2" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "3" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "4" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "E" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "G" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "H" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
                  move "B" to ggunler2-tip    write ggunler2-rec invalid stop " " end-write
           end-read
       end-perform
    end-start

    initialize takasfiyat-rec
    start takasfiyat key > takasfiyat-anah invalid continue
      not invalid
       perform until  fs-takasfiyat = "10"
        read takasfiyat next 
         end move "10" to fs-takasfiyat
         not end 
          if takasfiyat-tarih < "20000000" then 
            exit perform cycle
          end-if
          if  takasfiyat-tarih < dilk-tar 
             move dilk-tar to ggunler-tarih  ggunler2-tarih
            else
             move dson-tar to ggunler-tarih
            if  takasfiyat-tarih < dson-tar 
              move   takasfiyat-tarih to ggunler-tarih  ggunler2-tarih
            end-if
         end-if
         read ggunler no lock invalid 
            display message box "H87868"
         end-read
          

          initialize gtakas-rec cast-rec
          MOVE TAKASFIYAT-REZ-NO to gtakas-rezno rez-no cast-rez-no
          move takasfiyat-tarih   to cast-tarih
          read cast no lock invalid continue
          end-read
          read rez no lock invalid continue 
          end-read
          read gtakas no lock invalid  
            move rez-acenta to  gtakas-acenta
             move rez-firma to gtakas-sirket 
             move rez-grup-no to gtakas-grup
             move rez-odano to gtakas-odano
             move rez-share to gtakas-share  YEDEK-SHARE
          end-read
            
              if eski-tip not = 1 
               
              add TAKASFIYAT-FIYAT      to gtakas-tar-tutdov(ggunler-sira) 
                                           gtakas-top-tutdov 
                                           ggunler-tutdov
                                           top-dov
              add TAKASFIYAT-fiyat-tl  to gtakas-tar-tuttl(ggunler-sira) 
                                          gtakas-top-tuttl  
                                          ggunler-tuttl 
                                          top-tl



              else
              
             
              add TAKASFIYAT-FIYAT     to gtakas-tar-tutdov(ggunler-sira) 
                                           gtakas-top-tutdov 
                                           ggunler-tutdov
                                           top-dov
              add TAKASFIYAT-fiyat-tl  to gtakas-tar-tuttl(ggunler-sira) 
                                          gtakas-top-tuttl  
                                          ggunler-tuttl 
                                          top-tl

             


          end-if
**************************
               evaluate cast-buyuk
                     when 1
                        move "1" to ggunler2-tip 
                     when 2
                        move "2" to ggunler2-tip 
                     when other
                        move "3" to ggunler2-tip 
               end-evaluate
                read ggunler2 no lock invalid 
                          display message box "H87868"
                  end-read
               add TAKASFIYAT-FIYAT      to  ggunler2-tutdov
                                          
               add TAKASFIYAT-fiyat-tl  to   ggunler2-tuttl 
                 if takasfiyat-tarih >= rez-gir-tar and  
                      takasfiyat-tarih < rez-cik-tar  then 
                         add cast-buyuk to  ggunler2-pax
                 end-if                          
                move cast-share to rez-share
              if rez-share not = 1 and takasfiyat-tarih >= rez-gir-tar
                 and  takasfiyat-tarih < rez-cik-tar  then 
                   add 1    to gtakas-top-ogec top-ogec
              end-if
              if takasfiyat-tarih >= rez-gir-tar and  
                 takasfiyat-tarih < rez-cik-tar  then 
                   compute gtakas-top-pgec =   gtakas-top-pgec + rez-buyuk + ( rez-kucuk / 2 )
                   compute top-pgec =   top-pgec + rez-buyuk + ( rez-kucuk / 2 )
                    add cast-buyuk to gtakas-tar-pax(ggunler-sira) 
                                       gtakas-top-pax
                                       ggunler-pax
                                       top-pax
                  move CAST-PAN-TIPI to gtakas-tar-pan(ggunler-sira) 
              end-if




              write gtakas-rec invalid rewrite gtakas-rec
              end-write   
              



              initialize gtakas-rec
              MOVE TAKASFIYAT-REZ-NO to gtakas-rezno
              move 1 to gtakas-anlasma
            read gtakas no lock invalid 
             move rez-acenta to  gtakas-acenta
             move rez-firma to gtakas-sirket 
             move rez-grup-no to gtakas-grup
             move rez-odano to gtakas-odano
             move YEDEK-SHARE to gtakas-share
            end-read
             
               add TAKASFIYAT2-FIYAT     to gtakas-tar-tutdov(ggunler-sira) 
                                            gtakas-top-tutdov 
                                            ggunler-tutdov2
                                            top-dov2
               add TAKASFIYAT2-fiyat-tl  to gtakas-tar-tuttl(ggunler-sira) 
                                            gtakas-top-tuttl  
                                            ggunler-tuttl2 
                                            top-tl2

                write gtakas-rec     invalid rewrite gtakas-rec
                end-write

                rewrite ggunler-rec  invalid stop " "
                end-rewrite
                 rewrite ggunler2-rec  invalid stop " "
                end-rewrite
        end-read
       end-perform
    end-start

           .
 takas-aktar-exit.
    exit.

*
 ref-bul.
       MOVE rez-ODA-KONUMU TO KONUM-ANAHTAR
       READ KONUM NO LOCK INVALID
         DISPLAY MESSAGE BOX "kasa-KONUK-23644"
       END-READ.

*
 gece-al.
    initialize takas-gece takvim-rec.
    move rez-gir-tar to takvim-anah.
*    open input takvim
    start takvim key not < takvim-anah invalid move 1 to takas-gece continue,

        not invalid,
        move spaces to var-yok,
        perform with test after until var,
            read takvim next no lock end move "V" to var-yok,

                not end,

                evaluate true
                    when takvim-anah = rez-cik-tar move "V" to var-yok,
                    when takvim-anah > rez-cik-tar move "V" to var-yok,
                    when takvim-anah not > rez-cik-tar,
                         add 1 to takas-gece,
                end-evaluate,
            end-read,
        end-perform,
    end-start
*    close takvim
    .

 gece-al-exit.
    exit.
 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid move 1 to ekran-fis-1.
 
    add 1 to ekran-fis-1.
   
    move ekran-fis-1(2:) to takas-no takasfiyat-no gtakas-no ggunler-no ggunler2-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    
    open output takas takasfiyat gtakas ggunler ggunler2
    close takas takasfiyat gtakas ggunler ggunler2
    open i-o takas with mass-update.
    open i-o takasfiyat gtakas ggunler ggunler2 with mass-update.
    initialize takas-rec.

 detay-ata.
    initialize dokumer-rec detay
      move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                                 fil-7 fil-8 fil-9  fil-11 fil-12 fil-1gadi fil-sirket fil-acenta fil-acen-kod
                                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                                 fil-sayi(21) fil-okonum fil-fkonum
                                      
    if gtakas-anlasma = 0 then
         perform tek-detay-at

         move rez-gir-gun       to xgun
         move rez-gir-ay        to xay
         move rez-gir-yil       to xyil
         move xtarih to det-6
         move rez-cik-gun       to xgun
         move rez-cik-ay        to xay
         move rez-cik-yil       to xyil
         move xtarih to det-7
         if rez-grup-no > 0 then 
         move rez-grup-no       to det-1
         end-if

         initialize odalar-rec
         move rez-odano         to det-3 odalar-anah
         read odalar no lock invalid 
              continue
         end-read
         if odalar-uzun-no not = spaces
            move odalar-uzun-no to det-3
         end-if
         move gtakas-top-ogec   to z-5
         move z-5               to det-8
         move gtakas-top-pgec   to n-8
         move n-8               to det-9
         move rez-buyuk         to z-3
         move z-3               to det-11
         move rez-kucuk         to z-3
         move z-3               to det-12
         add rez-buyuk   to top-buyuk
         add rez-kucuk   to top-kucuk
        
             add 1 to top-oda
        

        
         move  gtakas-top-tuttl   to bas-top-tuttl
         move  gtakas-top-tutdov  to bas-top-tutdov
           initialize ek1 ek2
           if rez-gel-sirket not = spaces 
           move "*" to ek1
         end-if
          if rez-git-sirket not = spaces 
           move "*" to ek2
         end-if
         string ek1 delimited by " "
             rez-adi delimited by " "
           " " delimited by size
           ek2 delimited by " "
           rez-soyadi delimited by size
           into det-5

           initialize konum-rec
           move rez-oda-konumu   to konum-anahtar
           read konum no lock invalid 
                move "*****"  to konum-adi
           end-read 
                move konum-adi  to  det-okonum

           initialize konum-rec
           move rez-fiyat-konumu   to konum-anahtar
           read konum no lock invalid 
                move "*****"  to konum-adi
           end-read 
                move konum-adi  to det-fkonum             
            move REZ-GRUP-ADI   to det-1gadi 
            MOVE rez-firma      to firma-kodu
            move rez-acenta to acenta-kodu
            read firma no lock invalid
                   continue
                   not invalid
                   string 
                   firma-kodu delimited by " "
           "-" delimited by size
           firma-adi delimited by size
           into det-sirket
           end-read


           read acenta no lock invalid
                   continue
           not invalid
               move acenta-kodu to det-acen-kod
               move acenta-adi  to det-acenta
           end-read
            move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-11 fil-12  fil-1gadi fil-sirket fil-acenta fil-acen-kod
                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                 fil-sayi(21) fil-okonum fil-fkonum 
       
            
           write dokumer-rec from detay
        if yan-goster = 1 then 
           perform yan-detay-ata
        end-if       
       else
           move "ANLASMA FIYATLARI" to det-5

           if anlasma-goster = 1 then 
                perform tek-detay-at
               if gtakas-top-tutdov  = bas-top-tutdov and REZ-FIYAT-FIX  not = "E"                    
                    move "521" to det-renk1
               else
                 if REZ-FIYAT-FIX  = "E" then
                    move "111" to det-renk1
                 else
                   
                    move "176" to det-renk1
                 end-if
               end-if
                move "A"          to det-dokumer-20(3:1)
    
                move "1"         to det-dokumer-20(10:1)
                write dokumer-rec from detay
           end-if
   
      end-if
*    move gtakas-tar-tuttl      to z-1.
*    move z-1                 to det-12.
*    move gtakas-tar-tutdov        to z-2.
*    move z-2                 to det-13.
   

    
    move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-11 fil-12  fil-1gadi fil-sirket fil-acenta fil-acen-kod
                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                 fil-sayi(21) fil-okonum fil-fkonum. 






        .
 tek-detay-at.
     move gtakas-rezno         to det-4  rez-anah

     read rez no lock invalid 
          stop " " 
     end-read

    
    
     move  gtakas-top-tuttl  to n-9
     move  n-9               to det-sayi(1)
     move  gtakas-top-tutdov to n-9
     move  n-9               to det-sayi(2)
     move  gtakas-top-pax    to z-pax
     move  z-pax             to det-pax(2)

     perform varying ii from 1 by 1 until ii > 19
        if det-doviz = 1 then 
             move gtakas-tar-tutdov(ii) to n-9
          else
            move gtakas-tar-tuttl(ii) to n-9
        end-if
        move gtakas-tar-pax(ii) to z-pax
        move z-pax to  det-pax(ii + 2)
        move n-9 to det-sayi(ii + 2)
        move gtakas-tar-pan(ii) to det-pax(ii + 2)(1:2)



     end-perform .

*
*
 g-liste-toplam2.
    perform varying xy from 1 by 1 until xy > 3
      evaluate xy 
            when 1 move "1" to toplam-tip
            when 2 move "2" to toplam-tip
            when 3 move "3" to toplam-tip
            when 4 move "R" to toplam-tip
            when 5 move "E" to toplam-tip
            when 6 move "G" to toplam-tip
            when 7 move "H" to toplam-tip
            when 8 move "B" to toplam-tip
       end-evaluate 
    initialize dokumer-rec detay

    initialize ggunler2-rec
    move toplam-tip to   ggunler2-tip
    initialize atop-tl atop-dov  atop-oda atop-pax
    start ggunler2 key > ggunler2-kodu invalid continue
     not invalid
    perform varying ii from 1 by 1 until ii > 19
       read ggunler2 next end move "10" to fs-ggunler2
        not end
         if  toplam-tip not =  ggunler2-tip  
            exit perform
         end-if
        if det-doviz = 1 then 
             move ggunler2-tutdov to n-9 

          else
            move ggunler2-tuttl to n-9  
        end-if
        move n-9 to det-sayi(ii + 2)
         move ggunler2-pax to z-pax 
         move z-pax to det-pax(ii + 2)
        end-read
        add ggunler2-tutdov to atop-dov 
                           
        add ggunler2-pax to atop-pax
        add 1 to atop-oda             
        add ggunler2-tuttl to atop-tl











     end-perform 
     end-start
    move atop-tl   to n-9       
    move n-9     to det-sayi(1)
    move atop-dov  to n-9      
    move n-9     to det-sayi(2)
     move atop-pax  to z-pax    
    move z-pax     to det-pax(2)
        

          move "        TOPLAM " to det-5
         evaluate  toplam-tip
           when  "1"  
             move "1 PAX " to det-5(1:6) 
             
           when "2"    move "2 PAX " to det-5(1:6) 
           when "3"    move "3+ PAX" to det-5(1:6) 
         end-evaluate  
     

    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-11 fil-12  fil-1gadi fil-sirket fil-acenta  fil-acen-kod
                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                 fil-sayi(21) fil-okonum fil-fkonum

    write dokumer-rec from detay
    end-perform.

*
 g-liste-toplam.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-1   det-3 det-4 det-5 det-6
                 det-7 det-8 det-9  det-11 det-12  det-1gadi det-sirket det-acenta det-acen-kod
                 det-sayi(1) det-sayi(2) det-sayi(3) det-sayi(4) det-sayi(5) 
                 det-sayi(6) det-sayi(7) det-sayi(8) det-sayi(9) det-sayi(10) 
                 det-sayi(11) det-sayi(12) det-sayi(13) det-sayi(14) det-sayi(15) 
                 det-sayi(16) det-sayi(17) det-sayi(18) det-sayi(19) det-sayi(20) 
                 det-sayi(21) det-okonum det-fkonum
    write dokumer-rec from detay.
    initialize dokumer-rec detay

    initialize ggunler-rec
    start ggunler key > ggunler-kodu invalid continue
     not invalid
    perform varying ii from 1 by 1 until ii > 19
       read ggunler next end move "10" to fs-ggunler
        not end
        if det-doviz = 1 then 
             move ggunler-tutdov to n-9 

          else
            move ggunler-tuttl to n-9  
        end-if
        move n-9 to det-sayi(ii + 2)
         move ggunler-pax to z-pax 
         move z-pax to det-pax(ii + 2)
        end-read
     end-perform .
    move top-tl   to n-9        bas-top-tuttl
    move n-9     to det-sayi(1)
    move top-dov  to n-9       bas-top-tutdov
    move n-9     to det-sayi(2)
     move top-pax  to z-pax    
    move z-pax     to det-pax(2)
         move top-ogec   to z-5
         move z-5               to det-8
         move top-pgec   to n-8
         move n-8               to det-9
         move top-buyuk         to z-3
         move z-3               to det-11
         move top-kucuk         to z-3
         move z-3               to det-12
       move top-oda          to z-3
         move z-3               to det-3(2:)
         move "REEL TOPLAM " to det-5

    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-11 fil-12  fil-1gadi fil-sirket fil-acenta fil-acen-kod
                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                 fil-sayi(21) fil-okonum fil-fkonum

    write dokumer-rec from detay.


   
      initialize dokumer-rec detay

    initialize ggunler-rec
    start ggunler key > ggunler-kodu invalid continue
     not invalid
    perform varying ii from 1 by 1 until ii > 19
       read ggunler next end move "10" to fs-ggunler
        not end
        if det-doviz = 1 then 
             move ggunler-tutdov2 to n-9

          else
            move ggunler-tuttl2 to n-9
        end-if
        move n-9 to det-sayi(ii + 2)
        end-read
     end-perform .
    move top-tl2   to n-9
    move n-9     to det-sayi(1)
    move top-dov2  to n-9
    move n-9     to det-sayi(2)
     move "ANLASMA TOPLAM " to det-5
    move "A"          to det-dokumer-20(3:1)
     if   top-tl2  = bas-top-tuttl and
                     top-dov2  = bas-top-tutdov 
               move "481" to det-renk1
     else
            move "176" to det-renk1
     end-if
   
    move "1"          to det-dokumer-20(10:1)
    move "|" to fil-1   fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9  fil-11 fil-12    fil-1gadi   fil-sirket fil-acenta fil-acen-kod
                 fil-sayi(1) fil-sayi(2) fil-sayi(3) fil-sayi(4) fil-sayi(5) 
                 fil-sayi(6) fil-sayi(7) fil-sayi(8) fil-sayi(9) fil-sayi(10) 
                 fil-sayi(11) fil-sayi(12) fil-sayi(13) fil-sayi(14) fil-sayi(15) 
                 fil-sayi(16) fil-sayi(17) fil-sayi(18) fil-sayi(19) fil-sayi(20) 
                 fil-sayi(21) fil-okonum fil-fkonum

    write dokumer-rec from detay.
    initialize dokumer-rec detay
*****************************************
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-1   det-3 det-4 det-5 det-6
                 det-7 det-8 det-9  det-11 det-12   det-1gadi det-sirket det-acenta det-acen-kod
                 det-sayi(1) det-sayi(2) det-sayi(3) det-sayi(4) det-sayi(5) 
                 det-sayi(6) det-sayi(7) det-sayi(8) det-sayi(9) det-sayi(10) 
                 det-sayi(11) det-sayi(12) det-sayi(13) det-sayi(14) det-sayi(15) 
                 det-sayi(16) det-sayi(17) det-sayi(18) det-sayi(19) det-sayi(20) 
                 det-sayi(21) det-okonum det-fkonum
    write dokumer-rec from detay.
*
 acc-07-Aft-Procedure.
      open input acenta
      if acn-kod = spaces 
        move "Tum Acentalar" to acenta-adi
      else 
      move acn-kod    to acenta-kodu
      read acenta no lock invalid
           move "Tanimsiz Acenta ..." to acenta-adi
           move 4 to accept-control
           move 12 to control-id
      end-read
      end-if.
      display lb-acenadi.
      close acenta. 
     
     .
*

     .
*
 gun-bul2.
     initialize gun-s

     move rez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= rez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s        
                          end-if 
                end-read


              end-perform  
      end-start.
     .

*
 Tek-Rez-Takas.
 
    perform takas-dosya-ac.
    
    initialize rez-rec.

      move gelen-rez to rez-anah
*      open input rez
      
      read rez  no lock 
        invalid 
*         close rez
         display message box "Rezervasyon Bulunamadi"
         not invalid 
*                         close rez
                      perform tek-rez-yaz               
         end-read.
               .
 

     .
*
 tek-rez-yaz.
          perform peryot-fiyat-bul
          write takas-rec invalid 
               rewrite takas-rec,
         end-write.
*
 grup-after.
     
      if rapor-grup not = spaces and 0 then 
      move 1 to ii
      open input rez
      initialize rez-rec 
      move rapor-grup to REZ-GRUP-NO
      move "I"  to rez-durumu
       start rez key >=  REZ-grup invalid 
         display message box " Grup bulunamadi"
         not invalid
            
            perform until fs-rez = "10" 
                 read rez next no lock end move "10" to fs-rez
                     not end
                      if  REZ-GRUP-NO not = rapor-grup or 
                         "I"  not = rez-durumu then
                          if ii = 1 then 
                             display message box " Grup bulunamadi"
                            
                           end-if 
                           move "10" to fs-rez

                         else
                          if ii = 1 then
                               move rez-gir-tar to ilk-tarih
                               move rez-gir-tar to son-tarih
                               move rez-cik-tar to ilk-cik-tarih
                               move rez-cik-tar to son-cik-tarih
                           end-if
                          move 3 to ii
                           if rez-cik-tar < ilk-cik-tarih move rez-cik-tar to  ilk-cik-tarih end-if
                           if rez-cik-tar > son-cik-tarih move rez-cik-tar to  son-cik-tarih end-if
                          
                           if rez-gir-tar < ilk-tarih move rez-gir-tar to  ilk-tarih end-if
                           if rez-gir-tar > son-tarih move rez-gir-tar to  son-tarih end-if
                          
                     end-if
                 end-read
            end-perform


       end-start
       move ilk-tarih to dilk-tar
         display acc-01  acc-02  acc-03 acc-04 acc-05 acc-06
         display acc-01a  acc-02a  acc-03a acc-04a acc-05a acc-06a
         display acc-01c acc-02c acc-03c 
       close rez
       end-if
      
     .
*
*
 yan-detay-ata.
     initialize yanrez-rec
     move gtakas-rezno          to yanrez-rezno
     start yanrez key not < yanrez-anah invalid
           continue
     not invalid
     perform with test after until fs-yanrez = "10"
     read yanrez next no lock end move "10"  to fs-yanrez
     not at end
            initialize dokumer-rec detay
            if yanrez-rezno <> gtakas-rezno
               exit perform
            end-if

            if yanrez-sirano > 1 then 
               string yanrez-adi delimited by " "
                   " " delimited by size
                 yanrez-soyadi delimited by size
                 into det-5
                write dokumer-rec from detay
                
                
           end-if


     end-read
     end-perform
     end-start
     .
*
 grup-ara.
    initialize gruplar-cagir
    call "/asya/ytl/obj/otel/gruplara.asy" using gruplar-cagir
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/gruplara.asy" 
    end-call
    move gruplar-cagir   to rapor-grup
    display acc-grup-no
      perform gruplar-oku.
*
 gruplar-oku.
        
    if rapor-grup not = zeroes and spaces 
     open input gruplar
     initialize gruplar-rec
     move rapor-grup  to gruplar-kodu
     read gruplar no lock invalid 
          move "    "      to gruplar-adi
     end-read 
          move gruplar-adi to gadi

       move gruplar-gel-tar to ilk-tarih
       move gruplar-gel-tar to son-tarih
       move gruplar-git-tar to ilk-cik-tarih
       move gruplar-git-tar to son-cik-tarih
       if gruplar-git-tar < ilk-cik-tarih move gruplar-git-tar to  ilk-cik-tarih end-if
       if gruplar-git-tar > son-cik-tarih move gruplar-git-tar to  son-cik-tarih end-if
       
       if gruplar-gel-tar < ilk-tarih move gruplar-gel-tar to  ilk-tarih end-if
       if gruplar-gel-tar > son-tarih move gruplar-gel-tar to  son-tarih end-if
       move ilk-tarih to dilk-tar
       move 1         to ilk-gun ilk-cik-gun
       move 1         to ilk-ay ilk-cik-ay
       move 2002      to ilk-yil ilk-cik-yil

       move 31        to son-gun son-cik-gun
       move 12        to son-ay  son-cik-ay
       move 2026      to son-yil son-cik-yil

         display acc-01  acc-02  acc-03 acc-04 acc-05 acc-06
         display acc-01a  acc-02a  acc-03a acc-04a acc-05a acc-06a
         display acc-01c acc-02c acc-03c 


     close gruplar
    else
       move "Tum Gruplar" to gadi
    end-if 
    display lb-gadi
    .
*
 acc-grup-no-Aft-Procedure.
    perform gruplar-oku
     
     .



 
