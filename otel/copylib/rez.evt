* rez.evt
* rez.evt is generated from D:\asya\acugt.ytl\otel\rez.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-tab-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form1-Ta-1-Value
        MOVE 0 TO tab-s-1-Visible, tab-s-2-Visible, tab-s-3-Visible,
            tab-s-4-visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO tab-s-1-Visible
        WHEN 2
           MOVE 1 TO tab-s-2-Visible
        WHEN 3
           MOVE 1 TO tab-s-3-Visible
        WHEN 4
           MOVE 1 TO tab-s-4-visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form1
*       After-Tabchg-Display
     END-EVALUATE
     .

 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 eraly-booking-cb-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           EVALUATE Event-Control-Id
           WHEN 1025
              PERFORM eraly-booking-cb-Ex-Cmd-Clicked
           WHEN 178
              PERFORM fix-fiyat-cb-Ex-Cmd-Clicked
           WHEN 220
              PERFORM fix-fiyat-cb-Ex-Cmd-Clicked
           WHEN 199
              PERFORM fix-fiyat-cb-Ex-Cmd-Clicked
           WHEN 244
              PERFORM fix-fiyat-cb-Ex-Cmd-Clicked
           WHEN 301
              PERFORM fix-fiyat-cb-Ex-Cmd-Clicked
           END-EVALUATE
        END-EVALUATE
     END-IF
     .

 aksiyon-cb-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM aksiyon-cb-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 bilbord-cb-Exception-Proc.
     PERFORM bilbord-cb-Ex-Cmd-Clicked
     .

 special-cb-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM special-cb-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 a-fiy-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Changed
           PERFORM a-fiy-Ex-Ntf-Changed
        END-EVALUATE
     END-IF
     .

 fiyat-konumu-combo-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM fiyat-konumu-combo-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 acc-viptipi-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Ntf-Changed
        PERFORM acc-viptipi-Ev-Ntf-Changed
     END-EVALUATE
     .

 accept-tel-no-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM accept-tel-no-Ev-Cmd-Goto
     END-EVALUATE
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        EVALUATE Event-Control-Id
        WHEN 302
           PERFORM gf-Ev-Msg-Begin-Entry
        WHEN 44
           PERFORM Form1-Gd-1a-Ev-Msg-Begin-Entry
        END-EVALUATE
     END-EVALUATE
     .

 tab-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM tab-1-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 accept-not2a-Exception-Proc.
     PERFORM accept-not2a-Ex-Other
     .

 accept-not2aa-Exception-Proc.
     PERFORM accept-not2aa-Ex-Other
     .

 Form1-Pb-5-Exception-Proc.
     PERFORM grup-islemleri
     .

 acc-pno2-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno2-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno3-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno3-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno4-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno4-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno5-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno5-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno6-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno6-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno7-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno7-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno8-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno8-Ev-Cmd-Goto
     END-EVALUATE
     .

 acc-pno9-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-pno9-Ev-Cmd-Goto
     END-EVALUATE
     .

 Form1-Gd-2-Event-Proc.
     PERFORM gd2-Ev-Other
     .

 a-fiya-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Changed
           PERFORM a-fiya-Ex-Ntf-Changed
        END-EVALUATE
     END-IF
     .

 accept-odano-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Changed
           PERFORM accept-odano-Ex-Ntf-Changed
        END-EVALUATE
     ELSE
        PERFORM Exception-Procedure
     END-IF
     .

 acc-mis-no-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM acc-mis-no-Ev-Cmd-Goto
     END-EVALUATE
     .

 Screen1-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Screen1-Pb-1-Link
     .

 Screen1-Gd-1-Event-Proc.
     .

 grform-Exception-Proc.
     PERFORM grform-Ex-Other
     .

 grform-Gd-1-Event-Proc.
     .

 fsil-Event-Proc.
     .

 fsil-Cm-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Ntf-Selchange
        PERFORM fsil-Cm-1-Ev-Ntf-Selchange
     END-EVALUATE
     .

 a2-Exception-Proc.
     PERFORM Exception-Procedure
     .

 screen2-Event-Proc.
     .

 screen3-Event-Proc.
     .

 Screen4-Event-Proc.
     .

 Screen4-Exception-Proc.
     PERFORM Screen4-Ex-Other
     .

 Screen4-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM gd-Ev-Msg-Begin-Entry
     WHEN Msg-Finish-Entry
        PERFORM gd-Ev-Msg-Finish-Entry
     END-EVALUATE
     .

 Form5-Event-Proc.
     .

 gd-tf-Event-Proc.
     PERFORM gd-tf-Ev-Other
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     move 1 to share-en 
     perform icyetki-kontrol
     call "c$narg" using link-var.
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open i-o ulkeek close ulkeek
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read              
     close genel.
     open i-o genel2
     initialize genel2-rec 
     move 1 to genel2-anah 
     read genel2 no lock invalid
          continue
     end-read 
     close genel2                          
      open input kllnc
     move k-kodu-tasi to k-kodu
     read kllnc no lock invalid 
          stop " "
     end-read

     if genel-fiks-yok = 1 then 
        if k-fix-fiyat-etkin = 0 or space   | firat 30/07/2020 delphine
           move 0 to vis-fiy-acik
        else 
           move 1 to vis-fiy-acik
        end-if
     else
        move 1 to vis-fiy-acik
     end-if
      move calisma-tarihi to tarih-tasi.
     move k-blok-acar   to k1-blok-acar
     move k-blok-kitler to k1-blok-kitler
     move k-fiy-sup     to k1-fiy-sup
     move k-muh-sup     to k1-muh-sup
     move k-rezer-sup   to k1-rezer-sup
     move k-konum-upgrade-yapabilir to k1-konum-upgrade-yapabilir
     close kllnc
    
     perform kullandi  
     open i-o rez takvim .
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid  
          initialize genelfis-rec
          move 1 to genelfis-anahtar
          add 1  to rez-oto
          move rez-oto to xrez-no accept-rez-no
          write genelfis-rec invalid
                rewrite genelfis-rec invalid continue
                end-rewrite 
          end-write
     not invalid
          add 1 to  print-no
          move print-no to takasFIYAT-no
          open output takasfiyat
          close takasfiyat
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
     initialize gec-gecme  islkilit-acik-kapali
      open i-o odalar2 
      if genel-uzun-oda-no-kullanilsin = 1 
         move 1 to vis-uzun 
         move 0 to vis-kisa 
      else
         move 1 to vis-kisa  
         move 0 to vis-uzun
      end-if
     
     .
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka.
     move rezpara-doviz       to xrez-doviz.
     move rezpara-pan-tipi    to xrez-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi.
     move rezpara-ulke        to xrez-ulke.
     move rezpara-anlasma     to xrez-anlasma.
     move rezpara-pazar       to xrez-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil xrez-al-yil rez-al-yil    .
     move calis-ay            to xrez-gir-ay  xrez-cik-ay  xrez-al-ay  rez-al-ay  .
     move calis-gun           to xrez-gir-gun xrez-cik-gun xrez-al-gun rez-al-gun.

     move   tarih-tasi to takvim-anah
     start takvim key > takvim-anah invalid continue
       not invalid
       read takvim next no lock end continue
       end-read
     end-start
     move takvim-anah to xrez-cik-tar.

 default-ata.
*************Default Degerler Ataniyor.........
     move "4" to xrez-statu
     display acc-rez-status

       move "0" to xrez-kv-tipi
     display acc-rez-kv-tipi

     modify rez-tipi-combo, 
            value = "1"
            mass-update = 0.
            move "1" to xrez-tipi rez-tipi-combo-value .
     modify rez-kgb-combo, 
            value = rezpara-k-g-b
            mass-update = 0.
            move rezpara-k-g-b to xrez-k-g-b rez-kgb-combo-value.
     modify rez-vip-combo, 
            value = "N"
            mass-update = 0.
            move "N" to xrez-vip rez-vip-combo-value ilk-vip-tipi.

            if rezpara-aygun = "A" move 2 to rb-degisken-1
            else                   move 1 to rb-degisken-1
            end-if.
     modify kur-tipi-rb-1, GROUP-VALUE = rb-degisken-1.
     perform konum-ata thru konum-ata-exit.
 konum-ata.
*************Konumlar Yukleniyor.......
     modify oda-konumu-combo, 
            reset-list  = 1
            mass-update = 1.
     modify fiyat-konumu-combo, 
            reset-list  = 1
            mass-update = 1.
     open input konum.
     initialize konum-rec tmp-sayi ilk-konum.
     start konum key not < konum-anahtar invalid 
           continue
     not invalid 
     initialize fs-konum
     perform with test after until fs-konum = "10"
             read konum next no lock end move "10" to fs-konum
             not at end
                  add 1 to tmp-sayi
                  if tmp-sayi = 1
                      move konum-anahtar     to ilk-konum
                     add 1 to tmp-sayi
                  end-if 
                  initialize oda-konumu-combo-value fiyat-konumu-combo-value
                  move konum-anahtar     to oda-konumu-combo-value     fiyat-konumu-combo-value
                  move "->"              to oda-konumu-combo-value(3:) fiyat-konumu-combo-value(3:)
                  move konum-adi(1:10)         to oda-konumu-combo-value(5:) fiyat-konumu-combo-value(5:) 
                  modify oda-konumu-combo,
                         item-to-add(oda-konumu-combo-value)
                  modify fiyat-konumu-combo,
                         item-to-add(fiyat-konumu-combo-value)
             end-read
     end-perform
     end-start
     close konum.
     move ilk-konum  to oda-konumu-combo-value fiyat-konumu-combo-value 
     modify oda-konumu-combo, 
            mass-update = 0.
     modify fiyat-konumu-combo, 
            mass-update = 0.
 konum-ata-exit.
      exit.
*
 fiyat-konum-bul.
     open input konum.
     initialize konum-rec fiyat-konumu-acik
     move xrez-fiyat-konumu to konum-anahtar
     read konum no lock invalid continue
          not invalid
          initialize fiyat-konumu-acik
          move konum-anahtar     to fiyat-konumu-acik
          move "->"              to fiyat-konumu-acik(3:)
          move konum-adi         to fiyat-konumu-acik(5:)
     end-read.
     close konum.
*     display accept-fiy-kon-adi.
 fiyat-konum-bul-exit.
      exit.
*
*
 rez-oku2.
           if key-status = 52
               exit paragraph
            end-if 
             
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
             
            
          move accept-rez-no to xrez-no rez-no
 
          initialize rez-rec   yan-deg rezek-rec
           move link-gelen-rec to rez-rec 
            initialize rezek-rezidance
          
          if rez-staf-bos not  = high-values then 
              initialize    xrez-rec
          end-if
         
         
              if rez-gir-tar < tarih-tasi then 
                move tarih-tasi to rez-gir-tar
             end-if
          if link-var not = 7 then    
             initialize rez-adi rez-soyadi 
             if rez-para-share-yok = 0 or spaces
                initialize rez-buyuk rez-kucuk rez-free rez-bebek rez-fiyati 
             end-if 
           end-if 
            if rez-staf-bos = high-values then 
               move rez-gir-tar to xrez-gir-tar
               move rez-cik-tar to xrez-cik-tar
               initialize xrez-fiyati
               move rez-odano to xrez-odano
            
               move rez-acenta to xrez-acenta
               move rez-paylas-oda to xrez-paylas-oda  
               move rez-odano to odalar-no
            open input odalar
            read odalar no lock invalid continue
            end-read
            move odalar-konumu to xrez-oda-konumu xrez-fiyat-konumu
            close odalar
            MOVE 0 TO REZ-BUYUK
             
            else
             move rez-rec to xrez-rec
            end-if 
            
               move rez-oto to xrez-no accept-rez-no   xrez-no rez-no   rezek-no
             move link-gelen-sharenum to xrez-sharenum rez-sharenum
             if xrez-sharenum < 0 then
                move 0 to xrez-sharenum 
            end-if
              if cinpara-kartsiz-pos = 1 then 
                move rez-no(2:) to xREZ-EXTRA-KART
                display accept-not2a
              end-if
               move "Y" to rez-yeni-eski

             if link-gelen-sharenum not > 0 and 
                rez-para-share-yok = 0 
                open i-o genelfis
                      initialize genelfis-rec 
                      move 2     to genelfis-anahtar
                      read genelfis no lock invalid
                           display message box "Genel Parametre Tanimsiz..."
                                           title "[ Uyari ]"
                                           icon 1
                               close genelfis
                           exit paragraph
                      not invalid
                          add 1                 to share-no
                          rewrite genelfis-rec end-rewrite 
                      end-read 
                      close genelfis
                       move share-no to xrez-sharenum 
           end-if
          
      move xrez-odano to ydk-odano
     perform okunan-goster.

     if eski-rez  move rez-durumu       to srez-durumu 
                  move rez-tipi         to srez-tipi 
                  move rez-acenta       to srez-acenta 
                  move rez-oda-konumu   to srez-oda-konumu 
                  move rez-fiyat-konumu to srez-fiyat-konumu 
                  move rez-s-d-t-g      to srez-s-d-t-g 
                  move rez-k-g-b        to srez-k-g-b 
                  move rez-anlasma      to srez-anlasma 
                  move rez-pan-tipi     to srez-pan-tipi
                  move rez-odano        to srez-odano 
                  move rez-gir-tar      to srez-gir-tar 
                  move rez-cik-tar      to srez-cik-tar 
                  move rez-kisi         to srez-kisi 
                  move rez-fiyati       to srez-fiyati
                  move rez-on-odeme     to srez-on-odeme 
                  move rez-on-doviz     to srez-on-doviz 
                  move rez-bilbord-eh   to srez-bilbord-eh

*                  modify acc-mis-no, visible = true
*                  modify form1-la-1aaab visible = true
*                  move rez-profil-sirket   to ps1
*                  move rez-profil-no to mis-no
*                  display acc-mis-no acc-ps1

     end-if.
      initialize gec-gecme
         
             perform anlasma-bul
          
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if.

*

*
 rez-okudevre.
           if key-status = 52
               exit paragraph
            end-if 
         
             open i-o genelfis devremulk  
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
             
            
          move accept-rez-no to xrez-no rez-no
 
          initialize yan-deg rezek-rec
          initialize rezek-rezidance
       
              
*              move link-gelen-rec to rez-rec 
              move function numval (link-gelen-rec(11:10))   to devremulk-no
              read devremulk no lock invalid 
                display message box "Devre mulk hissedari okunamadi"
                exit paragraph
              end-read
              if genel-devremulk-cakisma-yok <> 1
                     move DEVREMULK-ODA-NO  to xrez-odano
              end-if
              move "0001"            to xrez-acenta 
              open input musteri
               initialize musteri-rec
              move  DEVREMULK-profil-sirket to ps1  musteri-sirket   
              move  DEVREMULK-profil-no     to mis-no    musteri-no 
                read musteri no lock invalid 
                   continue
                end-read
                move musteri-adi     to xrez-adi
                move musteri-soyadi to  xrez-soyadi
                close musteri
             if genel-devremulk-cakisma-yok <> 1

                open input odalar
                initialize odalar-rec
                move DEVREMULK-ODA-NO  to xrez-odano odalar-anah
                read odalar no lock invalid
                     continue
                end-read
                if odalar-uzun-no <> spaces
                   move odalar-uzun-no to uzun-odano
                else
                   move xrez-odano to uzun-odano
                end-if
                close odalar

             end-if
             initialize rez-adi rez-soyadi
             move DEVREMULK-ODA-KONUMU  to xrez-oda-konumu
             move DEVREMULK-oda-KONUMU  to xrez-fiyat-konumu
             move tarih-tasi            to xrez-al-tar 
             move rez-oto               to xrez-no accept-rez-no 
                                           xrez-no rez-no rezek-no
             move link-rez-grup-rec     to gruplar-rec

*              if rez-gir-tar < tarih-tasi then 
*                move tarih-tasi to rez-gir-tar
*             end-if
          
           
             move gruplar-gel-tar    to xrez-gir-tar   
             move gruplar-git-tar    to xrez-cik-tar  
         
             if cinpara-kartsiz-pos = 1 then 
                 move rez-no(2:) to xREZ-EXTRA-KART
                 display accept-not2a
             end-if
               move "Y" to rez-yeni-eski
 
      move xrez-odano   to ydk-odano
      move devremulk-no to xrez-dev-uye-no
      perform okunan-goster.
 
      initialize gec-gecme
      
             perform anlasma-bul
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if
      close devremulk.
*

*
 rez-oku3.
           if key-status = 52
               exit paragraph
            end-if 
         
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
             
            
          move accept-rez-no to xrez-no rez-no
 
          initialize yan-deg rezek-rec
          initialize rezek-rezidance
       
             
*              move link-gelen-rec to rez-rec 
              move link-rez-grup-rec  to gruplar-rec

*              if rez-gir-tar < tarih-tasi then 
*                move tarih-tasi to rez-gir-tar
*             end-if
             initialize rez-adi rez-soyadi

             move gruplar-kodu       to xrez-grup-no xrez-voucher 
             move gruplar-adi        to xrez-grup-adi 
                                        xrez-adi(1:20) 
                                        xrez-soyadi(1:20)
             move gruplar-firma      to xrez-firma  
             move gruplar-acenta     to xrez-acenta  
             move gruplar-banka      to xrez-banka  
             move gruplar-doviz      to xrez-doviz   
             move gruplar-pan-tipi   to xrez-pan-tipi  
             move gruplar-anlasma    to xrez-anlasma  
             move gruplar-odeme      to xrez-odeme-tipi  
             move gruplar-pazar      to xrez-pazar   
             move gruplar-ulke       to xrez-ulke  
             move gruplar-gel-tar    to xrez-gir-tar   
             move gruplar-git-tar    to xrez-cik-tar  
             move gruplar-not1       to xrez-not1      
             move gruplar-not2       to xrez-not2     
             move 1                  to xrez-buyuk
             move 1                  to xrez-s-d-t-g
             move gruplar-kaynak-1    to xrez-kaynak-1
             move gruplar-kaynak-2    to xrez-kaynak-2
             move gruplar-kaynak-3    to xrez-kaynak-3
             move gruplar-satis-tar   to xrez-al-tar
             move gruplar-isl-tar     to xrez-isl-tar
             move gruplar-kur to xrez-cin-kuru
             if function numval(gruplar-adi(99:2)) > 0 and 
                function numval(gruplar-adi(99:2)) < 40
                  move gruplar-adi(99:2)  to xrez-oda-konumu 
                                             xrez-fiyat-konumu
             else
                  display message box "Konum hatasi..." new-line
                                      "Lutfen Kontrol Ediniz..."
                                  title "Uyari"
                                  icon 1
                     set exit-pushed to true 
             end-if 
                
             move rez-oto to xrez-no accept-rez-no 
                             xrez-no rez-no rezek-no

             move link-gelen-sharenum to xrez-sharenum rez-sharenum
             if xrez-sharenum < 0 
                move 0 to xrez-sharenum
             end-if
             if cinpara-kartsiz-pos = 1 then 
                 move rez-no(2:) to xREZ-EXTRA-KART
                 display accept-not2a
             end-if
               move "Y" to rez-yeni-eski
*             if link-gelen-sharenum not > 0 
*                      open i-o genelfis
*                      initialize genelfis-rec 
*                      move 2     to genelfis-anahtar
*                      read genelfis no lock invalid
*                           display message box "Genel Parametre Tanimsiz..."
*                                           title "[ Uyari ]"
*                                           icon 1
*                               close genelfis
*                           exit paragraph
*                      not invalid
*                          add 1                 to share-no
*                          rewrite genelfis-rec end-rewrite 
*                      end-read 
*                      close genelfis
*                      move share-no to xrez-sharenum 
*           end-if
      move xrez-odano to ydk-odano
      perform okunan-goster.

 
      initialize gec-gecme
             perform anlasma-bul
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if.
*
 Form1-Aft-Initdata.
*/-----------------------------\*    
*/---------DIL AYARLA----------\*    
*/-----------------------------\*
       
     perform dil-ayarla-proc.
          

      if genel-uzun-oda-no-kullanilsin  not = zeroes then
         modify accept-uzun-odano , visible = true
         modify fr-uzun-odano ,     visible = true
         modify accept-odatipi-e , visible = false
         modify fr-odatipi ,       visible = false
     end-if  
          perform web-goster
     initialize rez-rec xrez-rec yan-deg musteriden-geldi. 
     initialize short-var-yok kayit-izni.
     modify ACC-rez-status  reset-list = 1   mass-update = 1 
     modify ACC-rez-status  item-to-add "1-K.Karti Garantili  "
     modify ACC-rez-status  item-to-add "2-Sirket  Garantili  "
     modify ACC-rez-status  item-to-add "3-Acenta  Garantili  "
     modify ACC-rez-status  item-to-add "4-Garantisiz         "
     modify ACC-rez-status  item-to-add "5-Deposit Odemeli  "
     modify ACC-rez-status  item-to-add "6-No Show  "
       modify ACC-rez-status  mass-update = 0


         modify ACC-rez-kv-tipi  reset-list = 1   mass-update = 1 
     modify ACC-rez-kv-tipi   item-to-add("0-Otel Oder","1-AcentaOder","2-MisafirOder")
    
       modify ACC-rez-kv-tipi  mass-update = 0
      
     if link-var = 1 then
       perform rez-parametre-ata
       perform default-ata
       move link-rez-no to accept-rez-no
       move 1 to control-value
       move 1001 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       move 2 to control-value
       move 1002 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       move 3 to control-value
       move 1004 to control-id
       move 4 to accept-control
       exit paragraph
     end-if
     if link-var = 3 then
       
       perform rez-parametre-ata
       perform default-ata
       move link-rez-no to accept-rez-no
       move 1 to control-value
       move 1001 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       perform rez-oku2
       move 3 to control-value
       move 1014 to control-id
       move 4 to accept-control


       exit paragraph
     end-if
     if link-var = 7 then
       perform rez-parametre-ata
       perform default-ata
       move link-rez-no to accept-rez-no
       move 1 to control-value
       move 1001 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       perform rez-oku2
       move 3 to control-value
       move 1014 to control-id
       move 4 to accept-control
         move 2 to key-status
        perform  exception-procedure
        set exit-pushed to true
         call "w$keybuf" using 1,x"1B" end-call
       
       

       exit paragraph
     end-if
     if link-var = 4 then            
       if link-gelen-rec(1:10) = "DEVRE-----"
          move   link-gelen-rec(11:10) to  devremulk-no
               Initialize Rez-Rec xrez-rec
               perform rez-parametre-ata
               perform default-ata
               move link-rez-no to accept-rez-no
               move 1 to control-value
               move 1001 to control-id
               perform bef-procedure 
               perform Aft-Procedure
           
               perform rez-okudevre
               move 3 to control-value
               move 1014 to control-id
               move 4 to accept-control
               exit paragraph 

       else
               initialize rez-rec xrez-rec
               perform rez-parametre-ata
               perform default-ata
               move link-rez-no to accept-rez-no
               move 1 to control-value
               move 1001 to control-id
               perform bef-procedure 
               perform Aft-Procedure
               perform rez-oku3
               move 3 to control-value
               move 1014 to control-id
               move 4 to accept-control
               exit paragraph
       end-if
     end-if
     if link-var = 5 then
       perform toplu-ac
       exit paragraph
     end-if
     if link-var = 6
        perform toplu-degisim
        exit paragraph
     end-if 
     if link-var = 11
        perform toplu-ac-xls
        exit paragraph 
     end-if 
     if link-var < 1 then 
        perform rez-parametre-ata
        perform default-ata
     end-if
*************Buttonlar Disable ediliyor.......
     modify button-acenara      enabled = false.
     modify button-anlasmaara   enabled = false.
     modify button-bankaara     enabled = false.
     modify button-dovizara     enabled = false.
     modify button-ondovizara   enabled = false.
     modify button-pansiyonara  enabled = false.
     modify button-odemeara     enabled = false.
     modify button-anlasmaara   enabled = false.
     modify button-pazarara     enabled = false.
     modify button-ulkeara      enabled = false.
     modify button-odaara       enabled = false.
*************Acceptler Disable ediliyor.......
*************Formu Goster............

       perform gun-bul
       perform form-update
************Degerleri Oku
*            perform acenta-oku   thru acenta-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform sehir-oku    thru sehir-oku-exit
            perform doviz-oku    thru doviz-oku-exit
            perform ondoviz-oku  thru ondoviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit

            perform odatipi-goster
            perform odatipi-goster2
            perform odatipi-goster3
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
 
            initialize gec-gecme
            perform bef-procedure.
*
 toplu-degisim.
    initialize kac-tane-degisecek
    perform varying rami
              from 1
              by 1
              until rami > ust-occ
                 if link-degisim-rez-no(rami) = spaces  or 
                    link-degisim-rez-no(rami) = zeroes
                       exit perform cycle 
                 end-if 
                    add 1 to kac-tane-degisecek
    end-perform
    display message box kac-tane-degisecek "--Adet Rezervasyon Icin Degisim Baslayacaktir." new-line
                                           "Eminmisiniz?"
                    title "Uyari"
                    icon 1
                    type 2
                    default 2
                    returning return-code 
    if return-code = 2
         set exit-pushed to true
         call "w$keybuf" using 1,x"1B" end-call
           exit paragraph
    end-if 

           modify Form1-Fr-2a visible = true
       
          modify button-kaydet visible = false
          modify button-kaydet-cikma visible = false
          modify mesaj-buttonb   visible = false
           modify button-sil  visible = false
           modify button-cogalt visible = false

     move 0  to toplu-rez-adet
     perform yuzde-update   
     perform varying rami 
             from 1 
             by 1 
             until rami > ust-occ
                 if link-degisim-rez-no(rami) = spaces  or 
                    link-degisim-rez-no(rami) = zeroes
                       exit perform cycle 
                 end-if 
                       initialize rez-rec xrez-rec
                       perform rez-parametre-ata
                       perform default-ata
                       move link-degisim-rez-no(rami) to accept-rez-no
                       move 1 to control-value
                       move 1001 to control-id
                       perform bef-procedure 
                       perform Aft-Procedure
                       perform rez-oku

                       if link-degisim-banka not = zeroes
                           move link-degisim-banka to xrez-banka
                           display accept-banka
                       end-if 
                       if link-degisim-doviz not = zeroes
                           move link-degisim-doviz to xrez-doviz
                           display accept-doviz
                       end-if 
                       if link-degisim-pan not = spaces
                           move link-degisim-pan to xrez-pan-tipi  
                           display accept-pansiyon
                       end-if
                       if link-degisim-odeme not = spaces
                           move link-degisim-odeme to xrez-odeme-tipi
                           display accept-odeme
                       end-if
                       if link-degisim-anlasma not = spaces
                           move link-degisim-anlasma to xrez-anlasma
                           display accept-anlasma
                       end-if
                       if link-degisim-pazar not = spaces
                           move link-degisim-pazar to xrez-pazar
                           display accept-pazar
                       end-if
                       if link-degisim-ulke not = spaces
                           move link-degisim-ulke to xrez-ulke
                           display accept-ulke
                       end-if
                       if link-degisim-kaynak1 not = spaces
                           move link-degisim-kaynak1 to xrez-kaynak-1
                           display acc-kaynak1
                       end-if
                       if link-degisim-kaynak2 not = spaces
                           move link-degisim-kaynak2 to xrez-kaynak-2
                           display acc-kaynak2
                       end-if
                       if link-degisim-kaynak3 not = spaces
                           move link-degisim-kaynak3 to xrez-kaynak-3
                           display acc-kaynak3
                       end-if
                       if link-degisim-gelis-tar not = zeroes
                           move link-degisim-gelis-tar to xrez-gir-tar
                           display accept-gir-gun accept-gir-ay accept-gir-yil
                       end-if
                       if link-degisim-cikis-tar not = zeroes
                           move link-degisim-cikis-tar to xrez-cik-tar
                           display accept-cik-gun accept-cik-ay accept-cik-yil
                       end-if
                       if link-degisim-firma not = spaces
                           move link-degisim-firma to xrez-firma
                           display accept-firma
                       end-if
                       if link-degisim-acenta not = spaces
                           move link-degisim-acenta to xrez-acenta
                           display accept-acenta
                       end-if
                       if link-degisim-not1 not = spaces
                           move link-degisim-not1 to xrez-not1
                           display accept-not1
                       end-if
                       if link-degisim-not2 not = spaces
                           move link-degisim-not2 to xrez-not2
                           display accept-not2
                       end-if
                       if link-degisim-odeme-durumu not = spaces
                          move link-degisim-odeme-durumu to xrez-statu 
                          display acc-rez-status
                       end-if 
                       if link-degisim-no-post not = 0 or 
                          link-degisim-no-post not = spaces
                             move link-degisim-no-post   to xrez-no-post
                             display fix-fiyat-cbaa
                       end-if 
                       if link-degisim-mis-tipi not = spaces 
                          move link-degisim-mis-tipi  to xrez-vip 
                          display acc-viptipi
                       end-if 
                       if link-degisim-voucher not = spaces
                          move link-degisim-voucher to xrez-voucher
                          display accept-voucher
                       end-if 
                       
                       add 1  to toplu-rez-adet 
                       move 2 to key-status
                       perform  exception-procedure
                       move  link-degisim-rez-no(rami) to  
                       siradaki-rez-no sifir-rez-no
                            
                       perform  yuzde-update
                       display accept-adi accept-soyadi
               

     end-perform 
         set exit-pushed to true
         call "w$keybuf" using 1,x"1B" end-call
       exit paragraph .
         .
*
 toplu-ac.
      initialize  toplu-rez-adet toplu-oda-adet
      perform varying rami from 1 by 1 until rami > ust-occ
                      
           if link-toplu-grup-adi1(rami) not = spaces or  
              link-toplu-grup-soy1(rami) not = spaces 
           
               add 1 to toplu-rez-adet
               add 1 to toplu-oda-adet
                    if link-toplu-grup-adi2(rami) not = spaces or  
                    link-toplu-grup-soy2(rami) not = spaces 
                       add 1 to toplu-rez-adet
                   
                           if link-toplu-grup-adi3(rami) not = spaces or  link-toplu-grup-soy3(rami) not = spaces 
                               add 1 to toplu-rez-adet

                                 if link-toplu-grup-adi4(rami) not = spaces or  link-toplu-grup-soy4(rami) not = spaces 
                                          add 1 to toplu-rez-adet
                                  end-if

                             end-if
                    end-if
            end-if
      end-perform
       display message box toplu-oda-adet " adet oda icin " toplu-rez-adet " kisi rezervasyon toplu olarak acilacaktir." new-line
                           "Devam etmek istiyor musunuz? " new-line
                           title "Toplu Rezervasyon Acilacak......" icon 2 type 2 default 1 giving sonuc3
           if sonuc3 not = 1 then 
             call "w$keybuf" using 1,x"1B" end-call
             exit paragraph
           end-if
             
        initialize rez-rec xrez-rec
       perform rez-parametre-ata
       perform default-ata
       move link-rez-no to accept-rez-no
       move 1 to control-value
       move 1001 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       perform rez-oku4
      
       set exit-pushed to true
         call "w$keybuf" using 1,x"1B" end-call
       exit paragraph .
*
*
 rez-oku4.
           modify Form1-Fr-2a visible = true
       
          modify button-kaydet visible = false
          modify button-kaydet-cikma visible = false
          modify mesaj-buttonb   visible = false
           modify button-sil  visible = false
           modify button-cogalt visible = false

          move 0 to yuzde
               perform  yuzde-update 
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                    compute siradaki-rez-no =     0
                  add toplu-rez-adet 1 to rez-oto
                  move rez-oto to xrez-no accept-rez-no
               
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                  compute siradaki-rez-no =      rez-oto + 0
                  add toplu-rez-adet to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis

         
            
          move accept-rez-no to xrez-no rez-no
 
          initialize  rezek-rec
          initialize rezek-rezidance
       
             
*              move link-gelen-rec to rez-rec 
              move link-rez-grup-rec  to gruplar-rec

*              if rez-gir-tar < tarih-tasi then 
*                move tarih-tasi to rez-gir-tar
*             end-if
             initialize rez-adi rez-soyadi

             move gruplar-kodu        to xrez-grup-no  xrez-voucher
             move gruplar-adi         to xrez-grup-adi 
                                         xrez-adi(1:20) 
                                         xrez-soyadi(1:20)

             move gruplar-firma       to xrez-firma  
             move gruplar-acenta      to xrez-acenta  
             move gruplar-banka       to xrez-banka  
             move gruplar-doviz       to xrez-doviz   
             move gruplar-pan-tipi    to xrez-pan-tipi  
             move gruplar-anlasma     to xrez-anlasma  
             move gruplar-odeme       to xrez-odeme-tipi  
             move gruplar-pazar       to xrez-pazar   
             move gruplar-ulke        to xrez-ulke  
             move gruplar-gel-tar     to xrez-gir-tar   
             move gruplar-git-tar     to xrez-cik-tar  
             move gruplar-not1        to xrez-not1      
             move gruplar-not2        to xrez-not2     
             move 1                   to xrez-buyuk
             move 1                   to xrez-s-d-t-g
             move gruplar-kaynak-1    to xrez-kaynak-1
             move gruplar-kaynak-2    to xrez-kaynak-2
             move gruplar-kaynak-3    to xrez-kaynak-3 
             move gruplar-satis-tar   to xrez-al-tar
             move gruplar-isl-tar     to xrez-isl-tar
             move gruplar-kur         to xrez-cin-kuru
             if function numval(gruplar-adi(99:2)) > 0 and 
                function numval(gruplar-adi(99:2)) < 40
                  move gruplar-adi(99:2)  to xrez-oda-konumu 
                                             xrez-fiyat-konumu
             else
                  display message box "Konum hatasi..." new-line
                                      "Lutfen Kontrol Ediniz..."
                                  title "Uyari"
                                  icon 1
                     set exit-pushed to true 
             end-if 
                
             move rez-oto to xrez-no accept-rez-no 
                             xrez-no rez-no rezek-no

             move link-gelen-sharenum to xrez-sharenum rez-sharenum
             if xrez-sharenum < 0 
                move 0 to xrez-sharenum
             end-if
             if cinpara-kartsiz-pos = 1 then 
                 move rez-no(2:) to xREZ-EXTRA-KART
                 display accept-not2a
             end-if
               move "Y" to rez-yeni-eski

            initialize  xrez-odano 
             perform okunan-goster
              move  siradaki-rez-no to sifir-rez-no
            initialize gec-gecme
             perform anlasma-bul
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if.
               perform varying rami from 1 by 1 until rami > ust-occ
                 
                 initialize xrez-sharenum yan-deg
*                  initialize xrez-share 
                  if link-toplu-grup-adi1(rami) not = spaces or  
                     link-toplu-grup-soy1(rami) not = spaces 
                        add 1                to siradaki-rez-no
                        move siradaki-rez-no to xrez-no accept-rez-no
                        display accept-rezno
                        move  link-toplu-grup-adi1(rami) to xrez-adi 
                        move  link-toplu-grup-soy1(rami) to xrez-soyadi
                        display accept-adi accept-soyadi
                           
                          if link-toplu-grup-adi2(rami) not = spaces or  
                             link-toplu-grup-soy2(rami) not = spaces 
                              if link-share-yok not = 1 
                                 perform  yeni-share-al-toplu 
                              else
                                 move  link-toplu-grup-adi2(rami)  to adi2
                                 move  link-toplu-grup-soy2(rami)  to soy2
                                 move  link-toplu-grup-adi3(rami)  to adi3
                                 move  link-toplu-grup-soy3(rami)  to soy3
                                 move  link-toplu-grup-adi4(rami)  to adi4
                                 move  link-toplu-grup-soy4(rami)  to soy4

                                 display l-soy3 l-adi3 l-adi2 l-soy2 l-adi4 l-soy4   

                              end-if
                              if link-toplu-grup-adi3(rami) not = spaces or  
                                  link-toplu-grup-soy3(rami) not = spaces 
                                    move 3 to xrez-buyuk   
                                    if link-toplu-grup-adi4(rami) not = spaces or  link-toplu-grup-soy4(rami) not = spaces
                                       move 4 to xrez-buyuk   
                                    end-if
                              else 
                                   move 2 to xrez-buyuk                                     
                              end-if
                           else
                             move 1 to xrez-buyuk                                                                                          
                           end-if

                      
                           evaluate xrez-buyuk
                           when 1
                               if link-toplu-grup-coc-adi1(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi1(rami) not = spaces
                                     move link-toplu-grup-coc-adi1(rami) to adi2
                                     move link-toplu-grup-coc-soyadi1(rami) to soy2
                                     move 1 to xrez-kucuk
                                     display l-adi2 l-soy2
                               end-if 
                               if link-toplu-grup-coc-adi2(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi2(rami) not = spaces
                                     move link-toplu-grup-coc-adi2(rami) to adi3
                                     move link-toplu-grup-coc-soyadi2(rami) to soy3
                                     move 2 to xrez-kucuk
                                     display l-adi3 l-soy3
                               end-if 
                               if link-toplu-grup-coc-adi3(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi3(rami) not = spaces
                                     move link-toplu-grup-coc-adi3(rami) to adi4
                                     move link-toplu-grup-coc-soyadi3(rami) to soy4
                                     move 3 to xrez-kucuk
                                     display l-adi4 l-soy4
                               end-if 
                           when 2
                               if link-toplu-grup-coc-adi1(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi1(rami) not = spaces
                                     move link-toplu-grup-coc-adi1(rami) to adi3
                                     move link-toplu-grup-coc-soyadi1(rami) to soy3
                                     move 1 to xrez-kucuk
                                     display l-adi3 l-soy3
                               end-if 
                               if link-toplu-grup-coc-adi2(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi2(rami) not = spaces
                                     move link-toplu-grup-coc-adi2(rami) to adi4
                                     move link-toplu-grup-coc-soyadi2(rami) to soy4
                                     move 2 to xrez-kucuk
                                     display l-adi4 l-soy4
                               end-if 
                               if link-toplu-grup-coc-adi3(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi3(rami) not = spaces
                                     move link-toplu-grup-coc-adi3(rami) to adi5
                                     move link-toplu-grup-coc-soyadi3(rami) to soy5
                                     move 3 to xrez-kucuk
                                     display l-adi5 l-soy5
                               end-if                             
                           when 3
                               if link-toplu-grup-coc-adi1(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi1(rami) not = spaces
                                     move link-toplu-grup-coc-adi1(rami) to adi4
                                     move link-toplu-grup-coc-soyadi1(rami) to soy4
                                     move 1 to xrez-kucuk
                                     display l-adi4 l-soy4
                               end-if 
                               if link-toplu-grup-coc-adi2(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi2(rami) not = spaces
                                     move link-toplu-grup-coc-adi2(rami) to adi5
                                     move link-toplu-grup-coc-soyadi2(rami) to soy5
                                     move 2 to xrez-kucuk
                                     display l-adi5 l-soy5
                               end-if 
                               if link-toplu-grup-coc-adi3(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi3(rami) not = spaces
                                     move link-toplu-grup-coc-adi3(rami) to adi6
                                     move link-toplu-grup-coc-soyadi3(rami) to soy6
                                     move 3 to xrez-kucuk
                                     display l-adi6 l-soy6
                               end-if                             
                            
                           when 4
                               if link-toplu-grup-coc-adi1(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi1(rami) not = spaces
                                     move link-toplu-grup-coc-adi1(rami) to adi5
                                     move link-toplu-grup-coc-soyadi1(rami) to soy5
                                     move 1 to xrez-kucuk
                                     display l-adi5 l-soy5
                               end-if 
                               if link-toplu-grup-coc-adi2(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi2(rami) not = spaces
                                     move link-toplu-grup-coc-adi2(rami) to adi6
                                     move link-toplu-grup-coc-soyadi2(rami) to soy6
                                     move 2 to xrez-kucuk
                                     display l-adi6 l-soy6
                               end-if 
                               if link-toplu-grup-coc-adi3(rami) not = spaces or
                                  link-toplu-grup-coc-soyadi3(rami) not = spaces
                                     move link-toplu-grup-coc-adi3(rami) to adi7
                                     move link-toplu-grup-coc-soyadi3(rami) to soy7
                                     move 3 to xrez-kucuk
                                     display l-adi7 l-soy7
                               end-if                                  
                           end-evaluate 
                       

                           if cinpara-kartsiz-pos = 1 then 
                              move xrez-no(2:) to xREZ-EXTRA-KART
                              display accept-not2a
                           end-if
                           move 2  to key-status
                           perform exception-procedure
                           perform yuzde-update 
                           display accept-adi accept-soyadi

                          if link-share-yok not = 1 
                            if link-toplu-grup-adi2(rami) not = spaces or  
                               link-toplu-grup-soy2(rami) not = spaces
                            
                                     add 1  to siradaki-rez-no
                                     move 0 to xrez-buyuk xrez-fiyati
                                     move  link-toplu-grup-adi2(rami) to xrez-adi 
                                     move  link-toplu-grup-soy2(rami) to xrez-soyadi
                                       move siradaki-rez-no to xrez-no  accept-rez-no
                                       display accept-rezno
                                       if cinpara-kartsiz-pos = 1 then 
                                                move xrez-no(2:) to xREZ-EXTRA-KART
                                               display accept-not2a
                                           end-if
                                          move 2 to key-status
                                         perform  exception-procedure
                                          perform  yuzde-update 
                                             display accept-adi accept-soyadi
                                   if link-toplu-grup-adi3(rami) not = spaces or  link-toplu-grup-soy3(rami) not = spaces 
                                        add 1 to  siradaki-rez-no
                                         move  link-toplu-grup-adi3(rami) to xrez-adi 
                                         move  link-toplu-grup-soy3(rami) to xrez-soyadi
                                          move 0 to xrez-buyuk xrez-fiyati
                                          move siradaki-rez-no to xrez-no   accept-rez-no
                                          display accept-rezno
                                          move 2 to key-status
                                           if cinpara-kartsiz-pos = 1 then 
                                              move xrez-no(2:) to xREZ-EXTRA-KART
                                              display accept-not2a
                                           end-if     
                                              perform  exception-procedure
                                              perform  yuzde-update 
                                              display accept-adi accept-soyadi
                                          if link-toplu-grup-adi4(rami) not = spaces or  link-toplu-grup-soy4(rami) not = spaces 
                                                add 1 to  siradaki-rez-no
                                                 move  link-toplu-grup-adi4(rami) to xrez-adi 
                                                 move  link-toplu-grup-soy4(rami) to xrez-soyadi
                                                  move 0 to xrez-buyuk xrez-fiyati
                                                  move siradaki-rez-no to xrez-no   accept-rez-no
                                                  display accept-rezno
                                                  move 2 to key-status
                                                   if cinpara-kartsiz-pos = 1 then 
                                                      move xrez-no(2:) to xREZ-EXTRA-KART
                                                      display accept-not2a
                                                   end-if     
                                                      perform  exception-procedure
                                                      perform  yuzde-update 
                                                      display accept-adi accept-soyadi

                                          end-if
                                   end-if
                            end-if
                            end-if
                  end-if
           end-perform           
           .
*
 yuzde-update.       
         compute  yuzde rounded = 
         (siradaki-rez-no - sifir-rez-no ) / toplu-rez-adet * 100
**         move 50 to yuzde
         move yuzde to EYUZDE.
             modify Form1-Fr-2a, FILL-PERCENT = YUZDE,
                    TITLE = YUZDELE-BASLIK.     
*
 yeni-share-al-toplu.
           open i-o genelfis
           initialize genelfis-rec 
           move 2     to genelfis-anahtar
           read genelfis no lock invalid
                display message box "Genel Parametre Tanimsiz..."
                                title "[ Uyari ]"
                                icon 1
                    close genelfis
                exit paragraph
           not invalid
               add 1                 to share-no
               rewrite genelfis-rec end-rewrite 
           end-read 
           close genelfis
           move share-no to xrez-sharenum .
*
 yanrez-oku. 
   
        initialize yanrez-rec  
          adi2 soy2 d-tar2
          adi3 soy3 d-tar3 
          adi4 soy4 d-tar4
          adi5 soy5 d-tar5 
          adi6 soy6 d-tar6 
          adi7 soy7 d-tar7
          adi8 soy8 d-tar8
          adi9 soy9 d-tar9
          mis-no ps1 pno2 ps2 pno3 ps3 pno4 ps4 pno5 
          ps5 pno6 ps6 pno7 ps7 pno8 ps8 pno9 ps9
        open input yanrez
        move rez-no to yanrez-rezno
        start yanrez key > yanrez-anah
         invalid
            continue
         not invalid 
           perform until fs-yanrez = "10"
              read yanrez next no lock
                 end 
                   move "10" to fs-yanrez
                 not end
                   if yanrez-rezno not = rez-no
                      move "10" to fs-yanrez
                      else
                      evaluate yanrez-sirano
                         when 1
                           move yanrez-profil-no to mis-no
                           move yanrez-profil-sirket to ps1
                           move yanrez-dog-tar       to d-tar1
                           display acc-ps1 acc-mis-no
                           
                         when 2
                           move yanrez-adi      to  adi2
                           move yanrez-soyadi   to  soy2
                           move yanrez-dog-tar  to  d-tar2 
                           move yanrez-profil-no to pno2
                           move yanrez-profil-sirket to ps2

                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi2 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi2
                                   
                
                                   initialize sifreli-text
                                  move soy2 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy2
                                end-if   

                           display acc-ps2 acc-pno2
                         when 3
                           move yanrez-adi      to  adi3
                           move yanrez-soyadi   to  soy3
                           move yanrez-dog-tar  to  d-tar3 
                           move yanrez-profil-no to pno3
                           move yanrez-profil-sirket to ps3
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi3 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi3
                                
                
                                   initialize sifreli-text
                                  move soy3 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy3
                                 end-if  

                           display acc-ps3 acc-pno3
                         when 4
                           move yanrez-adi      to  adi4
                           move yanrez-soyadi   to  soy4
                           move yanrez-dog-tar  to  d-tar4 
                           move yanrez-profil-no to pno4
                           move yanrez-profil-sirket to ps4
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi4 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi4
                               
                
                                   initialize sifreli-text
                                  move soy4 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy4
                                end-if

                           display acc-ps4 acc-pno4
                         when 5
                           move yanrez-adi      to  adi5
                           move yanrez-soyadi   to  soy5
                           move yanrez-dog-tar  to  d-tar5 
                           move yanrez-profil-no to pno5
                           move yanrez-profil-sirket to ps5
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi5 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi5
                             
                
                                   initialize sifreli-text
                                  move soy5 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy5
                                 end-if 

                           display acc-ps5 acc-pno5
                         when 6
                           move yanrez-adi      to  adi6
                           move yanrez-soyadi   to  soy6
                           move yanrez-dog-tar  to  d-tar6 
                           move yanrez-profil-no to pno6
                           move yanrez-profil-sirket to ps6
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi6 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi6
                               
                
                                   initialize sifreli-text
                                  move soy6 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy6
                                end-if  

                           display acc-ps6 acc-pno6
                         when 7
                           move yanrez-adi      to  adi7
                           move yanrez-soyadi   to  soy7
                           move yanrez-dog-tar  to  d-tar7 
                           move yanrez-profil-no to pno7
                           move yanrez-profil-sirket to ps7
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi7 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi7
                             
                
                                   initialize sifreli-text
                                  move soy7 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy7
                                end-if

                           display acc-ps7 acc-pno7
                         when 8
                           move yanrez-adi      to  adi8
                           move yanrez-soyadi   to  soy8
                           move yanrez-dog-tar  to  d-tar8 
                           move yanrez-profil-no to pno8
                           move yanrez-profil-sirket to ps8
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi8 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi8
                                
                
                                   initialize sifreli-text
                                  move soy8 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy8
                                 end-if 

                           display acc-ps8 acc-pno8
                         when 9
                           move yanrez-adi      to  adi9
                           move yanrez-soyadi   to  soy9
                           move yanrez-dog-tar  to  d-tar9 
                           move yanrez-profil-no to pno9
                           move yanrez-profil-sirket to ps9
                                 if sifre-devrede = 1
                                  initialize sifreli-text
                                  move adi9 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to adi9
                                
                
                                   initialize sifreli-text
                                  move soy9 to sifreli-text
                                  perform sifreleme-yap
                                  move sifreli-text to soy9
                                end-if  

                           display acc-ps9 acc-pno9

                     end-evaluate
                   end-if


              end-read
           end-perform
        end-start.
        close yanrez.
*
 rez-oku.
     modify lb-on-odeme-var,visible = false
     move accept-rez-no to xrez-no rez-no
     initialize eski-oda-konum
     read rez no lock invalid 
          initialize rez-rec xrez-rec  yan-deg rezek-rec
          initialize rezek-rezidance
          move accept-rez-no to xrez-no rez-no   rezek-no
          initialize cocuklar
          move "Y" to rez-yeni-eski
          modify tab-1 value = 1 
          move 1 to Form1-Ta-1-Value
          display tab-1
          perform tab-1-Ev-Cmd-Tabchanged
          perform rez-parametre-ata
          perform default-ata
          move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
          move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu 
                               oda-konumu-combo-value fiyat-konumu-combo-value
          accept xrez-al-tar from century-date
              
          if cinpara-kartsiz-pos = 1 then 
             move rez-no(2:) to xREZ-EXTRA-KART
             display accept-not2a
          end-if
     not invalid 
         move "E" to rez-yeni-eski
         initialize rezek-rec
         move rez-oda-konumu to eski-oda-konum
         move rez-no to rezek-no 
         open i-o rezek
             read rezek no lock invalid
                continue
             end-read
         close rezek

      initialize sifre-devrede  
      
     if genel2-kvkk-perdeleme-yil > 0 
        
         open input kllnc
        initialize kllnc-rec
        move k-kodu-tasi to k-kodu
        read kllnc no lock invalid
           continue 
        not invalid 
            if k-kvkk-yetki = "K"
               move tarih-tasi to gercek-tarih-tasi
               compute s1 = function INTEGER-OF-DATE(gercek-tarih-tasi) - genel2-kvkk-perdeleme-yil 
               compute s2 = function DATE-of-integer(s1)
               move rez-cik-tar to xrez-cik-tar
               if xrez-cik-tar < s2
               move rez-adi to xrez-adi
               move rez-soyadi to xrez-soyadi
               move rez-telefon-no to xrez-telefon-no

                  initialize sifreli-text
                  move xrez-adi to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xrez-adi

                  initialize sifreli-text
                  move xrez-soyadi to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xrez-soyadi
         
                  initialize sifreli-text
                  move xrez-telefon-no to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xrez-telefon-no
                  move 1 to sifre-devrede

               end-if 
            end-if 
        end-read 
       close kllnc
     end-if 



         perform yanrez-oku
         perform konuk-kontrol
         move rez-rec to xrez-rec

         move rez-kv-tipi to yedek-kv-tipi
         move rez-acenta to yedek-acenta-kodu
        
         move rez-cocuklar to cocuklar

      initialize sifre-devrede  
      
     if genel2-kvkk-perdeleme-yil > 0 
        
         open input kllnc
        initialize kllnc-rec
        move k-kodu-tasi to k-kodu
        read kllnc no lock invalid
           continue 
        not invalid 
            if k-kvkk-yetki  = "K"
               move tarih-tasi to gercek-tarih-tasi
               compute s1 = function INTEGER-OF-DATE(gercek-tarih-tasi) - genel2-kvkk-perdeleme-yil 
               compute s2 = function DATE-of-integer(s1)
               move rez-cik-tar to xrez-cik-tar
               if xrez-cik-tar < s2
               move rez-adi to xrez-adi
               move rez-soyadi to xrez-soyadi
               move rez-telefon-no to xrez-telefon-no

                  initialize sifreli-text
                  move xrez-adi to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xrez-adi

                  initialize sifreli-text
                  move xrez-soyadi to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xrez-soyadi
         
                  initialize sifreli-text
                  move xrez-telefon-no to sifreli-text
                  perform sifreleme-yap
                  move sifreli-text to xrez-telefon-no
                  move 1 to sifre-devrede

               end-if 
            end-if 
        end-read 
       close kllnc
     end-if 



         if xrez-grup-no > 0
            open input gruplar
            initialize gruplar-rec 
            move xrez-grup-no to gruplar-kodu
            read gruplar no lock invalid 
                 continue 
            not invalid 
                move gruplar-adi  to xrez-grup-adi 
            end-read
            close gruplar
         else
            initialize xrez-grup-adi
         end-if 
         if xrez-onodeme-var = 1
            perform onodeme-kontrol
         end-if
          
          if xrez-onodeme-var = 1
            modify lb-on-odeme-var,visible = true 
         end-if 
         if xrez-al-tar  < "10000000" then 
           move rez-isl-tar to rez-al-tar  xrez-al-tar
         end-if  
 
         if rez-sejour-entegre = 1
            modify lb-sej,visible = true
         end-if 
     end-read.
     move rez-odano to ydk-odano
     perform okunan-goster.

     if eski-rez 
        move rez-durumu       to srez-durumu 
        move rez-tipi         to srez-tipi 
        move rez-acenta       to srez-acenta 
        move rez-oda-konumu   to srez-oda-konumu 
        move rez-fiyat-konumu to srez-fiyat-konumu 
        move rez-s-d-t-g      to srez-s-d-t-g 
        move rez-k-g-b        to srez-k-g-b 
        move rez-anlasma      to srez-anlasma 
        move rez-pan-tipi     to srez-pan-tipi
        move rez-odano        to srez-odano 
        move rez-gir-tar      to srez-gir-tar 
        move rez-cik-tar      to srez-cik-tar 
        move rez-kisi         to srez-kisi 
        move rez-fiyati       to srez-fiyati
        move rez-on-odeme     to srez-on-odeme 
        move rez-on-doviz     to srez-on-doviz 
        move rez-bilbord-eh   to srez-bilbord-eh

*        modify acc-mis-no, visible = true
*        modify form1-la-1aaab visible = true
*        move rez-profil-sirket   to ps1
*        move rez-profil-no to mis-no
*        display acc-mis-no acc-ps1

     end-if.
******>Silinmis rezervasyon uzerinde oynama yapilamasin!!!! 
******>Iptal geri alinabilsin..........................!!!! 
     if eski-rez  and rez-durumu = "S" 
        initialize Mesaj-degiskenler
        move " [ Silinmis Rezervasyon ] " to mmesaj-title
        move " Bu Rezervasyon Uzerinde Degisiklik " to mmesaj-1 
        move " Yapamazsiniz.............      !!! " to mmesaj-2 
        move 1           to mmesaj-type
        move 3           to mmesaj-icon
        move 1           to mmesaj-default
          perform mmesaj-ver
        if xrez-cik-tar not < calisma-tarihi          
           initialize mesaj-degiskenler
           move " [ Rezervasyonu Geri Al ] " to mmesaj-title
           move " SILINMIS REZERVASYON GORUNTULENECEKTIR EMINMISINIZ ? " to mmesaj-1
           move " ..... [ E->Geri Al  H->Iptal ]  ...... " to mmesaj-2 
           move 2           to mmesaj-type
           move 2           to mmesaj-icon
           move 2           to mmesaj-default
           perform mmesaj-ver
           if donus-kodu = 1 
               continue 
               modify lb-sil,visible = 1
               modify sil-rez-geri-al,visible = 1
               modify button-kaydet-cikma,visible = 0
               modify button-kaydet,visible = 0
               modify button-sil,visible = 0           
               modify button-cogalt,visible = 0
               modify button-cogalta,visible = 0
               modify mesaj-buttonb,visible = 0
*/*              perform silinen-rez-geri-al
           else
               initialize rez-rec xrez-rec  yan-deg
               move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
               move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                                    oda-konumu-combo-value fiyat-konumu-combo-value
               perform gun-bul
               perform form-update
               move 4    to accept-control
               move 1002 to control-id
           end-if
        else 
           move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
           move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                                oda-konumu-combo-value fiyat-konumu-combo-value
           perform gun-bul
           perform form-update
           move 4    to accept-control
*           move 1002 to control-id       | firat silme 11/09/2020   silinmis rezervasyonlar geri almada bug a sebep oluyordu..
           move 1004 to control-id        | firat ekleme 11/09/2020
           modify lb-sil,visible = 1
         
           if genel-rez-sil-kontrol  = 1
              modify sil-rez-geri-al,visible = 0
           else
              modify sil-rez-geri-al,visible = 1
           end-if 

           modify button-kaydet-cikma,visible = 0
           modify button-kaydet,visible = 0
           modify button-sil,visible = 0           
           modify button-cogalt,visible = 0
           modify button-cogalta,visible = 0
           modify mesaj-buttonb,visible = 0
        end-if
     end-if.
******>Silinmis rezervasyon uzerinde oynama yapilamasin!!!! 
 rez-oku-exit.
     exit.
 konuk-kontrol.
****>Herhangi bir sebeple C-in yapilmis folio kaybolursa 
****>rezervasyon kaydi silinebilsin diye konuldu........
      if eski-rez and rez-c-in = "E"
         open input konuk
         move rez-folio   to konuk-folio
         read konuk no lock invalid 
*             
           display message box "Rezervasyon Register Karti baglantisi Bozuk" new-line
                              "Lutfen Ctrl-T ye basip Bakim yapiniz"
         end-read
         close konuk
      end-if.
****>
*
 blok-kilit-ayar.
      initialize blok-tit
     if xrez-odano not = spaces
       move 1 to blok-vis 
      if xrez-blok-tip = 1 or 2 then
         initialize rezodablok-rec
          open i-o rezodablok
         open input kllnc
          move xrez-odano to rezodablok-odano
          move xrez-no to rezodablok-rezno
         read rezodablok no lock invalid continue
         end-read
         close rezodablok
         move rezodablok-tamblok-staf to k-kodu 
         read kllnc no lock invalid continue
         end-read
         close kllnc
         move k-adi to blok-tit(1:10)
         move rezodablok-tamblok-saat to  blok-tit(12:2)
         move ":" to  blok-tit(14:1)
          move rezodablok-tamblok-dakika to  blok-tit(15:2)
          move "KILIT KALDIR " to blok-tit(19:)
          if k-kodu-tasi =  rezodablok-tamblok-staf or k1-blok-acar = 1 then 
           move "KILIT KALDIR    " to blok-tit(19:)
            move 1 to blok-en
            else
             move "KILITLI BLOKAJ  " to blok-tit(19:)
            move 0 to blok-en
          end-if
          move 0 to oda-en
            move 1 to blok-vis
          else
           if   k1-blok-kitler = 1 then 
                move "             BLOKAJ KITLE       " to blok-tit(1:)
                move 1 to blok-en
                move 1 to blok-vis
            else
             move "            BLOKAJ KITLE               " to blok-tit(1:)
             move 0 to blok-en
             move 0 to blok-vis
          end-if


          
           move 1 to oda-en
      end-if
      else
        move 0 to blok-vis
        move 1 to oda-en
     end-if 
     display a-blok accept-odano  
     perform xrez-oda-uzat
     .
*
*
 a-blok-Link.
      if xrez-blok-tip = 1 or 2 then
      initialize rezodablok-rec
         open i-o rezodablok 
          move xrez-odano to rezodablok-odano
          move xrez-no to rezodablok-rezno
         read rezodablok no lock invalid continue
         end-read
         accept  rezodablok-boztar from century-date
           
           accept rezodablok-boztar-zaman from time
            
           move k-kodu-tasi to  rezodablok-boz-staf    rezodablok-staf 
          rewrite rezodablok-rec invalid write rezodablok-rec end-rewrite

          close rezodablok
       
          move 0 to xrez-blok-tip 
       
          
          else
           move 1 to xrez-blok-tip 
              open i-o rezodablok 
          move xrez-odano to rezodablok-odano
          move xrez-no to rezodablok-rezno
         read rezodablok no lock invalid continue
         end-read
         accept  rezodablok-tamblok-tar from century-date
           
           accept rezodablok-tamblok-zaman from time
            
           move k-kodu-tasi to  rezodablok-tamblok-staf rezodablok-staf   
          rewrite rezodablok-rec invalid write rezodablok-rec end-rewrite

          close rezodablok

          
         
      end-if
       perform blok-kilit-ayar




     
     .
*
 share-edilebilir-mi.
  
     move 1 to share-en
     if genel-paylas-oda = 1
         if xrez-paylas-oda = 1
            move 1 to share-en
          else
           move 0 to share-en
        end-if
        else
        move 1 to share-en
     end-if
     display mesaj-buttonb
     .
*
 onay-kontrol.
      modify f-onay,
            reset-grid = 1
       open i-o onay
        move "ONAYLAR" to  f-1
                    modify f-onay,record-to-add(f-rec)
                    move 1 to onay-no
       initialize onay-rec
       set REZ-TARIH-ONAY to true
       move xrez-no to  ONAY-ANAHTAR
       start onay key >= onay-id invalid continue
           not invalid 
           perform until fs-onay = "10"
             read onay next no lock end move "10" to fs-onay
                not end 
                 if (not rez-tarih-onay ) or function numval(onay-anahtar) not =  xrez-no
                  move "10" to fs-onay
                  exit perform 
                  else
                    add 1 to  onay-no
                     move ONAY-VERI-yeni(1:4)   to e-y(1)     move ONAY-VERI-yeni(5:2)    to e-a(1)       move ONAY-VERI-yeni(7:2)    to e-g(1) 
                     move ONAY-VERI-yeni(9:4)   to e-y(2)     move ONAY-VERI-yeni(13:2)    to e-a(2)      move ONAY-VERI-yeni(15:2)    to e-g(2) 
                                     string
                                          e-otar(1) delimited by size
                                          " - " delimited by size
                                          e-otar(2) delimited by size     
                                          into  f-1
                    modify f-onay, record-to-add(f-rec)
                    modify f-onay(onay-no, 2) hidden-data = ONAY-rec 
                    modify f-onay(onay-no, 1) hidden-data = ONAY-ID 
                    evaluate true
                           
                          when  ONAY-VERILDI 
                             move 152 to o-renk
                          when       ONAY-IPTAL 
                             move 176 to o-renk
                          when       onay-uygulandi 
                              move 80  to o-renk
                          when other
                            move 0 to o-renk
                    end-evaluate
                    if o-renk > 0
                     modify  f-onay(onay-no,1) row-color = o-renk
                    end-if
                     move 1 to vis-fo
                    
                 end-if  
              end-read 
              end-perform 
        end-start

       close onay.

*
 okunan-goster.
       move 0 to vis-fo
     if genel-onay = 1 
       perform onay-kontrol
       
       display f-onay
     end-if
     move xrez-gir-tar to eskiilktar
     move xrez-cik-tar to eskisontar

     if  xrez-sharenum > 0
       
      open input arez
      initialize arez-rec
      move xrez-sharenum to arez-sharenum
      move "I" to arez-durumu
      start arez key >=   aREZ-anah-share invalid continue
          not invalid 
          perform until fs-arez = "10"
             read arez next no lock end move "10" to fs-arez
                not end
              if  xrez-sharenum = arez-sharenum
                 and  "I" = arez-durumu
                 if  xrez-no not = arez-no
                        move 1 to ashare-var
                    else
                    continue
                 end-if 
                 else
                 move "10" to fs-arez
              end-if
           end-read
          end-perform
      end-start


      close arez
      end-if
                   
            if xrez-call-center not = spaces
               modify accept-ccenter,enabled = false 
            else
               modify accept-ccenter,enabled = true
            end-if

     display lb-on-odeme-vara
     move xrez-tipi to rez-tipi-combo-value
     perform blok-kilit-ayar
     modify rez-tipi-combo, 
            value = rez-tipi-combo-value
            mass-update = 0.
     display accept-rezno
     move xrez-k-g-b to rez-kgb-combo-value
     modify rez-kgb-combo, 
            value = rez-kgb-combo-value
            mass-update = 0.
     if xrez-vip = spaces move "N" to xrez-vip


     end-if
     move xrez-vip to rez-vip-combo-value
     modify rez-vip-combo, 
            value = rez-vip-combo-value
            mass-update = 0.
     open input konum 
     initialize konum-rec
     move xrez-oda-konumu to oda-konumu-combo-value
                             konum-anahtar
    read konum no lock invalid 
    initialize oda-konumu-combo-value
    move konum-anahtar     to oda-konumu-combo-value
    move "->"              to oda-konumu-combo-value(3:)
    move "Hata"            to oda-konumu-combo-value(5:)
    modify oda-konumu-combo,
            item-to-add(oda-konumu-combo-value)
     end-read 
*****>Fiyat konumu icin oku
     move xrez-fiyat-konumu to fiyat-konumu-combo-value
                               konum-anahtar
    read konum no lock invalid 
    initialize fiyat-konumu-combo-value
    move konum-anahtar     to fiyat-konumu-combo-value
    move "->"              to fiyat-konumu-combo-value(3:)
    move "Hata"            to fiyat-konumu-combo-value(5:)
    modify fiyat-konumu-combo,
            item-to-add(fiyat-konumu-combo-value)
     end-read 
*****>Fiyat konumu icin oku
     close konum
     move xrez-buyuk to xrez-s-d-t-g
     if xrez-buyuk = 0 then 
        move  1 to  xrez-s-d-t-g
     end-if
      if xrez-buyuk > 4 then 
        move  4 to  xrez-s-d-t-g
     end-if
    evaluate true
         when xrez-s-d-t-g = "1" modify accept-odatipi-e value = "1->Single"
         when xrez-s-d-t-g = "2" modify accept-odatipi-e value = "2->Double"
         when xrez-s-d-t-g = "3" modify accept-odatipi-e value = "3->Triple"
         when xrez-s-d-t-g = "4" modify accept-odatipi-e value = "4->Group "
         when other              modify accept-odatipi-e value = "1->Single"
    end-evaluate
    if xrez-eb = "E"
       modify eraly-booking-cb, value = 1
    else
       modify eraly-booking-cb, value = 0
    end-if

    if xrez-aksiyon-eh = "H"
       modify aksiyon-cb, value = 1
    else
       modify aksiyon-cb, value = 0
    end-if

    if xrez-bilbord-eh = "E"
       modify bilbord-cb, value = 1
    else
       modify bilbord-cb, value = 0
    end-if

    if xrez-fiyat-fix = "E"
       modify fix-fiyat-cb, value = 1
    else
       modify fix-fiyat-cb, value = 0
    end-if

    if xrez-online-cin = 1
       modify online-cin-cb, value = 1
    else
       modify online-cin-cb, value = 0
    end-if

    evaluate true
         when xrez-kur-aygun = "G" move "1" to rb-degisken-1
         when xrez-kur-aygun = "A" move "2" to rb-degisken-1
         when other                move "1" to rb-degisken-1
    end-evaluate
     modify kur-tipi-rb-1, group-value = rb-degisken-1.

     open input kllnc
     initialize kllnc-rec
     move xrez-staf to k-kodu

     read kllnc no lock invalid 
          move all "*" to k-adi
     end-read 
     modify accept-k-adi value = k-adi

     modify accept-k-saat value = xrez-degis-saat
     modify accept-k-dakika value = xrez-degis-dakika

     initialize kllnc-rec
     move xrez-alan-staff to k-kodu
     read kllnc no lock invalid 
          move all " " to k-adi
     end-read 
     modify accept-k-adi-alan value = k-adi
     
     initialize kllnc-rec
     move xrez-conf-staff to k-kodu
     read kllnc no lock invalid 
          move all " " to k-adi
     end-read 
     modify accept-k-adi-conf value = k-adi  


     close kllnc

*************Formu Goster............
         perform gun-bul
         perform form-update
************Degerleri Oku
    

            perform acenta-oku   thru acenta-oku-exit
            perform sehir-oku   thru sehir-oku-exit
            perform firma-oku    thru firma-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
            perform ondoviz-oku  thru ondoviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform odatipi-goster
            perform odatipi-goster2
            perform odatipi-goster3
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            perform op-goster
            perform rehber-goster
            perform vip-goster
            perform vip-turu-goster
            perform ozel-after
            perform gel-yaz perform git-yaz
             
          if ONKPARA-REFERANS-VAR = 1 and   eski-rez and  xrez-acenta > spaces
                    perform refli-konum
           end-if
           perform share-edilebilir-mi
           display online-cin-cb
     .
*
 acc-rez-no-Bef-Procedure.
     initialize rez-rec xrez-rec aksiyon-var-yok.
*       inquire rez-tipi-combo, value in ilk-rez-tipi
*       move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
     initialize short-var-yok kayit-izni.
     perform bef-procedure.

 eraly-booking-cb-Ex-Cmd-Clicked.
        evaluate control-id
         when 1025
              inquire eraly-booking-cb, value in sayi
              if sayi = 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
        end-evaluate.
        if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-early-sabit = 1 and 
          acen-dft-early not = sayi
          display message box "Acenta icin Early booking degeri girilmis  " new-line
                              "Early Booking varsayilan degerine degistirildi"
                              title "Bilginize"
            modify eraly-booking-cb, value =  acen-dft-early
             inquire eraly-booking-cb, value in sayi
              if sayi = 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
        end-if.
     .
*
 fix-fiyat-cb-Ex-Cmd-Clicked.
        evaluate control-id
         when 220
              inquire fix-fiyat-cb, value in sayi
              if sayi = 1 move "E" to xrez-fiyat-fix
                 else     move "H" to xrez-fiyat-fix
              end-if
        end-evaluate.
        if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-fix-sabit = 1 and 
          acen-dft-fix not = sayi
          display message box "Acenta icin Fix Fiyat degeri girilmis  " new-line
                              "Fix Fiyat varsayilan degerine degistirildi"
                              title "Bilginize"
            modify fix-fiyat-cb, value =  acen-dft-fix
             
              if acen-dft-fix = 1 move "E" to xrez-fiyat-fix
                 else     move "H" to xrez-fiyat-fix
              end-if
        end-if.
*
 aksiyon-cb-Ex-Cmd-Clicked.
        evaluate control-id
         when 1040
              inquire aksiyon-cb, value in sayi
              if sayi = 1 move "H" to xrez-aksiyon-eh
                 else     move "E" to xrez-aksiyon-eh
              end-if
        end-evaluate.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-aksiyonyok-sabit = 1 and 
          acen-dft-aksiyon-yok not = sayi
          display message box "Acenta icin Aksiyon degeri girilmis  " new-line
                              "Aksiyon varsayilan degerine degistirildi"
                              title "Bilginize"
            modify aksiyon-cb, value =  acen-dft-aksiyon-yok
             
              if acen-dft-aksiyon-yok = 1 move "E" to xrez-aksiyon-eh
                 else                 move "H" to xrez-aksiyon-eh
              end-if
        end-if.
     .
*
 special-cb-Ex-Cmd-Clicked.
          inquire special-cb, value in sayi
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-specialyok-sabit = 1 and 
          acen-dft-special-yok not = sayi
          display message box "Acenta icin Special degeri girilmis  " new-line
                              "Aksiyon varsayilan degerine degistirildi"
                              title "Bilginize"
            modify special-cb, value =  acen-dft-special-yok
             
              
        end-if.
     .
*
 bilbord-cb-Ex-Cmd-Clicked.
    if key-status = 5464 
      evaluate control-id
      when 1043
        inquire bilbord-cb, value in sayi
        if sayi = 1 
           move "E" to xrez-bilbord-eh
        else     
           move "H" to xrez-bilbord-eh
        end-if
        if xrez-acenta = not-dos-anah(8:4) and
           acen-dft-bilboard-sabit = 1 and 
           acen-dft-bilboard not = sayi
           display message box 
                "Acenta icin Bilboard degeri girilmis  " new-line
                "Bilboard degeri varsayilan degerine degistirildi"
                    title "Bilginize"
           modify bilbord-cb, value =  acen-dft-bilboard
        
           if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                else     move "H" to xrez-bilbord-eh
           end-if
        end-if
      end-evaluate
     else 
       perform exception-procedure
     end-if.
*
 rez-tipi-combo-Aft-Procedure.
     inquire rez-tipi-combo, value in harf.
     move harf     to xrez-tipi.
*                                  
 bef-procedure.
    
     move control-value    to sonraki-kontrol
     move control-id       to sonraki-id
      perform kullandi.
*     display message box "o-k->" onceki-kontrol, new-line
*                         "S-k->" sonraki-kontrol, new-line
*                         "O-id->" onceki-id, new-line
*                         "S-Id->" sonraki-id, new-line
*                         "key-->" key-status new-line
*                         "gec-gecme-->" gec-gecme.
***>Onceki Kontrole gidebilsin ama sonrakine gidemesin....
     if gecmez
*        if sonraki-kontrol not = 1
*           if sonraki-kontrol > onceki-kontrol                            
*              move 4         to accept-control
*              move onceki-id to control-id
*              exit paragraph
*           end-if
*        end-if
          CONTINUE
     end-if  

     if genel-yas-zorunlu  = 1 and (control-id = 1031 or 1032 )
      move 0 to yas-kaydedildi
       perform acu-screen4-routine
      
       
      if yas-kaydedildi = 1 then
        display accept-kucuk accept-free  accept-buyuk
      end-if
      move 4 to accept-control
      move 10321 to control-id
          exit paragraph
     end-if
     evaluate control-id
       when 404
          move 1 to vis-acik
      
          move xrez-doviz to xREZ-ON-DOVIZ
          display accept-ondoviz
          perform ondoviz-oku
       when 1003
            modify button-acenara enabled = true
       when 1016
            modify button-bankaara enabled = true
       when 1017
            modify button-dovizara enabled = true
       when 1018
            modify button-pansiyonara enabled = true
       when 1019
            modify button-odemeara enabled = true
      when 1014
            perform anlasma-bul
       when 1020
            perform anlasma-bul
            modify button-anlasmaara enabled = true
       when 1021
            modify button-pazarara enabled = true
       when 1022
            modify button-ulkeara enabled = true
       when 1034
        if genel-uzun-oda-no-kullanilsin not = 1 
             modify button-odaara  enabled = true
         end-if   
       when 402
            modify button-ondovizara enabled = true
     end-evaluate.

     initialize mesaj.
     evaluate control-id
          when 1033 
*             initialize linkh-odahes
*             move 1 to linkh-nereden
*             move xrez-no to linkh-rez-no
*            
*             call "/asya/ytl/obj/otel/odahes.asy" 
*                        using linkh-odahes xrez-rec
*                        on exception 
*                        perform callerr-proc
*                        exit paragraph
*                        not on exception 
*                   cancel "/asya/ytl/obj/otel/odahes.asy"
*                   end-call
          when 1001
              evaluate true
                  when turkce
                       move "Rezervasyon Tipini Seciniz............" to mesaj
                  when almanca
                       move "Rezervasyon Tipini Seciniz............" to mesaj
                  when ingilizce
                       move "Rezervasyon Tipini Seciniz............" to mesaj
              end-evaluate
          when 1002
              evaluate true
                  when turkce
                       move "Rezervasyon No Giriniz Enter->Otomatik  F1->Eski Rez Ara" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1003
              evaluate true
                  when turkce
                       move "Acenta Kodunu  Giriniz  F1->Acenta Kodu Ara" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1004
          when 1005
          when 1006
              evaluate true
                  when turkce
                       move "Musteri Giris Tarihi" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1007
          when 1008
              evaluate true
                  when turkce
                       move "Musteri Giris Zamani" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1009
          when 1010
          when 1011
              evaluate true
                  when turkce
                       move "Musteri Cikis Tarihi  F1->Kalis Gunu Bul" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1012
          when 1013
              evaluate true
                  when turkce
                       move "Musteri Cikis Zamani" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj
     .

*
 Aft-Procedure.
      if musteriden-geldi = 1
         move 4    to accept-control
         move 1014 to control-id
         move 0  to musteriden-geldi
      end-if 
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
     initialize gec-gecme.
      evaluate control-id
       WHEN 49
            MOVE SOY2 TO ARANACAK-soyadi
            move adi2 to aranacak-adi
 
            move 2    to hangi-profil
            perform profil-goster

       when 63
           MOVE SOY3 TO ARANACAK-soyadi
           move adi3 to aranacak-adi
 
            move 3    to hangi-profil
            perform profil-goster  
       when 66
           MOVE SOY4 TO ARANACAK-soyadi
           move adi4 to aranacak-adi
 
            move 4    to hangi-profil
            perform profil-goster  
       when 76
           MOVE SOY5 TO ARANACAK-soyadi
           move adi5 to aranacak-adi
 
            move 5    to hangi-profil
            perform profil-goster
       when 92
           MOVE SOY6 TO ARANACAK-soyadi
           move adi6 to aranacak-adi
 
            move 6    to hangi-profil
            perform profil-goster
       when 98
           MOVE SOY7 TO ARANACAK-soyadi
           move adi7 to aranacak-adi
 
            move 7    to hangi-profil
            perform profil-goster
       when 187
           MOVE SOY8 TO ARANACAK-soyadi
           move adi8 to aranacak-adi
 
            move 8    to hangi-profil
            perform profil-goster
       when 279
           MOVE SOY9 TO ARANACAK-soyadi
           move adi9 to aranacak-adi
 
            move 9    to hangi-profil
            perform profil-goster
       when 290
            perform sehir-oku thru sehir-oku-exit
       when 1001
              inquire rez-tipi-combo, value in ilk-rez-tipi
              move ilk-rez-tipi to xrez-tipi ilk-rez-tipi rez-tipi-combo-value
*            modify rez-tipi-combo, 
*              value = "1"
*              mass-update = 0
              move 4 to accept-control
              move 1002 to control-id
       when 999
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xrez-al-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move " Girdiginiz Tarih Tanimsiz....... "  to mmesaj-1
              move " Tekrar Deneyiniz................ "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xrez-al-tar > calisma-tarihi and yeni-rez
***********************************            and yeni-rez
              
              initialize mesaj-degiskenler
              move " [ Yanlis Olabilecek Tarih ] " to mmesaj-title
              move " Ileri  Tarih Belirtiniz.. "  to mmesaj-1
              move " Kontrol Ediniz.................... "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               
            end-if
            
       when 1002
            if key-status = 52
               exit paragraph
            end-if 
           if accept-rez-no = 0
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                  
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis

           end-if
               modify lb-sil,visible = 0        
               modify sil-rez-geri-al,visible = 0
               modify button-kaydet-cikma,visible = 1
               modify button-kaydet,visible = 1
               modify button-sil,visible = 1
               modify button-cogalt,visible = 1
               modify button-cogalta,visible = 1
               modify mesaj-buttonb,visible = 1

             perform rez-oku  thru rez-oku-exit
             initialize gec-gecme
             perform anlasma-bul
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if
       when 1223
            perform tacenta-oku 
       when 84
            perform rehber-goster
       when 173 
            perform vip-goster 
       when 250
            perform vip-turu-goster
       when 191
         perform   gel-yaz
        
       when 195
         perform git-yaz
         
       when 1999
            perform firma-oku
            if firma-rate not = spaces 
               if xrez-acenta  = spaces 
                      if rez-yeni-eski = "Y" then
                           if xrez-firma not = spaces
                              perform firma-dft-yukle
                            end-if
                      end-if
                   move firma-rate to xrez-acenta
                   display accept-acenta
                   else
                    display message box "Default Rate Koduna Uymamaktasiniz"

                end-if
                else
                 if gecmez
                    continue  

                 else
                     if rez-yeni-eski = "Y" then
                           if xrez-firma not = spaces
                              perform firma-dft-yukle
                            end-if
                      end-if
                 end-if 
               
            end-if
             if xrez-no > 0  then
                if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
              move 1 to link-nereden 
              move "F"     to  link-not-islem
              move "REZ"   to  link-NOT-DOS    
              open input acenta
              move xrez-acenta  to link-not-dos-anah acenta-kodu  
              read acenta no lock invalid continue
                not invalid 
                   if acenta-rate-acenta > spaces
                      move   acenta-rate-acenta to  link-not-dos-anah
                  end-if
              end-read
              close acenta
              move xrez-gir-tar to link-not-dos-anah(5:8)  
              move xrez-cik-tar to link-not-dos-anah(13:8)  
              move xrez-firma  to  link-not-dos-anah(22:8)  
              move 1 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                        using link-not
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/mesajgir.asy"
                   end-call
                move  link-not-donus  to  toplam-not
               display not-ac
               move xrez-acen-anah to son-not-d
             end-if
           end-if
             
       when 1003
            if key-status = 52
               exit paragraph
            end-if 
            modify button-acenara enabled = false
            initialize gec-gecme
            perform acenta-oku thru acenta-oku-exit
            if acen-kara-list = 1
               display message box "Secmis oldugunuz acenta kara listede.." new-line
                                   "Lutfen Farkli Bir Acenta Kodu Giriniz.."
                               title "Uyari"
                               icon 1
                exit paragraph 
            end-if 
            if gecmez
               move 4          to accept-control
               move 1003       to control-id
               exit paragraph
            end-if
            if rez-yeni-eski = "Y" then
             if xrez-firma = spaces
                perform acen-dft-yukle
             end-if
            end-if

            if yeni-rez then
                move acenta-kv-tipi to xrez-kv-tipi

                 else 
                if yedek-acenta-kodu <> xrez-acenta

                            move acenta-kv-tipi to xrez-kv-tipi
                 end-if

            end-if
           if xrez-no > 0 then
              if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
              move 1 to link-nereden 
              move "F"     to  link-not-islem
              move "REZ"   to  link-NOT-DOS    
              open input acenta
              move xrez-acenta  to link-not-dos-anah acenta-kodu  
              read acenta no lock invalid continue
                not invalid 
                   if acenta-rate-acenta > spaces
                      move   acenta-rate-acenta to  link-not-dos-anah
                  end-if
              end-read
              close acenta
              if ONKPARA-REFERANS-VAR = 1 
                initialize son-yuklenen-ref
                perform refli-konum
             end-if
             move xrez-gir-tar to link-not-dos-anah(5:8)  
             move xrez-cik-tar to link-not-dos-anah(13:8)
             move xrez-acenta  to link-not-dos-anah(22:8)
             move xrez-no      to link-dosya-aciklamasi
             move 1            to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                        using link-not
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/mesajgir.asy"
                   end-call
                   move  link-not-donus  to  toplam-not
                   display not-ac

               move xrez-acen-anah to son-not-d
            end-if 
         end-if
*******Giris Tarihi Kontrol......... 
       when 1006
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xrez-gir-tar to tarih
            perform takvim-oku thru takvim-oku-exit

            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move " Girdiginiz Tarih Tanimsiz....... "  to mmesaj-1
              move " Tekrar Deneyiniz................ "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xrez-gir-tar < calisma-tarihi 
              if k-kodu-tasi not = "ASYA" 
                   move 1 to gec-gecme
              end-if
***********************************            and yeni-rez
              move 1 to gec-gecme
              initialize mesaj-degiskenler
              move " [ Yanlis Tarih ] " to mmesaj-title
              move " Gecmis Tarihe Rezervasyon Girilemez.. "  to mmesaj-1
              move " Tarihi Degistirin.................... "  to mmesaj-2
              move 1           to mmesaj-type




              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if
            move gun-gun(takvim-gun-adi) to adi-goster
            modify lb-gel-gun-e title = adi-goster
            initialize adi-goster
*            if xrez-gel-saat = 0
*               move 12   to xrez-gel-saat
*               display accept-gir-saat
*            end-if 
*******Kalis Gunu Bul
       when 11009
            move 27 to key-status
            if kalis-gun not = 0
               perform kalis-bul thru kalis-bul-exit 
            end-if
*******Cogaltma Islemi
            
            
*******Cikis Tarihi Kontrol......... 
       when 31009
            move 27 to key-status
            
*******Cikis Tarihi Kontrol......... 
       when 1011
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xrez-cik-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move " Girdiginiz Tarih Tanimsiz....... "  to mmesaj-1
              move " Tekrar Deneyiniz................ "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xrez-cik-tar < xrez-gir-tar
              move 1 to gec-gecme
              initialize mesaj-degiskenler
              move " [ Yanlis Tarih ] " to mmesaj-title
              move " Cikis Tarihi Giris Tarihinden Kucuk Olamaz. "  to mmesaj-1
              move " Tarihi Degistirin.......................... "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if
            move gun-gun(takvim-gun-adi) to adi-goster
            modify lb-git-gun-e title = adi-goster
            initialize adi-goster
            perform gun-bul
            
            if xrez-no > 0 and ( son-not-d(5:8) not = xrez-gir-tar or 
                son-not-d(13:8) not = xrez-cik-tar )
            then
                          if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11
                   move 1 to link-nereden 
                   move "F"     to  link-not-islem
                   move "REZ"   to  link-NOT-DOS    
                    open input acenta
                      move xrez-acenta  to link-not-dos-anah acenta-kodu  
                      read acenta no lock invalid continue
                        not invalid 
                           if acenta-rate-acenta > spaces
                              move   acenta-rate-acenta to  link-not-dos-anah
                          end-if
                      end-read
                      close acenta
                   move xrez-gir-tar to link-NOT-DOS-ANAH(5:8)  
                   move xrez-cik-tar to link-NOT-DOS-ANAH(13:8) 
                   
                   move 1 to link-nereden 
                        call "/asya/ytl/obj/otel/mesajgir.asy" 
                             using link-not


                             on exception 
                             perform callerr-proc
                             exit paragraph
                             not on exception 
                             cancel "/asya/ytl/obj/otel/mesajgir.asy"
                        end-call
                     move  link-not-donus  to  toplam-not
                     display not-ac
                     move xrez-acen-anah to son-not-d
                end-if
         end-if

       when 1014
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
             if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 then 
             if rezpara-adi-bosgec = "H" and xrez-adi = spaces 
               move 1 to gec-gecme
               initialize mesaj-degiskenler
               move " [ Musteri-Adi Bos ] " to mmesaj-title
               move " Musterinin Adini Bos Gecmek Icin .......... "  to mmesaj-1
               move " Onburo Calisma Parametreleri Uygun Degil... "  to mmesaj-2
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver   
           
                    if gec-gecme = 1
                       move 1014   to control-id
                       move 4      to accept-control
                    end-if 

               exit paragraph
            end-if 
            end-if

       when 1015
              if link-var not = 5 and link-var not = 6 and link-var not = 7  and link-var not = 11 then 
               if genel-rezde-profil-gec not =  1
                   
                           modify tab-1, value = 4
                            move 4  to form1-ta-1-value
                            perform tab-1-Ev-Cmd-Tabchanged
                           
                   
            end-if
           
            move 1 to p1-vis            
            modify gd2,mass-update = 1
                       reset-grid = 1
            display gd2
                 move 1  to hangi-profil
                 perform profil-goster 
            move 0 to accept-control
            if key-status = 52
               exit paragraph
            end-if 

            initialize gec-gecme
            if xrez-soyadi = spaces
               if yeni-rez
                  move xrez-adi      to xrez-soyadi


                  display accept-soyadi 
               end-if
            end-if
               if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 then 
            if rezpara-soyadi-bosgec = "H" and xrez-soyadi = spaces 
               move 1 to gec-gecme
               initialize mesaj-degiskenler
               move " [ Musteri-Soyadi Bos ] " to mmesaj-title
               move " Musterinin Soyadini Bos Gecmek Icin........ "  to mmesaj-1
               move " Onburo Calisma Parametreleri Uygun Degil... "  to mmesaj-2
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               move 1 to gec-gecme
                    if gec-gecme = 1
                       move 1015   to control-id
                       move 4      to accept-control
                    end-if 
               exit paragraph
            end-if        
            end-if
 
**********>Eski Musteri ve Mukerrer Rezervasyon Kontrolu......
**********>KONTROLLER-1. 
            initialize key-status
*             if yeni-rez 
*                perform silinmis-rez-ara
*            end-if
            if rezpara-eskimus-ara = "E" 
*****               perform eskimus-ara  thru eskimus-ara-exit
        
                 move xrez-adi    to aranacak-adi
                 move xrez-soyadi to aranacak-soyadi
                          perform grara
            end-if

            if rezpara-mukerrer-ara = "E" and rezpara-isimden-ara 
               perform mukerrer-isimden thru mukerrer-isimden-exit
               if rezpara-mukerrer-gecsin = "H" 
                   move 1 to gec-gecme
                   exit paragraph
               end-if
            end-if
              open input karalist            
              move "M" to karalist-tipi 
              move xrez-adi    to karalist-adi 
              move xrez-soyadi to karalist-soyadi 
              read karalist no lock invalid 
                  continue
              not invalid 
                   display message box  karalist-adi " " karalist-soyadi " Misafir Kara Listede.." new-line
                                        "Aciklama : " KARALIST-ACK-1 new-line
                                        "Aciklama : " KARALIST-ACK-2 new-line
                                        "Islem iptal edildi."
                                   title "Uyari"
                                   icon 2
                   close karalist
                   move 1 to gec-gecme
                   exit paragraph
              end-read
            close karalist  
            end-if                    
       when 1016
            if key-status = 52
               exit paragraph
            end-if          
            modify button-bankaara enabled = false
            initialize gec-gecme
            perform banka-oku thru banka-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1017
            if key-status = 52
               exit paragraph
            end-if 
            modify button-dovizara enabled = false
            initialize gec-gecme
            perform doviz-oku thru doviz-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1018
          if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 then 
            if key-status = 52
               exit paragraph
            end-if 
            modify button-pansiyonara enabled = false
            initialize gec-gecme
            perform pansiyon-oku thru pansiyon-oku-exit
            if gecmez
               exit paragraph
            end-if 
**********>Kontrat kontrolu....Alotment Rezervasyonar icin...
**********>Aksiyon ve stop-sale kontrolu
**********>KONTROLLER-2. 
*            stop " "
            if xrez-tipi = 1 
               move "V" to kontrat-var-yok 
*               perform kontrat-kontrol-xiii
*               perform kontrat-kontrol  thru kontrat-kontrol-exit 
            end-if
            perform aksiyon2-kontrol  thru aksiyon2-kontrol-exit 
            perform aksiyon-kontrol   thru aksiyon-kontrol-exit
            end-if
       when 1019
              
            if key-status = 52
               exit paragraph
            end-if 
            modify button-odemeara enabled = false
            initialize gec-gecme
            perform odeme-oku thru odeme-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1020
            if key-status = 52
               exit paragraph
            end-if 
            modify button-anlasmaara enabled = false
            initialize gec-gecme
            perform anlasma-oku thru anlasma-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1021
            if key-status = 52
               exit paragraph
            end-if 
            modify button-pazarara enabled = false
            initialize gec-gecme
            perform pazar-oku thru pazar-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1022
            if key-status = 52
               exit paragraph
            end-if 
            modify button-ulkeara enabled = false
            initialize gec-gecme
            perform ulke-oku thru ulke-oku-exit
            if gecmez
               exit paragraph
            end-if 
        when 41
            if key-status = 52
               exit paragraph
            end-if 
            modify button-opara enabled = false
           
            perform op-goster
            
       when 1023
**********>Mukerrer Rezervasyon Kontrolu......Voucherden...
**********>KONTROLLER-3. 
             if ( link-var = 5 or link-var = 6 ) and link-var not = 7 and link-var not = 11 then 
                  exit paragraph
             end-if
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            if rezpara-mukerrer-ara = "E" and rezpara-voucherden-ara 
               if xrez-voucher not = spaces 
                 perform mukerrer-voucherden thru mukerrer-voucherden-exit 
                 perform mukerrer-voucherden-s thru mukerrer-voucherden-exit-s
               if rezpara-mukerrer-gecsin = "H"
                  move 1 to gec-gecme
                  exit paragraph
               end-if 
              end-if 
            end-if
             if xrez-voucher  = spaces   and genel-voucher-zorunlu = 1 
                  move 1 to gec-gecme
                   move 4 to accept-control
                  move  1023  to control-id
                  exit paragraph
                 

             end-if
             modify tab-1, value = 1
            move 1  to form1-ta-1-value
            perform tab-1-Ev-Cmd-Tabchanged 

       when 1024
            inquire rez-kgb-combo, value in xrez-k-g-b
       when 1026
       when 1027
            
            if rb-degisken-1 = "1"
               move "G" to xrez-kur-aygun 
            else 
               move "A" to xrez-kur-aygun 
            end-if
       when 1028
          
            inquire oda-konumu-combo, 
            value in buffer-mami
                move buffer-mami(1:2) to 
                xrez-oda-konumu
               open input konum 
               initialize konum-rec
               move xrez-oda-konumu to konum-anahtar
               read konum no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Oda Konumu Hatali ] " to mmesaj-title
                    move " Secmis Oldugunuz Oda Konumu Tanimsiz....... "  to mmesaj-1
                    move " Seciminizi Degistiriniz.................... "  to mmesaj-2
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver

                    close konum
                    move 1 to gec-gecme
                    exit paragraph
                    not invalid continue
               end-read 
               close konum
**********>Short Kontrol.......
**********>KONTROLLER-4. 
           |   if link-var not = 5 and link-var not = 6 and link-var not = 7 then 
           |       exit paragraph
           |   end-if
           | kaya artemis iin degistirildi uyari cikmiyor dieeee 07 06 2014
           if ( link-var = 5 or link-var = 6 ) and link-var not = 7 and link-var not = 11 then 
                  exit paragraph
           end-if

             
            if rezpara-short-uyari = "E" 
               perform short-kontrol  thru short-kontrol-exit 
               if short-var and rezpara-short-gecsin = "H"  
                  move 1 to gec-gecme
                  exit paragraph
               end-if
            end-if 
       when 1030
            if key-status = 52
               exit paragraph
            end-if 
             
            evaluate true 
              WHEN xrez-buyuk = 0
               move "1" to xrez-s-d-t-g 
                modify accept-odatipi-e value = "1->Single"
*                if rezpara-sifir-pax = 1 then 
*                        move "1" to xrez-s-d-t-g 
*                                      move "1" to xrez-s-d-t-g 
*                                        modify accept-odatipi-e value = "1->Single"
*                                      else
*                   display message box "Onburo calisma parametrelerinde " new-line
*                                      "Sifir pax a izin verilmemistir"
*                   move 1 to gec-gecme
*                  exit paragraph
*
*                end-if 
              when xrez-buyuk < 2 move "1" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "1->Single"
              when xrez-buyuk = 2 move "2" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "2->Double"
              when xrez-buyuk = 3 move "3" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "3->Triple"
              when xrez-buyuk > 3 move "4" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "4->Group "
            end-evaluate
**********>Kontenjan Kontrolu....
**********>KONTROLLER-5. 
            if link-var < 3
            if rezpara-kont-uyari = "E" and xrez-tipi = 1 
               perform kontenjan-kontrol  thru kontenjan-kontrol-exit 
               if kontj-yok and rezpara-kont-gecsin = "H" 
                  move 1 to gec-gecme
                  exit paragraph
               end-if, 
            end-if 
            end-if
       when 1033
            if key-status = 52
               exit paragraph
            end-if 
                    if k1-fiy-sup not = 1 
                             display message box "Fiyat Supervisor degilsiniz"  new-line 
                                         "fiyat hesaplamasi yapilmadi" title "   " 
                                         move REZ-FIYATI to xREZ-FIYATI
                                         display accept-fiyati
                         else
                           perform hes-gonder
                      end-if
            if genel-rezde-profil-gec not =  1
                    if xrez-buyuk + xrez-kucuk + xrez-free + xrez-bebek > 1 then 
                           modify tab-1, value = 4
                            move 4  to form1-ta-1-value
                            perform tab-1-Ev-Cmd-Tabchanged
                            move 48 to control-id
                            move 4 to accept-control
                    end-if
            end-if
       when 10321
            if genel-fiks-yok = 1   | delphin iin yapld...yanndakilere gemiyordu...
               if k-fix-fiyat-etkin = 0 or space    | firat 30/07/2020 delphine
                  if genel-rezde-profil-gec not =  1
                     if xrez-buyuk + xrez-kucuk + xrez-free + xrez-bebek > 1 then 
                        modify tab-1, value = 4
                        move 4  to form1-ta-1-value
                        perform tab-1-Ev-Cmd-Tabchanged
                        move 48 to control-id
                        move 4 to accept-control
                     end-if
                  end-if        
               end-if
            end-if
       when 311
       when 1034
          if genel-uzun-oda-no-kullanilsin = 1 
           perform xrez-oda-kisalt
           end-if
            if key-status = 52
               exit paragraph
            end-if 
            modify button-odaara  enabled = false
            initialize gec-gecme
            perform blok-kont2
       when 1042
            inquire fiyat-konumu-combo, 
                value in buffer-mami
                move buffer-mami(1:2) to 
                xrez-fiyat-konumu
               open input konum 
               initialize konum-rec
               move xrez-fiyat-konumu to konum-anahtar
               read konum no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Oda Konumu Hatali ] " to mmesaj-title
                    move " Secmis Oldugunuz Oda Konumu Tanimsiz....... "  to mmesaj-1
                    move " Seciminizi Degistiriniz.................... "  to mmesaj-2
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver

                    close konum
                    move 1 to gec-gecme
                    exit paragraph
                    not invalid continue
               end-read 
                 close konum
             
               if rez-yeni-eski = "Y" then 
                   move xrez-fiyat-konumu to xrez-oda-konumu
                  inquire fiyat-konumu-combo, 
                     value in oda-konumu-combo-value
                 display oda-konumu-combo
               end-if

             
       when 215
            inquire rez-vip-combo, value in xrez-vip
                if xrez-vip = spaces move "N" to xrez-vip rez-vip-combo-value
            end-if
       when 402
            if key-status = 52
               exit paragraph
            end-if 
            modify button-ondovizara enabled = false
            initialize gec-gecme
            perform ondoviz-oku thru ondoviz-oku-exit

            if gecmez
               exit paragraph
            end-if 

       when 404
            if key-status = 52
               exit paragraph
            end-if 
               move xrez-on-odeme   to odeme-z
               modify accept-odeme-tutar value = odeme-z
*            if xrez-on-doviz not = 0 or xrez-on-doviz not = spaces
               perform toplam-odeme-bul thru  toplam-odeme-bul-exit
*            end-if
     
*            if rezpara-detay-alsin = "H" 
*               move 4    to accept-control
*               move 1028 to control-id
*            end-if
       when 242
            move 4   to accept-control
            move 243 to control-id
       when 243
            move 4   to accept-control
            move 246 to control-id
      end-evaluate
*****yanrez karalist kontrol
      evaluate control-id
         when 49
         when 63
         when 66
         when 76
         when 92
         when 98
         when 187
         when 279
              move hangi-profil to klist-yan-kac
              perform yanrez-karalist-kontrol
      end-evaluate.
***************      

 silinen-ara.
     if xrez-voucher = spaces then exit paragraph
     end-if
         initialize rez-rec
         move "S" to rez-durumu
         move xrez-voucher to rez-voucher
         start rez key >= rez-vouc invalid continue
            not invalid
             perform until fs-rez = "10"
               read rez next no lock end move "10" to fs-rez
                  not end
                    if rez-voucher not = xrez-voucher 
                      move "10" to fs-rez
                      else
                       if rez-acenta = xrez-acenta and 
                          rez-gir-yil = xrez-gir-yil 
                             display message box  rez-no " nolu Silimis rezervazyon ile ayni voucher nolu rezervasyon girmektesiniz" 
                             title "DIKKAT"
 

                       end-if
                    end-if
               end-read
            end-perform
         end-start
        .

        .
*
 kontrat-kontrol-xiii.
      move isyeri-adres-tasi to krez-dosya-adres
                                kcast-dosya-adres
      open i-o kontrat krez kcast konum
      initialize takvim-rec konum-rez-top tum-rez-top     
      move xrez-gir-tar to takvim-anah              | rez gir tar ile takvim startlanr
      start takvim key not < takvim-anah invalid
            continue
      not invalid
      perform with test after until fs-takvim = "10"
      read takvim next no lock end move "10" to fs-takvim
      not at end 
          if takvim-anah > xrez-cik-tar
             exit perform 
          end-if
          initialize kontrat-rec kontenjan-bulundu 
                     konum-kontenjan-dolu otel-kontenjan-dolu   | rezervasyonun her gn iin kontrat ta kontenjan kontrol yaplr
          move xrez-acenta to kontrat-acenta
          start kontrat key not < kontrat-anah invalid
                continue
          not invalid
          perform with test after until fs-kontrat = "10"
          read kontrat next no lock end move "10" to fs-kontrat
          not at end
              if kontrat-acenta <> xrez-acenta
                 exit perform 
              end-if
              if takvim-anah not > kontrat-son-tarih and 
                 takvim-anah not < kontrat-ilk-tarih 

                 initialize kcast-rec 
                 move takvim-anah to kcast-tarih
                 start kcast key not < kcast-anah invalid
                       continue
                 not invalid
                 perform with test after until fs-kcast = "10"
                 read kcast next no lock end move "10" to fs-kcast
                 not at end
                     if takvim-anah <> kcast-tarih
                        exit perform 
                     end-if 
                     initialize krez-rec 
                     move kcast-rez-no to krez-no
                     read krez no lock invalid
                          exit perform cycle
                     not invalid
                         if krez-durumu <> "I" or
                            krez-k-g-b  <> "K" or
                            krez-cik-tar = takvim-anah or
                            krez-acenta <> kontrat-acenta 
                            exit perform cycle 
                         end-if
                         if kontrat-oda(kcast-oda-konumu) <> 0 and 9999
                            add 1 to konum-rez-top
                         end-if
                         if kontrat-oda(41) <> 0 and 9999
                            add 1 to tum-rez-top
                         end-if
                         if kontrat-oda(kcast-oda-konumu) = konum-rez-top  
                            move takvim-gun to dis-tak-gun
                            move takvim-ay  to dis-tak-ay
                            move takvim-yil to dis-tak-yil
                            initialize konum-rec 
                            move kcast-oda-konumu to konum-anahtar 
                            read konum no lock invalid
                                 continue
                            end-read
                            |||| her konum icin uyar veerdigi icin konuldu saliy. 20220121-lonicera
                            if konum-anahtar = xrez-oda-konumu
                                    display message box dis-takvim, " tarihinde " konum-adi," - Oda konumu " new-line
                                                        "kontenjan sinirini geciyor. Rezervasyon kaydedilmeyecektir.." new-line
                                                        "Lutfen kontrol ediniz.."
                            end-if
                            move 1 to konum-kontenjan-dolu               
                            close kontrat krez kcast konum
                            exit paragraph
                         else 
                            move 0 to konum-kontenjan-dolu
                         end-if
                         if kontrat-oda(41) = tum-rez-top
                            display message box "Otelin acentaya ait kontenjan siniri geciliyor." new-line 
                                                "Rezervasyon kaydedilmeyecektir. Lutfen kontrol ediniz.."
                            move 1 to otel-kontenjan-dolu               
                            close kontrat krez kcast konum
                            exit paragraph
                         else 
                            move 0 to otel-kontenjan-dolu
                         end-if
                     end-read
                 end-read 
                 end-perform 
                 end-start
              end-if
          end-read
          end-perform 
          end-start
      end-read
      end-perform 
      end-start
      close kontrat krez kcast konum.
*
 exception-procedure.
     perform kullandi.
     if link-var= 1 then
       if key-status = 19  then
          move 99999999 to link-rez-no
          set exit-pushed to true
          exit paragraph
       end-if
       if key-status = 15  then
          move 0 to link-rez-no
          set exit-pushed to true
          exit paragraph
       end-if       
     end-if
     if key-status = 7001
        perform rezervasyon-formu-ekle
     end-if
     if key-status = 7002
         perform rezervasyon-resim-goruntule
     end-if
     if key-status = 7003
         perform rezervasyon-form-sil
     end-if
      if key-status = 7 and k-kodu-tasi = "ASYA" 
         modify accept-foliono enabled = true
      end-if 

     if key-status = 4574
         perform reg-kart-yazdir
     end-if
     if key-status = 5478
        perform kur-tarihi-uygula
     end-if 
     if key-status = 3289
        perform kredi-karti-cagir
     end-if 
     if key-status = 3597

*        if genel-rez-sil-kontrol = 1 and rez-gir-tar < tarih-tasi
*                display message box "Silnen Rezervasyon Geri Alinamaz." 
*                        title "Uyari"
*                        icon 3
*                        exit paragraph 
*        end-if

        display message box "Silinen Rezervasyon Geri Alinacaktir."  new-line
                            "Eminmisiniz?"
                        title "Uyari"
                        icon 1
                        type 2
                        default 2
                        returning return-code 
        if return-code = 2
            exit paragraph 
        end-if 

                                
        perform silinen-rez-geri-al
        display message box "Rezervasyon Geri Alinmistir." new-line
                            "Lutfen Kontrol Ediniz."
                        title "Uyari"
                        icon 1
         modify lb-sil,visible = 0
         move 4    to accept-control
         move 1002 to control-id
     end-if 
     if key-status = 4558
           initialize link-onodeme-rez-no
           move xrez-no  to link-onodeme-rez-no
           initialize rez-rec
           move xrez-no  to rez-no
           read rez no lock invalid 
                display message box "On Odeme Yapabilmek icin Rezervasyonu Kaydetmeniz Gerekmektedir..."
                                title "Uyari"
                                icon 1
                move 1  to xrez-onodeme-var 
           not invalid 
             move 1   to rez-onodeme-var xrez-onodeme-var
           if GENEL-ONODEME-DOV-DERLE not = 1 
               
                 display message box "C/in Kuru Sabitlenecektir..." new-line
                                     "Eminmisiniz?"
                                 title "Uyari"
                                 icon 1
                                 type 2 
                                 default 1
                                 returning return-code 
*                 move 1 to return-code
                 if return-code = 1 |or 2   14/08/2020 likya world istek       | bende sacma oldugunu biliyorum abi ama muhammed abi sadece cz dedi 
                    if xrez-cin-kuru not > 0      | hayr cevabnda cek girisine ne gonderilecek mantgn bilmiyorum... 
                       open input kur
                       initialize kur-rec
                       move tarih-tasi     to kur-tarih
                       move rez-banka      to kur-banka
                       move rez-doviz      to kur-doviz
                       read kur no lock invalid 
                           display message box "Kur Bulunamadi.." new-line
                                               "C/in Kuru Sabitlenemedi.." new-line
                                               "Lutfen Kontrol Ediniz.."
                                           title "Uyari"
                                           icon 1
                       not invalid 
                           move doviz-alis   to xrez-cin-kuru    rez-cin-kuru 
                           move tarih-tasi   to xrez-cin-kur-tar rez-cin-kur-tar                       
                       end-read 
                       close kur
                       display accept-kur-gun accept-kur-ay accept-kur-yil accept-adia
                    else
                       continue | sacma oldugunu biliyorum (ramazan)
                    end-if 

                    accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                    accept rez-edit-zaman from time          |                           
                
                    rewrite rez-rec end-rewrite 
                    perform log-operation-rez
                    
                    if GENEL-ONODEME-DOV-DERLE not = 1 
                    display message box "Uygulanan Kur : " xrez-cin-kuru
                                    title "Uyari"
                                    icon 1
                     end-if
                 end-if
              end-if
           end-read 

           call "/asya/ytl/obj/otel/onodegir.asy" 
                        using  link-onodeme-rez-no
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                cancel "/asya/ytl/obj/otel/onodegir.asy"
           end-call
           perform onodeme-kontrol
                   
     end-if 
     if key-status = 4555
        if rez-dev-uye-no not = zeroes
           move  rez-dev-uye-no to link-uye-no 
           call "/asya/ytl/obj/otel/devmulk.asy" 
                        using  link-uye-no
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                cancel "/asya/ytl/obj/otel/devmulk.asy"
           end-call
        end-if  
     end-if 
     if key-status = 4559
        perform zarfdok-hazirla
     end-if 
     if key-status = 4560
           initialize link-ekgir-anah
           move  xrez-anah to link-ekgir-rezno 
           call "/asya/ytl/obj/otel/depekgir.asy" 
                        using  link-ekgir-anah
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                cancel "/asya/ytl/obj/otel/depekgir.asy"
           end-call       
     end-if 
      if key-status = 4556
        if xrez-folio > 0
           open i-o konuk 
             move xrez-no to rez-no
             read rez no lock invalid stop " " exit paragraph
             end-read
             move rez-folio to konuk-folio
             read konuk no lock invalid
                 initialize rez-folio rez-c-in

                  accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                  accept rez-edit-zaman from time          |                           
                
                 rewrite rez-rec invalid stop " " 
                 end-rewrite
                 not invalid 
                     if konuk-rez-no not = rez-no 
                        initialize rez-folio rez-c-in

                        accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                        accept rez-edit-zaman from time          |                           
                
                        rewrite rez-rec invalid stop " " 
                        end-rewrite
                       ELSE
                       MOVE "E" to rez-c-in

                       accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                       accept rez-edit-zaman from time          |                           
                
                        rewrite rez-rec invalid stop " " 
                        end-rewrite
                    end-if

             end-read
             CLOSE KONUK
           set exit-pushed to true
        end-if
     end-if 
     if key-status = 5555    or 
        key-status = 16
          if ((control-id = 1014 or
             control-id = 1015) and key-status = 16) or 
             control-id = 88
           move xrez-adi         to aranacak-adi  
           move xrez-soyadi      to aranacak-soyadi
           move mis-no           to bulunan-profil-no
           move ps1              to bulunan-profil-sirket
           move d-tar1           to aranacak-dogum-tarihi
           move 1 to yan-kac
           perform profil-cagir
        end-if
          if ((control-id = 48 or
             control-id = 49) and key-status = 16) or 
             control-id = 148
            move 2        to yan-kac
            move adi2     to aranacak-adi
            move soy2     to aranacak-soyadi 
            move pno2     to bulunan-profil-no
            move ps2      to bulunan-profil-sirket
            move d-tar2   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 64 or
             control-id = 63) and key-status = 16) or 
             control-id = 144
            move 3        to yan-kac
            move adi3     to aranacak-adi 
            move soy3     to aranacak-soyadi
            move pno3     to bulunan-profil-no
            move ps3      to bulunan-profil-sirket 
            move d-tar3   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 65 or
             control-id = 66) and key-status = 16) or 
             control-id = 146
            move 4        to yan-kac
            move adi4     to aranacak-adi 
            move soy4     to aranacak-soyadi 
            move pno4     to bulunan-profil-no
            move ps4      to bulunan-profil-sirket
            move d-tar4   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 80 or
             control-id = 76) and key-status = 16) or 
             control-id = 151
            move 5        to yan-kac
            move adi5     to aranacak-adi 
            move soy5     to aranacak-soyadi 
            move pno5     to bulunan-profil-no
            move ps5      to bulunan-profil-sirket
            move d-tar5   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 91 or
             control-id = 92) and key-status = 16) or 
             control-id = 153
            move 6        to yan-kac
            move adi6     to aranacak-adi 
            move soy6     to aranacak-soyadi
            move pno6     to bulunan-profil-no
            move ps6      to bulunan-profil-sirket 
            move d-tar6   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 97 or
             control-id = 98) and key-status = 16) or 
             control-id = 155
            move 7        to yan-kac
            move adi7     to aranacak-adi 
            move soy7     to aranacak-soyadi 
            move pno7     to bulunan-profil-no
            move ps7      to bulunan-profil-sirket
            move d-tar7   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if

          if ((control-id = 186 or
             control-id = 187) and key-status = 16) or 
             control-id = 276
            move 8        to yan-kac
            move adi8     to aranacak-adi 
            move soy8     to aranacak-soyadi 
            move pno8     to bulunan-profil-no
            move ps8      to bulunan-profil-sirket
            move d-tar8   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if
          if ((control-id = 278 or
             control-id = 279) and key-status = 16) or 
             control-id = 285
            move 9        to yan-kac
            move adi9     to aranacak-adi 
            move soy9     to aranacak-soyadi 
            move pno9     to bulunan-profil-no
            move ps9      to bulunan-profil-sirket
            move d-tar9   to aranacak-dogum-tarihi
            perform profil-cagir
         end-if

         if yan-kac > 1
              move yan-kac to klist-yan-kac
              perform yanrez-karalist-kontrol
         end-if
     end-if
     if key-status = 7 
       if xrez-folio = 0 then 
         perform share-form-cagir
       end-if
     end-if 
     if key-status = 1666666666
        initialize mis-cagir
        move mis-no to mis-no-cagir2
        move ps1 to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if 
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 1     to yan-kac
       if mis-kayit = 1 
            move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
            perform ortak-profil-yaz
       end-if
        
     end-if
     if key-status = 20
     
        if xrez-c-in = "E" then 
           initialize konuk-rec
           
           open input konuk
           move xrez-folio to konuk-folio
           read konuk no lock invalid
               

           display message box "Rezervasyon cin bakimi yapildi." new-line 
                   "Devam edersiniz Cin bayragi kaldiralacak" 
                   title "DIKKAT" 
           move xrez-no to rez-no
           read rez no lock invalid 
             continue
             not invalid 
                initialize rez-c-in rez-folio
                 move "4" to rez-gr-status

               accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
               accept rez-edit-zaman from time          |                           
               
               rewrite rez-rec  invalid continue end-rewrite
               perform log-operation-rez
             end-read
             not invalid 
            display message box "Rezervasyon cin kontrolu yapildi"   title "DIKKAT"   
           end-read
         close konuk


       end-if
     end-if
*     if key-status = 5
*        open i-o konuk 
*        move rez-folio to konuk-folio 
*         read konuk no lock invalid
*            display message box "Bulamadim"
*            not invalid
*              move rez-no to konuk-rez-no
*              rewrite konuk-rec
*          end-read
*          close konuk
*        if link-var= 1 then
*          move 99999999 to link-rez-no
*          set exit-pushed to true
*          exit paragraph
*       end-if
*     end-if


********* eger donuste yeniden okunmassan karisikliga sebeb olur 
********* ornek konukta deisiklik yapilip donuste rez kaydedilirse
********* saglam kafa ile test edilmesi lazim **** mami
**********************************************
     if key-status = 333 and def-anl-uyumsuz = 1
        perform uyumsuz-anlasma-bul
     end-if
     if key-status = 8
        if xrez-c-in not = "E" and xrez-folio not > 0
        if control-id = 1034 or 311 then 
        if control-id = 311  then 
          if genel-uzun-oda-no-kullanilsin = 1 
           perform xrez-oda-kisalt
           end-if end-if
            perform oda-ara2
        else
           continue
*         perform rez-soz-bas
        end-if
        end-if 
     end-if
     if key-status = 3131 and xrez-no > 0 
            if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
           move "U"     to  link-not-islem
           move "REZ"   to  link-not-dos    
           move xrez-anah to link-not-dos-anah  
           move 1 to link-nereden 
           string xrez-adi delimited by "  "
                  " " delimited by size
                  xrez-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
                  call "/asya/ytl/obj/otel/mesajgir.asy" 
                       using link-not
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/mesajgir.asy"
                  end-call
                  move  link-not-donus  to  toplam-not
                  display not-ac
                  move xrez-acen-anah to son-not-d
             exit paragraph 
       end-if 
     end-if
     if key-status = 4784 
        perform misafir-istek-giris
     end-if 
     if key-status = 3132 then
     if eski-rez then
     if xrez-no > 0 then
           
                  call "/asya/ytl/obj/otel/renkata.asy" 
                       using xrez-no
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/renkata.asy"
                  end-call           
     end-if
     
     else
         Display message box "Ancak kaydedilmis rezervasyona renk atayabilirsiniz" 
     end-if
     end-if
     if key-status = 3133 then
            initialize link-rout
             move xrez-no to rout-rez-no(1)
             MOVE xrez-gir-tar to routsec-gir-tar 
               
             string  xrez-no delimited by size
                     xrez-adi delimited by "   "
                     xrez-soyadi delimited by "  " 
             into rout-text
                  call "/asya/ytl/obj/otel/routsec.asy" 
                       using link-rout
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routsec.asy"
                  end-call
     end-if
     if  key-status = 3502 then
         perform acu-screen2-routine
     end-if


 
      if key-status = 3187 then                 
                  call "/asya/ytl/obj/otel/routkont.asy" 
                       using xrez-no  xrez-folio
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routkont.asy"
                  end-call
     end-if
      if key-status = 3188 then                
         initialize link-earsiv-odeme-bilgileri
         move "R"           to link-earsiv-odeme-nereden
         move xrez-al-tar   to link-earsiv-odeme-tarihi
         move xrez-no       to link-earsiv-odeme-anah
                  call "/asya/ytl/obj/otel/earsbil.asy" 
                       using link-earsiv-odeme-bilgileri
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/earsbil.asy"
                  end-call
     end-if

     if key-status = 3599 then
         open i-o rezweb
         initialize rezweb-rec
          move rez-no to rezweb-rezno 
          read rezweb no lock invalid 
                move 0 to web-var
                initialize rezweb-rec
          not invalid 
                move 1 to web-var
          end-read          
          close rezweb 
          perform acu-formweb1-routine
          move 4   to accept-control
          move 269 to control-id
     end-if
     if key-status = 14 and rez-folio > 0 then 
**************************> rezcin.asy
        initialize dokcagir-tasi
        set dokcagir-tasi-call-cin2    to true
        move rez-no                    to dokcagir-konuk-rez-no      
        move rez-folio                 to dokcagir-konuk-folio
        perform dokcagir-call
        move dokcagir-konuk-rez-no     to rez-no
        move dokcagir-konuk-folio      to rez-folio
        exit paragraph 
     end-if
     if key-status    = 5 and
        rezpara-trace = 1 and 
        rez-durumu    = "I"
*        if k1-fiy-sup not = 1 then 
*           display message box "Bu kullanici Fiyat Supervisor  degildir" title "Dikkat"
*        else
           call "/asya/ytl/obj/otel/cast2.asy" 
                using xrez-no xrez-plan xrez-dig-plan
                on exception 
                perform callerr-proc
                exit paragraph
                not on exception 
           cancel "/asya/ytl/obj/otel/cast2.asy"
           end-call
           move xrez-no to rez-no 
           read rez no lock invalid 
                continue
           not invalid
               if xrez-plan not = rez-plan or xrez-dig-plan  not = rez-dig-plan 
                  move xrez-plan to rez-plan
                  move xrez-dig-plan to rez-dig-plan 

                  accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                  accept rez-edit-zaman from time          |                           
                
                  rewrite rez-rec invalid 
                          continue 
                  not invalid 
                      if rez-folio > 0 then 
                         open i-o konuk
                         move rez-folio to konuk-folio
                         read konuk no lock invalid 
                              continue
                         not invalid
                             move xrez-plan to konuk-plan
                             move xrez-dig-plan to konuk-dig-plan 
                             rewrite konuk-rec invalid 
                                 continue 
                             end-rewrite
                                perform log-operation-konuk
                             close konuk
                         end-read
                      end-if
                  end-rewrite
                  perform log-operation-rez
                  display Form1-Pb-4
               end-if  
           end-read
*        end-if   
        exit paragraph 
     end-if
**************************************
     move control-id to gidis-id
     evaluate key-status
         when 17 
             move rez-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of rez-rec
             set link-logview-rec-size to size of rez-rec
             perform logview-call
             initialize key-status
         when 1 
            evaluate control-id
              when  1002
                    perform rez-ara      thru rez-ara-exit
              when  1003
                    modify button-acenara enabled = false
                    perform acenta-ara   thru acenta-ara-exit
              when 290
                    perform sehir-ara     thru sehir-ara-exit               
              when  1999
                    perform firma-ara   thru firma-ara-exit
              when  1223
                    perform tacenta-ara 
              when  1009
                    initialize kalis-gun
                    perform acu-form2-routine
                    exit paragraph
              when  1016
                    modify button-bankaara enabled = false
                    perform banka-ara    thru banka-ara-exit
              when  1017
                    modify button-dovizara enabled = false
                    perform doviz-ara    thru doviz-ara-exit
              when  1018
                    modify button-pansiyonara enabled = false
                    perform pansiyon-ara thru pansiyon-ara-exit
              when  41 
                    perform op-ara
              when  173 
                    perform vip-ara
              when 250
                    perform vip-turu-ara
              when 84
                    perform rehber-ara
              when  33
                    perform odatipi-ara
              when  26
                    perform odatipi-ara2
              when  29
                    perform odatipi-ara3
              when  28
                    perform kaynak1-ara
              when  167
                    perform kaynak2-ara
              when  169
                    perform kaynak3-ara

              when  1019
                    modify button-odemeara enabled = false
                    perform odeme-ara    thru odeme-ara-exit
              when  16

                    perform ozel-ara
              when  1020
                    modify button-anlasmaara enabled = false
                    perform anlasma-ara  thru anlasma-ara-exit
              when  1021
                    modify button-pazarara enabled = false
                    perform pazar-ara    thru pazar-ara-exit



              when  1022
                    modify button-ulkeara enabled = false
                    perform ulke-ara     thru ulke-ara-exit
              when 311
              when 1034
                 if  control-id = 311 perform xrez-oda-kisalt end-if
                    if xrez-c-in not = "E" and xrez-folio not > 0
                       modify button-odaara  enabled = false
                       perform oda-ara2
                       initialize key-status
                    else 
                       modify button-odaara  enabled = false
                       initialize key-status
                      
                    end-if 
              when  402
                    modify button-ondovizara enabled = false
                    perform ondoviz-ara  thru ondoviz-ara-exit
              when 1
                   if genel2-toplam-fiyat-aktif = 1
                      perform toplam-fiyat-gir
                   end-if
            end-evaluate
*         when 555586          
*           if k-kodu-tasi = "ASYA" or "X   " 
*           stop " "
*           move xrez-rec to rez-rec 
*           move 2015 to rez-isl-yil
*           rewrite rez-rec  invalid stop  " " end-rewrite
*           end-if
         when 2
         when 4412  
             perform dosya-kilit-kontrol
             if link-islkilit-durum <> spaces
               exit paragraph 
             end-if 

                   if k1-fiy-sup not = 1 
                             display message box "Fiyat Supervisor degilsiniz"  new-line 
                                         "fiyat hesaplamasi yapilmadi" title "   "
                             move REZ-FIYATI to xREZ-FIYATI
                             display accept-fiyati
                         else
                           perform hes-gonder
                      end-if
                 if xrez-sharenum < 0 then 
                  move 0 to xrez-sharenum
               end-if
               if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
                  if rez-para-profil-yok = 1
                    if mis-no = 0 and ps1 = spaces
                     display message box "Profil Baglantisi Yapilmadan Rezervasyon Kaydedilemez.."
                                     title "Uyari"
                                     icon 1
                        exit paragraph 
                    end-if 
                  end-if 
               end-if 
            if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
            if rezpara-mukerrer-ara = "E" and rezpara-tumunde-ara 
               perform mukerrer-isimden thru mukerrer-isimden-exit 
               if xrez-voucher not = spaces 
                  perform mukerrer-voucherden thru mukerrer-voucherden-exit 
                  perform mukerrer-voucherden-s thru mukerrer-voucherden-exit-s
              end-if

               if rezpara-mukerrer-gecsin = "H" 
                   move 1 to gec-gecme
                   exit paragraph
               end-if
            end-if
            end-if 
            
            initialize t-kisi girilen-kisi
            compute t-kisi = xrez-buyuk + xrez-kucuk + xrez-free + xrez-bebek
            
                 if adi2 not = spaces and soy2 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi3 not = spaces and soy3 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi4 not = spaces and soy4 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi5 not = spaces and soy5 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi6 not = spaces and soy6 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi7 not = spaces and soy7 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi8 not = spaces and soy8 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 if adi9 not = spaces and soy9 not = spaces
                    add 1 to girilen-kisi
                 end-if 
                 add 1 to girilen-kisi

               if girilen-kisi > t-kisi 
                if  t-kisi = 0 then 
                    if genel2-sifir-pax-izin-verme = 1 
                       display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                           "Girilen isim sayisi :" girilen-kisi new-line
                                           "0 Pax giris yaptiniz" new-line
                                           "Islem Iptal Edildi.."
                                     title "Uyari"
                                      icon 1
                       move 1 to gec-gecme
                       exit paragraph
                    else
                       display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                           "Girilen isim sayisi :" girilen-kisi  new-line
                                           "0 Pax giris yaptiniz"
                                     title "Uyari"
                                      icon 1
                    end-if
                else
                  display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                      "Girilen isim sayisi :" girilen-kisi  new-line
                                      "Fazla Sayida isim girisi yaptiniz.." new-line
                                      "Islem Iptal Edildi.."
                                  title "Uyari"
                                  icon 1
                   move 1 to gec-gecme
                   exit paragraph
                 end-if 
               end-if 
               if t-kisi > 9                                                      ||| firat ramazan abi istedi 24/08/2019
                  display message box "Rezervasyon Toplam Kisi Sayisi : " t-kisi new-line
                                      "Sisteme 9 dan fazla kisi girilememektedir." new-line
                                      "Islem Iptal Edildi.." new-line
                                      "Asya-Soft Ile Iletisime Geciniz.."
                                  title "Uyari"
                                  icon 1
                   move 1 to gec-gecme
                   exit paragraph
               end-if
               initialize onay-rec onay-bulundu  onay-uygulandi-yaz
               if xrez-dev-uye-no > 0  and genel-onay = 1 and xrez-tarlar not = eski-tarlar then
               open i-o onay
                    set REZ-TARIH-ONAY to true
                    move xrez-no       to ONAY-ANAHTAR
                    move  eski-tarlar  to ONAY-VERI-eski
                    move  xrez-tarlar  to ONAY-VERI-yeni
                  read onay no lock invalid continue
                    not invalid 
                    
                      move 1 to onay-bulundu
                    
                     
                  end-read
               close onay
                  
                  if onay-bulundu = 1
                    evaluate true
                      when ONAY-BEKLER 
                           move eski-tarlar to xrez-tarlar
                           display accept-cik-gun accept-cik-ay accept-cik-yil 
                             accept-gir-gun accept-gir-ay accept-gir-yil 
                          display message box  "Onay Bekleyen Degisiklik Talebi" new-line
                          "Rezervasyon Eski tarihlerine alinmistir" title "Onay"
                            
                      when  ONAY-VERILDI
                                move 1 to onay-uygulandi-yaz

                       when  ONAY-IPTAL 
                            move eski-tarlar to xrez-tarlar
                           display accept-cik-gun accept-cik-ay accept-cik-yil 
                             accept-gir-gun accept-gir-ay accept-gir-yil 

                        display message box  "Reddilmis  Onay Talebi " new-line
                                       "Rezervasyon Eski tarihlerine alinmistir"  title "Onay"
                       when  onay-uygulandi  
                           open i-o onay
                                     set onay-bekler to true
                                     move k-kodu-tasi to ONAY-IST-STAF
                                        accept ONAY-IST-TARIH from century-date 
                                        accept ONAY-IST-zaman  from time
                                        
                                    rewrite onay-rec invalid 
                                          continue end-rewrite
                                close onay
                                 move eski-tarlar to xrez-tarlar
                           display accept-cik-gun accept-cik-ay accept-cik-yil 
                             accept-gir-gun accept-gir-ay accept-gir-yil 
                                display message box  "Uygulanan Onay yeniden aktif edildi" new-line
                                       "Rezervasyon Eski tarihlerine alinmistir"  title "Onay"
                      end-evaluate         



                  else
            

                   display message box "Devremulk Rezervasyonunda Tarih degisikligi  "  new-line
                                      "yapmaktassiniz. Rezervasyon eski tarih uzerinden kaydedilecek "  new-line
                                      "Tarih degisikligi yetkili personel tarafindan onaylandiktan sonra " new-line
                                      "Tekrar kaydetmeniz gerekecektir. Onay talebi yapilsin mi?"
                                  title "Uyari"
                                  icon 1 type 2 giving onay-sonuc
                          if onay-sonuc = 2 
                            display message box "Rezervasyon Kaydedilmedi" title "Dikkat"  
                              exit paragraph

                          end-if
                       if onay-sonuc = 1 
                            
                            
                            open i-o onay   open input  devremulk musteri
                        initialize onay-rec devremulk-rec
                        set  REZ-TARIH-ONAY to true
                         move xrez-no to  ONAY-ANAHTAR
                         move  eski-tarlar to  ONAY-VERI-eski
                         move xrez-tarlar to  ONAY-VERI-yeni
                         set  ONAY-BEKLER to true
                       
                          move xrez-dev-uye-no to devremulk-no
                         read devremulk no lock invalid 
                                 display message box "Devre mulk hissedari okunamadi"
              
                              end-read
             
                             
                               initialize musteri-rec
                              move  DEVREMULK-profil-sirket to   musteri-sirket   
                              move  DEVREMULK-profil-no     to     musteri-no 
                                read musteri no lock invalid 
                                   continue
                                end-read
                             |   move musteri-adi     to xrez-adi
                             |   move musteri-soyadi to  xrez-soyadi
                                 move eskiilktar(1:4)   to e-y(1)     move eskiilktar(5:2)    to e-a(1)      move eskiilktar(7:2)    to e-g(1) 
                                 move eskisontar(1:4)   to e-y(2)     move eskisontar(5:2)    to e-a(2)      move eskisontar(7:2)    to e-g(2) 
                                 move xrez-GIR-TAR(1:4) to e-y(3)     move xrez-GIR-TAR(5:2)  to e-a(3)      move xrez-GIR-TAR(7:2)  to e-g(3) 
                                 move xrez-cik-TAR(1:4) to e-y(4)     move xrez-cik-TAR(5:2)  to e-a(4)      move xrez-cik-TAR(7:2)  to e-g(4) 
                                 
                                  string  devremulk-no delimited by size
                                        "nolu "   delimited by size
                                         musteri-adi delimited by "   "
                                          " " delimited by size
                                         musteri-soyadi delimited by "   "
                                          new-line  delimited by size
                                          "ait devremulk rezervasyonu rezervasyon degisiklik talebi"  delimited by size
                                           new-line  delimited by size
                                          "Eski Tarihler"  delimited by size 
                                            new-line  delimited by size
                                          e-otar(1) delimited by size
                                          " - " delimited by size
                                          e-otar(2) delimited by size
                                           new-line  delimited by size
                                           "Talep Edilen Tarihler"  delimited by size
                                             new-line  delimited by size
                                          e-otar(3) delimited by size
                                          " - " delimited by size
                                          e-otar(4) delimited by size
                                          into onay-text
                                        move k-kodu-tasi to ONAY-IST-STAF
                                        accept ONAY-IST-TARIH from century-date 
                                        accept ONAY-IST-zaman  from time


                                       write onay-rec invalid display message box " Var olan talep degistirildi"
                                          rewrite onay-rec end-write
                                          display message box onay-text new-line 
                                              "Onay talebi girilmistir"
                                        close musteri onay devremulk
                                         move eski-tarlar to xrez-tarlar
                             display accept-cik-gun accept-cik-ay accept-cik-yil 
                             accept-gir-gun accept-gir-ay accept-gir-yil 
                          end-if
                      end-if
               end-if
*               stop " "
               perform kontrat-kontrol-xiii

*               if 1 = otel-kontenjan-dolu or konum-kontenjan-dolu 
*                  move 1 to gec-gecme
*                  exit paragraph
*               end-if

              open input kllnc
*              if k-kodu-tasi = "ASYA" stop " " end-if
              initialize kllnc-rec 
              move k-kodu-tasi to k-kodu
              read kllnc no lock invalid
                   continue
              not invalid
                  if k-ccenter-user = 1    
                     if k-ccenter-supervisor = 0 
                        display message box "Ccenter yetkilendirmesi ;" new-line
                                            "Supervisor olmayan kullanici kayit yapamaz.."
                        close kllnc 
                        exit paragraph
                     else
                        initialize rez-rec konuk-rec 
                        move xrez-no to rez-no
                        read rez no lock invalid 
                             continue 
                        not invalid
                            move xrez-not1 to rez-not1
                            move xrez-not2 to rez-not2

                            accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                            accept rez-edit-zaman from time          |                           
                
                            rewrite rez-rec end-rewrite 
                            perform log-operation-rez
                        end-read 
                        if rez-c-in = "E"
                           move rez-folio  to konuk-folio
                           read konuk no lock invalid 
                                continue 
                           not invalid
                               move xrez-not1 to konuk-acik-1
                               move xrez-not2 to konuk-acik-2
                           end-read 
         
                           rewrite konuk-rec end-rewrite 
                           perform log-operation-konuk
                         end-if

                         display message box "Ccenter yetkilendirmesi ;" new-line
                                             "Yalnizca notlar kaydedilmistir.."
                         close kllnc 
                         exit paragraph                        
                     end-if
                  end-if
              end-read 
              close kllnc 

               perform kaydet   thru kaydet-exit
          
               if link-var = 4 and 
                  link-gelen-rec(1:10) = "DEVRE-----"              
                    move dev-rez-no       to link-rez-no
                    perform destroy-window-proc
                    goback
               end-if 
         when 3
             perform dosya-kilit-kontrol
             if link-islkilit-durum <> spaces
               exit paragraph 
             end-if 
             if genel-onodeme-odano not = spaces
                if rez-onodeme-var = 1
                   perform on-odeme-folio-kontrol
                  if bakiye-bulundu = 1

                     display message box rez-no" 'Nolu Rezervasyonun On Odemesi Var." new-line
                                             son-konuk-ac  "nolu folioda " son-islem-ac " nolu islem de " new-line
                                             son-dep-ac "departmaninda " z-bakiye " bakiye var "
                                               "Odeme hareketlerini kontrol ettikten sonra silme islemine devam etmeniz onerilir."
                                    title "Uyari"
                                    icon 1
                     exit paragraph 
                  end-if 
                end-if
             end-if
             if rez-acenta-odeme-alindi = 1
                display message box "Acenta On Odemesi Alinmis Rezervasyon Silinemez...." new-line
                                    "Krediler Departmaniyla Iletisime Geciniz...."
                                title "Uyari"
                                icon 1
                   exit paragraph 
             end-if 
               perform rez-sil   thru rez-sil-exit                        
         when 4 
             perform dosya-kilit-kontrol
             if link-islkilit-durum <> spaces
               exit paragraph 
             end-if 
             perform cogalt
        when 8
            perform dosya-kilit-kontrol
             if link-islkilit-durum <> spaces
               exit paragraph 
             end-if 
            if control-id not = 1034 and  control-id not = 311 then
              
            move 1 to cogalt-adet
            perform acu-screen3-routine
            move cogalt-adet to z3
            display message box z3 " adet rezervasyon cogaltilacaktir. " new-line 
                "Emin misiniz? " title "Rezervasyon Cogalt" type 2 default 2 giving sonuc
                if sonuc = 1 
            perform varying ci from 1 by  1 until ci > cogalt-adet
             perform cogalt2
           end-perform
             call "w$keybuf" using 3 end-call
             display message box z3 " adet rezervasyon cogaltilmistir." title "Cogaltma "
              
            else
              display message box "Cogaltma Islemi Iptal edildi" title "Cogaltma "
            end-if
           end-if
        when 11
           perform kont-goster
        when 12 
            perform acu-grform-routine
           
               move 4 to accept-control
        when  other
*        display message box key-status
     end-evaluate.
*
 kontrol-bolumu. 
************=======> Bu Bolum Cesitli Kontrollar Icindir    <====***********    
 aksiyon2-kontrol. 
         open input aksiyhrk. 
         initialize special-varsa gun-sayi. 
 aksiyon2-basla. 
          move xrez-gir-tar to takvim-anah. 
          start takvim key not < takvim-anah invalid 
                close aksiyhrk 
                go aksiyon2-kontrol-exit. 
 aksiyon2-oku. 
         read takvim   next no lock end go ak2-bak. 
         if fs-takvim   = 99 go aksiyon2-oku. 
         if takvim-anah = xrez-cik-tar go ak2-bak. 
         if takvim-anah > xrez-cik-tar go ak2-bak. 
         add 1 to gun-sayi. 
         go aksiyon2-oku. 
 ak2-bak. 
         move "O"           to aksiyhrk-tipi.
         move xrez-acenta   to aksiyhrk-acenta. 
         move xrez-gir-tar  to aksiyhrk-tarih. 
         move xrez-pan-tipi to aksiyhrk-pan-tipi.
         move gun-sayi      to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
             close aksiyhrk go aksiyon2-kontrol-exit. 
            initialize mesaj-degiskenler
            if control-id = 1018
              move " [ Aksiyon Uyari] " to mmesaj-title
              move "Special Offera Tabii Acenta                       "  to mmesaj-1
              move "Geceleme..:"   to mmesaj-2(01:12)
              move aksiyhrk-gecele to mmesaj-2(12:02)
              move "Indirim(pp):"   to mmesaj-2(15:12)
              move aksiyhrk-ode(1:2)    to mmesaj-2(27:02)
              move "."                  to mmesaj-2(29:01)
              move aksiyhrk-ode(3:2)    to mmesaj-2(30:02)
              move 1           to mmesaj-type
              move 1           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
            end-if.
            move "V"  to special-var-yok. 
            move aksiyhrk-gecele   to special-gece.
            move aksiyhrk-hes-tipi to special-hes-tipi
            move aksiyhrk-ekle     to special-ekle
            move aksiyhrk-ode      to special-tahsil. 
            close      aksiyhrk. 
 aksiyon2-kontrol-exit. 
      exit. 

 aksiyon-kontrol. 
         if xrez-gir-tar = xrez-cik-tar then go aksiyon-kontrol-exit end-if
         open input aksiyhrk. 
         initialize aksiyon-varsa gun-sayi. 
 aksiyon-basla. 
          move xrez-gir-tar to takvim-anah. 
          start takvim key not < takvim-anah invalid 
                close aksiyhrk 
                go aksiyon-kontrol-exit. 
 aksiyon-oku. 
         read takvim   next no lock end go ak-bak. 
         if fs-takvim   = 99 go aksiyon-oku. 
         if takvim-anah = xrez-cik-tar go ak-bak. 
         if takvim-anah > xrez-cik-tar go ak-bak. 
         add 1 to gun-sayi. 
         go aksiyon-oku.
*
 git-yaz.
      if xrez-git-sirket not = spaces 
           open input isyeri
                  move xrez-git-sirket to isyeri-no
                  read isyeri no lock invalid
                    continue
                    not invalid
                    move ISYERI-UNVAN to git-sir-adi
                    display lb-git

                  end-read
         close isyeri 
         end-if.


*
 gel-yaz.
       if xrez-gel-sirket not = spaces 
          open input isyeri
                  move xrez-gel-sirket to isyeri-no
                  read isyeri no lock invalid
                    continue
                    not invalid
                    move ISYERI-UNVAN to gel-sir-adi
                    display lb-gel

                  end-read
         close isyeri
         end-if.
 ak-bak. 
         move "A"           to aksiyhrk-tipi.
         move xrez-acenta   to aksiyhrk-acenta. 
         move xrez-gir-tar  to aksiyhrk-tarih. 
         move xrez-pan-tipi to aksiyhrk-pan-tipi.
         move gun-sayi      to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
             close aksiyhrk go aksiyon-kontrol-exit. 
            initialize mesaj-degiskenler
            if control-id = 1018
              move " [ Aksiyon Uyari] " to mmesaj-title
              move "Aksiyona Tabi Acenta                       "  to mmesaj-1
              move "Geceleme..:"   to mmesaj-2(01:12)
              move aksiyhrk-gecele to mmesaj-2(12:02)
              move "Tahsil....:"   to mmesaj-2(15:12)
              move aksiyhrk-ode(1:2)    to mmesaj-2(26:02)
              move "."   to mmesaj-2(28:01)
            
              move aksiyhrk-ode(3:2)    to mmesaj-2(29:02)
              move 1           to mmesaj-type
              move 1           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
            end-if.
             
            if aksiyhrk-ebharic = 1 and (xrez-eb = "E") then 
               modify  aksiyon-cb  value = 1 
                 move "H" to xrez-aksiyon-eh
             else
            move "V"  to aksiyon-var-yok 
            move aksiyhrk-gecele   to ak-gece 
            move aksiyhrk-ode      to ak-tahsil 
            end-if
            close      aksiyhrk. 
 aksiyon-kontrol-exit. 
      exit. 

 stopsale-kontrol. 
      open input aksiyhrk grup.
 stopsale-oku. 
        move "Y" to stopsale-var-yok 
        initialize stopsale-bil-var.
        move xrez-gir-tar to takvim-anah
        start takvim key >= takvim-anah 
          invalid
          continue
           not invalid
         perform until fs-takvim = "10" or  stopsale-var-yok = "V"
          read takvim next no lock 
           end move "10" to fs-takvim
           not end 
           if takvim-anah >= xrez-cik-tar
             move "10" to fs-takvim
           else
             move "S"           to aksiyhrk-tipi
             move xrez-acenta   to aksiyhrk-acenta 
             move takvim-anah  to aksiyhrk-tarih 
             move xrez-fiyat-konumu to aksiyhrk-pan-tipi
             move 0             to aksiyhrk-gecele
             read aksiyhrk no lock invalid 
               continue
              not invalid
              move "V" to stopsale-var-yok
              if aksiyhrk-oto-bil-dus = 1 
              if xrez-al-tar  >=  aksiyhrk-rezal-tar1 and
                 xrez-al-tar   <= aksiyhrk-rezal-tar2
                   move 1 to stopsale-bil-var
               end-if 
              end-if 
              go stopsale-kontrol-exit
             end-read      

          initialize  aksiyhrk-pan-tipi
          read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              if aksiyhrk-oto-bil-dus = 1
              if xrez-al-tar  >=  aksiyhrk-rezal-tar1 and
                 xrez-al-tar   <= aksiyhrk-rezal-tar2
                   move 1 to stopsale-bil-var
               end-if 
              end-if 

              go stopsale-kontrol-exit
          end-read      

         initialize aksiyhrk-acenta
         read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              if aksiyhrk-oto-bil-dus = 1
              if xrez-al-tar  >=  aksiyhrk-rezal-tar1 and
                 xrez-al-tar   <= aksiyhrk-rezal-tar2
                   move 1 to stopsale-bil-var
               end-if 

              end-if 

              go stopsale-kontrol-exit
         end-read     
         move xrez-fiyat-konumu to aksiyhrk-pan-tipi
         read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              if aksiyhrk-oto-bil-dus = 1
              if xrez-al-tar  >=  aksiyhrk-rezal-tar1 and
                 xrez-al-tar   <= aksiyhrk-rezal-tar2
                   move 1 to stopsale-bil-var
               end-if 

              end-if 

              go stopsale-kontrol-exit
         end-read     
         initialize grup-rec
         move "A" to grup-tipi
         start grup key > grup-anah
           invalid
            continue
           not invalid
             perform until fs-grup = "10" 
              read grup next no lock 
                end move "10" to fs-grup
                not end
                 if grup-tipi not = "A" then
                     move "10" to fs-grup
                   else
                     if grup-alt = xrez-acenta 
                       
                        move grup-kodu to aksiyhrk-acenta
                        initialize  aksiyhrk-pan-tipi

                         read aksiyhrk no lock invalid 
                            continue
                         not invalid
                        
                        move "V" to stopsale-var-yok
                      if aksiyhrk-oto-bil-dus = 1
              if xrez-al-tar  >=  aksiyhrk-rezal-tar1 and
                 xrez-al-tar   <= aksiyhrk-rezal-tar2
                   move 1 to stopsale-bil-var
               end-if 
                
                      end-if 

                         exit perform 
                       end-read  
                        move xrez-fiyat-konumu to aksiyhrk-pan-tipi
                          read aksiyhrk no lock invalid 
                            continue
                         not invalid
                        
                        move "V" to stopsale-var-yok
                      if aksiyhrk-oto-bil-dus = 1
              if xrez-al-tar  >=  aksiyhrk-rezal-tar1 and
                 xrez-al-tar   <= aksiyhrk-rezal-tar2
                   move 1 to stopsale-bil-var
               end-if 

                      end-if 

                         exit perform 
                       end-read  
                     end-if
                 end-if
               end-read
             end-perform 
         end-start
         end-if
        end-read                      
        end-perform
        end-start.

 stopsale-kontrol-exit.
          if stopsale-var-yok = "V" then
            initialize mesaj-degiskenler
            move " [ Stop Sale Uyari] " to mmesaj-title
            move " Bu Acentaya Stop-Sale Cekilmis....... "  to mmesaj-1
            move " Bu Tarihlere Rezervasyon Girmeyin.... "  to mmesaj-2
            move 1           to mmesaj-type
            move 2           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            end-if
            close      aksiyhrk grup.  



*
 eskimus-ara. 
        move "I"          to rez-durumu. 
        move xrez-soyadi  to rez-soyadi. 
       start rez key not < rez-soy invalid 
             go eskimus-ara-exit. 
 eskimus-oku.
         read rez next no lock end go eskimus-ara-exit. 





         if fs-rez = 99 go eskimus-oku. 
         if rez-soyadi > xrez-soyadi go eskimus-ara-exit. 
         if rez-durumu not = "I" go eskimus-ara-exit. 

         if rez-soyadi = xrez-soyadi and rez-adi = xrez-adi 
            continue
         else 
         go eskimus-oku
         end-if. 
         if rez-no   =   xrez-no     go eskimus-oku. 
            initialize mesaj-degiskenler
            move " [ Eski Musteri Uyari ] " to mmesaj-title
            move "DAHA ONCE GELMIS...Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 1           to mmesaj-icon
            move 1           to mmesaj-default
            initialize donus-kodu
            perform mmesaj-ver
            if donus-kodu = 2 
               go eskimus-ara-exit
            end-if
         go eskimus-oku. 
 eskimus-ara-exit. 
     exit. 


 mukerrer-isimden. 
        move "I"          to rez-durumu. 
        move xrez-soyadi  to rez-soyadi. 
       start rez key not < rez-soy invalid 
             go mukerrer-isimden-exit. 
 mukerrer-isim-oku. 
         read rez next no lock end go mukerrer-isimden-exit. 
         if fs-rez = 99 go mukerrer-isim-oku. 
         if rez-soyadi > xrez-soyadi go mukerrer-isimden-exit. 
         if rez-durumu not = "I" go mukerrer-isimden-exit. 
         if rez-soyadi = xrez-soyadi and rez-adi = xrez-adi 
            and ( xrez-gir-tar < rez-cik-tar  and 
            xrez-cik-tar > rez-gir-tar )
          
            continue
         else 
            go mukerrer-isim-oku
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-isim-oku. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move "KONAKLAMA CAKISIYOR"                 to mmesaj-3. 
           
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-isimden-exit
            end-if
         go mukerrer-isim-oku. 
 mukerrer-isimden-exit. 
      exit. 

 mukerrer-voucherden. 
        move "I"          to rez-durumu. 
        move xrez-voucher to rez-voucher. 
       start rez key not < rez-vouc invalid go mukerrer-voucherden-exit. 
 mukerrer-vouc-oku. 
         read rez next no lock end go mukerrer-voucherden-exit. 
         if fs-rez = 99 go mukerrer-vouc-oku. 
         if rez-voucher > xrez-voucher go mukerrer-voucherden-exit. 
         if rez-durumu not = "I" go mukerrer-voucherden-exit. 
         if rez-voucher = xrez-voucher 
            continue
         else 
            go mukerrer-vouc-oku
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-vouc-oku. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-voucherden-exit
            end-if
         go mukerrer-vouc-oku. 
 mukerrer-voucherden-exit. 
      exit. 


 mukerrer-voucherden-s. 
        move "S"          to rez-durumu. 
        move xrez-voucher to rez-voucher. 
       start rez key not < rez-vouc invalid 
               go mukerrer-voucherden-exit-s. 
 mukerrer-vouc-oku-s. 
         read rez next no lock end go mukerrer-voucherden-exit-s. 
         if fs-rez = 99 go mukerrer-vouc-oku-s. 
         if rez-voucher > xrez-voucher go mukerrer-voucherden-exit-s. 
         if rez-durumu not = "S" go mukerrer-voucherden-exit-s. 
         if rez-voucher = xrez-voucher 
            continue
         else 
            go mukerrer-vouc-oku-s
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-vouc-oku-s. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move "[  SILINMIS REZERVASYON  !!! ]"  to mmesaj-3
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-voucherden-exit-s
            end-if
         go mukerrer-vouc-oku-s. 
 mukerrer-voucherden-exit-s. 
      exit. 
*
 short-kontrol.
        open input konum.
        initialize konum-rec short-1konum short-toplam ref-short-toplam ref-sat-haz-oda-top.
        move xrez-oda-konumu   to konum-anahtar.
        read konum no lock invalid 
             initialize konum-rec.
        close konum.
        move konum-ref to rez-konum-referansi
        move "Y" to short-var-yok.
        move xrez-gir-tar to takvim-anah.
        start takvim key not < takvim-anah invalid 
              go short-kontrol-bitti.
 short-oku.
         read takvim next no lock end go short-kontrol-bitti.
         if fs-takvim = 99 go short-oku.
         if takvim-anah = xrez-cik-tar  go short-kontrol-bitti.
         if takvim-anah > xrez-cik-tar  go short-kontrol-bitti.
            initialize short-1konum short-toplam 
         compute short-1konum =  1 +
                 takvim-sat-oda(xrez-oda-konumu) .
         compute short-toplam =  1  +
                 takvim-sat-oda(1)  + takvim-sat-oda(2)  +
                 takvim-sat-oda(3)  + takvim-sat-oda(4)  +
                 takvim-sat-oda(5)  + takvim-sat-oda(6)  +
                 takvim-sat-oda(7)  + takvim-sat-oda(8)  +
                 takvim-sat-oda(9)  + takvim-sat-oda(10) + 
                 takvim-sat-oda(11) + takvim-sat-oda(12) +
                 takvim-sat-oda(13) + takvim-sat-oda(14) +
                 takvim-sat-oda(15) + takvim-sat-oda(16) +
                 takvim-sat-oda(17) + takvim-sat-oda(18) +
                 takvim-sat-oda(19) + takvim-sat-oda(20) +
                 takvim-sat-oda(21) + takvim-sat-oda(22) +
                 takvim-sat-oda(23) + takvim-sat-oda(24) +
                 takvim-sat-oda(25) + takvim-sat-oda(26) +
                 takvim-sat-oda(27) + takvim-sat-oda(28) +
                 takvim-sat-oda(29) + takvim-sat-oda(30) + 
                 takvim-sat-oda(31) + takvim-sat-oda(32) +
                 takvim-sat-oda(33) + takvim-sat-oda(34) +
                 takvim-sat-oda(35) + takvim-sat-oda(36) +
                 takvim-sat-oda(37) + takvim-sat-oda(38) +
                 takvim-sat-oda(39) + takvim-sat-oda(40)
                 
         if onkpara-referans-var = 1                            |alba iin yapld otel ref shortta ise gerisi muhim degil uyar versin.
            if onkpara-referans-nerden = 1
               perform referans-short-hesapla
               if ref-short-toplam not < ref-sat-haz-oda-top
                  perform referans-shortta
                       go short-kontrol-bitti 
               end-if
               initialize ref-short-toplam ref-sat-haz-oda-top
               if short-1konum > konum-hazir-oda  
                  perform 1konum-shortta
                       go short-kontrol-bitti
               end-if
               go short-oku 
            end-if
         else
            if short-toplam > takvim-hazir-oda 
               perform toplam-shortta
                    go short-kontrol-bitti
            end-if
            if short-1konum > konum-hazir-oda  
               perform 1konum-shortta
                    go short-kontrol-bitti
            end-if
            go short-oku
         end-if
         .
*
 short-kontrol-bitti.
     exit.
 short-kontrol-exit.
    exit.

*
 referans-short-hesapla.
    move isyeri-adres-tasi to konum13-dosya-adres
                               cast13-dosya-adres
                                rez13-dosya-adres
                            
    open input konum13 cast13 rez13
    perform varying i from 1 by 1 until i > 40
        initialize konum13-rec cast13-rec
        move i to konum13-anahtar 
        read konum13 no lock invalid
             exit perform
        end-read

        if konum13-ref <> rez-konum-referansi
           exit perform cycle
        end-if

        compute ref-sat-haz-oda-top = ref-sat-haz-oda-top + konum13-hazir-oda 
    end-perform

    move takvim-anah to cast13-tarih
    start cast13 key not < cast13-anah invalid
          continue
    not invalid
    perform with test after until fs-cast13 = "10"
    read cast13 next no lock end move "10" to fs-cast13
    not at end
        if takvim-anah <> cast13-tarih
           exit perform
        end-if
        initialize rez13-rec 
        move cast13-rez-no to rez13-no
        read rez13 no lock invalid
             exit perform cycle
        not invalid
            if rez13-durumu <> "I" 
               exit perform cycle 
            end-if
            if rez13-k-g-b  <> "K" 
               exit perform cycle 
            end-if
            if rez13-cik-tar = takvim-anah
               exit perform cycle 
            end-if
        end-read
        
        initialize konum13-rec 
        move rez13-oda-konumu to konum13-anahtar
        read konum13 no lock invalid
             exit perform cycle 
        not invalid
            if konum13-ref <> rez-konum-referansi
               exit perform cycle
            end-if
        end-read

        add 1 to ref-short-toplam

    end-read
    end-perform 
    end-start
    close konum13 cast13 rez13
        .                            
*
 1konum-shortta.   
***        perform acu-form4-routine
*       exit paragraph  
       |add 1 to sonraki-id
       |move sonraki-id to control-id
       |move 4 to accept-control
       |move "V" to short-var-yok.
           
       initialize mesaj-degiskenler
       move " [ Oda Konumunuz Short'ta ] " to mmesaj-title
       move "Bu Tarihte"                           to mmesaj-1(01:10)
       move konum-adi(01:10)                       to mmesaj-1(12:10)
       move "Oda Shortta"                          to mmesaj-1(23:11)
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move konum-hazir-oda  to mmesaj-2(22:04)
       move short-1konum     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 toplam-shortta.
*****       perform acu-form4-routine
*        exit paragraph

       |////18082018 dokumerde kaydettikten sonra bir sonraki rezervasyona gemedii iin kapatld
       |add 1 to sonraki-id
       |      move sonraki-id to control-id
       |move 4 to accept-control
       |move "V" to short-var-yok.
       |//////
       
       
       initialize mesaj-degiskenler
       move " [ Tum Konumlar Short'ta ] " to mmesaj-title
       move "Bu Tarihte OTEL Short'ta"     to mmesaj-1
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)
       
       move takvim-hazir-oda to mmesaj-2(22:04)
       move short-toplam     to mmesaj-2(32:04)
       
       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
        .
*
 referans-shortta.
*****       perform acu-form4-routine
*        exit paragraph
      | add 1 to sonraki-id
      |       move sonraki-id to control-id
      | move 4 to accept-control
      | move "V" to short-var-yok.
       
       initialize mesaj-degiskenler
       move " [ Referans Short'ta ] " to mmesaj-title
       move "Bu Tarihte Oteliniz Short'ta"     to mmesaj-1
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)
       
       move ref-sat-haz-oda-top  to mmesaj-2(22:04)
       move ref-short-toplam     to mmesaj-2(32:04)
       
       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
        .
*
 kontenjan-kontrol. 
        open  input acenhrk bilbord. 
        move "V" to kontj-var-yok. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah 
              invalid go kontenjan-kontrol-bitti. 
 kontj-oku. 
         read takvim next no lock end 
              go kontenjan-kontrol-bitti. 
         if fs-takvim = 99 go kontj-oku. 
         if takvim-anah = xrez-cik-tar 
            go kontenjan-kontrol-bitti
         end-if. 
         if takvim-anah > xrez-cik-tar 
            go kontenjan-kontrol-bitti
         end-if. 
         initialize acenhrk-rec grid-geldi. 
*****         move xrez-acenta       to acenhrk-acenta bilbord-acenta. 
         move ac-bilb           to bilbord-acenta
         move ac-kont           to acenhrk-acenta
         move takvim-anah       to acenhrk-tarih bilbord-tarih. 
         move rezpara-kont-tipi to acenhrk-s-d-t-g. 
         if rezpara-kont-tipi = 0 
            move xrez-s-d-t-g   to acenhrk-s-d-t-g
         end-if. 
         move xrez-fiyat-konumu   to acenhrk-oda-konumu bilbord-oda-tip. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda
            perform kontenjani-dolu
            move 1 to grid-geldi
               go kontenjan-kontrol-bitti
         end-if
         end-read.
         read bilbord no lock invalid 
           continue   
         not invalid
         if bilbord-oda <= bilbord-sat-oda 
            perform kontenjani-dolu
            move 1 to grid-geldi
               go kontenjan-kontrol-bitti
         end-if
         end-read.
         move 1 to bilbord-oda-tip
         read bilbord no lock invalid 
           continue   
         not invalid
****** mami   zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz
          if bilbord-rson-tarih < tarih-tasi and 
             bilbord-rson-tarih > "20000000" then 
            perform kontenjani-dolu
            move 1 to grid-geldi
             go kontenjan-kontrol-bitti
         end-if
         end-read.

            initialize acenhrk-rec. 
*****         move xrez-acenta       to acenhrk-acenta. 
         move ac-kont to acenhrk-acenta
         move takvim-anah       to acenhrk-tarih. 
         move rezpara-kont-tipi to acenhrk-s-d-t-g. 
         if rezpara-kont-tipi = 0 
            move xrez-s-d-t-g   to acenhrk-s-d-t-g
         end-if. 
         move 41   to acenhrk-oda-konumu.  
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
            move 1 to grid-geldi
               go kontenjan-kontrol-bitti
         end-if
         end-read.
            initialize acenhrk-rec. 
****         move xrez-acenta       to acenhrk-acenta. 
           move ac-kont to acenhrk-acenta
         move takvim-anah       to acenhrk-tarih. 
         move 5 to acenhrk-s-d-t-g. 
         
         move xrez-fiyat-konumu   to acenhrk-oda-konumu. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
            move 1 to grid-geldi
               go kontenjan-kontrol-bitti
         end-if
         end-read.
            initialize acenhrk-rec. 
         move ac-kont to acenhrk-acenta
*****         move xrez-acenta       to acenhrk-acenta. 
         move takvim-anah       to acenhrk-tarih. 
         move 5 to acenhrk-s-d-t-g. 
         move 41   to acenhrk-oda-konumu. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
            move 1 to grid-geldi
               go kontenjan-kontrol-bitti
         end-if
         end-read.
         go kontj-oku. 
 kontenjan-kontrol-bitti.
         close acenhrk  bilbord
         perform acu-form4-routine
         add 1 to sonraki-id
               move sonraki-id to control-id  
         move 4 to accept-control.
 kontenjan-kontrol-exit. 
         exit. 

 kontenjani-dolu. 
       close acenhrk  bilbord
       perform acu-form4-routine
       add 1 to sonraki-id
             move sonraki-id to control-id
       move 4 to accept-control
       open input acenhrk bilbord
       exit paragraph
       move "Y" to kontj-var-yok. 
       initialize mesaj-degiskenler
       move " [ Kontenjan Hata ] " to mmesaj-title
       move "Bu Tarihte Bu Acentanin Kon.Yok"      to mmesaj-1. 
       move "Tarih:  /  /     Kon:      Sat:     " to mmesaj-2. 
       move takvim-gun                             to mmesaj-2(07:02). 
       move takvim-ay                              to mmesaj-2(10:02). 
       move takvim-yil                             to mmesaj-2(13:04). 
       move acenhrk-kontrat-oda                    to mmesaj-2(22:04). 
       move acenhrk-sat-oda                        to mmesaj-2(32:04). 
       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
        .
*
 blok-kontrol.
           initialize gec-gecme
           open input cast.
        move xrez-gir-tar   to cast-tarih.
        move xrez-odano     to cast-oda-no.
        start cast key not < cast-anah3 invalid 
              go blok-kontrol-bitti.
 blok-kontrol-oku.
        read cast next no lock end 
             go blok-kontrol-bitti.
        if fs-cast = 99 go blok-kontrol-oku.
        if cast-tarih  > xrez-cik-tar   go blok-kontrol-bitti.
        if cast-tarih  = xrez-cik-tar   go blok-kontrol-bitti.
        if cast-oda-no > xrez-odano     go blok-kontrol-bitti.
        if cast-oda-no = xrez-odano  continue
        else 
           go blok-kontrol-oku
        end-if.
        if cast-rez-no = xrez-no go blok-kontrol-oku.
           initialize mesaj-degiskenler
           move " [ DIKKAT ] " to mmesaj-title
           move "Girdiginiz Oda Bu Tarihte Blokeli  " to mmesaj-1
           move "Tarih..:  /  /                     " to mmesaj-2
           move cast-gun     to mmesaj-2(09:02)
           move cast-ay      to mmesaj-2(12:02)
           move cast-yil     to mmesaj-2(15:04)

           move 1           to mmesaj-type
           move 2           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
             .
 blok-kontrol-bitti.
            close cast.
 blok-kontrol-exit.
     exit.
*
 blokaj-konum-farkli. 
        initialize mesaj-degiskenler
        move " [ Blokaj Hata ] " to mmesaj-title
        move "Rezervasyon Konumu Ile Blokaj Oda." to mmesaj-1. 
        move "Konumu Farkli...Rez..:   Blok..:  " to mmesaj-2. 
        move xrez-oda-konumu                      to mmesaj-2(23:1). 
        move odalar-konumu                        to mmesaj-2(33:1). 
        move 1           to mmesaj-type
        move 3           to mmesaj-icon
        move 1           to mmesaj-default
             perform mmesaj-ver.
 blokaj-konum-farkli-exit. 
     exit. 
*
 toplam-odeme-bul.
     
          modify form1-gd-1a reset-grid  = 1 mass-update = 1 .
        initialize odeme-var 
            open input cast
              
         initialize cast-rec top-odeme   top-reel top-anlasma gece-sayi
            move xrez-no to cast-rez-no
         start cast  key >  cast-anah1 
            invalid continue
            not invalid
            
             modify form1-gd-1a reset-grid = 1 mass-update = 1
         move "Tarih" to gd-1-tarih
         move "Reel" to  gd-1-tutar
         move "Anlasma" to gd-1-toplam
         modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
          initialize gece-sayi

        perform with test after until fs-cast = "10"  
          read cast next no lock end move "10" to fs-cast
          not end
             if cast-rez-no not = xrez-no or 
               cast-tarih >= xrez-cik-tar
               
               move "10" to fs-cast
               else
               add 1 to gece-sayi
                  initialize renk

                move cast-gun to  gd-1-tarih(1:2)                   
                move cast-ay  to  gd-1-tarih(4:2)   
                move cast-yil to  gd-1-tarih(7:4)
                move "/" to           gd-1-tarih(3:1)   gd-1-tarih(6:1) 
                 if tarih-tasi > cast-tarih
                    move CAST-BASILAN-FIYAT  to z-8
                    move z-8               to gd-1-tutar
                      add CAST-BASILAN-FIYAT to top-reel
                         if cast-BASILAN-FIYAT not = cast-anlasma-fiyati
                           move 176 to renk
                         end-if
                 end-if
                 if tarih-tasi = cast-tarih
                   move 517 to renk
                    add cast-basilan-fiyat to cast-fiyati
                    move CAST-fiyati  to z-8
                    move z-8               to gd-1-tutar
                      add cast-fiyati to top-reel
                        if cast-fiyati not = cast-anlasma-fiyati
                           move 176 to renk
                    end-if
                 end-if
                 if tarih-tasi < cast-tarih
                    add cast-fiyati to top-reel
                    move CAST-fiyati  to z-8
                    if cast-fiyati not = cast-anlasma-fiyati
                       move 176 to renk
                    end-if
                    move z-8               to gd-1-tutar
                 end-if

                move cast-anlasma-fiyati  to z-8
                move z-8               to gd-1-toplam
               
                   add cast-anlasma-fiyati to top-anlasma
                
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 if renk not = 0 then 
                   modify  form1-gd-1a(gece-sayi + 1) row-color  = renk 
                 end-if
              end-if
          end-read 
        end-perform, 
        end-start,
           move 0 to renk
             move "TOPLAM" to           gd-1-tarih
                 
                    move  top-reel to z-8
                    if top-reel not = top-anlasma
                       move 176 to renk
                    end-if
                    move z-8               to gd-1-tutar
               

                move top-anlasma          to z-8
                move z-8               to gd-1-toplam
               
                  
                
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 if renk not = 0 then 
                   modify  form1-gd-1a(gece-sayi + 2) 
                       start-x = 1 x = 3
                       start-y = gece-sayi + 2 y = gece-sayi + 2
                       region-color  = renk 
                 end-if


         modify form1-gd-1a  mass-update = 0
         close cast
              move  top-anlasma to top-odeme
            compute kal-odeme = top-odeme - xrez-on-odeme 

            move top-odeme      to odeme-z
            modify  accept-toplam-tutar value = odeme-z
            move xrez-on-odeme  to odeme-z
            modify  accept-odeme-toplam value = odeme-z
            move kal-odeme      to odeme-z
            modify  accept-odeme-kalan  value = odeme-z.
        
 toplam-odeme-bul-exit.
        exit.
*********************KONTROLLER*********************
***********Aramalar.........
*
*
*
 Form1-Gd-1a-Ev-Msg-Begin-Entry.
             set event-action to event-action-fail
    
             
               call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xrez-no   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/hesayr.asy"
               end-call



     .

 kaydet. 
 kaydet-kontrol. 
                                                   
      open input kllnc                                 |||| Delphine transfer kullanc istei 21/05/2019
      initialize kllnc-rec 
      move k-kodu-tasi to k-kodu
      read kllnc no lock invalid
           continue
      end-read
      close kllnc
      if k-ccenter-user = 1 
         move xrez-no to rez-no 
         read rez no lock invalid
              display message box "CRM & CCenter kullanicisinin rezervasyon kayit yetkisi yoktur.." new-line
                              title "Uyari"
                              icon 1
         end-read
         if k-ccenter-supervisor = 1
            if xrez-not1 <> rez-not1 or 
               xrez-not2 <> rez-not2

               move xrez-not1 to rez-not1
               move xrez-not2 to rez-not2

               accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
               accept rez-edit-zaman from time          |                           
               
               rewrite rez-rec invalid
                       continue
               not invalid
                   display message box "Not kaydi tamamlandi.."
                                   title "Uyari"
                                   icon 1
               end-rewrite 
            end-if
         end-if
         move 1 to gec-gecme
         go kaydet-exit
      end-if 

      initialize mesaj-degiskenler gec-gecme.
      
*/***************************gecici olarak kaldrld ***********************************    
*      if genel-konum-upgrade-devrede = 1 
*       if yeni-rez 
*         if k1-konum-upgrade-yapabilir not = 1   
*      
*               initialize  l-eski-konum    
*               move xrez-oda-konumu to l-yeni-konum     
*               move xrez-no      to  l-rezno          
*               move xrez-rec      to  l-rez-rec     
*               move 0 to  l-yapabilir     
*
*               call "/asya/ytl/obj/otel/blokupg.asy" using  l-eski-konum  l-yeni-konum l-rezno l-rez-rec  l-yapabilir      
*                    on exception perform callerr-proc
*                    not on exception
*               cancel "/asya/ytl/obj/otel/blokupg.asy" 
*               end-call
*               display message box  "l-eski-konum    :" l-eski-konum    new-line
*                                    "l-yeni-konum    :" l-yeni-konum     new-line
*                                    "l-rezno         :" l-rezno          new-line
*                                    "l-rez-rec(1:200):" l-rez-rec(1:200)  new-line
*                                    "l-yapabilir     :" l-yapabilir        new-line
*                                    "k-kodu-tasi     :" k-kodu-tasi        new-line
*        if  l-yapabilir = 0 then 
*              move 1 to gec-gecme
*                  display message box  "Oda Upgrade Yetkiniz Bulunmamaktadir..." new-line
*                                       "Rezervasyon Kaydedilemedi....."
*                                  title "Uyari"
*                                  icon 2
*              go kaydet-exit
*              else
*               move   l-rez-rec(950:4)  to xrez-conf-staff
*        end-if
*      end-if
*      else
*      move k-kodu-tasi to xrez-conf-staff
*      end-if
*/***************************gecici olarak kaldrld *********************************** 
*/*******************kastamonu konaklar***********************************************************
        if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11
            if rezpara-short-uyari = "E" 
               
               perform short-kontrol  thru short-kontrol-exit 
               if short-var and rezpara-short-gecsin = "H"
                  display message box "Bu Tarihte Tum Odalar Dolu..." new-line
                                      "Isleme Devam Edilemez..."
                                  title "Uyari"
                                  icon 1                
                  move 1 to gec-gecme
                  go kaydet-exit
               end-if
            end-if 
        end-if
*/*******************kastamonu konaklar***********************************************************
        if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11
              open i-o karalist            
              move "M" to karalist-tipi 
              move xrez-adi    to karalist-adi 
              move xrez-soyadi to karalist-soyadi 
              read karalist no lock invalid 
                  continue
              not invalid 
                   display message box  karalist-adi " " karalist-soyadi " Misafir Kara Listede.." new-line 
                                        "Aciklama : " KARALIST-ACK-1 new-line
                                        "Aciklama : " KARALIST-ACK-2 new-line
                                        "Islem iptal edildi."                     
                                   title "Uyari"
                                   icon 2
                   close karalist
                   move 1 to gec-gecme
                   go kaydet-exit
              end-read
              close karalist

              perform varying i from 2 by 1 until i > 9    
                      move i to klist-yan-kac
                      perform yanrez-karalist-kontrol
                      if gec-gecme = 1
                          go kaydet-exit
                      end-if
              end-perform
          end-if
        if xrez-gir-tar = xrez-cik-tar
           display message box "REZERVASYON GIRIS-CIKIS TARIHLERI AYNI " new-line new-line 
                               "DEVAM ETMEK ISTER MISINIZ...?"
                           title "Uyari"
                           icon 1
                           type 2
                           default 2
                           returning donus-kodu
           if donus-kodu = 2
              move 1 to gec-gecme
              go kaydet-exit
           end-if 
        end-if 
        if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11
        if rezpara-stops-uyari = "E" 
           
           perform stopsale-kontrol thru stopsale-kontrol-exit

           
           if rezpara-stops-gecsin = "H" and 
              stopsale-var-yok = "V" AND rez-yeni-eski = "Y"
              DISPLAY MESSAGE BOX "BU TARIHTE SATISA KAPALI GUN VAR" NEW-LINE
                 "PARAMETRELER IZIN VERMEMEKTEDIR"
                 TITLE "STOP SALE "
              move 1 to gec-gecme
             go kaydet-exit
           end-if
           
           if stopsale-var-yok = "V"
              initialize mesaj-degiskenler
              move " [ SATISA KAPALI  ] " to mmesaj-title
              move " BU TARIHLERDE STOP-SALE TANIMLANMIS   "  to mmesaj-1
              move " STOP'A RAGMEN DEVAM ETMEK ISTERMISINIZ?" to mmesaj-2 
              move 2           to mmesaj-type
              move 1           to mmesaj-icon
              move 2           to mmesaj-default
              perform mmesaj-ver
              if donus-kodu = 2 
                 go kaydet-exit
              end-if
           end-if
/*/********************lonicera istek stoplu gnlerde bilbord oto iaretle           
           if stopsale-bil-var = 1 and 
              stopsale-var-yok = "V"
              move "E"   to xrez-bilbord-eh              
           end-if    
/*/********************lonicera istek stoplu gnlerde bilbord oto iaretle
        end-if 
        end-if
        move " [ Hata ] " to mmesaj-title
        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
        initialize gecmez2 gecmez3
        perform acenta-oku   thru acenta-oku-exit
            if  GECMEZ2 = 1 then 
                move "Hata Yeri : [ Munferit Disinda Rezervasyon Acamassiniz.........]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default

                perform mmesaj-ver
                go kaydet-exit

            end-if
              
            if gecmez  
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default

                perform mmesaj-ver
                go kaydet-exit
            end-if 

            if gecmez3 = 1  
                move "Hata Yeri : [ Acenta Kodu Pasif................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default

                perform mmesaj-ver
                go kaydet-exit
            end-if 


          if acenta-op-zorunlu = 1 then
             perform op-goster
             if opcode-yok = 1 
               move "Hata Yeri : [ Operator Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit 
             end-if
          end-if
          if genel-kaynak1-zorunlu = 1 then
             perform kaynak1-goster
             if kaynak1-yok = 1 
               move "Hata Yeri : [ Kaynak1 Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit 
             end-if
          end-if
         if genel-kaynak2-zorunlu = 1 then
             perform kaynak2-goster
             if kaynak2-yok = 1 
               move "Hata Yeri : [ Kaynak2 Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit 
             end-if
          end-if
          if genel-kaynak3-zorunlu = 1 then
             perform kaynak3-goster
             if kaynak3-yok = 1 
               move "Hata Yeri : [ Kaynak3 Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit 
             end-if
          end-if
          if xrez-voucher  = spaces   and genel-voucher-zorunlu = 1 
                 move "Hata Yeri : [ Voucher Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit 
                 

             end-if
        perform firma-oku   
                if gecmez 
                move "Hata Yeri : [ Firma Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform banka-oku    thru banka-oku-exit
                if gecmez
                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform odeme-oku    thru odeme-oku-exit
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez
                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-gir-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-cik-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if
        move xrez-al-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Satis Tarihi  Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if
        if xrez-gir-tar  < tarih-tasi
           move "Hata Tipi : [ Uyumsuz Veri .......]" to mmesaj-1
          move "Hata Yeri : [ Gecmis Tarihe Rezervasyon Girilemez]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
         end-if
        if xrez-cik-tar < xrez-gir-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-k-g-b     not = "K" and not = "G" and not = "B" and not = "O"
           move "Hata Yeri : [ Kur K-G-B Tanimsiz..................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 

        open input konum
        move xrez-oda-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Rezervasyon Oda Konumu Tanimsiz.....]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid continue
             end-read
          move xrez-fiyat-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Rezervasyon Fiyat Konumu Tanimsiz.....]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid continue
             end-read



             close konum

        if xrez-s-d-t-g   not = 1 and not = 2 and not = 3 and not = 4 
           evaluate true 
              WHEN xrez-buyuk = 0
                if rezpara-sifir-pax = 1 then 
                        move "1" to xrez-s-d-t-g 
                                      move "1" to xrez-s-d-t-g 
                                        modify accept-odatipi-e value = "1->Single"
                                      else
                   display message box "Onburo calisma parametrelerinde " new-line
                                      "Sifir pax a izin verilmemistir"
                   move 1 to gec-gecme
                  exit paragraph

                end-if 
              when xrez-buyuk < 2 move "1" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "1->Single"
              when xrez-buyuk = 2 move "2" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "2->Double"
              when xrez-buyuk = 3 move "3" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "3->Triple"
              when xrez-buyuk > 3 move "4" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "4->Group "
            end-evaluate
        end-if 
        if (xrez-on-odeme not = zeroes and xrez-on-doviz = spaces) 
           move "Hata Yeri : [ On Odeme Doviz Kodu Tanimsiz........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-buyuk  <  1 and rezpara-sifir-pax not = 1
           move "Hata Yeri : [ Buyuk Sayisi [0] Olamaz.............]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-no  <  1 
           move "Hata Yeri : [ Rezervasyon Numarasi Bos Gecilemez..]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
*        if rezpara-blokaj  = "E" 
*        perform oda-oku      thru oda-oku-exit
*                if gecmez
*                move "Hata Yeri : [ Blokaj Odasi  Tanimsiz..............]" to mmesaj-2
*                move 1           to mmesaj-type
*                move 3           to mmesaj-icon
*                move 1           to mmesaj-default
*                perform mmesaj-ver
*                go kaydet-exit
*                end-if 
*                if rezpara-blokaj-farkli = "H" and 
*                   xrez-oda-konumu not = odalar-konumu 
*                   move "Hata Yeri : [ Blokaj Odasinin Konumu Yanlis.......]" to mmesaj-2
*                   move 1           to mmesaj-type
*                   move 3           to mmesaj-icon
*                   move 1           to mmesaj-default
*                   perform mmesaj-ver
*                   go kaydet-exit
*        end-if.

       if eski-rez and xrez-c-in = "E" 
          initialize mesaj-degiskenler
          move " [ Degistirilemez Rezervasyon ] " to mmesaj-title
          move " Bu Rezervasyon C-In Yapilmis   !!! " to mmesaj-1 
          move " Rezervasyonda Degisiklik yapilamaz " to mmesaj-2 
          move 1           to mmesaj-type
          move 3           to mmesaj-icon
          move 1           to mmesaj-default
             perform mmesaj-ver
             go kaydet-exit
       end-if.

*/ konfirme denetimi 
       inquire rez-kgb-combo, value in xrez-k-g-b

       if xrez-k-g-b <> "K" and yeni-rez
          display message box 
                  "Girmis oldugunuz rezervasyonu KONFIRME etmediniz ",new-line,
                  "Eminmisiniz ? ",
                  icon mb_warning_icon
                  title "Bilginize ..."
                  type mb_yes_no,
                  default 2
                  returning sunset-uyari
          if sunset-uyari = 2
             move 4 to accept-control
             move 1024 to control-id
             go kaydet-exit
          end-if
       end-if.
       if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
                perform blok-kont2
        end-if
       .



       if gecmez  then
           if genel-uzun-oda-no-kullanilsin = 1 
           move 311 to control-id
           else
             move 1034 to control-id
          end-if
             go kaydet-exit
               move 4 to accept-control
        end-if
        
       if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 
*       if yeni-rez 
*         move rez-rec to yedek-rez
*         perform silinmis-rez-ara
*         move yedek-rez to rez-rec
*        end-if

          initialize mesaj-degiskenler
          move " [ Kaydet Soru ] " to mmesaj-title
          move " GIRDIGINIZ BILGILER KAYDEDILECEKTIR " to mmesaj-1
          move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2 
          move 2           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
       else
         move 1 to donus-kodu
       end-if  
       if donus-kodu not = 2 
       if genel-konum-upgrade-devrede = 1 
       if eski-oda-konum not = spaces  and  eski-oda-konum <> xrez-oda-konumu   
      
       move eski-oda-konum to  l-eski-konum    
       move xrez-oda-konumu to l-yeni-konum     
       move xrez-no      to  l-rezno          
       move xrez-rec      to  l-rez-rec     
       move 0 to  l-yapabilir     

               call "/asya/ytl/obj/otel/blokupg.asy" using  l-eski-konum  l-yeni-konum l-rezno l-rez-rec  l-yapabilir      
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokupg.asy" 
               end-call
*               display message box  "l-eski-konum    :" l-eski-konum    new-line
*                                    "l-yeni-konum    :" l-yeni-konum     new-line
*                                    "l-rezno         :" l-rezno          new-line
*                                    "l-rez-rec(1:200):" l-rez-rec(1:200)  new-line
*                                    "l-yapabilir     :" l-yapabilir        new-line
*                                    "k-kodu-tasi     :" k-kodu-tasi        new-line
        if  l-yapabilir = 0 then 
              move 1 to gec-gecme
                  display message box  "Oda Upgrade Yetkiniz Bulunmamaktadir..." new-line
                                       "Rezervasyon Kaydedilemedi....."
                                  title "Uyari"
                                  icon 2
              go kaydet-exit
        end-if
      end-if
      end-if
      end-if
       if donus-kodu = 2 
          go kaydet-exit
       end-if 


            open output takasfiyat
            close takasfiyat
           open input  takvim2  kur romhrk kodlar02  aksiyhrk fiyat fiyatana konuk firma
           open i-o takasfiyat
          move rez-rec to yedek-rez
           move xrez-rec to rez-rec
           || stop " " 
*            perform peryot-fiyat-bul
           move yedek-rez to rez-rec
              close takasfiyat  takvim2 kur romhrk kodlar02  aksiyhrk fiyat fiyatana konuk firma
   
       if yeni-rez 
         
         move k-kodu-tasi to xrez-alan-staff
         if xrez-conf-staff = spaces then
                move   k-kodu-tasi to  xrez-conf-staff
          end-if
           accept sys-tar from century-date 
          if rez-para-isl-sistemden = 1 then
             move tarih-tasi to xrez-isl-tar  sys-tar
          else
             move sys-yil to xrez-isl-yil
             move sys-ay  to xrez-isl-ay 
             move sys-gun to xrez-isl-gun 
          end-if
          accept xrez-isl-zaman from time
       end-if. 
       move "Y" to fark-var-yok cast-fark-var-yok 
                   takvim-fark-var-yok acenhrk-fark-var-yok. 
*****if srez-durumu     not = xrez-durumu 
*****                   move "V" to fark-var-yok 
*****                   takvim-fark-var-yok acenhrk-fark-var-yok. 
*****if srez-tipi       not = xrez-tipi       move "V" to fark-var-yok. 
       if srez-acenta     not = xrez-acenta  
                          move "V" to fark-var-yok  
                          acenhrk-fark-var-yok
       end-if.
       if srez-gir-tar    not = xrez-gir-tar 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-cik-tar    not = xrez-cik-tar 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-kisi       not = xrez-kisi 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok 
       end-if.
       if srez-s-d-t-g    not = xrez-s-d-t-g 
                          move "V" to fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-k-g-b      not = xrez-k-g-b 
                          move "V" to fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok 
       end-if.
       if srez-oda-konumu not = xrez-oda-konumu 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-fiyat-konumu not = xrez-fiyat-konumu 
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-odano      not = xrez-odano 
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-bilbord-eh not = xrez-bilbord-eh 
                          move "V" to fark-var-yok 
                          move "V" to acenhrk-fark-var-yok
       end-if.
       if srez-fiyati     not = xrez-fiyati
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-anlasma    not = xrez-anlasma
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-pan-tipi   not = xrez-pan-tipi
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if onay-uygulandi-yaz = 1 
       open i-o onay
           set onay-uygulandi to true
            move k-kodu-tasi to ONAY-uyg-STAF
                                        accept ONAY-uyg-TARIH from century-date 
                                        accept ONAY-uyg-zaman  from time
           rewrite  onay-rec invalid write onay-rec end-rewrite
         close onay
         initialize onay-uygulandi-yaz
      end-if
       if eski-rez 
          move "I"             to xrez-durumu 
          move k-kodu-tasi     to xrez-staf 
          
          accept xrez-degis-zaman from time 

          move xrez-no to rez-no
          read rez no lock invalid
              display message box "Hata : rezkj44"
          end-read  
          if rez-folio > 0 then 
             display message box 
            " Bu rez C/IN oldu"
          else
             move "4" to xrez-gr-status
          move xrez-rec        to rez-rec 
          move "I"             to rez-durumu
*          move mis-no to rez-profil-no
*          move ps1    to rez-profil-sirket
          perform yanrez-kaydet
          if rez-sharenum not > 0 then 
             move 0   to rez-share 
          end-if 
          move cocuklar to rez-cocuklar

          accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
          accept rez-edit-zaman from time          |                           
          
          rewrite rez-rec invalid 
                display message box "Hata 15699 rezervasyon yazilamadi "   
                if k-kodu-tasi = "ASYA" or "X   "  then stop " "  end-if

                  accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                  accept rez-edit-zaman from time          |                           
                
                  write rez-rec invalid 
                      continue
                  end-write
          end-rewrite
               perform log-operation-rez

               if link-var = 4 and 
                  link-gelen-rec(1:10) = "DEVRE-----"              

                   move rez-no        to dev-rez-no 
               end-if 
           open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
          
          perform blokaj-degisim-yaz
          end-if
       end-if.
*************>Rezervasyonda cast'i etkilemeyen bilgiler degismemisse tekrar 
*************>silip yazmasin............. 
       if eski-rez 
         perform cast-sil     thru cast-sil-exit 
          perform cast-isle    thru cast-isle-exit
       end-if.
       if eski-rez and acenhrk-fark-var 
          perform acenhrk-sil  thru acenhrk-sil-exit 
          perform acenhrk-isle thru acenhrk-isle-exit
       end-if.
       if eski-rez and takvim-fark-var 
          perform takvim-sil   thru takvim-sil-exit 
          perform takvim-isle  thru takvim-isle-exit
       end-if.
*************> 
       if yeni-rez 
          move "I"             to xrez-durumu 
          move k-kodu-tasi     to xrez-staf 
          accept xrez-degis-zaman from time 
          move "4"             to xrez-gr-status
          move xrez-rec        to rez-rec 
          perform cast-isle    thru cast-isle-exit 
          perform acenhrk-isle thru acenhrk-isle-exit 
          perform takvim-isle  thru takvim-isle-exit 
          move "I"             to rez-durumu 
*          move mis-no to rez-profil-no
*          move ps1    to rez-profil-sirket
               move cocuklar to rez-cocuklar

          accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
          accept rez-edit-zaman from time          |                           
          
          write rez-rec invalid 
               display message box "Hata 15699 rezervasyon yazilamadi rez no :" rez-no  
                if k-kodu-tasi = "ASYA" or "X   "  then stop " "  end-if
          end-write   
              perform log-operation-rez
               if link-var = 4 and 
                  link-gelen-rec(1:10) = "DEVRE-----"              
                  move rez-no        to dev-rez-no 
               end-if
         
          open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
          perform blokaj-degisim-yaz 
       end-if.

       if yeni-rez  
         if rez-grup-no  > 0 then          
             open i-o route
             initialize route-rec
             move rez-grup-no to route-rezno  route-folio   
             start route key > route-anah invalid 
                 continue
             not invalid 
             perform until fs-route = "10"
             read route next no lock end 
                  move "10" to fs-route
             not end 
                 if rez-grup-no not = route-rezno  or 
                    rez-grup-no not = route-folio  then
                       move "10" to fs-route 
                       exit perform
                 end-if
                 move route-rec to ydk-route-rec
                 move rez-no    to route-rezno 
                 initialize route-folio   
                 write route-rec invalid
                       display message box "hata 9998 " 
                 end-write
                 move ydk-route-rec to route-rec
             end-read
             end-perform
             end-start
             close route                             
         end-if   
       else 
         if link-var = 6
          if link-degisim-route-yeniden-hesapla = 1
             open i-o route
             initialize route-rec
             move rez-grup-no to route-rezno  route-folio   
             start route key > route-anah invalid 
                 continue
             not invalid 
             perform until fs-route = "10"
             read route next no lock end 
                  move "10" to fs-route
             not end 
                 if rez-grup-no not = route-rezno  or 
                    rez-grup-no not = route-folio  then
                       move "10" to fs-route 
                       exit perform
                 end-if
                 move route-rec to ydk-route-rec
                 move rez-no    to route-rezno 
                 initialize route-folio   
                 write route-rec invalid
                       rewrite route-rec end-rewrite 
                 end-write
                 move ydk-route-rec to route-rec
             end-read
             end-perform
             end-start
             close route                 
          end-if
         end-if 
       end-if
       if rez-sharenum > 0 then 
          perform share-koy-kont
       end-if.
*
 ortak-yanrez.
      move rez-no      to yanrez-rezno
      move rez-gir-tar to yanrez-gel-tar
      move rez-cik-tar to yanrez-git-tar
      move rez-odano   to yanrez-odano
      .
*
 yanrez-kaydet.
       open i-o yanrez
       initialize yanrez-rec
       move 1 to yanrez-sirano
       move rez-adi    to yanrez-adi
       move rez-soyadi to yanrez-soyadi
       move mis-no     to yanrez-profil-no
       move ps1        to yanrez-profil-sirket
       move d-tar1     to yanrez-dog-tar
       perform ortak-yanrez

       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
    
    if adi2 not = spaces or 
       soy2 not = spaces then
       initialize yanrez-rec
       move 2 to yanrez-sirano
       move adi2   to yanrez-adi
       move soy2   to yanrez-soyadi
       move d-tar2 to yanrez-dog-tar
       move pno2   to yanrez-profil-no
       move ps2    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
     else
         move rez-no      to yanrez-rezno
         move 2 to yanrez-sirano
         read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if
    if adi3 not = spaces or soy3 not = spaces then
       initialize yanrez-rec
       move 3 to yanrez-sirano
       move adi3   to yanrez-adi
       move soy3   to yanrez-soyadi
       move d-tar3 to yanrez-dog-tar
       move pno3   to yanrez-profil-no
       move ps3    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
    else
         move rez-no      to yanrez-rezno
         move 3 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if
    if adi4 not = spaces or soy4 not = spaces then
       initialize yanrez-rec
       move 4 to yanrez-sirano
       move adi4   to yanrez-adi
       move soy4   to yanrez-soyadi
       move d-tar4 to yanrez-dog-tar
       move pno4   to yanrez-profil-no
       move ps4    to yanrez-profil-sirket
       perform ortak-yanrez

       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 4 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete                              
         perform log-operation-yanrez
         end-read
    end-if
    if adi5 not = spaces or soy5 not = spaces then
       initialize yanrez-rec
       move 5 to yanrez-sirano
       move adi5   to yanrez-adi
       move soy5   to yanrez-soyadi
       move d-tar5 to yanrez-dog-tar
       move pno5   to yanrez-profil-no
       move ps5    to yanrez-profil-sirket
       perform ortak-yanrez    
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 5 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if
    if adi6 not = spaces or soy6 not = spaces then
       initialize yanrez-rec
       move 6 to yanrez-sirano
       move adi6   to yanrez-adi
       move soy6   to yanrez-soyadi
       move d-tar6 to yanrez-dog-tar
       move pno6   to yanrez-profil-no
       move ps6    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 6 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if

    if adi7 not = spaces or soy7 not = spaces then
       initialize yanrez-rec
       move 7 to yanrez-sirano
       move adi7   to yanrez-adi
       move soy7   to yanrez-soyadi
       move d-tar7 to yanrez-dog-tar
       move pno7   to yanrez-profil-no
       move ps7    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 7 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if

    if adi8 not = spaces or soy8 not = spaces then
       initialize yanrez-rec
       move 8      to yanrez-sirano
       move adi8   to yanrez-adi
       move soy8   to yanrez-soyadi
       move d-tar8 to yanrez-dog-tar
       move pno8   to yanrez-profil-no
       move ps8    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 8 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez

         end-read

    end-if

    if adi9 not = spaces or soy9 not = spaces then
       initialize yanrez-rec
       move 9 to yanrez-sirano
       move adi9   to yanrez-adi
       move soy9   to yanrez-soyadi
       move d-tar9 to yanrez-dog-tar
       move pno9   to yanrez-profil-no
       move ps9    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 9 to yanrez-sirano
           read yanrez no lock invalid continue not invalid 
         delete yanrez invalid continue 
         end-delete
         perform log-operation-yanrez
         end-read
    end-if

    close yanrez.
*
 fis-cik-cikma. 
      if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 then
       if eski-rez and rezpara-duz-fis not = "E" 
          go fis-gec
       end-if 
       if yeni-rez and rezpara-fis-sor not = "E" 
          go fis-gec
       end-if
       initialize mesaj-degiskenler
       move " [ Fis Ciksin Mi ? ] " to mmesaj-title
       move " REZERVASYON FORMU ISTIYORMUSUNUZ..? " to mmesaj-1
       move " ...[ E->Evet  H->Hayir ]........... " to mmesaj-2 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go fis-gec
       end-if
       else
             go fis-gec
       end-if.
 rez-fis-cik. 
      
      call "/asya/ytl/obj/otel/rezfisiy.asy" using xrez-no
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/rezfisiy.asy" 
       end-call.
 fis-gec.  
      if link-var = 1 then 
              move 99999999 to link-rez-no
              set exit-pushed to true
              go kaydet-exit
          end-if.
      if link-var = 3
           move rez-sharenum to link-gelen-sharenum
           move rez-no to link-rez-no
               set exit-pushed to true
                go kaydet-exit
      end-if
      if link-var = 5 or link-var = 6 or link-var = 11 and link-var not = 7 
                 go kaydet-exit
      end-if
     initialize rez-rec xrez-rec accept-rez-no yan-deg

     move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
     move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                          oda-konumu-combo-value fiyat-konumu-combo-value
     perform gun-bul
     if key-status not = 4412
        perform form-update
     end-if 

     move 4    to accept-control
     move 1002 to control-id.

 kaydet-exit. 
     exit. 
********====> Rezervasyon Cogaltma Bolumu       <========********** 
 
********====> Rezervasyon Silme    Bolumu       <========********** 
 rez-sil. 
    open input kllnc 
    initialize kllnc-rec 
    move k-kodu-tasi to k-kodu
    read kllnc no lock invalid
         continue
    not invalid
        if k-ccenter-user = 1
           display message box "CRM & CCenter kullanicisinin rezervasyon silme yetkisi yoktur.." new-line
                           title "Uyari"
                           icon 1
           close kllnc 
           go rez-sil-exit
        end-if
    end-read
    close kllnc 
    move xrez-no to rez-no. 
    read rez no lock invalid go rez-sil-exit. 
    if rez-c-in = "E" 
       initialize mesaj-degiskenler
       move " [ Silinemez Rezervasyon ] " to mmesaj-title
       move " Bu Rezervasyon C-In Yapilmis   !!! " to mmesaj-1 
       move " C-In'i Iptal Edip Siliniz      !!! " to mmesaj-2 
       move 1           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
          perform mmesaj-ver
        if k-kodu-tasi = "1919" or "1919" then 
           display message box "SELAHATTIN DIKKAT ET SILIYOSUN"
                                "EGER ASYA SOFT YETKILISI DEGILSENIZ " new-line 
                                "LUTFEN  hayiri tiklayip ASYA kullanicisini kullanmayiniz.  "
                               title "DIKKAT ozel islem"
                              move 1           to mmesaj-type
                              move 1           to mmesaj-icon
                              move 2           to mmesaj-default
       else
         go rez-sil-exit
       end-if 
    end-if.
    
    if rez-sharenum > 0
       
        move high-values to link-share-rec(1:100) 
           move accept-rez-no  to link-share-rez-no
         call "/asya/ytl/obj/otel/share.asy" 
           using link-share-rez-no,  link-share-rec
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
          cancel "/asya/ytl/obj/otel/share.asy"
         end-call

          move accept-rez-no  to rez-no
           move xrez-no to rez-no 
             read rez no lock invalid stop " " 
             end-read
            move rez-rec to xrez-rec
           
    end-if.
       perform acu-fsil-routine
       initialize mesaj-degiskenler
       move " [ Sil Soru ] " to mmesaj-title
       move " BU REZERVASYON SILINECEKTIR ......  " to mmesaj-1
       if tr-sec(1:8) not = "--------" then
         move tr-sec(1:12)        to mmesaj-1(17:)
         move "TRANSFER EDILECEK" to mmesaj-1(30:)
       end-if
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 2           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go rez-sil-exit
       end-if
        if tr-sec(1:8) not = "--------" then
          open input isyeri
                    initialize isyeri-rec
                    move tr-sec(31:8) to isyeri-adres 
                    start isyeri key = isyeri-adres invalid 
                       move 99 to isyeri-no
                       
                      not invalid
                      read isyeri next no lock end-read
                     
                   end-start
                      move rez-rec to trez-rec
                      move isyeri-no to REZ-git-sirket  xREZ-git-sirket
                      move tr-acenta to trez-acenta
                    if REZ-git-sirket = "99"
                          move "99" to trez-gel-sirket 
                    else
                            initialize isyeri-rec
                            move isyeri-adres-tasi to isyeri-adres
                            start isyeri key = isyeri-adres invalid continue
                              not invalid
                              read isyeri next no lock end-read
                              move isyeri-no to trez-gel-sirket 
                            end-start
                    end-if
                   close isyeri
        end-if
       if tr-sec(1:8) not = "--------" and genel-transfer-kopya = 1 then           
           continue
       else
*******************************************************firat rez silinirken islenme tarihi kayboluyor o yuzde isl-tar  sil-tar a yedekliyorum
       move rez-isl-tar to rez-sil-tar 


*****************************************************************       
        if rez-para-isl-sistemden = 1 then
             move tarih-tasi to rez-isl-tar
          else
           accept sys-tar from century-date 
              move sys-yil to rez-isl-yil
              move sys-ay  to rez-isl-ay 
              move sys-gun to rez-isl-gun 
        end-if
        accept rez-isl-zaman from time
       move k-kodu-tasi   to rez-staf 
       move sil-sebeb to rez-sil-sebeb
       move r-iptal   to rez-iptal
       move fsil-value to rez-sil-neden
       initialize rez-sharenum
************* share kontrol **********
       move "S" to rez-durumu 

          accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
          accept rez-edit-zaman from time          |                           
          
          rewrite rez-rec invalid 
               initialize mesaj-degiskenler
               move " [ Hata ] " to mmesaj-title
               move " BU REZERVASYON SILINEMEDI.........  " to mmesaj-1
               move " KONTROL EDINIZ....................  " to mmesaj-2 
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               go rez-sil-exit
               perform log-operation-rez
        
*******perform cast-iptal   thru cast-iptal-exit. 

          end-rewrite
              ||sy.ekleme 21.09.2013
              perform log-operation-rez

              perform prohrk-sil  
              perform acenhrk-sil  thru acenhrk-sil-exit
              perform takvim-sil   thru takvim-sil-exit

            
           if rez-k-g-b = "O" | selahattin beyin talebi seginus              
             if rez-odano not = spaces
              open i-o odalar
              initialize odalar-rec
              move REZ-ODANO  to odalar-anah
              read odalar no lock invalid
                  continue 
              not invalid 
                   move house-bk  to HOUSE-DURUMU  ODALAR-DURUMU
                   rewrite odalar-rec end-rewrite 
                   perform log-operation-odalar
              end-read       
              close odalar
             end-if
           end-if 
      end-if
    
      if tr-sec(1:8) not = "--------" then
          perform rez-trans-et
      end-if
      initialize rez-rec xrez-rec accept-rez-no yan-deg
      move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
      move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu 
                           oda-konumu-combo-value fiyat-konumu-combo-value
      perform gun-bul
      perform form-update      
      move 4    to accept-control
      move 1002 to control-id.
 rez-sil-exit. 
     exit. 
*
 prohrk-sil.
     open i-o prohrk
     move isyeri-adres-tasi       to prohrk-rez-sirket
     move xrez-no                 to prohrk-rez-no
     start prohrk key not < prohrk-rez-anah invalid
         continue
     not invalid
     perform with test after until fs-prohrk = "10"
     read prohrk next no lock end move "10"   to fs-prohrk
     not at end
            if     isyeri-adres-tasi       = prohrk-rez-sirket and
                   xrez-no       = prohrk-rez-no
                   move "S"        to prohrk-rez-durumu
                   accept prohrk-duz-tarih from century-date
                   rewrite prohrk-rec invalid stop " " end-rewrite
            else
               move "10"   to fs-prohrk
            end-if
  
     end-read
     end-perform
     end-start
     close prohrk

     .

      
*
 rez-trans-et.
     
       perform onb-adres-aktar
        
     
             open i-o genelfis2
             move 1 to genelfis2-anahtar
             read genelfis2 no lock invalid  
                  continue
              not invalid
                  add 1 to rez2-oto 
                  move rez2-oto to trez-no 
                  rewrite genelfis2-rec end-rewrite
             end-read
             close genelfis2


     open i-o rez2 cast4 
        move trez-rec to rez2-rec 
         initialize rez2-odano
        write rez2-rec invalid stop " " end-write
        
          perform ucast-isle   
    
       open input yanrez
       open i-o yanrez2
       initialize yanrez-rec
            move rez-no to yanrez-rezno
        start yanrez key >= yanrez-anah invalid continue
           not invalid 
             perform until fs-yanrez= "10" 
                 read yanrez next no lock end move "10" to fs-yanrez
                    not end
                    if yanrez-rezno = rez-no
                      move yanrez-rec to yanrez2-rec
                      move rez2-no to  yanrez2-rezno
                    write yanrez2-rec invalid display message box yanrez2-rezno " Yanrez yazilamadi "  yanrez2-adi
                      end-write
                     else
                     move "10" to fs-yanrez
                     end-if
                end-read
             end-perform
        end-start


       close yanrez yanrez2
        
      close rez2 cast4
     
        .

*
 ucast-isle.
         move rez2-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
             continue
             not invalid
             perform until fs-takvim = "10"
                  read takvim next no lock end move "10" to fs-takvim
                     not end
                      if takvim-anah > rez2-cik-tar 
                        move "10" to fs-takvim
                        else

                         initialize cast4-rec 
                           move rez2-no           to cast4-rez-no
                           move takvim-anah       to cast4-tarih
                           move rez2-odano        to cast4-oda-no
                           move rez2-buyuk        to cast4-buyuk
                           move rez2-kucuk        to cast4-kucuk
                           move rez2-bebek        to cast4-bebek
                           move rez2-free         to cast4-free
                           move rez2-oda-konumu   to cast4-oda-konumu
                           move rez2-fiyat-konumu to cast4-fiyat-konumu
                           move rez2-anlasma      to cast4-anlasma
                           move rez2-pan-tipi     to cast4-pan-tipi
                           write cast4-rec invalid 
                            display message box cast4-tarih " tarihli Cast Yazilamadi"
                             end-write
                         end-if
                  end-read
           end-perform 
        end-start
             .
        .
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 

 cast-isle. 
          
           open input fiyat fiyatana hesayr  break
           open i-o cast takasfiyat. 
           move xrez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
              go cast-isle-bitti. 
 cast-yaz-oku. 
        read takvim next no lock end go cast-isle-bitti. 
        if fs-takvim = 99 go cast-yaz-oku. 
        if takvim-anah > xrez-cik-tar go cast-isle-bitti. 
                initialize cast-rec. 
            initialize takasfiyat-rec
           move xrez-no     to  cast-rez-no
           move takvim-anah to   cast-tarih
           
           
             initialize      hesaplanan-fiyat
           if xrez-gir-tar = cast-tarih and xrez-gec = 1  and xrez-fiyat-fix not = "E" 
            initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
           start hesayr key >= hesayr-anah invalid continue
              not invalid
              perform until fs-hesayr = "10"
                  read hesayr previous no lock end move "10" to fs-hesayr
                      not end 
                        if hesayr-rez-no = xrez-no and hesayr-tarih <= xrez-gir-tar
                          add hesayr-basilacak-tut to hesaplanan-fiyat 
                          else
                          move "10" to fs-hesayr
                        end-if
                  end-read
              end-perform
              else
               initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
               read hesayr no lock 
                      invalid 
                        continue
                  not invalid
                 move  hesayr-basilacak-tut to hesaplanan-fiyat 
               end-read
           end-if   



           if hesaplanan-fiyat = 0 then 
               move xrez-fiyati to hesaplanan-fiyat
            end-if  
        
           initialize eski-cast hesayr-rec
           read cast no lock invalid 
                 continue
                 
               not invalid
                move cast-rec to eski-cast
           end-read
           
               if xrez-plan not = 1 
                   move hesaplanan-fiyat to cast-fiyati
               else
                   if cast-tarih = tarih-tasi
                       move hesaplanan-fiyat to cast-fiyati
                   end-if
               end-if
                  move hesaplanan-fiyat to cast-anlasma-fiyati
                  if xrez-oda-plan not = 1
                     move xrez-odano        to cast-oda-no
                     move xrez-oda-konumu   to cast-oda-konumu
                  else 
                     if cast-oda-no = spaces
                        move xrez-odano   to cast-oda-no
                        move xrez-oda-konumu   to cast-oda-konumu

                     end-if 
                  end-if 
                  
                  
                  if xrez-fkonum-plan not = 1
                     move xrez-fiyat-konumu to cast-fiyat-konumu
                  else
                     if cast-fiyat-konumu = zeroes 
                        move xrez-fiyat-konumu to cast-fiyat-konumu                        
                     end-if 
                  end-if
                  if xrez-pans-plan not = 1
                     move xrez-pan-tipi     to cast-pan-tipi
                  else
                     if cast-pan-tipi = spaces
                     move  xrez-pan-tipi     to cast-pan-tipi                    
                     end-if 
                  end-if
                 
                  move xrez-grup-no      to cast-grup
                  move xrez-anlasma      to cast-anlasma

           if xrez-kisi-plan not = 1 or 
              xrez-gir-tar = cast-tarih
                
                   move xrez-buyuk        to cast-buyuk
                   move xrez-kucuk        to cast-kucuk        
                   move xrez-bebek        to cast-bebek
                   move xrez-free         to cast-free
                 
           end-if
                  move xrez-sharenum     to cast-sharenum
               if cast-sharenum not > 0 then 
                  move 0 to cast-share 
               end-if
           if takvim-anah = xrez-cik-tar
               initialize      cast-fiyati  cast-anlasma-fiyati
           end-if
           

*           move xrez-xxx          to cast-oda-adet 
*           move xrez-xxx          to cast-kisi-konaklama
            move xrez-rec to rez-rec
             perform break-mami
                write cast-rec invalid 
                      rewrite cast-rec invalid continue
                      end-rewrite
                end-write
               
      if cast-rec not = eski-cast(1:function length(cast-rec)) then 
                perform log-operation-cast
        end-if 



            go cast-yaz-oku. 
 cast-isle-bitti. 
            close cast takasfiyat.
            close fiyat fiyatana hesayr break.
 cast-isle-exit. 
     exit. 
 cast-sil. 
           open i-o cast. 
         initialize cast-rec. 
        move xrez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-sil-bitti. 
 cast-sil-oku. 
        read cast  next no lock end go cast-sil-bitti. 
        if fs-cast = 99 go cast-sil-oku. 

        if cast-rez-no > xrez-no go cast-sil-bitti. 
        if cast-rez-no = xrez-no continue
        else 
           go cast-sil-oku
        end-if.
        if cast-tarih  < xrez-gir-tar or 
           cast-tarih  > xrez-cik-tar
        continue
        else 
           go cast-sil-oku
        end-if.
        delete cast invalid 
          continue.
          perform log-operation-cast
            go cast-sil-oku. 
 cast-sil-bitti. 
         close cast. 
 cast-sil-exit. 
     exit. 
 cast-iptal. 
***********> Bu bolum silinen rezervasyonlari casta silinmis olarak isletmek 
***********> icin konulmustu iptal edildi........... 
           open i-o cast. 
        initialize cast-rec. 
        move rez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-iptal-bitti. 
 cast-ipt-oku. 
        read cast  next no lock end go cast-iptal-bitti. 
        if fs-cast = 99 go cast-ipt-oku. 
        if cast-rez-no > rez-no go cast-iptal-bitti. 
        if cast-rez-no = rez-no continue
        else 
           go cast-ipt-oku
        end-if. 
********move "S" to cast-durumu. 
        rewrite cast-rec invalid 
            continue.
         perform log-operation-cast
            go cast-ipt-oku. 
 cast-iptal-bitti. 
         close cast. 
 cast-iptal-exit. 
     exit. 
 acenhrk-isle. 
********if xrez-tipi = 1 continue else go acenhrk-isle-exit. 
        if xrez-k-g-b = "K" continue
        else 
           go acenhrk-isle-exit
        end-if. 
        open i-o acenhrk bilbord. 
 acenhrk-basla. 
         move xrez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
               go acenhrk-isle-bitti. 
 acenhrk-oku-yaz. 
         read takvim next no lock end 
              go acenhrk-isle-bitti. 
         if fs-takvim = 99 go acenhrk-oku-yaz. 
         if takvim-anah = xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 


         if takvim-anah > xrez-cik-tar 
            go acenhrk-isle-bitti


         end-if. 
********>Bilbord rezervasyona yazsin..
         if xrez-bilbord-eh = "E"
            perform bilbord-isle thru bilbord-isle-exit
         end-if.
********>Bilbord rezervasyona yazsin...
         if fark-yok 
            go acenhrk-oku-yaz
         end-if
           move ac-kont to acenhrk-acenta
*****          move xrez-acenta      to acenhrk-acenta. 
          move takvim-anah      to acenhrk-tarih. 
          move xrez-fiyat-konumu  to acenhrk-oda-konumu. 
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
              invalid  
                  initialize acenhrk-rec  
                     move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g
                  move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
         end-write 
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue end-rewrite  
         end-read  
           move ac-kont to acenhrk-acenta

****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41 to acenhrk-oda-konumu  
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
           invalid  
                  initialize acenhrk-rec 
                    move ac-kont to acenhrk-acenta
****                 move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g  
                   move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write  
           not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move xrez-fiyat-konumu  to acenhrk-oda-konumu  
          move 5     to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid 
                  initialize acenhrk-rec 
                   move ac-kont to acenhrk-acenta 
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move 5     to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write 
         not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
            move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41  to acenhrk-oda-konumu  
          move 5    to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid
                  initialize acenhrk-rec  
                    move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move 5   to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                       rewrite acenhrk-rec invalid continue
                       end-rewrite
                  end-write
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue
                  end-rewrite
         end-read
         go acenhrk-oku-yaz. 
 acenhrk-isle-bitti. 
        close acenhrk bilbord.
 acenhrk-isle-exit. 
      exit. 
 bilbord-isle. 
          initialize bilbord-rec.
           move ac-bilb to bilbord-acenta
          
*********          move xrez-acenta      to bilbord-acenta. 
          move takvim-anah      to bilbord-tarih. 
          move xrez-fiyat-konumu  to bilbord-oda-tip. 

         read bilbord no lock invalid 
              initialize bilbord-rec
              move ac-bilb to bilbord-acenta
****              move xrez-acenta      to bilbord-acenta
              move takvim-anah      to bilbord-tarih 
              move xrez-fiyat-konumu  to bilbord-oda-tip 
              write bilbord-rec invalid 
                    display message box "Bilborda yazilamadi hata no : bil-1001"
              end-write
         end-read.
          compute  bilbord-sat-oda   = bilbord-sat-oda   + 1. 
          compute  bilbord-sat-buyuk = bilbord-sat-buyuk + xrez-buyuk. 
         rewrite bilbord-rec invalid 
                 display message box "Bilborda yazilamdi hata no : bil-1002"
         end-rewrite.
 bilbord-isle-exit. 
      exit. 
*
 acenhrk-sil. 
********if srez-tipi = continue else go acenhrk-sil-exit. 
        if srez-k-g-b = "K" continue
        else 
           go acenhrk-sil-exit
        end-if. 
        open i-o acenhrk bilbord. 
 acenhrk-s-basla. 
           move srez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
                 go acenhrk-sil-bitti. 
 acenhrk-oku-sil. 
        read takvim next no lock end 
             go acenhrk-sil-bitti. 
        if fs-takvim = 99 go acenhrk-oku-sil. 
        if takvim-anah = srez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
        if takvim-anah > srez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
********>Bilbord rezervasyona yazsin..
         if srez-bilbord-eh = "E"
            perform bilbord-sil thru bilbord-sil-exit
         end-if.
********>Bilbord rezervasyona yazsin..
         if fark-yok 
            go acenhrk-oku-sil 
         end-if
            move ac-kont to acenhrk-acenta
*****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move srez-fiyat-konumu  to acenhrk-oda-konumu. 
           move srez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
           not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
           rewrite acenhrk-rec invalid continue end-rewrite
           end-read
             move ac-kont to acenhrk-acenta
****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move srez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
            not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
***           move srez-acenta      to acenhrk-acenta. 
             move ac-kont to acenhrk-acenta
           move takvim-anah      to acenhrk-tarih. 
           move srez-fiyat-konumu  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
          not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
*****         move srez-acenta      to acenhrk-acenta 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
           not invalid  
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek

            rewrite acenhrk-rec invalid continue end-rewrite
          end-read
          go acenhrk-oku-sil. 
 acenhrk-sil-bitti. 
          close acenhrk bilbord. 
 acenhrk-sil-exit. 
        exit. 
 bilbord-sil. 
          initialize bilbord-rec.


          move ac-bilb to bilbord-acenta
********    move srez-acenta      to bilbord-acenta 
          move takvim-anah      to bilbord-tarih. 
          move srez-fiyat-konumu  to bilbord-oda-tip. 

         read bilbord no lock invalid 
              go bilbord-sil-exit
         end-read.
          if bilbord-sat-oda > 0
             compute  bilbord-sat-oda   = bilbord-sat-oda   - 1
          end-if. 
          if bilbord-sat-buyuk > 0
             compute  bilbord-sat-buyuk = bilbord-sat-buyuk - srez-buyuk
          end-if. 
         rewrite bilbord-rec invalid 
                 display message box "Bilborda yazilamadi hata no : bil-1003"
         end-rewrite.
 bilbord-sil-exit. 
      exit. 
 takvim-isle. 
        if xrez-k-g-b = "K" continue
        else 
           go takvim-isle-exit
        end-if. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-isle-exit. 
 takvim-oku-yaz. 
        read takvim next no lock end go takvim-isle-exit. 
        if fs-takvim = 99 go takvim-oku-yaz. 
        if takvim-anah = xrez-cik-tar go takvim-isle-exit. 
        if takvim-anah > xrez-cik-tar go takvim-isle-exit. 
          compute takvim-sat-oda(xrez-oda-konumu)   = 
                  takvim-sat-oda(xrez-oda-konumu)   + 1. 
          compute takvim-sat-buyuk(xrez-oda-konumu) = 
                  takvim-sat-buyuk(xrez-oda-konumu) + xrez-buyuk. 
          compute takvim-sat-kucuk(xrez-oda-konumu) = 
                  takvim-sat-kucuk(xrez-oda-konumu) + xrez-kucuk. 
          compute takvim-sat-free(xrez-oda-konumu)  = 
                  takvim-sat-free(xrez-oda-konumu)  + xrez-free. 
          compute takvim-sat-free(xrez-oda-konumu)  = 

                  takvim-sat-free(xrez-oda-konumu)  + xrez-bebek.
        rewrite takvim-rec invalid go takvim-oku-yaz. 
            go takvim-oku-yaz. 
 takvim-isle-exit. 
     exit. 
 takvim-sil. 
        if srez-k-g-b = "K" continue
        else 
           go takvim-sil-exit
        end-if. 
        move srez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-sil-exit. 
 takvim-oku-sil. 
        read takvim next no lock end go takvim-sil-exit. 
        if fs-takvim = 99 go takvim-oku-sil. 
        if takvim-anah = srez-cik-tar go takvim-sil-exit. 
        if takvim-anah > srez-cik-tar go takvim-sil-exit. 
          compute takvim-sat-oda(srez-oda-konumu)   = 
                  takvim-sat-oda(srez-oda-konumu)   - 1. 
          compute takvim-sat-buyuk(srez-oda-konumu) = 
                  takvim-sat-buyuk(srez-oda-konumu) - srez-buyuk. 
          compute takvim-sat-kucuk(srez-oda-konumu) = 
                  takvim-sat-kucuk(srez-oda-konumu) - srez-kucuk. 
          compute takvim-sat-free(srez-oda-konumu)  = 
                  takvim-sat-free(srez-oda-konumu)  - srez-free. 
          compute takvim-sat-free(srez-oda-konumu)  = 
                  takvim-sat-free(srez-oda-konumu)  - srez-bebek.
        rewrite takvim-rec invalid go takvim-oku-sil. 
            go takvim-oku-sil. 
takvim-sil-exit. 
     exit. 
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 
 kalis-bul. 
 kalis-start. 
      initialize takvim-rec kalis-kontrol. 
      move xrez-gir-tar   to takvim-anah. 
      start takvim key > takvim-anah invalid 
            go kalis-bul-bitti. 
 kalis-oku. 
      read takvim next no lock end go kalis-bul-bitti. 
      add 1 to kalis-kontrol. 
      if kalis-kontrol > kalis-gun go kalis-bul-bitti. 
      if kalis-kontrol = kalis-gun go kalis-bul-bitti. 
         go kalis-oku. 
 kalis-bul-bitti. 
       if kalis-kontrol not = kalis-gun 
          initialize mesaj-degiskenler
          move " [ Gun Yanlis ] " to mmesaj-title
          move "Kalis Gunu Kadar Tanimli Tarih Yok.." to mmesaj-1 
          move "Seciminizi Kontrol Ediniz.....!!!!!!" to mmesaj-2 
          move 1           to mmesaj-type
          move 3           to mmesaj-icon
          move 1           to mmesaj-default
               perform mmesaj-ver
       end-if.
          move takvim-anah   to xrez-cik-tar. 
          display accept-cik-gun
          display accept-cik-ay
          display accept-cik-yil.
 kalis-bul-exit. 
      exit. 
*
 rez-ara.
      initialize rez-cagir.
      move "I"   to rez-cagri-tipi
      call "/asya/ytl/obj/otel/rezara.asy" using rez-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/rezara.asy" 
       end-call.
       move rez-no-cagir  to xrez-no rez-no accept-rez-no.
       display accept-rezno.
 rez-ara-exit.
       exit.
*
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to xrez-acenta.

*
 acenta-oku.
       open input acenta.
       initialize acenta-rec acen-kara-list.
       move xrez-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme            
       not invalid 
            if firma-kodu  = spaces
            perform acen-dft-oku
           end-if
       end-read
     
       if genel-konum-upgrade-devrede = 1 and yeni-rez 
            if k1-rezer-sup not = 1 and acenta-munferit not = 1 
              display message box "Sadece Rezervasyon Yetkilisi Kaydedebilir.... "
              move 1 to GECMEZ2 
           end-if
       end-if
       if acenta-kara-liste = 1
          move 1        to gec-gecme
          move 1        to acen-kara-list
       end-if 
        if  acenta-kontenjan not = spaces 
          move acenta-kontenjan to ac-kont
          else 
          move acenta-kodu to ac-kont
        end-if
       if acenta-master not = spaces 
          move acenta-master to ac-bilb
          else 
          move acenta-kodu to ac-bilb
        end-if
       close acenta.
       move acenta-adi     to adi-goster.
       modify lb-acenta-e, title = adi-goster.
            if acenta-kredili = 1
               modify lb-acenta-kredimi,visible = true
            ELSE
               modify lb-acenta-kredimi,visible = false               
            end-if 
       if acenta-munferit = 1 
         move 1 to munferitmi
         else
          move 0 to munferitmi
        end-if 
        
         initialize adi-goster
       display accept-acenta b1 b2
       if yeni-rez and acenta-pasif = 1 
          move 1 to gecmez3
       end-if
       
       .

 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.

*
 sehir-ara.
      initialize sehir-cagir.
      call "/asya/ytl/obj/otel/sehara.asy" using sehir-cagir

           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/sehara.asy" 
      end-call.
      move sehir-cagir     to xrez-sehir.
 sehir-oku.
       open input sehir.
       initialize sehir-rec.
       move xrez-sehir    to sehir-anah1
       read sehir         no lock invalid 
            
             move "Tanimsiz Sehir " to sehir-adi
       end-read
       close sehir.
       move sehir-adi     to adi-goster.
       modify lb-sehir-e, title = adi-goster.
       initialize adi-goster
       display accept-sehir.
 sehir-oku-exit.
       exit.
 sehir-ara-exit.
       exit.

*
 firma-ara.
      initialize firma-cagir.
      call "/asya/ytl/obj/otel/firmara.asy" using firma-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/firmara.asy" 
       end-call.
       move firma-cagir     to xrez-firma.

*
 firma-oku.
       open input firma acenta.
       initialize firma-rec.
       move xrez-firma   to firma-kodu
       read firma        no lock invalid 
         if firma-kodu = spaces
             if acenta-tipi = 3 
                 move 1        to gec-gecme
              end-if
          else
           move 1 to gec-gecme
         end-if
         not invalid
            if firma-kredili = 1
               modify lb-firma-kredimi,visible = true
            ELSE
               modify lb-firma-kredimi,visible = false               
            end-if 
            perform firma-dft-oku
          
       end-read
       close firma acenta.
       move firma-adi     to adi-goster.
       modify lb-firma, title = adi-goster.
       initialize adi-goster
       display accept-firma.

 firma-oku-exit.
       exit.
 firma-ara-exit.
       exit.
*
*
 tacenta-ara.
       if tr-sec(1:8) not = "--------" then
          initialize acenarat-cagir
          move tr-sec(31:8) to acenarat-cagir-sirket
          move tr-sec(1:15) to acenarat-cagir-ip
          call "/asya/ytl/obj/otel/acenarat.asy" using acenarat-cagir
                on exception perform callerr-proc
                   not on exception
                   cancel "/asya/ytl/obj/otel/acenarat.asy" 
          end-call
          move acenarat-cagir-kod     to tr-acenta
       else
          initialize acenta-cagir
          call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
                on exception perform callerr-proc
                   not on exception
                   cancel "/asya/ytl/obj/otel/acenara.asy" 
          end-call
          move acenta-cagir     to tr-acenta
       end-if

       perform tacenta-oku.
*
 tacenta-oku.
       if tr-sec(1:8) = "--------" then
          exit paragraph
       end-if

       open input acenta 
       initialize acenta-rec 
       move tr-acenta   to acenta-kodu
       read acenta        no lock invalid 
           move "Tanimsiz Acenta " to t-adi-goster
           not invalid
           move acenta-adi to  t-adi-goster 
       end-read
       
       close acenta 
      
       display A2 A3.

*
 takvim-oku.
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.
 takvim-oku-exit.
       exit.
*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to xrez-banka.
 banka-oku.
       
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-banka-sabit = 1 and 
          acen-dft-banka not = xrez-banka
          display message box "Acenta icin sabit banka degeri girilmis" new-line
                              "Banka varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-banka to xrez-banka
        end-if.


       open input banka.
       initialize banka-rec.
       move xrez-banka    to banka-kodu
       read banka        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to adi-goster.
       modify lb-banka-e, title = adi-goster.
       initialize adi-goster
       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc


               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-doviz.
 doviz-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-doviz-sabit = 1 and 
          acen-dft-doviz not = xrez-doviz
          display message box "Acenta icin sabit doviz degeri girilmis " new-line
                              "Doviz varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-doviz to xrez-doviz
        end-if.
 
 
       open input doviz.
       initialize doviz-rec.
       move xrez-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-doviz-e, title = adi-goster.


       initialize adi-goster
       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.

       exit.
*
 ondoviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-on-doviz.
 ondoviz-oku.
       if xrez-on-doviz = 0 or xrez-on-doviz = spaces
          go ondoviz-oku-exit
       end-if.
       open input doviz.
       initialize doviz-rec.
       move xrez-on-doviz to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-ondoviz-e, title = adi-goster.
       initialize adi-goster
       display accept-ondoviz.
 ondoviz-oku-exit.
       exit.
 ondoviz-ara-exit.
       exit.
*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to xrez-pan-tipi.
 pansiyon-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pansiyon-sabit = 1 and 
          acen-dft-pan-tipi not = xrez-pan-tipi
          display message box "Acenta icin sabit pansiyon degeri girilmis" new-line
                              "Pansiyon varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pan-tipi to xrez-pan-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xrez-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pansiyon-e, title = adi-goster.

       initialize adi-goster
       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odemeara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-odeme-tipi.
 odeme-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-odeme-sabit = 1 and 
          acen-dft-odeme-tipi not = xrez-odeme-tipi
          display message box "Acenta icin sabit odeme degeri girilmis" new-line
                              "odeme varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-odeme-tipi to xrez-odeme-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu

       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-odeme-e, title = adi-goster.
       initialize adi-goster
       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy" 
       end-call.
       move infox-kodu-cagir     to xrez-anlasma.
 anlasma-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-anlasma-sabit = 1 and 
          acen-dft-anlasma not = xrez-anlasma
          display message box "Acenta icin sabit anlasma degeri girilmis" new-line
                              "Anlasma varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-anlasma to xrez-anlasma
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi.
       move xrez-anlasma       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-anlasma-e, title = adi-goster.
       initialize adi-goster
       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/pazarara.asy" 
       end-call.
       move pazar-kodu-cagir     to xrez-pazar.
 pazar-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pazar-sabit = 1 and 
          acen-dft-pazar not = xrez-pazar
          display message box "Acenta icin sabit pazar degeri girilmis" new-line
                              "Pazar varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pazar to xrez-pazar
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move xrez-pazar         to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pazar-e, title = adi-goster.
       initialize adi-goster
       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ulkeara.asy" 
       end-call.
       move ulke-cagir     to xrez-ulke.
 ulke-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-ulke-sabit = 1 and 
          acen-dft-ulke not = xrez-ulke 
          display message box "Acenta icin sabit ULKE  degeri girilmis" new-line
                              "ULKE  varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-ulke  to xrez-ulke 
        end-if.
       open input ulke ulkeek.
       initialize ulke-rec.
       move xrez-ulke    to ulke-anah1 ulkeek-anah1
       read ulke         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read

       read ulkeek no lock invalid
            move low-values to ulkeek-dft-pazar
       end-read 

       if ulkeek-dft-pazar <> low-values and spaces 
          move ulkeek-dft-pazar to xrez-pazar
          perform pazar-oku thru pazar-oku-exit
       end-if

       close ulke ulkeek.
       move ulke-adi     to adi-goster.
       modify lb-ulke-e, title = adi-goster.
       initialize adi-goster
       display accept-ulke

       .
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.
*
 oda-ara.
       exit  .
 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move xrez-odano     to odalar-anah
       read odalar         no lock invalid 
          if odalar-anah not = spaces
            move 1         to gec-gecme
          end-if
            not invalid continue 
       end-read
       close odalar.
       display accept-odano.
       perform xrez-oda-uzat.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.
*
 tab-1-Ev-Cmd-Tabchanged.
    inquire tab-1 value in form1-ta-1-value
    move 0 to tab-s-1-visible tab-s-2-visible tab-s-3-visible tab-s-4-visible 
               p1-vis
    display tab-s-1 
    display tab-s-2 
    display tab-s-3
    display tab-s-4
    display  gd2
    if form1-ta-1-value = 1
       move 1 to tab-s-1-visible 
       display tab-s-1 
    end-if 
    if form1-ta-1-value = 2
       move 1 to tab-s-2-visible
       display tab-s-2
    end-if 
    if form1-ta-1-value = 4
       move 1 to tab-s-4-visible p1-vis
       display tab-s-4 gd2
       move 4 to accept-control
       move 48 to control-id

    end-if 
    
    if form1-ta-1-value = 3
*       if xrez-on-doviz not = 0 or xrez-on-doviz not = spaces
          perform toplam-odeme-bul thru  toplam-odeme-bul-exit
*       end-if
       move 1 to tab-s-3-visible
       display tab-s-3
    end-if 
    move event-action-ignore to event-action.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

     .
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form1-Aft-Routine.
     close rez takvim odalar2.
     perform kilit-aft-routine.     

*
 gun-bul.
     initialize gun-s
     move Xrez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= Xrez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      
                      end-if 
                end-read
             end-perform  
     end-start.
     move gun-s to gun-say
     display la-gun
      .
*
 aksiyon-toplam-bul.
        initialize aksiyonlu-toplam
        move xrez-gir-tar to takvim-anah
        start takvim key not < takvim-anah 
           invalid 
              display message box "Takvim Bulunamadi"
            not invalid 
                perform varying i from 1 by 1 until i > aksiyhrk-ode
                 read takvim next no lock
                    end 
                       exit perform
                   not end 
                     perform gunluk-bul
                     add oda-fiyati to aksiyonlu-toplam
                  end-read  
                 end-perform
         end-start.
          .
*
 gunluk-bul.
        move 0 to oda-fiyati. 
        move xrez-acenta        to fiyat-acenta. 
        move takvim-anah        to fiyat-tarih. 
        move xrez-tipi          to fiyat-rez-tipi. 
        move xrez-pan-tipi      to fiyat-pan-tipi. 
        move xrez-banka         to fiyat-banka. 
        move xrez-doviz         to fiyat-doviz. 
        move xrez-anlasma       to fiyat-anlasma. 
        move xrez-buyuk         to fiyat-buyuk.
        move xrez-kucuk         to fiyat-kucuk.
        read fiyat no lock invalid 
         
        exit paragraph.
             move fiyat-acenta    to fiyatana-acenta. 
             move fiyat-bas-tarih to fiyatana-ilk-tarih.
             move fiyat-bit-tarih to fiyatana-son-tarih.
             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
             move fiyat-banka     to fiyatana-banka. 
             move fiyat-doviz     to fiyatana-doviz. 
             move fiyat-anlasma   to fiyatana-anlasma. 
             move fiyat-buyuk     to fiyatana-buyuk.
             move fiyat-kucuk     to fiyatana-kucuk.
             read fiyatana no lock invalid 
             exit paragraph .

       move fiyatana-oda-fiyati(xrez-fiyat-konumu) to oda-fiyati. 
*/********* 
       if xrez-nor-indirim not = 0 
       compute oda-fiyati rounded = 
              (((oda-fiyati * xrez-nor-indirim) / 100) - oda-fiyati)
       end-if.
*/Early booking orani var ve early booking uygulanacak ise 
       if xrez-eb = "E" and fiyatana-eb-oran not = 0 
       compute oda-fiyati rounded = 
              (((oda-fiyati * (fiyatana-eb-oran +( fiyatana-eb-kusur / 100) )) / 100) - oda-fiyati)
       end-if. 
*/Kick back orani
       if  fiyatana-ug-oran not = 0 and gun-s > fiyatana-ug-geceleme  
           and xrez-ug-ind =1 then
       compute oda-fiyati rounded = 
              (((oda-fiyati * fiyatana-ug-oran) / 100) - oda-fiyati)
       end-if. 
       if xrez-ozel-durum-car > 0
       compute oda-fiyati rounded = 
              (oda-fiyati * xrez-ozel-durum-car) / 100
       end-if.
       if fiyatana-kick-back <> 0
       compute oda-fiyati  rounded = 
              (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
       end-if.
       if fiyatana-kick-back2 <> 0
       compute oda-fiyati  rounded = 
              (((oda-fiyati * fiyatana-kick-back2) / 1000) - oda-fiyati)
       end-if.
      .
*
 kont-goster.
       perform acu-form4-routine
       add 1 to sonraki-id
             move sonraki-id to control-id

       move 4 to accept-control
       .
*
 Form4-Aft-Initdata.

*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

      if cogalt-adet > 0 then 
         move cogalt-adet  to ek
       else
       if rez-yeni-eski = "Y"
          move 1 to ek
           else 
          move 0 to ek
       end-if
       end-if
       initialize gr-kayit     v-release
          open input acenhrk bilbord 
       move " Tarih "  to gd-1-col-1
       move "Kont"     to gd-1-col-2
       move "Gerc"     to gd-1-col-3

       move "Kont"     to gd-1-col-4
       move "Gerc"     to gd-1-col-5

       move "Kont"     to gd-1-col-6
       move "Gerc"     to gd-1-col-7

       move "Kont"     to gd-1-col-8
       move "Gerc"     to gd-1-col-9

       move "Haz."     to gd-1-col-10
       move "Sat."     to gd-1-col-11

       move "Haz."     to gd-1-col-12
       move "Sat."     to gd-1-col-13
       move "Ver."     to gd-1-col-14
       move "Sat."     to gd-1-col-15
       open input konum
       move xrez-fiyat-konumu to konum-anahtar
       read konum no lock invalid move all "*" to konum-adi
       end-read
      
       move konum-adi(1:5)    to l-tip(1:5)
       move konum-adi(1:5) to l-odatop(1:5)

       move xrez-oda-konumu to konum-anahtar
       read konum no lock invalid 
            move all "*" to konum-adi
       end-read
        

        close konum
       move konum-adi(1:9) to l-otelkon
       evaluate xrez-s-d-t-g
          when 1
          when 2
          when 3
             move "Sng" to l-tip(7:3)
             move "Single" to l-tiptop(1:5)
*/**************lonicera mustafa bey isterk emine hanm bilgisi var 
*          when 2

*             move "Dbl" to l-tip(7:3)
*             move "Double" to l-tiptop(1:5)
*          when 3
*             move "Trp" to l-tip(7:3)
*             move "Triple" to l-tiptop(1:5)
*/**************lonicera mustafa bey isterk emine hanm bilgisi var 
          when 4
             move "Grp" to l-tip(7:3)
             move "Group " to l-tiptop(1:5)
       end-evaluate
       move acenta-adi to l-acen(1:10)
       display l-1 l-2 l-3 l-4 l-5 l-6 l-01
       modify gd-1 record-to-add = gd-data
       add 1 to gr-kayit
       move xrez-gir-tar to takvim-anah
       start takvim key >= takvim-anah  
          invalid 
            display message box "Takvim Hatasi 4367"
          not invalid
          perform until fs-takvim = "10" 
             read takvim next no lock
              end 
                display message box "Takvim Hatasi 4367" 
                move "10" to fs-takvim 
              not end
                if takvim-anah >= xrez-cik-tar then 
                   move "10" to fs-takvim
                 else
                   move takvim-gun to  egun
                   move takvim-ay  to  eay
                   move takvim-yil to  eyil
                   move etarih   to gd-1-col-1
                   initialize kirmizi
                   move takvim-anah to  acenhrk-tarih bilbord-tarih
************************* acenta okunmas yaplabilir                   
                   
**************    move xrez-acenta  to acenhrk-acenta bilbord-acenta
                   move ac-bilb to bilbord-acenta
                   move ac-kont to acenhrk-acenta
                   move rezpara-kont-tipi to acenhrk-s-d-t-g 
                   if rezpara-kont-tipi = 0              
                     move xrez-s-d-t-g    to acenhrk-s-d-t-g
                   end-if  
*/***lonicera mustafa bey istek emine hanm bilgisi var 
                   evaluate xrez-s-d-t-g
                   when 1 
                   when 2
                   when 3 
                     move 1                 to acenhrk-s-d-t-g
                   when other
                     move xrez-s-d-t-g      to acenhrk-s-d-t-g
                   end-evaluate 
                   
*/***lonicera mustafa bey istek emine hanm bilgisi var                    
                   move xrez-fiyat-konumu to acenhrk-oda-konumu bilbord-oda-tip
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else

                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-2
                    add ek to   acenhrk-sat-oda 
                   move acenhrk-sat-oda to 4-z 
                   move 4-z to gd-1-col-3
                   if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(3:1)
                    end-if 
                  

                   move 5 to acenhrk-s-d-t-g
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-4
                   add ek to   acenhrk-sat-oda 
                  
                   move acenhrk-sat-oda to 4-z 




                   move 4-z             to gd-1-col-5
                    if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(5:1)
                    end-if
                   
                   move xrez-s-d-t-g   to acenhrk-s-d-t-g

                   evaluate xrez-s-d-t-g
                   when 1 
                   when 2
                   when 3 
                     move 1                 to acenhrk-s-d-t-g
                   when other
                     move xrez-s-d-t-g      to acenhrk-s-d-t-g
                   end-evaluate 

                   move 41 to  acenhrk-oda-konumu
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   if acenhrk-kontrat-oda > 999 then 

                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-6
                    add ek to   acenhrk-sat-oda 
                    
                   move acenhrk-sat-oda to 4-z 
                   move 4-z             to gd-1-col-7
                     if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(7:1)
                    end-if

                   move 41 to acenhrk-oda-konumu   
                   move 5  to acenhrk-s-d-t-g
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-8
                     add ek to   acenhrk-sat-oda 
                    
                   move acenhrk-sat-oda to 4-z 
                   move 4-z     to gd-1-col-9

                     if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(9:1)
                    end-if
                     move konum-hazir-oda to 4-z 
                   move 4-z     to gd-1-col-10
          
                   initialize top-satilan
                  
                    compute top-satilan = top-satilan + 
                         takvim-sat-oda(xrez-oda-konumu)
                 
                   add ek to top-satilan
                   move top-satilan to 4-z 
                   move 4-z to gd-1-col-11  
                   if   top-satilan > konum-hazir-oda
                       move "E" to kirmizi(11:1)
                   end-if
                   
                   move takvim-hazir-oda to 4-z 
                   move 4-z     to gd-1-col-12
                      
                   initialize top-satilan
                  
                   perform varying j from 1 by 1 until j > 40
                    compute top-satilan = top-satilan + 
                          takvim-sat-oda(j)                         
                   end-perform     
                   add ek to top-satilan
                   move top-satilan to 4-z 
                   if   top-satilan > takvim-hazir-oda
                       move "E" to kirmizi(13:1)
                   end-if   
                  
                   move 4-z to gd-1-col-13
                   initialize   gd-1-col-14 gd-1-col-15
                    read bilbord no lock 
                       invalid
                        initialize bilbord-oda bilbord-sat-oda bilbord-rson-tarih
                        not invalid

                         move bilbord-oda to 4-z 
                         move 4-z to gd-1-col-14
                         if xrez-bilbord-eh  = "E" then 
                            add ek to bilbord-sat-oda
                         end-if
                         move bilbord-sat-oda to 4-z 
                         move 4-z to gd-1-col-15
                          if bilbord-sat-oda > bilbord-oda
                             move "E" to kirmizi(15:1)
                          end-if  
                         move 1 to bilbord-oda-tip
                          read bilbord no lock
                             invalid
                               initialize bilbord-rson-tarih 
                            end-read

                          if bilbord-rson-tarih < tarih-tasi and 
                             bilbord-rson-tarih > "20000000" then 
                             move 1 to v-release
                         end-if
                    end-read
                end-if
             end-read
             if fs-takvim not = "10" then 
                 modify gd-1 record-to-add = gd-data  
                 add 1 to gr-kayit
                 perform varying mm from 1 by 1 until mm > 15
                  if kirmizi( mm : 1 ) = "E" then 
                    modify gd-1(gr-kayit, mm),
                      cell-color = 141
                   end-if
                  end-perform
             end-if
          end-perform 
       end-start
          display l-release
        close acenhrk bilbord
     .
*******************************************************************
************ mesaj receiving olayi *******************************
 form-update.
    
       display form1
       perform xrez-oda-uzat
       move 0   to p1-vis
       display gd2
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc

       if xrez-no > 0 then
            if link-var not = 5 and link-var not = 6 and link-var not = 7 and link-var not = 11 

           move 1 to link-nereden 
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move xrez-anah to link-NOT-DOS-ANAH   
           move 1 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
             display not-ac
             move xrez-acen-anah to son-not-d
           end-if 
         end-if
     
       .
*
*
 firma-dft-oku.
      open input nt
     initialize not-rec 
     move "FIR" to not-dos
     move "Default" to not-dos-anah.
     move firma-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
          
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 firma-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar

       move acen-dft-kaynak-1         to xrez-kaynak-1
       move acen-dft-kaynak-2         to xrez-kaynak-2
       move acen-dft-kaynak-3         to xrez-kaynak-3

       if acen-dft-early= 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if
       modify eraly-booking-cb, value = acen-dft-early
       modify fix-fiyat-cb, value = acen-dft-fix
       modify aksiyon-cb, value = acen-dft-aksiyon-yok
       modify bilbord-cb, value = acen-dft-bilboard 
       modify special-cb, value = acen-dft-special-yok
       perform eraly-booking-cb-Ex-Cmd-Clicked
       perform fix-fiyat-cb-Ex-Cmd-Clicked
       perform bilbord-cb-Ex-Cmd-Clicked
       perform special-cb-Ex-Cmd-Clicked

       perform aksiyon-cb-Ex-Cmd-Clicked
          
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke    
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform kaynak1-goster             perform kaynak2-goster
            perform kaynak3-goster

      .
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
       move   acen-dft-kaynak-1      to xrez-kaynak-1
       move   acen-dft-kaynak-2      to xrez-kaynak-2
       move   acen-dft-kaynak-3      to xrez-kaynak-3
       move   acen-dft-ozl-drm       to xrez-ozel-durum

       if   acen-dft-vip not = spaces then
           move   acen-dft-vip          to xrez-vip
       end-if
       if acen-dft-early= 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if
       modify eraly-booking-cb, value = acen-dft-early
       modify fix-fiyat-cb, value = acen-dft-fix
       modify aksiyon-cb, value = acen-dft-aksiyon-yok
       modify bilbord-cb, value = acen-dft-bilboard 
       modify special-cb, value = acen-dft-special-yok

       perform eraly-booking-cb-Ex-Cmd-Clicked
       perform fix-fiyat-cb-Ex-Cmd-Clicked
       perform bilbord-cb-Ex-Cmd-Clicked
       perform special-cb-Ex-Cmd-Clicked
       perform aksiyon-cb-Ex-Cmd-Clicked

         display accept-banka     accept-anlasmaa accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke   Form1-Pb-4  acc-kaynak1 acc-kaynak2 acc-kaynak3
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
               perform vip-goster
          if xrez-pan-tipi not = spaces 
            perform pansiyon-oku thru pansiyon-oku-exit
            else
             initialize  adi-goster
             modify lb-pansiyon-e, title = adi-goster
          end-if
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            perform ozel-after

      .
 kontrat-kontrol. 
         move "V" to kontrat-var-yok. 
         if xrez-tipi = 1 continue
            else go kontrat-kontrol-exit
         end-if.
         open input acenhrk. 
 kontrat-basla. 
          initialize acenhrk-rec. 
            move ac-kont to acenhrk-acenta
*****          move xrez-acenta  to acenhrk-acenta. 
          move xrez-gir-tar to acenhrk-tarih. 
          start acenhrk key not < acenhrk-anah invalid 
                go kontrat-yok. 
 kontrat-oku. 
         read acenhrk  next no lock end 
              go kontrat-yok. 
         if fs-acenhrk   = 99 go kontrat-oku. 
***         if acenhrk-acenta  = xrez-acenta continue
           if acenhrk-acenta  = ac-kont  continue
         else 

            go kontrat-yok. 
         if acenhrk-tarih not > xrez-gir-tar continue
         else 
            go kontrat-yok. 
         if acenhrk-kontrat-oda = 0 go kontrat-oku. 
            close acenhrk. 
            go kontrat-kontrol-exit. 
 kontrat-yok. 
            move "Y" to kontrat-var-yok. 
            close acenhrk. 
            initialize mesaj-degiskenler
            move " [ Kontrat Uyari] " to mmesaj-title
            move " Bu Acentanin Bu Tarihlerde Kontrati YOK.... "  to mmesaj-1
            move " Rezervasyon Tipini Degistirin.............. "  to mmesaj-2
            move 1           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver.
 kontrat-kontrol-exit. 
           exit. 
*
*
 Screen1-Pb-1-Link.
         set exit-pushed to true
     .

*
 op-ara.
    initialize pazar-cagir.
    move "O"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/opara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/opara.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-operator
    perform op-goster
    .
*
 vip-ara.
    initialize infox-cagir
    move "v"   to infox-tipi-cagir
    call "/asya/ytl/obj/otel/vipara.asy" using infox-cagir
       on exception perform callerr-proc
          not on exception
    cancel "/asya/ytl/obj/otel/vipara.asy" 
    end-call
    move infox-kodu-cagir     to xrez-vip
    perform vip-goster.
* 
 vip-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "v" to kodlar02-tipi
    move xrez-vip to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to lb-vip-adi
    display acc-viptipi lb-vip
    close kodlar02.

    .
*
 vip-turu-ara.
    initialize infox-cagir
    move "z"   to infox-tipi-cagir
    call "/asya/ytl/obj/otel/vipyara.asy" using infox-cagir
       on exception perform callerr-proc
          not on exception
    cancel "/asya/ytl/obj/otel/vipyara.asy" 
    end-call
    move infox-kodu-cagir     to xrez-vip-turu
    
    perform vip-turu-goster.
* 
 vip-turu-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "z"           to kodlar02-tipi
    move xrez-vip-turu to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi  to lb-vip-turu-adi
    display acc-vipturu  lb-vip-turu
    close kodlar02.
*
 rehber-ara.
    initialize pazar-cagir.
    move "O"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/rehara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/rehara.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-rehber
    perform rehber-goster.
* 
 rehber-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "R" to kodlar02-tipi
    move xrez-rehber to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to reh-goster-val
    display acc-rehber lb-rehber
    close kodlar02.

* 
 op-goster.
    open input kodlar02
    initialize kodlar02-rec  opcode-yok
    move "O" to kodlar02-tipi
    move xrez-operator to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
       move 1 to  opcode-yok 
    end-read
    move kodlar02-adi to op-goster
    display acc-op lb-op
    close kodlar02.

*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec kaynak1-yok
    move "AB" to onbkodlar10-tipi
    move xrez-kaynak-1 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
        move 1 to kaynak1-yok
    end-read
    move onbkodlar10-adi to kaynak1-tipi-goster
    display acc-kaynak1 lb-kaynak1
    close onbkodlar10.

 kaynak2-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec  kaynak2-yok
    move "AC" to onbkodlar10-tipi
    move xrez-kaynak-2 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
         move 1 to kaynak2-yok
    end-read
    move onbkodlar10-adi to kaynak2-tipi-goster
    display acc-kaynak2 lb-kaynak2
    close onbkodlar10.

 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec     kaynak3-yok
    move "AD" to onbkodlar10-tipi




    move xrez-kaynak-3 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
         move 1 to kaynak3-yok
    end-read
    move onbkodlar10-adi to kaynak3-tipi-goster
    display acc-kaynak3 lb-kaynak3
    close onbkodlar10.

*
 kaynak1-ara.
    initialize kaynak-cagir.
    move "AB"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk1ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk1ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-1
    perform kaynak1-goster
    .

 kaynak2-ara.
    initialize kaynak-cagir.
    move "AC"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk2ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk2ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-2
    perform kaynak2-goster
    .
 kaynak3-ara.
    initialize kaynak-cagir.
    move "AD"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk3ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk3ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-3
    perform kaynak3-goster
    .


*
 odatipi-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "G" to kodlar02-tipi
    move xrez-oda-tipi to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster
    display acc-odatip lb-odatip
    close kodlar02.

 odatipi-goster2.
    open input kodlar02
    initialize kodlar02-rec
    move "H" to kodlar02-tipi
    move xrez-oda-tipi2 to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster2
    display acc-odatip2 lb-odatip2
    close kodlar02.

 odatipi-goster3.
    open input kodlar02
    initialize kodlar02-rec
    move "I" to kodlar02-tipi
    move xrez-oda-tipi3 to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster3
    display acc-odatip3 lb-odatip3
    close kodlar02.
    .
*
 odatipi-ara.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-oda-tipi
    perform odatipi-goster
    .

 odatipi-ara2.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara2.asy"
      using pazar-cagir
      on exception


         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara2.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-oda-tipi2
    perform odatipi-goster2.
    .
 odatipi-ara3.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara3.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara3.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-oda-tipi3
    perform odatipi-goster3.
*
 ozel-after. 
         
    if xrez-acenta = not-dos-anah(8:4) and
       acen-dft-ozl-drm-sabit = 1 and 
       acen-dft-ozl-drm not = xrez-ozel-durum
       display message box "Acenta icin sabit Ozel durum degeri girilmis " new-line
                           "Ozel Durum varsayilan degerine degistirildi"
                           title "Bilginize"
        move acen-dft-ozl-drm to xrez-ozel-durum
    end-if.

    open input kodlar02.
    initialize kodlar02-rec.
    move "Z"                to kodlar02-tipi.
    move xrez-ozel-durum    to kodlar02-kodu
    read kodlar02 no lock invalid 
         continue
         not invalid continue 
    end-read
    close kodlar02.
    move kodlar02-adi       to ozel-adi-goster.
    modify lb-anlasma-ea,   title = ozel-adi-goster.
    move kodlar02-sayisal   to xrez-ozel-durum-car
    move kodlar02-ozl-tipi  to xREZ-ozel-tip 
    display accept-anlasmaa.
    
    if munferitmi = 1 
         initialize          link-t
        
         move xrez-no to Lnk-rez
          call "/asya/ytl/obj/otel/onodebul.asy" using link-t
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/onodebul.asy" 
       end-call




        move  lnk-kalan to z-alinacak
        move 1 to vis-web-odeme
        if lnk-kalan > 0 
        initialize   web-text(2)  web-text(1) web-text(3) 
       move  "GIRISDE ODEMELI KONAKLAMA" to web-text(1) 
        string z-alinacak " " d-kisa-adi delimited by size into web-text(2) 
        move "DAHA ODEME ALMALISINIZ" to web-text(3)
          move 176 to web-color
        else
         initialize   web-text(2)  web-text(1) web-text(3)
          if xrez-durumu = "S" 
               move  lnk-odeme to z-alinacak
               move  "SILINMIS" to web-text(1) 
                string "MUNFERIT REZ" into web-text(2) 


          else
               
                move  lnk-odeme to z-alinacak
               move  "ODEME OK" to web-text(1) 
                string z-alinacak " " d-kisa-adi delimited by size into web-text(2) 
                move "ODEME ALINMIS ODEME OK" to web-text(3)
               
           end-if


                move  112 to web-color 
       end-if
     else
       move 0 to vis-web-odeme 
    |if xrez-ozel-durum >= 91  then 
         open input rezweb
          move xrez-no to  rezweb-anah
          read rezweb no lock invalid 
              move 0 to vis-web-odeme
          not invalid 
             evaluate rezweb-pkodu(1:1)
                when 1 | esnek 
                                   
                 move " ODEMESIZ WEB SATISI " to web-text(1) 
                 move " C/IN DE ODEME ALMAYI " to web-text(2)  
                 move " UNUTMAYINIZ."   to web-text(3)
                    move  112 to web-color 
                when 2  | tam odeme 
                   
                  if xrez-ozel-durum >= 91
                         move " TAMAMI ODEMELI WEB SATISI " to web-text(1) 
                         move " MISAFIRDEN ODEMENIN TAMAMI " to web-text(2)  
                         move " ALINMISTIR."   to web-text(3)
                         move 176 to web-color 
                  end-if
                  if xrez-ozel-durum = zeroes
                           move " KISMI ODEMESI ALINMIS WEB " to web-text(1) 
                           move " SATISIN KALAN KISMINI  " to web-text(2)  
                           move " TAHSIL ETMEYI UNUTMAYINIZ!"   to web-text(3)
        
                              MOVE 144 TO WEB-COLOR
                  end-if
      


                when 3   |havale
                  move " HAVALE TAHADDUTLU WEB SATISI " to web-text(1) 
                  move " HAVALE ONAYLANMAMIS " to web-text(2)  
                  move " KONTROL EDINIZ."   to web-text(3)
                    MOVE  336  to web-color 
               when 8
                           move " KISMI ODEMESI ALINMIS WEB " to web-text(1) 
                           move " SATISIN KALAN KISMINI  " to web-text(2)  
                           move " TAHSIL ETMEYI UNUTMAYINIZ!"   to web-text(3)
        
                              MOVE 144 TO WEB-COLOR

               when 9
                         move " TAMAMI ODEMELI WEB SATISI " to web-text(1) 
                         move " MISAFIRDEN ODEMENIN TAMAMI " to web-text(2)  
                         move " ALINMISTIR."   to web-text(3)
                         move 176 to web-color 

               WHEN OTHER 
                    move " ODEMESIZ WEB SATISI " to web-text(1) 
                 move " C/IN DE ODEME ALMAYI " to web-text(2)  
                 move " UNUTMAYINIZ."   to web-text(3)
                    move  112 to web-color 
           
             end-evaluate 
            move 1 to vis-web-odeme 
          end-read
         close rezweb
      end-if
         |else

      
    |end-if.
    display a1a.
*
 ozel-ara.
      initialize odeme-cagir.
      move "Z"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/ozelara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ozelara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-ozel-durum.
       display accept-anlasmaa.
*
 oda-ara2.
      initialize blok-cagir
      move "M" to oda-db-cagir
      move xrez-oda-konumu   to oda-konum-cagir.
      move xrez-gir-tar to    blok-bas-tar
      move xrez-cik-tar to    blok-bit-tar
      move xrez-no     to  blok-rez-no
      call "/asya/ytl/obj/otel/odaara2.asy" 
            using oda-cagir, blok-bas-tar, 
                  blok-bit-tar, blok-rez-no
           on exception perform callerr-proc
       not on exception
      cancel "/asya/ytl/obj/otel/odaara2.asy" 
      end-call.
      move odano-cagir     to xrez-odano
      display accept-odano
      perform xrez-oda-uzat
      initialize blok-cagir.
*
 blok-kont2.
    
     perform oda-oku thru oda-oku-exit
            if gecmez
                  initialize xrez-odano
                  move ydk-odano to xrez-odano
                  display accept-odano
                  perform xrez-oda-uzat
                  move 1 to gec-gecme
                  exit paragraph
            end-if

             if odalar-anah not = spaces
               if rezpara-blokaj-farkli = "H" and 
                  xrez-oda-konumu not = odalar-konumu 
                    perform blokaj-konum-farkli thru blokaj-konum-farkli-exit 
                    move 1 to gec-gecme
                    exit paragraph
               else
                  continue
               end-if
             end-if
               








               initialize blok-cagir 
               move xrez-gir-tar    to blok-bas-tar 
               move xrez-cik-tar    to blok-bit-tar 
               move xrez-no         to blok-rez-no 
               move xrez-odano      to blok-oda 
               move xrez-sharenum   to blok-sharenum
               call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokara.asy" 
               end-call
               if rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H" 
                  initialize xrez-odano
                  move ydk-odano to xrez-odano
                  display accept-odano
                  perform xrez-oda-uzat
                  move 1 to gec-gecme
                  exit paragraph
                  else
                  move xrez-odano to ydk-odano
                 
                  if odalar-anah not = spaces and odalar-konumu not = spaces then 
                    move odalar-konumu to xrez-oda-konumu oda-konumu-combo-value  
                    display oda-konumu-combo
                  end-if
               end-if
                     .
*
 grara.
      initialize  grtumrez-rec onb-hata   grsayi
      open  input grtumrez
      if onb-hata = 1
         display message box "Repeat Guest listesi alinamadi" new-line 
                              "Bakim Menusunden Forecastlari yeniden olustura girip" new-line
                              "GR olustur butonunu tiklayiniz" new-line
            exit paragraph                      
      end-if
      move  aranacak-adi to grtumrez-adi
      move aranacak-soyadi to grtumrez-soyadi
        start grtumrez key not < grtumrez-soyad
         invalid continue
         not invalid
           perform until fs-grtumrez = "10"
             read grtumrez next no lock
                end move "10" to fs-grtumrez
                not end
                  if xrez-no  = grtumrez-no
                     exit perform cycle
                  end-if
                  if aranacak-soyadi not = grtumrez-soyadi
                     move "10" to fs-grtumrez
                     exit perform cycle
                  end-if
                  if rezpara-eskimus-soyad   =  1  or 
                      ( aranacak-adi =  grtumrez-adi )

                    move 1 to grsayi

                    move "10" to fs-grtumrez
                  end-if
             end-read
           end-perform 
       end-start
       close grtumrez .
       if grsayi > 0 then 
           
           MOVE CONTROL-ID TO SONRAKI-ID
           perform acu-grform-routine
           EVALUATE SONRAKI-ID
              WHEN 49
                MOVE 53 TO SONRAKI-ID
              WHEN 63
               MOVE 60 TO SONRAKI-ID
              WHEN 66
               MOVE 67 TO SONRAKI-ID
              WHEN 76
                  MOVE 79 TO SONRAKI-ID

              WHEN OTHER
              ADD 1 TO SONRAKI-ID
           END-EVALUATE
           MOVE SONRAKI-ID TO CONTROL-ID
             MOVE 4 TO ACCEPT-CONTROL
              
       end-if
       
     .
*
 grform-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

       if rezpara-eskimus-soyad not = 1
       move 0   to sadece-soyad
       else 
       move 1   to sadece-soyad
       end-if
       display grform-Cb-2
       perform gr-bul
       .
*
 gr-bul.
    
       initialize fs-grtumrez fs-grrez
       move EKRAN-FIS-1 to takasgr-dno.
       open output takasgr. close takasgr open i-o takasgr. 
       open input grtumrez
       initialize grtumrez-rec grsayi
       if aranacak-soyadi not = spaces
           move aranacak-soyadi to grtumrez-soyadi  
         start grtumrez key >= grtumrez-soyad 
          invalid continue
          not invalid
          perform until fs-grtumrez= "10" or grsayi > 30
            read grtumrez next no lock 
              end move "10" to fs-grtumrez
              not end 
                if aranacak-soyadi not = grtumrez-soyadi
                  move "10" to fs-grtumrez


                  else
                   if grtumrez-NO = xrez-no then 
                     exit perform cycle
                   end-if
                   if sadece-soyad = 0 and 
                   aranacak-adi(1:15) not = grtumrez-adi(1:15)
                   exit perform cycle
                   end-if
                   if gircik-gosterme = 1 and 
                      aranacak-adi(1:15)  = grtumrez-adi(1:15) and
                      (xrez-gir-tar = grtumrez-cik-tar or
                       xrez-cik-tar = grtumrez-gir-tar) 
                      exit perform cycle
                   end-if
                   if gircik-gosterme = 1 and 
                      takasgr-adi(1:15)  = grtumrez-adi(1:15) and
                      (takasgr-gir-tar = grtumrez-cik-tar or
                       takasgr-cik-tar = grtumrez-gir-tar) 

                      exit perform cycle
                   end-if
                    move grtumrez-rec to takasgr-rec
                    initialize takasgr-sira
                    write takasgr-rec invalid continue
                    not invalid
                      add  1 to grsayi
                    end-write
                    
                end-if 
            end-read    


          end-perform 
       end-start
       end-if
*       if soy2 not = spaces and grsayi < 30

*        initialize grtumrez-rec
*       move soy2 to grtumrez-soyadi  
*       start grtumrez key > grtumrez-soyad 
*          invalid continue
*          not invalid
*          perform until fs-grtumrez= "10" or grsayi > 30
*            read grtumrez next no lock 

*              end move "10" to fs-grtumrez
*              not end 
*                if soy2(1:15) not = grtumrez-soyadi(1:15)
*                  move "10" to fs-grtumrez
*                  else
*                   if sadece-soyad = 0 and 
*                   adi2(1:15) not = grtumrez-adi(1:15)
*                   exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      adi2(1:15)  = grtumrez-adi(1:15) and
*                      (xrez-gir-tar = grtumrez-cik-tar or
*                       xrez-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      takasgr-adi(1:15)  = grtumrez-adi(1:15) and
*                      (takasgr-gir-tar = grtumrez-cik-tar or
*                       takasgr-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                    move grtumrez-rec to takasgr-rec
*                    initialize takasgr-sira
*                    write takasgr-rec invalid continue
*                    not invalid
*                      add  1 to grsayi
*                    end-write
*                end-if 
*            end-read    
*          end-perform 
*       end-start
*       end-if
*        if soy3 not = spaces and grsayi < 30
*
*        initialize grtumrez-rec
*      move soy3 to grtumrez-soyadi  
*       start grtumrez key > grtumrez-soyad 

*          invalid continue
*          not invalid
*          perform until fs-grtumrez= "10" or grsayi > 30
*            read grtumrez next no lock 
*              end move "10" to fs-grtumrez
*              not end 
*                if soy3(1:15) not = grtumrez-soyadi(1:15)
*                  move "10" to fs-grtumrez
*                  else
*                   if sadece-soyad = 0 and 
*                       adi3(1:15) not = grtumrez-adi(1:15)
*                   exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      adi3(1:15)  = grtumrez-adi(1:15) and
*                      (xrez-gir-tar = grtumrez-cik-tar or
*                       xrez-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      takasgr-adi(1:15)  = grtumrez-adi(1:15) and
*                      (takasgr-gir-tar = grtumrez-cik-tar or
*                       takasgr-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                    move grtumrez-rec to takasgr-rec
*                    initialize takasgr-sira
*                    write takasgr-rec invalid continue
*                    not invalid
*                      add  1 to grsayi
*                    end-write
*                end-if 
*            end-read    
*          end-perform 
*       end-start
*       end-if
       modify  grform-Gd-1 reset-grid = 1 mass-update = 1
            move "SIRKET"        to   gr-klasor
            move "ADI"           to   gr-adi
            move "SOYADI"        to   gr-soy
            move "Giris Tar"     to   gr-giris-tar
            move "Cikis Tar"     to   gr-cikis-tar
            move "Dogum Tar"     to   gr-dogum-tar
            move "ODA"           to   gr-odano
          close grtumrez
       modify  grform-Gd-1 record-to-add  grform-Gd-1-Record
         initialize takasgr-rec  fs-takasgr
         start takasgr key > takasgr-soyad
          invalid 
           continue
          not invalid
          perform until fs-takasgr = "10"
           read takasgr next no lock 
            end move "10" to fs-takasgr 
            not end

            move takasgr-sirket  to gr-klasor
            move takasgr-adi     to gr-adi
            move takasgr-soyadi     to gr-soy

            move takasgr-gir-gun to egun
            move takasgr-gir-ay  to eay
            move takasgr-gir-yil to eyil

            move etarih     to gr-giris-tar
            
            move takasgr-cik-gun to egun
            move takasgr-cik-ay  to eay
            move takasgr-cik-yil to eyil

            move etarih     to gr-cikis-tar
            
          
           move takasgr-dog-gun to egun
           move takasgr-dog-ay  to eay

            move takasgr-dog-yil to eyil
            move takasgr-odano   to gr-odano

            move etarih     to gr-dogum-tar
            modify  grform-Gd-1 record-to-add  grform-Gd-1-Record
           end-read
         end-perform
       end-start
         modify  grform-Gd-1  mass-update = 0

        close takasgr.



     .
 rez-soz-bas. 
      call "/asya/ytl/obj/otel/rezsoz.asy" using xrez-no
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/rezsoz.asy" 
       end-call.

     .
*
 grform-Ex-Other.
      if key-status = 5 then
          perform gr-bul
      end-if
     .
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi

          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 fsil-Cm-1-Ev-Ntf-Selchange.
         move 1 to tacenta-vis
         display a1 a2 a3.

     .
*
 fsil-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.



     move xrez-acenta to tr-acenta
     display a2
     perform tacenta-oku

        open input kllnc
        initialize kllnc-rec
        move k-kodu-tasi  to k-kodu
        read kllnc no lock invalid continue
        end-read
        close kllnc
        display fsil-Cm-1
        modify fsil-Cm-1 reset-list = 1 

         initialize tr-ekle
         move "-----------------TRANSFER YOK-----" to tr-ekle
        modify fsil-Cm-1 item-to-add tr-ekle
     open i-o baglanti
     close baglanti

     open input baglanti
        initialize baglanti-rec
        start baglanti key > baglanti-kodu invalid continue
            not invalid
               initialize fs-baglanti
               perform until fs-baglanti = "10"
                   read baglanti next no lock 
                      end move "10" to fs-baglanti
                      not end
                         if baglanti-guncel not = 1 then 
                           exit perform cycle
                         end-if
                           initialize tr-ekle
                         move baglanti-aciklama-1 to tr-ekle 
                         move baglanti-adi        to tr-ekle(31:)
                         modify fsil-Cm-1 item-to-add tr-ekle
                   end-read
               end-perform
         end-start
        
          modify fsil-Cm-1  
            mass-update = 0.  
     close baglanti.
       move "-----------------TRANSFER YOK-----" to tr-ekle
         modify fsil-Cm-1 value =  tr-ekle







    
      modify fsil-Cm-2 reset-list = 1  mass-update = 1
   
      modify fsil-Cm-2 item-to-add "01-Mukerrer    "
      modify fsil-Cm-2 item-to-add "02-Rakip Otel    "
      modify fsil-Cm-2 item-to-add "03-Force Major    "
      modify fsil-Cm-2 item-to-add "04-Dusuk Fiyat  "
      modify fsil-Cm-2 item-to-add "05-Yapim Onarim    "
      modify fsil-Cm-2 item-to-add "06-Tur Iptali   "
      modify fsil-Cm-2 item-to-add "07-Toplanti Iptali   "
      modify fsil-Cm-2 item-to-add "08-Lokasyon     "
      modify fsil-Cm-2 item-to-add "09-Acenta Iptali    "
      modify fsil-Cm-2 item-to-add "10-Teror    "
      modify fsil-Cm-2 item-to-add "11-Hava Durumu    "
      modify fsil-Cm-2 item-to-add "12-Opsiyon Suresi  "
       mass-update = 0
      move 09 to sil-sebeb
      display fsil-Cm-2
       modify fsil-Cm-2 
       mass-update = 0
     .
*
 grup-after.
     if  xrez-grup-no not = spaces
     open i-o rezgrup 
     initialize rezgrup-rec
     move xrez-grup-no to  rezgrup-kodu
     read rezgrup no lock 
        invalid continue
     end-read
     if xrez-grup-adi = spaces then
        move rezgrup-adi to xrez-grup-adi
     end-if
     display  accept-grup-adi
      close rezgrup
     end-if
     .
*
 grupadi--after.
     if xrez-grup-adi not = spaces
     open i-o rezgrup 
     initialize rezgrup-rec
     move xrez-grup-no to  rezgrup-kodu
     read rezgrup no lock 
        invalid continue
     end-read
     if xrez-grup-adi not = spaces then
       move xrez-grup-adi  to rezgrup-adi 
       write rezgrup-rec invalid rewrite rezgrup-rec end-write
     end-if
     close rezgrup
      end-if.
     
     .
*
 Form2-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
     
     .
*
 Form3-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
     initialize tum-tel
     move xrez-telefon-no to tum-tel
     display acc-tel-ulke acc-tel-bolge acc-tel-telno

     
     .
*
 a-fiy-Ex-Ntf-Changed.
     inquire a-fiy value in v-fiy
  
     initialize nume nume2 ara-konum 
     move 1 to kyer
      move v-fiy(1:1) to nume
     if nume  is numeric then 
        move function numval(v-fiy (1:2)) to nume2
        if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2                to fiyat-konumu-combo-value(1:2)
                  move "->"                 to fiyat-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to fiyat-konumu-combo-value(5:)
        
        display fiyat-konumu-combo
        move fiyat-konumu-combo-value(1:2) to xrez-fiyat-konumu
        end-if
        else 

              move 0 to kyer
              inspect v-fiy tallying kyer for all space
              compute kyer = function length(v-fiy) - kyer
          perform varying k from 1 by 1 until k > 40
              if v-fiy(1:kyer) = xkonum-adi(k)(1:kyer) then 
                move k to nume2
                if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2         to      fiyat-konumu-combo-value(1:2)
                  move "->"                 to  fiyat-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to fiyat-konumu-combo-value(5:)
        
                     display fiyat-konumu-combo
                     move fiyat-konumu-combo-value(1:2) to xrez-fiyat-konumu
                end-if

                
                  


                 exit perform 
              end-if
          end-perform 
     end-if
     .
*
 fiyat-konumu-combo-Ex-Ntf-Selchange.
      inquire fiyat-konumu-combo, 
                value in buffer-mami
                move buffer-mami(1:2) to 
                xrez-fiyat-konumu
               open input konum 
               initialize konum-rec
               move xrez-fiyat-konumu to konum-anahtar
               read konum no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Oda Konumu Hatali ] " to mmesaj-title
                    move " Secmis Oldugunuz Oda Konumu Tanimsiz....... "  to mmesaj-1
                    move " Seciminizi Degistiriniz.................... "  to mmesaj-2
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver

                    close konum
                    move 1 to gec-gecme
                    exit paragraph
                    not invalid continue
               end-read 
               if rez-yeni-eski = "Y" then 
                   move xrez-fiyat-konumu to xrez-oda-konumu
                  inquire fiyat-konumu-combo, 
                     value in oda-konumu-combo-value
                 display oda-konumu-combo
               end-if
               close konum
      perform anlasma-bul       |||X firat ekleme 12/2/2021
     .
*
 a-fiya-Ex-Ntf-Changed.
 
     inquire a-oda value in v-oda
   
     initialize nume nume2 ara-konum 
     move 1 to kyer
      move v-oda(1:1) to nume
     if nume  is numeric then 
        move function numval(v-oda (1:2)) to nume2
        if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2            to      oda-konumu-combo-value(1:2)
                  move "->"                 to  oda-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to oda-konumu-combo-value(5:)
        
        display oda-konumu-combo
        move oda-konumu-combo-value(1:2) to xrez-oda-konumu
        end-if
        else 

              move 0 to kyer
              inspect v-oda tallying kyer for all space
              compute kyer = function length(v-oda) - kyer
          perform varying k from 1 by 1 until k > 40
              if v-oda(1:kyer) = xkonum-adi(k)(1:kyer) then 
                move k to nume2
                if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2         to      oda-konumu-combo-value(1:2)
                  move "->"                 to  oda-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to oda-konumu-combo-value(5:)
        
                     display oda-konumu-combo
                     move oda-konumu-combo-value(1:2) to xrez-oda-konumu
                end-if

                
                  
                 exit perform 

              end-if
          end-perform 
     end-if
     
     .



      .
*
 ace-takvim.
        initialize     ace-sart-gece  ace-hs-var  ace-top-gece
        move xrez-gir-tar to takvim-anah 
        start takvim key >= takvim-anah invalid continue
           not invalid 
           perform until fs-takvim  = "10" 
                 read takvim next no lock end move "10" to fs-takvim
                     not end 
                       if takvim-anah >=  xrez-cik-tar
                         move "10" to fs-takvim
                         else
                            add 1 to ace-top-gece 
                            if takvim-gun-adi = 5 or 6 then 
                               move 1 to ace-hs-var 
                            end-if
                            if takvim-anah >= aceanlas-sart-bas and 
                               takvim-anah <= aceanlas-sart-bit
                               add 1 to ace-sart-gece
                               
                            end-if
                       end-if
                 end-read
           end-perform
           if aceanlas-sart-haric = 1 then 
               compute ace-top-gece =  ace-top-gece  -  ace-sart-gece

           end-if

    .

 
*
 anlasma-bul.
      if xrez-fix-anl = 1 
        move 1 to def-anl-bulundu
        exit paragraph
      end-if
       open input acenta
         move xrez-acenta  to acenta-kodu 
          read acenta no lock invalid 
               continue
          end-read

          if acenta-rate-acenta > spaces
             move acenta-rate-acenta to acenta-kodu 
             read acenta no lock invalid
                move xrez-acenta to  xREZ-RATE-ACENTA
               not invalid 
                 move acenta-kodu to xREZ-RATE-ACENTA
                 else
                move xrez-acenta to  xREZ-RATE-ACENTA
          end-if
            move xrez-acenta  to acenta-kodu 
            read acenta no lock invalid continue
          end-read
        close acenta 
       
     

     open input aceanlas
     initialize aceanlas-rec def-anl-bulundu
     move xrez-rate-acenta       to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end
         if xrez-rate-acenta not =  aceanlas-acenta then
            move "10" to fs-aceanlas 
         else
             
            if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
               if onkpara-referans-var = 1 
                  evaluate onkpara-referans-nerden
                      when 1 
                           open input konum 
                           initialize konum-rec 
                           move xrez-fiyat-konumu to konum-anahtar 
                           read konum no lock invalid
                                continue
                           end-read 
                           close konum
                           if aceanlas-referans not = spaces and aceanlas-referans not = 0
                              if konum-ref not = aceanlas-referans
                                 exit perform cycle
                              end-if
                           end-if 
                      when 2
                           open input odalar 
                           initialize odalar-rec 
                           move xrez-odano to odalar-rec 
                           read odalar no lock invalid
                                continue
                           end-read 
                           close odalar 
                           if aceanlas-referans not = spaces and aceanlas-referans not = 0
                              if odalar-referans not = aceanlas-referans
                                 exit perform cycle
                              end-if
                           end-if
                  end-evaluate 
               end-if
            end-if   |||X

            if aceanlas-tutar-sira > 0 and  aceanlas-tutar-sira <= 9
               if xkonum-tutar-sira(xrez-fiyat-konumu) not = aceanlas-tutar-sira
                  exit perform  cycle
               end-if
            end-if
            if aceanlas-sart-var = 1 or aceanlas-hs = 1 or 
               aceanlas-min-max-var = 1  or aceanlas-haftatek  > 0 then 
               perform ace-takvim
            end-if
            move xrez-gir-tar to takvim-anah 
            read takvim no lock invalid
                 continue
            end-read
            if xrez-al-tar <= aceanlas-kabul-bit and 
               xrez-al-tar >= aceanlas-kabul-bas and
               xrez-gir-tar >= aceanlas-donem-bas and
               xrez-gir-tar <= aceanlas-donem-bit and 
               (aceanlas-min-max-var not = 1 or 
               (ace-top-gece >= aceanlas-min-gece and 
               ace-top-gece <= aceanlas-max-gece)) and 
               (aceanlas-hs not = 1  or ace-hs-var = 1) and 
               (aceanlas-sart-var not = 1 or 
               (ace-sart-gece >= aceanlas-sart-min-gece and 
               ace-sart-gece <= aceanlas-sart-max-gece)) and 
               (aceanlas-haftatek not > 0  or 
               (takvim-gun-adi = aceanlas-haftatek and ace-top-gece = 1)) then 
               move 1 to def-anl-bulundu
               if not eski-rez  and link-var not = 5 and link-var not = 6   
                     and link-var not = 4 and link-var not = 7 and link-var not = 11
                       continue
*                  display message box "Acentaya ait Anlasma Bulundu" new-line ||| srekli uyar veriyor kaldrld
*                                      "Anlasma tipi degistirilecektir...."
               end-if
               move "10" to fs-aceanlas 
            end-if
         end-if
     end-read
     end-perform
     end-start
     close aceanlas
     if def-anl-bulundu = 1
       if eski-rez and 
          aceanlas-anlasma <> xrez-anlasma
          move 1     to def-anl-uyumsuz
          move aceanlas-anlasma        to ydk-aceanlas-anlasma
          move  "Gercek Anlasma Kodu:" to deg-yazi
               modify Form1-Pb-2, visible = true
               modify Form1-Pb-2, title deg-anlasma 
                                 
          exit paragraph
      end-if
      if yeni-rez
        move aceanlas-anlasma     to xrez-anlasma
                 
       
        perform anlasma-oku
        if aceanlas-ear  = 1 then 
          move "E" to xrez-eb
        else
          move "H" to xrez-eb
        end-if

        if aceanlas-aks-yok = 1
           move "H" to xREZ-AKSIYON-EH
        else
           move "E" to xREZ-AKSIYON-EH
        end-if 

        if aceanlas-spe-yok = 1
           move 1 to xrez-special-eh  
        else
           move 0 to xrez-special-eh
        end-if 

        display special-cb aksiyon-cb 
****************************************************************
        if xrez-special-eh = "1" or "H" 
           modify special-cb, value = 1
           move 1           to xrez-special-eh
        else
           modify special-cb, value = 0
           move 0           to xrez-special-eh
        end-if
*******************************************************************   
        if xrez-aksiyon-eh = "1" or "H" 
           modify aksiyon-cb, value = 1
           move "H"           to xrez-aksiyon-eh
        else
           modify aksiyon-cb, value = 0
        end-if
********************************************************************   
        if xrez-eb = "E" or "1"
           modify eraly-booking-cb, value = 1
           move "E"     to xrez-eb
        else
           modify eraly-booking-cb, value = 0
        end-if
*******************************************************************
      end-if 
        display aksiyon-cb  special-cb eraly-booking-cb
     end-if.
*
 uyumsuz-anlasma-bul.
      if xrez-fix-anl = 1 
        move 1 to def-anl-bulundu
        exit paragraph
      end-if
       open input acenta
         move xrez-acenta  to acenta-kodu 
          read acenta no lock invalid continue
          end-read
          if acenta-rate-acenta > spaces
             move acenta-rate-acenta to acenta-kodu 
             read acenta no lock invalid
                move xrez-acenta to  xREZ-RATE-ACENTA
             not invalid 
                 move acenta-kodu to xREZ-RATE-ACENTA
                 
          else
                move xrez-acenta to  xREZ-RATE-ACENTA
          end-if
            move xrez-acenta  to acenta-kodu 
            read acenta no lock invalid continue
          end-read
      close acenta
     open input aceanlas
     initialize aceanlas-rec def-anl-bulundu
     move xREZ-RATE-ACENTA      to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
    
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end

         if xREZ-RATE-ACENTA not =  aceanlas-acenta then
            move "10" to fs-aceanlas 
         else
           
            if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
               if onkpara-referans-var = 1 
                  evaluate onkpara-referans-nerden
                      when 1 
                           open input konum 
                           initialize konum-rec 
                           move xrez-fiyat-konumu to konum-anahtar 
                           read konum no lock invalid
                                continue
                           end-read 
                           close konum
                           if aceanlas-referans not = spaces and aceanlas-referans not = 0
                              if konum-ref not = aceanlas-referans
                                 exit perform cycle
                              end-if
                           end-if 
                      when 2
                           open input odalar 
                           initialize odalar-rec 
                           move xrez-odano to odalar-rec 
                           read odalar no lock invalid
                                continue
                           end-read 
                           close odalar 
                           if aceanlas-referans not = spaces and aceanlas-referans not = 0
                              if odalar-referans not = aceanlas-referans
                                 exit perform cycle
                              end-if
                           end-if
                  end-evaluate 
               end-if
            end-if   |||X

            if aceanlas-tutar-sira > 0 and  aceanlas-tutar-sira <= 9
               if xkonum-tutar-sira(xrez-fiyat-konumu) not = aceanlas-tutar-sira
                  exit perform  cycle
               end-if
            end-if
            if aceanlas-sart-var = 1 or aceanlas-hs = 1 or 
               aceanlas-min-max-var = 1 or aceanlas-haftatek > 0 then 
               perform ace-takvim
            end-if
            move xrez-gir-tar to takvim-anah 
            read takvim no lock invalid continue
            end-read
            if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
                xrez-gir-tar >= aceanlas-donem-bas and
                xrez-gir-tar <= aceanlas-donem-bit and 
                (aceanlas-min-max-var not = 1 or 
                  (ace-top-gece >= aceanlas-min-gece and 
                    ace-top-gece <= aceanlas-max-gece )) and 
                ( aceanlas-hs not = 1  or ace-hs-var = 1  ) and 
                 (aceanlas-sart-var not = 1 or 
                  (ace-sart-gece >= aceanlas-sart-min-gece and 
                    ace-sart-gece <= aceanlas-sart-max-gece ))  and 
                    ( aceanlas-haftatek not > 0 or ( takvim-gun-adi = aceanlas-haftatek and 
                                       ace-top-gece = 1) )then 
               move 1 to def-anl-bulundu
               move "10" to fs-aceanlas 
            end-if
         end-if
     end-read
     end-perform
     end-start
     close aceanlas
     if def-anl-bulundu = 1
        move aceanlas-anlasma     to xrez-anlasma
        move aceanlas-ear         to xrez-eb
        move aceanlas-spe-yok     to xrez-special-eh
        move aceanlas-aks-yok     to xrez-aksiyon-eh

       
        perform anlasma-oku
   
        if xrez-special-eh = "1"
           modify special-cb, value = 1
        else
           modify special-cb, value = 0
        end-if
   
        if xrez-aksiyon-eh = "1"
           modify aksiyon-cb, value = 1
           move "H"           to xrez-aksiyon-eh
        else
           modify aksiyon-cb, value = 0
        end-if
   
        if xrez-eb = "1"
           modify eraly-booking-cb, value = 1
           move "E"     to xrez-eb
        else
           modify eraly-booking-cb, value = 0
        end-if         
     end-if.
*
 profil-cagir.
       move xrez-no                   to aranan-rez-no
       move isyeri-adres-tasi         to bulunan-rez-sirketi  
       
       call "/asya/ytl/obj/otel/profbul.asy" using profbul-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/profbul.asy" 
       end-call

       if secildi = 9
            exit paragraph 
       end-if
       move 4    to accept-control
       move 1014 to control-id
       perform ortak-profil-yaz

       if xrez-telefon-no = spaces and           |||X firt 12/03/2021
          musteri-tel3 not = spaces and 
          yan-kac = 1  and mis-no > 0
          move musteri-tel3   to xrez-telefon-no
          display accept-tel-no
       end-if
       .
*
 ortak-profil-yaz.       
       if secildi = 1 or 
          secildi = 2 or 
          secildi = 3
          open i-o yanrez
          initialize yanrez-rec
          move xrez-no            to yanrez-rezno
          move yan-kac            to yanrez-sirano
          read yanrez no lock invalid
              continue
          end-read
           if secildi = 2
             initialize musteri-rec         
          end-if

          if secildi = 1 or secildi = 3                  
            move bulunan-profil-sirket to musteri-sirket   
            move bulunan-profil-no     to musteri-no
            open input musteri
            read musteri no lock invalid
                 close yanrez 
                 exit paragraph
                 continue
            not invalid
                  move musteri-adi      to yanrez-adi 
                  move musteri-soyadi   to yanrez-soyadi 
                  move musteri-d-tarihi to yanrez-dog-tar
                 if genel-guest-oto-isaretle = 1
                    if yan-kac = 1
                      if xrez-vip = spaces or xrez-vip = "N"
                         if musteri-gelis-sayisi > 1
                            move "G"   to xrez-vip
                            perform vip-goster                         
                         end-if 
                      end-if 
                   end-if
                 end-if
            end-read
            close musteri 
          end-if
         
          evaluate yan-kac
          when 1
            move bulunan-profil-no       to mis-no yanrez-profil-no
            move bulunan-profil-sirket   to ps1    yanrez-profil-sirket
           
            move xrez-adi                           to yanrez-adi  
            move xrez-soyadi                        to yanrez-soyadi
               if secildi = 1 or secildi = 3  
                 move musteri-adi to xrez-adi yanrez-adi
                 move musteri-soyadi to xrez-soyadi yanrez-soyadi             
               end-if
            move yanrez-adi                        to   xrez-adi
            move yanrez-soyadi                      to  xrez-soyadi 
            move yanrez-dog-tar                  to d-tar1

        


            display acc-mis-no acc-ps1 accept-adi accept-soyadi
            l-d-gun1 l-d-ay1 l-d-yil1
          when 2
              move bulunan-profil-no       to pno2 yanrez-profil-no    
              move bulunan-profil-sirket   to ps2  yanrez-profil-sirket
              if secildi = 1 or secildi = 3  
                 move yanrez-adi                        to   adi2         
                 move yanrez-soyadi                      to   soy2 
                move yanrez-dog-tar  to d-tar2

           

             end-if
            display acc-pno2  acc-ps2    l-d-gun2 l-d-ay2 l-d-yil2 l-adi2 l-soy2
          when 3
            move bulunan-profil-no       to pno3 yanrez-profil-no    
            move bulunan-profil-sirket   to ps3  yanrez-profil-sirket
             if secildi =1 or secildi = 3 
            move  yanrez-adi     to adi3                           
            move  yanrez-soyadi to   soy3
             move yanrez-dog-tar  to d-tar3 

    

             end-if 
            display acc-pno3 acc-ps3   l-d-gun3 l-d-ay3 l-dyil3  l-adi3 l-soy3
          when 4
            move bulunan-profil-no       to pno4  yanrez-profil-no    
            move bulunan-profil-sirket   to ps4   yanrez-profil-sirket
             if secildi =1 or secildi = 3 
            move  yanrez-adi     to adi4                           
            move  yanrez-soyadi to   soy4 
             move yanrez-dog-tar  to d-tar4

            
             end-if
            display acc-pno4 acc-ps4   l-d-gun4 l-d-ay4 l-d-yil4 l-adi4 l-soy4
          when 5
            move bulunan-profil-no       to pno5  yanrez-profil-no    
            move bulunan-profil-sirket   to ps5   yanrez-profil-sirket
             if secildi =1 or secildi = 3 
             move  yanrez-adi     to adi5                           
             move  yanrez-soyadi to   soy5 
              move yanrez-dog-tar  to d-tar5

              

              end-if
            display acc-pno5 acc-ps5  l-d-gun5 l-d-ay5 l-d-yil5  l-adi5 l-soy5
          when 6
            move bulunan-profil-no       to pno6  yanrez-profil-no    
            move bulunan-profil-sirket   to ps6   yanrez-profil-sirket
              if secildi =1 or secildi = 3 
            move  yanrez-adi     to adi6                          
            move  yanrez-soyadi to   soy6 
            move yanrez-dog-tar  to d-tar6

               

            end-if
            display acc-pno6  acc-ps6  l-d-gun6 l-d-ay6 l-d-yil6   l-adi6 l-soy6
          when 7
            move bulunan-profil-no       to pno7  yanrez-profil-no    
            move bulunan-profil-sirket   to ps7   yanrez-profil-sirket
              if secildi =1 or secildi = 3 
            move  yanrez-adi     to adi7                           
            move  yanrez-soyadi to   soy7
            move yanrez-dog-tar  to d-tar7 
            end-if
            display acc-pno7 acc-ps7 l-d-gun7 l-d-ay7 l-d-yil7 l-adi7 l-soy7
          when 8
            move bulunan-profil-no       to pno8  yanrez-profil-no    
            move bulunan-profil-sirket   to ps8   yanrez-profil-sirket
              if secildi =1 or secildi = 3 
            move  yanrez-adi     to adi8                           
            move  yanrez-soyadi to   soy8
            move yanrez-dog-tar  to d-tar8 
            end-if
            display acc-pno8 acc-ps8 l-d-gun8 l-d-ay8 l-d-yil8 l-adi8 l-soy8
          when 9
            move bulunan-profil-no       to pno9  yanrez-profil-no    
            move bulunan-profil-sirket   to ps9   yanrez-profil-sirket
              if secildi =1 or secildi = 3 
            move  yanrez-adi     to adi9                           
            move  yanrez-soyadi to   soy9
            move yanrez-dog-tar  to d-tar9
            end-if
            display acc-pno9 acc-ps9 l-d-gun9 l-d-ay9 l-d-yil9 l-adi9 l-soy9

          end-evaluate
              write yanrez-rec invalid rewrite yanrez-rec end-rewrite end-write 
              perform log-operation-yanrez
         close yanrez
       end-if.


*
 acc-mis-no-Ev-Cmd-Goto.
        if ps1 = zeroes or ps1 = spaces 
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
        end-if
        initialize mis-cagir 
        move mis-no to mis-no-cagir2
        move ps1 to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call

       if xrez-telefon-no = spaces and           |||X firt 12/03/2021
          musteri-tel3 not = spaces and 
          yan-kac = 1 
          move musteri-tel3   to xrez-telefon-no
          display accept-tel-no
       end-if

       move 1     to yan-kac
       if mis-kayit = 1 
            move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
            perform ortak-profil-yaz
       end-if
       move 1  to musteriden-geldi.

*
 acc-pno2-Ev-Cmd-Goto.
        if pno2 = spaces or pno2 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if
        initialize mis-cagir
        move pno2 to mis-no-cagir2
        move ps2  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 2     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
          move mis-sirket-cagir      to bulunan-profil-sirket
          move mis-no-cagir2         to bulunan-profil-no

          perform ortak-profil-yaz
       end-if.


*
 acc-pno3-Ev-Cmd-Goto.
        if pno3 = spaces or pno3 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno3 to mis-no-cagir2
        move ps3  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 3     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2         to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno4-Ev-Cmd-Goto.
        if pno4 = spaces or pno4 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           

        end-if

        initialize mis-cagir
        move pno4 to mis-no-cagir2
        move ps4  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 4     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno5-Ev-Cmd-Goto.
        if pno5 = spaces or pno5 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno5 to mis-no-cagir2
        move ps5  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 5     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2         to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno6-Ev-Cmd-Goto.
        if pno6 = spaces or pno6 = zeroes
***            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno6 to mis-no-cagir2
        move ps6  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 6     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz

       end-if.

*
 acc-pno7-Ev-Cmd-Goto.
        if pno7 = spaces or pno7 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno7 to mis-no-cagir2
        move ps7  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 7     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno8-Ev-Cmd-Goto.
        if pno7 = spaces or pno7 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno8 to mis-no-cagir2
        move ps8  to mis-sirket-cagir

        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 8     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.
*
 acc-pno9-Ev-Cmd-Goto.
        if pno9 = spaces or pno9 = zeroes
*            display message box "Profil Bulunamadi....."
*                            title "[ Uyari ]"
*                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno9 to mis-no-cagir2
        move ps9  to mis-sirket-cagir
        move 2    to mis-kim-cagir
         if sifre-devrede = 1
            move  sifre-devrede to mis-sifreli
         end-if
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 9    to yan-kac



       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
  
     .
*
 hes-gonder.
      if Xrez-folio > 0 then 

        if key-status not = 2 
            display message box "CIN olmus rezervasyon register kartindan deneyiniz" title "DIKKAT"
            exit paragraph
        end-if
       end-if
        initialize linkh-odahes
        move xrez-no to  linkh-rez-no     
         move 1 to linkh-nereden  
         move 0 to linkh-anl-yaz
         move 0 to linkh-cast-yaz
*********************************************

                move xrez-kisi            to CAST-KISI     
                move  xrez-fiyat-konumu   to  cast-FIYAT-KONUMU       
                move  xrez-oda-konumu     to  cast-oda-KONUMU    
                move  xrez-anlasma        to cAST-ANLASMA         
                move  xREZ-PAN-TIPI       to CAST-PAN-TIPI 
        







*************************************************
          call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
**************************************
                move  CAST-KISI            to     xrez-kisi         
                move  cast-FIYAT-KONUMU   to    xrez-fiyat-konumu   
                move  cast-oda-KONUMU     to    xrez-oda-konumu   
                move  cAST-ANLASMA         to     xrez-anlasma      
                move  CAST-PAN-TIPI        to     xREZ-PAN-TIPI     
                                                

            
          if  "E" = xrez-eb
              modify eraly-booking-cb, value = 1
           else
              modify eraly-booking-cb, value = 0
        end-if
         
              display ug-cb
              open input hesayr
            initialize hesayr-rec
            move  xrez-no to hesayr-rez-no
            evaluate true
               when tarih-tasi > xrez-cik-tar
                  move xrez-gir-tar to hesayr-tarih
               when tarih-tasi <= xrez-gir-tar
                  move xrez-gir-tar to hesayr-tarih
               when other
                  move tarih-tasi to hesayr-tarih
            end-evaluate
              read hesayr  no lock invalid
                continue
                not invalid
              move hesayr-basilacak-tut to xrez-fiyati
              end-read
              if xrez-gec = 1 and tarih-tasi <= rez-gir-tar and xrez-fiyat-fix not = "E"
                 initialize hesayr-rec
                  move  xrez-no to hesayr-rez-no  
                  move xrez-gir-tar to hesayr-tarih
                  start hesayr key < hesayr-anah
                      invalid continue
                      not invalid
                      
                      read hesayr previous no lock end continue
                      not end
                          add hesayr-basilacak-tut to xrez-fiyati  
                      end-read
                  end-start

              end-if


              close  hesayr
            display accept-fiyati  
     .
*
 det-gonder.
        
          call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xrez-no xrez-rec   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/hesayr.asy"
         end-call

     .
*
 Form1-Pb-4-Link.
       move 0 to xrez-plan
       display Form1-Pb-4
     .
*
 rezervasyon-formu-ekle.
    move "Adobe PDF Dosyalari (*.pdf)|*.pdf" to 
          opnsav-filters
    call "c$opensavebox" using opensave-open-box,
                               opensave-data,
                         giving opensave-return.
    if opensave-return > 0
       perform resim-upload
    end-if.
*
 resim-upload.
    move low-values           to komut1 komut2 rename-dosya
    inspect opnsav-filename 
            replacing trailing spaces by low-values
    inspect opnsav-basename 
            replacing trailing spaces by low-values
    inspect opnsav-basename,
            replacing all spaces by "_"
    if is-remote
        string komut1,
              "@[DISPLAY]:"      delimited by low-values,
              opnsav-filename    delimited by low-values,

              into komut1

        string rename-dosya,
               xrez-no   delimited by low-values                
               ".pdf"    delimited by low-values 
        into rename-dosya        

        CALL "RENAME" using opnsav-basename rename-dosya

        string komut2,
              base-dir           delimited by low-values
              rename-dosya       delimited by low-values
              into komut2
    else
        string komut1,
               opnsav-filename delimited by low-values
        into komut1
        string rename-dosya,
               xrez-no   delimited by low-values 
               ".pdf"            delimited by low-values 
        into rename-dosya        

        CALL "RENAME" using opnsav-basename rename-dosya
        string komut2,
               base-dir        delimited by low-values
               rename-dosya    delimited by low-values
        into komut2
    end-if.
    call "c$copy" using komut1
                        komut2
                  giving copy-status.
*    move rename-dosya               to resim-rez-form 
*    display acc-rez-form
    if copy-status <> 0
       display message box 
               opnsav-filename, " dosyasi",x"0a0d",
               base-dir," klasorune kopyalanamadi ..."
               icon mb_error_icon
               title "Hata"
    end-if.
     
     .
*
 rezervasyon-form-sil.
     display message box "REZERVASYON FORMU SILINECEKTIR " new-line new-line 
                         "DEVAM ETMEK ISTER MISINIZ...?"
                     title "Uyari"
                     icon 1
                     type 2
                     default 2
                     returning donus-kodu
     if donus-kodu = 2
        exit paragraph 
     end-if 

    move low-values to opnsav-filename komut2
    string opnsav-filename
           xrez-no delimited by low-values
           ".pdf"  delimited by low-values
    into opnsav-filename

     string komut2,
            base-dir        delimited by low-values
            opnsav-filename    delimited by low-values
       into komut2

     call "C$DELETE" using komut2
    .
*
 rezervasyon-resim-goruntule.
    move low-values to opnsav-filename
    string opnsav-filename
           xrez-no delimited by low-values
           ".pdf"  delimited by low-values
    into opnsav-filename

    if is-remote
        move low-values           to komut2 local-file
        string local-file,
              "@[DISPLAY]:"    delimited by low-values
               local-folder    delimited by low-values
               opnsav-filename delimited by low-values
        into local-file

        string komut2,
               base-dir        delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2

    else
        move low-values           to komut2 local-file
        string local-file,
               local-folder    delimited by low-values
               opnsav-filename delimited by low-values
        into local-file

        string komut2,
               base-dir        delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2
    end-if.

    call "c$copy" using komut2|kopyaloanyorrr...
                        local-file
                  giving copy-status.
    if copy-status <> 0
*       display message box 
*               opnsav-filename, " dosyasi",x"0a0d",
*               base-dir," klasorune kopyalanamadi ..."
*               icon mb_error_icon
*               title "Hata"
        display message box "Goruntulenecek PDF Dosyasi Bulunamadi..."
                        title "[ Uyari ]"
                        icon 1
    end-if
    if copy-status = 0
       move 1 to resim-bulundu
       if resim-bulundu = 1
          perform resim-teklif
       end-if
    end-if.
*
 resim-teklif.
       if is-remote 
          set shell32-dll-uzak to true
          set shell-execute-uzak to true
       else
          set shell32-dll-yerel to true
          set shell-execute-yerel to true
       end-if
       call shell32-dll on exception 
            display message box
                   "shell32.dll dosyasi bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            exit paragraph.
       if is-remote
          move local-file(12:)   to local-file(1:)


       end-if

       inspect local-file replacing trailing spaces by low-values
       inspect local-file replacing all "/"  by "\"

       call shell-execute using by value 0,
                                by reference ac-komut
                                by reference local-file,
                                null
                                null
                                by value SW_SHOW
        on exception
            display message box
                   "ShellExecute Proseduru bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            cancel shell32-dll
            exit paragraph
       end-call.
       cancel shell-execute.
       cancel shell32-dll.
*
 accept-not2a-Ex-Other.
        evaluate key-status
        when 6      
               initialize kartarafil-cagir
               call "/asya/ytl/obj/otel/kartfil.asy" 
                        using kartarafil-cagir
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/kartfil.asy"
               end-call
               if kartarafil-ok = 1 then 
                  move kartarafil-kart to xrez-extra-kart 
                  display accept-not2a
               end-if
        end-evaluate.
*
 accept-not2aa-Ex-Other.
        evaluate key-status
        when 6
       initialize kartarafil-cagir
                call "/asya/ytl/obj/otel/kartfil.asy" 
                        using kartarafil-cagir
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/kartfil.asy"
                   end-call
              if kartarafil-ok = 1 then 
                move  kartarafil-kart  to  xrez-extra-kart2
                display accept-not2aa
              end-if
         end-evaluate .
*
 screen2-Aft-Routine.
       move function numval(z-aylik-tut) to  rezek-aylik-fiyat
       move function numval(z-aidat-tut) to  rezek-aidat-fiyat

      open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
     .

*
 screen2-Bef-Routine.
     
      initialize   z-aylik-tut z-aidat-tut
            move   rezek-aylik-fiyat   to z-aylik-tut
            move   rezek-aidat-fiyat   to z-aidat-tut
     .
*
 gd2-Ev-Other.
     
     .
*
 profil-goster.
     move 4  to kac-adet
 
     evaluate hangi-profil
     when 1
         move xrez-adi    to musteri-adi-filtre
         move xrez-soyadi to musteri-soy-filtre
     when 2
         move adi2    to musteri-adi-filtre
         move soy2 to musteri-soy-filtre
     when 3
         move adi3    to musteri-adi-filtre
         move soy3 to musteri-soy-filtre
     when 4
         move adi4    to musteri-adi-filtre
         move soy4 to musteri-soy-filtre
     when 5
         move adi5    to musteri-adi-filtre
         move soy5 to musteri-soy-filtre
     when 6
         move adi6    to musteri-adi-filtre
         move soy6 to musteri-soy-filtre
     when 7
         move adi7    to musteri-adi-filtre
         move soy7 to musteri-soy-filtre
     when 8
         move adi8    to musteri-adi-filtre
         move soy8 to musteri-soy-filtre
     when 9
         move adi9    to musteri-adi-filtre
         move soy9 to musteri-soy-filtre

     end-evaluate
     if musteri-adi-filtre(2:) = spaces and
        musteri-soy-filtre(2:) = spaces 
          exit paragraph 
     end-if 
     perform baslik-yukle
     perform profile-eslesen-ara
     perform profile-grid
     if hangi-profil = 1       
       open input prohrk
       perform gel-say-bul
 
       if gel-say > 1
          move 1   to xrez-vip-turu         
          perform vip-turu-goster
          if xrez-vip = "N" or " "
             move "G"       to xrez-vip
             move 1         to xrez-vip-oto-degis
             display acc-viptipi
             perform vip-goster   
          else
             if xrez-vip-oto-degis = 0 and xrez-vip = "G"
                move "N"       to xrez-vip 
                display acc-viptipi
                perform vip-goster                           
             end-if 
          end-if 
       else 
          if xrez-vip-oto-degis = 1 and xrez-vip = "G"
             move "N"       to xrez-vip 
             display acc-viptipi
             perform vip-goster            
          end-if 
       end-if
       if gel-say = 1
          move 2   to xrez-vip-turu
          perform vip-turu-goster        
       end-if         
       close prohrk
     end-if.
* 
 gel-say-bul.       
     initialize prohrk-rec gel-say       
     move ps1           to prohrk-profil-sirket
     move mis-no        to prohrk-profil-no
     start prohrk key not < prohrk-anah invalid
           continue
     not invalid
     perform with test after until fs-prohrk = "10"
     read prohrk next no lock end move "10"   to fs-prohrk
     not at end
            if prohrk-profil-no <> mis-no or
               prohrk-profil-sirket <> ps1  
                  move "10"   to fs-prohrk
                  exit perform
            end-if 
***********************04 01 2016 sonra kaldrlacakkkk******************
            if prohrk-profil-sirket = spaces or  
               prohrk-profil-no     = zeroes
                  exit perform cycle 
            end-if
*****************************************
            if prohrk-rez-durumu not = "S"
                add 1 to gel-say
            end-if
     end-read
     end-perform
     end-start.
*
 takas-yaz.
           initialize c1 c2 c3 c4  c6 puan
           move musteri-adi            to aranan
           move musteri-adi-filtre     to aranacak
       
           if musteri-adi-filtre not = spaces             
              perform ada-gore
           end-if 
            initialize c1 c2 c3 c4  c6  
           move musteri-soyadi         to aranan
           move musteri-soy-filtre     to aranacak
       
           if musteri-soy-filtre not = spaces               
              perform ada-gore
           end-if 
          
           if puan > 0
              add 1                   to c5
              initialize takasp-rec 
*              move m-profil           to takasp-anah            |mprofil bos geliyor o yuzden icini dagttm frat 17/08/2020
              move musteri-no         to takasp-no
              move musteri-sirket     to takasp-sirket
              move puan               to takasp-puan
              move musteri-adi        to takasp-adi
              move musteri-soyadi     to takasp-soyadi 
              move musteri-d-tarihi   to takasp-d-tarih
              move musteri-silindi    to takasp-silinen
              move musteri-e-mail     to takasp-email
              evaluate musteri-b-turu
              when "P"
                   move musteri-seri-no    to takasp-seri-no
              when "N"
                   move musteri-kim-tcno   to takasp-tc-no
              when other 
                   move musteri-seri-no    to takasp-seri-no
              end-evaluate
              move musteri-b-turu          to takasp-b-turu
              if musteri-puan-kart-no > zeroes 
                 move musteri-puan-kart-no         to takasp-kart-no
              end-if 
            if musteri-adi(1:10) = musteri-adi-filtre(1:10) and
               musteri-soyadi(1:10) = musteri-soy-filtre(1:10) and
               musteri-adi not = spaces and
               musteri-soyadi not = spaces                 
                 move 1   to xrez-gr-olabilir takasp-tam-uyum                                    
            end-if               
              write takasp-rec invalid 
                 rewrite takasp-rec end-rewrite 
              end-write 
           end-if .

*
 profile-eslesen-ara.
      open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
              move print-no to takasp-dno
    open output takasp close takasp         

    open input  musteri 
    open i-o takasp
     
          
        initialize boy deg-boyu sira
        inspect musteri-adi-filtre tallying deg-boyu for trailing spaces
        compute boy = 30 - deg-boyu 


        initialize soy-boy soy-deg-boyu
        inspect musteri-soy-filtre tallying soy-deg-boyu for trailing spaces
        compute soy-boy = 30 - soy-deg-boyu 

        evaluate true
        when boy > 2
               if soy-boy > 3
                  move 3  to soy-boy
               end-if 
               initialize  musteri-rec c5 aranan sira
               move musteri-adi-filtre(1:kac-adet)     to musteri-adi(1:kac-adet)
               move musteri-soy-filtre(1:soy-boy)      to musteri-soyadi(1:soy-boy)
               start musteri key not < musteri-ilk invalid
                     continue
               not invalid
               perform with test after until fs-musteri = "10"
               read musteri next no lock end move "10" to fs-musteri
               not at end
                       if musteri-adi(1:kac-adet) not = musteri-adi-filtre(1:kac-adet)
                          move "10"   to fs-musteri
                          exit perform cycle 
                       end-if 
*                       if musteri-soyadi(1:soy-boy) not = musteri-soy-filtre(1:soy-boy)
*                          move "10"   to fs-musteri
*                          exit perform cycle 
*                       end-if
                       if musteri-silindi = 1 and 
                          silinen-getir = 0
                              exit perform cycle 
                       end-if
               
                       if musteri-sirket = spaces or 
                          musteri-no = zeroes
                            exit perform cycle
                       end-if
                       if musteri-adi = spaces or
                          musteri-soyadi = spaces 
                            exit perform cycle 
                       end-if 

                       modify Form5-St-1-Handle, panel-index = 1
                                                 panel-text = musteri-no
                       perform takas-yaz
               
               end-read
               end-perform
               end-start
        when soy-boy > 2
               if boy > 3
                  move 3  to boy
               end-if
               initialize  musteri-rec c5 aranan sira
               move musteri-adi-filtre(1:boy)     to musteri-adi(1:boy)
               move musteri-soy-filtre(1:kac-adet)     to musteri-soyadi(1:kac-adet)
               start musteri key not < musteri-soy invalid
                     continue
               not invalid
               perform with test after until fs-musteri = "10"
               read musteri next no lock end move "10" to fs-musteri
               not at end
*                       if musteri-adi(1:boy) not = musteri-adi-filtre(1:boy)
*                          move "10"   to fs-musteri
*                          exit perform cycle 
*                       end-if 
                       if musteri-soyadi(1:kac-adet) not = musteri-soy-filtre(1:kac-adet)
                          move "10"   to fs-musteri
                          exit perform cycle 
                       end-if
                       if musteri-silindi = 1 and 
                          silinen-getir = 0
                              exit perform cycle 
                       end-if
               
                       if musteri-sirket = spaces or 
                          musteri-no = zeroes
                            exit perform cycle
                       end-if
                       if musteri-adi = spaces or
                          musteri-soyadi = spaces 
                            exit perform cycle 
                       end-if 

                       modify Form5-St-1-Handle, panel-index = 1
                                                 panel-text = musteri-no
                       perform takas-yaz
               
               end-read
               end-perform
               end-start
        when other
             if musteri-adi-filtre = spaces or musteri-soy-filtre = spaces 
                   display message box "En Az 3 Karakter Ad yada Soyad Girmelisiniz."
             end-if
        end-evaluate 

 
    close  musteri takasp
*      open i-o genelfis
*    move 1 to genelfis-anahtar
*    read genelfis no lock invalid
*         accept print-no from time
*    not invalid
*         add 1 to print-no
*         rewrite genelfis-rec end-rewrite
*    end-read
*    close genelfis
*    move print-no to takasp-dno
*    move k-kodu-tasi to takasp-k
*    open output takasp close takasp         
*    open input  musteri 
*    open i-o takasp
*    initialize  musteri-rec c5 aranan    apo
*    move musteri-soy-filtre(1:kac-adet)    to musteri-soyadi(1:kac-adet)
**    move musteri-adi-filtre(1:kac-adet)    to musteri-adi(1:kac-adet)
*    start musteri key not < musteri-soy-ad invalid
*          continue
*    not invalid
*    perform with test after until fs-musteri = "10"
*    read musteri next no lock end move "10" to fs-musteri
*    not at end
*            initialize takasp-rec
*            if musteri-sirket = spaces or 
*               musteri-no = zeroes
*                 exit perform cycle
*            end-if
*            if musteri-silindi = 1
*                 exit perform cycle 
*            end-if 
*            add 1 to apo
*            if musteri-soyadi(1:3) > musteri-soy-filtre(1:3)
***********              Display message box apo
*              move "10"   to fs-musteri
*            end-if 
*            if musteri-adi(1:10) = musteri-adi-filtre(1:10) and
*               musteri-soyadi(1:10) = musteri-soy-filtre(1:10) and
*               musteri-adi not = spaces and
*               musteri-soyadi not = spaces                 
*                 move 1   to xrez-gr-olabilir takasp-tam-uyum  
*                                  
*            end-if 
*             initialize c1 c2 c3 c4  c6 puan
*            move musteri-adi         to aranan
*            move musteri-adi-filtre           to aranacak
*
*            if musteri-adi-filtre not = spaces
*               perform ada-gore
*            end-if 
*             initialize c1 c2 c3 c4  c6  
*            move musteri-soyadi         to aranan
*            move musteri-soy-filtre     to aranacak
*
*            if musteri-soy-filtre not = spaces
*               perform ada-gore
*            end-if 
*      
*        if puan > 0
*           add 1                        to c5            
*           move m-profil                to takasp-anah
*           move puan                    to takasp-puan
*           move musteri-adi             to takasp-adi
*           move musteri-soyadi          to takasp-soyadi
*           move musteri-ulke            to takasp-ulke
*           move musteri-d-tarihi        to takasp-d-tarih
*           move musteri-gelis-sayisi    to takas-p-gel-sayi
*           move musteri-kazanilan-puan  to takasp-gercek-puan
*           move musteri-kart-tipi       to takasp-kart-tipi
*           write takasp-rec invalid 
*              rewrite takasp-rec end-rewrite 
*           end-write 
*        end-if 
*
*     end-read
*    end-perform
*    end-start
*    close  musteri .
*    close takasp

     .


*
 ada-gore.
        inspect aranan tallying c1 for trailing spaces
        compute c2 = 20 - c1
        initialize c1
        inspect aranacak tallying c1 for trailing spaces
        compute c3 = 20 - c1 

        move 0 to c4
        inspect aranan(1:c3) tallying c4 for all aranacak(1:c3)
        if c4 > 0
           add 10000 to puan
           if c2 = c3 
               add 10000 to puan
           end-if 
        end-if 

        move 0 to c4
        inspect aranan(1:3) tallying c4 for all aranacak(1:3)
        if c4 > 0
           add 3000 to puan
        end-if

        move 0 to c4
        inspect aranan tallying c4 for all aranacak(1:c3)
        if c4 > 0
           add 5000 to puan
        end-if 

        perform varying i 
                  from 1
                  by 1
                  until i > c3 - 2
                      move 0   to c4 
                      inspect aranan tallying c4 for all aranacak(i:3)
                      if c4 > 0
                        if i = 1
                           add 300 to puan
                        end-if 
                          add 100 to puan
                      end-if 
        end-perform

        perform varying i 
                  from 1
                  by 1
                  until i > c3 - 1
                      move 0   to c4 
                      inspect aranan tallying c4 for all aranacak(i:2)
                      if c4 > 0
                        if i = 1
                           add 100 to puan
                        end-if 
                          add 10 to puan
                      end-if 
        end-perform.

     
*
 profile-grid.
    open input takasp ulke
    initialize takasp-rec 
    move 1  to satir
    move high-values to takasp-puan
    start takasp key not > takasp-puan invalid 
         continue 
    not invalid 
    perform until fs-takasp = "10"  
    read takasp previous no lock end move "10"  to fs-takasp
    not at end 
            add 1                to satir
            if satir > 40
                exit perform 
            end-if 
            initialize gd2-rec
            move takasp-no       to gd-2-col-1
            move takasp-adi      to gd-2-col-2
            move takasp-soyadi   to gd-2-col-3
            if takasp-d-yil > 1900
               move takasp-d-yil     to eyil
               move takasp-d-ay      to eay
               move takasp-d-gun     to egun
               move etarih           to gd-2-col-4
            end-if 

            move takas-p-gel-sayi    to z-gel-sayi
            move z-gel-sayi          to gd-2-col-5

            move takasp-gercek-puan  to z-puan
            move z-puan              to gd-2-col-6
            move takasp-kart-tipi    to gd-2-col-7
            move takasp-sirket       to gd-2-col-8
            modify gd2,record-to-add(gd2-rec)

            if takasp-tam-uyum = 1
               modify gd2(satir),row-color = 176

            end-if 

    end-read 
    end-perform
    end-start
    close takasp ulke
    modify gd2,mass-update = 0
    delete file takasp.

*
 baslik-yukle.
     modify gd2,
            reset-grid = 1
            mass-update = 1            
     move "P.No"        to gd-2-col-1
     move "Adi"         to gd-2-col-2
     move "Soyadi"      to gd-2-col-3
     move "D.Tarihi"    to gd-2-col-4
     move "G.S"        to gd-2-col-5
     move "Puan"         to gd-2-col-6
     move "K.Tip"       to gd-2-col-7
     move "Sirket"      to gd-2-col-8
     modify gd2,record-to-add(gd2-rec).


*
 share-form-cagir.
       
       if link-var not = 3 then 
     if rez-yeni-eski = "Y"
      
           initialize rez-link
           initialize rlink-rez-no   rlink-gelen-sharenum
      
           move xrez-rec to  rlink-gelen-rec 
          

         call "/asya/ytl/obj/otel/rez.asy" 
           using rlink-rez-no rlink-gelen-rec  rlink-gelen-sharenum
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
      cancel "/asya/ytl/obj/otel/rez.asy"
      end-call
        if rlink-gelen-sharenum > 0 then 
         move rlink-gelen-sharenum to xrez-sharenum
       end-if
     else
      move accept-rez-no  to link-share-rez-no
      call "/asya/ytl/obj/otel/share.asy" 
           using link-share-rez-no
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
      cancel "/asya/ytl/obj/otel/share.asy"
      end-call
      move link-share-rez-no to rez-no 
       read rez no lock invalid stop " " 
         not invalid
         move rez-sharenum to xrez-sharenum
         move rez-share to xrez-share
         display cb-spa
      end-read
     end-if
     end-if
       .
*
*
 share-koy-kont.
****** kural .
****** kontrol edilecek rez kaydi cagrlmadan okunmus ve kaydedilmis olmali
******* arez.lib acast.lib takvim2.lib sel tfd de olmali  rez acik olmali
       
       open i-o arez  acast konu2
       open input takvim2
       initialize ana-oda-verildi arez-rec
        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
        move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
 

      
       initialize ana-oda-verildi acast-rec  share-odalar

         move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
        move rez-sharenum to acast-sharenum
        move tarih-tasi to acast-tarih

             initialize fs-acast
       start acast key >= acast-anah6 
               invalid continue
          not invalid
          perform until fs-acast = "10" 
              read acast next no lock end 
                     move "10" to fs-acast
                 not end
                    if rez-sharenum not = acast-sharenum 
                        move "10" to fs-acast
                        exit perform cycle
                    end-if
                    move acast-rez-no to arez-no 
                    read arez no lock invalid 
                          display message  box "Hata Bakim icin arayiniz Castttt "
                     end-read
                            if arez-durumu  = "S" then
                              exit perform cycle
                            end-if

                             if acast-tarih > son-share-tar
                                move  acast-tarih to son-share-tar
                             end-if
                              if acast-tarih < ilk-share-tar
                                move  acast-tarih to ilk-share-tar
                             end-if

                                perform varying ish from 1 by 1 until ish > sodasay or ish > 20 
                                    if share-oda(ish) = acast-oda-no
                                      exit perform 
                                    end-if
                                end-perform
                                 if ish > sodasay then 
                                     if ish >= 20 then
                                          display message box "20 den fazla oda bagladiniz"
                                       else
                                             move acast-oda-no to share-oda(ish)
                                             move ish to  sodasay
                                            
                                     end-if
                                 end-if
              end-read
          end-perform 
       end-start
       initialize fs-takvim2 takvim2-rec
       move ilk-share-tar to takvim2-anah 
       
       start takvim2 key >= takvim2-anah invalid continue
         not invalid 
         perform until fs-takvim2 = "10"
             read takvim2 next no lock end move "10" to fs-takvim2 
               not end
               if takvim2-anah > son-share-tar 
                   move "10" to fs-takvim2 
                   exit perform cycle
                end-if
             end-read
                perform varying ish  from 1 by 1 until ish > sodasay or ish > 20 
                  initialize ana-oda-verildi acast-rec   fs-acast
                  move takvim2-anah to acast-tarih
                  move rez-sharenum to acast-sharenum
                  move share-oda(ish) to acast-oda-no
                  move high-values to acast-fiyati  acast-buyuk

                  start acast key < acast-anah6 invalid 
                          continue
                     not invalid
                       perform until fs-acast = "10" 
                           read acast previous no lock  
                               end
                                move "10" to fs-acast
                                if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                                  else
                                                  display message box "Hataaaaa"
                                               end-if
                                  end-if
                                not end
        if   takvim2-anah not = acast-tarih  or
             rez-sharenum not = acast-sharenum  or
             share-oda(ish) not = acast-oda-no
               move "10" to fs-acast
                if ana-oda-verildi not = 1 
                  read   acast next no lock 
                  end   display message box "Hataaaaa"
                  exit perform cycle
                  end-read
                      if   takvim2-anah not = acast-tarih  or
                             rez-sharenum not = acast-sharenum  or
                             share-oda(ish) not = acast-oda-no
                          display message box "Share Edilmis kayitlarda kesintisiz konaklama yok" new-line 
                                               "Dikkatinize "
                          if k-kodu-tasi = "X   " or "ASYA" then stop " "  end-if 
                           exit perform cycle
                     end-if
                      move 1 to  ana-oda-verildi
                       if  acast-share not = 0
                            move 0 to acast-share
                          rewrite acast-rec invalid stop " " end-rewrite
                          else

                          display message box "Hataaaaa"
                       end-if
                 end-if
               exit perform cycle
        end-if
                               move acast-rez-no to arez-no
                                move acast-rez-no to arez-no 
                                    read arez no lock invalid 
                                      display message  box "Hata Bakim icin arayiniz Castttt "
                                          end-read
                                            if arez-durumu  = "S" then
                                                  display message box "Silinmis Share gorunuyor"
                                                  exit perform cycle
                                                  
                                            end-if
                                   if arez-cik-tar <= acast-tarih
                                       if  acast-share not = 1
                                            move 1 to acast-share
                                            rewrite acast-rec invalid stop " " end-rewrite
                                       end-if
                                    else
                                        if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                              end-if
                                        else
                                                 if  acast-share not = 1
                                                       move 1 to acast-share
                                                      rewrite acast-rec invalid stop " " end-rewrite
                                                 end-if
                                  end-if
                             end-if

                           end-read
                       end-perform
                  end-start
                end-perform 
        end-perform
      end-start
      initialize arez-rec fs-arez

        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
       start arez key >= aREZ-anah-share invalid continue
          not invalid
          perform until fs-arez = "10" 
              read arez next no lock end 
                       
                     move "10" to fs-arez
                 not end
                    if rez-sharenum not = arez-sharenum  
                     
                            move "10" to fs-arez
                        exit perform cycle
                    end-if
                    if  arez-durumu not = "I"
                       exit perform cycle
                    end-if
                    if arez-cik-tar < tarih-tasi 
                         exit perform cycle
                    end-if
                    if arez-gir-tar <= tarih-tasi
                       move   tarih-tasi to acast-tarih
                       move   arez-no   to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                                      if arez-folio > 0 then 
                                       move arez-folio to konu2-folio
                                       read konu2 no lock invalid continue
                                       not invalid
                                          move acast-share to konu2-share
                                          rewrite konu2-rec invalid continue end-rewrite
                                       end-read

                                     end-if
                             end-if
                             
                       end-read
                        else
                        move   arez-gir-tar  to acast-tarih
                         move   arez-no        to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                               
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                             end-if
                       end-read


                   end-if
              end-read
          end-perform 
       end-start
       read rez no lock invalid 
            stop " " 
       end-read

     close arez acast takvim2 konu2. 


*
 grup-islemleri.
          if xrez-grup-no = 0 then 
              initialize gruplar-cagir
                    call "/asya/ytl/obj/otel/gruplara.asy" using gruplar-cagir xrez-gir-tar  xrez-cik-tar 1
                         on exception perform callerr-proc
                         not on exception
                    cancel "/asya/ytl/obj/otel/gruplara.asy" 
                    end-call
                    if gruplar-cagir > 0 then 
                    move gruplar-cagir   to xrez-grup-no
                    display accept-grup-kodu
                     display message box " Misafir sectiginiz gruba dahil edildi  " new-line
                                "Kaydettiginizde gecerli olacaktir  " new-line
                               " Fiyat ve Breakdown degisecektir. " new-line 
                               " Kontrol Ediniz    " new-line
                   end-if
                    
             else
             initialize xrez-grup-no
              display accept-grup-kodu
              display message box " Misafir grup disina cikarildi  " new-line
                                "Kaydettiginizde gecerli olacaktir  " new-line
                               " Fiyat ve Breakdown degisecektir. " new-line 
                               " Kontrol Ediniz    " new-line



          end-if
       
       
     .
*
 cogalt.
       open input arez
       move accept-rez-no to arez-no
       read arez no lock invalid 
          continue
          close arez
          display message box " Kaydetmediginiz Rezervasyonu cogaltamassiniz " title "YENI KAYIT "
           exit paragraph
       end-read

             
           close arez
           initialize rez-link
           initialize rlink-rez-no rlink-gelen-sharenum
           if arez-gir-tar < tarih-tasi
              move tarih-tasi to arez-gir-tar
           end-if
           move spaces to arez-c-in
         
           move 0 to arez-folio arez-sharenum  arez-share
           if arez-kart-no1 not = spaces and 
              arez-kart-no2 not = spaces and 
              arez-kart-no3 not = spaces and 
              arez-kart-no4 not = spaces
                initialize arez-kredi-kart
           end-if 

           if arez-isl-tar < tarih-tasi
              move tarih-tasi to arez-isl-tar
           end-if

           if arez-al-tar < tarih-tasi
              move tarih-tasi to arez-al-tar 
           end-if

           move spaces to arez-odano
           move arez-sharenum to rlink-gelen-sharenum
           move arez-rec      to rlink-gelen-rec 
           move arez-no       to rlink-rez-no

         call "/asya/ytl/obj/otel/rez.asy" 
           using rlink-rez-no rlink-gelen-rec rlink-gelen-sharenum
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
               cancel "/asya/ytl/obj/otel/rez.asy"
         end-call   .
*
 cogalt2.
       open input arez
       move accept-rez-no to arez-no
       read arez no lock invalid 
          continue
          close arez
          display message box " Kaydetmediginiz Rezervasyonu cogaltamassiniz " title "YENI KAYIT "
           exit paragraph
       end-read

             
           close arez
          initialize rez-link
           initialize rlink-rez-no   rlink-gelen-sharenum
           if arez-gir-tar < tarih-tasi
              move tarih-tasi to arez-gir-tar
           end-if
           move spaces to arez-c-in

           if arez-isl-tar < tarih-tasi
              move tarih-tasi to arez-isl-tar
           end-if

           if arez-al-tar < tarih-tasi
              move tarih-tasi to arez-al-tar 
           end-if

           move 0 to arez-folio arez-sharenum  arez-share
           if arez-kart-no1 not = spaces and 
              arez-kart-no2 not = spaces and 
              arez-kart-no3 not = spaces and 
              arez-kart-no4 not = spaces
                initialize arez-kredi-kart
           end-if           
           move spaces to arez-odano
           move arez-sharenum to rlink-gelen-sharenum
           move arez-rec to  rlink-gelen-rec 
           move arez-no to rlink-rez-no

         call "/asya/ytl/obj/otel/rez.asy" 
                using rlink-rez-no rlink-gelen-rec  rlink-gelen-sharenum
                
                               link-rez-grup-rec2 link-toplu-adlar2 link-degisim2 cogalt-adet
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
               cancel "/asya/ytl/obj/otel/rez.asy"
         end-call   .
*
         
         
         
*
 reg-kart-yazdir.
        if isyeri-adres-tasi = "ramada12"
         initialize link-reg-kart-cagir
         move xrez-no  to link-reg-kart-rez-no
         call "/asya/ytl/obj/otel/reglzr.asy" 
           using link-reg-kart-cagir
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
               cancel "/asya/ytl/obj/otel/reglzr.asy"
         end-call
        else
         initialize rez-cagir
         move xrez-no  to rez-cagir
         call "/asya/ytl/obj/otel/regfisy.asy" 
           using rez-cagir
           on exception 
           perform callerr-proc
           exit paragraph
           not on exception 
               cancel "/asya/ytl/obj/otel/regfisy.asy"
         end-call
        end-if.

*
 zarfdok-hazirla.
      open input yanrez
      initialize link-zarf
      perform varying i from 1 by 1 until i > 7
              initialize yanrez-rec
              move rez-no to yanrez-rezno
              move i      to yanrez-sirano
              read yanrez no lock invalid
                      continue
              not invalid
                if yanrez-adi <> spaces or yanrez-soyadi <> spaces then

                        MOVE rez-no TO link-zarf-rez-no   
                        add 1 to link-zarf-kacinci                                    
                        move yanrez-sirano to link-zarf-yan-id

                        call "/asya/ytl/obj/otel/zarfdok1.asy" using link-zarf
                                 on exception perform callerr-proc
                                 not on exception
                        cancel "/asya/ytl/obj/otel/zarfdok1.asy" 
                        end-call

                       
                end-if
              end-read
        end-perform 
        close yanrez.
*
 kur-tarihi-uygula.
        if xrez-cin-kur-tar = zeroes 
           display message box "Hatali tarih.." new-line
                               "Kontrol Ediniz.." new-line new-line
                               "Kur Uygulanamadi...!!!!"
                           title "Uyari"
                           icon 1
             exit paragraph 
        end-if
 
        open input kur
        initialize kur-rec
        move xrez-cin-kur-tar       to kur-tarih
        move rez-banka              to kur-banka
        move rez-doviz              to kur-doviz
        read kur no lock invalid 
              display message box "Uygulanacak Kur Bulunamadi..."
                              title "Uyari"
                              icon 1
                  initialize xrez-cin-kur-tar
                  display accept-kur-gun accept-kur-ay accept-kur-yil
                  close kur 
                  exit paragraph 
        not invalid              
                initialize rez-rec
                move xrez-no   to rez-no
                read rez no lock invalid 
                     continue 
                not invalid 

                   move doviz-alis     to rez-cin-kuru xrez-cin-kuru                 

                   accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                   accept rez-edit-zaman from time          |                           
                
                   rewrite rez-rec end-rewrite 
                   perform log-operation-rez
                end-read 
        end-read 
        display accept-adia
        close kur.
*
 on-odeme-folio-kontrol.
     open input yromhrk konuk
     initialize konuk-rec
     move "I"                      to konuk-durumu
     move genel-onodeme-odano      to konuk-odano
     start konuk key not < konuk-oda invalid 
           continue 
     not invalid 
     perform with test after until fs-konuk = "10"
     read konuk next no lock end move "10" to fs-konuk
     not at end 
            if konuk-durumu <> "I"
                exit perform 
            end-if 
            if konuk-odano <> genel-onodeme-odano
               exit perform 
            end-if
              perform yromhrk-bul
     end-read 
     end-perform
     end-start
     close yromhrk konuk
     .
*
 yromhrk-bul.
     initialize yromhrk-rec borc-bakiye alac-bakiye  bakiye-bulundu bakiye
     move konuk-folio   to yromhrk-folio
     start yromhrk key not < yromhrk-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-yromhrk = "10"
     read yromhrk next no lock end move "10" to fs-yromhrk
     not at end 
            if yromhrk-folio <> konuk-folio
                exit perform 
            end-if
            if yromhrk-rez-no <> rez-no
                exit perform cycle 
            end-if 
            evaluate yromhrk-ba
            when "B"
                    compute borc-bakiye = borc-bakiye + yromhrk-tl-tutar
                    move yromhrk-islem to son-islem-ac
                      move yromhrk-folio to son-konuk-ac
                      move yromhrk-depkod  to son-dep-ac
                  
            when "A"
                    compute alac-bakiye = alac-bakiye + yromhrk-tl-tutar
                    move yromhrk-islem to son-islem-ac
                      move yromhrk-folio to son-konuk-ac
                      move yromhrk-depkod  to son-dep-ac
            end-evaluate 
     end-read 
     end-perform
     end-start
     compute bakiye = borc-bakiye - alac-bakiye 
     if bakiye <> 0
        move 1   to bakiye-bulundu 
        move bakiye to z-bakiye
     end-if 
     .
*
 kredi-karti-cagir.
      if rez-no > 0
         initialize link-kkart
         move "R"             to link-kkart-nereden
         move rez-no          to link-kkart-rez
                   call "/asya/ytl/obj/otel/kkarti.asy" 
                        using link-kkart
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/kkarti.asy"
                   end-call

           initialize rez-rec
           move link-kkart-rez  to rez-no
           read rez no lock invalid 
               continue 
           end-read 
              move rez-kredi-kart to xrez-kredi-kart
      end-if   .
*
 onodeme-kontrol.
       move 0 to  xrez-onodeme-var
      open input yromhrk.
      open input konuk
      initialize konuk-rec
      move "I"                 to konuk-durumu
      move genel-onodeme-odano to konuk-odano
      start konuk key not < konuk-oda invalid 
           continue 
      not invalid 
      perform with test after until fs-konuk = "10"
      read konuk next no lock end move "10" to fs-konuk
      not at end 
             if konuk-durumu <> "I"  
                   exit perform 
             end-if
             if konuk-odano <> genel-onodeme-odano
                 exit perform 

             end-if
             initialize yromhrk-rec
             move konuk-folio to yromhrk-folio
             start yromhrk key >= yromhrk-anah invalid continue
                 not invalid 
                 perform until fs-yromhrk = "10"
                     read yromhrk next no lock end move "10" to fs-yromhrk
                         not end 
                           if yromhrk-folio not = konuk-folio
                              move "10" to fs-yromhrk
                              exit perform
                           end-if
                           if yromhrk-rez-no not = xrez-no
                                 or   yromhrk-rez-no not > 0
                              exit perform cycle
                           end-if
                           move 1 to   xrez-onodeme-var
                       end-read
                 end-perform 
            end-start
      end-read 
      end-perform
      end-start
      close konuk



      close yromhrk.
      
*
 screen3-Ef-1-Aft-Procedure.
      move 27 to key-status
      set exit-pushed to true
     .
*
 misafir-istek-giris.
           initialize link-vipistek-link-no
           move xrez-no   to link-vipistek-link-no
           call "/asya/ytl/obj/otel/vipistek.asy" 
                        using  link-vipistek-link-no
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                cancel "/asya/ytl/obj/otel/vipistek.asy"

     .
*
 pr-oda-kaldir.
          move 0 to xrez-oda-plan
       display Form1-Pb-4a
     .
*
 pr-kisi-kaldir.
          move 0 to xrez-kisi-plan
       display Form1-Pb-4aa
     .
*
 pr-pan-kaldir.
         move 0 to xrez-pans-plan
       display Form1-Pb-4aaaa
     .
*
 pr-fkonum-kaldir.
        move 0 to xrez-fkonum-plan
       display Form1-Pb-4aaa
     .
*
 blokaj-degisim-yaz.
       open i-o blokd
       initialize blokd-rec 
       move tarih-tasi           to blokd-tarih
       accept blokd-zaman from time
       move rez-no          to blokd-rez-no
       read blokd no lock invalid 
           continue 
       end-read 
       move k-kodu-tasi        to blokd-k-kodu
       move rez-odano          to blokd-odano
       write blokd-rec invalid 
           rewrite blokd-rec end-rewrite 
       end-write 
       close blokd.
*
 refli-konum.      
           if acenta-ref < 1 or acenta-ref > max-ref 
                move 0 to acenta-ref
              end-if
              if acenta-ref not = son-yuklenen-ref
                 modify fiyat-konumu-combo mass-update = 1 reset-list = 1 
                   initialize  tmp-sayi ilk-konum
                 perform varying ki from 1 by 1 until ki > 40 

                  if acenta-ref not = 0 and acenta-ref not = xkonum-ref(ki) 
                    
                      if ki = xrez-fiyat-konumu and eski-rez then 
                           display message box "Satisda olmayan bir konum secili" title "dikkat"
                            else
                           exit perform cycle
                      end-if
                  end-if
                  if xkonum-adi(ki) = spaces 
                     if ki = xrez-fiyat-konumu and eski-rez then 
                           display message box "Satisda olmayan bir konum secili" title "dikkat"
                            else
                           exit perform cycle
                      end-if
                   end-if
                      
    
                        add 1 to tmp-sayi
                     
                  initialize  fiyat-konumu-combo-value
                  move ki     to     fiyat-konumu-combo-value
                  move "->"              to fiyat-konumu-combo-value(3:)
                  move xkonum-adi(ki)         to  fiyat-konumu-combo-value(5:) 
                    if tmp-sayi = 1
                             move ki   to ilk-konum
                             move  fiyat-konumu-combo-value  to ilk-konumx
                         end-if 
                  modify fiyat-konumu-combo,
                         item-to-add(fiyat-konumu-combo-value)
                  
              end-perform
   
                
                 if Xrez-FIYAT-KONUMU < 1 or yeni-rez
                   move ilk-konumx  to fiyat-konumu-combo-value Xrez-FIYAT-KONUMU
                   else
                   if  Xrez-FIYAT-KONUMU > 0 and  Xrez-FIYAT-KONUMU < 40
                        move Xrez-FIYAT-KONUMU     to     fiyat-konumu-combo-value
                        move "->"              to fiyat-konumu-combo-value(3:)
                       move xkonum-adi(Xrez-FIYAT-KONUMU)         to  fiyat-konumu-combo-value(5:) 
                  end-if

                 end-if
                   if xrez-oda-konumu < 1 or yeni-rez
                   move ilk-konumx  to oda-konumu-combo-value xrez-oda-konumu
                    if  Xrez-oda-KONUMU > 1 and  Xrez-oda-KONUMU < 40
                        move Xrez-oda-KONUMU     to     fiyat-konumu-combo-value
                        move "->"              to fiyat-konumu-combo-value(3:)
                       move xkonum-adi(Xrez-oda-KONUMU)         to  fiyat-konumu-combo-value(5:) 
                  end-if
                 end-if
                    
                 modify fiyat-konumu-combo mass-update = 0 
                move acenta-ref to  son-yuklenen-ref
                move fiyat-konumu-combo-value(1:2) to xrez-fiyat-konumu ||| firat diyorki ; alba acenta seciminde referansl 
                move oda-konumu-combo-value(1:2)   to xrez-oda-konumu   ||| konumu ekrana getirip xrez e yazmad iin yapld...
                 display  fiyat-konumu-combo  oda-konumu-combo
              end-if .

*

 webrez-oku.
       perform Acu-formweb1-Routine  .
       .
*
 web-goster.             
          open i-o rezweb
          move rez-no to rezweb-rezno 
          read rezweb no lock invalid 
                move 0 to web-var
                initialize rezweb-rec
          not invalid 
                move 1 to web-var
          end-read
          display a-web  
          close rezweb .
*
 silinen-rez-geri-al.
               if xrez-gir-tar < calisma-tarihi
                 move calisma-tarihi to xrez-gir-tar
                 display accept-gir-gun accept-gir-ay accept-gir-yil
               end-if
               initialize xrez-odano rez-odano
               display accept-odano
               perform xrez-oda-uzat
               perform cast-sil     thru cast-sil-exit 
               perform cast-isle    thru cast-isle-exit
              perform acenhrk-isle thru acenhrk-isle-exit 
              perform takvim-isle  thru takvim-isle-exit 
 
              move k-kodu-tasi     to xrez-staf 
              accept xrez-degis-zaman from time 
              initialize xrez-sil-neden
              move "I"             to xrez-durumu
              initialize xrez-odano 
              display accept-odano
              perform xrez-oda-uzat
              move "4" to xrez-gr-status
              move xrez-rec to rez-rec
              

              accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
              accept rez-edit-zaman from time          |                           
              
              rewrite rez-rec invalid continue
                      initialize rez-rec xrez-rec  yan-deg
                      move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
                      move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                                           oda-konumu-combo-value fiyat-konumu-combo-value
                      perform gun-bul
                      perform form-update
                      move 4    to accept-control
                      move 1002 to control-id
              not invalid
                  perform log-operation-rez
              end-rewrite.
*
 Form1-Ef-1b-Ev-Ntf-Changed.
     
     .
*
 toplu-ac-xls.
      initialize  toplu-rez-adet toplu-oda-adet
      perform varying rami from 1 by 1 until rami > 5
              initialize t
              perform varying t from 1 by 1 until t > 9
                  if link-toplu-xls-grup-adi(rami,t) = spaces and 
                     link-toplu-xls-grup-soy(rami,t) = spaces
                        exit perform cycle
                  else
                     continue 
                  end-if 
              end-perform 
      end-perform
      add 1 to toplu-rez-adet
*       display message box toplu-oda-adet " adet oda icin " toplu-rez-adet " kisi rezervasyon toplu olarak acilacaktir." new-line
*                           "Devam etmek istiyor musunuz? " new-line
*                           title "Toplu Rezervasyon Acilacak......" icon 2 type 2 default 1 giving sonuc3
*           if sonuc3 not = 1 then 
*             call "w$keybuf" using 1,x"1B" end-call
*             exit paragraph
*           end-if
             
        initialize rez-rec xrez-rec
       perform rez-parametre-ata
       perform default-ata
       move link-rez-no to accept-rez-no
       move 1 to control-value
       move 1001 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       perform rez-oku-xls
      
       set exit-pushed to true
         call "w$keybuf" using 1,x"1B" end-call
       exit paragraph .
*
*
 rez-oku-xls.
           modify Form1-Fr-2a visible = true
       
          modify button-kaydet visible = false
          modify button-kaydet-cikma visible = false
          modify mesaj-buttonb   visible = false
           modify button-sil  visible = false
           modify button-cogalt visible = false

          move 0 to yuzde
               perform  yuzde-update 
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                    compute siradaki-rez-no =     0
                  add toplu-rez-adet 1 to rez-oto
                  move rez-oto to xrez-no accept-rez-no
               
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                  compute siradaki-rez-no = rez-oto + 0
                  add toplu-rez-adet to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis

         
            
          move accept-rez-no to xrez-no rez-no
 
          initialize  rezek-rec
          initialize rezek-rezidance
       
             
*              move link-gelen-rec to rez-rec 
              move link-rez-xls-grup-rec  to gruplar-rec

*              if rez-gir-tar < tarih-tasi then 
*                move tarih-tasi to rez-gir-tar
*             end-if
             initialize rez-adi rez-soyadi

             move gruplar-kodu        to xrez-grup-no   xrez-voucher
             move gruplar-adi         to xrez-grup-adi 
                                         xrez-adi(1:20) 
                                         xrez-soyadi(1:20)

             move gruplar-firma       to xrez-firma  
             move gruplar-acenta      to xrez-acenta  
             move gruplar-banka       to xrez-banka  
             move gruplar-doviz       to xrez-doviz   
             move gruplar-pan-tipi    to xrez-pan-tipi  
             move gruplar-anlasma     to xrez-anlasma  
             move gruplar-odeme       to xrez-odeme-tipi  
             move gruplar-pazar       to xrez-pazar   
             move gruplar-ulke        to xrez-ulke  
             move gruplar-gel-tar     to xrez-gir-tar   
             move gruplar-git-tar     to xrez-cik-tar  
             move gruplar-not1        to xrez-not1      
             move gruplar-not2        to xrez-not2     
             move 1                   to xrez-buyuk
             move 1                   to xrez-s-d-t-g
             move gruplar-kaynak-1    to xrez-kaynak-1
             move gruplar-kaynak-2    to xrez-kaynak-2
             move gruplar-kaynak-3    to xrez-kaynak-3 
             move gruplar-satis-tar   to xrez-al-tar
             move gruplar-isl-tar     to xrez-isl-tar
             move gruplar-kur         to xrez-cin-kuru
             
             if function numval(gruplar-adi(99:2)) > 0 and 
                function numval(gruplar-adi(99:2)) < 40
                  move gruplar-adi(99:2)  to xrez-oda-konumu 
                                             xrez-fiyat-konumu
             else
                  display message box "Konum hatasi..." new-line
                                      "Lutfen Kontrol Ediniz..."
                                  title "Uyari"
                                  icon 1
                     set exit-pushed to true 
             end-if 
                
             move rez-oto to xrez-no accept-rez-no 
                             xrez-no rez-no rezek-no

             move link-gelen-xls-sharenum to xrez-sharenum rez-sharenum
             if xrez-sharenum < 0 
                move 0 to xrez-sharenum
             end-if
             if cinpara-kartsiz-pos = 1 then 
                 move rez-no(2:) to xREZ-EXTRA-KART
                 display accept-not2a
             end-if
               move "Y" to rez-yeni-eski

            initialize  xrez-odano 
             perform okunan-goster
              move  siradaki-rez-no to sifir-rez-no
            initialize gec-gecme
             perform anlasma-bul
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if.
               initialize rami
               perform varying rami from 1 by 1 until rami > 5
                     
                        if link-toplu-xls-grup-adi(rami,1) not = spaces or 
                           link-toplu-xls-grup-soy(rami,1) not = spaces
                                add 1 to  siradaki-rez-no
                                move siradaki-rez-no to xrez-no  accept-rez-no
                                display accept-rezno
                                move  link-toplu-xls-grup-adi(rami,1) to xrez-adi 
                                move  link-toplu-xls-grup-soy(rami,1) to xrez-soyadi
                                move link-toplu-xls-dog-tar(rami,1)   to d-tar1
                                display accept-adi accept-soyadi l-d-gun1 l-d-ay1 l-d-yil1  

                              if link-toplu-xls-grup-adi(rami,2) not = spaces or  
                                   link-toplu-xls-grup-soy(rami,2) not = spaces 
                                    if link-share-xls-yok not = 1 
                                       perform  yeni-share-al-toplu 
                                    else
                                       move  link-toplu-xls-grup-adi(rami,2)  to adi2
                                       move  link-toplu-xls-grup-soy(rami,2)  to soy2
                                       move  link-toplu-xls-dog-tar(rami,2)   to d-tar2
                                       move  link-toplu-xls-grup-adi(rami,3)  to adi3
                                       move  link-toplu-xls-grup-soy(rami,3)  to soy3
                                       move  link-toplu-xls-dog-tar(rami,3)   to d-tar3
                                       move  link-toplu-xls-grup-adi(rami,4)  to adi4
                                       move  link-toplu-xls-grup-soy(rami,4)  to soy4
                                       move  link-toplu-xls-dog-tar(rami,4)   to d-tar4

                                       display l-soy3 l-adi3 l-adi2 l-soy2 l-adi4 l-soy4  
                                               l-d-gun2 l-d-ay2 l-d-yil2
                                               l-d-gun3 l-d-ay3 l-dyil3 
                                               l-d-gun4 l-d-ay4 l-d-yil4  
                                    end-if                           

                                   if link-toplu-xls-grup-adi(rami,3) not = spaces or  
                                      link-toplu-xls-grup-soy(rami,3) not = spaces 
                                            move 3 to xrez-buyuk   
                                     if link-toplu-xls-grup-adi(rami,4) not = spaces or 
                                        link-toplu-xls-grup-soy(rami,4) not = spaces
                                            move 4 to xrez-buyuk   
                                     end-if
                                   else 
                                      move 2 to xrez-buyuk                                     
                                   end-if
                              else
                                  move 1 to xrez-buyuk                                 
                              end-if  
     
                           if cinpara-kartsiz-pos = 1 then 
                                move xrez-no(2:) to xREZ-EXTRA-KART
                               display accept-not2a
                           end-if
                           move link-toplu-xls-voucher(rami,1) to xrez-voucher 
                                                                                      
                           move 2 to key-status
                           perform  exception-procedure
                           perform  yuzde-update                                        
                                    open input acenta aceanlas yassinir  yanrez polisxml arez
                                    move rez-no to lnk-rez-no
*                                    move 1 to link-var
                                    initialize tum-y
                                    perform link1
                                
                                    move myassinir-pax to xrez-buyuk
                                    move myassinir-chi to xrez-kucuk
                                    move myassinir-fre to xrez-free
                                    move myassinir-beb to xrez-bebek
                                    close acenta aceanlas yassinir  yanrez polisxml arez

                           move "E"       to rez-yeni-eski
                            
                           move 2 to key-status
                           perform  exception-procedure
                           perform  yuzde-update 

                           display accept-adi accept-soyadi


                    end-if
                      
               end-perform           
           .
*
 l-yaz.
      continue.
 eski-yaz.
      continue.
 yeni-yaz.
    continue.
 a-yaz.
     continue.
*
 Form1-Cb-1-Ev-Cmd-Clicked.
     display message box xrez-paylas-oda event-data-1 event-data-2
     
     .
*
*
 onb-adres-aktar.
     if tr-sec(1:30) = spaces 
          move acenta-dosya       to acenta2-acuserve-dosya          
          move fiyatana-dosya     to fana2-acuserve-dosya            
          move aksiyon-dosya      to aks2-acuserve-dosya                 
          move aksiyon2-dosya     to aks22-acuserve-dosya            
          move aceanlas-dosya     to ace2-acuserve-dosya             
          move not-dosya          to not2-acuserve-dosya             
          move acebavel-dosya     to acebavel2-acuserve-dosya        
          move firma-dosya        to firma2-acuserve-dosya           
          move fiyat-dosya        to fiyat2-acuserve-dosya           
          move rez-dosya          to rez2-acuserve-dosya             
          move yanrez-dosya       to yanrez2-acuserve-dosya          
          move cast-dosya         to cast4-acuserve-dosya            
          move genelfis-dosya     to genelfis2-acuserve-dosya        
                                                                     
          move tr-sec(31:8)         to acenta2-acuserve-dosya(21:8)       
                                        fana2-acuserve-dosya(21:8)                
                                        aks2-acuserve-dosya(21:8)                 
                                        aks22-acuserve-dosya(21:8)                
                                        ace2-acuserve-dosya(21:8)                 
                                        not2-acuserve-dosya(21:8)                 
                                        acebavel2-acuserve-dosya(21:8)            
                                        firma2-acuserve-dosya(21:8)               
                                        fiyat2-acuserve-dosya(21:8)               
                                        rez2-acuserve-dosya(21:8)                 
                                        yanrez2-acuserve-dosya(21:8)              
                                        cast4-acuserve-dosya(21:8)                
                                        genelfis2-acuserve-dosya(21:8)            
        exit paragraph                                               
     end-if
     if tr-sec = spaces then 
          move acenta-dosya       to acenta2-ACUSERVE-DOSYA       
          move fiyatana-dosya     to fana2-ACUSERVE-DOSYA         
          move aksiyon-dosya      to aks2-ACUSERVE-DOSYA   
          move aksiyon2-dosya     to aks22-ACUSERVE-DOSYA    
          move aceanlas-dosya     to ace2-ACUSERVE-DOSYA          
          move not-dosya          to not2-ACUSERVE-DOSYA          
          move acebavel-dosya     to acebavel2-ACUSERVE-DOSYA     
          move firma-dosya        to firma2-ACUSERVE-DOSYA        
       
          move fiyat-dosya        to fiyat2-ACUSERVE-DOSYA  
          move rez-dosya          to rez2-ACUSERVE-DOSYA  
          move yanrez-dosya       to yanrez2-ACUSERVE-DOSYA  
          move cast-dosya         to cast4-ACUSERVE-DOSYA  
          move genelfis-dosya     to genelfis2-ACUSERVE-DOSYA   

    else 
        move tr-sec(31:8) to        
                                      rez2-dosya-adres
                                      yanrez2-dosya-adres
                                      cast4-dosya-adres
                                     genelfis2-dosya-adres


            string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   rez2-dosya           delimited " "
                   into rez2-ACUSERVE-DOSYA 
            string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   yanrez2-dosya           delimited " "
                   into yanrez2-ACUSERVE-DOSYA 
           string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   cast4-dosya           delimited " "
                   into cast4-ACUSERVE-DOSYA 

           string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   genelfis2-dosya           delimited " "
                   into genelfis2-ACUSERVE-DOSYA 




            string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   acenta-dosya           delimited " "
                   into acenta2-ACUSERVE-DOSYA 
              string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values


                   fiyatind-dosya           delimited " "
                   into find2-ACUSERVE-DOSYA 
        
        
             string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyatana-dosya           delimited " "
                   into fana2-ACUSERVE-DOSYA   

           string "@" delimited by low-values


                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values

                   aksiyon-dosya           delimited " "
                   into aks2-ACUSERVE-DOSYA   
            string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   aksiyon2-dosya           delimited " "
                   into aks22-ACUSERVE-DOSYA   

           string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   aceanlas-dosya           delimited " "
                   into ace2-ACUSERVE-DOSYA 

           string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   not-dosya           delimited " "
                   into not2-ACUSERVE-DOSYA 

          string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "



                    ":" delimited by low-values
                   acebavel-dosya           delimited " "
                   into acebavel2-ACUSERVE-DOSYA  

           string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   firma-dosya           delimited " "
                   into firma2-ACUSERVE-DOSYA  

          
    
          string "@" delimited by low-values
                   tr-sec(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyat-dosya           delimited " "
                   into  fiyat2-ACUSERVE-DOSYA.
*

 screen4-Aft-Initdata.
     initialize gd-rec
     move "Sr"  to gd-sira
     move "Cocuk Adi " to gd-adi
     move "Yas " to gd-yas
     modify gd(1) record-data = gd-rec     .
      perform varying yi from 1 by 1 until yi > 10
      initialize gd-rec
        move yi   to z-2 
        move z-2   to gd-sira
        move cocuk-yas(yi) to z-2 
        move z-2           to gd-yas
        modify gd(yi + 1 ) record-data = gd-rec
      end-perform  .
*
 screen4-Ex-Other.
     if key-status = 2 then        
        perform varying yi from 1 by 1 until yi > 10
          inquire gd(yi + 1 , 3) cell-data in gd-yas
          if function numval(gd-yas) > 0 
            continue
          else
            initialize gd-yas
          end-if
          move function numval(gd-yas)  to cocuk-yas2(yi)          
        end-perform
        perform yas-sirala
        perform yas-hesap       
        move 1 to yas-kaydedildi
        set exit-pushed to true
     end-if.
*
  yas-sirala.
        sort C22 descending KEY cocuk-yas2
        move coklar2 to cocuklar
            .
*
 yas-hesap.
       open input aceanlas  yassinir
       initialize  lnk2.
       move xrez-al-tar to lnk2-al-tar
         move xrez-gir-tar   to lnk2-gir-tar  
    move  xrez-cik-tar  to lnk2-cik-tar  
      move xrez-acenta  to  lnk2-acenta
      move xrez-anlasma to  lnk2-anlasma
      perform varying pi from 1 by 1 until pi > xrez-buyuk
              move 50 to lnk2-yas(pi)
      end-perform 
       open input acenta
          move xrez-acenta to acenta-kodu
          read acenta no lock invalid continue
          end-read
       close acenta    
      perform varying zi from pi by 1 until  zi > 8
          compute ai = zi - pi + 1 
          if ai not > 5 
         if cocuk-yas(ai) > 0 then            
            move cocuk-yas(ai)  to   lnk2-yas(zi)
         end-if

         end-if
     end-perform 
      
      perform link2
      close aceanlas yassinir
      if  myassinir-pax >  xrez-buyuk then 
        
        display message box "Pax Sayisi  artirildi " title "PAX"
          compute ai = myassinir-pax - xrez-buyuk
         perform varying yi from 1 by 1 until yi >  8
            compute zi = yi + ai
             move cocuk-yas( zi) to cocuk-yas( yi )
          end-perform 

      end-if
  
      move  myassinir-pax  to xrez-buyuk   
 
      move myassinir-chi  to xrez-kucuk    
      move myassinir-fre  to xrez-free.
*
 gd-Ev-Msg-Begin-Entry.
    if event-data-1   = 1 or 2 
          set event-action to event-action-fail
    end-if

*     if event-data-2 > 2
*     inquire gd(event-data-2 - 1 , 3) cell-data in gd-yas 
*     if function numval(gd-yas) not > 0 
*         set event-action to event-action-fail
*          end-if
*    end-if
     .
*
 gd-Ev-Msg-Finish-Entry.
    
*             if event-data-2 > 2
*        
*             inquire gd(event-data-2 - 1 , 3) cell-data in gd-yas 
*              inquire gd(event-data-2  , 3) cell-data in bu-yas
*             if function numval(gd-yas) < function numval(bu-yas)
*                  modify gd(event-data-2  , 3) cell-data = "     "
*                   display message box "Yas Sirasi ile giriniz"
*                  end-if
*            end-if
     .
*
 yanrez-karalist-kontrol.
            evaluate klist-yan-kac
            when 2
                   MOVE adi2 TO ykara-isim
                   move soy2 to ykara-soyisim
            when 3
                   MOVE adi3 TO ykara-isim
                   move soy3 to ykara-soyisim
            when 4
                   MOVE adi4 TO ykara-isim
                   move soy4 to ykara-soyisim
            when 5
                   MOVE adi5 TO ykara-isim
                   move soy5 to ykara-soyisim
            when 6
                   MOVE adi6 TO ykara-isim
                   move soy6 to ykara-soyisim
            when 7
                   MOVE adi7 TO ykara-isim
                   move soy7 to ykara-soyisim
            when 8
                   MOVE adi8 TO ykara-isim
                   move soy8 to ykara-soyisim
            when 9
                   MOVE adi9 TO ykara-isim
                   move soy9 to ykara-soyisim
            when other 
                   exit paragraph
            END-EVALUATE
            if ykara-isim = spaces or ykara-soyisim = spaces
                  exit paragraph
            end-if
            open input karalist            
              move "M" to karalist-tipi 
              move ykara-isim    to karalist-adi 
              move ykara-soyisim to karalist-soyadi 
              read karalist no lock invalid 
                  continue
              not invalid 
                   display message box  karalist-adi " " karalist-soyadi " Misafir Kara Listede.." new-line
                                        "Aciklama : " KARALIST-ACK-1 new-line
                                        "Aciklama : " KARALIST-ACK-2 new-line
                                        "Islem iptal edildi."
                                   title "Uyari"
                                   icon 2
                   close karalist
                   
                   move 1 to gec-gecme
                   exit paragraph
              end-read
            close karalist.
*
 acc-viptipi-Ex-Ntf-Changed.
     initialize xrez-vip-oto-degis
     .
*
 acc-viptipi-Ev-Ntf-Changed.
     initialize xrez-vip-oto-degis
     .
*
 acc-viptipi-Aft-Procedure.
     initialize xrez-vip-oto-degis
     perform vip-goster
     .
*
 gf-Ev-Msg-Begin-Entry.
     
      if  event-data-2 > 1
          
         inquire f-onay(event-data-2,1)  hidden-data in ONAY-id 
         if ONAY-rec not = spaces
         open i-o onay
         read onay no lock invalid
             perform onay-getir
             not invalid 
            
             if ONAY-VERILDI and ONAY-VERI-eski = eski-tarlar then 
                move ONAY-VERI-yeni to xrez-tarlar
                   display accept-cik-gun accept-cik-ay accept-cik-yil 
                             accept-gir-gun accept-gir-ay accept-gir-yil 
                          display message box  "Onaylanan Talep Uygulandi " new-line
                          "Kaydetdiginizde Gecerli Olacaktir" title "Onay"
             else
               perform onay-getir
             end-if

        end-read
        close onay
        else
           perform onay-getir
        end-if       
    end-if
     set event-action to event-action-fail
     .
* 
 onay-getir.
     inquire f-onay(event-data-2,1)  hidden-data in link-onay 
                  call "/asya/ytl/obj/otel/onaygir.asy" 
                       using link-onay 
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/onaygir.asy"
                  end-call .
*
 f-onay-Ev-Other.
     
     .
*
 silinmis-rez-ara.
      move "  Asagidaki Silinimis Rezervasyon benzeri Rezervasyon girmektesiniz......." to ilk-sil-text
      move "S" to rez-durumu
      move ilk-sil-text to  sil-text
      move xrez-soyadi to rez-soyadi(1:5)
      start rez key <= rez-soy invalid continue
         not invalid 
           perform until fs-rez = "10"
             read rez next no lock end move "10" to fs-rez
                not end 
                  if rez-soyadi(1:5) not = xrez-soyadi(1:5) then 
                      exit perform 
                  end-if
                  perform silinmis-kriter
                  if   s-kriter = 1 then 
                     move rez-gir-yil to eyil move rez-gir-ay to eay move rez-gir-gun to egun
                    
                     string sil-text  delimited by "              "
                     new-line delimited by size
                     rez-no delimited by size
                     
                       "  nolu " delimited by size
                       etarih    delimited by size
                       " girisli "  delimited by size
                       rez-adi delimited by "    "
                       " " delimited by size
                       rez-soyadi delimited by "    "
                        " " delimited by size
                        new-line delimited by size
                        
                        into sil-text
                  end-if
             end-read
           end-perform
      end-start
        if sil-text(1:300) not =  ilk-sil-text(1:300) then
           string    new-line delimited by size
                     
                        sil-text  delimited by "              "
                        " Lutfen Kontrol Ediniz ........" delimited by size
                        into sil-text
          move 1 to xrez-sil-uyarildi
          display message box sil-text
          else
           move 1 to xrez-sil-uyarildi
        end-if
                        .
 
*
 silinmis-kriter.
     move 1 to s-kriter 
     if rez-adi(1:5) not = xrez-adi(1:5) then move 0 to s-kriter end-if.
     if rez-soyadi(1:5) not = xrez-soyadi(1:5) then move 0 to s-kriter end-if.
     if rez-gir-yil not = xrez-gir-yil  then  move 0 to s-kriter end-if.
*
 xrez-oda-uzat.  
            move  xrez-odano to o-kisa 
            perform oda-uzat
            move o-uzun to xrez-odano-uzun.
            display accept-odano-uzun.
*
 xrez-oda-kisalt.
         if genel-uzun-oda-no-kullanilsin = 1 
            move  xrez-odano-uzun  to o-uzun
            perform oda-kisalt
            move o-kisa to   xrez-odano
            display accept-odano
         end-if.
*
 accept-odano-Ex-Ntf-Changed.
     perform xrez-oda-kisalt
     .
*
 formweb1-Aft-Initdata.
     open i-o rezweb 
     move xrez-no            to web-rezno rez-no
     initialize rezweb-rec 
     move web-rezno          to rezweb-rezno
     read rezweb no lock invalid
          initialize rezweb-rec 
     end-read
     read rez no lock invalid
          initialize rez-rec 
     end-read
     move rezweb-eyalet            to web-cc-user
     if rezweb-pkodu <> spaces 
        move rezweb-pkodu(1:1) to web-ode-tip
     else 
        move "Y"               to web-ode-tip
     end-if
     move rezweb-adres             to web-sip-no
     if rezweb-sehir <> spaces
        move rezweb-sehir(1:1) to web-cek-tip
     else
        move "Y"               to web-cek-tip
     end-if
     move rezweb-ulkem             to web-ulke
     move rezweb-not               to web-not
     move rezweb-tel               to web-tel
     move rezweb-email             to web-mail
     move rezweb-yatak             to web-yatak
     move rezweb-sigara            to web-sigara-icilmez
     move rezweb-erken-giris       to web-erken
     move rezweb-gec-cikis         to web-gec 
     move rezweb-internal-voucher  to web-ind-kodu
     move rezweb-extra-adi(1)      to web-adi-1
     move rezweb-extra-aciklama(1) to web-acik-1 
     move rezweb-extra-tl-tutar(1) to web-tl-tut-1 
     move rezweb-extra-dv-tutar(1) to web-dv-tut-1
     move rezweb-extra-adi(2)      to web-adi-2
     move rezweb-extra-aciklama(2) to web-acik-2 
     move rezweb-extra-tl-tutar(2) to web-tl-tut-2 
     move rezweb-extra-dv-tutar(2) to web-dv-tut-2
     move rezweb-extra-adi(3)      to web-adi-3
     move rezweb-extra-aciklama(3) to web-acik-3 
     move rezweb-extra-tl-tutar(3) to web-tl-tut-3 
     move rezweb-extra-dv-tutar(3) to web-dv-tut-3
     move rezweb-kredi-karti       to web-kk-kodu
     if rez-call-center <> spaces
        move "C" to web-cc
     else
        move "B" to web-cc             
     end-if
     display acc-web-1301 acc-web-1302 acc-web-1303 acc-web-1304 acc-web-1305   
             acc-web-1306 acc-web-1307 acc-web-1308 acc-web-1309 acc-web-1310   
             acc-web-1311 acc-web-1312 acc-web-1313 acc-web-1314 acc-web-1315   
             acc-web-1316 acc-web-1317 acc-web-1318 acc-web-1319 acc-web-1320   
             acc-web-1321 acc-web-1322 acc-web-1323 acc-web-1324 acc-web-1325 
             acc-web-1326 cm-web-1301  cm-web-1302  cm-web-1303  cb-web-1301
     close rezweb 
        .
*
 pb-web-kaydet-Link.      
     if web-rezno = spaces 
        display message box "Rezervasyon numaras bos gecilemez"
        exit paragraph
     end-if
     open i-o rezweb 
     initialize rezweb-rec 
     move web-rezno to rezweb-rezno
     read rezweb no lock invalid
          continue
     end-read
     move web-cc-user         to rezweb-eyalet   
     if web-ode-tip(1:1) <> "Y"   
        move web-ode-tip(1:1) to rezweb-pkodu 
     end-if      
     move web-sip-no          to rezweb-adres            
     if web-cek-tip(1:1) <> "Y"   
        move web-cek-tip(1:1) to rezweb-sehir            
     end-if      
     move web-ulke            to rezweb-ulkem            
     move web-not             to rezweb-not              
     move web-tel             to rezweb-tel              
     move web-mail            to rezweb-email            
     move web-yatak           to rezweb-yatak            
     move web-sigara-icilmez  to rezweb-sigara           
     move web-erken           to rezweb-erken-giris      
     move web-gec             to rezweb-gec-cikis        
     move web-ind-kodu        to rezweb-internal-voucher 
     move web-adi-1           to rezweb-extra-adi(1)     
     move web-acik-1          to rezweb-extra-aciklama(1)
     move web-tl-tut-1        to rezweb-extra-tl-tutar(1)
     move web-dv-tut-1        to rezweb-extra-dv-tutar(1)
     move web-adi-2           to rezweb-extra-adi(2)     
     move web-acik-2          to rezweb-extra-aciklama(2)
     move web-tl-tut-2        to rezweb-extra-tl-tutar(2)
     move web-dv-tut-2        to rezweb-extra-dv-tutar(2)
     move web-adi-3           to rezweb-extra-adi(3)     
     move web-acik-3          to rezweb-extra-aciklama(3)
     move web-tl-tut-3        to rezweb-extra-tl-tutar(3)
     move web-dv-tut-3        to rezweb-extra-dv-tutar(3)
     move web-kk-kodu         to rezweb-kredi-karti
     write rezweb-rec invalid
           rewrite rezweb-rec invalid
                   continue
           not invalid
               move 1 to yaz-gitsin-dayi 
           end-rewrite 
     not invalid
         move 1 to yaz-gitsin-dayi 
     end-write 
     if yaz-gitsin-dayi = 1
        initialize rez-rec
        move rezweb-rezno to rez-no 
        read rez no lock invalid
             continue
        end-read
        if web-cc(1:1) = "C"
           move "call" to rez-call-center
        else
           initialize rez-call-center
        end-if

        accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
        accept rez-edit-zaman from time          |                           
        
        rewrite rez-rec invalid
           display "(call) rez datasina yazilamadi."
        end-rewrite 
        perform log-operation-rez
     end-if
     close rezweb     
     .
*
 toplam-fiyat-gir.





     .
*
 Form5-Aft-Initdata.
     perform tf-grid-baslik-yukle
     perform tf-grid-detay-yukle
     .
*
 tf-gun-hesapla.
     initialize takvim-rec gun-s
     move xrez-gir-tar to takvim-anah
     start takvim key not < takvim-anah invalid 
           continue
     not invalid
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
         if takvim-anah >= xrez-cik-tar
             move "10" to fs-takvim
           else
             add 1 to gun-s                      
         end-if 
     end-read
     end-perform  
     end-start
     move gun-say to gun-s
     .
*
 tf-grid-detay-yukle.
     initialize gd-tf-record
     move "Toplam Tutar" to gd-tf-col-1
     modify gd-tf, record-to-add(gd-tf-record)

     perform tf-gun-hesapla

     initialize takvim-rec gun-s
     move xrez-gir-tar to takvim-anah
     start takvim key not < takvim-anah invalid 
           continue
     not invalid
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end
         if xrez-cik-tar = takvim-anah
            exit perform 
         end-if

         initialize gd-tf-record
         move takvim-gun to gd-tf-col-1(1:)
         move "/"        to gd-tf-col-1(3:)
         move takvim-ay  to gd-tf-col-1(4:)
         move "/"        to gd-tf-col-1(6:)
         move takvim-yil to gd-tf-col-1(7:)
         modify gd-tf, record-to-add(gd-tf-record)

     end-read
     end-perform  
     end-start
     .
*
 tf-grid-baslik-yukle.
     modify gd-tf, reset-grid = 1 
     modify gd-tf, mass-update = 1 
     initialize gd-tf-record 
     move "Detay"  to gd-tf-col-1
     move "Tutar"  to gd-tf-col-2
     modify gd-tf, record-to-add(gd-tf-record)
     .
 
*
 gd-tf-Ev-Other.

     .
*
 pb-1301-Link.
     initialize hes-cagir
     move accept-rez-no to hes-cagir-giden-rez
     move xrez-adi      to hes-cagir-giden-adi(1)
     move xrez-soyadi   to hes-cagir-giden-soyadi(1)
     move d-tar1        to hes-cagir-giden-dogtar(1)
     move adi2          to hes-cagir-giden-adi(2)
     move soy2          to hes-cagir-giden-soyadi(2)
     move d-tar2        to hes-cagir-giden-dogtar(2)
     move adi3          to hes-cagir-giden-adi(3)
     move soy3          to hes-cagir-giden-soyadi(3)
     move d-tar3        to hes-cagir-giden-dogtar(3)
     move adi4          to hes-cagir-giden-adi(4)
     move soy4          to hes-cagir-giden-soyadi(4)
     move d-tar4        to hes-cagir-giden-dogtar(4)
     move adi5          to hes-cagir-giden-adi(5)
     move soy5          to hes-cagir-giden-soyadi(5)
     move d-tar5        to hes-cagir-giden-dogtar(5)
     move adi6          to hes-cagir-giden-adi(6)
     move soy6          to hes-cagir-giden-soyadi(6)
     move d-tar6        to hes-cagir-giden-dogtar(6)
     move adi7          to hes-cagir-giden-adi(7)
     move soy7          to hes-cagir-giden-soyadi(7)
     move d-tar7        to hes-cagir-giden-dogtar(7)
     move adi8          to hes-cagir-giden-adi(8)
     move soy8          to hes-cagir-giden-soyadi(8)
     move d-tar8        to hes-cagir-giden-dogtar(8)
     move adi9          to hes-cagir-giden-adi(9)
     move soy9          to hes-cagir-giden-soyadi(9)
     move d-tar9        to hes-cagir-giden-dogtar(9)
     call "/asya/ytl/obj/otel/hesgir.asy" 
                using hes-cagir 
                on exception 
                perform callerr-proc
                exit paragraph
                not on exception 
     cancel "/asya/ytl/obj/otel/hesgir.asy"
     end-call
     .
*
 accept-tel-no-Ev-Cmd-Goto.
     if genel2-gelismis-telefon = 1 
        perform Acu-Form3-Routine
        display accept-tel-no
     end-if
     .
*
 Form3-Ex-Other.
     evaluate key-status 
         when 2
              if tel-telno <> spaces 
                 move tum-tel to xrez-telefon-no
              end-if
              set exit-pushed to true
     end-evaluate
     .
*
 sifreleme-yap.
                  unstring sifreli-text delimited by " " into
                           kelimem(1)
                           kelimem(2)
                           kelimem(3)
                           kelimem(4)
                           kelimem(5)
                           kelimem(6)
                           kelimem(7)
                           kelimem(8)
                           kelimem(9)
                           kelimem(10)
                  
                  inspect kelime-occurs replacing all spaces by low-values
                  
                  perform varying r
                  from 1
                  by 1
                  until r > 10
                  
                     initialize word-length
                     perform varying word-length
                     from 1 
                     by 1
                     until word-length > 50
                        if kelimem(r)(word-length:1) = low-values 
                           exit perform  
                        end-if
                     end-perform 
                     compute word-length = word-length - 3
                  
                     if kelimem(r) <> low-values                        
                        move all "*" to kelimem(r)(3:word-length)
                     end-if
                  end-perform                                                                                                                   
                  
                  initialize sifreli-text
                  move low-values                 to sifreli-text
                  
                  perform varying r
                  from 1
                  by 1
                  until r > 10
                      string sifreli-text 
                             kelimem(r) delimited by low-values
                             " "       delimited by low-values
                             into sifreli-text
                  end-perform
                  inspect sifreli-text replacing all low-values by spaces.

 
