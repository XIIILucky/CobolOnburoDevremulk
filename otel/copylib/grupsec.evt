* grupsec.evt
* grupsec.evt is generated from D:\asya\acugt.ytl\otel\grupsec.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
      perform adresleri-tasi
      move zeroes   to filtre-gir-tar filtre-cik-tar deg-tar etki-tar
     .
*
 Form1-Aft-Initdata.
     open input gruplar
     initialize gruplar-rec 
     move secim-grup-no        to gruplar-kodu
     read gruplar no lock invalid 
          display message box "Grup Secimi Yapilmadi..."
                          title "Uyari"
                          icon 1
                 close gruplar
                 set exit-pushed to true 
     end-read
          modify fr-grup-adi, TITLE = gruplar-adi
     close gruplar.
     perform baslik-yukle
     perform grid-yukle.
 
*
 Form1-Ex-Other.
     evaluate key-status
     when 1
         evaluate control-id
         when 63
            perform konum-ara
         when 1016
            perform banka-ara
         when 113
            perform doviz-ara
         when 115
            perform pansiyon-ara
         when 54
            perform pansiyon-deg-ara          
         when 117
            perform odeme-ara
         when 125 
            perform anlasma-ara
         when 124
            perform pazar-ara
         when 121
            perform ulke-ara
         when 120
            perform kaynak1-ara
         when 138
            perform kaynak2-ara
         when 135
            perform kaynak3-ara
         when 127
            perform acenta-ara
         when 130 
            perform firma-ara
         when 38
            perform vip-ara
         end-evaluate
     when 2
        perform degisim-uygula
     when 5
        perform baslik-yukle
        perform grid-yukle
     when 1247
        perform cast-degisim-rez-bul
        move etki-tar    to deg-tar
        display acc-deg-gun acc-deg-ay acc-deg-yil
     when 1248
        perform cast-degisim-yap
     when 18
               initialize sayac
               inquire form1-gd-1,cursor-y in sayac
               inquire form1-gd-1(sayac,15),
                       cell-data in ydk-rez-no
             perform rez-cagir-1      
     when 1000  
         if banka-isaret = 1
            modify accept-banka,enabled = true 
            modify lb-banka,enabled = true
         else
            modify accept-banka,enabled = false 
            modify lb-banka,enabled = false 
         end-if 
     when 1001 
         if doviz-isaret = 1
            modify accept-doviz,enabled = true 
            modify lb-doviz,enabled = true
         else
            modify accept-doviz,enabled = false 
            modify lb-doviz,enabled = false 
         end-if 
     when 1002
         if pan-isaret = 1
            modify accept-pan,enabled = true 
            modify lb-pansiyon,enabled = true
         else
            modify accept-pan,enabled = false 
            modify lb-pansiyon,enabled = false 
         end-if 
     when 1003
         if odeme-isaret = 1
            modify accept-odeme,enabled = true 
            modify lb-odeme,enabled = true
         else
            modify accept-odeme,enabled = false 
            modify lb-odeme,enabled = false 
         end-if 
     when 1004
         if anlasma-isaret = 1
            modify accept-anlasma,enabled = true 
            modify lb-anlasma,enabled = true
         else
            modify accept-anlasma,enabled = false 
            modify lb-anlasma,enabled = false 
         end-if 
     when 1005
         if pazar-isaret = 1
            modify accept-pazar,enabled = true 
            modify lb-pazar,enabled = true
         else
            modify accept-pazar,enabled = false 
            modify lb-pazar,enabled = false 
         end-if 
     when 1006
         if ulke-isaret = 1
            modify accept-ulke,enabled = true 
            modify lb-ulke,enabled = true
         else
            modify accept-ulke,enabled = false 
            modify lb-ulke,enabled = false 
         end-if 
     when 1007
         if kaynak1-isaret = 1
            modify accept-kaynak1,enabled = true 
            modify lb-kaynak1,enabled = true
         else
            modify accept-kaynak1,enabled = false 
            modify lb-kaynak1,enabled = false 
         end-if 
     when 1008
         if kaynak2-isaret = 1
            modify accept-kaynak2,enabled = true 
            modify lb-kaynak2,enabled = true
         else
            modify accept-kaynak2,enabled = false 
            modify lb-kaynak2,enabled = false 
         end-if 
     when 1009
         if kaynak3-isaret = 1
            modify accept-kaynak3,enabled = true 
            modify lb-kaynak3,enabled = true
         else
            modify accept-kaynak3,enabled = false 
            modify lb-kaynak3,enabled = false 
         end-if 
     when 1010
          if cin-isaret = 1
             modify accept-cin-gun,enabled = true
             modify accept-cin-ay,enabled = true
             modify accept-cin-yil,enabled = true
             move tarih-tasi       to gelis-tar

             display accept-cin-gun 
                     accept-cin-ay 
                     accept-cin-yil
          else 
             modify accept-cin-gun,enabled = false
             modify accept-cin-ay,enabled = false
             modify accept-cin-yil,enabled = false
             initialize gelis-tar
             display accept-cin-gun 
                     accept-cin-ay 
                     accept-cin-yil

          end-if 
     when 1011     
          if cout-isaret = 1
             modify accept-cout-gun,enabled = true
             modify accept-cout-ay,enabled = true
             modify accept-cout-yil,enabled = true
             move tarih-tasi       to cikis-tar
             display accept-cout-gun 
                     accept-cout-ay 
                     accept-cout-yil

          else 
             modify accept-cout-gun,enabled = false
             modify accept-cout-ay,enabled = false
             modify accept-cout-yil,enabled = false
             initialize cikis-tar
             display accept-cout-gun 
                     accept-cout-ay 
                     accept-cout-yil
          end-if          
     when 1012
         if firma-isaret = 1
            modify accept-firma,enabled = true 
            modify lb-firma,enabled = true
         else
            modify accept-firma,enabled = false 
            modify lb-firma,enabled = false 
         end-if 
     when 1013
         if acenta-isaret = 1
            modify accept-acenta,enabled = true 
            modify lb-acenta,enabled = true
         else
            modify accept-acenta,enabled = false 
            modify lb-acenta,enabled = false 
         end-if 
     when 1014
         if not1-isaret = 1
            modify accept-not1,enabled = true 
         else
            modify accept-not1,enabled = false 
         end-if 
     when 1015
         if not2-isaret = 1
            modify accept-not2,enabled = true 
         else
            modify accept-not2,enabled = false 
         end-if
     when 1016
         if odeme-durumu-isaret = 1
            modify cb-odeme-durumu,enabled = true 
         else
            modify cb-odeme-durumu,enabled = false 
         end-if        
     when 1017
         if no-post-isaret = 1
            modify cb-no-post,enabled = true 
         else
            modify cb-no-post,enabled = false 
         end-if        
     when 1018
        if mistip-isaret = 1
          modify accept-mis-durum ,enabled = true
        else
          modify accept-mis-durum ,enabled = false
        end-if
     when 1019
        if voucher-isaret = 1
          modify accept-voucher,enabled = true 
        else
          modify accept-voucher,enabled = false
        end-if 
     end-evaluate 
     
     .
*
 baslik-yukle.
     modify form1-gd-1,reset-grid = 1
                       mass-update = 1
     initialize form1-gd-1-record
     move "#"   to gd-1-col-1
     move "Adi"      to gd-1-col-2
     move "Soyadi"   to gd-1-col-3
     move "C/In Tarihi" to gd-1-col-4
     move "C/Out Tarihi" to gd-1-col-5
     move "Firma"        to gd-1-col-6
     move "Acenta"       to gd-1-col-7
     move "Pax"          to gd-1-col-8
     move "Child"        to gd-1-col-9
     move "Pansiyon"     to gd-1-col-10
     move "Fiyat"        to gd-1-col-11
     move "DV"           to gd-1-col-12
     move "#"            to gd-1-col-13
     move "C/In"         to gd-1-col-14
     move "Rez No"       to gd-1-col-15
     modify form1-gd-1,
           record-to-add(form1-gd-1-record).
*
 grid-yukle.
    open input firma acenta doviz cast rez route
    initialize rez-rec 
               toplam-oda-sayisi toplam-kisi-sayi secim-durumu
    move 1                to toplam-kayit-sayi
    move gruplar-kodu     to rez-grup-no
    move "I"              to rez-durumu
    start rez key not < rez-grup invalid 
         continue 
    not invalid 
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10"   to fs-rez
    not at end
           if rez-grup-no <> gruplar-kodu or 
              rez-durumu <> "I"
                 exit perform 
           end-if 
           if rez-c-in = "E"
               exit perform cycle 
           end-if
           if rez-k-g-b not = "K"
               exit perform cycle 
           end-if
             
           if rez-gir-tar not = filtre-gir-tar and
              filtre-gir-tar not = zeroes 
                 exit perform cycle 
           end-if 

           if rez-cik-tar not = filtre-cik-tar and
              filtre-cik-tar not = zeroes 
                 exit perform cycle 
           end-if

           if filtre-konum > 0
              if rez-oda-konumu <> filtre-konum
                 exit perform cycle
              end-if 
           end-if 

           initialize form1-gd-1-record
           move rez-no          to gd-1-col-15
           move rez-adi         to gd-1-col-2
           move rez-soyadi      to gd-1-col-3

           move rez-gir-gun     to egun
           move rez-gir-ay      to eay
           move rez-gir-yil     to eyil
           move etarih          to gd-1-col-4

           move rez-cik-gun     to egun
           move rez-cik-ay      to eay
           move rez-cik-yil     to eyil
           move etarih          to gd-1-col-5

           initialize firma-rec 
           move rez-firma       to firma-kodu
           read firma no lock invalid
                move "         "to firma-adi
           end-read 
               move firma-adi   to gd-1-col-6

           initialize acenta-rec
           move rez-acenta      to acenta-kodu
           read acenta no lock invalid
               move "          "to acenta-adi
           end-read 
               move acenta-adi  to gd-1-col-7

           move rez-buyuk       to zzz
           move zzz             to gd-1-col-8
           move rez-kucuk       to zzz
           move zzz             to gd-1-col-9
           move rez-pan-tipi    to gd-1-col-10
           move rez-fiyati      to etutar
           move etutar          to gd-1-col-11
           initialize doviz-rec
           move rez-doviz       to doviz-kodu
           read doviz no lock invalid 
                move "        " to D-KISA-ADI
           end-read             
                move D-KISA-ADI to gd-1-col-12


           if key-status = 1247
                 if etki-tar not = zeroes 
                   initialize cast-rec
                   move etki-tar     to cast-tarih
                   move rez-no          to cast-rez-no
                   read cast no lock invalid 
                        exit perform cycle  
                   not invalid 
                        if cast-tarih = rez-cik-tar 
                           exit perform cycle 
                        end-if 
                        if cast-share = 0
                           move 1     to gd-1-col-13
                           add 1      to toplam-oda-sayisi
                        else
                           move 0     to gd-1-col-13
                        end-if 
                   end-read
                 end-if 
           else 
                 initialize cast-rec
                 move rez-gir-tar     to cast-tarih
                 move rez-no          to cast-rez-no
                 read cast no lock invalid 
                      continue 
                 not invalid    
                      if cast-share = 0
                         move 1     to gd-1-col-13
                         add 1      to toplam-oda-sayisi
                      else
                         move 0     to gd-1-col-13
                      end-if 
                 end-read
           end-if 

           compute toplam-kisi-sayi = toplam-kisi-sayi +
                                      cast-buyuk
           add 1                to toplam-kayit-sayi
           move rez-c-in        to gd-1-col-14

           modify form1-gd-1,
                  record-to-add(form1-gd-1-record)
           move "H"                 to secim-durumu
           modify form1-gd-1(toplam-kayit-sayi,1),
                  hidden-data = secim-durumu
           if secim-durumu = "H"
                  modify form1-gd-1(toplam-kayit-sayi,1),
                         bitmap = no-bmp
                         bitmap-width = 16
                         bitmap-number = 1
           end-if 

           if rez-c-in = "E"
              modify form1-gd-1(toplam-kayit-sayi),
                  row-color = 176
           end-if 
    end-read 
    end-perform
    end-start

    close firma acenta route doviz cast rez

    initialize form1-gd-1-record
    move "Toplam->"       to gd-1-col-2
    move toplam-oda-sayisi to zzz
    move zzz               to gd-1-col-3
    move toplam-kisi-sayi  to zzz
    move zzz               to gd-1-col-8

    modify form1-gd-1,
       record-to-add(form1-gd-1-record)

    modify form1-gd-1(toplam-kayit-sayi + 1 ),
            row-color = 480

    modify form1-gd-1,
       mass-update = 0

     .
*
 Form1-Gd-1-Ev-Other.
    evaluate event-type
    when msg-begin-entry
         move event-action-fail to event-action
            initialize secim-durumu son-satir
            inquire form1-gd-1,last-row in son-satir
            if son-satir not = event-data-2
               inquire form1-gd-1(event-data-2,1),hidden-data = secim-durumu
               if secim-durumu = "H"
                     modify form1-gd-1(event-data-2,1),
                            bitmap = yes-bmp
                            bitmap-width = 16
                            bitmap-number = 1
                            hidden-data = "E"
               else
                     modify form1-gd-1(event-data-2,1),
                            bitmap = no-bmp
                            bitmap-width = 16
                            bitmap-number = 1
                            hidden-data = "H"
               end-if
            end-if 
    when msg-heading-dblclick
         evaluate event-data-1
         when 1
             initialize secim-durumu son-satir
             inquire form1-gd-1,last-row in son-satir 
             compute son-satir = son-satir - 1
             initialize k i  
             perform varying i 
                        from 1
                        by 1
                        until i > son-satir
                        if i = son-satir
                            exit perform 
                        end-if 
                            compute k = i + 1
                            inquire form1-gd-1(k ,1),hidden-data secim-durumu
                            
                            if secim-durumu = "H"
                                  modify form1-gd-1(k,1),
                                         bitmap = yes-bmp
                                         bitmap-width = 16
                                         bitmap-number = 1
                                         hidden-data = "E"
                            else
                                  modify form1-gd-1(k,1),
                                         bitmap = no-bmp
                                         bitmap-width = 16
                                         bitmap-number = 1
                                         hidden-data = "H"
                            end-if 
             end-perform
         end-evaluate
    end-evaluate.


*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to banka-deger.
       display accept-banka
       perform banka-oku.

*
 konum-ara.
      initialize konum-cagir.
      call "/asya/ytl/obj/otel/konumara.asy" using konum-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/konumara.asy" 
       end-call
       if konum-cagir > 0
          move konum-cagir  to filtre-konum
          display accept-filtre-konum
          perform konum-deg-oku
       end-if 


     .
*
 banka-oku.        
       open input banka.
       initialize banka-rec.
       move banka-deger    to banka-kodu
       read banka        no lock invalid 
             continue 
            not invalid 
               continue 
       end-read
       close banka.
       move banka-adi     to banka-adi-goster.
       display lb-banka.
*
 doviz-ara.
       initialize doviz-cagir.
       call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to doviz-deger.
       display accept-doviz.
       perform doviz-oku.
*
 doviz-oku.
       open input doviz.
       initialize doviz-rec.
       move doviz-deger        to doviz-kodu
       read doviz         no lock invalid 
            move "Tanimsiz.."  to d-adi-1
       end-read
       close doviz.
       move d-adi-1       to doviz-adi-goster.
       display lb-doviz.
*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to pan-deger.
       display accept-pan
       perform pansiyon-oku 
       .
*
 pansiyon-deg-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to pan-deg-deger.
       display accept-pana
       perform pan-deg-oku 
       .
*
 pansiyon-oku.
       open input kodlar02
       initialize kodlar02-rec 
       move "A"          to kodlar02-tipi
       move pan-deger    to kodlar02-kodu
       read kodlar02 no lock invalid 
            continue 
       end-read 
            move kodlar02-adi  to pan-adi-goster
       close kodlar02
       display lb-pansiyon
      .
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odemeara.asy" 
       end-call.
       move odeme-kodu-cagir     to odeme-deger.
       display accept-odeme.
       perform odeme-oku.
*
 odeme-oku.
      open input kodlar02
      initialize kodlar02-rec 
      move "B"         to kodlar02-tipi
      move odeme-deger to kodlar02-kodu
      read kodlar02 no lock invalid 
           move "Tanimsiz.."  to kodlar02-adi
      end-read 
           move kodlar02-adi  to odeme-adi-goster
      close kodlar02
      display lb-odeme.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy" 
       end-call.
       move infox-kodu-cagir     to anlasma-deger.
       display accept-anlasma.
       perform anlasma-oku.
*
 anlasma-oku.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi
       move anlasma-deger      to kodlar02-kodu
       read kodlar02         no lock invalid 
            move "Tanimsiz.." to kodlar02-adi
       end-read
       close kodlar02.
               move kodlar02-adi  to anlasma-adi-goster
       display lb-anlasma.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/pazarara.asy" 
       end-call.
       move pazar-kodu-cagir     to pazar-deger
       display accept-pazar
       perform pazar-oku.
*
 pazar-oku.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move pazar-deger        to kodlar02-kodu
       read kodlar02         no lock invalid 
            move "Tanimsiz.."  to kodlar02-adi
       end-read
       close kodlar02.
       move kodlar02-adi       to pazar-adi-goster
       display lb-pazar.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ulkeara.asy" 
       end-call.
       move ulke-cagir     to ulke-deger.
       display accept-ulke.
       perform ulke-oku.
 ulke-oku.
       open input ulke.
       initialize ulke-rec.
       move ulke-deger    to ulke-anah1
       read ulke         no lock invalid 
           move "Tanimsiz.."  to ulke-adi
       end-read
       close ulke.
       move ulke-adi     to ulke-adi-goster.
       display lb-ulke.
*
 kaynak1-ara.
    initialize kaynak-cagir.
    move "AB"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk1ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk1ara.asy" 
    end-call
    move kaynak-kodu-cagir     to kaynak1-deger
    display accept-kaynak1
    perform kaynak1-goster.
*
 kaynak2-ara.
    initialize kaynak-cagir.
    move "AC"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk2ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk2ara.asy" 
    end-call
    move kaynak-kodu-cagir     to kaynak2-deger
    display accept-kaynak2
    perform kaynak2-goster.
*
 kaynak3-ara.
    initialize kaynak-cagir.
    move "AD"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk3ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk3ara.asy" 
    end-call
    move kaynak-kodu-cagir     to kaynak3-deger
    display accept-kaynak3
    perform kaynak3-goster.
*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move kaynak1-deger to onbkodlar10-kodu1
    read onbkodlar10 no lock invalid
        initialize onbkodlar10-rec
    end-read
        move onbkodlar10-adi to kaynak1-adi-goster
        display lb-kaynak1
    close onbkodlar10.
*
 kaynak2-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move kaynak1-deger to onbkodlar10-kodu1
    read onbkodlar10 no lock invalid
        initialize onbkodlar10-rec
    end-read
        move onbkodlar10-adi to kaynak2-adi-goster
        display lb-kaynak2
    close onbkodlar10.
*
 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move kaynak1-deger to onbkodlar10-kodu1
    read onbkodlar10 no lock invalid
        initialize onbkodlar10-rec
    end-read
        move onbkodlar10-adi to kaynak3-adi-goster
        display lb-kaynak3
    close onbkodlar10.
*
 firma-ara.
      initialize firma-cagir.
      call "/asya/ytl/obj/otel/firmara.asy" using firma-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/firmara.asy" 
       end-call.
       move firma-cagir     to firma-deger.
       display accept-firma
       perform firma-oku.
*
 vip-ara.
    initialize infox-cagir
    move "v"   to infox-tipi-cagir
    call "/asya/ytl/obj/otel/vipara.asy" using infox-cagir
       on exception perform callerr-proc
          not on exception
    cancel "/asya/ytl/obj/otel/vipara.asy" 
    end-call
    move infox-kodu-cagir     to mis-tip-deger
    perform vip-goster.
* 
 vip-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "v"      to kodlar02-tipi
    move mis-tip-deger to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to mistip-adi-goster
    display accept-mis-durum lb-mis-tipi
    close kodlar02.
*
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to acenta-deger.
       display accept-acenta
       perform acenta-oku.
*
 acenta-oku.
       open input acenta.
       initialize acenta-rec.
       move acenta-deger       to acenta-kodu
       read acenta        no lock invalid 
            move "Tanimsiz.."  to acenta-adi
       end-read
       close acenta.
           move acenta-adi     to acenta-adi-goster.      
       display lb-acenta.
*
*
 firma-oku.
       open input firma.
       initialize firma-rec.
       move firma-deger   to firma-kodu
       read firma        no lock invalid 
            move "Tanimsiz.." to firma-adi
       end-read
       close firma.
       move firma-adi     to firma-adi-goster
       display lb-firma.
*
 degisim-uygula.
       if banka-isaret = 0 and
          doviz-isaret = 0 and
          pan-isaret = 0 and
          odeme-isaret = 0 and
          anlasma-isaret = 0 and
          pazar-isaret = 0 and
          ulke-isaret = 0 and
          kaynak1-isaret = 0 and
          kaynak2-isaret = 0 and
          kaynak3-isaret = 0 and
          cin-isaret = 0 and
          cout-isaret = 0 and
          firma-isaret = 0 and
          acenta-isaret = 0 and
          not1-isaret   = 0 and
          not2-isaret   = 0 and
          odeme-durumu-isaret = 0 and
          no-post-isaret = 0   and
          mistip-isaret = 0  and
          route-yeniden-hesapla = 0 and
          voucher-isaret = 0
              display message box "Degisim Icin Secim Yapilmadi.." new-line
                                  "Lutfen Tekrar Deneyiniz."
                              title "Uyari"
                              icon 1
              exit paragraph 
       end-if
        
       if banka-isaret = 1 and banka-deger = zeroes or 
          doviz-isaret = 1 and doviz-deger = zeroes or
          pan-isaret   = 1 and pan-deger   = spaces or 
          odeme-isaret = 1 and odeme-deger = spaces or 
          anlasma-isaret = 1 and anlasma-deger   = spaces or 
          pazar-isaret   = 1 and pazar-deger   = spaces or 
          ulke-isaret   = 1 and ulke-deger   = spaces or 
          kaynak1-isaret   = 1 and kaynak1-deger   = spaces or 
          kaynak2-isaret   = 1 and kaynak2-deger   = spaces or 
          kaynak3-isaret   = 1 and kaynak3-deger   = spaces or 
          cin-isaret   = 1 and gelis-tar   = zeroes or 
          cout-isaret   = 1 and cikis-tar   = zeroes or 
          firma-isaret   = 1 and firma-deger   = spaces or 
          acenta-isaret   = 1 and acenta-deger   = spaces or
          not1-isaret     = 1 and not1-deger = space or
          not2-isaret     = 1 and not2-deger = spaces or
          odeme-durumu-isaret = 1 and odeme-durumu-deger(1:1) = spaces or
          no-post-isaret = 1 and no-post-deger(1:1) = spaces or
          mistip-isaret = 1 and mis-tip-deger = spaces  or
          voucher-isaret = 1 and voucher-isaret = spaces 
              display message box "Degisim Icin Bos Alanlar Bulundu.." new-line
                                  "Lutfen Tekrar Deneyiniz."
                              title "Uyari"
                              icon 1
              exit paragraph 
            
       end-if
       if cin-isaret = 1 and gelis-tar < tarih-tasi
           display message box "C/In Tarihi - Onburo Calisma Tarihinden Once Olamaz.."
                           title "Uyari"
                           icon 1
           exit paragraph 
       end-if 
       if cout-isaret = 1 and cikis-tar < tarih-tasi
           display message box "C/Out Tarihi - Onburo Calisma Tarihinden Once Olamaz.."
                           title "Uyari"
                           icon 1
           exit paragraph 
       end-if
       if cin-isaret = 1
          perform giris-kontrol
       end-if 
       if cout-isaret = 1
          perform cikis-kontrol
       end-if

       display message box "Rezervasyon Degisimleri Baslayacaktir..." new-line
                           "Eminmisiniz.?"
                       title "Uyari"
                       icon 1
                       type 2
                       default 2
                       returning return-code 
       if return-code = 2
          exit paragraph 
       end-if 

       perform degisim-basla.
*
 degisim-basla.
             initialize secim-durumu son-satir link-degisim
             inquire form1-gd-1,last-row in son-satir 
             compute son-satir = son-satir - 1
             initialize k i  
             perform varying i 
                        from 1
                        by 1
                        until i > son-satir
                             if i = son-satir
                                 exit perform 
                             end-if 
                             compute k = i + 1
                             inquire form1-gd-1(k ,1),
                                     hidden-data secim-durumu
                             inquire form1-gd-1(k ,15),
                                     cell-data ydk-rez-no
                             if secim-durumu not = "E"
                                 exit perform cycle 
                             end-if 
                                
                             if secim-durumu = "E"                                
                                move ydk-rez-no       to link-degisim-rez-no(i)
                                if banka-isaret = 1 and banka-deger not = zeroes 
                                   move banka-deger   to link-degisim-banka
                                end-if 
                                if doviz-isaret = 1 and doviz-deger not = zeroes 
                                   move doviz-deger   to link-degisim-doviz
                                end-if 
                                if pan-isaret = 1  and pan-deger not = spaces
                                   move pan-deger     to link-degisim-pan
                                end-if 
                                if odeme-isaret = 1 and odeme-deger not = spaces 
                                   move odeme-deger   to link-degisim-odeme
                                end-if
                                if anlasma-isaret = 1 and anlasma-deger not = spaces 
                                   move anlasma-deger to link-degisim-anlasma
                                end-if 
                                if pazar-isaret = 1 and pazar-deger not = spaces 
                                   move pazar-deger   to link-degisim-pazar
                                end-if 
                                if ulke-isaret = 1 and ulke-deger not = spaces 
                                   move ulke-deger    to link-degisim-ulke
                                end-if                                      
                                if kaynak1-isaret = 1 and kaynak1-deger not = spaces 
                                   move kaynak1-deger to link-degisim-kaynak1
                                end-if 
                                if kaynak2-isaret = 1 and kaynak2-deger not = spaces 
                                   move kaynak2-deger to link-degisim-kaynak2
                                end-if 
                                if kaynak3-isaret = 1 and kaynak3-deger not = spaces
                                   move kaynak3-deger to link-degisim-kaynak3
                                end-if 
                                if cin-isaret = 1 and gelis-tar not = zeroes 
                                   move gelis-tar     to link-degisim-gelis-tar
                                end-if 
                                if cout-isaret = 1 and cikis-tar not = zeroes 
                                   move cikis-tar     to link-degisim-cikis-tar
                                end-if 
                                if firma-isaret = 1 and firma-deger not = spaces
                                   move firma-deger   to link-degisim-firma
                                end-if 
                                if acenta-isaret = 1 and acenta-deger not = spaces
                                   move acenta-deger  to link-degisim-acenta
                                end-if 
                                if not1-isaret = 1 and not1-deger not = spaces
                                   move not1-deger    to link-degisim-not1
                                end-if 
                                if not2-isaret = 1 and not2-deger not = spaces 
                                   move not2-deger    to link-degisim-not2
                                end-if
                                if odeme-durumu-isaret = 1 and 
                                   odeme-durumu-deger(1:1) not = spaces
                                   move odeme-durumu-deger(1:1) to link-degisim-odeme-durumu
                                end-if
                                if no-post-isaret = 1 and
                                   no-post-deger(1:1) not = spaces
                                   move no-post-deger(1:1)  to link-degisim-no-post
                                end-if 
                                if mis-tip-deger not = spaces
                                   move mis-tip-deger  to link-degisim-mis-tipi
                                end-if 
                                if route-yeniden-hesapla = 1
                                   move route-yeniden-hesapla to link-degisim-route-yeniden-hesapla
                                end-if 
                                if voucher-deger not = spaces
                                   move voucher-deger  to link-degisim-voucher
                                end-if 
                             end-if                                
              end-perform.
              perform rez-cagir.
              
*
 giris-kontrol.
       open input takvim
       initialize takvim-rec 
       move gelis-tar         to takvim-anah
       read takvim no lock invalid 
            display message box "Hatali C/In Tarihi Girdiniz.." new-line
                                "Lutfen Kontrol Ediniz.."
                            title "Uyari"
                            icon 1
              close takvim
              exit paragraph 
       end-read 
       close takvim.
*
 cikis-kontrol.
       open input takvim
       initialize takvim-rec 
       move cikis-tar         to takvim-anah
       read takvim no lock invalid 
            display message box "Hatali C/Out Tarihi Girdiniz.." new-line
                                "Lutfen Kontrol Ediniz.."
                            title "Uyari"
                            icon 1
              close takvim
              exit paragraph 
       end-read 
       close takvim.
*
 rez-cagir.
          call "/asya/ytl/obj/otel/rez.asy" 
                        using  link-rez-no link-gelen-rec link-gelen-sharenum 
                               link-rez-grup-rec link-toplu-adlar link-degisim
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/rez.asy"
          end-call.    
*
 rez-cagir-1.

       initialize dokcagir-tasi
       set dokcagir-tasi-call-rez1   to true
       move ydk-rez-no                   to dokcagir-rez-no
       perform dokcagir-call
       move dokcagir-rez-no          to rez-no.
*
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 cast-degisim-rez-bul.
       if etki-tar not = zeroes 
          open input takvim
          initialize takvim-rec 
          move etki-tar   to takvim-anah
          read takvim no lock invalid 
              display message box "Hatali Tarih Girdiniz." new-line
                                  "Lutfen Kontrol Ediniz."
                              title "Uyari"
                              icon 1
                     close takvim
                     exit paragraph 
          end-read 
          close takvim
        
          if etki-tar < tarih-tasi
             display message box "Onburo Calisma Tarihinden Onceki Bir Gune Giris Yaptiniz..."
                             title "Uyari"
                             icon 1
              exit paragraph 
          end-if
        end-if

        perform baslik-yukle
        perform grid-yukle.
*
 pan-deg-oku.
       open input kodlar02
       initialize kodlar02-rec hata
       move "A"          to kodlar02-tipi
       move pan-deg-deger    to kodlar02-kodu
       read kodlar02 no lock invalid 
            move 1             to hata 
            move "Hatali Pansiyon" to kodlar02-adi
       end-read 
            move kodlar02-adi  to pan-deg-adi-goster
       close kodlar02
       display lb-pansiyona
      .
*
 cast-degisim-yap.
       perform pan-deg-oku      
       open input takvim
       initialize takvim-rec 
       move deg-tar   to takvim-anah
       read takvim no lock invalid 
           display message box "Hatali Tarih Girdiniz." new-line
                               "Lutfen Kontrol Ediniz."
                           title "Uyari"
                           icon 1
                  close takvim
                  exit paragraph 
       end-read 
       close takvim
       
       if etki-tar < tarih-tasi
          display message box "Onburo Calisma Tarihinden Onceki Bir Gune Giris Yapilamaz..."
                          title "Uyari"
                          icon 1
           exit paragraph 
       end-if
    
       evaluate hata
       when 1 
          display message box "Pansiyon Kodu Hatali.." new-line
                              "Tekrar Deneyiniz."
                          title "Uyari"
                          icon 1
           exit paragraph 
       end-evaluate 
       display message box "Gunluk Degisimler Uygulanacaktir." new-line
                           "Eminmisiniz."
                       title "Uyari"
                       icon 1
                       type 2 
                       default 2
                       returning return-code 
             if return-code = 2
                exit paragraph
             end-if 
             open i-o rez cast
             initialize secim-durumu son-satir 
             inquire form1-gd-1,last-row in son-satir 
             compute son-satir = son-satir - 1
             initialize k i  
             perform varying i 
                        from 1
                        by 1
                        until i > son-satir
                             if i = son-satir
                                 exit perform 
                             end-if 
                             compute k = i + 1
                             inquire form1-gd-1(k ,1),
                                     hidden-data secim-durumu
                             inquire form1-gd-1(k ,15),
                                     cell-data ydk-rez-no
                                
                             if secim-durumu = "E"
                                initialize rez-rec
                                move ydk-rez-no to rez-no
                                read rez no lock invalid 
                                    display message box "Rez No Bulunamadi.." 
                                not invalid 
                                    if rez-durumu <> "I" 
                                       exit perform cycle 
                                    end-if 
                                    if rez-k-g-b <> "K"
                                       exit perform cycle 
                                    end-if 
                                    if rez-c-in = "E" 
                                        display message box "Rezervasyon Baska Bir Terminal Tarafindan C/IN'e Alinmis..."
                                        exit perform cycle 
                                    end-if 
                                    if rez-folio > 0 
                                        exit perform cycle 
                                    end-if
                                    if rez-grup-no <> secim-grup-no
                                       exit perform cycle 
                                    end-if 

                                    initialize cast-rec 
                                    move deg-tar          to cast-tarih
                                    move rez-no           to cast-rez-no
                                    read cast no lock invalid 
                                         exit perform cycle 
                                    not invalid
                                        if cast-tarih <> deg-tar
                                           exit perform cycle 
                                        end-if 
                                        if hata < 1
                                            move pan-deg-deger to cast-pan-tipi
                                            rewrite cast-rec end-rewrite 
                                            perform log-operation-cast
                                            if cast-tarih = rez-gir-tar
                                               move cast-pan-tipi to rez-pan-tipi
                                            end-if 
                                        end-if 
                                       
                                    end-read 
                                    move 1          to rez-pans-plan
                                    

                                  accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                                  accept rez-edit-zaman from time          |                           

                                    rewrite rez-rec end-rewrite 
                                    perform log-operation-rez
                                end-read 
                             end-if 
              end-perform.
             close rez cast
             display message box "Islem Tamamlandi" new-line
                                 "Lutfen Kontrol Ediniz."
                             title "Uyari"
                             icon 1
             set exit-pushed to true.
*
 konum-deg-oku.
     open input konum
     initialize konum-rec 
     move filtre-konum to konum-anahtar
     read konum no lock invalid 
         move "Tanimsiz"  to konum-adi
     end-read 
          move konum-adi  to konum-deg-adi-goster
     close konum
     display lb-filtre-konum.

 
