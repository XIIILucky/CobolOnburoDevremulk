*
 Form1-Bef-Create.
     perform icyetki-kontrol

     call "c$narg" using link-var.
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read
     close genel.
     open  i-o rez takvim .
        open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to  print-no
                  
                  move print-no to takasFIYAT-no
                     open output takasfiyat
                   close takasfiyat
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
     initialize gec-gecme.
     .
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka.
     move rezpara-doviz       to xrez-doviz.
     move rezpara-pan-tipi    to xrez-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi.
     move rezpara-ulke        to xrez-ulke.
     move rezpara-anlasma     to xrez-anlasma.
     move rezpara-pazar       to xrez-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil xrez-al-yil rez-al-yil    .
     move calis-ay            to xrez-gir-ay  xrez-cik-ay  xrez-al-ay  rez-al-ay  .
     move calis-gun           to xrez-gir-gun xrez-cik-gun xrez-al-gun rez-al-gun.
 default-ata.
*************Default Degerler Ataniyor.........
     move "4" to xrez-statu
     display acc-rez-status
     modify rez-tipi-combo, 
            value = "1"
            mass-update = 0.
            move "1" to xrez-tipi rez-tipi-combo-value .
     modify rez-kgb-combo, 
            value = rezpara-k-g-b
            mass-update = 0.
            move rezpara-k-g-b to xrez-k-g-b rez-kgb-combo-value.
     modify rez-vip-combo, 
            value = "N"
            mass-update = 0.
            move "N" to xrez-vip rez-vip-combo-value ilk-vip-tipi.

            if rezpara-aygun = "A" move 2 to rb-degisken-1
            else                   move 1 to rb-degisken-1
            end-if.
     modify kur-tipi-rb-1, GROUP-VALUE = rb-degisken-1.
     perform konum-ata thru konum-ata-exit.
 konum-ata.
*************Konumlar Yukleniyor.......
     modify oda-konumu-combo, 
            reset-list  = 1
            mass-update = 1.
     modify fiyat-konumu-combo, 
            reset-list  = 1
            mass-update = 1.
     open input konum.
     initialize konum-rec tmp-sayi ilk-konum.
     start konum key not < konum-anahtar invalid 
           continue
     not invalid 
     initialize fs-konum
     perform with test after until fs-konum = "10"
             read konum next no lock end move "10" to fs-konum
             not at end
                  add 1 to tmp-sayi
                  if tmp-sayi = 1
                      move konum-anahtar     to ilk-konum
                     add 1 to tmp-sayi
                  end-if 
                  initialize oda-konumu-combo-value fiyat-konumu-combo-value
                  move konum-anahtar     to oda-konumu-combo-value     fiyat-konumu-combo-value
                  move "->"              to oda-konumu-combo-value(3:) fiyat-konumu-combo-value(3:)
                  move konum-adi(1:10)         to oda-konumu-combo-value(5:) fiyat-konumu-combo-value(5:) 
                  modify oda-konumu-combo,
                         item-to-add(oda-konumu-combo-value)
                  modify fiyat-konumu-combo,
                         item-to-add(fiyat-konumu-combo-value)
             end-read
     end-perform
     end-start
     close konum.
     move ilk-konum  to oda-konumu-combo-value fiyat-konumu-combo-value 
     modify oda-konumu-combo, 
            mass-update = 0.
     modify fiyat-konumu-combo, 
            mass-update = 0.
 konum-ata-exit.
      exit.
*
 fiyat-konum-bul.
     open input konum.
     initialize konum-rec fiyat-konumu-acik
     move xrez-fiyat-konumu to konum-anahtar
     read konum no lock invalid continue
          not invalid
          initialize fiyat-konumu-acik
          move konum-anahtar     to fiyat-konumu-acik
          move "->"              to fiyat-konumu-acik(3:)
          move konum-adi         to fiyat-konumu-acik(5:)
     end-read.
     close konum.
*     display accept-fiy-kon-adi.
 fiyat-konum-bul-exit.
      exit.
*
 Form1-Aft-Initdata.
*/-----------------------------\*    
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

     initialize rez-rec xrez-rec yan-deg musteriden-geldi. 
     initialize short-var-yok kayit-izni.
     modify ACC-rez-status  reset-list = 1   mass-update = 1 
     modify ACC-rez-status  item-to-add "1-K.Karti Garantili  "
     modify ACC-rez-status  item-to-add "2-Sirket  Garantili  "
     modify ACC-rez-status  item-to-add "3-Acenta  Garantili  "
     modify ACC-rez-status  item-to-add "4-Garantisiz         "
     modify ACC-rez-status  item-to-add "5-Deposit Odemeli  "
     modify ACC-rez-status  item-to-add "6-No Show  "
       modify ACC-rez-status  mass-update = 0

     if link-var = 1 then
       perform rez-parametre-ata
       perform default-ata
       move link-rez-no to accept-rez-no
       move 1 to control-value
       move 1001 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       move 2 to control-value
       move 1002 to control-id
       perform bef-procedure 
       perform Aft-Procedure
       move 3 to control-value
       move 1003 to control-id
       move 4 to accept-control
       exit paragraph
     end-if
     
     perform rez-parametre-ata
     perform default-ata
*************Buttonlar Disable ediliyor.......
     modify button-acenara      enabled = false.
     modify button-anlasmaara   enabled = false.
     modify button-bankaara     enabled = false.
     modify button-dovizara     enabled = false.
     modify button-ondovizara   enabled = false.
     modify button-pansiyonara  enabled = false.
     modify button-odemeara     enabled = false.
     modify button-anlasmaara   enabled = false.
     modify button-pazarara     enabled = false.
     modify button-ulkeara      enabled = false.
     modify button-odaara       enabled = false.
*************Acceptler Disable ediliyor.......
*************Formu Goster............
       perform gun-bul
       perform form-update
************Degerleri Oku
*            perform acenta-oku   thru acenta-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
            perform ondoviz-oku  thru ondoviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform odatipi-goster
            perform odatipi-goster2
            perform odatipi-goster3
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster

            initialize gec-gecme.
     perform bef-procedure.
     .
*
 yanrez-oku.
        initialize yanrez-rec  
          adi2 soy2 d-tar2
          adi3 soy3 d-tar3 
          adi4 soy4 d-tar4
          adi5 soy5 d-tar5 
          adi6 soy6 d-tar6 
          adi7 soy7 d-tar7
        open input yanrez
        move rez-no to yanrez-rezno
        start yanrez key > yanrez-anah
         invalid
            continue
         not invalid 
           perform until fs-yanrez = "10"
              read yanrez next no lock
                 end 
                   move "10" to fs-yanrez
                 not end
                   if yanrez-rezno not = rez-no
                      move "10" to fs-yanrez
                      else
                      evaluate yanrez-sirano
                         when 1
                           move yanrez-profil-no to mis-no
                           move yanrez-profil-sirket to ps1
                           display acc-ps1 acc-mis-no
                           
                         when 2
                           move yanrez-adi      to  adi2
                           move yanrez-soyadi   to  soy2
                           move yanrez-dog-tar  to  d-tar2 
                           move yanrez-profil-no to pno2
                           move yanrez-profil-sirket to ps2
                           display acc-ps2 acc-pno2
                         when 3
                           move yanrez-adi      to  adi3
                           move yanrez-soyadi   to  soy3
                           move yanrez-dog-tar  to  d-tar3 
                           move yanrez-profil-no to pno3
                           move yanrez-profil-sirket to ps3
                           display acc-ps3 acc-pno3
                         when 4
                           move yanrez-adi      to  adi4
                           move yanrez-soyadi   to  soy4
                           move yanrez-dog-tar  to  d-tar4 
                           move yanrez-profil-no to pno4
                           move yanrez-profil-sirket to ps4
                           display acc-ps4 acc-pno4
                         when 5
                           move yanrez-adi      to  adi5
                           move yanrez-soyadi   to  soy5
                           move yanrez-dog-tar  to  d-tar5 
                           move yanrez-profil-no to pno5
                           move yanrez-profil-sirket to ps5
                           display acc-ps5 acc-pno5
                         when 6
                           move yanrez-adi      to  adi6
                           move yanrez-soyadi   to  soy6
                           move yanrez-dog-tar  to  d-tar6 
                           move yanrez-profil-no to pno6
                           move yanrez-profil-sirket to ps6
                           display acc-ps6 acc-pno6
                         when 7
                           move yanrez-adi      to  adi7
                           move yanrez-soyadi   to  soy7
                           move yanrez-dog-tar  to  d-tar7 
                           move yanrez-profil-no to pno7
                           move yanrez-profil-sirket to ps7
                           display acc-ps7 acc-pno7
                     end-evaluate
                   end-if
              end-read
           end-perform
        end-start.
        close yanrez.
*
 rez-oku.
     move accept-rez-no to xrez-no rez-no
     read rez no lock invalid 
          initialize rez-rec xrez-rec  yan-deg rezek-rec
          initialize rezek-rezidance
          move accept-rez-no to xrez-no rez-no   rezek-no
              move "Y" to rez-yeni-eski
              perform rez-parametre-ata
              perform default-ata
              move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
              move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu 
                                   oda-konumu-combo-value fiyat-konumu-combo-value
             accept xrez-al-tar from century-date
              
              if cinpara-kartsiz-pos = 1 then 
                move rez-no(2:) to xREZ-EXTRA-KART
                display accept-not2a
              end-if
          not invalid 
              move "E" to rez-yeni-eski
              initialize rezek-rec
              move rez-no to rezek-no 
              open i-o rezek
                  read rezek no lock invalid
                     continue
                  end-read


              close rezek
              perform yanrez-oku
              perform konuk-kontrol
              move rez-rec to xrez-rec
              if xrez-al-tar  < "10000000" then 
                move rez-isl-tar to rez-al-tar  xrez-al-tar

              end-if   
     end-read.
     perform okunan-goster.

     if eski-rez  move rez-durumu       to srez-durumu 
                  move rez-tipi         to srez-tipi 
                  move rez-acenta       to srez-acenta 
                  move rez-oda-konumu   to srez-oda-konumu 
                  move rez-fiyat-konumu to srez-fiyat-konumu 
                  move rez-s-d-t-g      to srez-s-d-t-g 
                  move rez-k-g-b        to srez-k-g-b 
                  move rez-anlasma      to srez-anlasma 
                  move rez-pan-tipi     to srez-pan-tipi
                  move rez-odano        to srez-odano 
                  move rez-gir-tar      to srez-gir-tar 
                  move rez-cik-tar      to srez-cik-tar 
                  move rez-kisi         to srez-kisi 
                  move rez-fiyati       to srez-fiyati
                  move rez-on-odeme     to srez-on-odeme 
                  move rez-on-doviz     to srez-on-doviz 
                  move rez-bilbord-eh   to srez-bilbord-eh
*                  modify acc-mis-no, visible = true
*                  modify form1-la-1aaab visible = true
*                  move rez-profil-sirket   to ps1
*                  move rez-profil-no to mis-no
*                  display acc-mis-no acc-ps1

     end-if.
******>Silinmis rezervasyon uzerinde oynama yapilamasin!!!! 
******>Iptal geri alinabilsin..........................!!!! 
     if eski-rez  and rez-durumu = "S" 
        initialize Mesaj-degiskenler
        move " [ Silinmis Rezervasyon ] " to mmesaj-title
        move " Bu Rezervasyon Uzerinde Degisiklik " to mmesaj-1 
        move " Yapamazsiniz.............      !!! " to mmesaj-2 
        move 1           to mmesaj-type
        move 3           to mmesaj-icon
        move 1           to mmesaj-default
          perform mmesaj-ver
        if xrez-cik-tar not < calisma-tarihi 
           initialize mesaj-degiskenler
           move " [ Rezervasyonu Geri Al ] " to mmesaj-title
           move " SILINMIS REZERVASYON GERI ALINSIN MI ? " to mmesaj-1
           move " ..... [ E->Geri Al  H->Iptal ]  ...... " to mmesaj-2 
           move 2           to mmesaj-type
           move 2           to mmesaj-icon
           move 2           to mmesaj-default
           perform mmesaj-ver
           if donus-kodu = 1
             if xrez-gir-tar < calisma-tarihi
               move calisma-tarihi to xrez-gir-tar
               display accept-gir-gun accept-gir-ay accept-gir-yil
             end-if
             
               perform cast-sil     thru cast-sil-exit 
               perform cast-isle    thru cast-isle-exit
              perform acenhrk-isle thru acenhrk-isle-exit 
              perform takvim-isle  thru takvim-isle-exit 
 
              move k-kodu-tasi     to xrez-staf 
              initialize xrez-e-mail
              move "I"             to xrez-durumu
              initialize xrez-odano 
              display accept-odano
              move xrez-rec to rez-rec
              
              rewrite rez-rec invalid continue

              initialize rez-rec xrez-rec  yan-deg
              move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
              move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                                   oda-konumu-combo-value fiyat-konumu-combo-value
              perform gun-bul
              perform form-update
              move 4    to accept-control
              move 1002 to control-id
              not invalid
                  perform log-operation-rez
              end-rewrite

              else
               initialize rez-rec xrez-rec  yan-deg
               move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
               move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                                    oda-konumu-combo-value fiyat-konumu-combo-value
               perform gun-bul
               perform form-update
               move 4    to accept-control
               move 1002 to control-id
           end-if
        else
              initialize mesaj-degiskenler
           move " [Silinmis Rezervasyon Log ] " to mmesaj-title
           move " SILINMIS REZERVASYON LOGU ACILSIN MI ? " to mmesaj-1
           move " ..... [ E->Log Ac  H->Cik ]  ...... " to mmesaj-2 
           move 2           to mmesaj-type
           move 2           to mmesaj-icon
           move 2           to mmesaj-default
           perform mmesaj-ver
           if donus-kodu = 1
              move rez-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of rez-rec
             set link-logview-rec-size to size of rez-rec
             perform logview-call
             initialize key-status

           end-if
               initialize rez-rec xrez-rec  yan-deg
               move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
               move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                                    oda-konumu-combo-value fiyat-konumu-combo-value
               perform gun-bul
               perform form-update
               move 4    to accept-control
               move 1002 to control-id
        end-if
     end-if.
******>Silinmis rezervasyon uzerinde oynama yapilamasin!!!! 
 rez-oku-exit.
     exit.
 konuk-kontrol.
****>Herhangi bir sebeple C-in yapilmis folio kaybolursa 
****>rezervasyon kaydi silinebilsin diye konuldu........
      if eski-rez and rez-c-in = "E"
         open input konuk
         move rez-folio   to konuk-folio
         read konuk no lock invalid 
*             
           display message box "Rezervasyon Register Karti baglantisi Bozuk" new-line
                              "Lutfen Ctrl-T ye basip Bakim yapiniz"
         end-read
         close konuk
      end-if.
****>
*
 okunan-goster.
     
     move xrez-tipi to rez-tipi-combo-value
     modify rez-tipi-combo, 
            value = rez-tipi-combo-value
            mass-update = 0.
     display accept-rezno
     move xrez-k-g-b to rez-kgb-combo-value
     modify rez-kgb-combo, 
            value = rez-kgb-combo-value
            mass-update = 0.
     if xrez-vip = spaces move "N" to xrez-vip
     end-if
     move xrez-vip to rez-vip-combo-value
     modify rez-vip-combo, 
            value = rez-vip-combo-value
            mass-update = 0.
     open input konum 
     initialize konum-rec
     move xrez-oda-konumu to oda-konumu-combo-value
                             konum-anahtar
    read konum no lock invalid 
    initialize oda-konumu-combo-value
    move konum-anahtar     to oda-konumu-combo-value
    move "->"              to oda-konumu-combo-value(3:)
    move "Hata"            to oda-konumu-combo-value(5:)
    modify oda-konumu-combo,
            item-to-add(oda-konumu-combo-value)
     end-read 
*****>Fiyat konumu icin oku
     move xrez-fiyat-konumu to fiyat-konumu-combo-value
                               konum-anahtar
    read konum no lock invalid 
    initialize fiyat-konumu-combo-value
    move konum-anahtar     to fiyat-konumu-combo-value
    move "->"              to fiyat-konumu-combo-value(3:)
    move "Hata"            to fiyat-konumu-combo-value(5:)
    modify fiyat-konumu-combo,
            item-to-add(fiyat-konumu-combo-value)
     end-read 
*****>Fiyat konumu icin oku
     close konum
    evaluate true
         when xrez-s-d-t-g = "1" modify accept-odatipi-e value = "1->Single"
         when xrez-s-d-t-g = "2" modify accept-odatipi-e value = "2->Double"
         when xrez-s-d-t-g = "3" modify accept-odatipi-e value = "3->Triple"
         when xrez-s-d-t-g = "4" modify accept-odatipi-e value = "4->Group "
         when other              modify accept-odatipi-e value = "1->Single"
    end-evaluate
    if xrez-eb = "E"
       modify eraly-booking-cb, value = 1
    else
       modify eraly-booking-cb, value = 0
    end-if

    if xrez-aksiyon-eh = "H"
       modify aksiyon-cb, value = 1
    else
       modify aksiyon-cb, value = 0
    end-if

    if xrez-bilbord-eh = "E"
       modify bilbord-cb, value = 1
    else
       modify bilbord-cb, value = 0
    end-if

    if xrez-fiyat-fix = "E"
       modify fix-fiyat-cb, value = 1
    else
       modify fix-fiyat-cb, value = 0
    end-if

    evaluate true
         when xrez-kur-aygun = "G" move "1" to rb-degisken-1
         when xrez-kur-aygun = "A" move "2" to rb-degisken-1
         when other                move "1" to rb-degisken-1
    end-evaluate
     modify kur-tipi-rb-1, group-value = rb-degisken-1.

     open input kllnc
     initialize kllnc-rec
     move xrez-staf to k-kodu
     read kllnc no lock invalid 
          move all "*" to k-adi
     end-read 
     modify accept-k-adi value = k-adi
     close kllnc

*************Formu Goster............
          perform gun-bul
         perform form-update
************Degerleri Oku
            perform acenta-oku   thru acenta-oku-exit
            perform firma-oku    thru firma-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
            perform ondoviz-oku  thru ondoviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform odatipi-goster
            perform odatipi-goster2
            perform odatipi-goster3
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            perform op-goster
            perform rehber-goster
            perform vip-goster
            perform ozel-after

     .
*
 acc-rez-no-Bef-Procedure.
     initialize rez-rec xrez-rec aksiyon-var-yok.
*       inquire rez-tipi-combo, value in ilk-rez-tipi
*       move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
     initialize short-var-yok kayit-izni.
     perform bef-procedure.

 eraly-booking-cb-Ex-Cmd-Clicked.
        evaluate control-id
         when 1025
              inquire eraly-booking-cb, value in sayi
              if sayi = 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
        end-evaluate.
        if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-early-sabit = 1 and 
          acen-dft-early not = sayi
          display message box "Acenta icin Early booking degeri girilmis  " new-line
                              "Early Booking varsayilan degerine degistirildi"
                              title "Bilginize"
            modify eraly-booking-cb, value =  acen-dft-early
             inquire eraly-booking-cb, value in sayi
              if sayi = 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
        end-if.
     .
*
 fix-fiyat-cb-Ex-Cmd-Clicked.
        evaluate control-id
         when 220
              inquire fix-fiyat-cb, value in sayi
              if sayi = 1 move "E" to xrez-fiyat-fix
                 else     move "H" to xrez-fiyat-fix
              end-if
        end-evaluate.
        if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-fix-sabit = 1 and 
          acen-dft-fix not = sayi
          display message box "Acenta icin Fix Fiyat degeri girilmis  " new-line
                              "Fix Fiyat varsayilan degerine degistirildi"
                              title "Bilginize"
            modify fix-fiyat-cb, value =  acen-dft-fix
             
              if acen-dft-fix = 1 move "E" to xrez-fiyat-fix
                 else     move "H" to xrez-fiyat-fix
              end-if
        end-if.
*
 aksiyon-cb-Ex-Cmd-Clicked.
        evaluate control-id
         when 1040
              inquire aksiyon-cb, value in sayi
              if sayi = 1 move "H" to xrez-aksiyon-eh
                 else     move "E" to xrez-aksiyon-eh
              end-if
        end-evaluate.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-aksiyonyok-sabit = 1 and 
          acen-dft-aksiyon-yok not = sayi
          display message box "Acenta icin Aksiyon degeri girilmis  " new-line
                              "Aksiyon varsayilan degerine degistirildi"
                              title "Bilginize"
            modify aksiyon-cb, value =  acen-dft-aksiyon-yok
             
              if acen-dft-aksiyon-yok = 1 move "E" to xrez-aksiyon-eh
                 else                 move "H" to xrez-aksiyon-eh
              end-if
        end-if.
     .
*
 special-cb-Ex-Cmd-Clicked.
          inquire special-cb, value in sayi
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-specialyok-sabit = 1 and 
          acen-dft-special-yok not = sayi
          display message box "Acenta icin Special degeri girilmis  " new-line
                              "Aksiyon varsayilan degerine degistirildi"
                              title "Bilginize"
            modify special-cb, value =  acen-dft-special-yok
             
              
        end-if.
     .
*
 bilbord-cb-Ex-Cmd-Clicked.
       if key-status = 5464 
       evaluate control-id
         when 1043
              inquire bilbord-cb, value in sayi
              if sayi = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if
              if xrez-acenta = not-dos-anah(8:4) and
                 acen-dft-bilboard-sabit = 1 and 
                 acen-dft-bilboard not = sayi
                 display message box 
                      "Acenta icin Bilboard degeri girilmis  " new-line
                      "Bilboard degeri varsayilan degerine degistirildi"
                          title "Bilginize"
                 modify bilbord-cb, value =  acen-dft-bilboard
             
                 if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                      else     move "H" to xrez-bilbord-eh
                 end-if
            end-if
        end-evaluate
        else 
           perform exception-procedure
        end-if.
     .
*
 rez-tipi-combo-Aft-Procedure.
     inquire rez-tipi-combo, value in harf.
     move harf     to xrez-tipi.
*                                  
 bef-procedure.
     move control-value    to sonraki-kontrol
     move control-id       to sonraki-id
*     display message box "o-k->" onceki-kontrol, new-line
*                         "S-k->" sonraki-kontrol, new-line
*                         "O-id->" onceki-id, new-line
*                         "S-Id->" sonraki-id, new-line
*                         "key-->" key-status new-line
*                         "gec-gecme-->" gec-gecme.
***>Onceki Kontrole gidebilsin ama sonrakine gidemesin....
     if gecmez
        if sonraki-kontrol not = 1
           if sonraki-kontrol > onceki-kontrol
              move 4         to accept-control
              move onceki-id to control-id
              exit paragraph
           end-if
        end-if
     end-if
     evaluate control-id
       when 404
          move 1 to vis-acik
          display ode-acik
          move xrez-doviz to xREZ-ON-DOVIZ
          display accept-ondoviz
          perform ondoviz-oku
       when 1003
            modify button-acenara enabled = true
       when 1016
            modify button-bankaara enabled = true
       when 1017
            modify button-dovizara enabled = true
       when 1018
            modify button-pansiyonara enabled = true
       when 1019
            modify button-odemeara enabled = true
      when 1014
            perform anlasma-bul
           
       when 1020
            perform anlasma-bul
            modify button-anlasmaara enabled = true
       when 1021
            modify button-pazarara enabled = true
       when 1022
            modify button-ulkeara enabled = true
       when 1034
            modify button-odaara  enabled = true
       when 402
            modify button-ondovizara enabled = true
     end-evaluate.

     initialize mesaj.
     evaluate control-id
          when 1033 
*             initialize linkh-odahes
*             move 1 to linkh-nereden
*             move xrez-no to linkh-rez-no
*            
*             call "/asya/ytl/obj/otel/odahes.asy" 
*                        using linkh-odahes xrez-rec
*                        on exception 
*                        perform callerr-proc
*                        exit paragraph
*                        not on exception 
*                   cancel "/asya/ytl/obj/otel/odahes.asy"
*                   end-call
          when 1001
              evaluate true
                  when turkce
                       move "Rezervasyon Tipini Seciniz............" to mesaj
                  when almanca
                       move "Rezervasyon Tipini Seciniz............" to mesaj
                  when ingilizce
                       move "Rezervasyon Tipini Seciniz............" to mesaj
              end-evaluate
          when 1002
              evaluate true
                  when turkce
                       move "Rezervasyon No Giriniz Enter->Otomatik  F1->Eski Rez Ara" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1003
              evaluate true
                  when turkce
                       move "Acenta Kodunu  Giriniz  F1->Acenta Kodu Ara" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1004
          when 1005
          when 1006
              evaluate true
                  when turkce
                       move "Musteri Giris Tarihi" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1007
          when 1008
              evaluate true
                  when turkce
                       move "Musteri Giris Zamani" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1009
          when 1010
          when 1011
              evaluate true
                  when turkce
                       move "Musteri Cikis Tarihi  F1->Kalis Gunu Bul" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
          when 1012
          when 1013
              evaluate true
                  when turkce
                       move "Musteri Cikis Zamani" to mesaj
                  when almanca
                       move " " to mesaj
                  when ingilizce
                       move " " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj
     .
*
 co-after.
            if cogalt-adet not = 0
               perform cogalt thru cogalt-exit 
            end-if
            move 27 to key-status.
            set exit-pushed to true
            .
*
 Aft-Procedure.
      if musteriden-geldi = 1
         move 4    to accept-control
         move 1014 to control-id
         move 0  to musteriden-geldi
      end-if 
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
      initialize gec-gecme.
      evaluate control-id
       WHEN 49
            MOVE SOY2 TO ARANACAK-soyadi
            move adi2 to aranacak-adi
          perform  grara
            move 2    to hangi-profil
            perform profil-goster
       when 63
           MOVE SOY3 TO ARANACAK-soyadi
           move adi3 to aranacak-adi
              perform  grara
            move 3    to hangi-profil
            perform profil-goster
       when 66
           MOVE SOY4 TO ARANACAK-soyadi
           move adi4 to aranacak-adi
              perform  grara
            move 4    to hangi-profil
            perform profil-goster

       when 1001
              inquire rez-tipi-combo, value in ilk-rez-tipi
              move ilk-rez-tipi to xrez-tipi ilk-rez-tipi rez-tipi-combo-value
       modify rez-tipi-combo, 
*              value = "1"
*              mass-update = 0
       when 999
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xrez-al-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move " Girdiginiz Tarih Tanimsiz....... "  to mmesaj-1
              move " Tekrar Deneyiniz................ "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xrez-al-tar > calisma-tarihi 
***********************************            and yeni-rez
              
              initialize mesaj-degiskenler
              move " [ Yanlis Olabilecek Tarih ] " to mmesaj-title
              move " Ileri  Tarih Belirtiniz.. "  to mmesaj-1
              move " Kontrol Ediniz.................... "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               
            end-if
            
       when 1002
            if key-status = 52
               exit paragraph
            end-if 
           if accept-rez-no = 0
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to rez-oto 
                  move rez-oto to xrez-no accept-rez-no
                 
                   
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis

           end-if
             perform rez-oku  thru rez-oku-exit
             initialize gec-gecme
             perform anlasma-bul
             if yeni-rez
                modify Form1-Pb-2,visible = false
             end-if
       when 1223
            perform tacenta-oku 
       when 84
            perform rehber-goster
       when 173 
            perform vip-goster
       when 1999
            perform firma-oku
            if firma-rate not = spaces 
               if xrez-acenta  = spaces 
                      if rez-yeni-eski = "Y" then
                           if xrez-firma not = spaces
                              perform firma-dft-yukle
                            end-if
                      end-if
                   move firma-rate to xrez-acenta
                   display accept-acenta
                   else
                    display message box "Default Rate Koduna Uymamaktasiniz"

                end-if
                else
                 if gecmez
                    continue  

                 else
                     if rez-yeni-eski = "Y" then
                           if xrez-firma not = spaces
                              perform firma-dft-yukle
                            end-if
                      end-if
                 end-if 
               
            end-if
             
       when 1003
            if key-status = 52
               exit paragraph
            end-if 
            modify button-acenara enabled = false
            initialize gec-gecme
            perform acenta-oku thru acenta-oku-exit
            if gecmez
               exit paragraph
            end-if
            if rez-yeni-eski = "Y" then
             if xrez-firma = spaces
               perform acen-dft-yukle
             end-if
            end-if
           if xrez-no > 0 and son-not-d(1:4) not = xrez-acenta then
              move 1 to link-nereden 
              move "F"     to  link-not-islem
              move "REZ"   to  link-NOT-DOS    
              move xrez-acenta  to link-not-dos-anah   
              move xrez-gir-tar to link-not-dos-anah(5:8)  
              move xrez-cik-tar to link-not-dos-anah(13:8)  
              move 1 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                        using link-not
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/mesajgir.asy"
                   end-call
                move  link-not-donus  to  toplam-not
               display not-ac
               move xrez-acen-anah to son-not-d
         end-if
*******Giris Tarihi Kontrol......... 
       when 1006
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xrez-gir-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move " Girdiginiz Tarih Tanimsiz....... "  to mmesaj-1
              move " Tekrar Deneyiniz................ "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xrez-gir-tar < calisma-tarihi 
***********************************            and yeni-rez
              move 1 to gec-gecme
              initialize mesaj-degiskenler
              move " [ Yanlis Tarih ] " to mmesaj-title
              move " Gecmis Tarihe Rezervasyon Girilemez.. "  to mmesaj-1
              move " Tarihi Degistirin.................... "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if
            move gun-gun(takvim-gun-adi) to adi-goster
            modify lb-gel-gun-e title = adi-goster
            initialize adi-goster

*******Kalis Gunu Bul
       when 11009
            move 27 to key-status
            if kalis-gun not = 0
               perform kalis-bul thru kalis-bul-exit 
            end-if
*******Cogaltma Islemi
            
            
*******Cikis Tarihi Kontrol......... 
       when 31009
            move 27 to key-status
            
*******Cikis Tarihi Kontrol......... 
       when 1011
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            move xrez-cik-tar to tarih
            perform takvim-oku thru takvim-oku-exit
            if gecmez
              initialize mesaj-degiskenler
              move " [ Tanimsiz Tarih ] " to mmesaj-title
              move " Girdiginiz Tarih Tanimsiz....... "  to mmesaj-1
              move " Tekrar Deneyiniz................ "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if 
            if xrez-cik-tar < xrez-gir-tar
              move 1 to gec-gecme
              initialize mesaj-degiskenler
              move " [ Yanlis Tarih ] " to mmesaj-title
              move " Cikis Tarihi Giris Tarihinden Kucuk Olamaz. "  to mmesaj-1
              move " Tarihi Degistirin.......................... "  to mmesaj-2
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

               exit paragraph
            end-if
            move gun-gun(takvim-gun-adi) to adi-goster
            modify lb-git-gun-e title = adi-goster
            initialize adi-goster
            perform gun-bul
            if xrez-no > 0 and ( son-not-d(5:8) not = xrez-gir-tar or 
                son-not-d(13:8) not = xrez-cik-tar )
            then
                   move 1 to link-nereden 
                   move "F"     to  link-not-islem
                   move "REZ"   to  link-NOT-DOS    
                   move xrez-acenta  to link-NOT-DOS-ANAH   
                   move xrez-gir-tar to link-NOT-DOS-ANAH(5:8)  
                   move xrez-cik-tar to link-NOT-DOS-ANAH(13:8)  
                   move 1 to link-nereden 
                        call "/asya/ytl/obj/otel/mesajgir.asy" 
                             using link-not
                             on exception 
                             perform callerr-proc
                             exit paragraph
                             not on exception 
                             cancel "/asya/ytl/obj/otel/mesajgir.asy"
                        end-call
                     move  link-not-donus  to  toplam-not
                     display not-ac
                     move xrez-acen-anah to son-not-d
         end-if

       when 1014
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            if rezpara-adi-bosgec = "H" and xrez-adi = spaces 
               move 1 to gec-gecme
               initialize mesaj-degiskenler
               move " [ Musteri-Adi Bos ] " to mmesaj-title
               move " Musterinin Adini Bos Gecmek Icin .......... "  to mmesaj-1
               move " Onburo Calisma Parametreleri Uygun Degil... "  to mmesaj-2
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               move 1 to gec-gecme
               exit paragraph
            end-if 
       when 1015

            modify tab-1, value = 4
            move 4  to form1-ta-1-value
            perform tab-1-Ev-Cmd-Tabchanged 
            move 1 to p1-vis            
            modify gd2,mass-update = 1
                       reset-grid = 1
            display gd2
                 move 1  to hangi-profil
                 perform thread profil-goster 
            move 0 to accept-control
            if key-status = 52
               exit paragraph
            end-if 

            initialize gec-gecme
            if xrez-soyadi = spaces
               if yeni-rez
                  move xrez-adi      to xrez-soyadi
                  display accept-soyadi 
               end-if
            end-if
            if rezpara-soyadi-bosgec = "H" and xrez-soyadi = spaces 
               move 1 to gec-gecme
               initialize mesaj-degiskenler
               move " [ Musteri-Soyadi Bos ] " to mmesaj-title
               move " Musterinin Soyadini Bos Gecmek Icin........ "  to mmesaj-1
               move " Onburo Calisma Parametreleri Uygun Degil... "  to mmesaj-2
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               move 1 to gec-gecme
               exit paragraph
            end-if
 
**********>Eski Musteri ve Mukerrer Rezervasyon Kontrolu......
**********>KONTROLLER-1. 
            initialize key-status
            if rezpara-eskimus-ara = "E" 
*****               perform eskimus-ara  thru eskimus-ara-exit
        
                 move xrez-adi    to aranacak-adi
                 move xrez-soyadi to aranacak-soyadi
                          perform grara
            end-if
            if rezpara-mukerrer-ara = "E" and rezpara-isimden-ara 
               perform mukerrer-isimden thru mukerrer-isimden-exit
               if rezpara-mukerrer-gecsin = "H" 
                   move 1 to gec-gecme
                   exit paragraph
               end-if
            end-if
            open input karalist
            
              move "M" to karalist-tipi 
              move xrez-adi    to karalist-adi 
              move xrez-soyadi to karalist-soyadi 
              read karalist no lock invalid continue
              not invalid 
                display message box  "Misafir Kara Listede"
              end-read
            close karalist
       when 1016
            if key-status = 52
               exit paragraph
            end-if 
            modify button-bankaara enabled = false
            initialize gec-gecme
            perform banka-oku thru banka-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1017
            if key-status = 52
               exit paragraph
            end-if 
            modify button-dovizara enabled = false
            initialize gec-gecme
            perform doviz-oku thru doviz-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1018
            if key-status = 52
               exit paragraph
            end-if 
            modify button-pansiyonara enabled = false
            initialize gec-gecme
            perform pansiyon-oku thru pansiyon-oku-exit
            if gecmez
               exit paragraph
            end-if 
**********>Kontrat kontrolu....Alotment Rezervasyonar icin...
**********>Aksiyon ve stop-sale kontrolu
**********>KONTROLLER-2. 
            if xrez-tipi = 1 
               move "V" to kontrat-var-yok 
*               perform kontrat-kontrol  thru kontrat-kontrol-exit 
            end-if
            perform aksiyon2-kontrol  thru aksiyon2-kontrol-exit 
            perform aksiyon-kontrol   thru aksiyon-kontrol-exit 
       when 1019
            if key-status = 52
               exit paragraph
            end-if 
            modify button-odemeara enabled = false
            initialize gec-gecme
            perform odeme-oku thru odeme-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1020
            if key-status = 52
               exit paragraph
            end-if 
            modify button-anlasmaara enabled = false
            initialize gec-gecme
            perform anlasma-oku thru anlasma-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1021
            if key-status = 52
               exit paragraph
            end-if 
            modify button-pazarara enabled = false
            initialize gec-gecme
            perform pazar-oku thru pazar-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1022
            if key-status = 52
               exit paragraph
            end-if 
            modify button-ulkeara enabled = false
            initialize gec-gecme
            perform ulke-oku thru ulke-oku-exit
            if gecmez
               exit paragraph
            end-if 
        when 41
            if key-status = 52
               exit paragraph
            end-if 
            modify button-opara enabled = false
           
            perform op-goster
            
       when 1023
**********>Mukerrer Rezervasyon Kontrolu......Voucherden...
**********>KONTROLLER-3. 
            if key-status = 52
               exit paragraph
            end-if 
            initialize gec-gecme
            if rezpara-mukerrer-ara = "E" and rezpara-voucherden-ara 
               if xrez-voucher not = spaces 
                 perform mukerrer-voucherden thru mukerrer-voucherden-exit 

               if rezpara-mukerrer-gecsin = "H"
                  move 1 to gec-gecme
                  exit paragraph
               end-if 
              end-if 
            end-if
       when 1024
            inquire rez-kgb-combo, value in xrez-k-g-b
       when 1026
       when 1027
            if rb-degisken-1 = "1"
               move "G" to xrez-kur-aygun 
            else 
               move "A" to xrez-kur-aygun 
            end-if
       when 1028
            inquire oda-konumu-combo, 
            value in buffer-mami
                move buffer-mami(1:2) to 
                xrez-oda-konumu
               open input konum 
               initialize konum-rec
               move xrez-oda-konumu to konum-anahtar
               read konum no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Oda Konumu Hatali ] " to mmesaj-title
                    move " Secmis Oldugunuz Oda Konumu Tanimsiz....... "  to mmesaj-1
                    move " Seciminizi Degistiriniz.................... "  to mmesaj-2
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver

                    close konum
                    move 1 to gec-gecme
                    exit paragraph
                    not invalid continue
               end-read 
               close konum
**********>Short Kontrol.......
**********>KONTROLLER-4. 
            if rezpara-short-uyari = "E" 
               perform short-kontrol  thru short-kontrol-exit 
               if short-var and rezpara-short-gecsin = "H"  
                  move 1 to gec-gecme
                  exit paragraph
               end-if
            end-if 
       when 1030
            if key-status = 52
               exit paragraph
            end-if 
            evaluate true 
              WHEN xrez-buyuk = 0
                if rezpara-sifir-pax = 1 then 
                  display message box "Onburo calisma parametrelerinde " new-line
                                      "Sifir pax a izin verilmistir."
                                      move "1" to xrez-s-d-t-g 
                                        modify accept-odatipi-e value = "1->Single"
                                      else
                   display message box "Onburo calisma parametrelerinde " new-line
                                      "Sifir pax a izin verilmemistir"
                   move 1 to gec-gecme
                  exit paragraph

                end-if 
              when xrez-buyuk < 2 move "1" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "1->Single"
              when xrez-buyuk = 2 move "2" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "2->Double"
              when xrez-buyuk = 3 move "3" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "3->Triple"
              when xrez-buyuk > 3 move "4" to xrez-s-d-t-g 
                   modify accept-odatipi-e value = "4->Group "
            end-evaluate
**********>Kontenjan Kontrolu....
**********>KONTROLLER-5. 
            if rezpara-kont-uyari = "E" and xrez-tipi = 1 
               perform kontenjan-kontrol  thru kontenjan-kontrol-exit 
               if kontj-yok and rezpara-kont-gecsin = "H" 
                  move 1 to gec-gecme
                  exit paragraph
               end-if, 
            end-if 
       when 1033
            if key-status = 52
               exit paragraph
            end-if 
            perform hes-gonder
             
            
       when 1034
            if key-status = 52
               exit paragraph
            end-if 
            modify button-odaara  enabled = false
            initialize gec-gecme
            perform blok-kont2
       when 1042
            inquire fiyat-konumu-combo, 
                value in buffer-mami
                move buffer-mami(1:2) to 
                xrez-fiyat-konumu
               open input konum 
               initialize konum-rec
               move xrez-fiyat-konumu to konum-anahtar
               read konum no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Oda Konumu Hatali ] " to mmesaj-title
                    move " Secmis Oldugunuz Oda Konumu Tanimsiz....... "  to mmesaj-1
                    move " Seciminizi Degistiriniz.................... "  to mmesaj-2
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver

                    close konum
                    move 1 to gec-gecme
                    exit paragraph
                    not invalid continue
               end-read 
               if rez-yeni-eski = "Y" then 
                   move xrez-fiyat-konumu to xrez-oda-konumu
                  inquire fiyat-konumu-combo, 
                     value in oda-konumu-combo-value
                 display oda-konumu-combo
               end-if
               close konum
       when 215
            inquire rez-vip-combo, value in xrez-vip
            if xrez-vip = spaces move "N" to xrez-vip rez-vip-combo-value
            end-if
       when 402
            if key-status = 52
               exit paragraph
            end-if 
            modify button-ondovizara enabled = false
            initialize gec-gecme
            perform ondoviz-oku thru ondoviz-oku-exit

            if gecmez
               exit paragraph
            end-if 
       when 404
            if key-status = 52
               exit paragraph
            end-if 
               move xrez-on-odeme   to odeme-z
               modify accept-odeme-tutar value = odeme-z
*            if xrez-on-doviz not = 0 or xrez-on-doviz not = spaces
               perform toplam-odeme-bul thru  toplam-odeme-bul-exit
*            end-if
     
*            if rezpara-detay-alsin = "H" 
*               move 4    to accept-control
*               move 1028 to control-id
*            end-if
      end-evaluate.
      .




        .
*
 exception-procedure.
     if link-var= 1 then
       if key-status = 19  then
          move 99999999 to link-rez-no
          set exit-pushed to true
          exit paragraph
       end-if
       if key-status = 15  then
          move 0 to link-rez-no
          set exit-pushed to true
          exit paragraph
       end-if       
     end-if
     if key-status = 7001
        perform rezervasyon-formu-ekle
     end-if
     if key-status = 7002
         perform rezervasyon-resim-goruntule
     end-if
     
     if key-status = 5555    or 
        key-status = 16
          if ((control-id = 1014 or
             control-id = 1015) and key-status = 16) or 
             control-id = 88
           move xrez-adi         to aranacak-adi  
           move xrez-soyadi      to aranacak-soyadi
           move mis-no           to bulunan-profil-no
           move ps1              to bulunan-profil-sirket
           move 1 to yan-kac
           perform profil-cagir
        end-if
          if ((control-id = 48 or
             control-id = 49) and key-status = 16) or 
             control-id = 148
            move 2        to yan-kac
            move adi2     to aranacak-adi
            move soy2     to aranacak-soyadi 
            move pno2     to bulunan-profil-no
            move ps2      to bulunan-profil-sirket
            perform profil-cagir
         end-if
          if ((control-id = 64 or
             control-id = 63) and key-status = 16) or 
             control-id = 144
            move 3        to yan-kac
            move adi3     to aranacak-adi 
            move soy3     to aranacak-soyadi
            move pno3     to bulunan-profil-no
            move ps3      to bulunan-profil-sirket 
            perform profil-cagir
         end-if
          if ((control-id = 65 or
             control-id = 66) and key-status = 16) or 
             control-id = 146
            move 4        to yan-kac
            move adi4     to aranacak-adi 
            move soy4     to aranacak-soyadi 
            move pno4     to bulunan-profil-no
            move ps4      to bulunan-profil-sirket
            perform profil-cagir
         end-if
          if ((control-id = 80 or
             control-id = 76) and key-status = 16) or 
             control-id = 151
            move 5        to yan-kac
            move adi5     to aranacak-adi 
            move soy5     to aranacak-soyadi 
            move pno5     to bulunan-profil-no
            move ps5      to bulunan-profil-sirket
            perform profil-cagir
         end-if
          if ((control-id = 91 or
             control-id = 92) and key-status = 16) or 
             control-id = 153
            move 6        to yan-kac
            move adi6     to aranacak-adi 
            move soy6     to aranacak-soyadi
            move pno6     to bulunan-profil-no
            move ps6      to bulunan-profil-sirket 
            perform profil-cagir
         end-if
          if ((control-id = 97 or
             control-id = 98) and key-status = 16) or 
             control-id = 155
            move 7        to yan-kac
            move adi7     to aranacak-adi 
            move soy7     to aranacak-soyadi 
            move pno7     to bulunan-profil-no
            move ps7      to bulunan-profil-sirket
            perform profil-cagir
         end-if
     end-if
     if key-status = 6
        initialize mis-cagir
        move mis-no to mis-no-cagir2
        move ps1 to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 1     to yan-kac
       if mis-kayit = 1 
            move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
            perform ortak-profil-yaz
       end-if
        
     end-if
     if key-status = 20
     
        if xrez-c-in = "E" then 
           initialize konuk-rec
           
           open input konuk
           move xrez-folio to konuk-folio
           read konuk no lock invalid
               

           display message box "Rezervasyon cin bakimi yapildi." new-line 
                   "Devam edersiniz Cin bayragi kaldiralacak" 
                   title "DIKKAT" 
           move xrez-no to rez-no
           read rez no lock invalid 
             continue
             not invalid 
                initialize rez-c-in rez-folio
               rewrite rez-rec  invalid continue end-rewrite
             end-read
             not invalid 
            display message box "Rezervasyon cin kontrolu yapildi"   title "DIKKAT"   
           end-read
         close konuk
       end-if
     end-if
*     if key-status = 5
*        open i-o konuk 
*        move rez-folio to konuk-folio 
*         read konuk no lock invalid
*            display message box "Bulamadim"
*            not invalid
*              move rez-no to konuk-rez-no
*              rewrite konuk-rec
*          end-read
*          close konuk
*        if link-var= 1 then
*          move 99999999 to link-rez-no
*          set exit-pushed to true
*          exit paragraph
*       end-if
*     end-if


********* eger donuste yeniden okunmassan karisikliga sebeb olur 
********* ornek konukta deisiklik yapilip donuste rez kaydedilirse
********* saglam kafa ile test edilmesi lazim **** mami
**********************************************
     if key-status = 333 and def-anl-uyumsuz = 1
        perform uyumsuz-anlasma-bul
     end-if
     if key-status = 8 
        if control-id = 1034 then 
        perform oda-ara2
        else
*         perform rez-soz-bas
        end-if
     end-if
     if key-status = 3131 and xrez-no > 0 then
           move "U"     to  link-not-islem
           move "REZ"   to  link-not-dos    
           move xrez-anah to link-not-dos-anah  
           move 1 to link-nereden 
           string xrez-adi delimited by "  "
                  " " delimited by size
                  xrez-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
                  call "/asya/ytl/obj/otel/mesajgir.asy" 
                       using link-not
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/mesajgir.asy"
                  end-call
                  move  link-not-donus  to  toplam-not
                  display not-ac
                  move xrez-acen-anah to son-not-d
      exit paragraph 
     end-if
     if key-status = 3132 then
     if eski-rez then
     if xrez-no > 0 then
           
                  call "/asya/ytl/obj/otel/renkata.asy" 
                       using xrez-no
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/renkata.asy"
                  end-call           
     end-if
     
     else
         Display message box "Ancak kaydedilmis rezervasyona renk atayabilirsiniz" 
     end-if
     end-if
     if key-status = 3133 then
            initialize link-rout
             move xrez-no to rout-rez-no(1)
             MOVE xrez-gir-tar to routsec-gir-tar 
               
             string  xrez-no delimited by size
                     xrez-adi delimited by "   "
                     xrez-soyadi delimited by "  " 
             into rout-text
                  call "/asya/ytl/obj/otel/routsec.asy" 
                       using link-rout
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routsec.asy"
                  end-call
     end-if
     if  key-status = 3502 then
         perform acu-screen2-routine
     end-if


 
      if key-status = 3187 then
            
            

            
                  call "/asya/ytl/obj/otel/routkont.asy" 
                       using xrez-no  xrez-folio
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routkont.asy"
                  end-call
     end-if
     if key-status = 14 and rez-folio > 0 then 
**************************> rezcin.asy
        initialize dokcagir-tasi
        set dokcagir-tasi-call-cin2    to true
        move rez-no                    to dokcagir-konuk-rez-no      
        move rez-folio                 to dokcagir-konuk-folio
        perform dokcagir-call
        move dokcagir-konuk-rez-no     to rez-no
        move dokcagir-konuk-folio      to rez-folio
        exit paragraph 
     end-if
     if key-status    = 5 and
        rezpara-trace = 1 and 
        rez-durumu = "I"
           call "/asya/ytl/obj/otel/cast2.asy" 
                using xrez-no xrez-plan 
                on exception 
                perform callerr-proc
                exit paragraph
                not on exception 
           cancel "/asya/ytl/obj/otel/cast2.asy"
           end-call
           
      exit paragraph 
     end-if
**************************************
     move control-id to gidis-id
     evaluate key-status
         when 17 
             move rez-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of rez-rec
             set link-logview-rec-size to size of rez-rec
             perform logview-call
             initialize key-status
         when 1 
            evaluate control-id
              when  1002
                    perform rez-ara      thru rez-ara-exit
              when  1003
                    modify button-acenara enabled = false
                    perform acenta-ara   thru acenta-ara-exit
              when  1999
                    perform firma-ara   thru firma-ara-exit
              when  1223
                    perform tacenta-ara 
              when  1009
                    initialize kalis-gun
                    perform acu-form2-routine
                    exit paragraph
              when  1016
                    modify button-bankaara enabled = false
                    perform banka-ara    thru banka-ara-exit
              when  1017
                    modify button-dovizara enabled = false
                    perform doviz-ara    thru doviz-ara-exit
              when  1018
                    modify button-pansiyonara enabled = false
                    perform pansiyon-ara thru pansiyon-ara-exit
              when  41 
                    perform op-ara
              when  173 
                    perform vip-ara
              when 84
                    perform rehber-ara
              when  33
                    perform odatipi-ara
              when  26
                    perform odatipi-ara2
              when  29
                    perform odatipi-ara3
              when  28
                    perform kaynak1-ara
              when  167
                    perform kaynak2-ara
              when  169
                    perform kaynak3-ara

              when  1019
                    modify button-odemeara enabled = false
                    perform odeme-ara    thru odeme-ara-exit
              when  16
                    perform ozel-ara
              when  1020
                    modify button-anlasmaara enabled = false
                    perform anlasma-ara  thru anlasma-ara-exit
              when  1021
                    modify button-pazarara enabled = false
                    perform pazar-ara    thru pazar-ara-exit



              when  1022
                    modify button-ulkeara enabled = false
                    perform ulke-ara     thru ulke-ara-exit
              when  1034
                    modify button-odaara  enabled = false
                    perform oda-ara      thru oda-ara-exit
              when  402
                    modify button-ondovizara enabled = false
                    perform ondoviz-ara  thru ondoviz-ara-exit
            end-evaluate
         when 2 
                perform hes-gonder
               perform kaydet   thru kaydet-exit
         when 3
               perform rez-sil   thru rez-sil-exit
         when 4 
            if eski-rez
               initialize cogalt-adet
               initialize c-e 
               move 1 to g-e
               
               perform acu-form3-routine
               move sonraki-id to control-id
               move 4 to accept-control
               exit paragraph
            end-if
        when 11
           perform kont-goster
        when 12 
            perform acu-grform-routine
           
               move 4 to accept-control
        when  other
*        display message box key-status
     end-evaluate.
*
 kontrol-bolumu. 
************=======> Bu Bolum Cesitli Kontrollar Icindir    <====***********
   
 

 aksiyon2-kontrol. 
         open input aksiyhrk. 
         initialize special-varsa gun-sayi. 
 aksiyon2-basla. 
          move xrez-gir-tar to takvim-anah. 
          start takvim key not < takvim-anah invalid 
                close aksiyhrk 
                go aksiyon2-kontrol-exit. 
 aksiyon2-oku. 
         read takvim   next no lock end go ak2-bak. 
         if fs-takvim   = 99 go aksiyon2-oku. 
         if takvim-anah = xrez-cik-tar go ak2-bak. 
         if takvim-anah > xrez-cik-tar go ak2-bak. 
         add 1 to gun-sayi. 
         go aksiyon2-oku. 
 ak2-bak. 
         move "O"           to aksiyhrk-tipi.
         move xrez-acenta   to aksiyhrk-acenta. 
         move xrez-gir-tar  to aksiyhrk-tarih. 
         move xrez-pan-tipi to aksiyhrk-pan-tipi.
         move gun-sayi      to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
             close aksiyhrk go aksiyon2-kontrol-exit. 
            initialize mesaj-degiskenler
            if control-id = 1018
              move " [ Aksiyon Uyari] " to mmesaj-title
              move "Special Offera Tabii Acenta                       "  to mmesaj-1
              move "Geceleme..:"   to mmesaj-2(01:12)
              move aksiyhrk-gecele to mmesaj-2(12:02)
              move "Indirim(pp):"   to mmesaj-2(15:12)
              move aksiyhrk-ode(1:2)    to mmesaj-2(27:02)
              move "."                  to mmesaj-2(29:01)
              move aksiyhrk-ode(3:2)    to mmesaj-2(30:02)
              move 1           to mmesaj-type
              move 1           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
            end-if.
            move "V"  to special-var-yok. 
            move aksiyhrk-gecele   to special-gece.
            move aksiyhrk-hes-tipi to special-hes-tipi
            move aksiyhrk-ekle     to special-ekle
            move aksiyhrk-ode      to special-tahsil. 
            close      aksiyhrk. 
 aksiyon2-kontrol-exit. 
      exit. 

 aksiyon-kontrol. 
         if xrez-gir-tar = xrez-cik-tar then go aksiyon-kontrol-exit end-if
         open input aksiyhrk. 
         initialize aksiyon-varsa gun-sayi. 
 aksiyon-basla. 
          move xrez-gir-tar to takvim-anah. 
          start takvim key not < takvim-anah invalid 
                close aksiyhrk 
                go aksiyon-kontrol-exit. 
 aksiyon-oku. 
         read takvim   next no lock end go ak-bak. 
         if fs-takvim   = 99 go aksiyon-oku. 
         if takvim-anah = xrez-cik-tar go ak-bak. 
         if takvim-anah > xrez-cik-tar go ak-bak. 
         add 1 to gun-sayi. 
         go aksiyon-oku. 
 ak-bak. 
         move "A"           to aksiyhrk-tipi.
         move xrez-acenta   to aksiyhrk-acenta. 
         move xrez-gir-tar  to aksiyhrk-tarih. 
         move xrez-pan-tipi to aksiyhrk-pan-tipi.
         move gun-sayi      to aksiyhrk-gecele. 
         read aksiyhrk no lock invalid 
             close aksiyhrk go aksiyon-kontrol-exit. 
            initialize mesaj-degiskenler
            if control-id = 1018
              move " [ Aksiyon Uyari] " to mmesaj-title
              move "Aksiyona Tabi Acenta                       "  to mmesaj-1
              move "Geceleme..:"   to mmesaj-2(01:12)
              move aksiyhrk-gecele to mmesaj-2(12:02)
              move "Tahsil....:"   to mmesaj-2(15:12)
              move aksiyhrk-ode(1:2)    to mmesaj-2(26:02)
              move "."   to mmesaj-2(28:01)
            
              move aksiyhrk-ode(3:2)    to mmesaj-2(29:02)
              move 1           to mmesaj-type
              move 1           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
            end-if.
             
            if aksiyhrk-ebharic = 1 and (xrez-eb = "E") then 
               modify  aksiyon-cb  value = 1 
                 move "H" to xrez-aksiyon-eh
             else
            move "V"  to aksiyon-var-yok 
            move aksiyhrk-gecele   to ak-gece 
            move aksiyhrk-ode      to ak-tahsil 
            end-if
            close      aksiyhrk. 
 aksiyon-kontrol-exit. 
      exit. 
 stopsale-kontrol. 
      open input aksiyhrk grup.
 stopsale-oku. 
        move "Y" to stopsale-var-yok.
        move xrez-gir-tar to takvim-anah
        start takvim key >= takvim-anah 
          invalid
          continue
           not invalid
         perform until fs-takvim = "10" or  stopsale-var-yok = "V"
          read takvim next no lock 
           end move "10" to fs-takvim
           not end 
           if takvim-anah >= xrez-cik-tar
             move "10" to fs-takvim
           else
             move "S"           to aksiyhrk-tipi
             move xrez-acenta   to aksiyhrk-acenta 
             move takvim-anah  to aksiyhrk-tarih 
             move xrez-fiyat-konumu to aksiyhrk-pan-tipi
             move 0             to aksiyhrk-gecele
             read aksiyhrk no lock invalid 
               continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
             end-read      

          initialize  aksiyhrk-pan-tipi
          read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
          end-read      

         initialize aksiyhrk-acenta
         read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
         end-read     
         move xrez-fiyat-konumu to aksiyhrk-pan-tipi
         read aksiyhrk no lock invalid 
              continue
              not invalid
              move "V" to stopsale-var-yok
              go stopsale-kontrol-exit
         end-read     
         initialize grup-rec
         move "A" to grup-tipi
         start grup key > grup-anah
           invalid
            continue
           not invalid
             perform until fs-grup = "10" 
              read grup next no lock 
                end move "10" to fs-grup
                not end
                 if grup-tipi not = "A" then
                     move "10" to fs-grup
                   else
                     if grup-alt = xrez-acenta 
                       
                        move grup-kodu to aksiyhrk-acenta
                        initialize  aksiyhrk-pan-tipi

                         read aksiyhrk no lock invalid 
                            continue
                         not invalid
                        
                        move "V" to stopsale-var-yok
                         exit perform 
                       end-read  
                        move xrez-fiyat-konumu to aksiyhrk-pan-tipi
                          read aksiyhrk no lock invalid 
                            continue
                         not invalid
                        
                        move "V" to stopsale-var-yok
                         exit perform 
                       end-read  
                     end-if
                 end-if
               end-read
             end-perform 
         end-start
         end-if
        end-read
        end-perform
        end-start.

 stopsale-kontrol-exit.
          if stopsale-var-yok = "V" then
            initialize mesaj-degiskenler
            move " [ Stop Sale Uyari] " to mmesaj-title
            move " Bu Acentaya Stop-Sale Cekilmis....... "  to mmesaj-1
            move " Bu Tarihlere Rezervasyon Girmeyin.... "  to mmesaj-2
            move 1           to mmesaj-type
            move 2           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            end-if
            close      aksiyhrk grup.  

*
 eskimus-ara. 
        move "I"          to rez-durumu. 
        move xrez-soyadi  to rez-soyadi. 
       start rez key not < rez-soy invalid 
             go eskimus-ara-exit. 
 eskimus-oku.
         read rez next no lock end go eskimus-ara-exit. 
         if fs-rez = 99 go eskimus-oku. 
         if rez-soyadi > xrez-soyadi go eskimus-ara-exit. 
         if rez-durumu not = "I" go eskimus-ara-exit. 
         if rez-soyadi = xrez-soyadi and rez-adi = xrez-adi 
            continue
         else 
         go eskimus-oku
         end-if. 
         if rez-no   =   xrez-no     go eskimus-oku. 
            initialize mesaj-degiskenler
            move " [ Eski Musteri Uyari ] " to mmesaj-title
            move "DAHA ONCE GELMIS...Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 1           to mmesaj-icon
            move 1           to mmesaj-default
            initialize donus-kodu
            perform mmesaj-ver
            if donus-kodu = 2 
               go eskimus-ara-exit
            end-if
         go eskimus-oku. 
 eskimus-ara-exit. 
     exit. 
 mukerrer-isimden. 
        move "I"          to rez-durumu. 
        move xrez-soyadi  to rez-soyadi. 
       start rez key not < rez-soy invalid 
             go mukerrer-isimden-exit. 
 mukerrer-isim-oku. 
         read rez next no lock end go mukerrer-isimden-exit. 
         if fs-rez = 99 go mukerrer-isim-oku. 
         if rez-soyadi > xrez-soyadi go mukerrer-isimden-exit. 
         if rez-durumu not = "I" go mukerrer-isimden-exit. 
         if rez-soyadi = xrez-soyadi and rez-adi = xrez-adi 
            and ( xrez-gir-tar < rez-cik-tar  and 
            xrez-cik-tar > rez-gir-tar )
          
            continue
         else 
            go mukerrer-isim-oku
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-isim-oku. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move "KONAKLAMA CAKISIYOR"                 to mmesaj-3. 
           
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-isimden-exit
            end-if
         go mukerrer-isim-oku. 
 mukerrer-isimden-exit. 
      exit. 
 mukerrer-voucherden. 
        move "I"          to rez-durumu. 
        move xrez-voucher to rez-voucher. 
       start rez key not < rez-vouc invalid go mukerrer-voucherden-exit. 
 mukerrer-vouc-oku. 
         read rez next no lock end go mukerrer-voucherden-exit. 
         if fs-rez = 99 go mukerrer-vouc-oku. 
         if rez-voucher > xrez-voucher go mukerrer-voucherden-exit. 
         if rez-durumu not = "I" go mukerrer-voucherden-exit. 
         if rez-voucher = xrez-voucher 
            continue
         else 
            go mukerrer-vouc-oku
         end-if. 
         if rez-no   =   xrez-no     go mukerrer-vouc-oku. 
            initialize mesaj-degiskenler
            move " [ Mukerrer Kayit Uyari ] " to mmesaj-title
            move "MUKERRER KAYIT.....Rez No:         " to mmesaj-1.
            move rez-no                                to mmesaj-1(27:08). 
            move "Acen:     G:  /  /     C:  /  /    " to mmesaj-2. 
            move rez-acenta   to mmesaj-2(06:04). 
            move rez-gir-gun  to mmesaj-2(13:02). 
            move rez-gir-ay   to mmesaj-2(16:02). 
            move rez-gir-yil  to mmesaj-2(19:04). 
            move rez-cik-gun  to mmesaj-2(26:02). 
            move rez-cik-ay   to mmesaj-2(29:02). 
            move rez-cik-yil  to mmesaj-2(32:04). 
            move 2           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 2 
               go mukerrer-voucherden-exit
            end-if
         go mukerrer-vouc-oku. 
 mukerrer-voucherden-exit. 
      exit. 
*
 short-kontrol.
            open input konum.
            initialize konum-rec short-1konum short-toplam.
            move xrez-oda-konumu   to konum-anahtar.
            read konum no lock invalid 
                 initialize konum-rec.
            close konum.
        move "Y" to short-var-yok.
        move xrez-gir-tar to takvim-anah.
        start takvim key not < takvim-anah invalid 
              go short-kontrol-bitti.
 short-oku.
         read takvim next no lock end go short-kontrol-bitti.
         if fs-takvim = 99 go short-oku.
         if takvim-anah = xrez-cik-tar  go short-kontrol-bitti.
         if takvim-anah > xrez-cik-tar  go short-kontrol-bitti.
            initialize short-1konum short-toplam.
         compute short-1konum =  1 +
                 takvim-sat-oda(xrez-oda-konumu) .
         compute short-toplam =  1 +
                 takvim-sat-oda(1) + takvim-sat-oda(2) +
                 takvim-sat-oda(3) + takvim-sat-oda(4) +
                 takvim-sat-oda(5) + takvim-sat-oda(6) +
                 takvim-sat-oda(7) + takvim-sat-oda(8) +
                 takvim-sat-oda(9) + takvim-sat-oda(10) + 
                 takvim-sat-oda(11) + takvim-sat-oda(12) +
                 takvim-sat-oda(13) + takvim-sat-oda(14) +
                 takvim-sat-oda(15) + takvim-sat-oda(16) +
                 takvim-sat-oda(17) + takvim-sat-oda(18) +
                 takvim-sat-oda(19) + takvim-sat-oda(20) +
                 takvim-sat-oda(21) + takvim-sat-oda(22) +
                 takvim-sat-oda(23) + takvim-sat-oda(24) +
                 takvim-sat-oda(25) + takvim-sat-oda(26) +
                 takvim-sat-oda(27) + takvim-sat-oda(28) +
                 takvim-sat-oda(29) + takvim-sat-oda(30) + 
                 takvim-sat-oda(31) + takvim-sat-oda(32) +
                 takvim-sat-oda(33) + takvim-sat-oda(34) +
                 takvim-sat-oda(35) + takvim-sat-oda(36) +
                 takvim-sat-oda(37) + takvim-sat-oda(38) +
                 takvim-sat-oda(39) + takvim-sat-oda(40)



                 .
         if short-1konum > konum-hazir-oda  
            perform 1konum-shortta
                 go short-kontrol-bitti
         end-if.
         if short-toplam > takvim-hazir-oda 
            perform toplam-shortta
                 go short-kontrol-bitti
         end-if.
            go short-oku.
*
 short-kontrol-bitti.
     exit.
 short-kontrol-exit.
    exit.
*
 1konum-shortta.
       perform acu-form4-routine
       add 1 to sonraki-id
       move sonraki-id to control-id
       move 4 to accept-control
       exit paragraph
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Oda Konumunuz Short'ta ] " to mmesaj-title
       move "Bu Tarihte"                           to mmesaj-1(01:10)
       move konum-adi(01:10)                       to mmesaj-1(12:10)
       move "Oda Shortta"                          to mmesaj-1(23:11)
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move konum-hazir-oda  to mmesaj-2(22:04)
       move short-1konum     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 toplam-shortta.
       perform acu-form4-routine
       add 1 to sonraki-id
             move sonraki-id to control-id
       move 4 to accept-control
       exit paragraph
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Tum Konumlar Short'ta ] " to mmesaj-title
       move "Bu Tarihte Tum Konumlar Short'ta"     to mmesaj-1
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move takvim-hazir-oda to mmesaj-2(22:04)
       move short-toplam     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 kontenjan-kontrol. 
        open  input acenhrk bilbord. 
        move "V" to kontj-var-yok. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah 
              invalid go kontenjan-kontrol-bitti. 
 kontj-oku. 
         read takvim next no lock end 
              go kontenjan-kontrol-bitti. 
         if fs-takvim = 99 go kontj-oku. 
         if takvim-anah = xrez-cik-tar 
            go kontenjan-kontrol-bitti
         end-if. 
         if takvim-anah > xrez-cik-tar 
            go kontenjan-kontrol-bitti
         end-if. 
         initialize acenhrk-rec. 
*****         move xrez-acenta       to acenhrk-acenta bilbord-acenta. 
                   move ac-bilb to bilbord-acenta
                   move ac-kont to acenhrk-acenta
         move takvim-anah       to acenhrk-tarih bilbord-tarih. 
         move rezpara-kont-tipi to acenhrk-s-d-t-g. 
         if rezpara-kont-tipi = 0 
            move xrez-s-d-t-g   to acenhrk-s-d-t-g
         end-if. 
         move xrez-fiyat-konumu   to acenhrk-oda-konumu bilbord-oda-tip. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
               go kontenjan-kontrol-bitti
         end-if
         end-read.
         read bilbord no lock invalid 
           continue   
         not invalid
         if bilbord-oda <= bilbord-sat-oda 
            perform kontenjani-dolu
               go kontenjan-kontrol-bitti
         end-if
         end-read.
         move 1 to bilbord-oda-tip
         read bilbord no lock invalid 
           continue   
         not invalid
****** mami   zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz
          if bilbord-rson-tarih < tarih-tasi and 
             bilbord-rson-tarih > "20000000" then 
             perform kontenjani-dolu
             go kontenjan-kontrol-bitti
         end-if
         end-read.

            initialize acenhrk-rec. 
*****         move xrez-acenta       to acenhrk-acenta. 
         move ac-kont to acenhrk-acenta
         move takvim-anah       to acenhrk-tarih. 
         move rezpara-kont-tipi to acenhrk-s-d-t-g. 
         if rezpara-kont-tipi = 0 
            move xrez-s-d-t-g   to acenhrk-s-d-t-g
         end-if. 
         move 41   to acenhrk-oda-konumu. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
               go kontenjan-kontrol-bitti
         end-if
         end-read.
            initialize acenhrk-rec. 
****         move xrez-acenta       to acenhrk-acenta. 
           move ac-kont to acenhrk-acenta
         move takvim-anah       to acenhrk-tarih. 
         move 5 to acenhrk-s-d-t-g. 
         
         move xrez-fiyat-konumu   to acenhrk-oda-konumu. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
               go kontenjan-kontrol-bitti
         end-if
         end-read.
            initialize acenhrk-rec. 
         move ac-kont to acenhrk-acenta
*****         move xrez-acenta       to acenhrk-acenta. 
         move takvim-anah       to acenhrk-tarih. 
         move 5 to acenhrk-s-d-t-g. 
         move 41   to acenhrk-oda-konumu. 
         read acenhrk no lock invalid 
           continue   
         not invalid
****** mami        if acenhrk-sat-oda > acenhrk-kontrat-oda + 1 
         if acenhrk-sat-oda >= acenhrk-kontrat-oda 
            perform kontenjani-dolu
               go kontenjan-kontrol-bitti
         end-if
         end-read.
         go kontj-oku. 
 kontenjan-kontrol-bitti. 
          close acenhrk bilbord. 
 kontenjan-kontrol-exit. 
           exit. 

 kontenjani-dolu. 
       close acenhrk  bilbord
       perform acu-form4-routine
       add 1 to sonraki-id
             move sonraki-id to control-id
       move 4 to accept-control
       open input acenhrk bilbord
       exit paragraph
       move "Y" to kontj-var-yok. 
       initialize mesaj-degiskenler
       move " [ Kontenjan Hata ] " to mmesaj-title
       move "Bu Tarihte Bu Acentanin Kon.Yok"      to mmesaj-1. 
       move "Tarih:  /  /     Kon:      Sat:     " to mmesaj-2. 
       move takvim-gun                             to mmesaj-2(07:02). 
       move takvim-ay                              to mmesaj-2(10:02). 
       move takvim-yil                             to mmesaj-2(13:04). 
       move acenhrk-kontrat-oda                    to mmesaj-2(22:04). 
       move acenhrk-sat-oda                        to mmesaj-2(32:04). 
       move 2           to mmesaj-type
       move 2           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
        .
*
 blok-kontrol.
           initialize gec-gecme
           open input cast.
        move xrez-gir-tar   to cast-tarih.
        move xrez-odano     to cast-oda-no.
        start cast key not < cast-anah3 invalid 
              go blok-kontrol-bitti.
 blok-kontrol-oku.
        read cast next no lock end 
             go blok-kontrol-bitti.
        if fs-cast = 99 go blok-kontrol-oku.
        if cast-tarih  > xrez-cik-tar   go blok-kontrol-bitti.
        if cast-tarih  = xrez-cik-tar   go blok-kontrol-bitti.
        if cast-oda-no > xrez-odano     go blok-kontrol-bitti.
        if cast-oda-no = xrez-odano  continue
        else 
           go blok-kontrol-oku
        end-if.
        if cast-rez-no = xrez-no go blok-kontrol-oku.
           initialize mesaj-degiskenler
           move " [ DIKKAT ] " to mmesaj-title
           move "Girdiginiz Oda Bu Tarihte Blokeli  " to mmesaj-1
           move "Tarih..:  /  /                     " to mmesaj-2
           move cast-gun     to mmesaj-2(09:02)
           move cast-ay      to mmesaj-2(12:02)
           move cast-yil     to mmesaj-2(15:04)

           move 1           to mmesaj-type
           move 2           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
             .
 blok-kontrol-bitti.
            close cast.
 blok-kontrol-exit.
     exit.
*
 fiyat-bul.
        open input fiyat fiyatana. 
        move 0 to oda-fiyati. 
        open input kodlar02.
       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
           
             close kodlar02
            go fiyat-bulundu 
       end-read
       close kodlar02.
        if ode-posting = "H" then          
           go fiyat-bulundu 
        end-if
        move xrez-acenta        to fiyat-acenta. 
        move xrez-gir-tar       to fiyat-tarih. 
        move xrez-tipi          to fiyat-rez-tipi. 
        move xrez-pan-tipi      to fiyat-pan-tipi. 
        move xrez-banka         to fiyat-banka. 
        move xrez-doviz         to fiyat-doviz. 
        move xrez-anlasma       to fiyat-anlasma. 
        move xrez-buyuk         to fiyat-buyuk.
        move xrez-kucuk         to fiyat-kucuk.
        read fiyat no lock invalid go fiyat-bulundu.
 
             move fiyat-acenta    to fiyatana-acenta. 
             move fiyat-bas-tarih to fiyatana-ilk-tarih.
             move fiyat-bit-tarih to fiyatana-son-tarih.
             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
             move fiyat-banka     to fiyatana-banka. 
             move fiyat-doviz     to fiyatana-doviz. 
             move fiyat-anlasma   to fiyatana-anlasma. 
             move fiyat-buyuk     to fiyatana-buyuk.
             move fiyat-kucuk     to fiyatana-kucuk.

             read fiyatana no lock invalid go fiyat-bulundu.
********>Early Booking kontrol
             perform eb-varsa-uyar.
             perform ug-varsa-uyar.
             perform cift-indirim-uyar.
       move fiyatana-oda-fiyati(xrez-fiyat-konumu) to oda-fiyati. 
*/********* 
       if xrez-nor-indirim not = 0 
       compute oda-fiyati rounded = 
              (((oda-fiyati * xrez-nor-indirim) / 100) - oda-fiyati)
       end-if.
*/Early booking orani var ve early booking uygulanacak ise 
       if xrez-eb = "E" and fiyatana-eb-oran not = 0 
          compute oda-fiyati rounded = 
              (((oda-fiyati * (fiyatana-eb-oran +( fiyatana-eb-kusur / 100) )) / 100) - oda-fiyati)
       end-if. 
       if  fiyatana-ug-oran not = 0 and gun-s >= fiyatana-ug-geceleme 
           and xrez-ug-ind = 1 then  
           compute oda-fiyati rounded = 
              (((oda-fiyati * (fiyatana-ug-oran + (fiyatana-ug-kusur / 100))) / 100) - oda-fiyati)
       end-if. 
       
*/Kick back orani
       if xrez-ozel-durum-car > 0
*          if k-kodu-tasi(1:1) = "x" then stop " " end-if  
        evaluate  xrez-ozel-tip 
           WHEN "T"
           if aksiyon-var and aksiyhrk-sondan = 1 
                compute oda-fiyati rounded =   oda-fiyati - 
                 Xrez-ozel-durum-car / aksiyhrk-ode
                else
                 compute oda-fiyati rounded =   oda-fiyati - 
                 Xrez-ozel-durum-car / gun-s 
               end-if    
             when "S"
                compute oda-fiyati rounded = 
                       oda-fiyati - xrez-ozel-durum-car

             when "E" 
                  compute oda-fiyati rounded = 
                       oda-fiyati + xrez-ozel-durum-car
             when other
                  compute oda-fiyati rounded = 
                       (oda-fiyati * xrez-ozel-durum-car) / 100
         end-evaluate
              
       end-if.
       if fiyatana-kick-back <> 0
       compute oda-fiyati rounded = 
              (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
       end-if.
       if fiyatana-kick-back2 <> 0
       compute oda-fiyati rounded = 
              (((oda-fiyati * fiyatana-kick-back2) / 1000) - oda-fiyati)
       end-if.
       move oda-fiyati to xrez-fiyati. 
       compute xrez-fiyati rounded = oda-fiyati * 1.
 aksiyonlu-uyar. 
       if aksiyon-var and  xrez-aksiyon-eh not = "H"
           continue
         else 
          go aksiyonlu2-uyar
       end-if. 
            initialize mesaj-degiskenler
            move " [ Aksiyon Fiyati ] " to mmesaj-title
            move "Anlasma Fiyati:"      to mmesaj-1(01:15). 
            move oda-fiyati             to oda-fiyati-z. 
            move oda-fiyati-z           to mmesaj-1(16:20). 
            move "Aksiyon Fiyati:"      to mmesaj-2(01:15). 
            if  ( aksiyhrk-sondan = 1 and xrez-aksiyon-eh not = "H") and fiyatana-fiks = 0 
                and xrez-fiyat-fix not = "E"  then 
                  perform aksiyon-toplam-bul
                else 
                  compute aksiyonlu-toplam = 
                            oda-fiyati * aksiyhrk-ode
            end-if
            if xrez-aksiyon-eh not = "H"
               compute oda-fiyati rounded = ((aksiyonlu-toplam) / aksiyhrk-gecele)
               move oda-fiyati            to oda-fiyati-z
            else
               compute oda-fiyati-z rounded = ((aksiyonlu-toplam) / aksiyhrk-gecele)
            end-if.
************move oda-fiyati            to oda-fiyati-z. 
            move oda-fiyati-z          to mmesaj-2(16:20). 
            move 1           to mmesaj-type
            move 1           to mmesaj-icon
            move 1           to mmesaj-default
             perform mmesaj-ver.

 aksiyonlu-uyar-exit. 
       exit. 
 aksiyonlu2-uyar. 
       if special-var and  xrez-special-eh not = 1 continue
       else 
          go fiyat-bulundu
       end-if. 
            initialize mesaj-degiskenler
            move " [ Aksiyon Fiyati ] " to mmesaj-title
            move "Anlasma Fiyati............"      to mmesaj-1(01:20). 
            move oda-fiyati             to oda-fiyati-z eski-fiyat. 
            move oda-fiyati-z           to mmesaj-1(21:20). 
            move "Sp. Off Fiyati..........."      to mmesaj-2(01:20).
             if special-ekle = 1 then move -1 to special-eksi-car
             else move 1 to special-eksi-car
             end-if
             evaluate special-hes-tipi
               when 1
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (xrez-buyuk + ( xrez-kucuk / 2 ) ) / special-gece)
                         * special-eksi-car )
               when 2
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (xrez-buyuk + ( xrez-kucuk ) ) / special-gece)
                          * special-eksi-car )
               when 3
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) / special-gece)
                          * special-eksi-car )
               when 4
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * xrez-buyuk)
                          * special-eksi-car )
               when 5
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (xrez-buyuk + ( xrez-kucuk / 2 ) ) )
                          * special-eksi-car )
               when 6
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * (xrez-buyuk + ( xrez-kucuk ) ) )
                          * special-eksi-car )
               when 7
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil))
                          * special-eksi-car )

               when other
                   compute oda-fiyati rounded = oda-fiyati - 
                         (((special-tahsil) * xrez-buyuk / special-gece)
                          * special-eksi-car )
              end-evaluate
               move oda-fiyati            to oda-fiyati-z
            move oda-fiyati-z          to mmesaj-2(22:20).
            move "Special Offer Gunluk....."      to mmesaj-3(01:20).
            compute eski-fiyat  = eski-fiyat - oda-fiyati
            move eski-fiyat             to oda-fiyati-z. 
            move oda-fiyati-z           to mmesaj-3(21:20). 
            move 1           to mmesaj-type
            move 1           to mmesaj-icon
            move 1           to mmesaj-default
             perform mmesaj-ver.

 aksiyonlu2-uyar-exit. 
       exit. 
 fiyat-bulundu. 
       move oda-fiyati to xrez-fiyati.
       compute xrez-fiyati rounded = oda-fiyati * 1.
       close fiyat fiyatana. 
 fiyat-bul-exit. 
       exit. 
*
 cift-indirim-uyar.
    perform gun-bul    if xrez-ug-ind = 1 
       if not (fiyatana-ug-oran > 0 and gun-s >= fiyatana-ug-geceleme) 
          display message box
          " Uzun geceleme indirimini kapsamiyor ve kaldirilacak "
          move 0 to xrez-ug-ind
          display ug-cb
       end-if
    end-if
    if xrez-eb = "E" 
       if not (fiyatana-eb-oran > 0 )
          display message box
          " EB indirimini kapsamiyor ve kaldirilacak "
          modify eraly-booking-cb, value = 0
          move "H" to xrez-eb
       end-if
    end-if
    
    initialize ind-sayi
    if aksiyon-var    add 1 to ind-sayi end-if
    if xrez-ug-ind = 1    add 1 to ind-sayi end-if
    if xrez-eb = "E"  add 1 to ind-sayi end-if
    if ind-sayi > 1 then 
        display message box 
             "Bu Rezervasyon icin Aksiyon - Uzun Geceleme - EB indirimlerinden " new-line
             "en az 2 tanesi uygulanmis kontrol ediniz."
       end-if.
*
 ug-varsa-uyar.
      if fiyatana-ug-oran > 0 and gun-s >= fiyatana-ug-geceleme 
         and xrez-ug-ind = 0 then 
             initialize mesaj-degiskenler
                move " [ Uzun Geceleme Indirimini Kapsayan Rez ] " to mmesaj-title
                move " Bu Rezervasyon Uzun Geceleme Indirimi Sartlarini Sagliyor  " to mmesaj-1
                move " UZUN GECELEME SECENEGI CHECH EDILSIN MI ?? " to mmesaj-2 
                move " ..... [ E->Check Et H->Check Iptal I->Iptal ]  ........ " to mmesaj-3 
                move 4           to mmesaj-type
                move 1           to mmesaj-icon
                move 3           to mmesaj-default
                perform mmesaj-ver
                if donus-kodu = 1
                   move 1 to xrez-ug-ind
                   display ug-cb
                end-if
      end-if .
*
 eb-varsa-uyar.
      if yeni-rez 
       if rez-para-isl-sistemden = 1 then
             move tarih-tasi to sys-tar
             else
           accept sys-tar from century-date 
      end-if
            move sys-yil to xrez-isl-yil
            move sys-ay  to xrez-isl-ay 
            move sys-gun to xrez-isl-gun 
         if fiyatana-eb-oran not = 0 
            and sys-tar not < fiyatana-eb-bas-tarih  and
                sys-tar not > fiyatana-eb-bit-tarih  and xrez-eb not = "E"   
            initialize mesaj-degiskenler
            move " [ Early Booking Rezervasyon ] " to mmesaj-title
            move " GIRDIGINIZ RERVASYON BU TARIH ITIBARIYLE E/B ICERIYOR.. " to mmesaj-1
            move " EARLY BOOKING SECENEGI CHECH EDILSIN MI  ............?? " to mmesaj-2 
            move " ..... [ E->Check Et H->Check Iptal I->Iptal ]  ........ " to mmesaj-3 
            move 4           to mmesaj-type
            move 1           to mmesaj-icon
            move 3           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 1
               modify eraly-booking-cb, value = 1
               move "E" to xrez-eb
            end-if
         end-if 
         if fiyatana-eb-oran  = 0 
            and sys-tar not < fiyatana-eb-bas-tarih  and
                sys-tar not > fiyatana-eb-bit-tarih   
            initialize mesaj-degiskenler
            move " [ Early Booking Rezervasyon ] " to mmesaj-title
            move " GIRDIGINIZ RERVASYON BU TARIH ITIBARIYLE E/B ICERIYOR.. " to mmesaj-1
            move " YANLIZ ANLASMA KODUNU DEGISTIRELISINIZ  ............?? " to mmesaj-2 
           
          
            move 1           to mmesaj-icon
           
            perform mmesaj-ver
           
         end-if 



      end-if. 
      if eski-rez 
         if fiyatana-eb-oran not = 0 
            and xrez-al-tar not < fiyatana-eb-bas-tarih  and
                xrez-al-tar not > fiyatana-eb-bit-tarih and xrez-eb not = "E"  
            initialize mesaj-degiskenler
            move " [ Early Booking Rezervasyon ] " to mmesaj-title
            move " GIRDIGINIZ RERVASYON BU TARIH ITIBARIYLE E/B ICERIYOR.. " to mmesaj-1
            move " EARLY BOOKING SECENEGI CHECH EDILSIN MI  ............?? " to mmesaj-2 
            move " ..... [ E->Check Et H->Check Iptal I->Iptal ]  ........ " to mmesaj-3 
            move 4           to mmesaj-type
            move 1           to mmesaj-icon
            move 3           to mmesaj-default
            perform mmesaj-ver
            if donus-kodu = 1
               modify eraly-booking-cb, value = 1
               move "E" to xrez-eb
            end-if
         end-if 
      end-if. 
 eb-varsa-uyar-exit.
    exit.
*
 blokaj-konum-farkli. 
        initialize mesaj-degiskenler
        move " [ Blokaj Hata ] " to mmesaj-title
        move "Rezervasyon Konumu Ile Blokaj Oda." to mmesaj-1. 
        move "Konumu Farkli...Rez..:   Blok..:  " to mmesaj-2. 
        move xrez-oda-konumu                      to mmesaj-2(23:1). 
        move odalar-konumu                        to mmesaj-2(33:1). 
        move 1           to mmesaj-type
        move 3           to mmesaj-icon
        move 1           to mmesaj-default
             perform mmesaj-ver.
 blokaj-konum-farkli-exit. 
     exit. 
*
 toplam-odeme-bul.
     
          modify form1-gd-1a reset-grid  = 1 mass-update = 1 .
        initialize odeme-var 
            open input cast
              
         initialize cast-rec top-odeme   top-reel top-anlasma gece-sayi
            move xrez-no to cast-rez-no
         start cast  key >  cast-anah1 
            invalid continue
            not invalid
            
             modify form1-gd-1a reset-grid = 1 mass-update = 1
         move "Tarih" to gd-1-tarih
         move "Reel" to  gd-1-tutar
         move "Anlasma" to gd-1-toplam
         modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
          initialize gece-sayi

        perform with test after until fs-cast = "10"  
          read cast next no lock end move "10" to fs-cast
          not end
             if cast-rez-no not = xrez-no or 
               cast-tarih >= xrez-cik-tar
               
               move "10" to fs-cast
               else
               add 1 to gece-sayi
                  initialize renk

                move cast-gun to  gd-1-tarih(1:2)                   
                move cast-ay  to  gd-1-tarih(4:2)   
                move cast-yil to  gd-1-tarih(7:4)
                move "/" to           gd-1-tarih(3:1)   gd-1-tarih(6:1) 
                 if tarih-tasi > cast-tarih
                    move CAST-BASILAN-FIYAT  to z-8
                    move z-8               to gd-1-tutar
                      add CAST-BASILAN-FIYAT to top-reel
                         if cast-BASILAN-FIYAT not = cast-anlasma-fiyati
                           move 176 to renk
                         end-if
                 end-if
                 if tarih-tasi = cast-tarih
                   move 517 to renk
                    add cast-basilan-fiyat to cast-fiyati
                    move CAST-fiyati  to z-8
                    move z-8               to gd-1-tutar
                      add cast-fiyati to top-reel
                        if cast-fiyati not = cast-anlasma-fiyati
                           move 176 to renk
                    end-if
                 end-if
                 if tarih-tasi < cast-tarih
                    add cast-fiyati to top-reel
                    move CAST-fiyati  to z-8
                    if cast-fiyati not = cast-anlasma-fiyati
                       move 176 to renk
                    end-if
                    move z-8               to gd-1-tutar
                 end-if

                move cast-anlasma-fiyati  to z-8
                move z-8               to gd-1-toplam
               
                   add cast-anlasma-fiyati to top-anlasma
                
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 if renk not = 0 then 
                   modify  form1-gd-1a(gece-sayi + 1) row-color  = renk 
                 end-if
              end-if
          end-read 
        end-perform, 
        end-start,
           move 0 to renk
             move "TOPLAM" to           gd-1-tarih
                 
                    move  top-reel to z-8
                    if top-reel not = top-anlasma
                       move 176 to renk
                    end-if
                    move z-8               to gd-1-tutar
               

                move top-anlasma          to z-8
                move z-8               to gd-1-toplam
               
                  
                
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 if renk not = 0 then 
                   modify  form1-gd-1a(gece-sayi + 2) 
                       start-x = 1 x = 3
                       start-y = gece-sayi + 2 y = gece-sayi + 2
                       region-color  = renk 
                 end-if


         modify form1-gd-1a  mass-update = 0
         close cast
              move  top-anlasma to top-odeme
            compute kal-odeme = top-odeme - xrez-on-odeme 

            move top-odeme      to odeme-z
            modify  accept-toplam-tutar value = odeme-z
            move xrez-on-odeme  to odeme-z
            modify  accept-odeme-toplam value = odeme-z
            move kal-odeme      to odeme-z
            modify  accept-odeme-kalan  value = odeme-z.
        
 toplam-odeme-bul-exit.
        exit.
*********************KONTROLLER*********************
***********Aramalar.........
*
*
*
 Form1-Gd-1a-Ev-Msg-Begin-Entry.
             set event-action to event-action-fail
    
             
               call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xrez-no   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/hesayr.asy"
               end-call



     .

 kaydet. 
 kaydet-kontrol. 
          initialize mesaj-degiskenler gec-gecme.
        if rezpara-stops-uyari = "E" 
               perform stopsale-kontrol thru stopsale-kontrol-exit
               if rezpara-stops-gecsin = "H" and 
                  stopsale-var-yok = "V" AND rez-yeni-eski = "Y"
                  DISPLAY MESSAGE BOX "BU TARIHTE SATISA KAPALI GUN VAR" NEW-LINE
                     "PARAMETRELER IZIN VERMEMEKTEDIR"
                     TITLE "STOP SALE "
                  move 1 to gec-gecme
                 go kaydet-exit
               end-if
             IF stopsale-var-yok = "V"
               initialize mesaj-degiskenler
              move " [ SATISA KAPALI  ] " to mmesaj-title
       move " BU TARIHLERDE STOP-SALE TANIMLANMIS   " to mmesaj-1
       move " STOP'A RAGMEN DEVAM ETMEK ISTERMISINIZ?" to mmesaj-2 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 2           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go kaydet-exit
       end-if
       END-IF
            end-if 
        move " [ Hata ] " to mmesaj-title
        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
        perform acenta-oku   thru acenta-oku-exit
                if gecmez 
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform firma-oku   
                if gecmez 
                move "Hata Yeri : [ Firma Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform banka-oku    thru banka-oku-exit
                if gecmez
                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform odeme-oku    thru odeme-oku-exit
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez
                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-gir-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-cik-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if
        if xrez-gir-tar  < tarih-tasi
           move "Hata Tipi : [ Uyumsuz Veri .......]" to mmesaj-1
          move "Hata Yeri : [ Gecmis Tarihe Rezervasyon Girilemez]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
         end-if
        if xrez-cik-tar < xrez-gir-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-k-g-b     not = "K" and not = "G" and not = "B" and not = "O"
           move "Hata Yeri : [ Kur K-G-B Tanimsiz..................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 

        open input konum
        move xrez-oda-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Rezervasyon Oda Konumu Tanimsiz.....]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid continue
             end-read
          move xrez-fiyat-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Rezervasyon Fiyat Konumu Tanimsiz.....]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go kaydet-exit
             not invalid continue
             end-read



             close konum

        if xrez-s-d-t-g   not = 1 and not = 2 and not = 3 and not = 4 
           move "Hata Yeri : [ Oda Tipi Tanimsiz..[ S-D-T-G ]......]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if (xrez-on-odeme not = zeroes and xrez-on-doviz = spaces) 
           move "Hata Yeri : [ On Odeme Doviz Kodu Tanimsiz........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-buyuk  <  1 and rezpara-sifir-pax not = 1
           move "Hata Yeri : [ Buyuk Sayisi [0] Olamaz.............]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-no  <  1 
           move "Hata Yeri : [ Rezervasyon Numarasi Bos Gecilemez..]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
*        if rezpara-blokaj  = "E" 
*        perform oda-oku      thru oda-oku-exit
*                if gecmez
*                move "Hata Yeri : [ Blokaj Odasi  Tanimsiz..............]" to mmesaj-2
*                move 1           to mmesaj-type
*                move 3           to mmesaj-icon
*                move 1           to mmesaj-default
*                perform mmesaj-ver
*                go kaydet-exit
*                end-if 
*                if rezpara-blokaj-farkli = "H" and 
*                   xrez-oda-konumu not = odalar-konumu 
*                   move "Hata Yeri : [ Blokaj Odasinin Konumu Yanlis.......]" to mmesaj-2
*                   move 1           to mmesaj-type
*                   move 3           to mmesaj-icon
*                   move 1           to mmesaj-default
*                   perform mmesaj-ver
*                   go kaydet-exit
*        end-if.

       if eski-rez and xrez-c-in = "E" 
          initialize mesaj-degiskenler
          move " [ Degistirilemez Rezervasyon ] " to mmesaj-title
          move " Bu Rezervasyon C-In Yapilmis   !!! " to mmesaj-1 
          move " Rezervasyonda Degisiklik yapilamaz " to mmesaj-2 
          move 1           to mmesaj-type
          move 3           to mmesaj-icon
          move 1           to mmesaj-default
             perform mmesaj-ver
             go kaydet-exit
       end-if.

*/ konfirme denetimi 
       inquire rez-kgb-combo, value in xrez-k-g-b

       if xrez-k-g-b <> "K" and yeni-rez
          display message box 
                  "Girmis oldugunuz rezervasyonu KONFIRME etmediniz ",new-line,
                  "Eminmisiniz ? ",
                  icon mb_warning_icon
                  title "Bilginize ..."
                  type mb_yes_no,
                  default 2
                  returning sunset-uyari
          if sunset-uyari = 2
             move 4 to accept-control
             move 1024 to control-id
             go kaydet-exit
          end-if
       end-if.
       perform blok-kont2.
       initialize mesaj-degiskenler
       move " [ Kaydet Soru ] " to mmesaj-title
       move " GIRDIGINIZ BILGILER KAYDEDILECEKTIR " to mmesaj-1.
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2. 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go kaydet-exit
       end-if
            open output takasfiyat
            close takasfiyat
           open input  takvim2  kur romhrk kodlar02  aksiyhrk fiyat fiyatana konuk firma
           open i-o takasfiyat
          move rez-rec to yedek-rez
           move xrez-rec to rez-rec
*            perform peryot-fiyat-bul
           move yedek-rez to rez-rec
              close takasfiyat  takvim2 kur romhrk kodlar02  aksiyhrk fiyat fiyatana konuk firma
       if yeni-rez 
           accept sys-tar from century-date 
          if rez-para-isl-sistemden = 1 then
             move tarih-tasi to xrez-isl-tar  sys-tar
          else
             move sys-yil to xrez-isl-yil
             move sys-ay  to xrez-isl-ay 
             move sys-gun to xrez-isl-gun 
          end-if
       end-if. 
       move "Y" to fark-var-yok cast-fark-var-yok 
                   takvim-fark-var-yok acenhrk-fark-var-yok. 
*****if srez-durumu     not = xrez-durumu 
*****                   move "V" to fark-var-yok 
*****                   takvim-fark-var-yok acenhrk-fark-var-yok. 
*****if srez-tipi       not = xrez-tipi       move "V" to fark-var-yok. 
       if srez-acenta     not = xrez-acenta  
                          move "V" to fark-var-yok  
                          acenhrk-fark-var-yok
       end-if.
       if srez-gir-tar    not = xrez-gir-tar 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-cik-tar    not = xrez-cik-tar 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-kisi       not = xrez-kisi 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok 
       end-if.
       if srez-s-d-t-g    not = xrez-s-d-t-g 
                          move "V" to fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-k-g-b      not = xrez-k-g-b 
                          move "V" to fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok 
       end-if.
       if srez-oda-konumu not = xrez-oda-konumu 
                          move "V" to fark-var-yok cast-fark-var-yok 
                          takvim-fark-var-yok acenhrk-fark-var-yok
       end-if.
       if srez-fiyat-konumu not = xrez-fiyat-konumu 
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-odano      not = xrez-odano 
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-bilbord-eh not = xrez-bilbord-eh 
                          move "V" to fark-var-yok 
                          move "V" to acenhrk-fark-var-yok
       end-if.
       if srez-fiyati     not = xrez-fiyati
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-anlasma    not = xrez-anlasma
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if srez-pan-tipi   not = xrez-pan-tipi
                          move "V" to fark-var-yok 
                          move "V" to cast-fark-var-yok 
       end-if.
       if eski-rez 
          move "I"             to xrez-durumu 
          move k-kodu-tasi     to xrez-staf 
          move xrez-no to rez-no
          read rez no lock invalid
            display message box "Hata : rezkj44"
          end-read  
          if rez-folio > 0 then 
            display message box 
            " Bu rez C/IN oldu"
            else
          move xrez-rec        to rez-rec 
          move "I"             to rez-durumu
*          move mis-no to rez-profil-no
*          move ps1    to rez-profil-sirket
          perform yanrez-kaydet
          rewrite rez-rec invalid 
                  write rez-rec invalid continue
                  end-write
          end-rewrite
               perform log-operation-rez
           open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
           
          end-if
       end-if.
*************>Rezervasyonda cast'i etkilemeyen bilgiler degismemisse tekrar 
*************>silip yazmasin............. 
       if eski-rez 
 

          perform cast-sil     thru cast-sil-exit 
          perform cast-isle    thru cast-isle-exit
       end-if.
       if eski-rez and acenhrk-fark-var 
          perform acenhrk-sil  thru acenhrk-sil-exit 
          perform acenhrk-isle thru acenhrk-isle-exit
       end-if.
       if eski-rez and takvim-fark-var 
          perform takvim-sil   thru takvim-sil-exit 
          perform takvim-isle  thru takvim-isle-exit
       end-if.
*************> 
       if yeni-rez 
          move "I"             to xrez-durumu 
          move k-kodu-tasi     to xrez-staf 
          move xrez-rec        to rez-rec 
          perform cast-isle    thru cast-isle-exit 
          perform acenhrk-isle thru acenhrk-isle-exit 
          perform takvim-isle  thru takvim-isle-exit 
          move "I"             to rez-durumu 
*          move mis-no to rez-profil-no
*          move ps1    to rez-profil-sirket
          write rez-rec invalid 
                rewrite rez-rec invalid continue
                end-rewrite
          end-write   
              perform log-operation-rez
          open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
            
       end-if.
*
 ortak-yanrez.
      move rez-no      to yanrez-rezno
      move rez-gir-tar to yanrez-gel-tar
      move rez-cik-tar to yanrez-git-tar
      move rez-odano   to yanrez-odano.
*
 yanrez-kaydet.
       open i-o yanrez
       initialize yanrez-rec
       move 1 to yanrez-sirano
       move rez-adi    to yanrez-adi
       move rez-soyadi to yanrez-soyadi
       move mis-no     to yanrez-profil-no
       move ps1        to yanrez-profil-sirket
       perform ortak-yanrez

       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
    
    if adi2 not = spaces or 
       soy2 not = spaces then
       initialize yanrez-rec
       move 2 to yanrez-sirano
       move adi2   to yanrez-adi
       move soy2   to yanrez-soyadi
       move d-tar2 to yanrez-dog-tar
       move pno2   to yanrez-profil-no
       move ps2    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
     else
         move rez-no      to yanrez-rezno
         move 2 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi3 not = spaces or soy3 not = spaces then
       initialize yanrez-rec
       move 3 to yanrez-sirano
       move adi3   to yanrez-adi
       move soy3   to yanrez-soyadi
       move d-tar3 to yanrez-dog-tar
       move pno3   to yanrez-profil-no
       move ps3    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
        else
         move rez-no      to yanrez-rezno
         move 3 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi4 not = spaces or soy4 not = spaces then
       initialize yanrez-rec
       move 4 to yanrez-sirano
       move adi4   to yanrez-adi
       move soy4   to yanrez-soyadi
       move d-tar4 to yanrez-dog-tar
       move pno4   to yanrez-profil-no
       move ps4    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 4 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi5 not = spaces or soy5 not = spaces then
       initialize yanrez-rec
       move 5 to yanrez-sirano
       move adi5   to yanrez-adi
       move soy5   to yanrez-soyadi
       move d-tar5 to yanrez-dog-tar
       move pno5   to yanrez-profil-no
       move ps5    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 5 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if
    if adi6 not = spaces or soy6 not = spaces then
       initialize yanrez-rec
       move 6 to yanrez-sirano
       move adi6   to yanrez-adi
       move soy6   to yanrez-soyadi
       move d-tar6 to yanrez-dog-tar
       move pno6   to yanrez-profil-no
       move ps6    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 6 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if

    if adi7 not = spaces or soy7 not = spaces then
       initialize yanrez-rec
       move 7 to yanrez-sirano
       move adi7   to yanrez-adi
       move soy7   to yanrez-soyadi
       move d-tar7 to yanrez-dog-tar
       move pno7   to yanrez-profil-no
       move ps7    to yanrez-profil-sirket
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           perform log-operation-yanrez
       else
         move rez-no      to yanrez-rezno
         move 7 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             perform log-operation-yanrez
    end-if

    close yanrez.
*
 fis-cik-cikma. 
       if eski-rez and rezpara-duz-fis not = "E" 
          go fis-gec
       end-if. 
       if yeni-rez and rezpara-fis-sor not = "E" 
          go fis-gec
       end-if
       initialize mesaj-degiskenler
       move " [ Fis Ciksin Mi ? ] " to mmesaj-title
       move " REZERVASYON FORMU ISTIYORMUSUNUZ..? " to mmesaj-1.
       move " ...[ E->Evet  H->Hayir ]........... " to mmesaj-2. 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go fis-gec
       end-if.
 rez-fis-cik. 
      call "/asya/ytl/obj/otel/rezfisi.asy" using xrez-no
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/rezfisi.asy" 
       end-call.
 fis-gec. 
      if link-var = 1 then 
              move 99999999 to link-rez-no
              set exit-pushed to true
              go kaydet-exit
          end-if.
     initialize rez-rec xrez-rec accept-rez-no yan-deg

     move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
     move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu
                          oda-konumu-combo-value fiyat-konumu-combo-value
     perform gun-bul
     perform form-update
     move 4    to accept-control
     move 1002 to control-id.

 kaydet-exit. 
     exit. 
********====> Rezervasyon Cogaltma Bolumu       <========********** 
 cogalt. 
 
 cogalt-kontrol. 
        initialize mesaj-degiskenler gec-gecme.
        move " [ Hata ] " to mmesaj-title
        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
        perform acenta-oku   thru acenta-oku-exit
                if gecmez 
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 

        perform banka-oku    thru banka-oku-exit
                if gecmez

                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        perform odeme-oku    thru odeme-oku-exit
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez
                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 

        move xrez-gir-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 

        move xrez-cik-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go cogalt-exit
                end-if 
        if xrez-cik-tar < xrez-gir-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 

        if xrez-gir-tar < calisma-tarihi
           move "Hata Yeri : [ Gecmise Cogaltma YAPILAMAZ..........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 

        if xrez-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 
        if xrez-k-g-b     not = "K" and not = "G" and not = "B" and not = "O"
           move "Hata Yeri : [ Kur K-G-B Tanimsiz..................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 

        open input konum
        move xrez-oda-konumu to konum-anahtar
        read konum no lock invalid 
             move "Hata Yeri : [ Oda Konumu Tanimsiz.................]" to mmesaj-2
             move 1           to mmesaj-type
             move 3           to mmesaj-icon
             move 1           to mmesaj-default
             perform mmesaj-ver
             close konum
             move 1 to gec-gecme
             go cogalt-exit
             not invalid continue
             end-read
             close konum

        if xrez-k-g-b     not = "K" and not = "G" and not = "B" and not = "O"
           move "Hata Yeri : [ Rez K-G-B Tanimsiz.[ K-G-B ]........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 

        if xrez-s-d-t-g   not = 1 and not = 2 and not = 3 and not = 4 
           move "Hata Yeri : [ Oda Tipi Tanimsiz..[ S-D-T-G ]......]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 
        if (xrez-on-odeme not = zeroes and xrez-on-doviz = spaces) 
           move "Hata Yeri : [ On Odeme Doviz Kodu Tanimsiz........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 
        if xrez-buyuk  <  1 
           move "Hata Yeri : [ Buyuk Sayisi [0] Olamaz.............]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go cogalt-exit
        end-if 
************** ets de kaldirdim muhammed
*        if rezpara-blokaj  = "E" 
*        perform oda-oku      thru oda-oku-exit
*                if gecmez
*                move "Hata Yeri : [ Blokaj Odasi  Tanimsiz..............]" to mmesaj-2
*                move 1           to mmesaj-type
*                move 3           to mmesaj-icon
*                move 1           to mmesaj-default
*                perform mmesaj-ver
*                go cogalt-exit
*                end-if 
*                if rezpara-blokaj-farkli = "H" and 
*                   xrez-oda-konumu not = odalar-konumu 
*                   move "Hata Yeri : [ Blokaj Odasinin Konumu Yanlis.......]" to mmesaj-2
*                   move 1           to mmesaj-type
*                   move 3           to mmesaj-icon
*                   move 1           to mmesaj-default
*                   perform mmesaj-ver
*                   go cogalt-exit
*        end-if.
        
            move 0 to key-status
            perform acu-form4-routine.
            initialize g-e 
            move 1 to c-e
            display accept-cik-gunaa cik-p .
        
 krkrkrkr. 
       initialize mesaj-degiskenler
       move " [ Cogalt Soru ] " to mmesaj-title
       move " REZERVASYON COGALTMA ISLEMI         " to mmesaj-1.
       move " BASLASIN MI ?....E->Evet, H->Hayir  " to mmesaj-2. 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go cogalt-exit
       end-if.

        perform grup-cogalt thru grup-cogalt-exit cogalt-adet times. 

           initialize mesaj-degiskenler
           move " [ Rezervasyon Cogaltildi ] " to mmesaj-title
           move "Ekrandaki Rezervasyon Cogaltildi ..." to mmesaj-1 
           move "Yeni Rezervasyon No...:"              to mmesaj-2 
           move cog-fis-no                             to mmesaj-2(30:)
           move 1           to mmesaj-type
           move 1           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver.

        go cogalt-exit. 
 grup-cogalt. 
 cog-rez-no. 
       initialize cog-fis-no xrez-odano
       display accept-odano. 
       perform cog-fis-al thru cog-fis-al-exit. 
       move cog-fis-no    to rez-no. 
       read rez no lock invalid continue 
            not invalid 
            initialize mesaj-degiskenler
            move " [ Fis No Dolu ] " to mmesaj-title
            move cog-fis-no          to mmesaj-1 
            move "Nolu Rezervasyon Fisi Dolu Sonraki No Icin ENTER" to mmesaj-2 
            move 1           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
             perform mmesaj-ver
             go cog-rez-no
        end-read.
*
 cog-rez-yaz. 
         move xrez-rec    to rez-rec. 

         move cog-fis-no  to rez-no. 
         move "I"         to rez-durumu. 
         move k-kodu-tasi to rez-staf. 
         initialize  rez-c-in  rez-folio REZ-ODANO. 
         if rez-para-isl-sistemden = 1 then
             move tarih-tasi to sys-tar
             else
         accept sys-tar from century-date 
         end-if
                move sys-yil to rez-isl-yil
                move sys-ay  to rez-isl-ay 
                move sys-gun to rez-isl-gun 
                 if rez-para-isl-sistemden = 1 then
             move tarih-tasi to rez-isl-tar
         end-if
         initialize rez-odano
         write rez-rec invalid go grup-cogalt-exit. 
               perform log-operation-rez.
         move xrez-no    to fisno-tut. 
         move cog-fis-no to xrez-no. 
         perform cast-isle    thru cast-isle-exit. 
         move fisno-tut  to xrez-no. 
         perform acenhrk-isle thru acenhrk-isle-exit. 
         perform takvim-isle  thru takvim-isle-exit. 
       go grup-cogalt-exit. 
 grup-cogalt-exit. 
     exit. 
 cogalt-exit.
     exit.
*
 cog-fis-al. 
    initialize cog-fis-no. 
    open i-o genelfis. 
    move 1 to genelfis-anahtar. 
    read genelfis no lock invalid 
         initialize genelfis-rec 
         move 1 to genelfis-anahtar
         not invalid continue
    end-read. 
    add 1 to rez-oto. 
    if rez-oto > 99999998 
       close genelfis go cog-fis-al-exit
    end-if. 
    move rez-oto to cog-fis-no. 
    rewrite genelfis-rec invalid 
            write genelfis-rec invalid continue
            end-write
    end-rewrite. 
    close genelfis. 
 cog-fis-al-exit. 
    exit. 
********====> Rezervasyon Silme    Bolumu       <========********** 
 rez-sil. 
    move xrez-no to rez-no. 
    read rez no lock invalid go rez-sil-exit. 
    if rez-c-in = "E" 
       initialize mesaj-degiskenler
       move " [ Silinemez Rezervasyon ] " to mmesaj-title
       move " Bu Rezervasyon C-In Yapilmis   !!! " to mmesaj-1 
       move " C-In'i Iptal Edip Siliniz      !!! " to mmesaj-2 
       move 1           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
          perform mmesaj-ver
        if k-kodu-tasi = "1919" or "1919" then 
           display message box "SELAHATTIN DIKKAT ET SILIYOSUN"
                                "EGER ASYA SOFT YETKILISI DEGILSENIZ " new-line 
                                "LUTFEN  hayiri tiklayip ASYA kullanicisini kullanmayiniz.  "
                               title "DIKKAT ozel islem"
                              move 1           to mmesaj-type
                              move 1           to mmesaj-icon
                              move 2           to mmesaj-default
       else
         go rez-sil-exit
       end-if 
    end-if.
       perform acu-fsil-routine
       initialize mesaj-degiskenler
       move " [ Sil Soru ] " to mmesaj-title
       move " BU REZERVASYON SILINECEKTIR ......  " to mmesaj-1
       if tr-sec(1:8) not = "--------" then
         move tr-sec(1:8) to mmesaj-1(17:)
         move "TRANSFER EDILECEK" to mmesaj-1(26:)
       end-if
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 2           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go rez-sil-exit
       end-if
        if tr-sec(1:8) not = "--------" then
           open input isyeri
            initialize isyeri-rec
            move tr-sec(1:8) to isyeri-adres
            start isyeri key = isyeri-adres invalid continue
              not invalid
              read isyeri next no lock end-read
              move isyeri-no to REZ-git-sirket
              move rez-rec to trez-rec
              move isyeri-adres-tasi to trez-gel-sirket
              move tr-acenta to trez-acenta

           end-start
           close isyeri
        end-if
        if rez-para-isl-sistemden = 1 then
             move tarih-tasi to rez-isl-tar
          else
           accept sys-tar from century-date 
              move sys-yil to rez-isl-yil
              move sys-ay  to rez-isl-ay 
              move sys-gun to rez-isl-gun 
        end-if
       move k-kodu-tasi   to rez-staf 
       move sil-sebeb to rez-sil-sebeb
       move r-iptal   to rez-iptal
       move fsil-value to rez-e-mail
       move "S" to rez-durumu 
       rewrite rez-rec invalid 
               initialize mesaj-degiskenler
               move " [ Hata ] " to mmesaj-title
               move " BU REZERVASYON SILINEMEDI.........  " to mmesaj-1
               move " KONTROL EDINIZ....................  " to mmesaj-2 
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
               go rez-sil-exit.
               perform log-operation-rez.
*******perform cast-iptal   thru cast-iptal-exit. 
      perform prohrk-sil  
      perform acenhrk-sil  thru acenhrk-sil-exit. 
      perform takvim-sil   thru takvim-sil-exit.
      if tr-sec(1:8) not = "--------" then
          perform rez-trans-et
      end-if
      initialize rez-rec xrez-rec accept-rez-no yan-deg
      move ilk-rez-tipi to xrez-tipi rez-tipi-combo-value
      move ilk-konum    to xrez-oda-konumu xrez-fiyat-konumu 
                           oda-konumu-combo-value fiyat-konumu-combo-value
      perform gun-bul
      perform form-update      
      move 4    to accept-control
      move 1002 to control-id.
 rez-sil-exit. 
     exit. 
*
 prohrk-sil.
     open i-o prohrk
     move isyeri-adres-tasi       to prohrk-rez-sirket
     move xrez-no                 to prohrk-rez-no
     start prohrk key not < prohrk-rez-anah invalid
         continue
     not invalid
     perform with test after until fs-prohrk = "10"
     read prohrk next no lock end move "10"   to fs-prohrk
     not at end
            if     isyeri-adres-tasi       = prohrk-rez-sirket and
                   xrez-no       = prohrk-rez-no
                   move "S"        to prohrk-rez-durumu
                   accept prohrk-duz-tarih from century-date
                   rewrite prohrk-rec invalid stop " " end-rewrite
            else
               move "10"   to fs-prohrk
            end-if
  
     end-read
     end-perform
     end-start
     close prohrk

     .
*
 rez-trans-et.
      close rez takvim
      move isyeri-adres-tasi to eisyeri-adres-tasi
      move tr-sec(1:8)  to isyeri-adres-tasi
      perform adresleri-tasi
             open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  move rez-oto to xrez-no accept-rez-no
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                  add 1 to rez-oto 
                  move rez-oto to trez-no 
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
      
                                
      open i-o rez takvim
        move trez-rec to rez-rec xrez-rec
        write rez-rec invalid stop " " end-write
           perform log-operation-rez
          perform cast-isle    thru cast-isle-exit 
          perform acenhrk-isle thru acenhrk-isle-exit 
          perform takvim-isle  thru takvim-isle-exit 

      close rez takvim
      move eisyeri-adres-tasi to isyeri-adres-tasi
      perform adresleri-tasi
      open i-o rez  takvim
        .
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 
 cast-isle. 
          
           open input fiyat fiyatana hesayr 
           open i-o cast takasfiyat. 
           move xrez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
              go cast-isle-bitti. 
 cast-yaz-oku. 
        read takvim next no lock end go cast-isle-bitti. 
        if fs-takvim = 99 go cast-yaz-oku. 
        if takvim-anah > xrez-cik-tar go cast-isle-bitti. 
                initialize cast-rec. 
            initialize takasfiyat-rec
           move xrez-no     to  cast-rez-no
           move takvim-anah to   cast-tarih
           
           
             initialize      hesaplanan-fiyat
           if xrez-gir-tar = cast-tarih and xrez-gec = 1 
            initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
           start hesayr key >= hesayr-anah invalid continue
              not invalid
              perform until fs-hesayr = "10"
                  read hesayr previous no lock end move "10" to fs-hesayr
                      not end 
                        if hesayr-rez-no = xrez-no and hesayr-tarih <= xrez-gir-tar
                          add hesayr-basilacak-tut to hesaplanan-fiyat 
                          else
                          move "10" to fs-hesayr
                        end-if
                  end-read
              end-perform
              else
               initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
               read hesayr no lock 
                      invalid 
                        continue
                  not invalid
                 move  hesayr-basilacak-tut to hesaplanan-fiyat 
               end-read
           end-if   
           if hesaplanan-fiyat = 0 then 
               move xrez-fiyati to hesaplanan-fiyat
            end-if  
        
           initialize eski-cast hesayr-rec
           read cast no lock invalid 
                 continue
                 
               not invalid
                move cast-rec to eski-cast
           end-read
               if xrez-plan not = 1 
                   move hesaplanan-fiyat to cast-fiyati
                   else
                   if cast-tarih = tarih-tasi
                       move hesaplanan-fiyat to cast-fiyati
                   end-if
                end-if
                  move hesaplanan-fiyat to cast-anlasma-fiyati
           if xrez-plan not = 1 or xrez-gir-tar = cast-tarih
                   move xrez-odano        to cast-oda-no
                   move xrez-buyuk        to cast-buyuk
                   move xrez-kucuk        to cast-kucuk
        
                   move xrez-bebek        to cast-bebek
                   move xrez-free         to cast-free
                   move xrez-oda-konumu   to cast-oda-konumu
                   move xrez-fiyat-konumu to cast-fiyat-konumu
                   move xrez-anlasma      to cast-anlasma
                   move xrez-pan-tipi     to cast-pan-tipi
           end-if
       
           if takvim-anah = xrez-cik-tar
               initialize      cast-fiyati  cast-anlasma-fiyati
           end-if
           

*           move xrez-xxx          to cast-oda-adet 
*           move xrez-xxx          to cast-kisi-konaklama
        
                write cast-rec invalid 
                      rewrite cast-rec invalid continue
                      end-rewrite
                end-write
      if cast-rec not = eski-cast(1:function length(cast-rec)) then 
                perform log-operation-cast
        end-if 



            go cast-yaz-oku. 
 cast-isle-bitti. 
            close cast takasfiyat.
            close fiyat fiyatana hesayr.
 cast-isle-exit. 
     exit. 
 cast-sil. 
           open i-o cast. 
         initialize cast-rec. 
        move xrez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-sil-bitti. 
 cast-sil-oku. 
        read cast  next no lock end go cast-sil-bitti. 
        if fs-cast = 99 go cast-sil-oku. 
        if cast-rez-no > xrez-no go cast-sil-bitti. 
        if cast-rez-no = xrez-no continue
        else 
           go cast-sil-oku
        end-if.
        if cast-tarih  < xrez-gir-tar or 
           cast-tarih  > xrez-cik-tar
        continue
        else 
           go cast-sil-oku
        end-if.
        delete cast invalid 
          continue.
          perform log-operation-cast
            go cast-sil-oku. 
 cast-sil-bitti. 
         close cast. 
 cast-sil-exit. 
     exit. 
 cast-iptal. 
***********> Bu bolum silinen rezervasyonlari casta silinmis olarak isletmek 
***********> icin konulmustu iptal edildi........... 
           open i-o cast. 
        initialize cast-rec. 
        move rez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-iptal-bitti. 
 cast-ipt-oku. 
        read cast  next no lock end go cast-iptal-bitti. 
        if fs-cast = 99 go cast-ipt-oku. 
        if cast-rez-no > rez-no go cast-iptal-bitti. 
        if cast-rez-no = rez-no continue
        else 
           go cast-ipt-oku
        end-if. 
********move "S" to cast-durumu. 
        rewrite cast-rec invalid 
            continue.
         perform log-operation-cast
            go cast-ipt-oku. 
 cast-iptal-bitti. 
         close cast. 
 cast-iptal-exit. 
     exit. 
 acenhrk-isle. 
********if xrez-tipi = 1 continue else go acenhrk-isle-exit. 
        if xrez-k-g-b = "K" continue
        else 
           go acenhrk-isle-exit
        end-if. 
        open i-o acenhrk bilbord. 
 acenhrk-basla. 
         move xrez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
               go acenhrk-isle-bitti. 
 acenhrk-oku-yaz. 
         read takvim next no lock end 
              go acenhrk-isle-bitti. 
         if fs-takvim = 99 go acenhrk-oku-yaz. 
         if takvim-anah = xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
         if takvim-anah > xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
********>Bilbord rezervasyona yazsin..
         if xrez-bilbord-eh = "E"
            perform bilbord-isle thru bilbord-isle-exit
         end-if.
********>Bilbord rezervasyona yazsin...
         if fark-yok 
            go acenhrk-oku-yaz
         end-if
           move ac-kont to acenhrk-acenta
*****          move xrez-acenta      to acenhrk-acenta. 
          move takvim-anah      to acenhrk-tarih. 
          move xrez-fiyat-konumu  to acenhrk-oda-konumu. 
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
              invalid  
                  initialize acenhrk-rec  
                     move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g
                  move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
         end-write 
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue end-rewrite  
         end-read  
           move ac-kont to acenhrk-acenta

****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41 to acenhrk-oda-konumu  
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
           invalid  
                  initialize acenhrk-rec 
                    move ac-kont to acenhrk-acenta
****                 move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g  
                   move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write  
           not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move xrez-fiyat-konumu  to acenhrk-oda-konumu  
          move 5     to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid 
                  initialize acenhrk-rec 
                   move ac-kont to acenhrk-acenta 
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move 5     to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write 
         not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
            move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41  to acenhrk-oda-konumu  
          move 5    to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid
                  initialize acenhrk-rec  
                    move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move 5   to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                       rewrite acenhrk-rec invalid continue
                       end-rewrite
                  end-write
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue
                  end-rewrite
         end-read
         go acenhrk-oku-yaz. 
 acenhrk-isle-bitti. 
        close acenhrk bilbord.
 acenhrk-isle-exit. 
      exit. 
 bilbord-isle. 
          initialize bilbord-rec.
           move ac-bilb to bilbord-acenta
          
*********          move xrez-acenta      to bilbord-acenta. 
          move takvim-anah      to bilbord-tarih. 
          move xrez-oda-konumu  to bilbord-oda-tip. 

         read bilbord no lock invalid 
              initialize bilbord-rec
              move ac-bilb to bilbord-acenta
****              move xrez-acenta      to bilbord-acenta
              move takvim-anah      to bilbord-tarih 
              move xrez-oda-konumu  to bilbord-oda-tip 
              write bilbord-rec invalid 
                    display message box "Bilborda yazilamadi hata no : bil-1001"
              end-write
         end-read.
          compute  bilbord-sat-oda   = bilbord-sat-oda   + 1. 
          compute  bilbord-sat-buyuk = bilbord-sat-buyuk + xrez-buyuk. 
         rewrite bilbord-rec invalid 
                 display message box "Bilborda yazilamdi hata no : bil-1002"
         end-rewrite.
 bilbord-isle-exit. 
      exit. 
*
 acenhrk-sil. 
********if srez-tipi = continue else go acenhrk-sil-exit. 
        if srez-k-g-b = "K" continue
        else 
           go acenhrk-sil-exit
        end-if. 
        open i-o acenhrk bilbord. 
 acenhrk-s-basla. 
           move srez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
                 go acenhrk-sil-bitti. 
 acenhrk-oku-sil. 
        read takvim next no lock end 
             go acenhrk-sil-bitti. 
        if fs-takvim = 99 go acenhrk-oku-sil. 
        if takvim-anah = srez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
        if takvim-anah > srez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
********>Bilbord rezervasyona yazsin..
         if srez-bilbord-eh = "E"
            perform bilbord-sil thru bilbord-sil-exit
         end-if.
********>Bilbord rezervasyona yazsin..
         if fark-yok 
            go acenhrk-oku-sil 
         end-if
            move ac-kont to acenhrk-acenta
*****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move srez-fiyat-konumu  to acenhrk-oda-konumu. 
           move srez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
           not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
           rewrite acenhrk-rec invalid continue end-rewrite
           end-read
             move ac-kont to acenhrk-acenta
****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move srez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
            not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
***           move srez-acenta      to acenhrk-acenta. 
             move ac-kont to acenhrk-acenta
           move takvim-anah      to acenhrk-tarih. 
           move srez-fiyat-konumu  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
          not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
*****         move srez-acenta      to acenhrk-acenta 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
           not invalid  
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - srez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - srez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - srez-bebek

            rewrite acenhrk-rec invalid continue end-rewrite
          end-read
          go acenhrk-oku-sil. 
 acenhrk-sil-bitti. 
          close acenhrk bilbord. 
 acenhrk-sil-exit. 
        exit. 
 bilbord-sil. 
          initialize bilbord-rec.


          move ac-bilb to bilbord-acenta
********    move srez-acenta      to bilbord-acenta 
          move takvim-anah      to bilbord-tarih. 
          move srez-oda-konumu  to bilbord-oda-tip. 

         read bilbord no lock invalid 
              go bilbord-sil-exit
         end-read.
          if bilbord-sat-oda > 0
             compute  bilbord-sat-oda   = bilbord-sat-oda   - 1
          end-if. 
          if bilbord-sat-buyuk > 0
             compute  bilbord-sat-buyuk = bilbord-sat-buyuk - srez-buyuk
          end-if. 
         rewrite bilbord-rec invalid 
                 display message box "Bilborda yazilamadi hata no : bil-1003"
         end-rewrite.
 bilbord-sil-exit. 
      exit. 
 takvim-isle. 
        if xrez-k-g-b = "K" continue
        else 
           go takvim-isle-exit
        end-if. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-isle-exit. 
 takvim-oku-yaz. 
        read takvim next no lock end go takvim-isle-exit. 
        if fs-takvim = 99 go takvim-oku-yaz. 
        if takvim-anah = xrez-cik-tar go takvim-isle-exit. 
        if takvim-anah > xrez-cik-tar go takvim-isle-exit. 
          compute takvim-sat-oda(xrez-oda-konumu)   = 
                  takvim-sat-oda(xrez-oda-konumu)   + 1. 
          compute takvim-sat-buyuk(xrez-oda-konumu) = 
                  takvim-sat-buyuk(xrez-oda-konumu) + xrez-buyuk. 
          compute takvim-sat-kucuk(xrez-oda-konumu) = 
                  takvim-sat-kucuk(xrez-oda-konumu) + xrez-kucuk. 
          compute takvim-sat-free(xrez-oda-konumu)  = 
                  takvim-sat-free(xrez-oda-konumu)  + xrez-free. 
          compute takvim-sat-free(xrez-oda-konumu)  = 

                  takvim-sat-free(xrez-oda-konumu)  + xrez-bebek.
        rewrite takvim-rec invalid go takvim-oku-yaz. 
            go takvim-oku-yaz. 
 takvim-isle-exit. 
     exit. 
 takvim-sil. 
        if srez-k-g-b = "K" continue
        else 
           go takvim-sil-exit
        end-if. 
        move srez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-sil-exit. 
 takvim-oku-sil. 
        read takvim next no lock end go takvim-sil-exit. 
        if fs-takvim = 99 go takvim-oku-sil. 
        if takvim-anah = srez-cik-tar go takvim-sil-exit. 
        if takvim-anah > srez-cik-tar go takvim-sil-exit. 
          compute takvim-sat-oda(srez-oda-konumu)   = 
                  takvim-sat-oda(srez-oda-konumu)   - 1. 
          compute takvim-sat-buyuk(srez-oda-konumu) = 
                  takvim-sat-buyuk(srez-oda-konumu) - srez-buyuk. 
          compute takvim-sat-kucuk(srez-oda-konumu) = 
                  takvim-sat-kucuk(srez-oda-konumu) - srez-kucuk. 
          compute takvim-sat-free(srez-oda-konumu)  = 
                  takvim-sat-free(srez-oda-konumu)  - srez-free. 
          compute takvim-sat-free(srez-oda-konumu)  = 
                  takvim-sat-free(srez-oda-konumu)  - srez-bebek.
        rewrite takvim-rec invalid go takvim-oku-sil. 
            go takvim-oku-sil. 
takvim-sil-exit. 
     exit. 
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 
 kalis-bul. 
 kalis-start. 
      initialize takvim-rec kalis-kontrol. 
      move xrez-gir-tar   to takvim-anah. 
      start takvim key > takvim-anah invalid 
            go kalis-bul-bitti. 
 kalis-oku. 
      read takvim next no lock end go kalis-bul-bitti. 
      add 1 to kalis-kontrol. 
      if kalis-kontrol > kalis-gun go kalis-bul-bitti. 
      if kalis-kontrol = kalis-gun go kalis-bul-bitti. 
         go kalis-oku. 
 kalis-bul-bitti. 
       if kalis-kontrol not = kalis-gun 
          initialize mesaj-degiskenler
          move " [ Gun Yanlis ] " to mmesaj-title
          move "Kalis Gunu Kadar Tanimli Tarih Yok.." to mmesaj-1 
          move "Seciminizi Kontrol Ediniz.....!!!!!!" to mmesaj-2 
          move 1           to mmesaj-type
          move 3           to mmesaj-icon
          move 1           to mmesaj-default
               perform mmesaj-ver
       end-if.
          move takvim-anah   to xrez-cik-tar. 
          display accept-cik-gun
          display accept-cik-ay
          display accept-cik-yil.
 kalis-bul-exit. 
      exit. 
*
 rez-ara.
      initialize rez-cagir.
      move "I"   to rez-cagri-tipi
      call "/asya/ytl/obj/otel/rezara.asy" using rez-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/rezara.asy" 
       end-call.
       move rez-no-cagir  to xrez-no rez-no accept-rez-no.
       display accept-rezno.
 rez-ara-exit.
       exit.
*
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to xrez-acenta.

*
 acenta-oku.
       open input acenta.
       initialize acenta-rec.
       move xrez-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme
            
            not invalid 
            if firma-kodu  = spaces
            perform acen-dft-oku
           end-if
       end-read
        if  acenta-kontenjan not = spaces 
          move acenta-kontenjan to ac-kont
          else 
          move acenta-kodu to ac-kont
        end-if
       if acenta-master not = spaces 
          move acenta-master to ac-bilb
          else 
          move acenta-kodu to ac-bilb
        end-if
       close acenta.
       move acenta-adi     to adi-goster.
       modify lb-acenta-e, title = adi-goster.
       initialize adi-goster
       display accept-acenta.

 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.
*
 firma-ara.
      initialize firma-cagir.
      call "/asya/ytl/obj/otel/firmara.asy" using firma-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/firmara.asy" 
       end-call.
       move firma-cagir     to xrez-firma.

*
 firma-oku.
       open input firma acenta.
       initialize firma-rec.
       move xrez-firma   to firma-kodu
       read firma        no lock invalid 
            
            if firma-kodu = spaces

              
            
              if acenta-tipi = 3 
                 move 1        to gec-gecme
              end-if
          else
           move 1 to gec-gecme
         end-if
         not invalid
        
            perform firma-dft-oku
          
       end-read
       close firma acenta.
       move firma-adi     to adi-goster.
       modify lb-firma, title = adi-goster.
       initialize adi-goster
       display accept-firma.

 firma-oku-exit.
       exit.
 firma-ara-exit.
       exit.
*
*
 tacenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to tr-acenta.
       perform tacenta-oku.
*
 tacenta-oku.
       open input acenta.
       initialize acenta-rec.
       move tr-acenta   to acenta-kodu
       read acenta        no lock invalid 
           move "Tanimsiz Acenta " to t-adi-goster
           not invalid
           move acenta-adi to  t-adi-goster 
       end-read
       
       close acenta.
      
       display A2 A3.

*
 takvim-oku.
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.
 takvim-oku-exit.
       exit.
*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to xrez-banka.
 banka-oku.
       
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-banka-sabit = 1 and 
          acen-dft-banka not = xrez-banka
          display message box "Acenta icin sabit banka degeri girilmis" new-line
                              "Banka varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-banka to xrez-banka
        end-if.
       open input banka.
       initialize banka-rec.
       move xrez-banka    to banka-kodu
       read banka        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to adi-goster.
       modify lb-banka-e, title = adi-goster.
       initialize adi-goster
       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-doviz.
 doviz-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-doviz-sabit = 1 and 
          acen-dft-doviz not = xrez-doviz
          display message box "Acenta icin sabit doviz degeri girilmis " new-line
                              "Doviz varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-doviz to xrez-doviz
        end-if.
 
 
       open input doviz.
       initialize doviz-rec.
       move xrez-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-doviz-e, title = adi-goster.


       initialize adi-goster
       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.
       exit.
*
 ondoviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-on-doviz.
 ondoviz-oku.
       if xrez-on-doviz = 0 or xrez-on-doviz = spaces
          go ondoviz-oku-exit
       end-if.
       open input doviz.
       initialize doviz-rec.
       move xrez-on-doviz to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-ondoviz-e, title = adi-goster.
       initialize adi-goster
       display accept-ondoviz.
 ondoviz-oku-exit.
       exit.
 ondoviz-ara-exit.
       exit.
*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to xrez-pan-tipi.
 pansiyon-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pansiyon-sabit = 1 and 
          acen-dft-pan-tipi not = xrez-pan-tipi
          display message box "Acenta icin sabit pansiyon degeri girilmis" new-line
                              "Pansiyon varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pan-tipi to xrez-pan-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xrez-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pansiyon-e, title = adi-goster.
       initialize adi-goster
       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odemeara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-odeme-tipi.
 odeme-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-odeme-sabit = 1 and 
          acen-dft-odeme-tipi not = xrez-odeme-tipi
          display message box "Acenta icin sabit odeme degeri girilmis" new-line
                              "odeme varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-odeme-tipi to xrez-odeme-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-odeme-e, title = adi-goster.
       initialize adi-goster
       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy" 
       end-call.
       move infox-kodu-cagir     to xrez-anlasma.
 anlasma-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-anlasma-sabit = 1 and 
          acen-dft-anlasma not = xrez-anlasma
          display message box "Acenta icin sabit anlasma degeri girilmis" new-line
                              "Anlasma varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-anlasma to xrez-anlasma
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi.
       move xrez-anlasma       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-anlasma-e, title = adi-goster.
       initialize adi-goster
       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/pazarara.asy" 
       end-call.
       move pazar-kodu-cagir     to xrez-pazar.
 pazar-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pazar-sabit = 1 and 
          acen-dft-pazar not = xrez-pazar
          display message box "Acenta icin sabit pazar degeri girilmis" new-line
                              "Pazar varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pazar to xrez-pazar
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move xrez-pazar         to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pazar-e, title = adi-goster.
       initialize adi-goster
       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ulkeara.asy" 
       end-call.
       move ulke-cagir     to xrez-ulke.
 ulke-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-ulke-sabit = 1 and 
          acen-dft-ulke not = xrez-ulke 
          display message box "Acenta icin sabit ULKE  degeri girilmis" new-line
                              "ULKE  varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-ulke  to xrez-ulke 
        end-if.
       open input ulke.
       initialize ulke-rec.
       move xrez-ulke    to ulke-anah1
       read ulke         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close ulke.
       move ulke-adi     to adi-goster.
       modify lb-ulke-e, title = adi-goster.
       initialize adi-goster
       display accept-ulke.
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.
*
 oda-ara.
       exit  .
 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move xrez-odano     to odalar-anah
       read odalar         no lock invalid 
            move 1         to gec-gecme
            not invalid continue 
       end-read
       close odalar.
       display accept-odano.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.
*
 tab-1-Ev-Cmd-Tabchanged.
    inquire tab-1 value in form1-ta-1-value
    move 0 to tab-s-1-visible tab-s-2-visible tab-s-3-visible tab-s-4-visible 
               p1-vis
    display tab-s-1 
    display tab-s-2 
    display tab-s-3
    display tab-s-4
    display  gd2
    if form1-ta-1-value = 1
       move 1 to tab-s-1-visible 
       display tab-s-1 
    end-if 
    if form1-ta-1-value = 2
       move 1 to tab-s-2-visible
       display tab-s-2
    end-if 
    if form1-ta-1-value = 4
       move 1 to tab-s-4-visible p1-vis
       display tab-s-4 gd2
       move 4 to accept-control
       move 48 to control-id

    end-if 
    
    if form1-ta-1-value = 3
*       if xrez-on-doviz not = 0 or xrez-on-doviz not = spaces
          perform toplam-odeme-bul thru  toplam-odeme-bul-exit
*       end-if
       move 1 to tab-s-3-visible
       display tab-s-3
    end-if 
    move event-action-ignore to event-action.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

     .
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form1-Aft-Routine.
     close rez takvim.
     .
*
 gun-bul.
     initialize gun-s
     move Xrez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= Xrez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      
                      end-if 
                end-read
             end-perform  
     end-start.
     move gun-s to gun-say
     display la-gun
      .
*
 aksiyon-toplam-bul.
        initialize aksiyonlu-toplam
        move xrez-gir-tar to takvim-anah
        start takvim key not < takvim-anah 
           invalid 
              display message box "Takvim Bulunamadi"
            not invalid 
                perform varying i from 1 by 1 until i > aksiyhrk-ode
                 read takvim next no lock
                    end 
                       exit perform
                   not end 
                     perform gunluk-bul
                     add oda-fiyati to aksiyonlu-toplam
                  end-read  
                 end-perform
         end-start.
          .
*
 gunluk-bul.
        move 0 to oda-fiyati. 
        move xrez-acenta        to fiyat-acenta. 
        move takvim-anah        to fiyat-tarih. 
        move xrez-tipi          to fiyat-rez-tipi. 
        move xrez-pan-tipi      to fiyat-pan-tipi. 
        move xrez-banka         to fiyat-banka. 
        move xrez-doviz         to fiyat-doviz. 
        move xrez-anlasma       to fiyat-anlasma. 
        move xrez-buyuk         to fiyat-buyuk.
        move xrez-kucuk         to fiyat-kucuk.
        read fiyat no lock invalid 
         
        exit paragraph.
             move fiyat-acenta    to fiyatana-acenta. 
             move fiyat-bas-tarih to fiyatana-ilk-tarih.
             move fiyat-bit-tarih to fiyatana-son-tarih.
             move fiyat-rez-tipi  to fiyatana-rez-tipi. 
             move fiyat-pan-tipi  to fiyatana-pan-tipi. 
             move fiyat-banka     to fiyatana-banka. 
             move fiyat-doviz     to fiyatana-doviz. 
             move fiyat-anlasma   to fiyatana-anlasma. 
             move fiyat-buyuk     to fiyatana-buyuk.
             move fiyat-kucuk     to fiyatana-kucuk.
             read fiyatana no lock invalid 
             exit paragraph .

       move fiyatana-oda-fiyati(xrez-fiyat-konumu) to oda-fiyati. 
*/********* 
       if xrez-nor-indirim not = 0 
       compute oda-fiyati rounded = 
              (((oda-fiyati * xrez-nor-indirim) / 100) - oda-fiyati)
       end-if.
*/Early booking orani var ve early booking uygulanacak ise 
       if xrez-eb = "E" and fiyatana-eb-oran not = 0 
       compute oda-fiyati rounded = 
              (((oda-fiyati * (fiyatana-eb-oran +( fiyatana-eb-kusur / 100) )) / 100) - oda-fiyati)
       end-if. 
*/Kick back orani
       if  fiyatana-ug-oran not = 0 and gun-s > fiyatana-ug-geceleme  
           and xrez-ug-ind =1 then
       compute oda-fiyati rounded = 
              (((oda-fiyati * fiyatana-ug-oran) / 100) - oda-fiyati)
       end-if. 
       if xrez-ozel-durum-car > 0
       compute oda-fiyati rounded = 
              (oda-fiyati * xrez-ozel-durum-car) / 100
       end-if.
       if fiyatana-kick-back <> 0
       compute oda-fiyati  rounded = 
              (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
       end-if.
       if fiyatana-kick-back2 <> 0
       compute oda-fiyati  rounded = 
              (((oda-fiyati * fiyatana-kick-back2) / 1000) - oda-fiyati)
       end-if.
      .
*
 kont-goster.
       perform acu-form4-routine
       add 1 to sonraki-id
             move sonraki-id to control-id

       move 4 to accept-control
       .
*
 Form4-Aft-Initdata.

*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

      if cogalt-adet > 0 then 
         move cogalt-adet  to ek
       else
       if rez-yeni-eski = "Y"
          move 1 to ek
           else 
          move 0 to ek
       end-if
       end-if
       initialize gr-kayit     v-release
       open input acenhrk bilbord 
       move " Tarih "  to gd-1-col-1
       move "Kont"     to gd-1-col-2
       move "Gerc"     to gd-1-col-3

       move "Kont"     to gd-1-col-4
       move "Gerc"     to gd-1-col-5

       move "Kont"     to gd-1-col-6
       move "Gerc"     to gd-1-col-7

       move "Kont"     to gd-1-col-8
       move "Gerc"     to gd-1-col-9

       move "Haz."     to gd-1-col-10
       move "Sat."     to gd-1-col-11

       move "Haz."     to gd-1-col-12
       move "Sat."     to gd-1-col-13
       move "Ver."     to gd-1-col-14
       move "Sat."     to gd-1-col-15
       open input konum
       move xrez-fiyat-konumu to konum-anahtar
       read konum no lock invalid move all "*" to konum-adi
       end-read
      
       move konum-adi(1:5)    to l-tip(1:5)
       move konum-adi(1:5) to l-odatop(1:5)
       move xrez-oda-konumu to konum-anahtar
       read konum no lock invalid move all "*" to konum-adi

       end-read
        close konum
       move konum-adi(1:9) to l-otelkon
       evaluate xrez-s-d-t-g
          when 1
             move "Sng" to l-tip(7:3)
             move "Single" to l-tiptop(1:5)
          when 2
             move "Dbl" to l-tip(7:3)
             move "Double" to l-tiptop(1:5)
          when 3
             move "Trp" to l-tip(7:3)
             move "Triple" to l-tiptop(1:5)
          when 4
             move "Grp" to l-tip(7:3)
             move "Group " to l-tiptop(1:5)
       end-evaluate
       move acenta-adi to l-acen(1:10)
       display l-1 l-2 l-3 l-4 l-5 l-6 l-01
       modify gd-1 record-to-add = gd-data
       add 1 to gr-kayit
       move xrez-gir-tar to takvim-anah
       start takvim key >= takvim-anah  
          invalid 
            display message box "Takvim Hatasi 4367"
          not invalid
          perform until fs-takvim = "10" 
             read takvim next 
              end 
                display message box "Takvim Hatasi 4367" 
                move "10" to fs-takvim 
              not end
                if takvim-anah >= xrez-cik-tar then 
                   move "10" to fs-takvim
                 else
                   move takvim-gun to  egun
                   move takvim-ay  to  eay
                   move takvim-yil to  eyil
                   move etarih   to gd-1-col-1
                   initialize kirmizi
                   move takvim-anah to  acenhrk-tarih bilbord-tarih
************************* acenta okunmas yaplabilir                   
                   
**************    move xrez-acenta  to acenhrk-acenta bilbord-acenta
                   move ac-bilb to bilbord-acenta
                   move ac-kont to acenhrk-acenta
                   move rezpara-kont-tipi to acenhrk-s-d-t-g 
                   if rezpara-kont-tipi = 0 
             
                     move xrez-s-d-t-g   to acenhrk-s-d-t-g
                   end-if 
                   move xrez-fiyat-konumu to acenhrk-oda-konumu bilbord-oda-tip
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-2
                    add ek to   acenhrk-sat-oda 
                   move acenhrk-sat-oda to 4-z 
                   move 4-z to gd-1-col-3
                   if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(3:1)
                    end-if 
                  

                   move 5 to acenhrk-s-d-t-g
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-4
                   add ek to   acenhrk-sat-oda 
                  
                   move acenhrk-sat-oda to 4-z 
                   move 4-z to gd-1-col-5
                    if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(5:1)
                    end-if
                   
                   move xrez-s-d-t-g   to acenhrk-s-d-t-g
                   move 41 to  acenhrk-oda-konumu
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-6
                    add ek to   acenhrk-sat-oda 
                    
                   move acenhrk-sat-oda to 4-z 
                   move 4-z     to gd-1-col-7
                     if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(7:1)
                    end-if

                   move 41 to  acenhrk-oda-konumu   
                   move 5  to acenhrk-s-d-t-g
                   read acenhrk no lock invalid
                       initialize acenhrk-kontrat-oda acenhrk-sat-oda
                   end-read
                   if acenhrk-kontrat-oda > 999 then 
                       move all spaces to 4-z9
                    else
                      move acenhrk-kontrat-oda to 4-z9 
                   end-if 
                   move 4-z9 to gd-1-col-8
                     add ek to   acenhrk-sat-oda 
                    
                   move acenhrk-sat-oda to 4-z 
                   move 4-z     to gd-1-col-9

                     if acenhrk-kontrat-oda < acenhrk-sat-oda
                       move "E" to kirmizi(9:1)
                    end-if
                     move konum-hazir-oda to 4-z 
                   move 4-z     to gd-1-col-10
          
                   initialize top-satilan
                  
                    compute top-satilan = top-satilan + 
                         takvim-sat-oda(xrez-oda-konumu)
                 
                   add ek to top-satilan
                   move top-satilan to 4-z 
                   move 4-z to gd-1-col-11  
                   if   top-satilan > konum-hazir-oda
                       move "E" to kirmizi(11:1)
                   end-if
                   
                   move takvim-hazir-oda to 4-z 
                   move 4-z     to gd-1-col-12
                      
                   initialize top-satilan
                  
                   perform varying j from 1 by 1 until j > 40
                    compute top-satilan = top-satilan + 
                          takvim-sat-oda(j)



                   end-perform     
                   add ek to top-satilan
                   move top-satilan to 4-z 
                   if   top-satilan > takvim-hazir-oda
                       move "E" to kirmizi(13:1)
                   end-if   
                  
                   move 4-z to gd-1-col-13
                   initialize   gd-1-col-14 gd-1-col-15
                    read bilbord no lock 
                       invalid
                        initialize bilbord-oda bilbord-sat-oda bilbord-rson-tarih
                        not invalid

                         move bilbord-oda to 4-z 
                         move 4-z to gd-1-col-14
                         if xrez-bilbord-eh  = "E" then 
                            add ek to bilbord-sat-oda
                         end-if
                         move bilbord-sat-oda to 4-z 
                         move 4-z to gd-1-col-15
                          if bilbord-sat-oda > bilbord-oda
                             move "E" to kirmizi(15:1)
                          end-if  
                         move 1 to bilbord-oda-tip
                          read bilbord no lock
                             invalid
                               initialize bilbord-rson-tarih 
                            end-read


                          if bilbord-rson-tarih < tarih-tasi and 
                             bilbord-rson-tarih > "20000000" then 
                             move 1 to v-release
                         end-if
                    end-read
                end-if
             end-read
             if fs-takvim not = "10" then 
                 modify gd-1 record-to-add = gd-data  
                 add 1 to gr-kayit
                 perform varying mm from 1 by 1 until mm > 15
                  if kirmizi( mm : 1 ) = "E" then 
                    modify gd-1(gr-kayit, mm),
                      cell-color = 141
                   end-if
                  end-perform
             end-if
          end-perform 
       end-start
          display l-release
        close acenhrk bilbord
     .
*******************************************************************
************ mesaj receiving olayi *******************************
 form-update.
       display form1
       move 0   to p1-vis
       display gd2
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

       if xrez-no > 0 then
           move 1 to link-nereden 
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move xrez-anah to link-NOT-DOS-ANAH   
           move 1 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
             display not-ac
             move xrez-acen-anah to son-not-d
         end-if
       .
*
*
 firma-dft-oku.
      open input nt
     initialize not-rec 
     move "FIR" to not-dos
     move "Default" to not-dos-anah.
     move firma-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 firma-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
       if acen-dft-early= 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if
       modify eraly-booking-cb, value = acen-dft-early
       modify fix-fiyat-cb, value = acen-dft-fix
       modify aksiyon-cb, value = acen-dft-aksiyon-yok
       modify bilbord-cb, value = acen-dft-bilboard 
       modify special-cb, value = acen-dft-special-yok
       perform eraly-booking-cb-Ex-Cmd-Clicked
       perform fix-fiyat-cb-Ex-Cmd-Clicked
       perform bilbord-cb-Ex-Cmd-Clicked
       perform special-cb-Ex-Cmd-Clicked

       perform aksiyon-cb-Ex-Cmd-Clicked
          
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke    
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
      .
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
       if acen-dft-early= 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if
       modify eraly-booking-cb, value = acen-dft-early
       modify fix-fiyat-cb, value = acen-dft-fix
       modify aksiyon-cb, value = acen-dft-aksiyon-yok
       modify bilbord-cb, value = acen-dft-bilboard 
       modify special-cb, value = acen-dft-special-yok
       perform eraly-booking-cb-Ex-Cmd-Clicked
       perform fix-fiyat-cb-Ex-Cmd-Clicked
       perform bilbord-cb-Ex-Cmd-Clicked
       perform special-cb-Ex-Cmd-Clicked

       perform aksiyon-cb-Ex-Cmd-Clicked
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke   Form1-Pb-4  
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
      .
 kontrat-kontrol. 
            move "V" to kontrat-var-yok. 
         if xrez-tipi = 1 continue
            else go kontrat-kontrol-exit
         end-if.
         open input acenhrk. 
 kontrat-basla. 
          initialize acenhrk-rec. 
            move ac-kont to acenhrk-acenta
*****          move xrez-acenta  to acenhrk-acenta. 
          move xrez-gir-tar to acenhrk-tarih. 
          start acenhrk key not < acenhrk-anah invalid 
                go kontrat-yok. 
 kontrat-oku. 
         read acenhrk  next no lock end 
              go kontrat-yok. 
         if fs-acenhrk   = 99 go kontrat-oku. 
***         if acenhrk-acenta  = xrez-acenta continue
           if acenhrk-acenta  = ac-kont  continue
         else 
            go kontrat-yok. 
         if acenhrk-tarih not > xrez-gir-tar continue
         else 
            go kontrat-yok. 
         if acenhrk-kontrat-oda = 0 go kontrat-oku. 
            close acenhrk. 
            go kontrat-kontrol-exit. 
 kontrat-yok. 
            move "Y" to kontrat-var-yok. 
            close acenhrk. 
            initialize mesaj-degiskenler
            move " [ Kontrat Uyari] " to mmesaj-title
            move " Bu Acentanin Bu Tarihlerde Kontrati YOK.... "  to mmesaj-1
            move " Rezervasyon Tipini Degistirin.............. "  to mmesaj-2
            move 1           to mmesaj-type
            move 3           to mmesaj-icon
            move 1           to mmesaj-default
            perform mmesaj-ver.
 kontrat-kontrol-exit. 
           exit. 
*
*
 Screen1-Pb-1-Link.
         set exit-pushed to true
     .

*
 op-ara.
    initialize pazar-cagir.
    move "O"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/opara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/opara.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-operator
    perform op-goster
    .
*
 vip-ara.
    initialize infox-cagir
    move "v"   to infox-tipi-cagir
    call "/asya/ytl/obj/otel/vipara.asy" using infox-cagir
       on exception perform callerr-proc
          not on exception
    cancel "/asya/ytl/obj/otel/vipara.asy" 
    end-call
    move infox-kodu-cagir     to xrez-vip
    perform vip-goster.
* 
 vip-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "v" to kodlar02-tipi
    move xrez-vip to kodlar02-kodu
    read kodlar02 no lock invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to lb-vip-adi
    display acc-viptipi lb-vip
    close kodlar02.

    .
*
 rehber-ara.
    initialize pazar-cagir.
    move "O"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/rehara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/rehara.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-rehber
    perform rehber-goster.
* 
 rehber-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "R" to kodlar02-tipi
    move xrez-rehber to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to reh-goster-val
    display acc-rehber lb-rehber
    close kodlar02.

* 
 op-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "O" to kodlar02-tipi
    move xrez-operator to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to op-goster
    display acc-op lb-op
    close kodlar02.

*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move xrez-kaynak-1 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak1-tipi-goster
    display acc-kaynak1 lb-kaynak1
    close onbkodlar10.

 kaynak2-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AC" to onbkodlar10-tipi
    move xrez-kaynak-2 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak2-tipi-goster
    display acc-kaynak2 lb-kaynak2
    close onbkodlar10.

 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AD" to onbkodlar10-tipi
    move xrez-kaynak-3 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak3-tipi-goster
    display acc-kaynak3 lb-kaynak3
    close onbkodlar10.

*
 kaynak1-ara.
    initialize kaynak-cagir.
    move "AB"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk1ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk1ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-1
    perform kaynak1-goster
    .

 kaynak2-ara.
    initialize kaynak-cagir.
    move "AC"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk2ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk2ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-2
    perform kaynak2-goster
    .
 kaynak3-ara.
    initialize kaynak-cagir.
    move "AD"   to kaynak-tipi-cagir.
    call "/asya/ytl/obj/otel/kynk3ara.asy"
      using kaynak-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/kynk3ara.asy" 
    end-call
    move kaynak-kodu-cagir     to xrez-kaynak-3
    perform kaynak3-goster
    .


*
 odatipi-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "G" to kodlar02-tipi
    move xrez-oda-tipi to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster
    display acc-odatip lb-odatip
    close kodlar02.

 odatipi-goster2.
    open input kodlar02
    initialize kodlar02-rec
    move "H" to kodlar02-tipi
    move xrez-oda-tipi2 to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster2
    display acc-odatip2 lb-odatip2
    close kodlar02.

 odatipi-goster3.
    open input kodlar02
    initialize kodlar02-rec
    move "I" to kodlar02-tipi
    move xrez-oda-tipi3 to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster3
    display acc-odatip3 lb-odatip3
    close kodlar02.
    .
*
 odatipi-ara.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-oda-tipi
    perform odatipi-goster
    .

 odatipi-ara2.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara2.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara2.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-oda-tipi2
    perform odatipi-goster2.
    .
 odatipi-ara3.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara3.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara3.asy" 
    end-call
    move pazar-kodu-cagir     to xrez-oda-tipi3
    perform odatipi-goster3.
    .
*
 ozel-after.
      open input kodlar02.
       initialize kodlar02-rec.
       move "Z"                to kodlar02-tipi.
       move xrez-ozel-durum    to kodlar02-kodu
       read kodlar02         no lock invalid 
            continue
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to ozel-adi-goster.
       modify lb-anlasma-ea,   title = ozel-adi-goster.
       move kodlar02-sayisal   to xrez-ozel-durum-car
       move kodlar02-ozl-tipi  to xREZ-ozel-tip 
       display accept-anlasma.
     .
*
 ozel-ara.
      initialize odeme-cagir.
      move "Z"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/ozelara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ozelara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-ozel-durum.
       display accept-anlasmaa.
*
 oda-ara2.
      initialize blok-cagir
      move "M" to oda-db-cagir
      move xrez-oda-konumu   to oda-konum-cagir.
      move xrez-gir-tar to    blok-bas-tar
      move xrez-cik-tar to    blok-bit-tar
      move xrez-no     to  blok-rez-no
      call "/asya/ytl/obj/otel/odaara2.asy" 
            using oda-cagir, blok-bas-tar, 
                  blok-bit-tar, blok-rez-no
           on exception perform callerr-proc
       not on exception
      cancel "/asya/ytl/obj/otel/odaara2.asy" 
      end-call.
      move odano-cagir     to xrez-odano
      display accept-odano
      initialize blok-cagir.
*
 blok-kont2.
     if xrez-share = 1 then exit paragraph end-if 
     perform oda-oku thru oda-oku-exit
            if gecmez
               exit paragraph
            end-if 
            
               if rezpara-blokaj-farkli = "H" and 
                  xrez-oda-konumu not = odalar-konumu 
                  perform blokaj-konum-farkli thru blokaj-konum-farkli-exit 
                  move 1 to gec-gecme
                  exit paragraph
                  else
                  if odalar-anah not = spaces or odalar-anah not = zeroes then 
                  move odalar-konumu to xrez-oda-konumu oda-konumu-combo-value
                  display oda-konumu-combo
                  end-if
               end-if
               initialize blok-cagir 
               move xrez-gir-tar    to blok-bas-tar 
               move xrez-cik-tar    to blok-bit-tar 
               move xrez-no         to blok-rez-no 
               move xrez-odano      to blok-oda 
               call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokara.asy" 
               end-call
               if rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H" 
                  initialize xrez-odano
                  display accept-odano
                  move 1 to gec-gecme
                  exit paragraph
               end-if
                     .
*
 grara.
      initialize  grtumrez-rec onb-hata   grsayi
      open  input grtumrez
      if onb-hata = 1
         display message box "Repeat Guest listesi alinamadi" new-line 
                              "Bakim Menusunden Forecastlari yeniden olustura girip" new-line
                              "GR olustur butonunu tiklayiniz" new-line
            exit paragraph                      
      end-if
      move  aranacak-adi to grtumrez-adi
      move aranacak-soyadi to grtumrez-soyadi
        start grtumrez key not < grtumrez-soyad
         invalid continue
         not invalid
           perform until fs-grtumrez = "10"
             read grtumrez next no lock
                end move "10" to fs-grtumrez
                not end
                  if xrez-no  = grtumrez-no
                     exit perform cycle
                  end-if
                  if aranacak-soyadi not = grtumrez-soyadi
                     move "10" to fs-grtumrez
                     exit perform cycle
                  end-if
                  if rezpara-eskimus-soyad   =  1  or 
                      ( aranacak-adi =  grtumrez-adi )

                    move 1 to grsayi

                    move "10" to fs-grtumrez
                  end-if
             end-read
           end-perform 
       end-start
       close grtumrez .
       if grsayi > 0 then 
           
           MOVE CONTROL-ID TO SONRAKI-ID
           perform acu-grform-routine
           EVALUATE SONRAKI-ID
              WHEN 49
                MOVE 53 TO SONRAKI-ID
              WHEN 63
               MOVE 60 TO SONRAKI-ID
              WHEN 66
               MOVE 67 TO SONRAKI-ID
              WHEN 76
                  MOVE 79 TO SONRAKI-ID

              WHEN OTHER
              ADD 1 TO SONRAKI-ID
           END-EVALUATE
           MOVE SONRAKI-ID TO CONTROL-ID
             MOVE 4 TO ACCEPT-CONTROL
              
       end-if
       
     .
*
 grform-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

       if rezpara-eskimus-soyad not = 1
       move 0   to sadece-soyad
       else 
       move 1   to sadece-soyad
       end-if
       display grform-Cb-2
       perform gr-bul
       .
*
 gr-bul.
    
       initialize fs-grtumrez fs-grrez
       move EKRAN-FIS-1 to takasgr-dno.
       open output takasgr. close takasgr open i-o takasgr. 
       open input grtumrez
       initialize grtumrez-rec grsayi
       if aranacak-soyadi not = spaces
           move aranacak-soyadi to grtumrez-soyadi  
         start grtumrez key >= grtumrez-soyad 
          invalid continue
          not invalid
          perform until fs-grtumrez= "10" or grsayi > 30
            read grtumrez next no lock 
              end move "10" to fs-grtumrez
              not end 
                if aranacak-soyadi not = grtumrez-soyadi
                  move "10" to fs-grtumrez


                  else
                   if grtumrez-NO = xrez-no then 
                     exit perform cycle
                   end-if
                   if sadece-soyad = 0 and 
                   aranacak-adi(1:15) not = grtumrez-adi(1:15)
                   exit perform cycle
                   end-if
                   if gircik-gosterme = 1 and 
                      aranacak-adi(1:15)  = grtumrez-adi(1:15) and
                      (xrez-gir-tar = grtumrez-cik-tar or
                       xrez-cik-tar = grtumrez-gir-tar) 
                      exit perform cycle
                   end-if
                   if gircik-gosterme = 1 and 
                      takasgr-adi(1:15)  = grtumrez-adi(1:15) and
                      (takasgr-gir-tar = grtumrez-cik-tar or
                       takasgr-cik-tar = grtumrez-gir-tar) 
                      exit perform cycle
                   end-if
                    move grtumrez-rec to takasgr-rec
                    initialize takasgr-sira
                    write takasgr-rec invalid continue
                    not invalid
                      add  1 to grsayi
                    end-write
                    
                end-if 
            end-read    
          end-perform 
       end-start
       end-if
*       if soy2 not = spaces and grsayi < 30

*        initialize grtumrez-rec
*       move soy2 to grtumrez-soyadi  
*       start grtumrez key > grtumrez-soyad 
*          invalid continue
*          not invalid
*          perform until fs-grtumrez= "10" or grsayi > 30
*            read grtumrez next no lock 
*              end move "10" to fs-grtumrez
*              not end 
*                if soy2(1:15) not = grtumrez-soyadi(1:15)
*                  move "10" to fs-grtumrez
*                  else
*                   if sadece-soyad = 0 and 
*                   adi2(1:15) not = grtumrez-adi(1:15)
*                   exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      adi2(1:15)  = grtumrez-adi(1:15) and
*                      (xrez-gir-tar = grtumrez-cik-tar or
*                       xrez-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      takasgr-adi(1:15)  = grtumrez-adi(1:15) and
*                      (takasgr-gir-tar = grtumrez-cik-tar or
*                       takasgr-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                    move grtumrez-rec to takasgr-rec
*                    initialize takasgr-sira
*                    write takasgr-rec invalid continue
*                    not invalid
*                      add  1 to grsayi
*                    end-write
*                end-if 
*            end-read    
*          end-perform 
*       end-start
*       end-if
*        if soy3 not = spaces and grsayi < 30
*
*        initialize grtumrez-rec
*      move soy3 to grtumrez-soyadi  
*       start grtumrez key > grtumrez-soyad 
*          invalid continue
*          not invalid
*          perform until fs-grtumrez= "10" or grsayi > 30
*            read grtumrez next no lock 
*              end move "10" to fs-grtumrez
*              not end 
*                if soy3(1:15) not = grtumrez-soyadi(1:15)
*                  move "10" to fs-grtumrez
*                  else
*                   if sadece-soyad = 0 and 
*                       adi3(1:15) not = grtumrez-adi(1:15)
*                   exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      adi3(1:15)  = grtumrez-adi(1:15) and
*                      (xrez-gir-tar = grtumrez-cik-tar or
*                       xrez-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                   if gircik-gosterme = 1 and 
*                      takasgr-adi(1:15)  = grtumrez-adi(1:15) and
*                      (takasgr-gir-tar = grtumrez-cik-tar or
*                       takasgr-cik-tar = grtumrez-gir-tar) 
*                      exit perform cycle
*                   end-if
*                    move grtumrez-rec to takasgr-rec
*                    initialize takasgr-sira
*                    write takasgr-rec invalid continue
*                    not invalid
*                      add  1 to grsayi
*                    end-write
*                end-if 
*            end-read    
*          end-perform 
*       end-start
*       end-if
       modify  grform-Gd-1 reset-grid = 1 mass-update = 1
            move "SIRKET"        to   gr-klasor
            move "ADI"           to   gr-adi
            move "SOYADI"        to   gr-soy
            move "Giris Tar"     to   gr-giris-tar
            move "Cikis Tar"     to   gr-cikis-tar
            move "Dogum Tar"     to   gr-dogum-tar
            move "ODA"           to   gr-odano
          close grtumrez
       modify  grform-Gd-1 record-to-add  grform-Gd-1-Record
         initialize takasgr-rec  fs-takasgr
         start takasgr key > takasgr-soyad
          invalid 
           continue
          not invalid
          perform until fs-takasgr = "10"
           read takasgr next no lock 
            end move "10" to fs-takasgr 
            not end

            move takasgr-sirket  to gr-klasor
            move takasgr-adi     to gr-adi
            move takasgr-soyadi     to gr-soy

            move takasgr-gir-gun to egun
            move takasgr-gir-ay  to eay
            move takasgr-gir-yil to eyil

            move etarih     to gr-giris-tar
            
            move takasgr-cik-gun to egun
            move takasgr-cik-ay  to eay
            move takasgr-cik-yil to eyil

            move etarih     to gr-cikis-tar
            
          
           move takasgr-dog-gun to egun
           move takasgr-dog-ay  to eay
            move takasgr-dog-yil to eyil
            move takasgr-odano   to gr-odano

            move etarih     to gr-dogum-tar
            modify  grform-Gd-1 record-to-add  grform-Gd-1-Record
           end-read
         end-perform
       end-start
         modify  grform-Gd-1  mass-update = 0

        close takasgr.



     .
 rez-soz-bas. 
      call "/asya/ytl/obj/otel/rezsoz.asy" using xrez-no
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/rezsoz.asy" 
       end-call.

     .
*
 grform-Ex-Other.
      if key-status = 5 then
          perform gr-bul
      end-if
     .
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 fsil-Cm-1-Ev-Ntf-Selchange.
         move 1 to tacenta-vis
         display a1 a2 a3.

     .
*
 fsil-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

     move xrez-acenta to tr-acenta
     display a2
     perform tacenta-oku
     modify fsil-Cm-1 mass-update = 1 reset-list = 1 .
       move "--------- Transfer Yok            " to tr-ekle 
       modify fsil-Cm-1 item-to-add tr-ekle
     OPEN input grup isyeri
     initialize grup-rec
     MOVE "S" TO GRUP-TIPI
     MOVE GENEL-sirket-grup TO GRUP-KODU
      start grup key > grup-anah
        invalid continue
        not invalid 
         perform until fs-grup = "10" 
            read grup next no lock
              end move "10" to fs-grup
              not end 
                if   "S" = GRUP-TIPI
                  and GENEL-sirket-grup = GRUP-KODU
                    move grup-alt(1:2) to isyeri-no
                    read isyeri no lock invalid
                     move "Silinmis Sirket " to isyeri-unvan
                    end-read
                    if isyeri-adres not = isyeri-adres-tasi
                    move ISYERI-ADRES to tr-ekle(1:8) 
                    move "-" to tr-ekle(9:1)
                    move isyeri-unvan to tr-ekle(10:20) 
                   modify fsil-Cm-1 item-to-add tr-ekle
                   end-if
                  else
                   move "10" to fs-grup
               end-if
          end-read
       end-perform
     end-start
     modify fsil-Cm-1 mass-update = 0
     move "--------" to tr-sec
     display fsil-cm-1
       close grup isyeri
      modify fsil-Cm-2 reset-list = 1  mass-update = 1
   
      modify fsil-Cm-2 item-to-add "01-Mukerrer    "
      modify fsil-Cm-2 item-to-add "02-Rakip Otel    "
      modify fsil-Cm-2 item-to-add "03-Force Major    "
      modify fsil-Cm-2 item-to-add "04-Dusuk Fiyat  "
      modify fsil-Cm-2 item-to-add "05-Yapim Onarim    "
      modify fsil-Cm-2 item-to-add "06-Tur Iptali   "
      modify fsil-Cm-2 item-to-add "07-Toplanti Iptali   "
      modify fsil-Cm-2 item-to-add "08-Lokasyon     "
      modify fsil-Cm-2 item-to-add "09-Acenta Iptali    "
      modify fsil-Cm-2 item-to-add "10-Teror    "
      modify fsil-Cm-2 item-to-add "11-Hava Durumu    "
      modify fsil-Cm-2 item-to-add "12-Opsiyon Suresi  "
       mass-update = 0
      move 09 to sil-sebeb
      display fsil-Cm-2
       modify fsil-Cm-2 
       mass-update = 0
     .
*
 grup-after.
     if  xrez-grup-no not = spaces
     open i-o rezgrup 
     initialize rezgrup-rec
     move xrez-grup-no to  rezgrup-kodu
     read rezgrup no lock 
        invalid continue
     end-read
     if xrez-grup-adi = spaces then
       move rezgrup-adi to xrez-grup-adi
     end-if
     display  accept-grup-adi
      close rezgrup
     end-if
     .
*
 grupadi--after.
     if xrez-grup-adi not = spaces
     open i-o rezgrup 
     initialize rezgrup-rec
     move xrez-grup-no to  rezgrup-kodu
     read rezgrup no lock 
        invalid continue
     end-read
     if xrez-grup-adi not = spaces then
       move xrez-grup-adi  to rezgrup-adi 
       write rezgrup-rec invalid rewrite rezgrup-rec end-write
     end-if
     close rezgrup
      end-if.
     
     .
*
 Form2-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
     
     .
*
 Form3-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.

     
     .
*
 a-fiy-Ex-Ntf-Changed.
     inquire a-fiy value in v-fiy
  
     initialize nume nume2 ara-konum 
     move 1 to kyer
      move v-fiy(1:1) to nume
     if nume  is numeric then 
        move function numval(v-fiy (1:2)) to nume2
        if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2                to fiyat-konumu-combo-value(1:2)
                  move "->"                 to fiyat-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to fiyat-konumu-combo-value(5:)
        
        display fiyat-konumu-combo
        move fiyat-konumu-combo-value(1:2) to xrez-fiyat-konumu
        end-if
        else 

              move 0 to kyer
              inspect v-fiy tallying kyer for all space
              compute kyer = function length(v-fiy) - kyer
          perform varying k from 1 by 1 until k > 40
              if v-fiy(1:kyer) = xkonum-adi(k)(1:kyer) then 
                move k to nume2
                if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2         to      fiyat-konumu-combo-value(1:2)
                  move "->"                 to  fiyat-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to fiyat-konumu-combo-value(5:)
        
                     display fiyat-konumu-combo
                     move fiyat-konumu-combo-value(1:2) to xrez-fiyat-konumu
                end-if

                
                  
                 exit perform 
              end-if
          end-perform 
     end-if
     .
*
 fiyat-konumu-combo-Ex-Ntf-Selchange.
      inquire fiyat-konumu-combo, 
                value in buffer-mami
                move buffer-mami(1:2) to 
                xrez-fiyat-konumu
               open input konum 
               initialize konum-rec
               move xrez-fiyat-konumu to konum-anahtar
               read konum no lock invalid 
                    initialize mesaj-degiskenler
                    move " [ Oda Konumu Hatali ] " to mmesaj-title
                    move " Secmis Oldugunuz Oda Konumu Tanimsiz....... "  to mmesaj-1
                    move " Seciminizi Degistiriniz.................... "  to mmesaj-2
                    move 1           to mmesaj-type
                    move 3           to mmesaj-icon
                    move 1           to mmesaj-default
                    perform mmesaj-ver

                    close konum
                    move 1 to gec-gecme
                    exit paragraph
                    not invalid continue
               end-read 
               if rez-yeni-eski = "Y" then 
                   move xrez-fiyat-konumu to xrez-oda-konumu
                  inquire fiyat-konumu-combo, 
                     value in oda-konumu-combo-value
                 display oda-konumu-combo
               end-if
               close konum
     .
*
 a-fiya-Ex-Ntf-Changed.
 
     inquire a-oda value in v-oda
   
     initialize nume nume2 ara-konum 
     move 1 to kyer
      move v-oda(1:1) to nume
     if nume  is numeric then 
        move function numval(v-oda (1:2)) to nume2
        if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2            to      oda-konumu-combo-value(1:2)
                  move "->"                 to  oda-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to oda-konumu-combo-value(5:)
        
        display oda-konumu-combo
        move oda-konumu-combo-value(1:2) to xrez-oda-konumu
        end-if
        else 

              move 0 to kyer
              inspect v-oda tallying kyer for all space
              compute kyer = function length(v-oda) - kyer
          perform varying k from 1 by 1 until k > 40
              if v-oda(1:kyer) = xkonum-adi(k)(1:kyer) then 
                move k to nume2
                if nume2 > 0 and  < 41 and xkonum-adi(nume2) not = spaces then
                  move nume2         to      oda-konumu-combo-value(1:2)
                  move "->"                 to  oda-konumu-combo-value(3:)
                  move xkonum-adi(nume2)    to oda-konumu-combo-value(5:)
        
                     display oda-konumu-combo
                     move oda-konumu-combo-value(1:2) to xrez-oda-konumu
                end-if

                
                  
                 exit perform 
              end-if
          end-perform 
     end-if
     
     .



      .
*
 anlasma-bul.
     open input aceanlas
     initialize aceanlas-rec def-anl-bulundu
     move xrez-acenta       to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end
           if xrez-acenta not =  aceanlas-acenta then
               move "10" to fs-aceanlas 
           else
             if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
                xrez-gir-tar >= aceanlas-donem-bas and
                xrez-gir-tar <= aceanlas-donem-bit then 
                move 1 to def-anl-bulundu
                if not eski-rez 
                   display message box "Acentaya ait Anlasma Bulundu" new-line
                                       "Anlasma tipi degistirilecektir...."
                end-if
                move "10" to fs-aceanlas 
             end-if
           end-if
     end-read
     end-perform
     end-start
     close aceanlas
     if def-anl-bulundu = 1
       if eski-rez and 
          aceanlas-anlasma <> xrez-anlasma
          move 1     to def-anl-uyumsuz
          move aceanlas-anlasma        to ydk-aceanlas-anlasma
          move  "Gercek Anlasma Kodu:" to deg-yazi
               modify Form1-Pb-2, visible = true
               modify Form1-Pb-2, title deg-anlasma 
                                 
          exit paragraph
      end-if
      if yeni-rez
        move aceanlas-anlasma     to xrez-anlasma
                 
       
        perform anlasma-oku
*            if k-kodu-tasi = "ASYA" then  stop " " end-if
                  if   aceanlas-ear  = 1 then 
                    move "E" to xrez-eb
                    else
                    move "H" to xrez-eb
                  end-if

                   if  aceanlas-aks-yok = 1 then 
                   move "H" to xrez-aksiyon-eh
                   else
                     move " " to xrez-aksiyon-eh
                   end-if

                   if  aceanlas-spe-yok = 1 then 
                       move 1 to xrez-special-eh
                   else
                        move 0 to xrez-special-eh
                   end-if
                   display special-cb aksiyon-cb 
        if xrez-special-eh = "1" or "H" 
           modify special-cb, value = 1
        else
           modify special-cb, value = 0
        end-if
   
        if xrez-aksiyon-eh = "1" or "H" 
           modify aksiyon-cb, value = 1
           move "H"           to xrez-aksiyon-eh
        else
           modify aksiyon-cb, value = 0
        end-if
   
        if xrez-eb = "E" or "1"
           modify eraly-booking-cb, value = 1
           move "E"     to xrez-eb
        else
           modify eraly-booking-cb, value = 0
        end-if
        end-if 
        display aksiyon-cb special-cb eraly-booking-cb
     end-if.
*
 uyumsuz-anlasma-bul.
     open input aceanlas
     initialize aceanlas-rec def-anl-bulundu
     move xrez-acenta       to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid

           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end
           if xrez-acenta not =  aceanlas-acenta then
               move "10" to fs-aceanlas 
           else
             if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
                xrez-gir-tar >= aceanlas-donem-bas and
                xrez-gir-tar <= aceanlas-donem-bit then 
                move 1 to def-anl-bulundu
                move "10" to fs-aceanlas 
             end-if
           end-if
     end-read
     end-perform
     end-start
     close aceanlas
     if def-anl-bulundu = 1
        move aceanlas-anlasma     to xrez-anlasma
        move aceanlas-ear         to xrez-eb
        move aceanlas-aks-yok     to xrez-aksiyon-eh
        move aceanlas-spe-yok     to xrez-special-eh
        perform anlasma-oku
   
        if xrez-special-eh = "1"
           modify special-cb, value = 1
        else
           modify special-cb, value = 0
        end-if
   
        if xrez-aksiyon-eh = "1"
           modify aksiyon-cb, value = 1
           move "H"           to xrez-aksiyon-eh
        else
           modify aksiyon-cb, value = 0
        end-if
   
        if xrez-eb = "1"
           modify eraly-booking-cb, value = 1
           move "E"     to xrez-eb
        else
           modify eraly-booking-cb, value = 0
        end-if         
     end-if.

 

*
 profil-cagir.
       move xrez-no                   to aranan-rez-no
       move isyeri-adres-tasi         to bulunan-rez-sirketi
       
       call "/asya/ytl/obj/otel/profbul.asy" using profbul-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/profbul.asy" 
       end-call
       perform ortak-profil-yaz.
*
 ortak-profil-yaz.       
       if secildi = 1 or 
          secildi = 2 OR 
          secildi = 3
          open i-o yanrez
          initialize yanrez-rec
          move xrez-no            to yanrez-rezno
          move yan-kac            to yanrez-sirano
          read yanrez no lock invalid
              continue
          end-read
           if secildi = 2
             initialize musteri-rec         
          end-if

          if secildi = 1 or secildi = 3                
            move bulunan-profil-sirket to musteri-sirket   
            move bulunan-profil-no     to musteri-no
            open input musteri
              read musteri no lock invalid
                 close yanrez 
                 exit paragraph
                 continue
                  not invalid
                  move musteri-adi to yanrez-adi 
                  move musteri-soyadi to yanrez-soyadi 
                  move musteri-d-tarihi to yanrez-dog-tar
              end-read
              close musteri 
          end-if
         
          evaluate yan-kac
          when 1
            move bulunan-profil-no       to mis-no yanrez-profil-no
            move bulunan-profil-sirket   to ps1    yanrez-profil-sirket
           
            move xrez-adi                           to yanrez-adi  
            move xrez-soyadi                        to yanrez-soyadi
               if secildi = 1  
                 move musteri-adi to xrez-adi yanrez-adi
                 move musteri-soyadi to xrez-soyadi yanrez-soyadi             
               end-if
            move yanrez-adi                        to   xrez-adi
            move yanrez-soyadi                      to  xrez-soyadi 
            display acc-mis-no acc-ps1 accept-adi accept-soyadi
          when 2
              move bulunan-profil-no       to pno2 yanrez-profil-no    
              move bulunan-profil-sirket   to ps2  yanrez-profil-sirket
              if secildi = 1  
                 move yanrez-adi                        to   adi2         
                 move yanrez-soyadi                      to   soy2 
                move yanrez-dog-tar  to d-tar2
             end-if
            display acc-pno2  acc-ps2    l-d-gun2 l-d-ay2 l-d-yil2 l-adi2 l-soy2
          when 3
            move bulunan-profil-no       to pno3 yanrez-profil-no    
            move bulunan-profil-sirket   to ps3  yanrez-profil-sirket
             if secildi =1 
            move  yanrez-adi     to adi3                           
            move  yanrez-soyadi to   soy3
             move yanrez-dog-tar  to d-tar3 
             end-if 
            display acc-pno3 acc-ps3   l-d-gun3 l-d-ay3 l-dyil3  l-adi3 l-soy3
          when 4
            move bulunan-profil-no       to pno4  yanrez-profil-no    
            move bulunan-profil-sirket   to ps4   yanrez-profil-sirket
             if secildi =1 
            move  yanrez-adi     to adi4                           
            move  yanrez-soyadi to   soy4 
             move yanrez-dog-tar  to d-tar4
             end-if
            display acc-pno4 acc-ps4   l-d-gun4 l-d-ay4 l-d-yil4 l-adi4 l-soy4
          when 5
            move bulunan-profil-no       to pno5  yanrez-profil-no    
            move bulunan-profil-sirket   to ps5   yanrez-profil-sirket
             if secildi =1 
             move  yanrez-adi     to adi5                           
             move  yanrez-soyadi to   soy5 
              move yanrez-dog-tar  to d-tar5
              end-if
            display acc-pno5 acc-ps5  l-d-gun5 l-d-ay5 l-d-yil5  l-adi5 l-soy5
          when 6
            move bulunan-profil-no       to pno6  yanrez-profil-no    
            move bulunan-profil-sirket   to ps6   yanrez-profil-sirket
              if secildi =1 
            move  yanrez-adi     to adi6                          
            move  yanrez-soyadi to   soy6 
            move yanrez-dog-tar  to d-tar6
            end-if
            display acc-pno6  acc-ps6  l-d-gun6 l-d-ay6 l-d-yil6   l-adi6 l-soy6
          when 7
            move bulunan-profil-no       to pno7  yanrez-profil-no    
            move bulunan-profil-sirket   to ps7   yanrez-profil-sirket
              if secildi =1 
            move  yanrez-adi     to adi7                           
            move  yanrez-soyadi to   soy7
            move yanrez-dog-tar  to d-tar7
            end-if
            display acc-pno7 acc-ps7 l-d-gun7 l-d-ay7 l-d-yil7 l-adi7 l-soy7
          end-evaluate
              write yanrez-rec invalid rewrite yanrez-rec end-rewrite end-write 
         close yanrez
       end-if.


*
 acc-mis-no-Ev-Cmd-Goto.
        if ps1 = zeroes or ps1 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
        end-if
        initialize mis-cagir 
        move mis-no to mis-no-cagir2
        move ps1 to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 1     to yan-kac
       if mis-kayit = 1 
            move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no
            perform ortak-profil-yaz
       end-if
       move 1  to musteriden-geldi.

*
 acc-pno2-Ev-Cmd-Goto.
        if pno2 = spaces or pno2 = zeroes
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
           
        end-if
        initialize mis-cagir
        move pno2 to mis-no-cagir2
        move ps2  to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 2     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno3-Ev-Cmd-Goto.
        if pno3 = spaces or pno3 = zeroes
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno3 to mis-no-cagir2
        move ps3  to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 3     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno4-Ev-Cmd-Goto.
        if pno4 = spaces or pno4 = zeroes
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno4 to mis-no-cagir2
        move ps4  to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 4     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno5-Ev-Cmd-Goto.
        if pno5 = spaces or pno5 = zeroes
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno5 to mis-no-cagir2
        move ps5  to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 5     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2         to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno6-Ev-Cmd-Goto.
        if pno6 = spaces or pno6 = zeroes
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno6 to mis-no-cagir2
        move ps6  to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 6     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
 acc-pno7-Ev-Cmd-Goto.
        if pno7 = spaces or pno7 = zeroes
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
           
        end-if

        initialize mis-cagir
        move pno7 to mis-no-cagir2
        move ps7  to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
       move 7     to yan-kac
       if mis-kayit = 1 
          move 1 to secildi
            move mis-sirket-cagir      to bulunan-profil-sirket
            move mis-no-cagir2          to bulunan-profil-no

           perform ortak-profil-yaz
       end-if.

*
  
     .
*
 hes-gonder.
      if Xrez-folio > 0 then 
        if key-status not = 2 
            display message box "CIN olmus rezervasyon register kartindan deneyiniz" title "DIKKAT"
            exit paragraph
        end-if
       end-if
        initialize linkh-odahes
        move xrez-no to  linkh-rez-no     
         move 1 to linkh-nereden  
         move 0 to linkh-anl-yaz
         move  0  to linkh-cast-yaz

          call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
            
          if  "E" = xrez-eb
              modify eraly-booking-cb, value = 1
           else
              modify eraly-booking-cb, value = 0
        end-if
         
              display ug-cb
              open input hesayr
            initialize hesayr-rec
            move  xrez-no to hesayr-rez-no
            evaluate true
               when tarih-tasi > rez-cik-tar
                  move xrez-gir-tar to hesayr-tarih
               when tarih-tasi <= rez-gir-tar
                  move xrez-gir-tar to hesayr-tarih
               when other
                  move tarih-tasi to hesayr-tarih
            end-evaluate
              read hesayr  no lock invalid
                continue
                not invalid
              move hesayr-basilacak-tut to xrez-fiyati
              end-read
              if xrez-gec = 1 and tarih-tasi <= rez-gir-tar
                 initialize hesayr-rec
                  move  xrez-no to hesayr-rez-no  
                  move xrez-gir-tar to hesayr-tarih
                  start hesayr key < hesayr-anah
                      invalid continue
                      not invalid
                      
                      read hesayr previous no lock end continue
                      not end
                          add hesayr-basilacak-tut to xrez-fiyati  
                      end-read
                  end-start

              end-if


              close  hesayr
            display accept-fiyati  
     .
*
 det-gonder.
        
          call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xrez-no   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/hesayr.asy"
         end-call

     .
*
 Form1-Pb-4-Link.
       move 0 to xrez-plan
       display Form1-Pb-4
     .
*
 rezervasyon-formu-ekle.
    move "Adobe PDF Dosyalari (*.pdf)|*.pdf" to 
          opnsav-filters
    call "c$opensavebox" using opensave-open-box,
                               opensave-data,
                         giving opensave-return.
    if opensave-return > 0
       perform resim-upload
    end-if.
*
 resim-upload.
    move low-values           to komut1 komut2 rename-dosya
    inspect opnsav-filename 
            replacing trailing spaces by low-values
    inspect opnsav-basename 
            replacing trailing spaces by low-values
    inspect opnsav-basename,
            replacing all spaces by "_"
    if is-remote
        string komut1,
              "@[DISPLAY]:"      delimited by low-values,
              opnsav-filename    delimited by low-values,
              into komut1

        string rename-dosya,
               xrez-no   delimited by low-values                
               ".pdf"    delimited by low-values 
        into rename-dosya        

        CALL "RENAME" using opnsav-basename rename-dosya

        string komut2,
              base-dir           delimited by low-values
              rename-dosya       delimited by low-values
              into komut2
    else
        string komut1,
               opnsav-filename delimited by low-values
        into komut1
        string rename-dosya,
               xrez-no   delimited by low-values 
               ".pdf"            delimited by low-values 
        into rename-dosya        

        CALL "RENAME" using opnsav-basename rename-dosya
        string komut2,
               base-dir        delimited by low-values
               rename-dosya    delimited by low-values
        into komut2
    end-if.
    call "c$copy" using komut1
                        komut2
                  giving copy-status.
*    move rename-dosya               to resim-rez-form 
*    display acc-rez-form
    if copy-status <> 0
       display message box 
               opnsav-filename, " dosyasi",x"0a0d",
               base-dir," klasorune kopyalanamadi ..."
               icon mb_error_icon
               title "Hata"
    end-if.
     
     .
*
 rezervasyon-resim-goruntule.
    move low-values to opnsav-filename
    string opnsav-filename
           xrez-no delimited by low-values
           ".pdf"  delimited by low-values
    into opnsav-filename

    if is-remote
        move low-values           to komut2 local-file
        string local-file,
              "@[DISPLAY]:"    delimited by low-values
               local-folder    delimited by low-values
               opnsav-filename delimited by low-values
        into local-file

        string komut2,
               base-dir        delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2

    else
        move low-values           to komut2 local-file
        string local-file,
               local-folder    delimited by low-values
               opnsav-filename delimited by low-values
        into local-file

        string komut2,
               base-dir        delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2
    end-if.

    call "c$copy" using komut2|kopyaloanyorrr...
                        local-file
                  giving copy-status.
    if copy-status <> 0
*       display message box 
*               opnsav-filename, " dosyasi",x"0a0d",
*               base-dir," klasorune kopyalanamadi ..."
*               icon mb_error_icon
*               title "Hata"
        display message box "Goruntulenecek PDF Dosyasi Bulunamadi..."
                        title "[ Uyari ]"
                        icon 1
    end-if
    if copy-status = 0
       move 1 to resim-bulundu
       if resim-bulundu = 1
          perform resim-teklif
       end-if
    end-if.
*
 resim-teklif.
       if is-remote 
          set shell32-dll-uzak to true
          set shell-execute-uzak to true
       else
          set shell32-dll-yerel to true
          set shell-execute-yerel to true
       end-if
       call shell32-dll on exception 
            display message box
                   "shell32.dll dosyasi bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            exit paragraph.
       if is-remote
          move local-file(12:)   to local-file(1:)
       end-if
       inspect local-file replacing trailing spaces by low-values
       inspect local-file replacing all "/"  by "\"

       call shell-execute using by value 0,
                                by reference ac-komut
                                by reference local-file,
                                null
                                null
                                by value SW_SHOW
        on exception
            display message box
                   "ShellExecute Proseduru bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            cancel shell32-dll
            exit paragraph
       end-call.
       cancel shell-execute.
       cancel shell32-dll.
     
      .

 
*
 accept-not2a-Ex-Other.
               initialize kartarafil-cagir
                call "/asya/ytl/obj/otel/kartfil.asy" 
                        using kartarafil-cagir
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/kartfil.asy"
                   end-call
              if kartarafil-ok = 1 then 
                move  kartarafil-kart  to  xrez-extra-kart 
                display accept-not2a
              end-if
          .
*
 accept-not2aa-Ex-Other.
       initialize kartarafil-cagir
                call "/asya/ytl/obj/otel/kartfil.asy" 
                        using kartarafil-cagir
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/kartfil.asy"
                   end-call
              if kartarafil-ok = 1 then 
                move  kartarafil-kart  to  xrez-extra-kart2
                display accept-not2aa
              end-if
     .
*
 screen2-Aft-Routine.
       move function numval(z-aylik-tut) to  rezek-aylik-fiyat
       move function numval(z-aidat-tut) to  rezek-aidat-fiyat

      open i-o rezek
          write rezek-rec invalid rewrite rezek-rec
            invalid continue
            end-rewrite
          end-write
          close rezek
     .

*
 screen2-Bef-Routine.
     
      initialize   z-aylik-tut z-aidat-tut
            move   rezek-aylik-fiyat   to z-aylik-tut
            move   rezek-aidat-fiyat   to z-aidat-tut
     .
*
 gd2-Ev-Other.
     
     .
*
 profil-goster.
     move 4  to kac-adet
 
     evaluate hangi-profil
     when 1
         move xrez-adi    to musteri-adi-filtre
         move xrez-soyadi to musteri-soy-filtre
     when 2
         move adi2    to musteri-adi-filtre
         move soy2 to musteri-soy-filtre
     when 3
         move adi3    to musteri-adi-filtre
         move soy3 to musteri-soy-filtre
     when 4
         move adi4    to musteri-adi-filtre
         move soy4 to musteri-soy-filtre
     when 5
         move adi5    to musteri-adi-filtre
         move soy5 to musteri-soy-filtre
     when 6
         move adi6    to musteri-adi-filtre
         move soy6 to musteri-soy-filtre
     when 7
         move adi7    to musteri-adi-filtre
         move soy7 to musteri-soy-filtre

     end-evaluate
     if musteri-adi-filtre(2:) = spaces and
        musteri-soy-filtre(2:) = spaces 
          exit paragraph 
     end-if 
     perform baslik-yukle
     perform profile-eslesen-ara
     perform profile-grid.
    .
*
 profile-eslesen-ara.
      open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
              move print-no to takasp-dno
    open output takasp close takasp         
    open input  musteri 
    open i-o takasp
    initialize  musteri-rec c5 aranan
    move musteri-adi-filtre(1:kac-adet)    to musteri-adi(1:kac-adet)
    start musteri key not < musteri-ilk invalid
          continue
    not invalid
    perform with test after until fs-musteri = "10"
    read musteri next no lock end move "10" to fs-musteri
    not at end
            initialize takasp-rec
            if musteri-sirket = spaces or 
               musteri-no = zeroes
                 exit perform cycle
            end-if
            if musteri-adi(1:kac-adet) not = musteri-adi-filtre(1:kac-adet)
               move "10"   to fs-musteri
            end-if 
            if musteri-adi(1:10) = musteri-adi-filtre(1:10) and
               musteri-soyadi(1:10) = musteri-soy-filtre(1:10) and
               musteri-adi not = spaces and
               musteri-soyadi not = spaces 
                 move 1   to xrez-gr-olabilir takasp-tam-uyum
                 
            end-if 
             initialize c1 c2 c3 c4  c6 puan
            move musteri-adi         to aranan
            move musteri-adi-filtre           to aranacak

            if musteri-adi-filtre not = spaces
               perform ada-gore
            end-if 
             initialize c1 c2 c3 c4  c6  
            move musteri-soyadi         to aranan
            move musteri-soy-filtre        to aranacak

            if musteri-soy-filtre not = spaces
               perform ada-gore
            end-if 
      
        if puan > 0
           add 1               to c5
            
           move m-profil       to takasp-anah
           move puan           to takasp-puan
           move musteri-adi    to takasp-adi
           move musteri-soyadi to takasp-soyadi
           move musteri-ulke   to takasp-ulke
           move musteri-d-tarihi        to takasp-d-tarih
           move musteri-gelis-sayisi    to takas-p-gel-sayi
           move musteri-kazanilan-puan  to takasp-gercek-puan
           move musteri-kart-tipi       to takasp-kart-tipi
           write takasp-rec invalid 
              rewrite takasp-rec end-rewrite 
           end-write 
        end-if 

     end-read
    end-perform
    end-start
    close  musteri .
    close takasp.


*
 ada-gore.
        inspect aranan tallying c1 for trailing spaces
        compute c2 = 20 - c1
        initialize c1
        inspect aranacak tallying c1 for trailing spaces
        compute c3 = 20 - c1 

        move 0 to c4
        inspect aranan(1:c3) tallying c4 for all aranacak(1:c3)
        if c4 > 0
           add 10000 to puan
           if c2 = c3 
               add 10000 to puan
           end-if 
        end-if 

        move 0 to c4
        inspect aranan(1:3) tallying c4 for all aranacak(1:3)
        if c4 > 0
           add 3000 to puan
        end-if

        move 0 to c4
        inspect aranan tallying c4 for all aranacak(1:c3)
        if c4 > 0
           add 5000 to puan
        end-if 

        perform varying i 
                  from 1
                  by 1
                  until i > c3 - 2
                      move 0   to c4 
                      inspect aranan tallying c4 for all aranacak(i:3)
                      if c4 > 0
                        if i = 1
                           add 300 to puan
                        end-if 
                          add 100 to puan
                      end-if 
        end-perform

        perform varying i 
                  from 1
                  by 1
                  until i > c3 - 1
                      move 0   to c4 
                      inspect aranan tallying c4 for all aranacak(i:2)
                      if c4 > 0
                        if i = 1
                           add 100 to puan
                        end-if 
                          add 10 to puan
                      end-if 
        end-perform.

     
*
 profile-grid.
    open input takasp ulke
    initialize takasp-rec 
    move 1  to satir
    move high-values to takasp-puan
    start takasp key not > takasp-puan invalid 
         continue 
    not invalid 
    perform until fs-takasp = "10"  
    read takasp previous no lock end move "10"  to fs-takasp
    not at end 
            add 1                to satir
            if satir > 20
                exit perform 
            end-if 
            initialize gd2-rec
            move takasp-no       to gd-2-col-1
            move takasp-adi      to gd-2-col-2
            move takasp-soyadi   to gd-2-col-3
            if takasp-d-yil > 1900
               move takasp-d-yil    to eyil
               move takasp-d-ay     to eay
               move takasp-d-gun    to egun
               move etarih          to gd-2-col-4
            end-if 

            move takas-p-gel-sayi   to z-gel-sayi
            move z-gel-sayi         to gd-2-col-5

            move takasp-gercek-puan     to z-puan
            move z-puan          to gd-2-col-6
            move takasp-kart-tipi to gd-2-col-7
            move takasp-sirket   to gd-2-col-8
            modify gd2,record-to-add(gd2-rec)
            if takasp-tam-uyum = 1
               modify gd2(satir),row-color = 176
            end-if 
    end-read 
    end-perform
    end-start
    close takasp ulke
    modify gd2,mass-update = 0
    delete file takasp.



*
 baslik-yukle.
     modify gd2,
            reset-grid = 1
            mass-update = 1            
     move "P.No"        to gd-2-col-1
     move "Adi"         to gd-2-col-2
     move "Soyadi"      to gd-2-col-3
     move "D.Tarihi"    to gd-2-col-4
     move "G.S"        to gd-2-col-5
     move "Puan"         to gd-2-col-6
     move "K.Tip"       to gd-2-col-7
     move "Sirket"      to gd-2-col-8
     modify gd2,record-to-add(gd2-rec).