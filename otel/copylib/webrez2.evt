* webrez2.evt
* webrez2.evt is generated from D:\asya\acugt.ytl\otel\webrez2.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM g1-Ev-Msg-Begin-Entry
     END-EVALUATE
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     

     call "c$narg" using link-var.
     
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open input genel genel2
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read
     initialize genel2-rec 
     move 1 to genel2-anah 
     read genel2 no lock invalid
          continue 
     end-read 
     close genel genel2.
     move calisma-tarihi to tarih-tasi
*     if link-var > 0 then 
*     move "20180407" to tarih-tasi
*     end-if
     move "2500" to web2-acenta.
     perform konum-ata.        
      open extend w2log.
     .
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka.
     move rezpara-doviz       to xrez-doviz .
     move rezpara-pan-tipi    to xrez-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi.
     move rezpara-ulke        to xrez-ulke.
     move rezpara-anlasma     to xrez-anlasma.
     move rezpara-pazar       to xrez-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil xrez-al-yil rez-al-yil    .
     move calis-ay            to xrez-gir-ay  xrez-cik-ay  xrez-al-ay  rez-al-ay  .
     move calis-gun           to xrez-gir-gun xrez-cik-gun xrez-al-gun rez-al-gun.

           move "4" to xrez-statu
   
            move "1" to xrez-tipi 
     
            move rezpara-k-g-b to xrez-k-g-b 
     
            move "N" to xrez-vip 

           
     
       .
 konum-ata.
*************Konumlar Yukleniyor.......
    
     open input konum.
     initialize konum-rec tmp-sayi.
     start konum key not < konum-anahtar invalid 
           continue
     not invalid 
     initialize fs-konum
     perform with test after until fs-konum = "10"
             read konum next no lock end move "10" to fs-konum
             not at end
                 if konum-satis = 1 then 
                  add 1 to tmp-sayi
                  move KONUM-ANAHTAR to wkonum-no(tmp-sayi)
                  move konum-adi to wkonum-adi(tmp-sayi)
                 end-if                 
             end-read
     end-perform
     end-start
     close konum.
   
     
 

*
 Form1-Aft-Initdata.
*/-----------------------------\*    
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     
    
     initialize rez-rec xrez-rec yan-deg. 
   
     copy "konumoku.prc".
     if link-var >= 1 then
          
                  move gweb-tipxx  to  web-tipxx
                  move gweb-debug  to  web-debug 
                  move gweb-rec    to  web-rec
                  move gweb2-rec   to  web2-rec

                 if web-debug = 1 then 
                   perform def-doldur2
                   display message box   "ok"
                  end-if 
                   
                    Perform islem
                  if web-debug = 1 then 
                   perform ekran-yaz
                   display message box   "ok"
                  end-if 
                   move web-tipxx    to   gweb-tipxx
                  move web-debug  to   gweb-debug 
                  move web-rec    to    gweb-rec
                  move web2-rec   to gweb2-rec
                  set exit-pushed to true
        else
                perform def-doldur
     end-if .
     
*
 def-doldur2.
         initialize  g-rec
         move "DATA " to gc1
         move "DEGER" to gc2
         perform varying i from 1 by 1 until i > 10
           move i to gd-o(i)
         end-perform 
         modify g1(1) record-data = g-rec
           initialize  g-rec
         move   "web2-gelen-bastar " to gc1
         move web2-bas-tar to gc2
         modify g1(2) record-data = g-rec
              initialize  g-rec
         move   "web2-gelen-bittar" to gc1
         move web2-bit-tar to gc2
         modify g1(3) record-data = g-rec
              initialize  g-rec
           move   "web2-gelen-pax" to gc1
         move web2-gelen-pax to gc2
                move "Onodeme" to  gd-o(1)
          move "0" to  gd-o(2)
         modify g1(4) record-data = g-rec
                initialize  g-rec
         move   "web2-gelen-chi" to gc1
         move web2-gelen-chi to gc2
         modify g1(5) record-data = g-rec
               initialize  g-rec
          move   "web2-gelen-free" to gc1
         move web2-gelen-free to gc2
         modify g1(6) record-data = g-rec
          move web2-doviz to gc2
         modify g1(7) record-data = g-rec
         initialize  g-rec
         move   "WEB2 GIDEN" to gc1
         move "xxxxxxxx" to gc2
         modify g1(8) record-data = g-rec 
          perform ekran-yaz .

             initialize  g-rec
         move   "DATA " to gc1
         move "DEGER" to gc2
         perform varying i from 1 by 1 until i > 10
           move i to gd-o(i)
         end-perform 
         modify g1(1) record-data = g-rec
           initialize  g-rec
         move   "web2-doviz " to gc1
         move web2-doviz to gc2
       

         modify g1(2) record-data = g-rec
              initialize  g-rec
         move   "web2-konum" to gc1
         move web2-konum-KODU to gc2
         modify g1(3) record-data = g-rec
              initialize  g-rec
           move   "web2-bas-tar" to gc1
         move web2-bas-tar to gc2
         modify g1(4) record-data = g-rec
                initialize  g-rec
         move   "web2-bit-tar" to gc1
         move web2-bit-tar to gc2
         modify g1(5) record-data = g-rec
        
                  initialize  g-rec
         move   "web2-pax" to gc1
         move web2-gelen-pax to gc2
                   move "Onodeme" to  gd-o(1)
          move "100" to  gd-o(2)
         modify g1(6) record-data = g-rec
                  initialize  g-rec
         move   "web2-chi" to gc1
         move web2-gelen-chi to gc2
         modify g1(7) record-data = g-rec
         
          initialize  g-rec
          move   "web2-title" to gc1
         
         move " XXXXX " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-title(i) to gd-o(i)
         end-perform 
         modify g1(8) record-data = g-rec
         initialize  g-rec
          move   "web2-adi" to gc1
          
         move " XXXXX " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-adi(i) to gd-o(i)
         end-perform 
         modify g1(9) record-data = g-rec
         
          initialize  g-rec
          move   "web2-soyadi" to gc1
          
         move " XXXXX " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-soyadi(i) to gd-o(i)
         end-perform 
         modify g1(10) record-data = g-rec


         
         initialize  g-rec
         move   "WEB GIDEN" to gc1
         move "xxxxxxxx" to gc2
         modify g1(11) record-data = g-rec 
            perform ekran-yaz .

     .
*
 def-doldur.
         initialize  g-rec
         move   "DATA " to gc1
         move "DEGER" to gc2
         perform varying i from 1 by 1 until i > 10
           move i to gd-o(i)
         end-perform 
         modify g1(1) record-data = g-rec
           initialize  g-rec
         move   "web2-doviz " to gc1
        
          move   "ulke " to  gd-o(2)
         move "DE  " to gd-o(3)
          move "IP  " to gd-o(4)
          move "985"    to gd-o(5)(1:3)
           move "SATIS TAR  " to gd-o(6)
          move "01.01.2017"    to gd-o(7)
           move "ACENTA  " to gd-o(8)
          move "2502"    to gd-o(9)
         modify g1(2) record-data = g-rec
              initialize  g-rec
         move   "web2-konum" to gc1
         move "01" to gc2
         modify g1(3) record-data = g-rec
              initialize  g-rec
           move   "web2-bas-tar" to gc1
         move "20180416" to gc2
         modify g1(4) record-data = g-rec
                initialize  g-rec
         move   "web2-bit-tar" to gc1
          move "20180417" to gc2
         
         modify g1(5) record-data = g-rec
                initialize  g-rec
           move   "web2-pax" to gc1
         move "2" to gc2
                   move "Onodeme" to  gd-o(1)
          move "100" to  gd-o(2)
         modify g1(6) record-data = g-rec
                initialize  g-rec
         move   "web2-chi" to gc1
         move "0" to gc2
         modify g1(7) record-data = g-rec
         
          initialize  g-rec
          move   "web2-title" to gc1
          MOVE "MR  " to web2-title(1)
          MOVE "MRS " to web2-title(2)
         move " XXXXX " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-title(i) to gd-o(i)
         end-perform 
         modify g1(8) record-data = g-rec
         initialize  g-rec
          move   "web2-adi" to gc1
          MOVE "ABDULLAH " to web2-adi(1)
          MOVE "GULSEN   " to web2-adi(2)
         move " XXXXX " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-adi(i) to gd-o(i)
         end-perform 
         modify g1(9) record-data = g-rec
         
          initialize  g-rec
          move   "web2-soyadi" to gc1
          MOVE "YAPICI   " to web2-soyadi(1)
          MOVE "YAPICI   " to web2-soyadi(2)
         move " XXXXX " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-soyadi(i) to gd-o(i)
         end-perform 
         modify g1(10) record-data = g-rec


         
         initialize  g-rec
         move   "WEB GIDEN" to gc1
         move "xxxxxxxx" to gc2
         modify g1(11) record-data = g-rec 
          perform ekran-yaz .


*
  ekran-yaz.
      
         initialize  g-rec
         move   "web2-doviz" to gc1
         move web2-doviz to gc2
         modify g1(12) record-data = g-rec

                initialize  g-rec
          move   "web2-konum" to gc1
         move web2-konum-kodu to zz
         move zz to gc2
         modify g1(13) record-data = g-rec


          initialize  g-rec
          move   "web2-anlasma" to gc1
         move web2-anlasma to gc2
         modify g1(14) record-data = g-rec

        
             initialize  g-rec
         move   "web2-tutar" to gc1
         move " gunler  " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-oda-fiyati-gunluk(i) to z-para
           move z-para to gd-o(i)
         end-perform 
         modify g1(15) record-data = g-rec
              initialize  g-rec
         move   "ham tutar" to gc1
         move " gunler  " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-oda-fiyati-gunluk-ham(i) to z-para
           move z-para to gd-o(i)
         end-perform 
         modify g1(16) record-data = g-rec
                initialize  g-rec
         move   "EB Ind" to gc1
         move " gunler  " to gc2
         perform varying i from 1 by 1 until i > 10
           move web2-oda-fiyati-gunluk-ind-tut(i,1) to z-para
           move z-para to gd-o(i)
         end-perform 
         modify g1(17) record-data = g-rec

               initialize  g-rec
         move   "web2-toplamtutar" to gc1
         move web2-oda-fiyati-toplam to z-para
         move z-para to gc2
        
         
         modify g1(18) record-data = g-rec
         
         initialize  g-rec
         move   "web2-rez-no" to gc1
         move web2-rez-no  to gc2
         modify g1(19) record-data = g-rec

         initialize  g-rec
         move   "web2-kkarti-bilgisi" to gc1
         move web2-kkarti-bilgisi  to gc2
         modify g1(20) record-data = g-rec

        .
*        
  anlasma-bul.
       open input acenta
         move xrez-acenta  to acenta-kodu 
          read acenta no lock invalid 
               continue
          end-read

          if acenta-rate-acenta > spaces
             move acenta-rate-acenta to acenta-kodu 
             read acenta no lock invalid
                move xrez-acenta to  xREZ-RATE-ACENTA
               not invalid 
                 move acenta-kodu to xREZ-RATE-ACENTA
          else
                move xrez-acenta to  xREZ-RATE-ACENTA
          end-if
            move xrez-acenta  to acenta-kodu 
            read acenta no lock invalid continue
          end-read
        close acenta 

     open input aceanlas
     initialize aceanlas-rec def-anl-bulundu
     move xREZ-RATE-ACENTA       to aceanlas-acenta
     move high-values       to aceanlas-anlasma-tar
     start aceanlas key not > aceanlas-bul invalid
           continue
     not invalid
     perform with test after until fs-aceanlas = "10"
     read aceanlas previous no lock end move "10" to fs-aceanlas
     not at end

           if xREZ-RATE-ACENTA not =  aceanlas-acenta then
               move "10" to fs-aceanlas 
           else
              if genel2-aceanlas-referansli = 1    |||X firat ekleme 12/2/2021
                 if onkpara-referans-var = 1 
                    evaluate onkpara-referans-nerden
                        when 1 
                             open input konum 
                             initialize konum-rec 
                             move xrez-fiyat-konumu to konum-anahtar 
                             read konum no lock invalid
                                  continue
                             end-read 
                             close konum
                             if aceanlas-referans not = spaces and aceanlas-referans not = 0
                                if konum-ref not = aceanlas-referans
                                   exit perform cycle
                                end-if
                             end-if 
                        when 2
                             open input odalar 
                             initialize odalar-rec 
                             move xrez-odano to odalar-rec 
                             read odalar no lock invalid
                                  continue
                             end-read 
                             close odalar 
                             if aceanlas-referans not = spaces and aceanlas-referans not = 0
                                if odalar-referans not = aceanlas-referans
                                   exit perform cycle
                                end-if
                             end-if
                    end-evaluate 
                 end-if
              end-if   |||X
            if aceanlas-tutar-sira > 0 and  aceanlas-tutar-sira <= 9
             
             if xkonum-tutar-sira(xrez-fiyat-konumu) not = aceanlas-tutar-sira
               exit perform  cycle
              end-if
           end-if
             if xrez-al-tar <= aceanlas-kabul-bit and 
                xrez-al-tar >= aceanlas-kabul-bas and
                xrez-gir-tar >= aceanlas-donem-bas and
                xrez-gir-tar <= aceanlas-donem-bit then 
                move 1 to def-anl-bulundu
                  move aceanlas-anlasma     to xrez-anlasma
                
                  if aceanlas-ear = 1 then 
                      move "E" to  xrez-eb
                      else
                      initialize  xrez-eb
                  end-if
                    if  aceanlas-aks-yok = 1 then 
                       move "H" to xrez-aksiyon-eh
                   else
                         move " " to xrez-aksiyon-eh
                   end-if
                   if aceanlas-spe-yok= 1 move "E" to xREZ-SPECIAL-EH
                 else     move "H" to xREZ-SPECIAL-EH
                         end-if
     
                  move aceanlas-spe-yok     to xrez-special-eh
                move "10" to fs-aceanlas 
             end-if
           end-if
     end-read
     end-perform
     end-start
     close aceanlas .
       

*
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move web2-acenta to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.

       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar

      
       if acen-dft-early= 1 move "E" to xrez-eb
                 else     move "H" to xrez-eb
              end-if
       if acen-dft-bilboard = 1 move "E" to xrez-bilbord-eh
                 else     move "H" to xrez-bilbord-eh
              end-if .
       
*
 Exception-Procedure.
        evaluate key-status 
          when 2

           inquire g1(2) record-data in g-rec
           move  gc2 to  web2-doviz
           move gd-o(3) to web2-ulke
          if gd-o(5) (1:3) = "999"
            move gd-o(5) to web2-ip
          end-if

             move   "ulke " to  gd-o(2)
         move "TR  " to gd-o(3)
          move "IP  " to gd-o(4)
          move "985"    to gd-o(5)(1:3)
           move "SATIS TAR  " to gd-o(6)
          move "01.01.2017"    to gd-o(7)
           move "ACENTA  " to gd-o(8)
          move "2502"    to gd-o(9)
          inquire g1(3) record-data in g-rec
           move  function numval(gc2) to  web2-konum-kodu
          inquire g1(4) record-data in g-rec
           move gc2 to  web2-bas-tar
           inquire g1(5) record-data in g-rec
           move gc2 to  web2-bit-tar
           inquire g1(6) record-data in g-rec
           move function numval(gc2) to  web2-gelen-pax
           move function numval(gd-o(2)) to  web2-cekilen-tut
            inquire g1(7) record-data in g-rec
           move function numval(gc2) to  web2-gelen-chi
          inquire g1(8) record-data in g-rec
          perform varying i from 1 by 1 until i > 10
           move  gd-o(i)  to   web2-title(i)
         end-perform
           inquire g1(9) record-data in g-rec
          perform varying i from 1 by 1 until i > 10
           move  gd-o(i)  to   web2-adi(i)
         end-perform
           inquire g1(10) record-data in g-rec
          perform varying i from 1 by 1 until i > 10
           move  gd-o(i)  to   web2-soyadi(i)

         end-perform
            inquire g1(19) record-data in g-rec
         move gc2 to  web2-rez-no

            inquire g1(20) record-data in g-rec
         move gc2 to  web2-kkarti-bilgisi

       
         
         
       
              move 02 to     web2-rate-kodu
               
          
               move 1 to web-tipxx 
                move 0 to web-debug
               
             call "/asya/ytl/obj/otel/webrez2.asy" 
                        using   web
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/webrez2.asy"
            end-call
          
                 
*            perform islem
            perform ekran-yaz
        end-evaluate .

    
     .
 islem.
    
     initialize hata-oldu
    open i-o rez.
     initialize  w2log-rec 
     accept w2log-tarih from century-date
     accept w2log-zaman from time
     move "0001" to w2log-data
     move gweb2-rec to w2log-data(6:)
     | write w2log-rec end-write
     move web2-rez-no to x8
     move function numval (x8)  to web2-rez-no
     if web2-ip(1:3) = "999"
             move 1 to hrunner
             else
             move 0 to hrunner
          end-if
     if  web2-rez-no = 0 then 
         
         move "Y" to  wislem-tipi
         perform hatasiz-islem

         if hata-oldu  =  0 then 

                    move rez-no to web2-rez-no 
                    move rez-anlasma to web2-anlasma 
                    move rez-fiyat-konumu to  web2-giden-konum 
                    move rez-doviz to web2-giden-doviz
                    initialize  w2log-rec 
                    accept w2log-tarih from century-date
                    accept w2log-zaman from time
                    move "9999          Rez yazildi" to w2log-data
                    move rez-no to w2log-data(6:8)
                    | write w2log-rec end-write  

          else

                     move 0 to web2-rez-no
                     initialize  w2log-rec 
                     accept w2log-tarih from century-date
                     accept w2log-zaman from time
                     move "8888   Rezervasyon yazilamadi" to w2log-data
                     | write w2log-rec end-write  

       end-if  
       else
       if web2-gelen-pax  = 0 then 
                     move "P" to  wislem-tipi
                    perform isimupdate-islem
                     if hata-oldu  =  0 then 
                            move rez-no to web2-rez-no 
                            move rez-anlasma to web2-anlasma 
                            move rez-fiyat-konumu to  web2-giden-konum 
                            move rez-doviz to web2-giden-doviz
                            initialize  w2log-rec 
                            accept w2log-tarih from century-date
                            accept w2log-zaman from time
                            move "9789     Isim update edildi" to w2log-data
                            move rez-no to w2log-data(6:8)
                            | write w2log-rec end-write  
        
                      else
        
                             move 0 to web2-rez-no
                             initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move " 9987 Isim update edilemedi" to w2log-data
                             | write w2log-rec end-write  
        
                    end-if  

        else
               if web2-bas-tar < 1900 
                   move "S" to  wislem-tipi
                    perform sil-islem
                     if hata-oldu  =  0 then 
        
                            move rez-no to web2-rez-no 
                            move rez-anlasma to web2-anlasma 
                            move rez-fiyat-konumu to  web2-giden-konum 
                            move rez-doviz to web2-giden-doviz
                            initialize  w2log-rec 
                            accept w2log-tarih from century-date
                            accept w2log-zaman from time
                            move "9989          Rez silindi" to w2log-data
                            move rez-no to w2log-data(6:8)
                            | write w2log-rec end-write  
        
                      else
        
                             move 0 to web2-rez-no
                             initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move " 9987 Rez silinemedi" to w2log-data
                             | write w2log-rec end-write  
        
                    end-if  
                  else          
                     move "U" to  wislem-tipi
                       perform hatasiz-islem
        
                         if hata-oldu  =  0 then 
        
                            move rez-no to web2-rez-no 
                            move rez-anlasma to web2-anlasma 
                            move rez-fiyat-konumu to  web2-giden-konum 
                            move rez-doviz to web2-giden-doviz
                            initialize  w2log-rec 
                            accept w2log-tarih from century-date
                            accept w2log-zaman from time
                            move "9989          Rez update" to w2log-data
                            move rez-no to w2log-data(6:8)
                            | write w2log-rec end-write  

                          else
                
                                     move 0 to web2-rez-no
                                     initialize  w2log-rec 
                                     accept w2log-tarih from century-date
                                     accept w2log-zaman from time
                                     move " 9987 Rez update" to w2log-data
                                     | write w2log-rec end-write  

                        end-if  
             end-if
         end-if
     end-if
         
     close rez.        
********************************************
*
*
*
 isimupdate-islem.
        move web2-rez-no to rez-no
        read rez no lock invalid 
                   initialize  w2log-rec 
                     accept w2log-tarih from century-date
                     accept w2log-zaman from time
                     move "8597 isim Update Rez yok " to w2log-data  
                      move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                     | write w2log-rec end-write    
                      move 1 to hata-oldu
                       move "isim update Rezervasyon bulunamadi " to web2-hata-aciklama(10:)
                     not invalid 
                     if rez-gir-tar < tarih-tasi 
                             initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8572 onceki tarihe isim update  " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "onceki tarihe isim update " to web2-hata-aciklama(10:)
                               exit paragraph
                     end-if
                     if rez-gir-tar < tarih-tasi 
                             initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8572 onceki tarihe isim update   " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "onceki tarihe isim update " to web2-hata-aciklama(10:)
                                exit paragraph
                     end-if
                     if rez-durumu = "S" then
                              initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8575 Zaten silinmis isim update" to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "Daha once silinmis isim update " to web2-hata-aciklama(10:)
                               exit paragraph
                     end-if
                     if rez-folio > 0 then
                        initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8578 CIN isim update   " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "CIN OLMUS isim update" to web2-hata-aciklama(10:)
                               exit paragraph


                     end-if
           move rez-rec        to xrez-rec
                      
           move web2-adi(1)    to xrez-adi 
           move web2-soyadi(1) to xrez-soyadi     

           move web2-adi(2)    to adi2
           move web2-soyadi(2) to soy2    
          
           move web2-adi(3)    to adi3
           move web2-soyadi(3) to soy3  
             
           move web2-adi(4)    to adi4
           move web2-soyadi(4) to soy4  

           move web2-adi(5)    to adi5
           move web2-soyadi(5) to soy5 
 
           move web2-adi(6)    to adi6
           move web2-soyadi(6) to soy6 

           move web2-adi(7)    to adi7
           move web2-soyadi(7) to soy7

           move "ASYA"    to xrez-staf 
            
***             move web2-call-center to xrez-call-center
                          
                  move xrez-rec to rez-rec
                 
              
                if web2-cekilen-tut > 0 and genel-web-stil not = "D" then  
                   perform onodeme-yaz
                   move 1 to rez-onodeme-var
                 end-if
                 move 1 to udan-geldi
                        perform webrez-yaz
                  

                 accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                 accept rez-edit-zaman from time          |                           
                  if web2-erken-giris(1:1) not = spaces
                     move web2-erken-giris(1:1) to rez-vip
                  end-if                 
                 rewrite rez-rec invalid 
                         move 1 to hata-oldu
                         move "REZ isim update yapilamadi" to web2-hata-aciklama
                 not invalid
                     perform log-operation-rez
                      initialize  w2log-rec 
                      accept w2log-tarih from century-date
                      accept w2log-zaman from time
                      move "0045   isim  Rez update" to w2log-data
                      | write w2log-rec end-write  
               
                       perform yanrez-kaydet
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0050     YanRez yazildi" to w2log-data
                              | write w2log-rec end-write  
                                
                    
                end-rewrite
             
               
     
       
*****               perform log-operation-rez


        end-read.






 sil-islem.

        move web2-rez-no to rez-no
        read rez no lock invalid 
                   initialize  w2log-rec 
                     accept w2log-tarih from century-date
                     accept w2log-zaman from time
                     move "8566 Silinecek Rez yok " to w2log-data  
                      move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                     | write w2log-rec end-write    
                      move 1 to hata-oldu
                       move "Rezervasyon bulunamadi " to web2-hata-aciklama(10:)
        not invalid 
                     if rez-gir-tar < tarih-tasi 
                             initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8572 onceki tarihe silinme   " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "onceki tarihe silinme " to web2-hata-aciklama(10:)
                               exit paragraph
                     end-if
                     if rez-gir-tar < tarih-tasi 
                             initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8572 onceki tarihe silinme   " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "onceki tarihe silinme " to web2-hata-aciklama(10:)
                                exit paragraph
                     end-if
                     if rez-durumu = "S" then
                              initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8575 Zaten silinmis   " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "Daha once silinmis " to web2-hata-aciklama(10:)
                               exit paragraph
                     end-if
                     if rez-folio > 0 then
                        initialize  w2log-rec 
                             accept w2log-tarih from century-date
                             accept w2log-zaman from time
                             move "8578 CIN   " to w2log-data  
                              move web2-rez-no to  w2log-data(150:) web2-hata-aciklama(1:)
                             | write w2log-rec end-write    
                              move 1 to hata-oldu
                               move "CIN OLMUS" to web2-hata-aciklama(10:)
                               exit paragraph


                     end-if
                      if rez-para-isl-sistemden = 1 then
                               move tarih-tasi to rez-isl-tar
                          else
                            accept sys-tar from century-date 
                                      move sys-yil to rez-isl-yil
                                      move sys-ay  to rez-isl-ay 
                                      move sys-gun to rez-isl-gun 
                          end-if
                           move k-kodu-tasi   to rez-staf 
                     
       move "S" to rez-durumu 
        
       accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
       accept rez-edit-zaman from time          |                           
       if web2-erken-giris(1:1) not = spaces
          move web2-erken-giris(1:1) to rez-vip
       end-if        
       rewrite rez-rec invalid 
                move 1 to hata-oldu
                       move "CIN OLMUS" to web2-hata-aciklama(10:)
                         exit paragraph
               not invalid
               perform log-operation-rez
*******perform cast-iptal   thru cast-iptal-exit. 
*              perform prohrk-sil  
*              perform acenhrk-sil  thru acenhrk-sil-exit 
*              perform takvim-sil   thru takvim-sil-exit
      end-rewrite


        end-read.



          .
 hatasiz-islem.
    
     initialize xrez-rec
     perform rez-parametre-ata
       if "U" =  wislem-tipi
                        initialize udan-geldi
                        move 1 to udan-geldi

              move web2-rez-no to rez-no
               read rez no lock invalid 
                   move 1 to hata-oldu
                   exit paragraph
                  not invalid
                  if rez-durumu = "S" 
                      move 1 to hata-oldu
                      exit paragraph
                 end-if
                 if rez-folio > 0 then 
                          move 1 to hata-oldu
                          exit paragraph
                 end-if
              end-read
              move rez-rec to xrez-rec

           else
            if hrunner = 1 
               move web2-ulke(1:2) to xrez-al-tar(7:2)
               move web2-ulke(4:2) to xrez-al-tar(5:2)
               move web2-ulke(7:4) to xrez-al-tar(1:4)
             
            else
              move tarih-tasi to xrez-al-tar
            end-if
            
                 perform rez-fis-al
       end-if
      perform konum-ata
   
        
      if hrunner = 0  then
      
     open input uyrukweb ulke 
     open i-o aceuyruk
     move web2-ulke to uyrukweb-web-kodu
         read uyrukweb no lock key  uyrukweb-web-kodu  invalid 
                 move rezpara-web-ulke to xrez-ulke
            not invalid 
                move uyrukweb-ulke to xrez-ulke
         end-read
         initialize ulke-rec
         move xrez-ulke to ULKE-ANAH
         read ulke no lock invalid 
           move  rezpara-web-ulke to ULKE-ANAH
           read ulke no lock invalid 
               move  rezpara-web-ulke to ULKE-ANAH
                 display message box " Defult ulke yok"                 
           end-read           
         end-read

*/******************************stone group için / ramazan       
         initialize aceuyruk-rec
         move uyrukweb-kodu        to aceuyruk-uyruk
         start aceuyruk key not < aceuyruk-anah1 invalid 
              continue 
         not invalid 
         perform until fs-aceuyruk = "10"
         read aceuyruk next no lock end move "10" to fs-aceuyruk
         not at end 
                  if aceuyruk-uyruk <> uyrukweb-kodu
                      exit perform 
                  end-if 
                  if web2-bas-tar >= aceuyruk-k-bas-tar   and
                     web2-bas-tar < aceuyruk-k-bit-tar  
                        move aceuyruk-acenta to ulke-web-acenta
                        exit perform 
                  end-if 
         end-read 
         end-perform
         end-start
*/******************************stone group için / ramazan

       
             move ulke-web-acenta to web2-acenta


     close uyrukweb ulke aceuyruk
     end-if

     move web2-acenta to xrez-acenta
   
     perform acen-dft-oku
        
     move xrez-doviz to web2-doviz
     initialize  w2log-rec 
     accept w2log-tarih from century-date
     accept w2log-zaman from time
     move "0010     defaultlar okundu" to w2log-data
      
          
     | write w2log-rec end-write  



      if hata-oldu not = 0 then 
         exit paragraph
      end-if
   
        move  web2-bas-tar  to xrez-gir-tar
        move  web2-bit-tar    to xrez-cik-tar
          accept w2log-tarih from century-date
     accept w2log-zaman from time
     move "4222         tarih geldi xrezgir:" to w2log-data
     move  xrez-gir-tar to  w2log-data(40:)

     | write w2log-rec end-write 
         move web2-gelen-pax      to xrez-buyuk
         move xrez-bUYUK to xrez-s-d-t-g
         if xrez-s-d-t-g > 4 then 
           move 4 to xrez-s-d-t-g
         end-if
         move  web2-gelen-chi     to xrez-kucuk
        
          

         move  web2-gelen-free     to xrez-free
          move  web2-gelen-bebek     to xrez-bebek

    move web2-konum-kodu to bulunan-konum
    
      if bulunan-konum > 0 then 


       initialize  w2log-rec 
     accept w2log-tarih from century-date
     accept w2log-zaman from time
     move "0020         konum bulundu" to w2log-data
      move bulunan-konum to w2log-data(6:4)
     | write w2log-rec end-write 
       else
       move 1 to hata-oldu
           initialize  w2log-rec 
     accept w2log-tarih from century-date
     accept w2log-zaman from time
      move "0021 ***** konum bulunamadi" to  w2log-data
     
     | write w2log-rec end-write 
      end-if

     
       if hata-oldu not = 0 then 
         exit paragraph
      end-if
     move bulunan-konum to xrez-oda-konumu xrez-fiyat-konumu
     perform anlasma-bul
        
    
     
     if def-anl-bulundu = 1
           move aceanlas-anlasma to xrez-anlasma
              initialize  w2log-rec 
              accept w2log-tarih from century-date
              accept w2log-zaman from time
              move "0030         default anlasma bulundu" to w2log-data
              move xrez-anlasma to w2log-data(6:4)
             | write w2log-rec end-write  
           else
              initialize  w2log-rec 
              accept w2log-tarih from century-date
              accept w2log-zaman from time
              move "0030 *** default anlasma bulunamadi" to w2log-data
              
               | write w2log-rec end-write  
            move "1255-Defult anlasma bulunamadi " to web2-hata-aciklama
          move 1 to hata-oldu
      end-if.  
        if hata-oldu not = 0 then 
         exit paragraph
      end-if

          

              initialize  w2log-rec 
              accept w2log-tarih from century-date
              accept w2log-zaman from time
              move "0035     Fiyat almaya  gitti" to w2log-data

              | write w2log-rec end-write  
           if web2-rate-kodu  not = 1
                            
                 open input kodlar02
                 initialize kodlar02-rec
                 EVALUATE  web2-rate-kodu
                 WHEN 2
                       move 91  to xREZ-OZEL-DURUM kodlar02-kodu

                        ||29.02.2020 STONE ICIN EKLENDI SALIH
                        initialize kodlar02-rec
                        move "Z"         to kodlar02-tipi
                        start kodlar02 key not < kodlar02-anah invalid 
                            continue 
                        not invalid 
                        perform until fs-kodlar02 = "10"
                        read kodlar02 next no lock end move "10"   to fs-kodlar02
                        not at end
                                   if kodlar02-tipi <> "Z"
                                          exit perform
                                   end-if  
                                   if kodlar02-web not = spaces and  kodlar02-web = 1 
                                     if kodlar02-ozel-durum-onli-bas-yil > 0 and kodlar02-ozel-durum-onli-bit-yil > 0
                                             move 20                               to onli-ozl-bas-yil(1:2) onli-ozl-bit-yil(1:2) 
                                             move kodlar02-ozel-durum-onli-bas-yil to onli-ozl-bas-yil(3:2)
                                             move kodlar02-ozel-durum-onli-bas-ay  to onli-ozl-bas-ay
                                             move kodlar02-ozel-durum-onli-bas-gun to onli-ozl-bas-gun
                        
                                             move kodlar02-ozel-durum-onli-bit-yil to onli-ozl-bit-yil(3:2)
                                             move kodlar02-ozel-durum-onli-bit-ay  to onli-ozl-bit-ay
                                             move kodlar02-ozel-durum-onli-bit-gun to onli-ozl-bit-gun
                        
                                             if xrez-al-tar not = zeroes and xrez-al-tar >= onli-ozl-bas-tar and xrez-al-tar <= onli-ozl-bit-tar
                                                 if kodlar02-kodu not = "91"
                                                        move kodlar02-kodu to xREZ-OZEL-DURUM 
                                                 end-if 
                                             end-if
                                     end-if
                                   end-if 
                        end-read 
                        end-perform
                        end-start
                        move xREZ-OZEL-DURUM to kodlar02-kodu 
                        ||29.02.2020 STONE ICIN EKLENDI SALIH
                 WHEN 3
                       MOVE 90  to xREZ-OZEL-DURUM kodlar02-kodu
                 END-EVALUATE
                    move "Z" to kodlar02-tipi
                    read kodlar02 no lock invalid
                        continue
                    not invalid 
                      move kodlar02-sayisal   to xrez-ozel-durum-car
                      move kodlar02-ozl-tipi  to xREZ-ozel-tip 
                 end-read

                 if acen-dft-ozl-drm-sabit = 1
                    initialize kodlar02-rec def-carpan
                    move acen-dft-ozl-drm  to kodlar02-kodu
                    move "Z" to kodlar02-tipi
                    read kodlar02 no lock invalid
                        continue
                    not invalid 
//                      move kodlar02-sayisal   to xrez-ozel-durum-car

*                      move kodlar02-sayisal   to def-carpan
*                      compute  def-carpan rounded = def-carpan / 100
                      move acen-dft-ozl-drm to xREZ-OZEL-DURUM
                      move kodlar02-sayisal to xrez-ozel-durum-car

                      move kodlar02-ozl-tipi  to xREZ-ozel-tip
                 end-if                  

                 initialize kodlar02-rec
                 move "B" to kodlar02-tipi
                 start kodlar02 key >= kodlar02-anah invalid continue
                   not invalid 
                     perform until fs-kodlar02 = "10"

                            read kodlar02 next no lock end move "10" to fs-kodlar02
                               not end
                                 if kodlar02-tipi not = "B"
                                   move "10" to fs-kodlar02
                                   else
                                        if GENEL-ONODEME-DOV-DERLE = 1 
                                          if Ode-Tipi = "A"
                                            move kodlar02-kodu to xrez-odeme-tipi
                                           end-if
                                        else
                                         if Ode-Tipi = "B"
                                            move kodlar02-kodu to xrez-odeme-tipi
                                          end-if
                                        end-if
                                end-if
                           end-read
                        end-perform
                    end-start
                   
                       

                  close kodlar02

              

              else
                move "01" to xrez-odeme-tipi


                 open input kodlar02
               
                  initialize kodlar02-rec
                 
                 move "B" to kodlar02-tipi
                 start kodlar02 key >= kodlar02-anah invalid continue
                   not invalid 
                     perform until fs-kodlar02 = "10"

                            read kodlar02 next no lock end move "10" to fs-kodlar02
                               not end
                                 if kodlar02-tipi not = "B"
                                   move "10" to fs-kodlar02
                                   else
                                 if Ode-Tipi = "A"
                                    move kodlar02-kodu to xrez-odeme-tipi
                                     move "10" to fs-kodlar02
                                end-if
                                end-if
                           end-read
                        end-perform
                    end-start
                  close kodlar02
                   


            
           end-if

            move function numval(web2-internal-voucher(1:5)) to xREZ-NOR-INDIRIM  
            accept w2log-tarih from century-date
     accept w2log-zaman from time
     move "4528 Fiyat-konttan once xrezgir:" to w2log-data
     move  xrez-gir-tar to  w2log-data(40:)
           move "H" to xrez-fiyat-fix
           move 0 to xrez-plan
         if web2-odeme-tipi = "2"
              initialize xrez-ozel-durum-car xrez-ozel-durum
                move xrez-gir-tar  to gir-tarih
                move xrez-cik-tar  to cik-tarih
                compute s1  = (function INTEGER-OF-DATE(gir-tarih) - 
                             function INTEGER-OF-DATE(cik-tarih))    
                 

                compute xrez-fiyati rounded = web2-dv-tutar / s1

            move "E"             to xrez-fiyat-fix
         end-if
     | write w2log-rec end-write   
         perform fiyat-kont.

 
   
                   initialize  w2log-rec 
              accept w2log-tarih from century-date
              accept w2log-zaman from time
              move "0040     Fiyat alindi  " to w2log-data

              | write w2log-rec end-write 
      if hata-oldu not = 0 then 
         exit paragraph
      end-if
         move web2-adi(1)     to  xrez-adi 
         move web2-soyadi(1)  to  xrez-soyadi  
         move web2-title(1)   to xrez-title

          move web2-adi(2)    to adi2
         move web2-soyadi(2)  to soy2    
         move web2-d-tar(2)   to d-tar2  
         move web2-title(2)   to title2
        

          move web2-adi(3)    to adi3
         move web2-soyadi(3)  to soy3  
         move web2-d-tar(3)   to d-tar3     
         move web2-title(3)   to title3
     
             
          move web2-adi(4)    to adi4
         move web2-soyadi(4)  to soy4  
         move web2-d-tar(4)   to d-tar4
         move web2-title(4)   to title4


           move web2-adi(5)   to adi5
         move web2-soyadi(5)  to soy5 
         move web2-d-tar(5)   to d-tar5
         move web2-title(5)   to title5
          
 
           move web2-adi(6)   to adi6
         move web2-soyadi(6)  to soy6 
         move web2-d-tar(6)   to d-tar6          
         move web2-title(6)   to title6

              move "ASYA"    to xrez-staf 
              initialize xrez-e-mail
              move "I"             to xrez-durumu
              initialize xrez-odano 


                open i-o acenhrk takvim cast
                  move xrez-rec to rez-rec
            
            if "U" =  wislem-tipi
               if web2-cekilen-tut > 0 and genel-web-stil not  = "D"  then  
                   perform onodeme-yaz
                   move 1 to rez-onodeme-var
                 end-if
                
               accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
               accept rez-edit-zaman from time          |                           
                  if web2-erken-giris(1:1) not = spaces
                     move web2-erken-giris(1:1) to rez-vip
                  end-if                
               rewrite rez-rec invalid 
                 move 1 to hata-oldu
                 move "REZ update yapilamadi" to web2-hata-aciklama
                 not invalid
                     perform log-operation-rez
                      initialize  w2log-rec 
                      accept w2log-tarih from century-date
                      accept w2log-zaman from time
                      move "0045     Rez update xgirtar:" to w2log-data
                      move xrez-gir-tar  to w2log-data(30:)
                      move "girtar:" to w2log-data(40:)
                      move rez-gir-tar  to w2log-data(50:)
                      | write w2log-rec end-write 
                        initialize udan-geldi
                        move 1 to udan-geldi
                        perform webrez-yaz
                       perform yanrez-kaydet
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0050     YanRez yazildi" to w2log-data
                              | write w2log-rec end-write  
                                   perform cast-sil    thru cast-sil-exit
                       perform cast-isle    thru cast-isle-exit
                                 initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0055     Cast yazildi" to w2log-data
                              | write w2log-rec end-write  
                      perform acenhrk-isle thru acenhrk-isle-exit 
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0060     Acenhrk yazildi" to w2log-data
                              | write w2log-rec end-write  
                      perform takvim-isle  thru takvim-isle-exit 
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0065     takvim yazildi" to w2log-data
                              | write w2log-rec end-write  
                end-rewrite
           else
                move web2-call-center to rez-call-center
                move tarih-tasi to REZ-ISL-TAR
                MOVE REZ-NO TO REZ-VOUCHER
                 if web2-cekilen-tut > 0 and genel-web-stil not  = "D" then  
                   perform onodeme-yaz
                   move 1 to rez-onodeme-var
                 end-if
                   
                  accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                  accept rez-edit-zaman from time          |                           
                  if web2-erken-giris(1:1) not = spaces
                     move web2-erken-giris(1:1) to rez-vip
                  end-if 
                  write rez-rec invalid 
                     move 1 to hata-oldu
                     move "REZ  yazilamadi" to web2-hata-aciklama
                 not invalid
                  perform log-operation-rez
                      initialize  w2log-rec 
                      accept w2log-tarih from century-date
                      accept w2log-zaman from time
                      move "0045     Rez yazildi" to w2log-data
                      | write w2log-rec end-write 
                      initialize udan-geldi
                      perform webrez-yaz
                       perform yanrez-kaydet
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0050     YanRez yazildi" to w2log-data
                              | write w2log-rec end-write  
                 
                      perform cast-isle    thru cast-isle-exit
                                 initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0055     Cast yazildi" to w2log-data
                              | write w2log-rec end-write  
                      perform acenhrk-isle thru acenhrk-isle-exit 
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0060     Acenhrk yazildi" to w2log-data
                              | write w2log-rec end-write  
                      perform takvim-isle  thru takvim-isle-exit 
                              initialize  w2log-rec 
                              accept w2log-tarih from century-date
                              accept w2log-zaman from time
                              move "0065     takvim yazildi" to w2log-data
                              | write w2log-rec end-write  
                    end-write
            end-if
            
            if web2-odeme-tipi = "2"   
                     open i-o hesayr  
               initialize cast-rec fark-tut hesayr-rec
               compute fark-tut = toplam-cast-fiyati - web2-dv-tutar
               move xrez-no   to cast-rez-no 
               start cast key not < CAST-ANAH1 invalid 
                   continue 
               not invalid 
               perform until fs-cast = "10"
               read cast next no lock end move "10"  to fs-cast
               not at end 
                       if cast-rez-no <> xrez-no
                           exit perform 
                       end-if 
                       initialize rez-rec
                       move xrez-no  to rez-no
                       read rez no lock invalid
                           continue 
                       not invalid 
                       if cast-tarih = rez-cik-tar
                          exit perform cycle 
                       end-if 
                           move 1 to rez-plan
                            
                           accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                           accept rez-edit-zaman from time          |                           
                
                           rewrite rez-rec end-rewrite 
                           perform log-operation-rez
***                move xrez-gir-tar  to gir-tarih
                       move rez-cik-tar  to cik-tarih
                       compute s1  = function INTEGER-OF-DATE(cik-tarih) - 1
                       compute s2 = function DATE-OF-INTEGER(s1)
                       if cast-tarih = s2
                          if fark-tut < 0
                             compute cast-fiyati = cast-fiyati + (fark-tut * -1)
                          else
                             compute cast-fiyati = cast-fiyati - fark-tut
                          end-if 
                          move cast-fiyati to cast-anlasma-fiyati 
                           rewrite cast-rec end-rewrite 
                           perform log-operation-cast                       
                        end-if 

                        initialize hesayr-rec 
                        move cast-tarih to hesayr-tarih
                        move cast-rez-no to hesayr-rez-no
                        read hesayr no lock invalid 
                                continue 
                        not invalid 
                           move cast-fiyati to hesayr-basilacak-tut hesayr-ham-fiyat
                           rewrite hesayr-rec invalid 
                              continue 
                           end-rewrite
                            
                        end-read 

                       end-read 
               end-read 
               end-perform
               end-start
               close hesayr
            end-if
            
              close    acenhrk takvim cast
             
      .
*
 onodeme-yaz.
          
          initialize onodeme-hata konuk-rec
          open i-o exthrk yromhrk hrk2 konuk kur
          
           move genel-onodeme-odano to  KONUK-ODAno           
           move "I" to       KONUK-DURUMU  
           start konuk key = konuk-oda invalid 
             move "Folio uyumsuz " to onodeme-hata  
           not invalid 
            perform until fs-konuk = "10" 

           read konuk next no lock end move "Folio yok " to onodeme-hata move "10" to fs-konuk
                    
                     not end
                   if  "I"  =     KONUK-DURUMU or genel-onodeme-odano  =  KONUK-ODAno then 
                           if konuk-fol-kodu = "E" and konuk-adi(1:3)="WEB"
                          move konuk-folio to  onodeme-folio
                              perform onfolio-ok
                               exit perform 
                          end-if
                          else

                     move "Folio yok " to onodeme-hata move "10" to fs-konuk
                  end-if
           end-read
           end-perform 
           close exthrk yromhrk hrk2 konuk  kur
            .
*
 onfolio-ok.
         accept bugun-tar from century-date
         if bugun-tar < tarih-tasi
            move tarih-tasi to bugun-tar
          end-if
       
           initialize hrk2-rec exthrk-rec yromhrk-rec
          move bugun-tar to kur-tarih t9
          move rez-banka to kur-banka
          move rez-doviz to kur-doviz
          read kur no lock invalid 
                  move function date-of-integer(function integer-of-date(t9) - 1 ) to kur-tarih
                  read kur no lock invalid                           
                       move 1 to doviz-alis 
                  not invalid 
                  continue
                  end-read
          end-read
           if genel-web-stil  = "D"  and kur-doviz = 11

             move EFEKTIF-satis to doviz-alis
          END-IF

          move   kur-tarih  to yromhrk-kur-tarih
 
            open i-o genelfis
            move 1 to genelfis-anahtar
            read genelfis no lock invalid
                 initialize genelfis-rec 
                 move 1 to genelfis-anahtar
                 not invalid continue 
            end-read
            add 1 to cekgir-oto
            
            rewrite genelfis-rec invalid 
                    write genelfis-rec 
        
                    end-write continue
            end-rewrite
            close genelfis.
        
       
          move konuk-folio to  EXTHRK-FOLIO yROMHRK-kaynak-folio   
          move cekgir-oto to EXTHRK-islem.
          move "W" to  EXTHRK-ISLEM-TIPI yROMHRK-ISLEM-TIPI   
          |    EXTHRK-ISLEM-TIPI2   PIC X.
          move bugun-tar to  EXTHRK-TARIH  yROMHRK-TARIH
             
          move genel-web-odeme to  EXTHRK-DEPKOD yROMHRK-DEPKOD       

          MOVE "A" TO  EXTHRK-BA yROMHRK-ba
          move web2-cekilen-tut to  EXTHRK-DV-TUTAR  yROMHRK-DV-TUTAR
          COMPUTE  EXTHRK-TL-TUTAR  ROUNDED  =  DOViz-alis * EXTHRK-DV-TUTAR  
          move  EXTHRK-TL-TUTAR to   yROMHRK-TL-TUTAR
          accept  EXTHRK-ZAMAN from time
          move     EXTHRK-ZAMAN  to    yROMHRK-ZAMAN
         move 1 to EXTHRK-ref
          
          MOVE "WEB " TO   EXTHRK-STAF  hrk2-STAF yROMHRK-STAF      


         move exthrk-anah to hrk2-anah  yromhrk-anah
         move konuk-folio to   hrk2-kaynak-folio
                move rez-no to yromhrk-rez-no
        
              move doviz-alis to   yromhrk-kur-degeri
            
                  move 1 to  yromhrk-dovizli-kk    
                  move EXTHRK-DV-TUTAR to  yromhrk-doviz-tut      
          MOVE EXTHRK-DV-TUTAR TO  hrk2-ger-DV-TUTAR      
          MOVE REZ-BANKA TO hrk2-ger-banka      
          MOVE REZ-DOVIZ TO  hrk2-ger-doviz  yromhrk-doviz-kodu     
          
            write exthrk-rec invalid continue
               not invalid 
                 write yromhrk-rec invalid continue
                    not invalid 
                      write hrk2-rec invalid continue
                       end-write
                       end-write
                       end-write
         
          OPEN I-O ONKASA
          initialize onkasa-rec
       MOVE exthrk-TARIH    TO ONKASA-TARIH.
       MOVE exthrk-DEPKOD   TO ONKASA-DEP.
       READ ONKASA NO LOCK INVALID 
          continue
        end-read
        COMPUTE ONKASA-TUTAR-TL   = ONKASA-TUTAR-TL + extHRK-TL-TUTAR
         COMPUTE ONKASA-TUTAR-DV   = ONKASA-TUTAR-DV + extHRK-DV-TUTAR
       REWRITE ONKASA-REC INVALID WRITE ONKASA-REC END-REWRITE
       CLOSE ONKASA
          open input doviz
         move xrez-doviz to doviz-kodu
         read doviz no lock invalid move "Tanimsiz " to d-kisa-adi
         end-read
         close doviz
         move   web2-cekilen-tut to z-dov
         string 
                 "OO:" delimited by size                                 
                 z-dov delimited by size
                 d-kisa-adi delimited by "  "
                  " " delimited by size
                  rez-adi delimited by "  " 
                  " " delimited by size
                 rez-soyadi delimited by  "  "
                
                 "-" delimited by size
                 rez-no delimited by "  "
                 "-" delimited by size
                 web2-adres delimited by "      "
                
                 
            into form-acik
        

         if form-acik not = spaces then
           open i-o nt
               initialize not-rec
               if konuk-fol-kodu = "R"
                  move  "RHR"     to NOT-DOS
                  move romhrk-anah to  NOT-DOS-ANAH 

                  else
                  move  "EHR"      to NOT-DOS
                  move exthrk-anah to  NOT-DOS-ANAH 

               end-if
               move form-acik to not1

              write not-rec invalid
                continue
              end-write
          
           close nt
         end-if   .


        .
************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 
 webrez-yaz.
     open i-o rezweb depekhiz
     initialize rezweb-rec
     move rez-no to rezweb-rezno 
     read rezweb no lock invalid 
         continue 
     end-read 
     perform varying i from 1 by 1 until i > 3
     
         move web2-extra-adi(i)      to rezweb-extra-adi(i) 
     
         move web2-extra-aciklama(i) to rezweb-extra-aciklama(i)
         move web2-extra-tl-tutar(i) to rezweb-extra-tl-tutar(i)
         move web2-extra-dv-tutar(i) to rezweb-extra-dv-tutar(i)
     end-perform          
         if udan-geldi not =  1
           move web2-eyalet            to rezweb-eyalet         
         end-if
         if web2-kkarti-bilgisi not = spaces
            move web2-kkarti-bilgisi   to rezweb-kredi-karti
         end-if 
         if web2-pkodu not = spaces
            move web2-pkodu            to rezweb-pkodu 
         end-if

         if web2-adres not = spaces
            move web2-adres            to rezweb-adres          
         end-if

         if web2-sehir not = spaces
           move web2-sehir            to rezweb-sehir          
         end-if 
         
         move web2-ulkem            to rezweb-ulkem          
         move web2-not              to rezweb-not            
         move web2-tel              to rezweb-tel            
         move web2-email            to rezweb-email          
         move web2-yatak            to rezweb-yatak          
         move web2-sigara           to rezweb-sigara         
         move web2-erken-giris      to rezweb-erken-giris    
         move web2-gec-cikis        to rezweb-gec-cikis 
         move web2-internal-voucher to rezweb-internal-voucher 
         
         if web2-odeme-tipi = 2
            if web2-cekilen-tut > 0 and web2-cekilen-tut = web2-dv-tutar
               move 9 to rezweb-pkodu               ||| fiks tamamý ödemeli
            end-if 
            if web2-cekilen-tut > 0 and web2-cekilen-tut not = web2-dv-tutar
               move 8 to rezweb-pkodu  ||| fiks kýsmý ödeme
            end-if 
         end-if 

     write rezweb-rec invalid rewrite rezweb-rec end-write
      

     perform depekhiz-yaz-yeni
     close rezweb depekhiz.
*
 depekhiz-yaz-yeni. 
     perform varying i from 1 by 1 until i > 3
       if rezweb-extra-tl-tutar(i) > 0
          initialize depekhiz-rec cift-kayit
          move rezweb-anah to depekhiz-rez        
          move 018         to depekhiz-depkod
          move rezweb-extra-aciklama(i)(1:1)  to ilk-hane
          if ilk-hane > 1  and ilk-hane < 9                 
             perform varying k 
                     from 1 
                     by 1 
                     until k > ilk-hane                               
                        add 1  to depekhiz-sira 
                        perform depekhiz-yaz
                        perform depekhiz-yaz-2
                        move 1 to cift-kayit                                                       
             end-perform
          else
             move 1  to depekhiz-sira
          end-if 
          if cift-kayit not = 1
             if depekhiz-sira = 0
                move 1  to depekhiz-sira
             end-if 
             perform depekhiz-yaz
             perform depekhiz-yaz-2
          end-if  
       end-if
     end-perform 
 
     initialize depekhiz-rec
     move rezweb-rezno to depekhiz-rez
     start depekhiz key not < depekhiz-anahtar invalid 
          continue
     not invalid
     perform until fs-depekhiz = "10"
     read depekhiz next no lock end move "10" to fs-depekhiz
     not at end 
           if depekhiz-rez <> rezweb-rezno
               exit perform 
           end-if 
           compute depekhiz-tutar rounded = depekhiz-tutar / 2
           rewrite depekhiz-rec end-rewrite 
     end-read 
     end-perform
     end-start.
     
*
 depekhiz-yaz.     
*     initialize rez-rec
*     move rezweb-anah to rez-anah
*     read rez no lock invalid
*          continue 
*     not invalid 
         move rez-gir-tar      to depekhiz-tarih
*     end-read 
     move 0                    to depekhiz-tipi(1:1)
     move rez-doviz            to depekhiz-doviz
     move rezweb-extra-dv-tutar(i) to depekhiz-tutar
     move rez-durumu           to depekhiz-durumu
     move rezweb-extra-aciklama(i) to depekhiz-aciklama  
     move "ASYA"               to depekhiz-staf
     accept depekhiz-isl-tarih from century-date
     move " "                  to depekhiz-islem-durumu
     write depekhiz-rec invalid 
         rewrite depekhiz-rec end-rewrite 
     end-write.
*
 depekhiz-yaz-2.
     compute depekhiz-sira = depekhiz-sira + 1
*     initialize rez-rec
*     move rezweb-anah to rez-anah
*     read rez no lock invalid
*          continue 
*     not invalid 
         move rez-cik-tar      to depekhiz-tarih
*     end-read 
     move 1                    to depekhiz-tipi(1:1)
     move rez-doviz            to depekhiz-doviz
     move rezweb-extra-dv-tutar(i) to depekhiz-tutar
     move rez-durumu           to depekhiz-durumu
     move rezweb-extra-aciklama(i) to depekhiz-aciklama  
     move "ASYA"               to depekhiz-staf
     accept depekhiz-isl-tarih from century-date
     move " "                  to depekhiz-islem-durumu
     write depekhiz-rec invalid 
         rewrite depekhiz-rec end-rewrite 
     end-write.



*
 cast-sil. 
     
         initialize cast-rec. 
        move xrez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-sil-bitti. 
 cast-sil-oku. 
        read cast  next no lock end go cast-sil-bitti. 
        if fs-cast = 99 go cast-sil-oku. 
        if cast-rez-no > xrez-no go cast-sil-bitti. 
        if cast-rez-no = xrez-no continue
        else 
           go cast-sil-oku
        end-if.
        if cast-tarih  < xrez-gir-tar or 
           cast-tarih  > xrez-cik-tar
        continue
        else 
           go cast-sil-oku
        end-if.
        delete cast invalid 
          continue.
          perform log-operation-cast
            go cast-sil-oku. 
 cast-sil-bitti. 
       continue.
 cast-sil-exit. 
     exit. 
 cast-isle. 
          
           open input fiyat fiyatana hesayr 
            initialize toplam-cast-fiyati
           move xrez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
              go cast-isle-bitti. 
 cast-yaz-oku. 
        read takvim next no lock end go cast-isle-bitti. 
        if fs-takvim = 99 go cast-yaz-oku. 
        if takvim-anah > xrez-cik-tar go cast-isle-bitti. 
                initialize cast-rec. 
            initialize takasfiyat-rec
           move xrez-no     to  cast-rez-no
           move takvim-anah to   cast-tarih
           
           
             initialize      hesaplanan-fiyat
           if xrez-gir-tar = cast-tarih and xrez-gec = 1 
            initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
           start hesayr key >= hesayr-anah invalid continue
              not invalid
              perform until fs-hesayr = "10"
                  read hesayr previous no lock end move "10" to fs-hesayr
                      not end 
                        if hesayr-rez-no = xrez-no and hesayr-tarih <= xrez-gir-tar
                          add hesayr-basilacak-tut to hesaplanan-fiyat 
                          else
                          move "10" to fs-hesayr
                        end-if
                  end-read
              end-perform
              else
               initialize hesayr-rec
               move cast-rez-no to hesayr-rez-no
               move cast-tarih to hesayr-tarih
               read hesayr no lock 
                      invalid 
                        continue
                  not invalid
                 move  hesayr-basilacak-tut to hesaplanan-fiyat 
               end-read
           end-if   
           if hesaplanan-fiyat = 0 then 
               move xrez-fiyati to hesaplanan-fiyat
            end-if  
        
           initialize eski-cast hesayr-rec
           read cast no lock invalid 
                 continue
                 
               not invalid
                move cast-rec to eski-cast
           end-read
               if xrez-plan not = 1 
                   move hesaplanan-fiyat to cast-fiyati
                   else
                   if cast-tarih = tarih-tasi
                       move hesaplanan-fiyat to cast-fiyati
                   end-if
                end-if
                  move hesaplanan-fiyat to cast-anlasma-fiyati
           if xrez-plan not = 1 or xrez-gir-tar = cast-tarih
                   move xrez-odano        to cast-oda-no
                   move xrez-buyuk        to cast-buyuk
                   move xrez-kucuk        to cast-kucuk
        
                   move xrez-bebek        to cast-bebek
                   move xrez-free         to cast-free
                   move xrez-oda-konumu   to cast-oda-konumu
                   move xrez-fiyat-konumu to cast-fiyat-konumu
                   move xrez-anlasma      to cast-anlasma
                   move xrez-pan-tipi     to cast-pan-tipi
           end-if

       
           if takvim-anah = xrez-cik-tar
               initialize      cast-fiyati  cast-anlasma-fiyati
           end-if
           

*           move xrez-xxx          to cast-oda-adet 
*           move xrez-xxx          to cast-kisi-konaklama
           compute toplam-cast-fiyati = toplam-cast-fiyati + cast-fiyati
                write cast-rec invalid 
                      rewrite cast-rec invalid continue
                      end-rewrite
                end-write
      if cast-rec not = eski-cast(1:function length(cast-rec)) then 
                perform log-operation-cast
        end-if 



            go cast-yaz-oku. 
 cast-isle-bitti. 
           
            close fiyat fiyatana hesayr.
 cast-isle-exit. 
     exit. 
*
 fiyat-kont.

    open input hesayr takvim
     
     initialize linkh-odahes  
        move xrez-no to  linkh-rez-no     
         move 3 to linkh-nereden  
         move 0 to linkh-anl-yaz
         move 0 to linkh-cast-yaz
      
          call "/asya/ytl/obj/otel/odahes.asy" 
                        using   xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
                  accept w2log-zaman from time
     move "4529 odahes sonra xrezgir:" to w2log-data
     move  xrez-gir-tar to  w2log-data(40:)

     | write w2log-rec end-write     
            initialize ig
            move xrez-gir-tar to takvim-anah

            start takvim key = takvim-anah
                invalid
                  move 1 to hata-oldu
                  move "Takvim-yok"  to web2-hata-aciklama 
                  not invalid
                  perform until fs-takvim = "10"
                    read takvim next no lock
                      end move "10" to fs-takvim
                      not end
                      if takvim-anah >= xrez-cik-tar 
                         move "10" to fs-takvim
                         exit perform cycle
                       end-if
           
             
                    initialize hesayr-rec
                    move  xrez-no to hesayr-rez-no
                    move takvim-anah to hesayr-tarih
                      
                      read hesayr  no lock invalid
                          move 1 to hata-oldu
                          move "Fiyat yok " to web2-hata-aciklama

                      not invalid
                      if  hesayr-basilacak-tut not > 0 then  

                            move 1 to hata-oldu
                            move "Fiyat yok " to web2-hata-aciklama
                      else
                         if takvim-anah = xrez-gir-tar 
                             move   hesayr-basilacak-tut  to  xrez-fiyati
                        end-if
                      
                     
                      end-if
                                move xrez-gir-tar to takvim-anah
                  
                   
                              add 1 to ig
                         
                          
                          move  hesayr-basilacak-tut    to  web2-oda-fiyati-gunluk(ig)
                             
                          add   hesayr-basilacak-tut   to  web2-oda-fiyati-toplam
                               
                          move    hesayr-ham-fiyat      to   web2-oda-fiyati-gunluk-ham(ig)
                         
        
                         add    hesayr-ham-fiyat      to    web2-oda-fiyati-ham-toplam
        
                        
                 
        
                         move hesayr-eb-tut   to  web2-oda-fiyati-gunluk-ind-tut(ig,1)   
                          add hesayr-eb-tut   to   web2-oda-fiyati-ind-tut(1)    
                         move "Erken Rezervasyon "  to  web2-oda-fiyati-ind-adi(1)      
                        
                         move  hesayr-ug-tut   to   web2-oda-fiyati-gunluk-ind-tut(ig,2)        
                         add  hesayr-ug-tut   to   web2-oda-fiyati-ind-tut(2)       
                         move "Uzun Geceleme "     to   web2-oda-fiyati-ind-adi(2)     
                      
                         move hesayr-aks1-tut    to   web2-oda-fiyati-gunluk-ind-tut(ig,3)       
                         add hesayr-aks1-tut    to   web2-oda-fiyati-ind-tut(3)                                                                       
                         move  "Son Gece Indirimi"    to   web2-oda-fiyati-ind-adi(3)    
                     
                         
                      
                        move  hesayr-so1-tut    to   web2-oda-fiyati-gunluk-ind-tut(ig,4)          
                         add  hesayr-so1-tut    to   web2-oda-fiyati-ind-tut(4)                                                                      
                        move "Bonus "       to       web2-oda-fiyati-ind-adi(4)   
                      
                    
               


                    end-read
          end-read 
          end-perform 
         end-start
    
              close  hesayr takvim.
            

    
    .
*
 rez-fis-al.
        open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                  initialize genelfis-rec
                  move 1 to genelfis-anahtar
                  add 1  to rez-oto
                  
                  write genelfis-rec invalid
                        rewrite genelfis-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                 
                  add 1 to  print-no
                   add 1  to rez-oto
                 
                  rewrite genelfis-rec end-rewrite
             end-read
             close genelfis
             move rez-oto to xrez-no .
*
 acenhrk-isle. 
********if xrez-tipi = 1 continue else go acenhrk-isle-exit. 
        if xrez-k-g-b = "K" continue
        else 
           go acenhrk-isle-exit
        end-if. 
        
 acenhrk-basla. 
         move xrez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
               go acenhrk-isle-bitti. 

 acenhrk-oku-yaz. 
         read takvim next no lock end 
              go acenhrk-isle-bitti. 
         if fs-takvim = 99 go acenhrk-oku-yaz. 
         if takvim-anah = xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
         if takvim-anah > xrez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
********>Bilbord rezervasyona yazsin..
*         if xrez-bilbord-eh = "E"
*            perform bilbord-isle thru bilbord-isle-exit
*         end-if.
********>Bilbord rezervasyona yazsin...
         if fark-yok 
            go acenhrk-oku-yaz
         end-if
           move ac-kont to acenhrk-acenta
*****          move xrez-acenta      to acenhrk-acenta. 
          move takvim-anah      to acenhrk-tarih. 
          move xrez-fiyat-konumu  to acenhrk-oda-konumu. 
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
              invalid  
                  initialize acenhrk-rec  
                     move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g
                  move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
         end-write 
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue end-rewrite  
         end-read  
           move ac-kont to acenhrk-acenta

****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41 to acenhrk-oda-konumu  
          move xrez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
           invalid  
                  initialize acenhrk-rec 
                    move ac-kont to acenhrk-acenta
****                 move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move xrez-s-d-t-g     to acenhrk-s-d-t-g  
                   move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write  
           not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
           move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move xrez-fiyat-konumu  to acenhrk-oda-konumu  
          move 5     to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid 
                  initialize acenhrk-rec 
                   move ac-kont to acenhrk-acenta 
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move xrez-fiyat-konumu  to acenhrk-oda-konumu  
                  move 5     to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write 
         not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
            move ac-kont to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41  to acenhrk-oda-konumu  
          move 5    to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid
                  initialize acenhrk-rec  
                    move ac-kont to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move 5   to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  write acenhrk-rec invalid 
                       rewrite acenhrk-rec invalid continue
                       end-rewrite
                  end-write
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + xrez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + xrez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + xrez-bebek  
                  rewrite acenhrk-rec invalid continue
                  end-rewrite
         end-read
         go acenhrk-oku-yaz. 
 acenhrk-isle-bitti. 
       
 acenhrk-isle-exit. 
      exit. 


 
 takvim-isle. 
        if xrez-k-g-b = "K" continue
        else 
           go takvim-isle-exit
        end-if. 
        move xrez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go takvim-isle-exit. 
 takvim-oku-yaz. 
        read takvim next no lock end go takvim-isle-exit. 
        if fs-takvim = 99 go takvim-oku-yaz. 
        if takvim-anah = xrez-cik-tar go takvim-isle-exit. 
        if takvim-anah > xrez-cik-tar go takvim-isle-exit. 
          compute takvim-sat-oda(xrez-oda-konumu)   = 
                  takvim-sat-oda(xrez-oda-konumu)   + 1. 
          compute takvim-sat-buyuk(xrez-oda-konumu) = 
                  takvim-sat-buyuk(xrez-oda-konumu) + xrez-buyuk. 
          compute takvim-sat-kucuk(xrez-oda-konumu) = 
                  takvim-sat-kucuk(xrez-oda-konumu) + xrez-kucuk. 
          compute takvim-sat-free(xrez-oda-konumu)  = 
                  takvim-sat-free(xrez-oda-konumu)  + xrez-free. 
          compute takvim-sat-free(xrez-oda-konumu)  = 

                  takvim-sat-free(xrez-oda-konumu)  + xrez-bebek.
        rewrite takvim-rec invalid go takvim-oku-yaz. 
            go takvim-oku-yaz. 
 takvim-isle-exit. 
     exit. 
*
*
 ortak-yanrez.
      move rez-no      to yanrez-rezno
      move rez-gir-tar to yanrez-gel-tar
      move rez-cik-tar to yanrez-git-tar
      move rez-odano   to yanrez-odano.
*
 yanrez-kaydet.
       open i-o yanrez
       initialize yanrez-rec
       move 1 to yanrez-sirano
       move rez-adi    to yanrez-adi
       move rez-soyadi to yanrez-soyadi
       move mis-no     to yanrez-profil-no
       move ps1        to yanrez-profil-sirket
      

       perform ortak-yanrez

       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
          
    
    if adi2 not = spaces or 
       soy2 not = spaces then
       initialize yanrez-rec
       move 2 to yanrez-sirano
       move adi2   to yanrez-adi
       move soy2   to yanrez-soyadi
       move d-tar2 to yanrez-dog-tar
       move pno2   to yanrez-profil-no
       move ps2    to yanrez-profil-sirket
       move title2 to yanrez-title
       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           
     else
         move rez-no      to yanrez-rezno
         move 2 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
            
    end-if
    if adi3 not = spaces or soy3 not = spaces then
       initialize yanrez-rec
       move 3 to yanrez-sirano
       move adi3   to yanrez-adi
       move soy3   to yanrez-soyadi
       move d-tar3 to yanrez-dog-tar
       move pno3   to yanrez-profil-no
       move ps3    to yanrez-profil-sirket
       move title3 to yanrez-title

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
          
        else
         move rez-no      to yanrez-rezno
         move 3 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             
    end-if
    if adi4 not = spaces or soy4 not = spaces then
       initialize yanrez-rec
       move 4 to yanrez-sirano
       move adi4   to yanrez-adi
       move soy4   to yanrez-soyadi
       move d-tar4 to yanrez-dog-tar
       move pno4   to yanrez-profil-no
       move ps4    to yanrez-profil-sirket
       move title4 to yanrez-title

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite
       end-write
           
       else
         move rez-no      to yanrez-rezno
         move 4 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             
    end-if
    if adi5 not = spaces or soy5 not = spaces then
       initialize yanrez-rec
       move 5 to yanrez-sirano
       move adi5   to yanrez-adi
       move soy5   to yanrez-soyadi
       move d-tar5 to yanrez-dog-tar
       move pno5   to yanrez-profil-no
       move ps5    to yanrez-profil-sirket
       move title5 to yanrez-title

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           
       else
         move rez-no      to yanrez-rezno
         move 5 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             
    end-if
    if adi6 not = spaces or soy6 not = spaces then
       initialize yanrez-rec
       move 6      to yanrez-sirano
       move adi6   to yanrez-adi
       move soy6   to yanrez-soyadi
       move d-tar6 to yanrez-dog-tar
       move pno6   to yanrez-profil-no
       move ps6    to yanrez-profil-sirket
       move title6 to yanrez-title

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
          
       else
         move rez-no      to yanrez-rezno
         move 6 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             
    end-if

    if adi7 not = spaces or soy7 not = spaces then
       initialize yanrez-rec
       move 7 to yanrez-sirano
       move adi7   to yanrez-adi
       move soy7   to yanrez-soyadi
       move d-tar7 to yanrez-dog-tar
       move pno7   to yanrez-profil-no
       move ps7    to yanrez-profil-sirket
       move title7 to yanrez-title

       perform ortak-yanrez
       write yanrez-rec invalid 
             rewrite yanrez-rec end-rewrite 
       end-write
           
       else
         move rez-no      to yanrez-rezno
         move 7 to yanrez-sirano
         delete yanrez invalid continue 
         end-delete
             
    end-if

    close yanrez.
*
 log-dos.
                    
                      initialize  w2log-rec 
                      accept w2log-tarih from century-date
                      accept w2log-zaman from time

                           call "c$rerr" using extend-stat text-message 1.
                            move extend-stat       to fileerr-linkage-hata-no.
                            move Secondary-Error   to fileerr-linkage-secondary-hata-no.
                        
                            call "c$rerrname" using fileerr-linkage-dosya-adi.
                             move fileerr-linkage-hata-no to w2log-data(15:)
                             move fileerr-linkage-dosya-adi to  w2log-data(20:)
                      move "5555-Hata-No:" to w2log-data(1:10)
                      move w2log-data to web2-hata-aciklama
                      move 1 to hata-oldu
                      | write w2log-rec end-write 
                      . 
*
 Form1-Aft-Routine.
       close w2log move calisma-tarihi to tarih-tasi. 
     .
*
 g1-Ev-Msg-Begin-Entry.
           inquire g1, x in sut y in sat
     
        if web2-rez-no > 0 and sat = 19 then 
           
           move event-action-fail to event-action
                initialize dokcagir-tasi
                move web2-rez-no             to dokcagir-rez-no
                set dokcagir-tasi-call-rez1     to true
               
                perform dokcagir-call
       
         end-if             
     
     .
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*

 
