* lap2asy.evt
* lap2asy.evt is generated from D:\asya\acugt.ytl\otel\lap2asy.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-Form1-Event-Extra.
     EVALUATE Event-Type
     WHEN Msg-Close
        PERFORM Acu-Form1-Msg-Close
     END-EVALUATE
     .

 Acu-Form1-Msg-Close.
     ACCEPT Quit-Mode-Flag FROM ENVIRONMENT "QUIT_MODE"
     IF Quit-Mode-Flag = ZERO
        PERFORM Acu-Form1-Exit
        PERFORM Acu-Exit-Rtn
     END-IF
     .

 Form1-Event-Proc.
* 
     PERFORM Acu-Form1-Event-Extra
     PERFORM Form1-Ev-Other
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .

 Form1-Pb-1-Event-Proc.
     PERFORM Form1-Pb-1-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
       accept isyeri-adres-tasi from command-line
       set environment "RENEW_TIMEOUT" to 1
       perform adresleri-tasi
       open input genel
       initialize genel-rec
       move 1    to genel-anahtar
       read genel no lock invalid
            display message box "Onburo Calisma Parametreleri Tanimsiz..."
                            title "[ Uyari ]"
                            icon 1
            set exit-pushed to true 
       end-read
       close genel.
*
 Form1-Aft-Initdata.
     set environment "RENEW_TIMEOUT" to 1.
     perform thread zamanla.
     perform lapis-yaz.
*
 zamanla.
    move 5 to kalan
    perform with test after until 1 = 0
            call "c$sleep" using 1
            subtract 1 from kalan
            if kalan = 0
               if islemde <> "E"
                  perform lapis-yaz
                  move 180 to kalan
               else
                  move 120 to kalan
               end-if
            end-if
            display lb-kalan
    end-perform. 
*
 lapis-yaz.
        
        modify Form1-St-1-Handle,            
           panel-index = 3
           panel-text  = "Status :Active"

        move "Start Date :"   to start-status-t 
        accept ilk-tar from century-date 
        move ilk-yil     to eyil
        move ilk-ay      to eay
        move ilk-gun     to egun
        move etarih      to ytarih

        modify Form1-St-1-Handle,            
           panel-index = 4
           panel-text  = netarih 

        move "Start Time :"   to start-status
        accept zaman from time 
        move saat   to esaat 
        move dakika to edakika 
        move saniye to esaniye 
        move ezaman to yzaman

        modify Form1-St-1-Handle,            
           panel-index = 5
           panel-text  = nezaman 

     modify Form1-Gd-1, RESET-GRID = 1
                        mass-update = 1
     initialize form1-gd-1-record
     move "Sira"          to gd-1-col-1
     move "Tarih"         to gd-1-col-2
     move "Zaman"         to gd-1-col-3
     move "Bilgi"         to gd-1-col-4
     move "Isl No"        to gd-1-col-5
     move "Durumu"        to gd-1-col-6
     modify Form1-Gd-1, RECORD-TO-ADD(form1-gd-1-record)
     modify form1-gd-1, mass-update = 0                       

       open input genel
       initialize genel-rec
       move 1    to genel-anahtar
       read genel no lock invalid
            display message box "Onburo Calisma Parametreleri Tanimsiz..."
                            title "[ Uyari ]"
                            icon 1
            set exit-pushed to true 
       end-read
       close genel

       open i-o lpsentgr konuk romhrk onbkodlar10 onkasa exthrk fatdetay lapkont nt yromhrk hrk2 silhrk
       open input  depkod  
       initialize lpsentgr-rec hata   degisiklik-kaydi
       move 0                   to lapis-asya-islendi
       move 0                   to kayit-adet 
       start lpsentgr key not < lapis-anah-2 invalid
             continue
       not invalid
       perform with test after until fs-lpsentgr = "10"
       read lpsentgr next no lock end move "10"  to fs-lpsentgr
       not at end
*/hatali kayit kontrol dosyasi
               if lapis-asya-islendi = 1
                  exit perform 
               end-if

               initialize hata
               add 1                           to kayit-adet  
               initialize form1-gd-1-record 
               move kayit-adet                 to ekayit-adet
               move ekayit-adet                to gd-1-col-1

               move lapis-yil                  to eyil
               move lapis-ay                   to eay
               move lapis-gun                  to egun
               move etarih                     to gd-1-col-2

               accept zaman from time 

               move saat                       to esaat
               move dakika                     to edakika
               move saniye                     to esaniye
               move ezaman                     to gd-1-col-3

               initialize lapkont-rec 
               move lapis-islem-no             to lapkont-islem-no
               read lapkont no lock invalid
                     move lpsentgr-rec         to lapkont-rec
                     write lapkont-rec end-write 
               not invalid 

                    if lapis-tarih <> lapkont-tarih
                       move "Kayit Tarihi Degismis"   to lapkont-hata-acik gd-1-col-4
                       move 1                         to lapkont-hata-kodu
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5
                       move "Hata"                    to gd-1-col-6
                       move 1                         to hata            
                       rewrite lapkont-rec end-rewrite
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle 
                    end-if
                       
                    if lapis-asya-anah <> lapkont-asya-anah
                       move "Asya Anahtar Hatali"     to lapkont-hata-acik gd-1-col-4
                       move 2                         to lapkont-hata-kodu
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5
                       move 1                         to hata
                       move "Hata"                    to gd-1-col-6 
                       rewrite lapkont-rec end-rewrite
                       modify form1-gd-1,record-to-add(form1-gd-1-record) 
                       exit perform cycle                        
                    end-if

                    if lapis-depkod <> lapkont-depkod
                       move "Departman Kodu Degismis"     to lapkont-hata-acik gd-1-col-4
                       move 3                             to lapkont-hata-kodu
                       move lapis-islem-no                to eislem 
                       move eislem                        to gd-1-col-5
                       move 1                             to hata
                       move "Hata"                        to gd-1-col-6 
                       rewrite lapkont-rec end-rewrite 
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle                        
                    end-if

                    if lapis-folio-no <> lapkont-folio-no
                       move "Folio Numarasi Degismis"     to lapkont-hata-acik gd-1-col-4
                       move 4                             to lapkont-hata-kodu
                       move lapis-islem-no                to eislem 
                       move eislem                        to gd-1-col-5
                       move 1                             to hata
                       move "Hata"                        to gd-1-col-6
                       rewrite lapkont-rec end-rewrite 
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle                        
                    end-if

                    if lapis-tutar-tl <> lapkont-tutar-tl and 
                       lapis-tarih <> lapkont-tarih
                       move "TL Tutari Degismis"          to lapkont-hata-acik gd-1-col-4
                       move 5                             to lapkont-hata-kodu
                       move lapis-islem-no                to eislem 
                       move eislem                        to gd-1-col-5
                       move 1                             to hata
                       move "Hata"                        to gd-1-col-6
                       rewrite lapkont-rec end-rewrite 
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle                        
                    end-if

                    if lapis-tutar-dv <> lapkont-tutar-dv  and 
                       lapis-tarih <> lapkont-tarih
                       move "Dv Tutari Degismis"          to lapkont-hata-acik gd-1-col-4
                       move 6                             to lapkont-hata-kodu
                       move lapis-islem-no                to eislem 
                       move eislem                        to gd-1-col-5
                       move 1                             to hata
                       move "Hata"                        to gd-1-col-6
                       rewrite lapkont-rec end-rewrite 
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle                        
                    end-if

                    if lapis-dv-kodu <> lapkont-dv-kodu
                       move "Doviz Kodu Degismis"         to lapkont-hata-acik gd-1-col-4
                       move 7                             to lapkont-hata-kodu
                       move lapis-islem-no                to eislem 
                       move eislem                        to gd-1-col-5
                       move 1                             to hata
                       move "Hata"                        to gd-1-col-6
                       rewrite lapkont-rec end-rewrite 
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle                        
                    end-if

                    if lapis-DOV-BOZ-ANAH <> lapkont-DOV-BOZ-ANAH
                       move "Doviz Bozumu Degismis"       to lapkont-hata-acik gd-1-col-4
                       move 8                             to lapkont-hata-kodu
                       move lapis-islem-no                to eislem 
                       move eislem                        to gd-1-col-5
                       move 1                             to hata
                       move "Hata"                        to gd-1-col-6
                       rewrite lapkont-rec end-rewrite 
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle                        
                    end-if
                  
               end-read
                
               if  lapis-folio-no not > 0                  
               
                    move  "0 Folio No "      to lapkont-hata-acik gd-1-col-4
                       move lapis-islem-no              to eislem 
                       move eislem                      to gd-1-col-5
                       move 1                           to hata
                       move "Hata"                      to gd-1-col-6

                       rewrite lapkont-rec end-rewrite
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                    exit perform cycle
               end-if
               initialize konuk-rec
               move lapis-folio-no                      to konuk-folio
               read konuk no lock invalid
                    move  "Folio No Bulunamadi..."      to lapkont-hata-acik gd-1-col-4
                       move lapis-islem-no              to eislem 
                       move eislem                      to gd-1-col-5
                       move 1                           to hata
                       move "Hata"                      to gd-1-col-6

                       rewrite lapkont-rec end-rewrite
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                    exit perform cycle 
               not invalid
                    if konuk-durumu not = "I"
*/kontrol dosyasýna hata durumunu yaz  
                       move "Folio Inhouse Degil"       to lapkont-hata-acik gd-1-col-4
                       move lapis-islem-no              to eislem 
                       move eislem                      to gd-1-col-5
                       move 1                           to hata
                       move "Hata"                      to gd-1-col-6
                       rewrite lapkont-rec end-rewrite
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle
                    end-if
                          
                    if lapis-tarih >= konuk-gel-tar and
                       lapis-tarih <= konuk-git-tar 
******                       lapis-tarih = calisma-tarihi
                           continue 
                    else 
                       move "C/In - C/Out Tarihi Disindaki Kayit"        to lapkont-hata-acik gd-1-col-4
                       move lapis-islem-no              to eislem 
                       move eislem                      to gd-1-col-5
                       move 1                           to hata
                       move "Hata"                      to gd-1-col-6
                       rewrite lapkont-rec end-rewrite
                       modify form1-gd-1,record-to-add(form1-gd-1-record)
                       exit perform cycle 
                    end-if                                        
                    if konuk-acik-kapali = "C"
*/kontrol dosyasýna hata durumunu yaz  
                       move "Kapali Folio"              to lapkont-hata-acik gd-1-col-4
                       move lapis-islem-no              to eislem 
                       move eislem                      to gd-1-col-5
                       move 1                           to hata
                       move "Hata"                      to gd-1-col-6
                       rewrite lapkont-rec end-rewrite  
                       modify form1-gd-1,record-to-add(form1-gd-1-record) 
                       exit perform cycle
                    end-if
               end-read
               if lapis-tarih < calisma-tarihi
                       move "Gecmis Tarihe Kayit Bildirimi"              to lapkont-hata-acik gd-1-col-4
                       move lapis-islem-no              to eislem 
                       move eislem                      to gd-1-col-5
                       move 1                           to hata
                       move "Hata"                      to gd-1-col-6
                       rewrite lapkont-rec end-rewrite  
                       modify form1-gd-1,record-to-add(form1-gd-1-record) 
                       exit perform cycle
               end-if 

               initialize depkod-rec
               move lapis-depkod                                 to depkod-anah  
               read depkod no lock invalid
                      move "Departman Kodu Tanimsiz.."           to lapkont-hata-acik  gd-1-col-4
                      move lapis-islem-no                        to eislem 
                      move eislem                                to gd-1-col-5
        
                      move "Hata"                                to gd-1-col-6
                      rewrite lapkont-rec end-rewrite
                      move 1                                     to hata
                      modify form1-gd-1,record-to-add(form1-gd-1-record)
                      exit perform cycle
*/kontrol dosyasýna hata durumunu yaz  
               end-read
*/lapis-islem-no sýfýrdan küçükse (örnekk -22586) nakit ve kredi kartý kaydýdýr.
               if lapis-asya-anah < "A" and
                  lapis-islem-no > 0
                   
                    if lapis-tarih > calisma-tarihi
                       move calisma-tarihi   to lapis-tarih
                    end-if
*/spa programlarinda gunsonu kavrami olmadigi icin saat 12 den sonra diger gunun tarihinde kayit geliyor
*/yukaridaki if kosulu bunun icin konulmustur.Ramazan 
                    
**                  lapis-tarih = calisma-tarihi
                   perform lapis-fis-al|yeni kayit
                   perform romhrk-yaz|yeni kayit

*                   if lapis-dv-kodu not = "10" and |tl hariç diðer dovizler için döviz bozumu yapýlýyor
*                      lapis-islem-no < 0  and 
*                      lapis-tarih = calisma-tarihi
*                         perform doviz-fis-no-al
*                         perform doviz-boz
*                   end-if

*                   open input kodlar02
*                   initialize kodlar02-rec
*                   move konuk-odeme-tipi  to kodlar02-kodu
*                   move "B"               to kodlar02-tipi
*                   read kodlar02 no lock invalid
*                        continue
*                   not invalid
*                       if ode-tipi = "B"
*                            perform lapis-fis-al
*                            close kodlar02
*                            perform kredi-yaz
*                            open input kodlar02
*                       end-if
*                   end-read
*                   close kodlar02

                   if lapis-asya-silindi = 1
                      if lapis-tarih = calisma-tarihi
*                         perform dov-boz-sil|kayit lapisden silindiyse tekrar asyaya iþlenmiyor
                         perform lapis-sil|lapisden silme yapýlmýþ.
                    
                      else
                         move "Gecmis Tarihe Silme Kaydi"    to lapkont-hata-acik
                         move 1                         to hata
                         rewrite lapkont-rec end-rewrite
                         modify form1-gd-1,record-to-add(form1-gd-1-record)
                         exit perform cycle 
                      end-if
                   end-if

               else
                  
                   if lapis-asya-silindi = 1
                      if lapis-tarih = calisma-tarihi
*                         perform dov-boz-sil
                         perform lapis-sil                                                 
                      else
                         move "Gecmis Tarihe Silme Kaydi"    to lapkont-hata-acik
                         move 1                              to hata
                         rewrite lapkont-rec end-rewrite
                         modify form1-gd-1,record-to-add(form1-gd-1-record) 
                         exit perform cycle 
                      end-if
                   else

                       
*                       if lapis-dv-kodu not = "10" and |tl hariç diðer dovizler için döviz bozumu yapýlýyor
*                          lapis-islem-no < 0 and 
*                          lapis-tarih = calisma-tarihi
*                              perform dov-boz-sil|döviz silindi
*                              perform doviz-fis-no-al|silinen döviz yeni haliyle  tekrar yazýlýyor
*                              perform doviz-boz|silinen döviz yeni haliyle tekrar  yazýlýyor
*                       end-if

                       if lapis-tutar-tl = lapkont-tutar-tl and
                          lapis-tutar-dv = lapkont-tutar-dv or
                          lapis-tarih = calisma-tarihi

                             perform lapis-sil
                             perform tutar-kontrol
                             move "Duzeltme Kaydi"      to lapkont-hata-acik
                       else
                          move "Gecmis Tarihe Duzeltme Kaydi"   to lapkont-hata-acik
                          move 1                         to hata
                          rewrite lapkont-rec end-rewrite 
                          modify form1-gd-1,record-to-add(form1-gd-1-record) 
                          exit perform cycle 
                       end-if

                   end-if
               end-if

               if hata not = 1
                  move lapkont-rec           to gd-1-col-4
                  move lapis-islem-no        to eislem 
                  move eislem                to gd-1-col-5
                  move "Islendi"             to gd-1-col-6
                  move lpsentgr-rec             to lapkont-rec
                  accept lapkont-isl-tarih from century-date 
                  accept lapkont-isl-zaman from time
                  rewrite lapkont-rec end-rewrite 
                 
          
                  initialize onbkodlar10-rec 
                       move  "EE" to  onbkodlar10-tipi                          
                  read onbkodlar10 no lock invalid
                     continue                          
                  end-read                     
                      accept onbkodlar10-santral-tarih from century-date
                      accept  onbkodlar10-santral-zaman from time
                      write onbkodlar10-rec invalid rewrite onbkodlar10-rec end-write
                  

               end-if

               modify Form1-Gd-1, RECORD-TO-ADD(form1-gd-1-record)|gride kayit gönderiliyor

       end-read
       end-perform
       end-start
       close konuk lpsentgr depkod  lapkont onbkodlar10 romhrk onkasa nt exthrk fatdetay yromhrk hrk2 silhrk.
*
 lapis-sil.
       
       if konuk-fol-kodu = "R"
          perform romhrk-sil
       else 
          perform exthrk-sil
       end-if
       if hata = 1
          initialize hata
          open input konu2  
            perform yromhrk-sil 
          close konu2 
       end-if .

*
 yromhrk-sil. 
       initialize sil-degiskenler.
       move lapis-asya-anah(2:)             to yromhrk-anah
       read yromhrk no lock invalid 
            move 1                          to hata
            move "Yanlis Silinme Kaydi yromhrk"     to lapkont-hata-acik
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5
                       move 1                         to hata
            move "Hata"                     to gd-1-col-6
            rewrite lapkont-rec end-rewrite 
       not invalid 
                move yromhrk-folio     to sil-folio 
                move yromhrk-depkod    to sil-depkod
                move yromhrk-ba        to sil-ba
                move yromhrk-tl-tutar  to sil-tl-tutar
                move yromhrk-dv-tutar  to sil-dv-tutar

                if konuk-fol-kodu = "R"
                   initialize konu2-rec
                   move yromhrk-kaynak-folio to konu2-folio
                   read konu2 no lock invalid 
                       continue 
                   not invalid 
                       if konu2-durumu not = "I"
                          move "kaynak Folio Inhouse Degil"       to lapkont-hata-acik gd-1-col-4
                          move lapis-islem-no              to eislem 
                          move eislem                      to gd-1-col-5
                          move 1                           to hata
                          move "Hata"                      to gd-1-col-6
                          rewrite lapkont-rec end-rewrite
                          modify form1-gd-1,record-to-add(form1-gd-1-record)
                           
                          exit paragraph
                       end-if 
                       if konuk-acik-kapali = "C"  
                          move "kaynak Kapali Folio"              to lapkont-hata-acik gd-1-col-4
                          move lapis-islem-no              to eislem 
                          move eislem                      to gd-1-col-5
                          move 1                           to hata
                          move "Hata"                      to gd-1-col-6
                          rewrite lapkont-rec end-rewrite  
                          modify form1-gd-1,record-to-add(form1-gd-1-record)                                  
                                  exit paragraph
                       end-if

                   end-read 

                   initialize romhrk-rec
                   move yromhrk-kaynak-folio   to romhrk-folio
                   move yromhrk-islem          to romhrk-islem
                   read romhrk no lock invalid 
                        continue 
                   not invalid 
                      delete romhrk invalid 
                           continue
                      end-delete
                      perform log-operation-romhrk
                   end-read 
                   move romhrk-anah      to hrk2-anah
                   read hrk2 no lock invalid
                        continue
                   not invalid
                       delete hrk2 end-delete
                   end-read
                   move romhrk-rec to silhrk-rec
                   delete yromhrk invalid 
                       continue 
                   end-delete                  
                else 
                   initialize exthrk-rec
                   move yromhrk-kaynak-folio   to exthrk-folio
                   move yromhrk-islem          to exthrk-islem
                   read exthrk no lock invalid 
                        continue 
                   not invalid 
                      delete exthrk invalid 
                           continue
                      end-delete
                      perform log-operation-exthrk
                   end-read 
                   move exthrk-anah              to hrk2-anah
                   read hrk2 no lock invalid
                        continue
                   not invalid
                       delete hrk2 end-delete
                   end-read
                   move exthrk-rec to silhrk-rec
                   delete yromhrk invalid 
                       continue 
                   end-delete 
                end-if                 

                accept silhrk-zaman from time 

                accept silhrk-tarih from century-date
                move k-kodu-tasi    to silhrk-staf
                if hata not = 1 
                   move 1 to lapis-asya-islendi  |eðer lapisden kayýt silindiyse asyadan da sil ve iþlendiyi 1 yap yoksa yromhrk stop " " a düþer 
               
                   rewrite lpsentgr-rec end-rewrite
               
                  write silhrk-rec invalid 
                       continue
                   end-write
                end-if

               perform onkasa-eksilt thru onkasa-eksilt-exit
               perform konuk-eksilt  thru konuk-eksilt-exit
            end-read.
*
 romhrk-sil.
 
       initialize sil-degiskenler.
       move lapis-asya-anah(2:)             to romhrk-anah
       read romhrk no lock invalid 
            move 1                          to hata
            move "Yanlis Silinme Kaydi"     to lapkont-hata-acik
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5
                       move 1                         to hata
            move "Hata"                     to gd-1-col-6
            rewrite lapkont-rec end-rewrite 
       not invalid 
                move romhrk-folio     to sil-folio 
                move romhrk-depkod    to sil-depkod
                move romhrk-ba        to sil-ba
                move romhrk-tl-tutar  to sil-tl-tutar
                move romhrk-dv-tutar  to sil-dv-tutar
                
                delete romhrk invalid 
                    exit paragraph
                end-delete
                perform log-operation-romhrk
                move romhrk-anah      to hrk2-anah
                read hrk2 no lock invalid
                     continue
                not invalid
                    delete hrk2 end-delete
                end-read
                move hrk2-kaynak-folio     to yromhrk-folio
                move romhrk-islem          to yromhrk-islem
                read yromhrk no lock invalid
                     continue
                not invalid
                    delete yromhrk end-delete
                end-read
*******>Sil    inmis kayitlara yaz
                move romhrk-rec to silhrk-rec
                accept silhrk-zaman from time 
****                move calisma-tarihi to silhrk-tarih
                accept silhrk-tarih from century-date
                move k-kodu-tasi to silhrk-staf
                if hata not = 1 
                   move 1 to lapis-asya-islendi  |eðer lapisden kayýt silindiyse asyadan da sil ve iþlendiyi 1 yap yoksa yromhrk stop " " a düþer 
               
                   rewrite lpsentgr-rec end-rewrite
               
                   write silhrk-rec invalid 
                       continue
                   end-write
                end-if

*               close silhrk  

               perform onkasa-eksilt thru onkasa-eksilt-exit
               perform konuk-eksilt  thru konuk-eksilt-exit
            end-read.
*
 exthrk-sil.
*       open i-o silhrk  .
       initialize sil-degiskenler.
       move lapis-asya-anah(2:)      to exthrk-anah
       read exthrk no lock invalid 
            move 1                          to hata
            move "Yanlis Silinme Kaydi"     to lapkont-hata-acik
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5
                       move 1                         to hata
            move "Hata"                     to gd-1-col-6
            rewrite lapkont-rec end-rewrite 
       not invalid 
            move exthrk-folio     to sil-folio 
            move exthrk-depkod    to sil-depkod
            move exthrk-ba        to sil-ba
            move exthrk-tl-tutar  to sil-tl-tutar
            move exthrk-dv-tutar  to sil-dv-tutar
            delete exthrk invalid exit paragraph
            end-delete.
            perform log-operation-exthrk
            move exthrk-anah      to hrk2-anah
            read hrk2 no lock invalid
                 continue
            not invalid
                delete hrk2 end-delete
            end-read
            move hrk2-kaynak-folio     to yromhrk-folio
            move exthrk-islem          to yromhrk-islem
            read yromhrk no lock invalid
                 continue
            not invalid
                delete yromhrk end-delete
            end-read

*******>Silinmis kayitlara yaz
            move exthrk-rec to silhrk-rec
            accept silhrk-zaman from time 
            accept silhrk-tarih from century-date
            move k-kodu-tasi to silhrk-staf
            if degisiklik-kaydi not = 1
               move 1 to lapis-asya-islendi     |eðer lapisden kayýt silindiyse asyadan da sil ve iþlendiyi 1 yap yoksa yromhrk stop " " a düþer 
               rewrite lpsentgr-rec end-rewrite

               write silhrk-rec invalid 
                   continue
               end-write
            end-if
*            close silhrk  .

            perform onkasa-eksilt thru onkasa-eksilt-exit

            perform konuk-eksilt  thru konuk-eksilt-exit
                 .
*
 konuk-eksilt.
    move sil-folio to konuk-folio.
    read konuk no lock invalid 
         go konuk-eksilt-exit
         not invalid continue
    end-read.
    if sil-ba = "B"
       compute konuk-top-borc = konuk-top-borc - sil-tl-tutar.
    if sil-ba = "A"
       compute konuk-top-alac = konuk-top-alac - sil-tl-tutar.
    rewrite konuk-rec invalid continue.
 konuk-eksilt-exit.
      exit.
* 
 onkasa-eksilt.
       move calisma-tarihi        to onkasa-tarih.
       move sil-depkod        to onkasa-dep.
       read onkasa no lock invalid 
            go onkasa-eksilt-exit
            not invalid continue 
       end-read.
       compute onkasa-tutar-tl   = onkasa-tutar-tl - sil-tl-tutar.
       compute onkasa-tutar-dv   = onkasa-tutar-dv - sil-dv-tutar.
       rewrite onkasa-rec invalid continue.
 onkasa-eksilt-exit.
       exit.
*
 tutar-kontrol.
       perform lapis-fis-al
       perform romhrk-yaz.
*
 romhrk-yaz. 
     initialize hrkgir-rec
     move konuk-folio                        to hrkgir-folio
     move cekgir-oto                         to hrkgir-islem 
   
     move "E"                                to hrkgir-islem-tipi 
     move lapis-tarih to hrkgir-tarih                
     accept hrkgir-zaman                     from time 
          call "c$justify" using lapis-adisyon-no ,"R"
     move lapis-adisyon-no                   to hrkgir-cekno 
     move "LPIS"                             to hrkgir-staf 
     move lapis-tutar-tl                     to hrkgir-tl-tutar
     move lapis-tutar-dv                     to hrkgir-dv-tutar

     call "c$justify" using lapis-depkod ,"R"
     inspect lapis-depkod replacing all spaces by zeroes   

     initialize depkod-rec
     move lapis-depkod                                 to depkod-anah hrkgir-depkod
     read depkod no lock invalid
            move "Departman Kodu Tanimsiz.."           to lapkont-hata-acik  gd-1-col-4
            move lapis-islem-no                        to eislem 
            move eislem                                to gd-1-col-5

            move "Hata"                                to gd-1-col-6
            rewrite lapkont-rec end-rewrite
            move 1                                     to hata
*/kontrol dosyasýna hata durumunu yaz  
     not invalid
           move depkod-ba                    to hrkgir-ba 
     end-read

********************kopyalanacak
    open input route konu2 rez kodlar02
*    open i-o yromhrk

    move hrkgir-rec  to yromhrk-rec
    move hrk2-data   to yromhrk-data
    write yromhrk-rec invalid 
           move "Yromhrk Bulunamadi..."      to lapkont-hata-acik  gd-1-col-4
           move 1                            to hata
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5

            move "Hata"                     to gd-1-col-6
           rewrite lapkont-rec end-rewrite  
    end-write 
*    close yromhrk
    
    perform folref-bul
    perform folref-ata
    close route konu2 rez kodlar02
*    open i-o hrk2
    move hrkgir-anah                      to hrk2-anah
    move yromhrk-folio                    to hrk2-kaynak-folio
    write hrk2-rec end-write
*    close hrk2
    move function numval(lapis-fat-no)    to romhrk-fatura-no exthrk-fatura-no
    move hrkgir-rec       to romhrk-rec exthrk-rec
**************** kopyalanacak

    open input konu2
          move hrkgir-folio   to konu2-folio
          read konu2 no lock invalid 
               close konu2
               exit paragraph 
          end-read 
         
    close konu2
    if  konu2-fol-kodu = "R"
        write romhrk-rec invalid
          move "Room Folio Bulunamadi..."           to lapkont-hata-acik gd-1-col-4
          move 1                                    to hata
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5

            move "Hata"                             to gd-1-col-6
          rewrite lapkont-rec end-rewrite 
        not invalid
            move "R"                                to lapis-asya-anah(1:1)
            move hrkgir-anah                        to lapis-asya-anah(2:)
        end-write
        perform log-operation-romhrk
    else  
        write exthrk-rec invalid
             move "Extra Folio Bulunamadi..."       to lapkont-hata-acik  gd-1-col-4
             move 1                                 to hata
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5

             move "Hata"                            to gd-1-col-6
             rewrite lapkont-rec end-rewrite 
        not invalid
            move "E"                                to lapis-asya-anah(1:1)
            move hrkgir-anah                        to lapis-asya-anah(2:)
        end-write
        perform log-operation-exthrk
    end-if

    initialize onkasa-rec
    move hrkgir-tarih                               to onkasa-tarih
    move hrkgir-depkod                              to onkasa-dep
    read onkasa no lock invalid
         initialize onkasa-tutar-tl onkasa-tutar-dv
    end-read
    compute onkasa-tutar-tl = onkasa-tutar-tl + hrkgir-tl-tutar
    compute onkasa-tutar-dv rounded = onkasa-tutar-dv + 
            hrkgir-dv-tutar

    write onkasa-rec invalid 
          rewrite onkasa-rec end-rewrite  
    end-write

    compute konuk-top-borc = konuk-top-borc + hrkgir-tl-tutar
    rewrite konuk-rec invalid 
        move "Konuk Kaydi Bulunamadi..."     to lapkont-hata-acik gd-1-col-4
        move 1                               to hata
        move lapis-islem-no                  to eislem 
        move eislem                          to gd-1-col-5
        move "Hata"                          to gd-1-col-6
        rewrite lapkont-rec end-rewrite 
    end-rewrite.

    initialize not-rec
    if konu2-fol-kodu = "R"
       move  "RHR"              to NOT-DOS
       move romhrk-anah         to NOT-DOS-ANAH
    else                        
       move  "EHR"              to NOT-DOS
       move exthrk-anah         to NOT-DOS-ANAH 
    end-if
       
    move lapis-aciklama     to not1
    inspect not1  converting  x"FDD0DCDEDDD6C7E7FEF0FCFDF6" to 
                              x"8DA69A9E989980879FA7818D94"
    write not-rec invalid
          continue 
    end-write

    if hata not = 1  
*|eðer hata  sýfýrsa lapis-asya-islendi 1 olur hata 1 gelirse asya iþlendi deðiþmez kayýt lapisin tablosunda iþlendiye dönmez
       move 1 to lapis-asya-islendi
       rewrite lpsentgr-rec end-rewrite
    end-if.

*
 kredi-yaz.
     initialize hrkgir-rec
     move konuk-folio                        to hrkgir-folio
     move cekgir-oto                         to hrkgir-islem 
   
     move "E"                                to hrkgir-islem-tipi 
     move lapis-tarih to hrkgir-tarih                     
     accept hrkgir-zaman                     from time 
     call "c$justify" using lapis-adisyon-no ,"R"
     move lapis-adisyon-no                     to hrkgir-cekno 
     move "LPIS"                             to hrkgir-staf 
     move lapis-tutar-tl                     to hrkgir-tl-tutar
     move lapis-tutar-dv                     to hrkgir-dv-tutar

     call "c$justify" using lapis-depkod ,"R"
     inspect lapis-depkod replacing all spaces by zeroes   

     initialize depkod-rec
     move onkpara-diger1                       to depkod-anah hrkgir-depkod 
|onkpara-diger1 genel parametrede ticket departmanýna lapis için city ledger hangi departman olucaksa onu yazýn.
     read depkod no lock invalid
           move "Departman Kodu Tanimsiz.."  to lapkont-hata-acik  gd-1-col-4
           move 1                            to hata
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5

            move "Hata"                     to gd-1-col-6
            rewrite lapkont-rec end-rewrite 
     not invalid
           move depkod-ba                    to hrkgir-ba 
     end-read

********************kopyalanacak
    open input route konu2 rez kodlar02
*    open i-o yromhrk

    move hrkgir-rec  to yromhrk-rec
    move hrk2-data   to yromhrk-data
    write yromhrk-rec invalid 
           move "Yromhrk Bulunamadi..."      to lapkont-hata-acik  gd-1-col-4
           move 1                            to hata
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5

            move "Hata"                     to gd-1-col-6
           rewrite lapkont-rec end-rewrite 
    end-write 
*    close yromhrk
    
    perform folref-bul
    perform folref-ata
    close route konu2 rez kodlar02
*    open i-o hrk2
    move hrkgir-anah                      to hrk2-anah
    move yromhrk-folio                    to hrk2-kaynak-folio
    write hrk2-rec end-write
*    close hrk2
    move function numval(lapis-fat-no)    to romhrk-fatura-no exthrk-fatura-no
    move hrkgir-rec       to romhrk-rec exthrk-rec
**************** kopyalanacak
    open input konu2
          move hrkgir-folio   to konu2-folio
          read konu2 no lock invalid 
               close konu2
               exit paragraph 
          end-read 
         
    close konu2
    if  konu2-fol-kodu = "R"
        write romhrk-rec invalid
          move "Room Folio Bulunamadi..."           to lapkont-hata-acik  gd-1-col-4
          move 1                                    to hata
          move lapis-islem-no                       to eislem 
          move eislem                               to gd-1-col-5
          move "Hata"                               to gd-1-col-6
          rewrite lapkont-rec end-rewrite 
        not invalid
            move "R"                                to lapis-asya-anah(1:1)
            move hrkgir-anah                        to lapis-asya-anah(2:)
        end-write
        perform log-operation-romhrk
    else  
        write exthrk-rec invalid
             move "Extra Folio Bulunamadi..."       to lapkont-hata-acik gd-1-col-4
             move 1                                 to hata

             move lapis-islem-no                    to eislem 
             move eislem                            to gd-1-col-5
             move "Hata"                            to gd-1-col-6
             rewrite lapkont-rec end-rewrite 
        not invalid
            move "E"                                to lapis-asya-anah(1:1)
            move hrkgir-anah                        to lapis-asya-anah(2:)

        end-write
        perform log-operation-exthrk
    end-if

    initialize onkasa-rec                          
    move hrkgir-tarih                               to onkasa-tarih
    move hrkgir-depkod                              to onkasa-dep
    read onkasa no lock invalid
         initialize onkasa-tutar-tl onkasa-tutar-dv
    end-read
    compute onkasa-tutar-tl = onkasa-tutar-tl + hrkgir-tl-tutar
    compute onkasa-tutar-dv rounded = onkasa-tutar-dv + 
            hrkgir-dv-tutar

    write onkasa-rec invalid 
          rewrite onkasa-rec end-rewrite  
    end-write

    compute konuk-top-borc = konuk-top-borc + hrkgir-tl-tutar
    rewrite konuk-rec invalid 
        move "Konuk Kaydi Bulunamadi..."     to lapkont-hata-acik  gd-1-col-4
        move 1                               to hata
                       move lapis-islem-no            to eislem 
                       move eislem                    to gd-1-col-5

            move "Hata"                     to gd-1-col-6
        rewrite lapkont-rec end-rewrite 
    end-rewrite

      if hata not = 1
         move 1 to lapis-asya-islendi
         rewrite lpsentgr-rec end-rewrite
      end-if.


*
 lapis-fis-al.
    open i-o genelfis
    move 1 to genelfis-anahtar 
    read genelfis no lock invalid  
         continue
    not invalid 
         compute cekgir-oto = cekgir-oto + 1 
         rewrite genelfis-rec end-rewrite
    end-read
    close genelfis.
*
 doviz-boz.
    open i-o dov-boz kur
    initialize dov-boz-rec kur-rec
    move lapis-tarih         to dov-boz-tarih kur-tarih dov-boz-belge-tar
    move 0                   to dov-boz-alis-satis
    move yedekdov-boz-fisno  to dov-boz-fisno
    read dov-boz no lock invalid
            move 0                   to dov-boz-alis-satis         
            move konuk-banka         to dov-boz-banka kur-banka
            move "D"                 to dov-boz-tipi
            move lapis-dv-kodu       to dov-boz-doviz  kur-doviz
            read kur no lock invalid
                 move 1   to doviz-alis
            end-read
                 move doviz-alis          to dov-boz-kur-tutar
            move lapis-tutar-dv           to dov-boz-dv-tutar
            move lapis-tutar-tl           to dov-boz-tl-tutar dov-boz-net-tl-tutar
            move konuk-folio              to dov-boz-folio
            move konuk-adi                to dov-boz-adi
            move konuk-soyadi             to dov-boz-soy
            move konuk-ulke               to dov-boz-ulke
            move 6                        to dov-boz-belge
            accept dov-boz-zaman from time 
            move konuk-odano              to dov-boz-oda
            move "LPIS"                   to dov-boz-staf
            move " "                      to dov-boz-elle
            move dov-boz-anah             to lapis-dov-boz-anah
            write dov-boz-rec invalid continue end-write 
    end-read
    close dov-boz kur
    .
*
 doviz-fis-no-al.
    open i-o genelfis
    initialize yedekdov-boz-fisno
    move 1 to genelfis-anahtar
    read genelfis no lock invalid 
         initialize genelfis-rec 
         move 1 to genelfis-anahtar
    end-read
         add 1 to dov-boz-oto
         move dov-boz-oto to yedekdov-boz-fisno    
         if dov-boz-alis-satis(1:1) = 1
            move 1 to yedekdov-boz-fisno(1:1)
         end-if
    rewrite genelfis-rec invalid 
        write genelfis-rec end-write 
    end-rewrite
    close genelfis.
*
 dov-boz-sil.
    open i-o dov-boz
    initialize dov-boz-rec
    move lapis-dov-boz-anah   to dov-boz-anah
    read dov-boz no lock invalid
         continue
    not invalid
         move "S"             to DOV-BOZ-DURUMU
         accept DOV-BOZ-sil-ZAMAN from time
         move "LPIS"          to dov-boz-staf
         rewrite dov-boz-rec end-rewrite 
    end-read
    close dov-boz.
     
     .
**************************Route islemi icin...........
*
 folref-bul.
       initialize aroute-anah routtur routyazma routbulundu extradan-geldi
       if konuk-fol-kodu = "R" then 
          move konuk-rez-no to aroute-rezno
       else
          if konuk-extra-rez-no  > 0 
              move 1 to extradan-geldi
              move konuk-extra-rez-no to aroute-rezno
           else
              move konuk-folio to aroute-folio
          end-if
       end-if

     
       perform until routbulundu = 1 or routtur > 10 
       add 1 to routtur
       initialize route-rec
        move aroute-anah to route-anah
       move hrkgir-depkod   to route-depkod
       if hrkgir-corr-depkod not = spaces and hrkgir-corr-depkod not = zeroes 
         move  hrkgir-corr-depkod to route-depkod
       end-if
       read route no lock invalid
           
           perform rout-folio-kontrol
           perform def-pen-bul
            move 1 to routbulundu
         not invalid
         if route-tip = "P"

            perform rout-folio-kontrol
            move 1 to routbulundu
          else
            if route-tip = "F"
               if route-no <> route-folio
                        initialize aroute-anah
                        move route-no to  aroute-folio
                   else
                     perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

                end-if
              else
                if route-no <> route-rezno
                      initialize aroute-anah
                      move route-no  to aroute-rezno
                         else
                       perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

               end-if
            end-if
        end-if
        end-read
       end-perform 
        .
 rout-folio-kontrol.
     initialize konu2-rec
     if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read

            if extradan-geldi = 1 then 
            
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move konuk-folio to konu2-folio
                     read konu2 no lock invalid 
                        continue
                      end-read

                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move konuk-folio to konu2-folio
                      read konu2 no lock invalid 
                        continue
                      end-read
                  end-if
               end-read
               else
                move rez-folio to konu2-folio
                read konu2 no lock invalid
                       continue
                      end-read
           end-if

    end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
          if KONU2-ACIK-KAPALI    = "C" 
            move 2 to routyazma
          end-if
          if KONU2-DURUMU not = "I" then
              move 3 to routyazma
          end-if
       end-read
          . 
 def-pen-bul.
       initialize konu2-rec
      if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        initialize rez-rec
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read
          if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move konuk-folio to konu2-folio
                   read konu2 no lock invalid
                       continue
                      end-read
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move konuk-folio to konu2-folio
                      read konu2 no lock invalid
                       continue
                      end-read
                  end-if
               end-read
               else
                move rez-folio to konu2-folio
                read konu2 no lock invalid
                       continue
                      end-read
           end-if

     end-if

       read konu2 no lock 
          invalid
           move 1 to routyazma
           move konuk-folio to konu2-folio
           read konu2 no lock invalid continue
           end-read
          not invalid
             move "B"               to kodlar02-tipi
               move konu2-odeme-tipi  to kodlar02-kodu 
              read kodlar02 no lock invalid
                    move 1 to route-no
             
                  not invalid
                     if ode-tipi  not =  "A"  | KREDI ISE
                        if hrkgir-corr-depkod not = spaces
                                    move  hrkgir-corr-depkod to depkod-anah
                                    read depkod no lock invalid continue
                                    end-read
                        end-if
                          if depkod-tipi = 2 then 
                                 move 1 to route-no
                             else
                                move 2 to route-no
                                

                                  
                               
                          end-if
                          if hrkgir-corr-depkod not = spaces

                                    move  hrkgir-depkod to depkod-anah
                                    read depkod no lock invalid continue
                                    end-read
                          end-if
                      else
                         move 1 to route-no
                   end-if
             end-read
       end-read
          .
*
 folref-ata.
     if routyazma = 0 and routbulundu = 1 
      move konu2-folio to hrkgir-folio
      if vis-pen = 1 then
          move odemepen to hrkgir-ref
             else
          move route-no to hrkgir-ref
      end-if                  
    end-if.
*
 Form1-Ex-Other.
*     if key-status = 99
*        open i-o yromhrk hrk2 silhrk
*             perform lapis-yaz
*        close yromhrk hrk2 silhrk
*     end-if

 

     if key-status = 5
        set exit-pushed to true 
     end-if.
*
 Form1-Ev-Other.
        .
*
 Form1-Gd-1-Ev-Other.
     
     .
*
 Form1-Pb-1-Ev-Other.
     
     .


 
