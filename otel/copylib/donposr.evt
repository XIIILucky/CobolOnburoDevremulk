* donposr.evt
* donposr.evt is generated from D:\asya\acugt.ytl\otel\donposr.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-win-tab-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO secili-tab
        MOVE 0 TO Form1-Pg-1-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form1-Pg-1-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form1
*       After-Tabchg-Display
     END-EVALUATE
     .

 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 acc-mis-no-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        EVALUATE Event-Control-Id
        WHEN 157
           PERFORM acc-mis-no-Ev-Cmd-Goto
        WHEN 164
           PERFORM acc-mis-no-Ev-Cmd-Goto
        END-EVALUATE
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 14
           PERFORM Form1-Gd-1-Ev-Other
        WHEN 63
           PERFORM dep-gd-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Gd-1-Exception-Proc.
     PERFORM Form1-Gd-1-Ex-Other
     .

 Form1-Pb-3-Event-Proc.
     .

 ode-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM ode-acc-Ev-Cmd-Clicked
     END-EVALUATE
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        EVALUATE Event-Control-Id
        WHEN 9
           PERFORM Form1-Gd-1a-Ev-Msg-Begin-Entry
        END-EVALUATE
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 14
           PERFORM Form1-Gd-1-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 win-tab-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM win-tab-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 pen-gd-Event-Proc.
     PERFORM pen-gd-Ev-Other
     .

 button-kaydet-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM button-kaydet-Ex-Cmd-Clicked
     END-EVALUATE
     .

 button-kaydet-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM button-kaydet-Ex-Cmd-Clicked
        WHEN Cmd-Goto
           PERFORM button-kaydet-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 button-acik-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM button-acik-Ev-Cmd-Clicked
     END-EVALUATE
     .

 Form0-Event-Proc.
     .

 Form0-Exception-Proc.
     PERFORM Form0-Ex-Other
     .

 Form2-Event-Proc.
     .

 Form2-Pb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form2-Pb-1-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form2a-Exception-Proc.
     PERFORM Form2a-Ex-Other
     .

 form3-Exception-Proc.
     PERFORM form3-Ex-Other
     .

 screen2-Exception-Proc.
     PERFORM screen2-Ex-Other
     .

 screen1-Exception-Proc.
     PERFORM screen1-Ex-Other
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .
***   start event editor code   ***
*
 Form0-Bef-Create.
 .

*
 Form0-Aft-Initdata.
      modify combo-folio-yeri,reset-list = 1 
                              mass-update = 1
      modify combo-rapor-tipi,reset-list = 1 
                              mass-update = 1 

      modify combo-folio-yeri,
             item-to-add("I-Inhouse","H-History")
      move "I-Inhouse" to combo-folio-yeri-value
      modify combo-rapor-tipi,
             item-to-add("T-Turk Lirasi","D-Doviz")
      move "T-Turk Lirasi" to combo-rapor-tipi-value
      modify combo-folio-yeri,mass-update = 0
                              value combo-folio-yeri-value
      modify combo-rapor-tipi,mass-update = 0
                              value combo-rapor-tipi-value.      
      move onkpara-doviz to rapor-doviz
      move onkpara-banka to rapor-banka
     
      if link-var = 1 then 
           move link-fol-no to konuk-folio
           open input konuk
           read konuk no lock 
             invalid             
               display message box "Folio Bulunamadi"
               close konuk
               set exit-pushed to true
               exit paragraph
             not invalid
               close konuk  
               perform folio-linkle
           end-read 
                   
         else
           move 4 to accept-control
           move 9 to control-id
       end-if .
       
*
 folio-linkle.
      if konuk-durumu  = "I"
         move "I-Inhouse" to combo-folio-yeri-value
        else
         move "H-History" to combo-folio-yeri-value
      end-if
      display combo-folio-yeri
      if konuk-fol-kodu = "R" 
         move "D-Doviz" to combo-rapor-tipi-value
       else
         move "D-Doviz" to combo-rapor-tipi-value
        move 0                 to rapor-folio-kuru
        move konuk-BANKA     to rapor-banka
        move konuk-doviz     to rapor-doviz
       
*         move "T-Turk Lirasi" to combo-rapor-tipi-value
      end-if   
      display combo-rapor-tipi
      move konuk-odano to rapor-oda
      move konuk-folio to rapor-folio
      display acc-oda acc-folio 
      perform after-depkod
      
         perform after-folio-kuru
         perform after-doviz
         perform after-banka
      perform tipi-after
      move 2001 to key-status
      perform form0-ex-other
           .


*
 toplu-kontrol.
       initialize gec-gecme
       
       perform after-depkod
       if dis-dov = 1 then 
         perform after-doviz
         perform after-banka
       end-if  .

*

 Form0-Ex-Other.
      evaluate key-status
           when 2001
                perform toplu-kontrol
                if gec-gecme = 0 

                    perform ekran-islem
                    if link-var= 1 then
                      
                       if esk-status = 19  or = 8 then
                          move 99999999 to link-fol-no
                          set exit-pushed to true
                          exit paragraph
                       end-if
                       if esk-status = 15  then
                          move 0 to link-fol-no
                          set exit-pushed to true
                          exit paragraph
                       end-if

                     end-if
                
                    move 4 to accept-control
                     move 9 to control-id 
                 end-if
           when 2002
                perform toplu-kontrol
                if gec-gecme = 0 

                perform liste-islem
                move 4 to accept-control
                move 9 to control-id
                end-if
          
           when 001
                evaluate control-id
                    when 9  
                    when 19  
                         perform oda-ara  thru oda-ara-exit 
                    when 10 
                    when 20 
                         perform folio-ara  thru folio-ara-exit 
                    when 14
                         perform depart-ara
                    when 21
                         perform banka-ara
                    when 22
                         perform doviz-ara
                end-evaluate
          when 2
                perform konuk-ara
      end-evaluate.

 ekran-islem.
      if rapor-folio = zeroes 
         move 4 to accept-control
         move 9 to control-id
         exit paragraph
      end-if.
      open input konuk
      initialize konuk-rec
      move rapor-folio      to konuk-folio
      read konuk no lock invalid
           close konuk
           move 4 to accept-control
           move 10 to control-id
           exit paragraph
      end-read.
      close konuk.
      if konuk-durumu <> combo-folio-yeri-value(1:1) 
         display message box 
                 "Folio ile secimdeki folio yeri birbirini tutmuyor",new-line,
                 "Devam edilsin mi ?"
                 type mb_yes_no
                 icon mb_warning_icon
                 title "Bilginize"
                 returning i
                 if i = 2 
                    move 4 to accept-control
                    move 10 to control-id
                    exit paragraph
                 end-if
      end-if.
      move konuk-odano      to rapor-oda.
      open input odalar.
      move rapor-oda        to odalar-anah
      read odalar no lock invalid
           move 4 to accept-control
           move 9 to control-id
           exit paragraph
      end-read
      close odalar.
      
      perform acu-form1-routine.


 liste-islem.
         if onkpara-eski-folio-lst = 1
                 perform  listeeski-islem
                  else
              
             
      initialize foliolzt-cagir
      move combo-rapor-tipi-value(1:1) to foliolzt-tldv-cagir
      move rapor-folio                 to foliolzt-no-cagir
      move rapor-departman             to foliolzt-depart-cagir
          
      move rapor-folio-kuru            to foliolzt-kuru-cagir
      move rapor-banka(1:2)            to foliolzt-banka-cagir
      move rapor-doviz                 to foliolzt-doviz-cagir
      move kaynak-kuru                 to foliolzt-kaynak-kuru
       compute foliolzt-pencere =  secili-tab - 1
      call "/asya/ytl/obj/otel/foliolzr.asy" using foliolzt-cagir
            on exception perform callerr-proc
               not on exception
      cancel "/asya/ytl/obj/otel/foliolzr.asy" 
      end-call
         end-if.
       .
*
 listeeski-islem.
      
      initialize foliolst-cagir
      move combo-rapor-tipi-value(1:1) to foliolst-tldv-cagir
      move rapor-folio                 to foliolst-no-cagir
      move rapor-departman             to foliolst-depart-cagir
          
      move rapor-folio-kuru            to foliolst-kuru-cagir
      move rapor-banka(1:2)            to foliolst-banka-cagir
      move rapor-doviz                 to foliolst-doviz-cagir
      call "/asya/ytl/obj/otel/foliolst.asy" using foliolst-cagir
            on exception perform callerr-proc
               not on exception
      cancel "/asya/ytl/obj/otel/foliolst.asy" 
      end-call.
       .
*
 grid-yaz.
       open input konu2
       open i-o genelfis
         read genelfis no lock invalid
              accept ekran-fis-1 from time
         end-read
         add 1 to ekran-fis-1
         rewrite genelfis-rec invalid continue end-rewrite
         close genelfis
         move ekran-fis-1       to dep-toplam-no kdv-toplam-no
      if onkpara-folio-dep-toplam = "E"
         
         open output dep-toplam close dep-toplam
         open i-o dep-toplam mass-update
      end-if.
      if onkpara-folio-kdv-toplam = 1
         
         open output kdv-toplam close kdv-toplam
         open i-o kdv-toplam mass-update
      end-if.
      initialize borc-toplam alac-toplam tutar bakiye
      toplamlar    tlborc-toplam tlalac-toplam tltutar tlbakiye
      
      modify form1-gd-1,reset-grid = 1 mass-update = 1.
*      move "X"           to gd-1-col-0 
      move "Tarih"       to gd-1-col-1
      move "D.K"         to gd-1-col-2
      move "Departman"   to gd-1-col-3
      move "Aciklama "   to gd-1-col-4
      MOVE "KUR"         TO GD-1-COL-99
      move "Borc-D"        to gd-1-col-5
      move "Borc-TL"        to gd-1-col-105
      move "Alacak-D"      to gd-1-col-6
      move "Bakiye-D"      to gd-1-col-7
      move "Alacak-TL"      to gd-1-col-106
      move "Bakiye-TL"      to gd-1-col-107
      move "Zaman"       to gd-1-col-8
      move "Islem"       to gd-1-col-9
      move "Cek no"      to gd-1-col-10
      move "Kart"        to gd-1-col-11
      move "Staff"       to gd-1-col-12
      move "POS Kod"    to gd-1-col-13
      move "Tip"         to gd-1-col-14
      move "P"         to gd-1-col-19
      move "Kaynak"         to gd-1-col-20
      move "Fat No"         to gd-1-col-21
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)
             open i-o hrk2 
      if konuk-fol-kodu = "R"
         open input  depkod kllnc nt cast
         open i-o romhrk 
         initialize romhrk-rec
         move rapor-folio       to romhrk-folio 
         start romhrk key not < romhrk-anah1 invalid
               continue
         not invalid
         initialize fs-romhrk
         perform with test after until fs-romhrk = "10"
         read romhrk next no lock end move "10" to fs-romhrk
         not at end
              if romhrk-folio <> rapor-folio
                 move "10" to fs-romhrk
                 exit perform 
              end-if
              if romhrk-ref = 0 then 
                move 1 to romhrk-ref
                rewrite romhrk-rec invalid display message box "Hata 359340" end-rewrite
                perform log-operation-romhrk
              end-if
              if pencere > 0 and pencere not = romhrk-ref
              exit perform cycle
              end-if
           if rapor-departman = spaces or rapor-departman = zeroes 
              or rapor-departman = romhrk-depkod then
              initialize hrkgir-rec
              move romhrk-rec        to hrkgir-rec
              move romhrk-anah       to hrk2-anah
              read hrk2 no lock invalid
                   display message box "Eski Versiyon Datasi" new-line 
                              " Bakim icin arayiniz" title "HATA"
                  if k-kodu-tasi = "ASYA" or "X   "
                    open i-o yromhrk
                   move romhrk-anah  to hrk2-anah
                   move romhrk-folio to hrk2-kaynak-folio
                   write hrk2-rec invalid stop " " end-write
                   move romhrk-anah to yromhrk-anah 
                   read yromhrk no lock invalid 
                   move romhrk-rec to yromhrk-rec
                   move romhrk-folio to yROMHRK-kaynak-folio
                   write yromhrk-rec invalid stop " "end-write
                   end-read
                   close yromhrk
                   end-if
              end-read
              move hrk2-rec to hrkgir-hrk2
              perform grid-yukle
              perform toplam-al
              if onkpara-folio-dep-toplam = "E"
                 perform dep-toplam-al
              end-if
              if onkpara-folio-kdv-toplam = 1
                 perform kdv-toplam-al
              end-if
            end-if
         end-read
         end-perform
         end-start
         
         move konuk-rez-no to cast-rez-no
         initialize cast-rec top-odeme   top-reel top-anlasma
            move konuk-rez-no to cast-rez-no
         start cast  key >  cast-anah1 
            invalid continue
            not invalid
            
             modify form1-gd-1a reset-grid = 1 mass-update = 1
         move "Tarih" to gd-1-tarih
         move "Reel" to  gd-1-tutar
         move "Anlasma" to gd-1-toplam
         modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
          initialize gece-sayi

        perform with test after until fs-cast = "10"  
          read cast next no lock end move "10" to fs-cast
          not end
             if cast-rez-no not = konuk-rez-no or 
               cast-tarih >= konuk-git-tar
               
               move "10" to fs-cast
               else
               add 1 to gece-sayi
                  initialize renk

                move cast-gun to  gd-1-tarih(1:2)                   
                move cast-ay  to  gd-1-tarih(4:2)   
                move cast-yil to  gd-1-tarih(7:4)
                move "/" to           gd-1-tarih(3:1)   gd-1-tarih(6:1) 
                 if tarih-tasi > cast-tarih
                    move CAST-BASILAN-FIYAT  to z-8
                    move z-8               to gd-1-tutar
                      add CAST-BASILAN-FIYAT to top-reel
                         if cast-BASILAN-FIYAT not = cast-anlasma-fiyati
                           move 176 to renk
                         end-if
                 end-if
                 if tarih-tasi = cast-tarih
                   move 517 to renk
                    add cast-basilan-fiyat to cast-fiyati
                    move CAST-fiyati  to z-8
                    move z-8               to gd-1-tutar
                      add cast-fiyati to top-reel
                        if cast-fiyati not = cast-anlasma-fiyati
                           move 176 to renk
                    end-if
                 end-if
                 if tarih-tasi < cast-tarih
                    add cast-fiyati to top-reel
                    move CAST-fiyati  to z-8
                    if cast-fiyati not = cast-anlasma-fiyati
                       move 176 to renk
                    end-if
                    move z-8               to gd-1-tutar
                 end-if

                move cast-anlasma-fiyati  to z-8
                move z-8               to gd-1-toplam
               
                   add cast-anlasma-fiyati to top-anlasma
                
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 if renk not = 0 then 
                   modify  form1-gd-1a(gece-sayi + 1) row-color  = renk 
                 end-if
              end-if
          end-read 
        end-perform, 
        end-start,
           move 0 to renk
             move "TOPLAM" to           gd-1-tarih
                 
                    move  top-reel to z-8
                    if top-reel not = top-anlasma
                       move 176 to renk
                    end-if
                    move z-8               to gd-1-tutar
               

                move top-anlasma          to z-8
                move z-8               to gd-1-toplam
               
                  
                
                 modify  form1-gd-1a record-to-add(Form1-Gd-1-Rec)
                 if renk not = 0 then 
                   modify  form1-gd-1a(gece-sayi + 2) 
                       start-x = 1 x = 3
                       start-y = gece-sayi + 2 y = gece-sayi + 2
                       region-color  = renk 
                 end-if


         modify form1-gd-1a  mass-update = 0

         open i-o exthrk 
         initialize exthrk-rec 
         hatali-kayit-var hatali-tutar-toplam
         move rapor-folio       to exthrk-folio 
         start exthrk key not < exthrk-anah1 invalid
               continue
         not invalid
         initialize fs-exthrk
         perform with test after until fs-exthrk = "10"
         read exthrk next no lock end move "10" to fs-exthrk
         not at end
                 if exthrk-folio <> rapor-folio
                     exit perform 
                 end-if 
                 move 1  to hatali-kayit-var
                 compute hatali-tutar-toplam = 
                 hatali-tutar-toplam + exthrk-tl-tutar
         end-read 
         end-perform
         end-start
         close romhrk depkod kllnc nt cast exthrk

      else
         open input depkod kllnc nt
         open i-o exthrk
         initialize exthrk-rec
         move rapor-folio       to exthrk-folio
         start exthrk key not < exthrk-anah1 invalid
               continue
         not invalid
         initialize fs-exthrk
         perform with test after until fs-exthrk = "10"
         read exthrk next no lock end move "10" to fs-exthrk
         not at end
              if exthrk-folio <> rapor-folio
                 move "10" to fs-exthrk
                 exit perform 
              end-if
              if exthrk-ref = 0 then 
                move 1 to exthrk-ref
                rewrite exthrk-rec invalid display message box "Hata 359340" end-rewrite
                perform log-operation-exthrk
              end-if
              if pencere > 0 and pencere not = exthrk-ref
              exit perform cycle
              end-if
              if rapor-departman = spaces or rapor-departman = zeroes 
              or rapor-departman = exthrk-depkod then
           
              initialize hrkgir-rec
              move exthrk-rec        to hrkgir-rec
               move exthrk-anah to hrk2-anah
              read hrk2 no lock invalid
                move exthrk-folio to hrk2-kaynak-folio
              end-read
              move hrk2-rec to hrkgir-hrk2
              perform grid-yukle
              perform toplam-al
              if onkpara-folio-dep-toplam = "E"
                 perform dep-toplam-al
              end-if
              if onkpara-folio-kdv-toplam = 1
                 perform kdv-toplam-al
              end-if
              end-if
         end-read
         end-perform
         end-start

         open i-o romhrk 
         initialize romhrk-rec 
         hatali-kayit-var hatali-tutar-toplam
         move rapor-folio       to romhrk-folio 
         start romhrk key not < romhrk-anah1 invalid
               continue
         not invalid
         initialize fs-romhrk
         perform with test after until fs-romhrk = "10"
         read romhrk next no lock end move "10" to fs-romhrk
         not at end
                 if romhrk-folio <> rapor-folio
                     exit perform 
                 end-if 
                 move 1  to hatali-kayit-var
                 compute hatali-tutar-toplam = 
                 hatali-tutar-toplam + romhrk-tl-tutar
         end-read 
         end-perform
         end-start


         close exthrk depkod kllnc nt romhrk
      end-if.
      display Form1-Pb-1a
      close hrk2 .
       initialize form1-gd-1-record.
     
     
      move "Toplam"               to gd-1-col-1
      move borc-toplam            to etutar
      move etutar                 to gd-1-col-5
      move alac-toplam            to etutar 
      move etutar                 to gd-1-col-6
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7
      move TLborc-toplam            to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLalac-toplam            to eTLtutar 
      move eTLtutar                 to gd-1-col-106
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107

      modify form1-gd-1,
             record-to-add(form1-gd-1-record)
      inquire form1-gd-1 last-row in eski-y 


      modify form1-gd-1
                    y = eski-y,
                    row-color = 257
      modify form1-gd-1
                    y = eski-y,
                    x = 10,
                    cell-color = 48
      modify form1-gd-1
                    y = eski-y,
                    x = 11,
                    cell-color = 432

      initialize form1-gd-1-record
      move "Genel Toplam"         to gd-1-col-3
      move genel-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move TLgenel-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move genel-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      move TLgenel-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute bakiye = genel-borc-toplam - genel-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7
      compute TLbakiye = TLgenel-borc-toplam - TLgenel-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Oda Toplam"           to gd-1-col-3
      move   oda-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move   TLoda-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move   oda-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      move   TLoda-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute bakiye = oda-borc-toplam - oda-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7
      compute TLbakiye = TLoda-borc-toplam - TLoda-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Extra Toplam"         to gd-1-col-3
      move extra-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move extra-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      compute bakiye = extra-borc-toplam - extra-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7

      move TLextra-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLextra-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute TLbakiye = TLextra-borc-toplam - TLextra-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Telefon Toplam"         to gd-1-col-3
      move telefon-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move telefon-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      compute bakiye = telefon-borc-toplam - telefon-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7

      move TLtelefon-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLtelefon-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute TLbakiye = TLtelefon-borc-toplam - TLtelefon-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)

      initialize form1-gd-1-record
      move "Diger Toplam"         to gd-1-col-3
      move diger-borc-toplam      to etutar
      move etutar                 to gd-1-col-5
      move diger-alac-toplam      to etutar
      move etutar                 to gd-1-col-6
      compute bakiye = diger-borc-toplam - diger-alac-toplam
      move bakiye                 to etutar
      move etutar                 to gd-1-col-7


      move TLdiger-borc-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-105
      move TLdiger-alac-toplam      to eTLtutar
      move eTLtutar                 to gd-1-col-106
      compute TLbakiye = TLdiger-borc-toplam - TLdiger-alac-toplam
      move TLbakiye                 to eTLtutar
      move eTLtutar                 to gd-1-col-107
      modify form1-gd-1,
             record-to-add(form1-gd-1-record)


      if onkpara-folio-dep-toplam = "E"
         open input depkod
         initialize form1-gd-1-record
         move "Dep.Toplam"           to gd-1-col-1
         modify form1-gd-1,
                record-to-add(form1-gd-1-record) 
        
         inquire form1-gd-1 last-row in eski-y 
         add 1 to eski-y
          modify form1-gd-1
                    y = eski-y,
                   row-color = 257
         initialize dep-toplam-rec bakiye

         start dep-toplam key not < dep-toplam-anah invalid
               continue
         not invalid
         perform with test after until fs-dep-toplam = "10"
         read dep-toplam next no lock end move "10" to fs-dep-toplam
         not at end
              initialize form1-gd-1-record
              move dep-toplam-anah       to depkod-anah gd-1-col-2
              read depkod no lock invalid
                   move "Tanimsiz ..."   to depkod-adi
              end-read
              move depkod-adi            to gd-1-col-3
              evaluate true
                   when dep-toplam-tip = "A"
                        move dep-toplam-tutar   to etutar
                        move etutar             to gd-1-col-106
                        subtract dep-toplam-tutar from bakiye
                       
                   when dep-toplam-tip = "B"
                       move dep-toplam-tutar   to etutar
                        move etutar             to gd-1-col-105
                        add dep-toplam-tutar    to bakiye
                        
              end-evaluate
              move bakiye                       to etutar
              move etutar                       to gd-1-col-107
             
              modify form1-gd-1,
                     record-to-add(form1-gd-1-record)
         end-read
         end-perform
         end-start
         close dep-toplam depkod
         delete file dep-toplam
      end-if.
        if onkpara-folio-kdv-toplam = 1
        
         initialize form1-gd-1-record
         move "KDV Toplam"           to gd-1-col-1
          move "NET"  to gd-1-col-105
               move "KDV"                    to gd-1-col-106
               move "TOPLAM"                     to gd-1-col-107
         modify form1-gd-1,
                record-to-add(form1-gd-1-record)
                  inquire form1-gd-1 last-row in eski-y 
                  modify form1-gd-1
                    y = eski-y,

                    row-color = 257
         initialize kdv-toplam-rec bakiye
        
         start kdv-toplam key not < kdv-toplam-anah invalid
               continue
         not invalid
         perform with test after until fs-kdv-toplam = "10"
         read kdv-toplam next no lock end move "10" to fs-kdv-toplam
         not at end
              initialize form1-gd-1-record
              move kdv-toplam-anah     to  gd-1-col-3(1:2)
              move "KDV"               to  gd-1-col-3(4:)
              
              move kdv-net-tutar                      to etutar
              move etutar                       to gd-1-col-105
               move kdv-kdv-tutar                       to etutar
              move etutar                       to gd-1-col-106
               move kdv-toplam-tutar                       to etutar
              move etutar                       to gd-1-col-107
              modify form1-gd-1,
                     record-to-add(form1-gd-1-record)
         end-read
         end-perform
         end-start
         close kdv-toplam 
         delete file kdv-toplam
      end-if.
      close konu2
      modify form1-gd-1,mass-update = 0.
*
 TUM-TAB-AC.
         MODIFY win-tab,  
         reset-tabs = 1 
          MODIFY win-tab,  
         TAB-TO-ADD = ( "Tum Pencereler") 
          move secili-tab to yedek-secili
        move 1 to ilk-yukle
         initialize refler-occ
        initialize uyari
         move 1 to genelfis-anahtar
         move 0 to pencere
        perform grid-yaz
         move 0 to ilk-yukle.
         perform tab-ac.
          if yedek-secili > 1 then 
             move yedek-secili to secili-tab
          compute  pencere  = yedek-secili - 1
          perform grid-yaz
          display win-tab
          
          end-if.
         perform pen-kont.



*
 Form1-Aft-Initdata.
       if konuk-durumu = "H" then
      
         if konuk-acik-hesap = 1 then 
              move "HISTORY - ACIK " to tip-lab
           else
              move "HISTORY  " to tip-lab
                
          end-if  
          move 1 to vextra
                     move 48 to colextra
        else
        if konuk-fol-kodu = "E" then 
             move "EXTRA       " to tip-lab
             move 79 to colextra
             move 1 to vextra
           else
              move 0 to vextra
           end-if
        end-if 
        display lextra l1 l2
         if konuk-durumu = "I"
         move "Inhouse ..."  to form1-title(15:)
           move 65793 to form-color 
      else
         move "History ..."  to form1-title(15:)
           move 304 to form-color 
      end-if
        modify form1-handle, title = form1-title

        move 1 to ilk-yukle
         initialize refler-occ
        initialize uyari
         move 1 to genelfis-anahtar
         move 0 to pencere
        perform grid-yaz
         move 0 to ilk-yukle.

         perform tab-ac.
      move konuk-fiyat-konumu to konum-anahtar
      open input konum
      read konum no lock invalid
            continue
        not invalid
            move konum-adi to acc-fkonum
            display ef-anlasmaa
      end-read
      close konum
      move "D" to kodlar02-tipi
      move KONUK-ANLASMA to kodlar02-kodu
      open input kodlar02

      read kodlar02 no lock invalid
            continue
        not invalid
            move kodlar02-adi to acc-anlasma
            display ef-anlasma
      end-read
      close kodlar02
      move gece-sayi to gece-say
      display l-gece
      perform not-goster
      perform pen-kont
      move 4 to accept-control
      move 14 to control-id.
     


 tab-ac.
    open input musteri

    open i-o folref
    if max-folref = 0 then move 1 to max-folref end-if
    perform varying t from 1 by 1 until t > 8  or t > max-folref
    
       move t to tab-text
        
        
              
             move konuk-folio to folref-folio
             compute folref-ref =  t
             read folref no lock invalid 
                   perform folref-def-at
                   not invalid
                   if folref-profil-no not > 0 then 
                      perform folref-def-at
                   end-if
             end-read
             initialize musteri-rec
             move  folref-profil-anah to ref-prof(t) musteri-anah(2:)
              read musteri no lock invalid
                continue
             end-read
                string  musteri-adi delimited by "   "
                    " " delimited by size
                   musteri-soyadi delimited by "  "
                   into tab-text(5:)
                end-string
             move  folref-ode  to ref-ode(t)
             if folref-ode = 1 then 
                move "***" to tab-text(2:3)
             end-if
             MODIFY win-tab,  
         TAB-TO-ADD = ( tab-text)         
   
    end-perform
    close folref musteri.  
*
 folref-def-at. 
                initialize folref-data
             if  t = 1 then
               if fol-pes not = "A" 
                 move 1 to folref-ode
                 if acenta-tipi = 3
                    if konuk-firma > spaces 
                         move firma-profil-anah to folref-profil-anah
                      else
                         move acenta-profil-anah to folref-profil-anah
                   end-if
                   else
                   move acenta-profil-anah to folref-profil-anah
                end-if
                 write folref-rec invalid  rewrite folref-rec end-write
                 else
                 if yanrez-profil-no > 0 then 
                   move 0 to folref-ode
                 
                    move yanrez-profil-anah to folref-profil-anah
                   write folref-rec invalid  stop " "  end-write
                 end-if
                  

               end-if
               else
               if yanrez-profil-no > 0 then 
                   move 0 to folref-ode
                 
                    move yanrez-profil-anah to folref-profil-anah
                    write folref-rec invalid  stop " "  end-write
               end-if

             end-if



           .  
*
 not-goster.
      
      if konuk-fol-kodu = "R" 
         move 9 to link-nereden 
         move "REZ"   to  link-NOT-DOS    
         move konuk-rez-no to link-NOT-DOS-ANAH   
      else
         if konuk-extra-rez-no > 0 then
           move 10 to link-nereden 
           move "REZ"   to  link-NOT-DOS    
           move konuk-extra-rez-no to link-NOT-DOS-ANAH    
         else
           move 10 to link-nereden 
           move "KON"   to  link-NOT-DOS    
           move konuk-folio to link-NOT-DOS-ANAH    
           
         end-if

      end-if .
        


             move "K"     to  link-not-islem
             
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
             display not-ac
                           .
 ref-bul.
    continue
    .
 grid-yukle.
        
          if hrkgir-ref = 0 or hrkgir-ref not  numeric then 
                 perform ref-bul
                 if hrkgir-ref = 0 or hrkgir-ref not  numeric then 
                     move 1 to hrkgir-ref
                end-if
             if konuk-fol-kodu = "R"
                   move hrkgir-ref to romhrk-ref
                   rewrite romhrk-rec end-rewrite
                   perform log-operation-romhrk
               else
                  move hrkgir-ref to exthrk-ref
                  rewrite exthrk-rec end-rewrite
                  perform log-operation-exthrk
            end-if  
             end-if
         if ilk-yukle = 1 then 
            
            move 1 to ref-var(hrkgir-ref)
            if hrkgir-ref > max-folref then 
            move hrkgir-ref to max-folref
            end-if
             evaluate hrkgir-ba
           when "A" subtract hrkgir-tl-tutar from ref-bakiye(hrkgir-ref)
           when "B" add      hrkgir-tl-tutar to ref-bakiye(hrkgir-ref)
           end-evaluate

         end-if

       initialize form1-gd-1-record 
         initialize not-rec
      if konuk-fol-kodu = "R"
          move  "RHR"     to NOT-DOS
          move romhrk-anah to  NOT-DOS-ANAH 
         else
          move  "EHR"     to NOT-DOS
          move exthrk-anah to  NOT-DOS-ANAH 
       end-if  
         
          read nt no lock invalid initialize not1
          end-read
          move not1 to gd-1-col-4
     initialize konu2-rec  
     move hrkgir-hrk2-kaynak-folio to  konu2-anah
     read konu2 no lock invalid 
          
            continue
       end-read
      move hrkgir-ref to gd-1-col-19
      if  hrkgir-fatura-no > 0 then 
          move hrkgir-fatura-no to gd-1-col-21
      else
          move spaces to gd-1-col-21
      end-if
      initialize text2 
      string
        konu2-odano delimited by size
        "-" delimited by size
        konu2-adi delimited by "  "
        " " delimited by size
        konu2-soyadi delimited by "  " 
        into text2
        end-string
        move text2 to gd-1-col-20 
      move hrkgir-gun             to egun
      move hrkgir-ay              to eay 
      move hrkgir-yil             to eyil
      move etarih                 to gd-1-col-1
      move hrkgir-depkod          to gd-1-col-2 depkod-anah
      read depkod no lock invalid
           move "Tanimsiz ..."    to depkod-adi
      end-read
      move depkod-adi             to gd-1-col-3
      MOVE  hrkgir-tl-tutar   TO TLTUTAR ETLTUTAR
      if combo-rapor-tipi-value(1:1) = "T"
         move hrkgir-tl-tutar      to etutar tutar  ETLTUTAR TLTUTAR
         MOVE 1 TO KONUK-KUR-DEGERI
      else
********************************         
        if rapor-folio-kuru =0 then 
          if kaynak-kuru = 1 and depkod-tipi = 2 and konu2-doviz = rapor-doviz then 
              move konu2-kur-degeri to  konuk-kur-degeri
          else
            open input kur
            move rapor-banka(1:2) to kur-banka
            move rapor-doviz to kur-doviz
            move hrkgir-tarih to kur-tarih
            read kur no lock 
                 invalid
                 if uyari = 0 then 
                    display message box rapor-banka "---" kur-banka "--Kur bulunamadi folio-kuru alinacak"
                    move 1 to uyari
                  end-if
                 not invalid 
                evaluate true
                    when "D" = onkpara-d-e and  "A" = onkpara-a-s 
                         move doviz-alis    to konuk-kur-degeri
                    when "D" = onkpara-d-e and  "S" = onkpara-a-s 
                         move doviz-satis   to konuk-kur-degeri
                    when "E" = onkpara-d-e and  "A" = onkpara-a-s 
                         move efektif-alis  to konuk-kur-degeri
                    when "E" = onkpara-d-e and  "S" = onkpara-a-s 
                         move efektif-satis to konuk-kur-degeri
                    when other
                         move doviz-alis to konuk-kur-degeri
                 end-evaluate   
              end-read            
                 close kur       
            end-if

        end-if
          
         compute   hrkgir-dv-tutar rounded =
               hrkgir-tl-tutar / konuk-kur-degeri
         move hrkgir-dv-tutar      to etutar tutar





*******************************
      end-if

      evaluate hrkgir-ba
           when "A" move etutar to gd-1-col-6
                    MOVE ETLTUTAR TO  gd-1-col-106
                    add tutar   to alac-toplam
                    subtract tutar from bakiye
                     add TLtutar   to TLalac-toplam
                    subtract TLtutar from TLbakiye
           when "B" move etutar to gd-1-col-5
                     MOVE ETLTUTAR TO  gd-1-col-105 
                    add tutar   to borc-toplam 
                    add tutar   to bakiye
                      add TLtutar   to TLborc-toplam 
                    add TLtutar   to TLbakiye
      end-evaluate.
      MOVE KONUK-KUR-DEGERI TO EKUR
      MOVE EKUR TO GD-1-COL-99
      move bakiye               to etutar
      move etutar               to gd-1-col-7
       move TLbakiye               to eTLtutar
      move eTLtutar               to gd-1-col-107
      move hrkgir-saat          to esaat
      move hrkgir-dakika        to edakika
      move hrkgir-saniye        to esaniye
      move ezaman               to gd-1-col-8
      move hrkgir-islem         to gd-1-col-9
      move hrkgir-cekno         to gd-1-col-10
      move hrkgir-kart-no       to gd-1-col-11
      move hrkgir-staf          to k-kodu
      read kllnc no lock invalid
           move "Tanimsiz ..."  to k-adi
      end-read
      move k-adi                to gd-1-col-12
      move hrkgir-pos-kodu      to gd-1-col-13
      move hrkgir-islem-tipi    to gd-1-col-14
      modify form1-gd-1,
             record-to-add(form1-gd-1-record).
        inquire form1-gd-1,
            last-row in kayit-yeri
       modify form1-gd-1(kayit-yeri,20),
            hidden-data = konu2-folio.
       if hrkgir-fatura-no > 0
          modify form1-gd-1(kayit-yeri)
                    row-color = 304
       end-if. 



 toplam-al.
      if combo-rapor-tipi-value(1:1) = "T"
         move hrkgir-tl-tutar    to tutar
      else
         move hrkgir-dv-tutar    to tutar
      end-if.
      evaluate true
           when depkod-tipi = 1 and hrkgir-ba = "B"
                add tutar to genel-borc-toplam
                add TLtutar to TLgenel-borc-toplam
           when depkod-tipi = 1 and hrkgir-ba = "A"
                add tutar to genel-alac-toplam
                add TLtutar to TLgenel-alac-toplam
           when depkod-tipi = 2 and hrkgir-ba = "B"
                add tutar to oda-borc-toplam
                add TLtutar to TLoda-borc-toplam
           when depkod-tipi = 2 and hrkgir-ba = "A"
                add tutar to oda-alac-toplam
                add TLtutar to TLoda-alac-toplam
           when depkod-tipi = 3 and hrkgir-ba = "B"
                add tutar to extra-borc-toplam
                add TLtutar to TLextra-borc-toplam
           when depkod-tipi = 3 and hrkgir-ba = "A"
                add tutar to extra-alac-toplam
                add TLtutar to TLextra-alac-toplam
           when depkod-tipi = 4 and hrkgir-ba = "B"
                add tutar to telefon-borc-toplam
                add TLtutar to TLtelefon-borc-toplam
           when depkod-tipi = 4 and hrkgir-ba = "A"
                add tutar to telefon-alac-toplam
                add TLtutar to TLtelefon-alac-toplam
           when depkod-tipi = 5 and hrkgir-ba = "B"
                add tutar to diger-borc-toplam
                add TLtutar to TLdiger-borc-toplam
           when depkod-tipi = 5 and hrkgir-ba = "A"
                add tutar to diger-alac-toplam
                add TLtutar to TLdiger-alac-toplam
           when other
                display message box "uyumsuz tip---"  new-line
                        " Tipi :" depkod-tipi new-line
                        " BA   :" hrkgir-ba new-line,
                  depkod-anah,new-line,depkod-tipi
                        new-line,tutar
      end-evaluate.
 dep-toplam-al.
      initialize dep-toplam-rec
       
      move hrkgir-tl-tutar    to tutar
      if hrkgir-corr-depkod not = spaces and  not = zeroes
             move hrkgir-corr-depkod      to dep-toplam-anah
             read dep-toplam no lock invalid
               initialize dep-toplam-rec
               move hrkgir-corr-depkod  to dep-toplam-anah
               if hrkgir-ba = "B" then
                 move "A"     to dep-toplam-tip 
                 else    move "B"     to dep-toplam-tip 
               end-if
             end-read
             subtract tutar                from  dep-toplam-tutar
        else  

              move hrkgir-depkod       to dep-toplam-anah
              read dep-toplam no lock invalid
                   initialize dep-toplam-rec
                   move hrkgir-depkod  to dep-toplam-anah
                   move hrkgir-ba      to dep-toplam-tip
              end-read
              add tutar               to  dep-toplam-tutar
      end-if
      rewrite dep-toplam-rec invalid
              write dep-toplam-rec invalid continue end-write
      end-rewrite.
 kdv-toplam-al.

      initialize kdv-toplam-rec
      initialize tutar
      move hrkgir-tl-tutar    to tutar
      move hrkgir-depkod       to depkod-kodu
       if hrkgir-corr-depkod not = spaces and not = zeroes

             move hrkgir-corr-depkod       to depkod-kodu
        end-if
      
      read depkod no lock invalid continue end-read
      if depkod-kdv > 0 
          
              move depkod-kdv to kdv-toplam-anah
              read kdv-toplam no lock invalid
                   initialize kdv-toplam-rec
                   move depkod-kdv to kdv-toplam-anah
                  
              end-read
              if hrkgir-corr-depkod not = spaces and not = zeroes
                 subtract  hrkgir-tl-tutar            from  kdv-toplam-tutar
              else
                 add  hrkgir-tl-tutar                to kdv-toplam-tutar
              end-if
                compute tutar rounded = ( hrkgir-tl-tutar  / (100 + depkod-kdv ) ) * 100 
               if hrkgir-corr-depkod not = spaces and not = zeroes
                     compute kdv-net-tutar rounded = kdv-net-tutar -  tutar
                    else
                   compute kdv-net-tutar rounded = kdv-net-tutar +  tutar
              end-if
                if hrkgir-corr-depkod not = spaces and not = zeroes
                     compute kdv-kdv-tutar rounded =    kdv-kdv-tutar  - ( hrkgir-tl-tutar  - tutar )
                    else
                  compute kdv-kdv-tutar rounded =    kdv-kdv-tutar  + ( hrkgir-tl-tutar  - tutar )
              end-if
              rewrite kdv-toplam-rec invalid
                      write kdv-toplam-rec invalid continue end-write
              end-rewrite
      end-if.
*
 Form1-Gd-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
         move event-action-fail to event-action,
           inquire form1-gd-1, y in satir x in sutun
              inquire Form1-Gd-1(satir,13),
                         cell-data in grid-islemno
              inquire Form1-Gd-1(satir,21),
                         cell-data in grid-fatno
             if sutun = 21 then 
                  perform fat-sil-gonder
             end-if
             
           

              if grid-islemno > 0 then
               if sutun = 20 then
                   inquire form1-gd-1(satir,20),
                           hidden-data in konu2-folio
                
                      call "/asya/ytl/obj/otel/kfolio.asy" using konu2-folio
                        on exception perform callerr-proc
                                not on exception
                         cancel "/asya/ytl/obj/otel/kfolio.asy" 
                   end-call      
                else
                  inquire Form1-Gd-1(satir,13),
                         hidden-data in hidden
                     if k-kodu-tasi = "ASYA" or "X   " then 
                        continue
                        else
                         if konuk-durumu = "H" and konuk-acik-hesap = 0 then 
                           exit paragraph
                         end-if
                         if grid-fatno > 0 then
                         exit paragraph
                         end-if
                      end-if
                         if hidden(1:1) = "1" then 
                           move "0" to hidden(1:1)
                            modify form1-gd-1,
                              y = satir,
                               row-color = 0
*                    cell-color = 480
                           else
                            move "1" to hidden(1:1)
                             modify form1-gd-1,
                              y = satir,
                               row-color = 290
                         end-if
                    modify Form1-Gd-1(satir,13),
                         hidden-data = hidden
                  end-if
              end-if
              
        when msg-goto-cell
        when msg-goto-cell-mouse
        when msg-begin-drag
        when msg-end-drag
        when msg-goto-cell-drag
             inquire form1-gd-1,y in yeni-y
             if yeni-y < 2
                move 2 to yeni-y eski-y
             end-if
*             if eski-y > zeroes 
*                modify form1-gd-1(eski-y),
*                       x = 2
*                       row-color = 0
*                       cell-color = 0
*             end-if
             modify form1-gd-1,
                    y = yeni-y,
                    start-x = 3
                    start-y = yeni-y
                    x = 9,
                    region-color = 480
*                    cell-color = 480
             move yeni-y to eski-y
    end-evaluate.
     
     .
*
 Form1-Bef-Create.
      initialize acc-not
      move konuk-acik-1  to acc-acik-1
      move konuk-acik-2  to acc-acik-2
      move konuk-voucher to acc-voucher
      initialize form1-title
      move "Folio "       to form1-title
      if konuk-durumu = "I"
         move "Inhouse ..."  to form1-title(15:)
           move 65793 to form-color 
      else
         move "History ..."  to form1-title(15:)
           move 304 to form-color 
      end-if
    

      if combo-rapor-tipi-value(1:1) = "D" then
           if rapor-folio-kuru = 1 then 
               move "Folio Kuru uzerinden dovizli" to form1-title(30:) 
             else 
               move Banka-adi    to form1-title(30:)
               move "-"          to form1-title(45:1)
               move d-adi-1       to form1-title(46:)

           end-if
          else 
             move "TL fiyatlari"  to form1-title(30:)

      end-if
      open input acenta doviz kodlar02 firma yanrez
        move konuk-firma      to firma-kodu acc-firma-adi
         read firma no lock invalid
              move spaces to firma-adi
         end-read
      move "-"               to acc-firma-adi(5:)
      move firma-adi         to acc-firma-adi(6:)
      initialize yanrez-rec
      if konuk-fol-kodu = "R" then
        
        move konuk-rez-no to yanrez-rezno
        move 1           to yanrez-sirano
        read yanrez no lock invalid continue
        end-read     
       end-if 
      
      
      
      
      
      move konuk-acenta      to acenta-kodu acc-acenta-adi
      read acenta no lock invalid
           move "Tanimsiz ..." to acenta-adi
      end-read
      move "-"               to acc-acenta-adi(5:)
      move acenta-adi        to acc-acenta-adi(6:)

      move konuk-doviz       to doviz-kodu acc-doviz-adi
      read doviz no lock invalid
           move "Tanimsiz ..." to d-adi-1
      end-read
      move "-"               to acc-doviz-adi(3:)
      move d-adi-1           to acc-doviz-adi(4:)
      move konuk-kur-degeri  to e-kur-tutar
      move e-kur-tutar       to acc-cin-kuru
      move konuk-dv-degeri   to etutar
      move etutar            to acc-fiyat
      move "A"               to kodlar02-tipi
      move konuk-pan-tipi    to kodlar02-kodu acc-pansiyon-adi
      read kodlar02 no lock invalid
           move "Tanimsiz"   to kodlar02-adi
      end-read
      move "-"               to acc-pansiyon-adi(3:)
      move kodlar02-adi      to acc-pansiyon-adi(4:)
      move "B"               to kodlar02-tipi
      move konuk-odeme-tipi  to kodlar02-kodu acc-odeme-adi
      read kodlar02 no lock invalid
           move "Tanimsiz"   to kodlar02-adi
      end-read
      move ode-tipi to fol-pes
      move "-"               to acc-odeme-adi(3:)
      move kodlar02-adi      to acc-odeme-adi(4:)

      close acenta doviz kodlar02 yanrez firma.

*
 oda-ara.
      initialize oda-cagir.
      if combo-folio-yeri-value(1:1) = "I"
         move "D"   to oda-db-cagir
      end-if.
      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odaara.asy" 
       end-call.
       move odano-cagir     to rapor-oda.
 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move rapor-oda     to odalar-anah
       read odalar         no lock invalid 
            initialize rapor-oda
            not invalid continue 
       end-read
       close odalar.
       display acc-oda.
       initialize rapor-folio.
       display acc-folio.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.
*
 folio-ara.
       initialize folara-cagir
       move combo-folio-yeri-value(1:1) to folara-cagri-tipi
       move rapor-oda             to folara-odano
       call "/asya/ytl/obj/otel/folara.asy" using folara-cagir
            on exception 
            perform callerr-proc
            not on exception
         cancel "/asya/ytl/obj/otel/folara.asy"
         if folara-no-cagir <> zeroes
           move folara-no-cagir to rapor-folio
           display acc-folio
         end-if
       end-call.
 folio-ara-exit.
       exit.
     .
*
 Form0-Pb-3-Link.
*
 Form0-Pb-3a-Link.
*
 detay-goster.
     inquire form1-gd-1,
             cursor-y in form1-i
     inquire form1-gd-1 (form1-i)
             record-data in Form1-Gd-1-Record
     move gd-1-col-14 to rapor-islem-tipi
      if rapor-islem-tipi = "T" then 
     evaluate key-status
     when 2 move "S" to rapor-islem-tipi
     when 3 move "P" to rapor-islem-tipi
     end-evaluate
      end-if
     evaluate rapor-islem-tipi
       when "S"  
       when "P"
       when "T"
          
           perform Acu-Form2-Routine
     end-evaluate
     move 4  to accept-control
     move 14 to control-id
     .
*
 Form2-Aft-Create.
     evaluate rapor-islem-tipi
       when "S" perform telefon-detay-goster
       when "P" perform pos-detay-goster
       when "T" perform transfer-detay-goster
       when other perform detay-goster-kapat 
     end-evaluate
     .
*
 telefon-detay-goster.
     modify Form2-Handle, title "Telefon Ayrinti Raporu"
     modify Form2-Gd-1, visible false
     modify Form2-Fr-1, visible true
     modify Form2-Fr-2, visible true
     modify Form2-La-10, visible true
                         size    10
     modify Form2-La-11, visible true
                         column  15
     modify Form2-La-12, visible false
     modify Form2-La-20, visible true
                         size    10
     modify Form2-La-21, visible true
                         column  15
     modify Form2-La-22, visible true
                         column  20
     modify Form2-La-30, visible true
                         size    10
     modify Form2-La-31, visible true
                         column  15
     modify Form2-La-40, visible true
                         size    10
     modify Form2-La-41, visible true
                         column  15
     modify Form2-La-42, visible true
                         column  20
     modify Form2-La-50, visible true
                         size    10
     modify Form2-La-51, visible true
                         column  15
     modify Form2-La-60, visible true
                         size    10
     modify Form2-La-61, visible true
                         column  15
     modify Form2-La-62, visible false
     modify Form2-Ef-10, visible true
                         column  16
                         size    8
     modify Form2-Ef-12, visible false
     modify Form2-Ef-20, visible true
                         column  16
                         size    4
     modify Form2-Ef-22, visible true
                         column  21
                         size    6
     modify Form2-Ef-30, visible true
                         column  16
                         size    5
     modify Form2-Ef-40, visible true
                         column  16
                         size    4
     modify Form2-Ef-42, visible true
                         column  21
                         size    6
     modify Form2-Ef-50, visible true
                         column  16
     modify Form2-Ef-60, visible true
                         column  16
                         size    15
     modify Form2-Ef-62, visible false
     
     initialize teldata-rec
     open input teldata
     move gd-1-col-1(1:2) to rapor-gun
     move gd-1-col-1(4:2) to rapor-ay
     move gd-1-col-1(7:4) to rapor-yil
     move gd-1-col-9      to rapor-islem
     move gd-1-col-10      to rapor-cekno
     move rapor-tarih to teldata-tarih
     start teldata key >= teldata-anah
       invalid
         continue
       not invalid
         perform with test after until fs-teldata = "10"
           read teldata next no lock
             end
               move "10" to fs-teldata
             not at end
               if teldata-tarih   = rapor-tarih and
                  teldata-islemno = rapor-cekno and
                  teldata-tipi    = "M"

                  modify Form2-La-10, TITLE
                    "Tarih"
                  modify Form2-La-20, TITLE
                    "Oda / Folio"
                  modify Form2-La-30, TITLE
                    "Islem No"
                  modify Form2-La-40, TITLE
                    "Kontur / Zaman"
                  modify Form2-La-42, TITLE
                    "/"
                  modify Form2-La-50, TITLE
                    "Numara"
                  modify Form2-La-60, TITLE
                    "Tutar"
                    
                  move teldata-gun to egun
                  move teldata-ay  to eay
                  move teldata-yil to eyil
                  modify Form2-Ef-10, VALUE etarih
                  modify Form2-Ef-20, VALUE teldata-odano
                  modify Form2-Ef-22, VALUE teldata-folio
                  modify Form2-Ef-30, VALUE teldata-islemno
                  modify Form2-Ef-40, VALUE teldata-kontur
                  modify Form2-Ef-42, VALUE teldata-sure
                  modify Form2-Ef-50, VALUE teldata-numara
                  move teldata-satis to etutar
                  modify Form2-Ef-60, VALUE etutar
                  move "10" to fs-teldata
               end-if
           end-read
         end-perform
     end-start
     close teldata
     move 4    to accept-control
     move 1001 to control-id
     .
*
 pos-detay-goster.
     modify Form2-Handle, title "Satis Ayrinti Raporu"
     modify Form2-Gd-1, visible true
     modify Form2-Fr-1, visible false
     modify Form2-Fr-2, visible false
     modify Form2-Fr-2, visible false
     modify Form2-La-10, visible false
     modify Form2-La-11, visible false
     modify Form2-La-12, visible false
     modify Form2-La-20, visible false
     modify Form2-La-21, visible false
     modify Form2-La-22, visible false
     modify Form2-La-30, visible false
     modify Form2-La-31, visible false
     modify Form2-La-40, visible false
     modify Form2-La-41, visible false
     modify Form2-La-42, visible false
     modify Form2-La-50, visible false
     modify Form2-La-51, visible false
     modify Form2-La-60, visible false
     modify Form2-La-61, visible false
     modify Form2-La-62, visible false
     modify Form2-Ef-10, visible false
     modify Form2-Ef-12, visible false
     modify Form2-Ef-20, visible false
     modify Form2-Ef-22, visible false
     modify Form2-Ef-30, visible false
     modify Form2-Ef-40, visible false
     modify Form2-Ef-42, visible false
     modify Form2-Ef-50, visible false
     modify Form2-Ef-60, visible false
     modify Form2-Ef-62, visible false
     
     initialize cost-degiskenler p-rec costhrk-rec i
     move cost-sirketi to costhrk-dosya-adres p-dosya-alan posdep-dosya-adres
     move cost-sirketi to satkod-dosya-adres

     move stok-sirketi to depart-dosya-adres
     move gd-1-col-1(1:2) to rapor-gun
     move gd-1-col-1(4:2) to rapor-ay
     move gd-1-col-1(7:4) to rapor-yil
     move gd-1-col-9     to rapor-islem
     move gd-1-col-10      to rapor-cekno
     move rapor-yil       to costhrk-dosya-yil    p-dosya-yil   
     move rapor-ay        to costhrk-dosya-ay     p-dosya-ay
     move rapor-gun   to   p-dosya-gun  
     move rapor-tarih     to costhrk-tarih         
     move rapor-cekno     to costhrk-fis-no p-fis-no
     move "C"             to costhrk-ana-tip
     move "A"             to costhrk-alt-tip
     open input costhrk satkod depart  p posdep

 




     
     start p key >= p-alt-2
       invalid
         continue
       not invalid
         modify form2-gd-1,reset-grid = 1 mass-update = 1
         move "Kodu"        to cost-gd-kodu
         move "Recete Adi"  to cost-gd-adi
         move "Adet"        to cost-gd-mik
         move "Tutar"       to cost-gd-tl
         modify form2-gd-1, record-to-add = cost-gd-dizi
         add 1 to i
         perform with test after until fs-p = "10"
           read p next no lock
             end
               move "10" to fs-p
             not at end
               if 

                  p-fis-no  = rapor-cekno 
                

                  
                    initialize posdep-rec
                     move p-depkod to posdep-anah
                     read posdep no lock invalid
                       stop " "
                      display message box "posdep bulunamadi "  p-depkod
                     end-read
                  
                 
                     
                 

                 
                     initialize satkod-rec
                     move p-rec-kodu    to       satkod-kodu
                     move posdep-recete-ana-dep    to satkod-ana-dep
                     move posdep-recete-alt-dep     to satkod-alt-dep
                     read satkod no lock
                       invalid
                         move all "*"  to satkod-adi
                     end-read
                     move satkod-adi   to cost-gd-adi
                     move p-adet to emiktar
                     move emiktar      to cost-gd-mik
                 

                 
                     move  p-tutar-tl to cost-tl
                     move  p-tutar-dv to cost-dv
                     add p-tutar-tl to    cost-top-tl
                     add p-tutar-dv to    cost-top-dv
                     perform grid2-deger-yukle
               else
                  move "10" to fs-p
               end-if
           end-read
         end-perform

         initialize cost-gd-dizi
         modify form2-gd-1, record-to-add = cost-gd-dizi
         add 1 to i
         move all high-value to cost-gd-adi
         move "TOPLAM :"  to cost-gd-adi(13:8)
         move cost-top-tl to e-tutar
         move e-tutar     to cost-gd-tl
          move cost-top-dv to e-tutar
         move e-tutar     to cost-gd-dv
         modify form2-gd-1, record-to-add = cost-gd-dizi
                            Y             = i
                            row-color     = 432
         modify form2-gd-1,mass-update = 0
     end-start
     close costhrk satkod depart p posdep 
     move 4    to accept-control
     move 1001 to control-id
     .
*
 grid2-deger-yukle.
        move cost-tl          to e-tutar
        move e-tutar          to cost-gd-tl
         move cost-dv          to e-tutar
        move e-tutar          to cost-gd-dv
        modify form2-gd-1, record-to-add(cost-gd-dizi)
        add 1 to i
        move costhrk-rec-sira to eski-rec-sira
       
        initialize cost-tl.
     .
*
 transfer-detay-goster.
     modify Form2-Handle, title "Cek Transfer Bilgisi"
     modify Form2-Gd-1, visible false
     modify Form2-Fr-1, visible true
     modify Form2-La-10, visible true
                         size    14
     modify Form2-La-11, visible true
                         column  18
     modify Form2-La-12, visible true
                         column  23
     modify Form2-La-20, visible true
                         size    14
     modify Form2-La-21, visible true
                         column  18
     modify Form2-La-22, visible false
     modify Form2-La-30, visible true
                         size    14
     modify Form2-La-31, visible true
                         column  18
     modify Form2-La-40, visible true
                         size    14
     modify Form2-La-41, visible true
                         column  18
     modify Form2-La-42, visible true
                         column  27
     modify Form2-La-50, visible true
                         size    14
     modify Form2-La-51, visible true
                         column  18
     modify Form2-La-60, visible true
                         size    14
     modify Form2-La-61, visible true
                         column  18
     modify Form2-La-62, visible true
                         column  27
     modify Form2-Ef-10, visible true
                         column  19
                         size    4
     modify Form2-Ef-12, visible true
                         column  24
                         size    6
     modify Form2-Ef-20, visible true
                         column  19
                         size    24
     modify Form2-Ef-22, visible false
     modify Form2-Ef-30, visible true
                         column  19
                         size    24
     modify Form2-Ef-40, visible true
                         column  19
                         size    8
     modify Form2-Ef-42, visible true
                         column  28
                         size    8
     modify Form2-Ef-50, visible true
                         column  19
     modify Form2-Ef-60, visible true
                         column  19
                         size    8
     modify Form2-Ef-62, visible true
                         column  28
                         size    6
     
     initialize cektr-rec
     open input cektr
     move gd-1-col-1(1:2) to rapor-gun
     move gd-1-col-1(4:2) to rapor-ay
     move gd-1-col-1(7:4) to rapor-yil
     move gd-1-col-9      to rapor-islem
     move rapor-tarih to cektr-tarih
     start cektr key >= cektr-tarih
       invalid
         continue
       not invalid
         perform with test after until (fs-cektr = "10" or fs-cektr = "OK")
           read cektr next no lock
             end
               move "10" to fs-cektr
             not at end
               if cektr-tarih = rapor-tarih
                  if cektr-yeni-folio = rapor-folio and
                     cektr-islem      = rapor-islem

                     modify Form2-La-10, TITLE
                       "Eski Oda / Folio"
                     modify Form2-La-20, TITLE
                       "Musteri Adi"
                     modify Form2-La-30, TITLE
                       "Musteri Soyadi"
                     modify Form2-La-40, TITLE
                       "C/in - C/Out"
                     modify Form2-La-42, TITLE
                       "-"
                     modify Form2-La-50, TITLE
                       "Transferi Yapan"
                     modify Form2-La-60, TITLE
                       "Transfer Tarih / Zaman"
                     
                     open input konuk
                     move cektr-eski-folio to konuk-folio
                     read konuk no lock
                       invalid
                         move all "*" to konuk-rec
                     end-read
                     close konuk

                     open input kllnc
                     move cektr-staf  to k-kodu
                     read kllnc no lock
                       invalid
                         move all "*" to kllnc-rec
                     end-read
                     close kllnc

                     modify Form2-Ef-10, VALUE konuk-odano
                     modify Form2-Ef-12, VALUE cektr-eski-folio
                     modify Form2-Ef-20, VALUE konuk-adi
                     modify Form2-Ef-30, VALUE konuk-soyadi
                     move konuk-gel-gun to egun
                     move konuk-gel-ay  to eay
                     move konuk-gel-yil to eyil
                     modify Form2-Ef-40, VALUE etarih
                     move konuk-git-gun to egun
                     move konuk-git-ay  to eay
                     move konuk-git-yil to eyil
                     modify Form2-Ef-42, VALUE etarih
                     modify Form2-Ef-50, VALUE k-adi
                     move cektr-isl-gun to egun
                     move cektr-isl-ay  to eay
                     move cektr-isl-yil to eyil
                     modify Form2-Ef-60, VALUE etarih
                     move cektr-saat    to esaat
                     move cektr-dakika  to edakika
                     move cektr-saniye  to esaniye
                     modify Form2-Ef-62, VALUE ezaman
                  end-if
               else
                  move "10" to fs-cektr
               end-if
           end-read
         end-perform
     end-start
     close cektr
     move 4    to accept-control
     move 1001 to control-id
     .
*
 detay-goster-kapat.
     set Exit-Pushed to true
     .
*
 Form2-Pb-1-Ex-Cmd-Clicked.
     perform detay-goster-kapat
     .
*
*

*
 Form1-Gd-1-Ex-Other.
       
      initialize Form1-Gd-1-record grid-islemno
    inquire Form1-Gd-1, cursor-y in satir cursor-x in sutun
    inquire Form1-Gd-1(satir),
            record-data in form1-gd-1-record
            
    move gd-1-col-9   to grid-islemno
    evaluate event-type 
         when msg-begin-entry
             move event-action-fail to event-action,
            
    end-evaluate.
     evaluate key-status
       when 3

        when 14
            compute TLbakiye = TLgenel-borc-toplam - TLgenel-alac-toplam
          if tlbakiye not = 0 and (k-kodu-tasi= "X   " or "ASYA") and konuk-durumu = "H" 
            and konuk-fol-kodu = "E"
             move 12 to konuk-git-ay 
             move 31 to konuk-git-gun
             open i-o konuk
             rewrite konuk-rec invalid stop " " end-rewrite
             close konuk
           end-if
        WHEN 12
           if konuk-durumu not = "I" and  k-kodu-tasi not = "X   "  and k-kodu-tasi not = "ASYA"  then 
                    display message box "Kapali Folio"
                    exit paragraph
           end-if
          
              initialize satir sutun
                  open i-o genelfis
                 move 1 to genelfis-anahtar
                read genelfis no lock invalid
                       initialize genelfis-rec 
                      move 1 to genelfis-anahtar
                     not invalid continue 
                end-read
                add 1 to cekgir-oto
                move cekgir-oto to hrkgir-islem
               rewrite genelfis-rec invalid 
                   write genelfis-rec 
               end-write continue
              end-rewrite
              close genelfis
              if grid-islemno not = 0 
                 initialize form-acik bol-tut
                  move 0 to kay-deg
                 perform acu-screen1-routine
                  if kay-deg = 0 then 
                       
                       exit paragraph
                  end-if
                 
                 open i-o konu2
                  move gonder-kaynak-folio to konu2-folio
                  read konu2 no lock invalid
                       display message box "Folio okunamadi"
                       close konu2
                       exit paragraph
                  end-read
                 initialize mesaj-degiskenler
               
               
                 initialize Form1-Gd-1-record 
                 inquire Form1-Gd-1, cursor-y in satir cursor-x in sutun
                 inquire Form1-Gd-1(satir,13),
                         cell-data in grid-islemno
                 if konuk-fol-kodu = "R"
                    open i-o romhrk hrk2 yromhrk
                       perform romhrk-degistir
                    close romhrk hrk2 yromhrk
                 else    
                    open i-o exthrk hrk2 yromhrk
                       perform exthrk-degistir
                    close exthrk hrk2 yromhrk
                 end-if
                  close konu2
                 perform  Form1-Bef-Create
                 perform  Form1-aft-Initdata
                 
              end-if 

     when 9 

      move key-status to  esk-status 
*     perform hrk-0
      when 19
      when 15
         move key-status to  esk-status 
         set exit-pushed to true
      when 1055 

              compute link-ref =  secili-tab - 1
             call "/asya/ytl/obj/otel/folfat1.asy" 
                 using  konuk-folio, konuk-odano, link-ref
              on exception 
                  perform callerr-proc
                  exit paragraph
              not on exception 
                  cancel "/asya/ytl/obj/otel/folfat1.asy"
            end-call
             perform tum-tab-ac
      when 1056
           perform hatali-route-al
      when 11 
           if  acc-not(1:3) = "A42" and (k-kodu-tasi = "X   " or "ASYA" )

              call "/asya/ytl/obj/otel/cekgir2.asy" using konuk-folio
                      on exception perform callerr-proc
                       not on exception
                       cancel "/asya/ytl/obj/otel/cekgir2.asy" 
                  end-call

           else
       
           if ( ( konuk-durumu = "I"  or konuk-acik-hesap = 1 )) 
         
**************************> cekgir.asy
              initialize dokcagir-tasi
              set dokcagir-tasi-call-cekgir1 to true
              move konuk-folio               to dokcagir-konuk-folio
              compute dokcagir-pencere = secili-tab - 1
              perform dokcagir-call
              move dokcagir-konuk-folio      to konuk-folio
              perform  Form1-Bef-Create
              perform tum-tab-ac
            else
              display message box
                "Bu folioya kredi ceki isleyemezsiniz"
          end-if
          end-if
          
       
     
     when 1
     when 2
     when 3
        perform detay-goster

     when 5
               inquire Form1-Gd-1(satir,13),
                         cell-data in grid-islemno
                
                   move grid-islemno  to romhrk-islem exthrk-islem
                   move konuk-folio   to romhrk-folio exthrk-folio
                 open i-o nt
               initialize not-rec
               if konuk-fol-kodu = "R"
                  move  "RHR"     to NOT-DOS
                  move romhrk-anah to  NOT-DOS-ANAH 

                  else
                  move  "EHR"      to NOT-DOS
                  move exthrk-anah to  NOT-DOS-ANAH 

               end-if
               read nt no lock invalid initialize not1
                  end-read
               move  not1  to form-acik
              perform acu-form3-routine
            
           close nt
             perform  Form1-Bef-Create
             perform  Form1-aft-Initdata
          
      when 8
        
          if konuk-durumu  = "H" and konuk-acik-hesap not  = 1 
*          and k-kodu-tasi not = "1919"  then 
            display message box "Kapali Folio"
            exit paragraph
          end-if
          initialize link-cektr iii
          inquire Form1-Gd-1(satir,13),
                         last-row in son-satir
             perform varying satir from 1 by 1 until  satir > son-satir
                 inquire Form1-Gd-1(satir,13),
                         hidden-data in hidden
                         if hidden(1:1) = "1" then 
                           inquire Form1-Gd-1(satir,13),
                            cell-data in grid-islemno
                            add 1 to iii
                                  move grid-islemno to link-islem(iii)
                                  if iii > 99 then 
                                    display message box " En fazla 99 hareket gonderilebilir"
                                    exit paragraph
                                  end-if   
                         end-if
                        
             end-perform
              move secili-tab to pencere
              move konuk-folio to link-folio
               call "/asya/ytl/obj/otel/cektr.asy" using link-cektr
                    on exception perform callerr-proc
                       not on exception
                       cancel "/asya/ytl/obj/otel/cektr.asy" 
                  end-call

              perform tum-tab-ac

      when 7
      initialize gon-sec
         perform acu-screen2-routine
            
            
         if gon-sec = 1  then
          open i-o romhrk exthrk
              inquire Form1-Gd-1(satir,13),
                         last-row in son-satir
             perform varying satir from 1 by 1 until  satir > son-satir
             inquire Form1-Gd-1(satir,13),
                         hidden-data in hidden
                         if hidden(1:1) = "1" then 
                           inquire Form1-Gd-1(satir,13),
                            cell-data in grid-islemno
                            
                           if konuk-fol-kodu = "R"  
                            
                            move konuk-folio  to romhrk-folio
                            move grid-islemno to romhrk-islem
                            read romhrk no lock invalid 
                                display message box "gonderilemedi"
                               not invalid
                                move gonder-ref to romhrk-ref
                                rewrite romhrk-rec invalid continue
                                end-rewrite
                                perform log-operation-romhrk
                             end-read
                          
                             else
                             move konuk-folio  to exthrk-folio
                            move grid-islemno to exthrk-islem
                            read exthrk no lock invalid 
                                display message box "gonderilemedi"
                               not invalid
                                move gonder-ref to exthrk-ref
                                rewrite exthrk-rec invalid continue
                                end-rewrite
                                perform log-operation-exthrk
                             end-read
                             
                             
                         end-if
                        end-if

             end-perform
             close romhrk exthrk
              move secili-tab to pencere
             perform tum-tab-ac
        end-if
        
      when 23
          if k-kodu-tasi not = "ASYA" then 
            display message box "Yetkisiz Islem"
            exit paragraph
           end-if
               if grid-islemno not = 0 
                 
                 initialize mesaj-degiskenler
                 move "Kayit Silinsin mi ?"  to mmesaj-1
                 move " [ KAYIT BOLME ] " to mmesaj-title
                 move 2           to mmesaj-type
                 move 1           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 if donus-kodu = 2
                    move 4        to accept-control
                   
                    exit paragraph
                 end-if
                 initialize Form1-Gd-1-record 
                 inquire Form1-Gd-1, cursor-y in satir cursor-x in sutun
                 inquire Form1-Gd-1(satir,13),
                         cell-data in grid-islemno
                 if konuk-fol-kodu = "R"
                    open i-o romhrk hrk2 yromhrk
                      move grid-islemno  to romhrk-islem
                       move konuk-folio   to romhrk-folio
                       read romhrk no lock invalid 
                            display message box "Slinecek Kayit Bulunamadi....."
                                              title = " [ Kayit Yok ] "
                            exit paragraph
                       
                        not invalid 
                         Open i-o silhrk
                         move romhrk-rec to silhrk-rec
                         accept silhrk-zaman from time 
                         move calisma-tarihi to silhrk-tarih
                         move k-kodu-tasi to romhrk-staf silhrk-staf
                        
                         write silhrk-rec invalid continue
                         end-write
                         close silhrk
                         move romhrk-anah       to hrk2-anah 
                         read hrk2 no lock invalid
                              move romhrk-folio     to hrk2-kaynak-folio                 
                         end-read
                        delete romhrk 
                           invalid
                                display message box  "Islem Gerceklestirilemedi"
                            not invalid
                              move hrk2-kaynak-folio to yromhrk-folio
                              move romhrk-islem      to yromhrk-islem
                              read yromhrk no lock invalid
                                   stop " "
                              end-read
                              delete yromhrk invalid stop " " end-delete
                              delete hrk2    invalid stop " " end-delete
                          end-delete
                   end-read
                    close romhrk hrk2 yromhrk
                 else 
                    open i-o exthrk hrk2 yromhrk
                        move grid-islemno  to exthrk-islem
                       move konuk-folio   to exthrk-folio
                       read exthrk no lock invalid 
                            display message box "Silinecek Kayit Bulunamadi....."
                                              title = " [ Kayit Yok ] "
                            exit paragraph
                       
                        not invalid 
                         Open i-o silhrk
                         move exthrk-rec to silhrk-rec
                         accept silhrk-zaman from time 
                         move calisma-tarihi to silhrk-tarih
                         move k-kodu-tasi to romhrk-staf silhrk-staf
                        
                         write silhrk-rec invalid continue
                         end-write
                         close silhrk
                         move exthrk-anah       to hrk2-anah 
                         read hrk2 no lock invalid
                              move romhrk-folio     to hrk2-kaynak-folio                 
                         end-read
                        delete exthrk 
                           invalid
                                display message box  "Islem Gerceklestirilemedi"
                            not invalid
                              move hrk2-kaynak-folio to yromhrk-folio
                              move exthrk-islem      to yromhrk-islem
                              read yromhrk no lock invalid
                                   stop " "
                              end-read
                              delete yromhrk invalid stop " " end-delete
                              delete hrk2    invalid stop " " end-delete
                          end-delete
                   end-read
                    close exthrk hrk2 yromhrk
                 end-if
                
                 
              end-if
       

         when 6            
            if konuk-durumu = "H" and 
               k-kodu-tasi = "ASYA" then
               inquire Form1-Gd-1(satir,13),
                       cell-data in grid-islemno
                 if konuk-fol-kodu = "R"
                      open i-o romhrk hrk2 yromhrk
                      move grid-islemno  to romhrk-islem   yromhrk-islem
                      move konuk-folio   to romhrk-folio    yromhrk-folio
                      read romhrk no lock invalid 
                           display message box " hataaaa"
                      not invalid 
                         if romhrk-depkod = "000"    
                            move "054" to romhrk-depkod
                            rewrite romhrk-rec invalid stop " " end-rewrite
                            perform log-operation-romhrk
                          read yromhrk no lock invalid 
                                display message box " hataaaa"
                                not invalid 
                                move "054" to yromhrk-depkod
                            rewrite yromhrk-rec invalid stop " " end-rewrite
                          end-read
                         end-if
                      end-read
                 end-if
            end-if
          if konuk-durumu not = "I" and 
             k-kodu-tasi not = "ASYA" and 
             konuk-acik-hesap not  = 1
                display message box "Kapali Folio"
                exit paragraph
           end-if
                 inquire Form1-Gd-1, 
                         cursor-y in satir 
                         cursor-x in sutun
                 inquire Form1-Gd-1(satir,21),
                         cell-data in grid-fatno

           if grid-fatno not = zeroes 
               display message box "Fatura Kesilmis Harekete Bolme Islemi Yapilamaz.."
                               title "Uyari"
                               icon 1
                   exit paragraph 
           end-if 
             initialize satir sutun
                  open i-o genelfis
                 move 1 to genelfis-anahtar
                read genelfis no lock invalid
                       initialize genelfis-rec 
                      move 1 to genelfis-anahtar
                     not invalid continue 
                end-read
                add 1 to cekgir-oto
                move cekgir-oto to hrkgir-islem
               rewrite genelfis-rec invalid 
                   write genelfis-rec 
               end-write continue
              end-rewrite
              close genelfis
               
              if grid-islemno not = 0 
                 initialize form-acik bol-tut
                 perform acu-form2a-routine
                  move bol-tut to parca1
                  if parca1 not > 0 then
                     display message box "Lutfen Tutar Giriniz"
                     move 4        to accept-control
                    
                     exit paragraph
                  end-if
                 initialize mesaj-degiskenler
                 move "Kayit Bolunsun mu ?"  to mmesaj-1
                 move " [ KAYIT BOLME ] " to mmesaj-title
                 move 2           to mmesaj-type
                 move 1           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 if donus-kodu = 2
                    move 4        to accept-control
                    exit paragraph
                 end-if

                 initialize Form1-Gd-1-record 
                 inquire Form1-Gd-1, 
                         cursor-y in satir 
                         cursor-x in sutun

                 inquire Form1-Gd-1(satir,13),
                         cell-data in grid-islemno
                         
                 if konuk-fol-kodu = "R"
                    open i-o romhrk hrk2 yromhrk
                       perform romhrk-bol
                    close romhrk hrk2 yromhrk
                 else 
                    open i-o exthrk hrk2 yromhrk
                       perform exthrk-bol
                    close exthrk hrk2 yromhrk
                 end-if
                 perform  Form1-Bef-Create
                 perform  Form1-aft-Initdata
                 
              end-if
           WHEN OTHER 
             CONTinue
           
     end-evaluate.
     .
*
 Form1-Aft-Create.
     move 4  to accept-control
     move 14 to control-id



     .

*
 Before-Procedurelar.
     Evaluate control-id
       when 10
         perform folio-ara  thru folio-ara-exit
     end-evaluate
     .
     .

depart-ara.
      initialize depkod-cagir
                 call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                    on exception perform callerr-proc
                       not on exception
                       cancel "/asya/ytl/obj/otel/depara.asy" 
                  end-call
                          move depkod-dep-kodu to rapor-departman
               display accept-departman
               move 4 to accept-control
               move 14 to control-id
        .


 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to rapor-banka
       display accept-banka
        move 4 to accept-control
        move 21 to control-id.
 after-banka.
       open input banka.
       initialize banka-rec.
       move rapor-banka    to banka-kodu
       read banka        no lock invalid 
            add 1        to gec-gecme
             
             move "Tanimsiz" to banka-adi
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to l-banka-adi.


       display label-banka-adi
        .
 
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to rapor-doviz
       display accept-doviz
       move 4 to accept-control
        move 22 to control-id..
 after-doviz.
       open input doviz.
       initialize doviz-rec.
       move rapor-doviz    to doviz-kodu
       read doviz         no lock invalid 
            add  1        to gec-gecme
            move "Tanimsiz" to d-adi-1
            
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to l-doviz-adi
       display label-doviz-adi.
 
 after-depkod.
    
    if rapor-departman = spaces or rapor-departman = zeroes
       move "Tm Departmanlar" to l-depkod-adi
       else
            
            open input depkod
            move rapor-departman   to depkod-anah
            read depkod no lock invalid
                 move "Tanimsiz ..." to depkod-adi
                 move 1 to gec-gecme
                 not invalid 
                continue 
            end-read
            close depkod
            move depkod-adi to l-depkod-adi
            display l-depart-adi
         end-if   
     
     .
 after-folio-kuru.
        
         if rapor-folio-kuru = 1 then 
             move 0 to dis-dov
          else 
             move 1 to dis-dov 
          end-if
           display accept-banka accept-doviz    .
           .
 
 tipi-after.
        if combo-rapor-tipi-value(1:1) = "D"
           move 1 to vis-dov
         else 
           move 0 to vis-dov 
           move 1 to dis-dov
          
        end-if
        display label-banka accept-banka label-banka-adi
                   label-doviz accept-doviz label-doviz-adi
                   label-folio-kuru label-folio-kurua
         perform after-folio-kuru
       .
 
       .
*
 hrk-0.
     if isyeri-adres-tasi = "park2009" or "gard2009" or "yedepark" or "yedegard" and k-kodu-tasi = "S   "
       open i-o exthrk romhrk
       initialize romhrk-rec exthrk-rec
        if konuk-fol-kodu = "R" then 
          
          move konuk-folio to romhrk-folio
          start romhrk key >= romhrk-anah1 
            invalid continue
            not invalid
            perform until fs-romhrk = "10" 
               read romhrk next no lock 
               end move "10" to fs-romhrk
               not end 
                if romhrk-folio = konuk-folio
                   delete romhrk invalid stop " " end-delete
                else
                  move "10" to fs-romhrk

                end-if
               end-read
            end-perform
          end-start
           else
            move konuk-folio to exthrk-folio
          start exthrk key >= exthrk-anah1 
            invalid continue
            not invalid
            perform until fs-exthrk = "10" 
               read exthrk next no lock 
               end move "10" to fs-exthrk
               not end 
                if exthrk-folio = konuk-folio
                   delete exthrk invalid stop " " end-delete
                else
                  move "10" to fs-exthrk

                end-if
              end-read
            end-perform
           


        end-if
        close exthrk romhrk
          move 99999999 to link-fol-no
          set exit-pushed to true
        display message box "OK"
       end-if.
*
*
 profil-cagir.
       initialize aranan-rez-no
       move isyeri-adres-tasi         to bulunan-rez-sirketi
       
       call "/asya/ytl/obj/otel/profbuld.asy" using profbul-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/profbuld.asy" 
       end-call
    
       if secildi = 1 or 
          secildi = 2 OR 
          secildi = 3
           move bulunan-profil-no       to mis-no 
           move bulunan-profil-sirket   to ps1    
           
          
            display acc-mis-no acc-ps1 
            move ps1    to ref-profil-sirket(secili-tab - 1 ) 
             move mis-no to ref-profil-no(secili-tab - 1 ) 
            if secili-tab > 1 then
            open i-o folref
             move konuk-folio to folref-folio
             compute folref-ref =  secili-tab - 1
             move bulunan-profil-no to folref-profil-no
             move bulunan-profil-sirket to folref-profil-sirket
             move pes to folref-ode
             write folref-rec invalid rewrite folref-rec end-write
             close folref
             perform pen-kont
           end-if
          
       end-if.

*
 Form1-Ex-Other.
      
 
     evaluate key-status
     when 1055 
         compute link-ref =  secili-tab - 1
             call "/asya/ytl/obj/otel/folfat1.asy" 
                 using  konuk-folio, konuk-odano, link-ref
              on exception 
                  perform callerr-proc
                  exit paragraph
              not on exception 
                  cancel "/asya/ytl/obj/otel/folfat1.asy"
            end-call
        

     when 1345
         perform folio-rapor
     when 1346
         perform Acu-Form4-Routine

     when 16
     
           move konuk-adi         to aranacak-adi  
           move konuk-soyadi      to aranacak-soyadi
           move mis-no           to bulunan-profil-no
           move ps1              to bulunan-profil-sirket
           
           perform profil-cagir
           
     
*     when 8
*          perform hrk-0
     when 2002
          perform toplu-kontrol
                if gec-gecme = 0 
               
                   perform liste-islem
              
                move 4 to accept-control
                move 9 to control-id
                end-if
    
      when 3131 
        if konuk-fol-kodu = "R" 

         move 9 to link-nereden 
         move "REZ"   to  link-NOT-DOS    
         move konuk-rez-no to link-NOT-DOS-ANAH   
         else
         if konuk-extra-rez-no > 0 then
           move 10 to link-nereden 
           move "REZ"   to  link-NOT-DOS    
           move konuk-extra-rez-no to link-NOT-DOS-ANAH    
           else
           move 10 to link-nereden 
           move "KON"   to  link-NOT-DOS    
           move konuk-folio to link-NOT-DOS-ANAH    
           
          end-if

       end-if 
      
           move "U"     to  link-not-islem
           
           string konuk-adi delimited by "  "
                  " " delimited by size
                  konuk-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
                  display not-ac
     end-evaluate
     .

*
 konuk-ara.
      initialize konuk-cagir.
      move combo-folio-yeri-value(1:1)  to konuk-cagri-tipi
      call "/asya/ytl/obj/otel/konukara.asy" using konuk-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/konukara.asy" 
       end-call.
       move konuk-folio-cagir  to rapor-folio.
       display acc-folio. 
       open input konuk
       initialize konuk-rec
       move rapor-folio        to konuk-folio
       read konuk no lock invalid
            close konuk
            exit paragraph
       end-read
       close konuk.
       move konuk-odano        to rapor-oda.
       display acc-oda.
       move 4 to accept-control
       move 17 to control-id.


*
 romhrk-degistir.
       move grid-islemno  to romhrk-islem
       move konuk-folio   to romhrk-folio
       read romhrk no lock invalid 
            display message box "slem Bulunamadi....."
                              title = " [ Kayit Yok ] "
            exit paragraph
            not invalid 
             
                 move romhrk-anah       to hrk2-anah
 
                 read hrk2 no lock invalid
                       display message box "islem yapilamadi"
                       not invalid
                         move hrk2-kaynak-folio to yromhrk-folio
                      move romhrk-islem to yromhrk-islem
                      read yromhrk no lock invalid
                           display message box "Islem Yatim kaldi"
                           not invalid
                           delete yromhrk end-delete
                             move gonder-kaynak-folio   to hrk2-kaynak-folio  yromhrk-folio
                             write yromhrk-rec invalid stop  "  " 
                                 not invalid
                                  move gonder-kaynak-folio   to hrk2-kaynak-folio         


                                 rewrite hrk2-rec invalid stop " " end-rewrite
                             end-write
                       end-read
                             
                 end-read
             
             
             
        end-read.
        display message box "Hareket Kaynagi degisti" new-line
                         konu2-adi konu2-soyadi .
           
            
*
 exthrk-degistir.
       move grid-islemno  to exthrk-islem
       move konuk-folio   to exthrk-folio
       read exthrk no lock invalid 
            display message box "slem Bulunamadi....."
                              title = " [ Kayit Yok ] "
            exit paragraph
            not invalid 
             
                 move exthrk-anah       to hrk2-anah
 
                 read hrk2 no lock invalid
                         display message box "islem yapilamadi"
                       not invalid
                         move hrk2-kaynak-folio to yromhrk-folio
                      move exthrk-islem to yromhrk-islem
                      read yromhrk no lock invalid
                           display message box "Islem Yatim kaldi"
                           not invalid
                           delete yromhrk end-delete
                             move gonder-kaynak-folio   to hrk2-kaynak-folio  yromhrk-folio
                             write yromhrk-rec invalid stop  "  " 
                                 not invalid
                                  move gonder-kaynak-folio   to hrk2-kaynak-folio   
                                 rewrite hrk2-rec invalid stop " " end-rewrite
                             end-write
                       end-read
                                   
                 end-read
             
             
             
        end-read
            display message box "Hareket Kaynagi degisti" new-line
                         konu2-adi konu2-soyadi .
                        .
*
 romhrk-bol.
       move grid-islemno  to romhrk-islem
       move konuk-folio   to romhrk-folio
       read romhrk no lock invalid 
            display message box "Bolunecek Kayit Bulunamadi....."
                              title = " [ Kayit Yok ] "
            exit paragraph
            not invalid 
             if parca1 < ROMHRK-TL-TUTAR then
                 open i-o silhrk
                 move romhrk-rec to silhrk-rec
                 accept silhrk-zaman from time 
                 move calisma-tarihi to silhrk-tarih
                 move k-kodu-tasi to romhrk-staf silhrk-staf
                 move "Split" to  SILHRK-KART-NO 
                 write silhrk-rec invalid continue
                 end-write
                 close silhrk
                 move romhrk-anah       to hrk2-anah 
                 read hrk2 no lock invalid
                      move romhrk-folio     to hrk2-kaynak-folio                 
                 end-read
                  subtract parca1 from romhrk-tl-tutar
                 rewrite romhrk-rec invalid 
                        display message box  "Islem Gerceklestirilemedi"
                    not invalid
                      move hrk2-kaynak-folio to yromhrk-folio
                      move romhrk-islem to yromhrk-islem
                      read yromhrk no lock invalid
                           stop " "
                      end-read
                      
                       subtract parca1 from yromhrk-tl-tutar
                      rewrite yromhrk-rec invalid stop " " end-rewrite 

                      move cekgir-oto to romhrk-islem hrk2-islem yromhrk-islem
                      move parca1 to romhrk-tl-tutar  yromhrk-tl-tutar
                      
                         write romhrk-rec invalid 
                            display message box  "Islem Gerceklestirilemedi Balans bozuldu"
                             not invalid
                           write yromhrk-rec invalid stop " " end-write 
                          write hrk2-rec invalid 
                                display message box "Kaynak Islem Basarisiz..."
                          end-write
                              display message box  "Islem Tamam"
                           
                          end-write 
                          perform log-operation-romhrk
                 end-rewrite
                 perform log-operation-romhrk
             
                else 
                  display message box "Daha kucuk parcaya bolun"
              end-if
        end-read
           
            
            .
*
 exthrk-bol.
       
       move grid-islemno  to exthrk-islem
       move konuk-folio   to exthrk-folio

       read exthrk no lock invalid 


            display message box "Bolunecek Kayit Bulunamadi....."
                              title = " [ Kayit Yok ] "
            exit paragraph
            not invalid 
             if parca1 < extHRK-TL-TUTAR then
                 open i-o silhrk
                 move exthrk-rec to silhrk-rec
                 accept silhrk-zaman from time 
                 move calisma-tarihi to silhrk-tarih
                 move k-kodu-tasi to romhrk-staf
                 move "KART" to SILHRK-KART-NO 
                 write silhrk-rec invalid continue
                 end-write
                 close silhrk
                 move exthrk-anah      to hrk2-anah
                 read hrk2 no lock invalid
                      move exthrk-folio     to hrk2-kaynak-folio                 
                 end-read
                 subtract parca1 from exthrk-tl-tutar
                  move hrk2-kaynak-folio to yromhrk-folio
                      move exthrk-islem to yromhrk-islem
                      read yromhrk no lock invalid
                           stop " "
                      end-read

                 rewrite exthrk-rec invalid 
                        display message box  "Islem Gerceklestirilemedi"
                    not invalid
                     
                      subtract parca1 from yromhrk-tl-tutar
                      rewrite yromhrk-rec invalid stop " " end-rewrite 

                     move cekgir-oto to exthrk-islem hrk2-islem yromhrk-islem
                      move parca1 to exthrk-tl-tutar yromhrk-tl-tutar 
                         write exthrk-rec invalid 
                            display message box  "Islem Gerceklestirilemedi"
                             not invalid
                          write yromhrk-rec invalid stop " " end-write
                          write hrk2-rec invalid 
                                display message box "Kaynak Islem Basarisiz..."
                          end-write
                              display message box  "Islem Tamamlandi"
                           
                          end-write 
                          perform log-operation-exthrk
                 end-rewrite
                 perform log-operation-exthrk
             else 
              display message box "Daha kucuk parcaya bolun"
             end-if
        end-read.
*
*
 Aft-Procedure.
      
            move 27 to key-status
     
     .
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form2a-Ex-Other.
        continue

     .
*
 form3-Ex-Other.
       evaluate key-status
            when 2
              if transfer = 1 then
              open input konuk
                  move function numval(form-acik(1:8))  to konuk-folio
                  read konuk no lock invalid 
                     continue
                     not invalid

                    if hrk-tip = "R" 
                       delete romhrk invalid 
                         display message box  "Silinemedi" 
                         not invalid
                         

                         move konuk-folio to romhrk-folio
                         move romhrk-rec to exthrk-rec
                         if konuk-fol-kodu ="E" then 
                                write exthrk-rec 
                                  invalid display message box "YAzilamadi"
                                  end-write
                                  perform log-operation-exthrk
                             else
                                 write romhrk-rec 
                                     invalid display message box "YAzilamadi"
                                 end-write
                                 perform log-operation-romhrk
                         end-if
                        end-delete
                    else
                        delete exthrk invalid 
                         display message box  "Silinemedi" 
                         not invalid
                         move konuk-folio to exthrk-folio 
                         move exthrk-rec to romhrk-rec
                         if konuk-fol-kodu ="E" then 
                                write exthrk-rec 
                                  invalid display message box "YAzilamadi"
                                  end-write
                                  perform log-operation-exthrk
                             else
                                 write romhrk-rec 
                                     invalid display message box "YAzilamadi"
                                 end-write
                                 perform log-operation-romhrk
                         end-if
                        end-delete


                    end-if

                  end-read
                  close konuk
                else
                    move form-acik to not1
                  rewrite not-rec
                    invalid
                 write not-rec
                end-rewrite
                end-if
               set exit-pushed to true

       end-evaluate
     .

     .
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 win-tab-Ev-Cmd-Tabchanged.
      

       if event-data-1 > 1 and < 10 then
        move 1 to vis-ref

        move ref-profil-sirket(event-data-1 - 1) to ps1
        move ref-profil-no(event-data-1 - 1 ) to mis-no
        move ref-ode(event-data-1 - 1) to pes
        else
        move 0 to vis-ref

      end-if
        display acc-mis-no acc-ps1 ode-acc
        perform musteri-oku
        compute pencere =  event-data-1 - 1
      
        perform grid-yaz
 
     .











         .
*
 acc-mis-no-Ev-Cmd-Goto.
        initialize mis-cagir
        move mis-no to mis-no-cagir2
        move ps1 to mis-sirket-cagir
        move 2    to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call
      .
*
 Form1-Pb-3-Ev-Cmd-Clicked.
      
     .
*
 Form1-Gd-1-Ev-Msg-Begin-Entry.
     
     .
*
 screen2-Ex-Other.
           evaluate key-status
            when 2
              move 1 to gon-sec
              set exit-pushed to true
             
              when other
              move 0 to gon-sec
           end-evaluate
     .
* 
 musteri-oku.
     open input musteri
     initialize musteri-rec
     move ps1    to musteri-sirket
     move mis-no to musteri-no
     read musteri no lock invalid initialize musteri-text
          not invalid
             string musteri-adi    delimited by "  "
                     " " delimited by size
                    musteri-soyadi delimited by "  "
                   into musteri-text

     end-read.
     display musteri-acc.
     close musteri.
*
 ode-acc-Ev-Cmd-Clicked.
    
      if secili-tab > 1 then
            open i-o folref
             move konuk-folio to folref-folio
             compute folref-ref =  secili-tab - 1
             move mis-no to folref-profil-no
             move ps1 to folref-profil-sirket
             if pes = 1 then 
                 move 0 to  folref-ode
                 else
                 move 1 to folref-ode
             end-if
             move  folref-ode  to
                    ref-ode (secili-tab - 1 )
             write folref-rec invalid rewrite folref-rec end-write
             close folref
             perform pen-kont
           end-if
     .
 Pen-Kont.
    
    initialize pencere-toplamlar romhrk-rec exthrk-rec
       open input konuk romhrk exthrk
      read konuk no lock invalid stop " " 
      end-read
     
    move konuk-folio to romhrk-folio exthrk-folio
     if konuk-fol-kodu = "R"  then
             start romhrk key > romhrk-anah invalid
                continue
                not invalid
                perform until fs-romhrk = "10"
                read romhrk next no lock 
                   end move "10" to fs-romhrk
                   not end
                     if romhrk-folio not = konuk-folio 
                        move "10" to fs-romhrk
                        else
                        move romhrk-rec to hrkgir-rec
                        perform topla
                    end-if
                end-read
                end-perform
             end-start

          else
            start exthrk key > exthrk-anah invalid
                continue
                not invalid
                  perform until fs-exthrk = "10"
                read exthrk next no lock 
                   end move "10" to fs-exthrk
                   not end
                     if exthrk-folio not = konuk-folio 
                        move "10" to fs-exthrk
                        else
                        move exthrk-rec to hrkgir-rec
                        perform topla
                    end-if
                end-read
                end-perform
             end-start

      end-if
     perform pen-yukle
     perform dep-yukle
      close konuk  romhrk exthrk
      if      p-bakiye(1) = 0  and
              p-bakiye(2) = 0    and
              p-bakiye(3) = 0   and
              p-bakiye(4) = 0   and
              p-bakiye(5) = 0   and
              p-bakiye(6) = 0      and
              p-bakiye(7) = 0    and
              p-bakiye(8) = 0   and
              p-bakiye(9) = 0  
         
                 modify button-kaydet  enabled = true
                else
               modify button-kaydet  enabled = false
                   SET GECMEZ TO TRUE
          end-if
          if   konuk-durumu = "H"
               modify button-kaydet  enabled = false
                              visible= False
                   SET GECMEZ TO TRUE
                if konuk-acik-hesap = 1 then 
                      modify button-acik  enabled = false
                                 title = "Hesap Kapat"
                                  visible = true
                     if      p-bakiye(1) = 0  and
                              p-bakiye(2) = 0    and
                              p-bakiye(3) = 0   and
                              p-bakiye(4) = 0   and
                              p-bakiye(5) = 0   and
                              p-bakiye(6) = 0      and
                              p-bakiye(7) = 0    and
                              p-bakiye(8) = 0   and
                              p-bakiye(9) = 0  
                            modify button-acik  enabled = true
                                               
                    end-if
                 else
                   if konuk-kapat-tarih = tarih-tasi or konuk-git-tar = tarih-tasi
                       modify button-acik  enabled = true
                                 title = "Hesap Ac"
                                  visible = true
                   
                   
                   else
                   modify button-acik  enabled = false
                                 title = "Hesap Kapat"
                                  visible = False

                   end-if 
                end-if
               else
                 modify button-acik  enabled = true
                                      title = "Acik Hesap COUT"  
          end-if                      
          
      .
topla.
     move 1 to p-var(hrkgir-ref)
    if hrkgir-ba= "B"
      add hrkgir-tl-tutar to p-bakiye(hrkgir-ref)
      else
      subtract hrkgir-tl-tutar from p-bakiye(hrkgir-ref)
    end-if
    if hrkgir-fatura-no > 0 then
      continue
      else
 
      move 1 to p-fatura(hrkgir-ref)
    end-if
    


      .
*
 pen-yukle.
     
      open input folref musteri
      modify pen-gd, reset-grid  = 1
                         mass-update = 1.
      initialize pen-record
      move "Pen "         to prec1
      move "Odeme "       to prec2
      move "Cari Adi "    to prec3
      move "[TL] Tutar "  to prec4
      move "Fat "         to prec5
      
      modify pen-gd, record-to-add (pen-record) 
       move 1 to kayit-sayi   
     
      perform varying ii from 1 by 1 until ii > 10
              if p-var(ii) = 1 then
               add 1 to kayit-sayi
              
               initialize pen-record   folref-rec
                 move konuk-folio to folref-folio
                 move ii to folref-ref
                 read folref no lock invalid
                     continue
                 end-read



                  move ii to zz p-no(ii)
                  
               move zz to prec1
                 if folref-ode = 1 then
                   move "C/L" to prec2
                   else
                   move "SELF" to prec2 
                 end-if
                  
                 move folref-profil-anah to m-profil
                   read musteri  no lock invalid continue
                    not invalid
                      string musteri-adi delimited by "  "
                           " " delimited by size
                           musteri-soyadi delimited by "  "
                           into prec3

                   end-read
                   move folref-ode to p-odeme(ii)
 

                 move p-bakiye(ii) to z-bakiye
                 move z-bakiye to prec4
                 if p-fatura(ii) = 1 then
                   move "FAT" to prec5
                   else
                   move "   " to prec5
                 end-if
                 modify pen-gd, record-to-add (pen-record) 
                 modify pen-gd(kayit-sayi,1) hidden-data = pen-top(ii)
             end-if
       end-perform
          modify pen-gd, 
                         mass-update = 0.
           close folref musteri.
                   
*
 pen-gd-Ev-Other.
        evaluate event-type 
         when msg-begin-entry
                inquire pen-gd x in px
                     y in py
       inquire pen-gd(py,1) hidden-data in pen-top(10)
       if p-no(10) > 0 and < 10 then
         evaluate px
           when 5 
              if p-bakiye(10) = 0 then
                 
                     call "/asya/ytl/obj/otel/folfat1.asy" 
                         using  konuk-folio, konuk-odano, p-no(10)
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/folfat1.asy"
                    end-call
                     perform Pen-Kont
                 else
                 display message box "BALANSLI FATURA KESILEMEZ" title "BALANSLI FATURA"
               end-if

           when other
            if  p-bakiye(10) > 0 then 
            initialize dokcagir-tasi
              set dokcagir-tasi-call-cekgir3   to true
              move konuk-folio                 to dokcagir-konuk-folio
              move p-no(10) to dokcagir-pencere
              if p-odeme(10)  = 1 then 
                 move onkpara-city-ledger   to dokcagir-dep-kodu
                 else
                  move onkpara-outlet-cash  to dokcagir-dep-kodu
              end-if
              move p-bakiye(10)                 to dokcagir-cout-tutar
              perform dokcagir-call

              perform Form1-Aft-Initdata
              perform tum-tab-ac
             end-if
              
         end-evaluate
       end-if
             move event-action-fail to event-action,
    end-evaluate.
     .
*
 button-kaydet-Ex-Cmd-Clicked.
                     
              initialize dokcagir-tasi
              set dokcagir-tasi-call-cout2   to true
              if bakiye = 0
                
                 move 2                          to dokcagir-toplu
              end-if
              move konuk-odano                  to dokcagir-konuk-odano
              move konuk-folio                to dokcagir-konuk-folio
              perform dokcagir-call
                    call "w$keybuf" using 3 end-call
                  open input konuk
      initialize konuk-rec
      move rapor-folio      to konuk-folio
      read konuk no lock invalid
          continue
      end-read.
      close konuk.
      
     


             perform Form1-Aft-Initdata
              perform tum-tab-ac
     
     .
*
*
 button-acik-Ev-Cmd-Clicked.
       open input konuk
              initialize konuk-rec
              move rapor-folio      to konuk-folio
              read konuk no lock invalid
                  continue
              end-read.
              close konuk
       evaluate true
       
          when konuk-durumu = "I"
                 initialize dokcagir-tasi
              set dokcagir-tasi-call-cout2   to true
              if bakiye = 0
               move 2                          to dokcagir-toplu
              end-if
              move konuk-odano                  to dokcagir-konuk-odano
              move konuk-folio                to dokcagir-konuk-folio
              perform dokcagir-call
                   call "w$keybuf" using 3 end-call
                  open input konuk
              initialize konuk-rec
              move rapor-folio      to konuk-folio
              read konuk no lock invalid
                  continue
              end-read
              close konuk
              perform Form1-Aft-Initdata
              perform tum-tab-ac
         when  konuk-durumu = "H"   and konuk-acik-hesap = 1
           perform pen-kont
           if      p-bakiye(1) = 0  and
              p-bakiye(2) = 0    and
              p-bakiye(3) = 0   and
              p-bakiye(4) = 0   and
              p-bakiye(5) = 0   and
              p-bakiye(6) = 0      and
              p-bakiye(7) = 0    and
              p-bakiye(8) = 0   and
              p-bakiye(9) = 0  

              display message box "Acik Hesap Kapatilacak " new-line new-line 
                                   "Emin misiniz? ................." new-line  icon 2
                                   title "HESAP KAPATILIYOR" default 1 type 2
                                   giving return-code
                      if return-code = 1 then 
                           perform pen-kont
                                   if      p-bakiye(1) = 0  and
                                      p-bakiye(2) = 0    and
                                      p-bakiye(3) = 0   and
                                      p-bakiye(4) = 0   and
                                      p-bakiye(5) = 0   and
                                      p-bakiye(6) = 0      and
                                      p-bakiye(7) = 0    and
                                      p-bakiye(8) = 0   and
                                      p-bakiye(9) = 0  
                                        open i-o konuk
                                              initialize konuk-rec
                                              move rapor-folio      to konuk-folio
                                              read konuk no lock invalid
                                                  continue
                                                  not invalid 
                                                  move 0 to konuk-acik-hesap
                                                  move k-kodu-tasi to  konuk-kapat-staf
                                                  move tarih-tasi to konuk-kapat-tarih 

                                                  accept konuk-kapat-zaman from time
                                                  rewrite konuk-rec  invalid stop " " end-rewrite                                              
                                                  perform log-operation-konuk
                                              end-read
                                              close konuk
                                             perform Form1-Aft-Initdata
                                            perform tum-tab-ac



                                   else
                                display message box "Hesap Girildi " new-line 
                                   "Hesap Kapatilamadi" icon 3 
                          end-if
                     end-if

          end-if
            when  konuk-durumu = "H"   and konuk-acik-hesap not = 1  and ( konuk-kapat-tarih = tarih-tasi
             or konuk-git-tar = tarih-tasi )
                
                    display message box "Kapali Hesap Tekrar Acilacak " new-line new-line 
                                   "Emin misiniz? ................." new-line  icon 2
                                   title "HESAP ACILIYOR" default 1 type 2
                                   giving return-code
                      if return-code = 1 then 
                         
                                        open i-o konuk
                                              initialize konuk-rec
                                              move rapor-folio      to konuk-folio
                                              read konuk no lock invalid
                                                  continue
                                                  not invalid 
                                                  move 1 to konuk-acik-hesap
                                                 

                                                
                                                  rewrite konuk-rec  invalid stop " " end-rewrite
                                                  perform log-operation-konuk
                                              end-read
                                              close konuk
                                             perform Form1-Aft-Initdata
                                            perform tum-tab-ac
                    end-if
            when other 
              display message box "ISLEM YOOOOOOOOOOOOK"
       end-evaluate

     .

*
 Form1-Pb-2-Ex-Cmd-Clicked.
       open i-o romhrk exthrk yromhrk hrk2
       OPEN INPUT route
       initialize route-rec
       move "R" to route-tip
       move konuk-rez-no to route-no
       start route key > route-data invalid
            continue
            not invalid
            perform until fs-route = "10"
               read route next no lock end move "10" to fs-route
                 not end
                  if route-no = konuk-rez-no and route-tip = "R" then
*                         perform route-bulundu
                           continue
                      else
                      move "10" to fs-route
                  end-if
                end-read
            end-perform 
       end-start
         close romhrk exthrk yromhrk  hrk2
              .


*
 folio-rapor.
              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya
     initialize rapor-son-satir
     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Folio Detay Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Folio Detay Raporu" to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"                  to det-dokumer-20(10:1)
     move "Oda No:"            to det-filler(1:8)
     move konuk-odano of konuk to det-filler(8:4)
     move "Folio:"             to det-filler(13:6)
     move konuk-folio of konuk to det-filler(19:8)
     move "Adi:"               to det-filler(28:4)
     move konuk-adi   of konuk to det-filler(33:10)
     move "Soyadi:"            to det-filler(44:7)
     move konuk-soyadi of konuk to det-filler(52:10)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                     to det-dokumer-20(1:1)
     move "1"                     to det-dokumer-20(10:1)
     move "C/in Tarihi:"          to det-filler(1:12)
     move konuk-gel-gun of konuk  to det-filler(14:2)
     move "/"                     to det-filler(16:1)
     move konuk-gel-ay of konuk   to det-filler(18:2)
     move "/"                     to det-filler(20:1)
     move konuk-gel-yil of konuk  to det-filler(22:4)

     move "C/Out Tarihi:"          to det-filler(28:12)
     move konuk-git-gun of konuk  to det-filler(41:2)
     move "/"                     to det-filler(43:1)
     move konuk-git-ay of konuk   to det-filler(45:2)
     move "/"                     to det-filler(47:1)
     move konuk-git-yil of konuk  to det-filler(48:4)

     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LRLLRRRRRRRRRRRRLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2)     
     move "Tarih"                       to det-1
     move "D.Kodu"                      to det-2
     move "Departman Adi       "        to det-3
     move "Aciklama"                    to det-4
     move "Kur"                         to det-5
     move "Borc-D"                      to det-6
     move "Borc-TL"                     to det-7
     move "Alacak-D"                         to det-8
     move "Alacak-TL"                        to det-9
     move "Bakiye-D"                  to det-10
     move "Bakiye-TL"                     to det-11
     move "Zaman"                      to det-12
     move "Islem No"                          to det-13
     move "T"                           to det-14
     move "Cek No"                      to det-15
     move "Kart No"                      to det-16
     move "Staff"                        to det-17
     move "Pos Kod"                      to det-18
     move "P"                            to det-19
     move "Kaynak"                       to det-20
     move "Fat No"                       to det-21

     move "|" to fil-1 fil-2 fil-3 fil-4  fil-5  fil-6
                 fil-7 fil-8  fil-9 fil-10 fil-11 
                 fil-12 fil-13  fil-14 fil-15 fil-16 
                 fil-17 fil-18 fil-19 fil-20 fil-21 
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5  det-6
                 det-7 det-8  det-9 det-10 det-11 
                 det-12 det-13  det-15 det-14 det-16     
                 det-17 det-18 det-19 det-20 det-21 

     write dokumer-rec from detay
**************************
      initialize i
      inquire form1-gd-1,last-row in rapor-son-satir
      perform varying i 
                 from 2 
                 by 1
                 until i > rapor-son-satir
                    inquire form1-gd-1(i),record-data in form1-gd-1-record

                    initialize dokumer-rec detay toplam-satiri
                    move gd-1-col-1       to det-1
                    move gd-1-col-2       to det-2
                    move gd-1-col-3       to det-3
                    move gd-1-col-4       to det-4
                    move gd-1-col-99      to det-5
                    move gd-1-col-5       to det-6
                    move gd-1-col-105     to det-7
                    move gd-1-col-6       to det-8
                    move gd-1-col-106     to det-9
                    move gd-1-col-7       to det-10
                    move gd-1-col-107     to det-11
                    move gd-1-col-8       to det-12

                    move gd-1-col-9       to det-13
                    move gd-1-col-14      to det-14
                    move gd-1-col-10      to det-15
                    move gd-1-col-11      to det-16
                    move gd-1-col-12      to det-17
                    move gd-1-col-13      to det-18
                    move gd-1-col-19      to det-19
                    move gd-1-col-20      to det-20
                    move gd-1-col-21      to det-21
                    
                    write dokumer-rec from detay
                    initialize dokumer-rec detay
                    move "-"            to det-dokumer-20(5:1)
                    move all "-" to det-1 det-2 det-3 det-4 det-5  det-6
                         det-7 det-8  det-9 det-10 det-11 
                         det-12 det-13  det-14 det-15 det-16           
                         det-17 det-18 det-19 det-20 det-21 
                    write dokumer-rec from detay
                    
                    compute toplam-satiri = rapor-son-satir - 6 
                    if i = toplam-satiri
                       initialize dokumer-rec detay
                       move "A"          to det-dokumer-20(3:1)
                       move 481          to det-renk1
                       move "1"          to det-dokumer-20(10:1)
                       write dokumer-rec from detay                       
                    end-if
                   
      end-perform

              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              delete file dokumer
    .
*
 Form1-Gd-1a-Ev-Msg-Begin-Entry.
     set event-action to event-action-fail
      move konuk-rez-no to rez-no
              open input rez 
              read rez no lock invalid 
                 display message box "Rezervasyon Okunamadi"

              end-read 
               close rez
              move rez-rec to xrez-rec
               call "/asya/ytl/obj/otel/hesayr.asy" 
                        using  xrez-no   
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/hesayr.asy"
         end-call



     .
     
     .
*
 screen1-Ex-Other.
     if key-status = 27 
        move 0 to konu2-folio
     end-if
     if key-status = 2 
           move 1 to kay-deg
           set exit-pushed to true
     end-if
     
     .
*
 dep-gd-Ev-Other.
      evaluate event-type 
          when msg-heading-clicked
             call "/asya/ytl/obj/otel/depozit.asy" 
                         using  konuk-folio
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/depozit.asy"
                    end-call  
                   perform dep-yukle

          when msg-begin-entry
                inquire dep-gd x in px
                     y in py
                     if py < 2 then 
                     exit paragraph 
                      move event-action-fail to event-action,
                     end-if
                     initialize depozit-rec
                    inquire dep-gd(py,1) hidden-data in depozit-anahtar
                    
                    call "/asya/ytl/obj/otel/depozit.asy" 
                         using  konuk-folio, depozit-anahtar
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/depozit.asy"
                    end-call  
                       move event-action-fail to event-action,
                    perform dep-yukle
         
  
            
    end-evaluate.
     .
*
 dep-yukle.
     
      open input depozit  depkod doviz
      modify dep-gd, reset-grid  = 1
                         mass-update = 1.
      initialize DEP-record
      move "Depozit "      to gdep1
      move "Tarih "        to gdep2
      move "Tutar "        to gdep3
      move "Doviz "        to gdep4
  
      
      modify dep-gd, record-to-add (dep-record) 
         move 1 to kayit-sayi   

       initialize depozit-rec
           move konuk-folio to  DEPOZIT-FOLIO  
        start depozit key >  DEPOZIT-ANAHTAR invalid continue
            not invalid
               perform until fs-depozit = "10" 
                  read depozit next no lock end move "10" to fs-depozit
                      not end
                        if depozit-folio not = konuk-folio 
                          move "10" to fs-depozit 
                          else
                            if depozit-durumu not = "S" 
                               initialize dep-record
                                move depozit-depkod to depkod-anah 
                                  read depkod no lock invalid
                                    move depkod-kodu to depkod-adi
                                    move "************" to depkod-adi(5:)

                                 end-read
                                move DEPOZIT-DOVIZ to doviz-kodu
                                read doviz no lock invalid
                                   continue
                                end-read
                                  initialize DEP-record
                              move DEPKOD-ADI      to gdep1
                              move depozit-yil   to eyil
                                 move depozit-ay   to eay
                                 move depozit-gun   to egun
                    
                              move etarih        to gdep2
                              move depozit-tutar to e-tutar
                              move e-tutar    to   gdep3
                              move d-kisa-adi        to gdep4
                          
      
                       modify dep-gd, record-to-add (dep-record) 
                      add 1 to kayit-sayi   
                          modify dep-gd(kayit-sayi,1) hidden-data = depozit-anahtar 

                            end-if
                         end-if

                    end-read
                end-perform
       end-start
          modify dep-gd, 
                         mass-update = 0.
           close depozit depkod doviz.
                   
*
 Form4-Aft-Initdata.

      open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis

              
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid
             continue
     end-read
     close genel 
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya
     initialize rapor-son-satir
     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Folio Detay Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Folio Detay Raporu" to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     move "1"                  to det-dokumer-20(10:1)
     move "Oda No:"            to det-filler(1:8)
     move konuk-odano of konuk to det-filler(8:4)
     move "Folio:"             to det-filler(13:6)
     move konuk-folio of konuk to det-filler(19:8)
     move "Adi:"               to det-filler(28:4)
     move konuk-adi   of konuk to det-filler(33:10)
     move "Soyadi:"            to det-filler(44:7)
     move konuk-soyadi of konuk to det-filler(52:10)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                     to det-dokumer-20(1:1)
     move "1"                     to det-dokumer-20(10:1)
     move "C/in Tarihi:"          to det-filler(1:12)
     move konuk-gel-gun of konuk  to det-filler(14:2)
     move "/"                     to det-filler(16:1)
     move konuk-gel-ay of konuk   to det-filler(18:2)
     move "/"                     to det-filler(20:1)
     move konuk-gel-yil of konuk  to det-filler(22:4)

     move "C/Out Tarihi:"          to det-filler(28:12)
     move konuk-git-gun of konuk  to det-filler(41:2)
     move "/"                     to det-filler(43:1)
     move konuk-git-ay of konuk   to det-filler(45:2)
     move "/"                     to det-filler(47:1)
     move konuk-git-yil of konuk  to det-filler(48:4)

     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LRLLRRRRRRRRRRRRLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"                          to det-dokumer-20(1:2)     
     move "Tarih"                       to det-1
     move "Kod"                         to det-2
     move "Oda"                         to det-8
     move "Malzeme Adi"                 to det-3
     move "Adet"                        to det-5
     move "Tutar [TL]"                  to det-6
     move "Tutar [DV]"                  to det-7
     move "Departman"                   to det-4
     move "|" to fil-1 fil-2 fil-3 fil-4  fil-5 fil-6 fil-8
                 fil-7 

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5  det-6 det-8
                 det-7  
     write dokumer-rec from detay
**************************



     inspect folio-detay-adi replacing all space by low-values 
     string folio-detay-adi 
            konuk-adi    delimited by low-values 
            " "          delimited by low-values 
            konuk-soyadi delimited by low-values 
     into folio-detay-adi                            



     move cost-sirketi to costhrk-dosya-adres p-dosya-alan posdep-dosya-adres
     move cost-sirketi to satkod-dosya-adres
     initialize i 
     open input yromhrk depkod
     initialize yromhrk-rec cost-top-tl cost-top-dv ydk-p-fis-no
     move 1                to kayit-sayi
     move txt-donem-bas-tar to yromhrk-tarih
     start yromhrk key not < yROMHRK-ANAH2 invalid 
           continue 
     not invalid
     perform with test after until fs-yromhrk = "10"
     read yromhrk next no lock end move "10"  to fs-yromhrk
     not at end 
     add 1 to i 
*     if i = 300 then display message box "ciktim" exit perform   end-if
*              if yromhrk-folio not = konuk-folio
*                 exit perform 
*              end-if

              if  yromhrk-tarih > txt-donem-bit-tar   then
                 exit perform
              end-if

              initialize depkod-rec
              move yromhrk-depkod to depkod-anah
              read depkod no lock invalid 
                   move all "*"  to depkod-adi
              not invalid 
                   if depkod-tipi not = 3
                       exit perform cycle 
                   end-if 
              end-read
              if yromhrk-cekno = ydk-p-fis-no
                  exit perform cycle 
              end-if
              if yromhrk-islem-tipi not = "P"
                  exit perform cycle
              end-if

              move yromhrk-gun    to p-dosya-gun
              move yromhrk-ay     to p-dosya-ay
              move yromhrk-yil    to p-dosya-yil

              perform folio-pos-detay

             
     end-read 
     end-perform
     end-start


              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              delete file dokumer 



     close yromhrk depkod
     initialize form4-gd-1-record
     move "Toplam->"             to gd-4-col-1
     move cost-top-tl            to etutar
     move etutar                 to gd-4-col-5
     move cost-top-dv            to etutar
     move etutar                 to gd-4-col-6
     .
   
*
 folio-pos-detay.
     open input p satkod posdep konuk
     initialize p-rec 
     start p key >= p-kime invalid 
          continue 
     not invalid 
     perform with test after until fs-p = "10"
     read p next no lock end move "10"  to fs-p
     not at end
     initialize detay
          if p-musteri not = "M"
                 exit perform cycle
          end-if 
          if txt-satis-kodu not = zeroes and txt-satis-kodu not = p-rec-kodu then
             exit perform cycle
          end-if
          if p-happy not = "D" then
             exit perform cycle
          end-if
            move p-dosya-gun              to egun
            move p-dosya-ay               to eay
            move p-dosya-yil              to eyil
            move etarih                   to det-1
  
            if p-fis-no not = yROMHRK-CEKNO
                exit perform cycle 
            end-if 
            move p-fis-no                 to ydk-p-fis-no
            initialize posdep-rec
            move p-depkod                 to posdep-anah
            read posdep no lock invalid
                 move all "*"             to posdep-adi
            end-read
            add 1                         to kayit-sayi
            initialize satkod-rec
            move p-rec-kodu               to satkod-kodu det-2
            move posdep-recete-ana-dep    to satkod-ana-dep
            move posdep-recete-alt-dep    to satkod-alt-dep
            read satkod no lock invalid
                move all "*"              to satkod-adi
            end-read
            move satkod-adi               to det-3
            move p-adet                   to emiktar
            move emiktar                  to det-5
            
            move p-tutar-tl               to etutar
            move etutar                   to det-6

            move p-tutar-dv               to etutar
            move etutar                   to det-7

            move posdep-adi               to det-4
            initialize konuk-rec
            move p-folio             to KONUK-FOLIO
            read konuk  no lock invalid
                    continue
            not invalid
             move konuk-odano             to det-8
            end-read
           
            if txt-oda-no not = spaces  and txt-oda-no not = konuk-odano then
                exit perform cycle
            end-if
            add p-tutar-tl to    cost-top-tl
            add p-tutar-dv to    cost-top-dv

               write dokumer-rec from detay
               initialize dokumer-rec detay
               move "-"            to det-dokumer-20(5:1)
               move all "-" to det-1 det-2 det-3 det-4 det-5  det-6
                      det-7 det-8
               write dokumer-rec from detay              
     end-read
     end-perform
     end-start
     close p satkod posdep konuk.


*
 Form4-Ex-Other.
     evaluate key-status
     when 2
        perform  Form4-Aft-Initdata
*        perform folio-detay-rapor
     end-evaluate.
*
 fat-sil-gonder.
            inquire form1-gd-1(satir,sutun),
                      cell-data in link-fat-no
                      if link-fat-no > 0 then
                       call "/asya/ytl/obj/otel/fatiptal.asy" 
                    using  link-fat-no fat-tarih
                    on exception 
                     perform callerr-proc
                     exit paragraph
                    not on exception 
                     cancel "/asya/ytl/obj/otel/fatiptal.asy"
                  end-call
                end-if.
*
 hatali-route-al.
      display message box "Route Edilemeyen Hareketler Ana Folio'ya Tasinacaktir."new-line
                          "Eminmisiniz?"
                      title "Uyari"
                      icon 1
                      type 2
                      default 2
                      returning return-code 
      if return-code = 2
         exit paragraph 
      end-if 
      open input konuk 
      open i-o romhrk exthrk
      read konuk no lock invalid 
           display message box "Folio Bulunamadi.."
                           title "Uyari"
                           icon 1
           close konuk
           exit paragraph 
      end-read 
           evaluate konuk-fol-kodu 
           when "E"
               perform romhrk-duzelt
           when "R"
               perform exthrk-duzelt
           end-evaluate
      close konuk romhrk exthrk
      display message box "Hareketler Tasinmistir."new-line
                          "Lutfen Kontrol Ediniz."
                      title "Uyari"
                      icon 1
     .
*
 romhrk-duzelt.
     initialize romhrk-rec exthrk-rec 
     move konuk-folio        to romhrk-folio
     start romhrk key not < romhrk-anah1 invalid 
           continue 
     not invalid 
     perform with test after until fs-romhrk = "10"
     read romhrk next no lock end move "10" to fs-romhrk
     not at end 
            if romhrk-folio <> konuk-folio
                 exit perform 
            end-if
            move romhrk-rec to exthrk-rec 
            write exthrk-rec invalid 
                 continue 
            not invalid 
                delete romhrk invalid 
                     delete exthrk invalid 
                         stop " "
                     end-delete 
                     perform log-operation-exthrk
                end-delete               
                perform log-operation-romhrk
            end-write
            perform log-operation-exthrk
     end-read 
     end-perform
     end-start
     .
*
 exthrk-duzelt.
     initialize romhrk-rec exthrk-rec 
     move konuk-folio        to exthrk-folio
     start exthrk key not < exthrk-anah1 invalid 
           continue 
     not invalid 
     perform with test after until fs-exthrk = "10"
     read exthrk next no lock end move "10" to fs-exthrk
     not at end 
            if exthrk-folio <> konuk-folio
                 exit perform 
            end-if
            move exthrk-rec to romhrk-rec 
            write romhrk-rec invalid 
                 continue 
            not invalid 
                delete exthrk invalid 
                     delete romhrk invalid 
                         stop " "
                     end-delete 
                     perform log-operation-romhrk
                end-delete               
                perform log-operation-exthrk
            end-write
            perform log-operation-romhrk
     end-read 
     end-perform
     end-start
     .
*
 Form4-Bef-Create.
      perform adresleri-tasi.
      move tarih-tasi to txt-donem-bas-tar txt-donem-bit-tar


     .
*
 accept-gir-yil-Aft-Procedure.
      open input takvim
      move txt-donem-bas-tar to takvim-anah
      read takvim no lock invalid
              move 4    to accept-control
              move 1004 to control-id
              continue
      end-read

      close takvim
     .
*
 accept-cik-yil-Aft-Procedure2.
      open input takvim
      move txt-donem-bas-tar to takvim-anah
      read takvim no lock invalid
              move 4    to accept-control
              move 1009 to control-id 
              continue
      end-read

      close takvim
     .
*
 Form4-Aft-Procedure.

     .

 
