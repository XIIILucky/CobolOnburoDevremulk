* butcegir.evt
* butcegir.evt is generated from D:\asya\acugt.ytl\otel\butcegir.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM gd-2-Ev-Msg-Begin-Entry
     END-EVALUATE
     .

 Form1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Close
           PERFORM Form1-Ex-Cmd-Close
        END-EVALUATE
     ELSE
        PERFORM Form1-Ex-Other
     END-IF
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .

 Form1-Gd-1-Exception-Proc.
     PERFORM Form1-Gd-1-Ex-Other
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
       perform adresleri-tasi
       move tarih-tasi      to giris-tarih
          open input konum 
            start konum key > konum-anahtar invalid continue
              not invalid
               perform until fs-konum ="10"
                   read konum next no lock
                     end move "10" to fs-konum
                     not end 
                        if konum-ust1 < 1 or konum-ust1 > 40 then 
                           move konum-anahtar to konum-ust1
                        end-if
                          if konum-ust2 < 1 or konum-ust2 > 40 then 
                           move konum-anahtar to konum-ust2
                        end-if
                          move  konum-ust1  to ust1(konum-anahtar)
                          
                          move  konum-ust2  to ust2(konum-anahtar)
                  end-read
               end-perform
            end-start
             close konum
           perform varying i from 1 by 1 until i > 40 or ust1(i) < 1
                move ust1(i) to sira
                if ust1(sira) not = sira  then 
                   
                   display message box  i ". konum 1. ust konumu hatali"  new-line
                           "Birlesme Yok secenegi dogru calisacaktir "
                   
                   
                   title "HATA" 
                end-if
                move ust2(i) to sira
                if ust2(sira) not = sira  then 
                   
                 display message box  i ". konum 2. ust konumu hatali"  new-line
                  "Birlesme Yok secenegi dogru calisacaktir "
                  title "HATA" 
                end-if
           end-perform 
     
     .
*
 Form1-Aft-Initdata.
      
    open i-o butcegir close butcegir
    modify com-ana1, item-to-add ("P-Pazar",  "T-Acenta", "U-Ulke ", 
    "F-Fiyat Konumu", "O-Oda Konumu", "A-Anlasma " )
     modify com-ana2, item-to-add (" -Detaysiz","P-Pazar",  "T-Acenta", "U-Ulke ", 
    "F-Fiyat Konumu", "O-Oda Konumu", "A-Anlasma ") 
    move "P" to rap-anah1
    move " " to rap-anah2
    display com-ana1 com-ana2
     
     .
*
 Form1-Ex-Other.
    evaluate key-status
    when 2002
         perform butce-sil
         display message box "Silme Islemi Tamamlandi."new-line
                             "Lutfen Kontrol Ediniz.."
                         title "[ Uyari ]"
                         icon 1
             set exit-pushed to true 
    when 1003
         move 1 to vis-99
         display acc-99 Form1-La-1 form1-pb-3
         move 0 to vis-5
         display Form1-Pb-1aa
         move 4 to accept-control
         move 12 to control-id
    when 2001
         perform form-farkli-kaydet
         display message box "Kopyalama Islemi Basariyla Tamamlandi..."
                         title "[ Uyari ]"
                         icon 1
    when 1009
         move 1 to v-but-yeni v-but-ac v-3 
         display form1-pb-1a form1-pb-1 com-ana1 com-ana2  
         
         move 0 to v-2 vis-5
         display acc-2 acc-3 acc-4 lb-butce-adi lb-butce-tarih  Form1-Pb-1aa 
         modify form1-gd-1,reset-grid = 1
         close takas5 takas6 takas7 takas8
         
                  
    when 1001
       perform acu-form2-routine
          call "w$keybuf" using 3 end-call
    when 1002
             display message box "Kaydetmek Istediginizden Eminmisiniz.."
                             title "[ Uyari ]"
                             icon 1
                             type 2
                             default 2
                             returning donus
             if donus = 2
                exit paragraph
             else
                perform form-kaydet
                display message box "Butceniz Basariyla Kaydedildi..."
                                title "[ Uyari ]" 
                                icon 1  
                         move 1 to v-but-yeni v-but-ac v-3 
                         display form1-pb-1a form1-pb-1 com-ana1 com-ana2  
                         
                         move 0 to v-2 vis-6 vis-5
                         display acc-2 acc-3 acc-4 lb-butce-adi lb-butce-tarih  Form1-Pb-1aa Form1-Pb-1aaa
                         modify form1-gd-1,reset-grid = 1
                         close takas5 takas6 takas7 takas8              
             end-if
    when 2
       move 1 to satir
       open input acenta kodlar02 ulke konum
           initialize acc-4-val                                
           move 1 to v-1 v-2 vis-4 vis-5 
           display Form1-Gd-1 lb-butce-tarih Form1-Pb-1aa  Form1-Pb-2 lb-butce-adi acc-2 acc-3 acc-4

           move 0 to v-3 v-but-ac v-but-yeni
           display com-ana1 com-ana2 Form1-Pb-1a Form1-Pb-1
           move 4        to accept-control
           move 43       to control-id
           perform takas-dosya-yaz
           perform baslik-grid-yukle
           perform grid-doldur

       close acenta kodlar02 ulke konum 
    when 27
       if degisti = 1
          display message box "Kaydetmek Istermisiniz..."
                          title "[ Uyari ]"
                          icon 1
                          type 4
                          default 1
                          returning donus
          evaluate donus
          when 2
             set exit-pushed to true
*             close takas5 takas6 takas7 takas8
*             delete file takas5 takas6 takas7 takas8
          when 3
             initialize key-status
             set event-action to event-action-fail
          when 1
             perform form-kaydet
             display message box "Butceniz Basariyla Kaydedildi..."
                             title "[ Uyari ]" 
                             icon 1
                         move 1 to v-but-yeni v-but-ac v-3 
                         display form1-pb-1a form1-pb-1 com-ana1 com-ana2  
                         
                         move 0 to v-2 vis-6 vis-5
                         display acc-2 acc-3 acc-4 lb-butce-adi lb-butce-tarih  Form1-Pb-1aa Form1-Pb-1aaa
                         modify form1-gd-1,reset-grid = 1
                         close takas5 takas6 takas7 takas8
          end-evaluate

       end-if

    end-evaluate
     
     .
*
 baslik-grid-yukle.
     modify form1-gd-1,reset-grid = 1
                       mass-update = 1

     initialize g-rec
     move "Detay"     to gd-1-col-1
     move "Toplam"    to gd-1-col-33
     modify form1-gd-1,record-to-add(g-rec)

     initialize takas8-rec 
     move 1 to satir-sayi
     start takas8 key not < takas8-anah invalid
           continue
     not invalid
     perform with test after until fs-takas8 = "10"
     read takas8 next no lock end move "10" to fs-takas8
     not at end
            add 1 to satir-sayi
            modify form1-gd-1(1,satir-sayi),
                                     cell-data(takas8-gun)
     end-read
     end-perform
     end-start
     modify form1-gd-1,mass-update = 0
     
    .


*
 ih3.
           initialize takas5-rec
              move takas6-ilk-anah to takas5-ilk-anah
                if ( rap-anah1(1:1) = "F" or "O" ) and takas6-ilk-anah not = high-values
                  if birles-tip = 2 then 
                     move function numval(takas6-ilk-anah) to sira
                     move ust1(sira) to  takas5-ilk-anah
                  end-if
                  if birles-tip = 3 then
                     move function numval(takas6-ilk-anah) to sira
                    move ust2(sira) to  takas5-ilk-anah
                  end-if
                end-if

                move takas6-iki-anah to takas5-iki-anah

                if ( rap-anah2(1:1) = "F" or "O" )  and takas6-iki-anah not = high-values
                  if birles-tip = 2 then 
                     move function numval(takas6-iki-anah) to sira
                     move ust1(sira) to  takas5-iki-anah
                  end-if
                  if birles-tip = 3 then 
                     move function numval(takas6-iki-anah) to sira
                     move ust2(sira) to  takas5-iki-anah
                  end-if
                end-if
               read takas5 no lock invalid
                        move satir to takas5-satir
                        add 1 to satir
                   write takas5-rec invalid 
                            stop " "
                         continue 
                   end-write
               end-read.
*
 ih2.
      
           evaluate  rap-anah2(1:1)

                when " " 
                    move "DETAYSIZ" to takas6-iki-anah
                                        perform ih3
                 when "A"    
                    initialize kodlar02-rec
                      move "D" to kodlar02-tipi
                     start kodlar02 key > kodlar02-anah invalid continue
                        not invalid
                          perform until fs-kodlar02 = "10"
                              read kodlar02 next no lock 
                                 end move "10" to fs-kodlar02
                                 not end
                                     if kodlar02-tipi  not = "D" 
                                        move "10" to fs-kodlar02
                                     else
                                        move kodlar02-kodu to takas6-iki-anah
                                        perform ih3
                                     end-if
                             end-read
                          end-perform 
                     end-start
                      

                when "P"
                      initialize kodlar02-rec
                      move "E" to kodlar02-tipi
                     start kodlar02 key > kodlar02-anah invalid continue
                        not invalid
                          perform until fs-kodlar02 = "10"
                              read kodlar02 next no lock 
                                 end move "10" to fs-kodlar02
                                 not end
                                     if kodlar02-tipi  not = "E" 
                                          move "10" to fs-kodlar02
                                     else
                                        move kodlar02-kodu to takas6-iki-anah
                                        perform ih3
                                     end-if
                             end-read
                          end-perform 
                     end-start
                      
                     
                 
                 when "U"
                  initialize ulke-rec
                    
                     start ulke key > ulke-anah invalid continue
                        not invalid
                          perform until fs-ulke = "10"
                              read ulke next no lock 
                                 end move "10" to fs-ulke
                                 not end
                                    
                                        move ulke-anah to takas6-iki-anah
                                        perform ih3
                                    
                             end-read
                          end-perform 
                     end-start
                    
                      
            
                
                when "F" when "O"
                      initialize konum-rec
                    
                     start konum key > konum-anahtar invalid continue
                        not invalid
                          perform until fs-konum = "10"
                              read konum next no lock 
                                 end move "10" to fs-konum
                                 not end
                                    if konum-adi not = spaces
                                        move konum-anahtar to takas6-iki-anah
                                        perform ih3
                                     end-if
                             end-read
                          end-perform 
                     end-start
                     
                when "T"
                    initialize acenta-rec
                    
                     start acenta key > acenta-anahtar invalid continue
                        not invalid
                          perform until fs-acenta = "10"
                              read acenta next no lock 
                                 end move "10" to fs-acenta
                                 not end
                                    if acenta-adi not = spaces
                                        move acenta-kodu to takas6-iki-anah
                                        perform ih3
                                     end-if
                             end-read
                          end-perform 
                     end-start

           end-evaluate
           move high-values to takas6-iki-anah
           perform ih3



         .
*
 ihtimal-yukle.
        
             initialize takas6-rec
           evaluate  rap-anah1(1:1)
                 when "A"    
                    initialize kodlar02-rec
                      move "D" to kodlar02-tipi
                     start kodlar02 key > kodlar02-anah invalid continue
                        not invalid
                          perform until fs-kodlar02 = "10"
                              read kodlar02 next no lock 
                                 end move "10" to fs-kodlar02
                                 not end
                                     if kodlar02-tipi  not = "D" 
                                       move "10" to fs-kodlar02
                                     else
                                        move kodlar02-kodu to takas6-ilk-anah
                                        perform ih2
                                     end-if
                             end-read
                          end-perform 
                     end-start
                      

                when "P"
                      initialize kodlar02-rec
                      move "E" to kodlar02-tipi
                     start kodlar02 key > kodlar02-anah invalid continue
                        not invalid
                          perform until fs-kodlar02 = "10"
                              read kodlar02 next no lock 
                                 end move "10" to fs-kodlar02
                                 not end
                                     if kodlar02-tipi  not = "E" 
                                          move "10" to fs-kodlar02
                                     else
                                        move kodlar02-kodu to takas6-ilk-anah
                                        perform ih2
                                     end-if
                             end-read
                          end-perform 
                     end-start
                      
                     
                 
                 when "U"
                  initialize ulke-rec
                    
                     start ulke key > ulke-anah invalid continue
                        not invalid
                          perform until fs-ulke = "10"
                              read ulke next no lock 
                                 end move "10" to fs-ulke
                                 not end
                                    
                                        move ulke-anah to takas6-ilk-anah
                                        perform ih2
                                    
                             end-read
                          end-perform 
                     end-start
                   
                      
            
                
                when "F" when "O"
                      initialize konum-rec
                    
                     start konum key > konum-anahtar invalid continue
                        not invalid
                          perform until fs-konum = "10"
                              read konum next no lock 
                                 end move "10" to fs-konum
                                 not end
                                    if konum-adi not = spaces
                                        move konum-anahtar to takas6-ilk-anah
                                        perform ih2
                                     end-if
                             end-read
                          end-perform 
                     end-start
                     
                when "T"
                    initialize acenta-rec
                    
                     start acenta key > acenta-anahtar invalid continue
                        not invalid
                          perform until fs-acenta = "10"
                              read acenta next no lock 
                                 end move "10" to fs-konum
                                 not end
                                    if acenta-adi not = spaces
                                        move acenta-anahtar to takas6-ilk-anah
                                        perform ih2
                                     end-if
                             end-read
                          end-perform 
                     end-start
         end-evaluate 
         move high-values to takas6-ilk-anah
         perform ih2.
*
 takas-dosya-yaz.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid 
         move 1 to ekran-fis-1
    end-read.
   
    add 1 to ekran-fis-1.
   
    move ekran-fis-1(2:) to takas6-no takas8-no takas7-no  takas5-no.
    rewrite genelfis-rec invalid 
            write genelfis-rec invalid continue
            end-write
    end-rewrite.
    close genelfis.
    open output takas6 close takas6
    open output takas6 close takas6
    open output takas7 close takas7
    open output takas8 close takas8
    open i-o takas6 with mass-update.
    open i-o takas7 with mass-update.
    open i-o takas5 with mass-update.
    open i-o takas8 with mass-update.

    open input takvim takvim2.
    initialize takvim-rec.
    move 1           to giris-gun
    move giris-tarih to takvim-anah
    start takvim key not < takvim-anah invalid 
           continue
    not invalid
    move 1 to kolon
    perform with test after until fs-takvim = "10" 
    read takvim next no lock end move "10" to fs-takvim
    not end,
        if takvim-anah(1:6) > giris-tarih(1:6),
           move "10" to fs-takvim           
        else,
           initialize takas8-rec,
           move takvim-anah to takas8-tarih,
           if kolon < 40
              add 1 to kolon
           end-if
           move kolon to takas8-kolon
                write takas8-rec invalid stop " " end-write                              
        end-if,

    end-read,
    end-perform,
    end-start.
         add 1 to kolon
    close takvim takvim2
      perform ihtimal-yukle.

*
 grid-doldur.
      move 10 to yer1
      move 21 to yer2
      move 30 to yer3
      move 1 to kayit-sira 
    initialize takas5-rec

    start takas5 key > takas5-anah invalid 
          continue
    not invalid
    perform with test after until fs-takas5 = "10"
    read takas5 next no lock end move "10" to fs-takas5
    not at end

             initialize g-rec
             if yedek-anah = spaces 
                move 1 to r1
                move takas5-ilk-anah to yedek-anah
                move takas5-ilk-anah to g-rec(1:9)
                   perform t1-yaz
             else
                if takas5-ilk-anah not = yedek-anah
                   move takas5-ilk-anah to yedek-anah
                   initialize r2
                    if takas5-ilk-anah = high-values
                        move 9 to r1
                    else
                        if r1 = 1 then 
                           move 2 to r1 
                        else 
                           move 1 to r1 
                        end-if
                    end-if
                         move takas5-ilk-anah to g-rec(1:9)
                          perform t1-yaz
                else
                  if takas5-ilk-anah = high-values and 
                     takas5-iki-anah = high-values
                            perform t1-yaz
                  end-if
                end-if
             end-if
      
                 move takas5-iki-anah to g-rec(yer1 + 1 :9) 
                      perform t2-yaz
                 if takas5-iki-anah = high-values
                    move 9 to r2
                 else
                    if r2 = 1 then 
                       move 2 to r2 
                    else 
                       move 1 to r2 
                    end-if
                 end-if
                 evaluate rler
                 when "11"
                        move r11A to acik-renk
                        move r11K to koyu-renk
                        move "0" to hid-buf 
                 when "12" 
                        move r12A to acik-renk
                        move r12K to koyu-renk
                         move "0" to hid-buf 
                 when "19" 
                        move r19A to acik-renk
                        move r19K to koyu-renk
                         move "1" to hid-buf 
                 when "21" 
                        move r21A to acik-renk
                        move r21K to koyu-renk
                         move "0" to hid-buf 
                 when "22"
                        move r22A to acik-renk
                        move r22K to koyu-renk
                         move "0" to hid-buf 
                 when "29" 
                        move r29A to acik-renk
                        move r29K to koyu-renk
                         move "1" to hid-buf 
                 when "91"
                        move r91A to acik-renk
                        move r91K to koyu-renk
                           move "1" to hid-buf 
                 when "92" 
                        move r92A to acik-renk
                        move r92K to koyu-renk
                           move "1" to hid-buf 
                 when "99" 
                        move r99A to acik-renk
                        move r99K to koyu-renk 
                           move "1" to hid-buf 
                 end-evaluate

            move "Oda " to  g-rec(yer2 + 1 :9) 
                 perform varying i from 1 by 1 until i > kolon - 1
                      move takas5-oda(i) to z-oda
                      if boslar0 = 1 or takas5-oda(i) > 0
                         move z-oda to   g-rec((i * 10) + ( yer2 ):10),
                      else
                        initialize   g-rec((i * 10) + ( yer2 ):10),
                      end-if
                 end-perform 
                      move takas5top-oda to zt-oda
                       if boslar0 = 1 or takas5top-oda > 0
                           move zt-oda to   g-rec((kolon * 10 - 10) + ( yer2 ):12),
                          else
                          initialize   g-rec((kolon * 10 - 10) + (yer2 ) :12),   
                      end-if
                  
                  modify form1-gd-1,record-to-add(g-rec)
                  add 1 to kayit-sira 
                  modify form1-gd-1(kayit-sira), row-color acik-renk  
                   modify form1-gd-1(kayit-sira,1) hidden-data hid-buf

                   initialize g-rec(1:9) g-rec(yer1 + 1 :9)
****           end-if
****          if d2 = 1 then 
           

            move "Oda Ort " to  g-rec(yer2 + 1 :9) 
           perform varying i from 1 by 1 until i > kolon - 1
                 compute ort rounded = takas5-tut(i) / takas5-oda(i)
                  move ort to z-ort
                  if boslar0 = 1 or ort > 0
                    move z-ort to   g-rec((i * 10) + (yer2 ) :10),
                    else
                       initialize   g-rec((i * 10) + ( yer2 ):10),
                 end-if
           end-perform 

              compute ort rounded = takas5top-tut / takas5top-oda
              move ort to zt-ort
               if boslar0 = 1 or ort > 0
                   move zt-ort to   g-rec((kolon * 10 - 10) + (yer2 ) :12),
                     else
                          initialize   g-rec((kolon * 10 - 10) + (yer2 ) :12),
              end-if
****                 move koyu-renk to   g-rec((kolon * 10) + (yer2 + 13) :3),

                     modify form1-gd-1,record-to-add(g-rec)
                  add 1 to kayit-sira 
                  modify form1-gd-1(kayit-sira), row-color koyu-renk 
                  modify form1-gd-1(kayit-sira,1) hidden-data hid-buf

           initialize g-rec(1:9) g-rec(yer1 + 1 :9)
***          end-if
***          if d3 = 1 then 
                move "Pax " to  g-rec(yer2 + 1 :9) 
                 perform varying i from 1 by 1 until i > kolon - 1
                      move takas5-pax(i) to z-pax
                        if boslar0 = 1 or takas5-pax(i)  > 0
                           move z-pax to   g-rec((i * 10) + (yer2) :10),
                           else
                            initialize   g-rec((i * 10) + ( yer2 ):10),
                      end-if
                    end-perform 
                 move takas5top-pax to zt-pax
                  if boslar0 = 1 or takas5top-pax  > 0
                    move zt-pax to   g-rec((kolon * 10 - 10) + (yer2 ) :12)
                      else
                          initialize   g-rec((kolon * 10 - 10) + (yer2 ) :12)
                 end-if
****                 move acik-renk to   g-rec((kolon * 10) + (yer2 + 13) :3)
                  modify form1-gd-1,record-to-add(g-rec)                                  
                  add 1 to kayit-sira 
                  modify form1-gd-1(kayit-sira), row-color acik-renk 
                  modify form1-gd-1(kayit-sira,1) hidden-data hid-buf

                  initialize g-rec(1:9) g-rec(yer1 + 1 :9)
**          end-if
****          if d4 = 1 then 
           
                   move "Pax Ort " to  g-rec(yer2 + 1 :9) 
                 perform varying i from 1 by 1 until i > kolon - 1
                    compute ort rounded = takas5-tut(i) / takas5-pax(i)
                      move ort to z-ort
                      if boslar0 = 1 or ort  > 0
                           move z-ort to   g-rec((i * 10) + (yer2 ) :10),
                           else
                       initialize   g-rec((i * 10) + ( yer2 ):10),
                      end-if
                        
                 end-perform 
        
                      compute ort rounded = takas5top-tut / takas5top-pax
                      move ort to zt-ort
                      if boslar0 = 1 or ort  > 0
                          move zt-ort to   g-rec((kolon * 10 - 10) + (yer2 ) :12),
                            else
                          initialize   g-rec((kolon * 10 - 10) + (yer2 ) :12),
                      end-if
****                        move koyu-renk to   g-rec((kolon * 10) + (yer2 + 13) :3),
                 modify form1-gd-1,record-to-add(g-rec)  
                  add 1 to kayit-sira 
                  modify form1-gd-1(kayit-sira), row-color koyu-renk  
                  modify form1-gd-1(kayit-sira,1) hidden-data hid-buf

                   initialize g-rec(1:9) g-rec(yer1 + 1 :9)
****           end-if


****          if d5 = 1 then 

                    move "Tutar " to  g-rec(yer2 + 1 :9) 
                 perform varying i from 1 by 1 until i > kolon - 1
                      move takas5-tut(i) to z-tut
                      if boslar0 = 1 or takas5-tut(i)  > 0
                           move z-tut to   g-rec((i * 10) + (yer2 ) :10),
                           else
                       initialize   g-rec((i * 10) + ( yer2 ):10),
                      end-if
                      

                 end-perform 
                 
                      move takas5top-tut to zt-tut
                      if boslar0 = 1 or takas5top-tut  > 0
                         move zt-tut to   g-rec((kolon * 10 - 10) + (yer2 ) :12),
                         else
                          initialize   g-rec((kolon * 10 - 10) + (yer2 ) :12),
                      end-if 
                          
***                       move acik-renk to   g-rec((kolon * 10) + (yer2 + 13) :3),  
                  modify form1-gd-1,record-to-add(g-rec) 
                  add 1 to kayit-sira 
                  modify form1-gd-1(kayit-sira), row-color acik-renk 
                  modify form1-gd-1(kayit-sira,1) hidden-data hid-buf
                     

    end-read
    end-perform
    end-start.
*

 t1-yaz.
                   if  takas5-ilk-anah = high-values
                             if  takas5-iki-anah = high-values
                                move "OTEL  " to  g-rec(1 :9) 
                              else
                            
                               move "TOPLAM" to  g-rec(1 :9) 
                             end-if
                              else
                              move rap-anah1        to yaz-det-tip
                              move takas5-ilk-anah  to yaz-det-anah
                              
                              perform yaz-bul
                              move yaz-text to    g-rec(1 :9) 

                  
**********yaz
                            end-if. 
*
 yaz-bul.
           initialize  yaz-text
           evaluate  yaz-det-tip
                                 when " " 
                                    move "Detaysiz" to yaz-text
                                  when "A"              
                                        move "D" to kodlar02-tipi
                                        move yaz-det-anah   to kodlar02-kodu
                                        read kodlar02 no lock invalid
                                             move all "*" to kodlar02-adi
                                             move kodlar02-kodu to kodlar02-adi
                                        end-read
                                        move kodlar02-adi to yaz-text 

                                  when "P"              
                                        move "E" to kodlar02-tipi
                                        move yaz-det-anah   to kodlar02-kodu
                                        read kodlar02 no lock invalid
                                             move all "*" to kodlar02-adi
                                             move kodlar02-kodu to kodlar02-adi
                                        end-read
                                        move kodlar02-adi to yaz-text 
                                   
                                   when "U"
                                        move yaz-det-anah   to ulke-anah
                                        read ulke no lock invalid
                                             move all "*" to ulke-adi
                                             move ulke-anah to  ulke-adi
                                        end-read
                                         move ulke-adi to yaz-text 
                
                                  
                                  when "F" when "O"
                                        move yaz-det-anah(1:2)   to konum-anahtar
                                        read konum no lock invalid
                                             move all "*" to konum-adi
                                        end-read
                                       
                                        move konum-adi     to yaz-text 
                                  when "T"
                                        move yaz-det-anah   to acenta-anahtar 
                                        read acenta no lock invalid
                                              
                                             move all "*" to acenta-adi
                                             move acenta-kodu to acenta-adi
                                        end-read
                                       
                                        move acenta-adi     to yaz-text 
                                  
                               end-evaluate .



*
 t2-yaz.
            if  takas5-iki-anah = high-values
                              move "TOPLAM" to  g-rec(yer1 + 1 :9) 
            else
                move rap-anah2        to yaz-det-tip
                move takas5-iki-anah  to yaz-det-anah
                              
                perform yaz-bul
                move yaz-text to    g-rec(yer1 + 1 :9) 

**********yaz
           end-if.

*
 Form1-Ex-Cmd-Close.
     
     .
*
 satir-bul.
       compute bolum = grid-satir + 4
       divide bolum by 5 giving takas-satir remainder veri-sira
       if veri-sira = 0
          move 5 to veri-sira
          subtract 1 from takas-satir
       end-if
      .
*
 grid-satir-bul.
       compute oda-satir     = (takas-satir - 1 ) * 5 + 1 + 1
       compute oda-ort-satir = (takas-satir - 1 ) * 5 + 2 + 1
       compute pax-satir     = (takas-satir - 1 ) * 5 + 3 + 1
       compute pax-ort-satir = (takas-satir - 1 ) * 5 + 4 + 1
       compute tutar-satir   = (takas-satir - 1 ) * 5 + 5 + 1
           .
*
 Form1-Gd-1-Ev-Other.
       inquire form1-gd-1,x in xx
                          y in yy
       perform grid-ev-2.
*
 grid-ev-2.
       evaluate event-type
       when msg-begin-entry
            move yy      to grid-satir
                 perform satir-bul
          
        inquire form1-gd-1(yy,1) hidden-data in hid-buf 
        if function numval (hid-buf) = 1 then 
          set event-action to event-action-fail
       end-if

            evaluate veri-sira
            when 1
               inquire form1-gd-1(yy,xx),cell-data in z-oda
               move z-oda     to s-oda
               modify form1-gd-1(yy,xx),cell-data = s-oda
            when 2
*               inquire form1-gd-1(yy,xx),cell-data in z-ort
*               move z-ort     to s-ort
*               modify form1-gd-1(yy,xx),cell-data = s-ort
                set event-action to event-action-fail
            when 3
               inquire form1-gd-1(yy,xx),cell-data in z-pax
               move z-pax     to s-pax
               modify form1-gd-1(yy,xx),cell-data = s-pax
            when 4
               inquire form1-gd-1(yy,xx),cell-data in z-ort
               move z-ort     to s-ort
               modify form1-gd-1(yy,xx),cell-data = s-ort
            when 5
               set event-action to event-action-fail
            end-evaluate
       when msg-finish-entry
            move 1 to degisti
            initialize takas5-rec
            move takas-satir      to takas5-satir
            read takas5 no lock key takas5-satir invalid 
                 stop " " 
            not invalid

            if takas5-ilk-anah = high-values or
               (takas5-iki-anah = high-values ) or
               xx = 33
                 set event-action to event-action-fail 
                  exit paragraph
            end-if
                 
                move takas5-oda(xx - 1) to e-oda s-oda     
                move takas5-pax(xx - 1) to e-pax s-pax    
                move takas5-tut(xx - 1) to e-tut s-tut
                compute s-oda-ort rounded = s-tut / s-oda
                compute s-pax-ort rounded = s-tut / s-pax 
            if toplu-gonderim not = 1
               evaluate veri-sira
               when 1
                  inquire form1-gd-1(yy,xx),cell-data in s-oda
                  move s-oda     to z-oda
                  modify form1-gd-1(yy,xx),cell-data = z-oda
               when 2
                  stop  " " 
*                  inquire form1-gd-1(yy,xx),cell-data in s-oda-ort
*                  move s-oda-ort     to z-ort
*                  modify form1-gd-1(yy,xx),cell-data = z-ort
               when 3
                  inquire form1-gd-1(yy,xx),cell-data in s-pax
                  move s-pax     to z-pax
                  modify form1-gd-1(yy,xx),cell-data = z-pax
               when 4
                  inquire form1-gd-1(yy,xx),cell-data in s-pax-ort
                  move s-pax-ort     to z-ort
                  modify form1-gd-1(yy,xx),cell-data = z-ort
               when 5
                 
*                  inquire form1-gd-1(yy,xx),cell-data in s-tut
*                  move s-tut     to z-tut
*                  modify form1-gd-1(yy,xx),cell-data = z-tut
               end-evaluate
                   compute s-tut = s-pax * s-pax-ort
                   compute s-oda-ort rounded = s-tut / s-oda                   

            else

                  inquire form1-gd-1(oda-satir,xx),cell-data in s-oda

                  inquire form1-gd-1(pax-satir,xx),cell-data in s-pax

                  inquire form1-gd-1(tutar-satir,xx),cell-data in s-tut

                   compute s-pax-ort rounded = s-tut / s-pax                   
                   compute s-oda-ort rounded = s-tut / s-oda                   

            end-if
                perform grid-satir-bul

*                   compute s-tut = s-oda * s-oda-ort
*                   compute s-pax-ort rounded = s-tut / s-pax



     

                move s-oda       to takas5-oda(xx - 1) 
                move s-pax       to takas5-pax(xx - 1) 
                move s-tut       to takas5-tut(xx - 1) 

                compute takas5top-oda = takas5top-oda - e-oda + s-oda
                compute takas5top-pax = takas5top-pax - e-pax + s-pax
                compute takas5top-tut = takas5top-tut - e-tut + s-tut
                
                move s-oda       to z-oda
                move s-pax       to z-pax
                move s-tut       to z-tut

                modify form1-gd-1(oda-satir,xx),cell-data = z-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(pax-satir,xx),cell-data = z-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(tutar-satir,xx),cell-data = z-tut



                

                move takas5top-oda       to zt-oda
                move takas5top-pax       to zt-pax
                move takas5top-tut       to zt-tut


                compute s-oda-ort rounded = takas5top-tut / takas5top-oda  
                compute s-pax-ort rounded = takas5top-tut / takas5top-pax

                modify form1-gd-1(oda-satir,33),cell-data = zt-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(pax-satir,33),cell-data = zt-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(tutar-satir,33),cell-data = zt-tut
                 rewrite takas5-rec invalid stop " " end-rewrite|write 

            end-read
*-------------------------------------------------------------------satir yazildi---------
            move takas5-anah      to yedek-5-anah
            move high-values      to takas5-iki-anah
****            move takas-satir      to takas5-satir
            read takas5 no lock invalid 
                 stop " " 
            not invalid
                 
 

                move takas5-satir     to takas-satir
                perform grid-satir-bul

*                   compute s-tut = s-oda * s-oda-ort
*                   compute s-pax-ort rounded = s-tut / s-pax
                compute takas5-tut(xx - 1) = takas5-tut(xx - 1) + s-tut - e-tut
                compute takas5-oda(xx - 1) = takas5-oda(xx - 1) + s-oda - e-oda
                compute takas5-pax(xx - 1) = takas5-pax(xx - 1) + s-pax - e-pax
                
    
                compute takas5top-oda = takas5top-oda - e-oda + s-oda
                compute takas5top-pax = takas5top-pax - e-pax + s-pax
                compute takas5top-tut = takas5top-tut - e-tut + s-tut
                
                move takas5-oda(xx - 1)       to z-oda
                move takas5-pax(xx - 1)       to z-pax
                move takas5-tut(xx - 1)       to z-tut


                   compute s-pax-ort rounded = takas5-tut(xx - 1) / takas5-pax(xx - 1)
                   compute s-oda-ort rounded = takas5-tut(xx - 1) / takas5-oda(xx - 1)

                modify form1-gd-1(oda-satir,xx),cell-data = z-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(pax-satir,xx),cell-data = z-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(tutar-satir,xx),cell-data = z-tut


                move takas5top-oda       to zt-oda
                move takas5top-pax       to zt-pax
                move takas5top-tut       to zt-tut


                compute s-oda-ort rounded = takas5top-tut / takas5top-oda  
                compute s-pax-ort rounded = takas5top-tut / takas5top-pax

                modify form1-gd-1(oda-satir,33),cell-data = zt-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(pax-satir,33),cell-data = zt-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(tutar-satir,33),cell-data = zt-tut

                rewrite takas5-rec invalid stop " " end-rewrite |write  
            end-read
**************************************************************ara toplam bitti
*------------------------------------------------------------------
            move yedek-5-anah       to takas5-anah
            move high-values        to takas5-ilk-anah
            read takas5 no lock invalid 
                 stop " " 
            not invalid               
 

                move takas5-satir     to takas-satir
                perform grid-satir-bul

*                   compute s-tut = s-oda * s-oda-ort
*                   compute s-pax-ort rounded = s-tut / s-pax
                compute takas5-tut(xx - 1) = takas5-tut(xx - 1) + s-tut - e-tut
                compute takas5-oda(xx - 1) = takas5-oda(xx - 1) + s-oda - e-oda
                compute takas5-pax(xx - 1) = takas5-pax(xx - 1) + s-pax - e-pax
                
    
                compute takas5top-oda = takas5top-oda - e-oda + s-oda
                compute takas5top-pax = takas5top-pax - e-pax + s-pax
                compute takas5top-tut = takas5top-tut - e-tut + s-tut
                
                move takas5-oda(xx - 1)       to z-oda
                move takas5-pax(xx - 1)       to z-pax
                move takas5-tut(xx - 1)       to z-tut


                   compute s-pax-ort rounded = takas5-tut(xx - 1) / takas5-pax(xx - 1)
                   compute s-oda-ort rounded = takas5-tut(xx - 1) / takas5-oda(xx - 1)

                modify form1-gd-1(oda-satir,xx),cell-data = z-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(pax-satir,xx),cell-data = z-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(tutar-satir,xx),cell-data = z-tut


                move takas5top-oda       to zt-oda
                move takas5top-pax       to zt-pax
                move takas5top-tut       to zt-tut


                compute s-oda-ort rounded = takas5top-tut / takas5top-oda  
                compute s-pax-ort rounded = takas5top-tut / takas5top-pax

                modify form1-gd-1(oda-satir,33),cell-data = zt-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(pax-satir,33),cell-data = zt-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(tutar-satir,33),cell-data = zt-tut

                rewrite takas5-rec invalid stop " " end-rewrite |write  
            end-read



**************************************************************ara toplam bitti
*------------------------------------------------------------------
            move high-values       to takas5-anah
            read takas5 no lock invalid 
                 stop " " 
            not invalid
                 
 

                move takas5-satir     to takas-satir
                perform grid-satir-bul

*                   compute s-tut = s-oda * s-oda-ort
*                   compute s-pax-ort rounded = s-tut / s-pax
                compute takas5-tut(xx - 1) = takas5-tut(xx - 1) + s-tut - e-tut
                compute takas5-oda(xx - 1) = takas5-oda(xx - 1) + s-oda - e-oda
                compute takas5-pax(xx - 1) = takas5-pax(xx - 1) + s-pax - e-pax
                
    
                compute takas5top-oda = takas5top-oda - e-oda + s-oda
                compute takas5top-pax = takas5top-pax - e-pax + s-pax
                compute takas5top-tut = takas5top-tut - e-tut + s-tut
                
                move takas5-oda(xx - 1)       to z-oda
                move takas5-pax(xx - 1)       to z-pax
                move takas5-tut(xx - 1)       to z-tut


                   compute s-pax-ort rounded = takas5-tut(xx - 1) / takas5-pax(xx - 1)
                   compute s-oda-ort rounded = takas5-tut(xx - 1) / takas5-oda(xx - 1)

                modify form1-gd-1(oda-satir,xx),cell-data = z-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(pax-satir,xx),cell-data = z-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,xx),cell-data = z-ort

                modify form1-gd-1(tutar-satir,xx),cell-data = z-tut


                move takas5top-oda       to zt-oda
                move takas5top-pax       to zt-pax
                move takas5top-tut       to zt-tut


                compute s-oda-ort rounded = takas5top-tut / takas5top-oda  
                compute s-pax-ort rounded = takas5top-tut / takas5top-pax

                modify form1-gd-1(oda-satir,33),cell-data = zt-oda
                move s-oda-ort to z-ort
                modify form1-gd-1(oda-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(pax-satir,33),cell-data = zt-pax

                move s-pax-ort to z-ort
                modify form1-gd-1(pax-ort-satir,33),cell-data = z-ort

                modify form1-gd-1(tutar-satir,33),cell-data = zt-tut

                rewrite takas5-rec invalid stop " " end-rewrite |write  
            end-read

       end-evaluate
     

     .
*
 Form1-Gd-1-Ex-Other.
       evaluate key-status
       when 27
       if degisti = 1
          display message box "Kaydetmek Istermisiniz..."
                          title "[ Uyari ]"
                          icon 1
                          type 4
                          default 1
                          returning donus
          evaluate donus
          when 2
             set exit-pushed to true
*             close takas5 takas6 takas7 takas8
*             delete file takas5 takas6 takas7 takas8
          when 3
             initialize key-status
             set event-action to event-action-fail
          when 1
             perform form-kaydet
             display message box "Butceniz Basariyla Kaydedildi..."
                             title "[ Uyari ]" 
                             icon 1

          end-evaluate

       end-if


       when 5
               inquire form1-gd-1,cursor-x in xx
                                  cursor-y in yy

               inquire form1-gd-1(yy,xx),
                                  cell-data in kopya-veri
               if xx < 33
                   perform until xx > 31 
                   
                   add 1 to xx
                   modify form1-gd-1,cursor-x = xx                                  
                   move msg-begin-entry to event-type
                   perform grid-ev-2

                   modify form1-gd-1(yy,xx),cell-data = kopya-veri
                   move msg-finish-entry to event-type
                   perform grid-ev-2
                   end-perform 
               end-if
       when 6
               inquire form1-gd-1,cursor-x in xx
                                  cursor-y in yy
               move xx to eski-xx
               move yy to eski-yy

               move eski-yy  to grid-satir
               perform satir-bul
               perform grid-satir-bul

               inquire form1-gd-1(oda-satir,xx),
                                  cell-data in kopya-oda
               inquire form1-gd-1(pax-satir,xx),
                                  cell-data in kopya-pax
               inquire form1-gd-1(tutar-satir,xx),
                                  cell-data in kopya-tutar

               if xx < 33
                   perform until xx > 31 
                   
                   add 1 to xx
                   modify form1-gd-1,cursor-x = xx                                  
                   move msg-begin-entry to event-type
                   perform cakma-begin-entry

                   move 1 to toplu-gonderim
                   modify form1-gd-1(oda-satir,xx),cell-data = kopya-oda
                   modify form1-gd-1(pax-satir,xx),cell-data = kopya-pax
                   modify form1-gd-1(tutar-satir,xx),cell-data = kopya-tutar

                   move msg-finish-entry to event-type
                   perform grid-ev-2
                    move 0 to toplu-gonderim
                   end-perform 
               end-if 
         

       end-evaluate
     
     .
* 
 cakma-begin-entry.
            move yy      to grid-satir
                 perform satir-bul


               inquire form1-gd-1(oda-satir,xx),cell-data in z-oda
               move z-oda     to s-oda


               inquire form1-gd-1(yy,xx),cell-data in z-pax
               move z-pax     to s-pax


               inquire form1-gd-1(yy,xx),cell-data in z-ort
               move z-ort     to s-ort.

*
 form-kaydet.
       if acc-4-val = spaces
          display message box "Butce Ismi Giriniz..."
                          title "[ Uyari ]"
                          icon 1
          move 4  to accept-control
          move 43 to control-id
       end-if

       open i-o butcegir takvim
       initialize butcegir-rec takas5-rec
       start takas5 key not < takas5-anah invalid
             continue
       not invalid
       perform with test after until fs-takas5 = "10"
       read takas5 next no lock end move "10" to fs-takas5
       not at end
               if takas5-ilk-anah = high-values or
                  takas5-iki-anah = high-values 
                    continue
               else
                initialize takvim-rec 
                move giris-tarih        to takvim-anah
                move 0                   to takvim-gun
                start takvim key not < takvim-anah invalid
                      continue
                not invalid
                perform with test after until fs-takvim = "10"
                read takvim next no lock end move "10" to fs-takvim
                not at end 
                        if takvim-ay not = giris-ay or
                           takvim-yil not = giris-yil
                              move "10" to fs-takvim                    
                        else
                            perform tek-tarih-kaydet
                        end-if
                
                 end-read
                 end-perform
                 end-start
               end-if
       end-read
       end-perform
       end-start

       close butcegir takvim.
*
 tek-tarih-kaydet.
       move takas5-anah               to butcegir-takas5-anah
       move takas5-tut(takvim-gun)    to butcegir-tut
       move takas5-oda(takvim-gun)    to butcegir-oda
       move takas5-pax(takvim-gun)    to butcegir-pax
       move takvim-anah               to butcegir-tarih
       move acc-4-val                 to butcegir-adi
       move rap-anah1(1:1)            to butcegir-tip-1
       move rap-anah2(1:1)            to butcegir-tip-2
       move k-kodu-tasi               to butcegir-staf
              write butcegir-rec invalid
                   rewrite butcegir-rec end-rewrite 
              end-write 

       .
*
 form-farkli-kaydet.
       if acc-99-val = spaces
          display message box "Butce Ismi Giriniz..."
                          title "[ Uyari ]"
                          icon 1
          move 4  to accept-control
          move 12 to control-id
       end-if

       open i-o butcegir takvim
       initialize butcegir-rec takas5-rec
       start takas5 key not < takas5-anah invalid
             continue
       not invalid
       perform with test after until fs-takas5 = "10"
       read takas5 next no lock end move "10" to fs-takas5
       not at end
               if takas5-ilk-anah = high-values or
                  takas5-iki-anah = high-values 
                    continue
               else
                initialize takvim-rec 
                move giris-tarih        to takvim-anah
                move 0                   to takvim-gun
                start takvim key not < takvim-anah invalid
                      continue
                not invalid
                perform with test after until fs-takvim = "10"
                read takvim next no lock end move "10" to fs-takvim
                not at end 
                        if takvim-ay not = giris-ay or
                           takvim-yil not = giris-yil
                              move "10" to fs-takvim                    
                        else
                            perform tek-tarih-farkli-kaydet
                        end-if
                
                 end-read
                 end-perform
                 end-start
               end-if
       end-read
       end-perform
       end-start

       close butcegir takvim.
*
 tek-tarih-farkli-kaydet.
       move takas5-anah               to butcegir-takas5-anah
       move takas5-tut(takvim-gun)    to butcegir-tut
       move takas5-oda(takvim-gun)    to butcegir-oda
       move takas5-pax(takvim-gun)    to butcegir-pax
       move takvim-anah               to butcegir-tarih
       move acc-99-val                 to butcegir-adi
       move rap-anah1(1:1)            to butcegir-tip-1
       move rap-anah2(1:1)            to butcegir-tip-2
       move k-kodu-tasi               to butcegir-staf
              write butcegir-rec invalid 
                   rewrite butcegir-rec end-rewrite 
              end-write. 
*
 Form2-Aft-Initdata.
       perform ac-baslik-yukle.
       perform ac-grid-yukle.
*
 ac-baslik-yukle.
      modify gd-2,reset-grid = 1
                  mass-update = 1
      initialize gd-2-rec
      move "Tarih"      to gd-2-col-1
      move "Butce Adi"  to gd-2-col-2
      move "Detay-1"    to gd-2-col-3
      move "Detay-2"    to gd-2-col-4
      
      modify gd-2, record-to-add(gd-2-rec).
*
 ac-grid-yukle.
      open input butcegir
      initialize butcegir-rec  yedek-butcegir-adi
      move rap-anah1(1:1)     to butcegir-tip-1
      move rap-anah2(1:1)     to butcegir-tip-2
      start butcegir key not < butcegir-anah invalid
            continue
      not invalid
      perform with test after until fs-butcegir = "10"
      read butcegir next no lock end move "10"  to fs-butcegir
      not at end
             if rap-anah1(1:1) not = butcegir-tip-1 and
                rap-anah2(1:1) not = butcegir-tip-2
                   exit perform 
             end-if

             if yedek-butcegir-adi = spaces |konumlar anahtar sahada olduu iin gride btn konumlar doluyor...
                 move butcegir-adi  to yedek-butcegir-adi
                 move butcegir-tarih to yedek-giris-tarih
             else
                if butcegir-adi = yedek-butcegir-adi and 
                   butcegir-tarih(1:6) = yedek-giris-tarih(1:6)
                       exit perform cycle
                else
                   move butcegir-adi to yedek-butcegir-adi
                   move butcegir-tarih to yedek-giris-tarih
                end-if
             end-if

             initialize gd-2-rec
             move butcegir-ay        to eay
             move butcegir-yil       to eyil
             move etarih             to gd-2-col-1
             move butcegir-adi       to gd-2-col-2

             evaluate butcegir-tip-1
             when "P"
                  move "Pazar"       to gd-2-col-3
             when "T"
                  move "Acenta"      to gd-2-col-3
             when "U"
                  move "Ulke"        to gd-2-col-3
             when "F"
                  move "F.Konumu"    to gd-2-col-3
             when "O"                
                  move "O.Konumu"    to gd-2-col-3
             when "A"
                  move "Anlasma"     to gd-2-col-3
             end-evaluate

             evaluate butcegir-tip-2
             when "P"
                  move "Pazar"       to gd-2-col-4
             when "T"
                  move "Acenta"      to gd-2-col-4
             when "U"
                  move "Ulke"        to gd-2-col-4
             when "F"
                  move "F.Konumu"    to gd-2-col-4
             when "O"                
                  move "O.Konumu"    to gd-2-col-4
             when "A"
                  move "Anlasma"     to gd-2-col-4
             end-evaluate

             modify gd-2,record-to-add(gd-2-rec)
      end-read
      end-perform
      end-start
      close butcegir
      modify gd-2,mass-update = 0
      .
     .

*
 Form2-Ex-Other.
      evaluate key-status
      when 1008
           inquire gd-2, cursor-y sayac 
           inquire gd-2(sayac,2),cell-data in yedek-butcegir-adi
           inquire gd-2(sayac,1),cell-data in yedek-butcegir-tarih
           move yedek-butcegir-tarih(1:2)   to giris-ay
           move yedek-butcegir-tarih(4:4)   to giris-yil

           move yedek-butcegir-adi          to acc-4-val
           move 1 to  v-2 v-1 vis-4 vis-5  vis-6
           display form1-gd-1 lb-butce-tarih lb-butce-adi 
                   acc-2 acc-3 acc-4  bt-sil Form1-Pb-1aaa form1-pb-1aa Form1-Pb-2
  
           move 0 to v-3 v-but-ac v-but-yeni
           display com-ana1 com-ana2 Form1-Pb-1a Form1-Pb-1       
                 
           
           open input acenta kodlar02 ulke konum
                     

                         perform takas-dosya-yaz
                         perform baslik-grid-yukle
             
                         perform takas5-doldur
                         perform grid-doldur

           close acenta kodlar02 ulke konum 
           set exit-pushed to true

      end-evaluate    
     .
*
 takas5-doldur.
     open i-o  butcegir takvim
     initialize takas5-rec butcegir-rec  takvim-rec 
     move giris-tarih        to takvim-anah
     move 0                  to takvim-gun
     start takvim key not < takvim-anah invalid
           continue
     not invalid
     perform with test after until fs-takvim = "10"
     read takvim next no lock end move "10" to fs-takvim
     not at end 
             if takvim-ay not = giris-ay or
                takvim-yil not = giris-yil
                   move "10" to fs-takvim                    
             else
                 perform butcegir-start
             end-if
     end-read
     end-perform
     end-start
     close takvim butcegir.
*
 butcegir-start.
     initialize butcegir-rec
     move rap-anah1(1:1)     to butcegir-tip-1
     move rap-anah2(1:1)     to butcegir-tip-2
     move yedek-butcegir-adi to butcegir-adi

     move takvim-anah        to butcegir-tarih

     start butcegir key not < butcegir-alt-anah invalid
           continue
     not invalid
     perform with test after until fs-butcegir = "10"
     read butcegir next no lock end move "10" to fs-butcegir
     not at end
             if butcegir-tip-1 not = rap-anah1(1:1) or
                butcegir-tip-2 not = rap-anah2(1:1) or
                butcegir-adi   not = yedek-butcegir-adi  or 
                butcegir-tarih not = takvim-anah
                  exit perform 
             end-if

             initialize takas5-rec
             move butcegir-takas5-anah         to takas5-anah 
             read takas5 no lock invalid
                  delete butcegir end-delete|eer grid zerindeki koullardan bieyler silinirse diye konuldu r: pazar kodu                    
             not invalid
                  move butcegir-takas5-anah    to takas5-anah 
                  move butcegir-tut            to takas5-tut(takvim-gun) 
                  move butcegir-oda            to takas5-oda(takvim-gun) 
                  move butcegir-pax            to takas5-pax(takvim-gun)

                  add butcegir-tut             to takas5top-tut
                  add butcegir-oda             to takas5top-oda
                  add butcegir-pax             to takas5top-pax

                     rewrite takas5-rec invalid stop " " end-rewrite 
                       perform toplam-al
             end-read
     end-read
     end-perform
     end-start

     initialize takas5-rec x-sira 
     start takas5 key not < takas5-anah invalid
           continue
     not invalid
     perform with test after until fs-takas5 = "10"
     read takas5 next no lock end move "10" to fs-takas5
     not at end 
            add 1 to x-sira
            move x-sira to takas5-satir
            rewrite takas5-rec invalid stop "1 " end-rewrite 
     end-read
     end-perform
     end-start

     .
*
 toplam-al.
            move takas5-anah      to yedek-5-anah
            move high-values      to takas5-ilk-anah
            perform toplam-al-2

            move high-values to takas5-iki-anah

            perform toplam-al-2
            move yedek-5-anah to takas5-anah 
            move high-values to takas5-iki-anah

            perform toplam-al-2
            .
*
 toplam-al-2.
    read takas5 no lock invalid
         initialize takas5-data       
    end-read
      add butcegir-tut            to takas5-tut(takvim-gun) 
      add butcegir-oda            to takas5-oda(takvim-gun) 
      add butcegir-pax            to takas5-pax(takvim-gun)
      add butcegir-tut             to takas5top-tut
      add butcegir-oda             to takas5top-oda
      add butcegir-pax             to takas5top-pax

      write takas5-rec invalid 
          rewrite takas5-rec end-rewrite 
      end-write 

      .
*
 acc-4-Aft-Procedure.
      if acc-4-val = spaces
         display message box "Butce Adi Giriniz..."
                         title "[ Uyari ]"
                         icon 1 
         move 4   to accept-control
         move 43  to control-id
         exit paragraph
      end-if
     
     .
*
 butce-sil.
     display message box "Butce Silinecektir.Eminmisiniz?"
                     title "[ Uyari ]"
                     icon 1
                     type 2
                     default 2
                     returning donus
     if donus = 2
        exit paragraph
     end-if
       open i-o butcegir takvim
       initialize butcegir-rec takas5-rec
       start takas5 key not < takas5-anah invalid
             continue
       not invalid
       perform with test after until fs-takas5 = "10"
       read takas5 next no lock end move "10" to fs-takas5
       not at end
               if takas5-ilk-anah = high-values or
                  takas5-iki-anah = high-values 
                    continue
               else
                initialize takvim-rec 
                move giris-tarih        to takvim-anah
                move 0                   to takvim-gun
                start takvim key not < takvim-anah invalid
                      continue
                not invalid
                perform with test after until fs-takvim = "10"
                read takvim next no lock end move "10" to fs-takvim
                not at end 
                        if takvim-ay not = giris-ay or
                           takvim-yil not = giris-yil
                              move "10" to fs-takvim                    
                        else
                            perform tek-tarih-sil
                        end-if
                
                 end-read
                 end-perform
                 end-start
               end-if
       end-read
       end-perform
       end-start

       close butcegir takvim.
*
 tek-tarih-sil.
       move takas5-anah               to butcegir-takas5-anah
       move takvim-anah               to butcegir-tarih
       move acc-4-val                 to butcegir-adi
       move rap-anah1(1:1)            to butcegir-tip-1
       move rap-anah2(1:1)            to butcegir-tip-2
       read butcegir no lock invalid
            display message box "Silinecek Kayit Bulunamadi..." new-line
                                "Lutfen Kontrol Ediniz..."
                            title "[ Uyari ]"
                            icon 1
       not invalid
               move k-kodu-tasi               to butcegir-staf
               move takas5-tut(takvim-gun)    to butcegir-tut
               move takas5-oda(takvim-gun)    to butcegir-oda
               move takas5-pax(takvim-gun)    to butcegir-pax
                   delete butcegir end-delete
       end-read.
*
 gd-2-Ev-Msg-Begin-Entry.
        set event-action to event-action-fail
       move 1008 to key-status
       perform Form2-Ex-Other
          call "w$keybuf" using 1,x"1B" end-call.

 
