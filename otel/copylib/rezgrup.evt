* rezgrup.evt
* rezgrup.evt is generated from F:\asya\acugt.kaya\otel\rezgrup.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform icyetki-kontrol

     call "c$narg" using link-var.
     perform adresleri-tasi.
*     move tus-yetkileri to tus-kodlari.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid continue
     end-read
     close genel.
     open  i-o rez  takvim .
       
     initialize gec-gecme.
     
*
 rezgrup2-olustur.
    
     set environment "V-version"  to 5. 
     open output rezgrup. close rezgrup.
     set environment "V-version"  to 3.   
     
      open i-o rezgrup2
      initialize rez-rec
       move "I" to rez-durumu
       start rez key > rez-grup invalid continue
          not invalid 
            perform until fs-rez ="10" 
                 read rez next no lock 
                    end move "10" to fs-rez
                    not end
                    if rez-durumu not = "I" then
                      move "10" to fs-rez
                      exit perform
                    end-if
                    if rez-grup-adi = spaces
                       exit perform cycle
                    end-if
                    if rez-grup-no > spaces or 0 then
                      initialize rezgrup2-rec                             
                      move rez-grup-no to rezgrup2-kodu
                      read rezgrup2 no lock invalid  
                         move rez-acenta   to rezgrup2-acenta
                         move rez-gir-tar  to rezgrup2-gel-tar
                         move rez-cik-tar  to rezgrup2-git-tar
                         move rez-grup-adi to rezgrup2-adi
                         write rezgrup2-rec invalid 
                               rewrite rezgrup2-rec end-rewrite 
                         end-write                           
                       end-read                                                                   
                    end-if
                  end-read

            end-perform 
      end-start
     close rezgrup2 .
     move rezgrup2-dosya to rezgrup-cagir-dosya
     .

*
 rezgrup-olustur.   
      set environment "V-version"  to 5. 
     open output rezgrup. close rezgrup.
     set environment "V-version"  to 3.   
    
     open i-o rezgrup.
       initialize rez-rec rezgrup-rec 
       
       move "I" to rez-durumu
       move grup-no to rez-grup-no rezgrup-kodu
       start rez key >= rez-grup invalid continue
          not invalid 
            perform until fs-rez ="10" 
                 read rez next no lock 
                    end move "10" to fs-rez
                    not end
                    
                    if rez-durumu not = "I" or
                     grup-no not = rez-grup-no then
                      move "10" to fs-rez
                      exit perform
                    end-if
                         if rezgrup-acenta = spaces then
                           move rez-acenta   to rezgrup-acenta
                           move rez-gir-tar  to rezgrup-gel-tar
                           move rez-cik-tar  to rezgrup-git-tar
                           move rez-grup-adi to rezgrup-adi
                           move rez-not1     to rezgrup-not1
                           move rez-not2     to rezgrup-not2
                         else
                        
                          move rez-acenta   to rezgrup-acenta
                          if rez-not1(1:20) not = rezgrup-not1(1:20)
                                move 1 to rezgrup-not1-fark
                            end-if
                            if rez-not2(1:18) not = rezgrup-not2(1:18)
                                move 1 to rezgrup-not2-fark
                            end-if
                          if rez-gir-tar not = rezgrup-gel-tar
                                move 1 to rezgrup-gel-tar-fark
                            end-if
                            
                          if rez-cik-tar not = rezgrup-git-tar
                                move 1 to rezgrup-git-tar-fark
                            end-if
                          if rez-gir-tar <  rezgrup-gel-tar 
                                move rez-gir-tar  to rezgrup-gel-tar
                          end-if
                          if rez-cik-tar >  rezgrup-git-tar
                                move rez-cik-tar  to rezgrup-git-tar
                          end-if
                           move rez-grup-adi to rezgrup-adi
                       end-if
                     
                        evaluate  rez-buyuk
                          when 1 
                              add 1 to rezgrup-sng-say(rez-oda-konumu)
                              move rezgrup-sng-say(rez-oda-konumu) to rez-sira
                              move rez-no     to  rezgrup-sng-rez-no(rez-oda-konumu,  rez-sira)
                              if rez-fiyati not = rezgrup-sng-fiy(rez-oda-konumu)
                             
                                 if rezgrup-sng-fiy(rez-oda-konumu) > 0 
                                  
                                      move 1 to  rezgrup-sng-fiy-fark(rez-oda-konumu)
                                    
                                 end-if
                                 if rez-fiyati > rezgrup-sng-fiy(rez-oda-konumu)
                                    move rez-fiyati to rezgrup-sng-fiy(rez-oda-konumu)
                                 end-if
                              end-if
                              add rez-fiyati to rezgrup-sng-top-fiyat(rez-oda-konumu)
                          when 2
                              add 1 to rezgrup-dbl-say(rez-oda-konumu)
                              move rezgrup-dbl-say(rez-oda-konumu) to rez-sira
                              move rez-no     to  rezgrup-dbl-rez-no(rez-oda-konumu,  rez-sira)
                              if rez-fiyati not = rezgrup-dbl-fiy(rez-oda-konumu)
                                 if rezgrup-dbl-fiy(rez-oda-konumu) > 0 
                                  
                                      move 1 to  rezgrup-dbl-fiy-fark(rez-oda-konumu)
                                    
                                 end-if
                                 if rez-fiyati > rezgrup-dbl-fiy(rez-oda-konumu)
                                    move rez-fiyati to rezgrup-dbl-fiy(rez-oda-konumu)
                                 end-if
                              end-if
                               add rez-fiyati to rezgrup-dbl-top-fiyat(rez-oda-konumu)
                          when other
                              add 1 to rezgrup-trp-say(rez-oda-konumu)
                              move rezgrup-trp-say(rez-oda-konumu) to rez-sira
                              move rez-no     to  rezgrup-trp-rez-no(rez-oda-konumu,  rez-sira)
                              if rez-fiyati not = rezgrup-trp-fiy(rez-oda-konumu)
                                 if rezgrup-trp-fiy(rez-oda-konumu) > 0 
                                  
                                      move 1 to  rezgrup-trp-fiy-fark(rez-oda-konumu)
                                   
                                 end-if
                                 if rez-fiyati > rezgrup-trp-fiy(rez-oda-konumu)
                                    move rez-fiyati to rezgrup-trp-fiy(rez-oda-konumu)
                                 end-if
                              end-if
                               add rez-fiyati to rezgrup-trp-top-fiyat(rez-oda-konumu)
                        end-evaluate
                        
                  end-read

            end-perform 
      end-start
       write rezgrup-rec invalid display message box "Hata"  end-write
     .
     .
*
  rezgrup-oku.
       perform rezgrup-olustur
       
       initialize rezgrup-rec toplamlar.
       move grup-no    to rezgrup-kodu
       read rezgrup       no lock invalid 
            move 1        to gec-gecme
            initialize xrez-rec grup-adi
            perform rez-parametre-ata
            not invalid 
            move rezgrup-adi     to grup-adi
       display accept-grup-adi

      
       perform varying i from 1 by 1 until i > 40

          if rezgrup-SNG-rez-no(i,1) > 0 then
            move rezgrup-sng-rez-no(i,1) to rez-no 
            read rez no lock invalid
              continue  display "hataaaaaaaaaaaaaaaaaaaaaaaa 1"
              not invalid                
               move rez-rec to xrez-rec
               exit perform  
            end-read
          end-if
          if rezgrup-dbl-rez-no(i,1) > 0 then
            move rezgrup-dbl-rez-no(i,1) to rez-no 
            read rez no lock invalid
              continue  display "hataaaaaaaaaaaaaaaaaaaaaaaa 1"
              not invalid                
               move rez-rec to xrez-rec
               exit perform  
            end-read
          end-if
          if rezgrup-trp-rez-no(i,1) > 0 then
            move rezgrup-trp-rez-no(i,1) to rez-no 
            read rez no lock invalid
              continue  display "hataaaaaaaaaaaaaaaaaaaaaaaa 1"
              not invalid                
               move rez-rec to xrez-rec
               exit perform  
            end-read
          end-if
       end-perform
       move rezgrup-gel-tar to  xrez-gir-tar
       move rezgrup-git-tar to  xrez-cik-tar
       move rezgrup-not1  to xrez-not1
       move rezgrup-not2  to xrez-not2
       



       end-read
       close rezgrup.
       
         modify form1-gd-1 mass-update = 1
         
       perform varying i from 1 by 1 until i > 40
          compute tops-pax = tops-pax + (rezgrup-sng-say(i) * 1 )   
           add  rezgrup-sng-say(i) to tops-oda
           move rezgrup-sng-say(i) to z-say
           modify form1-gd-1(2, i + 1 )
               cell-data = z-say
               hidden-data =  rezgrup-sng-say(i) 
           add  rezgrup-sng-top-fiyat(i) to tops-fiyat
           
           move rezgrup-sng-fiy(i) to z-fiy
           if rezgrup-sng-fiy-fark(i) = 1 then
             move 156 to cell-renk
             else
             move 513 to cell-renk
           end-if
            modify form1-gd-1(3, i + 1 )
               cell-data = z-fiy
               hidden-data =  rezgrup-sng-fiy(i)
               cell-color  =  cell-renk
******************dbl  
         
            compute tops-pax = tops-pax + (rezgrup-dbl-say(i) * 2 )   
           add  rezgrup-dbl-say(i) to tops-oda
           move rezgrup-dbl-say(i) to z-say
           modify form1-gd-1(4, i + 1 )
               cell-data = z-say
               hidden-data =  rezgrup-dbl-say(i) 
           add  rezgrup-dbl-top-fiyat(i) to tops-fiyat
           
           move rezgrup-dbl-fiy(i) to z-fiy
           if rezgrup-dbl-fiy-fark(i) = 1 then
             move 156 to cell-renk
             else
             move 513 to cell-renk
           end-if
            modify form1-gd-1(5, i + 1 )
               cell-data = z-fiy
               hidden-data =  rezgrup-dbl-fiy(i)
               cell-color  =  cell-renk


             

*****************trp
           add  rezgrup-trp-say(i) to tops-oda
           compute tops-pax = tops-pax + (rezgrup-trp-say(i) * 3 )
           move rezgrup-trp-say(i) to z-say
           modify form1-gd-1(6, i + 1 )
               cell-data = z-say
               hidden-data =  rezgrup-trp-say(i) 
             add  rezgrup-trp-top-fiyat(i) to tops-fiyat
           
           move rezgrup-trp-fiy(i) to z-fiy
           if rezgrup-trp-fiy-fark(i) = 1 then
             move 156 to cell-renk
             else
             move 513 to cell-renk
           end-if
            modify form1-gd-1(7, i + 1 )
               cell-data = z-fiy
               hidden-data =  rezgrup-trp-fiy(i)
               cell-color  =  cell-renk

          

       end-perform 
         
         modify form1-gd-1  mass-update = 0 
         
          move tops-oda to top-oda
          move tops-pax to top-pax
         
          move tops-fiyat to top-fiy
         perform okunan-goster
       .
*
 rez-parametre-ata.
*************Parametreden default degerler yukleniyor.........
     move rezpara-banka       to xrez-banka.
     move rezpara-doviz       to xrez-doviz.
     move rezpara-pan-tipi    to xrez-pan-tipi.
     move rezpara-odeme-tipi  to xrez-odeme-tipi.
     move rezpara-ulke        to xrez-ulke.
     move rezpara-anlasma     to xrez-anlasma.
     move rezpara-pazar       to xrez-pazar.
     move rezpara-aygun       to xrez-kur-aygun.
     move calis-yil           to xrez-gir-yil xrez-cik-yil.
     move calis-ay            to xrez-gir-ay  xrez-cik-ay.
     move calis-gun           to xrez-gir-gun xrez-cik-gun.
     move "4" to  xrez-gr-status.
 default-ata.
*************Default Degerler Ataniyor.........
        continue.
 

*
 Form1-Aft-Initdata.
     initialize rez-rec xrez-rec yan-deg. 
     initialize short-var-yok kayit-izni.
      modify form1-gd-1,
            reset-grid = 1 
            mass-update = 1 
    
      initialize form1-gd-1-record  
     move "Kisi/Konum"             to gd-1-col-1
     open input konum 
     initialize kodlar02-rec
     move 1 to i 
     start konum key not < konum-anahtar invalid
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          evaluate konum-anahtar
             when 1  move konum-adi   to gd-1-col-2   
             when 2  move konum-adi   to gd-1-col-3
             when 3  move konum-adi   to gd-1-col-4
             when 4  move konum-adi   to gd-1-col-5
             when 5  move konum-adi   to gd-1-col-6
             when 6  move konum-adi   to gd-1-col-7
             when 7  move konum-adi   to gd-1-col-8
             when 8  move konum-adi   to gd-1-col-9
             when 9  move konum-adi   to gd-1-col-10
             when 10 move konum-adi   to gd-1-col-11
             when 11 move konum-adi   to gd-1-col-12
             when 12 move konum-adi   to gd-1-col-13
             when 13 move konum-adi   to gd-1-col-14
             when 14 move konum-adi   to gd-1-col-15
             when 15 move konum-adi   to gd-1-col-16
             when 16 move konum-adi   to gd-1-col-17
             when 17 move konum-adi   to gd-1-col-18
             when 18 move konum-adi   to gd-1-col-19
             when 19 move konum-adi   to gd-1-col-20
             when 20 move konum-adi   to gd-1-col-21
             when 21 move konum-adi   to gd-1-col-22
             when 22 move konum-adi   to gd-1-col-23
             when 23 move konum-adi   to gd-1-col-24
             when 24 move konum-adi   to gd-1-col-25
             when 25 move konum-adi   to gd-1-col-26
             when 26 move konum-adi   to gd-1-col-27
             when 27 move konum-adi   to gd-1-col-28
             when 28 move konum-adi   to gd-1-col-29
             when 29 move konum-adi   to gd-1-col-30
             when 30 move konum-adi   to gd-1-col-31
             when 31 move konum-adi   to gd-1-col-32
             when 32 move konum-adi   to gd-1-col-33
             when 33 move konum-adi   to gd-1-col-34
             when 34 move konum-adi   to gd-1-col-35
             when 35 move konum-adi   to gd-1-col-36
             when 36 move konum-adi   to gd-1-col-37
             when 37 move konum-adi   to gd-1-col-38
             when 38 move konum-adi   to gd-1-col-39
             when 39 move konum-adi   to gd-1-col-40
             when 40 move konum-adi   to gd-1-col-41
          end-evaluate
        
     end-read
        end-perform
     end-start.
     close konum
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
      initialize form1-gd-1-record  
     move "Sng Oda "             to gd-1-col-1
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
      initialize form1-gd-1-record  
     move "Sng Fiyat"             to gd-1-col-1
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
       initialize form1-gd-1-record  
     move "Dbl oda"             to gd-1-col-1
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
      move "Dbl Fiyat"             to gd-1-col-1
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
      move "Trp Oda"             to gd-1-col-1
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
      move "Trp Fiyat"             to gd-1-col-1
     modify form1-gd-1,
            record-to-add(form1-gd-1-record)
     modify form1-gd-1,
            mass-update = 0 
     perform rez-parametre-ata
     perform default-ata
*************Buttonlar Disable ediliyor.......
    
*************Acceptler Disable ediliyor.......
*************Formu Goster............
       perform gun-bul
       perform form-update
************Degerleri Oku
*            perform acenta-oku   thru acenta-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
            perform firma-oku
            
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            
            initialize gec-gecme.
            move k-kodu-tasi to rez-grup-dosya-kllnc  rezgrup2-dosya-kllnc
             open i-o genelfis.
            move 1 to genelfis-anahtar
          read genelfis no lock invalid
                   move 1 to ekran-fis-1
           end-read
             add 1 to ekran-fis-1
           rewrite genelfis-rec invalid
             write genelfis-rec end-write
             end-rewrite
            close genelfis.
    
           move ekran-fis-1(2:) to rez-grup-dosya-no   rezgrup2-dosya-no
           inspect rez-grup-dosya replacing all spaces by "1"
           inspect rezgrup2-dosya replacing all spaces by "1"
            perform rezgrup2-olustur.
     .
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 okunan-goster.
*************Formu Goster............
           perform gun-bul
           perform form-update
************Degerleri Oku
            perform acenta-oku   thru acenta-oku-exit
            perform banka-oku    thru banka-oku-exit
            perform kaynak1-goster
            perform kaynak2-goster
            perform kaynak3-goster
            perform doviz-oku    thru doviz-oku-exit
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
            perform firma-oku 
          
     .
*
 Aft-Procedure.
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
      initialize gec-gecme.
      evaluate control-id
     
      when 1
         move 0 to y-rez
           if key-status = 52
               exit paragraph
            end-if 
        if grup-no = zeroes
           perform fis-al
           move 1 to y-rez
         

        end-if
           perform rezgrup-oku
      when 1016
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform banka-oku thru banka-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1017
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform doviz-oku thru doviz-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1018
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform pansiyon-oku thru pansiyon-oku-exit
            if gecmez
               exit paragraph
            end-if 
**********>Kontrat kontrolu....Alotment Rezervasyonar icin...
**********>Aksiyon ve stop-sale kontrolu
**********>KONTROLLER-2. 
             
       when 1019
            if key-status = 52
               exit paragraph
            end-if 
          
            initialize gec-gecme
            perform odeme-oku thru odeme-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1020
            if key-status = 52
               exit paragraph
            end-if 
          
            initialize gec-gecme
            perform anlasma-oku thru anlasma-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1021
            if key-status = 52
               exit paragraph
            end-if 
           
            initialize gec-gecme
            perform pazar-oku thru pazar-oku-exit
            if gecmez
               exit paragraph
            end-if 
       when 1022
            if key-status = 52
               exit paragraph
            end-if 
         
            initialize gec-gecme
            perform ulke-oku thru ulke-oku-exit
            if gecmez
               exit paragraph
            end-if 
        
            

    
      
       
      
      end-evaluate.
      .
*
 exception-procedure.
     if link-var= 1 then
       if key-status = 19  then
          move 99999999 to link-rez-no
          set exit-pushed to true
          exit paragraph
       end-if
       if key-status = 15  then
          move 0 to link-rez-no
          set exit-pushed to true
          exit paragraph
       end-if
      end-if
        if key-status =  1 
            evaluate control-id
              when 1 
                 perform rezgrup2-olustur
                 perform rezgrup-ara
              when  22
                    perform firma-ara   
              when  1003
                    perform acenta-ara   thru acenta-ara-exit
              when  1016
                    perform banka-ara    thru banka-ara-exit
              when  1017
                    perform doviz-ara    thru doviz-ara-exit
              when  1018
                    perform pansiyon-ara thru pansiyon-ara-exit
              
              when  1019
                    perform odeme-ara    thru odeme-ara-exit
              when  1020
                    perform anlasma-ara  thru anlasma-ara-exit
              when  1021
                    perform pazar-ara    thru pazar-ara-exit
              when  1022
                    perform ulke-ara     thru ulke-ara-exit
            end-evaluate

     end-if .
      if key-status = 2 or 4
               perform kaydet   thru kaydet-exit end-if
      if key-status = 3
               perform rez-sil   thru rez-sil-exit  end-if .
     

*
 kaydet. 
 kaydet-kontrol. 
        initialize mesaj-degiskenler gec-gecme.
        
           move 0 to y-rez
        move " [ Hata ] " to mmesaj-title
        move "Hata Tipi : [ Zorunlu Alanlarda Bilgi Eksik.......]" to mmesaj-1
        perform acenta-oku   thru acenta-oku-exit
                if gecmez 
                move "Hata Yeri : [ Acenta Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform banka-oku    thru banka-oku-exit
                if gecmez
                move "Hata Yeri : [ Banka  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform doviz-oku    thru doviz-oku-exit
                if gecmez
                move "Hata Yeri : [ Doviz  Kodu Tanimsiz................]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pansiyon-oku thru pansiyon-oku-exit
                if gecmez
                move "Hata Yeri : [ Pansiyon Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform odeme-oku    thru odeme-oku-exit
                if gecmez
                move "Hata Yeri : [ Odeme    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform anlasma-oku  thru anlasma-oku-exit
                if gecmez
                move "Hata Yeri : [ Anlasma  Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform pazar-oku    thru pazar-oku-exit
                if gecmez
                move "Hata Yeri : [ Pazar    Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 
        perform ulke-oku     thru ulke-oku-exit
                if gecmez
                move "Hata Yeri : [ Ulke     Kodu Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-gir-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Giris Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if 

        move xrez-cik-tar to tarih
        perform takvim-oku   thru takvim-oku-exit
                if gecmez
                move "Hata Yeri : [ Cikis Gunu    Tanimsiz..............]" to mmesaj-2
                move 1           to mmesaj-type
                move 3           to mmesaj-icon
                move 1           to mmesaj-default
                perform mmesaj-ver
                go kaydet-exit
                end-if
        if xrez-gir-tar  < tarih-tasi
           move "Hata Tipi : [ Uyumsuz Veri .......]" to mmesaj-1
          move "Hata Yeri : [ Gecmis Tarihe Rezervasyon Girilemez]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
*           go kaydet-exit
         end-if
        if xrez-cik-tar < xrez-gir-tar 
           move "Hata Yeri : [ Cikis Tarihi Kucuk Olamaz...........]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        if xrez-kur-aygun not = "G" and not = "A" 
           move "Hata Yeri : [ Kur Tipi Tanimsiz...................]" to mmesaj-2
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
           go kaydet-exit
        end-if 
        

       



*/ konfirme denetimi 
     

       
       initialize mesaj-degiskenler
       move " [ Kaydet Soru ] " to mmesaj-title
       move " GIRDIGINIZ BILGILER KAYDEDILECEKTIR " to mmesaj-1.
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2. 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go kaydet-exit
       end-if
       
        perform kaydediliyor.
        initialize xrez-rec grup-no grup-adi
         perform rez-parametre-ata
         move 4 to accept-control
         move 1 to  control-id
        perform form-update .





 kaydet-exit. 
     exit. 
*
 fiyatla.
         
          move rez-rec to xrez-rec

           
        initialize linkh-odahes
        move xrez-no to  linkh-rez-no     
         move 4 to linkh-nereden  
         move 1 to linkh-anl-yaz
        

           move  1 to linkh-cast-yaz
         
          call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
         end-call
          
        .
           
*

 kaydediliyor.
      initialize rrez-say
     
      perform varying i from 1 by 1 until i > 40
          
*********************sng      
          inquire form1-gd-1(2,i + 1),
             cell-data in eoda-say 
                move function numval(eoda-say) to oda-say
                           inquire form1-gd-1(3)   record-data in Form1-Gd-1-Record
          inquire form1-gd-1(3,i + 1),
              cell-data in eoda-fiy 
              move function numval(eoda-fiy) to oda-fiy
              move oda-say to k-oda-say
             perform varying ii from 1 by 1 until ii > oda-say
                add 1 to rrez-say
                if rezgrup-sng-rez-no(i,ii) > 0 then 
                    move rezgrup-sng-rez-no(i,ii) to rez-no 
                    read rez no lock invalid
                         stop " "
                       not invalid
                         if rez-folio > 0 then
                           display message box " CIN OLMUS"
                           else

                         perform cast-sil   thru cast-sil-exit 
                         perform acenhrk-sil  thru acenhrk-sil-exit
                         move 0 to hep-at
                         perform deg-at
                         move 1 to rez-buyuk
                          move rez-buyuk to REZ-S-D-T-G
                                if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
                                end-if
                         if rezgrup-sng-fiy-fark(i) not = 1
                            move oda-fiy to rez-fiyati
                         end-if
                        
                         rewrite rez-rec invalid stop " " end-rewrite
                         perform cast-isle   thru cast-isle-exit 
                         perform acenhrk-isle  thru acenhrk-isle-exit 
                          perform fiyatla
                        end-if
                   end-read
                   else 
                       move 1 to gelen-pax
                          move 1 to rez-buyuk
                       perform yeni-rez-olustur
                       move oda-fiy to rez-fiyati
                       move 1 to rez-buyuk
                        move rez-buyuk to REZ-S-D-T-G
                                if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
                                end-if
                       write rez-rec invalid stop " " end-write
                       perform cast-isle   thru cast-isle-exit 
                       perform acenhrk-isle  thru acenhrk-isle-exit 
                       move rez-no to rezgrup-sng-rez-no(i,ii)
                        perform fiyatla
                end-if
                subtract 1 from k-oda-say
                move rez-no to rout-rez-no(rrez-say)
             end-perform
 
              add 1 to oda-say giving oda-says
              perform varying ii from oda-says by 1 until ii > rezgrup-sng-say(i)
                if rezgrup-sng-rez-no(i,ii) > 0 then 
                    move rezgrup-sng-rez-no(i,ii) to rez-no 
                    read rez no lock invalid
                        display message box  "Diger Terminalden Silindi" 
                       not invalid
                      
                         if rez-folio = 0 then 
                                 perform cast-sil   thru cast-sil-exit 
                                 perform acenhrk-sil  thru acenhrk-sil-exit 
                                 delete rez invalid stop " " end-delete
                              else
                             display message box "CIN olmus oda silinemedi" 
                         end-if
                     end-read
                   else 
                      display message box "Beklenemeyen durum 2566E4HH"
                end-if
              end-perform 

*********************dbl      
      
    
          
          inquire form1-gd-1(4, i + 1),
              cell-data in eoda-say 
                move function numval(eoda-say) to oda-say
                move oda-say to k-oda-say
               
             inquire form1-gd-1(5)   record-data in Form1-Gd-1-Record
              
            inquire form1-gd-1(5, i + 1),
              cell-data in eoda-fiy 
              move function numval(eoda-fiy) to oda-fiy
             perform varying ii from 1 by 1 until ii > oda-say
              
                add 1 to rrez-say
                if rezgrup-dbl-rez-no(i,ii) > 0 then 
 
                    move rezgrup-dbl-rez-no(i,ii) to rez-no 
                    read rez no lock invalid
                         stop " "
                       not invalid
                         if rez-folio > 0 then
                           display message box " CIN OLMUS"
                           else

                         perform cast-sil   thru cast-sil-exit 
                         perform acenhrk-sil  thru acenhrk-sil-exit
                         move 0 to hep-at
                         perform deg-at
                         move 2 to rez-buyuk
                          move rez-buyuk to REZ-S-D-T-G
                                if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
                                end-if
                                
                         if rezgrup-dbl-fiy-fark(i) not = 1
                            move oda-fiy to rez-fiyati
                         end-if
                         rewrite rez-rec invalid stop " " end-rewrite
                         perform cast-isle   thru cast-isle-exit 
                         perform acenhrk-isle  thru acenhrk-isle-exit 
                          perform fiyatla
                        end-if
                   end-read
                   else 
                       move 2 to gelen-pax
                       move 2 to rez-buyuk
                       perform yeni-rez-olustur
                       move oda-fiy to rez-fiyati
                       move 2 to rez-buyuk
                        move rez-buyuk to REZ-S-D-T-G
                                if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
                                end-if
                       write rez-rec invalid stop " " end-write
                          perform cast-isle   thru cast-isle-exit 
                       perform acenhrk-isle  thru acenhrk-isle-exit 
                       move rez-no to rezgrup-dbl-rez-no(i,ii)
                        perform fiyatla
                end-if
                subtract 1 from k-oda-say
                move rez-no to rout-rez-no(rrez-say)
            end-perform 

              add 1 to oda-say giving oda-says
              perform varying ii from oda-says by 1 until ii > rezgrup-dbl-say(i)
                if rezgrup-dbl-rez-no(i,ii) > 0 then 
                    move rezgrup-dbl-rez-no(i,ii) to rez-no 
                    read rez no lock invalid
                         display message box  "Diger Terminalden Silindi" 
                       not invalid
                         if rez-folio = 0 then 
                                 perform cast-sil   thru cast-sil-exit 
                                 perform acenhrk-sil  thru acenhrk-sil-exit 
                                 delete rez invalid stop " " end-delete
                                  else

                             display message box "CIN olmus oda silinemedi" 
                         end-if
                     end-read
                   else 
                      display message box "Beklenmeyen durum 2566E4HH"
                end-if
              end-perform 

*********************trp    
      
      
      
          inquire form1-gd-1(6,i + 1),
               cell-data in eoda-say 
                move function numval(eoda-say) to oda-say
                    move oda-say to k-oda-say
                      inquire form1-gd-1(7)   record-data in Form1-Gd-1-Record
          inquire form1-gd-1(7,i + 1),
             
               cell-data in eoda-fiy 
              move function numval(eoda-fiy) to oda-fiy
             perform varying ii from 1 by 1 until ii > oda-say
                add 1 to rrez-say
                if rezgrup-trp-rez-no(i,ii) > 0 then 
 
                    move rezgrup-trp-rez-no(i,ii) to rez-no 
                    read rez no lock invalid
                        display message box  "Diger Terminalden Silindi" 
                       not invalid
                         if rez-folio > 0 then
                           display message box " CIN OLMUS"
                           else

                         perform cast-sil   thru cast-sil-exit 
                         perform acenhrk-sil  thru acenhrk-sil-exit
                         move 0 to hep-at
                         perform deg-at
                         move 3 to rez-buyuk
                          move rez-buyuk to REZ-S-D-T-G
                                if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
                                end-if
                         if rezgrup-trp-fiy-fark(i) not = 1
                            move oda-fiy to rez-fiyati
                         end-if
                         rewrite rez-rec invalid stop " " end-rewrite
                         perform cast-isle   thru cast-isle-exit 
                         perform acenhrk-isle  thru acenhrk-isle-exit 
                          perform fiyatla
                         end-if
                   end-read
                   else 
                       move 3 to gelen-pax
                        move 3 to rez-buyuk
                       perform yeni-rez-olustur
                       move oda-fiy to rez-fiyati
                       move 3 to rez-buyuk
                        move rez-buyuk to REZ-S-D-T-G
                                if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
                                end-if
                       write rez-rec invalid stop " " end-write
                          perform cast-isle   thru cast-isle-exit 
                       perform acenhrk-isle  thru acenhrk-isle-exit 
                       move rez-no to rezgrup-trp-rez-no(i,ii)
                        perform fiyatla
                end-if
                subtract 1 from k-oda-say
                move rez-no to rout-rez-no(rrez-say)

            end-perform 
              add 1 to oda-say giving oda-says
              perform varying ii from oda-says by 1 until ii > rezgrup-trp-say(i)
                if rezgrup-trp-rez-no(i,ii) > 0 then 
                    move rezgrup-trp-rez-no(i,ii) to rez-no 
                    read rez no lock invalid
                         stop " "
                       not invalid
                              
                         if rez-folio = 0 then 
                                 perform cast-sil   thru cast-sil-exit 
                                 perform acenhrk-sil  thru acenhrk-sil-exit 
                                 delete rez invalid stop " " end-delete
                                 else
                             display message box "CIN olmus oda silinemedi" 
                         end-if
                     end-read
                   else 
                      display message box "Beklenemeyen durum 2566E4HH"
                end-if
              end-perform 
            
      end-perform

          



      if key-status = 4 then 
         string  grup-no delimited by size
                 grup-adi delimited by "   "
                     into rout-text
                     move xrez-gir-tar to routsec-gir-tar
                  call "/asya/ytl/obj/otel/routsec.asy" 
                       using link-rout
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/routsec.asy"
                  end-call

      end-if.
*
 deg-at.
      move grup-no to rez-grup-no
      move grup-adi to rez-grup-adi
      move "I" to rez-durumu 
      if rezgrup-gel-tar-fark  not = 1 or  hep-at = 1
         move xrez-gir-tar     to rez-gir-tar
      end-if
       if rezgrup-git-tar-fark  not = 1 or hep-at = 1
         move xrez-cik-tar     to rez-cik-tar
      end-if
      if rezgrup-not1-fark  not = 1 or hep-at = 1
         move xrez-not1   to rez-not1
      end-if
      if rezgrup-not2-fark  not = 1 or  hep-at = 1
         move xrez-not2   to rez-not2
      end-if
      move "E" to REZ-FIYAT-FIX
      move gelen-pax        to rez-buyuk
       move rez-buyuk to REZ-S-D-T-G
       if rez-buyuk > 4 then 
          move 4 to rez-s-d-t-g 
       end-if
      move xrez-acenta      to rez-acenta
      move xrez-firma       to rez-firma
      move xREZ-BANKA       to REZ-BANKA        
      move xREZ-DOVIZ       to REZ-DOVIZ        
      move xREZ-ANLASMA     to REZ-ANLASMA      
      move xREZ-ODEME-TIPI  to REZ-ODEME-TIPI   
      move xREZ-PAN-TIPI    to REZ-PAN-TIPI     
      move xREZ-ULKE        to REZ-ULKE      
      move xrez-pazar       to rez-pazar 
      move xrez-kaynak-1    to rez-kaynak-1
      move xrez-kaynak-2    to rez-kaynak-2
      move xrez-kaynak-3    to rez-kaynak-3
     
      move xrez-gr-status  to rez-gr-status

     

      .
 yeni-rez-olustur.
       open i-o genelfis
             move 1 to genelfis-anahtar
             read genelfis no lock invalid  
                 continue
              not invalid
                  add 1 to  rez-oto
                  rewrite genelfis-rec invalid continue end-rewrite
              end-read
             close genelfis
         initialize rez-rec
         
         move rez-oto to rez-no 
         move 1  to  REZ-TIPI       
         move grup-adi to rez-adi
        move rez-buyuk to REZ-S-D-T-G
        if rez-buyuk > 4 then move 4 to rez-s-d-t-g 
        end-if
                               
         move "G" to  REZ-KUR-AYGUN      
         move "K" to  REZ-K-G-B   
         move i to rez-oda-konumu rez-fiyat-konumu
          if rez-para-isl-sistemden = 1 then
             move tarih-tasi to sys-tar
             else
           accept sys-tar from century-date 
          end-if
            move sys-yil to rez-isl-yil
            move sys-ay  to rez-isl-ay 
            move sys-gun to rez-isl-gun
         move 1 to hep-at
         perform deg-at
         


         
     .
 rez-sil. 
       initialize mesaj-degiskenler
       move " [ Sil Soru ] " to mmesaj-title
       move " BU Grup SILINECEKTIR ......  " to mmesaj-1
       
       move " EMIN MISINIZ.....E->Evet, H->Hayir  " to mmesaj-2 
       move 2           to mmesaj-type
       move 1           to mmesaj-icon
       move 2           to mmesaj-default
       perform mmesaj-ver
       if donus-kodu = 2 
          go rez-sil-exit
       end-if
       perform varying i from 1 by 1 until i > 40
            perform varying ii from 1 by 1 until ii > rezgrup-sng-say(i)
                if rezgrup-sng-rez-no(i,ii) > 0 then
                    move rezgrup-sng-rez-no(i,ii) to rez-no 
                      perform tek-rez-sil
                 end-if
            end-perform
            perform varying ii from 1 by 1 until ii > rezgrup-dbl-say(i)
                if rezgrup-dbl-rez-no(i,ii) > 0 then
                    move rezgrup-dbl-rez-no(i,ii) to rez-no 
                      perform tek-rez-sil
                 end-if
            end-perform
            perform varying ii from 1 by 1 until ii > rezgrup-trp-say(i)
                if rezgrup-trp-rez-no(i,ii) > 0 then
                    move rezgrup-trp-rez-no(i,ii) to rez-no 
                      perform tek-rez-sil
                 end-if
            end-perform
     end-perform.
     initialize rezgrup-rec xrez-rec grup-no grup-adi
      perform form-update
      move 4    to accept-control
      move 1002 to control-id.
 rez-sil-exit. 
     exit. 
*
 tek-rez-sil.
      read rez no lock invalid
            continue
            not invalid
            if rez-c-in  = "E" or rez-folio > 0
                  display message box rez-no rez-odano " CIN OLMUS" 
                else
                 if rez-para-isl-sistemden = 1 then
                     move tarih-tasi to rez-isl-tar
                    else
                   accept sys-tar from century-date 
                      move sys-yil to rez-isl-yil
                      move sys-ay  to rez-isl-ay 
                      move sys-gun to rez-isl-gun 
                  end-if
                 move k-kodu-tasi   to rez-staf 
                 perform cast-sil   thru cast-sil-exit 
                 perform acenhrk-sil  thru acenhrk-sil-exit 
                 move "S" to rez-durumu 
                 rewrite rez-rec invalid 
                       initialize mesaj-degiskenler
                       move " [ Hata ] " to mmesaj-title
                       move " BU REZERVASYON SILINEMEDI.........  " to mmesaj-1
                       move " KONTROL EDINIZ....................  " to mmesaj-2 
                       move 1           to mmesaj-type
                       move 3           to mmesaj-icon
                       move 1           to mmesaj-default
                       perform mmesaj-ver
                       
                       
               end-rewrite
             end-if
     end-read.
     
 cast-isle. 
          
           open i-o cast. 
        move rez-gir-tar to takvim-anah. 
        start takvim key not < takvim-anah invalid 
              go cast-isle-bitti. 
 cast-yaz-oku. 
        read takvim next no lock end go cast-isle-bitti. 
        if fs-takvim = 99 go cast-yaz-oku. 
        if takvim-anah > rez-cik-tar go cast-isle-bitti. 
                initialize cast-rec. 
           

           move takvim-anah       to cast-tarih. 
           move rez-no           to cast-rez-no. 
           move rez-odano        to cast-oda-no. 
           move rez-buyuk        to cast-buyuk
           move rez-kucuk        to cast-kucuk


           move rez-fiyati to cast-anlasma-fiyati cast-fiyati
           move rez-bebek        to cast-bebek
           move rez-free         to cast-free 
           
          
         
           move rez-oda-konumu   to cast-oda-konumu
           move rez-fiyat-konumu to cast-fiyat-konumu
           move rez-anlasma      to cast-anlasma
           move rez-pan-tipi     to cast-pan-tipi

*           move xrez-xxx          to cast-oda-adet 
*           move xrez-xxx          to cast-kisi-konaklama
        write cast-rec invalid 
              rewrite cast-rec invalid continue
              end-rewrite
        end-write.
           perform log-operation-cast
            go cast-yaz-oku. 
 cast-isle-bitti. 
            close cast .
            
 cast-isle-exit. 
     exit. 
 cast-sil. 
           open i-o cast. 
         initialize cast-rec. 
        move rez-no          to cast-rez-no. 
        start cast key not < cast-anah1 invalid  
              go cast-sil-bitti. 
 cast-sil-oku. 
        read cast  next no lock end go cast-sil-bitti. 
        if fs-cast = 99 go cast-sil-oku. 
        if cast-rez-no > rez-no go cast-sil-bitti. 
        if cast-rez-no = rez-no continue
        else 
           go cast-sil-oku
        end-if.
        delete cast invalid 
           continue.
        perform log-operation-cast
            go cast-sil-oku. 
 cast-sil-bitti. 
         close cast. 
 cast-sil-exit. 
     exit. 
 
 acenhrk-isle. 
********if xrez-tipi = 1 continue else go acenhrk-isle-exit. 
        if rez-k-g-b = "K" continue
        else 
           go acenhrk-isle-exit
        end-if. 
        open i-o acenhrk bilbord. 
 acenhrk-basla. 
         move rez-gir-tar to takvim-anah. 
         start takvim key not < takvim-anah invalid 
               go acenhrk-isle-bitti. 
 acenhrk-oku-yaz. 
         read takvim next no lock end 
              go acenhrk-isle-bitti. 
         if fs-takvim = 99 go acenhrk-oku-yaz. 
         if takvim-anah = rez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
         if takvim-anah > rez-cik-tar 
            go acenhrk-isle-bitti
         end-if. 
********>Bilbord rezervasyona yazsin..
         
********>Bilbord rezervasyona yazsin..
         if fark-yok 
            go acenhrk-oku-yaz
         end-if
          move rez-acenta to acenhrk-acenta
*****          move xrez-acenta      to acenhrk-acenta. 
          move takvim-anah      to acenhrk-tarih. 
          move rez-fiyat-konumu  to acenhrk-oda-konumu. 
          move rez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
              invalid  
                  initialize acenhrk-rec  
                     move rez-acenta to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move rez-fiyat-konumu  to acenhrk-oda-konumu  
                  move rez-s-d-t-g     to acenhrk-s-d-t-g
                  move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
         end-write 
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  rewrite acenhrk-rec invalid continue end-rewrite  
         end-read  
           move rez-acenta to acenhrk-acenta

****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41 to acenhrk-oda-konumu  
          move rez-s-d-t-g     to acenhrk-s-d-t-g  
         read acenhrk no lock 
           invalid  
                  initialize acenhrk-rec 
                    move rez-acenta to acenhrk-acenta
****                 move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move rez-s-d-t-g     to acenhrk-s-d-t-g  
                   move    99999   to acenhrk-kontrat-oda
                  
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write  
           not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
           move rez-acenta to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move rez-fiyat-konumu  to acenhrk-oda-konumu  
          move 5     to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid 
                  initialize acenhrk-rec 
                   move rez-acenta to acenhrk-acenta 
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move rez-fiyat-konumu  to acenhrk-oda-konumu  
                  move 5     to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  write acenhrk-rec invalid 
                        rewrite acenhrk-rec invalid continue
                        end-rewrite
                  end-write 
         not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  rewrite acenhrk-rec invalid continue  
                  end-rewrite
         end-read
            move rez-acenta to acenhrk-acenta
****          move xrez-acenta      to acenhrk-acenta  
          move takvim-anah      to acenhrk-tarih  
          move 41  to acenhrk-oda-konumu  
          move 5    to acenhrk-s-d-t-g  
         read acenhrk no lock 
          invalid
                  initialize acenhrk-rec  
                    move rez-acenta to acenhrk-acenta
*****                  move xrez-acenta      to acenhrk-acenta  
                  move takvim-anah      to acenhrk-tarih  
                  move 41  to acenhrk-oda-konumu  
                  move 5   to acenhrk-s-d-t-g  
                  move    99999   to acenhrk-kontrat-oda
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  write acenhrk-rec invalid 
                       rewrite acenhrk-rec invalid continue
                       end-rewrite
                  end-write
          not invalid 
                  compute  acenhrk-sat-oda   = acenhrk-sat-oda   + 1  
                  compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk + rez-buyuk  
                  compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk + rez-kucuk  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-free  
                  compute  acenhrk-sat-free  = acenhrk-sat-free  + rez-bebek  
                  rewrite acenhrk-rec invalid continue
                  end-rewrite
         end-read
         go acenhrk-oku-yaz. 
 acenhrk-isle-bitti. 
        close acenhrk bilbord.
 acenhrk-isle-exit. 
      exit. 

*
 acenhrk-sil. 
********if srez-tipi = continue else go acenhrk-sil-exit. 
        if rez-k-g-b = "K" continue
        else 
           go acenhrk-sil-exit
        end-if. 
        open i-o acenhrk bilbord. 
 acenhrk-s-basla. 
           move rez-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
                 go acenhrk-sil-bitti. 
 acenhrk-oku-sil. 
        read takvim next no lock end 
             go acenhrk-sil-bitti. 
        if fs-takvim = 99 go acenhrk-oku-sil. 
        if takvim-anah = rez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
        if takvim-anah > rez-cik-tar 
           go acenhrk-sil-bitti
        end-if. 
********>Bilbord rezervasyona yazsin..
        
********>Bilbord rezervasyona yazsin..
         
            move rez-acenta to acenhrk-acenta
*****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move rez-fiyat-konumu  to acenhrk-oda-konumu. 
           move rez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
           not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
           rewrite acenhrk-rec invalid continue end-rewrite
           end-read
             move rez-acenta  to acenhrk-acenta
****           move srez-acenta      to acenhrk-acenta. 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move rez-s-d-t-g     to acenhrk-s-d-t-g. 
          read acenhrk invalid continue
            not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
***           move srez-acenta      to acenhrk-acenta. 
             move rez-acenta to acenhrk-acenta
           move takvim-anah      to acenhrk-tarih. 
           move rez-fiyat-konumu  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
          not invalid
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek
         rewrite acenhrk-rec invalid continue end-rewrite
         end-read
           move rez-acenta to acenhrk-acenta
*****         move srez-acenta      to acenhrk-acenta 
           move takvim-anah      to acenhrk-tarih. 
           move 41  to acenhrk-oda-konumu. 
           move 5     to acenhrk-s-d-t-g. 
          read acenhrk no lock invalid continue 
           not invalid  
          compute  acenhrk-sat-oda   = acenhrk-sat-oda   - 1 
          compute  acenhrk-sat-buyuk = acenhrk-sat-buyuk - rez-buyuk 
          compute  acenhrk-sat-kucuk = acenhrk-sat-kucuk - rez-kucuk 
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-free
          compute  acenhrk-sat-free  = acenhrk-sat-free  - rez-bebek

            rewrite acenhrk-rec invalid continue end-rewrite
          end-read
          go acenhrk-oku-sil. 
 acenhrk-sil-bitti. 
          close acenhrk bilbord. 
 acenhrk-sil-exit. 
        exit. 
 

************=======>  Bu Bolum Yazma-Silme Islemleri Icindir <====*********** 
 kalis-bul. 
 kalis-start. 
      initialize takvim-rec kalis-kontrol. 
      move rez-gir-tar   to takvim-anah. 
      start takvim key > takvim-anah invalid 
            go kalis-bul-bitti. 
 kalis-oku. 
      read takvim next no lock end go kalis-bul-bitti. 
      add 1 to kalis-kontrol. 
      if kalis-kontrol > kalis-gun go kalis-bul-bitti. 
      if kalis-kontrol = kalis-gun go kalis-bul-bitti. 
         go kalis-oku. 
 kalis-bul-bitti. 
       if kalis-kontrol not = kalis-gun 
          initialize mesaj-degiskenler
          move " [ Gun Yanlis ] " to mmesaj-title
          move "Kalis Gunu Kadar Tanimli Tarih Yok.." to mmesaj-1 
          move "Seciminizi Kontrol Ediniz.....!!!!!!" to mmesaj-2 
          move 1           to mmesaj-type
          move 3           to mmesaj-icon
          move 1           to mmesaj-default
               perform mmesaj-ver
       end-if.
          move takvim-anah   to rez-cik-tar. 
          display accept-cik-gun
          display accept-cik-ay
          display accept-cik-yil.
 kalis-bul-exit. 
      exit. 
*
 firma-ara.
      initialize firma-cagir.
      call "/asya/ytl/obj/otel/firmara.asy" using firma-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/firmara.asy" 
       end-call.
       move firma-cagir     to xrez-firma.
       display accept-sirket
       perform firma-oku.
*
 acenta-ara.
      initialize acenta-cagir.
      call "/asya/ytl/obj/otel/acenara.asy" using acenta-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/acenara.asy" 
       end-call.
       move acenta-cagir     to xrez-acenta.
*

*
 acenta-oku.
       open input acenta.
       initialize acenta-rec.
       move xrez-acenta   to acenta-kodu
       read acenta        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            perform acen-dft-oku
            
       end-read
       close acenta.
       move acenta-adi     to adi-goster.
      
       modify lb-acenta-e, title = adi-goster.
       initialize adi-goster
       display accept-acenta.
             if y-rez = 1 then
               perform acen-dft-yukle
            end-if   .

 acenta-oku-exit.
       exit.
 acenta-ara-exit.
       exit.

*
*
 firma-oku.
       open input firma.
       initialize firma-rec.
       move xrez-firma   to firma-kodu
       read firma        no lock invalid 
            move 1        to gec-gecme
            not invalid 
            perform firma-dft-oku
       end-read
        
       
       close firma.
       move firma-adi     to sirket-goster.
       
       
       display accept-sirket lb-sirket.
        if y-rez = 1 then
               perform acen-dft-yukle
            end-if   .



*
 takvim-oku.
       initialize takvim-rec.
       move tarih         to takvim-anah 
       read takvim        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read.
 takvim-oku-exit.
       exit.


*
*
 rezgrup-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/rezgara.asy" using rezg-cagir  rezgrup-cagir-dosya
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/rezgara.asy" 
       end-call.
       move rezg-cagir     to grup-no.
       display accept-grup-kodu.






*
 banka-ara.
      initialize banka-cagir.
      call "/asya/ytl/obj/otel/bankaara.asy" using banka-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/bankaara.asy" 
       end-call.
       move banka-cagir     to xrez-banka.
 banka-oku.
       
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-banka-sabit = 1 and 
          acen-dft-banka not = xrez-banka
          display message box "Acenta icin sabit banka degeri girilmis" new-line
                              "Banka varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-banka to xrez-banka
        end-if.
       open input banka.
       initialize banka-rec.
       move xrez-banka    to banka-kodu
       read banka        no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close banka.
       move banka-adi     to adi-goster.
       modify lb-banka-e, title = adi-goster.
       initialize adi-goster
       display accept-banka.
 banka-oku-exit.
       exit.
 banka-ara-exit.
       exit.
*
 doviz-ara.
      initialize doviz-cagir.
      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call.
       move doviz-cagir     to xrez-doviz.
 doviz-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-doviz-sabit = 1 and 
          acen-dft-doviz not = xrez-doviz
          display message box "Acenta icin sabit doviz degeri girilmis " new-line
                              "Doviz varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-doviz to xrez-doviz
        end-if.
 
 
       open input doviz.
       initialize doviz-rec.
       move xrez-doviz    to doviz-kodu
       read doviz         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close doviz.
       move d-adi-1       to adi-goster.
       modify lb-doviz-e, title = adi-goster.
       initialize adi-goster
       display accept-doviz.
 doviz-oku-exit.
       exit.
 doviz-ara-exit.
       exit.

*
 pansiyon-ara.
      initialize pansiyon-cagir.
      move "A" to pansiyon-tipi-cagir.
      call "/asya/ytl/obj/otel/panara.asy" using pansiyon-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/panara.asy" 
       end-call.
       move pansiyon-kodu-cagir     to xrez-pan-tipi.
 pansiyon-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pansiyon-sabit = 1 and 
          acen-dft-pan-tipi not = xrez-pan-tipi
          display message box "Acenta icin sabit pansiyon degeri girilmis" new-line
                              "Pansiyon varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pan-tipi to xrez-pan-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "A"              to kodlar02-tipi.
       move xrez-pan-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pansiyon-e, title = adi-goster.
       initialize adi-goster
       display accept-pansiyon.
 pansiyon-oku-exit.
       exit.
 pansiyon-ara-exit.
       exit.
*
 odeme-ara.
      initialize odeme-cagir.
      move "B"   to odeme-tipi-cagir.
      call "/asya/ytl/obj/otel/odemeara.asy" using odeme-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odemeara.asy" 
       end-call.
       move odeme-kodu-cagir     to xrez-odeme-tipi.
 odeme-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-odeme-sabit = 1 and 
          acen-dft-odeme-tipi not = xrez-odeme-tipi
          display message box "Acenta icin sabit odeme degeri girilmis" new-line
                              "odeme varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-odeme-tipi to xrez-odeme-tipi
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "B"                to kodlar02-tipi.
       move xrez-odeme-tipi    to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-odeme-e, title = adi-goster.
       initialize adi-goster
       display accept-odeme.
 odeme-oku-exit.
       exit.
 odeme-ara-exit.
       exit.
*
 anlasma-ara.
      initialize infox-cagir.
      move "D"   to infox-tipi-cagir.
      call "/asya/ytl/obj/otel/infoxara.asy" using infox-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/infoxara.asy" 
       end-call.
       move infox-kodu-cagir     to xrez-anlasma.
 anlasma-oku.
       if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-anlasma-sabit = 1 and 
          acen-dft-anlasma not = xrez-anlasma
          display message box "Acenta icin sabit anlasma degeri girilmis" new-line
                              "Anlasma varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-anlasma to xrez-anlasma
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "D"                to kodlar02-tipi.
       move xrez-anlasma       to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-anlasma-e, title = adi-goster.
       initialize adi-goster
       display accept-anlasma.
 anlasma-oku-exit.
       exit.
 anlasma-ara-exit.
       exit.
*
 pazar-ara.
      initialize pazar-cagir.
      move "E"   to pazar-tipi-cagir.
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/pazarara.asy" 
       end-call.
       move pazar-kodu-cagir     to xrez-pazar.
 pazar-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-pazar-sabit = 1 and 
          acen-dft-pazar not = xrez-pazar
          display message box "Acenta icin sabit pazar degeri girilmis" new-line
                              "Pazar varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-pazar to xrez-pazar
        end-if.
       open input kodlar02.
       initialize kodlar02-rec.
       move "E"                to kodlar02-tipi.
       move xrez-pazar         to kodlar02-kodu
       read kodlar02         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close kodlar02.
       move kodlar02-adi       to adi-goster.
       modify lb-pazar-e, title = adi-goster.
       initialize adi-goster
       display accept-pazar.
 pazar-oku-exit.
       exit.
 pazar-ara-exit.
       exit.
*
 ulke-ara.
      initialize ulke-cagir.
      call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/ulkeara.asy" 
       end-call.
       move ulke-cagir     to xrez-ulke.
 ulke-oku.
          if xrez-acenta = not-dos-anah(8:4) and
          acen-dft-ulke-sabit = 1 and 
          acen-dft-ulke not = xrez-ulke 
          display message box "Acenta icin sabit ULKE  degeri girilmis" new-line
                              "ULKE  varsayilan degerine degistirildi"
                              title "Bilginize"
           move acen-dft-ulke  to xrez-ulke 
        end-if.
       open input ulke.
       initialize ulke-rec.
       move xrez-ulke    to ulke-anah1
       read ulke         no lock invalid 
            move 1        to gec-gecme
            not invalid continue 
       end-read
       close ulke.
       move ulke-adi     to adi-goster.
       modify lb-ulke-e, title = adi-goster.
       initialize adi-goster
       display accept-ulke.
 ulke-oku-exit.
       exit.
 ulke-ara-exit.
       exit.

*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form1-Aft-Routine.
     close rez takvim .
     .
*
 gun-bul.
     initialize gun-s
     move rez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= rez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      
                      end-if 
                end-read
             end-perform  
     end-start.
     move gun-s to gun-say
*     display la-gun
      .

     .
*******************************************************************
************ mesaj receiving olayi *******************************
 form-update.
        if  rezgrup-gel-tar-fark  = 1 then
          move 156 to cell-renk
            modify  accept-gir-gun   color =   cell-renk    no-tab
            modify  accept-gir-ay    color =   cell-renk      no-tab
            modify  accept-gir-yil   color =   cell-renk      no-tab
          else
            move 513 to cell-renk
              modify  accept-gir-gun   color =   cell-renk    use-tab
              modify  accept-gir-ay    color =   cell-renk    use-tab
              modify  accept-gir-yil   color =   cell-renk    use-tab
      end-if
        
      
       if  rezgrup-git-tar-fark  = 1 then
          move 156 to cell-renk
           modify  accept-cik-gun   color =   cell-renk  no-tab  
          modify  accept-cik-ay    color =   cell-renk   no-tab
          modify  accept-cik-yil   color =   cell-renk   no-tab
          else
          move 513 to cell-renk
          modify  accept-cik-gun   color =   cell-renk  use-tab
          modify  accept-cik-ay    color =   cell-renk  use-tab
          modify  accept-cik-yil   color =   cell-renk  use-tab
      end-if
          
       if  rezgrup-not1-fark  = 1 then
          move 156 to cell-renk
            modify  accept-not1   color =   cell-renk no-tab
          else
          move 513 to cell-renk
             modify  accept-not1   color =   cell-renk use-tab
      end-if  
       
      if  rezgrup-not2-fark  = 1 then
          move 156 to cell-renk
              modify  accept-not2   color =   cell-renk no-tab
          else
          move 513 to cell-renk
          modify  accept-not2   color =   cell-renk use-tab
      end-if  
        
        display
            accept-grup-adi
            accept-grup-kodu
            grst-acc
            accept-acenta 
            accept-gir-gun 
            accept-gir-ay 
            accept-gir-yil 
            accept-gir-saat 
            accept-gir-dakika 
            accept-cik-gun 
            accept-cik-ay 
            accept-sirket
            accept-cik-yil 
            accept-cik-saat 
            accept-cik-dakika 
            accept-banka 
            accept-doviz 
            accept-anlasma
            accept-pansiyon 
            accept-odeme 
            accept-pazar 
            accept-ulke 
            accept-not1
            accept-not2
            acc-top-fiy 
            acc-top-pax 
           
            acc-top-oda, 
           
       
       .
*
*
 firma-dft-oku.
      open input nt
     initialize not-rec 
     move "FIR" to not-dos
     move "Default" to not-dos-anah.
     move firma-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-oku.
      open input nt
     initialize not-rec 
     move "ACE" to not-dos
     move "Default" to not-dos-anah.
     move acenta-kodu to not-dos-anah(8:)
     read nt no lock 
        invalid
           initialize acen-dft
           move  rezpara-banka      to acen-dft-banka
           move  rezpara-doviz      to acen-dft-doviz
           move  rezpara-pan-tipi   to acen-dft-pan-tipi
           move  rezpara-odeme-tipi to acen-dft-odeme-tipi
           move  rezpara-anlasma    to acen-dft-anlasma
           move  rezpara-ulke       to acen-dft-ulke
           move  rezpara-pazar      to acen-dft-pazar
        not invalid 
          move not1 to acen-dft
     end-read
     close nt.
*
 acen-dft-yukle.
       move   acen-dft-banka         to xrez-banka
       move   acen-dft-doviz         to xrez-doviz
       move   acen-dft-pan-tipi      to xrez-pan-tipi
       move   acen-dft-odeme-tipi    to xrez-odeme-tipi
       move   acen-dft-anlasma       to xrez-anlasma
       move   acen-dft-ulke          to xrez-ulke
       move   acen-dft-pazar         to xrez-pazar
      

     
         display accept-banka     accept-doviz     accept-pansiyon
                 accept-odeme     accept-anlasma   accept-pazar
                 accept-ulke     
            perform banka-oku    thru banka-oku-exit
            perform doviz-oku    thru doviz-oku-exit
         
            perform pansiyon-oku thru pansiyon-oku-exit
            perform odeme-oku    thru odeme-oku-exit
            perform anlasma-oku  thru anlasma-oku-exit
            perform pazar-oku    thru pazar-oku-exit
            perform ulke-oku     thru ulke-oku-exit
      .

*

     .
*

     .
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 Form1-Gd-1-Ev-Other.
     evaluate event-type
         
             
         when msg-begin-entry
              inquire form1-gd-1,
                      y in ii
                      x in i
              inquire form1-gd-1(ii,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
              if i > 1 then 
              evaluate ii
                  when 2 
                    move  eski-deger to eski-oda

                  when 4 
                    move  eski-deger to eski-oda
                  when 6
                    move  eski-deger to eski-oda
               
                  when 3 
                    move eski-deger to eski-fiyat
                    move 0 to rezgrup-sng-fiy-fark(i - 1)

                  when 5 
                    move eski-deger to eski-fiyat
                     move 0 to rezgrup-dbl-fiy-fark(i - 1)
                  when 7
                     move eski-deger to eski-fiyat
                      move 0 to rezgrup-dbl-fiy-fark(i - 1)
              end-evaluate
              end-if
              modify form1-gd-1(ii,i) cell-color = 513
              if i > 0 and i < 21
                 
                    continue
               
              else
                 move event-action-fail to event-action
              end-if
         when msg-finish-entry
              inquire form1-gd-1(ii,i),
                      cell-data in yeni-deger
                      
               evaluate ii
                  when 2 when 4 when 6
                   move    yeni-deger to z-say
                   move    function numval(z-say) to s-say
                   modify  form1-gd-1(ii,i) cell-data = z-say hidden-data = s-say
                  when 3 when 5 when  7
                  
                   move    yeni-deger to z-fiy
                   move    function numval(z-fiy) to s-fiy
                   modify  form1-gd-1(ii,i) cell-data = z-fiy hidden-data = s-fiy
                  
              end-evaluate
              perform yhesap
     end-evaluate.



*
 yhesap.
     evaluate ii
         when 2 
          compute tops-oda = tops-oda - eski-oda  + s-say
          compute tops-pax = tops-pax - eski-oda  + s-say
          inquire form1-gd-1(3,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
            compute rezgrup-sng-top-fiyat(i - 1) = eski-deger * s-say

         when 3
         
          inquire form1-gd-1(2,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
            compute rezgrup-sng-top-fiyat(i - 1) = eski-deger * s-fiy
        when 4 
          compute tops-oda = tops-oda - eski-oda  + s-say
          compute tops-pax = tops-pax + (( - eski-oda  + s-say ) * 2 )
          inquire form1-gd-1(5,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
            compute rezgrup-dbl-top-fiyat(i - 1 ) = eski-deger * s-say

         when 5
         
          inquire form1-gd-1(4,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
            compute rezgrup-dbl-top-fiyat(i - 1) = eski-deger * s-fiy

         when 6 
          compute tops-oda = tops-oda - eski-oda  + s-say
          compute tops-pax = tops-pax + (( - eski-oda  + s-say ) * 3 )
          inquire form1-gd-1(7,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
            compute rezgrup-trp-top-fiyat(i - 1 ) = eski-deger * s-say

         when 7
         
          inquire form1-gd-1(6,i),
                      cell-data in cell-deger
              move function numval(cell-deger) to eski-deger
            compute rezgrup-trp-top-fiyat(i - 1) = eski-deger * s-fiy

     end-evaluate
          move tops-oda to top-oda
          move tops-pax to top-pax
          initialize tops-fiy
         perform varying i from 1 by 1  until i > 40
            add rezgrup-sng-top-fiyat(i) to tops-fiy 
            add rezgrup-dbl-top-fiyat(i) to tops-fiy
            add rezgrup-trp-top-fiyat(i) to tops-fiy
        end-perform 
         
       
          move tops-fiy to top-fiy
        display  acc-top-fiy 
            acc-top-pax 
            
            acc-top-oda, 

       .
*
 fis-al.
     open i-o genelfis
     initialize genelfis-rec 
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          initialize genelfis-rec
          move 1 to genelfis-anahtar
          write genelfis-rec end-write
     end-read
          add 1 to grup-oto
          rewrite genelfis-rec end-rewrite                 
     close genelfis
     move grup-oto          to grup-no
     display accept-grup-kodu.
*
 cil-gir.
     move 0 to rezgrup-git-tar-fark  
         
          move 513 to cell-renk
          modify  accept-cik-gun   color =   cell-renk  use-tab
          modify  accept-cik-ay    color =   cell-renk  use-tab
          modify  accept-cik-yil   color =   cell-renk  use-tab
     
     .
*
 gir-gir.
     move 0 to rezgrup-gel-tar-fark  
         
          move 513 to cell-renk
          modify  accept-gir-gun   color =   cell-renk  use-tab
          modify  accept-gir-ay    color =   cell-renk  use-tab
          modify  accept-gir-yil   color =   cell-renk  use-tab
     
     .
*
 not1-gir.
        move 0 to rezgrup-not1-fark  
         
          move 513 to cell-renk
          modify  accept-not1   color =   cell-renk  use-tab
          
          
     .
*
 not2-gir.
         move 0 to rezgrup-not2-fark  
         
          move 513 to cell-renk
          modify  accept-not2   color =   cell-renk  use-tab
        
     .
*
 kaynak1-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AB" to onbkodlar10-tipi
    move xrez-kaynak-1 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak1-tipi-goster
    display acc-kaynak1 lb-kaynak1
    close onbkodlar10.

 kaynak2-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AC" to onbkodlar10-tipi
    move xrez-kaynak-2 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak2-tipi-goster
    display acc-kaynak2 lb-kaynak2
    close onbkodlar10.

 kaynak3-goster.
    open input onbkodlar10
    initialize onbkodlar10-rec
    move "AD" to onbkodlar10-tipi
    move xrez-kaynak-3 to onbkodlar10-kodu1
    read onbkodlar10 no lock
      invalid
        initialize onbkodlar10-rec
    end-read
    move onbkodlar10-adi to kaynak3-tipi-goster
    display acc-kaynak3 lb-kaynak3
    close onbkodlar10.

 
