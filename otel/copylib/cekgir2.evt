* cekgir2.evt
* cekgir2.evt is generated from D:\asya\acugt.ytl\otel\cekgir2.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Gd-1-Event-Proc.
     PERFORM Form1-Gd-1-Ev-Other
     .

 Form2-Event-Proc.
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform icyetki-kontrol.
     call "c$narg" using link-var.
       
     if link-var > 1  then 
       move link-pen to link-pencere
     end-if
     perform adresleri-tasi.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid
          move calis-yil    to yil title-yil
          move calis-ay     to  ay title-ay
          move calis-gun    to gun title-gun
     end-read
     close genel.
      MOVE tarih-tasi TO calisma-tarihi
     .
     open input kodlar02 depkod acenta firma.
     open i-o romhrk exthrk konuk onkasa yromhrk hrk2.
     initialize gec-gecme.
     .
*
 sonraki-doviz.
    
    open input doviz
    move konuk-doviz  to doviz-kodu
      start doviz key > doviz-kodu
        invalid
         initialize doviz-kodu
            start doviz key > doviz-kodu
              invalid
               display message box "doviz bulunamadi :1456"
            end-start
      end-start
      read doviz next no lock
        end continue
        not end
        
        move doviz-kodu to konuk-doviz
      end-read
      close doviz
    .     
*
 kur-bul.
    open input kur
    initialize islem-kuru
    move calisma-tarihi  to kur-tarih
           if konuk-banka = spaces or konuk-banka = zeroes
             move onkpara-banka to konuk-banka
           end-if 
           if konuk-doviz = spaces or konuk-doviz = zeroes
             move onkpara-doviz to konuk-doviz
           end-if 
       
         
     if cinmi = 1  then 
         move KONUK-KUR-DEGERI to islem-kuru doviz-alis
         READ KONUK NO LOCK INVALID STOP " " 
         END-READ
           move konuk-banka to banka-kodu
           move konuk-doviz to doviz-kodu
          open input banka doviz
     
        read banka no lock invalid
               initialize banka-adi
       end-read
       read doviz  no lock invalid
               initialize  D-KISA-ADI 
       end-read
             move banka-adi to dov-kur
              move "-" to dov-kur(6:1)
             move d-kisa-adi to dov-kur(7:)
             if cinmi = 1 then 
             move "C/IN" to  dov-kur(12:4)
             end-if
             move islem-kuru to uy-kur
             display dov-kur-l l-kur
        close banka doviz
 
      else     
     initialize bakilan
      perform test after until islem-kuru > 0 
       add 1 to bakilan
       if bakilan > 20
       
         
         display message box "Hic bir kur girilmemis"
         exit perform
          set exit-pushed to true
       end-if
        move konuk-banka    to kur-banka   banka-kodu 
        move konuk-doviz    to kur-doviz   doviz-kodu   
       read kur no lock invalid 
         initialize   islem-kuru  doviz-alis
       end-read
        move doviz-alis to islem-kuru
  
          open input banka doviz
     
        read banka no lock invalid
               initialize banka-adi
       end-read
       read doviz  no lock invalid
               initialize  D-KISA-ADI 
       end-read
             move banka-adi to dov-kur
              move "-" to dov-kur(6:1)
             move d-kisa-adi to dov-kur(7:)
             move islem-kuru to uy-kur
             display dov-kur-l l-kur
        close banka doviz
       if islem-kuru = 0 
            perform sonraki-doviz 
        end-if
    end-perform
    end-if   
        
      
       
     close     kur.
     evaluate true
       when hrkgir-tl-tutar > 0 and    hrkgir-dv-tutar > 0  
       when hrkgir-tl-tutar = 0 and    hrkgir-dv-tutar > 0 
          compute   hrkgir-tl-tutar rounded =  hrkgir-dv-tutar * islem-kuru
        
         
       when hrkgir-tl-tutar > 0 and    hrkgir-dv-tutar = 0  
          compute   hrkgir-dv-tutar rounded =  hrkgir-tl-tutar / islem-kuru
    end-evaluate
      DISPLAY ACCEPT-TLTUTAR ACCEPT-DVTUTAR .

 kur-bul-exit.
    exit.
*
 accept-depkodu-Bef-Procedure.
     initialize hrkgir-rec  grid-islemno
                corr-dep-dep form-acik depkod-adi of depkod.
     move dep-dep    to hrkgir-depkod.
 
     modify accept-corrdepkodu enabled = false.
    
*     modify accept-aciklama enabled = false.

     modify lb-foliono-e   title = spaces
     modify fr-foliotipi-e title = spaces
     modify lb-adi-e       title = spaces
     modify lb-soyadi-e    title = spaces
     modify lb-girtar-e    title = spaces
     modify lb-ciktar-e    title = spaces
     modify fr-pansiyon-e  title = spaces
     modify lb-pansiyon-e  title = spaces
     modify fr-odeme-e     title = spaces
     modify lb-odeme-e     title = spaces
     modify lb-topborc-e   title = spaces
     modify lb-topalacak-e title = spaces
     modify lb-bakiye-e    title = spaces
     modify lb-outlet-e    title = spaces
     modify lb-acenta      title = spaces
     modify lb-not1        title = spaces
     modify lb-not2        title = spaces
     initialize toplam-not
     display form1.
     modify form1-fr-3 title = tarih-title.

*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         

     perform grid-baslik-at thru grid-baslik-at-exit.
     perform bef-procedure.
     .
*
 exception-procedure.
     move control-id to gidis-id
     evaluate key-status
       when 6                                   
            
          open input banka
          move konuk-banka to banka-kodu
          start banka  key > banka-kodu
            invalid
             initialize banka-kodu
             start banka key > banka-kodu
               invalid
                continue
             end-start
         end-start
         read banka next
           end continue
           not end
          move banka-kodu to konuk-banka
        end-read
          close banka

          perform kur-bul
          display dov-kur-l 
         

       when 7
         
          perform sonraki-doviz
          perform kur-bul
          display dov-kur-l 
       when 8
         if cinmi= 1 then 
           move 0 to cinmi
           else
           move 1 to cinmi
         end-if
          perform kur-bul
          display dov-kur-l 
        
       when 3131 
          if konuk-fol-kodu = "R" 

            move 5 to link-nereden 
            move "REZ"   to  link-NOT-DOS    
           move konuk-rez-no to link-NOT-DOS-ANAH   
         else
          if konuk-extra-rez-no > 0 then
           move 6 to link-nereden 
           move "REZ"   to  link-NOT-DOS    
           move konuk-extra-rez-no to link-NOT-DOS-ANAH    
           else
           move 6 to link-nereden 
           move "KON"   to  link-NOT-DOS    
           move konuk-folio to link-NOT-DOS-ANAH    
           
          end-if

       end-if 
      
           move "U"     to  link-not-islem
           
           string konuk-adi delimited by "  "
                  " " delimited by size
                  konuk-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
                  display not-ac
         when 1 
            evaluate control-id
              when  1001 
               perform depkod-ara
              when  1002
               perform oda-ara thru oda-ara-exit
              when  1007
               perform corr-depkod-ara
            end-evaluate

         when 2 
              perform kontroller

              if gecmez
                 initialize gec-gecme
                 move 4        to accept-control
                 move gidis-id to control-id
                 exit paragraph
              end-if
              initialize mesaj-degiskenler
              move "Girilen Bilgiler Kaydedilsin Mi ?"  to mmesaj-1
              move " [ Kaydet Basla ] " to mmesaj-title
              move 2           to mmesaj-type
              move 1           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
              if donus-kodu = 2
                 move 4        to accept-control
                 move gidis-id to control-id
                 exit paragraph
              end-if
                 open input kur 
                 initialize KUR-REC doviz-alis
               move calisma-tarihi  to kur-tarih
                       move onkpara-banka   to kur-banka
                       move onkpara-doviz   to kur-doviz
                       read kur no lock invalid
                            move 1 to doviz-alis
                      
                           
                       end-read

                    compute hrkgir-dv-tutar rounded = 
                           hrkgir-tl-tutar / doviz-alis

                   close kur
              perform kaydet
              if link-var = 4 then 
                  continue
                  else
                  perform grid-baslik-at thru grid-baslik-at-exit
                      move 4    to accept-control
                      move 1002 to control-id
              end-if
         when 3
              initialize satir sutun
              initialize kllnc-rec
              move k-kodu-tasi to k-kodu
              
              open input kllnc
              read kllnc no lock invalid 
              continue
              end-read
              close kllnc
              if k-cek-silemez = 1 
                 display message box "Bu kullanici kokdu ile cek silemezsiniz" new-line
                   "Kullanici Kodlari Tanimlamadan aciniz (Gelismis)" 
                
              else
              if grid-islemno not  = 0  or k-kodu-tasi = "ASYA" then 
                 initialize mesaj-degiskenler
                 move "Kayit Silinsin Mi ?"  to mmesaj-1
                 move " [ SIL ] " to mmesaj-title
                 move 2           to mmesaj-type
                 move 1           to mmesaj-icon
                 move 1           to mmesaj-default
                 perform mmesaj-ver
                 if donus-kodu = 2
                    move 4        to accept-control
                    move gidis-id to control-id
                    exit paragraph
                 end-if
                 initialize Form1-Gd-1-record 
                 inquire Form1-Gd-1, cursor-y in satir cursor-x in sutun
                 inquire Form1-Gd-1(satir,7),
                         cell-data in grid-islemno
                 if konuk-fol-kodu = "R"
                    perform romhrk-sil
                 else 
                    perform exthrk-sil
                 end-if
                 inquire form1-gd-1,
                         last-row in return-code
                 if return-code < 2
                    initialize grid-islemno
                 end-if
              end-if
              end-if
*              if kayit-var 
*                 move 4    to accept-control
*                 move 1001 to control-id
*              end-if 
         
         when 5
           if hrkgir-tl-tutar not > 0 then
                 display message box
                "Once TL Tutarini giriniz"

            else
             
                     if cinmi= 1 then 
                          call "/asya/ytl/obj/otel/dov-boz.asy" 
                                using  konuk-folio   hrkgir-tl-tutar
                                hrkgir-dv-tutar  banka-kodu   doviz-kodu 1
                                on exception 
                                perform callerr-proc
                                exit paragraph
                                not on exception 
                           cancel "/asya/ytl/obj/otel/dov-boz.asy"
                       end-call




             else
          
**************************> dov-boz.asy
              initialize dokcagir-tasi
              set dokcagir-tasi-call-dovboz5  to true 
              move konuk-folio                to dokcagir-konuk-folio
              move hrkgir-tl-tutar            to dokcagir-hrkgir-tl-tutar
              move hrkgir-dv-tutar            to dokcagir-hrkgir-dv-tutar
              move banka-kodu                 to dokcagir-banka-kodu
              move doviz-kodu                 to dokcagir-doviz-kodu
              perform dokcagir-call
              move dokcagir-konuk-folio       to konuk-folio
              move dokcagir-hrkgir-tl-tutar   to hrkgir-tl-tutar
              move dokcagir-hrkgir-dv-tutar   to hrkgir-dv-tutar
              move dokcagir-banka-kodu        to banka-kodu
              move dokcagir-doviz-kodu        to doviz-kodu
           
          end-if
            end-if
           
    end-evaluate.

*
 romhrk-sil.
       open i-o silhrk.
       initialize sil-degiskenler.
       move grid-islemno  to romhrk-islem
       move konuk-folio   to romhrk-folio
       read romhrk no lock invalid 
            display message box "Silinecek Kayit Bulunamadi....."
                              title = " [ Kayit Yok ] "
            close silhrk
            exit paragraph
       not invalid
*            if Romhrk-Islem-Tipi = "Y" then 
*             display message box "Devir Kaydi Silemezsiniz....."
*                              title = " [ Kayit Yok ] "
*              close silhrk
*              exit paragraph
*            end-if
            move romhrk-folio     to sil-folio 
            move romhrk-depkod    to sil-depkod
            move romhrk-ba        to sil-ba
            move romhrk-tl-tutar  to sil-tl-tutar
            move romhrk-dv-tutar  to sil-dv-tutar
            
            delete romhrk invalid exit paragraph
            end-delete
            perform log-operation-romhrk
            move romhrk-anah      to hrk2-anah
            read hrk2 no lock invalid
                 continue
            not invalid
                delete hrk2 end-delete
            end-read
            move hrk2-kaynak-folio     to yromhrk-folio
            move romhrk-islem          to yromhrk-islem
            read yromhrk no lock invalid
                 stop " "
            not invalid
                delete yromhrk end-delete
            end-read
*******>Silinmis kayitlara yaz
            move romhrk-rec to silhrk-rec
            accept silhrk-zaman from time 
            move calisma-tarihi to silhrk-tarih
            move k-kodu-tasi to silhrk-staf
            write silhrk-rec invalid continue
            end-write.
            close silhrk.

            perform onkasa-eksilt thru onkasa-eksilt-exit
*/CORRECTION
            if silhrk-corr-depkod <> zeroes
               perform onkasa-corr-eksilt
            end-if
*/CORRECTION

            perform konuk-eksilt  thru konuk-eksilt-exit
            modify Form1-Gd-1, record-to-delete(satir)
                               cursor-y = 2 cursor-x = 2
                               mass-update = 0.
            inquire form1-gd-1(2,7),
                    cell-data in grid-islemno.
            .

 exthrk-sil.
       open i-o silhrk.
       initialize sil-degiskenler.
       move grid-islemno  to exthrk-islem
       move konuk-folio   to exthrk-folio
       read exthrk no lock invalid 
            display message box "Silinecek Kayit Bulunamadi....."
                              title = " [ Kayit Yok ] "
            close silhrk
            exit paragraph
            not invalid 
*              if Romhrk-Islem-Tipi = "Y" then 
*             display message box "Devir Kaydi Silemezsiniz....."
*                              title = " [ Kayit Yok ] "
*              close silhrk
*              exit paragraph
*            end-if
            move exthrk-folio     to sil-folio 
            move exthrk-depkod    to sil-depkod
            move exthrk-ba        to sil-ba
            move exthrk-tl-tutar  to sil-tl-tutar
            move exthrk-dv-tutar  to sil-dv-tutar
            delete exthrk invalid exit paragraph
            end-delete.
            perform log-operation-exthrk
            move exthrk-anah      to hrk2-anah
            read hrk2 no lock invalid
                 continue
            not invalid
                delete hrk2 end-delete
            end-read
            move hrk2-kaynak-folio     to yromhrk-folio
            move exthrk-islem          to yromhrk-islem
            read yromhrk no lock invalid
                 stop " "
            not invalid
                delete yromhrk end-delete
            end-read

*******>Silinmis kayitlara yaz
            move exthrk-rec to silhrk-rec
            accept silhrk-zaman from time 
            move calisma-tarihi to silhrk-tarih
            move k-kodu-tasi to silhrk-staf
            write silhrk-rec invalid continue
            end-write.
            close silhrk.

            perform onkasa-eksilt thru onkasa-eksilt-exit

*/CORRECTION
            if silhrk-corr-depkod <> zeroes
               perform onkasa-corr-eksilt
            end-if
*/CORRECTION

            perform konuk-eksilt  thru konuk-eksilt-exit
            modify Form1-Gd-1, record-to-delete(satir)
                               cursor-y = 2 cursor-x = 2
                               mass-update = 0.
            inquire form1-gd-1(2,7),
                    cell-data in grid-islemno.
            .
*

*
 kaydet.
         if hrkgir-ISLEM  < 1 then 
           display message box "Islem Kaydedilemedi"
             title " "
             exit paragraph
          end-if
          move "M"              to hrkgir-islem-tipi
          move calisma-tarihi   to hrkgir-tarih
          move depkod-ba        to hrkgir-ba
          accept hrkgir-zaman from time
          move k-kodu-tasi      to hrkgir-staf
          if corr-dep-dep <> zeroes
             move corr-dep-dep  to hrkgir-corr-depkod
          end-if
          move hrkgir-rec       to romhrk-rec exthrk-rec
          if depkod-ba = "A" and depkod-turu = 3 
            if  dovizliislem = 1 
                continue   | bos oldugu icin konuldu... firat
            end-if
          end-if
********************kopyalanacak
          open input route konu2 rez
*          open i-o yromhrk
          move hrkgir-rec  to yromhrk-rec
         move hrk2-data to yromhrk-data
         write yromhrk-rec invalid stop " " end-write 
*         close yromhrk
        
          perform folref-bul
          perform folref-ata
          close route konu2  rez
*          open i-o hrk2
          move hrkgir-anah to hrk2-anah
          move yromhrk-folio to hrk2-kaynak-folio
          
          write hrk2-rec end-write
*          close hrk2
          move hrkgir-rec       to romhrk-rec exthrk-rec
**************** kopyalanacak
         

          if konu2-fol-kodu = "R"
             write romhrk-rec end-write,
             perform log-operation-romhrk
             else
             write exthrk-rec end-write
             perform log-operation-exthrk
          end-if.
          perform aciklama-yaz
          perform onkasa-artir thru onkasa-artir-exit
*/CORRECTION
          if hrkgir-corr-depkod <> zeroes
             perform onkasa-corr-artir
          end-if
*/CORRECTION
          open i-o konu2
          perform konuk-artir  thru konuk-artir-exit
          close konu2
          if ( DEPKOD-FATURA-TAKIP = "E" and 
              0 = 1 ) 
             perform oto-fatura
             else
         
             if depkod-makbuz = "E" 
               perform makbuz-cik thru makbuz-cik-exit
              end-if
           end-if
          
          
          if link-var = 4 then 
             set exit-pushed to true
          end-if.
*
 folref-bul.
*       if k-kodu-tasi = "ASYA" then stop " " end-if
       initialize aroute-anah routtur routyazma routbulundu  extradan-geldi
       if konuk-fol-kodu = "R" then 
          move konuk-rez-no to aroute-rezno
         else
          if konuk-extra-rez-no  > 0 
              move 1 to extradan-geldi
              move konuk-extra-rez-no to aroute-rezno
           else
              move konuk-folio to aroute-folio
          end-if
       end-if

     
       perform until routbulundu = 1 or routtur > 10 
       add 1 to routtur
       initialize route-rec
       move aroute-anah to route-anah
       move hrkgir-depkod   to route-depkod
       if hrkgir-corr-depkod not = spaces and hrkgir-corr-depkod not = zeroes 
         move  hrkgir-corr-depkod to route-depkod
       end-if
       read route no lock invalid
           
           perform rout-folio-kontrol
           perform def-pen-bul
            move 1 to routbulundu
         not invalid
         if route-tip = "P"

            perform rout-folio-kontrol
            move 1 to routbulundu
          else
            if route-tip = "F"
               if route-no <> route-folio
                        initialize aroute-anah
                        move route-no to  aroute-folio
                   else
                     perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

                end-if
              else
                if route-no <> route-rezno
                      initialize aroute-anah
                      move route-no  to aroute-rezno
                         else
                       perform rout-folio-kontrol
                       perform def-pen-bul
                       move 1 to routbulundu

               end-if
            end-if
        end-if
        end-read
       end-perform 
        .
 rout-folio-kontrol.
     initialize konu2-rec
     if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read
          
            if extradan-geldi = 1 then 
            
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move konuk-folio to konu2-folio
                     read konu2 no lock invalid 
                        continue
                      end-read

                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move konuk-folio to konu2-folio
                      read konu2 no lock invalid 
                        continue
                      end-read
                  end-if
               end-read
               else
                move rez-folio to konu2-folio
                read konu2 no lock invalid
                       continue
                      end-read
           end-if

    end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
          if KONU2-ACIK-KAPALI    = "C" 
            move 2 to routyazma
          end-if
          
       end-read
          .
 def-pen-bul.
        
       initialize konu2-rec
      if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        initialize rez-rec
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read
          if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move konuk-folio to konu2-folio
                   read konu2 no lock invalid
                       continue
                      end-read
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move konuk-folio to konu2-folio
                      read konu2 no lock invalid
                       continue
                      end-read
                  end-if
               end-read
               else
                move rez-folio to konu2-folio
                read konu2 no lock invalid
                       continue
                      end-read
           end-if

     end-if                    
       read konu2 no lock 
          invalid
           move 1 to routyazma
           move konuk-folio to konu2-folio
           read konu2 no lock invalid continue
           end-read
          not invalid
             move "B"               to kodlar02-tipi
               move konu2-odeme-tipi  to kodlar02-kodu 
              read kodlar02 no lock invalid
                    move 1 to route-no
             
                  not invalid
                     if ode-tipi  not =  "A"  | KREDI ISE
                        if hrkgir-corr-depkod not = spaces
                                    move  hrkgir-corr-depkod to depkod-anah
                                    read depkod no lock invalid continue
                                    end-read
                        end-if
                          if depkod-tipi = 2 then 
                                 move 1 to route-no
                             else
                                move 2 to route-no
                                

                                  
                               
                          end-if
                          if hrkgir-corr-depkod not = spaces

                                    move  hrkgir-depkod to depkod-anah
                                    read depkod no lock invalid continue
                                    end-read
                          end-if
                      else
                         move 1 to route-no
                   end-if
             end-read
       end-read
          .
*
 folref-ata.
     if routyazma = 0 and routbulundu = 1 
      move konu2-folio to hrkgir-folio
      if vis-pen = 1 then
          move odemepen to hrkgir-ref
             else
          move route-no to hrkgir-ref
      end-if
      else
       if vis-pen = 1 then
          move odemepen to hrkgir-ref
             else
          move 1 to hrkgir-ref
      end-if
    end-if
       .
*
 oto-fatura.
*       call "/asya/ytl/obj/otel/folfat1.asy" 
*            using  konuk-folio, konuk-odano
*         on exception 
*             perform callerr-proc
*             exit paragraph
*         not on exception 
*             cancel "/asya/ytl/obj/otel/folfat1.asy"
*       end-call
     .
*
 aciklama-yaz.
        if form-acik not = spaces then
           open i-o nt
               initialize not-rec
               if konuk-fol-kodu = "R"
                  move  "RHR"     to NOT-DOS
                  move romhrk-anah to  NOT-DOS-ANAH 

                  else
                  move  "EHR"      to NOT-DOS
                  move exthrk-anah to  NOT-DOS-ANAH 

               end-if
               move form-acik to not1

              write not-rec invalid
                display message box "Cakisma Hatasi 232352"
              end-write
          
           close nt
         end-if   .


*
 onkasa-artir.
       move hrkgir-tarih    to onkasa-tarih.
       move hrkgir-depkod   to onkasa-dep.
       read onkasa no lock invalid 
            go onkasa-yeni-isle
            not invalid continue 
       end-read.
       compute onkasa-tutar-tl   = onkasa-tutar-tl + hrkgir-tl-tutar.
       compute onkasa-tutar-dv   = onkasa-tutar-dv + hrkgir-dv-tutar.
       rewrite onkasa-rec invalid 
               write onkasa-rec 
               end-write continue
       end-rewrite.
       go onkasa-artir-exit.

*/CORRECTION
 onkasa-corr-artir.
       move hrkgir-tarih              to onkasa-tarih.
       move hrkgir-corr-depkod        to onkasa-dep.
       read onkasa no lock invalid 
            initialize onkasa-rec
            move hrkgir-tarih         to onkasa-tarih
            move hrkgir-corr-depkod   to onkasa-dep
       end-read.
       compute onkasa-corr-tutar-tl = onkasa-corr-tutar-tl + hrkgir-tl-tutar.
       compute onkasa-corr-tutar-dv = onkasa-corr-tutar-dv + hrkgir-dv-tutar.
       rewrite onkasa-rec invalid 
               write onkasa-rec end-write
       end-rewrite.

 onkasa-yeni-isle.
       initialize onkasa-rec.
       move hrkgir-tarih    to onkasa-tarih.
       move hrkgir-depkod   to onkasa-dep.
       move hrkgir-tl-tutar to onkasa-tutar-tl.
       move hrkgir-dv-tutar to onkasa-tutar-dv.
       write onkasa-rec invalid 
             rewrite onkasa-rec 
             end-rewrite continue 
       end-write.
 onkasa-artir-exit.
       exit.

 onkasa-eksilt.
       move calisma-tarihi    to onkasa-tarih.
       move sil-depkod        to onkasa-dep.
       read onkasa no lock invalid 
            go onkasa-eksilt-exit
            not invalid continue 
       end-read.
       compute onkasa-tutar-tl   = onkasa-tutar-tl - sil-tl-tutar.
       compute onkasa-tutar-dv   = onkasa-tutar-dv - sil-dv-tutar.
       rewrite onkasa-rec invalid continue.
 onkasa-eksilt-exit.
       exit.

*/CORRECTION
 onkasa-corr-eksilt.
       move calisma-tarihi            to onkasa-tarih.
       move silhrk-corr-depkod        to onkasa-dep.
       read onkasa no lock invalid 
            initialize onkasa-rec
            move calisma-tarihi       to onkasa-tarih
            move silhrk-corr-depkod   to onkasa-dep
       end-read.
       compute onkasa-corr-tutar-tl   = onkasa-corr-tutar-tl - sil-tl-tutar.
       compute onkasa-corr-tutar-dv   = onkasa-corr-tutar-dv - sil-dv-tutar.
       rewrite onkasa-rec invalid 
               write onkasa-rec end-write
       end-rewrite.
 konuk-artir.
           move hrkgir-folio   to konu2-folio.
           read konu2 no lock invalid 
                go konuk-artir-exit
                not invalid continue
           end-read.
           if hrkgir-ba = "B"
              compute konu2-top-borc = konu2-top-borc + hrkgir-tl-tutar.
           if hrkgir-ba = "A"
              compute konu2-top-alac = konu2-top-alac + hrkgir-tl-tutar.
          rewrite konu2-rec invalid continue.
 konuk-artir-exit.
      exit.
 konuk-eksilt.
    move sil-folio to konuk-folio.
    read konuk no lock invalid 
         go konuk-eksilt-exit
         not invalid continue
    end-read.
    if sil-ba = "B"
       compute konuk-top-borc = konuk-top-borc - sil-tl-tutar.
    if sil-ba = "A"
       compute konuk-top-alac = konuk-top-alac - sil-tl-tutar.
    rewrite konuk-rec invalid continue.
 konuk-eksilt-exit.
      exit.
*                                  
 bef-procedure.
     if control-id not = 1008
        initialize grid-islemno
     end-if
*     move control-value    to sonraki-kontrol
*     move control-id       to sonraki-id
*     display message box "o-k->" onceki-kontrol, new-line
*                         "S-k->" sonraki-kontrol, new-line
*                         "O-id->" onceki-id, new-line
*                         "S-Id->" sonraki-id, new-line
*                         "key-->" key-status new-line
*                         "gec-gecme-->" gec-gecme.
***>Onceki Kontrole gidebildin ama sonrakine gidemesin....
*     if gecmez
*        if sonraki-kontrol not = 2
*           if sonraki-kontrol > onceki-kontrol
*              move 4         to accept-control
*              move onceki-id to control-id
*              exit paragraph
*           end-if
*        end-if
*     end-if

     if control-id = 1005 and hrkgir-tl-tutar not = 0 and
        sonraki-kontrol > onceki-kontrol
        perform tlden-doviz
                move 4    to accept-control
                move 1006 to control-id
     end-if 
     

     initialize mesaj.
     evaluate control-id
          when 1001
              evaluate true
                  when turkce
                       move "Departman Kodu Giriniz... F1->Departman Kodu Ara..." to mesaj
                  when almanca
                       move "Departman Kodu Giriniz... F1->Departman Kodu Ara..." to mesaj
                  when ingilizce
                       move "Departman Kodu Giriniz... F1->Departman Kodu Ara..." to mesaj
              end-evaluate
          when 1002
              evaluate true
                  when turkce
                       move "Oda Numarasi Giriniz F1->Oda No Ara..." to mesaj
                  when almanca
                       move "Oda Numarasi Giriniz F1->Oda No Ara..." to mesaj
                  when ingilizce
                       move "Oda Numarasi Giriniz F1->Oda No Ara..." to mesaj
              end-evaluate
          when 1004
            if depkod-turu  = 3 
             if hrkgir-dv-tutar = 0 then 
              move 1 to v-ort
            display l-ort
            end-if
            end-if
              evaluate true
                  when turkce
                       move "Islemin [ TL ] Tutarini Giriniz... " to mesaj
                  when ingilizce
                       move "Islemin [ TL ] Tutarini Giriniz... " to mesaj
                  when almanca
                       move "Islemin [ TL ] Tutarini Giriniz... " to mesaj
              end-evaluate
          when 1005
              evaluate true
                  when turkce
                       move "Islemin [ Doviz ] Tutarini Giriniz... " to mesaj
                  when ingilizce
                       move "Islemin [ Doviz ] Tutarini Giriniz... " to mesaj
                  when almanca
                       move "Islemin [ Doviz ] Tutarini Giriniz... " to mesaj
              end-evaluate
          when 1006
              evaluate true
                  when turkce
                       move "Cek Numarasini Giriniz......" to mesaj
                  when ingilizce
                       move "Cek Numarasini Giriniz......" to mesaj
                  when almanca
                       move "Cek Numarasini Giriniz......" to mesaj
              end-evaluate
          when 1007
              evaluate true
                  when turkce
                       move "Correction Yapilan Departman Kodu..F1->Departman Kodu Ara " to mesaj
                  when ingilizce
                       move "Correction Yapilan Departman Kodu..F1->Departman Kodu Ara " to mesaj
                  when almanca
                       move "Correction Yapilan Departman Kodu..F1->Departman Kodu Ara " to mesaj
              end-evaluate
          when 1008
              evaluate true
                  when turkce
                       move "Departman Makbuzu Icin Aciklama Giriniz" to mesaj
                  when ingilizce
                       move "Departman Makbuzu Icin Aciklama Giriniz" to mesaj
                  when almanca
                       move "Departman Makbuzu Icin Aciklama Giriniz" to mesaj
              end-evaluate
          when 1009
              evaluate true
                  when turkce
                       move "Girilen Bilgileri Kaydet " to mesaj
                  when ingilizce
                       move "Girilen Bilgileri Kaydet " to mesaj
                  when almanca
                       move "Girilen Bilgileri Kaydet " to mesaj
              end-evaluate
          when 1010
              evaluate true
                  when turkce
                       move "Kaydi Sil " to mesaj
                  when ingilizce
                       move "Kaydi Sil " to mesaj
                  when almanca
                       move "Kaydi Sil " to mesaj
              end-evaluate
          when 1011
              evaluate true
                  when turkce
                       move "Girilen Kaydi Outlet Cash'e Aktar " to mesaj
                  when ingilizce
                       move "Girilen Kaydi Outlet Cash'e Aktar " to mesaj
                  when almanca
                       move "Girilen Kaydi Outlet Cash'e Aktar " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj.
     .
*
 Form1-Aft-Initdata.
     
     modify form1-fr-3 title = tarih-title.
      
     if link-var > 0 then
        initialize hata
        move link-fol-no to konuk-folio
        read konuk no lock 
           invalid 
             display message box "konuk bulnaamadi Folio---" konuk-folio
             set exit-pushed to true
             exit paragraph

           not invalid
           
           
               perform uygun-folio   
          
        end-read
        move konuk-git-tar to calisma-tarihi
        display ac-bol acc-01 acc-02 acc-03
        perform kur-bul
        if konuk-fol-kodu = "E" then 
            move 1 to vextra
            else
            move 0 to vextra
        end-if
        display lextra
         if link-var = 4 then 
           move link-depkod   to hrkgir-depkod
           move 1001 to control-id

           move link-tl-tutar to hrkgir-tl-tutar 
           display accept-tltutar accept-depkodu
             perform    Aft-Procedure
             if hata not = 1 then 
            move 1004 to control-id
            if link-depkod = onkpara-city-ledger and hata not = 1 then
            move 2 to key-status
            perform Exception-Procedure
            set exit-pushed to true
            end-if
            end-if
         end-if
     end-if .
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
      
 uygun-folio.
        perform accept-depkodu-Bef-Procedure
        move konuk-odano to cekgir-odano 
        display accept-odano
        move 1           to onceki-kontrol
        move 1002        to onceki-id
        move 1002        to gidis-id.
        move konuk-folio to hrkgir-folio
        initialize konuk-uygun
        perform musteri-oku 
 
          if konuk-uygun = 1
                  move 1 to gec-gecme
                  set exit-pushed to true
                 exit paragraph
                 
          end-if
              perform grid-yukle thru grid-yukle-exit
              
              perform fisno-al
              move 4 to accept-control
              move 1001 to control-id
      .
*
 Aft-Procedure.
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id to gidis-id.
      evaluate control-id
       when 1001
         initialize gec-gecme ba-kontrol
         move hrkgir-depkod to depkod-kodu dep-dep ba-kontrol
         read depkod no lock invalid 
               move 4         to accept-control
               move gidis-id  to control-id
               move 1 to hata
               exit paragraph
              not invalid 
              if depkod-kullanma = 1 then 
                  move 4         to accept-control
                 move gidis-id  to control-id
                 move 1 to hata
                 exit paragraph
              end-if
              if ONKPARA-CITY-LEDGER = depkod-kodu and 
              (( acenta-kredili not = 1 and konuk-firma = spaces ) or 
              (firma-kredili not = 1 and konuk-firma not = spaces))
              and ONKPARA-kredi-kilit = 1 then 
                 display message box "Bu Konaklamayi Krediye kaldiramazsiniz" new-line
                                     "Onburo calisma parametrlerinde Kredi kilitlemesini kaldirmalisiniz" new-line
                                     "veya Muhasebe Supervisori tarafindan " new-line
                                     "Acenta veya Sirket tanimlamadan Kredili secenegi secilmelidir" new-line
                  move 4         to accept-control
                 move gidis-id  to control-id
                 move 1 to hata
                 exit paragraph
              end-if

         end-read
         
               modify lb-depadi-e, title = depkod-adi of depkod
             
*               modify accept-aciklama, enabled = true
*               if depkod-makbuz = "E" 
*                  modify accept-aciklama, enabled = true
*               end-if 
               if depkod-turu = 2 
                  modify accept-corrdepkodu, enabled = true
               
                  modify lb-corrdepadi-e,    enabled = true
                   move 1 to vis-pen
                     if link-pencere > 0 then
                       move link-pencere to odemepen
                       else
                       move 1 to  odemepen
                     end-if
               else 
                  initialize corr-dep-dep
                  modify lb-corrdepadi-e, value = " "
                  modify accept-corrdepkodu, enabled = false
                                             value = 0
                 
                  modify lb-corrdepadi-e,    enabled = false
                  if depkod-ba = "A" or depkod-turu = 3
                     move 1 to vis-pen
                     if link-pencere > 0 then
                       move link-pencere to odemepen
                       else
                       move 1 to  odemepen
                     end-if
                     else
                     move 0 to vis-pen
                     open input route konu2 rez
        
                     
                     perform folref-bul
                 
                     close route konu2 rez




                 
                  move 1 to rout-vis
                  evaluate routyazma 
                     when 0
                       move "OK" to rsonuc
                     when 1
                       move "YOK" to rsonuc
                    when 2
                       move "KAPALI" to rsonuc
                    when 3 
                      move "COUT" to rsonuc
                  end-evaluate

                   display r1 r2 r3 r4 r5  r6
                   end-if
                   display penacc
               end-if 
            if depkod-turu not = 3 and konuk-fol-kodu not = "R"
                 move onkpara-banka to konuk-banka
                 move onkpara-doviz to konuk-doviz
                 perform kur-bul
                 
             end-if
       when 1002
         initialize gec-gecme
         open input odalar
         move cekgir-odano to odalar-anah
         read odalar no lock invalid 
              move 1 to gec-gecme
              close odalar
              initialize cekgir-odano
              display accept-odano
              exit paragraph
              not invalid continue 
         end-read
         close odalar
              initialize folara-cagir hrkgir-folio
              move "I"    to folara-cagri-tipi
              move cekgir-odano  to folara-odano
                   call "/asya/ytl/obj/otel/folara.asy" using folara-cagir
                         on exception perform callerr-proc
                         not on exception
                   cancel "/asya/ytl/obj/otel/folara.asy " 
                   end-call
                   move folara-no-cagir    to hrkgir-folio

              move hrkgir-folio to konuk-folio     
              read konuk no lock invalid 
                   move 1 to gec-gecme
                   exit paragraph                    
                   not invalid continue 
                  
              end-read
              initialize konuk-uygun
              perform musteri-oku 
              perform kur-bul
              if konuk-uygun = 1
                  move 1 to gec-gecme
                 exit paragraph
              end-if
              perform grid-yukle thru grid-yukle-exit
              perform fisno-al

       when 1004
           
            perform tlden-doviz
            move hrkgir-tl-tutar    to z-tutar
            modify accept-tltutar  value = z-tutar
             
            move 0 to v-ort
            display l-ort
            if hrkgir-tl-tutar > 0 then 
              move 1006 to control-id
              move 4 to accept-control
            end-if

       when 1005
            perform dovizden-tl
            move hrkgir-dv-tutar    to z-tutar
            modify accept-dvtutar  value = z-tutar
       when 16
            initialize grid-islemno
       when 1007
         initialize gec-gecme
         move corr-dep-dep to depkod-kodu 
         read depkod no lock invalid 
               move 1 to gec-gecme
               exit paragraph
              not invalid 
                 if depkod-kullanma = 1 then
                     display message box "Bu departman kullanýmda degil"
                     move 1 to gec-gecme
                    exit paragraph
              
                 end-if
         end-read
               display accept-corrdepkodu
               modify lb-corrdepadi-e, title = depkod-adi of depkod
             

         initialize gec-gecme
         move hrkgir-depkod to depkod-kodu dep-dep
         read depkod no lock invalid 
               move 1 to gec-gecme
               exit paragraph
              not invalid
               if depkod-kullanma = 1 then
                     display message box "Bu departman kullanimda degil"
                     move 1 to gec-gecme
                    exit paragraph
              
                 end-if
         end-read
           move 0 to vis-pen
           open input route konu2 rez
        
           move corr-dep-dep  to hrkgir-CORR-DEPKOD
           
           perform folref-bul
           
           close route konu2 rez




                 
                  move 1 to rout-vis
                  evaluate routyazma 
                     when 0
                       move "OK" to rsonuc
                     when 1
                       move "YOK" to rsonuc
                    when 2
                       move "KAPALI" to rsonuc
                    when 3 
                      move "COUT" to rsonuc
                  end-evaluate

                   display r1 r2 r3 r4 r5  r6
       when 1008 continue
       when 11001
            move 27 to key-status
      end-evaluate
      .
*
 kontroller.
       initialize gec-gecme.
         move hrkgir-depkod to depkod-kodu dep-dep
         read depkod no lock invalid 
               move 1         to gec-gecme
               move 1001      to gidis-id
               exit paragraph
              not invalid 
               if depkod-kullanma = 1 then 
                    move 1         to gec-gecme
               move 1001      to gidis-id
               exit paragraph


               end-if
         end-read
               modify lb-depadi-e, title = depkod-adi of depkod

         open input odalar
         move cekgir-odano to odalar-anah
         read odalar no lock invalid 
              move 1002  to gidis-id
              move 1     to gec-gecme
              close odalar
              exit paragraph
              not invalid continue 
         end-read
         close odalar
              move hrkgir-folio to konuk-folio     
              read konuk no lock invalid 
                   move 1002   to gidis-id
                   move 1      to gec-gecme
                   exit paragraph
                   not invalid continue 
                 
              end-read
       if hrkgir-tl-tutar = 0
          display message box 
                  "[TL] Tutarini Bos Gectiniz.."
                  new-line,
                  "Lutfen Rakam Giriniz" 
                  title = " [ Tutar Hatali ] "
*          move 1    to gec-gecme
*          move 1004 to gidis-id
*          exit paragraph
        end-if
       if depkod-turu = 2 
          move corr-dep-dep to depkod-kodu
          read depkod no lock invalid 
               move 1         to gec-gecme
               move 1007      to gidis-id
               exit paragraph
              not invalid 
               if depkod-kullanma = 1 then 
                  move 1         to gec-gecme
               move 1007      to gidis-id
               display message box "Departman kullanim disi"
               exit paragraph


               end-if
         end-read

         if depkod-turu = 2
            display message box 
                    "Correction yapmak istediginiz departmanin turu Correction",new-line,
                    "Lutfen kontrol ediniz"
                    icon mb_error_icon
                    title "Hata"
                    move 1 to gec-gecme
                    move 1007 to gidis-id
                    exit paragraph
         end-if

         move depkod-ba          to dummy-x | Correction - mi + mi ?
        


         modify lb-corrdepadi-e, title = depkod-adi of depkod
         move hrkgir-depkod to depkod-kodu dep-dep
         read depkod no lock invalid 
               move 1         to gec-gecme
               move 1001      to gidis-id
               exit paragraph
              not invalid 
              if depkod-kullanma = 1 then
                 move 1         to gec-gecme
               move 1001      to gidis-id
               display message box "Kullanim disi departman"
               exit paragraph

              end-if
         end-read
         if depkod-ba = dummy-x 
            display message box 
                    "Lutfen Borc Departmanlar icin Correction (+)",new-line,
                    "Alacak Departmanlar icin Correction (-) kullaniniz"
                    icon mb_error_icon
                    title "Hata"
                    move 1007   to gidis-id
                    move 1      to gec-gecme

                    exit paragraph
         end-if
         modify lb-depadi-e, title = depkod-adi of depkod
*/ Borc departmana Corr   (+) YASAK
*/ Alacak Departmana Corr (-) YASAK KONULACAK 
       end-if 
        .
*
 Form1-Pb-1-Link.
     .
*
 depkod-ara.
      initialize depkod-cagir.
      call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/depara.asy" 
       end-call
       move depkod-dep-kodu  to hrkgir-depkod
       move hrkgir-depkod to depkod-kodu dep-dep
       read depkod no lock invalid 
            move 4        to accept-control
            move 1001     to control-id
            exit paragraph
            not invalid 
            if depkod-kullanma = 1 then
                 move 4         to gec-gecme
               move 1001      to gidis-id
               display message box "Kullanim disi departman"
               exit paragraph

              end-if
       end-read
       modify lb-depadi-e, title = depkod-adi of depkod
       display accept-depkodu.
       if depkod-makbuz = "E" 
          modify accept-aciklama, enabled = true
       end-if 
       if depkod-turu = 2 
          modify accept-corrdepkodu, enabled = true
          modify lb-corrdepadi-e,    enabled = true
          else
          move ROMHRK-CORR-DEPKOD to  hrkgir-corr-depkod 
       end-if 
       move 4        to accept-control
       move 1001     to control-id.
     .
*
 oda-ara.
      initialize oda-cagir.
      move "D"   to oda-db-cagir
      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odaara.asy" 
       end-call.
       move odano-cagir     to cekgir-odano.
 oda-oku.
       open input odalar.
       initialize odalar-rec.
       move cekgir-odano   to odalar-anah
       read odalar         no lock invalid 
            initialize cekgir-odano
            not invalid continue 
       end-read
       close odalar.
       display accept-odano.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.
*
 corr-depkod-ara.
      initialize depkod-cagir.
      call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/depara.asy" 
       end-call
       move depkod-dep-kodu  to corr-dep-dep
       move corr-dep-dep to depkod-kodu
       read depkod no lock invalid 
            move 4        to accept-control
            move 1007     to control-id
            exit paragraph
            not invalid
            if depkod-kullanma = 1 then
                 move 4         to gec-gecme
               move 1007      to gidis-id
               display message box "Kullanim disi departman"
               exit paragraph

              end-if


       end-read
       modify lb-corrdepadi-e, title = depkod-adi of depkod
       display accept-corrdepkodu.

       move hrkgir-depkod to depkod-kodu dep-dep
       read depkod no lock invalid 
            move 4        to accept-control
            move 1001     to control-id
            exit paragraph
            not invalid 
            if depkod-kullanma = 1 then
                 move 4         to gec-gecme
               move 1001      to gidis-id
               display message box "Kullanim disi departman"
               exit paragraph

              end-if
       end-read
       move 4        to accept-control
       move 1007     to control-id.
     .
*
 grid-yukle.
 grid-baslik-at.
      modify Form1-Gd-1, reset-grid  = 1
                         mass-update = 1.
      initialize form1-gd-1-record
      move "Tarih "       to gd-1-col-1
      move "Dep "         to gd-1-col-2
      move "Dep.Adi "     to gd-1-col-3
      move "Aciklama"     to gd-1-col-4
      move "[TL] Tutar "  to gd-1-col-5
      move "[DV] Tutar "  to gd-1-col-6
      move "Islem No "    to gd-1-col-7
      move "Cek No "      to gd-1-col-8
      move "Zaman "       to gd-1-col-9
      move "Kart No "     to gd-1-col-10
      move "Staf "        to gd-1-col-11
      modify Form1-Gd-1, record-to-add (form1-gd-1-record) 
                         mass-update = 0.
 grid-baslik-at-exit.
      exit.

 grid-detay-yukle.
         open input kllnc nt
      if konuk-fol-kodu = "R"
         initialize romhrk-rec
         move konuk-folio     to romhrk-folio 
         if k-kodu-tasi not = "X    " and   k-kodu-tasi not = "ASYA" then 
            
             move calisma-tarihi  to romhrk-tarih
         end-if
         start romhrk key not < romhrk-anah1 invalid
               continue
         not invalid
               move zeroes to fs-romhrk
          perform with test after until fs-romhrk = "10"
           read romhrk next no lock end move "10" to fs-romhrk
           not at end
               if romhrk-folio <> konuk-folio
                  exit perform 
               end-if
               if romhrk-tarih <> calisma-tarihi
               if k-kodu-tasi not = "X     " and k-kodu-tasi not = "ASYA" then 
                  exit perform cycle
                  end-if
               end-if
               initialize form1-gd-1-record
               move romhrk-gun         to gd-1-col-1(01:02)
               move "/"                to gd-1-col-1(03:01)
               move romhrk-ay          to gd-1-col-1(04:02)
               move "/"                to gd-1-col-1(06:01)
               move romhrk-yil         to gd-1-col-1(07:04)
               move romhrk-depkod      to gd-1-col-2 depkod-kodu
                    read depkod no lock invalid 
                         move "Tanimsiz Departman"  to depkod-adi
                    end-read
                         move depkod-adi to gd-1-col-3
                  initialize not-rec     
                  move  "RHR"     to NOT-DOS
                  move romhrk-anah to  NOT-DOS-ANAH 
                  read nt no lock invalid initialize not1
                  end-read
                  move not1 to gd-1-col-4
               
               

               move romhrk-tl-tutar    to z-tutar
               move z-tutar            to gd-1-col-5
               move romhrk-dv-tutar    to z-tutar
               move z-tutar            to gd-1-col-6
               move romhrk-islem       to gd-1-col-7
               move romhrk-cekno       to gd-1-col-8
               move romhrk-saat        to gd-1-col-9(01:02)
               move ":"                to gd-1-col-9(03:01)
               move romhrk-dakika      to gd-1-col-9(04:02)
               move ":"                to gd-1-col-9(06:01)
               move romhrk-saniye      to gd-1-col-9(07:02)
               move romhrk-kart-no     to gd-1-col-10
               move romhrk-staf        to k-kodu
                    read kllnc no lock invalid 
                         move "Tanimsiz Kullanici"  to k-adi
                    end-read
                         move k-adi to gd-1-col-11
               modify Form1-Gd-1, record-to-add (form1-gd-1-record)
           end-read
          end-perform
         end-start
         else
         initialize exthrk-rec
         move konuk-folio     to exthrk-folio
         if k-kodu-tasi not = "X     "  and k-kodu-tasi not = "ASYA"then 
         move calisma-tarihi  to exthrk-tarih
         end-if
         start exthrk key not < exthrk-anah1 invalid
               continue
         not invalid
               move zeroes to fs-exthrk
          perform with test after until fs-exthrk = "10"
           read exthrk next no lock end move "10" to fs-exthrk
           not at end
               if exthrk-folio <> konuk-folio
                  exit perform 
               end-if
               if exthrk-tarih <> calisma-tarihi
                  if k-kodu-tasi not = "X    " and k-kodu-tasi not = "ASYA" then 
                  exit perform cycle
                  end-if
               end-if
               initialize form1-gd-1-record
               move exthrk-gun         to gd-1-col-1(01:02)
               move "/"                to gd-1-col-1(03:01)
               move exthrk-ay          to gd-1-col-1(04:02)
               move "/"                to gd-1-col-1(06:01)
               move exthrk-yil         to gd-1-col-1(07:04)
               move exthrk-depkod      to gd-1-col-2 depkod-kodu
                    read depkod no lock invalid 
                         move "Tanimsiz Departman"  to depkod-adi
                    end-read
                         move depkod-adi to gd-1-col-3
                       initialize not-rec     
                  move  "EHR"     to NOT-DOS
                  move romhrk-anah to  NOT-DOS-ANAH 
                  read nt no lock invalid initialize not1
                  end-read
                  move not1 to gd-1-col-4
               move exthrk-tl-tutar    to z-tutar
               move z-tutar            to gd-1-col-5
               move exthrk-dv-tutar    to z-tutar
               move z-tutar            to gd-1-col-6
               move exthrk-islem       to gd-1-col-7
               move exthrk-cekno       to gd-1-col-8
               move exthrk-saat        to gd-1-col-9(01:02)
               move ":"                to gd-1-col-9(03:01)
               move exthrk-dakika      to gd-1-col-9(04:02)
               move ":"                to gd-1-col-9(06:01)
               move exthrk-saniye      to gd-1-col-9(07:02)
               move exthrk-kart-no     to gd-1-col-10
               move exthrk-staf        to k-kodu
                    read kllnc no lock invalid 
                         move "Tanimsiz Kullanici"  to k-adi
                    end-read
                         move k-adi to gd-1-col-11

               modify Form1-Gd-1, record-to-add (form1-gd-1-record)
           end-read
          end-perform
         end-start
      end-if.
      modify Form1-Gd-1, mass-update = 0.
      close  kllnc nt.
 grid-detay-yukle-exit.
      exit.
 grid-yukle-exit.
      exit.
*
 Form1-Aft-Routine.
     close kodlar02 depkod acenta yromhrk hrk2.
     close romhrk exthrk konuk onkasa firma.
*
 musteri-oku.
        initialize konuk-uygun
        modify lb-foliono-e title = konuk-folio
        modify fr-foliotipi-e title = konuk-fol-kodu
        modify lb-adi-e     title = konuk-adi
        modify lb-soyadi-e  title = konuk-soyadi

        move konuk-gel-gun      to e-gun
        move konuk-gel-ay       to e-ay 
        move konuk-gel-yil      to e-yil
        modify lb-girtar-e  title = etarih
        
        move konuk-git-gun      to e-gun
        move konuk-git-ay       to e-ay 
        move konuk-git-yil      to e-yil
        modify lb-ciktar-e  title = etarih
        move konuk-acenta to acenta-kodu
        read acenta no lock invalid move acenta-kodu to acenta-adi end-read
         modify lb-acenta   title = acenta-adi
         move konuk-firma to firma-kodu
        read firma no lock invalid initialize firma-rec end-read
          modify lb-firma   title = firma-adi
*        modify lb-not1    title = konuk-not1
*        modify lb-not2    title = konuk-not2
        move "A"            to kodlar02-tipi
        move konuk-pan-tipi to kodlar02-kodu
        read kodlar02 no lock invalid 
             initialize kodlar02-adi 
             not invalid continue
        end-read
        modify fr-pansiyon-e  title = konuk-pan-tipi
        modify lb-pansiyon-e  title = kodlar02-adi

        move "B"            to kodlar02-tipi
        move konuk-odeme-tipi to kodlar02-kodu
        read kodlar02 no lock invalid 
             initialize kodlar02-adi 
             not invalid continue
        end-read
        modify fr-odeme-e  title = konuk-odeme-tipi
        modify lb-odeme-e  title = kodlar02-adi

        move konuk-top-borc     to z-tutar
        modify lb-topborc-e  title = z-tutar
        move konuk-top-alac     to z-tutar
        modify lb-topalacak-e  title = z-tutar
        initialize z-tutar
        compute z-tutar = konuk-top-borc - konuk-top-alac
        modify lb-bakiye-e  title = z-tutar
        compute at-bakiye = konuk-top-borc - konuk-top-alac    
            move at-bakiye to  hrkgir-tl-tutar of hrkgir-rec

*            if konuk-fol-kodu = "R"
*               display message box "Musterinin Oda Foliosunu Sectiniz"
*                                title = " [ Dikkat ] "
*               
*            end-if
            perform not-goster
            .

*
 fisno-al.
    open i-o genelfis
    move 1 to genelfis-anahtar
    read genelfis no lock invalid
         initialize genelfis-rec 
         move 1 to genelfis-anahtar
         not invalid continue 
    end-read
    add 1 to cekgir-oto
    move cekgir-oto to hrkgir-islem
    rewrite genelfis-rec invalid 
            write genelfis-rec 

            end-write continue
    end-rewrite
    close genelfis.
*    modify accept-islemno, color = 3
    display accept-islemno.
*
 tlden-doviz.
       initialize hrkgir-dv-tutar.        
       compute hrkgir-dv-tutar rounded = hrkgir-tl-tutar / islem-kuru.
       move hrkgir-dv-tutar    to z-tutar.
       modify accept-dvtutar  value = z-tutar.
 dovizden-tl.
       
     
       initialize hrkgir-tl-tutar
       compute hrkgir-tl-tutar rounded = hrkgir-dv-tutar * islem-kuru
       move hrkgir-tl-tutar    to z-tutar
       modify accept-tltutar  value = z-tutar.
      .
*
 Form1-Gd-1-Ev-Other.
    initialize Form1-Gd-1-record grid-islemno
    inquire Form1-Gd-1, cursor-y in satir cursor-x in sutun
    inquire Form1-Gd-1(satir),
            record-data in form1-gd-1-record
    move gd-1-col-7    to grid-islemno
    evaluate event-type 
         when msg-begin-entry
             move event-action-fail to event-action,
    end-evaluate.
*
 makbuz-cik.
 rapor-liste-basla.

    move hrkgir-tl-tutar   to tl-z
    move hrkgir-dv-tutar   to dv-z

    open input isyeri
    move isyeri-no-tasi to isyeri-no
    read isyeri no lock invalid 
         move spaces to isyeri-unvan
         not invalid continue
    end-read
    close isyeri.

    open input kllnc.
    move k-kodu-tasi to k-kodu.
    read kllnc no lock invalid 
         move spaces to k-adi k-soyadi
         not invalid continue
    end-read 
    close kllnc.

    open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
          not invalid
          add 1 to print-no
     rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     set  dokumer-yazici-text to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Departman Formu " to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Departman Formu " to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move calis-gun      to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move calis-ay       to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move calis-yil      to det-filler(57:04)
    write dokumer-rec from detay
     initialize dokumer-rec detay
     move "2"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay
      move "3"          to det-dokumer-20(10:1)
      write dokumer-rec from detay
       move "4"          to det-dokumer-20(10:1)
      write dokumer-rec from detay
*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
*     move "E" to dokumer-oto-sayfa-basi
*     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay
     move all "-"  to det-det
     write dokumer-rec from detay

     initialize dokumer-rec detay
     accept sis-zaman from time
     move depkod-adi       to form-adi
     move sis-saat         to l-saat
     move sis-dakika       to l-dakika
     move sis-saniye       to l-saniye
     move calis-gun        to rap-gun
     move calis-ay         to rap-ay
     move calis-yil        to rap-yil
     move liste-baslik   to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move all "-"  to det-det
     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay

*********Oda Bilgisi
     initialize dokumer-rec detay
     move "Oda No:"   to det-det(05:07)
     move "Folio :"   to det-det(20:07)
     move "Adi...:"   to det-det(40:07)
     move "Soyadi:"   to det-det(67:07)
     move konuk-odano         to det-det(12:04)
     move konuk-folio         to det-det(27:08)
     move konuk-adi(01:15)    to det-det(47:15)
     move konuk-soyadi(01:15) to det-det(74:15)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Tutar Bilgisi
     initialize dokumer-rec detay
     move "TL Tutar :"   to det-det(05:10)
     move "DV Tutar :"   TO det-det(40:10)
     move tl-z           to det-det(16:20)
     move dv-z           to det-det(51:20)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Cek-Islem Nosu
     initialize dokumer-rec detay
     move "Cek No...:"   to det-det(05:10)
     move "Islem No.:"   to det-det(30:10)
     move hrkgir-cekno   to det-det(15:10)
     move hrkgir-islem   to det-det(40:08)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Aciklama Bilgisi
     initialize dokumer-rec detay
     move "Aciklama.:"  to det-det(05:10)
     move form-acik     to det-det(15:40)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Duzenleyen Bilgisi
     initialize dokumer-rec detay
     move "Duzenleyen:"   to det-det(05:15)
     move "Imza......:"   to det-det(50:15)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move k-adi(01:15)    to det-det(05:15)
     move k-soyadi(01:15) to det-det(21:15)

     write dokumer-rec from detay
      initialize dokumer-rec detay
     move all "-"  to det-det
     write dokumer-rec from detay


     initialize dokumer-rec detay
     perform 40 times
     write dokumer-rec from detay
     end-perform
     
     

     initialize dokumer-rec detay
     write dokumer-rec from detay

******Ikinci Kez Yaz..........
     initialize dokumer-rec detay
     move all "-"  to det-det
     write dokumer-rec from detay

     initialize dokumer-rec detay
     accept sis-zaman from time
     move depkod-adi       to form-adi
     move sis-saat         to l-saat
     move sis-dakika       to l-dakika
     move sis-saniye       to l-saniye
     move calis-gun        to rap-gun
     move calis-ay         to rap-ay
     move calis-yil        to rap-yil
     move liste-baslik   to det-filler
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move all "-"  to det-det
     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay

*********Oda Bilgisi
     initialize dokumer-rec detay
     move "Oda No:"   to det-det(05:07)
     move "Folio :"   to det-det(20:07)
     move "Adi...:"   to det-det(40:07)
     move "Soyadi:"   to det-det(67:07)
     move konuk-odano         to det-det(12:04)
     move konuk-folio         to det-det(27:08)
     move konuk-adi(01:15)    to det-det(47:15)
     move konuk-soyadi(01:15) to det-det(74:15)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Tutar Bilgisi
     initialize dokumer-rec detay
     move "TL Tutar :"   to det-det(05:10)
     move "DV Tutar :"   TO det-det(40:10)
     move tl-z           to det-det(16:20)
     move dv-z           to det-det(51:20)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Cek-Islem Nosu
     initialize dokumer-rec detay
     move "Cek No...:"   to det-det(05:10)
     move "Islem No.:"   to det-det(30:10)
     move hrkgir-cekno   to det-det(15:10)
     move hrkgir-islem   to det-det(40:08)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Aciklama Bilgisi
     initialize dokumer-rec detay
     move "Aciklama.:"  to det-det(05:10)
     move form-acik     to det-det(15:40)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
*********Duzenleyen Bilgisi
     initialize dokumer-rec detay
     move "Duzenleyen:"   to det-det(05:15)
     move "Imza......:"   to det-det(50:15)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move k-adi(01:15)    to det-det(05:15)
     move k-soyadi(01:15) to det-det(21:15)

     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay
     write dokumer-rec from detay
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move all "-"  to det-det
     write dokumer-rec from detay

     initialize dokumer-rec detay
     write dokumer-rec from detay

     close dokumer
     call dokumer-prog on exception
           perform callerr-proc
     not on exception
     cancel dokumer-prog
     end-call
     delete file dokumer.

 makbuz-cik-exit.
    exit.
*
 pesin-kontrol.
    initialize outlet-cash.
    if onkpara-outlet-cash = zeroes 
       go pesin-kontrol-exit
    end-if.
    if ba-kontrol = "A"
       initialize mesaj-degiskenler
       move "[ Hata ]" to mmesaj-title
       move " Outlet Cash Yapabilmeniz Icin...." to mmesaj-1
       move " [ BORC ] Departmanina Islem Yapiyor  " to mmesaj-2
       move " Olmaniz Gerekir................  " to mmesaj-3
       move 1           to mmesaj-type
       move 1           to mmesaj-icon
       move 1           to mmesaj-default
       perform mmesaj-ver
    end-if. 
    initialize depkod-rec.
    move onkpara-outlet-cash to depkod-anah.
    read depkod no lock invalid 
         initialize mesaj-degiskenler
         move "[ Hata ]" to mmesaj-title
         move " Outlet Cash Departmani Tanimsiz.." to mmesaj-1
         move " Onburo Calisma Parametrelerinden." to mmesaj-2
         move " Tanimlayiniz....................." to mmesaj-3
         move 1           to mmesaj-type
         move 1           to mmesaj-icon
         move 1           to mmesaj-default
         perform mmesaj-ver
    end-read.

    if corr-dep-dep <> zeroes
       display message box
               "Correction departmani alani bos degil",
               icon mb_error_icon
               title "Hata"
               go pesin-kontrol-exit
    end-if

    move "E" to outlet-cash.
    if outlet-cash = "E"
       modify lb-outlet-e title = "Outlet Cash Aktar"
    end-if.
 pesin-kontrol-exit.
    exit.
*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
  not-goster.
      
      if konuk-fol-kodu = "R" 

         move 5 to link-nereden 
         move "REZ"   to  link-NOT-DOS    
         move konuk-rez-no to link-NOT-DOS-ANAH   
         else
         if konuk-extra-rez-no > 0 then
           move 6 to link-nereden 
           move "REZ"   to  link-NOT-DOS    
           move konuk-extra-rez-no to link-NOT-DOS-ANAH    
           else
           move 6 to link-nereden 
           move "KON"   to  link-NOT-DOS    
           move konuk-folio to link-NOT-DOS-ANAH    
           
          end-if

       end-if .
        


             move "K"     to  link-not-islem
             
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
              
                    move  link-not-donus  to  toplam-not
             display not-ac
                           .
*
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
*
 Form2-Aft-Initdata.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
     .

 
