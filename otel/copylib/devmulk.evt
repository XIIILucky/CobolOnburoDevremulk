* devmulk.evt
* devmulk.evt is generated from D:\asya\acugt.ytl\otel\devmulk.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-Form1-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form1-Ta-1-Value
        MOVE 0 TO Form1-Pg-1-Visible, Form1-Pg-2-Visible,
            Form1-Pg-3-Visible, Form1-Pg-4-Visible, Form1-Pg-5-Visible,
            Form1-Pg-6-Visible, Form1-Pg-7-Visible, Form1-Pg-8-Visible,
            Form1-Pg-9-Visible, Form1-Pg-10-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form1-Pg-1-Visible
        WHEN 2
           MOVE 1 TO Form1-Pg-2-Visible
        WHEN 3
           MOVE 1 TO Form1-Pg-3-Visible
        WHEN 4
           MOVE 1 TO Form1-Pg-4-Visible
        WHEN 5
           MOVE 1 TO Form1-Pg-5-Visible
        WHEN 6
           MOVE 1 TO Form1-Pg-6-Visible
        WHEN 7
           MOVE 1 TO Form1-Pg-7-Visible
        WHEN 8
           MOVE 1 TO Form1-Pg-8-Visible
        WHEN 9
           MOVE 1 TO Form1-Pg-9-Visible
        WHEN 10
           MOVE 1 TO Form1-Pg-10-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form1
        PERFORM Form1-Ta-1-Aft-Tabchg-Display
     END-EVALUATE
     .

 Acu-Form3-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form3-Ta-1-Value
        MOVE 0 TO Form3-Pg-1-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form3-Pg-1-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form3
*       After-Tabchg-Display
     END-EVALUATE
     .

 Form1-Exception-Pro2.
     PERFORM Form1-Ex-Other
     .

 acc-mis-no-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        EVALUATE Event-Control-Id
        WHEN 157
           PERFORM acc-mis-no1-Ev-Cmd-Goto
        END-EVALUATE
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 13
           PERFORM Form1-Gd-1-Ev-Other
        WHEN 20
           PERFORM Form1-Gd-2-Ev-Other
        WHEN 56
           PERFORM gd4-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Ta-1-Event-Proc.
     .

 Form1-Exception-Proc.
     .

 Form1-Gd-3-Event-Proc.
     PERFORM Form1-Gd-3-Ev-Other
     .

 Form1-Gd-2-Event-Proc.
     PERFORM Form1-Gd-6-Ev-Other
     .

 Form1-Gd-4-Event-Proc.
     EVALUATE Event-Control-Id
     WHEN 110
        PERFORM Form1-Gd-13-Ev-Other
     END-EVALUATE
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM gf-Ev-Msg-Begin-Entry
     END-EVALUATE
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form3-Cm-1-Event-Proc.
     PERFORM Form3-Cm-1-Ev-Ntf-Selchange
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form4-Gd-1-Event-Proc.
     PERFORM gd-plan-Ev-Other
     .

 Form5-Exception-Proc.
     PERFORM Form5-Ex-Other
     .

 grd-9-Event-Proc.
     PERFORM grd-9-Ev-Other
     .

 grd-9-Exception-Proc.
     PERFORM grd-9-Ex-Other
     .

 Form7-Event-Proc.
     .

 Form7-Exception-Proc.
     PERFORM Form7-Ex-Other
     .

 Form7-Gd-1-Event-Proc.
     PERFORM grd1-Ev-Other
     .

 Form8-Event-Proc.
     .

 Form8-Exception-Proc.
     PERFORM Form8-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.

      perform adresleri-tasi
      move tarih-tasi   to kay-tar
                           sat-tar 
                           bas-yil
      move k-kodu-tasi  to kay-staf

      move yil-tasi to xyil-tasi
      open input genel odalar2
      initialize genel-rec 
      move 1            to genel-anahtar
      read genel no lock invalid 
           display message box "Genel Parametreler Tanimsiz..."
                           title "Uyari"
                           icon 1
                 close genel
                 exit paragraph           
      end-read 
      close genel
      open i-o genelfis
      initialize genelfis-rec 
      move 1   to genelfis-anahtar
      read genelfis no lock invalid 
          continue 
      end-read 
      close genelfis
      move muha-sirketi to hesap-dosya-adres cari-dosya-adres mgenelfis-dosya-adres.
      perform  acuserve-adres-aktar


     .
*
 Form1-Aft-Initdata. 
      OPEN I-O DONHRK sozhrk soztar castdev CLOSE DONHRK sozhrk soztar castdev
      open input kllnc
      initialize kllnc-rec 
      move k-kodu-tasi   to k-kodu
      read kllnc no lock invalid 
           display message box "Kullanici Hatasi..."
                           title "Uyari"
                           icon 1
                 close kllnc
                 exit paragraph 
      end-read
              modify Form1-St-1-Handle, panel-index = 2
                                        panel-text = "Kaydeden Adi:"
             
              modify Form1-St-1-Handle, panel-index = 3
                                        panel-text = k-adi

              modify Form1-St-1-Handle, panel-index = 4
                                        panel-text = "Kaydeden Soyadi:"

              modify Form1-St-1-Handle, panel-index = 5
                                        panel-text = k-soyadi

              modify Form1-St-1-Handle, panel-index = 6
                                        panel-text = "Kayit Tarihi:"
              move kay-gun to egun
              move kay-ay  to eay
              move kay-yil to eyil

              modify Form1-St-1-Handle, panel-index = 7
                                        panel-text = etar
      close kllnc

      call "c$narg" using link-var
        if link-uye-no = 0
           perform fis-al
           perform normal-sabit-default-bul
           perform baslik-yukle
           if link-var = 3
              perform oda-at
           end-if 
        else
          if link-var > 0
            perform form-goruntule
            perform baslik-yukle
            perform grid-yukle
          end-if 
        end-if
       

        perform devre-mesaj-kontrol
        perform tahakkuk-mesaj-kontrol
        perform odeme-mesaj-kontrol

        perform oda-ve-donem-kapat-kontrol

        if genel-devre-tatil-aktif = 1
               modify accept-0112, enabled = false
               |modify Form1-Pb-4, visible = false
        end-if.
        
     if genel-onay = 1 
       perform onay-kontrol
       
      
     end-if.
* 
 oda-ve-donem-kapat-kontrol.
          move 1 to tam-rez-kontrol
          perform donhrk-rez-kontrol
          if donhrk-rez-var = 1  or dev-tatil-soz-var = 1 then
               modify accept-0107 , enabled = false 
               modify accept-0112 , enabled = false 
          else
               modify accept-0107 , enabled = true 
               modify accept-0112 , enabled = true 
          end-if
         .
*
 devre-mesaj-kontrol.
              move 12 to link-nereden 
              move "F"     to  link-not-islem
              move "DEV"   to  link-NOT-DOS    
              move uye-no  to  link-not-dos-anah   
              move 12 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                        using link-not
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/mesajgir.asy"
                   end-call
               initialize grd-not-record
 
               
           perform mesaj-oku
        .
*
 tahakkuk-mesaj-kontrol.
        move "F"     to link-not-islem
        move "AIT"   to link-not-dos    
        move uye-no  to link-not-dos-anah   
        move 12      to link-nereden 
        call "/asya/ytl/obj/otel/mesajgir.asy" using link-not
        on exception 
            perform callerr-proc
            exit paragraph
        not on exception 
        cancel "/asya/ytl/obj/otel/mesajgir.asy" end-call
        initialize grd-not-record
        perform tah-mesaj-oku
        .
*
 odeme-mesaj-kontrol.
        move "F"     to link-not-islem
        move "AIO"   to link-not-dos    
        move uye-no  to link-not-dos-anah   
        move 12      to link-nereden 
        call "/asya/ytl/obj/otel/mesajgir.asy" using link-not
        on exception 
            perform callerr-proc
            exit paragraph
        not on exception 
        cancel "/asya/ytl/obj/otel/mesajgir.asy" end-call
        initialize grd-not-record
        perform ode-mesaj-oku
        .
*
 normal-sabit-default-bul.
         open input prim
         initialize prim-rec
         start prim key not < prim-anah invalid
                 continue
         not invalid
         perform until fs-prim = "10"
         read prim next no lock end move "10" to fs-prim
         not end
             if prim-default = 1 and prim-sabit = 1 then
                move prim-kodu to dev-sabit-prim-kodu 
             end-if
             if prim-default = 1 and prim-sabit = 0 then
                move prim-kodu to dev-prim-kodu 
             end-if
         end-read
         end-perform
         end-start
         display accept-0115 accept-0114
         close prim 
       |  perform prim-oku
        | perform sabit-prim-oku
         .
*        
 form-goruntule.        
      open i-o devremulk kllnc musteri donhrk odalar
      initialize devremulk-rec 
      move link-uye-no                         to devremulk-no uye-no
      read devremulk no lock invalid 
           continue 
      not invalid
           if devremulk-durumu = "S"
              modify button-kaydet,enabled = false
              modify button-sil,enabled = false
              modify Form1-Pb-1,enabled = false
              modify button-odeme,enabled = false
              modify button-taksit,enabled = false
              modify button-taksita,enabled = false
              modify button-prim ,enabled = false
              modify button-prima,enabled = false
              modify button-primaa,enabled = false
              modify button-primaaa,enabled = false
              modify Form1-Pb-1a,enabled = true
              modify Form1-Pb-7,enabled = false
              modify Form1-St-1-Handle, panel-index = 1
                                        panel-text = "Iptal Uye"
              modify LBL-durum , title = "*****  PASIF SOZLESME  *****"
           end-if
            if devremulk-durumu = "K"
              modify button-kaydet,enabled = false
              modify button-sil,enabled = false
              modify Form1-Pb-1,enabled = false
              modify button-odeme,enabled = false
              modify button-taksit,enabled = false
              modify button-taksita,enabled = false
              modify button-prim ,enabled = false
              modify button-prima,enabled = false
              modify button-primaa,enabled = false
              modify button-primaaa,enabled = false
              modify Form1-Pb-1a,enabled = false
              modify Form1-Pb-7,enabled = false
              modify Form1-St-1-Handle, panel-index = 1
                                        panel-text = "Cikan Uye"
              modify LBL-durum , title = "*****  KAPALI SOZLESME  *****"
           end-if
           if devremulk-durumu = "Y"
              modify button-kaydet,enabled = true
              modify button-sil,enabled = true
              modify Form1-Pb-1,enabled = true
              modify button-odeme,enabled = true
              modify button-taksit,enabled = true
              modify button-taksita,enabled = true
              modify button-prim ,enabled = true
              modify button-prima,enabled = true
              modify button-primaa,enabled = true
              modify button-primaaa,enabled = true
              modify Form1-Pb-1a,enabled = false
              modify Form1-Pb-7,enabled = true
              modify Form1-St-1-Handle, panel-index = 1
                                        panel-text = "Aktif Uye"  
              modify LBL-durum , title = "*****  AKTIF SOZLESME  *****"
           end-if
 
           if devremulk-fatura-no not = spaces then
             if devremulk-fatura-no not = zeroes then
               modify devfat-but  ,enabled = false
               modify accept-0107 ,enabled = false
            end-if
           end-if

           move devremulk-devre-donem to ydk-donhrk-donem
           initialize kllnc-rec 
           move devremulk-staf                 to k-kodu
           read kllnc no lock invalid 
                move "Tanimsiz..."             to k-adi k-soyadi 
           end-read 

              modify Form1-St-1-Handle, panel-index = 2
                                        panel-text = "Kaydeden Adi:"
             
              modify Form1-St-1-Handle, panel-index = 3
                                        panel-text = k-adi

              modify Form1-St-1-Handle, panel-index = 4
                                        panel-text = "Kaydeden Soyadi:"

              modify Form1-St-1-Handle, panel-index = 5
                                        panel-text = k-soyadi

              modify Form1-St-1-Handle, panel-index = 6
                                        panel-text = "Kayit Tarihi:"
              move kay-gun to egun
              move kay-ay  to eay
              move kay-yil to eyil

              modify Form1-St-1-Handle, panel-index = 7
                                        panel-text = etar

   
           move DEVREMULK-profil-sirket        to ps1              
           move DEVREMULK-profil-no            to mis-no 


           initialize musteri-rec
           move ps1           to musteri-sirket
           move mis-no        to musteri-no
           read musteri no lock invalid 
                move "      " to musteri-adi musteri-soyadi
           end-read  

                  move all low-values to mis-adi
                  inspect musteri-adi replacing
                     trailing spaces by low-values

                  inspect musteri-soyadi replacing
                     trailing spaces by low-values

                   string mis-adi 
                   musteri-adi delimited by low-values
                   " "      delimited by low-values
                   musteri-soyadi delimited by low-values
                     into mis-adi

           move DEVREMULK-BASLAMA-YIL          to bas-yil          
           move DEVREMULK-BITIS-YIL            to bit-yil          

           move devremulk-oda-no               to o-kisa
           perform oda-uzat
           move o-uzun                         to dev-odano

           move devremulk-tapu-no              to dev-tapu-no      
           move devremulk-oda-konumu           to dev-oda-konumu   
           move devremulk-gun-sayisi           to dev-gun-sayisi   
           move devremulk-devre-donem          to dev-donem        
           move devremulk-aciklama             to dev-aciklama
           move devremulk-satis-tutari         to sat-fiy 
           move devremulk-satis-tarihi         to sat-tar         
           move devremulk-kayit-tarihi         to kay-tar
           move devremulk-hesap-no             to muh-kod
           move devremulk-satan-danisman       to dev-danisman-kodu
           move devremulk-prim-kodu            to dev-prim-kodu 
           move devremulk-sabit-prim-kodu      to dev-sabit-prim-kodu 
           move devremulk-sozlesme-no          to dev-sozlesme-no
           move devremulk-rci-no               to dev-rci-no
           move devremulk-rci-uyesi            to rci-uyesi
           move devremulk-danisman-kendisi     to danisman-satisi
            
           move devremulk-parsel-no            to dev-tap-parsel 
           move devremulk-vekalet-no           to dev-vekalet-no  
           move devremulk-tapu                 to dev-tap-verildi
***************************LuckyXIII*********************************Start 15/08/2017
           move devremulk-fix-aidat            to fix-aidat
***************************LuckyXIII*********************************End
           move devremulk-vekalet              to dev-vekalet-var 
           move devremulk-tapu-ver-tar         to tapu-tar  
           move devremulk-aidat-doviz-kodu     to aidat-doviz
           move devremulk-aidat-tutar          to aidat-fiy
           move devremulk-kdv-oran             to dev-kdv
           move devremulk-tapu-teb-tar         to taput-tar
 
           move devremulk-fatura-no            to dev-fat 

           perform prim-oku
           perform sabit-prim-oku
           perform konum-oku
           perform donem-oku
           perform hesap-oku      
           perform danisman-oku
           perform accept-0115a-Aft-Procedure
           perform guncel-borc-getir
           move devremulk-sozlesme-no to baslik-2
           modify Form1-Handle, TITLE = baslik
      end-read 
      close devremulk kllnc musteri donhrk odalar
      display accept-0101 accept-0102 accept-0103 accept-0104
              accept-0105 accept-0106 accept-0107 accept-0108
              accept-0109  accept-0111 accept-0112 accept-0113
              accept-0114 accept-0115 accept-0121
              accept-0119 accept-0120 acc-ps1 acc-mis-no1 acc-mis-adi Form1-Cb-1
              accept-0108 Form1-Cb-2 accept-0102a accept-0103a accept-0104a accept-0108a
              Form1-Cb-2a Form1-Cb-2 accept-0115a accept-0119a  Form1-Ef-2  Form1-La-4aa
              Form1-Cb-4  accept-0121a Form1-Cb-4a accept-0102aa accept-0103aa accept-0104aa
*      if devremulk-durumu = "S"
*              display message box "Pasif Sozlesme Aktif Yapilacaktir." new-line
*                                  "Eminmisiniz."
*                              title "Uyari"
*                              icon 1
*                              type 2
*                              default 2
*                              returning return-code 
*              if return-code = 2 
*                 set exit-pushed to true  
*                 exit paragraph 
*              end-if 
*              perform kayit-kaydet
* *             perform donhrk-kaydet
*              perform taksit-aktif-yap
*      end-if 
        .

*
 Form1-Ex-Other.
      evaluate key-status
      when 1
           evaluate control-id 
           when 104
           when 5
                perform oda-ara
           when 108
           when 36
                perform konum-ara
           when 114
                perform donem-ara
           when 15
           when 17
                perform hesap-ara
           when 25
           when 27
                perform danisman-ara
           when 29
           when 30
                perform prim-ara
           when 33
           when 34
                perform sabit-prim-ara
           when 61
                perform doviz-ara
           end-evaluate
      when 2
           perform kayit-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Devremulk Kayit Islemi Icin Yetkiniz Bulunmamaktadir !"
              icon 3
              exit paragraph
           end-if                              
           perform  kapali-pasif-kontrol
           if pasif-sozlesme = 1 then
              exit paragraph 
           end-if
           initialize soz-cakisma-var oda-cakisma-var donem-shortta hatali-donem
           if genel-devremulk-cakisma-yok <> 1
              perform devremulk-cakisma-kontrol
           end-if

           if oda-cakisma-var = 1 then 
              display message box "Ayni Oda ve Donem'e Ait Sozlesme Vardir ! , Kayit Yapilamaz !"
              exit paragraph
           end-if

           if hatali-donem = 1 then
              display message box  "Odaya Ait Yanlis Donem Secildi , Olmasi Gereken Donem Baslangici '"olmasi-gereken-prefix "' Olmalidir, Kayit Yapilamaz !"
              exit paragraph
           end-if


           if donem-shortta = 1 then 
              display message box " Oda Hissesi Doludur, Kayit Yapilamaz !"
              exit paragraph
           end-if
           initialize kaydet-hata-var 
           perform kayit-kaydet
           perform donhrk-kaydet
 
           perform donhrk-cast-olustur
           if yildat-duzenle = 1 then
              perform aidat-kaydet-duzenle
           end-if
           if tapu-sms-gonder = 1 or soz-sms-gonder = 1 then
              perform sms-gonder
           end-if 

           if kaydet-hata-var = 1  then 
              exit paragraph
           end-if
           if link-uye-no = zeroes then
              perform prim-yeni-dagit
              perform prim-dagit
              display message box "Primler Otomatik Dagitildi " new-line
                                  "Lutfen Kontrol Ediniz"
                             icon 1
                             type 1
           end-if

           SET EXIT-PUSHED TO TRUE  
    
      when 3
           perform kayit-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Devremulk Kayit Islemi Icin Yetkiniz Bulunmamaktadir !"
              icon 3
              exit paragraph
           end-if  

           perform  kapali-pasif-kontrol
           if pasif-sozlesme = 1  then
              exit paragraph 
           end-if

          |||silme
           initialize prim-var-hata  hata-var
           perform tamamen-odeme-sil-kontrol
           perform tamamen-prim-sil-kontrol
       |  perform dagitilmis-prim-kontrol

           if hata-var = 1 then 
              display message box devremulk-sozlesme-no" ' Nolu Sozlesmeye Ait Odeme Bulundu.." new-line
                                "Sozlesme Silinemez !"
                            title "Uyari"
                            icon 1
              exit paragraph
           end-if

           if prim-var-hata = 1 then 
              display message box devremulk-sozlesme-no" ' Nolu Sozlesmeye Ait Prim Odeme Tahsilati Yapilmis " new-line
                                "Sozlesme Silinemez !"
                            title "Uyari"
                            icon 1
              exit paragraph
           end-if

 
         
           display message box devremulk-sozlesme-no" 'Nolu Sozlesme ile Dagitilmis Primler Tamamen Silinecektir Emin misiniz ?" 
                     title "Uyari"
                     icon 1
                     type 2
                     default 2
                     returning return-code 
           if return-code not = 1 then
              exit paragraph
           end-if
           move 1 to tam-rez-kontrol
           perform  donhrk-rez-kontrol
           initialize tam-rez-kontrol
           if donhrk-rez-var = 1 then
              display message box "Bu Doneme Ait Acilmis Rezervasyonlar Var Sozlesme Silinemez !"
              icon 3
              exit paragraph
           end-if

           perform tamamen-form-taksit-sil
           perform tamamen-donhrk-sil
           perform tamamen-odeme-sil
           perform tamamen-kayit-sil
        
           display message box "Sozlesme Silinmistir !"
                            title "Uyari"
                            icon 1
           set exit-pushed to true

      when 4
           perform  kapali-pasif-kontrol
           if pasif-sozlesme = 1  then
              exit paragraph 
           end-if

           perform yetki-kontrol
           if yetki-yok = 1 then
              display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                 icon 3
              exit paragraph
           end-if
    
           perform odeme-giris-cagir
      when 16
           perform  kapali-pasif-kontrol
           if pasif-sozlesme = 1  then
              exit paragraph 
           end-if

           perform devre-sahibi
      when 5
           perform kapali-pasif-kontrol
           if pasif-sozlesme = 1  then
              exit paragraph 
           end-if
           perform fatura-kontol
           if yetki-yok = 1 then
              display message box "Faturasi Kesilmis Devremulk ! , Bu Islem Yapilamaz "
                         icon 3
                         exit paragraph
           end-if
           perform acu-form3-routine
      when 6
           perform  kapali-pasif-kontrol
           if pasif-sozlesme = 1  then
              exit paragraph 
           end-if
           perform fatura-kontol
           if yetki-yok = 1 then
              display message box "Faturasi Kesilmis Devremulk ! , Bu Islem Yapilamaz "
                         icon 3
                         exit paragraph
           end-if
           perform acu-form4-routine
      when 17
           perform devmulk-log-view
      when 18
           perform kayit-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Devremulk Kayit Islemi Icin Yetkiniz Bulunmamaktadir !"
                icon 3
                exit paragraph
           end-if  
           perform kapali-pasif-kontrol
           if pasif-sozlesme = 1  then
              exit paragraph 
           end-if

           if donhrk-kayit-var = 1 then
              display message box "Donemi Kaldirmadan Sozlesme Pasife Alinamaz !" new-line
                    exit paragraph
           end-if
           initialize pasif-onay
           perform kayit-sil
           perform donhrk-sil
           perform form-taksit-sil

           if pasif-onay = 1 
              display message box "Sozlesme Pasife Alinmistir !" new-line
                   set exit-pushed to true
           end-if
      when 19
           perform kayit-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Devremulk Kayit Islemi Icin Yetkiniz Bulunmamaktadir !"
                icon 3
                exit paragraph
           end-if  

           if devremulk-durumu = "S" and link-uye-no not = zeroes then
              display message box "Pasif Sozlesme ! Islem Yapilamaz ."
              icon 3
              exit paragraph
           end-if

           perform odeme-bul
           perform taksit-bul
           compute kalan-odeme =  taksit-toplam-bul - odeme-toplam-bul  
           if kalan-odeme <> zeroes then
                 display message box "Yapilan Tahsilat Toplami Ile Acilan Taksit Toplama Esit Olmalidir " new-line
                 "Sozlesme Karti Kapatilamaz ! "
                 icon 2
                 title "Asya-Soft Devremulk"
                         exit paragraph
           end-if
        
           initialize link-guncel-borc link-aidat-borc-tl link-aidat-borc-dv link-devremulk-no
           move uye-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devgunsor.asy" using link-devremulk-no link-guncel-borc link-aidat-borc-tl link-aidat-borc-dv
                      on exception perform callerr-proc
                   not on exception
           cancel "/asya/ytl/obj/otel/devgunsor.asy" 
           end-call
        
           if link-aidat-borc-tl <> zeroes then
                display message box "Sozlesme Kartinda Aidat Borcu Bulunmaktadir " new-line
                "Sozlesme Karti Kapatilamaz ! "
                icon 2
                title "Asya-Soft Devremulk"
                         exit paragraph
           end-if

           perform prim-toplam-bakiye-bul
           if prim-toplam-bakiye <> zeroes then
                display message box "Sozlesme Kartinda Bekleyen Prim Odemesi Bulunmaktadir " new-line
                "Sozlesme Karti Kapatilamaz ! "
                icon 2
                title "Asya-Soft Devremulk"
                         exit paragraph

           end-if


           display message box "Sozlesme Karti Kullanima Kapatilip Odasi ve Donemi Kullanima Acilacaktir."new-line
           "Sozlesme Tekrar Isleme Acilmayacaktir !!!" new-line
           "Isleme Devam Etmek Istiyor musunuz ? "
           title "Asya-Soft Devremulk"
           icon 2
           type 2
           default 2
           returning return-code 
           if return-code <> 1 then
                  exit paragraph
           end-if
           
           open i-o devremulk 
           initialize devremulk-rec
           move uye-no to devremulk-no
           read devremulk no lock invalid
                   display message box "Islem Gerceklestirilemediii !!x9"
           not invalid
               move devremulk-devre-donem to devremulk-kapanan-donem
               move "K"        to devremulk-durumu 
               move kay-tar    to devremulk-kayit-tarihi
               rewrite devremulk-rec invalid
                       stop " "
               not invalid
                   open input donhrk donhrk2
                   initialize donhrk-rec 
                     
                   move dev-odano       to o-uzun
                   perform oda-kisalt
                   move o-kisa          to donhrk-oda
                   move dev-donem       to donhrk-kodu
                   move devremulk-no    to donhrk-devremulk-no
                   start donhrk key not < donhrk-anah4 invalid 
                         continue 
                   not invalid 
                   perform with test after until fs-donhrk = "10"
                   read donhrk next no lock end move "10" to fs-donhrk
                   not at end 
                       if dev-odano(5:1) = spaces
                          if dev-odano <> donhrk-oda or
                             ydk-donhrk-donem <> donhrk-kodu or
                             devremulk-no <> donhrk-devremulk-no
                             exit perform
                          end-if
                       else
                          move dev-odano   to o-uzun
                          perform oda-kisalt
                           
                          if o-kisa <> donhrk-oda or
                             ydk-donhrk-donem <> donhrk-kodu or
                             devremulk-no <> donhrk-devremulk-no
                             exit perform
                          end-if
                       end-if
                       initialize donhrk2-rec
                       move donhrk-anah to donhrk2-anah
                       read donhrk no lock invalid
                            stop " "
                       not invalid
                           move 1 to donhrk-donem-kapali
                           rewrite donhrk2-rec  invalid
                               stop " " 
                           end-rewrite
                       end-read  

                   end-read
                   end-perform
                   end-start
                   close donhrk donhrk2
                   perform donhrk-cast-olustur
                   Display message box "Sozlesme Kapatilmistir"
                   close devremulk
                   set exit-pushed to true
               end-rewrite
           end-read
           close devremulk

      when 20
           perform kayit-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Devremulk Kayit Islemi Icin Yetkiniz Bulunmamaktadir !"
                icon 3
                exit paragraph
           end-if  

           if devremulk-durumu = "S"
              display message box "Pasif Sozlesme Aktif Yapilacaktir." new-line
                                  "Eminmisiniz."
                              title "Uyari"
                              icon 1
                              type 2
                              default 2
                              returning return-code 
              if return-code = 2 
                      exit paragraph
              end-if 
              perform kayit-kaydet
              perform donhrk-kaydet
              perform donhrk-cast-olustur
              perform taksit-aktif-yap
              set exit-pushed to true  
           end-if
      when 21
           initialize link-devremulk-no
           move devremulk-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devdonrp.asy" using link-devremulk-no
                    on exception perform callerr-proc
                not on exception
               cancel "/asya/ytl/obj/otel/devdonrp.asy" 
           end-call
      when 22
           initialize link-devremulk-no
           move devremulk-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devairp.asy" using link-devremulk-no
                 on exception perform callerr-proc
             not on exception
            cancel "/asya/ytl/obj/otel/devairp.asy" 
           end-call
      when 23
           initialize link-devremulk-no
           move devremulk-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devodrp.asy" using link-devremulk-no
                 on exception perform callerr-proc
             not on exception
            cancel "/asya/ytl/obj/otel/devodrp.asy" 
           end-call
      when 24
           initialize link-devremulk-no
           move devremulk-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devtkst.asy" using link-devremulk-no
                 on exception perform callerr-proc
             not on exception
            cancel "/asya/ytl/obj/otel/devtkst.asy" 
           end-call
      when 40
           initialize sozhrk-rec soztar-rec
           open input devremulk
           read devremulk no lock invalid
                display message box "Devremulk Kayit Edilmeden Islem Yapilamaz"
                    close devremulk
                    exit paragraph
           end-read
           close devremulk

           if dev-odano = spaces 
              display message box "Devremulk Oda Numarasi Giriniz"   
                    exit paragraph
           end-if

           perform Acu-Form7-Routine
           
           perform baslik-yukle
           perform grid-yukle
      when 978
           initialize link-devremulk-no
           move devremulk-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devfat.asy" using link-devremulk-no
                 on exception perform callerr-proc
             not on exception
            cancel "/asya/ytl/obj/otel/devfat.asy" 
           end-call

           set exit-pushed to true
      when 979
           initialize link-devremulk-no link-bakim-fat
           move devremulk-no to link-devremulk-no
           call "/asya/ytl/obj/otel/devfatya.asy" using link-devremulk-no
                 on exception perform callerr-proc
             not on exception
            cancel "/asya/ytl/obj/otel/devfatya.asy" 
           end-call
      when 1301
           perform aidat-grid-tazele
      when 1001 
           perform prim-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                 icon 3
                 exit paragraph
           end-if

           perform prim-dagit-bul
           if odeme-bulundu = 1
              display message box "Prim Dagitilmis Sozlesmeye Tekrar Prim Dagitilamaz.." new-line
                                  new-line
                                  "Primleri Yeniden Dagit Secenegini Kullaniniz.."
                              title "Uyari"
                              icon 1
                 exit paragraph
           end-if 

           display message box "Prim Dagitilacaktir." new-line
                              "Eminmisiniz.?"
                          title "Uyari"
                          icon 1
                          type 2
                          default 2
                          returning return-code
           if return-code = 2
              exit paragraph 
           end-if 
           perform prim-dagit
           display message box "Primler Dagitildi.." new-line
                              "Kontrol Ediniz."
                          title "Uyari"
                          icon 1
      when 1005
           perform prim-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                 icon 3
                 exit paragraph
           end-if
           display message box "Primler Yeniden Dagitilacaktir."new-line
                              "Eminmisiniz.?"
                          title "Uyari"
                          icon 1
                          type 2
                          default 2
                          returning return-code 
           if return-code = 2
              exit paragraph 
           end-if       
    
           perform prim-yeniden-dagit
           if odeme-bulundu <> 1 
              display message box "Primler Yeniden Dagitildi.." new-line
                               "Kontrol Ediniz."
                           title "Uyari"
                           icon 1
           end-if
      when 5001
           perform prim-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                 icon 3
                 exit paragraph
           end-if
           initialize prim-eskiye-gore
           move 1 to prim-eskiye-gore
           perform prim-eski-dagit
           initialize prim-eskiye-gore
      when 5002
           perform prim-yetki-kontrol
           if yetki-yok = 1 then
              display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                 icon 3
                 exit paragraph
           end-if
           perform prim-yeni-dagit
      when 1302
           initialize link-bakim-fat link-devremulk-no
           move devremulk-no to link-devre-no
           move "B"          to link-fat-turu
           call "/asya/ytl/obj/otel/devfatya.asy" using link-bakim-fat
                 on exception perform callerr-proc
             not on exception
            cancel "/asya/ytl/obj/otel/devfatya.asy" 
           end-call
      end-evaluate.
*
 aidat-grid-tazele.
        perform aidat-baslik-yukle
        perform aidat-grid-yukle
  
     .

*                                               
 tamamen-odeme-sil.
    open i-o odemeler
    initialize odemeler-rec prim-var-hata
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid 
          continue 
    not invalid
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end  

        if odemeler-devremulk-no <> uye-no
              exit perform 
       end-if 
  
        delete odemeler end-delete
        perform log-operation-odemeler
        perform odemesil-yaz

    end-read 
    end-perform
    end-start
    close odemeler  .

*
 devremulk-cakisma-kontrol.
          ||ODAYA AIT PREFIX DONEM ILE UYUSUYOR MU ?

          open input odalar 
          initialize odalar-rec
          move dev-odano to ODALAR-NO
          if dev-odano(5:1) not = space
             move dev-odano to o-uzun
             perform oda-kisalt
             move o-kisa to odalar-anah
          end-if
          read odalar no lock invalid 
                  continue
          not invalid
               move odalar-devre to olmasi-gereken-prefix
               if dev-donem(1:1) not = odalar-devre and dev-donem not = spaces then
                       move 1 to hatali-donem
               end-if
          end-read

          close odalar 
         
          || ODA CAKISMA VARMI BUL
          open input devremulk
          initialize devremulk-rec
          MOVE dev-odano to devremulk-oda-no 
          if dev-odano(5:1) not = space
             move dev-odano to o-uzun
             perform oda-kisalt
             move o-kisa    to devremulk-oda-no
          end-if

          start devremulk key not < devremulk-anah1 invalid

                  continue
          not invalid
          perform until fs-devremulk = "10"
          read devremulk next no lock end move "10" to fs-devremulk
          not end

                  |kendi sozlesmesi icin etkilemesin 
                  if devremulk-durumu not = "Y" then 
                          exit perform cycle
                  end-if

                  if devremulk-no = uye-no then
                        exit perform cycle
                  end-if
                  if dev-odano(5:1) = space
                     if dev-odano not = devremulk-oda-no then
                         | CLOSE devremulk
                        exit perform
                     end-if
                  else 
                     move dev-odano to o-uzun
                     perform oda-kisalt
                     if o-kisa not = devremulk-oda-no then
                         | CLOSE devremulk
                        exit perform
                     end-if
                  end-if
                  if dev-donem not = spaces and dev-donem = devremulk-devre-donem  then
                        move 1 to oda-cakisma-var
                  end-if
           
          end-read
          end-perform
          end-start
          CLOSE devremulk

    
          ||ODA KONTENJAN BULLL...............
          open input devremulk  odalar
          initialize devremulk-rec soz-donem-sayi
          move  dev-odano to devremulk-oda-no
          if dev-odano(5:1) not = space
             move dev-odano to o-uzun
             perform oda-kisalt
             move o-kisa to devremulk-oda-no
          end-if
          start devremulk key not < devremulk-anah1 invalid
                  continue
          not invalid
          perform until fs-devremulk = "10"
          read devremulk next no lock end move "10" to fs-devremulk
          not end
               |kendi sozlesmesi icin etkilemesin 
                  if devremulk-durumu not = "Y" then exit perform cycle end-if

                  if devremulk-no = uye-no then
                        exit perform cycle
                  end-if
                  if dev-odano(5:1) not = spaces
                     move dev-odano to o-uzun
                     perform oda-kisalt
                     if o-kisa not = devremulk-oda-no then
                        exit perform
                     end-if
                  else
                     if dev-odano not = devremulk-oda-no then
                        exit perform
                     end-if
                  end-if
                  move devremulk-oda-no to ODALAR-NO
                  read odalar no lock invalid 
                          continue
                  not invalid
                       if odalar-devre = olmasi-gereken-prefix
                             add 1 to soz-donem-sayi
                       end-if
                  end-read

          end-read
          end-perform
          end-start
          CLOSE devremulk odalar

          || ODANIN FREXININ BUL STARTLA KAC TARIH
           open input donem2

                initialize donem2-rec prefix-sayi
                move olmasi-gereken-prefix to DONEM2-ANAH
                start donem2 key not < donem2-anah invalid
                        continue
                not invalid
                perform until fs-donem2 = "10" 
                read donem2 next no lock end move "10" to fs-donem2
                not end
                      if donem2-kodu(1:1) not = olmasi-gereken-prefix then
                          exit perform
                      end-if
                      add 1 to prefix-sayi
                end-read
                end-perform
                end-start

                if prefix-sayi <= soz-donem-sayi  then
                     move 1 to donem-shortta
                end-if

          close  donem2
         
         .
*
 donhrk-rez-kontrol.
 |KONTROL
       initialize  donhrk-rez-var donhrk-kayit-var
       if dev-donem not = ydk-donhrk-donem or tam-rez-kontrol = 1 then
              open input donhrk donem rez
                   initialize donhrk-rec
                   move dev-odano           to donhrk-oda
                   move ydk-donhrk-donem    to donhrk-kodu
                   move uye-no              to donhrk-devremulk-no
                   if dev-odano(5:1) not = space
                      move dev-odano to o-uzun
                      perform oda-kisalt
                      move o-kisa to donhrk-oda 
                   end-if

                   start donhrk key not < donhrk-anah4 invalid
                           continue
                   not invalid
                   perform until fs-donhrk = "10" 
                   read donhrk next no lock end move "10" to fs-donhrk
                   not end
                          if o-kisa <> donhrk-oda or
                             ydk-donhrk-donem <> donhrk-kodu or
                             uye-no <> donhrk-devremulk-no
                                exit perform
                          end-if
  
                          move 1 to donhrk-kayit-var
                          if ( donhrk-rez-no not = zeroes ) or ( donhrk-tip-donem not = spaces ) then
                             initialize rez-rec 
                             move donhrk-rez-no to rez-no 
                             read rez no lock invalid
                                  exit perform cycle
                             end-read 
                             if rez-durumu = "I" 
                                move 1 to donhrk-rez-var
                                close donhrk donem rez
                                exit paragraph
                             end-if
                          end-if
                   end-read
                   end-perform
                   end-start
           close donhrk donem rez
      end-if.
*
 kayit-kaydet.
      if uye-no = 0
         display message box "Uye Numarasi Giriniz.."
                         title "Uyari"
                         icon 1
              move 1 to kaydet-hata-var
              exit paragraph 
      end-if
      open input  takvim
        initialize hata-var
        move sat-tar      to takvim-anah
        perform tarih-oku
      close takvim

      if hata-var = 1
         display message box "Hatali Satis Tarihi Girdiniz.." new-line
                             "Lutfen Kontrol Ediniz.."
                         title "Uyari"
                         icon 1
                          move 1 to kaydet-hata-var
              exit paragraph          
      end-if
      initialize hata-var
      perform odano-oku
      if hata-var = 1
         display message box "Oda Numarasi Giriniz.."
                         title "Uyari"
                         icon 1
                          move 1 to kaydet-hata-var
              exit paragraph                   
      end-if 
      perform konum-oku
      if hata-var = 1
         display message box "Hatali Konum Girdiniz.."
                         title "Uyari"
                         icon 1
                          move 1 to kaydet-hata-var
              exit paragraph                   
      end-if 
      perform donem-oku
      if hata-var = 1
         display message box "Hatali Donem Girdiniz.."
                         title "Uyari"
                         icon 1
                          move 1 to kaydet-hata-var
              exit paragraph                   
      end-if 
      if dev-odano = spaces
         display message box "Oda Numarasi Giriniz.."
                         title "Uyari"
                         icon 1
                          move 1 to kaydet-hata-var
              exit paragraph          
      end-if 
      if bas-yil < yil-tasi  and link-uye-no = zeroes 
          display message box yil-tasi",Oncesine Yil Giremezsiniz.."
                         title "Uyari"
                          icon 1        
                           move 1 to kaydet-hata-var
              exit paragraph
      end-if
      if bit-yil < yil-tasi and link-uye-no = zeroes 
          display message box yil-tasi",Oncesine Yil Giremezsiniz.."
                          title "Uyari"
                          icon 1     
                           move 1 to kaydet-hata-var
              exit paragraph 
      end-if 
      if dev-sozlesme-no = spaces
    
         display message box "Sozlesme Numarasi Giriniz.."
                         title "Uyari"
                         icon 1
                         move 1 to kaydet-hata-var
              exit paragraph
      end-if 

      perform sozlesme-kontrol
      if hata-var = 1
         display message box "Sozlesme No : "dev-sozlesme-no new-line
                             new-line "Sozlesme Daha Once Kaydedilmis.."
                         title "Uyari"
                         icon 1
                          move 1 to kaydet-hata-var
              exit paragraph 
      end-if 
      initialize tam-rez-kontrol
      perform  donhrk-rez-kontrol
      if donhrk-rez-var = 1 then
               display message box "Bu Doneme Ait Acilmis Rezervasyonlar Var Donem Degistirilemez !"
               icon 3
               exit paragraph
      end-if
      
      display message box "Kaydetmek Istediginizden Eminmisiniz..?"
                      title "Uyari"
                      icon 1
                      type 2
                      default 2
                      returning return-code 
      if return-code = 2
          move 1 to kaydet-hata-var
          exit paragraph 
      end-if
 
      open i-o devremulk
      initialize devremulk-rec
      move uye-no               to devremulk-no
      read devremulk no lock invalid 
           initialize devremulk-rec 
           move uye-no          to devremulk-no
      end-read           
           move ps1             to DEVREMULK-profil-sirket
           move mis-no          to DEVREMULK-profil-no
           move ps2             to DEVREMULK-satan-profil-sirket
           move mis-no2         to DEVREMULK-satan-profil-no
           move ps3             to DEVREMULK-kontak-profil-sirket
           move mis-no3         to DEVREMULK-kontak-profil-no
           move bas-yil         to DEVREMULK-BASLAMA-YIL
           move bit-yil         to DEVREMULK-BITIS-YIL
           move dev-odano       to devremulk-oda-no
           if dev-odano(5:1) not = space
              move dev-odano    to o-uzun
              perform oda-kisalt
              move o-kisa       to devremulk-oda-no
           end-if
           move dev-tapu-no     to devremulk-tapu-no
           move dev-oda-konumu  to devremulk-oda-konumu
           move dev-gun-sayisi  to devremulk-gun-sayisi
           move dev-donem       to devremulk-devre-donem
           move dev-aciklama    to devremulk-aciklama
           move kay-staf        to devremulk-staf
           move "Y"             to devremulk-durumu
           move sat-fiy         to devremulk-satis-tutari
           move sat-tar         to devremulk-satis-tarihi
           move kay-tar         to devremulk-kayit-tarihi
           move muh-kod         to devremulk-hesap-no
           move dev-danisman-kodu to devremulk-satan-danisman
           move dev-prim-kodu     to devremulk-prim-kodu
           move dev-sabit-prim-kodu  to devremulk-sabit-prim-kodu
           move dev-sozlesme-no      to devremulk-sozlesme-no
           move dev-rci-no           to devremulk-rci-no
           move rci-uyesi        to devremulk-rci-uyesi
           move danisman-satisi      to devremulk-danisman-kendisi 
           |fuck the system sy. :D
           move dev-tap-parsel  to devremulk-parsel-no
           move dev-vekalet-no  to devremulk-vekalet-no 
           move dev-tap-verildi to devremulk-tapu
***************************LuckyXIII*********************************Start 15/08/2017
           move fix-aidat       to devremulk-fix-aidat
***************************LuckyXIII*********************************End
           move dev-vekalet-var to devremulk-vekalet
           move tapu-tar        to devremulk-tapu-ver-tar
           move aidat-doviz     to devremulk-aidat-doviz-kodu
           move aidat-fiy       to devremulk-aidat-tutar
           move dev-kdv         to devremulk-kdv-oran
           move taput-tar       to devremulk-tapu-teb-tar
          | move dev-fat         to devremulk-fatura-no  ******kullanilmayacak !         
        write devremulk-rec invalid 
            rewrite devremulk-rec end-rewrite 
        end-write
        perform log-operation-devmulk
      close devremulk

        . 
*
 tamamen-kayit-sil.
      open i-o devremulk
      initialize devremulk-rec 
      move uye-no              to devremulk-no
      read devremulk no lock invalid
           display message box "Silinecek Kayit Bulunamadi..."
                           title "Uyari"
                           icon 1
            close devremulk
            exit paragraph
      not invalid
            delete devremulk end-delete
            perform log-operation-devmulk
      end-read 
          
      close devremulk
       

        .
*
 kayit-sil.
      if uye-no = 0
         display message box "Uye Numarasi Giriniz.."
                         title "Uyari"
                         icon 1
              exit paragraph 
      end-if
      move 1 to tam-rez-kontrol
      perform  donhrk-rez-kontrol
      initialize tam-rez-kontrol
      if donhrk-rez-var = 1 then
               display message box "Bu Doneme Ait Acilmis Rezervasyonlar Var Uyelik Paside Alinamaz!"
               icon 3
               exit paragraph
      end-if
      display message box "Uyeligi Pasife Aliyorsunuz" new-line
                          "Eminmisiniz."
                      title "Uyari"
                      icon 1
                      type 2
                      default 2
                      returning return-code 
      if return-code = 2
          exit paragraph 
      end-if 
      move 1 to pasif-onay
      open i-o devremulk
      initialize devremulk-rec 
      move uye-no              to devremulk-no
      read devremulk no lock invalid
           display message box "Silinecek Kayit Bulunamadi..."
                           title "Uyari"
                           icon 1
            close devremulk
            exit paragraph 
      end-read 
           move "S"        to devremulk-durumu
           move kay-tar    to devremulk-kayit-tarihi
           rewrite devremulk-rec end-rewrite 
           perform log-operation-devmulk
      close devremulk
       
        .
*
*
 tamamen-donhrk-sil.
     if uye-no = 0
        display message box "Uye Numarasi Giriniz.."
                        title "Uyari"
                        icon 1
             exit paragraph 
     end-if
     open i-o donhrk
     initialize donhrk-rec 
     move dev-odano     to donhrk-oda yed-odano
     move dev-donem     to donhrk-kodu
     move uye-no        to donhrk-devremulk-no
     if dev-odano(5:1) not = space
        move dev-odano    to o-uzun
        perform oda-kisalt
        move o-kisa       to donhrk-oda yed-odano
     end-if
     start donhrk key not < donhrk-anah4 invalid 
           continue 
     not invalid 
     perform with test after until fs-donhrk = "10"
     read donhrk next no lock end move "10" to fs-donhrk
     not at end 
           if donhrk-oda <> yed-odano or
              donhrk-kodu <> dev-donem or
              donhrk-devremulk-no <> uye-no
                 exit perform 
           end-if 

           delete donhrk end-delete
           perform log-operation-donhrk
     end-read 
     end-perform
     end-start
     close donhrk.
*
 donhrk-sil.
     if uye-no = 0
        display message box "Uye Numarasi Giriniz.."
                        title "Uyari"
                        icon 1
             exit paragraph 
     end-if
     open i-o donhrk
     initialize donhrk-rec 
     move dev-odano     to donhrk-oda yed-odano
     move dev-donem     to donhrk-kodu
     move uye-no        to donhrk-devremulk-no
     if dev-odano(5:1) not = space
        move dev-odano    to o-uzun
        perform oda-kisalt
        move o-kisa       to donhrk-oda yed-odano
     end-if
     start donhrk key not < donhrk-anah4 invalid 
           continue 
     not invalid 
     perform with test after until fs-donhrk = "10"
     read donhrk next no lock end move "10" to fs-donhrk
     not at end 
           if donhrk-oda <> yed-odano or
              donhrk-kodu <> dev-donem or 
              uye-no <> donhrk-devremulk-no
                 exit perform 
           end-if 

           move "S"        to donhrk-durumu
           rewrite donhrk-rec end-rewrite 
           perform log-operation-donhrk
     end-read 
     end-perform
     end-start
     close donhrk.
*
 fis-al.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
         initialize genelfis-rec
         move 1 to genelfis-anahtar
     end-read
     add 1            to fihrist-oto of genelfis-rec 
     move fihrist-oto of genelfis-rec to uye-no
     rewrite genelfis-rec invalid
         write genelfis-rec, end-write
     end-rewrite
     close genelfis
     display accept-0101
    .
*
 tarih-oku.
     read takvim no lock invalid 
          move 1 to hata-var 
     end-read 
    .
* 
 devre-sahibi.
     move "**"             to aranacak-adi  
     move "**"             to aranacak-soyadi
     move mis-no           to bulunan-profil-no
     move ps1              to bulunan-profil-sirket

     perform profil-cagir

     move bulunan-profil-sirket to ps1
     move bulunan-profil-no     to mis-no

     open input musteri
     initialize musteri-rec mis-adi
     move ps1                   to musteri-sirket
     move mis-no                to musteri-no
     read musteri no lock invalid 
          move "      "         to musteri-adi musteri-soyadi
     end-read 
          string mis-adi
                 musteri-adi delimited by spaces " "
                 " " delimited by size 
                 musteri-soyadi
          into mis-adi
     close musteri

     display acc-ps1 acc-mis-adi acc-mis-no1.
*
 profil-cagir.
       call "/asya/ytl/obj/otel/profbul.asy" using profbul-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/profbul.asy" 
       end-call.
 
*
 acc-mis-no1-Ev-Cmd-Goto.
        if ps1 = zeroes or ps1 = spaces 
            display message box "Profil Bulunamadi....."
                            title "[ Uyari ]"
                            icon 1
             exit paragraph
        end-if
        initialize mis-cagir 
        move mis-no to mis-no-cagir2
        move ps1    to mis-sirket-cagir
        move 2      to mis-kim-cagir
       call "/asya/ytl/obj/otel/musteri.asy" using mis-cagir
            on exception perform callerr-proc
        not on exception
       cancel "/asya/ytl/obj/otel/musteri.asy" 
       end-call.
*
 oda-ara.
      open input odalar
      initialize oda-cagir.
      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odaara.asy" 
      end-call.
      move odano-cagir to o-kisa
      perform oda-uzat
      move o-uzun      to dev-odano
      display accept-0107
      close odalar
      perform odano-oku
      .
*          
 doviz-ara.
      initialize aidat-doviz
      call "/asya/ytl/obj/otel/dovizara.asy" using aidat-doviz
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/dovizara.asy" 
       end-call
       display accept-0115a
         .
*
 odano-oku.
    open input odalar
    initialize odalar-rec 
    move dev-odano          to odalar-anah
    if dev-odano(5:1) not = spaces
       move dev-odano to o-uzun
       perform oda-uzat
       move o-kisa to odalar-anah
    end-if

    read odalar no lock invalid
            move 4   to accept-control
            move 104 to control-id
            move 1   to hata-var
            close odalar
            exit paragraph            
    end-read
        move odalar-konumu   to dev-oda-konumu
        perform konum-oku
    close odalar
    display accept-0109
     .
*
 konum-ara.
      initialize konum-cagir.
      call "/asya/ytl/obj/otel/konumara.asy" using konum-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/konumara.asy" 
       end-call
       move konum-cagir   to dev-oda-konumu
       display accept-0109.
       perform konum-oku.
*
 konum-oku.
       open input konum
       initialize konum-rec 

       move dev-oda-konumu to konum-anahtar
       read konum no lock invalid 
            move 4         to accept-control
            move 108       to control-id
            move 1         to hata-var
            close konum
            exit paragraph
       not invalid 
            move konum-adi to konum-adi-deger 
       end-read
       close konum
       display acc-konum-adi.
*
 donem-ara.
       initialize link-donem-kodu
       call "/asya/ytl/obj/otel/donara.asy" using link-donem-kodu
             on exception
                perform callerr-proc
             not on exception
                cancel "/asya/ytl/obj/otel/donara.asy"               
       end-call
       move link-donem-kodu    to dev-donem    
       display accept-0112
       perform donem-oku.
*
 danisman-ara.
       initialize link-danisman-kodu
       call "/asya/ytl/obj/otel/danisara.asy" using link-danisman-kodu
             on exception
                perform callerr-proc
             not on exception    
                cancel "/asya/ytl/obj/otel/danisara.asy"
                if link-danisman-kodu <> zeroes or 
                   link-danisman-kodu <> spaces
                     move link-danisman-kodu to dev-danisman-kodu
                     display accept-0111
                end-if
       end-call
       perform danisman-oku.
*
 hesap-ara.
         
           initialize hesapara-link
           move MUHA-SIRKETI  to hesapara-isyeri
           move genel-muha-uzak-ip to hesapara-ip-no
           call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
                  on exception 
                     perform callerr-proc
                  not on exception
                     if hesapara-hesap <> spaces 
                        move hesapara-hesap  to muh-kod 
                        display accept-0120
                     end-if
                  cancel "/asya/ytl/obj/otel/hesapara.asy"
             end-call
             perform hesap-oku
    .
*
 donem-oku.
      open input donem2
      initialize donem2-rec
      move dev-donem    to donem2-kodu
      read donem2 no lock invalid 
             initialize  donem-adi-deger
             display acc-donem-adi
             close donem2
             exit paragraph                       
      end-read
            move donem2-adi       to donem-adi-deger
      close donem2
      display acc-donem-adi
     .
*
 aidat-kaydet-duzenle.
     |||duun aidat taksitlerini sill
      OPEN I-O odemeler kur
             
             initialize odemeler-rec son-sira
             move uye-no           to odemeler-devremulk-no
             start odemeler key NOT < odemeler-anah invalid 
                                  continue 
             not invalid 
             perform with test after until fs-odemeler = "10"
             read odemeler NEXT  no lock end move "10"   to fs-odemeler
             not at end 
                      if odemeler-devremulk-no <> uye-no
                          exit perform 
                      end-if
                      evaluate odemeler-islem-turu
                          when "AI"
                            if odemeler-donem-yili = xyil-tasi then
                                  delete odemeler end-delete
                            end-if
                      end-evaluate
             end-read 
             end-perform
             end-start

             initialize odemeler-rec son-sira
             move uye-no           to odemeler-devremulk-no
             move high-values      to odemeler-sira 
             start odemeler key < odemeler-anah invalid 
                  move 1 TO son-sira
                  continue 
             not invalid 
             perform with test after until fs-odemeler = "10"
             read odemeler previous no lock end move "10"   to fs-odemeler
             not at end 
                      if odemeler-devremulk-no <> uye-no
                          move 1 to  son-sira
                          exit perform 
                      end-if
                      if odemeler-sira is not numeric 
                          initialize odemeler-sira 
                      end-if 

                      move odemeler-sira     to son-sira
                      compute son-sira = son-sira + 1
                      exit perform 
             end-read 
             end-perform
             end-start
  
                 initialize odemeler-rec 
                 move uye-no               to odemeler-devremulk-no
                 move son-sira             to odemeler-sira
                 move "AI"                 to odemeler-islem-turu
                 move yil-tasi             to odemeler-tarih-yil
                 move ay-tasi              to odemeler-tarih-ay
                 move gun-tasi             to odemeler-tarih-gun
                 move "B"                  to odemeler-hareket-turu
                 move k-kodu-tasi          to odemeler-prim-staf                            
                 move aidat-fiy            to odemeler-tutar-dv
                 move aidat-doviz          to odemeler-doviz-kodu
                 move "NA"                 to odemeler-odeme-turu 
                 move k-kodu-tasi          to odemeler-staf
                 move 01                   to odemeler-banka-kodu
                 initialize kur-rec
                 move tarih-tasi         to kur-tarih
                 move 01                  to kur-banka
                 move odemeler-doviz-kodu to kur-doviz
                 read kur no lock invalid        
                         initialize odemeler-tutar
                 not invalid
                      compute odemeler-tutar rounded = odemeler-tutar-dv * DOVIZ-ALIS
                 end-read
                
                 move xyil-tasi to odemeler-donem-yili
                 write odemeler-rec invalid 
                       display message box "Odeme Yazilamadi.."
                 end-write

     close odemeler kur.
*
 donhrk-bakim.

      move 1 to tam-rez-kontrol
      perform  donhrk-rez-kontrol
      if donhrk-rez-var = 1 then
               exit paragraph
      end-if

     open i-o donhrk 
     initialize donhrk-rec 
     move dev-donem          to donhrk-kodu
     if dev-odano(5:1) not = space
        move dev-odano to o-uzun
        perform oda-kisalt
        move o-kisa    to donhrk-oda yed-odano
     else 
        move dev-odano          to donhrk-oda  yed-odano
     end-if
     move uye-no             to donhrk-devremulk-no 
     start donhrk key not < donhrk-anah4 invalid 
          continue 
     not invalid 
     perform with test after until fs-donhrk = "10"
     read donhrk next no lock end move "10" to fs-donhrk
     not at end
             if donhrk-kodu <> dev-donem or 
                donhrk-oda <> yed-odano or
                uye-no <> donhrk-devremulk-no 
                 exit perform 
             end-if

            delete donhrk  end-delete
            perform log-operation-donhrk
    end-read 
     end-perform
     end-start
     close donhrk 
         .
*
 donhrk-kaydet.

     perform donhrk-bakim
     
     open i-o donhrk donem
     initialize donem-rec 
     move dev-donem          to donem-kodu
     move bas-yil            to donem-yili
     start donem key not < donem-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-donem = "10"
     read donem next no lock end move "10" to fs-donem
     not at end
             if donem-kodu <> dev-donem
                 exit perform 
             end-if
             if donem-yili > bit-yil 
                 exit perform 
             end-if

             initialize donhrk-rec 
             move dev-odano     to donhrk-oda
             if dev-odano(5:1)  not = space
                move dev-odano  to o-uzun
                perform oda-kisalt
                move o-kisa     to donhrk-oda
             end-if
             move donem-kodu    to donhrk-kodu
             move donem-yili    to donhrk-yili
             move uye-no        to donhrk-devremulk-no
             read donhrk no lock invalid 
                 continue 
             end-read 
                  move donem-bas-tar         to donhrk-bas-tar
                  move donem-bit-tar         to donhrk-bit-tar                                   
                  move devremulk-durumu      to donhrk-durumu            
                  move donem-staf            to donhrk-STAF               
               write donhrk-rec invalid 
                   rewrite donhrk-rec end-rewrite 
               end-write       
               perform log-operation-donhrk
     end-read 
     end-perform
     end-start
     close donhrk donem
      .

*
 donhrk-top-rez-gun-hesapla.
 
     open i-o  donhrk castdon takvim  rez donem
     open input cast

     initialize donem-rec
     move dev-donem      to donem-kodu
     move secili-dev-yil to DONEM-YILI
     start donem key not < donem-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-donem = "10"
     read donem next no lock end move "10" to fs-donem
     not at end
            if dev-donem <> donem-kodu then
                  exit perform
            end-if
            if secili-dev-yil <> DONEM-YILI then
                   exit perform
            end-if

            move donem-kodu     TO donhrk-KODU
            MOVE DONEM-YILI     TO DONHRK-YILI
            MOVE dev-odano      TO DONHRK-ODA
            if dev-odano(5:1) not = space
               move dev-odano to o-uzun
               perform oda-kisalt
               move o-kisa    to donhrk-oda
            end-if            
            move uye-no         TO donhrk-devremulk-no
            move DONEM-BAS-TAR  TO donhrk-BAS-TAR
            move DONEM-BIT-TAR  TO donhrk-BIT-TAR 
            read donhrk no lock invalid
                    continue
            not invalid
                                   
                   initialize rez-rec donhrk-toplam-rez
                   move donhrk-rez-no to rez-no
                   perform gun-bul

                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-2 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-3 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-4 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-5 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                   
                   move donhrk-toplam-rez to donhrk-trez-a-gun 
  
                   perform dev-donem-gun-bul
                   compute donhrk-trez-k-gun = gun-s - donhrk-trez-a-gun

                   if  donhrk-trez-k-gun < 0 then
                         display message box "Acilan Rezervasyonlarin Toplam Gunu , Donem Gununden Buyuktur " new-line
                         "Lutfen Kontrol Ediniz ! ... "
                         icon 3
                   end-if

                   rewrite donhrk-rec invalid
                           stop " "
                   end-rewrite
            end-read

     end-read 
     end-perform
     end-start

     close  donhrk  castdon takvim rez cast donem .
   
*
 gun-bul.
     initialize gun-s 
     read rez no lock invalid
             continue
     not invalid
            if rez-durumu <> "I"
                  exit paragraph
            end-if

            if rez-k-g-b <> "K"
                 exit paragraph
            end-if

            move rez-gir-tar to takvim-anah
            start takvim key not < takvim-anah
                 invalid 
                     continue
                  not invalid
                     perform until fs-takvim = "10"
                        read takvim next no lock
                            end move "10" to fs-takvim
                            not end
                              if takvim-anah >= rez-cik-tar
                                  move "10" to fs-takvim
                                else
                                  add 1 to gun-s                      
                              end-if 
                        end-read
                     end-perform  
            end-start
        end-read .


*
 dev-donem-gun-bul.
       move donhrk-BAS-TAR to takvim-anah
       start takvim key not < takvim-anah
            invalid 
                continue
             not invalid
                perform until fs-takvim = "10"
                   read takvim next no lock
                       end move "10" to fs-takvim
                       not end
                         if takvim-anah >= donhrk-BIT-TAR
                             move "10" to fs-takvim
                           else
                             add 1 to gun-s                      
                         end-if 
                   end-read
                end-perform  
       end-start .

 
* 
 donhrk-cast-olustur.
          perform donhrk-cast-sil
          perform donhrk-cast-kaydet .
*
 donhrk-cast-sil.
      open i-o  castdon 
             initialize castdon-rec 
             move uye-no            to castdon-devremulk-no
             start castdon key not < castdon-anah1 invalid 
                     continue 
             not invalid 
             perform with test after until fs-castdon = "10"
             read castdon next no lock end move "10" to fs-castdon
             not at end

                    if uye-no <> castdon-devremulk-no then
                            exit perform 
                    end-if
                    delete castdon end-delete 
                    perform log-operation-castdon
             end-read 
             end-perform
             end-start
      close castdon
         .
*
 donhrk-cast-kaydet.
     |KONTROL  bakILACAKKKK

|     **************UFFFFFF CUFLEYNNNNNNNNNNNNN
     open i-o  donhrk castdon takvim  rez
     open input cast
     initialize donhrk-rec 
     move dev-donem          to donhrk-kodu
     move dev-odano          to donhrk-oda
     if dev-odano(5:1) not = space
               move dev-odano to o-uzun
               perform oda-kisalt
               move o-kisa    to donhrk-oda
     end-if
     move uye-no             to donhrk-devremulk-no
     start donhrk key not < donhrk-anah4 invalid 
          continue 
     not invalid 
     perform with test after until fs-donhrk = "10"
     read donhrk next no lock end move "10" to fs-donhrk
     not at end
            if donhrk-kodu <> dev-donem or
                donhrk-oda  <> dev-odano or 
                uye-no <> donhrk-devremulk-no 
                       exit perform 
             end-if
           
             if donhrk-donem-kapali = 1 then
                    exit perform cycle 
             end-if

             initialize takvim-anah takvim-sayi
             move donhrk-BAS-TAR to takvim-anah
             start takvim key not < takvim-anah invalid 
                         continue 
             not invalid 
             perform until fs-takvim = "10"
             read takvim next no lock end move "10" to fs-takvim
             not end
                    if takvim-anah = donhrk-BIT-TAR then
                          exit perform
                    end-if

                    add 1 to takvim-sayi

                    initialize castdon-rec
                    move takvim-anah to castdon-tarih
                    move uye-no      to castdon-devremulk-no
                    move donhrk-oda  to castdon-oda-no
                    move donhrk-tip-donem  to CASTDON-TIPI

                    if takvim-sayi <= donhrk-trez-a-gun then
                         move 1 to CASTDON-DOLU
                    else
                         move 0 to CASTDON-DOLU
                    end-if

                    write castdon-rec invalid
                            stop " "
                    end-write
              
                    perform log-operation-castdon
             end-read
             end-perform
             end-start

             |  perform log-operation-donhrk
     end-read 
     end-perform
     end-start
     close  donhrk  castdon takvim rez cast .
*
 cast-oku-castdon-ata.
     read cast no lock invalid
            continue
     not invalid
            move CAST-REZ-NO to castdon-rez-no
            move CAST-ODA-NO to CASTDON-ODA-NO
            add 1 to castdon-ayni-tarih-rez
     end-read .
*
 baslik-yukle.
     modify form1-gd-1,reset-grid = 1
                       mass-update = 1
     if genel-devre-tatil-aktif = 1
        initialize form1-gd-1-record
        move "Yil"       to gd-1-col-1
        move "Bas.Tarihi"    to gd-1-col-2
        move "Bit.Tarihi"    to gd-1-col-3
        move "Sozlesme Tarih" to gd-1-col-4
        move "LOG"           to gd-1-col-6
        move "Aciklama"      to gd-1-col-7
        modify form1-gd-1,record-to-add(form1-gd-1-record)
     else
        initialize form1-gd-1-record
        move "Yil"         to gd-1-col-1
        move "Bas.Tarihi"  to gd-1-col-2
        move "Bit.Tarihi"  to gd-1-col-3
        move "Rezervasyon" to gd-1-col-4
        move "LOG"         to gd-1-col-6
        modify form1-gd-1,record-to-add(form1-gd-1-record)
     end-if

     .
*
 grid-yukle.
         
      if genel-devre-tatil-aktif = 1
        open input sozhrk soztar
        
            initialize dev-tatil-soz-var
            initialize sozhrk-rec kayit-sayi renk-sayi
            move 2 to kayit-sayi
            move uye-no        to sozhrk-devremulk-no
            move dev-odano     to sozhrk-oda yed-odano
            if dev-odano(5:1) not = space
               move dev-odano to o-uzun
               perform oda-kisalt
               move o-kisa    to sozhrk-oda yed-odano
            end-if
            start sozhrk key not < sozhrk-anah invalid 
                  continue 
            not invalid 
            perform with test after until fs-sozhrk = "10"
            read sozhrk next no lock end move "10" to fs-sozhrk
            not at end
                     if sozhrk-oda <> yed-odano or
                        sozhrk-devremulk-no <> uye-no   
                            exit perform 
                      end-if
                     

                      move 1 to dev-tatil-soz-var
                      initialize form1-gd-1-record 

                      move sozhrk-yil      to gd-1-col-1
                
                      move sozhrk-anlasma-gun   to egun
                      move sozhrk-anlasma-ay    to eay
                      move sozhrk-anlasma-yil   to eyil
                      move etar                 to gd-1-col-4
                      move sozhrk-aciklama      to gd-1-col-7
                         
                      modify Form1-Gd-1,record-to-add(form1-gd-1-record)
                      
                      modify form1-gd-1(kayit-sayi ,1),
                             hidden-data sozhrk-anah
                
                      modify form1-gd-1(kayit-sayi ,5),
                             bitmap = barra04-bmp
                             bitmap-width = 16
                             bitmap-number = 15
            
                       
                      initialize soztar-rec soz-tar-var soz-tar-kayit-say
                      move sozhrk-devremulk-no  to soztar-devremulk-no
                      move sozhrk-oda           to soztar-oda
                      move sozhrk-yil           to soztar-yil
                      move sozhrk-anlasma-tarih to soztar-anlasma-tarih
                      start soztar key not < soztar-anah invalid 
                            continue 
                      not invalid 
                      perform with test after until fs-soztar = "10"
                      read soztar next no lock end move "10" to fs-soztar
                      not at end
                                                        
                              if soztar-devremulk-no    <> sozhrk-devremulk-no 
                                or soztar-oda           <> sozhrk-oda
                                or soztar-yil           <> sozhrk-yil 
                                or soztar-anlasma-tarih <> sozhrk-anlasma-tarih        
                                   if soz-tar-kayit-say = 0
                                           add 1 to kayit-sayi
                                   end-if
                                   exit perform
                              end-if

                              move 1 to soz-tar-var 
                              add 1 to soz-tar-kayit-say 

                              move soztar-bas-gun    to egun
                              move soztar-bas-ay     to eay
                              move soztar-bas-yil    to eyil
                              move etar              to gd-1-col-2

                              move soztar-bit-gun    to egun
                              move soztar-bit-ay     to eay
                              move soztar-bit-yil    to eyil
                              move etar              to gd-1-col-3
                
                              if soz-tar-kayit-say > 1
                                    initialize gd-1-col-1 gd-1-col-4 gd-1-col-7
                              end-if
                        
                              if soz-tar-kayit-say = 1
                                      modify Form1-Gd-1(kayit-sayi ,2),cell-data = gd-1-col-2 
                                      modify Form1-Gd-1(kayit-sayi ,3),cell-data = gd-1-col-3 
                              else
                                      modify Form1-Gd-1,record-to-add(form1-gd-1-record)
                              end-if

                              add 1 to kayit-sayi
                      end-read
                      end-perform
                      end-start
            end-read
            end-perform
            end-start
        

        close sozhrk soztar

     else
        open input donhrk rez konuk
        initialize donhrk-rec kayit-sayi renk-sayi
        move dev-odano     to donhrk-oda yed-odano
            if dev-odano(5:1) not = space
               move dev-odano to o-uzun
               perform oda-kisalt
               move o-kisa    to donhrk-oda yed-odano
            end-if
        move dev-donem     to donhrk-kodu
*       move uye-no        to donhrk-devremulk-no
*       start donhrk key not < donhrk-ANAH4 invalid 
        start donhrk key not < donhrk-ANAH invalid 
              continue 
        not invalid 
        perform with test after until fs-donhrk = "10"
        read donhrk next no lock end move "10" to fs-donhrk
        not at end 
              if donhrk-oda <> yed-odano or
                 donhrk-kodu <> dev-donem 
                    exit perform 
              end-if   

              if uye-no <> donhrk-devremulk-no 
                   exit perform cycle
              end-if
        
              add 1                   to kayit-sayi renk-sayi
              initialize form1-gd-1-record
              move donhrk-yili        to gd-1-col-1
        
              move donhrk-bas-gun     to egun
              move donhrk-bas-ay      to eay
              move donhrk-bas-yil     to eyil
              move etar               to gd-1-col-2
        
              move donhrk-bit-gun     to egun
              move donhrk-bit-ay      to eay
              move donhrk-bit-yil     to eyil
              move etar               to gd-1-col-3
        
              Move "*** Rez. Listesi ***"     to gd-1-col-4
        
              evaluate donhrk-tip-donem
              when "S"
                   move "SATILAN DONEM"     to gd-1-col-7 
              when "K"
                   move "KIRALANAN DONEM"   to gd-1-col-7
              when other
                   move "NORMAL DONEM"      TO gd-1-col-7 
              end-evaluate
        
              modify form1-gd-1,
                     record-to-add(form1-gd-1-record)
              modify form1-gd-1(kayit-sayi + 1,2),
                     hidden-data donhrk-bas-tar
              modify form1-gd-1(kayit-sayi + 1,3),
                     hidden-data donhrk-bit-tar
        
              modify form1-gd-1(kayit-sayi + 1,5),
                     bitmap = barra04-bmp
                     bitmap-width = 16
                     bitmap-number = 15
        
              evaluate donhrk-tip-donem
              when "S"
                   modify form1-gd-1(renk-sayi + 1),
                          row-color = 480
              when "K"
                   modify form1-gd-1(renk-sayi + 1),
                          row-color = 176
              end-evaluate
              
        
        end-read 
        end-perform
        end-start
        close donhrk rez konuk
     end-if
     modify form1-gd-1,mass-update = 0.

*
 Form1-Gd-1-Ev-Other.
     evaluate event-type
     when msg-begin-entry
          move event-action-fail to event-action
           evaluate event-data-1
          when 4
             if genel-devre-tatil-aktif = 1
                     initialize sozhrk-anah
                     inquire Form1-Gd-1(event-data-2,1),hidden-data in sozhrk-anah
                     if sozhrk-anah not = spaces
                             perform Acu-Form7-Routine

                             perform baslik-yukle
                             perform grid-yukle
                     end-if
             else
                     inquire Form1-Gd-1(event-data-2,1),cell-data in secili-dev-yil
                     perform Acu-Form6-Routine
             end-if
         end-evaluate
          move event-action-fail to event-action
     when msg-bitmap-clicked
          evaluate event-data-1
          when 5
           if genel-devre-tatil-aktif = 1
                perform sozhrk-log-view
           else
                perform donhrk-log-view
           end-if
            
          end-evaluate 
     end-evaluate     
     .
*
 Form1-Mn-1-MI-Kiralil-Link. 
         perform kapali-pasif-kontrol
         if pasif-sozlesme = 1  then
                 exit paragraph 
         end-if

             open i-o donhrk
             initialize donhrk-rec 
             inquire form1-gd-1,
                        cursor-x         in end-x
                        cursor-y         in end-y            
             inquire form1-gd-1(end-y,1)cell-data in donhrk-yili
             move dev-odano         to donhrk-oda
            if dev-odano(5:1) not = space
               move dev-odano to o-uzun
               perform oda-kisalt
               move o-kisa    to donhrk-oda 
            end-if
             move dev-donem         to donhrk-kodu
             move uye-no            to donhrk-devremulk-no
             read donhrk no lock invalid 
                  display message box "Kayit Bulunamadi.."
                                  title "Uyari"
                                  icon 1
                    close donhrk
                    exit paragraph
             not invalid
                 evaluate key-status
                     when 1000
                           move "K" to donhrk-tip-donem
                     when 1002
                           move "S" to donhrk-tip-donem
                     when 1003
                           initialize donhrk-tip-donem
                  end-evaluate
                  rewrite donhrk-rec end-rewrite 
                  perform log-operation-donhrk
             end-read 
             close donhrk
             perform donhrk-cast-olustur
             perform baslik-yukle
             perform grid-yukle
             perform oda-ve-donem-kapat-kontrol
             .


 

*
 oda-at.
     move link-odano    to o-kisa 
     perform oda-uzat
     move o-uzun        to dev-odano
     
     move link-donem    to dev-donem
     display accept-0107 accept-0112
      .
*
 acuserve-adres-aktar.
    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres                                
                         REFERANS-DOSYA-adres     
                         mgenel-DOSYA-adres       

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA
                           ip-no.

    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.

  
    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    

    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values
    . 
*
 hesap-oku.
    open input hesap
    initialize hesap-rec 
    move muh-kod    to hesap-kodu
    read hesap no lock invalid 
         move "Tanimsiz..."  to hesap-adi
    end-read 
         move hesap-adi      to muh-adi
    close hesap
    display acc-muh-adi
    .
*
 odeme-baslik-yukle.
    modify form1-gd-2,reset-grid = 1
                      mass-update = 1
    initialize form1-gd-2-record
    move "Sira"     to gd-2-col-0
    move "Tarih"    to gd-2-col-1
    move "B/A"      to gd-2-col-2
    move "I.Turu"   to gd-2-col-3
    move "Tutar"    to gd-2-col-4
    move "O.Turu"   to gd-2-col-5
    move "Belge No" to gd-2-col-6
    move "Dzl"      to gd-2-col-7

    move "Banka"    to gd-2-col-8
    move "LOG"      to gd-2-col-9
    move "Mkbz"     to Gd-2-Col-10
    move "Vade"     to Gd-2-Col-12
    move "Fat No"     to Gd-2-Col-13
    modify form1-gd-2,record-to-add(form1-gd-2-record)
     .
*
 odeme-grid-yukle.    
    open i-o odemeler banka odemetip cek
    initialize odemeler-rec odeme-sayi alinmadi-sayi borc-var alt-toplam
    move 1                to kayit-sayi
    move uye-no           to odemeler-devremulk-no
    start odemeler key not < odemeler-dev-tar invalid
          continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
           if odemeler-devremulk-no <> uye-no
               exit perform 
           end-if
           if odemeler-hareket-turu <> "A"
               exit perform cycle 
           end-if 
            initialize form1-gd-2-record
           evaluate odemeler-islem-turu
           when "SO"
               move  "SATIS ODEMESI"            to gd-2-col-3 
           when "IO"
               move  "IPTAL ODEMESI"            to gd-2-col-3 
           when "SP"               
           when "NP"               
           when "PM"
           when "AG"               
           when "DP"                
           when "GS"               
           when "GN"
           WHEN "PP"
           WHEN "SS"
           when "AV"
           when "AO"
           when "AI"
           when "BO"
           when "BK"
                   exit perform cycle 
           when "FO"
               move  "FATURA ODEMESI"           to gd-2-col-3                 
           when "PI"
               move  "PARA IADESI"              to gd-2-col-3 
           WHEN OTHER 
               move  odemeler-islem-turu        to gd-2-col-3 
           end-evaluate

           add 1                      to odeme-sayi 
                                         alinmadi-sayi 
                                         kayit-sayi
           
           move odemeler-sira         to z-sira
           move z-sira                to gd-2-col-0
           move odemeler-tarih-gun    to egun
           move odemeler-tarih-ay     to eay
           move odemeler-tarih-yil    to eyil
           move etar                  to gd-2-col-1

           move odemeler-hareket-turu to gd-2-col-2


           move odemeler-tutar                  to etut
           move etut                            to gd-2-col-4
           compute alt-toplam = alt-toplam + odemeler-tutar

           initialize odemetip-rec
           move odemeler-odeme-turu      to odemetip-anah
           read odemetip no lock invalid 
                move "     "             to odemetip-adi
           end-read 
                move odemetip-adi        to gd-2-col-5

           move odemeler-cekno           to gd-2-col-6

           move odemeler-fatura-no    to 8-z
           move 8-z                   to Gd-2-Col-13
           initialize banka-rec
           move odemeler-banka-kodu      to banka-kodu
           read banka no lock invalid  
                move "     "             to banka-adi
           end-read 
                move banka-adi           to gd-2-col-8

           move odemeler-cek-isl-no to cek-isl-no 
           read cek no lock invalid
                   continue
           end-read

           move cek-vade-gun          to egun
           move cek-vade-ay           to eay
           move cek-vade-yil          to eyil
           move etar                  to gd-2-col-12

           modify form1-gd-2(kayit-sayi,10)
                  bitmap = barra04-bmp
                  bitmap-width = 16
                  bitmap-number = 9

           modify form1-gd-2(kayit-sayi,11)
                  bitmap = barra04-bmp
                  bitmap-width = 16
                  bitmap-number = 15 

           modify form1-gd-2(kayit-sayi,12)
                  bitmap = print-bmp
                  bitmap-width = 16
                  bitmap-number = 1
           modify form1-gd-2,
                   record-to-add(form1-gd-2-record)

           modify form1-gd-2(kayit-sayi,7),
                  hidden-data odemeler-cek-isl-no
    end-read 
    end-perform
    end-start
    close odemeler banka odemetip  cek
    if alt-toplam > 0
       add 1 to kayit-sayi
       initialize form1-gd-2-record
       move "Toplam->"    to gd-2-col-3
       move alt-toplam    to etut
       move etut          to gd-2-col-4
       modify form1-gd-2,record-to-add(form1-gd-2-record)
       modify form1-gd-2(kayit-sayi),
       row-color = 480
    end-if 
    modify form1-gd-2,mass-update = 0
     .
*
 prim-baslik-yukle.
    modify form1-gd-6,reset-grid = 1
                      mass-update = 1
    initialize gd-prim-rec
    move "Sira"     to gd-6-col-0
    move "Tarih"    to gd-6-col-1
    move "B/A"      to gd-6-col-2
    move "I.Turu"   to gd-6-col-3
    move "Tutar"    to gd-6-col-4
    move "O.Turu"   to gd-6-col-5
    move "Prim Ted." to gd-6-col-6
    move "Danisman" to gd-6-col-7
    move "Gorevi"   to gd-6-col-8
    move "STAF"     to Gd-6-Col-9
    move "Prnt"     to Gd-6-Col-10
    modify form1-gd-6,record-to-add(gd-prim-rec)
     .
*
 prim-grid-yukle.    
    open i-o odemeler danisman gorev devremulk odemetip
    initialize odemeler-rec odeme-sayi alinmadi-sayi borc-var alt-toplam  kayit-sayi
    move 1                to kayit-sayi
    move uye-no           to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid
          continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
           if odemeler-devremulk-no <> uye-no
               exit perform 
           end-if
           if odemeler-hareket-turu <> "A"
               exit perform cycle 
           end-if
           initialize gd-prim-rec
           evaluate odemeler-islem-turu
           when "SO"                  
           when "IO"
           when "FO"
           when "PI"  
           when "AI"
           WHEN "AO"
           WHEN "BO"
           WHEN "BK"
                exit perform cycle 
           when "SP"
                     move  "SABIT PRIM ODEMESI" to gd-6-col-3
           when "NP"
                   move  "PRIM ODEMESI" to gd-6-col-3 
           when "PM"
               move  "PERSONEL MAAS PRIMLERI" to gd-6-col-3  
           when "AV"
               move  "AVANS ODEMESI" to gd-6-col-3 
           when "AG"
               move  "AVANS GERI ODEMESI" to gd-6-col-3
           when "DP"
               move  "DIGER PRIM ODEMELERI" to gd-6-col-3 
           when "GS"
               move  "SABIT PRIM GERI ODEMESI" to gd-6-col-3 
           when "GN"
               move  "PRIM GERI ODEMESI" to gd-6-col-3 
           when "PP"
               move "NETWORK PRIM"       to gd-6-col-3
           when "SS"
               move "SABIT PRIM"         to gd-6-col-3
           WHEN OTHER 
               move odemeler-islem-turu  to gd-6-col-3      
           end-evaluate

           add 1                      to odeme-sayi alinmadi-sayi kayit-sayi
           
           move odemeler-sira         to z-sira
           move z-sira                to gd-6-col-0
           move odemeler-tarih-gun    to egun
           move odemeler-tarih-ay     to eay
           move odemeler-tarih-yil    to eyil
           move etar                  to gd-6-col-1

           move odemeler-hareket-turu to gd-6-col-2

           move odemeler-tutar        to etut
           move etut                  to gd-6-col-4
           compute alt-toplam = alt-toplam + odemeler-tutar

           initialize odemetip-rec
           move odemeler-odeme-turu   to odemetip-anah
           read odemetip no lock invalid 
                move "    "   to odemetip-adi
           end-read 
                move odemetip-adi to gd-6-col-5

           move odemeler-prim-isl-no         to z-sayi
           move z-sayi                       to gd-6-col-6

 
           initialize danisman-rec gd-6-col-7
           move odemeler-danisman-kodu to danisman-kodu
           read danisman no lock invalid 
                move "         " to danisman-adi danisman-soyadi
           end-read 
                string gd-6-col-7
                     danisman-adi delimited by spaces " "
                     danisman-soyadi delimited by size 
                into gd-6-col-7
 

           initialize gorev-rec
           move danisman-gorev-kodu  to gorev-kodu
           read gorev no lock invalid 
                move "       "   to gorev-adi
           end-read 
                move gorev-adi       to gd-6-col-8
                move odemeler-staf to Gd-6-Col-9

    

           modify form1-gd-6,record-to-add(gd-prim-rec)

           evaluate odemeler-islem-turu
           when "AV"
           when "AG"
                  modify form1-gd-6(kayit-sayi,10)
                  bitmap = print-bmp
                  bitmap-width = 16
                  bitmap-number = 1
           when other 
                   continue
           end-evaluate


          

 
    end-read 
    end-perform
    end-start
    close odemeler danisman gorev devremulk odemetip
    if kayit-sayi > 1
       add 1 to kayit-sayi
       initialize gd-prim-rec
       move "Toplam->"    to gd-6-col-3
       move alt-toplam    to etut
       move etut          to gd-6-col-4
       modify form1-gd-6,record-to-add(gd-prim-rec)
       modify form1-gd-6(kayit-sayi),
       row-color = 480
    end-if 
    modify form1-gd-6,mass-update = 0
     .
*
 taksit-baslik-yukle.
    modify form1-gd-3,reset-grid = 1
                      mass-update = 1
    initialize form1-gd-3-record
    move "Sira"     to gd-3-col-1
    move "Gun"      to gd-3-col-2
    move "Ay"       to gd-3-col-3
    move "Yil"      to gd-3-col-4
    move "O.Turu"   to gd-3-col-5
    move "Tutar"    to gd-3-col-6
    move "T.Sekli"  to gd-3-col-7
    move "Odenen"   to gd-3-col-8
    move "Fark"     to gd-3-col-9
    move "LOG"      to gd-3-col-10
    modify form1-gd-3,record-to-add(form1-gd-3-record)
     .
*
 taksit-grid-yukle. 
    perform odeme-bul
    open i-o taksit 
    initialize taksit-rec tahsilat-bitti alt-toplam odenen-toplam fark-hesapla
    move 1              to kayit-sayi
    move uye-no         to taksit-devremulk-no
    start taksit key not < taksit-dev-tarih invalid 
         continue 
    not invalid 
    perform with test after until fs-taksit = "10"
    read taksit next no lock end move "10" to fs-taksit
    not at end
 
            if taksit-devremulk-no <> uye-no
                exit perform 
            end-if
 
            add 1                        to kayit-sayi
            initialize form1-gd-3-record fark-hesapla
            move taksit-sira             to z-sira
            move z-sira                  to gd-3-col-1
            move taksit-tarih-gun        to gd-3-col-2
            move taksit-tarih-ay         to gd-3-col-3
            move taksit-tarih-yil        to gd-3-col-4

            evaluate taksit-odeme-turu
            when "CE"
                move "CE-Cek"            to gd-3-col-5
            when "KK"
                move "KK-Kredi Karti"    to gd-3-col-5
            when "NA"
                move "NA-Nakit"          to gd-3-col-5
            end-evaluate
            
            move taksit-tutar            to etut
            move etut                    to gd-3-col-6

            compute alt-toplam = alt-toplam + taksit-tutar

            evaluate taksit-sekli
            when "K"
                 move "K-Kapora Odemesi"  to gd-3-col-7
            when "P"
                 move "P-Pesinat Odemesi" to gd-3-col-7
            when "N"
                 move "N-Taksit Odemesi"  to gd-3-col-7
            end-evaluate
            if tahsilat-bitti = 1
               move taksit-tutar          to etut
               move etut                  to gd-3-col-9
            end-if 

            if odeme-toplam-bul > 0 and 
               taksit-tutar > 0  and 
               tahsilat-bitti = 0
                  if taksit-tutar <= kalan-odeme 
                     move taksit-tutar    to etut
                     move etut            to gd-3-col-8
                     compute odenen-toplam = 
                             odenen-toplam + taksit-tutar
                     modify form1-gd-3(kayit-sayi),
                            row-color = 112
                  else 
                     if kalan-odeme = 0
                        move taksit-tutar    to etut
                        move etut            to gd-3-col-9
                        move 1               to tahsilat-bitti
                     else
                        move kalan-odeme     to etut
                        move etut            to gd-3-col-8
                        move 1               to tahsilat-bitti
                        compute odenen-toplam = 
                                odenen-toplam + kalan-odeme
                        if kalan-odeme <> 0                             
                           compute fark-hesapla = 
                                   taksit-tutar - kalan-odeme
                           move fark-hesapla  to etut
                           move etut          to gd-3-col-9
        
                           modify form1-gd-3(kayit-sayi),
                                  row-color = 176
                        end-if 
                        
                     end-if 
                  end-if 
                  
                  compute kalan-odeme = 
                          kalan-odeme - taksit-tutar
            end-if
            modify form1-gd-3,
                   record-to-add(form1-gd-3-record)

           modify form1-gd-3(kayit-sayi,10),
                  bitmap = barra04-bmp
                  bitmap-width = 16
                  bitmap-number = 15

    end-read 
    end-perform
    end-start
    close taksit
    if alt-toplam > 0
       initialize form1-gd-3-record
       add 1              to kayit-sayi
       move "Toplam->"    to gd-3-col-5
       move alt-toplam    to etut
       move etut          to gd-3-col-6
       move odenen-toplam to etut
       move etut          to gd-3-col-8
           ||||syyy04012013
       compute toplam-kalan-odeme =  alt-toplam - odenen-toplam
       if toplam-kalan-odeme >= 0 then
           move toplam-kalan-odeme to etut
           move etut          to gd-3-col-9
       end-if
       |||

       modify form1-gd-3,record-to-add(form1-gd-3-record)
       modify form1-gd-3(kayit-sayi),row-color = 480

   

    end-if 
    if kalan-odeme > 0
       add 1              to kayit-sayi
       initialize form1-gd-3-record
       move "Fazla Odeme" to gd-3-col-5
       move kalan-odeme   to etut
       move etut          to gd-3-col-8
       modify form1-gd-3,record-to-add(form1-gd-3-record)
       modify form1-gd-3(kayit-sayi),row-color = 208 
    end-if
    modify form1-gd-3,mass-update = 0
     .
*
 odeme-bul.
    open i-o odemeler
            initialize odemeler-rec odeme-toplam-bul kalan-odeme
            move uye-no            to odemeler-devremulk-no
            start odemeler key not < odemeler-anah invalid 
                 continue 
            not invalid 
            perform with test after until fs-odemeler = "10"
            read odemeler next no lock end move "10" to fs-odemeler
            not at end 
                     if odemeler-devremulk-no <> uye-no
                         exit perform 
                     end-if
                     if odemeler-hareket-turu <> "A"
                         exit perform cycle 
                     end-if
                   evaluate odemeler-islem-turu
                   when "SO"
                       continue 
                   when "IO"
                       continue 
                   when "SP"               
                   when "NP"               
                   when "PM"
                   when "AG"               
                   when "DP"                
                   when "GS"               
                   when "GN"
                   WHEN "PP"
                   WHEN "SS"
                   when "AV"
                   WHEN "AI"
                   WHEN "AO"
                   WHEN "BO"
                        exit perform cycle 
                   when "FO"
                       continue                 
                   when "PI"
                       continue 
                   WHEN OTHER 
                       exit perform cycle 
                   end-evaluate
                     compute odeme-toplam-bul = odeme-toplam-bul + odemeler-tutar
                     move odeme-toplam-bul to kalan-odeme
            end-read 
            end-perform
            end-start
    close odemeler
     .
*
 taksit-bul.
    open input taksit
            initialize taksit-rec taksit-toplam-bul 
            move uye-no            to taksit-devremulk-no
            start taksit key not < taksit-anah invalid 
                 continue 
            not invalid 
            perform with test after until fs-taksit = "10"
            read taksit next no lock end move "10" to fs-taksit
            not at end 
                     if taksit-devremulk-no <> devremulk-no
                         exit perform  
                     end-if
                     compute taksit-toplam-bul = taksit-toplam-bul + taksit-tutar
            end-read 
            end-perform
            end-start
    close taksit
     .

*
 Form1-Gd-2-Ev-Other.
     evaluate event-type
     when msg-goto-cell-mouse
          initialize link-cek-isl-no link-odeme-sira link-odeme-uye-no
          inquire form1-gd-2(event-data-2,7), hidden-data link-cek-isl-no
          inquire form1-gd-2(event-data-2,1),cell-data in link-odeme-sira
          move uye-no                      to link-odeme-uye-no

     when msg-bitmap-clicked 
          evaluate event-data-1
          when 10
               perform kapali-pasif-kontrol
               if pasif-sozlesme = 1  then
                    exit paragraph 
               end-if
               perform yetki-kontrol
               if yetki-yok = 1 then
                         display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                         icon 3
                         exit paragraph
               end-if
                 perform fatura-kontol
                 if yetki-yok = 1 then
                         display message box "Faturasi Kesilmis Devremulk ! , Bu Islem Yapilamaz "
                         icon 3
                         exit paragraph
                 end-if
              perform odeme-yeniden-dagit
          when 11
              perform odemeler-log-view
          when 12
              perform odemeler-makbuz 
          end-evaluate
     end-evaluate 
     .

*
 Form3-Bef-Create.
      move tarih-tasi  to kap-tar pes-taksit-basla-tar taksit-basla-tar
     
     .
*
 Form3-Aft-Initdata.
      move sat-fiy     to dev-pes-tut dev-sat-tut
      display accept-0304
      perform ucret-hesapla

      perform devremulk-fiyat-bul

     .
* 
 devremulk-fiyat-bul.
          open input devfiyat
          initialize devfiyat-rec
          move dev-oda-konumu to devfiyat-konum-kodu
          read devfiyat no lock invalid
                  initialize dev-pesgir-tut dev-sat-tut
                  continue

          not invalid
                  if cmb-pesin-taksit(1:2) = "01" then
                          move devfiyat-pesin           to dev-sat-tut
                          move devfiyat-pesin-pesinat   to dev-pesgir-tut 
                  else
                          move devfiyat-taksit           to dev-sat-tut
                          move devfiyat-taksit-pesinat   to dev-pesgir-tut 
                  end-if
          end-read
          display accept-0305 accept-0304
          close devfiyat .

*
 Form3-Ex-Other.
      evaluate key-status
      when 2 
      if bakiye < 0 or 
         bakiye > 0 
            display message box "Bakiye Sifir [0] Olmadan Odeme Plani Olusturulamaz.."
                            title "Uyari"
                            icon 1
               exit paragraph 
      end-if 
         display message box "Odeme Plani Olusturulacaktir."new-line
                             "Eminmisiniz.?"
                         title "Uyari"
                         icon 1
                         type 2
                         default 2
                         returning return-code 
         if return-code = 2
             exit paragraph 
         end-if 

         perform odeme-plani-kaydet

         display message box "Odeme Plani Olusturuldu.." new-line
                             "Kontrol Ediniz.."
                         title "Uyari"
                         icon 1
         set exit-pushed to true 

      when 3
         display message box "Odeme Plani Yeniden Olusturulacaktir."new-line
                             "Eminmisiniz.?" new-line new-line
                             "Not:Yapmis oldugunuz islem eski Odeme Planini silecektir.."
                         title "!!! Dikkat !!!"
                         icon 3
                         type 2
                         default 2
                         returning return-code 
         if return-code = 2
             exit paragraph 
         end-if
      end-evaluate
     
     .
*
 odeme-plani-kaydet.
      open i-o taksit takvim odemeler
      initialize nereden-basla
      if bakiye = 0 or 
         bakiye = zeroes
            if dev-pesgir-tut not = zeroes 
                move 1      to nereden-basla
                perform pesinat-kaydet
            end-if 
   
            if dev-kapora-tut not = zeroes
                 evaluate nereden-basla
                 when 1
                    move 2       to nereden-basla
                 when 0
                    move 1       to nereden-basla
                 end-evaluate 
                 perform kapora-kaydet
            end-if 

     
            if dev-taksit-1 not = 0
               evaluate nereden-basla
               when 0
                  move 1        to nereden-basla
               when 1
                  move 2        to nereden-basla
               when 2
                  move 3        to nereden-basla
               end-evaluate

               perform plan-kaydet-1

            end-if 

            if dev-taksit-2 not = 0                
               evaluate nereden-basla
               when 0
                  move 1        to nereden-basla
               when 1
                  move 2        to nereden-basla
               when 2
                  move 3        to nereden-basla
               end-evaluate
               perform plan-kaydet-2
            end-if 
            if dev-taksit-3 not = 0  
               evaluate nereden-basla
               when 0
                  move 1        to nereden-basla
               when 1
                  move 2        to nereden-basla
               when 2
                  move 3        to nereden-basla
               end-evaluate
               perform plan-kaydet-3
            end-if 
      else
                   close taksit takvim
             exit paragraph 
      end-if
      close taksit takvim odemeler.
*
 pesinat-kaydet.
      initialize taksit-rec 
      move uye-no        to taksit-devremulk-no
      move nereden-basla to taksit-sira
      read taksit no lock invalid 
           continue 
      end-read
          move pes-taksit-basla-tar  to taksit-tarih
          move "B"                   to taksit-hareket-turu
          move "SO"                  to taksit-islem-turu
          move dev-pesgir-tut        to taksit-tutar taksit-tutar-dv
          move "NA"                  to taksit-odeme-turu
          move "P"                   to taksit-sekli |pesinat
          move k-kodu-tasi           to taksit-staf
      write taksit-rec invalid 
          rewrite taksit-rec end-rewrite 
      end-write
      perform log-operation-taksit
      .
*
 kapora-kaydet.
      initialize taksit-rec 
      move uye-no        to taksit-devremulk-no
      move nereden-basla to taksit-sira
      read taksit no lock invalid 
           continue               
      end-read
          move kap-tar              to taksit-tarih
          move "B"                  to taksit-hareket-turu
          move "SO"                 to taksit-islem-turu
          move dev-kapora-tut       to taksit-tutar taksit-tutar-dv
          move cb-kap(1:2)          to taksit-odeme-turu
          move "K"                  to taksit-sekli |kapora 
          move k-kodu-tasi          to taksit-staf
      write taksit-rec invalid 
          rewrite taksit-rec end-rewrite 
      end-write
      perform log-operation-taksit

    |  initialize odemeler-rec 
     | move taksit-devremulk-no      to odemeler-devremulk-no
     | move nereden-basla            to odemeler-sira
     | read odemeler no lock invalid 
     |     move kap-tar              to odemeler-tarih
     |     move "A"                  to odemeler-hareket-turu
     |     move "SO"                 to odemeler-islem-turu
     |     move dev-kapora-tut       to odemeler-tutar odemeler-tutar-dv
     |     move cb-kap(1:2)          to odemeler-odeme-turu
     |     move k-kodu-tasi          to odemeler-prim-staf
     |     perform cek-fis-al
     |     perform cek-kaydet
     |     move cek-isl-no           to odemeler-cek-isl-no                  
     |    write odemeler-rec invalid 
     |       continue 
     |    end-write
      |   perform log-operation-odemeler
     |end-read 
      .
*
 cek-fis-al.
        open i-o mgenelfis
        move 1        to mgenelfis-anahtar
        read mgenelfis no lock invalid
             initialize mgenelfis-rec
             add 1    to mcek-oto of mgenelfis-rec
             write mgenelfis-rec invalid
                   rewrite mgenelfis-rec end-rewrite
             end-write
        not invalid
             compute mcek-oto of mgenelfis-rec = mcek-oto of mgenelfis-rec + 1
             rewrite mgenelfis-rec end-rewrite
        end-read
        close mgenelfis.
*
 cek-kaydet.     
     open i-o cek
     initialize cek-rec 
     move mcek-oto of mgenelfis-rec       to cek-isl-no
     read cek no lock invalid
          move kap-tar                    to cek-isl-tar cek-vade cek-valor
          move odemeler-tutar             to cek-tutar
          move "A"                        to cek-a-v
          move "E"                        to cek-muhasebe-eh
          move "T"                        to cek-dovizlimi
          move odemeler-odeme-turu        to cek-tipi
          write cek-rec invalid 
              display message box "Kayit Yazilamadi..."
          end-write
          perform log-operation-cek
     end-read
     close cek.
*
 plan-kaydet-1.
         initialize i
         perform varying i 
                   from 1  
                   by 1
                   until i > dev-taksit-1                          
                        
                         if taksit-basla-ay > 12
                             move 1       to taksit-basla-ay
                             compute taksit-basla-yil = taksit-basla-yil + 1
                         end-if
                         initialize takvim-rec 
                         move taksit-basla-tar to takvim-anah
                         read takvim no lock invalid
                              subtract 1 from taksit-basla-gun |30 eken aylar bulmak iin
                              move taksit-basla-gun to takvim-gun 
                              read takvim no lock invalid
                                  if taksit-basla-ay = 2 |subat ayi iin
                                     subtract 2 from taksit-basla-gun
                                     move taksit-basla-gun to takvim-gun 
                                     read takvim no lock invalid 
                                          continue 
                                     not invalid 
                                         add 3 to taksit-basla-gun
                                     end-read 
                                  end-if 
                              not invalid 
                                  add 1 to taksit-basla-gun                                 
                              end-read
                         end-read
                         initialize taksit-rec
                         move dev-taksit-1-tut     to taksit-tutar taksit-tutar-dv
                         move dev-taksit-tip1(1:2) to taksit-odeme-turu
                         
                         perform taksit-yaz
                          compute taksit-basla-ay = taksit-basla-ay + 1
                         if i < dev-taksit-1

                            compute nereden-basla = nereden-basla + 1
                         end-if 
         end-perform
         
         compute nereden-basla = nereden-basla + 1
         move takvim-anah      to taksit-basla-tar.
 
*
 plan-kaydet-2.
         initialize i
         perform varying i 
                   from 1  
                   by 1
                   until i > dev-taksit-2                          
                           compute taksit-basla-ay = taksit-basla-ay + 1  
                         if taksit-basla-ay > 12
                             move 1       to taksit-basla-ay
                             compute taksit-basla-yil = taksit-basla-yil + 1
                         end-if
                         initialize takvim-rec 
                         move taksit-basla-tar to takvim-anah
                         read takvim no lock invalid
                              subtract 1 from taksit-basla-gun |30 eken aylar bulmak iin
                              move taksit-basla-gun to takvim-gun 
                              read takvim no lock invalid
                                  if taksit-basla-ay = 2 |subat ayi iin
                                     subtract 2 from taksit-basla-gun
                                     move taksit-basla-gun to takvim-gun 
                                     read takvim no lock invalid 
                                          continue 
                                     not invalid 
                                         add 3 to taksit-basla-gun
                                     end-read 
                                  end-if 
                              not invalid 
                                  add 1 to taksit-basla-gun                                 
                              end-read
                         end-read
                         initialize taksit-rec
                         move dev-taksit-2-tut     to taksit-tutar taksit-tutar-dv
                         move dev-taksit-tip2(1:2) to taksit-odeme-turu                         
                         perform taksit-yaz
                        
                         if i < dev-taksit-2
                            compute nereden-basla = nereden-basla + 1
                         end-if 
         end-perform.
         compute nereden-basla = nereden-basla + 1
         move takvim-anah      to taksit-basla-tar.
*
 plan-kaydet-3.
         initialize i
         perform varying i 
                   from 1  
                   by 1
                   until i > dev-taksit-3                          
                          compute taksit-basla-ay = taksit-basla-ay + 1
                         if taksit-basla-ay > 12
                             move 1       to taksit-basla-ay
                             compute taksit-basla-yil = taksit-basla-yil + 1
                         end-if
                         initialize takvim-rec 
                         move taksit-basla-tar to takvim-anah
                         read takvim no lock invalid
                              subtract 1 from taksit-basla-gun |30 eken aylar bulmak iin
                              move taksit-basla-gun to takvim-gun 
                              read takvim no lock invalid
                                  if taksit-basla-ay = 2 |subat ayi iin
                                     subtract 2 from taksit-basla-gun
                                     move taksit-basla-gun to takvim-gun 
                                     read takvim no lock invalid 
                                          continue 
                                     not invalid 
                                         add 3 to taksit-basla-gun
                                     end-read 
                                  end-if 
                              not invalid 
                                  add 1     to taksit-basla-gun                                 
                              end-read
                         end-read
                         initialize taksit-rec
                         move dev-taksit-3-tut     to taksit-tutar taksit-tutar-dv
                         move dev-taksit-tip3(1:2) to taksit-odeme-turu

                         perform taksit-yaz
                        
                         if i < dev-taksit-3
                            compute nereden-basla = nereden-basla + 1
                         end-if 
         end-perform.
*
 taksit-yaz.      
      move uye-no           to taksit-devremulk-no
      move nereden-basla    to taksit-sira 
      read taksit no lock invalid 
           continue 
      end-read 
          move takvim-anah          to taksit-tarih
          move "B"                  to taksit-hareket-turu
          move "SO"                  to taksit-islem-turu
          move "N"                  to taksit-sekli |taksit
          move k-kodu               to taksit-staf 
          write taksit-rec invalid 
              rewrite taksit-rec end-rewrite 
          end-write
          perform log-operation-taksit.
*
 ucret-hesapla.
      initialize toplam-ucret taksit1 taksit2 taksit3 bakiye
      compute taksit1 = dev-taksit-1 * dev-taksit-1-tut
      compute taksit2 = dev-taksit-2 * dev-taksit-2-tut
      compute taksit3 = dev-taksit-3 * dev-taksit-3-tut

      compute toplam-ucret = taksit1 + taksit2 + taksit3 +
                             dev-kapora-tut + dev-pesgir-tut
      compute bakiye = toplam-ucret - dev-sat-tut
      display lb-toplam-ucret lb-bakiye
       .
*
 Form4-Aft-Initdata.
      perform plan-duzenle-baslik-yukle
      perform plan-duzenle-grid-yukle
      initialize plan-sira 
      move kayit-sayi to plan-sira
      display accept-0401.
      
     

      .
*
 onay-kontrol.
        move 0 to vis-fo
      modify f-onay,
            reset-grid = 1
       open i-o onay   OPEN input odemeler
        move "ONAYLAR" to  f-1
                    modify f-onay,record-to-add(f-rec)
                    move 1 to onay-no
       initialize onay-rec
       set DEVRE-ONAY to true
       move devremulk-no to  ONAY-ANAHTAR
       start onay key >= onay-id invalid continue
           not invalid 
           perform until fs-onay = "10"
             read onay next no lock end move "10" to fs-onay
                not end 
                 if (not DEVRE-ONAY ) or function numval(onay-anahtar) not =  devremulk-no
                  move "10" to fs-onay
                  exit perform 
                  else
                    add 1 to  onay-no
                      move function numval(ONAY-VERI-yeni(1:10))  to zo-tut
                      move  ONAY-VERI-yeni(11:2) to text-id
                               perform text-acikla
                                    string
                                          text-aciklama delimited by "   "
                                          "  silme onayi " delimited by size
                                          zo-tut delimited by size     
                                          into  f-1
                    modify f-onay, record-to-add(f-rec)
                    modify f-onay(onay-no, 2) hidden-data = ONAY-rec 
                    modify f-onay(onay-no, 1) hidden-data = ONAY-ID 
                    initialize odemeler-rec
                     move  function numval(ONAY-VERI-yeni(15:))  to      odemeler-sira       
                     move  function numval(ONAY-ANAHTAR)         to   odemeler-devremulk-no
                               read odemeler no lock invalid
                                 set  onay-uygulandi to true
                                 rewrite onay-rec invalid continue end-rewrite
                                end-read


                    evaluate true
                           
                          when  ONAY-VERILDI 
                             move 152 to o-renk
                          when       ONAY-IPTAL 
                             move 176 to o-renk
                          when       onay-uygulandi 
                              move 80  to o-renk
                          when other
                            move 0 to o-renk
                    end-evaluate
                    if o-renk > 0
                     modify  f-onay(onay-no,1) row-color = o-renk
                    end-if
                     move 1 to vis-fo
                    
                 end-if  
              end-read 
              end-perform 
        end-start

       close onay odemeler.
        display f-onay.

*
 text-acikla.
                    initialize  text-aciklama
                       evaluate    text-id
                                when "SO"   move "SATIS ODEMESI  "     to text-aciklama
                                when "IO"   move "IPTAL ODEMESI  "     to text-aciklama
                                when "AO"   move "AIDAT ODEMESI  "    to text-aciklama
                                when "AI"   move "AIDAT GIRIS    "   to text-aciklama
                                when "SP"   move "SABIT PRIM ODEMESI  "   to text-aciklama
                                when "NP"   move "NORMAL PRIM ODEMESI  "   to text-aciklama
                                when "AV"   move "AVANS                 "  to text-aciklama
                                when "AG"   move "AVANS GERI ODEMESI     " to text-aciklama
                                when "PI"   move "PARA IADESI             "  to text-aciklama
                                when "GS"   move "SABIT PRIM GERI ODEMESI "  to text-aciklama
                                when "GN"   move "PRIM GERI ODEMESI       " to text-aciklama
                                when "PP"   move "PRIM                   "   to text-aciklama
                                when "SS"   move "SABIT PRIM            "   to text-aciklama
                      end-evaluate
                      .
*
 plan-duzenle-baslik-yukle. 
    modify gd-plan,reset-grid = 1
                      mass-update = 1
    initialize gd-plan-rec
    move "Sira"     to gd-4-col-1
    move "Gun"      to gd-4-col-2
    move "Ay"       to gd-4-col-3
    move "Yil"      to gd-4-col-4
    move "O.Turu"   to gd-4-col-5

    move "Tutar"    to gd-4-col-6
    move "T.Sekli"  to gd-4-col-7
    modify gd-plan,record-to-add(gd-plan-rec).
*
 plan-duzenle-grid-yukle.
    open i-o taksit
    initialize taksit-rec
    move 1              to kayit-sayi
    move uye-no         to taksit-devremulk-no
    start taksit key not < taksit-anah invalid 
         continue 
    not invalid 
    perform with test after until fs-taksit = "10"
    read taksit next no lock end move "10" to fs-taksit
    not at end 
            if taksit-devremulk-no <> uye-no
                exit perform 
            end-if
            add 1 to kayit-sayi
            initialize gd-plan-rec
            move taksit-sira             to z-sira
            move z-sira                  to gd-4-col-1
            move taksit-tarih-gun        to gd-4-col-2
            move taksit-tarih-ay         to gd-4-col-3
            move taksit-tarih-yil        to gd-4-col-4

            evaluate taksit-odeme-turu
            when "CE"
                move "CE-Cek"            to gd-4-col-5
            when "KK"
                move "KK-Kredi Karti"    to gd-4-col-5
            when "NA"
                move "NA-Nakit"          to gd-4-col-5
            end-evaluate
            
            move taksit-tutar            to etut
            move etut                    to gd-4-col-6
            evaluate taksit-sekli
            when "K"
                 move "K-Kapora Odemesi"      to gd-4-col-7
            when "P"
                 move "P-Pesinat Odemesi"     to gd-4-col-7
            when "N"
                 move "N-Taksit Odemesi"      to gd-4-col-7
            end-evaluate 
            modify gd-plan,record-to-add(gd-plan-rec)
            modify gd-plan(kayit-sayi,1),hidden-data = gd-plan-rec
    end-read 
    end-perform

    end-start
    close taksit
    modify gd-plan,mass-update = 0
     .    
      .
*
 gd-plan-Ev-Other.
    evaluate event-type
    when msg-begin-entry
         move event-action-fail to event-action
         inquire gd-plan(event-data-2,1),cell-data in plan-sira
         perform taksit-oku
         display accept-0401
    end-evaluate
     
     .
*
 takvim-oku.
    open input takvim
    initialize takvim-rec hata-var 
    move taksit-tarih  to takvim-anah
    read takvim no lock invalid 
         display message box "Hatali Tarih Girdiniz." new-line
                             "Kontrol Ediniz."
                         title "Uyari"
                         icon 1
                     close takvim
            move 1     to hata-var 
            exit paragraph 
    end-read 
    close takvim
     .
*
 Form4-Ex-Other.
    evaluate key-status
    when 4002
        display message box plan-sira" 'Nolu Siradaki Odeme Plani Kaydedilecek.." new-line
                            "Eminmisiniz.?"
                        title "Uyari"
                        icon 1
                        type 2 
                        default 2
                        returning return-code 
        if return-code = 2
            exit paragraph 
        end-if 
        perform yeni-plan-ekle
    when 4003
        display message box plan-sira" 'Nolu Siradaki Odeme Plani Silinecektir." new-line
                            "Eminmisiniz?"
                        title "Uyari"
                        icon 1
                        type 2
                        default 2
                        returning return-code 
        if return-code = 2
             exit paragraph 


        end-if 
        perform taksit-sil
    WHEN 4004
         display message box "TUM Odeme Plani Silinecektir." new-line
                            "Eminmisiniz?"
                        title "Uyari"
                        icon 1
                        type 2
                        default 2
                        returning return-code 
        if return-code = 2
             exit paragraph 
        end-if  
        perform tum-taksit-sil
    end-evaluate.
*
 Form1-Ta-1-Aft-Tabchg-Display.
    evaluate Form1-Ta-1-Value
    when 1
        perform baslik-yukle
        perform grid-yukle
    when 3
         open input devremulk
         initialize devremulk-rec
         move uye-no      to devremulk-no
         read devremulk no lock invalid 
             display message box "Sozlesme Kaydedilmeden Odeme Plani Olusturulamaz.."
                             title "Uyari"
                             icon 1
                close devremulk
                exit paragraph 
         end-read 
         close devremulk

         perform taksit-baslik-yukle
         perform taksit-grid-yukle
    when 2
         perform odeme-baslik-yukle
         perform odeme-grid-yukle
    when 4
         perform prim-baslik-yukle
         perform prim-grid-yukle
    when 5
         if dev-danisman-kodu = spaces or 
            dev-danisman-kodu = 0
               exit paragraph 
         end-if 
         if dev-prim-kodu = spaces or
            dev-prim-kodu = zeroes 
               exit paragraph 
         end-if 
         perform baslik-prim-atama-yukle
         perform prim-atama-grid-yukle
         perform baslik-sabit-prim-yukle
         perform sabit-prim-grid-yukle
    when 6
         perform mesaj-oku
    when 7
        perform aidat-baslik-yukle
        perform aidat-grid-yukle
    when 8
         perform bakim-grid-getir
    when 9
         perform tah-mesaj-oku
    when 10
         perform ode-mesaj-oku
    end-evaluate
    perform guncel-borc-getir 
     .
*
 bakim-grid-getir.
    modify form1-gd-13,reset-grid = 1
                       mass-update = 1
    initialize form1-gd-13-record
    move "Sira"      to gd-13-col-1
    move "Tarih"     to gd-13-col-2
    move "B/A"       to gd-13-col-3
    move "I.Turu"    to gd-13-col-4
    move "Dv Tutar"  to gd-13-col-5
    move "Doviz"     to gd-13-col-6
    move "Dzl"       to gd-13-col-7
    move "Fatura No" to gd-13-col-8
    MOVE "TL Tutar"  TO gd-13-col-9
    move "Yzdr"      to gd-13-col-10
    modify form1-gd-13,record-to-add(form1-gd-13-record)

    open i-o odemeler banka odemetip cek doviz   
    initialize odemeler-rec odeme-sayi alinmadi-sayi borc-var alt-toplam-dv 
    move 1      to kayit-sayi
    move uye-no to odemeler-devremulk-no
    start odemeler key not < odemeler-dev-tar invalid
          continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
        initialize gd13-renk

        if odemeler-devremulk-no <> uye-no
           exit perform 
        end-if

        if odemeler-hareket-turu NOT = "A"
           move 208 to gd13-renk 
        end-if 

        initialize form1-gd-13-record
        evaluate odemeler-islem-turu
            when "BO"
                 move  "BAKIM ODEMESI" to gd-13-col-4 
            when "BK"
                 string "YILLIK BAKIM"      delimited by size "-"
                        odemeler-donem-yili delimited by size  
                   into gd-13-col-4
            when other 
                 exit perform cycle
        end-evaluate

        add 1                      to kayit-sayi
        move odemeler-sira         to z-sira
        move z-sira                to gd-13-col-1
        move odemeler-tarih-gun    to egun
        move odemeler-tarih-ay     to eay
        move odemeler-tarih-yil    to eyil
        move etar                  to gd-13-col-2
        move odemeler-hareket-turu to gd-13-col-3
        move odemeler-tutar        to tl-tutari etut
        move etut                  to gd-13-col-9 

        perform  odeme-dv-hesapla

        move para-hesapla          to etut
        move etut                  to gd-13-col-5
      
        if odemeler-hareket-turu = "A"
           compute alt-toplam-dv = alt-toplam-dv - para-hesapla
        else
           compute alt-toplam-dv = alt-toplam-dv + para-hesapla
        end-if

        if odemeler-islem-turu = "BO" then
           move odemeler-tutar     to etut
           move etut               to gd-13-col-10 | TL
        end-if

        initialize odemetip-rec
        move odemeler-odeme-turu   to odemetip-anah
        read odemetip no lock invalid 
             move "     "          to odemetip-adi
        end-read 

        initialize doviz-rec
        move aidat-doviz           to  doviz-kodu
        read doviz no lock invalid
             continue
        not invalid
             move d-adi-1          to gd-13-col-6
        end-read

        move odemeler-fatura-no    to 8-z
        move 8-z                   to gd-13-col-8


        if odemeler-hareket-turu  = "A"
           modify form1-gd-13(kayit-sayi,10)
                  bitmap = print-bmp
                  bitmap-width = 16
                  bitmap-number = 1

           modify form1-gd-13(kayit-sayi,9)
                  bitmap = barra04-bmp
                  bitmap-width = 16
                  bitmap-number = 9
        else
           modify form1-gd-13(kayit-sayi,9)
                  bitmap = no-bmp
                  bitmap-width = 16
                  bitmap-number = 1
        end-if

        modify form1-gd-13,
               record-to-add(form1-gd-13-record)
        modify form1-gd-13(kayit-sayi),
               row-color = gd13-renk
        modify form1-gd-13(kayit-sayi,7),
               hidden-data odemeler-cek-isl-no
    end-read 
    end-perform
    end-start
    close odemeler banka odemetip cek doviz 

    if kayit-sayi > 1
       add 1 to kayit-sayi

       initialize form1-gd-13-record
       move alt-toplam-dv      to doviz-tutari

       perform odeme-tl-hesapla

       open input doviz
       move aidat-doviz        to doviz-kodu
       read doviz no lock invalid  
            move "     "       to d-kisa-adi
        end-read 
       close doviz

       initialize gd-13-col-4
       
       move "Toplam Borc->"  to gd-13-col-4
       move alt-toplam-dv    to etut
       move etut             to gd-13-col-5
       move d-kisa-adi       to gd-13-col-6
       move para-hesapla     to etut    
       move etut             to gd-13-col-9

       modify form1-gd-13,
              record-to-add(form1-gd-13-record)
       modify form1-gd-13(kayit-sayi),
              row-color = 480
    end-if 

    modify form1-gd-13,mass-update = 0       
    .
*
 aidat-baslik-yukle.
    modify gd4,reset-grid = 1
                     mass-update = 1
    initialize gd4-record
    move "Sira"      to gd4-col1
    move "Tarih"     to gd4-col2
    move "B/A"       to gd4-col3
    move "I.Turu"    to gd4-col4
    move "Dv Tutar"  to gd4-col5
    move "Doviz"     to gd4-col6
    move "Dzl"       to gd4-col8
    move "Fatura No" to gd4-col9
    MOVE "TL Tutar"  TO gd4-col10
    move "Yzdr"      to gd4-col11
    modify gd4,record-to-add(gd4-record)
         .
*
 aidat-grid-yukle.
     open i-o odemeler banka odemetip cek doviz   
    initialize odemeler-rec odeme-sayi alinmadi-sayi borc-var alt-toplam-dv alt-toplam-tl
    move 1                to kayit-sayi
    move uye-no           to odemeler-devremulk-no
    start odemeler key not < odemeler-dev-tar invalid
          continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
           initialize gd4-renk
           if odemeler-devremulk-no <> uye-no
               exit perform 
           end-if
           if odemeler-hareket-turu NOT = "A"
              move 208   to gd4-renk 
           end-if 

           initialize gd4-record
           if sadece-demirbaslar = 1 
               evaluate odemeler-islem-turu
                   when "DO"
                        move  "DEMIRBAS ODEMESI"            to gd4-col4 
                   when "DM"
                        string "YILLIK DEMIRBAS" delimited by size "-"
                             odemeler-donem-yili delimited by size  
                        into gd4-col4
                   when other 
                        exit perform cycle
               end-evaluate
           else
               evaluate odemeler-islem-turu
               when "AO"
                   move  "AIDAT ODEMESI"            to gd4-col4 
               when "AI"
                   string "YILLIK AIDAT" delimited by size "-"
                   odemeler-donem-yili delimited by size  
                   into gd4-col4
               when "AD"     
                    if duzeltmeler-ciksin = 1
                       move "AI. DUZELTME"             to gd4-col4
                       move 176 to gd4-renk
                    else 
                       exit perform cycle
                    end-if
               when "OD"
                    if duzeltmeler-ciksin = 1
                       move "OD. DUZELTME"             to gd4-col4
                       move 144 to gd4-renk
                    else 
                       exit perform cycle
                    end-if
               WHEN OTHER 
                    exit perform cycle
               end-evaluate
           end-if

           add 1                      to kayit-sayi
           move odemeler-sira         to z-sira
           move z-sira                to gd4-col1
           move odemeler-tarih-gun    to egun
           move odemeler-tarih-ay     to eay
           move odemeler-tarih-yil    to eyil
           move etar                  to gd4-col2

           move odemeler-hareket-turu to gd4-col3
  
           move odemeler-tutar    to tl-tutari ETUT
           MOVE ETUT              TO GD4-COL10 
           perform  odeme-dv-hesapla
           move para-hesapla      to etut
           move etut              to gd4-col5
      
           if odemeler-hareket-turu = "A"
              compute alt-toplam-dv = alt-toplam-dv - para-hesapla 
              compute alt-toplam-tl = alt-toplam-tl - odemeler-tutar     
           else
              compute alt-toplam-dv = alt-toplam-dv + para-hesapla
              compute alt-toplam-tl = alt-toplam-tl + odemeler-tutar
           end-if

           if odemeler-islem-turu = "AO" then
              move odemeler-tutar      to etut
              move etut                to gd4-col10 | TL
           end-if



           initialize odemetip-rec
           move odemeler-odeme-turu      to odemetip-anah
           read odemetip no lock invalid 
                move "     "             to odemetip-adi
           end-read 

           initialize doviz-rec
           move odemeler-doviz-kodu     to  doviz-kodu
           read doviz no lock invalid
                 continue
           not invalid
                  move D-ADI-1 to gd4-col6
           end-read


           move odemeler-fatura-no    to 8-z
           move 8-z                   to gd4-col9


        if odemeler-hareket-turu  = "A"
            modify gd4(kayit-sayi,10)
                   bitmap = print-bmp
                  bitmap-width = 16
                  bitmap-number = 1

            modify gd4(kayit-sayi,9)
                  bitmap = barra04-bmp
                  bitmap-width = 16
                  bitmap-number = 9
        else
              modify gd4(kayit-sayi,9)
                   bitmap = no-bmp
                  bitmap-width = 16
                  bitmap-number = 1
        end-if

           modify gd4,
                   record-to-add(gd4-record)
              modify gd4(kayit-sayi),row-color = gd4-renk

           modify gd4(kayit-sayi,7),
                  hidden-data odemeler-cek-isl-no
    end-read 
    end-perform
    end-start
     close odemeler banka odemetip cek  doviz 

      if kayit-sayi > 1
       add 1 to kayit-sayi
       initialize gd4-record
       
       move alt-toplam-dv      to doviz-tutari
       perform odeme-tl-hesapla
       OPEN INPUT DOVIZ
       move aidat-doviz        to DOVIZ-KODU
       read DOVIZ no lock invalid  
                move "     "   to D-KISA-ADI
        end-read 
       CLOSE DOVIZ
       initiaLIZE gd4-col4
       
       MOVE "Toplam Borc->"  TO  gd4-col4
       |MOVE D-KISA-ADI       TO gd4-col6
       move alt-toplam-dv    to etut
       move etut             to gd4-col5
       move para-hesapla     to etut    
*       move alt-toplam-tl    to etut
       move etut             to gd4-col10

       modify gd4,record-to-add(gd4-record)
       modify gd4(kayit-sayi),
       row-color = 480
    end-if 

    modify gd4,mass-update = 0       
         .

*
 Form4-Bef-Create.
    move tarih-tasi        to plan-duz-tar     
     .
*
 yeni-plan-ekle.
    open i-o taksit
    initialize taksit-rec hata-var  
    move uye-no                   to taksit-devremulk-no
    move plan-sira                to taksit-sira 
    read taksit no lock invalid
         continue 
    end-read 
         move plan-duz-tar        to taksit-tarih
         move plan-tut            to taksit-tutar
         move plan-ode-sekil(1:2) to taksit-odeme-turu
         move plan-tah-sekil(1:1) to taksit-sekli
         write taksit-rec invalid
            rewrite taksit-rec end-rewrite 
         end-write
         perform log-operation-taksit
    close taksit

    perform plan-duzenle-baslik-yukle
    perform plan-duzenle-grid-yukle

    compute plan-sira = plan-sira + 1
    initialize plan-tut
    display accept-0401 accept-0405
    move 4 to accept-control
    move 12 to control-id

     .
*
 taksit-oku.
    open input taksit
    initialize taksit-rec 
    move uye-no        to taksit-devremulk-no
    move plan-sira     to taksit-sira 
    read taksit no lock invalid 
         initialize plan-duz-tar plan-tut
         display accept-0402 accept-0403 accept-0404 accept-0405 
    not invalid 
        move taksit-tarih      to plan-duz-tar
        move taksit-tutar      to plan-tut
        move taksit-odeme-turu to plan-ode-sekil
        move taksit-sekli      to plan-tah-sekil        
    end-read 
    close taksit
    display accept-0402 accept-0403 accept-0404 accept-0405 
            cb-plan-ode-sekil cb-plan-tah-sekil
    .
*
 taksit-sil.
    open i-o taksit
    initialize taksit-rec 
    move uye-no        to taksit-devremulk-no
    move plan-sira     to taksit-sira 
    read taksit no lock invalid 
         initialize plan-duz-tar plan-tut
         display accept-0402 accept-0403 accept-0404 accept-0405
         display message box "Silinecek Kayit Bulunamadi.."
                         title "Uyari"
                         icon 2
    not invalid 
        delete taksit end-delete 
        perform log-operation-taksit
    end-read 
    close taksit
    initialize plan-duz-tar plan-tut
    display accept-0402 accept-0403 accept-0404 accept-0405 
            cb-plan-ode-sekil cb-plan-tah-sekil    
    perform plan-duzenle-baslik-yukle
    perform plan-duzenle-grid-yukle.
*
 tum-taksit-sil.
    open i-o taksit
    initialize taksit-rec 
    move uye-no        to taksit-devremulk-no
    start taksit key not < taksit-anah invalid
            continue
    not invalid
    perform until fs-taksit = "10" 
    read taksit next no lock end move "10" to fs-taksit 
    not end

          if taksit-devremulk-no not = uye-no then
                exit perform 
          end-if
          delete taksit end-delete
          perform log-operation-taksit
    end-read
    end-perform
    end-start
       
 
    close taksit
    initialize plan-duz-tar plan-tut
    display accept-0402 accept-0403 accept-0404 accept-0405 
            cb-plan-ode-sekil cb-plan-tah-sekil    
    perform plan-duzenle-baslik-yukle
    perform plan-duzenle-grid-yukle.
*
 odeme-giris-cagir.
    initialize link-odeme-uye-no 
    move uye-no                      to link-odeme-uye-no
    call "/asya/ytl/obj/otel/devodeme.asy" using link-odeme-uye-no
            on exception perform callerr-proc
               not on exception
          cancel "/asya/ytl/obj/otel/devodeme.asy" 
    end-call.
    perform odeme-baslik-yukle
    perform odeme-grid-yukle.
*
 odeme-tahsilat-sil.
    inquire form1-gd-2(event-data-2),
            record-data form1-gd-2-record
    open i-o odemeler
    initialize odemeler-rec 
    move uye-no                      to odemeler-devremulk-no
    move function numval(gd-2-col-0) to odemeler-sira
    read odemeler no lock invalid 
         display message box "Silinecek Kayit Bulunamadi..."
                         title "Kayit Bulunamadi."
                         icon 1
         close odemeler
         exit paragraph 
    not invalid 
        delete odemeler invalid 
             display message box "Kayit Silinemedi"
        end-delete
       
        perform log-operation-odemeler
        perform odemesil-yaz

        display message box "Odeme Silindi.."
                        title "Uyari"
                        icon 1
    end-read 
    close odemeler

    perform odeme-baslik-yukle
    perform odeme-grid-yukle.
*
 odeme-yeniden-dagit.
 |MAMI
    initialize link-odeme-uye-no link-cek-isl-no link-odeme-sira
    inquire form1-gd-2(event-data-2,7),
           hidden-data link-cek-isl-no
    inquire form1-gd-2(event-data-2,1),
           cell-data in link-odeme-sira
    move uye-no                      to link-odeme-uye-no
    if genel-onay = 1 
       perform onay-silme-kont
       if ONAY-VERILDI 
          continue
          else
         exit paragraph
       end-if
    end-if
    
    call "/asya/ytl/obj/otel/devodeme.asy" using link-odeme-uye-no,link-cek-isl-no,link-odeme-sira
            on exception perform callerr-proc
               not on exception
          cancel "/asya/ytl/obj/otel/devodeme.asy" 
    end-call.
    perform odeme-baslik-yukle
    perform odeme-grid-yukle.
*
 aidat-ekrana-getir.
 |MAMI
     initialize link-odeme-uye-no link-cek-isl-no link-odeme-sira
    inquire gd4(event-data-2,7),
           hidden-data link-cek-isl-no
    inquire gd4(event-data-2,1),
           cell-data in link-odeme-sira
    move uye-no                      to link-odeme-uye-no

    if genel-onay = 1 
       perform onay-silme-kont
       if ONAY-VERILDI 
          continue
          else
         exit paragraph
       end-if
    end-if

   
    call "/asya/ytl/obj/otel/devodeme.asy" using link-odeme-uye-no,link-cek-isl-no,link-odeme-sira
            on exception perform callerr-proc
               not on exception
          cancel "/asya/ytl/obj/otel/devodeme.asy" 
    end-call.
    perform odeme-baslik-yukle
    perform odeme-grid-yukle.
*
 bakim-ekrana-getir.
    initialize link-odeme-uye-no link-cek-isl-no link-odeme-sira
    inquire form1-gd-13(event-data-2,7),
            hidden-data link-cek-isl-no
    inquire form1-gd-13(event-data-2,1),
            cell-data in link-odeme-sira
    move uye-no  to link-odeme-uye-no

    if genel-onay = 1 
       perform onay-silme-kont
       if onay-verildi 
          continue
       else
          exit paragraph
       end-if
    end-if

   
    call "/asya/ytl/obj/otel/devodeme.asy" using link-odeme-uye-no,link-cek-isl-no,link-odeme-sira
            on exception perform callerr-proc
               not on exception
          cancel "/asya/ytl/obj/otel/devodeme.asy" 
    end-call.
    perform bakim-grid-getir
    .
*
 tamamen-form-taksit-sil.
    open i-o taksit
    initialize taksit-rec
    move uye-no          to taksit-devremulk-no
    start taksit key not < taksit-anah invalid
          continue 
    not invalid 
    perform with test after until fs-taksit = "10"
    read taksit next no lock end move "10" to fs-taksit
    not at end 
             if taksit-devremulk-no <> uye-no
                 exit perform 
             end-if
             delete taksit end-delete
             perform log-operation-taksit
    end-read 
    end-perform
    end-start
    close taksit
    .
*
 form-taksit-sil.
    open i-o taksit
    initialize taksit-rec
    move uye-no          to taksit-devremulk-no
    start taksit key not < taksit-anah invalid
          continue 
    not invalid 
    perform with test after until fs-taksit = "10"
    read taksit next no lock end move "10" to fs-taksit
    not at end 
             if taksit-devremulk-no <> uye-no
                 exit perform 
             end-if
             move 1             to taksit-iptal 
             rewrite taksit-rec end-rewrite 
             perform log-operation-taksit
    end-read 
    end-perform
    end-start
    close taksit
    .
*
 sil-kontrol.
    open input odemeler
    initialize odemeler-rec hata-var
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid 
          continue 
    not invalid
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
             if odemeler-devremulk-no <> uye-no
                exit perform 
             end-if

             EVALUATE odemeler-islem-turu
             WHEN  "PP"
             WHEN  "SS"    
                  EXIT PERFORM CYCLE
             WHEN OTHER 
                  CONTINUE
             END-EVALUATE

             MOVE  1     to hata-var
    end-read 
    end-perform
    end-start
    close odemeler
    .
*
 tamamen-prim-sil-kontrol.
    open input odemeler
    initialize odemeler-rec prim-var-hata
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid 
          continue 
    not invalid
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
             if odemeler-devremulk-no <> uye-no
                exit perform 
             end-if

              EVALUATE odemeler-islem-turu
              WHEN  "SP"
                MOVE 1  TO prim-var-hata
                EXIT PERFORM
              WHEN  "NP"    
                MOVE 1  TO prim-var-hata
                EXIT PERFORM 
             END-EVALUATE
    end-read 
    end-perform
    end-start
    close odemeler .
*
 tamamen-odeme-sil-kontrol.
    open input odemeler
    initialize odemeler-rec hata-var
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid 
          continue 
    not invalid
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
             if odemeler-devremulk-no <> uye-no
                exit perform 
             end-if

              EVALUATE odemeler-islem-turu
              WHEN  "PP"
                 continue 
              WHEN  "SS"       
                 continue 
              when other
                 move  1 to  hata-var
                 exit perform
             END-EVALUATE
    end-read 
    end-perform
    end-start
    close odemeler .
*
 taksit-aktif-yap.
    open i-o taksit
    initialize taksit-rec 
    move uye-no                   to taksit-devremulk-no
    start taksit key not < taksit-anah invalid
          continue 
    not invalid 
    perform with test after until fs-taksit = "10"
    read taksit next no lock end move "10"  to fs-taksit
    not at end 
            if taksit-devremulk-no <> uye-no
                exit perform 
            end-if 
            move 0        to taksit-iptal
            rewrite taksit-rec end-rewrite 
            perform log-operation-taksit
    end-read 
    end-perform
    end-start
    close taksit
    .
*
 danisman-oku.
    open input danisman
    initialize danisman-rec danisman-adi-deg
    move dev-danisman-kodu  to danisman-kodu
    read danisman no lock invalid 
         move "Tanimsiz.."  to danisman-adi
         MOVE 4  TO accept-control
         move 25 to control-id
    end-read         
         string danisman-adi-deg
               danisman-adi delimited by spaces " " 
               danisman-soyadi delimited by size 
         into danisman-adi-deg
          if danisman-pasif = 1 then
              modify acc-danisman-adi , color = 32944
              if link-uye-no  = 0 then
                      display message box "Pasif Danisman Girdiniz !"  new-line
                                  "Uyari !"
              end-if
         else
               modify acc-danisman-adi , color = 481
         end-if
    close danisman
    display acc-danisman-adi
    .
*
 prim-oku.
    open input prim
    initialize prim-rec 
    move dev-prim-kodu     to prim-kodu
    read prim no lock invalid 
         move "Tanimsiz.." to prim-adi
    end-read
        if prim-sabit = 0
         move prim-adi     to prim-adi-deg
        else
         display message box "Sabit Prim Girdiniz.." new-line
                             "Kontrol Ediniz."
                         title "Uyari"
                         icon 1
              close prim
              exit paragraph 
        end-if 
    close prim
    display acc-prim-adi
    if Form1-Ta-1-Value = 5
       perform baslik-prim-atama-yukle
       perform prim-atama-grid-yukle
    end-if 

    .
*
 sabit-prim-oku.
    open input prim
    initialize prim-rec 
    move dev-sabit-prim-kodu     to prim-kodu
    read prim no lock invalid 
         move "Tanimsiz.." to prim-adi
    end-read
        if prim-sabit = 1
           move prim-adi     to sabit-prim-adi-deg
        else
         display message box "Normal Prim Girdiniz.." new-line
                             "Kontrol Ediniz."
                         title "Uyari"
                         icon 1
              close prim
              exit paragraph 
        end-if 
    close prim
    display acc-sabit-prim-adi
    if Form1-Ta-1-Value = 5
       perform baslik-sabit-prim-yukle
       perform sabit-prim-grid-yukle
    end-if.
*
 prim-ara.
    initialize link-prim-kodu link-prim-sabit
    move 0 to link-prim-sabit
    call "/asya/ytl/obj/otel/primara.asy" using link-prim-kodu link-prim-sabit
        on exception perform callerr-proc
             not on exception
             cancel "/asya/ytl/obj/otel/primara.asy" 
    end-call.
    move link-prim-kodu     to dev-prim-kodu
    display accept-0114.
*
 sabit-prim-ara.
    initialize link-prim-kodu link-prim-sabit
    move 1 to link-prim-sabit
    call "/asya/ytl/obj/otel/primara.asy" using link-prim-kodu  link-prim-sabit
        on exception perform callerr-proc
             not on exception
             cancel "/asya/ytl/obj/otel/primara.asy" 
    end-call.
    move link-prim-kodu     to dev-sabit-prim-kodu
    display accept-0115. 
*
 sozlesme-kontrol.
    open input devremulk
    initialize devremulk-rec hata-var
    move dev-sozlesme-no  to devremulk-sozlesme-no
    start devremulk key not < devremulk-sozlesme-no invalid 
          continue 
    not invalid 
    perform with test after until fs-devremulk = "10"
    read devremulk next no lock end move "10" to fs-devremulk
    not at end 
            if devremulk-sozlesme-no <> dev-sozlesme-no
                exit perform 
            end-if
            if devremulk-durumu = "S"
               exit perform cycle 
            end-if
            if devremulk-no = uye-no
               exit perform cycle
            end-if 
            move 1 to hata-var 
    end-read 
    end-perform
    end-start
    close devremulk.
****************************************loglar
*
 devmulk-log-view.
    open input devremulk
    initialize devremulk-rec
    move uye-no to devremulk-no
    read devremulk no lock invalid
            continue
    end-read
    move devremulk-dosya      to link-logview-dosya-adi
    set link-logview-pointer  to address of devremulk-rec
    set link-logview-rec-size to size of devremulk-rec
    perform logview-call
    initialize key-status
    close devremulk.
*
 donhrk-log-view.
    open input donhrk
    initialize donhrk-rec
    move dev-odano  to donhrk-oda         
     if dev-odano(5:1) not = space
        move dev-odano to o-uzun
        perform oda-kisalt
        move o-kisa    to donhrk-oda      
     end-if
    move dev-donem  to donhrk-KODU 
    move uye-no     to donhrk-devremulk-no   
    inquire form1-gd-1(event-data-2,1),cell-data in donhrk-YILI        
    read donhrk no lock invalid 
        continue 
    end-read 
    close donhrk

    move donhrk-dosya        to link-logview-dosya-adi
    set link-logview-pointer  to address of donhrk-rec
    set link-logview-rec-size to size of donhrk-rec
    perform logview-call
    initialize key-status.


*
 sozhrk-log-view.
    move sozhrk-DOSYA        to link-logview-dosya-adi
    set link-logview-pointer  to address of sozhrk-rec
    set link-logview-rec-size to size of sozhrk-rec
    perform logview-call
    initialize key-status.

*
 castdon-log-view.
    move CASTDON-DOSYA        to link-logview-dosya-adi
    set link-logview-pointer  to address of castdon-rec
    set link-logview-rec-size to size of castdon-rec
    perform logview-call
    initialize key-status.
*
 odemeler-log-view.
    open input odemeler
    initialize odemeler-rec 
    move uye-no               to odemeler-devremulk-no
    inquire form1-gd-2(event-data-2,1),cell-data in odemeler-sira
    read odemeler no lock invalid 
        continue 
    end-read 
    close odemeler
    move odemeler-dosya        to link-logview-dosya-adi
    set link-logview-pointer  to address of odemeler-rec
    set link-logview-rec-size to size of odemeler-rec
    perform logview-call
    initialize key-status.
*
 odemeler-makbuz.
    open input odemeler
    initialize odemeler-rec 
    move uye-no               to odemeler-devremulk-no
    inquire form1-gd-2(event-data-2,1),cell-data in odemeler-sira
    read odemeler no lock invalid 
        continue 
    not invalid
             initialize link-tah-cek-isl-no   
             move odemeler-cek-isl-no to link-tah-cek-isl-no
             call "/asya/ytl/obj/otel/devtahm.asy" using link-tah-cek-isl-no  
                 on exception 
                 perform callerr-proc
                 close odemeler
                 exit paragraph
                 not on exception 
              cancel "/asya/ytl/obj/otel/devtahm.asy"
              end-call
    end-read 
    close odemeler
    initialize key-status.
*
 aidat-makbuz.
    open input odemeler
    initialize odemeler-rec 
    move uye-no                 to odemeler-devremulk-no
    inquire gd4(event-data-2,1),cell-data in odemeler-sira
    read odemeler no lock invalid 
        continue 
    not invalid
             initialize link-tah-cek-isl-no   
             move odemeler-cek-isl-no to link-tah-cek-isl-no
             call "/asya/ytl/obj/otel/devtahm.asy" using link-tah-cek-isl-no  
                 on exception 
                 perform callerr-proc
                 close odemeler
                 exit paragraph
                 not on exception 
              cancel "/asya/ytl/obj/otel/devtahm.asy"
              end-call
    end-read 
    close odemeler
    initialize key-status.

*
 prim-makbuz.
    open input odemeler
    initialize odemeler-rec 
    move uye-no               to odemeler-devremulk-no
    inquire form1-gd-6(event-data-2,1),cell-data in odemeler-sira
    read odemeler no lock invalid 
        continue 
    not invalid
             initialize link-tah-cek-isl-no   
             move odemeler-cek-isl-no to link-tah-cek-isl-no
             if odemeler-cek-isl-no = zeroes then 
             display message box "Yazdirilamadi  !" 
                      close odemeler
                      exit paragraph
             end-if

             call "/asya/ytl/obj/otel/devtahm.asy" using link-tah-cek-isl-no  
                 on exception 
                 perform callerr-proc
                 close odemeler
                 exit paragraph
                 not on exception 
              cancel "/asya/ytl/obj/otel/devtahm.asy"
              end-call
    end-read 
    close odemeler
    initialize key-status.
*
 taksit-log-view.
    open input taksit
    initialize taksit-rec 
    move uye-no               to taksit-devremulk-no
    inquire form1-gd-3(event-data-2,1),cell-data in taksit-sira
    read taksit no lock invalid 
        continue 
    end-read 
    close taksit
    move taksit-dosya         to link-logview-dosya-adi
    set link-logview-pointer  to address of taksit-rec
    set link-logview-rec-size to size of taksit-rec
    perform logview-call
    initialize key-status.
*********************************loglar *********************************
*
 Form1-Gd-3-Ev-Other.
    evaluate event-type
    when msg-bitmap-clicked
        evaluate event-data-1
        when 10
            perform taksit-log-view
        end-evaluate
    end-evaluate.

*
 prim-toplam-bakiye-bul.
    open i-o odemeler
    initialize odemeler-rec prim-toplam-bakiye
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid
         continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
          if odemeler-devremulk-no <> uye-no
              exit perform 
          end-if
          if odemeler-hareket-turu <> "A"
             exit perform cycle 
          end-if 
                
          evaluate odemeler-islem-turu
          when "GS"
          when "GN" 
          when "SP" 
          when "NP"
          when "PP"
          when "SS"
          when "AV"
          when "AG"
               continue
          when other
              exit perform cycle 
          end-evaluate 
           
          compute prim-toplam-bakiye = prim-toplam-bakiye + odemeler-tutar
    end-read 
    end-perform
    end-start
    close odemeler .
*
 baslik-prim-atama-yukle.
    modify form1-gd-5,reset-grid = 1
             
    initialize form1-gd-5-record
    move "Kodu"     to gd-5-col-1
    move "Gorev"    to gd-5-col-2
    move "Limit"    to gd-5-col-3
    move "Prim Tutar" to gd-5-col-4
    move "Kodu"       to gd-5-col-6
    move "Adi"        to gd-5-col-7
    move "Soyadi"     to gd-5-col-8
    move "Tutar"      to gd-5-col-9
    modify form1-gd-5,record-to-add(form1-gd-5-record).
*
  prim-atama-grid-yukle.

    open input primhrk gorev danisman
    initialize primhrk-rec
    move 1                   to son-satir 
    move dev-prim-kodu       to primhrk-kodu
    move low-values          to primhrk-yetki-sira 
    start primhrk key not < primhrk-anah1 invalid 
          continue 
    not invalid 
    perform with test after until fs-primhrk = "10"
    read primhrk next no lock end move "10" to fs-primhrk
    not at end 
            if primhrk-kodu <> dev-prim-kodu
                exit perform 
            end-if 
            initialize form1-gd-5-record gorev-rec
            move primhrk-gorev-kodu      to gd-5-col-1 gorev-kodu
            read gorev no lock invalid 
                 move "Tanimsiz.."       to gorev-adi
            end-read 
                 move gorev-adi          to gd-5-col-2

            move primhrk-prim-sinir      to etut
            move etut                    to gd-5-col-3
            move primhrk-primi           to etut
            move etut                    to gd-5-col-4

            add 1                        to son-satir
            modify form1-gd-5,
                   record-to-add(form1-gd-5-record)
    end-read 
    end-perform
    end-start
    |    stop " "
    initialize danisman-rec grid-gorev-kodu torba-para
    move dev-danisman-kodu       to danisman-kodu 
    perform until danisman-kodu = 0 or son-satir = 1 
        if son-satir < 1
           |display message box "Prim Atanamadi-4556"
           exit perform 
        end-if 
    read danisman no lock invalid 
         display message box "Danisma Bulunamadi-4555"
         set exit-pushed to true 
    end-read 
         initialize oldu 
         perform until oldu = 1
             inquire form1-gd-5(son-satir,1),cell-data in grid-gorev-kodu
             inquire form1-gd-5(son-satir,4),cell-data in grid-prim-para
             add grid-prim-para to torba-para
          
          if grid-gorev-kodu = danisman-gorev-kodu |or danisman-sabit-prim = 1  
                if danisman-pasif = 1  
                  inquire form1-gd-5(son-satir),record-data in form1-gd-5-record                  
                  move 1                 to oldu
                  move danisman-kodu     to gd-5-col-6
                  move danisman-adi      to gd-5-col-7
                  move danisman-soyadi   to gd-5-col-8
                  move "PASIF"           to gd-5-col-9
                  modify form1-gd-5(son-satir),record-data = form1-gd-5-record
                  move danisman-bagli-kodu   to danisman-kodu
                  subtract 1 from son-satir

             else
                  inquire form1-gd-5(son-satir),record-data in form1-gd-5-record
                  move 1                 to oldu
                  move danisman-kodu     to gd-5-col-6
                  move danisman-adi      to gd-5-col-7
                  move danisman-soyadi   to gd-5-col-8
                  move torba-para        to etut
                  move etut              to gd-5-col-9
                  initialize torba-para
                  modify form1-gd-5(son-satir),record-data = form1-gd-5-record
                  move danisman-bagli-kodu   to danisman-kodu
                  subtract 1 from son-satir
                end-if 
             else
                subtract 1 from son-satir
                if son-satir < 0
                   |display message box "Prim Atanamadi-4557"
                   exit perform 
                end-if 
             end-if 
         end-perform 
    end-perform
    close primhrk gorev danisman.
*
 baslik-sabit-prim-yukle.
    modify form1-gd-7,reset-grid = 1
                      mass-update = 1
    initialize form1-gd-7-record
    move "Kodu"       to gd-7-col-1
    move "Gorev"      to gd-7-col-2
    move "Limit"      to gd-7-col-3
    move "Prim Tutar" to gd-7-col-4
 
    modify form1-gd-7,record-to-add(form1-gd-7-record).
*
 sabit-prim-grid-yukle.
    open input primhrk gorev danisman prim
    initialize primhrk-rec
    move dev-sabit-prim-kodu       to primhrk-kodu
    move low-values                to primhrk-yetki-sira 
    start primhrk key not < primhrk-anah1 invalid 
          continue 
    not invalid 
    perform with test after until fs-primhrk = "10"
    read primhrk next no lock end move "10" to fs-primhrk
    not at end 
            if primhrk-kodu <> dev-sabit-prim-kodu
                exit perform 
            end-if
            initialize prim-rec
            move primhrk-kodu            to prim-kodu
            read prim no lock invalid 
                 continue 
            end-read 
            if prim-sabit not = 1
               exit perform cycle 
            end-if
            initialize danisman-rec form1-gd-7-record
            move primhrk-gorev-kodu      to danisman-kodu gd-7-col-1
            read danisman no lock invalid
                 move "  " to danisman-adi
            end-read 
               move danisman-adi to gd-7-col-2



            move primhrk-prim-sinir      to etut
            move etut                    to gd-7-col-3
            move primhrk-primi           to etut
            move etut                    to gd-7-col-4

            modify form1-gd-7,
                   record-to-add(form1-gd-7-record)
    end-read 
    end-perform
    end-start
    close primhrk gorev danisman prim.
    modify form1-gd-7,mass-update = 0. 
*
 prim-dagit.
    if dev-prim-kodu > 0
       perform normal-prim-dagit
    end-if
    if dev-sabit-prim-kodu > 0
       perform sabit-prim-dagit
    end-if.
*
 prim-yeniden-dagit.
    perform prim-odemeler-sil
    if odeme-bulundu = 1 then
         display message box "Prim Odemesi veya Prim Geri Odemesi Bulunmaktadir ! "new-line"Primler Tekrar Dagitilamaz ! "
         icon 3
         exit paragraph
    end-if
    perform prim-dagit.
*
 prim-odemeler-sil.
    open i-o odemeler
    initialize odemeler-rec odeme-bulundu
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid
         continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
          if odemeler-devremulk-no <> uye-no
              exit perform 
          end-if
          if odemeler-hareket-turu <> "A"
             exit perform cycle 
          end-if 
          evaluate odemeler-islem-turu
          when "GS"
          when "GN" 
          when "SP" 
          when "NP" 
               move 1  to odeme-bulundu
               Exit perform
          when other
              exit perform cycle 
          end-evaluate 
    end-read 
    end-perform
    end-start
    close odemeler
    
    if odeme-bulundu = 1 then
         exit paragraph
    end-if

    open i-o odemeler
    initialize odemeler-rec odeme-bulundu
    move uye-no          to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid
         continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
          if odemeler-devremulk-no <> uye-no
              exit perform 
          end-if
          if odemeler-hareket-turu <> "A"
             exit perform cycle 
          end-if 
          evaluate odemeler-islem-turu
          when "PP"
          when "SS"
              continue 
          when other
              exit perform cycle 
          end-evaluate
             delete odemeler end-delete 
       
             perform log-operation-odemeler
             perform odemesil-yaz
    end-read 
    end-perform


    end-start
    close odemeler.
*
 normal-prim-dagit.  
    inquire form1-gd-5,last-row in son-satir-bul
    open i-o odemeler
    initialize i
    perform varying i
               from 1
               by 1 
               until i > son-satir-bul
                 inquire Form1-Gd-5(i),record-data form1-gd-5-record
                 if function numval(gd-5-col-6) = zeroes or 
                    gd-5-col-6 = spaces
                       exit perform cycle 
                 else
                    perform odemeler-bos-sira-bul

                    if hangi-sira = 0
                       move 1             to hangi-sira
                    end-if 

                    initialize odemeler-rec 
                    move uye-no           to odemeler-devremulk-no
                    move hangi-sira       to odemeler-sira
                    read odemeler no lock invalid 
                         accept odemeler-tarih from century-date |ileride tarih tasiya atilacak unutma
                         move "A"                          to odemeler-hareket-turu
                         move k-kodu-tasi                  to odemeler-prim-staf                            
                         move "PP"                         to odemeler-islem-turu|sabit prim odemesi
                         move function numval(gd-5-col-9)  to odemeler-tutar
                         move function numval(gd-5-col-3)  to odemeler-limit
                         move "NA"                         to odemeler-odeme-turu
                         move function numval(gd-5-col-6)  to odemeler-danisman-kodu
                        write odemeler-rec invalid 
                             display message box "Prim Atanamadi.."
                        end-write
                        perform log-operation-odemeler
                    end-read 
                 end-if 
    end-perform
    close odemeler.
*
 sabit-prim-dagit. 
    inquire Form1-Gd-7,last-row in son-satir-bul
    open i-o odemeler
    initialize i
    perform varying i
               from 1
               by 1 
               until i > son-satir-bul
                 inquire Form1-Gd-7(i),record-data form1-gd-7-record
                 if function numval(gd-7-col-1) = zeroes or 
                    gd-7-col-1 = spaces
                       exit perform cycle 
                 else
                    perform odemeler-bos-sira-bul

                    if hangi-sira = 0
                       move 1             to hangi-sira
                    end-if 

                    initialize odemeler-rec 
                    move uye-no           to odemeler-devremulk-no
                    move hangi-sira       to odemeler-sira
                    read odemeler no lock invalid 
                         accept odemeler-tarih from century-date |ileride tarih tasiya atilacak unutma
                         move "A"                          to odemeler-hareket-turu
                         move k-kodu-tasi                  to odemeler-prim-staf                            
                         move "SS"                         to odemeler-islem-turu|sabit prim odemesi
                         move function numval(gd-7-col-4)  to odemeler-tutar
                         move function numval(gd-7-col-3)  to odemeler-limit
                         move "NA"                         to odemeler-odeme-turu
                         move function numval(gd-7-col-1)  to odemeler-danisman-kodu
                        write odemeler-rec invalid 
                             display message box "Prim Atanamadi.."
                        end-write
                        perform log-operation-odemeler 
                    end-read 
                 end-if 
    end-perform
    close odemeler.
*
 odemeler-bos-sira-bul.
     initialize odemeler-rec hangi-sira odeme-bulundu
     move uye-no           to odemeler-devremulk-no
     move high-values      to odemeler-sira 
     start odemeler key < odemeler-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-odemeler = "10"
     read odemeler previous no lock end move "10"   to fs-odemeler
     not at end 
              if odemeler-devremulk-no <> uye-no                  
                  exit perform 
              end-if
              if odemeler-sira is not numeric 
                  initialize odemeler-sira 
              end-if
              move odemeler-sira     to hangi-sira
              compute hangi-sira = hangi-sira + 1
              exit perform 
     end-read 
     end-perform
     end-start.
*
 prim-dagit-bul.
     open input odemeler
     initialize odemeler-rec  odeme-bulundu
     move uye-no           to odemeler-devremulk-no
     move high-values      to odemeler-sira
     start odemeler key < odemeler-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-odemeler = "10"
     read odemeler previous no lock end move "10"   to fs-odemeler
     not at end 
              if odemeler-devremulk-no <> uye-no                  
                  exit perform 
              end-if
              evaluate odemeler-islem-turu
              when "PP"
              when "SS"
                 continue 
              when other
                 exit perform cycle 
              end-evaluate 
              move 1         to odeme-bulundu
     end-read 
     end-perform
     end-start.
     close odemeler.
*
 Form1-Aft-Routine.
      open i-o devremulk cek taksit odemeler
      initialize devremulk-rec
      move uye-no     to devremulk-no 
      read devremulk no lock invalid 
          continue 
      not invalid
          move devremulk-no  to uye-no
          if k-kodu-tasi not = "X   " 
                perform taksit-yeniden-hesapla    
          end-if
              
      end-read 
      close devremulk cek taksit odemeler odalar2.
*
 prim-eski-dagit.
      perform baslik-prim-atama-yukle
      perform prim-eski-atama-grid-yukle
     .
*
 prim-yeni-dagit.
      perform baslik-prim-atama-yukle
      perform prim-atama-grid-yukle
      perform baslik-sabit-prim-yukle
      perform sabit-prim-grid-yukle
     .      
*
  prim-eski-atama-grid-yukle.
    open input primhrk gorev danisman
    initialize primhrk-rec
    move 1                   to son-satir 
    move dev-prim-kodu       to primhrk-kodu
    move low-values          to primhrk-yetki-sira 
    start primhrk key not < primhrk-anah1 invalid 
          continue 
    not invalid 
    perform with test after until fs-primhrk = "10"
    read primhrk next no lock end move "10" to fs-primhrk
    not at end 
            if primhrk-kodu <> dev-prim-kodu
                exit perform 
            end-if 
            initialize form1-gd-5-record gorev-rec
            move primhrk-gorev-kodu      to gd-5-col-1 gorev-kodu
            read gorev no lock invalid 
                 move "Tanimsiz.."       to gorev-adi
            end-read 
                 move gorev-adi          to gd-5-col-2

            move primhrk-prim-sinir      to etut
            move etut                    to gd-5-col-3
            move primhrk-primi           to etut
            move etut                    to gd-5-col-4

            add 1                        to son-satir
            modify form1-gd-5,
                   record-to-add(form1-gd-5-record)
    end-read 
    end-perform
    end-start
    
    initialize danisman-rec grid-gorev-kodu torba-para
    perform varying i 
             from 8
             by -1
             until i < 2
*                    inquire form1-gd-5(i,1),cell-data in grid-gorev-kodu
                    inquire form1-gd-5(i,4),
                            cell-data in grid-prim-para
                    add grid-prim-para to torba-para
                    evaluate i
                    when 8
                       move devremulk-p-asistan     to grid-gorev-kodu
                    when 7
                       move devremulk-p-danisman    to grid-gorev-kodu
                    when 6
                       move devremulk-p-liddanisman  to grid-gorev-kodu
                    when 5
                       move devremulk-p-yondanisman  to grid-gorev-kodu
                    when 4
                       move devremulk-p-ilsatmud     to grid-gorev-kodu
                    when 3
                       move devremulk-p-bolgemud     to grid-gorev-kodu
                    when 2
                       move devremulk-p-bolgekor     to grid-gorev-kodu                    
                    end-evaluate 
         |  orji  |     when 8
                 |      move devremulk-p-asistan  to grid-gorev-kodu
                 |   when 7
                 |      move devremulk-p-danisman  to grid-gorev-kodu
                 |   when 6
                 |      move devremulk-p-liddanisman  to grid-gorev-kodu
                 |   when 5
                 |      move devremulk-p-yondanisman  to grid-gorev-kodu
                 |   when 4
                 |      move devremulk-p-ilsatmud  to grid-gorev-kodu
                 |   when 3
                 |      move devremulk-p-yrdkor  to grid-gorev-kodu
                 ||   when 2
                 |      move devremulk-p-kor  to grid-gorev-kodu                    
                 |   end-evaluate 
                    if grid-gorev-kodu > 0
                        move grid-gorev-kodu  to danisman-kodu
                        read danisman no lock invalid 
                             continue 
                        not invalid 
                            move i   to son-satir
                            perform satir-at
                        end-read 
                    end-if
    end-perform. 
    close primhrk gorev danisman.
*
 satir-at.
       |    if danisman-pasif = 1  
      |       inquire form1-gd-5(son-satir),record-data in form1-gd-5-record                  
           
      |       move danisman-kodu     to gd-5-col-6
      |       move danisman-adi      to gd-5-col-7
      |       move danisman-soyadi   to gd-5-col-8
      |       move torba-para        to etut
       |      move etut              to gd-5-col-9  
       |      modify form1-gd-5(son-satir),record-data = form1-gd-5-record
       |    else
             inquire form1-gd-5(son-satir),record-data in form1-gd-5-record                 
             move danisman-kodu     to gd-5-col-6
             move danisman-adi      to gd-5-col-7
             move danisman-soyadi   to gd-5-col-8
             move torba-para        to etut
             move etut              to gd-5-col-9
             initialize torba-para
             modify form1-gd-5(son-satir),record-data = form1-gd-5-record.
        |   end-if . 
*
 odemesil-yaz.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
         initialize genelfis-rec
         move 1 to genelfis-anahtar
     end-read
     add 1            to ekran-fis-1
     move ekran-fis-1 to odemesil-sira
     rewrite genelfis-rec invalid
         write genelfis-rec, end-write
     end-rewrite
     close genelfis

     open i-o odemesil
     initialize odemesil-rec

     move odemesil-sira to odemesil-islem-no  
     accept odemesil-tarih from century-date
     move  odemeler-devremulk-no to odemesil-dev-no 

      move odemeler-hareket-turu  to  odemesil-hareket-turu     
      move odemeler-islem-turu    to   odemesil-islem-turu 
      move odemeler-tutar         to odemesil-tutar
      move odemeler-odeme-turu    to odemesil-odeme-turu
      move odemeler-cekno         to odemesil-cekno
      move odemeler-cek-isl-no    to odemesil-cek-isl-no
      move k-kodu-tasi            to odemesil-staf
      write odemesil-rec invalid
              stop "odemesil yazilamadi"
      end-write 

     close odemesil   .
*
 Form1-Pb-2-Link.
           move  link-not-donus  to  toplam-not
           move "U"     to  link-not-islem
           move "DEV"   to  link-not-dos    
           move uye-no  to link-not-dos-anah(1:8) 
           move 1 to link-nereden 
           string  uye-no delimited by "  " 
                  " " delimited by size
                  " 'Nolu Sozlesme" delimited by size
                  into link-dosya-aciklamasi
                  call "/asya/ytl/obj/otel/mesajgir.asy" 
                       using link-not
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/mesajgir.asy"
                  end-call
                  move  link-not-donus  to  toplam-not
     .

*
 Form3-Cm-1-Ev-Ntf-Selchange.
        perform devremulk-fiyat-bul
     .
*
 kapali-pasif-kontrol.   

         initialize pasif-sozlesme 
         if devremulk-durumu = "S" and link-uye-no not = zeroes then
                 move 1 to pasif-sozlesme 
                 display message box "Pasif Sozlesme ! Islem Yapilamaz ."
                 icon 3
                 exit paragraph
         end-if

         if devremulk-durumu = "K" and link-uye-no not = zeroes then
                 move 1 to pasif-sozlesme 
                 display message box "Kapali Sozlesme ! Islem Yapilamaz ."
                 icon 3
                 exit paragraph
         end-if
        .
*
 Form1-Mn-2-MI-PrimiSil-Link.
         perform kapali-pasif-kontrol
         if pasif-sozlesme = 1  then
                 exit paragraph 
         end-if
         perform prim-yetki-kontrol
         if yetki-yok = 1 then
                 display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                 icon 3
                 exit paragraph
         end-if

       open i-o odemeler

              initialize odemeler-rec
              move uye-no        to odemeler-devremulk-no
              move prim-sira-no  to odemeler-sira
              read odemeler no lock invalid
                      continue
              not invalid
                 
                 display message box "Sectiginiz Prim Silinecektir Emin Misiniz ?"
                 icon 1
                 type 2
                 default 2
                 returning return-code 
                 if return-code not = 1 then
                       close odemeler
                       exit paragraph
                 end-if
                 delete odemeler
                 end-delete

                 display message box "Islem Tamamlanmisir !"
              end-read
        
      close odemeler
     .
*
 fatura-kontol.
    
       initialize yetki-yok
       if devremulk-fatura-no not = spaces  then
             if devremulk-fatura-no not = zeroes  then   
                 move 1 to yetki-yok
             end-if
       end-if 
             .
*
 kayit-yetki-kontrol .
       open input kllnc
       initialize yetki-yok
       move k-kodu-tasi to K-KODU
       read kllnc no lock invalid
               continue
       not invalid
            if k-dev-yetki not = 1 then
               move 1 to yetki-yok
            else
               move 0 to yetki-yok
            end-if
       end-read
       close kllnc      .
*
 yetki-kontrol .
       open input kllnc
       initialize yetki-yok
       move k-kodu-tasi to K-KODU
       read kllnc no lock invalid
               continue
       not invalid
            if k-dev-tah-yetki not = 1 then
               move 1 to yetki-yok
            else
               move 0 to yetki-yok
            end-if
       end-read
       close kllnc      .
*
 prim-yetki-kontrol .
       open input kllnc
       initialize yetki-yok
       move k-kodu-tasi to K-KODU
       read kllnc no lock invalid
               continue
       not invalid
            if k-dev-prim-yetki not = 1 then
               move 1 to yetki-yok
            else
               move 0 to yetki-yok
            end-if
       end-read
       close kllnc      .
*
 Form1-Gd-6-Ev-Other.
     evaluate event-type
     when msg-begin-entry
           move event-action-fail to event-action
     when msg-bitmap-clicked 
          evaluate event-data-1
          when 10
                 perform prim-makbuz 
          end-evaluate
     when msg-goto-cell-mouse
          initialize prim-satir
          inquire Form1-Gd-6, y in prim-satir
          inquire Form1-Gd-6(prim-satir,1), cell-data in prim-sira-no
     end-evaluate 
     .
*
 sms-gonder.
          initialize link-devremulk-no link-sms-nereden link-tutar
         if soz-sms-gonder   = 1 then  
               move sat-tar  to link-tarih     
         else 
            if tapu-sms-gonder = 1 then
               move tapu-tar to link-tarih
            end-if
         end-if
           move uye-no    to link-devremulk-no
           move "D"       to link-sms-nereden
           move sat-fiy   to link-tutar
           call "/asya/ytl/obj/otel/smsgond.asy" using link-devremulk-no link-sms-nereden link-tutar link-tarih
           on exception perform callerr-proc
                not on exception
                cancel "/asya/ytl/obj/otel/smsgond.asy" 
            end-call

       .
*
 accept-0115a-Aft-Procedure.
     open input doviz
     initialize doviz-rec
     move aidat-doviz to doviz-kodu
     read doviz no lock invalid
             continue
     not invalid
          modify Form1-La-2 , title = D-ADI-1    

     end-read
     close doviz
     .
*
 gd4-Ev-Other.
        evaluate event-type
     when msg-bitmap-clicked 
          evaluate event-data-1
          when 9
               if k-kodu-tasi = "ASYA" stop " " end-if
               inquire gd4, y in grid-sira-id
               inquire gd4(grid-sira-id,3) , cell-data in borc-alacak
                 perform kapali-pasif-kontrol
                 if pasif-sozlesme = 1  then
                     exit paragraph 
                 end-if

                  perform yetki-kontrol
                 if yetki-yok = 1 then
                         display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                         icon 3
                         exit paragraph
                 end-if
                 |****fat no sorgula
                 open input odemeler
                         initialize odemeler-rec
                         move uye-no to odemeler-devremulk-no
                         inquire gd4(grid-sira-id,1) , cell-data in odemeler-sira
                         read odemeler no lock invalid
                                 display message box "Hata x9"
                                 stop " "
                         not invalid
                              if odemeler-fatura-no <> spaces then
                                  if odemeler-fatura-no <> zeroes then
                                      display message box "Faturasi Kesilmis Aidat ! , Bu Islem Yapilamaz "
                                      icon 3
                                      close odemeler
                                      exit paragraph
                                  end-if
                              end-if
                         end-read
                 close odemeler
                 ||||||
                 if borc-alacak  = "B" then
                        display message box "Secilen Kayit Aidat Borc Tutaridir" new-line
                            "Devam Etmek Istiyor musunuz ?"
                        title "Uyari"
                        icon 1
                        type 2
                        default 2
                        returning return-code 
                        if return-code = 2
                              exit paragraph 
                        end-if  
                end-if
                perform aidat-ekrana-getir




                 perform aidat-baslik-yukle
                 perform aidat-grid-yukle
          when 10
              perform aidat-makbuz 
          end-evaluate
     end-evaluate 
     .
*
 guncel-borc-getir.
 
         initialize link-guncel-borc link-aidat-borc-tl link-devremulk-no link-aidat-borc-dv 
         move uye-no to link-devremulk-no
         call "/asya/ytl/obj/otel/devgunsor.asy" using link-devremulk-no link-guncel-borc link-aidat-borc-tl link-aidat-borc-dv
                    on exception perform callerr-proc
                not on exception
          cancel "/asya/ytl/obj/otel/devgunsor.asy" 
          end-call
          display Form1-Ef-1
         .
    
*
 Form1-Mn-1-MI-RezNoKaldir-Link.
         
     .
*
 Form5-Bef-Create.
      initialize yeni-rez-no
     .
*
 Form1-Mn-1-MI-RezNoBagla-Link.
     .
*
 Form5-Pb-1-Link.
        move 1 to yeni-rez-tamam
        set exit-pushed to true
     .
*     
 rez-ara.
      initialize rezara-cagir.
      move "I"   to rezara-cagri-tipi
      call "/asya/ytl/obj/otel/rezara.asy" using rezara-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/rezara.asy" 
       end-call.
       move rezara-rez-no-cagir  to yeni-rez-no 
       display Form5-Ef-1.
*
 Form5-Ex-Other.
      evaluate key-status
        when 1
         if control-id = 5001 then
             perform rez-ara
         end-if 
      end-evaluate
     .
*
 odeme-tl-hesapla.
     open input kur
     initialize kur-rec para-hesapla  
     move tarih-tasi           to kur-tarih
     move 01                   to kur-banka
     move aidat-doviz          to kur-doviz
*     if odemeler-banka-kodu not = spaces
*        move odemeler-banka-kodu to kur-banka
*     end-if
     read kur no lock invalid        
          if aidat-doviz = 2 and isyeri-adres-tasi = "ilgaz017"
*             if debug = 5 stop " " end-if
             move 3 to doviz-alis 
              if DOVIZ-ALIS > 0.00001 then 
                  compute para-hesapla rounded = doviz-tutari * DOVIZ-ALIS
              END-IF
          end-if
     not invalid
             if DOVIZ-ALIS > 0.00001 then 
                  compute para-hesapla rounded = doviz-tutari * DOVIZ-ALIS
             END-IF
     end-read
     display accept-0109
     close kur
     .

*
 odeme-dv-hesapla.
     open input kur
     initialize kur-rec para-hesapla
     move odemeler-tarih       to kur-tarih
     move 01                   to kur-banka
     move aidat-doviz          to kur-doviz
     if odemeler-banka-kodu not = spaces
        move odemeler-banka-kodu to kur-banka
     end-if
     if odemeler-doviz-kodu > 0 
        move odemeler-doviz-kodu to kur-doviz
     end-if
     read kur no lock invalid        
          if aidat-doviz = 2 and isyeri-adres-tasi = "ilgaz017" 
             move 3 to doviz-alis 
             if DOVIZ-ALIS > 0.00001 then 
                  compute para-hesapla rounded = tl-tutari / DOVIZ-ALIS
             END-IF
          end-if
     not invalid
              if DOVIZ-ALIS > 0.00001 then 
                  compute para-hesapla rounded = tl-tutari / DOVIZ-ALIS
              END-IF
     end-read
     display accept-0109
     close kur
     .
*
 Form6-Aft-Initdata.

     modify grd-9 , reset-grid = 1
     initialize grd-9-record  
     move "Sira"       to grd-9-col-1
     move "Rez No"     to grd-9-col-2
     move "Giris"      to grd-9-col-3
     move "Cikis"      to grd-9-col-4
     move "Oda"        to grd-9-col-5
     move "Durum"      to grd-9-col-6
     move "Satis Durum" to grd-9-col-7
     modify grd-9,record-to-add(grd-9-record)

     open input donhrk rez konuk
     initialize donhrk-rec kayit-sayi renk-sayi
     move dev-odano      to donhrk-oda
     if dev-odano(5:1) not = space
        move dev-odano to o-uzun
        perform oda-kisalt
        move o-kisa    to donhrk-oda
     end-if
     move dev-donem      to donhrk-kodu
     move secili-dev-yil to donhrk-yili
     move uye-no         to donhrk-devremulk-no
     read donhrk no lock invalid
             continue
     not invalid

           move donhrk-bas-gun     to egun
           move donhrk-bas-ay      to eay
           move donhrk-bas-yil     to eyil
           modify lbl-tarih1 , title = etar 

           move donhrk-bit-gun     to egun
           move donhrk-bit-ay      to eay
           move donhrk-bit-yil     to eyil
           modify lbl-tarih2 , title = etar 

   
****************************
        
        perform varying r 
                from 1 
                by 1 
                until r > 5 

          initialize grd-9-record rez-rec
          move r  to grd-9-col-1

          evaluate r
          when 1
                  move donhrk-rez-no   to rez-no grd-9-col-2   move donhrk-tip-1 to secili-donhrk-tip
          when 2
                  move donhrk-rez-no-2 to rez-no grd-9-col-2   move donhrk-tip-2 to secili-donhrk-tip
          when 3
                  move donhrk-rez-no-3 to rez-no grd-9-col-2   move donhrk-tip-3 to secili-donhrk-tip
          when 4
                  move donhrk-rez-no-4 to rez-no grd-9-col-2   move donhrk-tip-4 to secili-donhrk-tip

          when 5
                  move donhrk-rez-no-5 to rez-no grd-9-col-2   move donhrk-tip-5 to secili-donhrk-tip
          end-evaluate

          read rez no lock invalid
                   continue
          not invalid 
                   move REZ-GIR-GUN to grd-9-col-3(1:2)
                   move "/"         to grd-9-col-3(3:1)
                   move REZ-GIR-ay  to grd-9-col-3(4:2)
                   move "/"         to grd-9-col-3(6:1)
                   move REZ-GIR-yil to grd-9-col-3(7:4)
        
                   move REZ-cik-GUN to grd-9-col-4(1:2)
                   move "/"         to grd-9-col-4(3:1)
                   move REZ-cik-ay  to grd-9-col-4(4:2)
                   move "/"         to grd-9-col-4(6:1)
                   move REZ-cik-yil to grd-9-col-4(7:4)
                   if rez-durumu = "S" then
                       move "SILINMIS"   to grd-9-col-6
                   ELSE 
                           move REZ-FOLIO to konuk-folio
                           read konuk no lock invalid
                              move "GELECEK"   to grd-9-col-6
                           not invalid
                               if KONUK-DURUMU = "I" then
                                  move "C/IN"  to grd-9-col-6
                               end-if
                               if KONUK-DURUMU = "H" then
                                  move "C/OUT" to grd-9-col-6
                               end-if
                           end-read
                   END-IF
                   move rez-odano     to grd-9-col-5
           end-read 
  
           if rez-no = zeroes or spaces then
                move " " to grd-9-col-2
                move donhrk-tip-donem  to secili-donhrk-tip 
           end-if
              
           evaluate secili-donhrk-tip
           when "S"
                move "SATILDI"     to grd-9-col-7 
           when "K"
                move "KIRALANDI"   to grd-9-col-7
           when other
                move "NORMAL"      TO grd-9-col-7 
           end-evaluate
            modify grd-9,record-to-add(grd-9-record)
 
             evaluate secili-donhrk-tip
             when "S"
                modify grd-9(r + 1),
                       row-color = 480
             when "K"
                modify grd-9(r  + 1),
                       row-color = 176
             end-evaluate

****************************** *
      end-perform
     
     end-read 

     close donhrk rez konuk

     .
     
*
 Form6-Mn-1-MI-RezervasyonOlustur-Link.
         perform kapali-pasif-kontrol
         if pasif-sozlesme = 1  then
                 exit paragraph 
         end-if
          OPEN INPUT DONEM
          move dev-donem to donem-kodu
          move secili-dev-yil to donem-yili
          read donem no lock invalid
                  display message box "Basarisizz x9"
                  exit paragraph
          end-read
          CLOSE DONEM
          initialize gruplar-rec link-rez-no link-gelen-rec 
                     link-gelen-sharenum link-rez-grup-rec
          inquire grd-9,
                     cursor-x         in end-x
                     cursor-y         in end-y            
          move DONEM-BAS-TAR to  gruplar-gel-tar
          move DONEM-BIT-TAR to  gruplar-git-tar
          inquire grd-9(end-y,2),cell-data in link-rez-no
          inquire grd-9(end-y,1),cell-data in secili-donhrk-rez-sira
          if link-rez-no not = zeroes
                exit paragraph 
          end-if 

          if  link-guncel-borc >= 1 then
                   initialize uyari-mesaj
                   move link-devremulk-no to z-uye-no
                   move link-guncel-borc  to z-borc
                   string "Rezervasyon Sahibinin Devremulk Sozlesmesine Ait " delimited by size
                   z-borc delimited by size
                   " TL GUNCEL Borcu Bulunmaktadir ! , Devam Etmek Istiyormusunuz ?" delimited by size
                   "  -------- Devremulk Uye No : " delimited by size
                   z-uye-no delimited by size
                   into uyari-mesaj
                   display message box uyari-mesaj
                   icon 3
                   type 2
                   default 2
                   returning return-code 
                   if return-code not = 1 then
                       exit paragraph
                   end-if
           end-if
           
           if  link-aidat-borc-tl >= 1 then
                   initialize uyari-mesaj
                   move link-devremulk-no to z-uye-no
                   move link-aidat-borc-tl to z-borc
                   string "Rezervasyon Sahibinin Devremulk Sozlesmesine Ait " delimited by size
                   z-borc delimited by size
                   " TL AIDAT Borcu Bulunmaktadir ! , Devam Etmek Istiyormusunuz ?" delimited by size
                   "  -------- Devremulk Uye No : " delimited by size
                   z-uye-no delimited by size
                   into uyari-mesaj
                   display message box uyari-mesaj
                   icon 3
                   type 2
                   default 2
                   returning return-code 
                   if return-code not = 1 then
                        exit paragraph
                   end-if
          end-if
          move dev-oda-konumu    to gruplar-adi(99:2) 
          move gruplar-rec       to link-rez-grup-rec
          move "DEVRE-----"      to link-gelen-rec(1:10)
          move uye-no            to link-gelen-rec(11:10)
*          stop " "
          call "/asya/ytl/obj/otel/rez.asy" 
                        using  link-rez-no link-gelen-rec link-gelen-sharenum link-rez-grup-rec 
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/rez.asy"
          end-call


          open i-o rez donhrk
          initialize rez-rec 
          move link-rez-no    to rez-no
          read rez no lock invalid 
               continue 
          not invalid
               if rez-durumu = "I"
                initialize donhrk-rec
                move secili-dev-yil    to donhrk-yili

                move dev-odano         to donhrk-oda               
                     if dev-odano(5:1) not = space
                        move dev-odano to o-uzun
                        perform oda-kisalt
                        move o-kisa    to donhrk-oda
                     end-if
                move dev-donem         to donhrk-kodu                
                move uye-no            to donhrk-devremulk-no
                read donhrk no lock invalid 
                     display message box "Kayit Okunamadi..."
                                     title "Uyari"
                                     icon 1
                         close donhrk rez 
                         exit paragraph 
                not invalid 
                evaluate secili-donhrk-rez-sira
                   when 1
                         move rez-no       to donhrk-rez-no
                   when 2
                         move rez-no       to donhrk-rez-no-2
                   when 3
                         move rez-no       to donhrk-rez-no-3
                   when 4
                          move rez-no      to donhrk-rez-no-4
                   when 5
                         move rez-no       to donhrk-rez-no-5
                end-evaluate
                     rewrite donhrk-rec end-rewrite 
                     perform log-operation-donhrk
                end-read 
               end-if 
          end-read 
          close rez donhrk
          perform donhrk-top-rez-gun-hesapla
          perform donhrk-cast-olustur
          perform Form6-Aft-Initdata
          perform oda-ve-donem-kapat-kontrol 
          perform Form6-Bef-Initdata  .


*
 Form6-Mn-1-MI-Kirala-Link.
            
         perform kapali-pasif-kontrol
         if pasif-sozlesme = 1  then
                 exit paragraph 
         end-if
          inquire grd-9,
                     cursor-x         in end-x
                     cursor-y         in end-y      
          inquire grd-9(end-y,1),cell-data in secili-donhrk-rez-sira
          inquire grd-9(end-y,2),cell-data in secili-donhrk-rez
 
          if secili-donhrk-rez = zeroes or spaces then
                 display message box "Once Rezervasyon Aciniz !"
                 exit paragraph 
          end-if

             open i-o donhrk
             initialize donhrk-rec            
             MOVE secili-dev-yil    TO donhrk-yili

             move dev-odano         to donhrk-oda
             if dev-odano(5:1) not = space
                move dev-odano to o-uzun
                perform oda-kisalt
                move o-kisa    to donhrk-oda
             end-if

             move dev-donem         to donhrk-kodu
             move uye-no            to donhrk-devremulk-no
             read donhrk no lock invalid 
                  display message box "Kayit Bulunamadi.."
                                  title "Uyari"
                                  icon 1
                    close donhrk
                    exit paragraph
             not invalid
                  evaluate key-status
                     when 1005
                           move "K" to popup-secim-tur
                     when 1006
                           move "S" to popup-secim-tur
                     when 1009
                           initialize popup-secim-tur
                  end-evaluate
                  evaluate secili-donhrk-rez-sira
                  when 1
                      move popup-secim-tur  to donhrk-tip-1
                  when 2
                      move popup-secim-tur  to donhrk-tip-2
                  when 3
                      move popup-secim-tur  to donhrk-tip-3
                  when 4
                      move popup-secim-tur  to donhrk-tip-4
                  when 5
                      move popup-secim-tur  to donhrk-tip-5
                  end-evaluate
                  rewrite donhrk-rec end-rewrite 
                  perform log-operation-donhrk
             end-read

             close donhrk
             perform donhrk-top-rez-gun-hesapla
             perform donhrk-cast-olustur
             perform Form6-Aft-Initdata
             perform oda-ve-donem-kapat-kontrol
             perform Form6-Bef-Initdata
     .
*
 Form6-Mn-1-MI-RezNoKaldir-Link.
       perform kapali-pasif-kontrol
         if pasif-sozlesme = 1  then
                 exit paragraph 
         end-if
        open input kllnc
          move k-kodu-tasi to K-KODU
          read kllnc no lock invalid
                  continue
          end-read
          close kllnc

          if K-SUPER not = "E" then
                display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                icon 3
                exit paragraph
          end-if
          inquire grd-9,
                     cursor-x         in end-x
                     cursor-y         in end-y      
         inquire grd-9(end-y,1),cell-data in secili-donhrk-rez-sira
          inquire grd-9(end-y,2),cell-data in secili-donhrk-rez
 
          if secili-donhrk-rez = zeroes or spaces then
                 exit paragraph 
          end-if

          open i-o donhrk rez
          initialize donhrk-rec
          inquire grd-9,
                     cursor-x         in end-x
                     cursor-y         in end-y            
          move secili-dev-yil to  donhrk-yili
          move dev-donem      to  donhrk-kodu
          move dev-odano      to donhrk-oda
             if dev-odano(5:1) not = space
                move dev-odano to o-uzun
                perform oda-kisalt
                move o-kisa    to donhrk-oda
             end-if
          move uye-no         to donhrk-devremulk-no
          read donhrk no lock invalid
                    close donhrk rez
                    exit paragraph 
          not invalid
                    
                     display message box "Rezervasyon Numarasi Kaldirilacaktir ! Emin misiniz ?"
                     type 2
                     default 2
                     returning return-code 
                     if return-code not = 1 then
                            close donhrk
                            exit paragraph
                     end-if

                      evaluate secili-donhrk-rez-sira
                      when 1
                                initialize donhrk-rez-no    donhrk-tip-1
                      when 2
                                initialize donhrk-rez-no-2  donhrk-tip-2
                      when 3
                                initialize donhrk-rez-no-3  donhrk-tip-3
                      when 4                                
                                initialize donhrk-rez-no-4  donhrk-tip-4
                      when 5
                                initialize donhrk-rez-no-5  donhrk-tip-5
                      end-evaluate

              rewrite donhrk-rec invalid
                      continue
              end-rewrite
              perform log-operation-donhrk

              initialize rez-rec
              MOVE secili-donhrk-rez to rez-no 
              read rez no lock invalid
                      continue
              not invalid
                    initialize rez-dev-uye-no

                    accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                    accept rez-edit-zaman from time          |                           

                    rewrite rez-rec invalid
                            stop " "
                    end-rewrite
                    perform log-operation-rez
              end-read

          end-read
          close donhrk rez
          perform donhrk-top-rez-gun-hesapla
          perform donhrk-cast-olustur
          perform Form6-Aft-Initdata
          perform oda-ve-donem-kapat-kontrol
          perform Form6-Bef-Initdata
     .
*
 grd-9-Ev-Other.
     evaluate event-type
     when msg-begin-entry
          move event-action-fail to event-action
          evaluate event-data-1 
          when 2
                    initialize link-rez-no
                     inquire grd-9,
                                cursor-x         in end-x
                                cursor-y         in end-y            
                     inquire grd-9(end-y,2)
                             cell-data in link-rez-no
                  if link-rez-no not = zeroes 
                     call "/asya/ytl/obj/otel/rez.asy" 
                                using  link-rez-no 
                                on exception 
                                perform callerr-proc
                                exit paragraph
                                not on exception 
                           cancel "/asya/ytl/obj/otel/rez.asy"
                     end-call         
                  end-if 
                   perform Form6-Aft-Initdata
           
         end-evaluate
     end-evaluate  
     .
*
 Form6-Mn-1-MI-RezNoBaga-Link.
        perform kapali-pasif-kontrol
         if pasif-sozlesme = 1  then
                 exit paragraph 
         end-if
          open input kllnc  
          move k-kodu-tasi to K-KODU
          read kllnc no lock invalid
                  continue
          end-read
          close kllnc

          if K-SUPER not = "E" then
                display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                icon 3
                exit paragraph
          end-if


          open i-o donhrk rez
          initialize donhrk-rec
          inquire grd-9,
                     cursor-x         in end-x
                     cursor-y         in end-y

          inquire grd-9(end-y,1),cell-data in secili-donhrk-rez-sira
          move secili-dev-yil to  donhrk-yili
          move dev-donem  to  donhrk-kodu

          move dev-odano  to donhrk-oda
             if dev-odano(5:1) not = space
                move dev-odano to o-uzun
                perform oda-kisalt
                move o-kisa    to donhrk-oda
             end-if
          move uye-no     to donhrk-devremulk-no
          read donhrk no lock invalid
                    close donhrk rez
                    exit paragraph 
          not invalid
              initialize yeni-rez-tamam
              perform Acu-Form5-Routine

              if yeni-rez-tamam = 1 then


                      evaluate secili-donhrk-rez-sira
                      when 1
                                move yeni-rez-no to donhrk-rez-no     
                      when 2
                                move yeni-rez-no to donhrk-rez-no-2   
                      when 3
                                move yeni-rez-no to donhrk-rez-no-3  
                      when 4                                
                                move yeni-rez-no to donhrk-rez-no-4  
                      when 5       
                                move yeni-rez-no to donhrk-rez-no-5 
                      end-evaluate

                      rewrite donhrk-rec invalid
                              continue
                      end-rewrite
                      perform log-operation-donhrk

                      initialize rez-rec
                      MOVE yeni-rez-no to rez-no 
                      read rez no lock invalid
                              continue
                      not invalid
                            move uye-no to rez-dev-uye-no

                            accept rez-edit-tarih from century-date  |firat amonra iin konuldu 03/11/2020
                            accept rez-edit-zaman from time          |                           

                            rewrite rez-rec invalid
                                    stop " "
                            end-rewrite
                            perform log-operation-rez
                      end-read
              end-if

          end-read
          close donhrk  rez
          perform donhrk-top-rez-gun-hesapla
          perform donhrk-cast-olustur
          perform Form6-Aft-Initdata
          perform oda-ve-donem-kapat-kontrol
          perform Form6-Bef-Initdata
     .
*
 grd-9-Ex-Other.

     .
*
 Form6-Bef-Initdata.
        open i-o  donhrk castdon takvim  rez donem
     open input cast

     initialize donem-rec
     move dev-donem to donem-kodu
     start donem key not < donem-anah invalid 
          continue 
     not invalid 
     perform with test after until fs-donem = "10"
     read donem next no lock end move "10" to fs-donem
     not at end
            if dev-donem <> donem-kodu then
                  exit perform
            end-if
            if DONEM-YILI <> secili-dev-yil then
                 exit perform cycle
            end-if
            move donem-kodu    to donhrk-KODU
            MOVE DONEM-YILI    TO DONHRK-YILI
            MOVE dev-odano     TO DONHRK-ODA
             if dev-odano(5:1) not = space
                move dev-odano to o-uzun
                perform oda-kisalt
                move o-kisa    to donhrk-oda
             end-if
            move uye-no        to donhrk-devremulk-no

            move DONEM-BAS-TAR to donhrk-BAS-TAR
            move DONEM-BIT-TAR to donhrk-BIT-TAR 
            
            read donhrk no lock invalid
                    continue
            not invalid
                                   
                   initialize rez-rec donhrk-toplam-rez
                   move donhrk-rez-no to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-2 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-3 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-4 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                
                   initialize rez-rec
                   move donhrk-rez-no-5 to rez-no
                   perform gun-bul
                   add gun-s to donhrk-toplam-rez
                   
                  
                   move donhrk-toplam-rez to donhrk-trez-a-gun 
  
                   perform dev-donem-gun-bul
                   move gun-s to donhrk-donem-top-gun
                   compute donhrk-trez-k-gun = donhrk-donem-top-gun - donhrk-trez-a-gun

                   move donhrk-donem-top-gun to z-gun
                   modify lbl-donem-gunu , title = z-gun

                   move donhrk-trez-a-gun to z-gun
                   modify lbl-rez-gun    , title = z-gun

                   move donhrk-trez-k-gun to z-gun
                   modify lbl-kalan-gun  , title = z-gun

                   rewrite donhrk-rec invalid
                           stop " "
                   end-rewrite
            end-read             

     end-read 
     end-perform
     end-start

     close  donhrk  castdon takvim rez cast donem . 
     .
*
 tah-mesaj-oku.
      modify gd-0901,reset-grid = 1
      initialize gd-0901-rec
      move "Tarih" to gd-0901-col-1
      move "Zaman" to gd-0901-col-2
      move "K.Adi" to gd-0901-col-3
      move "K.Syd" to gd-0901-col-4
      move "NOT"   to gd-0901-col-5
      modify gd-0901,record-to-add(gd-0901-rec)
    
      open input nt kllnc
      initialize not-rec
      move "AIT"  to not-dos
      move uye-no to not-dos-anah 
      start nt key not < not-anah invalid
         continue
      not invalid
      perform until fs-not = "10"
      read nt next no lock end move "10" to fs-not
      not end
               
          if "AIT" <> not-dos then
                exit perform
          end-if
          if uye-no  <>  function numval(not-dos-anah(1:8)) then
                exit perform 
          end-if
    
          if not-tip = "S" then
               exit perform cycle 
          end-if
    
          initialize gd-0901-rec
          move not-giris-yil    to eyil
          move not-giris-ay     to eay
          move not-giris-gun    to egun
          move etar             to gd-0901-col-1
    
          move not-giris-saat   to esaat
          move not-giris-dakika to edakika
          move ezaman           to gd-0901-col-2

          initialize kllnc-rec
          move not-giris-staf   to k-kodu
          read kllnc no lock invalid
              move "Silinmis"   to k-adi
              move "Silinmis"   to k-soyadi
          end-read

          move k-adi            to gd-0901-col-3
          move k-soyadi         to gd-0901-col-4
          move not1             to gd-0901-col-5
          modify gd-0901,record-to-add(gd-0901-rec)
    
     end-read
     end-perform
     end-start
     close nt kllnc
     .
*
 ode-mesaj-oku.
      modify gd-1001,reset-grid = 1
      initialize gd-1001-rec
      move "Tarih" to gd-1001-col-1
      move "Zaman" to gd-1001-col-2
      move "K.Adi" to gd-1001-col-3
      move "K.Syd" to gd-1001-col-4
      move "NOT"   to gd-1001-col-5
      modify gd-1001,record-to-add(gd-1001-rec)
    
      open input nt kllnc
      initialize not-rec
      move "AIO"  to not-dos
      move uye-no to not-dos-anah 
      start nt key not < not-anah invalid
         continue
      not invalid
      perform until fs-not = "10"
      read nt next no lock end move "10" to fs-not
      not end
               
          if "AIO" <> not-dos then
                exit perform
          end-if
          if uye-no  <>  function numval(not-dos-anah(1:8)) then
                exit perform 
          end-if
    
          if not-tip = "S" then
               exit perform cycle 
          end-if
    
          initialize gd-1001-rec
          move not-giris-yil    to eyil
          move not-giris-ay     to eay
          move not-giris-gun    to egun
          move etar             to gd-1001-col-1
    
          move not-giris-saat   to esaat
          move not-giris-dakika to edakika
          move ezaman           to gd-1001-col-2

          initialize kllnc-rec
          move not-giris-staf   to k-kodu
          read kllnc no lock invalid
              move "Silinmis"   to k-adi
              move "Silinmis"   to k-soyadi
          end-read

          move k-adi            to gd-1001-col-3
          move k-soyadi         to gd-1001-col-4
          move not1             to gd-1001-col-5
          modify gd-1001,record-to-add(gd-1001-rec)
    
     end-read
     end-perform
     end-start
     close nt kllnc
     .
*
 mesaj-oku.
         modify grd-11,reset-grid = 1
         initialize grd-11-record
         move "Tarih" to Gd-11-Col-1
         move "Zaman" to Gd-11-Col-2
         move "K.Adi" to Gd-11-Col-3
         move "K.Syd" to Gd-11-Col-33
         move "NOT"   to Gd-11-Col-4
         modify grd-11,record-to-add(grd-11-record)
         open input nt kllnc
          initialize not-rec
 
          move "DEV"  to NOT-DOS
          move uye-no to NOT-DOS-ANAH 
          start nt key not < NOT-ANAH invalid
                   continue
          not invalid
          perform until fs-not = "10"
          read nt next no lock end move "10" to fs-not
          not end
              
              if  "DEV"  <> NOT-DOS  then
                    exit perform
              end-if
              if uye-no  <>  function numval(NOT-DOS-ANAH(1:8)) then
                    exit perform 
              end-if

              if not-tip = "S" then
                   exit perform cycle 
              end-if

              initialize grd-11-record
              move NOT-Giris-YiL    to eyil
              move NOT-Giris-ay     to eay
              move NOT-Giris-gun    to egun
              move etar             to Gd-11-Col-1

              move NOT-Giris-SAAT   to esaat
              move NOT-Giris-dakika to edakika
              move ezaman           to Gd-11-Col-2
              initialize kllnc-rec
              move NOT-Giris-STAF   to K-KODU
              read kllnc no lock invalid
                       move "Silinmis"          to Gd-11-Col-3
                       move "Silinmis"          to Gd-11-Col-33
              not invalid
                  move K-ADI             to Gd-11-Col-3
                  move K-SOYADI          to Gd-11-Col-33
              end-read
             
              move NOT1              to Gd-11-Col-4
              modify grd-11,record-to-add(grd-11-record)

          end-read
          end-perform
          end-start

         close nt kllnc
         .
*
 Form7-Aft-Initdata.
     open input sozhrk soztar  
         read sozhrk no lock invalid
                 initialize sozhrk-rec
                 move yil-tasi   to sozhrk-yil
                 move tarih-tasi to sozhrk-anlasma-tarih
                 move dev-odano  to sozhrk-oda
                     if dev-odano(5:1) not = space
                        move dev-odano to o-uzun
                        perform oda-kisalt
                        move o-kisa    to sozhrk-oda
                     end-if
                 move uye-no     to sozhrk-devremulk-no
                 MOVE "0-Haric"  to cmb-aidat-var cmb-es-var
                 modify grd1,reset-grid = 1 
         not invalid
              
                 perform soztar-grid-yukle
                 perform Form7-Ef-1aaa-Aft-Procedure 
                 move 4 to accept-control
                 move 41 to control-id
         end-read 
          
         move sozhrk-oda to lbl-oda-value
         display form7-lbl-oda

         display accept-0317a accept-0316a accept-0315a accept-0317aa acc-ps1a acc-mis-no1a Form7-Ef-1 Form7-Ef-2 Form7-Ef-1a Form7-Ef-1aa Form7-Ef-1aaa 
             Form7-Cm-1 Form7-Ef-1aab Form7-Fr-2-Cm-2 Form7-Ef-1aaba Form7-Ef-1aabaa
     close  sozhrk soztar.
*
 Form7-Bef-Create.
                             

     .
*
 Form7-Ex-Other.
        evaluate key-status
           when 1
             if control-id = 167
                      initialize doviz-cagir
                      call "/asya/ytl/obj/otel/dovizara.asy" using doviz-cagir
                            on exception perform callerr-proc
                
                
                               not on exception
                               cancel "/asya/ytl/obj/otel/dovizara.asy" 
                       end-call
                       move doviz-cagir     to sozhrk-kira-doviz-kodu of sozhrk
                       display Form7-Ef-1aaa
              end-if
           when 2
            
               if sozhrk-yil = zeroes or 
                  sozhrk-oda = spaces or
                  sozhrk-devremulk-no = zeroes or
                  sozhrk-anlasma-yil = zeroes or
                  sozhrk-anlasma-ay  = zeroes or
                  sozhrk-anlasma-gun = zeroes or
                  sozhrk-adi = spaces or
                  sozhrk-soyadi = spaces 

                  display message box "Lutfen Gerekli Alanlari Doldurunuz !" new-line
                  "Devam Edilemiyor ... "
                  icon 2
                  exit paragraph
               end-if

               display message box "Girilen Bilgiler Kayit Edilecektir" new-line
               "Devam Etmek Istiyor musunuz ?"
               title "Asya-Soft"
               default 1
               type 2
               returning return-code
               if return-code <> 1
                     exit paragraph
               end-if
      
               if cmb-aidat-var(1:1) = "1"
                     MOVE 1  to sozhrk-aidat-durum 
               else
                     MOVE 0  to sozhrk-aidat-durum 
               end-if
               if cmb-es-var(1:1) = "1"
                      MOVE 1 to sozhrk-sayac-durum
               else
                      MOVE 0 to sozhrk-sayac-durum
               end-if

               open i-o sozhrk
               write sozhrk-rec invalid
                   rewrite sozhrk-rec invalid
                           stop " "
                   not invalid
                           display message box "Sozlesme Bilgileri Guncellendi"
                           title "Asya-Soft"
                           set exit-pushed to true
                   end-rewrite
               not invalid
                       display message box "Sozlesme Kayit Edildi"
                       title "Asya-Soft"
                       set exit-pushed to true
               end-write
               perform log-operation-sozhrk
             close sozhrk
             perform soztar-sil-yaz
           when 3
              initialize sozlesme-silindi
              open i-o sozhrk
                 read sozhrk no lock invalid
                         continue
                 not invalid
                         display message box "Sozlesme Silinecektir" new-line
                         "Devam Etmek Istiyor musunuz ? "
                         type 2
                         default 2
                         returning return-code
                         if return-code <> 1
                               exit paragraph
                         end-if
                                            
                         delete sozhrk end-delete
                         modify grd1, reset-grid = 1
                         move 1 to sozlesme-silindi
                         perform soztar-sil-yaz
                         initialize sozlesme-silindi
                         set exit-pushed to true
                 end-read 
               close sozhrk     
           when 12
                initialize soz-bas-tar soz-bit-tar
                move tarih-tasi to soz-bas-tar soz-bit-tar
                perform Acu-Form8-Routine
             
                if soz-tar-girildi = 1
                      perform varying i from 2 by 1 until i > 99
                          initialize soz-tar-sira
                          inquire grd1(i,1),cell-data in soz-tar-sira
                          continue
                          if soz-tar-sira = zeroes
                                if  soz-tar-sira-yedek > 0
                                      add 1 to soz-tar-sira-yedek
                                else
                                      move 1 to soz-tar-sira-yedek
                                end-if
                                exit perform
                          end-if
                          move soz-tar-sira to soz-tar-sira-yedek
                      end-perform

                      move soz-tar-sira-yedek to grd1-col-1
            
                      move soz-bas-gun    to egun
                      move soz-bas-ay     to eay
                      move soz-bas-yil    to eyil
                      move etar           to grd1-col-2
        
                      move soz-bit-gun    to egun
                      move soz-bit-ay     to eay
                      move soz-bit-yil    to eyil
                      move etar           to grd1-col-3
        
                      move "Duzenle"      to grd1-col-4
                      move "Sil"          to grd1-col-5
                      modify grd1,record-to-add(grd1-record)  
                      modify grd1(i,2) hidden-data = soz-bas-tar
                      modify grd1(i,3) hidden-data = soz-bit-tar
                end-if
        when 13
            if sozhrk-cikti-adres <> spaces
                 display message box "Daha Onceden Bir Sozlesme Formu Kayit Edilmis." new-line
                 "Devam Etmek Istiyor musunuz ? "
                 title "Asyasoft Yazilim"
                 default 2
                 type 2
                 returning return-code
                 if return-code <> 1
                       exit paragraph
                 end-if
            end-if
            move "Adobe PDF Dosyalari (*.pdf)|*.pdf" to 
                  opnsav-filters
            call "c$opensavebox" using opensave-open-box,
                                       opensave-data,
                                 giving opensave-return
            if opensave-return not > 0
                    exit paragraph
            end-if
        
            move low-values           to komut1 komut2 rename-dosya
            inspect opnsav-filename 
                    replacing trailing spaces by low-values
            inspect opnsav-basename 
                    replacing trailing spaces by low-values
            inspect opnsav-basename,
                    replacing all spaces by "_"
            if is-remote
                string komut1,
                      "@[DISPLAY]:"      delimited by low-values,
                      opnsav-filename    delimited by low-values,
                      into komut1
        
                string rename-dosya,
                       sozhrk-ANAH   delimited by low-values                
                       ".pdf"    delimited by low-values 
                into rename-dosya        
        
                CALL "RENAME" using opnsav-basename rename-dosya
        
                string komut2,
                      base-dir           delimited by low-values
                      rename-dosya       delimited by low-values
                      into komut2
            else
                string komut1,
                       opnsav-filename delimited by low-values
                into komut1
                string rename-dosya,
                       sozhrk-ANAH   delimited by low-values 
                       ".pdf"            delimited by low-values 
                into rename-dosya        
        
                CALL "RENAME" using opnsav-basename rename-dosya
                string komut2,
                       base-dir        delimited by low-values
                       rename-dosya    delimited by low-values
                into komut2
            end-if
            call "c$copy" using komut1
                                komut2
                          giving copy-status
         
            move rename-dosya to sozhrk-cikti-adres
          
            if copy-status <> 0
               display message box 
                       opnsav-filename, " dosyasi",x"0a0d",
                       base-dir," klasorune kopyalanamadi ..."
                       icon mb_error_icon
                       title "Hata"
                 initialize sozhrk-cikti-adres
            end-if

            display Form7-Ef-2
        when 14
            if sozhrk-cikti-adres <> spaces
                 exit paragraph
            end-if
            move low-values to opnsav-filename
            string opnsav-filename
                   sozhrk-ANAH delimited by low-values
                   ".pdf"  delimited by low-values
            into opnsav-filename
        
            if is-remote
                move low-values           to komut2 local-file
                string local-file,
                      "@[DISPLAY]:"    delimited by low-values
                       local-folder    delimited by low-values
                       opnsav-filename delimited by low-values
                into local-file
        
                string komut2,
                       base-dir        delimited by low-values
                       opnsav-filename    delimited by low-values
                into komut2
        
            else
                move low-values           to komut2 local-file
                string local-file,
                       local-folder    delimited by low-values
                       opnsav-filename delimited by low-values
                into local-file
        
                string komut2,
                       base-dir        delimited by low-values
                       opnsav-filename    delimited by low-values
                into komut2
            end-if
        
            call "c$copy" using komut2|kopyaloanyorrr...
                                local-file
                          giving copy-status
            if copy-status <> 0
                display message box "Goruntulenecek PDF Dosyasi Bulunamadi..."
                                title "[ Uyari ]"
                                icon 1
            end-if
            if copy-status = 0
               move 1 to resim-bulundu
               if resim-bulundu = 1
                  perform resim-teklif
               end-if
            end-if
        when 16
           if sozhrk-adi <> spaces or sozhrk-soyadi <> spaces
               move sozhrk-adi             to aranacak-adi  
               move sozhrk-soyadi          to aranacak-soyadi
           else
               move "**"             to aranacak-adi  
               move "**"             to aranacak-soyadi
           end-if

             move mis-no           to bulunan-profil-no
             move ps1              to bulunan-profil-sirket
        
             perform profil-cagir
        
             move bulunan-profil-sirket to sozhrk-profil-sirket
             move bulunan-profil-no     to sozhrk-profil-no  
        
             open input musteri
             initialize musteri-rec mis-adi
             move sozhrk-profil-sirket        to musteri-sirket
             move sozhrk-profil-no            to musteri-no
             read musteri no lock invalid 
                  move "      "         to musteri-adi musteri-soyadi
             end-read 

             if sozhrk-profil-no > 0 
                 move musteri-adi    to sozhrk-adi
                 move musteri-soyadi to sozhrk-soyadi
             end-if
 
             close musteri
        
             display Form7-Ef-1 Form7-Ef-2 Form7-Ef-1a acc-ps1a acc-mis-no1a   
        end-evaluate
     .
*
 resim-teklif.
       if is-remote 
          set shell32-dll-uzak to true
          set shell-execute-uzak to true
       else
          set shell32-dll-yerel to true
          set shell-execute-yerel to true
       end-if
       call shell32-dll on exception 
            display message box
                   "shell32.dll dosyasi bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            exit paragraph.
       if is-remote
          move local-file(12:)   to local-file(1:)
       end-if

       inspect local-file replacing trailing spaces by low-values
       inspect local-file replacing all "/"  by "\"

       call shell-execute using by value 0,
                                by reference ac-komut
                                by reference local-file,
                                null
                                null
                                by value SW_SHOW
        on exception
            display message box
                   "ShellExecute Proseduru bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            cancel shell32-dll
            exit paragraph
       end-call.
       cancel shell-execute.
       cancel shell32-dll.

*
 accept-0317aa-Aft-Procedure.
       open input takvim
            initialize takvim-rec
            move sozhrk-anlasma-tarih to takvim-anah
            read takvim no lock invalid
                    display message box "Lutfen Tanimli Bir Tarih Giriniz"
                    icon 3
                    move 4 to accept-control
                    move 37 to control-id
                    close takvim
                    exit paragraph
            end-read
       close takvim
       open input sozhrk soztar  
         
         read sozhrk no lock invalid
                 initialize sozhrk-diger
                 move dev-odano  to sozhrk-oda
                     if dev-odano(5:1) not = space
                        move dev-odano to o-uzun
                        perform oda-kisalt
                        move o-kisa    to sozhrk-oda
                     end-if
                 move uye-no     to sozhrk-devremulk-no
                 MOVE "0-Haric"  to cmb-aidat-var cmb-es-var
         not invalid
                 perform soztar-grid-yukle
                 perform Form7-Ef-1aaa-Aft-Procedure
                 if sozhrk-aidat-durum = 1
                       MOVE "1-Dahil"  to cmb-aidat-var  
                 end-if
                 if sozhrk-sayac-durum = 1
                       MOVE "1-Dahil"  to cmb-es-var  
                 end-if
         end-read
         display acc-ps1a acc-mis-no1a Form7-Ef-1 Form7-Ef-2 Form7-Ef-1a Form7-Ef-1aa Form7-Ef-1aaa 
             Form7-Cm-1 Form7-Ef-1aab Form7-Fr-2-Cm-2 Form7-Ef-1aaba Form7-Ef-1aabaa
     close  sozhrk soztar   
     .
*
 soztar-grid-yukle.
          initialize grd1-record
          modify grd1,reset-grid = 1
          move "Sira"     to grd1-col-1
          move "Bas.Tar." to grd1-col-2
          move "Bit.Tar." to grd1-col-3
          move "Duzenle"  to grd1-col-4
          move "Sil"      to grd1-col-5
          modify grd1,record-to-add(grd1-record)
 
          initialize soztar-rec soz-tar-var soz-tar-kayit-say
          move sozhrk-devremulk-no  to soztar-devremulk-no
          move sozhrk-oda           to soztar-oda
          move sozhrk-yil           to soztar-yil
          move sozhrk-anlasma-tarih to soztar-anlasma-tarih
          start soztar key not < soztar-anah invalid 
                continue 
          not invalid 
          perform with test after until fs-soztar = "10"
          read soztar next no lock end move "10" to fs-soztar
          not at end
                                            
                  if soztar-devremulk-no    <> sozhrk-devremulk-no 
                    or soztar-oda           <> sozhrk-oda
                    or soztar-yil           <> sozhrk-yil 
                    or soztar-anlasma-tarih <> sozhrk-anlasma-tarih
                       exit perform
                  end-if
                       
                  move 1 to soz-tar-var
                  add 1 to soz-tar-kayit-say

                  move soztar-sira       to grd1-col-1
                  move soztar-bas-gun    to egun
                  move soztar-bas-ay     to eay
                  move soztar-bas-yil    to eyil
                  move etar              to grd1-col-2

                  move soztar-bit-gun    to egun
                  move soztar-bit-ay     to eay
                  move soztar-bit-yil    to eyil
                  move etar              to grd1-col-3

                  move "Duzenle"         to grd1-col-4
                  move "Sil"             to grd1-col-5
                  modify grd1,record-to-add(grd1-record)

                  modify grd1(soz-tar-kayit-say + 1,2),hidden-data = soztar-bas-tarih
                  modify grd1(soz-tar-kayit-say + 1,3),hidden-data = soztar-bit-tarih

          end-read
          end-perform
          end-start.
*
 Form8-Ex-Other.
      evaluate key-status
         when 2
              if soz-bas-tar > soz-bit-tar
                    display message box "Sozlesme Baslangic Tarihi Bitis Tarihinden Buyuk Olamaz !"  new-line
                    "Devam Edilemiyor"
                    icon 2
                    exit paragraph
              end-if
              move 1 to soz-tar-girildi
              set exit-pushed to true
      end-evaluate
     .
*
 Form8-Bef-Create.
     move 0 to soz-tar-girildi
     move 4 to accept-control
     move 37 to control-id
     .
*
 grd1-Ev-Other.
      evaluate event-type
          when msg-begin-entry
              move event-action-fail to event-action
              evaluate event-data-1
              when 4
                   initialize soz-tar-sira 
                   inquire grd1(event-data-2,1),cell-data in soz-tar-sira
                   if soz-tar-sira <> zeroes
                          initialize soz-bas-tar soz-bit-tar
                          inquire grd1(event-data-2,2),hidden-data in soz-bas-tar
                          inquire grd1(event-data-2,3),hidden-data in soz-bit-tar

                          move event-data-2 to soztar-sira-yedek
                          perform Acu-Form8-Routine

                          if soz-tar-girildi = 1
                                  move soz-bas-gun    to egun
                                  move soz-bas-ay     to eay
                                  move soz-bas-yil    to eyil
                                  modify grd1(soztar-sira-yedek,2), cell-data = etar
                                  modify grd1(soztar-sira-yedek,2), hidden-data = soz-bas-tar
        
                                  move soz-bit-gun    to egun
                                  move soz-bit-ay     to eay
                                  move soz-bit-yil    to eyil
                                  modify grd1(soztar-sira-yedek,3), cell-data = etar
                                  modify grd1(soztar-sira-yedek,3), hidden-data = soz-bit-tar

                                  display message box "Tarih Guncellemesi Yapildi"
                                  title "Asya Soft"
                          end-if
                   end-if
              when 5
                   initialize soz-tar-sira 
                   inquire grd1(event-data-2,1),cell-data in soz-tar-sira
                   move event-data-2 to soztar-sira-yedek
                   inquire grd1(event-data-2,2),hidden-data in soz-bas-tar
                   inquire grd1(event-data-2,3),hidden-data in soz-bit-tar
                   if soz-tar-sira <> zeroes
                          display message box soz-tar-sira " Nolu ## " soz-bas-gun "/" soz-bas-ay "/" soz-bas-yil
                          "-" soz-bit-gun "/" soz-bit-ay "/" soz-bit-yil" ##"
                          " Secili Tarih Silinecektir" new-line
                          "Devam Etmek Istiyor musunuz ? "
                          default 2
                          type 2
                          returning return-code
                          if return-code <> 1
                                exit paragraph
                          end-if

                          modify grd1, record-to-delete(soztar-sira-yedek) 
                   end-if
              End-evaluate
              move event-action-fail to event-action
      end-evaluate.
*
 soztar-sil-yaz.
      |////*** SOZTAR SIL YAZZ
      open i-o soztar CASTDEV
      initialize soztar-rec soz-tar-var soz-tar-kayit-say
      move sozhrk-devremulk-no  to soztar-devremulk-no
      move sozhrk-oda           to soztar-oda
      move sozhrk-yil           to soztar-yil
      move sozhrk-anlasma-tarih to soztar-anlasma-tarih
      start soztar key not < soztar-anah invalid 
            continue 
      not invalid 
      perform with test after until fs-soztar = "10"
      read soztar next no lock end move "10" to fs-soztar
      not at end
                                        
              if soztar-devremulk-no    <> sozhrk-devremulk-no 
                or soztar-oda           <> sozhrk-oda
                or soztar-yil           <> sozhrk-yil 
                or soztar-anlasma-tarih <> sozhrk-anlasma-tarih
                   exit perform
              end-if
              delete soztar end-delete
              perform log-operation-soztar
      end-read
      end-perform
      end-start
            
      |////*** CASTDEV SIL YAZZ
      initialize castdev-rec  
      move sozhrk-oda           to castdev-oda
      move sozhrk-anah          to CASTDEV-SOZHRK-ANAH
      start castdev key not < castdev-anah1 invalid 
            continue 
      not invalid 
      perform with test after until fs-castdev = "10"
      read castdev next no lock end move "10" to fs-castdev
      not at end
               if CASTDEV-SOZHRK-ANAH <> sozhrk-anah
               or castdev-oda         <> sozhrk-oda
                     exit perform
               end-if

               delete castdev end-delete
               perform log-operation-castdev
               
      end-read
      end-perform 
      end-start
      CLOSE CASTDEV SOZTAR

      if sozlesme-silindi = 1
            exit paragraph
      end-if

      OPEN i-o SOZTAR
      perform varying i from 2 by 1 until i > 99
          inquire grd1(i,1),cell-data in soz-tar-sira
          if soz-tar-sira = zeroes
                 exit perform
          end-if
          
          initialize soztar-rec
          move sozhrk-devremulk-no  to soztar-devremulk-no
          move sozhrk-oda           to soztar-oda
          move sozhrk-yil           to soztar-yil
          move sozhrk-anlasma-tarih to soztar-anlasma-tarih
          move soz-tar-sira         to soztar-sira

          inquire grd1(i,2),hidden-data in soztar-bas-tarih  
          inquire grd1(i,3),hidden-data in soztar-bit-tarih  

          write soztar-rec invalid
                  stop " "
          end-write
          perform log-operation-soztar
      end-perform
      close soztar
      
       |////*** CASTDEV SIL YAZZ
      OPEN INPUT SOZTAR takvim
      open i-o CASTDEV


      initialize soztar-rec  
      move sozhrk-devremulk-no  to soztar-devremulk-no
      move sozhrk-oda           to soztar-oda
      move sozhrk-yil           to soztar-yil
      move sozhrk-anlasma-tarih to soztar-anlasma-tarih
      start soztar key not < soztar-anah invalid 
            continue 
      not invalid 
      perform with test after until fs-soztar = "10"
      read soztar next no lock end move "10" to fs-soztar
      not at end
                                        
              if soztar-devremulk-no    <> sozhrk-devremulk-no 
                or soztar-oda           <> sozhrk-oda
                or soztar-yil           <> sozhrk-yil 
                or soztar-anlasma-tarih <> sozhrk-anlasma-tarih
                   exit perform
              end-if


              initialize takvim-rec  
              move soztar-bas-tarih  to takvim-anah
              start takvim key not < takvim-anah invalid 
                    continue 
              not invalid 
              perform with test after until fs-takvim = "10"
              read takvim next no lock end move "10" to fs-takvim
              not at end
                      if takvim-anah > soztar-bit-tarih 
                            exit perform 
                      end-if

                      initialize castdev-rec
                      move takvim-anah          to castdev-tarih
                      move soztar-oda           to castdev-oda
                      move sozhrk-anah          to CASTDEV-SOZHRK-ANAH 
                      MOVE sozTAR-anah          TO CASTDEV-SOZTAR-ANAH |//** FAZLADAN ATILDI

                      read castdev no lock invalid
                             write castdev-rec invalid
                                   stop " "
                             end-write
                      not invalid
                             if CASTDEV-SOZHRK-ANAH <> sozhrk-anah
                                  stop "Ayni Odaya Ait Farkli Sozlesmelerden Tarih Girisi Var"
                             else
                                  rewrite castdev-rec invalid
                                      stop " "
                                  end-rewrite 
                             end-if
                      end-read
                      perform log-operation-castdev

              end-read
              end-perform
              end-start

      end-read
      end-perform
      end-start


      CLOSE SOZTAR CASTDEV takvim.
*
 accept-0317ab-Aft-Procedure.
            open input takvim
            initialize takvim-rec
            move soz-bas-tar to takvim-anah
            read takvim no lock invalid
                    display message box "Lutfen Tanimli Bir Tarih Giriniz"
                    icon 3
                    move 4 to accept-control
                    move 37 to control-id
                    close takvim
                    exit paragraph
            end-read
       close takvim
     .
*
 accept-0317aba-Aft-Procedure.
            open input takvim
            initialize takvim-rec
            move soz-bit-tar to takvim-anah
            read takvim no lock invalid
                    display message box "Lutfen Tanimli Bir Tarih Giriniz"
                    icon 3
                    move 4 to accept-control
                    move 44 to control-id
                    close takvim
                    exit paragraph
            end-read
       close takvim
     .
*
 Form7-Ef-1aaa-Aft-Procedure.
       open input doviz
       initialize doviz-rec
       move sozhrk-kira-doviz-kodu to doviz-kodu
       read doviz         no lock invalid 
               move "Tanimsiz" to lbl-doviz-adi
       not invalid
               move d-adi-1       to lbl-doviz-adi 
       end-read
       close doviz
       display Form7-La-2.
*
*
 gf-Ev-Msg-Begin-Entry.
        set event-action to event-action-fail
      if  event-data-2 > 1
           initialize odemeler-rec onay-rec
         inquire f-onay(event-data-2,1)  hidden-data in ONAY-id 
         if ONAY-rec not = spaces
         open i-o onay
         read onay no lock invalid
             perform onay-getir
             not invalid 
            
             if ONAY-VERILDI then  
             
              move    function numval(ONAY-VERI-yeni(15:))  to      link-odeme-sira       
              move  function numval(ONAY-ANAHTAR) to   link-odeme-uye-no

                    OPEN input odemeler
               initialize link-cek-isl-no
               move  link-odeme-uye-no to odemeler-devremulk-no
                move  link-odeme-sira  to  odemeler-sira
                 read odemeler no lock invalid
                      display message box "Odeme Bulunamadi"
                     continue
                     not invalid 
                         call "/asya/ytl/obj/otel/devodeme.asy" using link-odeme-uye-no,link-cek-isl-no,link-odeme-sira
                                    on exception perform callerr-proc
                                       not on exception
                                  cancel "/asya/ytl/obj/otel/devodeme.asy" 
                                            end-call

                                           
                 end-read
               close odemeler
                perform odeme-baslik-yukle
                perform odeme-grid-yukle 
                   
                           
             else
               perform onay-getir
             end-if

        end-read
        close onay
        else
           perform onay-getir
        end-if
        end-if
         perform onay-kontrol.

    
           .
*
 onay-takip.      
            open i-o onay 
                        initialize onay-rec
                      set DEVRE-ONAY to true
                     move devremulk-no to  ONAY-ANAHTAR
                         read onay no lock invalid 
                         set  ONAY-BEKLER to true
                                  string  mis-adi delimited by "   "
                                          new-line  delimited by size
                                          "ait devremulk Odeme Silme  Talebi"  delimited by size
                                         
                                          into onay-text

                                        move k-kodu-tasi to ONAY-IST-STAF
                                        accept ONAY-IST-TARIH from century-date 
                                        accept ONAY-IST-zaman  from time


                                       write onay-rec invalid continue
                                          rewrite onay-rec end-write
                                          display message box onay-text new-line 
                                              "Onay talebi girilmistir"
                                        not invalid 
                                        if not ONAY-VERILDI  then 
                                            display message box "Onaylanmamis Silme Talebi " title "Onayla"

                                        end-if


                                end-read
                              
                                        close  onay 



         
     
    
     .
* 
 onay-getir.
     inquire f-onay(event-data-2,1)  hidden-data in link-onay 
                  call "/asya/ytl/obj/otel/onaygir.asy" 
                       using link-onay 
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/onaygir.asy"
                  end-call .
                  

*
 onay-silme-kont.
       OPEN input odemeler
       initialize odemeler-rec onay-rec
       move  link-odeme-uye-no to odemeler-devremulk-no
        move  link-odeme-sira  to  odemeler-sira
         read odemeler no lock invalid 
             close odemeler
            exit paragraph
         end-read
       close odemeler
         open i-o onay
               move odemeler-tutar    to         onay-tutar  zo-tut   
               move onay-tutar to     ONAY-VERI-yeni
               move odemeler-islem-turu to   ONAY-VERI-yeni(11:2)
              move   odemeler-sira       to  ONAY-VERI-yeni(15:)
               set  DEVRE-ONAY  to true
               move link-odeme-uye-no   to ONAY-ANAHTAR
             read onay no lock invalid  
                                move  ONAY-VERI-yeni(11:2) to text-id
                               perform text-acikla
                         
                                  string link-odeme-uye-no delimited by size
                                         " nolu "
                                         mis-adi delimited by "   "
                                         zo-tut delimited by size
                                         " TL " delimited by size
                                         text-aciklama delimited by "   "
                                         " silme talebi " into onay-text
                                        move k-kodu-tasi to ONAY-IST-STAF
                                                        accept ONAY-IST-TARIH from century-date 
                                                        accept ONAY-IST-zaman  from time

                    display message box "Onay Almaniz gereken islem yapmaktasiniz "  new-line
                                         onay-text new-line 
                                         "onay Talebi girilsin mi? "
                                  title "Uyari"
                                  icon 1 type 2 giving onay-sonuc
                       if onay-sonuc = 1 
                                     write onay-rec invalid rewrite onay-rec end-write
                        end-if
                   not invalid 
                      if  ONAY-IPTAL 
                           display message box "Reddedilmis Onay Telebi  "  new-line
                                         onay-text new-line 
                                         "Talebi reddedilmistir Devam edemessiniz?"
                                  title "Uyari" 
                      end-if
                      if  ONAY-bekler
                           display message box "Talep onayi beklenmektedir  "  new-line
                                         
                                  title "Uyari" 
                      end-if
              end-read
            close onay
            

      .
*
 Form1-Mn-1-MI-CekOnayVer-Link.
       
        open input odemeler
        initialize odemeler-rec 
        move link-odeme-uye-no   to odemeler-devremulk-no
        move link-odeme-sira     to odemeler-sira
        read odemeler no lock invalid 
                   close odemeler
                   exit paragraph
        not invalid 
           if not(odemeler-odeme-turu = "CE"  or odemeler-odeme-turu  = "SE")  then
                   close odemeler
                   exit paragraph
           end-if
        end-read 
        close odemeler

       open i-o cek
             initialize cek-rec
             move link-cek-isl-no    to cek-isl-no
             read cek no lock invalid
                      continue
             not invalid
         

                  move "X" to CEK-DURUMU
                  accept CEK-ODEME from century-date

                  rewrite cek-rec invalid 
                      display message box "Kayit Yazilamadi..."
                  end-rewrite 
        
                  perform log-operation-cek

                 
             end-read
             close cek
             display message box "Cek Onaylandi".
*
 Form1-Mn-1-MI-CekOnayIPTAL-Link.
     
        open input odemeler
        initialize odemeler-rec 
        move link-odeme-uye-no   to odemeler-devremulk-no
        move link-odeme-sira     to odemeler-sira
        read odemeler no lock invalid 
                   close odemeler
                   exit paragraph
        not invalid 
           if not(odemeler-odeme-turu = "CE"  or odemeler-odeme-turu  = "SE")  then
                   close odemeler
                   exit paragraph
           end-if
        end-read 
        close odemeler

       open i-o cek
             initialize cek-rec
             move link-cek-isl-no    to cek-isl-no
             read cek no lock invalid
                     continue
             not invalid
         
                       initialize CEK-DURUMU
                       INITIALIZE CEK-ODEME

                  rewrite cek-rec invalid 
                      display message box "Kayit Yazilamadi..."
                  end-rewrite 
        
                  perform log-operation-cek

             end-read
             close cek
             display message box "Cek Onay IPTAL Edildi".
*
 Form1-Gd-13-Ev-Other.
     evaluate event-type
         when msg-begin-entry
              move event-action-fail to event-action

         when msg-bitmap-clicked 
              evaluate event-data-1
                  when 9
                       inquire form1-gd-13, y in grid-sira-id
                       inquire form1-gd-13(grid-sira-id,3) , cell-data in borc-alacak
               
                       perform kapali-pasif-kontrol
               
                       if pasif-sozlesme = 1  then
                          exit paragraph 
                       end-if
               
                       perform yetki-kontrol
               
                       if yetki-yok = 1 then
                          display message box "Bu Islem Icin Yetkiniz Bulunmamaktadir !"
                          icon 3
                          exit paragraph
                      end-if
                      |****fat no sorgula
                      open input odemeler
                      initialize odemeler-rec
                      move uye-no to odemeler-devremulk-no
               
                      inquire form1-gd-13(grid-sira-id,1) , cell-data in odemeler-sira
                      read odemeler no lock invalid
                           display message box "Hata x9"
                           stop " "
                      not invalid
                          if odemeler-fatura-no <> spaces then
                             if odemeler-fatura-no <> zeroes then
                                display message box "Faturasi Kesilmis Aidat ! , Bu Islem Yapilamaz "
                                icon 3
                                close odemeler
                                exit paragraph
                             end-if
                          end-if
                      end-read
                      close odemeler
                  ||||||
                      if borc-alacak  = "B" then
                         display message box "Secilen Kayit Aidat Borc Tutaridir" new-line
                             "Devam Etmek Istiyor musunuz ?"
                         title "Uyari"
                         icon 1
                         type 2
                         default 2
                         returning return-code 
                         if return-code = 2
                               exit paragraph 
                         end-if  
                      end-if
               
                      perform bakim-ekrana-getir
                      perform bakim-grid-getir
*                 when 10
*                      perform aidat-makbuz 
              end-evaluate
     end-evaluate
     .
*
 pb-0901-Link.
     move link-not-donus  to toplam-not
     move "U"             to link-not-islem
     move "AIT"           to link-not-dos    
     move uye-no          to link-not-dos-anah(1:8) 
     move 1               to link-nereden 
     string  uye-no delimited by "  " 
            " " delimited by size
            " 'Nolu Sozlesme" delimited by size
            into link-dosya-aciklamasi
            call "/asya/ytl/obj/otel/mesajgir.asy" 
                 using link-not
                 on exception 
                 perform callerr-proc
                 exit paragraph
                 not on exception 
            cancel "/asya/ytl/obj/otel/mesajgir.asy"
     end-call
     move  link-not-donus  to toplam-not
     .
*
 pb-0902-Link.
     move link-not-donus  to toplam-not
     move "U"             to link-not-islem
     move "AIO"           to link-not-dos    
     move uye-no          to link-not-dos-anah(1:8) 
     move 1               to link-nereden 
     string  uye-no delimited by "  " 
            " " delimited by size
            " 'Nolu Sozlesme" delimited by size
            into link-dosya-aciklamasi
            call "/asya/ytl/obj/otel/mesajgir.asy" 
                 using link-not
                 on exception 
                 perform callerr-proc
                 exit paragraph
                 not on exception 
            cancel "/asya/ytl/obj/otel/mesajgir.asy"
     end-call
     move  link-not-donus  to toplam-not
     .

 
