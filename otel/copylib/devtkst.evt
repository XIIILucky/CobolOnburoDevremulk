* devtkst.evt
* devtkst.evt is generated from D:\asya\acugt.ytl\otel\devtkst.Psf
* This is a generated file. DO NOT modify this file directly.


 form2-Exception-Proc.
     PERFORM form2-Ex-Other
     .
***   start event editor code   ***

*
 form2-Ex-Other.
     evaluate key-status
         when 1
            if control-id = 11 then
               initialize rpr-danisman-kodu
                call "/asya/ytl/obj/otel/danisara.asy" using rpr-danisman-kodu
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/danisara.asy"
                         if rpr-danisman-kodu <> zeroes or 
                            rpr-danisman-kodu <> spaces
                                 display accept-0101aa
                         end-if
                         move 4 to accept-control
                         move 11 to control-id
                  end-call

            end-if
            if control-id = 5 then
               initialize rpr-donem-kodu
                call "/asya/ytl/obj/otel/donara.asy" using rpr-donem-kodu
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/donara.asy"
                         if rpr-donem-kodu <> zeroes or 
                            rpr-donem-kodu <> spaces
                                 display accept-0101a
                         end-if
                         move 4 to accept-control
                         move 5 to control-id
                  end-call

            end-if
            if control-id = 16 then
                initialize devara-cagir
                call "/asya/ytl/obj/otel/devara.asy" using devara-cagir
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/devara.asy"
                         move devara-dev-no-cagir to rpr-devremulk-no
                         display accept-0101aaa
                  end-call

            end-if
            if control-id = 88 then
                      initialize oda-cagir
                      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
                            on exception perform callerr-proc
                               not on exception
                               cancel "/asya/ytl/obj/otel/odaara.asy" 
                       end-call
                       move odano-cagir     to rpr-oda-no
                       display accept-cik-yilaa
                       move 4 to accept-control
                       move 88 to control-id
              end-if 
             if control-id = 23 then
                   initialize txt-tip1
                    move "G"   to pazar-tipi-cagir
                    call "/asya/ytl/obj/otel/odatara.asy" using pazar-cagir 
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/odatara.asy" 
                    end-call
                    move pazar-kodu-cagir to txt-tip1
                    display form2-Ef-1a
            end-if 

            if control-id = 22 then
               initialize txt-konum
                call "/asya/ytl/obj/otel/konumara.asy" using txt-konum
                      on exception
                         perform callerr-proc
                      not on exception
                         cancel "/asya/ytl/obj/otel/konumara.asy"
                         if txt-konum <> zeroes or 
                            txt-konum <> spaces
                                 display form2-Ef-1
                         end-if
                         move 4 to accept-control
                         move 14 to control-id
                  end-call

            end-if 
          when 4
                  perform islem
        end-evaluate  .
* 
 islem.
              perform accept-gir-yil-Aft-Procedure
              perform accept-cik-yil-Aft-Procedure2
              if kaldi-mi = 1 then
                   display message box "Lutfen Tarihleri Kontrol Ediniz !"
                   move 4    to accept-control
                   move 1004 to control-id
                   exit paragraph
              end-if
              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   add 1 to EKRAN-FIS-1
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
              move EKRAN-FIS-1 to takas-no takasdan-no
              open output takas takasdan close takas takasdan
              |||
              
              perform danisman-etkilenen-bul
              ||||
              open i-o  takas
              open input donem donem2 donhrk  devremulk  musteri odalar  taksit  DANISMAN  takasdan kodlar02 konum
              
              initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                         dokumer-dosya

              set  dokumer-asya-set to true
              move print-no         to dokumer-dosya-adi
              open output dokumer
*/WINDOW TITLE
              initialize dokumer-rec detay
              move "W"                    to det-dokumer-20(1:)
              move "Donem Kodlari Raporu" to det-filler
              write dokumer-rec from detay
*/ BASLIKLAR
              initialize dokumer-rec detay
              move "B"                  to det-dokumer-20(1:)
              move "Donem Kodlari Raporu" to det-filler
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "B"                  to det-dokumer-20(1:)
              write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
              initialize dokumer-rec detay
              move "O"                        to det-dokumer-20(1:)
              move "E" to dokumer-oto-sayfa-basi
              move 56  to dokumer-oto-sayfa-satir
              move "|" to dokumer-detay-kolon-ayirici
              move "LLLLLRRRRRLLLLLLLLLLLLLLLL" to dokumer-align-occ
              move dokumer-ozellikler-rec     to det-filler
              write dokumer-rec from detay
*/ BASLIKLAR 
              initialize dokumer-rec detay
              move "D1"              to det-dokumer-20(1:)     
              move "Devrmlk No"       to det-1
              move "Oda"             to det-2
              move "Donem"           to det-3
              move "Ad-Soyad"        to det-4
              move "Taksit Tarihi"   to det-5
              move "Satis Tarihi   " to det-6
              move "Taksit"          to det-8
              if iptal-hes = 1
                   move "IPTAL ODEME" to det-8
              end-if
              move "Odemeler"        to det-7
              move "Kalan"           to det-9
              move "Sozlesme Fiyati"   to det-11
              move "Kesin Kalan"     to det-12
              move "Fazla Odeme"     to det-13
              move "Danisman"        to det-10
              move "Tapu T."         to det-15
              move "Tapu Teb. T."    to det-24
              move "VEKALET"         to det-16
              move "Konum"           to det-17
              move "Tip"             to det-18
              move "Fat.No"          to det-19
              move "Tc. Kimlik"      to det-20
              move "Ilk Tahsilat"    to det-21
              move "Ilk Tah.Tar"     to det-22
              move "Soz.No"     to det-23
              move all "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 fil-7  fil-8 fil-9 fil-10 fil-11 fil-12 fil-13 fil-15 fil-16 fil-17 fil-18 fil-19 fil-20 fil-21 fil-22  fil-23 fil-24
              write dokumer-rec from detay
              initialize dokumer-rec detay
              move "D2"               to det-dokumer-20(1:)     
              move "-"                to det-dokumer-20(5:1)
              move all "-" to det-1 det-2 det-3 det-4  det-5  det-6 det-7 det-8 det-9 det-10 det-11 det-12 det-13 det-15 det-16 det-17 det-18 det-19 det-20 det-21 det-22  det-23  det-24
              write dokumer-rec from detay  

              initialize eski-devremulk-no detay-toplam detay-dip-toplam  hisse-toplam eski-anah-deger ilk-kayit-mi
              initialize devremulk-rec alt-toplamlar  sozlesme-icmal  devmulk-sayi
              move 1 to ilk-kayit-mi

 
              if cmb-siralama(1:2) = "01" then
                        start devremulk key not < devremulk-anah invalid
                                continue
                        end-start
              end-if
              if cmb-siralama(1:2) = "02" then
                        start devremulk key not < devremulk-anah1 invalid
                                continue
                        end-start
              end-if
              if cmb-siralama(1:2) = "03" then
                        start devremulk key not < devremulk-anah2 invalid
                                continue
                        end-start
              end-if

              perform  until fs-devremulk = "10"
              read devremulk next no lock end move "10" to fs-devremulk
              not end


                 ||||/ ////////////////////
                 move devremulk-satis-tarihi to dev-ref-tarih
                 perform dev-ref-kontrol
                 if dev-ref-gecmez = 1
                       exit perform cycle
                 end-if
                 ||||////////////////////


                 if devremulk-no = zeroes or = spaces then
                                 exit perform cycle
                 end-if
               
                 if rpr-devremulk-no not = zeroes and devremulk-no not = rpr-devremulk-no  then
                          exit perform CYCLE
                 end-if
 

                if tapu-verilis not = 1 then
                          if ( txt-donem-bas-tar not <= devremulk-satis-tarihi 
                           or txt-donem-bit-tar not >= devremulk-satis-tarihi ) and rpr-devremulk-no = zeroes then
                               exit perform cycle
                        end-if
               else
                        if txt-donem-bas-tar not <= devremulk-tapu-ver-tar
                        or txt-donem-bit-tar not >= devremulk-tapu-ver-tar   then
                                  exit perform cycle
                        end-if

                 end-if

       
                if danisman-etkilenen not = 1 then
                     if rpr-danisman-kodu not = zeroes
                     and rpr-danisman-kodu not = devremulk-satan-danisman
                                exit perform cycle
                      end-if
                else
                      initialize takasdan-rec
                      move devremulk-satan-danisman to takasdan-kodu
                      read takasdan no lock invalid
                             exit perform cycle
                      end-read
                end-if

                if rpr-oda-no not = spaces    and rpr-oda-no not = DEVREMULK-ODA-NO
                                 exit perform cycle
                end-if
                if rpr-donem-kodu not = spaces and rpr-donem-kodu not = devremulk-devre-donem
                                exit perform cycle
                end-if
                if rpr-donem-kodu not = spaces and rpr-donem-kodu not = devremulk-devre-donem
                                exit perform cycle
                end-if

 
                if  devremulk-durumu <> dev-durumu(1:1)
                          exit perform cycle
                end-if

                 ||  
        
                  if txt-konum not = zeroes or txt-konum not = zeroes  then
                          move devremulk-oda-no to odalar-no
                          read odalar no lock invalid
                                  continue
                          not invalid
                             if txt-konum not = zeroes and ODALAR-KONUMU not =  txt-konum
                                      exit perform cycle
                             end-if
                              if txt-tip1 not = spaces and  ODALAR-TIPI not =  txt-tip1
                                      exit perform cycle
                             end-if
                          end-read
                  end-if


                initialize donguden-cikti detay
                perform detay-ata-dokumere-yaz
                if donguden-cikti not = 1 or taksit-sayisi > 0 then
                   perform detay-toplam-yaz
                end-if
              end-read
              end-perform

              perform detay-alt-toplam-yaz
    
              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
               close  donem donem2 donhrk devremulk musteri odalar takas taksit DANISMAN takasdan  kodlar02 konum
              delete file dokumer takas takasdan .

*
 danisman-etkilenen-bul.
    
   
          initialize siradaki
          open i-o takasdan
          open input danisman
          initialize takasdan-kodu 
          move rpr-danisman-kodu  to takasdan-kodu
          write takasdan-rec invalid 
                 stop " "
          end-write
           |||||  ALT DANISMANLARI BULLL |||||||||||||||||||||||||||||||||||||||||||
          initialize ust-dongu-cikti  danis-dizi-sira a-kayit p-kayit 
          
          move rpr-danisman-kodu to siradaki-danisman-kodu(1) 
          move 1 to danis-dizi-sira i
          perform varying i from 1 by 1 until i > 9999

                move siradaki-danisman-kodu(i) to danisman-bagli-kodu  
                start danisman key not < danisman-bagli-kodu invalid
                        move 1 to ust-dongu-cikti
                        continue
                not invalid
                perform until fs-danisman = "10" 
                read danisman next no lock end move "10" to fs-danisman
                not end

                       if danisman-bagli-kodu not = 
                       siradaki-danisman-kodu(i) then
                             exit perform
                       end-if

                       initialize takasdan-rec
                       move danisman-kodu   to takasdan-kodu

                       write takasdan-rec invalid 
                               stop " "
                       end-write

                       add 1 to danis-dizi-sira
                       move danisman-kodu to siradaki-danisman-kodu(danis-dizi-sira) 
                end-read
                end-perform
                end-start
         
                if siradaki-danisman-kodu(i) = zeroes or spaces then
                      exit perform 
                end-if

          end-perform
          close takasdan danisman
          |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||-
          .
*
detay-ata-dokumere-yaz.
                 
                 
                  initialize taksit-rec toplamlar taksit-sayisi 
                  perform odeme-bul  
                  move devremulk-no to taksit-devremulk-no 
                  start taksit key not < taksit-dev-tarih invalid
                          DISPLAY MESSAGE BOX DEVREMULK-NO " NOLU SOZLESMENIN TAKSITLERI ACILMAMIS RAPORA YANSIMAYACAKTIR !!!!!"
                          "LUTFEN TAKSIT PLANININ OLUSTURUNUZ !"
                          TITLE "UYARI"
                          continue
                  not invalid
                  perform until fs-taksit = "10" 
                  read taksit next no lock end move "10" to fs-taksit
                  not end
                        initialize detay
                        if taksit-devremulk-no not = devremulk-no then
                               move 1 to donguden-cikti
                               exit perform 
                        end-if

                                       
                      if tapu-cmb-value(1:2) = "02" and devremulk-tapu = 0  then
                               move 1  to donguden-cikti
                               exit paragraph
                      end-if

                      if tapu-cmb-value(1:2) = "03" and devremulk-tapu = 1  then
                                move 1  to donguden-cikti
                                exit paragraph
                      end-if

                      

                        add 1 to taksit-sayisi

                        move DEVREMULK-NO           to soz-no  
                        move DEVREMULK-ODA-NO       to oda-noo
                        move devremulk-devre-donem  to donem-noo

                        if taksit-sayisi = 1 then

                                 move DEVREMULK-NO           to det-1    
                                 move DEVREMULK-ODA-NO       to det-2  
                                 move devremulk-devre-donem  to det-3  
                                 move devremulk-satis-tutari to z-tutar
                                 move z-tutar                to det-11


                              
             
                                 move devremulk-tapu to tapu-value
                                                                  
                                initialize musteri-rec string-deger
                                move DEVREMULK-profil-sirket to musteri-sirket
                                move DEVREMULK-profil-no     to musteri-no
                                read musteri no lock invalid 
                                   move " " to musteri-adi musteri-soyadi
                                end-read 
                                string string-deger
                                     musteri-adi delimited by spaces " "
                                     " " delimited by size 
                                     musteri-soyadi
                                into string-deger
                                move string-deger to det-4 mus-adi
          
                
                                move musteri-kim-tcno to det-20
        
                                move DEVREMULK-SATIS-TARIHI(1:4) to det-6(7:4)
                                move "/"                         to det-6(6:1)
                                move DEVREMULK-SATIS-TARIHI(5:2) to det-6(4:2)
                                move "/"                         to det-6(3:1)
                                move DEVREMULK-SATIS-TARIHI(7:2) to det-6(1:2)
                                move det-6 to s-tarih


                                 move devremulk-satan-danisman to danisman-anah
                                 read danisman no lock invalid continue
                                 end-read
                                 initialize string-deger 
                                 string danisman-adi delimited by "   "
                                               " " delimited by size
                                               danisman-soyadi  delimited by "   "
                                               " " delimited by size
                                  into string-deger
                                  move string-deger to det-10 top-danisman-adi
                                   if devremulk-tapu-teb-tar not = zeroes and devremulk-tapu-teb-tar not = spaces
                                        move devremulk-tapu-teb-tar(1:4) to det-24(7:4)
                                        move "/"                         to det-24(6:1)
                                        move devremulk-tapu-teb-tar(5:2) to det-24(4:2)
                                        move "/"                         to det-24(3:1)
                                        move devremulk-tapu-teb-tar(7:2) to det-24(1:2)
                                     end-if
                                       
                                     if devremulk-tapu = 1 then
                                         |  move "VAR" to det-15
                
                                        move devremulk-tapu-ver-tar(1:4) to det-15(7:4)
                                        move "/"                         to det-15(6:1)
                                        move devremulk-tapu-ver-tar(5:2) to det-15(4:2)
                                        move "/"                         to det-15(3:1)
                                        move devremulk-tapu-ver-tar(7:2) to det-15(1:2)
    

                                      else
                                          | move "YOK" to det-15
                                     end-if
                
                                     if devremulk-vekalet = 1 then
                                           move "VAR" to det-16
                                     else
                                           move "YOK" to det-16
                                     end-if

                        end-if

                        move taksit-tarih(1:4) to det-5(7:4)
                        move "/"               to det-5(6:1)
                        move taksit-tarih(5:2) to det-5(4:2)
                        move "/"               to det-5(3:1)
                        move taksit-tarih(7:2) to det-5(1:2)
                        move det-5             to taksit-tar
        
               

                        initialize z-tutar
                        move taksit-tutar  to z-tutar
                        move z-tutar       to det-8

                       if iptal-hes = 1
                                move iptal-odeme-bul  to z-tutar
                                move z-tutar          to det-8
                       end-if
               
                      if taksit-tutar not = zeroes then

                                if odeme-toplam-bul >= taksit-tutar  then
                                        move taksit-tutar  to z-tutar
                                        move z-tutar       to det-7
        
                                        compute odeme-toplam-bul =  odeme-toplam-bul - taksit-tutar
                                     

                                else
                                        move odeme-toplam-bul  to z-tutar
                                        move z-tutar           to det-7
                                        compute fark-bul =  taksit-tutar - odeme-toplam-bul

                                        initialize z-tutar 
                                        move fark-bul      to z-tutar
                                        move z-tutar       to det-9

                                        move  0 to odeme-toplam-bul
                                end-if

                       end-if 
                    
                     move devremulk-oda-no to odalar-no
                         read odalar no lock invalid
                                 continue
                         not invalid
                                  initialize konum-rec
                                  move ODALAR-KONUMU to KONUM-ANAHTAR
                                  read konum no lock invalid
                                          initialize konum-rec
                                  end-read
                                  move konum-adi to det-17
        
                                  initialize kodlar02-rec
                                  move "G" to kodlar02-tipi



                                  move ODALAR-TIPI to kodlar02-kodu
                                  read kodlar02 no lock invalid
                                        initialize kodlar02-rec
                                  end-read
                                  move kodlar02-adi to det-18
                        end-read
             
                        
         
                        add taksit-tutar    to top-taksit  alt-top-taksit
                        move iptal-odeme-bul to top-iptal-odeme  
                
                        add taksit-odenen to top-odenen  
                        add fark-bul      to top-fark   
                       
                       

                        if ozet-ver not = 1   then
                             write dokumer-rec from detay
                        end-if 

                        move 0 to ilk-kayit-mi
                  end-read
                  end-perform
                  end-start

                  .

                      
*
donem-kodu-sayi-bul.

                       initialize donem2-rec donem-sayisi odalar-rec
                       start odalar key not < odalar-anah invalid
                               continue
                       not invalid
                       perform until fs-odalar = "10"
                       read odalar next no lock end move "10" to fs-odalar
                       not end
                            if odalar-hayali = "H" then
                                 exit perform cycle
                            end-if
                            if eski-anah-deger(1:1) = odalar-devre
                                 add 1 to donem-sayisi
                           end-if
                       end-read
                       end-perform
                       end-start
        .
*
oda-no-prefix-sayi-bul.

                       initialize odalar-rec donem-rec donem-sayisi prefix-tip
                       move eski-anah-deger(1:4) to odalar-anah
                       read odalar no lock invalid 
                               continue
                       not invalid
                          move odalar-devre to  prefix-tip
                       end-read
                       initialize donem2-rec
                       start donem2 key not < donem2-anah invalid
                               continue
                       not invalid         
                       perform until fs-donem2 = "10" 
                       read donem2 next no lock end move "10" to fs-donem2
                       not end
                           if prefix-tip = donem2-kodu(1:1)
                                 add 1 to donem-sayisi
                           end-if
                       end-read
                       end-perform
                       end-start
        .
*
detay-toplam-al.
                       if donguden-cikti not = 1
                       |donguden cikmadiði sürece toplam al.
                            add  1 to detay-oda-toplam   detay-oda-dip-toplam 
                            add  1 to detay-donem-toplam detay-donem-dip-toplam
                            add  devremulk-satis-tutari to detay-toplam-satis-fiyat detay-toplam-dip-satis-fiyat
                       end-if
        .
*
detay-toplam-yaz.

            

                     perform odeme-bul

                     initialize detay
                     move mus-adi    to det-4
                     move soz-no     to det-1
                     move oda-noo    to det-2
                     move donem-noo  to det-3
                     move s-tarih    to det-6
                     move taksit-tar to det-5
                     move top-taksit to z-tutar
                     move z-tutar            to det-8 
                     
                     if iptal-hes = 1
                          move top-iptal-odeme to z-tutar
                          move z-tutar            to det-8 
                     end-if
                     move odeme-toplam-bul   to z-tutar
                     move z-tutar            to det-7

                     add odeme-toplam-bul to alt-top-odenen
                     add devremulk-satis-tutari to alt-devremulk-satis-fiy
                     move top-fark   to z-tutar
                     move z-tutar    to det-9

                     move taksit-sayisi to z-5
                     move z-5           to det-5

                     move devremulk-satis-tutari to z-tutar
                     move z-tutar                to det-11
 
                     move top-danisman-adi to det-10

                     initialize hesapla
                     if  odeme-toplam-bul > top-taksit then
                         compute hesapla =  top-taksit  -  odeme-toplam-bul 
                         add hesapla   to alt-top-fazla
                         move hesapla  to z-tutar
                         move z-tutar  to det-13

                     else 
                         compute hesapla =  top-taksit - odeme-toplam-bul 
                         add hesapla   to alt-top-fark
                         if hesapla <= 0 then 
                               move "ODEMESI BITMIS" to det-9 
                         else
                               move hesapla  to z-tutar
                               move z-tutar  to det-9
                         end-if
                     end-if 
                   
                         if hesapla <= 0 then 
                               add 1 to odemesi-biten-sayisi
                         else
                               add 1 to odemesi-devam-sayisi
                         end-if

                                     if devremulk-tapu-teb-tar not = zeroes and devremulk-tapu-teb-tar not = spaces
                                        move devremulk-tapu-teb-tar(1:4) to det-24(7:4)
                                        move "/"                         to det-24(6:1)
                                        move devremulk-tapu-teb-tar(5:2) to det-24(4:2)
                                        move "/"                         to det-24(3:1)
                                        move devremulk-tapu-teb-tar(7:2) to det-24(1:2)
                                     end-if

                       if devremulk-tapu = 1 then
                           | move "VAR" to det-15
                                        move devremulk-tapu-ver-tar(1:4) to det-15(7:4)
                                        move "/"                         to det-15(6:1)
                                        move devremulk-tapu-ver-tar(5:2) to det-15(4:2)
                                        move "/"                         to det-15(3:1)
                                        move devremulk-tapu-ver-tar(7:2) to det-15(1:2)

                             add 1 to tapu-alanlar-sayisi
                        else
                           | move "YOK" to det-15 
                             add 1 to tapu-almayanlar-sayisi
                       end-if

                       if devremulk-vekalet = 1 then
                             move "VAR" to det-16
                       else
                              move "YOK" to det-16
                       end-if

                      |  add hesapla    to alt-top-fark

                     if ozet-ver not = 1 then
                        move "A" to det-dokumer-20(3:1)
                        move 112 to det-renk1
                        move "1" to det-dokumer-20(10:1)
                    end-if

                      if devremulk-durumu = "Y" then
                          add 1 to aktif-sozlesme-sayisi
                      end-if

                      if devremulk-durumu = "S" then
                          add 1 to iptal-sozlesme-sayisi 
                      end-if

                         move devremulk-oda-no to odalar-no
                         read odalar no lock invalid
                                 continue
                         not invalid
                                  initialize konum-rec
                                  move ODALAR-KONUMU to KONUM-ANAHTAR
                                  read konum no lock invalid
                                          initialize konum-rec
                                  end-read
                                  move konum-adi to det-17
        
                                  initialize kodlar02-rec
                                  move "G" to kodlar02-tipi
                                  move ODALAR-TIPI to kodlar02-kodu
                                  read kodlar02 no lock invalid
                                        initialize kodlar02-rec
                                  end-read
                                  move kodlar02-adi to det-18
                        end-read
                        if devremulk-fatura-no > 0 
                                move devremulk-fatura-no to det-19
                        end-if
                      move musteri-kim-tcno to det-20

                      if ilk-odeme-tut > 0
                             move ilk-odeme-tut      to z-tutar 
                             move z-tutar            to det-21
                             move ilk-odeme-tar(7:2) to det-22(1:2)
                             move "/"                to det-22(3:1)
                             move ilk-odeme-tar(5:2) to det-22(4:2)
                             move "/"                to det-22(6:1)
                             move ilk-odeme-tar(1:4) to det-22(7:4)
                      end-if


                      move devremulk-sozlesme-no to det-23
                     ADD 1 TO devmulk-sayi
                     write dokumer-rec from detay
                     initialize det-renk1 detay-toplam
                 
            .
*
detay-alt-toplam-yaz.

                     initialize detay
                     move "TOPLAM"         to det-1
                     move alt-top-taksit   to z-dip-tutar
                     move z-dip-tutar      to det-8 
                     
                     if iptal-hes = 1
                           move top-iptal-odeme-alt   to z-dip-tutar
                           move z-dip-tutar      to det-8 
                     end-if
                     move alt-top-odenen   to z-dip-tutar
                     move z-dip-tutar      to det-7
                     move alt-top-fark     to z-dip-tutar
                     move z-dip-tutar      to det-9

                     move alt-top-fazla   to z-dip-tutar
                     move z-dip-tutar      to det-13

                     move devmulk-sayi     to z-9 
                     move z-9              to det-2

                     move alt-devremulk-satis-fiy to z-dip-tutar
                     move z-dip-tutar             to det-11


                     move "A" to det-dokumer-20(3:1)
                     move 176 to det-renk1
                     move "1" to det-dokumer-20(10:1)

                     write dokumer-rec from detay

                     initialize det-renk1 detay
                     move "O.BITEN" TO DET-1
                     move odemesi-biten-sayisi     to z-9 
                     move z-9                      to det-2
                     write dokumer-rec from detay

                     initialize det-renk1 detay
                     move "O.DEVAM" TO DET-1
                     move odemesi-devam-sayisi     to z-9 
                     move z-9                      to det-2
                     write dokumer-rec from detay



                     initialize det-renk1 detay
                     move "TAPU VAR" TO DET-1
                     move tapu-alanlar-sayisi      to z-9 
                     move z-9                      to det-2
                     write dokumer-rec from detay

                     initialize det-renk1 detay
                     move "TAPU YOK" TO DET-1
                     move tapu-almayanlar-sayisi   to z-9 
                     move z-9                      to det-2
                     write dokumer-rec from detay


                  
                     initialize det-renk1 detay
                     move "AKTIF" TO DET-1
                     move aktif-sozlesme-sayisi     to z-9 
                     move z-9                      to det-2
                     write dokumer-rec from detay

                     initialize det-renk1 detay
                     move "PASIF" TO DET-1
                     move iptal-sozlesme-sayisi     to z-9 
                     move z-9                      to det-2
                     write dokumer-rec from detay
                 
            .
*
detay-dip-toplam-yaz.
                      

                      move "TOPLAM"                 to det-2
                      move detay-oda-dip-toplam     to z-4
                      move hisse-toplam             to z-4y

                      initialize string-deger
                      string 
                          z-4y delimited by size
                          "\"  delimited by size
                          z-4  delimited by size
                      into string-deger
                      move string-deger to det-3

                      move detay-toplam-dip-satis-fiyat to z-dip-tutar
                      move z-dip-tutar                  to det-8

                      move "A" to det-dokumer-20(3:1)
                      move 112 to det-renk1
                      move "1" to det-dokumer-20(10:1)

                    |  if donguden-cikti not = 1 
                          write dokumer-rec from detay
                          initialize det-renk1 detay-toplam
                   |   end-if
        .
*
 donem-cakisma-kontrol.
                                  
          initialize takas-rec baslangic-yil
          perform varying baslangic-yil from devremulk-baslama-yil by 1 until baslangic-yil > devremulk-bitis-yil
          move baslangic-yil to takas-yil
          move devremulk-devre-donem to takas-donem
          move devremulk-oda-no      to takas-oda
          read takas no lock invalid
                   write takas-rec
                   end-write
          not invalid
                      |CAKISMA VAR    |
                      move "A" to det-dokumer-20(3:1)
                      move 176 to det-renk1
                      move "1" to det-dokumer-20(10:1)
          end-read
          end-perform






         .             
   
*
 accept-gir-yil-Aft-Procedure.
      open input takvim
      move txt-donem-bas-tar to takvim-anah
      read takvim no lock invalid
              move 4    to accept-control
              move 1004 to control-id
              move 1 to kaldi-mi
              continue
      end-read

      close takvim
     .
*
 accept-cik-yil-Aft-Procedure2.
      open input takvim
      move txt-donem-bas-tar to takvim-anah
      read takvim no lock invalid
              move 4    to accept-control
              move 1009 to control-id 
              move 1 to kaldi-mi
              continue
      end-read

      close takvim
     .
*
 Form1-Pb-1-Link.
      open input plan donem2 takvim
      open i-o donem
          
           read plan next no lock
    end continue
    end-read
    perform until fs-plan = "10"
     initialize plan-rec sayac   
    read plan next no lock
    end 
    not end
*************************************************
               perform varying k from 1 by 1 until k > 50
                    unstring    plan-rec delimited by x"09"
                    into okunan-deger(k)  pointer sayac  
              end-perform   

             move  PLAN-REC(1:4)      to  txt-donem-kodu
             move   2012             to  txt-donem-yili
             move  PLAN-REC(10:4)    to txt-donem-bas-yil
             move  PLAN-REC(8:2)    to txt-donem-bas-ay
             move  PLAN-REC(6:2)    to txt-donem-bas-gun

             move  PLAN-REC(19:4)    to txt-donem-bit-yil
             move  PLAN-REC(17:2)    to txt-donem-bit-ay
             move  PLAN-REC(15:2)    to txt-donem-bit-gun

             move "ASYA" to donem-staf
             move txt-donem-kodu    to donem-kodu
             move txt-donem-yili    to donem-yili
             move txt-donem-bas-tar to DONEM-BAS-TAR
             move txt-donem-bit-tar to DONEM-BIT-TAR

              write donem-rec invalid 
                    rewrite donem-rec 
                    end-rewrite 
              end-write

             if  PLAN-REC(1:1) = "A" then move 7 to peryot-gun end-if
             if  PLAN-REC(1:1) = "B" then move 10 to peryot-gun end-if
              perform varying i from 1 by 1 until i > 50

                      
                      move k-kodu-tasi       to donem-staf
                      move txt-donem-kodu    to donem-kodu
                      move donem-bit-tar     to donem-bas-tar  takvim-anah
                      move txt-donem-yili    to takvim-yil
                      start takvim key = takvim-anah invalid 
                               subtract 1 from i
                               move "0101" to donem-bit-tar(5:)
                               exit perform cycle
                               
                      end-start
                    
                      perform varying ii from 1 by 1 until ii > peryot-gun + 1
        
                              read takvim next no lock end
                                    subtract 1 from i
                                     move "0101" to donem-bit-tar(5:)
                                     move 1000 to ii
                                     exit perform cycle
                                      
                              not end
                                 if takvim-yil not = txt-donem-yili then
                                     subtract 1 from i
                                     move "0101" to donem-bit-tar(5:)
                                     move 1000 to ii
                                     exit perform cycle
                                       
                                 end-if
                                 continue
                
                              end-read
                      
                      end-perform
                      
                      if ii >= 1000 then
     
                            exit perform cycle
                      end-if
                      
                      move takvim-anah  to DONEM-BIT-TAR

                      compute donem-yili =  txt-donem-yili + i 
                      move donem-yili to donem-bas-yil donem-bit-yil

                      write donem-rec invalid
                            rewrite donem-rec 
                            end-rewrite 
                      end-write

                     

              end-perform

             
*************************************************

          end-read
          END-PERFORM
           close donem donem2  takvim
        display message box "Tabi canimmmmmm =)"
      close plan
     .
*
 form2-Bef-Create.
         perform adresleri-tasi

         move tarih-tasi to txt-donem-bas-tar 
         move tarih-tasi to txt-donem-bit-tar
     .
*
 form2-Pb-1-Link.
              OPEN I-O ODALAR
              INITIALIZE ODALAR-REC
              START ODALAR KEY NOT < ODALAR-ANAH INVALID
                      CONTINUE
              NOT INVALID 
              PERFORM UNTIL FS-ODALAR = "10"
              READ ODALAR NEXT NO LOCK END MOVE "10" TO FS-ODALAR
              NOT END
                MOVE "A" TO ODALAR-DEVRE
                REWRITE ODALAR-REC
                END-REWRITE
              END-READ
              END-PERFORM
              END-START
              CLOSE ODALAR 
              DISPLAY MESSAGE BOX "TUM ODALAR A PREFIX ATILDI !"
              .
*
 odeme-bul.
    open i-o odemeler
    initialize odemeler-rec odeme-toplam-bul kalan-odeme iptal-odeme-bul
    initialize ilk-odeme-tut ilk-odeme-tar
    move devremulk-no    to odemeler-devremulk-no
    start odemeler key not < odemeler-anah invalid 
         continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
             if odemeler-devremulk-no <> devremulk-no
                 exit perform 
             end-if
             if odemeler-hareket-turu <> "A"
                 exit perform cycle 
             end-if
           evaluate odemeler-islem-turu
           when "SO"
               continue 
           when "IO"
               compute iptal-odeme-bul = iptal-odeme-bul + odemeler-tutar
               continue 
           when "SP"               
           when "NP"               
           when "PM"
           when "AG"               
           when "DP"                
           when "GS"               
           when "GN"
           WHEN "PP"
           WHEN "SS"
           when "AV"
           WHEN "AI"
           WHEN "AO"
           WHEN "BK"
           WHEN "BO"
                exit perform cycle 
           when "FO"
               continue                 
           when "PI"
               continue 
           WHEN OTHER 
                exit perform cycle 
           end-evaluate

             compute odeme-toplam-bul = odeme-toplam-bul + odemeler-tutar
             move odeme-toplam-bul to kalan-odeme

    end-read 
    end-perform
    end-start

    initialize odemeler-rec 
    initialize ilk-odeme-tut ilk-odeme-tar
    move devremulk-no    to odemeler-devremulk-no
    move low-values      to ODEMELER-TARIH   
    start odemeler key not < odemeler-dev-tar invalid 
         continue 
    not invalid 
    perform with test after until fs-odemeler = "10"
    read odemeler next no lock end move "10" to fs-odemeler
    not at end 
             if odemeler-devremulk-no <> devremulk-no
                 exit perform 
             end-if
             if odemeler-hareket-turu <> "A"
                 exit perform cycle 
             end-if


          evaluate odemeler-islem-turu
           when "SO"
               continue 
           when "IO"
               exit perform cycle  
           when "SP"               
           when "NP"               
           when "PM"
           when "AG"               
           when "DP"                
           when "GS"               
           when "GN"
           WHEN "PP"
           WHEN "SS"
           when "AV"
           WHEN "AI"
           WHEN "AO"
           WHEN "BK"
           WHEN "BO"
                exit perform cycle 
           when "FO"
               continue                 
           when "PI"
               continue 
           WHEN OTHER 
                exit perform cycle 
           end-evaluate

           if ilk-odeme-tut = zeroes
                 move odemeler-tutar to ilk-odeme-tut
                 move odemeler-tarih to ilk-odeme-tar
                 exit perform
           end-if
    end-read 
    end-perform
    end-start
    close odemeler
     .
*
 form2-Aft-Initdata.
        call "c$narg" using link-var     
  
        if link-var = 1 then
          move link-devremulk-no to rpr-devremulk-no
          display accept-0101aaa accept-0101aaa 
          if rpr-devremulk-no not = zeroes then
                move 0 to ozet-ver rpr-danisman-kodu 
                initialize txt-konum
                display form2-Cb-1 accept-0101a
                perform islem
          end-if
        end-if
     .
 
