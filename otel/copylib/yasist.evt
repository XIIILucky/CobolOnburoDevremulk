* yasist.evt
* yasist.evt is generated from D:\asya\acugt.ytl\otel\yasist.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi
    move tarih-tasi   to ilk-tar son-tar
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
*
 Form1-Aft-Initdata.                
    move tarih-tasi to tarih.
    move "O" to fol-tip.
    move "N" to rap-tip.
    move "01" to det-tip-value.
    display acc-01  acc-02 acc-03 acc-04 com-02.
*
 Form1-Ex-Other.
    evaluate key-status
      when 1001
         if cb1-val = 1
          modify acc-yas-1-1, ENABLED = true
          modify acc-yas-1-2, ENABLED = true
         else
          modify acc-yas-1-1, ENABLED = false
          modify acc-yas-1-2, ENABLED = false
          initialize yas-1-1 yas-1-2
          display acc-yas-1-1 acc-yas-1-2
         end-if
      when 1002
         if cb2-val = 1
          modify acc-yas-2-1, ENABLED = true
          modify acc-yas-2-2, ENABLED = true
         else
          modify acc-yas-2-1, ENABLED = false
          modify acc-yas-2-2, ENABLED = false
          initialize yas-2-1 yas-2-2           
          display acc-yas-2-1 acc-yas-2-2
         end-if
      when 1003
         if cb3-val = 1
          modify acc-yas-3-1, ENABLED = true
          modify acc-yas-3-2, ENABLED = true
         else
          modify acc-yas-3-1, ENABLED = false
          modify acc-yas-3-2, ENABLED = false
          initialize yas-3-1 yas-3-2           
          display acc-yas-3-1 acc-yas-3-2                                
         end-if
      when 1004
         if cb4-val = 1
          modify acc-yas-4-1, ENABLED = true
          modify acc-yas-4-2, ENABLED = true
         else
          modify acc-yas-4-1, ENABLED = false
          modify acc-yas-4-2, ENABLED = false
          initialize yas-4-1 yas-4-2           
          display acc-yas-4-1 acc-yas-4-2
         end-if
      when 1005
         if cb5-val = 1
          modify acc-yas-5-1, ENABLED = true
          modify acc-yas-5-2, ENABLED = true
         else
          modify acc-yas-5-1, ENABLED = false
          modify acc-yas-5-2, ENABLED = false
          initialize yas-5-1 yas-5-2   
          display acc-yas-5-1 acc-yas-5-2        
         end-if
      when 1
        evaluate control-id
        when 12
        when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to acn-kod
                        display acc-04
                     end-if
             end-call
             move 4 to accept-control
             move 12 to control-id
        when 16
        when 17
             initialize acn-grup-kod
             call "/asya/ytl/obj/otel/grupara.asy" 
                  using "A", acn-grup-kod  
                  on exception 
                     perform callerr-proc
                  not on exception
                     display acc-08
             end-call
             move 4 to accept-control
             move 17 to control-id
        end-evaluate
        exit paragraph
      when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
            end-call
            display l-filtre       
      when 2
        move det-tip-value(1:2) to det-tip
        open input kodlar02   konum doviz  
        perform takas-dosya-yaz thru takas-dosya-yaz-exit
              initialize takas8-rec
              start takas8 key not < takas8-anahtar invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close takas8 kodlar02   konum doviz pazartop  
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Yas Istatistik Raporu" to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Yas Istatistik Raporu " to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay

*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  
     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)     
     move "--->"       to det-2
     move "MEV"        to det-3
     move "CUT"        to det-4
     move "<---"       to det-5
     move "-*-"        to det-6
     move "---"        to det-7
     move "---"        to det-8
     move "--->"       to det-9
     move "DAGI"       to det-10
     move "LIM "       to det-11     
     move "<---"       to det-12
     move "---"        to det-13
     move "---"        to det-14
     move "---"        to det-15
     move "   "        to det-16
     move "|" to fil-1 fil-2  fil-3 fil-4 fil-5 fil-6 fil-7 fil-8 fil-9 fil-10 fil-11
                 fil-12 fil-13 fil-14 fil-15 fil-16
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"         to det-dokumer-20(1:2)
     move "-"          to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6 det-7 det-8 det-9 det-10 det-11
                     det-12 det-13 det-14 det-15 det-16
     write dokumer-rec from detay                

     initialize dokumer-rec detay 
     move "1"            to det-dokumer-20(10:1)
     move "D2"           to det-dokumer-20(1:2)     
     move "Acenta Adi"   to det-1
     move "Pax"          to det-2
     move "Chi"          to det-3
     move "Fre"          to det-4
     move "Beb"          to det-5

     if cb1-val = 1
        move yas-1-1   to z2
        move z2        to det-6(1:2)
        move "-"       to det-6(3:1)
        move yas-1-2   to z2
        move z2        to det-6(4:2)
     end-if
     move "%"          to det-7

     if cb2-val = 1
        move yas-2-1   to z2
        move z2        to det-8(1:2)
        move "-"       to det-8(3:1)
        move yas-2-2   to z2
        move z2        to det-8(4:2)
     end-if
     move "%"          to det-9

     if cb3-val = 1
        move yas-3-1   to z2
        move z2        to det-10(1:2)
        move "-"       to det-10(3:1)
        move yas-3-2   to z2
        move z2        to det-10(4:2)
     end-if
     move "%"          to det-11

     if cb4-val = 1
        move yas-4-1   to z2
        move z2        to det-12(1:2)
        move "-"       to det-12(3:1)
        move yas-4-2   to z2
        move z2        to det-12(4:2)
     end-if
     move "%"          to det-13

     if cb5-val = 1
        move yas-5-1   to z2
        move z2        to det-14(1:2)
        move "-"       to det-14(3:1)
        move yas-5-2   to z2
        move z2        to det-14(4:2)
     end-if

     move "%"          to det-15
     move "Toplam"     to det-16

     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 fil-7 fil-8 fil-9
                 fil-10 fil-11 fil-12 fil-13 fil-14 fil-15 fil-16
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6 det-7 det-8 det-9 det-10 
                     det-11 det-12 det-13 det-14 det-15  det-16
     write dokumer-rec from detay
              open input acenta uyruk ulke
              initialize fs-takas8 x-toplam-dizi alt-toplam-buyuk alt-toplam-yas  
                         alt-toplam-kucuk alt-toplam-free alt-toplam-bebek 
                         ort-yas1 ort-yas2 ort-yas3 ort-yas4 ort-yas5 toplam-yas-1
              perform with test after until fs-takas8 = "10"               
                    read takas8 next no lock end move "10" to fs-takas8    
                    not at end                                             
                                                                           
                    initialize dokumer-rec detay   
                    evaluate cm4-val(1:1)
                    when "A"
                       move takas8-acenta to acenta-kodu
                       read acenta no lock invalid 
                           move acenta-kodu to acenta-adi,
                       end-read
                         move acenta-adi     to det-1
                         move "A"            to det-dokumer-20(3:1)
                         move 144            to det-renk1
                    end-evaluate

                    evaluate cm4-val(1:1)
                    when "U"
                       move takas8-acenta to ULKE-ANAH1
                       read ulke no lock invalid 
                           move ULKE-ANAH1 to ulke-adi,
                       end-read
                         move ulke-adi       to det-1
                         move "A"            to det-dokumer-20(3:1)
                         move 144            to det-renk1
                    end-evaluate

                    evaluate cm4-val(1:1)
                    when "P"
                       move takas8-acenta to kodlar02-kodu
                       move "E"           to kodlar02-tipi
                       read kodlar02 no lock invalid 
                           move kodlar02-kodu to kodlar02-adi,
                       end-read
                         move kodlar02-adi       to det-1
                         move "A"            to det-dokumer-20(3:1)
                         move 144            to det-renk1
                    when "K"
                       initialize uyruk-rec
                       move takas8-acenta to uyruk-anah
                       read uyruk no lock invalid 
                           move uyruk-anah to uyruk-adi1,
                       end-read
                         move uyruk-adi1       to det-1
                         move "A"            to det-dokumer-20(3:1)
                         move 144            to det-renk1
                      
                    end-evaluate

                     evaluate cm4-val(1:1)
                    when "R"
                       
                         move takas8-acenta       to det-1
                         move "A"            to det-dokumer-20(3:1)
                         move 144            to det-renk1
                    end-evaluate

                      move takas8-buyuk       to z4
                      move z4                 to det-2
                      move takas8-kucuk       to z4
                      move z4                 to det-3
                      move takas8-free        to z4
                      move z4                 to det-4
                      move takas8-bebek       to z4
                      move z4                 to det-5

                      add takas8-buyuk        to alt-toplam-buyuk
                      add takas8-kucuk        to alt-toplam-kucuk
                      add takas8-free         to alt-toplam-free
                      add takas8-bebek        to alt-toplam-bebek

                      move takas8-yas-adet1   to z4
                      move z4                 to det-6 
                      move takas8-yas-adet2   to z4
                      move z4                 to det-8
                      move takas8-yas-adet3   to z4
                      move z4                 to det-10
                      move takas8-yas-adet4   to z4
                      move z4                 to det-12
                      move takas8-yas-adet5   to z4
                      move z4                 to det-14
                      
                      compute toplam-yas-1 = toplam-yas-1 + takas8-yas-adet1
                      compute toplam-yas-2 = toplam-yas-2 + takas8-yas-adet2
                      compute toplam-yas-3 = toplam-yas-3 + takas8-yas-adet3
                      compute toplam-yas-4 = toplam-yas-4 + takas8-yas-adet4
                      compute toplam-yas-5 = toplam-yas-5 + takas8-yas-adet5

                      compute toplam-yas-1-1 = toplam-yas-1-1 + takas8-yas-top1
                      compute toplam-yas-2-1 = toplam-yas-2-1 + takas8-yas-top2
                      compute toplam-yas-3-1 = toplam-yas-3-1 + takas8-yas-top3
                      compute toplam-yas-4-1 = toplam-yas-4-1 + takas8-yas-top4
                      compute toplam-yas-5-1 = toplam-yas-5-1 + takas8-yas-top5
                    
*                      compute toplam-kisi =  alt-toplam-buyuk + alt-toplam-kucuk + 
*                                             alt-toplam-free + alt-toplam-bebek

                      compute yan-toplam = 
                                takas8-yas-adet1 + takas8-yas-adet2 + takas8-yas-adet3 +
                                takas8-yas-adet4 + takas8-yas-adet5
                      compute yan-alt-toplam = yan-alt-toplam +  yan-toplam

                      move yan-toplam        to zyan-toplam
                      move zyan-toplam       to det-16

                      compute yuzde-yas-1 rounded = (takas8-yas-adet1 / yan-toplam ) * 100

                      move yuzde-yas-1  to zyuzde-yas-1
                      move zyuzde-yas-1 to det-7

                      compute yuzde-yas-2 rounded = (takas8-yas-adet2 / yan-toplam ) * 100
                      move  yuzde-yas-2 to zyuzde-yas-2
                      move zyuzde-yas-2 to det-9

                      compute yuzde-yas-3 rounded = (takas8-yas-adet3 / yan-toplam ) * 100
                      move  yuzde-yas-3 to zyuzde-yas-3
                      move zyuzde-yas-3 to det-11

                      compute yuzde-yas-4 rounded = (takas8-yas-adet4 / yan-toplam ) * 100
                      move  yuzde-yas-4 to zyuzde-yas-4
                      move zyuzde-yas-4 to det-13

                      compute yuzde-yas-5 rounded = (takas8-yas-adet5 / yan-toplam ) * 100
                      move  yuzde-yas-5 to zyuzde-yas-5
                      move zyuzde-yas-5 to det-15              ,



                      if atla not = 1
                         write dokumer-rec from detay
                      end-if 
                    end-read
              end-perform
              if atla  = 1
                 initialize pazartop-rec 
                 start pazartop key not < pazartop-anah invalid 
                      continue 
                 not invalid 
                 perform with test after until fs-pazartop = "10"
                 read pazartop next no lock end move "10"  to fs-pazartop
                 not at end 
                     initialize dokumer-rec detay
                     move pazartop-rez-no   to det-1
                     move pazartop-rez-sira to  det-2
                     move pazartop-yas      to zvirgul
                     move zvirgul           to det-3
                     write dokumer-rec from detay
                 end-read 
                 end-perform
                 end-start
              end-if
                 initialize dokumer-rec detay
                 move "Toplam -->"               to det-1
                 move "A"                        to det-dokumer-20(3:1)
                 move 481                        to det-renk1
                 move "1"                        to det-dokumer-20(10:1)
                 move alt-toplam-buyuk           to z4
                 move z4                         to det-2
                 move alt-toplam-kucuk           to z4
                 move z4                         to det-3
                 move alt-toplam-free            to z4
                 move z4                         to det-4
                 move alt-toplam-bebek           to z4
                 move z4                         to det-5


                 move toplam-yas-1               to z4
                 move z4                         to det-6 
                 
                 compute yuzde-yas-1 rounded = (toplam-yas-1 / yan-alt-toplam ) * 100
                 move  yuzde-yas-1               to zyuzde-yas-1
                 move zyuzde-yas-1               to det-7


                 move toplam-yas-2               to z4
                 move z4                         to det-8 

                 compute yuzde-yas-2 rounded = (toplam-yas-2 / yan-alt-toplam ) * 100
                 move  yuzde-yas-2               to zyuzde-yas-2
                 move zyuzde-yas-2               to det-9

                 move toplam-yas-3               to z4
                 move z4                         to det-10

                 compute yuzde-yas-3 rounded = (toplam-yas-3 / yan-alt-toplam ) * 100
                 move  yuzde-yas-3 to zyuzde-yas-3
                 move zyuzde-yas-3 to det-11

                 move toplam-yas-4               to z4
                 move z4                         to det-12

                 compute yuzde-yas-4 rounded = (toplam-yas-4 / yan-alt-toplam ) * 100
                 move  yuzde-yas-4 to zyuzde-yas-4
                 move zyuzde-yas-4 to det-13

                 move toplam-yas-5               to z4
                 move z4                         to det-14 

                 compute yuzde-yas-5 rounded = (toplam-yas-5 / yan-alt-toplam ) * 100
                 move  yuzde-yas-5 to zyuzde-yas-5
                 move zyuzde-yas-5 to det-15

                 move yan-alt-toplam             to z4
                 move z4                         to det-16

                 write dokumer-rec from detay

                 initialize dokumer-rec detay
                 move "Ort. Yas->"               to det-1
                 move "A"                        to det-dokumer-20(3:1)
                 move 176                        to det-renk1
                 move "1"                        to det-dokumer-20(10:1)  

                 initialize ort-yas
                 compute ort-yas rounded = 
                         toplam-yas / toplam-kisi

                 compute ort-yas1 rounded =                                                     
                         toplam-yas-1-1 / toplam-yas-1                                     
                                                                                                
                 compute ort-yas2 rounded =                                                     
                         toplam-yas-2-1 / toplam-yas-2                                      

                 compute ort-yas3 rounded = 
                         toplam-yas-3-1 / toplam-yas-3

                 compute ort-yas4 rounded = 
                         toplam-yas-4-1 / toplam-yas-4

                 compute ort-yas5 rounded = 
                         toplam-yas-5-1 / toplam-yas-5

                 move ort-yas     to zvirgul
                 move zvirgul     to det-2

                 move ort-yas1    to zvirgul
                 move zvirgul     to det-6
                 move ort-yas2    to zvirgul
                 move zvirgul     to det-8
                 move ort-yas3    to zvirgul
                 move zvirgul     to det-10
                 move ort-yas4    to zvirgul
                 move zvirgul     to det-12
                 move ort-yas5    to zvirgul
                 move zvirgul     to det-14

                 write dokumer-rec from detay



              close dokumer
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close takas8  uyruk ulke pazartop acenta kodlar02   konum doviz


              delete file dokumer takas8 pazartop takas
    end-evaluate.
     .

 takas-dosya-yaz.
    perform takas-dosya-ac.
    open input rez cast grup bilbord polisxml yanrez odalar uyruk ulke    
         perform cast-oku thru cast-oku-exit.
    close  rez cast takas grup bilbord polisxml yanrez odalar uyruk ulke.

 takas-dosya-yaz-exit.
    exit.
 cast-oku.
    initialize cast-rec toplam-yas toplam-kisi.
    move ilk-tar to cast-tarih.
    start cast key not < cast-anah2 invalid continue,
        not invalid,
        move spaces to var-yok,
        perform with test after until var,
            read cast next no lock end move "v" to var-yok,
                 not end,
                 if cast-tarih > son-tar
                    move "v" to var-yok,
                 else,                
                    initialize rez-rec,
                    move cast-rez-no to rez-no,
                    read rez no lock invalid 
                        continue,
                    not invalid                    
                        if filtre-var = 1 then 
                            perform filtre
                            if filtre-gecti = 1 then 
                              perform takas-kaydet thru takas-kaydet-exit
                            end-if
                        else
                            perform takas-kaydet thru takas-kaydet-exit 
                        end-if
                    end-read,                     
                 end-if,
            end-read,
        end-perform,
    end-start.
 cast-oku-exit.
    exit.

 takas-kaydet.
    if onkpara-referans-var = 1 then 
       perform ref-filtre
       if  not ref-gecti then 
           exit paragraph
       end-if
    end-if
    evaluate true
    when rap-tip = "N"
         if rez-durumu not = "I" go takas-kaydet-exit,
         end-if,
         if rez-k-g-b  not = "K" go takas-kaydet-exit,
         end-if,
    when rap-tip = "W"
         if rez-durumu not = "I" go takas-kaydet-exit,
         end-if,
         if rez-k-g-b      = "K" go takas-kaydet-exit,
         end-if,
    when rap-tip = "S"
         if rez-durumu not = "S" 
            go takas-kaydet-exit,
         end-if.
    if cast-tarih = rez-cik-tar   
        go takas-kaydet-exit.

    if acn-kod not = spaces and 
       rez-acenta not = acn-kod,
        go takas-kaydet-exit.

*** Grup Filtresi

    if acn-grup-kod not = spaces
      initialize grup-rec
      set grup-acenta to true
      move acn-grup-kod to grup-kodu
      move rez-acenta   to grup-alt
      read grup no lock
        invalid
          go takas-kaydet-exit
      end-read
    end-if

*** Grup Filtresi
*   TRACE Uygulamasi Acik ise kisi sayilari cast'tan alinacak
     move 1 to eklenecek-oda
    if rezpara-trace = 1
       if rez-kisi not = cast-kisi
          move cast-kisi to rez-kisi
       end-if
       if rez-oda-konumu not = cast-oda-konumu
          move cast-oda-konumu to rez-oda-konumu
       end-if
       if rez-fiyat-konumu not = cast-fiyat-konumu
          move cast-fiyat-konumu to rez-fiyat-konumu
       end-if
       if rez-anlasma not = cast-anlasma
          move cast-anlasma to rez-anlasma
       end-if
       if rez-pan-tipi not = cast-pan-tipi
          move cast-pan-tipi to rez-pan-tipi
       end-if
       if rez-share = 1 then          
             move 0  to eklenecek-oda 
       else
              move 1 to eklenecek-oda
       end-if
    else 
          move 1 to eklenecek-oda
    end-if
    
    move 0 to uyruklu

    initialize takas8-rec.
    evaluate cm4-val(1:1)
    when "U"
       move rez-ulke   to takas8-acenta
    read takas8 no lock invalid 
       continue
    end-read 
       perform takas-ara-yaz
    when "A"
       move rez-acenta to takas8-acenta
    read takas8 no lock invalid 
       continue
    end-read 
       perform takas-ara-yaz
    when "P"
       move rez-pazar  to takas8-acenta
    read takas8 no lock invalid 
       continue
    end-read 
       perform takas-ara-yaz
    when "R"
       move rez-no     to takas8-acenta  
    read takas8 no lock invalid 
       continue
    end-read 
       perform takas-ara-yaz
    when "K"
       if cast-tarih = rez-gir-tar  
          initialize takas-rec
          move cast-rez-no    to takas-rez-no
          read takas no lock invalid 
             
          end-read
           move 1 to uyruklu
              perform polisxml-bul
          write takas-rec invalid 
             rewrite takas-rec end-rewrite 
          end-write 
       end-if

    end-evaluate.
 takas-kaydet-exit.
     exit.
 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid 
         move 1 to ekran-fis-1
    end-read.
    
    add 1 to ekran-fis-1.
 
    move ekran-fis-1(2:) to takas8-no takas-no
                        pazartop-no.
    add 1 to ekran-fis-1.
    rewrite genelfis-rec invalid 
            write genelfis-rec invalid continue
            end-write
    end-rewrite.
    close genelfis.
    open output takas8 close takas8 open i-o takas8 with mass-update.
    open output takas close takas open i-o takas with mass-update.
    open output pazartop close pazartop open i-o pazartop with mass-update.
*
 acc-04-Aft-Procedure.
     open input acenta
     if acn-kod = spaces
        if acn-grup-kod = spaces
           move "Tum Acentalar"   to acenta-adi
        end-if
     else
        move acn-kod    to acenta-kodu
        read acenta no lock invalid
             move "Tanimsiz Acenta ..." to acenta-adi
             move 4 to accept-control
             move 12 to control-id
        end-read
        initialize acn-grup-kod
        move "Acenta Filtresi" to grup-adi
        display acc-08 lb-acngrupadi
     end-if
     display lb-acenadi
     close acenta
     .
*
 acc-08-Aft-Procedure.
     open input grup
     if acn-grup-kod = spaces
        if acn-kod = spaces
           move "Tum Gruplar"   to grup-adi
        end-if
     else
        initialize grup-rec
        set grup-acenta to true
        move acn-grup-kod    to grup-kodu
        read grup no lock invalid
             move "Tanimsiz Acenta Grubu..." to grup-adi
             move 4 to accept-control
             move 17 to control-id
        end-read
        initialize acn-kod
        move "Grup Filtresi" to acenta-adi
        display acc-04 lb-acenadi
     end-if
     display lb-acngrupadi
     close grup
     .
*
 yas-bul.
     subtract yasbulson-gun from yasbulilk-gun giving yasbulfark-gun                                        
     if yasbulfark-gun < 0 then 
       subtract 1 from yasbulilk-ay  
       evaluate yasbulilk-ay
          when 1 
          when 3 
          when 5 
          when 7 
          when 8 
          when 10 
          when 0
             add 31 to yasbulfark-gun 
          when 2
             divide yasbulilk-yil by 4 giving bolum remainder kalan
             if kalan = 0 then 
                 add 29 to yasbulfark-gun 
             else
                 add 28 to yasbulfark-gun
             end-if
          when other 
             add 30 to yasbulfark-gun 
         end-evaluate
     end-if
     subtract yasbulson-ay from yasbulilk-ay giving yasbulfark-ay 
     if yasbulfark-ay < 0 then 
       add 12 to yasbulfark-ay 
       subtract 1 from yasbulilk-yil
     end-if
     subtract yasbulson-yil from yasbulilk-yil giving yasbulfark-yil 
     compute yasbulfark-yil-say  rounded  =  yasbulfark-yil
          + ( yasbulfark-ay / 12 ) + ( yasbulfark-GUN / 365 )  
     move yasbulfark-yil-say to yasz
     compute toplam-yas = toplam-yas + yasbulfark-yil-say .
*
 polisxml-bul.
     initialize polisxml-rec
     move rez-no          to polisxml-rezno
     start polisxml key not < polisxml-anah invalid
           continue
     not invalid
     perform with test after until fs-polisxml = "10"
     read polisxml next no lock end move "10"  to fs-polisxml
     not at end
            if polisxml-rezno <> rez-no
               exit perform
            end-if
            if uyruklu = 1
                initialize takas8-rec 
                initialize uyruk-rec
                move polisxml-uyruk to uyruk-anah
                read uyruk no lock invalid 
                     initialize ulke-rec
                     move rez-ulke      to ulke-anah
                     read ulke no lock invalid
                          move "-YOK" to takas8-acenta
                     not invalid 
                         initialize uyruk-rec
                         move ULKE-akbs to uyruk-anah
                         read uyruk no lock invalid 
                              move "-YOK" to takas8-acenta
                         end-read 
                     end-read 
                end-read 

                move uyruk-anah to takas8-acenta
                if takas8-acenta = spaces
                   move "-YOK" to takas8-acenta
                end-if 
                read takas8 no lock invalid 
                   continue
                end-read                
            end-if 
            move 0 to istgirdi 
            evaluate polisxml-sirano 
            when 1 when 2 when 3 when 4 when 5 when 6 when 7 when 8
                if polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar      to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                        move 1 to istgirdi 
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                        move 1 to istgirdi 
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                        move 1 to istgirdi 
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                        move 1 to istgirdi 
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                        move 1 to istgirdi 
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if

                     move yasz to takas8-yas1

**                       if k-kodu-tasi = "ASYA" and istgirdi = 0 then stop " " end-if
                     else
**                    if k-kodu-tasi = "ASYA" then stop " " end-if
                end-if
            when 2
                if  polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if

                     move yasz to takas8-yas2
                end-if
            when 3
                if  polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if

                     move yasz to takas8-yas3
                end-if
            when 4
                if  polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if

                     move yasz to takas8-yas4
                end-if
            when 5
                if  polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if
                    move yasz to takas8-yas5
                end-if

            when 6
                if  polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if
                     
                end-if
            when 7
                if  polisxml-dog-yil > 1900
                    move polisxml-dog-tar to yasbulson-tarih
                    move rez-gir-tar to yasbulilk-tarih
                    perform yas-bul
                     if yasz > yas-1-1 
                        if yasz < yas-1-2
                          add 1 to takas8-yas-adet1
                          compute takas8-yas-top1                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top1 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-2-1 
                        if yasz < yas-2-2
                          add 1 to takas8-yas-adet2
                          compute takas8-yas-top2                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top2 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-3-1 
                        if yasz < yas-3-2
                          add 1 to takas8-yas-adet3
                          compute takas8-yas-top3                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top3 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-4-1 
                        if yasz < yas-4-2
                          add 1 to takas8-yas-adet4
                          compute takas8-yas-top4                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top4 + yasbulfark-yil-say 
                        end-if
                     end-if
                     if yasz > yas-5-1 
                        if yasz < yas-5-2
                          add 1 to takas8-yas-adet5
                          compute takas8-yas-top5                                  |firat yaþ aralýðý ortalamasý 24/10/2019
                                  = takas8-yas-top5 + yasbulfark-yil-say 
                        end-if
                     end-if
                     
                end-if
            end-evaluate

            add 1             to toplam-kisi

            if atla = 1            
               initialize pazartop-rec
               move polisxml-rezno   to pazartop-rez-no
               move polisxml-sirano  to pazartop-rez-sira
               read pazartop no lock invalid 
                   continue 
               end-read 
                    move yasbulfark-yil-say to pazartop-yas
               write pazartop-rec invalid 
                   rewrite pazartop-rec end-rewrite 
               end-write 
            end-if 

            if uyruklu = 1
               perform takas-ara-yaz
            end-if 

     end-read
     end-perform
     end-start.
*
 takas-ara-yaz.        
       if uyruklu = 0
**       if cast-tarih = rez-gir-tar  
          initialize takas-rec
          move cast-rez-no    to takas-rez-no
          read takas no lock invalid 
             

          end-read
          if uyruklu = 0
              perform polisxml-bul
             end-if
          write takas-rec invalid 
             rewrite takas-rec end-rewrite 
          end-write 
**       end-if
       end-if

       evaluate gelen-kalan(1:1)
       when "0"
               compute takas8-buyuk = 
                       takas8-buyuk + rez-buyuk
               compute takas8-kucuk = 
                       takas8-kucuk + rez-kucuk
               compute takas8-free = 
                       takas8-free + rez-free
               compute takas8-bebek = 
                       takas8-bebek + rez-bebek
       when "1"
           if cast-tarih = rez-gir-tar
               compute takas8-buyuk = 
                       takas8-buyuk + rez-buyuk
               compute takas8-kucuk = 
                       takas8-kucuk + rez-kucuk
               compute takas8-free = 
                       takas8-free + rez-free
               compute takas8-bebek = 
                       takas8-bebek + rez-bebek               
           end-if 
       end-evaluate 

       
    write takas8-rec invalid 
          rewrite takas8-rec 
    end-write.

 
