* dokumer.evt
* dokumer.evt is generated from D:\asya\acugt.ytl\otel\dokumer.Psf
* This is a generated file. DO NOT modify this file directly.


 Form0-Event-Proc.
     EVALUATE Event-Control-Id
     WHEN 2
        PERFORM grid0-Ev-Other
     END-EVALUATE
     .

 Form0-Exception-Proc.
     PERFORM Form0-Ex-Other
     .

 grid0-Exception-Proc.
     PERFORM grid0-Ex-Other
     .

 acc-baslik-Exception-Proc.
     PERFORM acc-baslik-Ex-Other
     .

 Form0-Pb-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        EVALUATE Event-Control-Id
        WHEN 4
           PERFORM Form0-Pb-1-Ev-Cmd-Clicked
        WHEN 7
           PERFORM Form0-Pb-1a-Ev-Cmd-Clicked
        END-EVALUATE
     END-EVALUATE
     .

 Form0-Pb-1aa-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        EVALUATE Event-Control-Id
        WHEN 11
           PERFORM Form0-Pb-1aaa-Ev-Cmd-Clicked
        END-EVALUATE
     END-EVALUATE
     .

 Form0-Gd-1-Event-Proc.
     PERFORM grid6-Ev-Other
     .

 grid6-Exception-Proc.
     PERFORM grid6-Ex-Other
     .

 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Gd-1-Event-Proc.
     PERFORM grid1-Ev-Other
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form3-Event-Proc.
     .

 Form3-Exception-Proc.
     PERFORM Form3-Ex-Other
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Form2-Ex-Other
     .

 Form2-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM HODO-Ev-Msg-Begin-Entry
     END-EVALUATE
     .
***   start event editor code   ***
*
 Form0-Bef-Create.

*/ T–KKAT T–KKATTTttt
*/ Onbprudaki dokumer-400 800 haneden k_-kse no-compile
*/
     move "X" to dokumer-400(wrk-dokumer-length:1)
*/ T–KKAT T–KKATTTttt
*/ gridteki suz icerigi ile suz datasindaki ayn- uzunlukta olmal-
*/
     if function length(filtre-icerik) <> function length(gd-6-col-2) or
        function length(gd-6-col-2) <> function length(grid-suz-icerik(1))
        display message box
                "Suz-icerik <> gd-6-col-2 or <> grid-suz-icerik"
                icon mb_warning_icon
                title "Hata"
                goback
     end-if
     move "X" to dokumer-400(wrk-dokumer-length:1)
*/ OPEN OFFICE MI ?
     initialize open-officemi
     accept open-officemi from environment "OPENOFFICE".
     accept filtre-dosya from time
        
*/
*/dokumer'in hangi tipte calisacagi sifirlansin diye ...
*     move "T"      to dokumer-calisma-tipi
     move program-modul            to dokumer-prog-modul.
     move dokumer-calisma-tipi     to calisma-tipi.
     move dokumer-genel-baslik-yaz to genel-baslik-at.
     initialize dokumer-genel-baslik-yaz dokumer-calisma-tipi grid-flt-deg.
     move 1 to dokumer-external-sifirla yazdirma-kaynagi
               yatay-cizgi dikey-cizgi.
     perform adresleri-tasi.
*********************************************************
*********************************************************
*********************************************************
*************
*
*
*    ONEMLI HANGI DOKUMERIN +ALI¶ACA¶I
*
*
*************
     open input kllnc.
     move k-kodu-tasi   to k-kodu
     read kllnc no lock invalid
          display message box "Tanimsiz kullanici ...."
          icon mb_error_icon
          title "Bilginize ...."
     end-read
     close kllnc.

*********************************************************
*********************************************************
*********************************************************
     call "c$calledby" using  called-program
                       giving called-status
     end-call.

      perform iso-icin-prosif-oku. | bilerek gercek prosiften once okuduk karismasin sistem

     perform prosif-oku.
     open i-o genel.
     move 1 to genel-anahtar.
     read genel no lock invalid
          display message box 
                  "Modul genel parametresi tanimsiz",new-line,
                  "Lutfen tanimlayiniz ..."
                  icon mb_error_icon
                  title "Hata"
                  close genel
                  goback
     end-read.
     close genel.
                 

     copy resource "cark.jpg".
     call "w$bitmap" using wbitmap-load "cark.jpg", giving cark-jpg


     if not dokumer-param-ok
        perform acu-form2-routine.
     if dokumer-yazici-format 
        perform Dokumer-Yazici-Format-Proc
        initialize dokumer-islem-tipi
        goback.
     if dokumer-yazici-grafik
        set grafik-yazici to true
        perform Dokumer-Yazici-Format-Proc
        initialize dokumer-islem-tipi
        goback.
     if dokumer-yazici-text
        perform Dokumer-Yazici-text-Proc
        initialize dokumer-islem-tipi
        goback.

     if dokumer-excel
        perform csv-call
        initialize dokumer-islem-tipi
        goback.   


     if not dokumer-param-ok
        perform destroy-window-proc
        initialize dokumer-islem-tipi
        goback.

 dokumer-yazici-text-proc.
     initialize liste-adres rapor-genel-baslik.
     accept translate-to-ansi from environment
            "TRANSLATE-TO-ANSI".
     set environment "TRANSLATE-TO-ANSI" to 0.
*/ seri printer c-kt-s- _-karmak i_in karde–ler ...
     initialize num-param
     call "c$narg" using num-param

     if num-param <> 0 and dokumer-link-liste-adres <> spaces
        move dokumer-link-liste-adres       to link-liste-adres
        move dokumer-link-sayfa-basi        to link-sayfa-basi
        move dokumer-link-print-no          to link-print-no
        move dokumer-link-liste-satir-sayi  to link-liste-satir-sayi
     else
        initialize link-prtler
        if grafik-yazici
           move called-program          to link-liste-adres
        end-if
        if faturaya-gonder = "E"
           move "RAMAZAN"           to link-liste-adres
           move kullanilan-yazicilar(10) to link-print-no
        end-if
        
        set dokumer-prog-prtcagir       to true
        call dokumer-prog-call using 
             link-prtler
        on exception 
              initialize faturaya-gonder
              perform callerr-proc
              exit paragraph
        not on exception 
        cancel dokumer-prog-call
        end-call
        initialize faturaya-gonder
        if num-param <> 0 
           move link-liste-adres         to dokumer-link-liste-adres
           move link-sayfa-basi          to dokumer-link-sayfa-basi
           move link-print-no            to dokumer-link-print-no
           move link-liste-satir-sayi    to dokumer-link-liste-satir-sayi
        end-if
     end-if
     move link-liste-adres        to liste-adres
     move link-sayfa-basi         to yazfor-sayfa-basi.

     open input prtler
     move link-print-no   to prtler-anah
     read prtler no lock invalid
          initialize prtler-rec
     end-read
     close prtler
     open input isyeri.
     move isyeri-no-tasi to isyeri-no
     read isyeri no lock invalid
          move "Tanimsiz Sirket" to isyeri-unvan
     end-read
     close isyeri.
     if liste-adres = spaces
        set environment "TRANSLATE-TO-ANSI" to translate-to-ansi
        exit paragraph
     end-if

     perform prosif-oku.
     accept tarih from century-date
     accept zaman from time
     move isyeri-unvan         to rapor-genel-otel-ismi
     if prosif-terminal-adi = "1"
        move user-id              to rapor-genel-terminal-adi
     end-if
     if prosif-sistem-saati = "1"
        move saat                 to esaat
        move dakika               to edakika
        move saniye               to esaniye
        move ezaman               to rapor-genel-zaman
     end-if
     if prosif-sistem-tarihi = "1"
        move yil                  to eyil
        move ay                   to eay
        move gun                  to egun
        move etarih               to rapor-genel-tarih
     end-if
     if prosif-kullanici-adi = "1"
        open input kllnc
        move k-kodu-tasi         to k-kodu
        read kllnc no lock invalid
             move "Tanimsiz ..." to k-adi
        end-read
        close kllnc
        move k-adi to rapor-genel-kullanici-adi
     end-if
     if prosif-sayfa-numarasi = "1"
        move "Sayfa: "   to rapor-genel-sayfa-filler
        move 1           to rapor-genel-sayfa
                            yazfor-sayfa
     end-if
     move "ASYA-SOFT [ Winner ]"    to rapor-imza.
     perform wait-wnd-create.
     open input dokumer.
     open output liste.
     set environment "TRANSLATE-TO-ANSI" to 
                     translate-to-ansi
     if prtler-buyuk-kucuk(1:1) = x"20"
         move x"0f"    to liste-rec
     end-if
     move prtler-buyuk-kucuk to liste-rec(2:)
     write liste-rec
     if genel-baslik-at <> "H"
        write liste-rec from rapor-genel-baslik after 0.
     initialize yazfor-degiskenler fs-dokumer yazfor-kayit-sayi.
     move 1 to rapor-genel-sayfa yazfor-sayfa ref-baslik-yaz
     perform with test after until fs-dokumer = "10"
     initialize dokumer-rec
     read dokumer next no lock end move "10" to fs-dokumer
     not at end
          move dokumer-20(10:1)  to yazfor-kere
          evaluate dokumer-20(1:1)
             when "W"
                   exit perform cycle
             when "B"
                   |/////NOKTA//////////////////////////////////////////
                   if ref-baslik-yaz = 1 and ONKPARA-REFERANS-VAR = 1
                           perform fiyat-oda-ref-after
                           add 1 to yazfor-entry-baslik-sayi yazfor-kayit-sayi
                           move ref-baslik-detay to yazfor-entry-baslik-occ(yazfor-entry-baslik-sayi)
                           move ref-baslik-detay to liste-rec
                           write liste-rec
                   end-if
                   |////////////////////////////////////////////////////////////////////
                   add 1 to yazfor-entry-baslik-sayi yazfor-kayit-sayi
                   if yazfor-entry-baslik-sayi < 8
                      move dokumer-400     to yazfor-entry-baslik-occ(yazfor-entry-baslik-sayi)
                      move yazfor-kere     to yazfor-entry-baslik-kere(yazfor-entry-baslik-sayi)
                   end-if
         
                   move dokumer-400 to liste-rec
                   write liste-rec
             when "O"
                   move dokumer-400  to dokumer-ozellikler-rec
                   exit perform cycle
             when "D"
                   exit perform cycle
             when other
                   inspect dokumer-400 
                           replacing all high-values by space
                   inspect dokumer-400 
                           replacing all low-values by space
                   write liste-rec from dokumer-400
                   add 1 to yazfor-kayit-sayi
          end-evaluate
          if dokumer-20(7:1) <> space 
             perform yazfor-text-after-0-alt-cizgi
          end-if
          if yazfor-kere numeric and 
             yazfor-kere > 0
                    perform yazfor-text-after-0
          end-if
          if dokumer-20(5:1) = "P"
             perform yazfor-text-baslik-at
          end-if
          if dokumer-20(5:1) = "L"
             initialize liste-rec
             write liste-rec after page
          end-if
          if dokumer-oto-sayfa-basi-yap
             if dokumer-oto-sayfa-satir < yazfor-kayit-sayi
                perform yazfor-text-baslik-at
             end-if
          end-if
     end-read
     end-perform.
     perform wait-wnd-destroy.

     perform iso-bos-yaz.
     perform iso-bilgileri-yaz.   ||| iso paragraf˝
     if yazfor-sayfa-basi = "E"
        initialize liste-rec
        write liste-rec after page
     end-if.
     close dokumer liste.
*
 yazfor-text-after-0-alt-cizgi.
     write liste-rec after 0.
*
 yazfor-text-after-0.
     perform varying yazfor-after-i from 1 by 1 until yazfor-after-i > yazfor-kere
             write liste-rec after 0 
     end-perform.
*
 yazfor-text-baslik-at.
     perform iso-bilgileri-yaz.
     initialize liste-rec yazfor-kayit-sayi
     write liste-rec after page
     add 1 to yazfor-sayfa
     if prosif-sayfa-numarasi = "1"
        move yazfor-sayfa to rapor-genel-sayfa
     end-if
     if genel-baslik-at <> "H"
        write liste-rec from rapor-genel-baslik
     end-if
     add 1 to yazfor-kayit-sayi
     perform varying i from 1 by 1 until i > yazfor-entry-baslik-sayi
             initialize liste-rec yazfor-kere
             write liste-rec from yazfor-entry-baslik-occ(i)
             if yazfor-entry-baslik-kere(i) > 0
                move yazfor-entry-baslik-kere(i) to yazfor-kere
                perform yazfor-after-0
             end-if
             add 1 to yazfor-kayit-sayi
     end-perform.
*
***********************************************************
***********************************************************
***********************************************************
***********************************************************
 dokumer-yazici-format-proc.
     initialize liste-adres rapor-genel-baslik.
     accept translate-to-ansi from environment
            "TRANSLATE-TO-ANSI".
     set environment "TRANSLATE-TO-ANSI" to 0.
*/ seri printer c-kt-s- _-karmak i_in karde–ler ...
     initialize num-param
     call "c$narg" using num-param
      
     if num-param <> 0 and dokumer-link-liste-adres <> spaces
        move dokumer-link-liste-adres       to link-liste-adres
        move dokumer-link-sayfa-basi        to link-sayfa-basi
        move dokumer-link-print-no          to link-print-no
        move dokumer-link-liste-satir-sayi  to link-liste-satir-sayi
     else
        initialize link-prtler
        if grafik-yazici
           move called-program          to link-liste-adres
        end-if
        set dokumer-prog-prtcagir       to true
        call dokumer-prog-call using 
             link-prtler
        on exception 
              perform callerr-proc
              exit paragraph
        not on exception 
        cancel dokumer-prog-call
        end-call
        if num-param <> 0 
           move link-liste-adres         to dokumer-link-liste-adres
           move link-sayfa-basi          to dokumer-link-sayfa-basi
           move link-print-no            to dokumer-link-print-no
           move link-liste-satir-sayi    to dokumer-link-liste-satir-sayi
        end-if
     end-if
     move link-liste-adres        to liste-adres
     move link-sayfa-basi         to yazfor-sayfa-basi.
     open input prtler
     move link-print-no   to prtler-anah
     read prtler no lock invalid
          initialize prtler-rec
     end-read
     close prtler
     if liste-adres = spaces
        set environment "TRANSLATE-TO-ANSI" to 
            translate-to-ansi
        exit paragraph.
     open input isyeri.
     move isyeri-no-tasi to isyeri-no
     read isyeri no lock invalid
          move "Tanimsiz Sirket" to isyeri-unvan
     end-read
     close isyeri.
     perform prosif-oku.
     accept tarih from century-date
     accept zaman from time
     move isyeri-unvan            to rapor-genel-otel-ismi
     if prosif-terminal-adi = "1"
        move user-id              to rapor-genel-terminal-adi
     end-if
     if prosif-sistem-saati = "1"
        move saat                 to esaat
        move dakika               to edakika
        move saniye               to esaniye
        move ezaman               to rapor-genel-zaman
     end-if
     if prosif-sistem-tarihi = "1"
        move yil                  to eyil
        move ay                   to eay
        move gun                  to egun
        move etarih               to rapor-genel-tarih
     end-if
     if prosif-kullanici-adi = "1"
        open input kllnc
        move k-kodu-tasi         to k-kodu
        read kllnc no lock invalid
             move "Tanimsiz ..." to k-adi
        end-read
        close kllnc
        move k-adi to rapor-genel-kullanici-adi
     end-if
     if prosif-sayfa-numarasi = "1"
        move "Sayfa: "   to rapor-genel-sayfa-filler
        move 1           to rapor-genel-sayfa
                            yazfor-sayfa
     end-if
     move "ASYA-SOFT [Winner 7.2]"    to rapor-imza.
     perform wait-wnd-create.
     open input dokumer.
     open output liste.

     set environment "TRANSLATE-TO-ANSI" to 
                     translate-to-ansi
     if prtler-buyuk-kucuk(1:1) = x"20"
         move x"0f"    to liste-rec
     end-if
     move prtler-buyuk-kucuk to liste-rec(2:)
     move 1 to satir
     if not grafik-yazici
        write liste-rec
     else
        subtract 3 from link-liste-satir-sayi
        initialize winprint-data
        call "win$printer" using winprint-get-page-layout
                                 winprint-data 
                                 returning grafik-yazici-donus
        
        move wprtdata-columns-per-page to link-liste-sutun-sayi
        subtract 1 from link-liste-sutun-sayi
        perform set-pen-width-3
        perform genel-kutu-ciz

        initialize textsize-data
        move grafik-yazici-font to textsize-font
        call "w$textsize" using "0", textsize-data
        move 2.50               to font-en
     end-if
     if genel-baslik-at <> "H"
        if grafik-yazici
           move 4 to sutun
           perform set-cursor
           write liste-rec from rapor-genel-baslik before advancing 1 line
        else
           write liste-rec from rapor-genel-baslik after 0
        end-if
     end-if
***** -Q printerlar icin sayfa sat-r say-s- ayarlamas-
     if link-liste-satir-sayi not numeric
        initialize link-liste-satir-sayi
     end-if
***** -Q printerlar icin sayfa sat-r say-s- ayarlamas-
     initialize yazfor-degiskenler fs-dokumer yazfor-kayit-sayi baslik-bosluk-sayi.
     move 1 to rapor-genel-sayfa yazfor-sayfa ref-baslik-yaz

     perform with test after until fs-dokumer = "10"
     initialize dokumer-rec
     read dokumer next no lock end move "10" to fs-dokumer
     not at end
          move dokumer-20(10:1)  to yazfor-kere
          evaluate dokumer-20(1:1)
             when "W"
                   exit perform cycle
             when "M"
                   initialize liste-rec
                   if grafik-yazici  
                    move 4 to sutun
                    add 1 to satir
                    perform set-cursor 
                    write liste-rec before advancing 1 line
                    else
                   write liste-rec
                 end-if

                   add 1 to yazfor-kayit-sayi
                            baslik-bosluk-sayi
             when "B"
                   |/////GRAFIK//////////////////////////////////////////
                   if ref-baslik-yaz = 1 and ONKPARA-REFERANS-VAR = 1
                           perform fiyat-oda-ref-after
                           add 1 to yazfor-entry-baslik-sayi yazfor-kayit-sayi
                           move ref-baslik-detay to yazfor-entry-baslik-occ(yazfor-entry-baslik-sayi)
                           move ref-baslik-detay to liste-rec
                           if grafik-yazici
                              add 1 to satir
                              move 4 to sutun
                              perform set-cursor
                              perform set-font-bold
                              write liste-rec before advancing 1 line
                              perform set-font-normal
                           else
                              write liste-rec 
                           end-if
                   end-if
                   |////////////////////////////////////////////////////////////////////
                   add 1 to yazfor-entry-baslik-sayi yazfor-kayit-sayi
                   if yazfor-entry-baslik-sayi < 8
                      move dokumer-400     to yazfor-entry-baslik-occ(yazfor-entry-baslik-sayi)
                      move yazfor-kere     to yazfor-entry-baslik-kere(yazfor-entry-baslik-sayi)
                   end-if
                   move dokumer-400 to liste-rec
                   if grafik-yazici
                      add 1 to satir
                      move 4 to sutun
                      perform set-cursor
                      perform set-font-bold
                      write liste-rec before advancing 1 line
                      perform set-font-normal
                   else
                      write liste-rec 
                   end-if
             when "O"
                   move dokumer-400  to dokumer-ozellikler-rec
                   exit perform cycle
             when "D"
                   evaluate dokumer-20(2:1)
                       when 1 
                            if grafik-yazici
                               add 0.75     to satir
                               perform soldan-saga-ciz
                               move satir   to grafik-ilk-y
                               subtract 0.75 from satir
                            end-if
                            perform yazfor-detay-al
                            initialize i ii yazfor-i yazfor-ii yazfor-kisit-detaylar
                                   yazfor-kisit-detay-sayi
                            perform varying i from 1 by 1 until i > yazfor-detay-sayi
                                   if prosif-detaylar(i:1) = "1" or
                                      i > 50 
                                      add 1           to yazfor-kisit-detay-sayi
                                      move i          to yazfor-kisit-index(yazfor-kisit-detay-sayi)
                                   end-if
                            end-perform
                            if grafik-yazici
                               move "E" to grafik-yazici-islem
                            end-if
                            perform yazfor-kayit-yerlestir
                            if grafik-yazici
                               initialize grafik-yazici-islem
                               if dokumer-20-ekran-yazma
                                  move "H"     to yazfor-detay-baslik-basma(1)
                               end-if
                            end-if
                            inspect liste-rec replacing all dokumer-detay-kolon-ayirici
                                    by space
                            move liste-rec    to yazfor-detay-baslik-occ(1)
                            move yazfor-kere  to yazfor-detay-baslik-kere(1)
                            move 1            to yazfor-detay-baslik-sayi
                       when other
                            perform yazfor-kayit-yerlestir
                            move dokumer-20(2:1) to yazfor-1
                            move liste-rec       to yazfor-detay-baslik-occ(yazfor-1)
                            move yazfor-kere     to yazfor-detay-baslik-kere(yazfor-1)
                            if grafik-yazici and dokumer-20-ekran-yazma
                               move "H"     to yazfor-detay-baslik-basma(yazfor-1)
                            end-if
                            add 1                to yazfor-detay-baslik-sayi
                   end-evaluate
                   if grafik-yazici
                      add 1 to satir
                      if dokumer-20-ekran-yazma
                         perform soldan-saga-ciz
                         initialize liste-rec
                      end-if
                      move 4 to sutun
                      perform set-cursor
                      perform set-font-bold 
                      write liste-rec before advancing 1 line
                      perform set-font-normal
                   else
                      write liste-rec 
                   end-if
                   add 1 to yazfor-kayit-sayi
             when other
*/ eger dokumer-20(9:1) = "X" ise kayit-yerlestir yapimiyor
*/ kayit direk move ediliyor
                   if dokumer-20(9:1) <> "X"
                      perform yazfor-kayit-yerlestir
                   else
                      move dokumer-400 to liste-rec
                   end-if
                   if grafik-yazici
                      add 1 to satir
                      if dokumer-20-ekran-yazma
                         perform soldan-saga-ciz
                         initialize liste-rec
                      end-if
                      if yazfor-kere > 0 and yazfor-kere numeric
                         perform set-pen-width-0
                         perform set-brush-light-gray
                         initialize wprtdata-draw
                         move 2.04                  to wprtdata-draw-start-x
                         move satir                 to wprtdata-draw-start-y
                         move link-liste-sutun-sayi to wprtdata-draw-stop-x
                         move satir                 to wprtdata-draw-stop-y
                         add 1                      to wprtdata-draw-stop-y
                         perform kutu-ciz
                         perform set-brush-null
                         perform set-pen-width-3
                      end-if
                      move 4 to sutun
                      perform set-cursor
                      inspect liste-rec replacing all dokumer-detay-kolon-ayirici
                                        by space
                      write liste-rec before advancing 1 line
                   else
                      write liste-rec 
                   end-if
                   add 1 to yazfor-kayit-sayi
          end-evaluate
          if dokumer-20(7:1) <> space 
             perform yazfor-after-0-alt-cizgi
          end-if
          if yazfor-kere numeric and 
             yazfor-kere > 0
                    perform yazfor-after-0
          end-if
          if dokumer-20(5:1) = "P"
             perform yazfor-baslik-at
          end-if
          if dokumer-20(5:1) = "L"
             if grafik-yazici
                move 1 to satir
             end-if
             initialize liste-rec
             write liste-rec after page
          end-if
          if dokumer-oto-sayfa-basi-yap
             if link-liste-satir-sayi > 0
                if link-liste-satir-sayi < yazfor-kayit-sayi
                   perform yazfor-baslik-at
                end-if
             else
                if dokumer-oto-sayfa-satir < yazfor-kayit-sayi
                   perform yazfor-baslik-at
                end-if
             end-if
          end-if
     end-read
     end-perform.
     perform wait-wnd-destroy.

     perform iso-bos-yaz.
     perform iso-bilgileri-yaz.   ||| iso paragraf˝

     if yazfor-sayfa-basi = "E"
        initialize liste-rec
        write liste-rec after page
     end-if.
     close dokumer liste.
     initialize dokumer-islem-tipi.
*
 yazfor-after-0-alt-cizgi.
     perform varying i from 1 by 1 until i > wrk-dokumer-length
          move dokumer_20(7:1)  to dokumer-400(i:1)
     end-perform
     perform yazfor-kayit-yerlestir.
*
 yazfor-after-0.
     perform varying yazfor-after-i from 1 by 1 until yazfor-after-i > yazfor-kere
             if not grafik-yazici
                write liste-rec after 0
             end-if
     end-perform.
*
 yazfor-baslik-at.
     perform iso-bilgileri-yaz.
     initialize liste-rec yazfor-kayit-sayi
     write liste-rec after page
     if grafik-yazici
        perform genel-kutu-ciz
        move 1 to satir
     end-if
     add 1 to yazfor-sayfa
     if prosif-sayfa-numarasi = "1"
        move yazfor-sayfa to rapor-genel-sayfa
     end-if
     if genel-baslik-at <> "H"
        if grafik-yazici
           move 4 to sutun
           perform set-cursor
           write liste-rec from rapor-genel-baslik 
                before advancing 1 line
        else
           write liste-rec from rapor-genel-baslik
        end-if
        add 1 to yazfor-kayit-sayi
     end-if
     if grafik-yazici
        perform set-font-bold
     end-if
      if baslik-bosluk-sayi <> 0
        perform baslik-bosluk-yaz baslik-bosluk-sayi times
     end-if.
     perform varying i from 1 by 1 until i > yazfor-entry-baslik-sayi
             initialize liste-rec yazfor-kere
             if grafik-yazici
                add 1 to satir
                move 4 to sutun
                perform set-cursor
                write liste-rec from yazfor-entry-baslik-occ(i)
                                before advancing 1 line
             else
                write liste-rec from yazfor-entry-baslik-occ(i)
             end-if
             if yazfor-entry-baslik-kere(i) > 0
                move yazfor-entry-baslik-kere(i) to yazfor-kere
                perform yazfor-after-0
             end-if
             add 1 to yazfor-kayit-sayi
     end-perform.
     if grafik-yazici
        add 0.75     to satir
        perform soldan-saga-ciz
        move satir   to grafik-ilk-y
        subtract 0.75 from satir
     end-if
     perform varying i from 1 by 1 until i > yazfor-detay-baslik-sayi
             initialize liste-rec yazfor-kere
             if grafik-yazici
                add 1 to satir
                if yazfor-detay-baslik-basma(i) = "H"
                   initialize yazfor-detay-baslik-occ(i)
                   perform soldan-saga-ciz
                end-if
                move 4 to sutun
                perform set-cursor
                write liste-rec from yazfor-detay-baslik-occ(i)
                                before advancing 1 line
             else
                write liste-rec from yazfor-detay-baslik-occ(i)
             end-if
             if yazfor-detay-baslik-kere(i) > 0
                move yazfor-detay-baslik-kere(i) to yazfor-kere
                perform yazfor-after-0
             end-if
             add 1 to yazfor-kayit-sayi
     end-perform.
     if grafik-yazici
        perform set-font-normal
     end-if.
*
baslik-bosluk-yaz.
      add 1 to yazfor-kayit-sayi.
      initialize liste-rec 
       if grafik-yazici  
                    move 4 to sutun
                    add 1 to satir
                    perform set-cursor 
                    write liste-rec before advancing 1 line
                    else
                   write liste-rec
                end-if
                .
*
 yazfor-kayit-yerlestir.
     initialize liste-rec yazfor-i yazfor-ii yazfor-iii.
     move 1 to yazfor-iii
     perform varying yazfor-i from 1 by 1 until yazfor-i > yazfor-kisit-detay-sayi
             move yazfor-kisit-index(yazfor-i)   to yazfor-ii
             move dokumer-rec(yazfor-bp(yazfor-ii):yazfor-au(yazfor-ii)) to liste-rec(yazfor-iii:yazfor-au(yazfor-ii))
             if grafik-yazici and yazfor-i <= yazfor-kisit-detay-sayi
                if not dokumer-grf-ust-alt-cizgi-yok
                   perform ustten-alta-ciz
                end-if
             end-if
             add yazfor-au(yazfor-ii)            to yazfor-iii
     end-perform.
*
 yazfor-detay-al.
     initialize i ii yazfor-i.
     inspect dokumer-rec tallying yazfor-detay-sayi
             for all dokumer-detay-kolon-ayirici.
     perform varying i from function length(dokumer-rec) by -1 until i = 21
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move i to yazfor-son-yer
                exit perform
             end-if
     end-perform.
     move 0  to yazfor-ii
     move 1  to yazfor-i
     move 22 to yazfor-bp(yazfor-i)
     perform varying i from 22 by 1 until i > yazfor-son-yer
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move ii to yazfor-au(yazfor-i)
                add  1  to yazfor-au(yazfor-i)
                move 0  to ii
                add  1  to yazfor-i
                move 0  to yazfor-ii
             else
                add 1   to ii yazfor-ii
                if yazfor-ii = 1
                   move i     to yazfor-bp(yazfor-i)
                end-if
             end-if
     end-perform.
*     display message box 
*            "1-> ",yazfor-bp(1),"    ",yazfor-au(1),new-line,
*            "2-> ",yazfor-bp(2),"    ",yazfor-au(2),new-line,
*            "3-> ",yazfor-bp(3),"    ",yazfor-au(3),new-line,
*            "4-> ",yazfor-bp(4),"    ",yazfor-au(4),new-line,
*            "5-> ",yazfor-bp(5),"    ",yazfor-au(5),new-line,
*            "6-> ",yazfor-bp(6),"    ",yazfor-au(6),new-line,
*            "7-> ",yazfor-bp(7),"    ",yazfor-au(7),new-line,
*            "8-> ",yazfor-bp(8),"    ",yazfor-au(8),new-line,
*            "9-> ",yazfor-bp(9),"    ",yazfor-au(9),new-line.
     
 dokumer-grid-proc.
     open i-o kvkky            |kvkkk 3

     perform wait-wnd-create.
     move 1 to ref-baslik-yaz
     open input dokumer.
     if filtrede
        open i-o filtre mass-update
     end-if
     initialize grid0-degiskenler fs-dokumer kayit-sayi
                dokumer-narg-degiskenler xdokumer-400.
     perform with test after until fs-dokumer = "10"
     initialize dokumer-rec
     read dokumer next no lock end move "10" to fs-dokumer
     not at end
          evaluate dokumer-20(1:1)
             when "W"
                   string xdokumer-400
                          dokumer-400 delimited by "    "
                          "-"    delimited by size 
                          isyeri-adres-tasi delimited by size 
                   into xdokumer-400
                   modify window form0-handle,
                          title = xdokumer-400 
 
             when "B"
                   |/////"DOKUMER"
                   if ref-baslik-yaz = 1 and ONKPARA-REFERANS-VAR = 1
                           perform fiyat-oda-ref-after
                           add 1 to grid0-entry-baslik-sayi
                           move ref-baslik-detay to grid0-entry-baslik-occ(grid0-entry-baslik-sayi)
                   end-if
                   add 1 to grid0-entry-baslik-sayi
                   if grid0-entry-baslik-sayi < 8
                      move dokumer-400     to grid0-entry-baslik-occ(grid0-entry-baslik-sayi)
                   end-if
             when "O"
                   display acc-baslik
                   move dokumer-400  to dokumer-ozellikler-rec
             when "D"               
                   evaluate dokumer-20(2:1)
                       when 1 
                            perform grid0-detay-al
                            perform varying i from 1 by 1 until i > grid0-detay-sayi
                                    if i <= 50
                                       move dokumer-align(i)   to grid0-align(i)
                                    end-if
                            end-perform
                            modify grid0,
                                   data-columns    = 0
                                   display-columns = 0
                                   reset-grid      = 1
                                   mass-update     = 1 
                            initialize i ii grid0-i grid0-ii grid0-kisit-detaylar
                                   grid0-kisit-detay-sayi
                            perform varying i from 1 by 1 until i > grid0-detay-sayi
                                   if prosif-detaylar(i:1) = "1" or
                                      i > 50
                                      add 1           to grid0-kisit-detay-sayi
                                      move i          to grid0-kisit-index(grid0-kisit-detay-sayi)
                                      add grid0-au(i) to grid0-virtual-width
                                      add 1           to grid0-virtual-width
                                   end-if
                            end-perform
                            modify grid0,
                                  display-columns = 1 
                                  data-columns    = 1
                            move 1 to grid0-iii iii
                            perform varying i from 1 by 1 until i = grid0-kisit-detay-sayi
                                    move grid0-kisit-index(i) to grid0-ii
                                    add  grid0-au(grid0-ii)   to grid0-iii
                                    modify grid0,
                                           data-columns    = grid0-iii  + iii
                                           display-columns = grid0-iii  + iii
                                           alignment       = grid0-align(grid0-ii) 
                                           centered-headings
                                    add  1 to iii
                            end-perform
                            modify grid0,
                                   x = grid0-kisit-detay-sayi
                                   alignment = grid0-align(grid0-kisit-detay-sayi)
                            inspect dokumer-400 replacing all 
                                    dokumer-detay-kolon-ayirici
                                    by space
                       when 2 
                            if dokumer-20(5:1) <> "-"
                               modify grid0,
                                      num-col-headings = 2
                            end-if
                   end-evaluate
                   if dokumer-20(5:1) = "-"
                      exit perform cycle
                   end-if
                   perform grid-kayit-yerlestir
                   perform grid-kayit-yerlestir2
                   modify grid0,
                           record-to-add(my_record_area)
                           virtual-width grid0-virtual-width
                   add 1 to kayit-sayi 
                   perform grid-color-set
             when other
                   if dokumer-20(5:1) = "-"
                      exit perform cycle
                   end-if

*/filtre islemi
                   if filtrede
                      perform filtre-kontrol  
                      if grid-flt-cikma
                         exit perform cycle
                      end-if
                   end-if
*/suz islemi
                   if suzde
                      perform suz-kontrol
                      if grid-suz-cikma
                         exit perform cycle
                      end-if
                   end-if

                   perform grid-kayit-yerlestir
                   modify grid0,record-to-add(my-record-area)
                   add 1 to kayit-sayi  
                   perform grid-color-set
          end-evaluate
     end-read
     end-perform.

     modify grid0,
            row-headings
            visible     = 1
            mass-update = 0. 

     close dokumer.
     if filtrede
        close filtre
     end-if
     if suzde 
        perform sutun-bilgiler-ekle
        move x"ff"         to suz-buffer(function length(suz-buffer):1)
        modify grid0
               insertion-index = 2
               record-to-add(suz-buffer)
               y = 2 
              row-color = 480
              not row-headings
     end-if
     perform wait-wnd-destroy.
     initialize dokumer-islem-tipi
     close kvkky.
*
 grid-kayit-yerlestir.
     initialize my-record-area i ii iii.
     move 1 to iii
     perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi
             move grid0-kisit-index(i)      to ii
             move dokumer-rec(grid0-bp(ii):grid0-au(ii)) to my-record-area(iii:)

             move dokumer-rec(grid0-bp(ii):grid0-au(ii)) 
                  to my-record-area(iii:)

             if wrk-dokumer-rec = spaces 
                move dokumer-rec to wrk-dokumer-rec 
             end-if
             if k-kvkk-yetki = "K"
                perform kvkk-kontrol
             end-if

             move iii                 to grid0-kisit-bp(i)
             move grid0-au(ii)        to grid0-kisit-au(i)
             add  grid0-au(ii)        to iii
             add  1                   to iii
     end-perform.
*
*
 grid-color-set.
     evaluate dokumer-20(3:1)
         when "A"
             
              move dokumer-400(grid0-son-yer - grid0-space:3) to 
                                               grid0-renk
                                               grid0-hidden-renk
              modify grid0(kayit-sayi),
                     row-color   = grid0-renk
*                     hidden-data = grid0-hidden-renk
         when "C"
              initialize grid0-hidden-data-renk i ii iii
              move dokumer-400(grid0-son-yer - grid0-space:3) to 
                                               grid0-renk
                                               grid0-hidden-renk
              perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi
                      if dokumer-20(3:1) = "C"
                         move grid0-kisit-index(i) to ii
                         compute iii = 3 + (3 * (ii - 1))
                         move dokumer-400(grid0-son-yer - grid0-space:iii) 
                              to grid0-renk grid0-hidden-renk  
                      end-if
                      modify grid0(kayit-sayi,i)
                             cell-color  = grid0-renk
                             hidden-data = grid0-hidden-data-renk
              end-perform
     end-evaluate.
*
 grid0-detay-al.
     initialize i ii grid0-i.
     inspect dokumer-rec tallying grid0-detay-sayi
             for all dokumer-detay-kolon-ayirici.
     perform varying i from function length (dokumer-rec)  by -1 until i = 21
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move i to grid0-son-yer
                exit perform
             end-if
     end-perform.
     move 0  to grid0-ii
     move 1  to grid0-i     
     move 22 to grid0-bp(grid0-i)
     perform varying i from 22 by 1 until i > grid0-son-yer
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move ii to grid0-au(grid0-i)
                move 0  to ii
                add  1  to grid0-i
                move 0  to grid0-ii
             else
                add 1   to ii grid0-ii
                if grid0-ii = 1
                   move i     to grid0-bp(grid0-i)
                end-if
             end-if
     end-perform.
     perform varying i from 1 by 1 until i > grid0-detay-sayi
             move dokumer-rec(grid0-bp(i):grid0-au(i)) to 
                  grid0-detay-adi(i)
     end-perform.
*     display message box 
*            "1-> ",grid0-bp(1),"    ",grid0-au(1),new-line,
*            "2-> ",grid0-bp(2),"    ",grid0-au(2),new-line,
*            "3-> ",grid0-bp(3),"    ",grid0-au(3),new-line,
*            "4-> ",grid0-bp(4),"    ",grid0-au(4),new-line,
*            "5-> ",grid0-bp(5),"    ",grid0-au(5),new-line,
*            "6-> ",grid0-bp(6),"    ",grid0-au(6),new-line,
*            "7-> ",grid0-bp(7),"    ",grid0-au(7),new-line,
*            "8-> ",grid0-bp(8),"    ",grid0-au(8),new-line,
*            "9-> ",grid0-bp(9),"    ",grid0-au(9),new-line.
     
*
 Form0-Aft-Initdata.
     initialize wrk-dokumer-rec 
        call "w$menu" using wmenu-enable,form0-mn-1-handle,1001 end-call
        call "w$menu" using wmenu-enable,form0-mn-1-handle,1002 end-call.
        call "w$menu" using wmenu-enable,form0-mn-1-handle,1003 end-call
        call "w$menu" using wmenu-show,form0-mn-1-handle end-call.
*********************************************************
*/ Salt okunur
     move 1 to salt-okunur
*********************************************************
     modify window form0-handle,action = action-maximize.
     evaluate true
        when dokumer-grid
             perform dokumer-grid-proc
        when dokumer-yazici-format
             perform dokumer-yazici-format-proc
     end-evaluate.
      perform kullandi.
*
 Form0-Pb-1-Ev-Cmd-Clicked.
     perform ole-excel-proc.
*
 Form0-Mn-1-MI-Detayayarlari-Link.
     perform Acu-Form1-Routine.
*
 Form1-Aft-Initdata.
     open i-o kvkky kllnc                                    |kvkkk 1
     initialize kllnc-rec 
     move k-kodu-tasi to k-kodu 
     read kllnc no lock invalid
          continue
     end-read 
     modify grid1,
            reset-grid  = 1 
            mass-update = 1
     move "X"      to gd-1-col-1
     move "Detay " to gd-1-col-2
     modify grid1,
            record-to-add(grid1-record-data)
     perform prosif-oku.
     move 1 to ii
     perform varying i from 1 by 1 until i > grid0-detay-sayi
             initialize grid1-record-data
             move grid0-detay-adi(i)    to gd-1-col-2
             if gd-1-col-2 = spaces
                move "_" to gd-1-col-2
             end-if
             modify grid1,
                    record-to-add(grid1-record-data)
             add 1 to ii
             if i <= 50
                if prosif-detaylar(i:1) = "1"
                   modify grid1(ii),
                          x = 1 
                          bitmap          = check-bmp
                          bitmap-width    = 16
                          bitmap-number   = 2
                          bitmap-trailing = 1
                          hidden-data     = "1"
                else
                   modify grid1(ii),
                          x = 1 
                          bitmap          = check-bmp
                          bitmap-width    = 16
                          bitmap-number   = 1
                          bitmap-trailing = 1
                          hidden-data     = "0"
                end-if
             end-if

             perform grid-baslik-kvkk-kontrol         |kvkkk 2

     end-perform.
     modify grid1,
            mass-update = 0
     close kvkky kllnc.
*
 grid1-Ev-Other.
     evaluate event-type
         when msg-begin-entry
              move event-action-fail  to event-action
              inquire grid1,
                      cursor-y in i
              evaluate event-data-1
                  when 1
                  when 2
                       inquire grid1(i,1),
                               hidden-data in dummy-1
                       if dummy-1 = "1"
                       modify grid1(i),
                              x = 1 
                              bitmap          = check-bmp
                              bitmap-width    = 16
                              bitmap-number   = 1
                              bitmap-trailing = 1
                              hidden-data     = "0"
                       else
                       modify grid1(i),
                              x = 1 
                              bitmap          = check-bmp
                              bitmap-width    = 16
                              bitmap-number   = 2
                              bitmap-trailing = 1
                              hidden-data     = "1"
                       end-if
                  when 3   
                       if k-kvkk-yetki = " "  
                          perform kvkk-tikle
                       else 
                          display message box "Kvkk yetkilisi degilsiniz.."
                       end-if
              end-evaluate 
     end-evaluate.
*
 Form1-Ex-Other.
     evaluate key-status
          when 2
               initialize i ii iii
               perform varying i from 1 by 1 until i > grid0-detay-sayi
                       move i to ii
                       add 1 to ii
                       inquire grid1(ii,1),
                               hidden-data in dummy-1
                       if dummy-1 = "1"
                          add 1 to iii
                       end-if
               end-perform
               if iii < 2
                  display message box 
                          "Rapor detay ayarlarinda en az 2 alanin secili",new-line
                          "olmasi gerekmektedir"
                          icon mb_error_icon
                          title "Hata"
                          exit paragraph
               end-if
               perform kaydet-soru
               if not soru-evet
                  exit paragraph
               end-if
               open i-o prosif
               initialize prosif-rec
               move k-kodu-tasi         to prosif-kim
               move called-program      to prosif-cob
               move "D"                 to prosif-tipi
               read prosif no lock invalid
                    move all "1" to prosif-detaylar prosif-genel-ayarlar
                    write prosif-rec invalid
                          rewrite prosif-rec end-rewrite
                   end-write
               end-read
               perform varying i from 1 by 1 until i > grid0-detay-sayi
                       move i to ii
                       add 1  to ii
                       inquire grid1(ii,1),
                               hidden-data in dummy-1
                       if i <= 50
                          move dummy-1 to prosif-detaylar(i:1)
                       end-if
               end-perform
               rewrite prosif-rec invalid
                       write prosif-rec end-write
               end-rewrite
               close prosif
               perform Dokumer-grid-proc
               set exit-pushed to true
     when 1001
     when 1002
     when 1003
          continue
     end-evaluate.
*
 Form0-Mn-1-MI-Genelraporayarlari-Link.
     perform Acu-Form4-Routine.
     
*
 Form4-Bef-Create.
     perform prosif-oku.
*
 Form4-Ex-Other.
     evaluate key-status
          when 2 
               perform kaydet-soru
               if not soru-evet
                  exit paragraph
               end-if
               open i-o prosif
               rewrite prosif-rec invalid
                       write prosif-rec end-write
               end-rewrite
               close prosif
     end-evaluate.
*
 Form0-Mn-1-MI-YeniaramatF6-Link.
     perform Acu-Form3-Routine.
     .
*
 Form0-Mn-1-MI-TekrararatF3-Link.
     perform Acu-Form3-Routine.
     .
*
 Form3-Aft-Initdata.
     modify combo3-arama,
            reset-list  = 1 
            mass-update = 1
     initialize arabul-2
     move "00-Tum sutunlar ..."  to combo3-arama-value
     modify combo3-arama,
            item-to-add(combo3-arama-value)
     perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi
             add 1 to arabul-2
             move arabul-2     to combo3-arama-value
             move "-"          to combo3-arama-value(3:)
             inquire grid0(1,i),
                     cell-data in combo3-arama-value(4:)
             modify combo3-arama,
                     item-to-add(combo3-arama-value)
     end-perform.
     move "00-Tum sutunlar ..."  to combo3-arama-value
     modify combo3-arama,
            mass-update = 0
            value = combo3-arama-value.
     if arabul-yeni-arama
        modify form3-pb-1,enabled = true
        modify form3-pb-2,enabled = false
        modify form3-pb-3,enabled = true
        initialize arabul-accept
        modify combo3-filtre,value  = arabul-accept
                      enabled = true
     end-if.
     if arabul-tekrar-arama
        modify form3-pb-1,enabled = false
        modify form3-pb-2,enabled = true
        modify form3-pb-3,enabled = false
        modify combo3-filtre,value   = arabul-accept
     end-if.
     modify form3-cb-2,value = 1
     modify form3-cb-3,value = 1.
*
 Form3-Ex-Other.
     evaluate key-status
          when 3
               inquire combo3-filtre,value in arabul-accept
               if arabul-accept = spaces 
                  move 4 to accept-control
                  move 6 to control-id
                  exit paragraph
               end-if
               set arabul-tekrar-arama to true
               inquire grid0,
                    search-options in grid-search-options
               perform form3-arama-set-et
               perform ara-bul
          when 6
               inquire combo3-filtre
                       value in arabul-accept
               if arabul-accept = spaces
                  move 4 to accept-control
                  move 5 to control-id
                  display omitted beep
                  exit paragraph
               end-if
               initialize arabul-degiskenler
               set arabul-yeni-arama to true
               move 1 to arabul-x arabul-y
               inquire combo3-filtre,
                       value in arabul-accept
               modify combo3-filtre,
                       item-to-add(arabul-accept)
               perform form3-arama-set-et
               move 1 to arabul-x arabul-y
               perform ara-bul
               set exit-pushed to true
     end-evaluate.
*
 form3-arama-set-et.
*/ buyuk kucuk harf eslestir
     inquire form3-cb-1,value in grid-search-case-flag
*/ ileri dogru arama
     inquire form3-cb-2,value in arabul-temp
     if arabul-temp = 1
        set grid-search-forwards to true
     end-if.
*/ arama bittiginde basa don
     inquire form3-cb-3, value in arabul-temp
     if arabul-temp = 1 
        move 0 to grid-search-wrap-flag
     else 
        move 1 to grid-search-wrap-flag
     end-if.
*/ simdikini atla
     set grid-search-skip-current to true
*/ sadece tam sozcukler mi bulunsun ?
     inquire form3-cb-4,value in arabul-temp
     if arabul-temp = 1
        set grid-search-match-all to true
     else
        set grid-search-match-any to true
     end-if.
     inquire combo3-arama,value in grid-search-column.
     modify grid0,
            search-options =  grid-search-options.
     
 ara-bul.
     modify grid0(arabul-y,arabul-x),
            search-options = grid-search-options
            search-text    = arabul-accept,
            giving           arabul-sonuc.
     if arabul-sonuc = 0
        display message box
                "Aranilan Kelime : ",arabul-accept,new-line,
                "Rapor Icinde Bulunamadi ..."
                icon mb_warning_icon
                type mb_ok
                title "Bilginize ..."
        initialize arabul-degiskenler
        set arabul-yeni-arama to true
        exit paragraph
     end-if.
     inquire grid0,x in arabul-x 
                   y in arabul-y
                    
     modify grid0,
            cursor-x = arabul-x
            cursor-y = arabul-y.
*
 grid0-Ex-Other.
     perform kullandi.
     evaluate key-status
         when 4
         when 5
         when 7
         when 8
              perform narg-islemler
         when 3
              perform Form3-Ex-Other
         when 2
              perform acu-form3-routine
              move 4 to accept-control
              move 2 to control-id

         when 5005
              perform filtre-uygula
         when 5006
              perform dokumer-grid-proc
         when 5007
              perform suz-uygula
         when 5008
              perform grup-uygula
         when 5009
              perform doksal-at
         when other
              perform narg-islemler
     end-evaluate.
 prosif-oku.
     open i-o prosif.
     initialize prosif-rec
     move k-kodu-tasi         to prosif-kim
     move called-program      to prosif-cob
     move "D"                 to prosif-tipi
     read prosif no lock invalid
          move all "1" to prosif-detaylar prosif-genel-ayarlar
          write prosif-rec invalid
                rewrite prosif-rec end-rewrite
          end-write
     end-read
 
     if prosif-sayfa <> spaces
          move prosif-sayfa to cmb-sayfa
     else
          move "Y"          to cmb-sayfa
     end-if
     if prosif-row-height <> zeroes
          move prosif-row-height to cmb-row
     else
          move " "               to cmb-row
     end-if
     if prosif-size <> zeroes and prosif-size <> spaces
          move prosif-size to cmb-size
     else
          move "10"         to cmb-size
     end-if

     close prosif.
 iso-icin-prosif-oku.
     open i-o prosif.
     initialize prosif-rec
     move called-program      to prosif-cob
     move "I"                 to prosif-tipi
     read prosif no lock invalid
          continue
     not invalid
          move prosif-iso-rapor-adi                 to iso-rapor-adi
          move prosif-iso-rev-no                    to iso-rev-no
          move prosif-iso-rev-yil                   to iso-eyil
          move prosif-iso-rev-ay                    to iso-eay 
          move prosif-iso-rev-gun                   to iso-egun
          move iso-etarih                           to iso-rev-tar 
     end-read.
     close prosif.
 wait-wnd-create.
     display floating window    
             handle in wait-handle
             title "Rapor Hazirlaniyor ..."
             size 50
             lines 10
             background-low
             user-white
             color 65793
             font traditional-font
     display label "Lutfen Bekleyiniz ..." transparent
             color 2 line 5 col 25 font traditional-font.
     display Bitmap, 
        COL 1.50, LINE 1.50, LINES 107, SIZE 175, 
        BITMAP-HANDLE cark-jpg, BITMAP-NUMBER 1, 
        BITMAP-START 1, BITMAP-End 4, BITMAP-TIMER 25, ID IS 3.
 wait-wnd-destroy.
     close window wait-handle.
*
 Form2-Ex-Other.
     evaluate key-status
         when 96
              move event-action-fail to event-action
         when 27
              set exit-pushed to true
         when 29
              set exit-pushed to true
     end-evaluate.
*
 Form0-Mn-1-MI-Farklikaydet-Link.
     initialize opensave-data opensave-status
     string 
     "Asya-Soft rapor dosyasi (*.ard)|*.ard|" delimited by size
     "Excel Calisma sayfasi (*.xls)|*.xls|" delimited by size
     "Web sayfasi (*.htm)|*.htm"  delimited by size
               into opnsav-filters
     move "ard"           to opnsav-default-ext
     call "c$opensavebox" using opensave-save-box
                                opensave-data
                          giving opensave-status
     end-call.
     if opensave-status <> 1 
        exit paragraph.
****************KONTROL KOY ard excel web icin
     if is-remote
        accept zaman from time
        move all low-values to seq-adres
        string seq-adres
               "/asya/ytl/liste/ard" delimited by low-values
               zaman delimited by low-values
               into seq-adres
        inspect seq-adres replacing all low-values by spaces
     else
        move opnsav-filename      to seq-adres
        inspect seq-adres replacing  trailing spaces by low-values
     end-if

     open output seq
     open input dokumer
     perform with test after until fs-dokumer = "10"
     initialize dokumer-rec
     read dokumer next no lock end move "10" to fs-dokumer
     not at end 
          initialize seq-rec
          move dokumer-rec      to seq-rec
          write seq-rec
     end-read
     end-perform
     close dokumer
     close seq
     if is-remote
        move all low-values to tofile
        inspect opnsav-filename replacing trailing spaces by low-values
        inspect seq-adres replacing trailing spaces by low-values
        string tofile
               "@[DISPLAY]:" delimited by low-values
               opnsav-filename delimited by low-values
               into tofile
        call "c$copy" using seq-adres tofile
        delete file seq
     end-if
     string seq-adres," ","dosyasi kaydedildi ..."
            delimited by low-value into seq-adres
     display message box seq-adres
             title "Bilginize ...".
*
*
 Form0-Mn-1-MI-Yaziciayarlari-Link.
     call "win$printer" using winprint-setup  
          giving winprinter-status
     end-call.
*
 Form0-Mn-1-MI-Yazdur-Link.
     perform Dokumer-Yazici-Format-Proc.
*
 Form0-Mn-1-MI-Ac-Link.
     initialize opensave-data opensave-status
     move "Asya-Soft Rapor Dosyasi (*.ard)|*.ard"
          to opnsav-filters
     move "ard"       to opnsav-default-ext
     call "c$opensavebox" using opensave-open-box
                                opensave-data
                          giving opensave-status
     end-call.
     if opensave-status <> 1 
        exit paragraph.
     inspect opnsav-filename replacing trailing spaces by low-values
     move opnsav-filename     to dokumer-dosya seq-adres.
     move zeroes to fs-seq
     open input seq.
     if fs-seq <> "00"
        display message box 
                seq-adres, " dosyasi bulunamadi ..."
                icon mb_error_icon
                title "Dosya Acma Hatasi"
                exit paragraph.
     close seq.
     perform Dokumer-Grid-Proc.
*
 Form0-Mn-1-MI-Saltokunur-Link.
     if salt-okunur = 1
        move 0 to salt-okunur
        call "w$menu" using wmenu-uncheck,form0-mn-1-handle,1030 end-call
     else
        move 1 to salt-okunur
        call "w$menu" using wmenu-check,form0-mn-1-handle,1030 end-call
     end-if.
*
 grid0-Ev-Other.
     evaluate event-type
          when msg-begin-entry
               evaluate event-data-2
               when 1
                    exit paragraph
               when 2
                    if not suzde
                       if salt-okunur = 1
                         perform isaretle
                          move event-action-fail to event-action
                        end-if
                    end-if
               when other
                    if salt-okunur = 1
                       perform isaretle
                       move event-action-fail to event-action
                    end-if
               end-evaluate
          when msg-finish-entry
               inquire grid0,
                       finish-reason in grid-finish-reason
               if grid-finish-reason-enter
                  inquire grid0(2),
                          record-data in suz-buffer
                  perform dokumer-grid-proc
               else
                  modify grid0(2),
                         record-data = suz-buffer
               end-if
          when msg-heading-dblclick
               perform sort-proc
          when msg-heading-clicked
               if filtrede
                  move event-data-1                 to grid-flt-kolon
                  perform filtre-load
               end-if
     end-evaluate.
*
 Form0-Mn-1-MI-Fontsecimi-Link.
     initialize wfont-data wfont-face-data font-handle.
     call "w$font" using wfont-choose-font font-handle wfont-data
          giving font-status.
     if font-status < 1 
        exit paragraph.
     call "w$font" using wfont-get-font,font-handle,wfont-data
          giving font-status.
     if font-status < 1   
        exit paragraph.
     modify grid0,
            mass-update = 1
            font        = font-handle
            mass-update = 0.
*
 Form0-Mn-1-MI-Dosyaa-Link.
     if yazdirma-kaynagi <> 1 
        move 1 to yazdirma-kaynagi
        call "w$menu" using wmenu-check,form0-mn-1-handle,1032
        call "w$menu" using wmenu-uncheck,form0-mn-1-handle,1033
     end-if.
*
 Form0-Mn-1-MI-Hucre-Link.
     if yazdirma-kaynagi <> 2 
        move 2 to yazdirma-kaynagi
        call "w$menu" using wmenu-uncheck,form0-mn-1-handle,1032
        call "w$menu" using wmenu-check,form0-mn-1-handle,1033
     end-if.
*
*
 excel-dosya-kayit-yerlestir.
     initialize liste-rec yazfor-i yazfor-ii yazfor-iii.
     move 1 to yazfor-iii
     perform varying yazfor-i from 1 by 1 until yazfor-i > yazfor-kisit-detay-sayi
             move yazfor-kisit-index(yazfor-i)   to yazfor-ii
             move dokumer-rec(yazfor-bp(yazfor-ii):yazfor-au(yazfor-ii)) to
                  liste-rec(yazfor-iii:yazfor-au(yazfor-ii))
             move "|"                            to liste-rec(yazfor-iii+yazfor-au(yazfor-ii) - 1:1)
             add yazfor-au(yazfor-ii)            to yazfor-iii
     end-perform.
*
 excel-dosya-detay-al.
     initialize i ii yazfor-i.
     inspect dokumer-rec tallying yazfor-detay-sayi
             for all dokumer-detay-kolon-ayirici.
     perform varying i from function length (dokumer-rec)  by -1 until i = 21
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move i to yazfor-son-yer
                exit perform
             end-if
     end-perform.
     move 0  to yazfor-ii
     move 1  to yazfor-i
     move 22 to yazfor-bp(yazfor-i)
     perform varying i from 22 by 1 until i > yazfor-son-yer
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move ii to yazfor-au(yazfor-i)
                add  1  to yazfor-au(yazfor-i)
                move 0  to ii
                add  1  to yazfor-i
                move 0  to yazfor-ii
             else
                add 1   to ii yazfor-ii
                if yazfor-ii = 1
                   move i     to yazfor-bp(yazfor-i)
                end-if
             end-if
     end-perform.
*
 sort-proc.
     initialize sort-degiskenler.
     inquire grid0,
             x in sort-i,
             hidden-data in sort-hidden-data,
             last-row in sort-kayit-sayi.
     if sort-column not = 0
        modify grid0(1,sort-column),   
               bitmap = 0
     end-if
     move sort-i    to sort-column
     subtract 1 from sort-kayit-sayi
     if sort-kayit-sayi < 2
        exit paragraph.
     display floating window lines 05 size 30
             background-low,
             title "Siralaniyor ...",
             handle in bekle-handle
             font small-font,
     display label "Lutfen bekleyiniz" line 2 col 1 size 30
     center font small-font transparent color 5 
     display label "Bilgiler siralaniyor" line 4 col 1 size 30
     center font small-font transparent color 5
     evaluate true
          when sort-hidden-data = "A" 
               move "B" to sort-hidden-data
               move 2  to sort-bitmap-number
          when sort-hidden-data = "B"
               move "A" to sort-hidden-data
               move 1  to sort-bitmap-number
          when other 
               move "A" to sort-hidden-data
               move 1  to sort-bitmap-number
     end-evaluate.
     modify grid0,
            y = 1,
            x = sort-column,
            bitmap barra05-bmp
            bitmap-number = sort-bitmap-number
            bitmap-trailing = 1
            bitmap-width = 16
            hidden-data = sort-hidden-data.

*/ziver
     accept sirala-dosya from time.

     open output sirala close sirala 
     open i-o sirala bulk-addition.
     open input dokumer
     initialize fs-dokumer sort-i
     perform with test after until fs-dokumer = "10"
             initialize dokumer-rec
             read dokumer next no lock end move "10" to fs-dokumer
             not at end
                  initialize sirala-rec
                  add 1 to sort-i
                  move sort-i           to sirala-anahtar
                  evaluate dokumer-20(1:1)
                     when "W" move 001 to sirala-opcode
                     when "M" move 000 to sirala-opcode
                     when "B" move 002 to sirala-opcode
                     when "O" move 003 to sirala-opcode
                     when "D" move 004 to sirala-opcode
                     when other move 999 to sirala-opcode
                  end-evaluate
                  move grid0-kisit-index(sort-column)      
                       to ii
                  move dokumer-rec(grid0-bp(ii):grid0-au(ii)) 
                       to sirala-start
                  move dokumer-rec     to sirala-bilgi
                  write sirala-rec end-write
             end-read
     end-perform
        
     close sirala 
     close dokumer
     open input sirala
     initialize sirala-rec  fs-sirala
     move 1 to sort-i
*/once ilk satirlar aliniyor baslik WBO ....
     initialize sirala-rec
     start sirala key not < sirala-anahtar invalid
           continue
     not invalid
     initialize fs-sirala
     open output dokumer
     perform with test after until fs-sirala = "10"
     read sirala next no lock end move "10" to fs-sirala
     not at end
          if sirala-opcode = 999
             move "10" to fs-sirala
             exit perform
          else
             initialize dokumer-rec
             write dokumer-rec from sirala-bilgi
          end-if
     end-read
     end-perform
     end-start
     if sort-hidden-data = "A"
        move all low-values to sirala-kelime
        start sirala key > sirala-kelime invalid
              move "89" to fs-sirala
        end-start
     else
        move all high-values to sirala-kelime 
        start sirala key < sirala-kelime invalid
              move "89" to fs-sirala
        end-start
     end-if

     if fs-sirala not = 89 
     perform with test after until fs-sirala = "10"
           if sort-hidden-data = "A"
              read sirala next no lock end move "10" to fs-sirala end-read
           else
              read sirala backward no lock 
                  end move "10" to fs-sirala 
              end-read
           end-if
           if fs-sirala <> "10"
              if sirala-opcode = 999
                 move sirala-bilgi       to dokumer-rec
                 write dokumer-rec
              end-if
           end-if
     end-perform
     close dokumer
     end-if.
     close sirala.
     delete file sirala.
     perform Dokumer-grid-proc
     modify grid0,
            y = 1,
            x = sort-column,
            bitmap barra05-bmp
            bitmap-number = sort-bitmap-number

            bitmap-trailing = 1
            bitmap-width = 16
            hidden-data = sort-hidden-data.
     close window bekle-handle.
*
 Form0-Mn-1-SEPARATOR-6-Link.
     if yatay-cizgi = 1
        call "w$menu" using wmenu-uncheck,form0-mn-1-handle,1017 end-call
        move 0 to yatay-cizgi
        modify grid0,
               mass-update = 1 
               row-dividers = 0
               mass-update = 0 
     else
        call "w$menu" using wmenu-check,form0-mn-1-handle,1017 end-call
        move 1 to yatay-cizgi
        modify grid0,
               mass-update = 1 
               row-dividers = -1
               mass-update = 0
     end-if.
*
 Form0-Mn-1-SEPARATOR-7-Link.
     if dikey-cizgi = 1
        call "w$menu" using wmenu-uncheck,form0-mn-1-handle,1018 end-call
        move 0 to dikey-cizgi
        perform varying i from 1 by 1 until i > grid0-detay-sayi
        modify grid0(1,i),
               mass-update = 1
               column-dividers = 0
               mass-update = 0
        end-perform
     else
        call "w$menu" using wmenu-check,form0-mn-1-handle,1018 end-call
        move 1 to dikey-cizgi
        perform varying i from 1 by 1 until i > grid0-detay-sayi
        modify grid0(1,i),
               mass-update = 1
               column-dividers = -1
               mass-update = 0
        end-perform
     end-if.
*
 Form0-Mn-1-MI-Hakkinda-Link.
     display message box
             "Asya-Soft Winner Report Design & Preview Utility",new-line,
                                       new-line,
             "Report Designer 2.1/2011",new-line,
             "Report Engine   2003",new-line
             "Report Preview [Grp.] 1.0/2011",
             title "Hakkinda ...".






*

 Form0-Mn-1-MI-Gerial-Link.
     perform dokumer-grid-proc.
*
**********************************************
******************OLE*************************
**********************************************
 
 ole-excel-proc.

    if filtrede
       open i-o filtre mass-update
    end-if

    initialize ole-excel-degiskenler.
*/ ole create
    create  application    of excel 
            handle          in hexcelapp. 
    modify  hexcelapp
            @SheetsInNewWorkBook = 1.
*/ new sheet
    modify  hexcelapp       workbooks::add() 
            giving          hexcelwkb.
    inquire hexcelwkb       
            worksheets::item(1) in hexcelwks. 
*/ workbook ismi
*    modify  hexcelwks
*            @Name = "Deneme rapor adi".
*/ excel gozuksun 
    modify  hexcelapp
             @visible = 0.


    open input dokumer.
*/ frame degiskenleri
    initialize frame-degiskenler
    inquire grid0,
            last-row in frame-kayit-sayi
    move 20              to frame-win-line
    move 20              to frame-win-pos
    move "Bekleyiniz..." to frame-title
    perform frame-ac
    accept omitted before time 0
*/ grid0-degiskenler icin hafizaya put
*/ tekrar yeni degisken kullanmamak icin
*/ bitiste tekrar get
     call "m$alloc" using 
          function length(grid0-degiskenler),
          ole-excel-pointer
     end-call
     call "m$put" using 
          ole-excel-pointer,
          grid0-degiskenler,
          function length(grid0-degiskenler),
          1
     end-call.
     initialize grid0-degiskenler fs-dokumer.
     MOVE 1 TO ref-baslik-yaz
     perform with test after until fs-dokumer = "10"
     initialize dokumer-rec
     read dokumer next no lock end move "10" to fs-dokumer
     not at end
          evaluate dokumer-20(1:1)
             when "W"
                   inspect dokumer-400 replacing trailing 
                          spaces by low-values
                   modify  hexcelwks
                          @Name = dokumer-400(1:30)
             when "B"        
                   |/////EXCEL 1//////////////////////////////////////////
                   if ref-baslik-yaz = 1 and ONKPARA-REFERANS-VAR = 1
                           perform fiyat-oda-ref-after
                           add 1                    to ole-excel-satir 
                           move ref-baslik-detay    to ole-excel-bilgi
                           move 1                   to ole-excel-sutun
                           move ole-cyan            to ole-excel-color
                           set  ole-excel-font-bold to true
                           perform ole-excel-record-send
                   end-if
                   |////////////////////////////////////////////////////////////////////
                   add 1 to ole-excel-satir
                   move dokumer-400         to ole-excel-bilgi
                   move 1                   to ole-excel-sutun
                   move ole-cyan            to ole-excel-color
                   set  ole-excel-font-bold to true
                   perform ole-excel-record-send
             when "O"
                   perform sirket-bilgisi-yaz
                   add 1 to ole-excel-satir
                   evaluate ole-excel-satir
                   when 2
                     perform zaman-tarih-bilgileri                      
                   when 3
                     perform zaman-tarih-bilgileri                      
                   when 4
                     perform zaman-tarih-bilgileri
                   when 5
                     perform zaman-tarih-bilgileri
                   end-evaluate 
                   move 1                   to ole-excel-sutun
                   move ole-cyan            to ole-excel-color
                   set  ole-excel-font-bold to true
                   perform ole-excel-record-send
                   display acc-baslik
                   move dokumer-400  to dokumer-ozellikler-rec

             when "D"
                   evaluate dokumer-20(2:1)
                       when 1
                            perform ole-excel-detay-al
                            perform varying i from 1 by 1 until i > grid0-detay-sayi
                                    if i <= 50
                                       move dokumer-align(i)   to grid0-align(i)
                                    end-if
                            end-perform
                            initialize i ii grid0-i grid0-ii grid0-kisit-detaylar
                                   grid0-kisit-detay-sayi
                            perform varying i from 1 by 1 until i > grid0-detay-sayi
                                   if prosif-detaylar(i:1) = "1" or
                                      i > 50
                                      add 1           to grid0-kisit-detay-sayi
                                      move i          to grid0-kisit-index(grid0-kisit-detay-sayi)
                                      add grid0-au(i) to grid0-virtual-width
                                      add 1           to grid0-virtual-width
                                   end-if
                            end-perform
                            move 1 to grid0-iii iii
                            perform varying i from 1 by 1 until i = grid0-kisit-detay-sayi
                                    move grid0-kisit-index(i) to grid0-ii
                                    add  grid0-au(grid0-ii)   to grid0-iii
                                    add  1 to iii
                            end-perform
                            inspect dokumer-400 replacing all 
                                    dokumer-detay-kolon-ayirici
                                    by space
                   end-evaluate   
                   if dokumer-20(5:1) = "-"
                      exit perform cycle
                   end-if
                   add 1 to ole-excel-satir
                   perform ole-excel-kayit-yerlestir
                   add 1 to kayit-sayi
                   perform ole-excel-color-set
                   perform frame-goster
             when other
                   if dokumer-20(5:1) = "-"
                      exit perform cycle
                   end-if

****************************************************************************
*/filtre islemi
                   if filtrede
                      perform filtre-kontrol  
                      if grid-flt-cikma
                         exit perform cycle
                      end-if
                   end-if
*/suz islemi
                   if suzde
                      perform suz-kontrol
                      if grid-suz-cikma
                         exit perform cycle
                      end-if
                   end-if
****************************************************************************                  
                   add 1 to ole-excel-satir
                   perform ole-excel-kayit-yerlestir
                   add 1 to kayit-sayi
                   perform ole-excel-color-set
                   perform frame-goster
          end-evaluate
     end-read
     end-perform.
     close dokumer.
     if filtrede
        close filtre
     end-if
     perform frame-kapat.
     initialize dokumer-islem-tipi.
     
*     modify hexcelapp,@getsaveasfilename()
*          giving my-record-area
*     display message box my-record-area
     modify hexcelapp,
            @visible = 1.
     display message box 
             "Uygulamayi sonlandirmak icin Ok/Tamam butonunu seciniz",new-line,
             "Uygulama sonlandirilacaktir",
             title "Asya-Soft Excel Link/2003".
*/////////////////////////////////////////////
     modify  hexcelwkb,
             @close(0).
*////@CLOSE(1) oldugu zaman kilitleme yapar dikkat
     destroy hexcelwks. 
     destroy hexcelwkb. 
     modify  hexcelapp
             workbooks::close().
     modify  hexcelapp
             @quit(). 
     destroy hexcelapp.
     call "m$get" using 
          ole-excel-pointer,
          grid0-degiskenler
          function length(grid0-degiskenler)
          1
     end-call.
     call "m$free" using 
          ole-excel-pointer
     end-call.
*
 ole-excel-kayit-yerlestir.
     initialize my-record-area i ii iii.
     move 1 to iii ole-excel-sutun
     perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi
             move grid0-kisit-index(i)      to ii
             move dokumer-rec(grid0-bp(ii):grid0-au(ii)) to 
                  ole-excel-bilgi
             add  grid0-au(ii)        to iii
             add  1                   to iii
             initialize ole-excel-font-bold-eh
             if ole-excel-bilgi <> spaces 
                
                if ole-excel-bilgi(3:1)= "/" and 
                   ole-excel-bilgi(6:1)= "/" then
                   if not open-office
                      move ole-excel-bilgi(4:2) to tampon
                      move ole-excel-bilgi(1:2) to ole-excel-bilgi(4:2)
                      move tampon to ole-excel-bilgi(1:2)
                   end-if
                   
                 end-if
                perform ole-excel-record-send
             end-if
             add  1                   to ole-excel-sutun
     end-perform.
*
 ole-excel-color-set.
*     evaluate dokumer-20(3:1)
*         when "A"
*         when "C"
*              initialize grid0-hidden-data-renk i ii iii
*              move dokumer-400(grid0-son-yer - grid0-space:3) to 
*                                               grid0-renk
*                                               grid0-hidden-renk
*              perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi
*                      if dokumer-20(3:1) = "C"
*                         move grid0-kisit-index(i) to ii
*                         compute iii = 3 + (3 * (ii - 1))
*                         move dokumer-400(grid0-son-yer - grid0-space:iii) 
*                              to grid0-renk grid0-hidden-renk  
*                      end-if
*                      modify grid0(kayit-sayi,i)
*                             cell-color  = grid0-renk
*                             hidden-data = grid0-hidden-data-renk
*              end-perform
*     end-evaluate.
*
         .
 ole-excel-detay-al.
     initialize i ii grid0-i.
     inspect dokumer-rec tallying grid0-detay-sayi
             for all dokumer-detay-kolon-ayirici.
     perform varying i from function length (dokumer-rec)  by -1 until i = 21
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move i to grid0-son-yer
                exit perform
             end-if
     end-perform.
     move 0  to grid0-ii
     move 1  to grid0-i     
     move 22 to grid0-bp(grid0-i)
     perform varying i from 22 by 1 until i > grid0-son-yer
             if dokumer-rec(i:1) = dokumer-detay-kolon-ayirici
                move ii to grid0-au(grid0-i)
                move 0  to ii
                add  1  to grid0-i
                move 0  to grid0-ii
             else
                add 1   to ii grid0-ii
                if grid0-ii = 1
                   move i     to grid0-bp(grid0-i)
                end-if
             end-if
     end-perform.
     perform varying i from 1 by 1 until i > grid0-detay-sayi
             move dokumer-rec(grid0-bp(i):grid0-au(i)) to 
                  grid0-detay-adi(i)
     end-perform.
 ole-excel-record-send.
    inquire hexcelwks,
            @cells::@item(ole-excel-satir,ole-excel-sutun) = hrange
    inspect ole-excel-bilgi,
            replacing all high-values by space
                      all low-values  by space.
* TRANSLATE TO TURKISH CHARACTERS SETERELLEZI
*           piemci sorunsali
************ BUYUK KARAKTERLER
*x98 => b-y-k i
    inspect ole-excel-bilgi            
            converting x"98" to x"49"
*x9e => b-y-k s 
    inspect ole-excel-bilgi
            converting x"9E" to x"53"
*x99 => =
    inspect ole-excel-bilgi
            converting x"99" to x"4F"
*x9A => -
    inspect ole-excel-bilgi
            converting x"9A" to x"55"
*x9A => +
    inspect ole-excel-bilgi
            converting x"80" to x"43"
*x9A => yumusak G
    inspect ole-excel-bilgi
            converting x"A6" to x"47"
****** KUCUK KARAKTERLER
*x9A => yumusak G
    inspect ole-excel-bilgi
            converting x"A7" to x"67"
* kucuk i noktasizi
    inspect ole-excel-bilgi
            converting x"8D" to x"69"
* kucuk - 
    inspect ole-excel-bilgi
            converting x"81" to x"75"
* kucuk _ 
    inspect ole-excel-bilgi
            converting x"87" to x"63"
* kucuk s  
    inspect ole-excel-bilgi
            converting x"9F" to x"73"
* kucuk s  
    inspect ole-excel-bilgi
            converting x"94" to x"6F"
***********************************************
    if dokumer-narg-hesap-yer <> ole-excel-sutun
*    if genel-nokta-virgul = ","
      if k-ayrac-degistir = 1 
          inspect ole-excel-bilgi
                  converting "," to x"01"
          inspect ole-excel-bilgi
                  converting "." to ","
          inspect ole-excel-bilgi
                  converting x"01" to "."
       end-if
    end-if
*/ gonderilecek bilginin boyunu bul
    move 0 to ole-excel-size
    inspect ole-excel-bilgi(1:100) replacing trailing spaces by low-values
    inspect ole-excel-bilgi tallying ole-excel-size for all low-values
    compute ole-excel-size = 100 - ole-excel-size
    if ole-excel-size = 0
       move 1 to ole-excel-size
    end-if
    inspect ole-excel-bilgi replacing all low-values by spaces
    modify  hrange          
              @value = ole-excel-bilgi(1:ole-excel-size)
    if ole-excel-sutun <> 1 
       modify hrange          
              @EntireColumn::AutoFit()
    end-if
*/ BOLD 
    if ole-excel-font-bold 
        modify hrange,   
               @font::bold = 1
    end-if.
*/ yatay ve dikey cizgiler yok
*    modify  hrange  @Interior::Pattern = @xlSolid.
*/
*    if ole-excel-color <> 0
*       modify  hrange 
*               @Font::ColorIndex = ole-excel-color
*    end-if.
     destroy hrange.
*
 Form0-Pb-1a-Ev-Cmd-Clicked.
      perform csv-call.

*
 csv-call.
      initialize csvyap-link
      move called-program            to csvyap-link-called-program
      set dokumer-prog-csvyap        to true
      call dokumer-prog-call using csvyap-link
           on exception 
              perform callerr-proc
           not on exception
      cancel dokumer-prog-call
      end-call.
*
 HODO-Ev-Msg-Begin-Entry.
    evaluate event-data-2
    when 1
         if calisma-tipi = "T"
            set dokumer-ekran-text to true
         else
            set dokumer-grid       to true
         end-if
         move event-action-fail to event-action
         call "w$keybuf" using 1,x"1D" end-call
    when 2
         if calisma-tipi = "T"
            set dokumer-yazici-text   to true
         else
            set dokumer-yazici-format to true
         end-if
         move event-action-fail to event-action
         call "w$keybuf" using 1,x"1D" end-call
    when 3
         set dokumer-yazici-grafik to true
         move event-action-fail to event-action
         call "w$keybuf" using 1,x"1D" end-call
    when 4
         set dokumer-excel to true
         move event-action-fail to event-action
         call "w$keybuf" using 1,x"1D" end-call
    end-evaluate.
*
 Form2-Aft-Initdata.
*      modify hodo,
*
*             reset-grid = 1
*             mass-update = 1
*             record-to-add("E-Ekran","Y-Yazici","T-Text","G-Grafik Yazici","F-Fax","B-Fax Biriktiricisi").
*      modify hodo,
*             mass-update = 0.
***************GRAFIK YAZICI*********************
*
 kutu-ciz.
     move wprt-draw-rectangle to wprtdata-draw-shape.
     move wprtunits-cells     to wprtdata-draw-units.
     call "win$printer" using winprint-graph-draw
                              winprint-data
                        giving grafik-yazici-donus.


*
 cizgi-ciz.
     move wprt-draw-line      to wprtdata-draw-shape.
     move wprtunits-cells     to wprtdata-draw-units.
     call "win$printer" using winprint-graph-draw
                              winprint-data
                        giving grafik-yazici-donus.
*
 cizgi-ciz-pixel.
     move wprt-draw-line      to wprtdata-draw-shape.
     move wprtunits-pixels    to wprtdata-draw-units.
     call "win$printer" using winprint-graph-draw
                              winprint-data
                        giving grafik-yazici-donus.
*
 font-set.
     call "win$printer" using winprint-set-font
                              winprint-data
                        giving grafik-yazici-donus.
*
 set-cursor.
     initialize wprtdata-draw.
     move sutun           to wprtdata-draw-start-x.
     move satir           to wprtdata-draw-start-y.
     move wprtunits-cells to wprtdata-draw-units.
     call "win$printer" using winprint-set-cursor
                              winprint-data
                        giving grafik-yazici-donus.
*
 set-brush-gray.
      initialize wprtdata-brush.
      move wprt-brush-gray to wprtdata-brush-style.
      call "win$printer" using winprint-graph-brush
                               winprint-data
                         giving grafik-yazici-donus.
*
 set-brush-light-gray.
      initialize wprtdata-brush.
      move wprt-brush-ltgray to wprtdata-brush-style.
      call "win$printer" using winprint-graph-brush
                               winprint-data
                         giving grafik-yazici-donus.
*
 set-brush-null.
      initialize wprtdata-brush.
      move wprt-brush-null to wprtdata-brush-style.
      call "win$printer" using winprint-graph-brush
                               winprint-data
                         giving grafik-yazici-donus.
*
 set-pen-width-3.
*3 pixel geni–li-inde kalem yarat
      initialize wprtdata-pen.
      move wprt-pen-solid   to  wprtdata-pen-style.
      move 2                to  wprtdata-pen-width.
      call "win$printer" using winprint-graph-pen
                               winprint-data
                         giving grafik-yazici-donus.
 set-pen-width-0.
*0 pixel geni–li-inde kalem yarat
      initialize wprtdata-pen.
      move wprt-pen-null    to  wprtdata-pen-style.
      move 0                to  wprtdata-pen-width.
      call "win$printer" using winprint-graph-pen
                               winprint-data
                         giving grafik-yazici-donus.
*
 ustten-alta-ciz.
* cizgi ciz 
     initialize wprtdata-draw
     compute wprtdata-draw-start-x = 
             yazfor-iii + yazfor-au(yazfor-ii) + font-en
      
     move  wprtdata-draw-start-x  to wprtdata-draw-stop-x
     move grafik-ilk-y            to wprtdata-draw-start-y
     move  link-liste-satir-sayi  to wprtdata-draw-stop-y
     add 1                        to wprtdata-draw-stop-y
     perform cizgi-ciz.
 soldan-saga-ciz.
* cizgi ciz 
     initialize wprtdata-draw
     move 2                      to wprtdata-draw-start-x
     move link-liste-sutun-sayi  to wprtdata-draw-stop-x
     move satir                  to wprtdata-draw-start-y
     move satir                  to wprtdata-draw-stop-y
     perform cizgi-ciz.
*
 genel-kutu-ciz.
     initialize wprtdata-draw
     move 2                     to wprtdata-draw-start-x
     move 0.50                  to wprtdata-draw-start-y
     move link-liste-sutun-sayi to wprtdata-draw-stop-x
     move link-liste-satir-sayi to wprtdata-draw-stop-y
     add 3                      to wprtdata-draw-stop-y
     perform kutu-ciz.
*
 set-font-bold.
     initialize wfont-data
     move grafik-yazici-font-bold   to wprtdata-font 
     call "win$printer" using winprint-set-font
                              winprint-data .     
 set-font-normal.
     initialize wfont-data
     move grafik-yazici-font        to wprtdata-font 
     call "win$printer" using winprint-set-font
                              winprint-data .
 set-font-underline.
     initialize wfont-data
     move grafik-yazici-font-underline to wprtdata-font 
     call "win$printer" using winprint-set-font
                              winprint-data .     
*
*
 pb-grafik-yazici-Link.
     set grafik-yazici to true
     perform Dokumer-Yazici-Format-Proc.     
     .
*
 Form0-Pb-1aaa-Ev-Cmd-Clicked.
     perform Dokumer-Yazici-text-Proc.
     
     .
*
 hesaplari-sola-daya-print.
     initialize hesap-temp
     move 0 to hesap-sol-i
     inspect dokumer-rec(yazfor-bp(yazfor-ii):yazfor-au(yazfor-ii)) 
             tallying hesap-sol-i
             for all x"ff"
     if hesap-sol-i = 0
        move dokumer-rec(yazfor-bp(yazfor-ii):yazfor-au(yazfor-ii)) to
                             hesap-temp
        exit paragraph
     end-if

     initialize hesap-sol hesap-temp hesap-sol-ii
     move dokumer-rec(yazfor-bp(yazfor-ii):yazfor-au(yazfor-ii)) to
          hesap-sol

     perform varying hesap-sol-i
             from 1
             by 1
             until hesap-sol-i > yazfor-au(yazfor-ii)
             if hesap-sol(hesap-sol-i:1) <> x"ff"
                add 1 to hesap-sol-ii
                move hesap-sol(hesap-sol-i:1) to hesap-temp(hesap-sol-ii:1)
             end-if                                                    
     end-perform.


 hesaplari-sola-daya-ekran.
     initialize hesap-temp
     move 0 to hesap-sol-i
     inspect dokumer-rec(grid0-bp(ii):grid0-au(ii)) 
             tallying hesap-sol-i
             for all x"ff"
     if hesap-sol-i = 0
        move dokumer-rec(grid0-bp(ii):grid0-au(ii)) to
                             hesap-temp
        exit paragraph
     end-if

     initialize hesap-sol hesap-temp hesap-sol-ii
     move dokumer-rec(grid0-bp(ii):grid0-au(ii)) to
          hesap-sol

     perform varying hesap-sol-i
             from 1
             by 1
             until hesap-sol-i > grid0-au(ii) 
             if hesap-sol(hesap-sol-i:1) <> x"ff"
                add 1 to hesap-sol-ii
                move hesap-sol(hesap-sol-i:1) to hesap-temp(hesap-sol-ii:1)
             end-if                                                    
     end-perform.

*
 winprint-column-reset.
    call "win$printer" using winprint-clear-page-columns.
    call "win$printer" using winprint-clear-data-columns.
*
 winprint-column-set.
    move 0 to i
    perform varying yazfor-i 
            from 1 
            by 1 
            until yazfor-i > yazfor-kisit-detay-sayi
            move yazfor-kisit-index(yazfor-i)   to yazfor-ii

            initialize winprint-column
            move yazfor-bp(yazfor-ii)           to winprint-col-start
            subtract 20 from winprint-col-start
            move null                           to winprint-col-font
            move WPRTALIGN-NONE                 to winprint-col-alignment
            set  winprint-transparent           to true
            move wprtunits-cells to winprint-col-units
            call "win$printer" using winprint-set-page-column
                                     winprint-column

            add 1                      to i
            move yazfor-bp(yazfor-ii)  to ii
            subtract 22 from ii
            if i <> 1
               call "win$printer" using WINPRINT-SET-DATA-COLUMNS
                                        ii
            end-if

    end-perform.
    
     .

*********************** DOKUMCVS *****************************************
*
*
 filtre-uygula.
    inquire cb-filtre,
            value in cb-filtre-value.
    inquire grid6,
            size in dummy
    inquire form0-handle,
            size in yeni-sutun
            lines in yeni-lines
    compute yeni-lines = yeni-lines - 14.50 - 3

    if not filtrede
       compute yeni-sutun = yeni-sutun - 0.5 
       modify grid6,
              visible = false
       modify pb-filtre-uygula,
              visible = false
       modify grid0,
              size = yeni-sutun
              lines = yeni-lines
       perform dokumer-grid-proc
       exit paragraph
    end-if

    compute yeni-sutun = yeni-sutun - dummy - 0.5
    modify grid0,
           size = yeni-sutun
           lines yeni-lines
    modify grid6,
           visible = true
    modify pb-filtre-uygula,
           visible = true

    perform filtre-proc.

    move 1 to grid-flt-kolon.

    perform filtre-load.

*
 filtre-proc.
    initialize frame-degiskenler simdiki-bulk-gosterge
    move kayit-sayi      to frame-kayit-sayi
    move 20              to frame-win-line
    move 20              to frame-win-pos
    move "Bekleyiniz..." to frame-title
    perform frame-ac

    modify form1-handle,
            enabled = false
    open output filtre close filtre
    open i-o filtre mass-update.
    open input dokumer
    perform with test after until fs-dokumer = "10"
    initialize dokumer-rec
    read dokumer next no lock end move "10" to fs-dokumer
    not at end
         perform frame-goster
         if dokumer-20-islem = space and
            not dokumer-20-ekran-yazma
            perform varying grid-flt-i 
                    from 1
                    by 1
                    until grid-flt-i > grid0-kisit-detay-sayi
                          perform filtre-dosya-write
            end-perform         
         end-if
    end-read
    end-perform
    perform frame-kapat.

    initialize frame-degiskenler simdiki-bulk-gosterge
    move 100             to frame-kayit-sayi
    move 20              to frame-win-line
    move 20              to frame-win-pos
    move "Bekleyiniz..." to frame-title
    perform frame-ac

    close dokumer filtre.

    modify form0-handle,
           enabled = true.
    perform frame-kapat.

*
 filtre-dosya-write.
    initialize filtre-rec.
    set filtre-tip-kolon                                           to true
    move grid-flt-i                                             to filtre-kolon
    move dokumer-rec(grid0-bp(grid-flt-i):grid0-au(grid-flt-i)) to filtre-icerik
    
    write filtre-rec invalid
          continue
    end-write.
*
 filtre-load.
    open i-o filtre.
    modify grid6,
           reset-grid = 1
           mass-update = 1

    initialize Form6-Gd-1-Record.
    move "*"                   to gd-6-col-1
    move "Deger"               to gd-6-col-2
    modify grid6,
           record-to-add(form6-gd-1-record).

    initialize Form6-Gd-1-Record.
    move "Tumunu Sec"         to gd-6-col-2
    modify grid6,
           record-to-add(form6-gd-1-record).
    modify grid6(2,1),
           bitmap = check-bmp
           bitmap-number = 2
           bitmap-trailing = 1
           bitmap-width = 16.

    move 2 to grid-flt-i        

    initialize filtre-rec
    set filtre-tip-kolon                   to true
    move grid0-kisit-index(grid-flt-kolon) to filtre-kolon
    start filtre key not < filtre-anah invalid
          continue
    not invalid
    initialize fs-filtre
    perform with test after until fs-filtre = "10"
    read filtre next no lock end move "10" to fs-filtre
    not at end
         if not filtre-tip-kolon or filtre-kolon <> grid0-kisit-index(grid-flt-kolon)
            exit perform
         end-if

         initialize form6-gd-1-record
         move filtre-icerik                to gd-6-col-2
         modify grid6,
                record-to-add(form6-gd-1-record)
         add 1 to grid-flt-i grid-flt-kayit-sayi
         if filtre-harictir
            modify grid6(grid-flt-i,1),
                   bitmap = check-bmp
                   bitmap-number = 1
                   bitmap-trailing = 1
                   bitmap-width = 16
                   hidden-data = "E"
         else
            modify grid6(grid-flt-i,1),
                   bitmap = check-bmp
                   bitmap-number = 2
                   bitmap-trailing = 1
                   bitmap-width = 16
            add 1 to grid-flt-secili-sayi
         end-if
    end-read
    end-perform
    end-start

    modify grid6,
           mass-update = 0.

    close filtre.
    
*
 grid6-Ex-Other.
    perform grid0-ex-other.
     
     .
*
 acc-baslik-Ex-Other.
    perform grid0-ex-other.
     
     .
*
 Form0-Ex-Other.
    perform grid0-ex-other.
     
     .
*
 grid6-Ev-Other.
    evaluate event-type
    when msg-begin-entry
    when msg-bitmap-clicked
         move event-action-fail                 to event-action
         if event-data-2 < 2
            exit paragraph
         end-if
*OZEL DURUMLAR

         evaluate event-data-2
         when 2| tumunu sec yada secme 
                 if grid-flt-secili-sayi = grid-flt-kayit-sayi | tumu seciliyken tumunu uncheck yap
                    inquire grid6,
                            last-row in ii
                    open i-o filtre mass-update
                    perform varying i
                            from 2
                            by 1
                            until i > ii
                               initialize filtre-rec
                               set filtre-tip-kolon                   to true
                               move grid0-kisit-index(grid-flt-kolon) to filtre-kolon
                               inquire grid6(i,2)
                                       cell-data                      in filtre-icerik
                               read filtre no lock invalid
                                    continue
                               end-read
                               modify grid6(i,1)
                                      bitmap = check-bmp
                                      bitmap-number = 1
                                      bitmap-trailing = 1
                                      bitmap-width = 16
                                      hidden-data = "E"
                              set filtre-harictir                     to true
                              rewrite filtre-rec invalid
                                      write filtre-rec end-write
                              end-rewrite
                    end-perform
                    close filtre
                    move 0 to grid-flt-secili-sayi
                 else | tumu seciliyken tumunu check yap
                    inquire grid6,
                            last-row in ii
                    open i-o filtre mass-update
                    perform varying i
                            from 2
                            by 1
                            until i > ii
                               initialize filtre-rec
                               set filtre-tip-kolon                   to true
                               move grid0-kisit-index(grid-flt-kolon) to filtre-kolon
                               inquire grid6(i,2)
                                       cell-data                      in filtre-icerik
                               read filtre no lock invalid
                                    continue
                               end-read
                               modify grid6(i,1)
                                      bitmap = check-bmp
                                      bitmap-number = 2
                                      bitmap-trailing = 1
                                      bitmap-width = 16
                                      hidden-data = " "
                              initialize filtre-haric        
                              rewrite filtre-rec invalid
                                      write filtre-rec end-write
                              end-rewrite
                    end-perform
                    close filtre
                    move grid-flt-kayit-sayi to grid-flt-secili-sayi

                 end-if
                 exit paragraph
         end-evaluate

         open i-o filtre with mass-update
         initialize filtre-rec

         inquire grid6(event-data-2,1)
                 hidden-data in grid-flt-eh
         set filtre-tip-kolon                   to true
         move grid0-kisit-index(grid-flt-kolon) to filtre-kolon
         inquire grid6(event-data-2,2)
                 cell-data                      in filtre-icerik
         read filtre no lock invalid
              continue
         end-read

         if grid-flt-eh = "E"
            modify grid6(event-data-2,1)
                   bitmap = check-bmp
                   bitmap-number = 2
                   bitmap-trailing = 1
                   bitmap-width = 16
                   hidden-data = " "
           initialize filtre-haric
           rewrite filtre-rec invalid
                   write filtre-rec end-write
           end-rewrite
           add 1 to grid-flt-secili-sayi
         else
            modify grid6(event-data-2,1)
                   bitmap = check-bmp
                   bitmap-number = 1
                   bitmap-trailing = 1
                   bitmap-width = 16
                   hidden-data = "E"
           set filtre-harictir to true
           rewrite filtre-rec invalid
                   write filtre-rec end-write
           end-rewrite
           subtract 1 from grid-flt-secili-sayi
         end-if
         close filtre
         
        
         if grid-flt-secili-sayi = grid-flt-kayit-sayi
            modify grid6(2,1)
                   bitmap = check-bmp
                   bitmap-number = 2
                   bitmap-trailing = 1
                   bitmap-width = 16
         else
            modify grid6(2,1)
                   bitmap = check-bmp
                   bitmap-number = 1
                   bitmap-trailing = 1
                   bitmap-width = 16
         end-if
                 
    end-evaluate.
     
     .

*
 filtre-kontrol.
    initialize grid-flt-durum.
    perform varying grid-flt-i
            from 1
            by 1
            until grid-flt-i > grid0-kisit-detay-sayi
            initialize filtre-rec
            set filtre-tip-kolon                                        to true
            move grid-flt-i                                             to filtre-kolon
            move dokumer-rec(grid0-bp(grid-flt-i):grid0-au(grid-flt-i)) to filtre-icerik
            read filtre no lock invalid
                 exit perform cycle
            end-read
            if filtre-harictir 
               set grid-flt-cikma to true
               exit perform
            end-if
    end-perform.
*
 suz-uygula.
    inquire cb-suz,
            value in cb-suz-value.

    if not suzde
       perform dokumer-grid-proc
       exit paragraph
    end-if
    initialize suz-dokumer-buffer sutun-bilgiler
    move x"ff"         to suz-buffer(function length(suz-buffer):1)
    modify grid0
           insertion-index = 2
           record-to-add(suz-buffer)
           y = 2 
           row-color = 480
           not row-headings.
*
 suz-kontrol.
    
    inspect suz-dokumer-buffer replacing all x"ff" by spaces
    initialize grid-suz-durum.
    perform varying grid-suz-i
            from 1
            by 1
            until grid-suz-i > grid0-kisit-detay-sayi
*/ cell icerigi bossa pas gec
                  if suz-buffer(grid0-kisit-bp(grid-suz-i):grid0-kisit-au(grid-suz-i)) <> spaces
                     initialize kiyasla-deg
                     move function upper-case(suz-buffer(grid0-kisit-bp(grid-suz-i):grid0-kisit-au(grid-suz-i))) to kiyasla-bunu
                     move grid0-kisit-index(grid-suz-i)                                                          to grid-suz-iii
                     move function upper-case(dokumer-rec(grid0-bp(grid-suz-iii):grid0-au(grid-suz-iii)))        to kiyasla-sunla

                     inspect kiyasla-bunu tallying kiyasla-bunu-boy for trailing spaces
                     compute kiyasla-bunu-boy = function length(kiyasla-bunu) - kiyasla-bunu-boy
                     inspect kiyasla-sunla tallying kiyasla-sunla-boy for trailing spaces
                     compute kiyasla-sunla-boy = function length(kiyasla-sunla) - kiyasla-sunla-boy
                     inspect kiyasla-sunla(1:kiyasla-sunla-boy) tallying kiyasla-i for all kiyasla-bunu(1:kiyasla-bunu-boy)
                     if kiyasla-i = 0
                        set grid-suz-cikma        to true
                        exit perform
                     end-if
                  end-if
    end-perform.

    perform sutun-bilgiler-olustur.

*
 grup-uygula.
    set dokumer-prog-dokgrup            to true
    call dokumer-prog-call using dokumer-dosya,
                                                grid0-degiskenler
    on exception
       perform callerr-proc
    not on exception
    cancel dokumer-prog-call
    end-call.
    perform dokumer-grid-proc.
*
  isaretle.
      inquire grid0 CURSOR-Y in satir-yer
      inquire  grid0(satir-yer,2) hidden-data in Grid0-Hidden-Data-Renk
              
       if grid0-isaret not = 1 then  
          move 1 to grid0-isaret 
          modify  grid0(satir-yer,2) hidden-data = Grid0-Hidden-Data-Renk
          move 648 to grid0-renk
        else 
           move 0 to grid0-isaret 
           modify  grid0(satir-yer,2) hidden-data = Grid0-Hidden-Data-Renk
           move grid0-hidden-renk to grid0-renk
       end-if
       perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi            
             modify grid0(satir-yer,i)
                cell-color  = grid0-renk
       end-perform  .

      .
* 
 isaretle-sec.
       move 79 to grid0-renk
       perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi            
             modify grid0(satir-yer,i)
                cell-color  = grid0-renk
       end-perform  .

*
 isaretle-secme.
      
      inquire  grid0(satir-yer,2) hidden-data in Grid0-Hidden-Data-Renk
              
       if grid0-isaret  = 1 then  
          move 584 to grid0-renk
        else 
           move grid0-hidden-renk to grid0-renk
       end-if
       perform varying i from 1 by 1 until i > grid0-kisit-detay-sayi            
             modify grid0(satir-yer,i)
                cell-color  = grid0-renk
       end-perform  .


     
     .
*
 sutun-bilgiler-olustur.
         exit paragraph.

*     02 sutun-bilgiler-occ
*          OCCURS MAX-DOKUMER-KOLON TIMES.
*         03 sutun-topla      PIC  9(12)v9(4).
*         03 sutun-say        PIC  9(15).
*         03 sutun-buyuk      PIC  x(50).
*         03 sutun-kucuk      PIC  x(50).
*         03 sutun-ortalama   PIC  9(12)v9(5).


    perform varying grid-suz-i
            from 1
            by 1
            until grid-suz-i > grid0-kisit-detay-sayi
*/ say
                  add 1                                                                                to sutun-say(grid-suz-i)
*/ topla
                  add function numval-c(dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i)))        to sutun-topla(grid-suz-i)
* en buyuk deger
                  if dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i)) > sutun-buyuk(grid-suz-i) and 
                     dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i)) <> spaces
                     move dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i))                       to sutun-buyuk(grid-suz-i)
                  end-if
* en kucuk deger
                  if dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i)) < sutun-kucuk(grid-suz-i) and 
                     dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i)) <> spaces
                     move dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i))                       to sutun-kucuk(grid-suz-i)
                  end-if

                  if sutun-kucuk(grid-suz-i) = spaces
                     move dokumer-rec(grid0-bp(grid-suz-i):grid0-au(grid-suz-i))                       to sutun-kucuk(grid-suz-i)
                  end-if
    end-perform.
*
sutun-bilgiler-ekle.
        exit paragraph.
    inquire grid0,
            last-row in i
    modify grid0,
           record-to-add("$Say"),
           record-to-add("$Top"),
           record-to-add("$Min"),
           record-to-add("$Max"),
           record-to-add("$Ort").
    perform varying grid-suz-i
            from 2
            by 1
            until grid-suz-i > grid0-kisit-detay-sayi
                  compute sutun-ortalama(grid-suz-i) = sutun-topla(grid-suz-i) / sutun-say(grid-suz-i)
                  modify grid0,
                         y = i + 1
                         x = grid-suz-i
                         cell-data = sutun-say(grid-suz-i)
                         y = i + 2
                         x = grid-suz-i
                         cell-data = sutun-topla(grid-suz-i)
                         y = i + 3
                         x = grid-suz-i
                         cell-data = sutun-kucuk(grid-suz-i)
                         y = i + 4
                         x = grid-suz-i
                         cell-data = sutun-buyuk(grid-suz-i)
                         y = i + 5
                         x = grid-suz-i
                         cell-data = sutun-ortalama(grid-suz-i)
    end-perform.
    modify grid0,
           y = i + 1
           row-color = 432
           y = i + 2
           row-color = 432
           y = i + 3
           row-color = 432
           y = i + 4
           row-color = 432
           y = i + 5
           row-color = 432.
*
 zaman-tarih-bilgileri.
    initialize ole-excel-bilgi
    accept zaman from time
    accept tarih from century-date
    move yil                  to eyil
    move ay                   to eay
    move gun                  to egun
    move etarih               to ole-excel-bilgi(1:10)

    move saat                 to esaat
    move dakika               to edakika
    move saniye               to esaniye
    move ezaman               to ole-excel-bilgi(12:9)
    
    open input kllnc
    move k-kodu-tasi         to k-kodu
    read kllnc no lock invalid
         move "Tanimsiz ..." to k-adi
    end-read
    close kllnc
    move k-adi to ole-excel-bilgi(22:15).
*
 sirket-bilgisi-yaz.
    
   
     open input isyeri.
        move isyeri-no-tasi to isyeri-no
        read isyeri no lock invalid
        move "Tanimsiz Sirket" to isyeri-unvan
        end-read
    close isyeri
    initialize ole-excel-bilgi
    move isyeri-unvan               to ole-excel-bilgi 
    move 1                   to ole-excel-sutun
    move ole-cyan            to ole-excel-color
    set  ole-excel-font-bold to true
    perform ole-excel-record-send
    display acc-baslik
    move dokumer-400  to dokumer-ozellikler-rec. 

*
 fiyat-oda-ref-after. 
     
    if fiyat-ref-external> 0
      move fiyat-ref-external to ref-sat-adi
      move "-"              to ref-sat-adi(2:1)
      if fiyat-ref-external <= max-ref then
        move ref-adi(fiyat-ref-external)  to ref-sat-adi(3:)
       else
        move "????????? "  to ref-sat-adi
      end-if
      else 
       move "Tumu "  to ref-sat-adi
     end-if
    if oda-ref-external > 0
      move oda-ref-external to ref-oda-adi
      move "-"              to ref-oda-adi(2:1)
      if oda-ref-external <= max-ref then
        move ref-adi(oda-ref-external)  to ref-oda-adi(3:)
       else
        move "????????? "  to ref-oda-adi(4:)
      end-if
      else 
       move "Tumu "  to ref-oda-adi
     end-if
     
     move "   Oda Ref :"   to ref-baslik-detay 
     move ref-oda-adi      to ref-baslik-detay(13:)
    
     move "   Fiyat Ref :" to ref-baslik-detay(24:) 
     move ref-sat-adi      to ref-baslik-detay(35:)
     move 0                to ref-baslik-yaz.
* 
 doksal-at.
              
  
      initialize seq-adres genelfis-rec
      open i-o genelfis
      move 1 to genelfis-anahtar
      read genelfis no lock invalid
              display message box "Genelfis Tanimsizzz !"
              exit paragraph
      not invalid
              add 1 to PRINT-NO
              move "/asya/ytl/liste/"  to seq-adres
              move PRINT-NO            to seq-adres(17:)

              rewrite genelfis-rec invalid
                      continue
              end-rewrite
      end-read
      close genelfis

     inspect seq-adres replacing  trailing spaces by low-values
 
     open output seq
     open input dokumer
              
     open i-o prosif
     initialize prosif-rec seq-rec
     move "X"                 to seq-rec
     move k-kodu-tasi         to prosif-kim
     move called-program      to prosif-cob
     move "D"                 to prosif-tipi
     read prosif no lock invalid
                move all "1"              to seq-rec(22:50)
     not invalid
                move prosif-detaylar      to seq-rec(22:50)

                move function numval(cmb-size(1:2)) to prosif-size
                move cmb-sayfa(1:1)                 to prosif-sayfa
                move cmb-row                        to prosif-row-height

                rewrite prosif-rec invalid
                        stop " "
                end-rewrite
     end-read
     close prosif
     write seq-rec

     open input isyeri
        move isyeri-no-tasi to isyeri-no
        read isyeri no lock invalid
        move "Tanimsiz Sirket" to isyeri-unvan
        end-read
     close isyeri

     initialize seq-rec
     move "U1"          to seq-rec
     move isyeri-unvan  to seq-rec(22:)
     write seq-rec
     
     move all low-values to deger
     inspect k-adi    replacing trailing spaces by low-values
     inspect k-soyadi replacing trailing spaces by low-values

     string deger
               k-adi delimited by low-values
               " " delimited by low-values
               k-soyadi delimited by low-values
     into deger

     inspect deger replacing trailing low-values by spaces
     initialize seq-rec
     move "K1"          to seq-rec
     move deger         to seq-rec(22:)
     write seq-rec


     initialize seq-rec
     move "SAYFA"       to seq-rec
     move prosif-sayfa  to seq-rec(22:)
     write seq-rec

     initialize seq-rec
     move "FSIZE"       to seq-rec
     move prosif-size   to seq-rec(22:)
     write seq-rec

     initialize seq-rec
     move "ROWHE"            to seq-rec
     move prosif-row-height  to seq-rec(22:)
     write seq-rec

     initialize seq-rec
     move "ISORV"       to seq-rec
     move iso-rec       to seq-rec(22:)
     write seq-rec

     perform with test after until fs-dokumer = "10"
     initialize dokumer-rec
     read dokumer next no lock end move "10" to fs-dokumer
     not at end 
    
           inspect dokumer-rec replacing all high-values by spaces

           evaluate dokumer-20(1:1)
             when "B"
             when "D"
             when "T"
             when "C"
             when "O"
             when "Y"
             when " "
                 continue
             when other
                exit perform cycle
           end-evaluate
          initialize seq-rec
         
          move dokumer-rec      to seq-rec
          write seq-rec
     end-read
     end-perform
     close dokumer
     close seq  
     perform dok-gonder.
*
 dok-gonder.
    
       move all low-values to dos-hedef dos-kaynak.
       string dos-hedef,
              "@[DISPLAY]:c:\acucorp\acucbl701\acugt\pdf_temp\" delimited by low-values 
              seq-adres(17:4) delimited by low-values 
       into dos-hedef

       string dos-kaynak, seq-adres delimited by low-values  
       into dos-kaynak
       inspect dos-kaynak replacing leading spaces by low-values
 
       if is-remote or 1 = 1
             call "c$copy" using dos-kaynak dos-hedef giving sonuc
             if sonuc <> 0
                  display message box
                          "Rapor Dosyasi Yerele Kopyalanamadi !!!",x"0a0d"
                          "From : ",dos-kaynak,x"0a0d"
                          "To :" ,dos-hedef
                          icon mb_error_icon
                          title "Hata"
                          exit paragraph
             end-if

                         
            |//*** call "c$copy" using "/asya/ytl/obj/dokumer/DOKUMER_KILL.BAT" 
            |//***                     "@[DISPLAY]:C:\acucorp\acucbl701\acugt\bin\DOKUMER_KILL.BAT" giving sonuc
            |//*** if sonuc <> 0  
            |//***      display message box
            |//***              "Rapor Dosyasi Yerele Kopyalanamadi !!!",x"0a0d"
            |//***              "From : ","/asya/ytl/obj/dokumer/DOKUMER_KILL.BAT",x"0a0d"
            |//***              "To :" , "@[DISPLAY]:C:\acucorp\acucbl701\acugt\bin\DOKUMER_KILL.BAT"
            |//***              icon mb_error_icon
            |//***              title "Hata"
            |//***              |exit paragraph
            |//*** end-if
            |//*** call "c$system" using "C:\acucorp\acucbl701\acugt\bin\DOKUMER_KILL.BAT" ,CSYS-HIDDEN
            |//***            giving sonuc
            |//***
            |//*** call "c$sleep" using 0.5

             move all low-values to dok-hedef dok-kaynak
             move "/asya/ytl/obj/dokumer/DOKUMER.exe" to dok-kaynak 
             MOVE "@[DISPLAY]:C:\acucorp\acucbl701\acugt\bin\DOKUMER.exe"  to dok-hedef  
             call "c$copy" using dok-kaynak dok-hedef giving sonuc
            |//*** if sonuc <> 0   
            |//***      display message box
            |//***              "Rapor Dosyasi Yerele Kopyalanamadi !!!",x"0a0d"
            |//***              "From : ",dok-kaynak,x"0a0d"
            |//***              "To :" ,dok-hedef
            |//***              icon mb_error_icon
            |//***              title "Hata"
            |//***              |exit paragraph
            |//*** end-if


             initialize dok-gonder-param            
             move dok-hedef                       to dok-gonder-adres
             move dos-hedef(12:)                  to dok-gonder-dosya  
             call "c$system" using dok-gonder-param ,129 | CSYS-DESKTOP  +ASYNC
                        giving sonuc
       
             if sonuc = -1 
                display message box "Hata Donus Kodu-> "sonuc "               " new-line  
                        dok-hedef " Programi Bulunamadi !"
                        icon 1
                        title "Uyari" new-line 
             end-if 
             
       end-if.

*
 iso-bos-yaz.
     initialize iso-i
     if dokumer-yazici-text
        compute iso-i = dokumer-oto-sayfa-satir - yazfor-kayit-sayi
        perform iso-i times
           initialize liste-rec
           write liste-rec
        end-perform
     else
        if dokumer-oto-sayfa-basi-yap
           if link-liste-satir-sayi > 0
              compute iso-i = link-liste-satir-sayi - yazfor-kayit-sayi
           else
              compute iso-i = dokumer-oto-sayfa-satir - yazfor-kayit-sayi
           end-if
        end-if

        if grafik-yazici
           perform iso-i times
              initialize liste-rec
              write liste-rec before advancing 1 line
           end-perform
        else
           perform iso-i times
              initialize liste-rec
              write liste-rec 
           end-perform
        end-if

     end-if.

*
 iso-bilgileri-yaz.
     if iso-rev-no <> spaces and iso-rapor-adi <> spaces
        continue
     else
        exit paragraph
     end-if.
     if grafik-yazici
        initialize liste-rec
        write liste-rec before advancing 1 line
        initialize liste-rec
        move iso-rec               to liste-rec
        write liste-rec before advancing 1 line
     else
        initialize liste-rec
        write liste-rec
        move iso-rec               to liste-rec
        write liste-rec
     end-if.

 
