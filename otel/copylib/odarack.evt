* odarack.evt
* odarack.evt is generated from D:\asya\acugt.ytl\otel\odarack.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form0-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM Form1-Gd-1-Ev-Msg-Begin-Entry
     WHEN Msg-End-Heading-Drag
        PERFORM Acu-combo-oda-durumu-Content
     WHEN Msg-Goto-Cell
        PERFORM oda-git
     WHEN Msg-Goto-Cell-Mouse
        PERFORM oda-git
     WHEN Msg-Grid-Rbutton-Up
        PERFORM sag-tus-basildi
     WHEN Other
        EVALUATE Event-Control-Id
        WHEN 1
           PERFORM Form1-Gd-1-Ev-Other
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Gd-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Goto
           PERFORM oda-git
        END-EVALUATE
     ELSE
        PERFORM Form1-Gd-1-Ex-Other
     END-IF
     .

 Form1-Cb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-blokaj-oda-Event-Proc.
     .

 Form1-Cb-1a-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1b-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1ab-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cb-1aaa-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-bos-temiz-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 cb-blokajli-temiz-oda-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Clicked
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Ef-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Ntf-Changed
        EVALUATE Event-Control-Id
        WHEN 29
           PERFORM Form1-Ef-ack1-Ev-Ntf-Changed
        WHEN 30
           PERFORM Form1-Ef-ack1-Ev-Ntf-Changed
        END-EVALUATE
     END-EVALUATE
     .

 Form1-Ef-adi-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        PERFORM Form1-Ef-adi-Ev-Cmd-Goto
     END-EVALUATE
     .

 kart1-acc-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Goto
        EVALUATE Event-Control-Id
        WHEN 93
           PERFORM kart1-acc-Ev-Cmd-Goto
        WHEN 94
           PERFORM kart1-acc-Ev-Cmd-Goto
        WHEN 95
           PERFORM kart1-acc-Ev-Cmd-Goto
        END-EVALUATE
     END-EVALUATE
     .

 kart2-acc-Event-Proc.
     .

 kart3-acc-Event-Proc.
     .

 tek-ac-Event-Proc.
     .

 cb-otel-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM cb-otel-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 acc-rehber-Exception-Proc.
     PERFORM acc-rehber-Ex-Other
     .

 pen-gd-Event-Proc.
     PERFORM pen-gd-Ev-Other
     .

 Form1-Cm-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form1-Cb-1aa-Ex-Cmd-Clicked
        END-EVALUATE
     END-IF
     .

 Form1-Cm-3-Event-Proc.
     .

 Form1-Cm-3-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Ntf-Selchange
           PERFORM Form1-Cm-3-Ex-Ntf-Selchange
        END-EVALUATE
     END-IF
     .

 form0-exception-proc.
     PERFORM Form0-Ex-Other
     .

 Screen2-Event-Proc.
     .

 Form4-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form4-Gd-1-Event-Proc.
     PERFORM Form4-Gd-1-Ev-Other
     .

 Form5-Event-Proc.
     .

 Form5-Exception-Proc.
     PERFORM Form5-Ex-Other
     .
***   start event editor code   ***

*    genel icin mesaj konulacak
*    toplam oda sag tarafta takvimden alinacak ...
*    okumada problem var ........ 0116 ornegi ...
*--------------------------------------
 Form0-Bef-Create.
     perform adresleri-tasi.
     open input genel.
     move 1 to genel-anahtar
     read genel no lock invalid
          continue
     end-read
     close genel. 
     open input kllnc
     move k-kodu-tasi             to k-kodu
     read kllnc no lock invalid
          move 1    to k-kisi-goremez
     end-read
     close kllnc


       
         open i-o odalar2
      initialize kodlar02-rec
            open input kodlar02
            move "C" to kodlar02-tipi
            move house-touch to kodlar02-kodu
            read kodlar02 no lock invalid move  house-bk to house-touch
              not invalid
                continue
            end-read
             close   kodlar02
       move  k-rackde-satir to max-oda-sayi2
       initialize hangi-ref
       move k-ref            to hangi-ref 
      move cost-sirketi of genel to cst-genel-dosya-adres
                                  kart-dosya-adres
                                  odenmez-dosya-adres

*                                  genelfis-dosya-adres
*                                  errorlog-dosya-adres
*                                  takvim-dosya-adres  
     move 0 to calisma oda-vis v-nopost.
*
 Form0-Aft-Initdata.
              if genel-onburo-temizlemez = 1 
                call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 100
                call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 101
                 call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 102
                  call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 169
             else
                call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 100
                call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 101
                 call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 102
                  call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 169

             end-if
 
     open input doviz kur
     move ONKPARA-DOVIZ to doviz-kodu
     read doviz no lock invalid
          move "Tanimsiz" to d-kisa-adi
     end-read
     move d-adi-1 to extra-dov-adi
     move onkpara-doviz to kur-doviz
     move onkpara-banka  to kur-banka
     move tarih-tasi    to kur-tarih
     read kur no lock invalid
             move 1 to gunluk-kur
         not invalid move doviz-alis to gunluk-kur
     end-read
     close doviz kur
 
     initialize combo-oda-konumu-value combo-oda-tipi-value
     combo-oda-durumu-value acc-oda-kapasite-value
     combo-oda-tipi2-value combo-oda-tipi3-value. 

     modify combo-oda-konumu, reset-list = 1 mass-update = 1.
     modify combo-oda-durumu, reset-list = 1 mass-update = 1.
     modify combo-oda-tipi  , reset-list = 1 mass-update = 1.
     modify combo-oda-tipi2  , reset-list = 1 mass-update = 1.
     modify combo-oda-tipi3  , reset-list = 1 mass-update = 1.

     modify combo-oda-konumu,item-to-add("00-Hepsi")
     modify combo-oda-durumu,item-to-add("__-Hepsi")
     modify combo-oda-tipi,item-to-add("00-Hepsi")
     modify combo-oda-tipi2,item-to-add("00-Hepsi")
     modify combo-oda-tipi3,item-to-add("00-Hepsi")

     open input konum
     initialize konum-rec 
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
     read konum next no lock end move "10" to fs-konum
     not at end
          initialize combo-oda-konumu-value
          move konum-anahtar     to combo-oda-konumu-value
          move "-"               to combo-oda-konumu-value(3:)
          move konum-adi         to combo-oda-konumu-value(4:)
          modify combo-oda-konumu,item-to-add(combo-oda-konumu-value)
     end-read
     end-perform
     end-start.
     close konum.

     open input kodlar02.
     initialize kodlar02-rec
     move "C"   to kodlar02-tipi                             
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "C"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-durumu-value
                move kodlar02-kodu   to combo-oda-durumu-value
                move "-"             to combo-oda-durumu-value(3:)
                move kodlar02-adi    to combo-oda-durumu-value(4:)
                modify combo-oda-durumu,item-to-add(combo-oda-durumu-value)
             end-if
     end-read
     end-perform
     end-start.

     initialize kodlar02-rec
     move "G"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "G"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-tipi-value
                move kodlar02-kodu   to combo-oda-tipi-value
                move "-"             to combo-oda-tipi-value(3:)
                move kodlar02-adi    to combo-oda-tipi-value(4:)
                modify combo-oda-tipi,item-to-add(combo-oda-tipi-value)
             end-if
     end-read
     end-perform
     end-start.
     
     initialize kodlar02-rec
     move "H"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "H"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-tipi2-value
                move kodlar02-kodu   to combo-oda-tipi2-value
                move "-"             to combo-oda-tipi2-value(3:)
                move kodlar02-adi    to combo-oda-tipi2-value(4:)
                modify combo-oda-tipi2,item-to-add(combo-oda-tipi2-value)
             end-if
     end-read
     end-perform
     end-start.
     
     initialize kodlar02-rec
     move "I"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform with test after until fs-kodlar02 = "10"
     read kodlar02 next no lock 
          end 
             move "10" to fs-kodlar02
             exit perform
          not at end
             if kodlar02-tipi <> "I"
                move "10" to fs-kodlar02
                exit perform
             else
                initialize combo-oda-tipi2-value
                move kodlar02-kodu   to combo-oda-tipi3-value
                move "-"             to combo-oda-tipi3-value(3:)
                move kodlar02-adi    to combo-oda-tipi3-value(4:)
                modify combo-oda-tipi3,item-to-add(combo-oda-tipi3-value)
             end-if
     end-read
     end-perform
     end-start.
     
      close kodlar02.
     move "00-Hepsi"        to combo-oda-konumu-value
     move "__-Hepsi"       to combo-oda-durumu-value
     move "00-Hepsi"       to combo-oda-tipi-value
     
     move "00-Hepsi"       to combo-oda-tipi2-value
     
     move "00-Hepsi"       to combo-oda-tipi3-value
     
     modify combo-oda-konumu,
            mass-update = 0
            value = combo-oda-konumu-value
     modify combo-oda-durumu,
            mass-update = 0
            value = combo-oda-durumu-value
     modify combo-oda-tipi,
            mass-update = 0
            value = combo-oda-tipi-value.
     modify combo-oda-tipi2,
            mass-update = 0
            value = combo-oda-tipi2-value.
     modify combo-oda-tipi3,
            mass-update = 0
            value = combo-oda-tipi3-value.
      inquire cb-hayali-odalar, value in hayali-eh
       perform acu-form1-routine   .

 Form0-Ex-Other.
    if key-status = 2
       inquire cb-hayali-odalar, value in hayali-eh
       perform acu-form1-routine
    end-if.
*
 Form1-Aft-Initdata.
     
      
      if onkpara-referans-var = 1 then
         modify cb-otel reset-list = 1 
         if hangi-ref not > 0
           move "0->Tum Komplex" to   ref-ekle
           modify cb-otel item-to-add ref-ekle
         end-if 
              
         perform varying ref from 1 by 1 until ref > max-ref
          
            if hangi-ref > 0
               if hangi-ref not = ref
                   exit perform cycle 
               end-if 
            end-if 
            move ref  to ref-ekle
            move "->" to ref-ekle(2:2)
            move ref-adi(ref) to  ref-ekle(4:)
            modify cb-otel item-to-add ref-ekle
         end-perform 
      end-if
      initialize rapor-rehber lb-reh-value
      move 0 to oda-ref fiyat-ref
      if hangi-ref > 0
            move hangi-ref   to oda-ref       
      end-if 
      display oda-ref-acc sat-ref-acc acc-rehber lb-rehber cb-otel        
                                  
    move 1 to ooo-oda-cb bos-oda-cb blokaj-oda-cb cout-oda-cb
    cin-oda-cb arizali-oda-cb arizali-dolu-oda-cb
    bos-temiz-oda-cb blokajli-temiz-oda-cb touch-oda-cb.
    display cb-bos-oda cb-ooo-oda cb-blokaj-oda cb-cout-oda
    cb-cin-oda cb-arizali-oda cb-arizali-dolu-oda
    cb-bos-temiz-oda cb-blokajli-temiz-oda cb-touch-oda.

    perform cast-to-rez-oda-kontrol

    perform oda-ayar

    perform gride-yukle.

    perform rez-durum-bul.
*/sadece bir kere yukleme icin yapildi
    initialize durum-dizi.
    add 1 to calisma.
    if calisma = 1 
    open input kodlar02
    move "C"   to kodlar02-tipi
    start kodlar02 key not < kodlar02-anah invalid
          continue
    not invalid
    initialize fs-kodlar02
    move 1000 to 4-hane
    perform with test after until fs-kodlar02 = "10"
    read kodlar02 next no lock end move "10" to fs-kodlar02
    not at end
         if kodlar02-tipi = "C"
            initialize x-20
            move kodlar02-kodu     to x-20
            move "\t"              to x-20(3:)
            move kodlar02-adi      to x-20(5:5)

            initialize durum-sayi
            compute durum-sayi = 4-hane - 1000 + 1
            move kodlar02-kodu to durum-kodu(durum-sayi)

*            if 4-hane <> 1000
*            call "w$menu" using wmenu-add,
*                                sub-handle-1,
*                                0,
*                                0,
*                                x-20,
*                                4-hane
*            else
*            call "w$menu" using wmenu-change,
*                                sub-handle-1,
*                                1000,
*                                0,
*                                x-20,
*                                1000
*            end-if
*            add 1 to 4-hane
         else
            move "10" to fs-kodlar02
            exit perform
         end-if
    end-read
    end-perform
    end-start
    close kodlar02
    end-if.
*
 gride-yukle.
      perform planlanan-degisim-kontrol

              if genel-onburo-temizlemez = 1 
                call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 100
                call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 101
                 call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 102
                  call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 169
             else

                call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 100
                call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 101
                 call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 102
                  call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 169
              
             end-if
      modify form1-gd-1,mass-update = 1 reset-grid = 1 
     perform  grid-yeniden-bol.
       modify form1-gd-1,mass-update = 1 reset-grid = 1 
       open input onbkodlar10
       initialize onbkodlar10-rec e-santral e-lapis e-maginet
            move  "EE" to  onbkodlar10-tipi
          
       read onbkodlar10 no lock invalid
          continue
          not invalid
              move 0 to pms-durdu santral-durdu lapis-durdu
              accept suan-tarih from century-date
              accept suan-zaman from time
               compute  suan-say = 
                            suan-saat * 60 + suan-dakika 
                if onbkodlar10-pms-tarih > "20140000" then
                  compute  kont-say = 
                           + onbkodlar10-pms-saat * 60 + onbkodlar10-pms-dakika 
                   
                   if ( suan-tarih not = onbkodlar10-pms-tarih or  suan-say - kont-say > 15 ) and  suan-say > 15    then 
 
                       move 1 to pms-durdu
                       string 
                       "Son Maginet Trans: " delimited by size
                       onbkodlar10-pms-gun  delimited by size
                       "/" delimited by size
                       onbkodlar10-pms-ay  delimited by size
                         "/" delimited by size
                       onbkodlar10-pms-yil  delimited by size
                       " " delimited by size
                       onbkodlar10-pms-saat  delimited by size
                       ":" delimited by size
                       onbkodlar10-pms-dakika  delimited by size
                       into e-maginet



                   end-if
                end-if

               if onbkodlar10-santral-tarih > "20140000" then
                  compute  kont-say = 
                           + onbkodlar10-santral-saat * 60 + onbkodlar10-santral-dakika 
                  
                   if (( suan-tarih not = onbkodlar10-santral-tarih or  suan-say - kont-say > 15 ) and  suan-say > 15 ) or 
                      k-kodu-tasi = "X   " or "ASYA" then 
 
                       move 1 to santral-durdu
                       string 
                       "Son Santral Trans: " delimited by size
                       onbkodlar10-santral-gun  delimited by size
                       "/" delimited by size
                       onbkodlar10-santral-ay  delimited by size
                         "/" delimited by size
                       onbkodlar10-santral-yil  delimited by size
                       " " delimited by size
                       onbkodlar10-santral-saat  delimited by size
                       ":" delimited by size
                       onbkodlar10-santral-dakika  delimited by size
                       into e-santral
                      
                   end-if
                end-if
                if onbkodlar10-lapis-tarih > "20140000" then
                  compute  kont-say = 
                            onbkodlar10-lapis-saat * 60 + onbkodlar10-lapis-dakika 

                   if ( suan-tarih not = onbkodlar10-lapis-tarih or  suan-say - kont-say > 15 ) and  suan-say > 15    then
 
                       move 1 to lapis-durdu
                       string 
                       "Son Lapis Trans: " delimited by size
                       onbkodlar10-lapis-gun  delimited by size
                       "/" delimited by size
                       onbkodlar10-lapis-ay  delimited by size
                       "/" delimited by size
                       onbkodlar10-lapis-yil  delimited by size
                       " " delimited by size
                       onbkodlar10-lapis-saat  delimited by size
                       ":" delimited by size
                       onbkodlar10-lapis-dakika  delimited by size
                       into e-lapis
                   end-if
                end-if
                display a-maginet a-santral a-lapis 
        

       end-read
        close onbkodlar10
    modify progress-bar-1, fill-percent = 0.
    open i-o genelfis.
    move 1 to genelfis-anahtar
    read genelfis no lock invalid
         accept ekran-fis-1 from time
    end-read
    add 1 to ekran-fis-1
    rewrite genelfis-rec invalid
            write genelfis-rec invalid continue end-write
    end-rewrite
    close genelfis.

    move ekran-fis-1 (2:)         to takas-no takas2-no takaskont-no
    move k-kodu-tasi    to  takas-k takas2-k  takaskont-k
    open output takas takaskont close takas takaskont
    open i-o takas takaskont .
    open output takas2 close takas2 
    open i-o takas2 .
    open i-o plaka close plaka
    open input odalar plaka rez.
    initialize i odalar-rec odalar-ana-dizi toplamlar
    start odalar key not < odalar-anah invalid
          modify form1-gd-1,mass-update = 1
***          display message box "mass-update = 1"
          close odalar 
          exit paragraph
    not invalid
    perform with test after until fs-odalar = "10"
    read odalar next no lock end move "10" to fs-odalar
    not at end
         if odalar-no = spaces
            exit perform cycle
         end-if
         if odalar-aktif-pasif = 1
            exit perform cycle 
         end-if 
         if combo-oda-konumu-value(1:2) <> odalar-konumu and 
            combo-oda-konumu-value(1:2) <> "00"
            exit perform cycle
         end-if
         if acc-oda-kapasite-value <> odalar-kapasite(1:2) and
            acc-oda-kapasite-value <> 0
            exit perform cycle
         end-if
         if combo-oda-durumu-value(1:2) <> odalar-durumu and
            combo-oda-durumu-value(1:2) <> "__"
            exit perform cycle
         end-if
         if combo-oda-tipi-value(1:2) <> odalar-tipi and
            combo-oda-tipi-value(1:2) <> "00"
            exit perform cycle
         end-if
         if combo-oda-tipi2-value(1:2) <> odalar-tipi2 and
            combo-oda-tipi2-value(1:2) <> "00"
            exit perform cycle
         end-if
         if combo-oda-tipi3-value(1:2) <> odalar-tipi3 and
            combo-oda-tipi3-value(1:2) <> "00"
            exit perform cycle
         end-if


         if hayali-eh = 0                                             |||22/06/2019 firat
            if odalar-hayali = "H" or odalar-dis = 1                  |||Stone Group hayali blokajlýlar rackte gorunsun
               initialize rez-rec hayali-blokaj
               move "I"         to rez-durumu
               move tarih-tasi  to rez-gir-tar
               start rez key not < rez-gir invalid
                     continue
               not invalid
               perform with test after until fs-rez = "10"
               read rez next no lock end move "10" to fs-rez
               not at end 
                    if rez-durumu <> "I"  
                       exit perform  
                    end-if
                    if rez-gir-tar <> tarih-tasi 
                       exit perform  
                    end-if
                    if rez-odano = odalar-anah
                       move 1 to hayali-blokaj
                       exit perform 
                    end-if
               end-read 
               end-perform 
               end-start
               if hayali-blokaj = 0
                  exit perform cycle
               end-if
            end-if
         end-if

         move odalar-konumu to rez-oda-konumu rez-fiyat-konumu  
         move odalar-anah   to rez-odano

         if onkpara-referans-var = 1 then 
            perform ref-filtre
            if  not ref-gecti then 
               exit perform cycle
          end-if
        end-if
            
         initialize takas-rec
         move odalar-no        to takas-oda  takas-oda-yeri
         move odalar-durumu    to takas-oda-durumu

         write takas-rec invalid 
            display message box "Hata 3555" 
         end-write
         add 1 to toplam-oda
    end-read
    end-perform
    end-start    
    if i > 0
       modify form1-gd-1,
              record-to-add(odalar-ana-dizi)
    end-if.
                 
    open input konuk cast yanrez.
    initialize cast-rec rez-rec
    move tarih-tasi          to cast-tarih
    start cast key not < cast-anah invalid
          continue
    not invalid
*    accept eski-t from time 
    initialize fs-cast
    perform with test after until fs-cast = "10"
    
    read cast next no lock end move "10" to fs-cast
    not at end     
         add 1 to kayit 
         if cast-tarih > tarih-tasi
            move "10" to fs-cast
            exit perform
         end-if
         if cast-tarih not > tarih-tasi
            move cast-rez-no  to rez-no
            read rez no lock invalid 
                 exit perform cycle
            end-read
*            if rez-cik-tar = tarih-tasi then 
*               move rez-folio to konuk-folio
*               read konuk no lock invalid continue
*               end-read
*            end-if
             

            if rez-durumu = "I" and rez-c-in <> "E" and 
               rez-k-g-b = "K" 
               move cast-oda-no     to  odalar-no takas-oda
               initialize takas-dbl
               read takas no lock invalid
                 continue
                 not invalid
                  if takas-rez > 0 or takas-folio > 0 then
                       move cast-rez-no to takas-dbl  takas-ger-rez
                       move rez-tam-blok to takas-blok
                       move rez-renk to takas-renk
                   
                     write takas-rec  invalid 
                       display message box "Cakisma var Oda No:" takas-oda
                     end-write
                  end-if
               end-read
               read odalar no lock invalid 
                    exit perform cycle
               end-read
               move cast-rez-no     to takas-rez takas-ger-rez
               move "B"             to takas-durumu
               move odalar-durumu   to takas-oda-durumu
               move rez-adi         to takas-adi   
               move rez-rehber      to takas-rehber
               move rez-soyadi      to takas-soyadi
               move rez-tam-blok    to takas-blok
               move rez-sharenum    to takas-sharenum
               move rez-share    to takas-share
               move rez-renk    to takas-renk
                   move  rez-no to yanrez-rezno
               
**************************************************************************firt ekleme 1
               if rez-no > 0 and yeni-renk-ver(1:1) > 0
                  evaluate yeni-renk-ver(1:1) 
                      when 1
                           open i-o nt
                           initialize not-rec
                           move "REZ"    to  NOT-DOS 
                           move rez-no to not-dos-anah                  
                           start nt key not < not-anah invalid
                                 continue
                           not invalid
                           perform with test after until fs-not = "10" 
                           read nt next no lock end move "10" to fs-not
                           not at end 
                           
                               if not-dos-anah = rez-no and not-dos = "REZ"
                                  move 1    to takas-mesaj-var
                               else 
                                  exit perform 
                               end-if
                           
                           end-read
                           end-perform
                           end-start
                           close nt
                      when 2
                           if rez-vip = "G" 
                              move 1        to takas-g-r
                           else 
                              move 0        to takas-g-r
                           end-if
                  end-evaluate
               end-if
**************************************************************************firt ekleme 1
 
             perform varying yi from 1 by 1 until yi > 9
                 move yi to yanrez-sirano
                 read yanrez no lock invalid
                     move 10 to yi
                    not invalid 
                     move takas-rec     to takas2-rec
                     move yanrez-sirano to takas2-sira
                     move yanrez-adi    to takas2-adi
                     move yanrez-soyadi to takas2-soyadi
                     write takas2-rec  invalid rewrite takas2-rec end-write
                 end-read 
             end-perform 
             move rez-tam-blok to takas-blok
               move rez-renk to takas-renk
          
               rewrite takas-rec invalid 
                    continue
               end-rewrite
            end-if
            if rez-durumu = "I" and rez-c-in <> "E" and 
               rez-k-g-b = "O" 
               move cast-oda-no     to  odalar-no takas-oda
               read odalar no lock invalid exit perform cycle
               end-read
               initialize takas-dbl
               read takas no lock invalid
                 continue
                 not invalid
                  if takas-rez > 0 or takas-folio > 0 then
                     move cast-rez-no to takas-dbl
                      
                 
                     write takas-rec  invalid
                     display message box "3Cakisma var Oda No:" takas-oda
                     end-write
                  end-if
               end-read

                 ||19 12 2014 alba salih
                     move takas-oda to rez-odano 
                     if onkpara-referans-var = 1 then 
                        perform ref-filtre
                        if  not ref-gecti then 
                           exit perform cycle
                      end-if
                    end-if
                |||||||||||

               move cast-rez-no     to takas-rez   takas-ger-rez
               move "H"             to takas-durumu
               move odalar-durumu   to takas-oda-durumu
               move rez-adi         to takas-adi     
               move rez-rehber      to takas-rehber
               move rez-soyadi      to takas-soyadi
               move rez-sharenum   to takas-sharenum
               move rez-share   to takas-share
               move  rez-no to yanrez-rezno
**************************************************************************firt ekleme 2
               if rez-no > 0 and yeni-renk-ver(1:1) > 0
                  evaluate yeni-renk-ver(1:1) 
                      when 1
                           open i-o nt
                           initialize not-rec
                           move "REZ"    to  NOT-DOS 
                           move rez-no to not-dos-anah                  
                           start nt key not < not-anah invalid
                                 continue
                           not invalid
                           perform with test after until fs-not = "10" 
                           read nt next no lock end move "10" to fs-not
                           not at end 
                           
                               if not-dos-anah = rez-no and not-dos = "REZ"
                                  move 1    to takas-mesaj-var
                               else 
                                  exit perform 
                               end-if
                           
                           end-read
                           end-perform
                           end-start
                           close nt
                      when 2
                           if rez-vip = "G" 
                              move 1        to takas-g-r
                           else 
                              move 0        to takas-g-r
                           end-if
                  end-evaluate
               end-if
**************************************************************************firt ekleme 2
             perform varying yi from 1 by 1 until yi > 9
                 move yi to yanrez-sirano
                 read yanrez no lock invalid
                     move 10 to yi
                    not invalid 
                     move takas-rec to takas2-rec
                     move yanrez-sirano to takas2-sira
                     move yanrez-adi to takas2-adi
                     move yanrez-soyadi to takas2-soyadi
                     write takas2-rec  invalid rewrite takas2-rec end-write
                 end-read 
             end-perform 
               move rez-renk to takas-renk
            
               rewrite takas-rec 
                invalid 
                 write takas-rec
               end-rewrite
            end-if
         end-if
    end-read
    end-perform
    end-start.
    close rez cast konuk yanrez .
*    accept yeni-t from time
*    display messaGe box eski-t yeni-t "---" kayit
*        accept yeni-t from time
    open input konuk ozluk ozluk2 yanrez rez.
    initialize konuk-rec
    move "I"      to konuk-durumu
    start konuk key not < konuk-oda invalid
          continue
    not invalid
    initialize fs-konuk
    perform with test after until fs-konuk = "10"
    read konuk next no lock end move "10" to fs-konuk
    not at end
         if konuk-durumu = "I" and konuk-fol-kodu = "R"
            initialize takas-rec
            move konuk-odano   to takas-oda odalar-anah  takas-oda-yeri            
            read odalar no lock invalid
                  exit perform cycle
            end-read
            
            initialize takas-dbl
               read takas no lock invalid
                 continue
                 not invalid
                  if takas-rez > 0 or takas-folio > 0 then
                     move konuk-rez-no to takas-dbl                      
                     write takas-rec  invalid  
                          display message box "5Cakisma Var Oda No:" takas-oda
                     end-write
                  end-if
               end-read
            if odalar-hayali = "H" then
               move konuk-folio to ozluk2-folio
               read ozluk2 no lock invalid
               continue 
               not invalid
               move ozluk2-birles-folio to takas-bir-folio               
            end-if
            move konuk-folio to ozluk-folio
            read ozluk no lock invalid continue
            not invalid
              move ozluk-plaka to takas-plaka
            end-read
            move konuk-rez-no      to takas-rez    takas-ger-rez

            move konuk-folio       to takas-folio
            move konuk-adi         to takas-adi     
            move konuk-soyadi      to takas-soyadi
            move konuk-rehber      to takas-rehber
            move "C"               to takas-durumu
            move konuk-sharenum    to takas-sharenum
            move konuk-share     to takas-share
             move  konuk-gunsonu-cout to takas-gunsonu-cout
            if konuk-git-tar = calisma-tarihi
               move "Q"            to takas-durumu
              
                    
              
            end-if
             move odalar-durumu   to takas-oda-durumu
               move  konuk-rez-no to yanrez-rezno rez-no
               read rez no lock invalid continue end-read
               move rez-tam-blok  to takas-blok
               move rez-renk to takas-renk
             perform varying yi from 1 by 1 until yi > 9
                 move yi to yanrez-sirano
                 read yanrez no lock invalid
                     move 10 to yi
                    not invalid 
                     move takas-rec to takas2-rec
                     move yanrez-sirano to takas2-sira
                     move yanrez-adi to takas2-adi
                     move yanrez-soyadi to takas2-soyadi
                     write takas2-rec  invalid rewrite takas2-rec end-write
                 end-read 
             end-perform  
                  ||19 12 2014 alba salih
                     move takas-oda to rez-odano
                     if onkpara-referans-var = 1 then 
                        perform ref-filtre
                        if  not ref-gecti then 
                           exit perform cycle
                      end-if
                    end-if
                |||||||||||

**************************************************************************firt  3
               if rez-no > 0 and yeni-renk-ver(1:1) > 0
                  evaluate yeni-renk-ver(1:1) 
                      when 1
                           open i-o nt
                           initialize not-rec
                           move "REZ"    to  NOT-DOS 
                           move rez-no to not-dos-anah                  
                           start nt key not < not-anah invalid
                                 continue
                           not invalid
                           perform with test after until fs-not = "10" 
                           read nt next no lock end move "10" to fs-not
                           not at end 
                           
                               if not-dos-anah = rez-no and not-dos = "REZ"
                                  move 1    to takas-mesaj-var
                               else 
                                  exit perform 
                               end-if
                           
                           end-read
                           end-perform
                           end-start
                           close nt
                      when 2
                           if rez-vip = "G" 
                              move 1        to takas-g-r
                           else 
                              move 0        to takas-g-r
                           end-if
                  end-evaluate
               end-if
************************************************ 11.09.2019 Kadir / Fýrat
               if rez-pre-cin = 1
                  if house-ok <> odalar-durumu and spaces
                     move 8    to takas-renk 
                  else
                     move 9    to takas-renk
                  end-if
               end-if
**************************************************************************firt ekleme 3
            rewrite takas-rec
              invalid              
                if odalar-hayali = "H" or odalar-dis = 1  then write takas-rec end-if
            end-rewrite
         end-if
    end-read
    end-perform
    end-start
    if hayali-son = 0 then
        perform birles-oku
    end-if
    close konuk  ozluk ozluk2   yanrez rez odalar .
    modify form1-gd-1,mass-update = 1 reset-grid = 1 
*          display message box "mass-update = 1 reset-grid = 1 "
     open input outof 
     open i-o rezodablok
     open i-o odalar
    initialize takas-rec 
    start takas key not < takas-oda-yeri invalid
          continue
    not invalid
     

    initialize fs-takas i odalar-ana-dizi yer-y
               oda-durum-toplamlari

    move 1 to i
    perform with test after until fs-takas = "10"
*       add 1 to i
      if i > max-oda-sayi2
*      if debug = 1 then stop " " move 0  to debug  end-if
         move takas-rec to yedek-rec 
         perform grid-satir-yaz
         move 1 to i
         move yedek-rec to takas-rec
         start takas key > takas-oda-yer invalid move "10" to fs-takas
         end-start
      else
         
         read takas next no lock end move "10" to fs-takas
           not at end


*        if takas-oda = "A901" then stop " " end-if
           

     initialize takaskont-rec
    evaluate true
       when  takas-durumu = "Q"
         move takas-oda to takaskont-oda 
         move "D" to takaskont-tip
         move takas-rez to takaskont-rez-no
         move takas-sharenum to takaskont-sharenum
         write takaskont-rec invalid 
           read takaskont end-read
           if takas-sharenum  = takaskont-sharenum and takas-sharenum not = 0 then 
             continue
             else
                  continue 
*           display message box 
*              new-line, new-line
*                new-line, new-line
*              "Oda No :" takas-oda " Double C/IN                                " new-line
*              "Rez No :" takaskont-rez-no  new-line, 
*              "Rez No :" takas-rez new-line,  new-line,
*               new-line, new-line  new-line, new-line icon 2 title "DIKKAT"
            end-if
           
         end-write
  
       when  takas-folio  < 1
         move takas-oda to takaskont-oda 
         move "B" to takaskont-tip
          move takas-rez to takaskont-rez-no
             move takas-sharenum to takaskont-sharenum
         write takaskont-rec invalid 
           read takaskont end-read
           if takas-sharenum  = takaskont-sharenum and takas-sharenum not = 0 then 
             continue
             else
             continue 
*                    display message box 
*                      new-line, new-line   new-line, new-line "Oda No :" takas-oda
*                      " Double Blokaj                               " new-line
*                      "Rez No :" takaskont-rez-no  new-line, 
*                      "Rez No :" takas-rez   new-line,  
*                       new-line, new-line  new-line, new-line new-line, icon 2 title "DIKKAT"
           end-if
         end-write



       when other
         move takas-oda to takaskont-oda 
         move "B" to takaskont-tip
          move takas-rez to takaskont-rez-no
                 move takas-sharenum to takaskont-sharenum
         write takaskont-rec invalid 
           read takaskont end-read
            if takas-sharenum  = takaskont-sharenum and takas-sharenum not = 0 then 
             continue
             else
                   continue 
*           display message box 
*           new-line   new-line, new-line
*           "Oda No :" takas-oda " Double C/IN                                 " new-line
*              "Rez No :" takaskont-rez-no  new-line, 
*              "Rez No :" takas-rez new-line, 
*               new-line, new-line                                     
*                new-line, new-line new-line, icon 2 title "DIKKAT"
                end-if
         end-write
         initialize takaskont-rec
         move takas-oda to takaskont-oda 
         move "D" to takaskont-tip
          move takas-rez to takaskont-rez-no
                   move takas-sharenum to takaskont-sharenum
         write takaskont-rec invalid 
         read takaskont end-read
          if (takas-sharenum  = takaskont-sharenum and takas-sharenum not = 0 ) or CINPARA-DOLU-ODAYA = "E"  then 
             continue
             else
                continue 
*          display message box 
*          new-line   new-line, new-line "Oda No :" takas-oda " Double CIN                                    " new-line
*              "Rez No :" takaskont-rez-no  new-line, 
*              "Rez No :" takas-rez   new-line,   new-line, new-line
*               new-line, new-line
*               new-line, icon 2 title "DIKKAT"
               end-if
         end-write



    end-evaluate
            initialize donus
           if takas-oda = spaces
              exit perform cycle
           end-if

           if takas-folio <> 0                    
               if sadece-bos-cb = 1
                  move 1 to donus
                  if rapor-rehber = takas-rehber and
                     rapor-rehber not = spaces
                        move 0 to donus
                  end-if
               end-if

              if rapor-rehber not = spaces
                 if rapor-rehber not = takas-rehber
                   and takas-rez > 0 then
                     move 1 to donus
                 end-if
             end-if
           else
           
               move 0 to donus
               if rapor-rehber not = spaces
                 if rapor-rehber not = takas-rehber
                   and takas-rez > 0 then
                     move 1 to donus
                 end-if
              end-if
               if takas-share not = 1  
                   add 1 to sadece-bos-sayi
               end-if
           end-if
           if donus = 1 
              exit perform cycle
           end-if
           if takas-folio = 0 and takas-rez <> 0
              add 1 to toplam-blokaj
           end-if
           perform cb-degerlendir
           if donus = 1 
              exit perform cycle
           end-if
           
           move takas-oda        to o-kisa 
            perform oda-uzat
            move o-uzun to  odalar-dizi(i)
           move takas-dbl       to dbl-dizi(i)
           add 1 to i
        end-read
        end-if
    end-perform
    end-start.
  
    if i > 0
       perform grid-satir-yaz 
    end-if
    modify form1-gd-1,mass-update = 0.
*    display message box    "modify form1-gd-1,mass-update = 0"
    open input takvim.
    move tarih-tasi         to takvim-anah
    read takvim no lock invalid
         display message box 
                 "Tarih bulunamadi ...."
                 icon mb_Error_icon
                 title "Hata",
                 initialize takvim-rec
    end-read
    close takvim odalar outof rezodablok.
    move takvim-hazir-oda     to satilabilir
    compute kullanim-disi = takvim-top-oda - satilabilir.
    display acc-100 acc-101 acc-102 acc-103 acc-104 acc-105
    acc-106 acc-107 acc-107b acc-107a acc-104a acc-107ba.

*    display acc-toplam-satilan
*            acc-toplam-blokaj.

*    display        acc-toplam-oda.
     .
*
 birles-oku.
     initialize takas-rec
      
    start takas key not < takas-oda-anah invalid
          continue
    not invalid
    initialize fs-takas 
    perform with test after until fs-takas = "10"
*    
         read takas next no lock end move "10" to fs-takas
           not at end
           if takas-bir-folio = zeroes
                  move takas-oda to takas-oda-yeri
                  
               else
                 move takas-bir-folio to konuk-folio
                 read konuk no lock invalid
                    move takas-oda to takas-oda-yeri
                    not invalid
*                    stop " "
                  if hayali-son = 0 then 
                    move konuk-odano to takas-oda-yeri
                 
                    rewrite takas-rec invalid stop " " end-rewrite
                   end-if
                 end-read
          end-if
          end-read
     end-perform
     end-start.

 Form1-Gd-1-Ev-Msg-Begin-Drag.
    initialize eski-x eski-y
    modify form1-gd-1,cursor-frame-width = 3
    inquire form1-gd-1,
            cursor-y in i
            cursor-x in ii
    inquire form1-gd-1(i,ii),cell-data in tasi-oda.
*
 Form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
    if eski-x = 0 and eski-y = 0
       continue
    else
       inquire form1-gd-1(eski-y,eski-x),
               hidden-data in cell-hidden
       modify form1-gd-1,(eski-y,eski-x),
               cell-data = cell-oda
               
    end-if.
    move event-data-1       to ii eski-x
    move event-data-2       to i  eski-y
    modify form1-gd-1(i,ii),cell-data = tasi-oda.
*
 Form1-Gd-1-Ev-Msg-End-Drag.
    display message box "Tasindi .....".
    initialize tasi-oda.
    modify form1-gd-1,cursor-frame-width = 2.
     .
*
 Form1-Gd-1-Ex-Other.
      
    if key-status > 1000 and key-status < 1050
       initialize durum-sayi
       compute durum-sayi = key-status - 1000 + 1
       inquire form1-gd-1,
             cursor-y in i
             cursor-x in ii
        if genel-uzun-oda-no-kullanilsin = 1 
            inquire form1-gd-1(i,ii),
             hidden-data = cell-hidden
             cell-data in temp-oda-u
            move     temp-oda-u     to o-uzun
            perform oda-kisalt
            move o-kisa to temp-oda    
        else
       inquire form1-gd-1(i,ii),
             hidden-data = cell-hidden
             cell-data in temp-oda
       end-if
       perform konum-degistir thru konum-degistir-exit
    end-if 
    evaluate key-status
        when 001 continue
*        when 004 perform cagir-bosdolu
        when 005 perform Form1-Cb-1aa-Ex-Cmd-Clicked
    end-evaluate.
 rez-durum-bul.
    open input rez konuk.
    initialize rez-rec
    move tarih-tasi      to rez-gir-tar
    move "I"             to rez-durumu
    start rez key not < rez-gir invalid
          continue
    not invalid
    initialize fs-rez
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end
         if rez-gir-tar > tarih-tasi or rez-durumu <> "I" 
            move "10" to fs-rez
            exit perform
         end-if
         if rez-k-g-b <> "K"
            exit perform cycle
         end-if
         if  rez-folio  > 0     
              add 1                         to ger-cin-oda
              add rez-buyuk,rez-kucuk   to ger-cin-pax
         end-if
         add 1                    to gel-bek-oda
         add rez-buyuk rez-kucuk  to gel-bek-pax
    end-read
    end-perform
    end-start.

    initialize rez-rec
    move tarih-tasi      to rez-cik-tar
    move "I"             to rez-durumu
    start rez key not < rez-cik invalid
          continue
    not invalid
    initialize fs-rez
    perform with test after until fs-rez = "10"
    read rez next no lock end move "10" to fs-rez
    not at end
         if rez-cik-tar > tarih-tasi
            move "10" to fs-rez
            exit perform
         end-if
         if rez-durumu <> "I" or rez-k-g-b <> "K"
            exit perform cycle
         end-if
         move  rez-folio       to konuk-folio
         read konuk no lock invalid
              move "I"        to konuk-durumu
         end-read
         if konuk-durumu = "H"
            add 1                       to ger-cout-oda
            add konuk-buyuk konuk-kucuk to ger-cout-pax
         end-if
         add 1                   to git-bek-oda
         add rez-buyuk rez-kucuk to git-bek-pax
    end-read
    end-perform
    end-start.
    close rez konuk.
*    accept eski-t from time
*    display message box  yeni-t eski-t "---" kayit
    compute doluluk-1 rounded = 
            (toplam-satilan  * 100) / satilabilir
    compute doluluk-2 rounded = 
            ((toplam-satilan + ger-cin-oda - ger-cout-oda) * 100) / satilabilir
    compute doluluk-3 rounded = 
            ((toplam-satilan + gel-bek-oda - ger-cin-oda - git-bek-oda + ger-cout-oda) * 100) / satilabilir
*    display acc-1 acc-2 acc-3 acc-4 acc-5 acc-6 acc-7
*    acc-8 acc-9 acc-10 acc-11 acc-12 acc-14
      .
 cb-degerlendir.
********************  BURDA KALDIM *********************
    initialize donus.
    evaluate true
       when   takas-durumu = "Q"
                 if takas-share = 0
                  add 1 to cout-oda-sayi
                  end-if
                if cout-oda-cb = 0
                   move 1 to donus
                end-if
       when takas-oda-durumu = house-ao and
             takas-durumu <> spaces   and takas-durumu not = "Q"
              if takas-share = 0
             add 1 to arizalidolu-oda-sayi
             end-if
             if arizali-dolu-oda-cb = 0  
                     move 1 to donus
             end-if
       when takas-oda-durumu = house-ao 
        if takas-share = 0
                  add 1 to arizalibos-oda-sayi
                  end-if
                  if arizali-oda-cb = 0
                    move 1 to donus   
                   end-if  
       when takas-oda-durumu = house-so 
               if takas-share = 0
                   add 1 to ooo-oda-sayi
                   end-if
                   if ooo-oda-cb = 0
                      move 1 to donus   
                   end-if 
       

       when  takas-durumu = "C"
           if takas-share not  = 1 
             add  1 to dolu-oda-sayi
          end-if
               if cin-oda-cb = 0
                   move 1 to donus   
               end-if 
         when takas-oda-durumu = house-touch   
               if takas-share = 0
                 add 1 to touch-oda-sayi 
                 end-if
                   if touch-oda-cb = 0 
                          move 1 to donus
                end-if
        when takas-durumu = "B" and
             takas-oda-durumu = house-ok  
               if takas-share not  = 1 
                 add 1 to blokajliok-oda-sayi
               end-if
               if blokajli-ok-oda-cb = 0
                         move 1 to donus
                end-if
        when takas-durumu = "B" and
               takas-oda-durumu = house-bt
               if takas-share not  = 1 
                 add 1 to blokajlitemiz-oda-sayi
               end-if
               if blokajli-temiz-oda-cb = 0
                     move 1 to donus
                end-if
         when takas-durumu = "B" 
               if takas-share not  = 1 
                   add 1 to blokajlikirli-oda-sayi
                end-if
                if blokaj-oda-cb = 0
                    move 1 to donus
                end-if
         when  takas-oda-durumu = house-bt     and takas-durumu = spaces
                 if takas-share = 0
                      add 1 to  bostemiz-oda-sayi
                      end-if
                    if  bos-temiz-oda-cb = 0 
                          move 1 to donus
                end-if

         when takas-oda-durumu not = house-bt   and takas-durumu = spaces
               if takas-share = 0
                 add 1 to boskirli-oda-sayi 
                 end-if
                   if bos-oda-cb = 0 
                          move 1 to donus
                end-if


        when other 
            continue
            
****               stop " "
      end-evaluate

    
     
     
    
             .
     

   

   
    
*
 oda-ayar.
         modify form1-gd-1,mass-update = 1 reset-grid = 1 
         evaluate max-oda-sayi2
           when 30         |  1  2  3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21   22   23   24   25   26   27   28   29   30    
                  modify Form1-Gd-1, 
                  COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS    (1, 5, 9,  13, 17, 21, 25, 29, 33, 37, 41, 45, 49, 53, 57, 61, 65, 69, 73, 77, 81,  85,  89,  93,  97,  101, 105, 109, 113, 117), 
              DISPLAY-COLUMNS (1, 5, 9,  13, 17, 21, 25, 29, 33, 37, 41, 45, 49, 53, 57, 61, 65, 69, 73, 77, 81,  85,  89,  93,  97,  101, 105, 109, 113, 117), 
              SEPARATION      (0, 0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,   0,   0,   0,   0,   0,   0,   0    ,0  , 0),
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,   1,   1,   1,   1,   1,   1,   1,    1,   1),    
              ROW-DIVIDERS = 1
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial6B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 121
             when 25         |  1  2  3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21   22   23   24   25   26   27   28   29   30    
                  modify Form1-Gd-1, 
                  COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS    (1, 5, 9,  13, 17, 21, 25, 29, 33, 37, 41, 45, 49, 53, 57, 61, 65, 69, 73, 77, 81,  85,  89,  93,  97, ), 
              DISPLAY-COLUMNS (1, 6, 11, 16, 21, 26, 31, 36, 41, 46, 51, 56, 61, 66, 71, 76, 81, 86, 91, 96, 101, 106, 111, 116, 121,), 
              SEPARATION      (0, 0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,   0,   0,   0,   0,  ),
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,   1,   1,   1,   1,  ),    
              ROW-DIVIDERS = 1
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial7B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 125
           
           when 5                                          
             modify Form1-Gd-1,
             COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 62.60 CELLS, 
              DATA-COLUMNS (1, 5, 9, 13, 17), 
              DISPLAY-COLUMNS (1, 7, 13,19,  25),
              SEPARATION (5, 5, 5, 5, 5), 
              COLUMN-DIVIDERS (5, 5, 5,5, 5), 
              ROW-DIVIDERS = 5 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial27B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 30
            when 7
              modify Form1-Gd-1, 
              COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS (1, 5, 9, 13, 17,21,25), 
              DISPLAY-COLUMNS (1, 7, 13,19,  25,31,37),
              SEPARATION (0, 0, 0, 0, 0,0,0), 
              COLUMN-DIVIDERS (5, 5, 5,5, 5,5,5), 
              ROW-DIVIDERS = 5 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial20B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 41
            when 10
              modify Form1-Gd-1, 
              COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS    (1, 5, 9, 13, 17, 21,  25 ,29, 33, 37), 
              DISPLAY-COLUMNS (1, 6, 11,16, 21, 26,  31, 36, 41, 46),
              SEPARATION      (5, 5, 5,  5,  5,  5,  5,  5,   5, 5), 
              COLUMN-DIVIDERS (3, 3, 3,  3,  3,  3,  3,  3,   3, 3), 
              ROW-DIVIDERS = 3 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial16B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
                 virtual-width = 51
           when 14
              modify Form1-Gd-1, 
              COL 17.10, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 65.20 CELLS, 
              DATA-COLUMNS    (1, 5, 9, 13, 17, 21,  25 ,29, 33, 37, 41, 45, 49, 53), 
              DISPLAY-COLUMNS (1, 6, 11,16, 21, 26,  31, 36, 41, 46, 51, 56, 61, 66),
              SEPARATION      (5, 5, 5,  5,  5,  5,  5,  5,   5, 5,   5, 5  ,5,  5), 
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,   1, 1,   1, 1,  1,  1),          
              ROW-DIVIDERS = 1 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial12B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 70
            when other      |  1  2  3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21   22   23   24   25   26   27   28   29   30    
             move 18 to  max-oda-sayi2
               modify Form1-Gd-1,
               COL 17.50, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.80 CELLS, 
              DATA-COLUMNS    (1, 5, 9,  13, 17, 21, 25, 29, 33, 37, 41, 45, 49, 53, 57, 61, 65, 69), 
              DISPLAY-COLUMNS (1, 6, 11, 16, 21, 26, 31, 36, 41, 46, 51, 56, 61, 66, 71, 76, 81, 86), 
              SEPARATION      (0, 0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0),
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1),    
              ROW-DIVIDERS = 1
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial9B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 90
             
     end-evaluate
       display Form1-Cm-1
           .
   
*
 Form1-Cb-1aa-Ex-Cmd-Clicked.
      

     perform cast-to-rez-oda-kontrol

     inquire Form1-Gd-1, x in kaldigi-yer-x, y in kaldigi-yer-y       
     close takas takas2 takaskont plaka.
     delete file takas takas2 takaskont.
     perform oda-ayar
     open i-o kllnc.
   
      move k-kodu-tasi  to k-kodu
      read kllnc no lock invalid continue
          
     
      end-read.
      move max-oda-sayi2 to k-rackde-satir
       rewrite kllnc-rec invalid display message box "Kullanici kodu yazilamadi" end-rewrite

      close kllnc.
 
    modify Form1-Gd-1   enabled = 0
    perform gride-yukle.
    modify Form1-Gd-1   enabled = 1
    perform rez-durum-bul.
    move kaldigi-yer-x to takas-x. 
    move kaldigi-yer-y to takas-y.
    move 1 to apodan-geldi.
*
 Form1-Gd-1-Ev-Msg-Begin-Entry.

*     display message box "hhhhhh"

*    move 6 to key-status

    move event-action-fail   to event-action. 
*    perform pop-up-exception
    
*    initialize  key-status
    .
*
 konum-degistir.
       if temp-oda = spaces 
          go konum-degistir-exit
       end-if.

      open i-o odalar.
      initialize odalar-rec.
      move temp-oda    to odalar-anah.
      read odalar no lock invalid 
           close odalar go konum-degistir-exit
           not invalid  continue
      end-read.
       move durum-kodu(durum-sayi) to odalar-durumu
                                      house-durumu .
       rewrite odalar-rec invalid continue.
       perform log-operation-odalar
       close odalar.
 konum-degistir-exit.
      exit.
         .
 grid-satir-yaz.
*       if (k-kodu-tasi = "ASYA"  or "X   ")  and takas-oda = "1147" then stop " " end-if 
    add 1 to yer-y
    modify form1-gd-1,record-to-add(odalar-ana-dizi)
    perform varying i from 1 by 1 until i > max-oda-sayi2
      move odalar-dizi(i)   to o-uzun
            perform oda-kisalt
            move o-kisa to    takas-oda
      move dbl-dizi(i) to takas-dbl
      read takas no lock invalid
          continue
        not invalid
            
          initialize renk
          move oda-bos-temiz-renk   to renk
             if takas-oda-durumu = house-bt
                 move oda-bos-temiz-renk-1  to renk
              end-if
              if takas-oda-durumu = house-ok
                 move oda-blokaj-renk-2  to renk  | eski hali oda-blokaj-renk-1 'di ramazan askin
              end-if
              if takas-oda-durumu = house-touch
                if takas-durumu = "B"
                   move oda-touch-blokaj-renk  to renk
                else
                   move oda-touch-renk  to renk
                end-if
              end-if
         
         
         
          initialize outof-rec
          move takas-oda   to outof-odano
          
          start outof key not < outof-anah invalid
                continue
          not invalid
          perform with test after until fs-outof = "10"
          read outof next no lock 
            end 
                 move "10"  to fs-outof
                   move takas-oda to odalar-anah
                   read odalar no lock invalid 
                   if k-kodu-tasi = "ASYA" or "X   "
                     stop " " 
                     end-if
                   continue
                   end-read
                   if takas-oda-durumu = house-so
                     if takas-durumu = "C"
                      move house-dk to odalar-durumu house-durumu
                      else
                      move house-bk to odalar-durumu house-durumu
                   end-if

                   rewrite odalar-rec invalid 
                     if k-kodu-tasi = "ASYA" or "X   "
                     stop " " 
                     end-if
                    not invalid
                      perform log-operation-odalar
                   end-rewrite
                   end-if

          not at end 
                move takas-oda to odalar-anah
                 if takas-oda not = outof-odano
                     move takas-oda to odalar-anah
                   read odalar no lock invalid 
                   if k-kodu-tasi = "ASYA" or "X   "
                     stop " " 
                     end-if
                   continue
                   end-read
                    if takas-oda-durumu = house-so
                     if takas-durumu = "C"
                      move house-dk to odalar-durumu house-durumu
                      else
                      move house-bk to odalar-durumu  house-durumu
                   end-if
                  
                   rewrite odalar-rec invalid 
                     if k-kodu-tasi = "ASYA" or "X   "
                     stop " " 
                     end-if
                    not invalid
                      perform log-operation-odalar
                   end-rewrite
                  end-if
                    exit perform 
                 end-if
                 if outof-bit-tarih < tarih-tasi
                    exit perform cycle 
                 end-if
                  if outof-bas-tarih > tarih-tasi
                    exit perform cycle 
                 end-if
                  move oda-ooo-renk   to renk
                 
                 if takas-oda-durumu = house-so
                   
                      exit perform 
                    else
                      move takas-oda to odalar-anah
                   read odalar no lock invalid 
                   if k-kodu-tasi = "ASYA" or "X   "
                     stop " " 
                     end-if
                   continue
                   end-read
                      move house-so to odalar-durumu  house-durumu
                  
                   rewrite odalar-rec invalid 
                     if k-kodu-tasi = "ASYA" or "X   "
                     stop " " 
                     end-if
                    not invalid
                      perform log-operation-odalar
                   end-rewrite
                  
                   exit perform 
                 end-if
                 
          end-read          
          end-perform
          end-start
         
*/out of order icin renk veriyorrrr
*/out of order icin renk veriyorrrr
*          modify form1-gd-1(yer-y,i),
*                 cell-color = renk
                
          if takas-durumu = "B"         
             move oda-blokaj-renk to renk
             if takas-oda-durumu = house-bt  or house-ok   or house-touch
              
                 move oda-blokaj-renk-1  to renk
                 if  takas-oda-durumu = house-ok
                    move oda-blokaj-renk-2  to renk
                 end-if
                 if  takas-oda-durumu = house-touch
                    move oda-touch-blokaj-renk  to renk
                 end-if
                 if takas-blok = 1 then 
                       move 174 to renk

                  end-if
                  else
                         if takas-blok = 1 then 
                               move 156 to renk
        
                          end-if
                end-if
                initialize rezodablok-rec
                 move takas-oda to rezodablok-odano
                  move takas-rez to rezodablok-rezno
                 read rezodablok no lock invalid 
                 continue
                 end-read
                 if rezodablok-qtar > "19000000"  then 
                      if  takas-oda-durumu = house-ok or house-bt
                     move oda-anahtar-hazir-renk to  renk
                    else
                       move oda-anahtar-bekle-renk to  renk

                    end-if
             end-if                  
          end-if
        
          if takas-durumu = "C"
             move oda-cin-renk    to renk
             if takas-oda-durumu = house-dk then 
               move  oda-cin-renk-1 to renk 
               
            end-if
             if takas-gunsonu-cout   =  1 then 
                   subtract 1 from renk
             end-if 
          end-if
          if takas-durumu = "Q"
             move oda-cout-renk   to renk
             if takas-gunsonu-cout   =  1 then 
                move 431 to renk
             end-if 
          end-if
          
          if   takas-oda-durumu = house-ao and  

               takas-durumu = spaces
             move oda-ariza-renk  to renk
          end-if
          if takas-oda-durumu = house-ao and 
             takas-durumu <> spaces  and takas-durumu not = "Q"
             move oda-arizali-dolu-renk to renk
          end-if
          if takas-durumu = "H"
           
             move oda-hu-renk  to renk
          end-if
          evaluate yeni-renk-ver(1:1)
              when 0
                   continue
              when 1 
                   if takas-mesaj-var = 1
                      move oda-mesaj-var-renk  to renk
                   end-if
              when 2 
                   if takas-g-r = 1 
                      move oda-gr-renk         to renk
                   end-if
          end-evaluate
          initialize cell-hidden
          move takas-oda        to cell-oda
          move takas-rez        to cell-rez
          move takas-folio      to cell-folio
          move takas-durumu     to cell-durumu
          move takas-oda-durumu to cell-oda-durumu
          move takas-blok       to cell-tam-blok
          move yer-y            to takas-y  cell-y
          move i                to takas-x   cell-x
           
       
          rewrite takas-rec 
             invalid
             display message box " Hata : 123998"
          end-rewrite

          evaluate takas-renk 
            when 2 
              move 48 to renk
            when 3
            move 46 to renk
            when 4
            move 208 to renk
            when 5            
            move 225 to renk
            when 6
            move 304 to renk
            when 7
            move 365 to renk

            when 8
            move oda-pre-cin-renk to renk

            when 9
            move oda-pre-cin-ok-renk to renk

          end-evaluate
          if takas-folio > 0 
           perform varying k 
                   from 1 
                   by 1 
                   until k > 200
                     if takas-oda = dizi-oda(k)
                       move 555 to renk
                     end-if 
           end-perform
          end-if
*          if takas-oda = "A901" stop " " end-if
          modify form1-gd-1(yer-y,i),
                 cell-color = renk
                 hidden-data = cell-hidden
                 
      end-read
    end-perform
    initialize odalar-ana-dizi
    move 1 to i
    .
 cagir-bosdolu.
    initialize bosdolu-cagir
    move combo-oda-konumu-value to bosdolu-ilk-konum
                                   bosdolu-son-konum
*    move combo-oda-tipi-value   to bosdolu-ilk-tip
*                                   bosdolu-son-tip
    call "/asya/ytl/obj/otel/bosdolu.asy"
      using bosdolu-cagir
      on exception 
        perform callerr-proc
      not on exception
        cancel "/asya/ytl/obj/otel/bosdolu.asy"
    end-call
    .
*
*
 Form1-Ex-Other.
     evaluate key-status
        
        when 1006
            call "/asya/ytl/obj/otel/ger-caci.asy"                         
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/ger-caci.asy"
            end-call 
            
        when 4 
            perform cagir-bosdolu
        when 2341
            call "/asya/ytl/obj/otel/hstatus.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/hstatus.asy"
                    end-call 
        when 5

            

             perform Form1-Cb-1aa-Ex-Cmd-Clicked
        when 1238
             perform bos-oda-bul
        when 1237
             perform beklenen-cikis
        when 1236
             perform in-house
        when 1235
             call "/asya/ytl/obj/otel/kart.asy" 
                        using ext-fol-no
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/kart.asy"
                    end-call 
                    perform kartlari-goster
        
        when 579            
           if cell-rez > 0 and cell-folio not > 0 then 
                 move takas-rez to rez-anah
                 read rez no lock invalid 
                     display message box "Okunamadi"
                     not invalid
                     if rez-tam-blok = 1 then 
                     move 0 to rez-tam-blok
                     else
                     move 1 to rez-tam-blok
                    end-if
                end-read
           end-if
        when 578
             
           if cell-rez > 0 then 
             call "/asya/ytl/obj/otel/renkata.asy" 
                           using rez-no
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/renkata.asy"
                    end-call 
           end-if
        when 173

          perform qal
        when 554
            call "/asya/ytl/obj/otel/tekrack1.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/tekrac1.asy"
                    end-call
       when 555
            call "/asya/ytl/obj/otel/blokyap.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/blokyap.asy"
                    end-call
        when 556
            call "/asya/ytl/obj/otel/gelrez.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/gelrez.asy"
                    end-call
         when 557
            call "/asya/ytl/obj/otel/gitrez.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/gitrez.asy"
                    end-call
         when 558
            call "/asya/ytl/obj/otel/blokaj01.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/blokaj01.asy"
                    end-call  
        when 559
            call "/asya/ytl/obj/otel/hkrack.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/hkrack.asy"
                    end-call
        when 1547
            call "/asya/ytl/obj/otel/telisle.asy" 
                        
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/telisle.asy"
                    end-call   
     end-evaluate.
*
 Form1-Gd-1-Ev-Other.
    evaluate event-type 
      when msg-begin-entry
*   space e bastý
         
        move event-action-fail   to event-action
     when Msg-Goto-Cell-Mouse
     when Msg-Goto-Cell
    end-evaluate.
     .
*
 oda-git. 
     perform kullandi.
     if apodan-geldi = 1 
       modify form1-gd-1
            cursor-x = takas-x
            cursor-y = takas-y
        if key-status = 5 and takas-x = 1 and takas-y = 1 then 
           continue
           else
              move takas-x to event-data-1
         move takas-y to event-data-2
            perform oda-git2
          end-if
      end-if  
  
       
       move 0 to apodan-geldi
        if not (event-data-1 > 0 and event-data-1< 22
           and event-data-2 > 0 and event-data-1 < 50)
             exit paragraph
        end-if

        if event-type = 3 
           exit paragraph 
        end-if 
        if bekle = 1
*            wait for last thread test only status in thread-status
*            if thread-status not = 99 then 
*              display message box thread-status
*             end-if
              exit paragraph
*            display message box bekle 
         end-if
        move  1 to bekle
          perform oda-git2  
*        display message box bekle
        initialize bekle
      . 
*
 oda-git2.
        initialize ext-bakiye-tl ext-bakiye-dov
         initialize rom-bakiye-tl rom-bakiye-dov 
*         display message box event-type "----" event-control-id 
*        inquire Form1-Gd-1, cursor-x in i cursor-y in ii
*        accept omitted before ime 0
     if genel-uzun-oda-no-kullanilsin = 1 
            inquire form1-gd-1(event-data-2, event-data-1), 
               cell-data = oda-num-u
               hidden-data = cell-hidden
              move  oda-num-u   to o-uzun
            perform oda-kisalt
            move o-kisa to oda-num     
     else
         inquire form1-gd-1(event-data-2, event-data-1), 
               cell-data = oda-num
               hidden-data = cell-hidden
     end-if
        move event-data-2    to ariza-i
        move event-data-1    to ariza-ii

        initialize odalar-rec
        open input odalar
        move oda-num to odalar-no
        read odalar no lock invalid continue
          not invalid
            initialize kodlar02-rec
            open input kodlar02
            move "C" to kodlar02-tipi
            move house-durumu to kodlar02-kodu
            read kodlar02 no lock invalid move all spaces to oda-drm
              not invalid
                move kodlar02-adi to oda-drm
            end-read
            initialize kodlar02-rec
           move "G" to kodlar02-tipi
           move odalar-tipi to kodlar02-kodu
           read kodlar02 no lock invalid
              continue 
           end-read
           move kodlar02-adi to oda-tipi-1
           
           initialize kodlar02-rec
           move "H" to kodlar02-tipi
           move odalar-tipi2 to kodlar02-kodu
           read kodlar02 no lock invalid
              continue 
           end-read
           move kodlar02-adi to oda-tipi-2

           initialize kodlar02-rec
           move "I" to kodlar02-tipi
           move odalar-tipi3 to kodlar02-kodu
           read kodlar02 no lock invalid
              continue 
           end-read
           move kodlar02-adi to oda-tipi-3
            
            close kodlar02
        end-read
        close odalar
        display Form1-Ef-1aaaa
        display Form1-Ef-ack1 Form1-Ef-ack2
        Form1-Ef-tip1 Form1-Ef-tip2 Form1-Ef-tip3
        initialize oda-acik-girildi
        perform oda-bil-update
      . 
*
 sag-tus-basildi.
        open input kllnc
     move k-kodu-tasi             to k-kodu
     read kllnc no lock invalid
          move 1    to k-kisi-goremez
     end-read
     close kllnc


             initialize xk-durum-degistiremez
             move k-durum-degistiremez to xk-durum-degistiremez 
      
*     perform oda-git
      call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 1
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 12
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 21

      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 20
      call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 8
      call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 23
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 148
      
     
      if cell-rez > 0 then 
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 578
        
      else
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 578
         
     end-if
     
      if cell-rez > 0 and cell-folio not > 0 then 
          
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 173
      else
         
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 173
     end-if
     |////KUSADASI RAMADA ICIN KONULDUU
      if xk-durum-degistiremez = 1
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 100
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 169
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 101
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 102
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 173
      else
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 100
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 169
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 101
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 102
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 173

      end-if
     |////

      call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 18
      if cell-folio > 0 then 
        move "Register K\tCtrl-N"  to x-20
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 579
        
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 6
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 21
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 8
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 7
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 148
        
        call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 11
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 5
        if cell-durumu = "Q" then 
           call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 20
          else 
            continue
*           call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 12
        end-if
        else
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 6
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 7
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 11
        call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 5
        if cell-rez > 0
           move "Check-In\tCtrl-N" to x-20
           call "w$menu" using WMENU-enable, Form1-Mn-1-Handle, 148
                 
        else
           move "WalkIn C/In\tCtrl-N" to x-20
           call "w$menu" using WMENU-DISABLE, Form1-Mn-1-Handle, 1
           call "w$menu" using WMENU-disable, Form1-Mn-1-Handle, 23

        end-if
        
       call "w$menu" using WMENU-ENABLE, Form1-Mn-1-Handle, 579
          if cell-tam-blok = 1 then 
              move "Tam Blokaji Kaldir" to x-201
          else
              move "Tam Blokaj At" to x-201
          end-if
        
          call "w$menu" using wmenu-change,
                                Form1-Mn-1-Handle,
                                579,
                                0,
                                x-201,
                                579

     end-if
     call "w$menu" using wmenu-change,
                                Form1-Mn-1-Handle,
                                14,
                                0,
                                x-20,
                                14
     call "w$menu" using wmenu-show
     .
*
 bulunana-git.
        modify form1-gd-1
            cursor-x = takas-x
            cursor-y = takas-y
         .
         move takas-x to event-data-1
         move takas-y to event-data-2
         perform oda-git2
         .
*
 oda-ara.
     if ara-oda not = spaces then 
       initialize takas-rec
        move ara-oda   to o-uzun
            perform oda-kisalt
            move o-kisa to     takas-oda 
        read takas no lock 
            invalid
              display message box takas-oda 
               " nolu oda rack de bulunamadi"
            not invalid
                perform bulunana-git
        end-read
     end-if
      .
*
 adi-yok.    
    display message box "Adi " ara-adi(1:ara-adi-u) 
       " ile baslayan baska oda bulunamadi".
*
 plaka-yok.
    display message box "Plakasi " ara-plaka(1:ara-plaka-u) 
       " ile baslayan baska oda bulunamadi".
*
 soyadi-yok.
    display message box "Soyadi " ara-soyadi(1:ara-soyadi-u) 
       " ile baslayan baska oda bulunamadi".
*
 adi-ara.
     initialize adi-bitti
     if ara-adi not = spaces then 
******************************************* firat 1/7/2021 icinde ara kapatildi
*        perform adi-icinde-ara
*        move takas13-adi to takas2-adi 
*        start takas2 key >= takas2-adi
*          invalid
*            perform adi-yok
*            move 1 to adi-bitti
*            not invalid
*               perform sonraki-adi
*        end-start

*******************************************        
        perform varying ara-adi-u from 20 by -1 
          until ara-adi(ara-adi-u:1) not = space
           if ara-adi-u = 1 then 
               exit perform
           end-if
        end-perform  

        move ara-adi to takas2-adi 
        start takas2 key >= takas2-adi
          invalid
            perform adi-yok
            move 1 to adi-bitti
            not invalid
               perform sonraki-adi
        end-start
      end-if.
*
 adi-icinde-ara.
     perform takas13-dosya-ac
     open i-o konuk yanrez takas13
     initialize konuk-rec 
     start konuk key not < konuk-anah invalid
           continue
     not invalid
     perform with test after until fs-konuk = "10" 
     read konuk next no lock end move "10" to fs-konuk
     not at end

         initialize yanrez-rec 
         move konuk-rez-no to yanrez-rezno 
         move 1            to yanrez-sirano
         start yanrez key not < yanrez-anah invalid
               continue
         not invalid
         perform with test after until fs-yanrez = "10" 
         read yanrez next no lock end move "10" to fs-yanrez
         not at end 
             
             if yanrez-rezno <> konuk-rez-no
                exit perform 
             end-if

             move function upper-case(yanrez-adi)         to kelime
             move function upper-case(ara-adi)            to aranan-kelime
             move 0                                       to aranan-i 
                                                             aranan-kelime-boy

             inspect aranan-kelime tallying aranan-kelime-boy
                                   for trailing spaces 

             compute aranan-kelime-boy = function length(aranan-kelime) -
                                         aranan-kelime-boy
             
             inspect kelime tallying aranan-i 
                     for all aranan-kelime(1:aranan-kelime-boy)

             if aranan-i = 0 
                exit perform cycle
             end-if

             initialize takas13-rec 
             move konuk-odano  to takas13-oda
             read takas13 no lock invalid
                  exit perform cycle
             end-read
 
             move yanrez-adi   to takas13-adi
             write takas13-rec invalid
                   if k-kodu-tasi = "ASYA" stop " " end-if
             end-write 

         end-read 
         end-perform 
         end-start 

     end-read 
     end-perform 
     end-start 
     initialize takas13-rec 
     start takas13 key not < takas13-oda-anah invalid
           continue
     not invalid
     perform with test after until fs-takas13 = "10" 
     read takas13 next no lock end move "10" to fs-takas13
     not at end 
         exit perform 
     end-read 
     end-perform 
     end-start 
     close konuk yanrez takas13
     .
* 
 takas13-dosya-ac.
     open i-o genelfis
     initialize genelfis-rec
     move 1 to genelfis-anahtar
     read genelfis no lock invalid 
          move 1 to ekran-fis-1
     not invalid 
         add 1 to ekran-fis-1
         move ekran-fis-1 to takas13-no
         rewrite genelfis-rec invalid continue end-rewrite  
     end-read 
     close genelfis
     open output takas13 close takas13 
    .
     .
*
plaka-ara.
     initialize plaka-bitti
     if ara-plaka not = spaces then 
        
        perform varying ara-plaka-u from 15 by -1 
          until ara-plaka(ara-plaka-u:1) not = space
           if ara-plaka-u = 1 then 
               exit perform
           end-if
        end-perform  
        if genel-plaka not = 1
        move ara-plaka to takas-plaka 
        start takas key >= takas-plaka
          invalid
            perform plaka-yok
            move 1 to plaka-bitti
            not invalid
               perform sonraki-plaka
        end-start
        else
          move ara-plaka to plaka-text
        start plaka key >= plaka-text
          invalid
            perform plaka-yok
            move 1 to plaka-bitti
            not invalid
               perform sonraki-plaka
        end-start


        end-if
      end-if.
*
 soyadi-ara.
     initialize soyadi-bitti
     if ara-soyadi not = spaces then 
        
        perform varying ara-soyadi-u from 20 by -1 
          until ara-soyadi(ara-soyadi-u:1) not = space
           if ara-soyadi-u = 1 then 
               exit perform
           end-if
        end-perform  
       
        move ara-soyadi to takas2-soyadi 
        start takas2 key >= takas2-soyadi
          invalid
            perform soyadi-yok
            move 1 to soyadi-bitti
            not invalid
               perform sonraki-soyadi
        end-start
      end-if
      .
*
 sonraki-adi.
     if adi-bitti = 1 then 
        perform adi-ara
       else 
         read takas2 next no lock 
           end 
             perform adi-yok
             move 1 to adi-bitti
           not end
             if takas2-adi(1:ara-adi-u) not = 
                ara-adi(1:ara-adi-u) 
                perform adi-yok
                move 1 to adi-bitti
                else
                 move takas2-rec to takas-rec
                 read takas no lock invalid
                 continue
                 end-read
                 perform bulunana-git
             end-if
         end-read
      end-if.  
*
 sonraki-soyadi.
     if soyadi-bitti = 1 then 
        perform soyadi-ara
       else 
         read takas2 next no lock 
           end 
             perform soyadi-yok
             move 1 to soyadi-bitti
           not end
             if takas2-soyadi(1:ara-soyadi-u) not = 
                ara-soyadi(1:ara-soyadi-u) 
                perform soyadi-yok
                move 1 to soyadi-bitti
                else
                move takas2-rec to takas-rec
                 read takas no lock invalid
                 continue
                 end-read
                 perform bulunana-git
             end-if
         end-read
      end-if.
*
 sonraki-plaka.
     if plaka-bitti = 1 then 
        perform plaka-ara
       else 
        if genel-plaka not = 1
         read takas next no lock 
           end 
             perform plaka-yok
             move 1 to plaka-bitti
           not end
             if takas-plaka(1:ara-plaka-u) not = 
                ara-plaka(1:ara-plaka-u) 
                perform plaka-yok
                move 1 to plaka-bitti
                else                       
                 perform bulunana-git             
             end-if
         end-read

         else 
         perform  until 1 = 0
            read plaka next no lock 
           end 
             perform plaka-yok
             move 1 to plaka-bitti
               exit perform
           not end
             if plaka-text(1:ara-plaka-u) not = 
                ara-plaka(1:ara-plaka-u) 
                perform plaka-yok
                move 1 to plaka-bitti
                exit perform
                else 
                move plaka-folio to takas-folio 
                read takas key takas-folio 
                    invalid 
                     exit perform cycle
                   not invalid
                     perform bulunana-git  
                     exit perform 
             end-if
         end-read
         end-perform


         end-if
      end-if.
*
 pop-up-exception.
      
     inquire form1-gd-1,
                     cursor-y in i
                     cursor-x in ii
      if genel-uzun-oda-no-kullanilsin = 1 
            inquire form1-gd-1(i,ii),
             hidden-data = cell-hidden
             cell-data in temp-oda-u
            move     temp-oda-u     to o-uzun
            perform oda-kisalt
            move o-kisa to temp-oda    
        else
       inquire form1-gd-1(i,ii),
             hidden-data = cell-hidden
             cell-data in temp-oda
       end-if        
*     inquire form1-gd-1(i,ii),
*                     hidden-data = cell-hidden
*                     cell-data in temp-oda
         if temp-oda = spaces
                exit paragraph
             end-if
         
     evaluate key-status
         when 174
              open i-o rez odalar
              initialize rez-rec 
              move cell-rez to rez-no 
              read rez no lock invalid  
                   display message box "Rezervasyon kaydi bulunamadi.."
              not invalid
                  initialize odalar-rec 
                  move rez-odano to odalar-no
                  read odalar no lock invalid
                       display message box "Oda tanimlamasi bulunamadi.."
                  not invalid
                      if house-ok <> spaces and odalar-durumu
                         display message box "Oda durumu OK degil kontrol ediniz.."
                         close rez odalar
                         if rack-oto-tazele = 1
                            perform Form1-Cb-1aa-Ex-Cmd-Clicked
                         end-if           
                         exit paragraph
                      end-if
                  end-read 
              end-read 

              initialize rez-pre-cin

              accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
              accept rez-edit-zaman from time          |                           
  
              rewrite rez-rec end-rewrite 

              close rez odalar
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if           
         when 169
           if cell-rez not > 0 then 
             display message box " Blokajsiz Oda OK giremezsiniz" new-line 
                                 " Odayi temizlemeyi deneyin...." new-line
                                  title "Blokajsiz oda"
               exit paragraph 
           end-if
           open i-o odalar
                
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
            if house-ok not = spaces 
              move House-ok to odalar-durumu house-durumu
              move cell-rez to house-ok-rezno
              else
                if cell-folio  = 0 
              move  HOUSE-BT  to ODALAR-DURUMU
              move HOUSE-BT   to HOUSE-DURUMU 
              else
               move  HOUSE-DT to ODALAR-DURUMU
               move HOUSE-DT  to HOUSE-DURUMU 
              
               end-if 
            end-if
 
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
          perform log-operation-odalar
             
        close odalar   
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if           
        when 100
           open i-o odalar
       
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          if cell-folio  = 0 
              move  HOUSE-BT  to ODALAR-DURUMU



              move HOUSE-BT   to HOUSE-DURUMU 
              else
               move  HOUSE-DT to ODALAR-DURUMU
               move HOUSE-DT  to HOUSE-DURUMU 
              
            end-if 
********************* kapý kilit kapi kilit wolfex delphin yildirim yýldýrým 
*              call "c$system" using "C:\Users\MAMI-W7\Desktop\Project2.exe 1011 SOFTWARE",CSYS-DESKTOP 
*                giving return-code
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read
          perform log-operation-odalar
        close odalar   
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
          
         
        when 101
          open i-o odalar
       
            read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          if cell-folio  = 0 
              move  HOUSE-BK  to ODALAR-DURUMU
               move HOUSE-BK    to HOUSE-DURUMU 
              
          else
               move  HOUSE-DK  to ODALAR-DURUMU
                move HOUSE-DK     to HOUSE-DURUMU 
              
            end-if 
        
          rewrite odalar-rec invalid stop " " end-rewrite
              perform log-operation-odalar
          end-read
        close odalar   
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
          
          
        when 131
             if genel-touch-kullan = space or zero                             || genel parametreye baglandi
                display message box "Touch Parametresi Kapali" title " "
                exit paragraph
             end-if      
             open i-o odalar
             read odalar no lock invalid
                  display message box "Lutfen oda seciniz" title " "
             not invalid
                 move  HOUSE-touch  to ODALAR-DURUMU
                                       HOUSE-DURUMU 
                 rewrite odalar-rec invalid stop " " end-rewrite
                 perform log-operation-odalar
             end-read
             close odalar   
             if rack-oto-tazele = 1
                perform Form1-Cb-1aa-Ex-Cmd-Clicked
             end-if 
          
        when 102
          open i-o odalar
       
          read odalar no lock invalid
             display message box "Lutfen oda seciniz" title " "
              not invalid
           
          
               move  HOUSE-AO  to ODALAR-DURUMU  HOUSE-DURUMU 
              
            
              rewrite odalar-rec invalid stop " " end-rewrite
                  perform log-operation-odalar
            end-read
            close odalar
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

            when 579
              
           if cell-rez > 0 and cell-folio not > 0 then 
                 move cell-rez to rez-anah
                 open i-o rez
                 read rez no lock invalid 
                     display message box "Okunamadi"
                     not invalid
                     if rez-tam-blok = 1 then 
                     move 0 to rez-tam-blok
                     else
                     move 1 to rez-tam-blok

                    end-if
                end-read

                accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                accept rez-edit-zaman from time          |                           

                rewrite rez-rec invalid display message box "Rez Yazilamadi --Hata no :4555555"
                  end-rewrite
                close rez
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

           end-if

        when 578
          if cell-rez > 0 then 
             call "/asya/ytl/obj/otel/renkata.asy" 
                           using rez-no
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/renkata.asy"
                    end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
           
          end-if
         when 173
          perform qal
          
        when 1699
           initialize link-wakeup-hepsi
           move cell-rez        to  link-wakeup-rezno
           move cell-oda        to  link-wakeup-odano
           if cell-rez > 0
             call "/asya/ytl/obj/otel/wakeup.asy" 
                           using link-wakeup-hepsi
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/wakeup.asy"
                    end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
           
           end-if
        when 170

         if telpara-dishat-ac-kapa = 1 
             initialize telayarq-dosya-adi  telayarq-rec
             move cell-oda to telayarq-dosya-adi
             move ".may"   to telayarq-dosya-adi(5:4)
             open output telayarq  
      
             move cell-oda to telayarq-odano   
             if cell-folio > 0 then 
                 move cell-folio to     telayarq-folio
                 move konuk-adi to  telayarq-adi
                 move konuk-soyadi to  telayarq-soy
             end-if

             accept telayar-tarih from century-date 
             accept telayar-saat from time 
              move telayar-saat to telayarq-saat 
              move telayar-tarih to telayarq-tarih  
             
              move "A " to  telayarq-islem

                 if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
             move  telayarq-odano(2:) to telayarq-odano(1:)
             move " " to   telayarq-odano(4:1) 
          end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
               write telayarq-rec  end-write
               close telayarq
         end-if 
          if genel-4ipnet-devrede = 1
             perform 4ipnet-internet-ac
          end-if 
         
        when 171
          initialize telayarq-dosya-adi  telayarq-rec
          move konuk-odano to telayarq-dosya-adi
          move ".may" to telayarq-dosya-adi(5:4)
          open output telayarq  
          move konuk-odano to telayarq-odano   
          if konuk-folio > 0 then 
             move konuk-folio to     telayarq-folio
          end-if
           accept telayar-tarih from century-date 
          accept telayar-saat from time 
           move telayar-saat to telayarq-saat 
          move telayar-tarih to telayarq-tarih  
           move "K " to  telayarq-islem 
              if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
             move  telayarq-odano(2:) to telayarq-odano(1:)
             move " " to   telayarq-odano(4:1) 
          end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
            write telayarq-rec  end-write
            close telayarq
          
        WHEN 103
            
         if  telpara-dishat-ac-kapa = 1 then 
              open input telkod
             initialize telayarq-dosya-adi telayar-rec telayarq-rec
             if function numval(cell-oda) < 1000
                  move cell-oda to telayarq-dosya-adi(1:3)
                  move ".tay" to telayarq-dosya-adi(4:4)
             else 
                 move cell-oda to telayarq-dosya-adi
                 move ".tay" to telayarq-dosya-adi(5:4)
             end-if              
             
*             move cell-oda to telayarq-dosya-adi
*             move ".tay" to telayarq-dosya-adi(5:4)


             open output telayarq  
             open i-o telayar
***             move cell-oda to telayarq-odano  telayar-odano 
                if TELPARA-dishat-ac-kapa-dahili = 1
             initialize telkod-rec kayit-var
             start telkod key not < telkod-anah invalid 
                 continue 
             not invalid 
             perform with test after until fs-telkod = "10"
             read telkod next no lock end move "10" to fs-telkod
             not at end 
                     if tel-onb-oda = cell-oda
                         move TEL-ODA to telayarq-odano  telayar-odano
                         move 1       to kayit-var
                     else
                        exit perform cycle 
                     end-if 
             end-read 
             end-perform
             end-start
             if kayit-var not = 1
               move cell-oda to telayarq-odano  telayar-odano 
             end-if 
          else
                move cell-oda to telayarq-odano  telayar-odano 
          end-if 

             if cell-folio > 0 then 
                 move cell-folio to  telayar-folio   telayarq-folio
                 move konuk-adi to telayar-adi telayarq-adi
                 move konuk-soyadi to telayar-soy telayarq-soy
             end-if
             accept telayar-tarih from century-date 
             accept telayar-saat from time 
              move telayar-saat  to telayarq-saat 
              move telayar-tarih to telayarq-tarih  
             
              move "A " to telayar-islem telayarq-islem
              
              if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
                 move  telayarq-odano(2:) to telayarq-odano(1:)
                 move " " to   telayarq-odano(4:1) 
              end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
              write telayar-rec invalid continue end-write
               write telayarq-rec  end-write
               close telayarq

                if function numval(cell-oda) < 1000
                    move ".may" to telayarq-dosya-adi(4:4)
                  else 
                move ".may" to telayarq-dosya-adi(5:4)
        
                  end-if 
               

               if cell-folio > 0
                  move konuk-adi to telayar-adi telayarq-adi
                  move konuk-soyadi to telayar-soy telayarq-soy
              end-if 
               open output telayarq 
               write telayarq-rec  end-write
               close telayar telkod telayarq
         end-if          
         WHEN 104
          
         if  TELPARA-dishat-ac-kapa = 1 then 
          open input telkod
          initialize telayarq-dosya-adi telayar-rec telayarq-rec

        if function numval(cell-oda) < 1000
             move cell-oda to telayarq-dosya-adi(1:3)
             move ".tay" to telayarq-dosya-adi(4:4)
          else 
            move cell-oda to telayarq-dosya-adi
            move ".tay" to telayarq-dosya-adi(5:4)

          end-if 
*          move cell-oda to telayarq-dosya-adi
*          move ".tay" to telayarq-dosya-adi(5:4)


          open output telayarq  
          open i-o telayar
                if TELPARA-dishat-ac-kapa-dahili = 1
             initialize telkod-rec kayit-var
             start telkod key not < telkod-anah invalid 
                 continue 
             not invalid 
             perform with test after until fs-telkod = "10"
             read telkod next no lock end move "10" to fs-telkod
             not at end 
                     if tel-ONB-oda = cell-oda
                         move TEL-ODA to telayarq-odano  telayar-odano
                         move 1       to kayit-var
                     else
                        exit perform cycle 
                     end-if 
             end-read 
             end-perform
             end-start
             if kayit-var not = 1
               move cell-oda to telayarq-odano  telayar-odano 
             end-if 
          else
                move cell-oda to telayarq-odano  telayar-odano 
          end-if 

          


          if cell-folio > 0 then 
             move cell-folio to  telayar-folio   telayarq-folio
          end-if
           accept telayar-tarih from date 
          accept telayar-saat from time 
           move telayar-saat to telayarq-saat 
          move telayar-tarih to telayarq-tarih  
           move "K " to telayar-islem telayarq-islem 
              if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayarq-odano(1:1) = "0"
             move  telayarq-odano(2:) to telayarq-odano(1:)
             move " " to   telayarq-odano(4:1) 
          end-if
           if  TELPARA-dishat-ac-kapa-ignore = 1 and  telayar-odano(1:1) = "0"
             move  telayar-odano(2:) to telayar-odano(1:)
             move " " to   telayar-odano(4:1) 
          end-if
           write telayar-rec invalid continue end-write
            write telayarq-rec  end-write
            close telayarq
***            move ".may" to telayarq-dosya-adi(5:4)
                if function numval(cell-oda) < 1000
                    move ".may" to telayarq-dosya-adi(4:4)
                else 
                   move ".may" to telayarq-dosya-adi(5:4)        
                end-if 
            open output telayarq 
            write telayarq-rec  end-write
            close telkod telayar telayarq
           end-if
        when 1
             initialize aramayap
             move 1 to vis-ara2
             move 0 to vis-ara1 vis-ara3 vis-ara4
             perform acu-form2-routine
             if aramayap= 1  then
              perform adi-ara
            end-if
            move 1 to control-id control-value
            move 4 to accept-control
        when 3
            evaluate true 
              when vis-ara2 = 1 
                  perform sonraki-adi
              when vis-ara1 = 1 
                  perform oda-ara
              when vis-ara3 = 1 
                  perform sonraki-soyadi
              when vis-ara4 = 1 
                  perform sonraki-plaka

            end-evaluate   
         when   17 
           move "U"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           move rez-anah to link-NOT-DOS-ANAH  
               
            move 1 to link-nereden 
           string rez-adi delimited by "  "
                  " " delimited by size
                  rez-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli rezervasyon" delimited by size
                  into link-dosya-aciklamasi
     
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
                  display not-ac
        when 15
             initialize aramayap
             move 1 to vis-ara1
             move 0 to vis-ara2 vis-ara3 vis-ara4
             perform acu-form2-routine
              if aramayap= 1  then
                 perform oda-ara
              end-if
              move 1 to control-value
            move 4 to accept-control
        when 16
             initialize aramayap
             move 1 to vis-ara4
             move 0 to vis-ara2 vis-ara1 vis-ara3
             perform acu-form2-routine
              if aramayap= 1  then
                 perform plaka-ara
              end-if
              move 1 to control-id
              move 4 to accept-control
        when 19
             initialize aramayap
             move 1 to vis-ara3
             move 0 to vis-ara2 vis-ara1 vis-ara4
             perform acu-form2-routine
              if aramayap= 1  then
              perform soyadi-ara
              end-if
              move 1 to control-id  control-value
            move 4 to accept-control
       when 18 
            if cell-rez > 0
             initialize dokcagir-tasi
             set dokcagir-tasi-call-rez1   to true
             move cell-rez                   to dokcagir-rez-no
             perform dokcagir-call
             move dokcagir-rez-no          to rez-no              
            end-if 
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

        when 14
                  
                 

                  if cell-rez > 0 then
                    if cell-folio = 0 then 
                      move 99999998 to cell-folio
                    end-if
**************************> rezcin.asy
                    initialize dokcagir-tasi
                    set dokcagir-tasi-call-cin2    to true
                    move cell-rez                  to dokcagir-konuk-rez-no
                    move cell-folio                to dokcagir-konuk-folio
                    perform dokcagir-call
                    move dokcagir-konuk-folio      to cell-folio
                    move dokcagir-konuk-rez-no     to cell-rez
                      if rack-oto-tazele = 1










                         perform Form1-Cb-1aa-Ex-Cmd-Clicked
                      end-if 
                  else
**************************> CIN CALL 3 PARAMETRELI CAGIRMA
                    initialize dokcagir-tasi
                    set dokcagir-tasi-call-cin3    to true
                    move cell-rez                  to dokcagir-konuk-rez-no
                    move cell-folio                to dokcagir-konuk-folio
                    move temp-oda                  to dokcagir-konuk-odano
                    perform dokcagir-call
                    move dokcagir-konuk-folio      to cell-folio
                    move dokcagir-konuk-rez-no     to cell-rez
                    move dokcagir-konuk-odano      to temp-oda
                      if rack-oto-tazele = 1
                         perform Form1-Cb-1aa-Ex-Cmd-Clicked
                      end-if 
        
                  end-if
          when 11
               if konuk-durumu = "I" and 
                  calisma-tarihi <= konuk-git-tar and 
                  calisma-tarihi >= konuk-gel-tar
**************cekgir.asy
                  initialize dokcagir-tasi
                  set dokcagir-tasi-call-kfolio  to true
                  move cell-folio                to dokcagir-konuk-folio 
                  
                  perform dokcagir-call
                 
              end-if
         when 6
          if cell-folio > 0 then 
           call "/asya/ytl/obj/otel/folio.asy" 
            using  cell-folio
            on exception 
             perform callerr-proc
             exit paragraph
            not on exception 
             cancel "/asya/ytl/obj/otel/folio.asy"
          end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

          end-if
         when 7
           if cell-folio > 0 then 
          call "/asya/ytl/obj/otel/folio.asy" 
            using  ext-fol-no
            on exception 
             perform callerr-proc
             exit paragraph
            not on exception 
             cancel "/asya/ytl/obj/otel/folio.asy"
          end-call
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

          end-if
 
         when 12
         when 20
**************************> cout.asy
           if genel-dosya-kilit-devrede <> 1
              initialize dokcagir-tasi
              set dokcagir-tasi-call-cout2   to true
              move temp-oda                  to dokcagir-konuk-odano
              move cell-folio                to dokcagir-konuk-folio
              perform dokcagir-call
              move dokcagir-konuk-odano      to temp-oda
              move dokcagir-konuk-folio      to cell-folio
                 call "w$keybuf" using 3 end-call 
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if
            end-if
          when 8
**************************> odadegis.asy
              initialize dokcagir-tasi
              set dokcagir-tasi-call-odadegis1  to true
              move temp-oda                     to dokcagir-konuk-odano
              perform dokcagir-call
              move dokcagir-konuk-odano         to temp-oda
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 

           when 21
**************************> uzatma.asy
              initialize dokcagir-tasi
              set dokcagir-tasi-call-uzatma1    to true
              move temp-oda                     to dokcagir-konuk-odano
              perform dokcagir-call
              move dokcagir-konuk-odano         to temp-oda
              if rack-oto-tazele = 1
                 perform Form1-Cb-1aa-Ex-Cmd-Clicked
              end-if 
         when 23
******************************kartkap2.asy
             perform Form1-Mn-1-MI-oda-kart-Link
    end-evaluate.
*
 oda-bil-update.
        move cell-folio to konuk-folio
        initialize geceleme  q-vis
      evaluate true  
            when cell-folio > 0
                 move 1 to oda-vis
                 perform oda-bilgi-fol
                 perform geceleme-bul
            when cell-rez > 0
                 move 0 to v-nopost
                 move 1 to oda-vis
                 perform oda-bilgi-fol
                 perform geceleme-bul
             when other
               move 0 to oda-vis  v-vip
                move 0 to v-nopost
               open input konum 
               move odalar-konumu to konum-anahtar
                read konum no lock 
                     invalid move "**********" to konum-adi
                  end-read
                 move konum-adi to oda-knm
                 move odalar-aciklama1   to oda-ack1
               move odalar-aciklama2-1   to oda-ack2
                close konum
    end-evaluate.
    perform bilgi-yaz.

 bilgi-yaz.
*     if k-kisi-goremez = 1 then 
*       initialize konuk-buyuk
*       
*     end-if
*     if k-kodu-tasi = "ASYA" and konuk-buyuk = 0 then 
*         stop " "
*
*     end-if
        open input yanrez
     initialize yerler
     string konuk-adi delimited by "   "
            "-" delimited by size
            konuk-soyadi delimited by "  "
            into ad-soyad(1)
     move konuk-rez-no to yanrez-rezno
     move 2 to yanrez-sirano siradaki
     read yanrez no lock invalid 
       continue
       not invalid 
       add 1 to siradaki
       string yanrez-adi  delimited by "   "
            "-" delimited by size
            yanrez-soyadi delimited by "  "
            into ad-soyad(2)
          end-string
             move konuk-rez-no to yanrez-rezno
             move 3 to yanrez-sirano 
             read yanrez no lock invalid 
               continue
               not invalid 
               add 1 to siradaki
               string yanrez-adi  delimited by "   "
                    "-" delimited by size
                    yanrez-soyadi delimited by "  "
                    into ad-soyad(3)
        
               end-string
                       move konuk-rez-no to yanrez-rezno
                     move 4 to yanrez-sirano 
                     read yanrez no lock invalid 
                       continue
                       not invalid 
                       add 1 to siradaki
                       string yanrez-adi  delimited by "   "
                            "-" delimited by size
                            yanrez-soyadi delimited by "  "
                            into ad-soyad(4)
                
                       end-string

                  end-read
           end-read
    end-read
      close yanrez .
*     string OZLUK-YANI-ADI1 delimited by "   "
*            " " delimited by size
*            OZLUK-YANI-soy1 delimited by "  "
*            into ad-soyad(2)
*        if ad-soyad2 = spaces then 
*           move 2 to siradaki
*           else
*           move 3 to siradaki
*        end-if
    move  "517" to yrenk(1) yrenk(2)  yrenk(3) yrenk(4) yrenk(5)
        
        move event-data-2    to takas-y
        move event-data-1    to takas-x
         
         read takas key takas-yer 
           invalid initialize takas-oda-uzun
           not invalid 
            move takas-oda        to o-kisa 
            perform oda-uzat
            move o-uzun to takas-oda-uzun
            evaluate true
             when takas-durumu = "B" 
                      EVALuate takas-oda-durumu 
                         when house-bt
                          move oda-blokaj-renk-1  to takas-renk33
                          move  0 to q-vis
                          
                         when house-ok
                          move oda-blokaj-renk-2  to takas-renk33
                          move  0 to q-vis
                         when house-touch
                          move oda-touch-blokaj-renk  to takas-renk33
                          move  0 to q-vis
                         when other
                           
                           move oda-blokaj-renk to  takas-renk33
                           if rezodablok-qtar > "19000000"  then 
                               move 240 to  takas-renk33
                            end-if
                     end-evaluate
                
          
              when  takas-durumu = "C"
                  move oda-cin-renk    to  takas-renk33
          
              when  takas-durumu = "Q"
                   move oda-cout-renk   to  takas-renk33
        
              when other 
                   move   oda-bos-temiz-renk-1 to takas-renk33
           end-evaluate
           move  takas-renk33 to yrenk(1) yrenk(2)  yrenk(3) 
          if siradaki > 3 then 
             move  takas-renk33 to yrenk(3) 
          end-if
           if siradaki > 4 then 
             move  takas-renk33 to yrenk(4) 
          end-if
           if siradaki > 5 then 
             move  takas-renk33 to yrenk(5) 
          end-if
        end-read
        perform varying sirai from siradaki by 1 until sirai > 5
           move  "517" to yrenk(sirai)
        end-perform
*****************************************************
     move takas-oda-uzun to firat-yedek-oda         |sharenum olan ancak share olmamýþ rezervasyonlarda oda no 
                                                    |sýfýrlanýyordu onun için konuldu. if çýkýþýnda boþsa tekrar yedekten dolacak.
*****************************************************
     if konuk-sharenum > 0 then 
        initialize takas-rec
        move konuk-sharenum to takas-sharenum
        start takas key = takas-sharenum invalid continue
           not invalid 
              perform until fs-takas = "10"
                  read takas next no lock end move "10" to fs-takas
                     not end 
                       if takas-sharenum not = konuk-sharenum
                          move "10" to fs-takas
                          exit perform cycle
                       end-if
                          if  konuk-rez-no = takas-ger-rez  exit perform cycle end-if
                            
                           string takas-adi delimited by "   "
                            " " delimited by size
                            takas-soyadi delimited by "  "
                            into ad-soyad(siradaki)
                             move takas-yer to yer(siradaki)
                             evaluate true
                               when takas-durumu = "B" 
                                    if takas-oda-durumu = house-bt
                                                move oda-blokaj-renk-1  to   yrenk(siradaki)
                        
                                               else
                                            if takas-oda-durumu = house-ok
                                                 move oda-blokaj-renk-2  to   yrenk(siradaki)
                                            else
                                               move oda-blokaj-renk to   yrenk(siradaki)
                                               end-if
                                        end-if
                
                                  
            
                                when  takas-durumu = "C"
                                    move oda-cin-renk    to  yrenk(siradaki)
           
                                when  takas-durumu = "Q"
                                     move oda-cout-renk   to  yrenk(siradaki)
        
                                when other 
                                     move   oda-bos-temiz-renk-1 to  yrenk(siradaki)
                             end-evaluate
                            add 1 to siradaki
                       if siradaki >= 6 then  
                         move "10" to  fs-takas
                       end-if
                   end-read
              end-perform
        end-start
     end-if


*****************************************************
     if takas-oda-uzun = spaces                      |sharenum olan ancak share olmamýþ rezervasyonlarda oda no 
        move firat-yedek-oda to takas-oda-uzun       |        
     end-if                                          |sýfýrlanýyordu onun için konuldu.    firat 11/10/2019
*****************************************************


     if konuk-mini-ok = 1     then 
        move 1 to mini-ok
        else
        move 0 to mini-ok
     end-if
     if konuk-acik-kapali = "C"
       move 1 to v-nopost
       else
       move 0 to v-nopost
     end-if
     display a-minibar
     display form1-fr-2a.
     display form1-la-1a.
     display form1-ef-oda.
     display Form1-Ef-ack1 Form1-Ef-ack2
     display Form1-Ef-odaa
     display form1-ef-folio
     display form1-geceleme
     display form1-ef-adi   ac-q
     display kart1-acc kart2-acc kart3-acc  Form1-Pb-5
     display form1-ef-adi2
     display form1-ef-adi3
     display form1-ef-adi4
     display form1-ef-adi5

     display form1-ef-gg
     display form1-ef-ga
     display form1-ef-gy  form1-ef-g1 form1-ef-g2
     form1-ef-g3 form1-ef-g4 form1-ef-g3a form1-ef-g4a
     display Form1-a-safe
     display acc-vip
     display Form1-a-anah
     display form1-ef-cg
     display form1-ef-ca
     display form1-ef-cy
     display form1-ef-acenta
     display form1-ef-ulke
     display form1-ef-buyuk
     display form1-ef-kucuk
     display form1-ef-free
     display form1-ef-bebek
     display form1-ef-voucher
     display form1-ef-pans
     display form1-ef-ode
     display form1-ef-banka
     display form1-ef-doviz
     display form1-ef-dv-toplam
     display form1-ef-cin-kuru
     display form1-ef-tl-toplam
     display form1-ef-not1
     display form1-ef-not2
     display form1-ef-fiyat-konumu
     display form1-ef-oda-konumu
     display l-nopost
     perform pen-kont
    
   
     
   
      move all low-values to toplam-ariza
       perform teknik-bak
       display tek-ac.

      if eski-oda not = odalar-no then 
        move odalar-no to eski-oda
         initialize toplam-not
      
     if cell-rez > 0 or ( cell-folio > 0 and konuk-rez-no > 0 ) then
           move 3 to link-nereden 
           move "K"     to  link-not-islem
           move "REZ"   to  link-NOT-DOS    
           if cell-rez > 0
                move cell-rez to link-not-dos-anah
              else
              move konuk-rez-no to link-NOT-DOS-ANAH   
            end-if
           move 3 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
        end-if
             display not-ac
       end-if
     .
 oda-bilgi-fol.
      initialize ozluk-rec
     open input rez yanrez 
     if cell-folio > 0 then 
             open input konuk ozluk
             move cell-folio         to konuk-folio ozluk-folio
             read konuk no lock invalid
                  display message box 
                          cell-folio," numarali folio bulunamadi ..." new-line
                          "Lutfen F5 ile racki tazeleyiniz"
                          icon mb_error_icon,
                          title "Hata"
                          close konuk  rez  ozluk yanrez
                          exit paragraph
                   not invalid
                     
                      perform extra-kont
                      move cell-folio         to konuk-folio ozluk-folio
                       read konuk no lock end-read
                       read ozluk no lock end-read
             close ozluk
             end-read
             close konuk
             move konuk-rez-no to rez-anah
             read rez no lock 
                invalid display message box "Rezervasyon bulunamadi"
             end-read
                move  rez-no to yanrez-rezno
            
                 move 2 to yanrez-sirano
                 read yanrez no lock invalid
                    
                     continue
                    not invalid 
                     move yanrez-adi to OZLUK-YANI-ADI1
                      move yanrez-soyadi to OZLUK-YANI-soy1
                  end-read
              move  "Konuk Bilgileri" to frm-tit
              move  "Folio No :"   to fol-tit
         else
             move "Blokaj Bilgileri" to frm-tit
             move "Rez No :"         to  fol-tit
             move cell-rez to rez-no
             read rez no lock 


                invalid display message box "Rezervasyon bulunamadi"
             end-read
               initialize rezodablok-rec
              open i-o rezodablok

                     
                  move rez-odano to rezodablok-odano
                  move rez-no to rezodablok-rezno
                 read rezodablok no lock invalid 
                 continue
                 end-read
                 if rezodablok-qtar > "19000000"  then 
                  move  1 to q-vis
                  initialize q-tit
                    move  rezodablok-qtar-yil to e-yil
                    move  rezodablok-qtar-ay to e-ay
                    move  rezodablok-qtar-gun to e-gun
                    move  rezodablok-qtar-saat to e-saat
                    move  rezodablok-qtar-dakika to e-dakika
                    if rezodablok-qtar not = tarih-tasi
                    move e-tarih to q-tit(1:10)
                   
                    
                   end-if
                    move e-zaman to  q-tit(14:) 
                       
                  else
                            move 0 to q-vis
                           
                  end-if
      

              close rezodablok
             initialize konuk-kur-degeri toplam-tutar kart-no1 kart-no2 kart-no3
             move rez-acenta        to konuk-acenta
             move rez-no            to konuk-folio
             move rez-adi           to konuk-adi
             move rez-soyadi        to konuk-soyadi
             move rez-gir-tar       to konuk-gel-tar
             move rez-gel-zaman     to konuk-gel-zaman
             move rez-cik-tar       to konuk-git-tar
             move rez-ulke          to konuk-ulke
             move rez-buyuk         to konuk-buyuk
             move rez-kucuk         to konuk-kucuk
             move rez-free          to konuk-free
             move rez-bebek         to konuk-bebek
             move rez-voucher       to konuk-voucher
             move rez-pan-tipi      to konuk-pan-tipi
             move rez-odeme-tipi    to konuk-odeme-tipi
             move rez-banka         to konuk-banka
             move rez-doviz         to konuk-doviz
             move rez-fiyati        to konuk-dv-degeri
             move rez-odano         to konuk-odano
             move rez-fiyat-konumu  to konuk-fiyat-konumu 
             move rez-vip           to konuk-vip
             move rez-no        to konuk-rez-no
             move rez-firma         to konuk-firma
             move rez-sharenum to konuk-sharenum  
                   move  rez-no to yanrez-rezno
            
                 move 2 to yanrez-sirano
                 read yanrez no lock invalid
                    
                     continue
                    not invalid 
                     move yanrez-adi to OZLUK-YANI-ADI1
                      move yanrez-soyadi to OZLUK-YANI-soy1
                  end-read


     end-if



     close rez yanrez.
     move 1 to v-vip

     open input kodlar02 
     initialize kodlar02-rec
     move "v"       to kodlar02-tipi
     move konuk-vip to kodlar02-kodu
     read kodlar02 no lock invalid
          move "*"  to kodlar02-adi
     end-read

        if konuk-vip = " "
           move "NORMAL"   to d-vip
        else
           move kodlar02-adi to d-vip
        end-if
     close kodlar02
*     Evaluate konuk-vip
*            when  "N"  move 0 to v-vip
*            when  "V"  move "VIP" to d-vip
*            when  "T"  move "TOP VIP" to d-vip
*            when  "B"  move "BALAYI" to d-vip
*            when  "G"  move "GRepeat" to d-vip
*            when  "1"  move "VIP 1" to d-vip
*            when  "2"  move "VIP 2" to d-vip
*            when  "3"  move "VIP 3" to d-vip       
*      end-evaluate

     open input konum
     move konuk-fiyat-konumu to konum-anahtar
     read konum no lock 
        invalid move "**********" to konum-adi
     end-read
     move konum-adi to fiyat-knm
     move odalar-konumu to konum-anahtar
     read konum no lock 
        invalid move "**********" to konum-adi
     end-read
     move konum-adi          to oda-knm
     move odalar-aciklama1   to oda-ack1
     move odalar-aciklama2-1 to oda-ack2
     close konum
     if odalar-konumu = konuk-fiyat-konumu then 
       move 517 to color-fiyat
        else
       move 176 to color-fiyat
       end-if
     open input ulke.
     move konuk-ulke      to ulke-anah
     
     read ulke no lock invalid
     
          move "Tanimsiz" to ulke-adi
     end-read
     close ulke.
     
     open input acenta firma
     move konuk-acenta    to acenta-anahtar
     read acenta no lock invalid
          move "Tanimsiz" to acenta-adi
     end-read    
     close acenta.
     if konuk-firma not = spaces 
        initialize firma-rec
        move konuk-firma   to firma-kodu
        read firma no lock invalid 
             continue 
        not invalid 
            move firma-adi to acenta-adi
            modify Form1-La-1ab,title = "Firma :"
        end-read
     else 
       modify Form1-La-1ab,title = "Acenta :"
     end-if 
     close firma

     open input banka
     move konuk-banka     to banka-kodu
     read banka no lock invalid
          move "Tanimsiz" to banka-adi
     end-read
     close banka.
     
     open input doviz
     move konuk-doviz     to doviz-kodu 
     read doviz no lock invalid
          move "Tanimsiz" to d-kisa-adi
     end-read
     move d-kisa-adi to oda-dov-adi     
     close doviz.

     if cell-folio > 0 then 
     compute toplam = konuk-oda-tutar + konuk-extbed-tutar +
                      konuk-kahvalti-tutar + konuk-ogle-tutar +
                      konuk-aksam-tutar + konuk-icecek-tutar +
                      konuk-extra-tutar
     move toplam      to toplam-tutar

     compute rom-bakiye-tl = konuk-top-borc - konuk-top-alac
     compute rom-bakiye-dov rounded = rom-bakiye-tl / konuk-kur-degeri

     end-if
     open input kodlar02 odalar.
     move konuk-odeme-tipi        to kodlar02-kodu
     move "B"                     to kodlar02-tipi
     read kodlar02 no lock invalid
          move "Tanimsiz"         to kodlar02-adi
     end-read
     move kodlar02-adi            to odeme-adi.
     
     close odalar kodlar02.
*
extra-kont.
         initialize ext-fol-no
**********************************************
        
           
          if CINPARA-EXT-FOL-AC not = "E"
            move konuk-folio to ext-fol-no
            perform  kartlari-goster
         end-if
                  move "I" to konuk-durumu
                   move konuk-odano   to tmp-oda
                   move konuk-gel-tar to tmp-gel-tar
                   move konuk-git-tar to tmp-git-tar  
                     start konuk key = konuk-oda 
                        invalid 
                           continue
                        not invalid
                           perform until  fs-konuk = "10"
                           read konuk next no lock 
                                 end move "10"  to fs-konuk
                             not end
                               if konuk-odano not = tmp-oda
                                  move "10"  to fs-konuk
                                else
                                  
                                   if konuk-gel-tar = tmp-gel-tar and
                                      konuk-git-tar = tmp-git-tar and 
                                      konuk-fol-kodu not = "R" then
                                         move konuk-folio to ext-fol-no
                                         compute ext-bakiye-tl = konuk-top-borc - konuk-top-alac
                                         
                                         compute ext-bakiye-dov rounded = ext-bakiye-tl / gunluk-kur
                                         move konuk-folio to ext-fol-no
                                          
                                         move "10"  to fs-konuk
                                  end-if
                            end-if
                        end-read
                    end-perform
          end-start.
          if CINPARA-EXT-FOL-AC  = "E" 
            perform  kartlari-goster
         end-if.
*
 kartlari-goster.
        
           initialize onb-hata
         open input kart.
         if onb-hata = 1 then 
           initialize onb-hata
           exit paragraph
         end-if
         initialize kart-rec kart-no1 kart-no2 kart-no3
            kart-ind1 kart-ind2 kart-ind3
         move ext-fol-no to kart-folio
         start kart key >= kart-folio
          invalid continue
          not invalid 
          perform varying kart-say from 1 by 1 until 
                 fs-kart = "10" or kart-say > 3
             read kart next no lock 
               end move "10" to fs-kart 
               not end
                if kart-folio not = ext-fol-no
                    move "10" to fs-kart 
                    else
                   evaluate kart-say
                      when 1
                         move kart-no to kart-no1
                         if kart-ind > 0 then 
                              string "%", kart-ind ,
                                into kart-ind1

                         end-if
                      when 2
                          move kart-no to kart-no2
                          if kart-ind > 0 then 
                              string "%", kart-ind ,
                                into kart-ind2

                         end-if
                      when 3
                          move kart-no to kart-no3
                          if kart-ind > 0 then 
                              string "%", kart-ind ,
                                into kart-ind3

                         end-if
                   end-evaluate
               end-if
             end-read
          end-perform
        end-start 
        display kart1-acc kart2-acc kart3-acc kartind1-acc kartind2-acc kartind3-acc  Form1-Pb-5
        close kart.

*
 Screen1-Ef-1-Aft-Procedure.
      move 1 to aramayap
      set exit-pushed to true
     .
*
 takas-kapat.
     close takas takas2 takaskont plaka.
     delete file takas takas2 takaskont.
     .
*
 Form3-Aft-Initdata.
      initialize status-deg
     open input konuk kodlar02
     initialize konuk-rec
     move "I" to konuk-durumu
     start konuk key > konuk-oda 
      invalid
            continue
      not invalid
        perform until fs-konuk  = "10"
         read konuk next no lock 
            end 
              move "10" to fs-konuk
            not end 
              if konuk-duzeltme = 1 then 
                    exit perform cycle
              end-if
              if konuk-durumu not = "I" then 
                  move "10" to fs-konuk
                else
                  if konuk-fol-kodu = "R" then
                    add 1           to v-oda4
                    add konuk-buyuk to v-pax4
                    add konuk-kucuk to v-chi4
                    add konuk-free  to v-fre4
                    add konuk-bebek to v-beb4

                    move "B" to KODLAR02-TIPI
                    move konuk-odeme-tipi to kodlar02-kodu
                    read kodlar02 no lock invalid initialize kodlar02-rec
                    end-read
                    if ode-tipi = "D"   or  ode-tipi = "F"
                       add 1 to v-coda4
                       add konuk-buyuk to v-cpax4
                       add konuk-kucuk to v-cchi4
                       add konuk-free  to v-cfre4
                       add konuk-bebek to v-cbeb4
                    end-if 
                  end-if   
               end-if
            end-read
        end-perform
     end-start 
     if k-kodu-tasi = "ASYA" or k-kodu-tasi = "X   " then stop " " end-if
     open input rez
     initialize rez-rec
     move "I" to rez-durumu
     move tarih-tasi to rez-gir-tar
     start rez key >= rez-gir 
        invalid continue
        not invalid
          perform  until fs-rez = "10"
            read rez next no lock
               end 
                 move "10" to fs-rez
               not end
                 if rez-durumu not = "I" or
                    rez-gir-tar not = tarih-tasi then
                      move "10" to fs-rez
                    else
                      move "B" to KODLAR02-TIPI
                      move rez-odeme-tipi to kodlar02-kodu
                      read kodlar02 no lock invalid initialize kodlar02-rec
                      end-read
                      if rez-folio > 0 then 
                         initialize konuk-rec
                          move "I"       to konuk-durumu
                          move rez-folio to konuk-folio
                          read konuk no lock invalid 
                            display message box rez-no " nolu rez de cin uyusmazligi"
                            exit perform cycle
                          end-read
                          if konuk-duzeltme = 1 then 
                             
                                exit perform cycle

                          end-if
                          add 1           to v-oda2
                          
                          add rez-buyuk to v-pax2
                          add rez-kucuk to v-chi2
                          add rez-free  to v-fre2
                          add rez-bebek to v-beb2
                          if ode-tipi = "D"   or  ode-tipi = "F"
                            add 1           to v-coda2
                            add rez-buyuk to v-cpax2
                            add rez-kucuk to v-cchi2
                            add rez-free  to v-cfre2
                            add rez-bebek to v-cbeb2
                          end-if
                        else
                          add 1           to v-oda5
                          add rez-buyuk to v-pax5
                          add rez-kucuk to v-chi5
                          add rez-free  to v-fre5
                          add rez-bebek to v-beb5
       
                          if ode-tipi = "D"   or  ode-tipi = "F"
                            add 1           to v-coda5
                            add rez-buyuk to v-cpax5
                            add rez-kucuk to v-cchi5
                            add rez-free  to v-cfre5
                            add rez-bebek to v-cbeb5
                          end-if
                      end-if
                 end-if
             end-read
          end-perform
     end-start
    
     initialize rez-rec
     move "I" to rez-durumu
     move tarih-tasi to rez-cik-tar
     start rez key >= rez-cik 
        invalid continue
        not invalid
          perform  until fs-rez = "10"
            read rez next no lock
               end 
                 move "10" to fs-rez
               not end
                 if rez-durumu not = "I" or
                    rez-cik-tar not = tarih-tasi then
                      move "10" to fs-rez
                    else
                      move "B" to KODLAR02-TIPI
                      move rez-odeme-tipi to kodlar02-kodu
                      read kodlar02 no lock invalid initialize kodlar02-rec
                      end-read
                      move rez-folio to konuk-folio
                      move "I"       to konuk-durumu
                      read konuk no lock
                        invalid
                          continue
*                         display message box "Hata 4532j" new-line
*                            rez-no
                       end-read
                       
                          if konuk-duzeltme = 1 then 
                                exit perform cycle

                          end-if
                        if konuk-durumu not  = "I"
                           add 1           to v-oda3
                          add rez-buyuk   to v-pax3
                          add rez-kucuk   to v-chi3
                          add rez-free    to v-fre3
                          add rez-bebek  to v-beb3
                          if ode-tipi = "D"   or  ode-tipi = "F"
                            add 1           to v-coda3
                            add rez-buyuk to v-cpax3
                            add rez-kucuk to v-cchi3
                            add rez-free  to v-cfre3
                            add rez-bebek to v-cbeb3
                          end-if
                          else
                          add 1           to v-oda6
                          add rez-buyuk   to v-pax6
                          add rez-kucuk   to v-chi6
                          add rez-free    to v-fre6
                          add rez-bebek   to v-beb6
       
                          if ode-tipi = "D"   or  ode-tipi = "F"
                            add 1           to v-coda6
                            add rez-buyuk to v-cpax6
                            add rez-kucuk to v-cchi6
                            add rez-free  to v-cfre6
                            add rez-bebek to v-cbeb6
                          end-if
                      end-if
                 end-if
             end-read
          end-perform
     end-start
     close rez konuk kodlar02
     move v-oda2   to oda2   display l-oda2 
     move v-pax2   to pax2   display l-pax2
     move v-chi2   to chi2   display l-chi2
     move v-fre2   to fre2   display l-fre2
     move v-beb2   to beb2   display l-beb2
     move v-coda2  to coda2  display l-coda2 
     move v-cpax2  to cpax2  display l-cpax2
     move v-cchi2  to cchi2  display l-cchi2
     move v-cfre2  to cfre2  display l-cfre2
     move v-cbeb2  to cbeb2  display l-cbeb2

     move v-oda3   to oda3   display l-oda3 
     move v-pax3   to pax3   display l-pax3
     move v-chi3   to chi3   display l-chi3
     move v-fre3   to fre3   display l-fre3
     move v-beb3   to beb3   display l-beb3
     move v-coda3  to coda3  display l-coda3 
     move v-cpax3  to cpax3  display l-cpax3
     move v-cchi3  to cchi3  display l-cchi3
     move v-cfre3  to cfre3  display l-cfre3
     move v-cbeb3  to cbeb3  display l-cbeb3

     move v-oda4   to oda4   display l-oda4 
     move v-pax4   to pax4   display l-pax4
     move v-chi4   to chi4   display l-chi4
     move v-fre4   to fre4   display l-fre4
     move v-beb4   to beb4   display l-beb4
     move v-coda4  to coda4  display l-coda4 
     move v-cpax4  to cpax4  display l-cpax4
     move v-cchi4  to cchi4  display l-cchi4
     move v-cfre4  to cfre4  display l-cfre4
     move v-cbeb4  to cbeb4  display l-cbeb4

     move v-oda5   to oda5   display l-oda5 
     move v-pax5   to pax5   display l-pax5
     move v-chi5   to chi5   display l-chi5
     move v-fre5   to fre5   display l-fre5
     move v-beb5   to beb5   display l-beb5
     move v-coda5  to coda5  display l-coda5 
     move v-cpax5  to cpax5  display l-cpax5
     move v-cchi5  to cchi5  display l-cchi5
     move v-cfre5  to cfre5  display l-cfre5
     move v-cbeb5  to cbeb5  display l-cbeb5

     move v-oda6   to oda6   display l-oda6 
     move v-pax6   to pax6   display l-pax6
     move v-chi6   to chi6   display l-chi6
     move v-fre6   to fre6   display l-fre6
     move v-beb6   to beb6   display l-beb6
     move v-coda6  to coda6  display l-coda6 
     move v-cpax6  to cpax6  display l-cpax6
     move v-cchi6  to cchi6  display l-cchi6
     move v-cfre6  to cfre6  display l-cfre6
     move v-cbeb6  to cbeb6  display l-cbeb6

     compute v-oda1 = v-oda4 - v-oda2 + v-oda3 
     compute v-pax1 = v-pax4 - v-pax2 + v-pax3 
     compute v-chi1 = v-chi4 - v-chi2 + v-chi3 
     compute v-fre1 = v-fre4 - v-fre2 + v-fre3 
     compute v-beb1 = v-beb4 - v-beb2 + v-beb3 
     compute v-dol1 rounded = (v-oda1 / satilabilir) * 100
     compute v-dol4 rounded = (v-oda4 / satilabilir) * 100
     compute v-coda1 = v-coda4 - v-coda2 + v-coda3 
     compute v-cpax1 = v-cpax4 - v-cpax2 + v-cpax3 
     compute v-cchi1 = v-cchi4 - v-cchi2 + v-cchi3 
     compute v-cfre1 = v-cfre4 - v-cfre2 + v-cfre3 
     compute v-cbeb1 = v-cbeb4 - v-cbeb2 + v-cbeb3 

     compute v-oda7 = v-oda4 - v-oda6 + v-oda5 
     compute v-pax7 = v-pax4 - v-pax6 + v-pax5 
     compute v-chi7 = v-chi4 - v-chi6 + v-chi5 
     compute v-fre7 = v-fre4 - v-fre6 + v-fre5 
     compute v-beb7 = v-beb4 - v-beb6 + v-beb5 
     compute v-dol7 rounded = (v-oda7 / satilabilir) * 100

     compute v-coda7 = v-coda4 - v-coda6 + v-coda5 
     compute v-cpax7 = v-cpax4 - v-cpax6 + v-cpax5 
     compute v-cchi7 = v-cchi4 - v-cchi6 + v-cchi5 
     compute v-cfre7 = v-cfre4 - v-cfre6 + v-cfre5 
     compute v-cbeb7 = v-cbeb4 - v-cbeb6 + v-cbeb5 

     move v-oda1   to oda1   display l-oda1 
     move v-pax1   to pax1   display l-pax1
     move v-chi1   to chi1   display l-chi1
     move v-fre1   to fre1   display l-fre1
     move v-beb1   to beb1   display l-beb1
     move v-coda1  to coda1  display l-coda1 
     move v-cpax1  to cpax1  display l-cpax1
     move v-cchi1  to cchi1  display l-cchi1
     move v-cfre1  to cfre1  display l-cfre1
     move v-cbeb1  to cbeb1  display l-cbeb1
     move v-dol1   to dol1   display l-dol1
     move v-dol4   to dol4   display l-dol4
     move v-oda7   to oda7   display l-oda7 
     move v-pax7   to pax7   display l-pax7
     move v-chi7   to chi7   display l-chi7
     move v-fre7   to fre7   display l-fre7
     move v-beb7   to beb7   display l-beb7
     move v-coda7  to coda7  display l-coda7 
     move v-cpax7  to cpax7  display l-cpax7
     move v-cchi7  to cchi7  display l-cchi7
     move v-cfre7  to cfre7  display l-cfre7
     move v-cbeb7  to cbeb7  display l-cbeb7
     move v-dol7   to dol7   display l-dol7
     compute toda1 = v-pax1 + v-chi1 + v-fre1 + v-beb1
     display l-oda1a
     compute toda2 = v-pax2 + v-chi2 + v-fre2 + v-beb2
     display l-oda2a
     compute toda3 = v-pax3 + v-chi3 + v-fre3 + v-beb3
     display l-oda3a
     compute toda4 = v-pax4 + v-chi4 + v-fre4 + v-beb4
     display l-oda4a
     compute toda5 = v-pax5 + v-chi5 + v-fre5 + v-beb5
     display l-oda5a
     compute toda6 = v-pax6 + v-chi6 + v-fre6 + v-beb6
     display l-oda6a
     compute toda7 = v-pax7 + v-chi7 + v-fre7 + v-beb7
     display l-oda7a
     .
************* ARIZA OLAYI
 arizali-islem.
    perform acu-Form5-routine.
    move 4 to accept-control
    move 1 to control-id.
*
 Form4-Aft-Initdata.
    modify Form4-gd-1,
           reset-grid  = 1 
           mass-update = 1 
    move "Oda"          to gd-3-col-1
    move "Tarih"        to gd-3-col-2
    move "Zaman"        to gd-3-col-3
    move "Kullanici"    to gd-3-col-4
    move "Sorun"        to gd-3-col-5
    modify Form4-gd-1,
           record-to-add(Form4-gd-1-record)
    open input teknik kllnc.
    initialize teknik-rec
    move cell-oda          to teknik-odano
    move " "               to teknik-ok
    start teknik key not < teknik-alt-1 invalid
          continue
    not invalid
    initialize fs-teknik
    perform with test after until fs-teknik = "10"
    read teknik next no lock end move "10" to fs-teknik
    not at end
         if teknik-ok = "E" or 
            teknik-odano <> cell-oda  
            move "10" to fs-teknik
            exit perform
         end-if
         initialize Form4-gd-1-record
         move teknik-odano        to gd-3-col-1
         move teknik-sorun-yil    to eyil
         move teknik-sorun-ay     to eay 
         move teknik-sorun-gun    to egun
         move etarih              to gd-3-col-2
         move teknik-sorun-saat   to esaat
         move teknik-sorun-dakika to edakika
         move teknik-sorun-saniye to esaniye
         move ezaman              to gd-3-col-3
         move teknik-sorun-staf   to k-kodu
         read kllnc no lock invalid
              move "Tanimsiz ..." to k-adi
         end-read
         move k-adi               to gd-3-col-4
         move teknik-sorun        to gd-3-col-5
         modify Form4-gd-1,
                record-to-add(Form4-gd-1-record)
    end-read
    end-perform
    end-start
    close teknik kllnc.
    modify Form4-gd-1,
           mass-update = 0.
*
 Form4-Ex-Other.
    if key-status <> 2001
       exit paragraph.
    if teknik-aciklama = spaces
       move 4 to accept-control
       move 4 to control-id
       exit paragraph.
    open i-o teknik odalar.
    initialize teknik-rec
    move tarih-tasi           to teknik-sorun-tar
    accept teknik-sorun-zaman from time
    move cell-oda             to teknik-odano
    move k-kodu-tasi          to teknik-sorun-staf
    move teknik-aciklama      to teknik-sorun
    write teknik-rec invalid
          rewrite teknik-rec end-rewrite
    end-write.
    move cell-oda         to odalar-anah
    read odalar no lock invalid 
                        continue
                not invalid
         move house-ao      to odalar-durumu house-durumu
         rewrite odalar-rec invalid continue
         end-rewrite
         perform log-operation-odalar
    end-read.
    close teknik odalar.
    move house-ao             to cell-oda-durumu
    move oda-ariza-renk       to renk
    modify form1-gd-1(ariza-i,ariza-ii),
           hidden-data = cell-hidden
           cell-color = renk
    display message box
            "Teknik problem kaydedilmistir ..."
            title "Bilginize ...".

    set exit-pushed to true.
*
 Form4-Bef-Create.
    initialize teknik-aciklama.
*
 Form4-Gd-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
             move event-action-fail to event-action
    end-evaluate.
*
 Form4-Aft-Procedure.
     .
*
 form3-acc17-Aft-Procedure.
     initialize gec-gecme form3-ariza-adi
     if takip-durum-kodu = spaces
        exit paragraph.
     open input grup.
     initialize grup-rec
     set grup-hk-ts                    to true

     move takip-durum-kodu   to grup-alt
     read grup no lock invalid
          move 1 to gec-gecme
          move "Tanimsiz ...."         to grup-adi
     end-read
     move grup-adi                     to form3-ariza-adi
     if grup-turu <> "A" 
        move "Ariza kodu gecersiz ..." to form3-ariza-adi
        move 1 to gec-gecme
     end-if.
     close grup.
     display form3-acc18.
*
 form3-acc15-Aft-Procedure.
    initialize gec-gecme form3-ariza-grup-adi
    if takip-fis-sira <> 0 or takip-durum-grup-kodu = spaces
       exit paragraph.
     open input grup.
     initialize grup-rec
     set grup-hk-ts                      to true
     move takip-durum-grup-kodu          to grup-kodu.
     read grup no lock invalid
          move "Tanimsiz ..."            to grup-adi
          move 1 to gec-gecme
     end-read
     move grup-adi                       to form3-ariza-grup-adi
     close grup.
     display form3-acc16.
     .
*
 Form5-Ex-Other.
     evaluate key-status
     when 1
           move "R" to grup-cagir-tipi
           initialize grup-alt-cagir
           call "/asya/ytl/obj/otel/tgrupara.asy" 
                        using grup-cagir-tipi grup-alt-cagir
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/tgrupara.asy"
           end-call
           move grup-alt-cagir to takip-durum-kodu 
           display form3-acc17        
     when 2
     perform form3-acc15-Aft-Procedure
     if gec-gecme = 1
        move 4 to accept-control
        move 27 to control-id
        exit paragraph
     end-if 
     perform form3-acc17-Aft-Procedure
     if gec-gecme = 1
        move 4 to accept-control
        move 51 to control-id
        exit paragraph
     end-if 
     open i-o takip odalar
*     set takip-tip-teknik         to true
     move "O"                     to takip-odami-depmi
     move "A"                     to takip-acik-kapali
     accept takip-ilk-tarih from century-date
     accept takip-ilk-zaman from time
     move k-kodu-tasi             to takip-ilk-staf
     move "O"                     to takip-kayit-kaynak
     move k-kodu-tasi             to takip-staf
     move cell-oda                to takip-oda-dep-no
     move form3-combo-oncelik-value(1:1)  to takip-oncelik-durumu

     write takip-rec invalid
           Display message box 
                   "Ariza kaydedilemedi",new-line,
                   "Lutfen Tekrar deneyiniz ..."
                   icon mb_Error_icon
                   title "Hata"
                   close takip odalar
                   exit paragraph
     end-write

     move cell-oda         to odalar-anah
     read odalar no lock invalid 
          continue
     not invalid
*****> ISTEK UZERINE KALDIRILDI          move house-ao      to odalar-durumu house-durumu
*          rewrite odalar-rec invalid 
*                  continue
*          end-rewrite
          continue
     end-read
     close odalar takip
****> ISTEK UZERINE KALDIRILDI     move house-ao             to cell-oda-durumu
****     move oda-ariza-renk       to renk
****     modify form1-gd-1(ariza-i,ariza-ii),
****            hidden-data = cell-hidden
****            cell-color = renk
     display message box
             "Kaydedildi  ..."
             title "Bilginize ..."

     set exit-pushed to true
     end-evaluate. 
*
 Form5-Bef-Create.
     perform teknik-servis-fis-al.
     initialize takip-rec
     if key-status = 1004
        set takip-tip-hk-bildirim         to true
     else
        set takip-tip-teknik         to true   
     end-if 

     move hk-tk-servis-no         to takip-fis-no
     move 0                       to takip-fis-sira.
     open input kllnc
     move k-kodu-tasi             to k-kodu
     read kllnc no lock invalid
          move "Tanimsiz ...."    to k-adi k-soyadi
     end-read
     move all low-values          to takip-bildiren
     move "2"                     to form3-combo-oncelik-value(1:1)
     inspect k-adi    replacing trailing spaces by low-values
     inspect k-soyadi replacing trailing spaces by low-values
     string takip-bildiren,
            k-adi delimited by low-values
            " " delimited by low-values
            k-soyadi delimited by spaces
            into takip-bildiren
     inspect takip-bildiren replacing trailing spaces 
             by low-values
     close kllnc.
*
 teknik-servis-fis-al.
     open i-o genelfis.
     move 1 to genelfis-anahtar.
     read genelfis no lock invalid
          display message box 
                  "Onburo calisma parametresi tanimsiz ..."
                  icon mb_error_icon
                  title "Hata"
                  goback
     end-read
     add 1 to hk-tk-servis-no
     rewrite genelfis-rec end-rewrite.
     close genelfis.
     .
*
 Form1-Ef-ack1-Ev-Ntf-Changed.
          move 1 to oda-acik-girildi.
*
 odalar-yaz.
        if oda-acik-girildi = 1 then 
        open i-o odalar
       
        read odalar no lock invalid
        display message box "Lutfen oda seciniz" title " "
          not invalid
           
          move oda-ack1 to odalar-aciklama1
          move oda-ack2 to odalar-aciklama2-1
          rewrite odalar-rec invalid stop " " end-rewrite
          end-read

        close odalar 
        initialize  oda-acik-girildi
        end-if
     .
*
 teknik-bak.
    open input kllnc  
    open input takip grup
    initialize takip-rec  
    set takip-tip-teknik to true
    move "A"             to takip-acik-kapali
    move odalar-no to takip-oda-dep-no
    start takip key not < takip-alt-5 invalid
          continue
    not invalid
    initialize fs-takip
    perform with test after until fs-takip = "10"
    read takip next no lock end move "10" to fs-takip
    not at end
           if not takip-tip-teknik or 
              not takip-acik or
              odalar-no <> takip-oda-dep-no
                  exit perform
           end-if
           if takip-fis-sira = 0 and 
              takip-odami-depmi = "O"
              move takip-ilk-gun       to egun
              move takip-ilk-ay        to eay
              move takip-ilk-yil       to eyil
              move takip-ilk-saat      to esaat
              move takip-ilk-dakika    to edakika
              move takip-ilk-saniye    to esaniye
              move takip-ilk-staf             to k-kodu
              read kllnc no lock invalid
                   move "Tanimsiz..."       to k-adi
                  k-soyadi
              end-read
              inspect k-adi replacing trailing spaces 
                      by low-values
              inspect k-soyadi replacing trailing spaces 
                      by low-values
               if takip-durum-kodu <> spaces  and takip-durum1-aciklamalar1 = spaces
                 initialize grup-rec
                 set grup-hk-ts             to true
                 move takip-durum-kodu      to grup-alt
                 read grup no lock invalid
                      move "Tanimsiz Ariza kodu"   to grup-adi
                 end-read
               
                 move grup-adi           to takip-durum1-aciklamalar1
              end-if       
                     move toplam-ariza to etoplam-ariza
                     move all low-values to toplam-ariza
              string 
                     "  "  delimited by low-values,
                     etarih(1:5) delimited by low-values,
                     "-"    delimited by low-values,
                     ezaman delimited by low-values,
                     "-"    delimited by low-values,
                     k-soyadi delimited by low-values
                     x"0D0A" delimited by spaces
                     takip-durum1-aciklamalar1  delimited by "    "
                     x"0D0A" delimited by spaces
                      etoplam-ariza delimited by low-values,
                     into toplam-ariza
                     perform toplam-ariza-tr-duzelt
           end-if
      end-read
      end-perform
      end-start
      close takip kllnc grup.

     if odalar-durumu = house-so
          open input outof
          initialize  acik-outof
          initialize outof-rec
          move odalar-anah  to outof-odano
          
          start outof key not < outof-anah invalid
                continue
          not invalid
          perform with test after until fs-outof = "10"
          read outof next no lock 
            end 
                 move "10"  to fs-outof
                  

          not at end 
               
                 if odalar-anah not = outof-odano
                    
                    exit perform 
                 end-if
                 if outof-bit-tarih < tarih-tasi
                    exit perform cycle 
                 end-if
                  if outof-bas-tarih > tarih-tasi
                    exit perform cycle 
                 end-if
              
                  move outof-aciklama to acik-outof
                   exit perform 
                 
          end-read          
          end-perform
          end-start
           if acik-outof not = spaces 
                  move toplam-ariza to etoplam-ariza
                  initialize toplam-ariza
        string 
                     "OOO  " delimited by size

                     acik-outof delimited by "       ",
                     
                      etoplam-ariza delimited by "     ",
                     into toplam-ariza
          end-if

          perform toplam-ariza-tr-duzelt
          close outof
      end-if.


*
 toplam-ariza-tr-duzelt.
    call "c$toupper" using toplam-ariza value 100
    inspect toplam-ariza converting  x"FDD0DCDEDDD6C7E7FEF0FCFDF6" to x"8DA69A9E989980879FA7818D94" 
    inspect toplam-ariza converting  x"989E999A80A6A78D81879F94" to x"49534F55434767697563736F".
*
 kart1-acc-Ev-Cmd-Goto.
        if kart-no1 not = spaces
***************KART CALL
           initialize dokcagir-tasi
           set dokcagir-tasi-call-kart2   to true
           move ext-fol-no                to dokcagir-konuk-folio
           move kart-no1                  to dokcagir-rez-extra-kart
           perform dokcagir-call
           move dokcagir-konuk-folio      to ext-fol-no
           move dokcagir-rez-extra-kart   to kart-no1

           perform kartlari-goster
        end-if
     .
*
 kart2-acc-Ev-Cmd-Goto.
     if kart-no2 not = spaces
***************KART CALL
           initialize dokcagir-tasi
           set dokcagir-tasi-call-kart2   to true
           move ext-fol-no                to dokcagir-konuk-folio
           move kart-no2                  to dokcagir-rez-extra-kart
           perform dokcagir-call
           move dokcagir-konuk-folio      to ext-fol-no
           move dokcagir-rez-extra-kart   to kart-no2

           perform kartlari-goster
        end-if
     .
*
 kart3-acc-Ev-Cmd-Goto.
     if kart-no3 not = spaces
***************KART CALL
           initialize dokcagir-tasi
           set dokcagir-tasi-call-kart2   to true
           move ext-fol-no                to dokcagir-konuk-folio
           move kart-no3                  to dokcagir-rez-extra-kart
           perform dokcagir-call
           move dokcagir-konuk-folio      to ext-fol-no
           move dokcagir-rez-extra-kart   to kart-no3
           perform kartlari-goster
        end-if
     .



 grid-yeniden-bol.
     
    


          evaluate max-oda-sayi2
           when 30         |  1  2  3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21   22   23   24   25   26   27   28   29   30    
                  modify Form1-Gd-1, 
                  COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS    (1, 6,11,  16, 21, 26, 31, 36, 41, 46, 51, 56, 61, 66, 71, 76, 81, 86, 91, 96,101, 106, 111, 116, 121,  126, 131, 136, 141, 146), 
              DISPLAY-COLUMNS (1, 7,13,  19, 25, 31, 37, 43, 49, 55, 61, 67, 73, 79, 85, 91, 97,103,109,115,121, 127, 133, 139, 145,  151, 157, 163, 169, 175), 
              SEPARATION      (0, 0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,   0,   0,   0,   0,   0,   0,   0    ,0  , 0),
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,   1,   1,   1,   1,   1,   1,   1,    1,   1),    
              ROW-DIVIDERS = 1
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial-Narrow5B-TRK,
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 121
             when 25         |  1  2  3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21   22   23   24   25   26   27   28   29   30    
                  modify Form1-Gd-1, 
                  COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS    (1, 6,11,  16, 21, 26, 31, 36, 41, 46, 51, 56, 61, 66, 71, 76, 81, 86, 91, 96,101, 106, 111, 116, 121 ), 
              DISPLAY-COLUMNS (1, 7,13,  19, 25, 31, 37, 43, 49, 55, 61, 67, 73, 79, 85, 91, 97,103,109,115,121, 127, 133, 139, 145), 
              SEPARATION      (0, 0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,   0,   0,   0,   0,  ),
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,   1,   1,   1,   1,  ),    
              ROW-DIVIDERS = 1
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial6B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 125
            when 18         |  1  2  3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21   22   23   24   25   26   27   28   29   30    
               modify Form1-Gd-1,
               COL 17.50, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.80 CELLS, 
              DATA-COLUMNS    (1, 6, 11, 16, 21, 26, 31, 36, 41, 46, 51, 56, 61, 66, 71, 76, 81, 86), 
              DISPLAY-COLUMNS (1, 7,13,  19, 25, 31, 37, 43, 49, 55, 61, 67, 73, 79, 85, 91, 97, 103), 
              SEPARATION      (0, 0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0),
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1),    
              ROW-DIVIDERS = 1
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial-Narrow8B-TRK, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 109
           when 5                                          
             modify Form1-Gd-1,
             COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 62.60 CELLS, 
              DATA-COLUMNS (1, 6, 11, 16, 21), 
              DISPLAY-COLUMNS (1, 7, 13,19,  25),
              SEPARATION (5, 5, 5, 5, 5), 
              COLUMN-DIVIDERS (5, 5, 5,5, 5), 
              ROW-DIVIDERS = 5 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial27B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 30
            when 7
              modify Form1-Gd-1, 
              COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS (1, 6, 11, 16, 21, 26, 31), 
              DISPLAY-COLUMNS (1, 7,13,  19, 25, 31, 37),
              SEPARATION (0, 0, 0, 0, 0,0,0), 
              COLUMN-DIVIDERS (5, 5, 5,5, 5,5,5), 
              ROW-DIVIDERS = 5 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial20B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 41
            when 10
              modify Form1-Gd-1, 
              COL 17.70, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 64.60 CELLS, 
              DATA-COLUMNS    (1, 6, 11,16, 21, 26,  31, 36, 41, 46), 
              DISPLAY-COLUMNS (1, 7,13,  19, 25, 31, 37, 43, 49, 55),
              SEPARATION      (5, 5, 5,  5,  5,  5,  5,  5,   5, 5), 
              COLUMN-DIVIDERS (3, 3, 3,  3,  3,  3,  3,  3,   3, 3), 
              ROW-DIVIDERS = 3 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial12B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
                 virtual-width = 60
           when 14
       
              modify Form1-Gd-1, 
              COL 17.10, LINE 3.80, LINES 59.50 CELLS, 
              SIZE 65.20 CELLS, 
              DATA-COLUMNS    (1, 6, 11,16, 21, 26,  31, 36, 41, 46, 51, 56, 61, 66), 
              DISPLAY-COLUMNS (1, 7,13,  19, 25, 31, 37, 43, 49, 55, 61, 67, 73, 79),
              SEPARATION      (5, 5, 5,  5,  5,  5,  5,  5,   5, 5,   5, 5  ,5,  5), 
              COLUMN-DIVIDERS (1, 1, 1,  1,  1,  1,  1,  1,   1, 1,   1, 1,  1,  1),          
              ROW-DIVIDERS = 1 
              CURSOR-FRAME-WIDTH 12, DIVIDER-COLOR 13, FONT IS Arial10B, 
              HEADING-COLOR 519, HEADING-DIVIDER-COLOR 1, 
               virtual-width = 84


     end-evaluate
           .
*
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
     on exception 
        perform callerr-proc
     not on exception
        cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.
    .
*
 cb-otel-Ex-Ntf-Selchange.
            perform Form1-Cb-1aa-Ex-Cmd-Clicked.
*
 geceleme-bul.
        open input takvim
        initialize takvim-rec   o-gece
        move konuk-gel-tar to takvim-anah
        START TAKVIM key >= takvim-anah 
           invalid continue
           not invalid
           perform until fs-takvim = "10"
              read takvim next no lock end
                 move "10" to fs-takvim
                 not end
                 if takvim-anah >= konuk-git-tar
                         move "10" to fs-takvim
                     else
                     add 1 to  o-gece
                end-if
             end-read
          end-perform
        end-start

       
        move o-gece       to o2-gece
        move o2-gece      to geceleme
      close takvim.
*
 in-house.
      call "/asya/ytl/obj/otel/acenmuse.asy" 
        on exception 
        perform callerr-proc
       not on exception
        cancel "/asya/ytl/obj/otel/acenmuse.asy"
      end-call
     .
*
 beklenen-cikis.
      call "/asya/ytl/obj/otel/gun-cout.asy"
        on exception 
        perform callerr-proc
       not on exception
        cancel "/asya/ytl/obj/otel/gun-cout.asy"
      end-call

    .
*
 bos-oda-bul.
     

      call "/asya/ytl/obj/otel/bosrack.asy" using oda-ref(1:1)
        on exception 
        perform callerr-proc
       not on exception
        cancel "/asya/ytl/obj/otel/bosrack.asy"
      end-call
       .
* 
 rehber-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "R" to kodlar02-tipi
    move rapor-rehber to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to lb-reh-value
    if rapor-rehber = spaces
       move "Tum Rehber" to lb-reh-value
    end-if
    display lb-rehber
    close kodlar02
    move 4 to accept-control
    move 104 to control-id.
*
 acc-rehber-Ex-Other.
        evaluate key-status 
          when 1
            if control-id = 124
                initialize pazar-cagir
                move "R"   to pazar-tipi-cagir
                call "/asya/ytl/obj/otel/rehara.asy"
                  using pazar-cagir
                  on exception
                     perform callerr-proc
                  not on exception
                     cancel "/asya/ytl/obj/otel/rehara.asy" 
                end-call
                    move pazar-kodu-cagir     to rapor-rehber
                display acc-rehber
                perform rehber-goster
                
            end-if
       end-evaluate
     
     .
*
 acc-rehber-Aft-Procedure.
     perform rehber-goster

     
     .
*
 Pen-Kont.
    
    initialize pencere-toplamlar romhrk-rec exthrk-rec
       open input konuk romhrk  exthrk  kur
       move cell-folio to konuk-folio
      read konuk no lock invalid 

         perform   pen-yukle

      end-read
     
    move konuk-folio to romhrk-folio exthrk-folio
     if konuk-fol-kodu = "R"  then
             start romhrk key > romhrk-anah invalid
                continue
                not invalid
                perform until fs-romhrk = "10"
                read romhrk next no lock 
                   end move "10" to fs-romhrk
                   not end
                     if romhrk-folio not = konuk-folio 
                        move "10" to fs-romhrk
                        else
                        move romhrk-rec to hrkgir-rec
                        perform topla
                    end-if
                end-read
                end-perform
             end-start
              
              
               move ext-fol-no to exthrk-folio konu2-folio
               open input konu2  doviz
               read konu2 no lock invalid continue
               end-read
                         
                   move konu2-doviz to doviz-kodu 
                          read doviz no lock invalid
                           continue
                         end-read
                    move d-kisa-adi to exdov  
                    close doviz konu2
              start exthrk key > exthrk-anah invalid
                continue
                not invalid
                  perform until fs-exthrk = "10"
                read exthrk next no lock 
                   end move "10" to fs-exthrk
                   not end
                     if exthrk-folio not = ext-fol-no
                        move "10" to fs-exthrk
                        else
                        move exthrk-rec to hrkgir-rec
                        if hrkgir-ref < 1 then 
                           move 1 to hrkgir-ref
                        end-if
                        perform extra-topla
                    end-if
                end-read
                end-perform
             end-start

          else
    
          
            start exthrk key > exthrk-anah invalid
                continue
                not invalid
                  perform until fs-exthrk = "10"
                read exthrk next no lock 
                   end move "10" to fs-exthrk
                   not end
                     if exthrk-folio not = konuk-folio 
                        move "10" to fs-exthrk
                        else
                        move exthrk-rec to hrkgir-rec
                        
                        perform topla
                    end-if
                end-read
                end-perform
             end-start

      end-if
     perform pen-yukle
      close konuk  romhrk   exthrk  kur
      
      .
topla.
     if hrkgir-ref < 1 then 
           move 1 to hrkgir-ref
     end-if
     move 1 to p-var(hrkgir-ref)
    if hrkgir-ba= "B"
      add hrkgir-tl-tutar to p-bakiye(hrkgir-ref)
      else
      subtract hrkgir-tl-tutar from p-bakiye(hrkgir-ref)
    end-if
    if hrkgir-fatura-no > 0 then
      continue
      else
      move 1 to p-fatura(hrkgir-ref)
    end-if


      .
*
 extra-topla.
        move konu2-banka to kur-banka
        move konu2-doviz to kur-doviz doviz-kodu
        move hrkgir-tarih to kur-tarih
        read kur no lock invalid
            move 1 to gunluk-kur
            not invalid
             move doviz-alis to gunluk-kur
       end-read

     if hrkgir-ref < 1 then 
           move 1 to hrkgir-ref
     end-if
     move 1 to p-var(hrkgir-ref + 10 )
    if hrkgir-ba= "B"
           add hrkgir-tl-tutar to p-bakiye(hrkgir-ref + 10 )
       compute  p-dov-bakiye(hrkgir-ref + 10 ) rounded =  p-dov-bakiye(hrkgir-ref + 10 ) +
                      hrkgir-tl-tutar / gunluk-kur
    
      else
      subtract hrkgir-tl-tutar from p-bakiye(hrkgir-ref + 10 )
        compute  p-dov-bakiye(hrkgir-ref + 10 ) rounded =  p-dov-bakiye(hrkgir-ref + 10 ) -
                      hrkgir-tl-tutar / gunluk-kur
    end-if
    if hrkgir-fatura-no > 0 then
      continue
      else
      move 1 to p-fatura(hrkgir-ref + 10 )
    end-if




        .

*
 pen-yukle.
     
      open input folref musteri kodlar02
      modify pen-gd, reset-grid  = 1
                         mass-update = 1.
      initialize pen-record
      move "Pen "         to prec1
      move "Odeme "       to prec2
      move "Cari Adi "    to prec3
      move "[TL] Tutar "  to prec4
      move "Fat "         to prec5
      
      modify pen-gd, record-to-add (pen-record) 
       move 1 to kayit-sayi   
     
      perform varying ii from 1 by 1 until ii > 10
              if p-var(ii) = 1 then
               add 1 to kayit-sayi
              
               initialize pen-record   folref-rec
                 move konuk-folio to folref-folio
                 move ii to folref-ref
                 read folref no lock invalid
                      move "B"               to kodlar02-tipi
                      move konuk-odeme-tipi  to kodlar02-kodu 
                      read kodlar02 no lock invalid
                           move "Tanimsiz"   to kodlar02-adi
                      end-read
                      move ode-tipi to fol-pes
                        if  folref-ref = 1 then
                             if fol-pes not = "A" 
                                 move 1 to folref-ode
                              else
                                move 0 to folref-ode
                             end-if
                           else
                         move 0 to folref-ode
                      end-if
                 
                 
                  

               
                 end-read
                  move ii to zz p-no(ii) 

                  
               move zz to prec1
                 if folref-ode = 1 then
                   move "C/L" to prec2
                   else
                   move "SELF" to prec2 
                 end-if
                  

*                   move folref-profil-anah to m-profil         |firat m-profil bos gorunuyor.. 17/08/2020
                   move folref-profil-sirket to musteri-sirket
                   move folref-profil-no     to musteri-no
                   read musteri  no lock invalid continue
                    not invalid
                      string musteri-adi delimited by "  "
                           " " delimited by size
                           musteri-soyadi delimited by "  "
                           into prec3

                   end-read
                   move folref-ode to p-odeme(ii)
 

                 move p-bakiye(ii) to z-bakiye
                 move z-bakiye to prec4
                 if p-fatura(ii) = 1 then
                   move "FAT" to prec5
                   else
                   move "   " to prec5
                 end-if
                 modify pen-gd, record-to-add (pen-record) 
                 modify pen-gd(kayit-sayi,1) hidden-data = pen-top(ii)
             end-if
      end-perform
    
      perform varying ii from 1 by 1 until ii > 10
              if p-var( ii + 10 ) = 1 then
               add 1 to kayit-sayi
              
               initialize pen-record   folref-rec
                 move ext-fol-no to folref-folio
                 move ii to folref-ref
                 read folref no lock invalid
                     continue
                 end-read
                  move ii to zz p-no(ii + 10 )
                  add 10 to p-no (ii + 10 )
               move zz to prec1(2:1)
               move "E" to prec1(1:1) 
             
                 if folref-ode = 1 then
                   move "C/L" to prec2
                   else
                   move "SELF" to prec2 
                 end-if
                  
*                   move folref-profil-anah to m-profil         |firat m-profil bos gorunuyor.. 17/08/2020
                   move folref-profil-sirket to musteri-sirket
                   move folref-profil-no     to musteri-no
                   read musteri  no lock invalid continue
                    not invalid
                      string musteri-adi delimited by "  "
                           " " delimited by size
                           musteri-soyadi delimited by "  "
                           into prec3
                   end-read
                 move p-dov-bakiye( ii + 10 ) to z-bakiye
                 move z-bakiye(2:) to prec3
                 
                 move exdov to prec3(12:3)


                   move folref-ode to p-odeme( ii + 10 )
 

                 move p-bakiye( ii + 10 ) to z-bakiye
                 move z-bakiye to prec4
                 if p-fatura(ii + 10 ) = 1 then
                   move "FAT" to prec5
                   else
                   move "   " to prec5
                 end-if
                 modify pen-gd, record-to-add (pen-record) 
                 modify pen-gd(kayit-sayi,1) hidden-data = pen-top(ii + 10 )
                 modify pen-gd(kayit-sayi,2) hidden-data = ext-fol-no

             end-if
      end-perform
          modify pen-gd, 
                         mass-update = 0.
       close folref musteri kodlar02.
                   
*
 pen-gd-Ev-Other.
        evaluate event-type 
         when msg-begin-entry
                inquire pen-gd x in px
                     y in py
       inquire pen-gd(py,1) hidden-data in pen-top(10)
       if p-no(10) > 0 and < 20 then
         evaluate px
           when 5
             
              if p-bakiye(10) = 0 then
             move   p-no(10) to link-ref
                  if p-no(10) < 11 then

                     if onkpara-yeni-fatura = 1
                        call "/asya/ytl/obj/otel/folfaty.asy" 
                         using  konuk-folio, konuk-odano, link-ref
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/folfaty.asy"
                       end-call
                     else 
                        call "/asya/ytl/obj/otel/folfat1.asy" 
                         using  konuk-folio, konuk-odano, link-ref
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/folfat1.asy"
                       end-call
                       
                     end-if 
                    else
                       if onkpara-yeni-fatura = 1
                      subtract 10 from p-no(10)
                       move   p-no(10) to link-ref
                      call "/asya/ytl/obj/otel/folfaty.asy" 
                         using  ext-fol-no , konuk-odano, link-ref
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/folfaty.asy"
                    end-call
                    else
                      subtract 10 from p-no(10)
                       move   p-no(10) to link-ref
                      call "/asya/ytl/obj/otel/folfat1.asy" 
                         using  ext-fol-no , konuk-odano, link-ref
                      on exception 
                          perform callerr-proc
                          exit paragraph
                      not on exception 
                          cancel "/asya/ytl/obj/otel/folfat1.asy"
                    end-call

                    end-if 

                    end-if
                     perform Pen-Kont
                 else
                 display message box "BALANSLI FATURA KESILEMEZ" title "BALANSLI FATURA"
               end-if

           when other
            if  p-bakiye(10) > 0 then 
            initialize dokcagir-tasi
              set dokcagir-tasi-call-cekgir3   to true
               if p-no(10) < 11 then   

                      move konuk-folio                 to dokcagir-konuk-folio
                      move p-no(10) to dokcagir-pencere
                      if p-odeme(10)  = 1 then 
                         move onkpara-city-ledger   to dokcagir-dep-kodu
                          if acenta-cdep > spaces 
                            move   acenta-cdep     to   dokcagir-dep-kodu
                        end-if
                         else
                          move onkpara-outlet-cash  to dokcagir-dep-kodu
                           if acenta-sdep > spaces 
                                 move   acenta-sdep     to   dokcagir-dep-kodu
                             end-if
                      end-if
                  else
                     subtract 10 from p-no(10)
                      move ext-fol-no                 to dokcagir-konuk-folio
                      move p-no(10) to dokcagir-pencere
                      if p-odeme(10)  = 1 then 
                         move onkpara-city-ledger   to dokcagir-dep-kodu
                         else
                          move onkpara-outlet-cash  to dokcagir-dep-kodu
                      end-if

              end-if
              move p-bakiye(10)                 to dokcagir-cout-tutar
              perform dokcagir-call
              perform Pen-Kont
             end-if
              
         end-evaluate
       end-if
             move event-action-fail to event-action,
    end-evaluate.
     .
*
 Form1-Pb-6-Link.
        call "/asya/ytl/obj/otel/rezsuz.asy"
      using bosdolu-cagir
      on exception 
        perform callerr-proc
      not on exception
        cancel "/asya/ytl/obj/otel/rezsuz.asy"
    end-call
     .
*
 Form1-Pb-7-Link.
            call "/asya/ytl/obj/otel/restrez.asy"
      using bosdolu-cagir
      on exception 
        perform callerr-proc
      not on exception
        cancel "/asya/ytl/obj/otel/restrez.asy"
    end-call
     .
     
     .
*
 Form1-Ef-adi-Ev-Cmd-Goto.
       move 1 to siradaki
     .
*
 Form1-Ef-adi2-Ev-Ntf-Changed.
       move 2 to siradaki
       perform  bulunana-git2.
     .
*
 Form1-Ef-adi3-Ev-Ntf-Changed.
        move 3 to siradaki
        perform bulunana-git2.
     .
*
 Form1-Ef-adi4-Ev-Ntf-Changed.
         move 4 to siradaki
        perform  bulunana-git2.
     .
*
 Form1-Ef-adi5-Ev-Ntf-Changed.
         move 5 to siradaki
         perform bulunana-git2.
     .
*
*
 bulunana-git2.
       move  yer(siradaki)  to  takas-yer 
       read takas key takas-yer 
           invalid continue
           not invalid 
               move 1 to control-id
               move 4 to accept-control
               move 1 to apodan-geldi
       
          move 1 to apodan-geldi
      
        end-read
    
         .
*
 qal.
          open i-o odalar
       
          read odalar no lock invalid
             display message box "Lutfen oda seciniz" title " "
          end-read  
          close odalar        
       if cell-rez > 0 and cell-folio not > 0 then
             if HOUSE-DURUMU = house-bt  or house-ok
                 display message box "ODA TEMIZ " title "ODA TEMIZ"
                 exit paragraph
             end-if
             initialize rezodablok-rec
              open i-o rezodablok

                     
                  move rez-odano to rezodablok-odano
                  move rez-no to rezodablok-rezno
                 read rezodablok no lock invalid 
                 continue
                 end-read
                 if rezodablok-qtar > "19000000"  then 
                    move  rezodablok-qtar-yil to e-yil
                    move  rezodablok-qtar-ay to e-ay
                    move  rezodablok-qtar-gun to e-gun
                    move  rezodablok-qtar-saat to e-saat
                    move  rezodablok-qtar-dakika to e-dakika
                            display message box "Oda daha once  talep listesine alinmis" new-line
                               "Tarih :" e-tarih " Saat :" e-zaman   new-line
                               k-adi k-soyadi new-line  title "TALEP DAHA ONCE VERILMIS"
                  else
                      
                            accept  rezodablok-qtar from century-date
                            accept rezodablok-qtar-zaman from time
                            move k-kodu-tasi to  rezodablok-qstaf rezodablok-staf   
                           rewrite rezodablok-rec invalid write rezodablok-rec end-rewrite
                  end-if
      

              close rezodablok
          end-if .
*
 Form1-Pb-7a-Link.
     

            call "/asya/ytl/obj/otel/extrack.asy"                         
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/extrack.asy"
            end-call 
     .

*
 4ipnet-internet-ac. 
     initialize lik-int-folio 
     move  cell-folio to lik-int-folio
     call "/asya/ytl/obj/otel/intlogl.asy" 
          using lik-int-folio
          on exception 
          perform callerr-proc
          exit paragraph
          not on exception 
          cancel "/asya/ytl/obj/otel/intlogl.asy"
     end-call
     
     .

     
     .
*
 Form1-Pb-9-Link.
            call "/asya/ytl/obj/otel/blokajy1.asy"                         
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/blokajy1.asy"
            end-call      
     .
*
 Form1-Mn-1-MI-oda-kart-Link.
     if k-kodu-tasi = "ASYA" stop " " end-if
     if genel-oto-kapi = 1
        open input rez
        initialize rez-rec
        move cell-rez to rez-no
        read rez no lock invalid  
            continue 
        not invalid 
          initialize link-kapi-hepsi
          move rez-odano     to link-kapi-odano
          move 1             to link-kapi-nereden
          move rez-buyuk     to link-kapi-kisi-sayisi
          move rez-no        to link-kapi-rez-no
          call "/asya/ytl/obj/otel/kapikart.asy" 
                       using link-kapi-hepsi
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
             cancel "/asya/ytl/obj/otel/kapikart.asy"
          end-call         
        end-read 
        close rez
     else
        initialize link-kapi2-rez-no
        move cell-rez to link-kapi2-rez-no
        call "/asya/ytl/obj/otel/kartkap2.asy" using link-kapi2-rez-no oda-num
        on exception 
           perform callerr-proc
           exit paragraph
        not on exception 
            cancel "/asya/ytl/obj/otel/kartkap2.asy"
        end-call
     end-if.
*
 planlanan-degisim-kontrol.
     open input cast konuk rez
     initialize cast-rec vis-deg-var dizi-odalar 
     move  0 to k
     move tarih-tasi          to cast-tarih
     start cast key not < cast-anah invalid
          continue 
     not invalid
     perform until fs-cast = "10"
     read cast next no lock end move "10"  to fs-cast
     not at end 
             if cast-tarih <> tarih-tasi
                 exit perform 
             end-if 
             initialize rez-rec
             move cast-rez-no   to rez-no
             read rez no lock invalid 
                 exit perform cycle 
             not invalid 
                 if rez-durumu not = "I"
                     exit perform cycle 
                 end-if 
                 initialize konuk-rec
                 move rez-folio    to konuk-folio
                 read konuk no lock invalid 
                      continue 
                 not invalid 
                      if cast-oda-no not = konuk-odano
                         move 1   to vis-deg-var
                         add 1 to k 
                         move konuk-odano to dizi-oda(k)
                      end-if 
                      if cast-buyuk not = konuk-buyuk
                         move 1   to vis-deg-var
                      end-if 
                      if cast-kucuk not = konuk-kucuk
                         move 1   to vis-deg-var
                      end-if 
                      if cast-free not = konuk-free
                         move 1   to vis-deg-var
                      end-if 
                      if cast-bebek not = konuk-bebek
                         move 1   to vis-deg-var
                      end-if 
                 end-read
             end-read 
     end-read 
     end-perform
     end-start
     close cast konuk rez
      
        display Form1-Pb-7aa .
     
*
 Form1-Pb-7aa-Link.
     call "/asya/ytl/obj/otel/castdeg.asy"  
        on exception 
        perform callerr-proc
             exit paragraph
     not on exception 
       cancel "/asya/ytl/obj/otel/castdeg.asy"
     end-call.     
*
 Form0-Aft-Routine.
     close odalar2
     .

*
 cast-to-rez-oda-kontrol.
    move "cast" to cast2-dosya-adi
    open i-o cast cast2
    open input rez                                      
         initialize cast-rec  
         move tarih-tasi   to cast-tarih
         start cast key not < cast-anah invalid 
            continue 
         not invalid 
         perform with test after until fs-cast = "10"
         read cast next no lock end move "10"  to fs-cast
         not at end 
                 if cast-tarih <> tarih-tasi
                       exit perform
                 end-if
                 initialize rez-rec
                 move cast-rez-no to rez-no
                 read rez no lock invalid
                         exit perform cycle
                 not invalid
                      if rez-cik-tar = cast-tarih or REZ-K-G-B <> "K" or rez-durumu <> 'I'
                            exit perform cycle
                      end-if
              
                      if rez-odano <> spaces and cast-oda-no = spaces
                                 initialize cast2-rec   
                                 move cast-rez-no   to cast2-REZ-NO
                                 start cast2 key not < cast2-anah1 invalid 
                                            continue 
                                 not invalid 
                                 perform with test after until fs-cast2 = "10"
                                 read cast2 next no lock end move "10"  to fs-cast2
                                 not at end 
                                         if cast2-REZ-NO <> cast-rez-no
                                               exit perform
                                         end-if
                                         if rez-cik-tar = cast2-tarih or cast2-oda-no <> spaces
                                               exit perform cycle
                                         end-if
                                         move rez-odano to cast2-oda-no
                                         rewrite cast2-rec invalid
                                                 stop " "
                                         end-rewrite
                                 end-read 
                                 end-perform
                                 end-start 
                      end-if
                 end-read
         end-read 
         end-perform
         end-start
    close cast rez cast2
    perform rez-ileriye-gunluk-oda-kontrol
*    perform odalar2-kontrol
    .
*
*  odalar2-kontrol.
*     open i-o odalar
*     initialize odalar-rec
*     start odalar key not < odalar-anah invalid
*           continue
*     not invalid
*     perform with test after until fs-odalar = "10"
*     read odalar next no lock end move "10" to fs-odalar
**     not at end
*         initialize odalar2-rec
*         move odalar-anah to odalar2-no

*         if odalar-uzun-no <> spaces
*            move odalar-uzun-no to odalar2-anah
*         else 
*            move odalar-anah to odalar2-anah
*         end-if
*         
*         read odalar2 no lock invalid
*              continue
*         end-read
*         
*         write odalar2-rec invalid
*               rewrite odalar2-rec end-rewrite
*         end-write
*         perform log-operation-odalar
*     end-read
*     end-perform 
*     end-start
*     close odalar
*     .

* 
 rez-ileriye-gunluk-oda-kontrol.
    open input rez takvim
    open i-o cast2
         initialize takvim-rec takvim-adet
         move tarih-tasi to takvim-anah
         start takvim key not < takvim-anah invalid
                 continue
         not invalid
         perform until fs-takvim = "10"
         read takvim next no lock end move "10" to fs-takvim
         not end
               add 1 to takvim-adet
               if takvim-adet = 1
                    exit perform cycle | ilk gunu taramasýn diye
               end-if
               if takvim-adet > 7 
                     exit perform
               end-if
               initialize rez-rec
               move "I"         to REZ-DURUMU
               move takvim-anah to REZ-GIR-TAR 
               start rez key not < REZ-GIR invalid
                       continue
               not invalid 
               perform until fs-rez = "10"
               read rez next no lock end move "10" to fs-rez
               not end
                        if REZ-GIR-TAR <> takvim-anah
                             exit perform 
                        end-if
                        if rez-odano = spaces or REZ-K-G-B <> "K" or rez-durumu <> 'I'
                             exit perform cycle
                        end-if

                        initialize cast2-rec   
                        move rez-no   to cast2-REZ-NO
                        start cast2 key not < cast2-anah1 invalid 
                                   continue 
                        not invalid 
                        perform with test after until fs-cast2 = "10"
                        read cast2 next no lock end move "10"  to fs-cast2
                        not at end 
                                if cast2-REZ-NO <> rez-no
                                      exit perform
                                end-if
                                if cast2-oda-no <> spaces or rez-cik-tar = cast2-tarih 
                                      exit perform cycle
                                end-if
                                move rez-odano to cast2-oda-no
                                rewrite cast2-rec invalid
                                        stop " "
                                end-rewrite
                        end-read 
                        end-perform
                        end-start 
               end-read
               end-perform
               end-start

         end-read
         end-perform
         end-start
    close rez takvim cast2.
*
 Form1-Cm-3-Ex-Ntf-Selchange.
     perform Form1-Cb-1aa-Ex-Cmd-Clicked
     .


 
