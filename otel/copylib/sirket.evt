* sirket.evt
* sirket.evt is generated from D:\asya\acugt.ytl\otel\sirket.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM exception-procedure
     .

 Form1-Lb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Dblclick
           PERFORM Form1-Lb-1-Ex-Cmd-Dblclick
        END-EVALUATE
     ELSE
        PERFORM Form1-Lb-1-Ex-Other
     END-IF
     .

 Form2-Event-Proc.
     .

 Form2-Exception-Proc.
     PERFORM Exception-Procedure
     .

 accept-0101-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Spin-Down
        PERFORM accept-0101-Ev-Msg-Spin-Down
     WHEN Msg-Spin-Up
        PERFORM accept-0101-Ev-Msg-Spin-Up
     END-EVALUATE
     .

 Form2-Lb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Dblclick
           PERFORM Listbox-Eventlar
        WHEN Cmd-Goto
           PERFORM Listbox-Eventlar
        WHEN Ntf-Selchange
           PERFORM Listbox-Eventlar
        END-EVALUATE
     END-IF
     .

 Form2-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Heading-Dblclick
        PERFORM grid-1-Ev-Msg-Heading-Dblclick
     WHEN Other
        PERFORM grid-1-Ev-Other
     END-EVALUATE
     .

 Form3-Event-Proc.
     .

 Form4-Exception-Proc.
     PERFORM Form4-Ex-Other
     .

 Form5-Exception-Proc.
     PERFORM Form5-Ex-Other
     .

 Form1a-Cb-1-Exception-Proc.
     PERFORM dev-ex
     .

 Form1a-Cb-1a-Exception-Proc.
     PERFORM dev-ex
     .

 Form1a-Cb-1b-Exception-Proc.
     PERFORM dev-ex
     .

 Form1a-Cb-1c-Exception-Proc.
     PERFORM dev-ex
     .
***   start event editor code   ***
* kullanici sayisi 0 ise butun kullanicilara yetki
* gelismis bolumu dataya yazdirilacak ...
* ayni sirket varsa tekrar yaratilmasi engellenecek ...
*
 Form1-Aft-Initdata.
     open i-o isyeri.
     open i-o prosif.
     open input kllnc.
     move k-kodu-tasi    to k-kodu
     read kllnc no lock invalid
          initialize kllnc-rec
     end-read
     close kllnc.
*     if k-kodu not = "ASYA"
*        modify Form1-Pb-1a,enabled = false
*     end-if 
     modify form1-lb-1,
            reset-list  = 1
            mass-update = 1
     move all low-values to isyeri-rec
     start isyeri key not < isyeri-sira invalid
           continue
     not invalid
     initialize fs-isyeri
     perform with test after until fs-isyeri = "10"
           read isyeri next no lock end move "10" to fs-isyeri
           not at end
                initialize form1-lb-1-value prosif-rec
                if isyeri-sakli = "S"
                    exit perform cycle
                end-if
                if isyeri-sakli = "T" 
                   if key-status = 20 and k-sirket-evet
                      continue
                   else
                       exit perform cycle
                   end-if
                end-if
                move k-kodu-tasi    to prosif-kim
                move isyeri-no      to prosif-cob
                move "S"            to prosif-tipi
                read prosif no lock invalid 
                     move "E" to prosif-giris  ||| move "H"       to prosif-giris  |||
                     write prosif-rec invalid  ||| apdullah abi kllnc sirket baglantý 
                           rewrite prosif-rec invalid
                                   continue
                           end-rewrite
                     end-write
*                     perform log-operation-prosif
                end-read
                if prosif-giris = "E" or prosif-giris = " "
                   move isyeri-no      to lb-1-col-1
                   move isyeri-unvan   to lb-1-col-2
                   move isyeri-adres   to lb-1-col-3
                   modify form1-lb-1,
                          item-to-add(form1-lb-1-value)
                end-if
           end-read
     end-perform
     end-start
     initialize isyeri-rec
     modify form1-lb-1,
            selection-index = 1
            mass-update = 0
           
     close isyeri prosif.
     call "w$flush" using 1.
     .
*
 Form1-Bef-Procedure.
     add 1 to sacma-sayac.
     if sacma-sayac = 1
        modify Form1-Lb-1, selection-index = 1.
     perform bef-procedure.
     .
*
 Form1-Bef-Create.
*/  menuden mi cagirildi kontrolu
*/  0 ise menuden cagrildi ve bilgi aktarimi yapma
    if HAS-GRAPHICAL-INTERFACE
       initialize link-mi narg-status
       call "c$narg" using narg-status
       move narg-status to link-mi
       perform adresleri-tasi
       initialize key-status.

**********************TEXT***********************
*************************************************
     if not HAS-GRAPHICAL-INTERFACE 
        perform text-sirket-sec thru text-sirket-sec-exit
        goback.
     .
*
 exception-procedure.
     evaluate key-status
         when 17 
             move "/asya/ytl/data/otel/standart/isyeri"  to link-logview-dosya-adi
             set link-logview-pointer  to address of isyeri-rec
             set link-logview-rec-size to size of isyeri-rec
             perform logview-call
             initialize key-status
          when 20
               perform Form1-Aft-Initdata
               initialize key-status
          when 1001
               if link-aktarma
                  exit paragraph
               end-if
               inquire form1-lb-1,value in form1-lb-1-value
               if lb-1-col-3 = spaces 
                  exit paragraph
               end-if
               perform sifre-kontrol
               if islem-donus = 0
                  move lb-1-col-3 to isyeri-adres-tasi
                  move lb-1-col-1 to isyeri-no-tasi
*                  call "w$keybuf" using 1,x"1b" end-call
                  move 27 to key-status
                  destroy form1-handle
                  goback
               else
                  exit paragraph
               end-if
          when 1002
               perform acu-form2-routine
               initialize key-status
               perform Form1-Aft-Initdata
          when 002
               perform kaydet-soru
               if not soru-evet
                  exit paragraph
               end-if
               initialize i
               inspect isyeri-adres 
                       tallying i 
                       for all spaces
               if i > 0
                  display message box 
                          "Sirket ismi 8 karakter uzunlugunda olmalidir",new-line,
                          "bosluk karakteri kullanmayiniz "
                          icon mb_warning_icon
                          title "Bilginize ..."
                          move 4 to accept-control
                          move 22 to control-id
                          exit paragraph
               end-if
               if isyeri-adres = spaces or
                  isyeri-no = zeroes or isyeri-no = spaces
                  move 4 to accept-control
                  move 22 to control-id
                  exit paragraph
               end-if
               initialize temp-a temp-b kullanici-sayi
               inquire grid-1,
                       last-row in temp-b
               perform varying temp-a from 1 by 1 until temp-a > temp-b
                       inquire grid-1(temp-a,1),
                               hidden-data in char
                       if char = "E"
                          add 1 to kullanici-sayi
                       end-if
               end-perform
               if sirket-sayi > zeroes
                  initialize ii
                  perform varying i from 1 by 1 until i > sirket-sayi
                          modify form2-lb-1,query-index = i
                          inquire form2-lb-1,item-value in form2-lb-1-value
                          if lb-2-col-2 = isyeri-adres
                             add 1 to ii
                          end-if
                  end-perform
                  if ii > 1
                     move 4 to accept-control
                     move 22 to control-id
                     exit paragraph
                  end-if
               end-if
               initialize durum
               open i-o isyeri
               evaluate grup-value
                   when 2 move "S"  to isyeri-sakli
                   when 3 move "T"  to isyeri-sakli
                   when other initialize isyeri-sakli
               end-evaluate
               move k-kodu-tasi to isyeri-staf
               write isyeri-rec invalid
                     move "E" to durum
                     rewrite isyeri-rec end-rewrite
               end-write
               perform log-operation-isyeri
******************************************************
*               if kullanici-sayi = 0
*                  display message box 
*                          "Sirkete girme yetkisi olan kullanici sayisi : 0",new-line,new-line
*                          "Kullanici kodu tanimlamasi ve yetkilendirme icin bir supervisor ",new-line,
*                          "koduna veya bu yetkilere sahip bir kullaniciya ",new-line,
*                          "sirkete giris yetkisi veriniz",
*                          title "Bilginize ...",
*                          icon mb_warning_icon
*                          type mb_ok
*                          exit paragraph
*               end-if
******************************************************
*/ Dizin aciliyors
*-----------------------------------------------------
               initialize return-code
               move isyeri-adres to makedir-dizin
               call "C$MAKEDIR" using makedir-param 
                     giving return-code
               end-call
*-----------------------------------------------------
*/ log klasörü
               initialize logdir-dizin
               call "C$MAKEDIR" using logdir-param 
                     giving return-code
               end-call

               move isyeri-adres  to logdir-dizin

               call "C$MAKEDIR" using logdir-param 
                     giving return-code
               end-call                
               if durum = space
                  perform data-ac
*                  if link-mi = 0 then
*                      display message box 
*                           "Bu Sirketin Sablonunun Uygulansin mi?"
*                           type 2, icon 2, default 2
*                           giving sonuc
*                            title "SABLON KULLANIMI"
*                    if sonuc = 1 then
**                      perform genel-ac
*                      perform sablon-al
*                    end-if
*                    
*                  end-if
               end-if
               close isyeri
               perform listbox-yer-bul
               if i > zeroes
                    initialize form2-lb-1-value
                    modify form2-lb-1,
                           item-to-delete(i)
                    move isyeri-sira       to lb-2-col-1
                    move isyeri-adres      to lb-2-col-2
                    move isyeri-no         to lb-2-col-3
                    move isyeri-unvan      to lb-2-col-4
                    modify form2-lb-1,
                           item-to-add(form2-lb-1-value)
               else
                    initialize form2-lb-1-value
                    move isyeri-sira       to lb-2-col-1
                    move isyeri-adres      to lb-2-col-2
                    move isyeri-no         to lb-2-col-3
                    move isyeri-unvan      to lb-2-col-4
                    modify form2-lb-1,
                           item-to-add(form2-lb-1-value)
                    add 1 to sirket-sayi
               end-if
               move 4 to accept-control
               move 15 to control-id
               perform prosif-yaz
               exit paragraph
          when 003
               perform sil-soru
               if not soru-evet 
                  exit paragraph
               end-if
               open i-o isyeri
               delete isyeri invalid continue 
                      not invalid
                      subtract 1 from sirket-sayi
               end-delete
               perform log-operation-isyeri
               close isyeri
               perform listbox-yer-bul
               if i > zeroes
                    initialize form2-lb-1-value
                    modify form2-lb-1,
                           item-to-delete(i)
               end-if
               move 4 to accept-control
               move 15 to control-id
               exit paragraph
               perform prosif-sil
          when 3001
               inquire form2-lb-1,
                       selection-index in i
               if i < 2 
                  exit paragraph
               end-if
               modify form2-lb-1,query-index = i - 1
               inquire form2-lb-1,item-value in form2-lb-1-value
               modify form2-lb-1, item-to-delete(i - 1)
               modify form2-lb-1, insertion-index = i
                                  item-to-add(form2-lb-1-value)
          when 3002
               inquire form2-lb-1,
                       selection-index in i
               if i = sirket-sayi
                  exit paragraph
               end-if
               modify  form2-lb-1, query-index = i + 1
               inquire form2-lb-1, item-value in form2-lb-1-value
               modify  form2-lb-1, item-to-delete(i + 1)
               modify  form2-lb-1, insertion-index = i
                                   item-to-add(form2-lb-1-value)
          when 3003
               open i-o isyeri
               perform varying i from 1 by 1 until i > sirket-sayi
                    initialize isyeri-rec
                    modify form2-lb-1,
                           query-index = i
                    inquire form2-lb-1,
                           item-value in  form2-lb-1-value
                    move lb-2-col-3 to isyeri-no
                    read isyeri no lock invalid
                         continue
                    not invalid
                         move i to isyeri-sira
                         rewrite isyeri-rec invalid continue 
                         end-rewrite
                         perform log-operation-isyeri
                    end-read
                    move isyeri-sira    to lb-2-col-1
                    modify form2-lb-1,
                           item-to-delete(i)
                    modify form2-lb-1,
                           insertion-index = i
                           item-to-add(form2-lb-1-value)
               end-perform
               close isyeri
               modify form2-lb-1,
                      selection-index = 1
               move cmd-dblclick     to event-type
               perform listbox-eventlar
          when 7001
               initialize opensave-data
               call "c$opensavebox" using 
                    opensave-browse-folder,
                    opensave-data
                    giving opensave-status
               end-call
               if opensave-status <> 1 
                  exit paragraph
               end-if
               move opnsav-filename to isyeri-adres
               display accept-0104
          when 7002
               perform acu-form3-routine
     end-evaluate.

 sirket-to-lb-2.
     initialize sirket-sayi.
     modify form2-lb-1,
            reset-list  = 1
            mass-update = 1
     open i-o isyeri.
     move all low-values to isyeri-rec.
     start isyeri key not < isyeri-sira invalid
           continue
     initialize fs-isyeri
     not invalid
     perform with test after until fs-isyeri = "10"
           read isyeri next no lock end move "10" to fs-isyeri
           not at end
                add 1 to sirket-sayi
                initialize form2-lb-1-value
                move isyeri-sira       to lb-2-col-1
                move isyeri-adres      to lb-2-col-2
                move isyeri-no         to lb-2-col-3
                move isyeri-unvan      to lb-2-col-4
                modify form2-lb-1,
                       item-to-add(form2-lb-1-value)
           end-read
     end-perform
     end-start
     close isyeri.
     modify form2-lb-1,
            mass-update = 0.
     initialize isyeri-rec.
     perform grid-1-init.

 grid-1-init.
     modify grid-1,
            reset-grid = 1
            mass-update = 1
     move "Kodu"             to gd-1-col-1
     move "Adi"              to gd-1-col-2
     move "Soyadi"           to gd-1-col-3
     modify grid-1,
            record-to-add(grid-1-record-data)
     modify grid-1,
            mass-update = 0.
     .
 accept-0101-Bef-Procedure.
     initialize isyeri-rec.
     display accept-0102,accept-0102,accept-0103,accept-0104,accept-0105.
     modify button-0201,enabled = false
     modify button-0202,enabled = false.
     perform bef-procedure.
*
 accept-0101-Aft-Procedure.
     if (isyeri-no = spaces) or (isyeri-no = zeroes)
        modify button-0201,enabled = false
        modify button-0202,enabled = false
     else 
        modify button-0201,enabled = true
        modify button-0202,enabled = true
     end-if.
     open i-o isyeri.
     read isyeri no lock invalid
          initialize isyeri-rec
          inquire accept-0102,value in isyeri-no
          modify accept-0104,enabled = true
          modify but-sirket,enabled = true
          move 1 to grup-value
     not invalid
          modify accept-0104,enabled = false
          modify but-sirket,enabled = false
          evaluate isyeri-sakli
              when "S"   move 2 to grup-value
              when "T"   move 3 to grup-value
              when other move 1 to grup-value
          end-evaluate
     end-read
     display accept-0102,accept-0103,accept-0104,accept-0105.
     close isyeri.
     perform listbox-yer-bul.
     if i > zeroes
        modify form2-lb-1,
               selection-index = i
     end-if.
     perform kullanici-goster.

 listbox-eventlar.
     evaluate event-type
          when cmd-dblclick
               inquire form2-lb-1,value in form2-lb-1-value
               move lb-2-col-3 to isyeri-no
               perform accept-0101-Aft-Procedure
               move 4 to accept-control
               move 18 to control-id
               exit paragraph
          when ntf-selchange
          when cmd-goto
               inquire form2-lb-1,value in form2-lb-1-value
               move lb-2-col-3 to isyeri-no
               display accept-0101,
               perform accept-0101-Aft-Procedure
     end-evaluate.
     
     .
 listbox-yer-bul.
     initialize durum tekrar
     perform varying i from 1 by 1 until (durum = "E" or "H")
             initialize esirket-no form2-lb-1-value
             modify form2-lb-1,
                    query-index = i
             inquire form2-lb-1,
                    item-value in form2-lb-1-value
             move lb-2-col-3 to esirket-no
             if esirket-no <> spaces
                if esirket-no = tekrar
                   move "E" to durum
                   exit perform
                else
                   move esirket-no to tekrar
                end-if
             end-if

             if esirket-no = spaces
                move "H" to durum
                initialize i 
                exit perform
             else
                if esirket-no = isyeri-no
                   move "E" to durum
                   exit perform
                end-if
             end-if
    end-perform.
 bef-procedure.
    initialize mesaj hangi-form.
    evaluate control-id
           when 2
                move 1 to hangi-form
                evaluate true
                    when turkce
                         move "Cift tiklayarak sirkete giris yapabilirsiniz" to mesaj
                    when almanca
                         move "Cift tiklayarak sirkete giris yapabilirsiniz" to mesaj
                    when ingilizce
                         move "Cift tiklayarak sirkete giris yapabilirsiniz" to mesaj
                end-evaluate
           when 4
                move 1 to hangi-form
                evaluate true
                    when turkce
                         move "Sirkete giris icin tiklayin" to mesaj
                    when almanca
                         move "Sirkete giris icin tiklayin" to mesaj
                    when ingilizce
                         move "Sirkete giris icin tiklayin" to mesaj
                end-evaluate
           when 5
                move 1 to hangi-form
                evaluate true
                    when turkce
                         move "Yeni bir sirket acmak icin tiklayiniz" to mesaj
                    when almanca
                         move "Yeni bir sirket acmak icin tiklayiniz" to mesaj
                    when ingilizce
                         move "Yeni bir sirket acmak icin tiklayiniz" to mesaj
                end-evaluate
           when 15
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket kodunu giriniz" to mesaj
                    when almanca
                         move "Sirket kodunu giriniz" to mesaj
                    when ingilizce
                         move "Sirket kodunu giriniz" to mesaj
                end-evaluate
           when 18
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket adini giriniz " to mesaj
                    when almanca
                         move "Sirket adini giriniz"  to mesaj
                    when ingilizce
                         move "Sirket adini giriniz " to mesaj
                end-evaluate
           when 20
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket resmi unvanini giriniz " to mesaj
                    when almanca
                         move "Sirket resmi unvanini giriniz " to mesaj
                    when ingilizce
                         move "Sirket resmi unvanini giriniz " to mesaj
                end-evaluate
           when 22
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Dosyalarin yer alacagi kutuphane(dizin) adini giriniz" to mesaj
                    when almanca
                         move "Dosyalarin yer alacagi kutuphane(dizin) adini giriniz" to mesaj
                    when ingilizce
                         move "Dosyalarin yer alacagi kutuphane(dizin) adini giriniz" to mesaj
                end-evaluate
           when 23
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket kodunu kaydetmek icin tiklayiniz" to mesaj
                    when almanca
                         move "Sirket kodunu kaydetmek icin tiklayiniz" to mesaj
                    when ingilizce
                         move "Sirket kodunu kaydetmek icin tiklayiniz" to mesaj
                end-evaluate
           when 24
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket kodunu silem icin (Bilgiler silinmez) " to mesaj
                    when almanca
                         move "Sirket kodunu silem icin (Bilgiler silinmez) " to mesaj
                    when ingilizce
                         move "Sirket kodunu silem icin (Bilgiler silinmez) " to mesaj
                end-evaluate
           when 7
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket sirasini daha one almak icin tiklayiniz" to mesaj
                    when almanca
                         move "Sirket sirasini daha one almak icin tiklayiniz" to mesaj
                    when ingilizce
                         move "Sirket sirasini daha one almak icin tiklayiniz" to mesaj
                end-evaluate
           when 8
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sirket sirasini daha arkaya almak icin tiklayiniz" to mesaj
                    when almanca
                         move "Sirket sirasini daha arkaya almak icin tiklayiniz" to mesaj
                    when ingilizce
                         move "Sirket sirasini daha arkaya almak icin tiklayiniz" to mesaj
                end-evaluate
           when 9
                move 2 to hangi-form
                evaluate true
                    when turkce
                         move "Sira degisikliklerini kaydetmek icin tiklayiniz" to mesaj
                    when almanca
                         move "Sira degisikliklerini kaydetmek icin tiklayiniz" to mesaj
                    when ingilizce
                         move "Sira degisikliklerini kaydetmek icin tiklayiniz" to mesaj
                end-evaluate
     end-evaluate.
     if hangi-form = 1
       modify form1-st-1-handle,
              panel-index = 1
              panel-text  = mesaj 
     else
       modify form2-st-1-handle,
              panel-index = 1
              panel-text  =  mesaj
    end-if.
 data-ac.
    call "/asya/ytl/obj/otel/dataac.asy" using isyeri-adres on exception
         perform callerr-proc
    not on exception
         cancel "/asya/ytl/obj/otel/dataac.asy"
    end-call.
*
 Form1-Lb-1-Ex-Cmd-Dblclick.
    if link-aktarma
       exit paragraph.
    inquire form1-lb-1,value in form1-lb-1-value
    if lb-1-col-3 = spaces 
       exit paragraph.
    perform Sifre-Kontrol
    if islem-donus = 0
       move lb-1-col-3          to isyeri-adres-tasi
       move lb-1-col-1          to isyeri-no-tasi
*       call "w$keybuf" using 1,x"1b" end-call
       move 27 to key-status
       destroy form1-handle
       goback
    else
       exit paragraph
    end-if.
     
     .
*
 accept-0101-Ev-Msg-Spin-Down.
     inquire accept-0101,value in isyeri-no
     if isyeri-no > zeroes
        subtract 1 from isyeri-no 
        display accept-0101,
     end-if.
     .
*
 accept-0101-Ev-Msg-Spin-Up.
     inquire accept-0101,value in isyeri-no
     if isyeri-no < 99 
        add 1 to isyeri-no 
        display accept-0101,
     end-if.

 kullanici-goster.
     inquire accept-0101,value in isyeri-no
     if isyeri-no = zeroes or spaces
        exit paragraph
     end-if.
     perform Grid-1-Init.
     modify grid-1,
            mass-update = 1.
     open i-o kllnc prosif.
     initialize kllnc-rec 
     move 1 to bmp-y.
     start kllnc key not < k-kodu invalid
           continue
     not invalid
     initialize fs-kllnc
     perform with test after until fs-kllnc = "10"
           read kllnc next no lock end move "10" to fs-kllnc
           not at end
                if k-kullanimda = "E"
                   initialize grid-1-record-data prosif-rec
                   move k-kodu            to prosif-kim
                   move isyeri-no         to prosif-cob
                   move "S"               to prosif-tipi
                   move k-kodu            to gd-1-col-1
                   move k-adi             to gd-1-col-2
                   move k-soyadi          to gd-1-col-3
                   add 1 to bmp-y
                   modify grid-1,
                          record-to-add(grid-1-record-data)
                   read prosif no lock invalid
                        move "E" to prosif-giris
                        write prosif-rec invalid
                              rewrite prosif-rec invalid
                                      continue
                              end-rewrite
                        end-write
*                        perform log-operation-prosif
                   end-read
                   if prosif-giris = "E"  or prosif-giris = " " || prosif-giris = "E"
                      move yes-bmp to bmp-handle                || apdullah abi sirket kullanýcý baðlama
                      perform bmp-set
                   else 
                      move no-bmp to bmp-handle
                      perform bmp-set
                   end-if
                end-if
           end-read
     end-perform
     end-start
     close kllnc prosif.
     modify grid-1,
            mass-update = 0.

 bmp-set.
     if bmp-handle = yes-bmp
        modify grid-1, 
            y = bmp-y
            x = 1
            bitmap           = bmp-handle
            bitmap-number    = 1
            bitmap-trailing  = 1
            bitmap-width     = 16
            hidden-data = "E"
     else
        modify grid-1, 
            y = bmp-y
            x = 1
            hidden-data = "H"
            bitmap           = bmp-handle
            bitmap-number    = 1
            bitmap-trailing  = 1
            bitmap-width     = 16
     end-if.
*
 grid-1-Ev-Other.
    evaluate event-type
        when msg-begin-entry
             move event-action-fail to event-action
        when msg-bitmap-dblclick
             inquire grid-1,
                     y in bmp-y
                     hidden-data in char
             if char = "E"
                move "H" to char
                move no-bmp  to bmp-handle
                perform bmp-set
             else
                move "E" to char
                move yes-bmp  to bmp-handle
                perform bmp-set
             end-if
             modify grid-1,
                    y = bmp-y,
                    x = 1
                    hidden-data = char
        when msg-goto-cell
        when msg-goto-cell-mouse
        when msg-begin-drag
        when msg-end-drag
        when msg-goto-cell-drag
             inquire grid-1,y in yeni-y
             if yeni-y < 2
                move 2 to yeni-y eski-y
             end-if
             if eski-y > zeroes 
                modify grid-1(eski-y),x = 1
                       row-color = 0
                       cell-color = 0
             end-if
             modify grid-1,
                    y = yeni-y,
                    x = 1,
                    row-color = 256
                    cell-color = 256
             move yeni-y to eski-y
    end-evaluate.
 prosif-yaz.
    initialize temp-a temp-b.
    open i-o prosif.
    inquire grid-1,last-row in temp-b.
    perform varying temp-a from 2 by 1 until temp-a > temp-b
            inquire grid-1(temp-a,1),
                    hidden-data in char
                    record-data in grid-1-record-data
            move gd-1-col-1  to prosif-kim
            move isyeri-no   to prosif-cob
            move "S"         to prosif-tipi
            move char        to prosif-giris
            write prosif-rec invalid
                  rewrite prosif-rec end-rewrite
            end-write
*            perform log-operation-prosif
    end-perform.
    close prosif.
 prosif-sil.
*
 Form1-Lb-1-Ex-Other.
     if key-status = 20
        perform exception-procedure
     end-if.
 sifre-kontrol.
     initialize islem-donus.
     open input isyeri.
     move lb-1-col-1    to isyeri-no
     read isyeri no lock invalid
          move 1 to islem-donus
          display message box "Tanimsiz sirket ..."
                  icon mb_error_icon
                  title "Uyari",
     not invalid
         if isyeri-sifre <> spaces 
            initialize form4-donus
            perform acu-form4-routine
            if form4-donus <> 1 
               close isyeri
               goback
            end-if
         end-if
     end-read
     close isyeri.
*
 Form4-Bef-Create.
     initialize kere.
     
     .
*
 Form4-Ex-Other.
     evaluate key-status
         when 27
              move 1 to islem-donus
         when 5001
              if sifre = isyeri-sifre 
                 move 1 to form4-donus
                 set exit-pushed to true
                 exit paragraph
              end-if
              add 1 to kere
              if kere > 3
                 display message box 
                         "Sirket sifresini 3 kereden fazla yanlis yazdiniz",
                         new-line,
                         "Program 20 saniye sonra kapatiliyor !!!"
                         icon mb_error_icon
                         title "Hata"
                 move 20 to kere
                 perform varying kere from 20 by -1 until kere = 0
                         move kere to form4-saniye
                         modify form4-sf-handle,title = form4-title
                         call "c$sleep" using 1
                 end-perform
                 stop run
              end-if
     end-evaluate.
 text-sirket-sec.
    OPEN INPUT ISYERI.
    initialize isyeri-rec.
 EKRAN-AL.
    DISPLAY WINDOW BOXED,SHADOW,ERASE,NO WRAP, NO SCROLL,
    LEFT TITLE IS "[ Isyeri Listesi ]",
    BOTTOM LEFT TITLE IS "[Esc-Cik] [F2-Ekle]",
    LINE 04 COL 47 SIZE 32 LINES 18 COLOR 176,
    POP-UP AREA IS PENCERE-1.

    INITIALIZE ISYERI-TABLO.
    MOVE ZERO TO SON-SAYFA B.
    MOVE 1 TO A.
    MOVE LOW-VALUES TO ISYERI-SIRA.
    START ISYERI KEY IS NOT < ISYERI-SIRA INVALID KEY
                        MOVE 1 TO B PERFORM SON-ATA GO TABLO-SIFIRLA.
TABLO-AKTAR.
    READ ISYERI NEXT NO LOCK END PERFORM SON-ATA GO TABLO-SIFIRLA.
     IF ISYERI-SIRA NOT NUMERIC MOVE 0 TO ISYERI-SIRA.
      IF TUM-SIRKETLER NOT = "E" AND
             ISYERI-SIRA = 999 GO TABLO-AKTAR
      END-IF. 
    IF ISYERI-SIRA = 888 GO TABLO-AKTAR.
    IF A  > 09 PERFORM SON-ATA GO TABLO-SIFIRLA.
    ADD 1 TO B.
    IF B > 18 MOVE 1 TO B
              ADD  1 TO A.
    MOVE ISYERI-NO    TO DIZI-1(A,B).
    MOVE ISYERI-UNVAN TO DIZI-2(A,B).
    MOVE ISYERI-ADRES TO DIZI-3(A,B).
    MOVE ISYERI-SIFRE TO DIZI-SIFRE(A,B).
    MOVE SPACE        TO KONTROL(A,B).
    MOVE A TO SON-SAYFA.
    GO TABLO-AKTAR.
SON-ATA.
    IF B < 1 MOVE 1 TO A B SON-SAYFA. 
    MOVE "X" TO KONTROL(A,B).
TABLO-SIFIRLA.
    CLOSE ISYERI.
    MOVE 1 TO A.
    PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT.
    MOVE 1 TO B.
    PERFORM PARLAT.
AL.
    SET ENVIRONMENT "CURSOR_MODE" TO "2".
    MOVE ZERO TO TUS.
    ACCEPT omitted  LINE B COL 03 COLOR 80 ON EXCEPTION TUS CONTINUE.
    EVALUATE TRUE
    WHEN TUS = 20 AND K-SIRKET-YETKI = "E"
                  CLOSE WINDOW PENCERE-1 
                  MOVE "E" TO TUM-SIRKETLER GO text-sirket-sec
    WHEN TUS = 27 CLOSE WINDOW PENCERE-1
         go text-sirket-sec-exit
    WHEN TUS = 52 AND B NOT =  1
         PERFORM PARLATMA SUBTRACT 1 FROM B PERFORM PARLAT GO AL
    WHEN TUS = 52 AND B = 1 AND A NOT = 1
         SUBTRACT 1 FROM A PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT
         MOVE 18 TO B PERFORM PARLAT GO AL
    WHEN TUS = 53 AND B NOT = 18 AND KONTROL(A,B) NOT = "X"
         PERFORM PARLATMA ADD 1 TO B PERFORM PARLAT GO AL
    WHEN TUS = 53 AND B = 18 AND A NOT = SON-SAYFA
         ADD 1 TO A PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT
         MOVE 1 TO B PERFORM PARLAT GO AL
    WHEN TUS = 67 AND A NOT = 1
         SUBTRACT 1 FROM A PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT
         MOVE 18 TO B PERFORM PARLAT GO AL
    WHEN TUS = 68 AND A NOT = SON-SAYFA
         ADD 1 TO A PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT
         MOVE 1 TO B PERFORM PARLAT GO AL
    WHEN TUS = 500 AND A NOT = 1
         MOVE 1 TO A PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT
         MOVE 1 TO B PERFORM PARLAT GO AL
    WHEN TUS = 501 AND A NOT = SON-SAYFA
         MOVE SON-SAYFA TO A PERFORM SAYFA-YENILE THRU SAYFA-YENILE-EXIT
         MOVE 1 TO B PERFORM PARLAT GO AL
    WHEN TUS = 13 AND DIZI-1(A,B) NOT = SPACES 
                  PERFORM SIFRE-KONTROL-TEXT THRU SIFRE-KONTROL-TEXT-EXIT
                  IF SIFRE-BASARI   = 0
                  CLOSE WINDOW PENCERE-1
                  MOVE DIZI-1(A,B) TO ISYERI-NO-TASI
                  MOVE DIZI-3(A,B) TO ISYERI-ADRES-TASI
                  go text-sirket-sec-exit
                  END-IF
    WHEN OTHER GO AL.
    GO AL.
SAYFA-YENILE.
    MOVE ZERO TO B.
SAYFA-YENILE-01.
    ADD 1 TO B.
    IF B > 18 GO SAYFA-YENILE-EXIT.
    PERFORM PARLATMA.
    GO SAYFA-YENILE-01.
SAYFA-YENILE-EXIT.
    EXIT.
PARLAT.
    MOVE DIZI-1(A,B) TO DETAY-01.
    MOVE DIZI-2(A,B) TO DETAY-02.
    MOVE DIZI-3(A,B) TO DETAY-03.
    DISPLAY DETAY LINE B COL 01 COLOR 80 REVERSE.
PARLATMA.
    MOVE DIZI-1(A,B) TO DETAY-01.
    MOVE DIZI-2(A,B) TO DETAY-02.
    MOVE DIZI-3(A,B) TO DETAY-03.
    DISPLAY DETAY LINE B COL 01 COLOR 80.

BIRIM-ARA-EXIT.
    EXIT.

ZIL.
    DISPLAY OMITTED BEEP.

SIFRE-KONTROL-TEXT. 
    IF DIZI-SIFRE(A,B) NOT = SPACES 
       CONTINUE
    ELSE 
       MOVE 0 TO SIFRE-BASARI
       GO SIFRE-KONTROL-TEXT-EXIT
    END-IF.   
SIFRE-KONTROL-TEXT-01. 
    MOVE 1 TO SIFRE-BASARI.   
    DISPLAY WINDOW BOXED,ERASE,NO WRAP,NO SCROLL, 
    LINE 20 COL 48 SIZE 30 LINES 1 COLOR 80, 
    POP-UP AREA IS SIFRE-PEN. 
SIFRE-KONTROL-TEXT-02. 
    DISPLAY "Isyeri Sifresi: [          ]" LINE 01 COL 02 COLOR 80. 
SIFRE-KONTROL-TEXT-03. 
    INITIALIZE TUS SIRKET-SIFRE. 
    ACCEPT SIRKET-SIFRE AUTO SECURE PROMPT "*" UPPER CONVERT 
           LINE 01 COL 19 COLOR 48 ON EXCEPTION TUS CONTINUE. 
    IF TUS = 27 CLOSE WINDOW SIFRE-PEN MOVE 1 TO SIFRE-BASARI 
                GO SIFRE-KONTROL-TEXT-EXIT. 
    IF SIRKET-SIFRE NOT = DIZI-SIFRE(A,B) GO SIFRE-KONTROL-TEXT-03. 
    MOVE 0 TO SIFRE-BASARI.   
SIFRE-KONTROL-TEXT-04. 
SIFRE-KONTROL-TEXT-05. 
    CLOSE WINDOW SIFRE-PEN. 
SIFRE-KONTROL-TEXT-EXIT. 
    EXIT. 
text-sirket-sec-exit.
     exit.

*
 sablon-al.
      

       open i-o konuk rez romhrk exthrk onkasa
       open input depkod 
       initialize yuzde form6-aciklama   ilk-tarih-s son-tarih-s
         move isyeri-adres to hedef-sirket
         move isyeri-adres-tasi to sablon-sirket
         move onkpara-city-ledger to room-depart extr-depart
         move ONKPARA-GUEST-REFUND to grrm-depart  grex-depart         
            
         perform acu-form5-routine
         close konuk rez romhrk exthrk onkasa
         close depkod 
      .

*
 Form5-Ex-Other.
          initialize depkod-cagir
        evaluate  key-status 
           when  1
              evaluate control-id
                 when 7

                     move "A" to depkod-cagri-tipi
                    
                    call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                         on exception perform callerr-proc
                       not on exception
                           cancel "/asya/ytl/obj/otel/depara.asy" 
                    end-call
                         if depkod-dep-kodu not = 0 then 
                          move depkod-dep-kodu to room-depart
                           display lab1
                          end-if
                 when 8
                       move "A" to depkod-cagri-tipi
                    
                    call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                         on exception perform callerr-proc
                       not on exception
                           cancel "/asya/ytl/obj/otel/depara.asy" 
                    end-call
                         if depkod-dep-kodu not = 0 then   
                        move depkod-dep-kodu to extr-depart
                        display lab2
                        end-if
                 when 13
                      move "B" to depkod-cagri-tipi
                   
                    call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                         on exception perform callerr-proc
                       not on exception
                           cancel "/asya/ytl/obj/otel/depara.asy" 
                    end-call
                        if depkod-dep-kodu not = 0 then 
                          move depkod-dep-kodu to grrm-depart
                          end-if
                        display lab3
                 when 14
                     move "B" to depkod-cagri-tipi
                   
                    call "/asya/ytl/obj/otel/depara.asy" using depkod-cagir
                         on exception perform callerr-proc
                       not on exception
                           cancel "/asya/ytl/obj/otel/depara.asy" 
                    end-call
                     if depkod-dep-kodu not = 0 then 
                          move depkod-dep-kodu to grex-depart
                        display lab4
                    end-if
              
              end-evaluate
           when  2  
            initialize gecer 
              perform room-after
              perform extr-after
              perform gref-after
              perform cash-after
              if gecer = 0 then
               perform acu-form6-routine
               set exit-pushed to true
              end-if
        end-evaluate     .

 konuk-kapat.
        initialize konuk-rec
        move "I" to konuk-durumu
        start konuk key not < konuk-gel
          invalid continue
          not invalid 
          perform until fs-konuk = "10" 
            read konuk next     no lock
               end move "10" to fs-konuk
               not end
                 
                 if konuk-durumu not = "I" then

                      move "10" to fs-konuk
                   else
                        if ilk-tarih-s = 0 then 
                   add 1 to yuzde
                   
                   perform bar-ekle
                   move konuk-gel-tar  to ilk-tarih-s
                   move tarih-tasi     to son-tarih-s
                   if ilk-tarih-s < son-tarih-s - 7
                       compute ilk-tarih-s = son-tarih-s  - 7
                   end-if
                   compute eski-yuzde = yuzde
                   compute yuzde-oran rounded = ( 93 - yuzde )
                                         / ( son-tarih-s - ilk-tarih-s ) 

                   else
                     move konuk-gel-tar to bu-tarih-s
                     if bu-tarih-s > ilk-tarih-s  then 
                       
                      compute yuzde rounded = eski-yuzde + 
                            ( (bu-tarih-s - ilk-tarih-s) * yuzde-oran) 
                       perform bar-ekle
                      end-if
                 end-if
                        

                       
                       perform balans-isle
                end-if
            end-read
          end-perform
        end-start.
        move "romhrk" to copya-dosya   copya2-dosya
             move 94 to yuzde
             
             move copya-dosya to form6-aciklama(1:8)
             
             move " dosyasi kopyalaniyor.........." to form6-aciklama(9:)
             display l1
             perform bar-ekle
            if operating-system = "Unix"
                  call "c$system" using kopyala-unix giving sonuc
               else  
                  call "c$system" using kopyala-dos, 64 giving sonuc
            end-if,

            if sonuc not = zeroes then 
              display message box kopyala-unix new-line 
              "Kopyalama islemi basarilamadi---"  copya-dosya new-line 
              sonuc "   " operating-system
            end-if
             
             move "exthrk" to copya-dosya   copya2-dosya
             move 98 to yuzde
             
             move copya-dosya to form6-aciklama(1:8)
             
             move " dosyasi kopyalaniyor.........." to form6-aciklama(9:)
             display l1
             perform bar-ekle
            if operating-system = "Unix"
                  call "c$system" using kopyala-unix giving sonuc
               else  
                  call "c$system" using kopyala-dos, 64 giving sonuc
            end-if,

            if sonuc not = zeroes then 
              display message box kopyala-unix new-line 
              "Kopyalama islemi basarilamadi---"  copya-dosya new-line 
              sonuc "   " operating-system
            end-if
             
            move "genelfis" to copya-dosya   copya2-dosya
             move 94 to yuzde
             
             move copya-dosya to form6-aciklama(1:8)
             
             move " dosyasi kopyalaniyor.........." to form6-aciklama(9:)
             display l1
             perform bar-ekle
            if operating-system = "Unix"
                  call "c$system" using kopyala-unix giving sonuc
               else  
                  call "c$system" using kopyala-dos, 64 giving sonuc
            end-if,
              if sonuc not = zeroes then 
              display message box kopyala-unix new-line 
              "Kopyalama islemi basarilamadi---"  copya-dosya new-line 
              sonuc "   " operating-system
            end-if


        move 100 to yuzde 
        perform bar-ekle.
        display message box "Devir Islemleri tamamlandi." new-line 
                             "Yeni Sirkete ilk giriste bazi bakim" new-line 
                             "programlari otomatik  olarak calisacaktir.".
        set exit-pushed to true.
                 
      
 balans-isle.
     initialize tutar-degiskenler
     perform balans-bul.
     initialize form6-aciklama
       move konuk-adi to form6-aciklama(1:10)
        move konuk-soyadi to form6-aciklama(12:10)
             
            
             display l1
     if bakiye < 0 then 
        if konuk-fol-kodu = "R"
           if g-e = 0 then 
             initialize bakiye
           end-if
           
          else
           if c-e = 0 then 
             initialize bakiye
           end-if
           
         end-if
      else
         if konuk-fol-kodu = "R"
           if r-e = 0 then 
             initialize bakiye
           end-if
           
         else
           if e-e = 0 then 
             initialize bakiye
           end-if
           
         end-if
    end-if
     
     if bakiye not = 0 then   
      initialize hrkgir-rec
      perform fisno-bul   thru fisno-bul-exit
    accept sis-zaman from time
    move sis-zaman   to hrkgir-zaman
    move k-kodu-tasi to hrkgir-staf

    move konuk-folio    to hrkgir-folio
    move "Y"            to hrkgir-islem-tipi
    move calisma-tarihi to hrkgir-tarih
    if bakiye < 0 then 
        if konuk-fol-kodu = "R"
           move grrm-depart to depkod-kodu
          else
           move grex-depart to depkod-kodu
         end-if
      else
         if konuk-fol-kodu = "R"
           move room-depart to depkod-kodu
         else
           move extr-depart to depkod-kodu
         end-if
    end-if
    read depkod no lock 
      invalid display message box "hata:341234"
    end-read
    move depkod-kodu    to hrkgir-depkod
    move depkod-ba      to hrkgir-ba
    move cout-tutar to   tl-z
    move tl-z  to form6-aciklama(27:)
        move depkod-adi to form6-aciklama(37:)
            display l1
    accept omitted before time 5
    move cout-tutar     to hrkgir-tl-tutar
    compute hrkgir-dv-tutar  = cout-tutar / islem-kuru
    move 999999         to hrkgir-cekno
    move hrkgir-rec  to romhrk-rec exthrk-rec
         if konuk-fol-kodu = "R" 
            
            write romhrk-rec invalid display message box "sajkfl"
         else  
             write exthrk-rec invalid display message box "sdsffl"
         end-if

        perform onkasa-artir   thru onkasa-artir-exit
        perform konuk-artir    thru konuk-artir-exit
    end-if .
 
*
 balans-bul.     
      
               if konuk-fol-kodu = "R" 
                  perform romhrk-bul thru romhrk-bul-exit
               else
                  perform exthrk-bul thru exthrk-bul-exit
               end-if
               initialize bakiye-tipi
               move hrk-borc-tl   to konuk-top-borc
               move hrk-alac-tl   to konuk-top-alac
               rewrite konuk-rec invalid continue
               end-rewrite

               if hrk-borc-tl > hrk-alac-tl 
                  move "B" to bakiye-tipi
               end-if
               if hrk-alac-tl > hrk-borc-tl 
                  move "A" to bakiye-tipi
               end-if
               compute bakiye  = konuk-top-borc - konuk-top-alac
               move hrk-bakiye-tl   to cout-tutar
                                                   .
 
       
       
*
 onkasa-artir.
       move hrkgir-tarih    to onkasa-tarih.
       move hrkgir-depkod   to onkasa-dep.
       read onkasa no lock invalid 
            go onkasa-yeni-isle
            not invalid continue 
       end-read.
       compute onkasa-tutar-tl   = onkasa-tutar-tl + hrkgir-tl-tutar.
       compute onkasa-tutar-dv   = onkasa-tutar-dv + hrkgir-dv-tutar.
       rewrite onkasa-rec invalid 
               write onkasa-rec invalid continue
               end-write 
       end-rewrite.
       go onkasa-artir-exit.
 onkasa-yeni-isle.
            initialize onkasa-rec.
       move hrkgir-tarih    to onkasa-tarih.
       move hrkgir-depkod   to onkasa-dep.
       move hrkgir-tl-tutar to onkasa-tutar-tl.
       move hrkgir-dv-tutar to onkasa-tutar-dv.
       write onkasa-rec invalid 
             rewrite onkasa-rec invalid continue
             end-rewrite
       end-write.
 onkasa-artir-exit.
       exit.
*
 konuk-artir.
           move hrkgir-folio   to konuk-folio.
*           read konuk no lock invalid 
*                go konuk-artir-exit
*                not invalid continue
*           end-read.
           if hrkgir-ba = "B"
              compute konuk-top-borc = konuk-top-borc + hrkgir-tl-tutar.
           if hrkgir-ba = "A"
              compute konuk-top-alac = konuk-top-alac + hrkgir-tl-tutar.
          rewrite konuk-rec invalid continue
          end-rewrite.
 konuk-artir-exit.
      exit.
 fisno-bul.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid
         initialize genelfis-rec 
         move 1 to genelfis-anahtar.
    add 1 to cekgir-oto.
    move cekgir-oto to hrkgir-islem.
    rewrite genelfis-rec invalid 
            write genelfis-rec invalid continue
            end-write
    end-rewrite.
    close genelfis.
 fisno-bul-exit.
      exit.
     
      
 romhrk-bul.
       initialize romhrk-rec.
       move konuk-folio   to romhrk-folio.
       move spaces        to romhrk-islem.
      start romhrk key not < romhrk-anah invalid 
            go romhrk-bul-bitti.
 romhrk-bul-oku.
      read romhrk next no lock end go romhrk-bul-bitti.
      if fs-romhrk = 99 go romhrk-bul-oku.
      if romhrk-folio > konuk-folio go romhrk-bul-bitti.
      if romhrk-folio = konuk-folio 
         continue
      else 
         go romhrk-bul-oku
      end-if.
        if romhrk-ba = "B"
           compute hrk-borc-tl = hrk-borc-tl + romhrk-tl-tutar
           compute hrk-borc-dv = hrk-borc-dv + romhrk-dv-tutar
        end-if.
        if romhrk-ba = "A"
           compute hrk-alac-tl = hrk-alac-tl + romhrk-tl-tutar
           compute hrk-alac-dv = hrk-alac-dv + romhrk-dv-tutar
        end-if.
       go romhrk-bul-oku.

 romhrk-bul-bitti.
        if hrk-borc-tl > hrk-alac-tl
           compute hrk-bakiye-tl = hrk-borc-tl - hrk-alac-tl
        end-if.
        if hrk-borc-tl < hrk-alac-tl
           compute hrk-bakiye-tl = hrk-alac-tl - hrk-borc-tl
        end-if.

        if hrk-borc-dv > hrk-alac-dv
           compute hrk-bakiye-dv = hrk-borc-dv - hrk-alac-dv
        end-if.
        if hrk-borc-dv < hrk-alac-dv
           compute hrk-bakiye-dv = hrk-alac-dv - hrk-borc-dv
        end-if.
 romhrk-bul-exit.
     exit.
 exthrk-bul.
       initialize exthrk-rec.
       move konuk-folio   to exthrk-folio.
       move spaces        to exthrk-islem.
      start exthrk key not < exthrk-anah invalid 
            go exthrk-bul-bitti.
 exthrk-bul-oku.
      read exthrk next no lock end go exthrk-bul-bitti.
      if fs-exthrk = 99 go exthrk-bul-oku.
      if exthrk-folio > konuk-folio go exthrk-bul-bitti.
      if exthrk-folio = konuk-folio 
         continue
      else 
         go exthrk-bul-oku
      end-if.
        if exthrk-ba = "B"
           compute hrk-borc-tl = hrk-borc-tl + exthrk-tl-tutar
           compute hrk-borc-dv = hrk-borc-dv + exthrk-dv-tutar
        end-if.
        if exthrk-ba = "A"
           compute hrk-alac-tl = hrk-alac-tl + exthrk-tl-tutar
           compute hrk-alac-dv = hrk-alac-dv + exthrk-dv-tutar
        end-if.
       go exthrk-bul-oku.
 exthrk-bul-bitti.
        if hrk-borc-tl > hrk-alac-tl
           compute hrk-bakiye-tl = hrk-borc-tl - hrk-alac-tl
        end-if.
        if hrk-borc-tl < hrk-alac-tl
           compute hrk-bakiye-tl = hrk-alac-tl - hrk-borc-tl
        end-if.

        if hrk-borc-dv > hrk-alac-dv
           compute hrk-bakiye-dv = hrk-borc-dv - hrk-alac-dv
        end-if.
        if hrk-borc-dv < hrk-alac-dv
           compute hrk-bakiye-dv = hrk-alac-dv - hrk-borc-dv
        end-if.
 exthrk-bul-exit.
     exit.

        
 bar-ekle.
     move yuzde to EYUZDE.
     modify Form1-Fr-2b, FILL-PERCENT = YUZDE,
            TITLE = YUZDELE-BASLIK.
     .
*
 Form6-Aft-Initdata.
      accept system-information   from system-info
        accept terminal-abilities   from terminal-info
        move sablon-sirket            to copya2-adres copya-adres 
        move hedef-sirket           to paste2-adres paste-adres  genel-dosya-adres

        perform varying k from 1 by 1 until k > 62 or dosyalar(k) = spaces
             if fiyat-atma = 1 and dosyalar(k)(1:8) = "fiyatana" then
               exit perform cycle
              end-if
              move dosyalar(k) to copya-dosya   copya2-dosya
             add 1 to yuzde
             
             move copya-dosya to form6-aciklama(1:8)
             
             move " dosyasi kopyalaniyor.........." to form6-aciklama(9:)
             display l1
             perform bar-ekle
            if operating-system = "Unix"
                  call "c$system" using kopyala-unix giving sonuc
               else  
                  call "c$system" using kopyala-dos, 64 giving sonuc
            end-if,
*           display message box kopyala-unix
            if sonuc not = zeroes then 
              display message box kopyala-unix new-line 
              "Kopyalama islemi basarilamadi---"  copya-dosya new-line 
              sonuc "   " operating-system
            end-if
             
        end-perform
            open i-o genel
            move "Y" to genel-yilbasi
            rewrite genel-rec invalid display message box "hata kdfjkls"
            end-rewrite
            move isyeri-adres-tasi to genel-dosya-adres
            
           perform konuk-kapat

     .
*
 genel-ac.    
      open input genel
      move 1 to genel-anahtar
      read genel no lock invalid continue
         not invalid continue
      end-read
    close genel.
    perform kur-bul thru kur-bul-exit.
*
 kur-bul.
    open input kur
    initialize islem-kuru
    move calisma-tarihi  to kur-tarih
    move onkpara-banka   to kur-banka
    move onkpara-doviz   to kur-doviz
    read kur no lock invalid 
         close kur 
         display message box 
         "Gunluk Kur Kaydi Bulunamadi  Islem Yapilamaz.."
          new-line,
         "Onburo Calisma Tarihi..:" calis-gun   "/" calis-ay   "/" calis-yil   
          new-line,
         "Banka-Doviz Kodu.......:" onkpara-banka   "-" onkpara-doviz
         title = " [ Kurlar Tanimsiz ] "
         goback
    end-read
    move doviz-alis to islem-kuru
    if onkpara-d-e = "D" and onkpara-a-s = "A" 
       move doviz-alis    to islem-kuru
    end-if 
    if onkpara-d-e = "D" and onkpara-a-s = "S" 
       move doviz-satis   to islem-kuru
    end-if 
    if onkpara-d-e = "E" and onkpara-a-s = "A" 
       move efektif-alis  to islem-kuru
    end-if 
    if onkpara-d-e = "E" and onkpara-a-s = "S" 
       move efektif-satis to islem-kuru
    end-if 

    if islem-kuru = 0 
       close kur
       display message box 
       "Kur Tutari [0] Olamaz, Islem Yapamazsiniz.."
        new-line,
       "Onburo Calisma Tarihi..:" calis-gun   "/" calis-ay   "/" calis-yil   
        new-line,
       "Banka-Doviz Kodu.......:" onkpara-banka   "-" onkpara-doviz
       title = " [ Kurlar Tanimsiz ] "
       goback
    end-if.
    close      kur.
 kur-bul-exit.
    exit.
*
 form5-after.
       initialize gecer
       evaluate control-id
          when 7
              perform room-after
          when 8
              perform extr-after
          when 13
              perform gref-after
          when 14
              perform cash-after

       end-evaluate
         if gecer = 1 then 
            move 4 to accept-control
         end-if
     .
*
 room-after.
          if r-e = 1 then 
          move room-depart to depkod-kodu
          read depkod no lock 
             invalid
               move 1 to gecer
                   display message box "Tanimsiz Departman Girdiniz"
               not invalid
                 if depkod-ba = "B" then
                     move 1 to gecer
                     display message box "Lutfen Alacak Departmani Giriniz"
                     move 7 to control-id
                 end-if   
          end-read
          move depkod-adi to room-adi
                 display la1
           end-if
           .

 extr-after.
           if e-e = 1  then
          move extr-depart to depkod-kodu
          read depkod no lock 
             invalid
               move 1 to gecer
                   display message box "Tanimsiz Departman Girdiniz"
               not invalid
                 if depkod-ba = "B" then
                     move 1 to gecer
                     display message box "Lutfen Alacak Departmani Giriniz"
                     move 8 to control-id
                 end-if   
          end-read
          move depkod-adi to extra-adi
                 display la2
            end-if
           .
 gref-after.
            if g-e = 1  then
          move grrm-depart to depkod-kodu
          read depkod no lock 
             invalid
               move 1 to gecer
                   display message box "Tanimsiz Departman Girdiniz"
               not invalid
                 if depkod-ba = "A" then
                     move 1 to gecer
                     display message box "Lutfen Borc Departmani Giriniz"
                     move 13 to control-id
                 end-if   
          end-read
          move depkod-adi to gref-adi
                 display la3
            end-if
           .
 cash-after.
          if c-e = 1  then
          move grex-depart to depkod-kodu
          read depkod no lock 
             invalid
               move 1 to gecer
                   display message box "Tanimsiz Departman Girdiniz"
               not invalid
                 if depkod-ba = "A" then
                     move 1 to gecer
                     display message box "Lutfen Alacak Departmani Giriniz"
                     move 14 to control-id
                 end-if   
                 move depkod-adi to cash-adi
                 display la4

          end-read
          end-if
          
           .
*
 Form5-Aft-Initdata.
              perform room-after
              perform extr-after
              perform gref-after
              perform cash-after
         
     .
*
 dev-ex.
       display lab1 lab2 lab3 lab4
     .
*
 Form3-Aft-Routine.
     move 4    to accept-control
     move 18   to control-id 
     .
*    
 grid-1-Ev-Msg-Heading-Dblclick.
     exit paragraph.|tek yetki verilemiyor.kontrol edildikten sonra yüklensin R.AÞKIN
     inquire   grid-1, last-row in  km-son
    perform varying km from 2 by 1 until km > km-son
          inquire grid-1(km),
                     
                     hidden-data in char
             if char = "E"
                move "H" to char
                move no-bmp  to bmp-handle
                perform bmp-set2
             else
                move "E" to char
                move yes-bmp  to bmp-handle
                perform bmp-set2
             end-if
             modify grid-1,
                    y = km
                    x = 1
                    hidden-data = char

     end-perform 
     .


 bmp-set2.
     if bmp-handle = yes-bmp
        modify grid-1, 
            y = km
            x = 1
            bitmap           = bmp-handle
            bitmap-number    = 1
            bitmap-trailing  = 1
            bitmap-width     = 16
            hidden-data = "E"
     else
        modify grid-1, 
            y = km
            x = 1
            hidden-data = "H"
            bitmap           = bmp-handle
            bitmap-number    = 1
            bitmap-trailing  = 1
            bitmap-width     = 16
     end-if.

 
