* odalar.evt
* odalar.evt is generated from D:\asya\acugt.ytl\otel\odalar.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 Form1-Lb-1-Exception-Proc.
* 
     IF Event-Occurred
        EVALUATE Event-Type
        WHEN Cmd-Dblclick
           PERFORM listbox-eventlar
        WHEN Cmd-Goto
           PERFORM Listbox-Eventlar
        WHEN Ntf-Selchange
           PERFORM Listbox-Eventlar
        END-EVALUATE
     END-IF
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform adresleri-tasi.
      open i-o odalar2 close odalar2
      open i-o genel
      move 1 to genel-anahtar
      read genel no lock invalid continue
         not invalid
         move calis-yil        to yil-tasi
         move calis-ay         to ay-tasi
         move calis-gun        to gun-tasi
         move genel-log        to log-sistemi-devrede
         move genel-log-seviye to log-sistem-seviyesi
      end-read
      close genel.
      if k-kodu-tasi = "X   " or "ASYA"
          move 1 to asyami
      end-if
     open input kllnc
       move k-kodu-tasi to K-KODU
       read kllnc no lock invalid
               continue
       end-read
     close kllnc

     .
*
 accept-0101-Bef-Procedure.
     if oto-islem = "1"
        exit paragraph.
        
     initialize odalar-rec
     move ilk-durum    to combo-0101-value
     move ilk-konum    to combo-0102-value
     move ilk-kat      to combo-0103-value
     display accept-0102,accept-0102a,combo-0101,combo-0102,combo-0103,cb-0101, cb-0101  cb-0101b cb-0101ba cb-0101ba accs2 acc-1301.
     modify button-0101,enabled = false
     modify button-0102,enabled = false
     perform bef-procedure.
     .
*
 accept-0101-Aft-Procedure.
     if oto-islem = "1" 
        exit paragraph.
*     if odalar-anah = spaces 
*        modify button-0101,enabled = false
*        modify button-0102,enabled = false
*     else 
        modify button-0101,enabled = true
        modify button-0102,enabled = true
*     end-if.
     open input odalar.
     open i-o odalar2
     read odalar no lock invalid
          initialize odalar-rec
          inquire accept-0101, value in odalar-anah
          initialize cb-0101-value 
     not invalid
          move odalar-durumu     to combo-0101-value
          move odalar-konumu     to combo-0102-value
          move odalar-kat        to combo-0103-value
          if odalar-hayali = "H"
             move 1 to cb-0101-value
             else
             move 0 to cb-0101-value
          end-if
     end-read
     if genel-uzun-oda-no-kullanilsin = 1
        initialize odalar2-rec 
        move odalar-no to odalar2-no
        read odalar2 key is odalar2-anah1 invalid
             continue
        not invalid
            move odalar2-uzun-no to odalar-uzun-no
        end-read 
     end-if
     perform Pazar-Adi-Goster
     perform Odatipi-Goster
     perform Odatipi2-Goster
     perform Odatipi3-Goster

     display accept-0102,accept-0102a,combo-0101,combo-0102,acc-1301 acc-1302
             combo-0103,cb-0101 cb-0101b cb-0101ba acc-pazar lb-pazar  acc-referans
              cb-0101a cb-1301
             acc-odatip lb-odatip
             acc-odatipa lb-odatipa
             acc-odatipaa lb-odatipaa accs2 .
     close odalar odalar2.
     perform listbox-yer-bul.
     if i > zeroes
        modify form1-lb-1,
               selection-index = i
     end-if
     move odalar-odatemiz to tmp-odatemiz
     .
*
 exception-procedure.
     evaluate key-status
         when 8 
              perform Form1-Pb-1a-Link
         when 16
            open i-o odalar
            initialize odalar-rec
            start odalar key not < odalar-anah invalid 
                 continue 
            not invalid 
            perform with test after until fs-odalar = "10"
            read odalar next no lock end move "10" to fs-odalar
            not at end 
                   if odalar-no(1:1) = "1"
                      move 1      to odalar-referans 
                   end-if 
                   if odalar-no(1:1) = "2"
                      move 1      to odalar-referans 
                   end-if 
                   if odalar-no(1:1) = "3"
                      move 2      to odalar-referans 
                   end-if 
                   if odalar-no(1:1) = "4"
                      move 2      to odalar-referans 
                   end-if 
                    rewrite odalar-rec end-rewrite 
            end-read 
            end-perform
            end-start
            close odalar 
            display message box "Referans Dagitildi."
         when 17 
             move odalar-dosya         to link-logview-dosya-adi
             set link-logview-pointer  to address of odalar-rec
             set link-logview-rec-size to size of odalar-rec
             perform logview-call
             initialize key-status
         when 1
           evaluate control-id
             when 1021
             when 1022 perform pazar-ara
             when 33
             when 34   perform odatipi-ara
             when 37   perform odatipi2-ara
             when 41   perform odatipi3-ara
           end-evaluate
         when 2
              if oto-islem = "1"
                 initialize oto-degiskenler
                 modify label-0101, title = "Oda Numarasi : "
                 modify accept-0103,visible = false
                 modify button-0101,title = "&Kaydet",
                 modify button-0102,visible = true
                 modify button-0103,visible = true
                 modify button-0104,title = "&Oto.Tanimla"
                 move space to oto-islem
                 move 4 to accept-control
                 move 4 to control-id
                 exit paragraph
              end-if
              if combo-0101-value = spaces 
                 move 4 to accept-control
                 move 8 to control-id
                 display omitted beep
                 exit paragraph
              end-if
              if combo-0102-value = spaces 
                 move 4 to accept-control
                 move 10 to control-id
                 display omitted beep
                 exit paragraph
              end-if
              if combo-0103-value = spaces
                 move 4 to accept-control
                 move 14 to control-id
                 display omitted beep
                 exit paragraph
              end-if

              open i-o odalar odalar2
              if cb-0101-value = 1
                 move "H" to odalar-hayali
              else
                 move "G" to odalar-hayali
              end-if
              move combo-0101-value(1:2) to odalar-durumu house-durumu
              move combo-0102-value(1:2) to odalar-konumu
              move combo-0103-value(1:2) to odalar-kat
              initialize i
              move k-kodu-tasi to odalar-staf
              if odalar-anah not = spaces
                 write odalar-rec invalid continue
                       rewrite odalar-rec 
                       end-rewrite
                 end-write
                     perform log-operation-odalar
                 if odalar-uzun-no <> spaces 
                    move odalar-no       to odalar2-no
                    move odalar-uzun-no  to odalar2-uzun-no
                    write odalar2-rec invalid
                          rewrite odalar2-rec end-rewrite 
                    end-write 
                 end-if
              end-if
              close odalar odalar2

              if tmp-odatemiz = "K" and 
                 odalar-odatemiz = spaces
                 perform odatemiz-kapat
              end-if
              perform listbox-yer-bul
              if i > zeroes
                   initialize form1-lb-1-value
                   modify form1-lb-1,
                          item-to-delete(i)
                   move odalar-anah     to lb-1-col-1
                   move odalar-durumu   to lb-1-col-2
                   move odalar-konumu   to lb-1-col-3
                   move odalar-kapasite to lb-1-col-4
                   move odalar-kat      to lb-1-col-5
                   move odalar-hayali   to lb-1-col-6
                   modify form1-lb-1,
                          item-to-add(form1-lb-1-value)
              else
                 initialize form1-lb-1-value
                 move odalar-anah     to lb-1-col-1
                 move odalar-durumu   to lb-1-col-2
                 move odalar-konumu   to lb-1-col-3
                 move odalar-kapasite to lb-1-col-4
                 move odalar-kat      to lb-1-col-5
                 move odalar-hayali   to lb-1-col-6
                 modify form1-lb-1,
                        item-to-add(form1-lb-1-value)
              end-if
              move 4 to accept-control
              move 5 to control-id
              exit paragraph
         when 3
              perform listbox-yer-bul
              if i > zeroes
                 modify form1-lb-1,
                        item-to-delete(i)
              end-if
              open i-o odalar
              delete odalar invalid continue 
              end-delete
                  perform log-operation-odalar
              close odalar
              move 4 to accept-control
              move 5 to control-id
        when 4
              open input  kodlar02 konum
              open i-o odalar
              initialize odalar-rec
              start odalar key not < odalar-anah invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close odalar kodlar02 konum
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no 
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi takas-no
     open output takas close takas open i-o takas with mass-update 
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Tanimli Odalar Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Tanimli Odalar Raporu"   to det-filler
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RLLLLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
     move "  Oda"        to det-1
     move "Dr."          to det-2
     move "Durumu"       to det-3
     move "K"            to det-4
     move "Konum"        to det-5
     move "K."           to det-6
     move "K"            to det-7
     move "Kat"          to det-8
     move "H"            to det-9
     move "2"           to det-10
     move "Kat"        to det-11
     move "pre"      to det-12
     move "Ref"      to det-13
     MOVE "TIP1" TO DET-14
     MOVE "TIP2" TO DET-15
     MOVE "TIP3" TO DET-16
     move "O.uzun" to det-17

     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-8 fil-9 fil-10 fil-11 fil-12 fil-13 fil-14 fil-15 fil-16  fil-17
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6
                 det-7 det-8 det-9 det-10 det-11 det-12   det-13  det-14 det-15 det-16 det-17
     write dokumer-rec from detay
*********************************
*       if k-kodu-tasi = "X" then 
*             close odalar open i-o odalar
*             initialize odalar-rec
*              start odalar key not < odalar-anah1 invalid
*                    continue
*              end-start
*            perform with test after until fs-odalar = "10"
*                    read odalar next no lock end move "10" to fs-odalar
*                    not at end
*                      if odalar-anah(4:1) = spaces then
*                        delete odalar invalid stop " " end-delete
*                        compute yeni-oda = 1000 + function numval(odalar-anah)
*                        move yeni-oda to odalar-anah
*                        write odalar-rec invalid stop " " end-write
*                     end-if
*                    end-read
*             end-perform
*        end-if
              initialize fs-odalar
              perform with test after until fs-odalar = "10"
                    read odalar next no lock end move "10" to fs-odalar
                    not at end
                        if odalar-aktif-pasif = 1
                            exit perform cycle 
                        end-if 
                         initialize dokumer-rec detay takas-rec
                         move odalar-konumu   to takas-anah
                         read takas no lock invalid 
                              initialize takas-rec 
                              move odalar-konumu    to takas-anah
                              move 1                to takas-odakonumu-adet
                              if odalar-hayali = "H"
                                 move 1 to takas-hayali-1-adet                                 
                              end-if
                              if odalar-hayal2 = 1
                                 move 1 to takas-hayali-2-adet                                 
                              end-if
                              write takas-rec invalid stop " " end-write 
                         not invalid
                             add 1 to takas-odakonumu-adet
                              if odalar-hayali = "H"
                                 add 1 to takas-hayali-1-adet                                 
                              end-if
                              if odalar-hayal2 = 1
                                 add 1 to takas-hayali-2-adet                                 
                              end-if

                             rewrite takas-rec end-rewrite 
                         end-read
                         
                         move odalar-anah     to det-1
                         move odalar-durumu   to kodlar02-kodu det-2
                         move "C"             to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all "*" to kodlar02-adi
                         end-read
                         move kodlar02-adi    to det-3
                         move odalar-konumu   to konum-anahtar det-4
                         read konum no lock invalid
                              move all "*" to konum-adi
                         end-read
                         move konum-adi       to det-5
                         move odalar-kapasite to det-6
                         move odalar-kat      to kodlar02-kodu det-7
                         move "F"             to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all "*" to kodlar02-kodu
                         end-read
                         move kodlar02-adi    to det-8
                         move odalar-hayali   to det-9
                         if odalar-hayal2 = 1 then 
                           move "X" to det-10
                         end-if
                         move odalar-tipi   to kodlar02-kodu 
                         move "G"             to kodlar02-tipi
                         read kodlar02 no lock invalid
                              move all " " to kodlar02-adi
                         end-read
                         move kodlar02-adi    to det-11
                        move   odalar-referans to det-13
                         move odalar-devre    to det-12

         
                            initialize kodlar02-rec
                            move "G" to kodlar02-tipi
                            move ODALAR-TIPI to kodlar02-kodu
                            read kodlar02 no lock
                              invalid
                                initialize kodlar02-rec
                            end-read
                            move kodlar02-adi to det-14

                            initialize kodlar02-rec
                            move "H" to kodlar02-tipi
                            move ODALAR-TIPI2 to kodlar02-kodu
                            read kodlar02 no lock
                              invalid
                                initialize kodlar02-rec
                            end-read
                            move kodlar02-adi to det-15


                            initialize kodlar02-rec
                            move "I" to kodlar02-tipi
                            move ODALAR-TIPI3 to kodlar02-kodu
                            read kodlar02 no lock
                              invalid
                                initialize kodlar02-rec
                            end-read
                            move kodlar02-adi to det-16
           
               
                          move odalar-uzun-no to det-17
                         
                         write dokumer-rec from detay
                         if genel-uzun-oda-no-kullanilsin not = 1 
                            if odalar-uzun-no not = spaces
                              initialize odalar-uzun-no
                              write odalar-rec invalid rewrite odalar-rec end-write
                            end-if
                        end-if
                    end-read
              end-perform
                   perform icmal-goster
                initialize dokumer-rec detay
                move "-"            to det-dokumer-20(5:1)
                move all "-" to det-1 det-2 det-3 det-4 det-5 det-6  det-17
                                det-7 det-8 det-9 det-10 det-11 det-12 det-13  det-14 det-15 det-16
                write dokumer-rec from detay
              close dokumer takas
              call dokumer-prog on exception
                   perform callerr-proc
              not on exception
                   cancel dokumer-prog
              end-call
              close odalar konum kodlar02
              delete file dokumer takas
         when 125
         stop " "
         exit paragraph
             open i-o odalar
             initialize odalar-rec 
             move 8000 to odalar-anah
             start odalar key >= odalar-anah
                invalid continue
                not invalid 
                  perform until fs-odalar = "10" 
                    read odalar next no lock end move "10" to fs-odalar
                      not end 
                       if odalar-anah >= "9000"
                           exit perform
                       end-if 
                       move 1    to odalar-dis
                       move  "G" to odalar-hayali
                       rewrite odalar-rec invalid continue
                       end-rewrite
                    end-read
                 end-perform 
             end-start
             close odalar
         when 5
              if oto-islem = space
                 initialize oto-degiskenler
                 move spaces to combo-0101-value combo-0102-value  combo-0103-value cb-0101-value odalar-kapasite odalar-anah oto-bit-oda
                 display      accept-0101,accept-0102,acc-1301,accept-0102a,accept-0103,combo-0101,combo-0102,combo-0103,cb-0101  cb-0101a cb-0101b cb-0101ba
                 move "1"   to oto-islem
                 modify button-0101,visible = true
                                    title = "&Vazgec"
                                    enabled = 1
                 modify button-0102,visible = false
                 modify button-0103,visible = false
                 modify button-0104,visible = true
                                    title = "&Basla"
                 modify accept-0103,enabled = 1
                                    visible = 1
                 modify label-0101,title = "Baslangic/Bitis Oda :"
                 move 4 to accept-control
                 move 4 to control-id
                 exit paragraph
              else

                 
                move function numval(odalar-anah) to oto-bas-oda                   
                if oto-bas-oda > 9
                          move 4 to x-bas     
                end-if
                      
                if oto-bas-oda > 099
                           move 3 to x-bas      
                end-if
          
                if oto-bas-oda > 999
                         move 2 to x-bas            
                end-if 
                if (oto-bas-oda(x-bas:) not < oto-bit-oda(x-bas:)) OR
                    oto-bit-oda = zeroes
                    move 4 to accept-control
                    move 4 to control-id
                    display omitted beep
                    exit paragraph
                 end-if
                 if combo-0101-value = spaces
                    move 4 to accept-control
                    move 8 to control-id
                    display omitted beep
                    exit paragraph
                 end-if
                 if combo-0102-value = spaces
                    move 4 to accept-control
                    move 10 to control-id
                    display omitted beep
                    exit paragraph
                 end-if
                 if combo-0103-value = spaces 
                    move 4 to accept-control
                    move 14 to control-id
                    display omitted beep
                    exit paragraph
                 end-if
                 initialize sayac
                 move odalar-kapasite     to oto-kapasite
                 open i-o odalar  
                 perform varying sayac from oto-bas-oda by 1 until sayac > oto-bit-oda
                         
                         initialize xodalar-tipi xodalar-tipi2 xodalar-tipi3 xodalar-dis
                         if odalar-tipi not = spaces
                            move odalar-tipi         to xodalar-tipi
                         end-if 
                         if odalar-tipi2 not = spaces
                            move odalar-tipi2        to xodalar-tipi2
                         end-if 
                         if odalar-tipi3 not = spaces
                            move odalar-tipi3        to xodalar-tipi3
                         end-if 
                         move odalar-dis             to xodalar-dis
                         initialize odalar-rec    
                         if sayac > 9
                                  move sayac(4:)              to odalar-anah
                         end-if

                         if sayac > 99
                                  move sayac(3:)              to odalar-anah
                         end-if
          
                         if sayac > 999
                                  move sayac(2:)              to odalar-anah
                         end-if

                         read odalar no lock invalid
                              move combo-0101-value(1:1)  to odalar-durumu
                              move combo-0102-value(1:2)  to odalar-konumu
                              move combo-0103-value       to odalar-kat
                              if cb-0101-value = 1 
                                 move "H"                 to odalar-hayali
                              else
                                 move "G"                 to odalar-hayali
                              end-if
                              move oto-kapasite           to odalar-kapasite
                              move xodalar-dis            to odalar-dis
                              if xodalar-tipi not = spaces
                                 move xodalar-tipi           to odalar-tipi
                              end-if
                              if xodalar-tipi2 not = spaces
                                 move xodalar-tipi2           to odalar-tipi2
                              end-if
                              if xodalar-tipi3 not = spaces
                                 move xodalar-tipi3           to odalar-tipi3
                              end-if
                              write odalar-rec invalid continue 
                              end-write
                                  perform log-operation-odalar
                              initialize form1-lb-1-value
                              move odalar-anah     to lb-1-col-1
                              move odalar-durumu   to lb-1-col-2
                              move odalar-konumu   to lb-1-col-3
                              move odalar-kapasite to lb-1-col-4
                              move odalar-kat      to lb-1-col-5
                              move odalar-hayali   to lb-1-col-6
                              modify form1-lb-1,
                                    item-to-add(form1-lb-1-value)
                              initialize i
                              perform listbox-yer-bul
                              if i > zeroes
                                 modify form1-lb-1,
                                        selection-index = i
                              end-if
*                         not invalid 
*                              move 1       to odalar-dis
*                              rewrite odalar-rec end-rewrite 
*                              perform log-operation-odalar
                         end-read
                 end-perform
                 close odalar
                 initialize oto-degiskenler
                 modify label-0101, title = "Oda Numarasi : "
                 modify accept-0103,visible = false
                 modify button-0101,title = "&Kaydet",
                 modify button-0102,visible = true
                 modify button-0103,visible = true
                 modify button-0104,title = "&Oto.Tanimla"
                 move space to oto-islem
                 move 4 to accept-control
                 move 4 to control-id
                 exit paragraph
              end-if

     end-evaluate.
*
 bef-procedure.
     initialize mesaj.
     evaluate control-id
          when 5
              evaluate true
                  when turkce
                       move "Oda numarasini giriniz          " to mesaj
                  when ingilizce
                       move "Oda numarasini giriniz          " to mesaj
                  when almanca
                       move "Oda numarasini giriniz          " to mesaj
              end-evaluate
          when 8
              evaluate true
                  when turkce
                       move "Oda housekeeping kodunu seciniz" to mesaj
                  when ingilizce
                       move "Oda housekeeping kodunu seciniz" to mesaj
                  when almanca
                       move "Oda housekeeping kodunu seciniz" to mesaj
              end-evaluate
          when 10
              evaluate true
                  when turkce
                       move "Oda konumunu seciniz             " to mesaj
                  when ingilizce
                       move "Oda konumunu seciniz             " to mesaj
                  when almanca
                       move "Oda konumunu seciniz             " to mesaj
              end-evaluate
          when 12
              evaluate true
                  when turkce
                       move "Oda kapasitesini giriniz          " to mesaj
                  when ingilizce
                       move "Oda kapasitesini giriniz          " to mesaj
                  when almanca
                       move "Oda kapasitesini giriniz          " to mesaj
              end-evaluate
          when 14
              evaluate true
                  when turkce
                       move "Kat kodunu seciniz               " to mesaj
                  when ingilizce
                       move "Kat kodunu seciniz               " to mesaj
                  when almanca
                       move "Kat kodunu seciniz               " to mesaj
              end-evaluate
          when 16
              evaluate true
                  when turkce
                       move "Hayali oda icin tiklayiniz       " to mesaj
                  when ingilizce
                       move "Hayali oda icin tiklayiniz       " to mesaj
                  when almanca
                       move "Hayali oda icin tiklayiniz       " to mesaj
              end-evaluate
          when 19
              if oto-islem = space
              evaluate true
                  when turkce
                       move "Oda numarasini kaydetmek icin tiklayiniz" to mesaj
                  when ingilizce
                       move "Oda numarasini kaydetmek icin tiklayiniz" to mesaj
                  when almanca
                       move "Oda numarasini kaydetmek icin tiklayiniz" to mesaj
              end-evaluate
              else
              evaluate true
                  when turkce
                       move "Otomatik oda olusturma isleminde vazgecmek icin tiklayiniz" to mesaj
                  when ingilizce
                       move "Otomatik oda olusturma isleminde vazgecmek icin tiklayiniz" to mesaj
                  when almanca
                       move "Otomatik oda olusturma isleminde vazgecmek icin tiklayiniz" to mesaj
              end-evaluate
              end-if
          when 20
              evaluate true
                  when turkce
                       move "Oda numarasini silmek icin tiklayiniz " to mesaj
                  when ingilizce
                       move "Oda numarasini silmek icin tiklayiniz " to mesaj
                  when almanca
                       move "Oda numarasini silmek icin tiklayiniz " to mesaj
              end-evaluate
          when 21
              evaluate true
                  when turkce
                       move "Rapor almak icin tiklayiniz      " to mesaj
                  when ingilizce
                       move "Rapor almak icin tiklayiniz      " to mesaj
                  when almanca
                       move "Rapor almak icin tiklayiniz      " to mesaj
              end-evaluate
          when 18
              evaluate true
                  when turkce
                       move "Ayni ozellikte odalari otomatik yaratmak icin tiklayiniz" to mesaj
                  when ingilizce
                       move "Ayni ozellikte odalari otomatik yaratmak icin tiklayiniz" to mesaj
                  when almanca
                       move "Ayni ozellikte odalari otomatik yaratmak icin tiklayiniz" to mesaj
              end-evaluate

     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj.
*
 Form1-Aft-Initdata.
     open i-o odalar2 close odalar2
     initialize ilkler.
     modify form1-lb-1,
            reset-list  = 1
            mass-update = 1
     open input odalar
     initialize odalar-rec
     start odalar key not < odalar-anah invalid
           continue
     not invalid
     move zeroes to fs-odalar
     initialize i
     perform with test after until fs-odalar = "10"
          read odalar next no lock end move "10" to fs-odalar
          not at end
               initialize form1-lb-1-value
               add 1 to i
               if i = 1 
                  move odalar-anah  to ilk-oda
               end-if
               move odalar-anah     to lb-1-col-1
               move odalar-durumu   to lb-1-col-2
               move odalar-konumu   to lb-1-col-3
               move odalar-kapasite to lb-1-col-4
               move odalar-kat      to lb-1-col-5
               move odalar-hayali   to lb-1-col-6
               modify form1-lb-1,
                      item-to-add(form1-lb-1-value)
          end-read
     end-perform
     end-start
     close odalar
     initialize odalar-rec
     modify form1-lb-1,
            mass-update = 0
            selection-index = 1
            thumb-position = 1.

     modify combo-0101,
            reset-list  = 1
            mass-update = 1   
     modify combo-0102,
            reset-list  = 1
            mass-update = 1   
     modify combo-0103,
            reset-list  = 1
            mass-update = 1   

     open input kodlar02
     initialize kodlar02-rec i ii
     move "C"   to kodlar02-tipi
     start kodlar02 key not < kodlar02-anah invalid
           continue
     not invalid
     initialize fs-kodlar02
     perform  with test after until fs-kodlar02 = "10"
           read kodlar02 next no lock end move "10" to fs-kodlar02
           not at end
                evaluate kodlar02-tipi
                     when "C"
                          add 1 to i
                          if i = 1 
                             move kodlar02-kodu to ilk-durum
                          end-if
                          move kodlar02-kodu    to combo-0101-value
                          move "-"              to combo-0101-value(3:)
                          move kodlar02-adi     to combo-0101-value(4:)
                          modify combo-0101,
                                 item-to-add(combo-0101-value)
                     when "F"
                          add 1 to ii
                          if ii = 1 
                             move kodlar02-kodu to ilk-kat
                          end-if
                          move kodlar02-kodu    to combo-0103-value
                          move "-"              to combo-0103-value(3:)
                          move kodlar02-adi     to combo-0103-value(4:)
                          modify combo-0103,
                                 item-to-add(combo-0103-value)
                end-evaluate
           end-read
     end-perform
     end-start
     close kodlar02.

     open input konum
     initialize konum-rec i
     start konum key not < konum-anahtar invalid
           continue
     not invalid
     initialize fs-konum
     perform with test after until fs-konum = "10"
           read konum next no lock end move "10" to fs-konum
           not at end
                add 1 to i
                if i = 1 
                   move konum-anahtar to ilk-konum
                end-if
                move konum-anahtar  to combo-0102-value(1:2)
                move "-"            to combo-0102-value(3:1)
                move konum-adi      to combo-0102-value(4:)
                modify combo-0102,
                       item-to-add(combo-0102-value)
           end-read
     end-perform
     end-start.
     close konum


     modify combo-0101,
            mass-update = 0
     modify combo-0102,
            mass-update = 0
     modify combo-0103,
            mass-update = 0
     if k-durum-degistiremez = 1
        modify combo-0101, enabled = false
     end-if
     if genel-uzun-oda-no-kullanilsin = 1
        modify acc-1301, visible = true
        modify La-1301,  visible = true
     end-if
     .
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 listbox-eventlar.
     evaluate event-type
          when cmd-dblclick
               inquire form1-lb-1,value in odalar-anah
               perform accept-0101-Aft-Procedure
               move 4 to accept-control
               move 8 to control-id
               exit paragraph
          when ntf-selchange
          when cmd-goto
               inquire form1-lb-1,value in odalar-anah
               display accept-0101,
               perform accept-0101-Aft-Procedure
     end-evaluate.
     
     .
 listbox-yer-bul.
     if k-kodu-tasi = "ASYA" then exit paragraph end-if
     initialize durum tekrar
     perform varying i from 1 by 1 until (durum = "E" or "H")
             initialize eodalar-anah
             modify form1-lb-1,
                    query-index = i
             inquire form1-lb-1,
                    item-value in eodalar-anah
             if eodalar-anah <> spaces
                if eodalar-anah = tekrar

                   move "E" to durum
                   exit perform
                else
                   move eodalar-anah to tekrar
                end-if
             end-if
             if eodalar-anah = spaces
                move "H" to durum
                initialize i 
                exit perform
             else
                if eodalar-anah = odalar-anah
                   move "E" to durum
                   exit perform
                end-if
             end-if
    end-perform.
*
 pazar-ara.
    initialize pazar-cagir.
    move "E"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/pazarara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/pazarara.asy" 
    end-call
    move pazar-kodu-cagir     to odalar-pazar
    perform pazar-adi-goster
    .
*
 odatipi-ara.
    initialize pazar-cagir.
    move "G"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara.asy" 
    end-call
    move pazar-kodu-cagir     to odalar-tipi
    perform odatipi-goster
    .
*
 odatipi2-ara.
    initialize pazar-cagir.
    move "H"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara2.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara2.asy" 
    end-call
    move pazar-kodu-cagir     to odalar-tipi2
    perform odatipi2-goster
    .
*
 odatipi3-ara.
    initialize pazar-cagir.
    move "I"   to pazar-tipi-cagir.
    call "/asya/ytl/obj/otel/odatara3.asy"
      using pazar-cagir
      on exception
         perform callerr-proc
      not on exception
         cancel "/asya/ytl/obj/otel/odatara3.asy" 
    end-call
    move pazar-kodu-cagir     to odalar-tipi3
    perform odatipi3-goster
    .
*
 pazar-adi-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "E" to kodlar02-tipi
    move odalar-pazar to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to adi-goster
    display acc-pazar lb-pazar
    close kodlar02
    .
*
 odatipi-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "G" to kodlar02-tipi
    move odalar-tipi to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi-goster
    display acc-odatip lb-odatip
    close kodlar02
    .
*
 odatipi2-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "H" to kodlar02-tipi
    move odalar-tipi2 to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi2-goster
    display acc-odatipa lb-odatipa
    close kodlar02
    .
*
 odatipi3-goster.
    open input kodlar02
    initialize kodlar02-rec
    move "I" to kodlar02-tipi
    move odalar-tipi3 to kodlar02-kodu
    read kodlar02 no lock
      invalid
        initialize kodlar02-rec
    end-read
    move kodlar02-adi to tipi3-goster
    display acc-odatipaa lb-odatipaa
    close kodlar02
    .
*
 icmal-goster.
    initialize dokumer-rec detay
    move "Konum"      to det-3
    move "T.Oda"      to det-5
    move "Hayali-1"   to det-8

    move "Hayali-2"   to det-11
    move "G.Oda"      to det-12
    move "A"          to det-dokumer-20(3:1)
    move 480          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    write dokumer-rec from detay
    initialize takas-rec alt-toplam alt-h1-toplam alt-h2-toplam fark alt-fark
    start takas key not < takas-anah invalid
          continue
    not invalid 
    perform with test after until fs-takas = "10"
    read takas next no lock end move "10"  to fs-takas
    not  at end
            initialize dokumer-rec detay konum-rec
            move takas-konumu     to konum-anahtar det-2
            read konum no lock invalid
                 move "Tanimsiz Oda Konumu.."  to konum-adi
            end-read
                 move konum-adi             to det-3

                 move takas-odakonumu-adet  to z-oda
                 move z-oda                 to det-5
                 compute fark = takas-odakonumu-adet - takas-hayali-1-adet

                 move fark                  to z-oda
                 move z-oda                 to det-12

                 add  takas-odakonumu-adet  to alt-toplam
                 add fark                   to alt-fark

                 move takas-hayali-1-adet   to z-oda 
                 move z-oda                 to det-8
                 add  takas-hayali-1-adet to alt-h1-toplam

                 move takas-hayali-2-adet   to z-oda
                 move z-oda                 to det-11
                 add  takas-hayali-2-adet to alt-h2-toplam

                 write dokumer-rec from detay
    end-read
    end-perform 
    end-start
    initialize dokumer-rec detay
    move "Total"        to det-1
    move alt-toplam    to z-oda
    move z-oda         to det-5
    move alt-h1-toplam    to z-oda
    move z-oda         to det-8
    move alt-h2-toplam    to z-oda
    move z-oda         to det-11
    move alt-fark    to z-oda
    move z-oda         to det-12

    move "A"           to det-dokumer-20(3:1)
    move 176           to det-renk1
    move "1"           to det-dokumer-20(10:1)
    write dokumer-rec from detay

    .
*
 accs2-Ex-Other.
        stop " "
        open i-o odalar
          start odalar key > odalar-anah invalid continue
            not invalid 
            perform until fs-odalar = "10"
                 read odalar next no lock  
                    end move "10" to fs-odalar
                     not end 
                     if odalar-hayali not = "H" 
                         evaluate   odalar-anah(4:1) 
                            when "0" 
                            when "1" 
                            when "2"
                            when "3"
                              move "A" to odalar-devre
                              rewrite odalar-rec invalid stop " "
                              end-rewrite
                            when "5" 
                            when "6"
                               move " " to odalar-devre
                            when other 
                              move "B" to odalar-devre
                              rewrite odalar-rec invalid stop " "
                              end-rewrite
                         end-evaluate
                     end-if
                   end-read
            end-perform

         end-start


        close odalar

     .
*
 Form1-Pb-1a-Link.

     if k-kodu-tasi <> "ASYA"                           | Uzun oda numarasý olan odalarý temizler... 29/07/2020 Fýrat 
        exit paragraph
     else 
        stop " " 
     end-if   
     open i-o odalar 
     initialize odalar-rec 
     start odalar key not < odalar-anah invalid
           continue
     not invalid
     perform with test after until fs-odalar = "10"
     read odalar next no lock end move "10" to fs-odalar
     not at end 
         if odalar-uzun-no not = spaces 
            initialize odalar-uzun-no
            rewrite odalar-rec end-rewrite 
         end-if
     end-read 
     end-perform 
     end-start             
     close odalar 

     exit paragraph

     if k-kodu-tasi <> "ASYA"                           | Uzun numarasý olmayan odalara oda nosunu yazar.. 29/07/2020 Fýrat 
        exit paragraph
     else 
        stop " " 
     end-if   
     open i-o odalar odalar2
     initialize odalar-rec 
     start odalar key not < odalar-anah invalid
           continue
     not invalid
     perform with test after until fs-odalar = "10"
     read odalar next no lock end move "10" to fs-odalar
     not at end 
         if odalar-uzun-no = spaces 
            move odalar-no to odalar-uzun-no
            rewrite odalar-rec end-rewrite 
            initialize odalar2-rec 
            move odalar-uzun-no to odalar2-uzun-no
            read odalar2 no lock invalid
                 continue
            end-read 
            move odalar-no to odalar2-no
            write odalar2-rec invalid
                  rewrite odalar2-rec end-rewrite 
            end-write 
         end-if
     end-read 
     end-perform 
     end-start             
     close odalar odalar2

     exit paragraph

     if k-kodu-tasi <> "ASYA"        | Aciklamadan yedigimiz odalar-odatemiz kismini temizler.. 29/07/2020 Fýrat 
        exit paragraph
     else 
        stop " " 
     end-if   
     open i-o odalar 
     initialize odalar-anah
     start odalar key not < odalar-anah invalid
           continue
     not invalid
     perform with test after until fs-odalar = "10"
     read odalar next no lock end move "10" to fs-odalar
     not at end

          initialize odalar-odatemiz
          rewrite odalar-rec invalid
                  stop " "
          end-rewrite

     end-read 
     end-perform 
     end-start 
     close odalar

     exit paragraph
     
     if k-kodu-tasi <> "ASYA" 
        exit paragraph
     else 
        stop " " 
     end-if   
     open i-o odalar odalar2
     initialize odalar-rec
     start odalar key not < odalar-anah invalid
           continue
     not invalid
     perform with test after until fs-odalar = "10"
     read odalar next no lock end move "10" to fs-odalar
     not at end
         initialize odalar2-rec
         move odalar-anah to odalar2-no

         if odalar-uzun-no <> spaces
            move odalar-uzun-no to odalar2-anah
         else 
            move odalar-anah to odalar2-anah
         end-if
         
         read odalar2 no lock invalid
              continue
         end-read
         
         write odalar2-rec invalid
               rewrite odalar2-rec end-rewrite
         end-write

*         if odalar-aktif-pasif = 1
*            move 0 to odalar-aktif-pasif
*            rewrite odalar-rec end-rewrite 
*         end-if 

     end-read
     end-perform 
     end-start
     close odalar odalar2

     .
*
 Form1-Pb-1aa-Link.
      exit paragraph
              open input odalar2 
              initialize odalar2-rec
              start odalar2 key not < odalar2-anah invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close odalar2 
                    exit paragraph
              end-start

              open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no 
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi 
*/WINDOW TITLE
     initialize dokumer-rec detay-uzun
     move "W"                  to det-dokumer-u20(1:)
     move "Tanimli Uzun Odalar Raporu"   to det-filler-uzun
     write dokumer-rec from detay-uzun
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-u20(10:1)
     move "B"            to det-dokumer-u20(1:1)
     move "Tanimli Uzun Odalar Raporu"   to det-filler-uzun
     write dokumer-rec from detay-uzun


     initialize dokumer-rec detay-uzun
     move "B"                  to det-dokumer-u20(1:1)
     write dokumer-rec from detay-uzun


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay-uzun
     move "O" to det-dokumer-u20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RLLLLLLLLLLLLLLLLLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler-uzun
     write dokumer-rec from detay-uzun
*/ BASLIKLAR  

     initialize dokumer-rec detay-uzun 
     move "1"          to det-dokumer-u20(10:1)
     move "D1"         to det-dokumer-u20(1:2)
     move "Oda U."       to det-u1
     move "Oda U."       to det-u2
     move "|" to fil-u1 fil-u2 
     write dokumer-rec from detay-uzun

     initialize dokumer-rec detay-uzun
     move "D2"           to det-dokumer-u20(1:2)
     move "-"            to det-dokumer-u20(5:1)
     move all "-" to det-u1 det-u2 
     write dokumer-rec from detay-uzun
     initialize fs-odalar2
     perform with test after until fs-odalar2 = "10"
     read odalar2 next no lock end move "10" to fs-odalar2
     not at end
         initialize dokumer-rec detay-uzun 
         move odalar2-anah   to det-u1
         move odalar2-no     to det-u2
       write dokumer-rec from detay-uzun 
        end-read
       end-perform
     initialize dokumer-rec detay-uzun
       move "-"            to det-dokumer-u20(5:1)
       move all "-" to det-u1 det-u2 
       write dokumer-rec from detay-uzun
     close dokumer 
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     close odalar2 
     delete file dokumer 
     .
*
 odatemiz-kapat.
      open i-o odatemiz 
      initialize odatemiz-rec 
      move "K"         to odatemiz-tip
      move odalar-anah to odatemiz-oda
      start odatemiz key > odatemiz-anah1 invalid
            continue
      not invalid
      perform with test after until fs-odatemiz = "10" 
      read odatemiz backward no lock end move "10" to fs-odatemiz
      not at end 
          if odatemiz-oda <> odalar-anah
             exit perform 
          end-if
          if odatemiz-tip <> "K"
             exit perform 
          end-if

          if odatemiz-ger-tem-tar = 0
             accept odatemiz-ger-tem-tar from century-date
             accept odatemiz-ger-tem-zaman from time
             rewrite odatemiz-rec invalid
                     stop " "
             end-rewrite
          end-if

      end-read 
      end-perform 
      end-start 
      close odatemiz
     .

 
