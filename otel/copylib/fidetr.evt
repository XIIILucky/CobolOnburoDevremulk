* fidetr.evt
* fidetr.evt is generated from F:\asya\acugt.kaya\otel\fidetr.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM exception-procedure
     .
***   start event editor code   ***
*
 Form1-Bef-Create. 
      set environment "extra-keys-ok" to 1.
*       set enviroment "Flush-count" to 2048    
       perform adresleri-tasi .

  
      
*
 before-procedure. 
    
             .

 Form1-Aft-Initdata. 
    
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid
          initialize mesaj-link
          move 03 to mesaj-no
          perform mesaj-ver
    not invalid
        continue
    end-read
    close genel.

*      
 exception-procedure. 
     evaluate key-status
          when 2 
               open output trnot
         
                      perform islem-yap 

               close trnot
               display  message box "Islem Bitti"  
            
     
          
         end-evaluate. 

         
           

*
 islem-yap. 
        if tanim-value  = 1 then 
           open i-o kodlar02 ulke 
              if tanim-eskisini-sil = 1 then 
                 perform pazar-sil
                 PERFORM ULKE-SIL
                 open output doviz odalar acenta depkod close doviz odalar acenta depkod
                 open output konum close konum
               end-if 
              open i-o  doviz konum odalar  acenta depkod
             perform pazar-al
             PERFORM ULKE-AL
             perform doviz-al
             perform konum-al
             perform oda-al
             perform acenta-al
             perform depkod-al
             
************   perform pans-al
             close kodlar02   ulke  doviz  konum  odalar  acenta
        end-if
        if rez-value  = 1 then 
           
              if rez-eskisini-sil = 1 then 
                
                 open output rez frate close rez frate
                 open output frez close frez
               end-if 
              open input fkonum facenta fulke fpazar fdoviz fodalar
              open i-o  rez frez  frate

                 perform rez-al
             
             
************   perform pans-al
             close rez  frez        
              close fkonum facenta fulke fpazar fdoviz fodalar frate
        end-if
        
        
        
        if cin-value = 1 then 
            open output konuk romhrk exthrk   ozluk ozluk2
            close       konuk romhrk exthrk   ozluk ozluk2

            open i-o rez konuk   frez exthrk ozluk yanrez
             perform cin-yap
              perform  cash-ac
            close rez konuk  exthrk     frez ozluk yanrez
        end-if
         if hrk-value = 1 then 
            open output  romhrk exthrk froomlar 
            close        romhrk exthrk froomlar 

            open i-o rez konuk romhrk exthrk froomlar   frez   fdepkod
              perform hrk-al
            
            close rez konuk romhrk exthrk  froomlar  frez   fdepkod
        end-if
         if kur-value = 1 then 
            open output  kur
            close        kur

            open i-o kur fdoviz takvim
              perform kur-al
            
            close kur  fdoviz takvim
        end-if
        if yan-value = 1 then 
            open output  yanrez  polisxml
            close        yanrez  polisxml

            open i-o rez konuk polisxml yanrez frez   OZLUK ULKE
              perform yan-al
            
            close  rez konuk polisxml yanrez frez OZLUK ULKE
        end-if
        if fih-value = 1 then 
            open output  fihrist
            close        fihrist

            open i-o fihrist
              perform fih-al2
            
            close  fihrist
        end-if

           .
fih-al2.
    
      move "fihrist2.txt" to fidetext-adi
      initialize uasya-sira
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
           initialize fidetext-rec
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                       if  function numval (fidetext-rec(32:4)) > 1000 and 
                            < 2000
                            then

                            initialize fihrist-alan fihrist-alan2
                       move  fidetext-rec(63:30)    to fihrist-alan
                        move  fidetext-rec(94:30)    to fihrist-alan2
                       initialize ilk-sayisal-yer baslangic-yer ilk-sayisal-yer2 baslangic-yer2
                       perform varying i from 30 by -1 until i <= 0
                          if fihrist-alan(i:1) = "0" or "1" or "2" or
                                                 "3" or "4" or "5" or
                                                 "6" or "7" or "8" or "9"
                            move i to ilk-sayisal-yer
                          end-if
                          if fihrist-alan(i:1) not =  "0" and not ="1" and not ="2" and
                                                 not ="3" and not ="4" and not ="5" and
                                                 not ="6" and not ="7" and not ="8" and not ="9" and
                                                 not =" " and not ="-" and not ="/"
                            
                             move i to baslangic-yer
                             exit perform 

                          end-if
                       end-perform 
                       perform varying i from 30 by -1 until i <= 0
                          if fihrist-alan2(i:1) = "0" or "1" or "2" or
                                                 "3" or "4" or "5" or
                                                 "6" or "7" or "8" or "9"
                            move i to ilk-sayisal-yer2
                          end-if
                          if fihrist-alan2(i:1) not =  "0" and not = "1" and not =  "2" and 
                                                not =  "3" and not = "4" and not =  "5" and
                                                not =  "6" and not = "7" and not =  "8" and not = "9" and
                                                not =  " " and not = "-" and not =  "/"
                            
                             move i to baslangic-yer2
                             exit perform 

                          end-if
                       end-perform 

                       if ilk-sayisal-yer > 0 or ilk-sayisal-yer2 > 0 then 

                        
                        initialize fihrist-rec
                        move uasya-sira to FIHRIST-NO  
                         add 1 to uasya-sira
                        move fihrist-alan(1:baslangic-yer) to  fihrist-adi
                        if ilk-sayisal-yer > 0 then 
                             move fihrist-alan(ilk-sayisal-yer:) to  fihrist-telefon
                        end-if
                        initialize i
                        inspect fihrist-alan2 TALLYING i FOR ALL "FAX" 
                        if ilk-sayisal-yer2 > 0 
                         if i = 1 then  
                             move fihrist-alan2(ilk-sayisal-yer2:) to fihrist-fax
                           else 
                             move    fihrist-alan2(ilk-sayisal-yer2:) to   FIHRIST-MOBIL-TEL
                         end-if
                         end-if
                        write fihrist-rec invalid stop " " end-write
                        end-if
                    end-if
            end-read
         end-perform 
         close fidetext.
           .
fih-al.
      move "fihrist.txt" to fidetext-adi
      initialize uasya-sira
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                  
                  evaluate true  
                     when  fidetext-rec(1:1) = "0" or = "1" 
                      or = "2" or = "3" or = "4" or = "5" or = "6" or = "7" 
                      or = "8" or = "9"
                     or  fidetext-rec(2:1) = "0" or = "1" 
                      or = "2" or = "3" or = "4" or = "5" or = "6" or = "7" 
                      or = "8" or = "9"
                       add 1 to uasya-sira
                        initialize fihrist-rec
                        move uasya-sira to FIHRIST-NO  
                        move  fidetext-rec(1:20)    to fihrist-telefon
                        move  fidetext-rec(32:20)   to       FIHRIST-adi        
                        write fihrist-rec invalid stop " " end-write
                     
                    when other
                       add 1 to uasya-sira
                        initialize fihrist-rec
                        move uasya-sira to FIHRIST-NO  
                        move  fidetext-rec(1:25)    to fihrist-adi
                        move  fidetext-rec(32:20)   to       FIHRIST-TELEFON         
                        write fihrist-rec invalid stop " " end-write
                  end-evaluate
                  
            end-read
         end-perform 
         close fidetext.


yan-al.
      move "yanrez.txt" to fidetext-adi
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                  move  fidetext-rec(1:10)    to frez-fide-kodu
                  read frez no lock invalid
                     continue 
                  not invalid
******                    if frez-fide-kodu(1:6) = "234468" then stop " " end-if
                     perform tek-xml-al 
                  end-read
            end-read
         end-perform 
         close fidetext.


tek-xml-al.
         move frez-asya-rez-kodu to rez-anah
         read rez no lock invalid continue
         not invalid
         move rez-folio to konuk-folio OZLUK-FOLIO
         read konuk no lock invalid continue
         end-read
         READ OZLUK NO LOCK INVALID CONTINUE
         END-READ
            INITIALIZE YANREZ-REC polisxml-rec
            MOVE REZ-NO TO   yanrez-rezno polisxml-rezno
            PERFORM UNTIL yanrez-sirano > 7
              ADD 1 TO yanrez-sirano
               READ YANREZ NO LOCK INVALID EXIT PERFORM
               END-READ
             END-PERFORM
             move yanrez-sirano to polisxml-sirano
 
             move fidetext-rec(32:20) to yanrez-ADI        polisxml-ADI        
             move fidetext-rec(68:20) to yanrez-SOYADI     polisxml-SOYADI     
             move rez-odano           to yanrez-ODANO      polisxml-ODANO      
             string  OZLUK-ADRES1 delimited by "   "      
                     OZLUK-ADRES2 
                     into polisxml-adr
                                           
             move rez-gir-tar         to yanrez-GEL-TAR    polisxml-GEL-TAR    
             move rez-cik-tar         to yanrez-GIT-TAR    polisxml-GIT-TAR    
             move konuk-gel-zaman     to yanrez-GEL-ZAMAN  polisxml-GEL-ZAMAN  
             move konuk-git-zaman     to yanrez-GIT-ZAMAN  polisxml-GIT-ZAMAN  
             MOVE KONUK-ULKE TO ULKE-ANAH
                      READ ULKE NO LOCK INVALID CONTINUE
                         NOT INVALID
                            MOVE ULKE-AKBS TO POLISXML-UYRUK
                      END-READ
             
              move fidetext-rec(205:20) to polisxml-babaadi   
              move fidetext-rec(236:20) to polisxml-anaadi    
              move fidetext-rec(267:30) to polisxml-dyeri     

               

              move fidetext-rec(298:30) to polisxml-nil         
              move fidetext-rec(329:30) to polisxml-nilce       
              move fidetext-rec(360:30) to polisxml-nmahalle    
              move "E" to polisxml-medeni
             move fidetext-rec(174:20) to  polisxml-kseri


              evaluate  fidetext-rec(135:1)

                      WHEN "2"     MOVE "N" TO POLISXML-KTURU
                      WHEN "1"     MOVE "P" TO POLISXML-KTURU
                      WHEN "3"     MOVE "E" TO POLISXML-KTURU
                      WHEN OTHER MOVE "D" TO POLISXML-KTURU

              end-evaluate
             if  fidetext-rec(391:1)= "2"
                move "K" to polisxml-cinsiyet   
                 else
                move "E" to polisxml-cinsiyet
             end-if
             move fidetext-rec(104:11) to polisxml-tckimlikno 
             move fidetext-rec(430:8) to  yanrez-dog-tar polisxml-dog-tar
             write yanrez-rec   invalid   rewrite yanrez-rec   end-write
             write polisxml-rec invalid   rewrite polisxml-rec end-write
         end-read

      .

kur-al.
        move "kurlar.txt" to fidetext-adi
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                    initialize fdoviz-rec
                    move  fidetext-rec(1:10)    to fdoviz-fide-kodu
                    read fdoviz no lock invalid stop " "
                    not invalid
                       move   fidetext-rec(32:8) to takvim-anah
                       start takvim key >= takvim-anah invalid continue
                         not invalid
                         
                          perform until fs-takvim = "10"
                             read takvim next 
                               end move "10" to fs-takvim
                               not end 
                                if takvim-anah > tarih-tasi then
                                  move "10" to fs-takvim
                                  else
                                   initialize kur-rec
                                     move 01 to kur-banka
                                     move takvim-anah      to kur-tarih
                                     move fdoviz-asya-kodu to kur-doviz
                                     read kur no lock invalid
                                       move function numval (fidetext-rec(80:10)) to doviz-alis
                                       if doviz-alis = 0 then move 1 to doviz-alis
                                       end-if
                                       write kur-rec invalid stop " " end-write
                                       move 02 to kur-banka
                                       move function numval (fidetext-rec(41:10)) to doviz-alis
                                       if doviz-alis = 0 then move 1 to doviz-alis
                                       end-if
                                       write kur-rec invalid stop " " end-write
                                       not invalid
                                       move "10" to fs-takvim

                                     end-read                                      
                                 end-if
                             end-read
                          end-perform
                        end-start  
                   end-read
            end-read
         end-perform.

         initialize kur-rec 
         start kur key > kur-kodu
           invalid continue 
           not invalid
            perform until fs-kur = "10" 
              read kur next 
                end move "10" to fs-kur
                not end
                   if doviz-alis = 0 then 
                     move 1 to doviz-alis
                     rewrite kur-rec invalid stop " " end-rewrite
                   end-if
              end-read
            end-perform 
         end-start
         close fidetext.
       
         initialize asya-sira
         MOVE TARIH-tasi to takvim-anah
         START TAKVIM KEY <= TAKVIM-ANAH

           invalid continue
           not invalid
             initialize asya-sira
            perform until fs-takvim = "10" or asya-sira > 98
              read takvim previous 
                end move "10" to fs-takvim
                not end
                add 1 to asya-sira
                 perform varying s-2 from 1 by 1 until s-2 > sondoviz
                       move takvim-anah to kur-tarih
                       move s-2 to kur-doviz
                       move 1 to kur-banka
                       
                       read kur no lock invalid 
                         move 1 to doviz-alis
                         write kur-rec invalid continue end-write
                         NOT INVALID 
                           if doviz-alis = 0 then 
                              move 1 to doviz-alis
                              rewrite kur-rec invalid continue end-rewrite
                           end-if
                       end-read
                       move 2 to kur-banka
                       read kur no lock invalid 
                         move 1 to doviz-alis
                         write kur-rec invalid continue end-write
                         NOT INVALID 
                           if doviz-alis = 0 then 
                              move 1 to doviz-alis
                              rewrite kur-rec invalid continue end-rewrite
                           end-if
                       end-read
                 end-perform
              end-read
            end-perform
          end-start.



*
 hrk-al.
         move "roomlar.txt" to fidetext-adi
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                    initialize froomlar-rec
                    move  fidetext-rec(32:10)    to froomlar-zwin-kodu
                    move  fidetext-rec(1:20)     to froomlar-fide-rez-kodu   
                    write froomlar-rec invalid continue end-write
                  
            end-read
         end-perform.
         close fidetext
         .
          initialize uuasya-sira
          move "tumhrk.txt" to fidetext-adi
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                add 1 to uuasya-sira
                 initialize hrkgir-rec  

                 move uuasya-sira to hrkgir-islem
                 move function numval (fidetext-rec(369:15)) to eksitut
                 move fidetext-rec(125:10) to fdepkod-fide-kodu
                 read fdepkod no lock invalid
                   stop " "
                 end-read
                 evaluate fidetext-rec(400:1) 
                     when "5" 
                         if eksitut >= 0  then
                            move "A" to hrkgir-ba 
                            move fdepkod-asya-kodu to hrkgir-depkod
                            compute hrkgir-tl-tutar rounded = eksitut
                           else 
                             move "B" to hrkgir-ba 
                             move "801"     to   hrkgir-depkod
                             move fdepkod-asya-kodu to hrkgir-corr-depkod
                             compute hrkgir-tl-tutar rounded = eksitut * (-1) 
                         end-if
                      when "1"  
                          if eksitut >= 0  then
                               move "B" to hrkgir-ba 
                               move fdepkod-asya-kodu to hrkgir-depkod
                               compute hrkgir-tl-tutar rounded = eksitut
                            else 
                               move "A" to hrkgir-ba 
                               move "802"     to   hrkgir-depkod
                               move fdepkod-asya-kodu to hrkgir-corr-depkod
                               compute hrkgir-tl-tutar rounded = eksitut * (-1) 
                          end-if
                      when other 
                           stop " "
                  end-evaluate
                    move  fidetext-rec(198:8)  to hrkgir-tarih
                    move  fidetext-rec(207:6)  to hrkgir-zaman
                    initialize frez-rec froomlar-rec
                    move   fidetext-rec(63:10)    to frez-fide-kodu 
                    move  fidetext-rec(94:10)     to frez-fide-zfac-kodu
                    read frez no lock invalid  stop " "
                    end-read
                    move  fidetext-rec(338:10)     to froomlar-zwin-kodu
                      if hrkgir-depkod = "100" then 
                        perform room-at
                        else
                           read froomlar no lock 
                              invalid      perform extr-at
                              not invalid  perform room-at 
                            end-read  
                      end-if
            end-read
         end-perform.
         close fidetext
           
         
         .

*
 extr-at.
       if frez-asya-extra-folio > 0 then 
          move frez-asya-extra-folio to hrkgir-folio
          move hrkgir-rec to exthrk-rec
          write exthrk-rec invalid stop " " end-write
          else 
             if frez-asya-room-folio > 0 then 
                move frez-asya-room-folio to hrkgir-folio
               move hrkgir-rec to romhrk-rec
                write romhrk-rec invalid stop " " end-write
              else 
          
               stop " " 
               end-if
        end-if  .
*
 room-at.       
       if frez-asya-room-folio > 0 then 
              move frez-asya-room-folio to hrkgir-folio
               move hrkgir-rec to romhrk-rec
              write romhrk-rec invalid stop " " end-write
              else 
                if frez-asya-extra-folio > 0 then 
                   move frez-asya-extra-folio to hrkgir-folio
                    move hrkgir-rec to exthrk-rec
                     write exthrk-rec invalid stop " " end-write
                      else stop " " 

                 end-if
           end-if
           
      .
*
 cin-yap.
     initialize rez-rec
     start rez key > rez-anah 
       invalid continue
       not invalid
       perform until fs-rez = "10" 
          read rez next no lock 
            end move "10" to fs-rez
            not end 
            if rez-c-in = "E" and  REZ-DURUMU = "I" then
                perform tek-cin
                PERFORM EXTRA-CIN
            end-if 
          end-read
       end-perform
      end-start

       
         .
*
 cash-ac.
          move "extfolio.txt" to fidetext-adi
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                 initialize konuk-rec frez-rec
                add 1 to fol-sira 
                initialize frez-rec
                move  fidetext-rec(1:20) to frez-fide-zfac-kodu   
                move fol-sira to frez-asya-extra-folio
                move fol-sira to konuk-folio 
                move 9000 to konuk-acenta

                 move   fidetext-rec(104:8)    to KONUK-GEL-TAR konuk-git-tar
                 if   fidetext-rec(113:8)  = spaces
                       move "31" to konuk-git-gun
                       move "12" to konuk-git-ay
                  else
                        move   fidetext-rec(113:8)    to KONUK-GIt-TAR
                 end-if
                move    fidetext-rec(32:20)    to KONUK-adi
                move    fidetext-rec(68:20)    to KONUK-soyadi
                move "9999" to konuk-odano
                move "E" to konuk-fol-kodu
                move "01" to konuk-odeme-tipi
                move CINPARA-EXT-FOL-BANKA to konuk-banka
                move  CINPARA-EXT-FOL-DOVIZ to konuk-doviz
                move  CINPARA-EXT-FOL-PAN  to konuk-pan-tipi
                
                move  CINPARA-EXT-FOL-ULKE  to konuk-ulke
                move  CINPARA-EXT-FOL-AYGUN to konuk-kur-aygun
                
                if fidetext-rec(132:8) not = spaces then
                  move fidetext-rec(132:8) to konuk-git-tar
                  move "H" to konuk-durumu
                      else 
                  move "I" to konuk-durumu
               end-if

                write konuk-rec invalid stop " " end-write
                write frez-rec invalid stop "dgfd " end-write
        
            end-read
         end-perform.
         close fidetext
         .

         .        
     
*
 tek-cin.
      move REZ-E-MAIL  to frez-anah
      read frez no lock invalid 
        stop " "
        not invalid
          initialize konuk-rec ozluk-rec
          move fol-sira to Frez-ASYA-room-folio konuk-folio ozluk-folio
          add 1 to fol-sira
          perform oda-cin
          move fol-sira to Frez-ASYA-extra-folio
          add 1 to fol-sira
          rewrite frez-rec invalid stop " " end-rewrite
      end-read .
*
 extra-cin.
        
 
          move  Frez-ASYA-extra-folio to konuk-folio ozluk-folio ozluk2-folio. 
        
    move cinpara-ext-fol-banka to banka-kodu. 
    
    move cinpara-ext-fol-doviz  to doviz-kodu. 
    
   
    
    
   
         move cinpara-ext-fol-ode  to kodlar02-kodu. 
  
          move rez-no to konuk-extra-rez-no 
           move "I"  to  konuk-durumu. 
          if frez-cout = "E" then 
              move "H"                 to konuk-durumu
           end-if
         
          move "E"  to konuk-fol-kodu. 
          move konuk-adi(1:17)           to konuk-adi(04:17). 
          move "E=>"                to konuk-adi(01:03). 
***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar  konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno konuk-bos. 
          move konuk-durumu  to  ozluk-durumu. 
          move konuk-adi           to ozluk-adi(04:17). 
          move "E=>"                to ozluk-adi(01:03). 
          write konuk-rec invalid stop " "
          end-write.
               
          
          write ozluk-rec invalid stop " "
          end-write.

*
 oda-cin.
    move rez-no              to konuk-rez-no. 
    move rez-adi             to konuk-adi. 
    move rez-soyadi          to konuk-soyadi. 
    move rez-s-d-t-g         to konuk-s-d-t-g.
    
    move rez-oda-konumu      to konuk-oda-konumu . 
    if rez-fiyat-konumu = 0 then 
       move rez-oda-konumu   to rez-fiyat-konumu
    end-if
    move rez-fiyat-konumu    to konuk-fiyat-konumu . 
    move rez-odeme-tipi      to konuk-odeme-tipi. 
    move rez-odano           to konuk-odano . 
    move rez-ulke            to konuk-ulke. 
    move rez-buyuk           to konuk-buyuk  . 
    move rez-kucuk           to konuk-kucuk . 
    move rez-free            to konuk-free  . 

    move rez-bebek           to konuk-bebek  .
    move rez-acenta          to konuk-acenta. 
    move rez-grup-no         to konuk-grup-no. 
    move rez-voucher         to konuk-voucher. 
    move rez-fiyat-konumu    to konuk-fiyat-konumu .
    move rez-nor-indirim     to konuk-nor-indirim. 
    move rez-pan-tipi        to konuk-pan-tipi. 
    move rez-tipi            to konuk-rez-tipi. 
    move rez-banka           to konuk-banka. 
    move rez-doviz           to konuk-doviz. 
    move rez-anlasma         to konuk-anlasma. 
    move rez-pazar           to konuk-pazar.
    move rez-share           to konuk-share
    move rez-eb              to konuk-eb.
    move rez-ug-ind          to konuk-ug-indirimi
    move rez-fiyat-fix       to konuk-fiyat-fix.
    move rez-kur-aygun       to konuk-kur-aygun. 
    move rez-cin-kuru        to konuk-kur-DEGERI
    move rez-bilbord-eh      to konuk-bilbord-eh
    move REZ-AKSIYON-EH      to konuk-AKSIYON-EH  
    move REZ-share           to konuk-share
    move rez-vip             to konuk-vip. 
    move rez-gir-tar         to konuk-gel-tar. 
    move rez-cik-tar         to konuk-git-tar. 
    move rez-not1            to konuk-acik-1. 
    move rez-not2            to konuk-acik-2. 
    move rez-gel-saat        to konuk-gel-saat.
    move rez-gel-dak         to konuk-gel-dakika.
    move rez-late-zaman      to konuk-late-zaman

    move rez-git-saat        to konuk-git-saat.
    move rez-git-dak         to konuk-git-dakika.

    move "I"                 to konuk-durumu. 
     if frez-cout = "E" then 
         move "H"                 to konuk-durumu
     end-if
    move "R"                 to konuk-fol-kodu. 
         initialize rez-ucreti tl-toplam dv-toplam. 
    move rez-fiyati          to rez-ucreti dv-toplam konuk-dv-degeri
                                . 
****>Ozluk Bilgileri ataniyor.....
    move rez-adres1          to ozluk-adres1.
    move rez-adres2          to ozluk-adres2.
    move rez-e-mail          to ozluk-e-mail.
    move rez-telno           to ozluk-telno.
    move konuk-folio to rez-folio
                move "E" to rez-c-in
              
    move "E" to rez-c-in
    rewrite rez-rec invalid stop " "  end-rewrite
    compute  konuk-oda-tutar  rounded = REZ-FIYATI * konuk-kur-degeri
          
      write konuk-rec  invalid stop " " end-write
      write ozluk-rec  invalid stop " " end-write

      .

*****************************************
*
 eb-anl-al.

        move "ratekod.txt" to fidetext-adi
        open input fidetext
       
       
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                   move fidetext-rec(1:10) to frate-kodu
                   move function numval ( fidetext-rec(63:2)) to   frate-anlasma
                   move function numval ( fidetext-rec(102:1))  to   frate-eb
                   write frate-rec invalid stop " "  end-write
            end-read
        end-perform .
        close fidetext.


 rez-al.
         perform eb-anl-al.
         move "rezdetay.txt" to fidetext-adi
         open input fidetext
       
         move 1000 to  uasya-sira
        
         initialize asya-sira  hata-sira
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                add 1 to uasya-sira
                initialize frez-rec rez-rec
                move uasya-sira                                 to frez-asya-rez-kodu   rez-no
                move fidetext-rec(1:20)                        to Frez-FIDE-KODU   REZ-E-MAIL 
                move function upper-case (fidetext-rec(22:30)) to Frez-adi  rez-adi 
                             
                 
                MOVE 1 TO REZ-TIPI              
               if fidetext-rec(1040:1) = "1" then 
                 move "I" to  REZ-DURUMU 
                 else
                   move "S" to  REZ-DURUMU
               end-if
             move fidetext-rec(154:10) to facenta-fide-kodu
             read facenta no lock invalid 
                move "9999" to rez-acenta
                 add 1 to hata-sira
              not invalid move facenta-asya-kodu to rez-acenta
             end-read
             move fidetext-rec(789:08)  to rez-gir-tar
             move fidetext-rec(798:08)  to rez-cik-tar
***********************tarih kontrolu yap usenme
             move  fidetext-rec(82:20)  to rez-adi
             move  fidetext-rec(118:20)  to rez-soyadi
             move "01" to rez-banka
             move fidetext-rec(719:10)         to fdoviz-fide-kodu
             read fdoviz no lock invalid 
                  move ONKPARA-DOVIZ to rez-doviz
               add 1 to hata-sira
              not invalid move fdoviz-asya-kodu to rez-doviz
             end-read
              move "01" to rez-anlasma
              move "02" to  REZ-ODEME-TIPI 
              move "AL" to  REZ-PAN-TIPI 

             move fidetext-rec(527:8) to fulke-fide-kodu
             read fulke no lock invalid 
             add 1 to hata-sira
             move "999" to rez-ulke
              not invalid move fulke-asya-kodu to rez-ulke
             end-read
             move fidetext-rec(807:10) to REZ-VOUCHER  
            move "G" to  REZ-KUR-AYGUN 

           move "K" to  REZ-K-G-B   


***          02 REZ-VIP               PIC X.
**********>Vipler alýnabilir
***********CIN kontrolu  
***          02 REZ-C-IN              PIC X.
***          02 REZ-FOLIO             PIC 9(08).

             move fidetext-rec(371:8) to fodalar-fide-kodu
             read fodalar no lock invalid add 1 to hata-sira
              not invalid move fodalar-asya-kodu to rez-odano
             end-read
           move fidetext-rec(410:8) to fkonum-fide-kodu
             read fkonum no lock invalid 
             move "01" to rez-oda-konumu
             add 1 to hata-sira
              not invalid move fkonum-asya-kodu to rez-oda-konumu
             end-read 
           move fidetext-rec(449:8) to fkonum-fide-kodu
             read fkonum no lock invalid 
                 move   rez-oda-konumu  to rez-fiyat-konumu
              not invalid move fkonum-asya-kodu to rez-fiyat-konumu
             end-read 
        
               move function numval(fidetext-rec(39:2)) to REZ-BUYUK 
               move rez-buyuk to REZ-S-D-T-G 
               if rez-buyuk > 4 then move 4 to REZ-S-D-T-G  end-if
               move function numval(fidetext-rec(193:2)) to REZ-kucuk 
               move function numval(fidetext-rec(232:2)) to REZ-bebek 
               move function numval(fidetext-rec(271:2)) to REZ-free 
               move function numval(fidetext-rec(750:10)) to REZ-CIN-KURU 
                move function numval(fidetext-rec(1164:5)) to REZ-FIYATI 
                if  REZ-FIYATI  > 0 then 
                  move "E" to rez-fiyat-fix
                  else
               move function numval(fidetext-rec(1067:5)) to REZ-FIYATI 
                    if rez-fiyati = 0
                           then
                        compute rez-fiyati rounded =      function numval(fidetext-rec(1195:5))
                     end-if
                  end-if

               move fidetext-rec(1046:08)  to rez-isl-tar
               move fidetext-rec(310:15)  to  REZ-GRUP-adi REZ-GRUP-NO 
               if rez-adi = spaces
                 move  REZ-GRUP-adi to rez-adi
                 end-if
               if rez-soyadi = spaces
                 move  REZ-GRUP-adi to rez-soyadi
                 end-if
               move fidetext-rec(566:20)  to  REZ-ADRES1
               move fidetext-rec(627:20)  to  REZ-ADRES2
               move fidetext-rec(838:20) to rez-not1
               move fidetext-rec(939:20) to rez-not2
               if fidetext-rec(1098:8) not = spaces then 
                   move "E" to REZ-C-IN 
               end-if
**********************sýlmeyi UNUTMA
**               if rez-acenta = "0607" then 
* *                   move "11" to rez-anlasma
*                    move "E" to rez-eb
*               end-if
*                 if rez-acenta = "0141" then 
*                    move "11" to rez-anlasma
*                    move "E" to rez-eb
*               end-if

*                  if     fidetext-rec(1055:1) = "1" then 
*                        move "9001" to rez-odano
*                      end-if
****             03 REZ-TELNO          PIC X(18).
************ 03 REZ-E-MAIL         PIC X(29).
         
        
             move fidetext-rec(488:8) to fpazar-fide-kodu
             read fpazar no lock invalid 
             add 1 to hata-sira  move "99" to rez-pazar
              not invalid move fpazar-asya-kodu to rez-pazar
             end-read 
              write rez-rec invalid stop " " end-write
              move fidetext-rec(1125:10) to frate-kodu
              read frate no lock  invalid 
                continue
                not invalid 
                   move frate-anlasma to rez-anlasma
                   if frate-eb = 1 then 
                    move "E" to rez-eb
                    end-if

              end-read
              if fidetext-rec(1111:8) not = spaces then 
                   move "E" to fREZ-Cout
               end-if
                write frez-rec invalid 
                  add 1 to asya-sira
                  move frez-rec to trnot-rec
                  write trnot-rec    end-write
                end-write
              move function numval(fidetext-rec(32:3)) to grez-adet 
              perform varying mi from 1 by 1 until grez-adet <= mi
                   add 1 to uasya-sira
               
                move uasya-sira            to    rez-no
                  write rez-rec invalid stop " " end-write

              end-perform 
            end-read
         end-perform 
         if asya-sira > 0 then
            display message box  asya-sira " adet rezervasyon acentasi degismis"
         end-if
         if hata-sira > 0 then
            display message box  hata-sira " adet hata var"
         end-if
         close fidetext

         . 
*******************************************
*****************************************
*
 depkod-al.
        
         move "depart.txt" to fidetext-adi
         open input fidetext
        
         open output fdepkod
      
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
             
                initialize fdepkod-rec  depkod-rec
                move  fidetext-rec(1:10) to Fdepkod-FIDE-KODU
                move function upper-case (fidetext-rec(32:25)) to Fdepkod-adi  depkod-adi 
                move function numval (fidetext-rec(63:3)) to depkod-kodu, Fdepkod-asya-KODU 
                move  fidetext-rec(71:1) to ba
                move  fidetext-rec(80:1) to pay
                 move 1 to depkod-tipi
                evaluate ba 
                  when "1" 
                    move "B" to  depkod-ba
                      move 1 to depkod-turu
                  when "5" 
                    move "A" to  depkod-ba
                    evaluate pay
                        when "1" 
                        when "0"
                        when "4"
                           move 3 to depkod-turu
                        when "2" 
                           move 4 to depkod-turu
                        when "3"
                           move 5 to depkod-turu
                         when other 
                            move 1 to depkod-turu
                    end-evaluate
                  when other 
                    stop " "
                end-evaluate

                write depkod-rec invalid stop " " end-write
                write fdepkod-rec invalid stop "dgfd " end-write
        
            end-read
         end-perform 
          move 802 to depkod-kodu
          move "A" to depkod-ba
          move 2 to depkod-turu
          move 1 to depkod-tipi
          move "CORRECTION (-)  " to depkod-adi
          write depkod-rec invalid stop " " end-write


          move 801 to depkod-kodu
          move "B" to depkod-ba
          move 2 to depkod-turu
          move 1 to depkod-tipi
          move "CORRECTION (+)  " to depkod-adi
          write depkod-rec invalid stop " " end-write

           move 808 to depkod-kodu
          move "B" to depkod-ba
          move 3 to depkod-turu
          move 1 to depkod-tipi
          move "GUEST REFUND  " to depkod-adi
          write depkod-rec invalid stop " " end-write


         close fidetext fdepkod

         .    
*****************************************   
*****************************************
*
 acenta-al.
        
         move "acenta.txt" to fidetext-adi
         open input fidetext
         initialize asya-sira
         open output facenta
      
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                add 1 to asya-sira
                initialize facenta-rec
                move  fidetext-rec(1:20) to Facenta-FIDE-KODU
                move function upper-case (fidetext-rec(22:30)) to Facenta-adi  acenta-adi 
                move asya-sira    to facenta-asya-kodu   acenta-kodu
                write acenta-rec invalid stop " " end-write
                write facenta-rec invalid stop "dgfd " end-write
        
            end-read
         end-perform 
           move 9000 to acenta-kodu
          move "OZEL ISLEMLER  " to acenta-adi
          write acenta-rec invalid stop " " end-write
          move 9999 to acenta-kodu
          move "FIDELIO DAN BOS" to acenta-adi
          write acenta-rec invalid stop " " end-write
         close fidetext facenta

         .    
*****************************************
 
 
        .
*****************************************
*
 oda-al.
         initialize oda-toplamlar
         move "yrms.txt" to fidetext-adi
         open input fidetext fkonum
          
         open output fodalar
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                initialize fodalar-rec odalar-rec
                move  fidetext-rec(1:30) to Fodalar-FIDE-KODU
                move fidetext-rec(63:4) to Fodalar-asya-kodu  odalar-anah 
                 move fidetext-rec(32:4) to fkonum-fide-kodu
                 read fkonum no lock invalid stop " " end-read
                 move fkonum-asya-kodu to odalar-konumu 
                 
                move fidetext-rec(63:4) to Fodalar-asya-kodu  odalar-anah 
                move "VR" to ODALAR-DURUMU house-durumu 
                move  function numval( fidetext-rec(289:2)) to odalar-kapasite
                add 1 to konum-odatop(fkonum-asya-kodu) konum-odatop(20) 
                add odalar-kapasite to  konum-odatop(21) 
                move  function numval(fidetext-rec(306:2)) to  s-2
                   move "G" to odalar-hayali
                 move s-2 to odalar-kat
                write fodalar-rec invalid stop " " end-write
                write odalar-rec invalid stop " " end-write
        
            end-read
         end-perform 
           move "9001" to  odalar-anah 
           move "H" to odalar-hayali
            move pm-konum to odalar-konumu 
             write odalar-rec invalid stop " " end-write
           move "9999" to  odalar-anah 
           move "H" to odalar-hayali
            move pm-konum to odalar-konumu 
             write odalar-rec invalid stop " " end-write
           perform varying s-2 from 1 by 1 until s-2 > 19
               move s-2 to konum-anahtar 
               read konum no lock invalid
                  continue
                  not invalid
                   move  konum-odatop(s-2)  to KONUM-TOP-ODA  KONUM-HAZIR-ODA
                     write konum-rec invalid rewrite konum-rec end-write 
               end-read
             
           end-perform 
           open i-o takvim 
             start takvim key > takvim-anah
              invalid continue
              not invalid
               perform until fs-takvim = "10"
                 read takvim next 
                   end  move "10" to fs-takvim
                   not end
                    perform varying s-2 from 1 by 1 until s-2 > 19
                      move konum-odatop(s-2)   to   takvim-konum-oda(s-2) 
         
                        move konum-odatop(20) to  TAKVIM-HAZIR-oda 
                        move konum-odatop(21) to  TAKVIM-HAZIR-yatak
                    
                     end-perform
                     rewrite takvim-rec end-rewrite
                end-read
                end-perform
             end-start
           close takvim
         close fidetext fodalar fkonum

         .    
*****************************************

*****************************************
*
 konum-al.
        
         move "ycat.txt" to fidetext-adi
         open input fidetext
         
         open output fkonum
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                initialize fkonum-rec
                move  fidetext-rec(1:30) to Fkonum-FIDE-KODU
                move function upper-case (fidetext-rec(32:3)) to Fkonum-adi  
                
                 move function numval( fidetext-rec(78:2)) to Fkonum-DISPLAY 
                 write fkonum-rec invalid stop " " end-write
        
            end-read
         end-perform 
         close fkonum
         open i-o fkonum.
             initialize fkonum-rec asya-sira konum-rec
             start  fkonum key > fkonum-display
               invalid continue
               not invalid
                perform until fs-fkonum = "10"
                  read fkonum next no lock 
                      end move "10" to fs-fkonum
                      not end 
                        add 1 to asya-sira
                        move asya-sira(3:2) to fkonum-asya-kodu konum-anahtar
                        move Fkonum-adi to  konum-adi 
                        move "FIDE" to konum-staf
                        write konum-rec invalid stop " " end-write
                        rewrite fkonum-rec invalid stop " " end-rewrite
                  end-read
                end-perform
             end-start
               add 1 to asya-sira
                 move asya-sira(3:2) to pm-konum konum-anahtar
                        move "EKO" to  konum-adi 
                        move "FIDE" to konum-staf
                        write konum-rec invalid stop " " end-write
               add 1 to asya-sira
                 move asya-sira(3:2) to pm-konum konum-anahtar
                        move "P.M" to  konum-adi 
                        move "FIDE" to konum-staf
                        write konum-rec invalid stop " " end-write

         close fidetext fkonum 

         .    
*****************************************
*
 doviz-al.
        
         move "ZCUR.txt" to fidetext-adi
         open input fidetext
         
         open output fdoviz
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                initialize fdoviz-rec
                move  fidetext-rec(1:30) to Fdoviz-FIDE-KODU
                move function upper-case (fidetext-rec(32:3)) to Fdoviz-adi  fdoviz-asya-kodu
                 move function numval( fidetext-rec(78:2)) to Fdoviz-DISPLAY 
                 
                  
                 write fdoviz-rec invalid stop " " end-write
        
            end-read
         end-perform 
         close fdoviz
         open i-o fdoviz.
             initialize fdoviz-rec asya-sira doviz-rec
             start  fdoviz key > fdoviz-display
               invalid continue
               not invalid
                perform until fs-fdoviz = "10"
                  read fdoviz next no lock 
                      end move "10" to fs-fdoviz
                      not end 
                        add 1 to asya-sira
                        move asya-sira(3:2) to fdoviz-asya-kodu doviz-kodu 
                        move Fdoviz-adi to D-kisa-adi d-adi-1 D-MERKEZ-BANKA-KODU
                        move "FIDE" to doviz-staf
                        write doviz-rec invalid stop " " end-write
                        rewrite fdoviz-rec invalid stop " " end-rewrite
                  end-read
                end-perform
             end-start
             move asya-sira to sondoviz
         close fidetext fdoviz 

         .    
*


*****************************************
*
 ULKE-al.
        
         move "XCOU.txt" to fidetext-adi
         open input fidetext
        
         open output fULKE
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                initialize fulke-rec
                move  fidetext-rec(1:30) to Fulke-FIDE-KODU
                move function upper-case (fidetext-rec(71:20)) to Fulke-adi

                move function numval( fidetext-rec(245:4)) to Fulke-DISPLAY  
                move  fidetext-rec(306:4) to Fulke-akbs  
                write fulke-rec invalid stop " " end-write
        
            end-read
         end-perform 
         close fulke
         open i-o fulke.
             initialize fulke-rec asya-sira ulke-rec
             start  fulke key > fulke-display
               invalid continue
               not invalid
                perform until fs-fulke = "10"
                  read fulke next no lock 
                      end move "10" to fs-fulke
                      not end 
                       
                        add 1 to asya-sira
                        move asya-sira(2:3) to fulke-asya-kodu ulke-anah
                        move Fulke-adi to ulke-adi 
                        move fulke-akbs to ULKE-akbs 
                        move "FIDE" to ulke-staf
                        write ulke-rec invalid stop " " end-write
                        rewrite fulke-rec invalid stop " " end-rewrite
                  end-read
                end-perform
             end-start
            
               move 999 to  ulke-anah
               move "FIDELIODAN BOS" to ulke-adi 
               write ulke-rec invalid stop " " end-write
         close fidetext fulke  

         .    
*
ulke-sil.
    
        initialize  ulke-rec
        start ulke key > ulke-anah 
          invalid continue
          not invalid
           perform until fs-ulke = "10"
            read ulke next no lock
              end move "10" to fs-ulke
              not end 
                
                   delete ulke invalid stop " " end-delete
                
            end-read
          end-perform
        end-start .

******************************************
*
 pazar-al.
        
         move "yras.txt" to fidetext-adi
         open input fidetext

         open output fpazar
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                initialize fpazar-rec
                move  fidetext-rec(1:30) to FPAZAR-FIDE-KODU
                move function upper-case (fidetext-rec(78:30)) to FPAZAR-adi
                move function numval( fidetext-rec(109:4)) to FPAZAR-DISPLAY  
                write fpazar-rec invalid stop " " end-write
        
            end-read
         end-perform 
         close fpazar
         open i-o fpazar.
             initialize fpazar-rec asya-sira kodlar02-rec
              move "E" to kodlar02-tipi
             start  fpazar key > fpazar-display
               invalid continue
               not invalid
                perform until fs-fpazar = "10"
                  read fpazar next no lock 
                      end move "10" to fs-fpazar
                      not end 
                        add 1 to asya-sira
                        move asya-sira(3:2) to fpazar-asya-kodu kodlar02-kodu
                        move FPAZAR-adi to kodlar02-adi 
                        write kodlar02-rec invalid stop " " end-write
                        rewrite fpazar-rec invalid stop " " end-rewrite
                  end-read
                end-perform
             end-start
              move "E" to kodlar02-tipi
               move 99 to  kodlar02-kodu
                        move "FIDELIODAN BOS" to kodlar02-adi 
                        write kodlar02-rec invalid stop " " end-write
         close fidetext fpazar  

         .    
*
pazar-sil.
    
        initialize  kodlar02-rec
        move "E" to kodlar02-tipi
        start kodlar02 key > kodlar02-anah 
          invalid continue
          not invalid
           perform until fs-kodlar02 = "10"
            read kodlar02 next no lock
              end move "10" to fs-kodlar02
              not end 
                if kodlar02-tipi not = "E"
                   move "10" to fs-kodlar02
                  else
                   delete kodlar02 invalid stop " " end-delete
                end-if
            end-read
          end-perform
        end-start .





             
*
 hata-goster.
    call "c$rerr" using extend-stat text-message 1.
    move extend-stat       to fileerr-linkage-hata-no.
    move Secondary-Error   to fileerr-linkage-secondary-hata-no.
    call "c$rerrname" using fileerr-linkage-dosya-adi.
    display message box "DOSYA : ",fileerr-linkage-dosya-adi,
    x"0a0d","errrrror :",fileerr-linkage-hata-no,x"0ad0",
    "error2 :",fileerr-linkage-secondary-hata-no.
    set exit-pushed to true
    stop " "
    .       

 
