* musteri.evt
* musteri.evt is generated from D:\asya\acugt.ytl\otel\musteri.Psf
* This is a generated file. DO NOT modify this file directly.


 Acu-Form1-Ta-1-Cmd-Tabchanged.
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        MOVE Event-Data-1 TO Form1-Ta-1-Value
        MOVE 0 TO Form1-Pg-1-Visible, Form1-Pg-2-Visible,
            Form1-Pg-3-Visible, Form1-Pg-4-Visible, Form1-Pg-5-Visible,
            Form1-Pg-6-Visible, Form1-Pg-7-Visible, Form1-Pg-8-Visible
        EVALUATE Event-Data-1
        WHEN 1
           MOVE 1 TO Form1-Pg-1-Visible
        WHEN 2
           MOVE 1 TO Form1-Pg-2-Visible
        WHEN 3
           MOVE 1 TO Form1-Pg-3-Visible
        WHEN 4
           MOVE 1 TO Form1-Pg-4-Visible
        WHEN 5
           MOVE 1 TO Form1-Pg-5-Visible
        WHEN 6
           MOVE 1 TO Form1-Pg-6-Visible
        WHEN 7
           MOVE 1 TO Form1-Pg-7-Visible
        WHEN 8
           MOVE 1 TO Form1-Pg-8-Visible
        END-EVALUATE
*       Before-Tabchg-Display
        DISPLAY Form1
        PERFORM Form1-Ta-1-Aft-Tabchg-Display
     END-EVALUATE
     .

 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Ta-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Tabchanged
        PERFORM Form1-Ta-1-Ev-Cmd-Tabchanged
     END-EVALUATE
     .

 Form1-Gd-1-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Bitmap-Clicked
        EVALUATE Event-Control-Id
        WHEN 201
           PERFORM gd-foto-Ev-Msg-Bitmap-Clicked
        WHEN 228
           PERFORM grd8-Ev-Msg-Bitmap-Clicked
        END-EVALUATE
     WHEN Msg-Begin-Entry
        EVALUATE Event-Control-Id
        WHEN 181
           PERFORM gd1-Ev-Msg-Begin-Entry
        WHEN 228
           PERFORM grd8-Ev-Msg-Begin-Entry
        END-EVALUATE
     END-EVALUATE
     .

 cb-1301-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Cmd-Clicked
        PERFORM cb-1301-Ev-Cmd-Clicked
     END-EVALUATE
     .

 gd2-Event-Proc.
* 
     EVALUATE Event-Type
     WHEN Msg-Begin-Entry
        PERFORM gd2-Ev-Msg-Begin-Entry
     END-EVALUATE
     .

 Form2-Event-Proc.
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform adresleri-tasi
     move isyeri-adres-tasi      to mis-sirket
     open i-o genel genel2
     move 1 to genel-anahtar genel2-anah
     read genel no lock invalid 
          Continue
     end-read

     read genel2 no lock invalid
          continue
     end-read
     close genel genel2          
         
     move muha-sirketi to hesap-dosya-adres cari-dosya-adres .
     perform  acuserve-adres-aktar
     if genel-profil-kolbandi-aktif = 1
        open i-o bantstok
        initialize bantstok-rec stok-var
        move 1 to bantstok-anah-kodu
        read bantstok no lock invalid
             move 0 to stok-var
        not invalid 
             move 1 to stok-var
        end-read 
        close bantstok
        if genel2-kolbandi-algo-stok-yok = 1
           move 0 to stok-var
        end-if 

        if stok-var = 1
           perform acuserve-bant-adres-aktar
        end-if      
     end-if
     .
*
 Form1-Ex-Other.
     inquire gd1,cursor-y in sayac
     inquire gd1,cursor-x in hangi-kolon
     evaluate key-status 
     when 11                
*          open input onbkodlar10
*          move 1 to sorgu-var
*          if kim-tcno > 0
*             move kim-tcno to polisxml-tckimlikno
*             initialize polisxml-kseri
*         else
**           move kim-serino to polisxml-kseri
*           initialize  polisxml-tckimlikno
*          end-if 
*          perform takas-olustur
*          perform kbs-exe-baglan
*          perform kbs-exe-islem-basla
*          close onbkodlar10
*          display message box alt-durum(1)
*                          title "Uyari"
*                          icon 1
      open input prohrk
      open i-o polisxml
      initialize prohrk-rec
       move musteri-sirket   to prohrk-profil-sirket
       move musteri-no       to prohrk-profil-no
      move isyeri-adres-tasi to prohrk-rez-sirket 
      start prohrk key > prohrk-anah invalid 
           continue
         not invalid
         perform until fs-prohrk = "10"
            read prohrk next no lock end move "10" to fs-prohrk
              not end
                if musteri-sirket    = prohrk-profil-sirket and
                   musteri-no        = prohrk-profil-no     and
                   isyeri-adres-tasi = prohrk-rez-sirket

                     initialize polisxml-rec
                     move prohrk-rez-no   to polisxml-rezno
                     move Prohrk-Rez-Sira to polisxml-sirano
                     read polisxml no lock invalid 
                        display "update edilecek polis kaydi yok"
                     not invalid
                       if alt-durum(1)(1:13) = "Kayit Bulundu"  
                          move 1 to polisxml-kbs-gonderildi
                       else
                          move 0 to polisxml-kbs-gonderildi                         
                       end-if 
                       rewrite polisxml-rec invalid display message box "Hata 4645645764" end-rewrite                       
                     end-read
                    else
                       move "10" to fs-prohrk
                end-if
             end-read
         end-perform
     end-start
     close prohrk polisxml
     when 18
        if Form1-Ta-1-Value = 6
           perform rez-cagir
        end-if
     when 6
        if Form1-Ta-1-Value = 6
           perform folio-cagir
        end-if 
     when 1
        if control-id = 22
           perform ulke-ara
        end-if
        if control-id = 126
           perform uyruk-ara
        end-if
        if control-id = 88
           perform pazar-ara
        end-if
        if control-id = 12
           perform hesap-ara
        end-if
        if control-id = 79
            perform kart-tipi-ara
        end-if
        if control-id = 213
           perform kart-tipi-ara-2
        end-if 
     when 2     
       if link-var <> 3
         if mis-sifreli = 1
            exit paragraph
         end-if 
       end-if 
           perform gr-kontrol
           perform xmlkontrol
           perform form-kaydet  
     when 5
           perform baslik-yukle
           perform konaklama-bilgisi
      when 31
            perform raporla
      when 1546
            perform puan-kullan
      when 1555
          perform tek-mus
      when 17
          perform log-goster
      when 3131
            perform mesajgir
       when 3030 
            perform anket-giris
               
     end-evaluate    
     .
*
 form-kaydet. 
     if mis-no = 0
        display message box "Misafir Numarasi Bos Gecilemez"
                        title "[ Uyari ]"
                        icon 1
        exit paragraph
     end-if

     if mis-adi = spaces
        display message box "Misafir Adi Bos Gecilemez"
                        title "[ Uyari ]"
                        icon 1
        exit paragraph          
     end-if

     if mis-sirket = spaces
        display message box "Kutuphane Bos Gecilemez"
                        title "[ Uyari ]"
                        icon 1
        exit paragraph          
        
     end-if

     if link-var not = 2
        display message box "Kaydedilsin Mi.?"
                        title "[Uyari]"
                        type 2
                        icon 2
                        returning return-code
        if return-code = 2
           exit paragraph
        end-if
     end-if 


     open i-o musteri
     initialize musteri-rec
     move mis-no            to musteri-no   
     move mis-sirket        to musteri-sirket          
     if link-var > 0
        move mis-no         to musteri-no   mis-no-cagir
        move mis-sirket     to musteri-sirket mis-sirket-cagir         
     end-if 
     read musteri no lock invalid
          initialize musteri-rec
          accept musteri-k-tarih from century-date
          move k-kodu-tasi  to musteri-staf-ilk
     end-read
     
     if k-kvkk-yetki = "K" and                                              |firat 10/03/2020
        link-var <> 3 and
        giz-durum = cb-1313-val
        display message box "Kvkk Yetkisi Yoktur.." new-line
                            "Islem Iptal Edildi.."
                      title "[ Uyari ]"
                       icon 1
        close musteri
        exit paragraph
     end-if

     if k-kvkk-yetki = "K" and                                              |firat 10/03/2020
        link-var <> 3 and
        giz-durum <> cb-1313-val

        move cb-1313-val to musteri-gizlilik

        accept musteri-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
        accept musteri-edit-zaman from time          |                           

        rewrite musteri-rec invalid
           continue
        end-rewrite 
        close musteri
        exit paragraph
     end-if

     move mis-no           to musteri-no  
     move mis-adi          to musteri-adi kim-adi             
     move mis-soy          to musteri-soyadi  kim-soy
     move kim-d-tarih      to musteri-d-tarihi 
     move mis-etarih       to musteri-e-tarihi 
     move mis-otarih       to musteri-o-tarihi 
     move mis-ulke         to musteri-ulke
     move mis-dil          to musteri-dil-1
     move mis-din          to musteri-din
     move mis-title        to musteri-unvan
     move mis-vucut-isisi  to musteri-vucut-isisi


     move mis-kisisel-ilce to musteri-kis-ilce            
     move mis-kisisel-il   to musteri-kis-il          

     move mis-email        to musteri-e-mail
     move mis-web          to musteri-web-adresi
     move mis-kart-tipi    to musteri-kart-tipi
     move mis-kart-tipi-2  to musteri-kart-tipi-2

     move mis-gelis-sayisi to musteri-gelis-sayisi
     move mis-unvan1       to musteri-unvan1
     move mis-unvan2       to musteri-unvan2
     move mis-adres1       to musteri-adres1
     move mis-adres2       to musteri-adres2
     move mis-vdairesi     to musteri-vdairesi
     move mis-vno          to musteri-vno
     move mis-il           to musteri-il
     move mis-ilce         to musteri-ilce 
     move mis-tel1         to musteri-tel1
     move mis-tel2         to musteri-tel2
     move mis-tel3         to musteri-tel3
     move mis-gsm          to musteri-gsm
     move mis-pk           to musteri-pk
     move mis-fax          to musteri-fax
*     move mis-hobi1        to musteri-hobi1
*     move mis-hobi2        to musteri-hobi2
*     move mis-gazete       to musteri-gazete-1
*     move mis-tvkanali     to musteri-tv-kanali-1
*     move mis-tv-prog      to musteri-tv-prog-1
     move mis-sirket       to musteri-sirket
     move mis-kis-adrs     to musteri-kis-adrs
     move mis-kis-adrs1    to musteri-kis-adrs1
     move mis-fat-ulke     to musteri-fat-ulke
     move cb-kaynak(1:2)   to musteri-kaynak

     move kim-il           to musteri-kim-il
     move kim-ilce         to musteri-kim-ilce

     move mis-acik         to musteri-aciklama
*     move mis-araba        to musteri-arac-model
     move mis-plaka        to musteri-plaka                    
     move cb-odeme(1:1)    to musteri-odeme-tipi
     move cb-kart-tipi-val(1:1) to musteri-odeme-kart-tipi          
     move kart-sahibi      to musteri-kart-sahibi
     move kart-no          to musteri-kart-no
     move cb-ay-val        to musteri-son-k-ay
     move cb-yil-val       to musteri-son-k-yil
     move guvenlik-kodu    to musteri-g-kodu
     move kim-tcno         to musteri-kim-tcno
     move kim-adi          to musteri-adi
     move kim-soy          to musteri-soyadi
     move kim-uyruk        to musteri-kim-uyruk
     move kim-cins(1:1)    to musteri-kim-cinsiyet
     move kim-medeni       to musteri-kim-medeni
     move kim-adres        to musteri-kim-adrs
     move kim-adres1       to musteri-kim-adrs1
     move kim-belge(1:1)   to musteri-b-turu
     move kim-serino       to musteri-seri-no
     move kim-baba         to musteri-baba-adi
     move kim-ana          to musteri-ana-adi
     move kim-dyeri        to musteri-d-yeri
     move kim-il           to musteri-kim-il
     move kim-ilce         to musteri-kim-ilce
     move kim-mahalle      to musteri-kim-mahalle
     move kim-cilt         to musteri-kim-cilt
     move kim-aile         to musteri-kim-aile-no
     move kim-sirano       to musteri-kim-sira-no
     move cb-1313-val      to musteri-gizlilik
     move polisxml-prb     to musteri-prb-ack
     move a-hesap-kodu     to musteri-muhasebe-kodu
     move mail-durumu(1:1) to musteri-mail-durumu

     if kart-numarasi1 not =  kart-numarasi and
        kart-numarasi not = spaces
        move kart-numarasi     to musteri-puan-kart-no
     else
        move kart-numarasi1    to musteri-puan-kart-no
     end-if 

     move toplam-puan      to musteri-kazanilan-puan
     move kullanilan-puan  to musteri-kullanilan-puan
     move acc-80-value     to musteri-gecmis-cl-tut
     move acc-81-value     to musteri-gecmis-kalis-sayisi
     
*     move acc-82-value     to musteri-gecmis-geceleme
     move k-kodu-tasi      to musteri-staf-son
     accept musteri-g-tarih from century-date

     if link-var = 2
        move mis-toplu-adi          to musteri-adi kim-adi
        move mis-toplu-soyadi       to musteri-soyadi kim-soy
        move mis-toplu-tc-no        to musteri-kim-tcno
        move mis-toplu-adres        to musteri-adres1 musteri-kis-adrs musteri-kim-adrs
        move mis-toplu-uyruk        to musteri-kim-uyruk
        move mis-toplu-dogum-yeri   to musteri-d-yeri
        move mis-toplu-kayitli-il   to musteri-kim-il
        move "."                    to musteri-kim-ilce
        move mis-toplu-ana-adi      to musteri-ana-adi
        move mis-toplu-baba-adi     to musteri-baba-adi
        move mis-toplu-belge-tipi   to musteri-b-turu
        move mis-toplu-dog-tar      to musteri-d-tarihi
        move "."                    to musteri-seri-no
     end-if 

     move uygulama-dahil            to musteri-uygulama-dahil

     accept musteri-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
     accept musteri-edit-zaman from time          |                           

     write musteri-rec invalid
      
*        perform polisxml-at
        inspect musteri-e-mail converting  x"989E999A80A6A78D81879F94" to
                                            x"49534F55434767697563736F"
        move function lower-case(musteri-e-mail)(1:40) TO musteri-e-mail
        inspect musteri-e-mail converting  x"FDF6E7FEF0FC" to x"696F63736775"

        accept musteri-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
        accept musteri-edit-zaman from time          |                           

        rewrite musteri-rec end-rewrite
     end-write  
     perform log-operation-musteri
     perform polisxml-at

     close musteri
        perform eraysoft-resim-kopyala  

           if k-kodu-tasi = "ASYA" stop " " end-if
        if genel-profil-kolbandi-aktif = 1 and bant-seri <> spaces 
           evaluate link-var
               when 3  
                    initialize mis-kol-bandi
                    move bant-seri to mis-kol-bandi

               when other  
                    open i-o kolbant rez musteri prohrk13
                    initialize kolbant-rec  
                    move 1 to bant-bos
                    move bant-seri to kolbant-seri-no 
                    start kolbant key not < kolbant-anah1 invalid
                          continue
                    not invalid
                    perform with test after until fs-kolbant = "10" 
                    read kolbant next no lock end move "10" to fs-kolbant
                    not at end 
                        if bant-seri = kolbant-seri-no
                           if kolbant-durumu = 4 exit perform cycle end-if
                           
                           move 0 to bant-bos
                           display message box "Kolbandi daha once", kolbant-rez-no, " nolu rezervasyona baglanmis." new-line
                                               "Islem iptal edilmistir!!.."
                        end-if
                        exit perform
                    end-read
                    end-perform
                    end-start    
                    if bant-bos = 1 
                       initialize kolbant-rec kisi-top
                       compute kisi-top = rez-buyuk + rez-kucuk + rez-free     
                       
                       move 1 to aktif-bant-say
                       move rez-no to kolbant-rez-no
                       start kolbant key not < kolbant-anah invalid
                             continue
                       not invalid
                       perform with test after until fs-kolbant  = "10"
                       read kolbant next no lock end move "10" to fs-kolbant 
                       not at end 
                      
                           if rez-no <> kolbant-rez-no
                              exit perform
                           end-if
                           if kolbant-durumu = 1 
                              add 1 to aktif-bant-say
                           end-if
                      
                       end-read
                       end-perform 
                       end-start
                       initialize tmp-ex-pax
                             if genel2-kolbandi-algo-stok-yok = 1
                                    move 99 to kisi-top
                             end-if                        
                       if kisi-top >= aktif-bant-say 
                          move 0 to gec-gecme
                       else
                          display message box "Aktif kolbandi sayisi rezervasyon toplam kisi sayisindan fazla olamaz." new-line
                                              "Daha fazla kolbandi tanimlamasi sisteme EXTRA PAX olarak islenecektir." new-line
                                              "Devam edecek misiniz...?"
                                        title "[Bildirim]"
                                         type 2
                                         icon 2
                                    returning return-code
                          if return-code = 2
                             move 1 to gec-gecme
                          else
                             move 0 to gec-gecme
                             move 1 to tmp-ex-pax
                          end-if
                       end-if
                       if gec-gecme = 0 and tmp-lck-rez <> spaces 
                          if stok-var = 1
                             move bant-seri(1:6) to bant-kont
                             move bant-seri      to fullbant-kont
                             perform stok-seri-kontrol
                          end-if
                            if genel2-kolbandi-algo-stok-yok = 1
                               move 0 to kolbant-seri-buldum
                            end-if 
                          
                          if kolbant-seri-buldum = 0
                             if stok-var = 1
                                display message box "Secilen Kolbandi Serisi Tanimlanmamis.."
                                              title "Uyari"
                                               icon 1    
                             else
                                move mis-no     to yedek-prof-no
                                move mis-sirket to yedek-prof-sirket
                                perform musteri-kolbandi-kontrol
                                if profil-kolbandi-var = 0

                                   if bant-seri(7:1) <> space 
                                      move bant-seri(1:6) to bant-kont
                                      move bant-seri      to fullbant-kont
                                      perform kolbant-algo-kont
                                   if genel2-kolbandi-algo-stok-yok = 1
                                      move 0 to hatali-bant
                                   end-if 
                                   else
                                      display message box "Kolbandi 7 haneden az olamaz.."
                                      move 1 to hatali-bant
                                   end-if

                                   if hatali-bant = 0
                                      initialize kolbant-rec
                                      move tmp-lck-rez to kolbant-rez-no 
                                      move bant-seri   to kolbant-seri-no 
                                      read kolbant no lock invalid
                                           move 1                to kolbant-durumu
                                           move tarih-tasi       to kolbant-kayit-tar
                                           move k-kodu-tasi      to kolbant-kayit-staff
                                           move mis-no           to kolbant-mus-profil
                                           move mis-sirket       to kolbant-mus-sirket
                                           move personel-bilinci to kolbant-p-bilinci
                                           move tmp-ex-pax       to kolbant-ex-pax
                                           move tmp-uzatma       to kolbant-uzatma
                                           if kolbant-rez-no <> 0 
                                              initialize musteri-rec 
*                                              move kolbant-mus-anah to m-profil    |firat m-profil bos gorunuyor.. 17/08/2020
                                              move kolbant-mus-sirket to musteri-sirket 
                                              move kolbant-mus-profil to musteri-no
                                              read musteri no lock invalid
                                                   continue
                                              not invalid
                                                  move tarih-tasi       to gbugun
                                                  move musteri-d-tarihi to gdogtar
*                                                  perform yas-hes-pro
*                                                  if yasz > 2
                                                     write kolbant-rec invalid 
                                                           continue
                                                     not invalid
*                                                        move kolbant-mus-anah to m-profil    |firat m-profil bos gorunuyor.. 17/08/2020
                                                         move kolbant-mus-sirket to musteri-sirket 
                                                         move kolbant-mus-profil to musteri-no
                                                         read musteri no lock invalid
                                                              continue
                                                         not invalid
                                                             move personel-bilinci to musteri-personel-bilinci
                                                             move bant-seri(1:26)  to musteri-kol-bandi

                                                             accept musteri-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                                                             accept musteri-edit-zaman from time          |                           
                                
                                                             rewrite musteri-rec end-rewrite
                                                         end-read
                                                     end-write
*                                                  end-if
                                              end-read
                                           end-if
                                           display message box "Bant yazma islemi tamamlandi."
                                      end-read   
                                   else
                                      display message box "Girilen bant serisi Algoritmaya uymuyor." new-line
                                                          "Bant yazma islemi iptal edilmistir.."
                                   end-if
                                end-if
                             end-if
                          else
                             move mis-no     to prohrk-profil-no
                             move mis-sirket to prohrk-profil-sirket
                             perform musteri-kolbandi-kontrol
                             if profil-kolbandi-var = 0 
                                if bant-seri(7:1) <> space 
                                   move bant-seri(1:6) to bant-kont
                                   move bant-seri      to fullbant-kont
                                   perform kolbant-algo-kont
                                end-if
                                if genel2-kolbandi-algo-stok-yok = 1
                                  move 0 to hatali-bant
                                end-if 
                                if hatali-bant = 0
                                   initialize kolbant-rec
                                   move tmp-lck-rez to kolbant-rez-no 
                                   move bant-seri   to kolbant-seri-no 
                                   read kolbant no lock invalid
                                        move 1           to kolbant-durumu
                                        move tarih-tasi  to kolbant-kayit-tar
                                        move k-kodu-tasi to kolbant-kayit-staff
                                        move mis-no      to kolbant-mus-profil
                                        move mis-sirket  to kolbant-mus-sirket
                                        move tmp-ex-pax  to kolbant-ex-pax
                                        move tmp-uzatma  to kolbant-uzatma
                                        if kolbant-rez-no <> 0 
                                           write kolbant-rec invalid      
                                                 continue
                                           not invalid
*                                                move kolbant-mus-anah to m-profil    |firat m-profil bos gorunuyor.. 17/08/2020
                                                move kolbant-mus-sirket to musteri-sirket 
                                                move kolbant-mus-profil to musteri-no
                                                read musteri no lock invalid
                                                     continue
                                                not invalid
                                                    move personel-bilinci to musteri-personel-bilinci
                                                    move bant-seri(1:26)  to musteri-kol-bandi

                                                    accept musteri-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                                                    accept musteri-edit-zaman from time          |                           
                        
                                                    rewrite musteri-rec end-rewrite
                                                end-read
                                            end-write
                                        end-if
                                        display message box "Bant yazma islemi tamamlandi."
                                   not invalid
                                       move 1           to kolbant-durumu
                                       move tarih-tasi  to kolbant-deg-tar
                                       move k-kodu-tasi to kolbant-deg-staff
                                       move mis-no      to kolbant-mus-profil
                                       move mis-sirket  to kolbant-mus-sirket
                                       move tmp-ex-pax  to kolbant-ex-pax
                                       move tmp-uzatma  to kolbant-uzatma
                                       rewrite kolbant-rec invalid
                                               continue
                                       not invalid
*                                           move kolbant-mus-anah to m-profil    |firat m-profil bos gorunuyor.. 17/08/2020
                                           move kolbant-mus-sirket to musteri-sirket 
                                           move kolbant-mus-profil to musteri-no
                                           read musteri no lock invalid
                                                continue
                                           not invalid
                                               move personel-bilinci to musteri-personel-bilinci
                                               move bant-seri(1:26)  to musteri-kol-bandi

                                               accept musteri-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
                                               accept musteri-edit-zaman from time          |                           
                
                                               rewrite musteri-rec end-rewrite
                                           end-read
                                       end-rewrite
                                   end-read
                                else
                                   display message box "Girilen bant serisi Algoritmaya uymuyor." new-line
                                                       "Bant yazma islemi iptal edilmistir.."
                                end-if
                             end-if
                          end-if
                       end-if
                    end-if
                    close kolbant rez musteri prohrk13
           end-evaluate
        end-if
     initialize deg kim-tcno kim-adi kim-soy kim-uyruk kim-cins kim-medeni kim-adres kim-adres1 kim-belge        
               kim-serino kim-baba kim-ana kim-dyeri kim-il kim-ilce kim-mahalle kim-cilt kim-aile kim-sirano       
               kart-no cb-kaynak kim-d-tarih mis-fat-ulke a-hesap-kodu mis-kart-tipi-2 toplam-puan kart-numarasi
               kullanilan-puan acc-80-value acc-81-value acc-82-value  uygulama-dahil cb-1313-val personel-bilinci

     display acc-mis-no cb-mail-durumu acc-mis-adi acc-mis-soy 
             acc-egun acc-eay acc-eyil acc-ogun acc-oay acc-oyil
             acc-mis-ulke acc-mis-dil acc-mis-din acc-mis-title acc-mis-vucut-isisi cb-uygulama-dahil
             acc-mis-mesleka acc-mis-meslek   acc-mis-email acc-mis-web acc-mis-kart acc-mis-kart-2 acc-mis-gel
             acc-mis-unvan1 acc-mis-unvan2 acc-mis-adres1   acc-mis-adres2 acc-mis-vd
             acc-mis-vno    acc-mis-il     acc-mis-ilce     acc-mis-tel1   acc-mis-tel2  acc-mis-tel3
             acc-mis-gsm    acc-mis-fax    acc-mis-pk       acc-mis-hobi1  acc-mis-hobi2 acc-mis-gazete
             acc-mis-kanal  acc-mis-prog   acc-mis-kis-adrs acc-mis-kis-adrs1 acc-mis-ila
             acc-mis-pazar  Form1-Cm-4                  
             acc-mis-acik acc-hesap-kodu acc-toplam-puan acc-kullanilan-puan 
             acc-kart-numarasi acc-80 acc-81 acc-82 cb-1313 cb-1301
     if genel2-useinbox-devrede = 1 and     |11/07/2020 firat use inbox sistemi
        (ydk-mail <> musteri-e-mail or                              
         ydk-adi <> musteri-adi or
         ydk-soyadi <> musteri-soyadi)              
        perform useinbox-islem
     end-if

     if link-var >= 1
        if link-var = 2
           set exit-pushed to true  
        end-if 
        if mis-kim-cagir = 1
           move 1 to mis-kayit         
           set exit-pushed to true     
        end-if
        
        if mis-kim-cagir = 2
           move 1 to mis-kayit         
           set exit-pushed to true     
        end-if
***/dokumerden geldigi zaman set exit-pushed yapýlýo
        if mis-kim-cagir = 5
           set exit-pushed to true
        end-if
     end-if. 
*
 useinbox-islem.      |11/07/2020 firat use inbox sistemi    musteri-adi musteri-soyadi  musteri-e-mail
*     open input uyrukkbs useinbox
*     initialize uyrukkbs-rec inbox-ekodu inbox-adi inbox-soyadi inbox-mail   
*     move musteri-kim-uyruk to uyrukkbs-kodu
*     read uyrukkbs no lock invalid
*          move "13131313131313131313" to inbox-ekodu
*     not invalid
*         initialize useinbox-rec 
*         move uyrukkbs-inbox-kodu to useinbox-kodu
*         read useinbox no lock invalid
*              move "13131313131313131313" to inbox-ekodu
*         not invalid
*             move useinbox-ekodu to inbox-ekodu
*         end-read 
*     end-read 
*     close uyrukkbs useinbox

     move musteri-adi             to inbox-adi
     move musteri-soyadi          to inbox-soyadi
     move musteri-e-mail          to inbox-mail
*     move genel2-useinbox-mail    to inbox-kk
*     move genel2-useinbox-pw      to inbox-pw
     move genel2-sendmail-api-key to inbox-apikey

     inspect inbox-adi    replacing trailing spaces by low-values 
     perform varying xiii from 1 by 1 until xiii > 30
        if inbox-adi(xiii:1) = spaces
           move "-"  to inbox-adi(xiii:1) 
        end-if 
        if inbox-adi(xiii:1) = low-values
           exit perform  
        end-if 
     end-perform 
     inspect inbox-adi    replacing trailing low-values by spaces 

     inspect inbox-soyadi replacing trailing spaces by low-values 
     perform varying xiii from 1 by 1 until xiii > 30
        if inbox-soyadi(xiii:1) = spaces
           move "-"  to inbox-soyadi(xiii:1) 
        end-if 
        if inbox-soyadi(xiii:1) = low-values
           exit perform  
        end-if 
     end-perform 
     inspect inbox-soyadi replacing trailing low-values by spaces 


     initialize exe-param-gonder  
     move all low-values to exe-param-gonder  
     inspect inbox-adi    replacing trailing spaces by low-values 
     inspect inbox-soyadi replacing trailing spaces by low-values 
     inspect inbox-mail   replacing trailing spaces by low-values 
     inspect inbox-kk     replacing trailing spaces by low-values 
     inspect inbox-pw     replacing trailing spaces by low-values 
     inspect inbox-ekodu  replacing trailing spaces by low-values 

     string exe-param-gonder
            "@[DISPLAY]:C:\acucorp\acucbl701\acugt\bin\sendmail.exe " delimited by low-values
            inbox-mail    delimited by low-values
            " "           delimited by low-values
            inbox-adi     delimited by low-values
            " "           delimited by low-values
            inbox-soyadi  delimited by low-values
            " "           delimited by low-values
            inbox-apikey  delimited by low-values
     into exe-param-gonder
    
     inspect exe-param-gonder replacing trailing low-values by spaces 
                                                                       
     call "c$copy" using "/asya/ytl/exe/sendmail/sendmail.exe",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\sendmail.exe"

     call "c$copy" using "/asya/ytl/exe/sendmail/sendmail.exe.config",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\sendmail.exe.config"

     call "c$copy" using "/asya/ytl/exe/sendmail/RestSharp.xml",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\RestSharp.xml"

     call "c$copy" using "/asya/ytl/exe/sendmail/RestSharp.dll",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\RestSharp.dll"

     call "c$copy" using "/asya/ytl/exe/sendmail/Newtonsoft.Json.xml",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\Newtonsoft.Json.xml"

     call "c$copy" using "/asya/ytl/exe/sendmail/Newtonsoft.Json.dll",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\Newtonsoft.Json.dll"

     call "c$copy" using "/asya/ytl/exe/sendmail/mapping.xml",
        "@[DISPLAY]:\acucorp\acucbl701\acugt\bin\mapping.xml"

        call "c$system" using exe-param-gonder, 384       |384 sayýsý kalacak siyah ekran çýkmasýný engelliyor.          || gonder gitsin dayýjým

      .
*
 Polisxml-At.
      open input prohrk rez.
      open i-o polisxml.
      initialize prohrk-rec.
       move musteri-sirket   to prohrk-profil-sirket
       move musteri-no       to prohrk-profil-no
      move isyeri-adres-tasi to prohrk-rez-sirket 
      start prohrk key > prohrk-anah invalid 
           continue
         not invalid
         perform until fs-prohrk = "10"
            read prohrk next no lock end move "10" to fs-prohrk
              not end
                if musteri-sirket    = prohrk-profil-sirket and
                   musteri-no        = prohrk-profil-no     and
                   isyeri-adres-tasi = prohrk-rez-sirket

                     initialize polisxml-rec
                     move prohrk-rez-no   to polisxml-rezno
                     move prohrk-rez-sira to polisxml-sirano
                     read polisxml no lock invalid 
                        display "update edilecek polis kaydi yok"
                     not invalid
                       move musteri-adi            to polisxml-adi
                       move musteri-soyadi            to polisxml-soyadi
                       move musteri-kim-tcno          to polisxml-tckimlikno          
                       move musteri-kim-uyruk         to polisxml-uyruk 
                       if  polisxml-uyruk = "KKT" then 
                           move "KKTC" to  polisxml-uyruk

                       end-if
                       move musteri-kim-cinsiyet      to polisxml-cinsiyet   
                       move musteri-kim-medeni        to polisxml-medeni
                       initialize polisxml-adr
                       string 
                              musteri-kim-adrs    delimited by "   "
                              musteri-kim-adrs1   delimited by "   "                      
                       into polisxml-adr

                       MOVE musteri-d-tarihi          to polisxml-dog-tar
               
                       move musteri-b-turu            to polisxml-kturu         
                       move musteri-seri-no           to polisxml-kseri        
                       move musteri-baba-adi          to polisxml-babaadi       
                       move musteri-ana-adi           to polisxml-anaadi        
                       move musteri-d-yeri            to polisxml-dyeri         
                       move musteri-kim-il            to polisxml-nil         
                       move musteri-kim-ilce          to polisxml-nilce       
                       move musteri-kim-mahalle       to polisxml-nmahalle    
                       move musteri-kim-cilt          to polisxml-ncilt       
                       move musteri-kim-aile-no       to polisxml-naile    
                       move musteri-kim-sira-no       to polisxml-nsira  
                      
                       move musteri-prb-ack           to polisxml-prb
                       rewrite polisxml-rec invalid display message box "Hata 4645645764" end-rewrite

                       initialize rez-rec             |profil-rez-no-alindi
                       move polisxml-rezno to rez-no 
                       read rez no lock invalid
                            continue
                       not invalid
                           if rez-gir-tar not > tarih-tasi and 
                              rez-cik-tar not < tarih-tasi
                              move prohrk-profil-anah to yedek-prof
                              move rez-no             to tmp-lck-rez
                           end-if
                       end-read
                      
                     end-read
                    else
                       move "10" to fs-prohrk
                end-if
             end-read
         end-perform
     end-start 
     close rez.
*
 Form1-Aft-Initdata.
    open i-o hediyhrk karttip musteri pformul close hediyhrk karttip musteri pformul
    call "c$narg" using link-var
*    if link-var > 1
*    if mis-kol-bandi <> spaces
*       move mis-kol-bandi to xrez-lnk-val
*       initialize mis-kol-bandi
*    end-if
*    end-if
         
     open input karttip
     initialize karttip-rec puanlar
     start karttip key not < karttip-anah invalid 
         continue 
     not invalid 
     perform with test after until fs-karttip = "10"
     read karttip next no lock end move "10" to fs-karttip
     not at end 
         if function numval(karttip-kodu) < 10
            move function numval(karttip-kodu) to s
            move karttip-alt-puan to alt-puan(s)
            move karttip-ust-puan to ust-puan(s)
         end-if 
     end-read 
     end-perform
     end-start
     close karttip
     if link-var = 1
        
        if mis-sirket-cagir = spaces and
           mis-no-cagir = spaces
           perform fis-al
           move 4 to accept-control
           move 6 to control-id
           move isyeri-adres-tasi     to mis-sirket
           move mis-cagir-adi         to mis-adi kim-adi
           move mis-cagir-soyadi      to mis-soy kim-soy
**           move mis-dogum-tarihi      to kim-d-tarih
           display acc-mis-adi acc-mis-soy acc-kim-adi acc-kim-soyadi
           display acc-mis-sirket acc-mis-no
           display acc-kim-dyil acc-kim-day acc-kim-dgun
        else
           move mis-sirket-cagir     to mis-sirket
           move mis-no-cagir         to mis-no
           display acc-mis-sirket acc-mis-no
           perform kayit-goster
           perform kullanilan-puan-bul
        end-if  
     else
        perform fis-al
        move 4 to accept-control
        move 6 to control-id
        move isyeri-adres-tasi     to mis-sirket
        move mis-cagir-adi         to mis-adi kim-adi
        move mis-cagir-soyadi      to mis-soy kim-soy
        display acc-mis-adi acc-mis-soy acc-kim-adi acc-kim-soyadi

        display acc-mis-sirket acc-mis-no 
        if link-var = 2 
           move mis-toplu-adi         to mis-adi kim-adi
           move mis-toplu-soyadi      to mis-soy kim-soy
           move mis-toplu-dog-tar     to kim-d-tarih
           move "."                   to kim-serino
           move mis-toplu-adres       to kim-adres
           move mis-toplu-uyruk       to kim-uyruk
           move mis-toplu-tc-no       to kim-tcno
           move mis-toplu-kayitli-il   to kim-il 
           move "."                    to kim-ilce
           move mis-toplu-ana-adi      to kim-ana
           move mis-toplu-baba-adi     to kim-baba


           display acc-mis-adi acc-mis-soy acc-kim-adi acc-kim-soyadi              
           move 2       to key-status 
           perform Form1-Ex-Other             
        end-if 
     end-if

     perform varying i from 1 by 1 until i > 3
        move i         to resim-no        
        perform resim-var-yok-kontrol-1
     end-perform
     if link-var not = 2
        open i-o musteri prohrk
        close musteri prohrk
     end-if 
     if link-var not = 2
        open i-o genelfis prohrk|transfer programý yüzünden CPY içinde deðil 
        move 0    to transferden
        perform puan-hesapla|CPY dirr CBL 'nin içine bakkkk...
        close genelfis prohrk|transfer programý yüzünden CPY içinde deðil 
        perform tek-mus
        perform konaklama-bilgisi
     end-if 

     open i-o kllnc                             | firat 10/03/2020 
     initialize kllnc-rec giz-durum
     move k-kodu-tasi to k-kodu
     read kllnc no lock invalid
          display message box "Kullanici kodu tanimsiz.."
     end-read 
     close kllnc
     if k-kvkk-yetki = "K" and 
        link-var <> 3 and
        musteri-gizlilik = 0
        perform kvkk-ekran-kontrol-1            | firat 09/03/2020 
     end-if
     move musteri-gizlilik to giz-durum

     |////12092018                                               
     perform kvk-tab-kontrol
    

     if link-var <> 3 
        if mis-sifreli = 1
            move mis-adi to sifreli-text
            perform sifreleme-yap
            move sifreli-text to mis-adi

            move mis-soy to sifreli-text
            perform sifreleme-yap
            move sifreli-text to mis-soy


            move kim-adi to sifreli-text
            perform sifreleme-yap
            move sifreli-text to kim-adi


            move kim-soy to sifreli-text
            perform sifreleme-yap
            move sifreli-text to kim-soy

            move kim-tcno to sifreli-text
            perform sifreleme-yap
            move sifreli-text to kim-tcno


            modify Form1-Pb-1,visible = false
        end-if 
     end-if 

     display cb-mail-durumu acc-mis-adi acc-mis-soy acc-mis-ila acc-son-staf acc-ilk-staf
             acc-egun acc-eay acc-eyil acc-ogun acc-oay acc-oyil   cb-uygulama-dahil
             acc-mis-ulke acc-mis-dil acc-mis-din acc-mis-title acc-mis-vucut-isisi
             acc-mis-mesleka acc-mis-meslek acc-mis-email acc-mis-web acc-mis-kart acc-mis-kart-2 acc-mis-gel
             acc-mis-unvan1 acc-mis-unvan2 acc-mis-adres1 acc-mis-adres2 acc-mis-vd cb-1313
             lb-ulke acc-mis-din Form1-La-1bb lb-pazar
     display acc-mis-vno acc-mis-il acc-mis-ilce acc-mis-tel1 acc-mis-tel2 acc-mis-tel3
             acc-mis-gsm acc-mis-fax acc-mis-pk acc-mis-hobi1 acc-mis-hobi2 acc-mis-gazete
             acc-mis-kanal acc-mis-prog acc-mis-kis-adrs acc-mis-kis-adrs1 acc-mis-pazar
             Form1-Cm-4 acc-mis-acik  acc-mis-plaka cb-odeme-tipi cb-kart-tipi
             acc-kart-sahibi acc-kart-sahiba cb-ay cb-yil acc-guvenlik
             acc-kim-tcno acc-kim-adi acc-kim-soyadi acc-kim-uyruk cb-kim-cinsiyet acc-kim-medeni
             acc-kim-adrs acc-kim-adrs1 cb-kim-belge acc-kim-serino acc-kim-baba acc-kim-ana acc-kim-dyeri
             acc-kim-dgun acc-kim-day acc-kim-dyil acc-kim-il acc-kim-ilce acc-kim-mahalle acc-kim-cilt
             acc-kim-aile acc-kim-sirano acc-guncel-guna acc-guncel-aya acc-guncel-yila 
             acc-guncel-gun acc-guncel-ay acc-guncel-yil acc-hesap-kodu acc-toplam-puan
             acc-kart-numarasi acc-kullanilan-puan acc-kalan-puan acc-80 acc-81 acc-82
             |acc-mis-araba
    |////12092018
*     perform kvkk-ekran-kontrol-2            | firat 09/03/2020 
     perform mesaj-goster
     perform yedekleme-yap
     .
*
 yedekleme-yap.
     if genel2-useinbox-devrede = 0 
        exit paragraph
     end-if
     initialize ydk-adi ydk-soyadi ydk-mail
     move mis-adi    to ydk-adi
     move mis-soy    to ydk-soyadi
     move mis-email  to ydk-mail
     .
*
 acc-mis-no-Aft-Procedure.
     if mis-no = 0
        perform fis-al
     end-if
     perform kayit-goster.
*
 kayit-goster.
     open input musteri
     initialize musteri-rec
     move mis-sirket    to musteri-sirket
     move mis-no        to musteri-no
     read musteri no lock invalid                  
         initialize deg mail-durumu kim-uyruk a-hesap-kodu acc-80-value   acc-81-value  acc-82-value  
         display acc-mis-adi acc-mis-soy mis-fat-ulke
                 acc-egun acc-eay acc-eyil acc-ogun acc-oay acc-oyil
                 acc-mis-ulke acc-mis-dil acc-mis-din acc-mis-title acc-mis-vucut-isisi
                 acc-mis-mesleka acc-mis-meslek acc-mis-email acc-mis-web acc-mis-kart acc-mis-kart-2 acc-mis-gel
                 acc-mis-unvan1 acc-mis-unvan2 acc-mis-adres1 acc-mis-adres2 acc-mis-vd
                 acc-mis-vno acc-mis-il acc-mis-ilce acc-mis-tel1 acc-mis-tel2 acc-mis-tel3
                 acc-mis-gsm acc-mis-fax acc-mis-pk acc-mis-hobi1 acc-mis-hobi2 acc-mis-gazete
                 acc-mis-kanal acc-mis-prog acc-kim-uyruk acc-mis-ila
                 acc-hesap-kodu  acc-80 acc-81 acc-82
     not invalid
        move musteri-no               to mis-no 
        move musteri-sirket           to mis-sirket                  
        move musteri-adi              to mis-adi          
        move musteri-soyadi           to mis-soy          
        move musteri-d-tarihi         to kim-d-tarih       
        move musteri-e-tarihi         to mis-etarih       
        move musteri-o-tarihi         to mis-otarih       
        move musteri-ulke             to mis-ulke         
        move musteri-dil-1            to mis-dil   
        move musteri-din              to mis-din
        move musteri-unvan            to mis-title  
        move musteri-vucut-isisi      to mis-vucut-isisi
        move musteri-uygulama-dahil   to uygulama-dahil
        move musteri-kis-ilce         to mis-kisisel-ilce    
        move musteri-kis-il           to mis-kisisel-il
   
        if mis-kisisel-il(1:10) = spaces and mis-kisisel-il(11:1) <> spaces
              initialize mis-kisisel-il(11:1)
        end-if
 
        move musteri-e-mail           to mis-email        
        move musteri-web-adresi       to mis-web          
        move musteri-kart-tipi        to mis-kart-tipi 
        move musteri-kart-tipi-2      to mis-kart-tipi-2
        move musteri-gelis-sayisi     to mis-gelis-sayisi 
        move musteri-unvan1           to mis-unvan1       
        move musteri-unvan2           to mis-unvan2       
        move musteri-adres1           to mis-adres1       
        move musteri-adres2           to mis-adres2       
        move musteri-vdairesi         to mis-vdairesi     
        move musteri-vno              to mis-vno          
        move musteri-il               to mis-il           
        move musteri-ilce             to mis-ilce         
        move musteri-tel1             to mis-tel1         
        move musteri-tel2             to mis-tel2         
        move musteri-tel3             to mis-tel3         
        move musteri-gsm              to mis-gsm          
        move musteri-pk               to mis-pk           
        move musteri-fax              to mis-fax          
        move musteri-kis-adrs         to mis-kis-adrs
        move musteri-kis-adrs1        to mis-kis-adrs1
        move musteri-kaynak           to cb-kaynak(1:2)
        move musteri-aciklama         to mis-acik
*        move musteri-arac-model       to mis-araba
        move musteri-plaka            to mis-plaka  
        move musteri-odeme-tipi       to cb-odeme        
        move musteri-odeme-kart-tipi  to cb-kart-tipi-val
        move musteri-kart-sahibi      to kart-sahibi
        move musteri-kart-no          to kart-no
        move musteri-son-k-ay         to cb-ay-val
        move musteri-son-k-yil        to cb-yil-val
        move musteri-g-kodu           to guvenlik-kodu        
        move musteri-kim-tcno         to kim-tcno
        move musteri-adi              to kim-adi
        move musteri-soyadi           to kim-soy        
        move musteri-kim-uyruk        to kim-uyruk
        move musteri-kim-cinsiyet     to kim-cins
        move musteri-kim-medeni       to kim-medeni
        move musteri-kim-adrs         to kim-adres
        move musteri-kim-adrs1        to kim-adres1
        move musteri-b-turu           to kim-belge
        move musteri-seri-no          to kim-serino
        move musteri-baba-adi         to kim-baba
        move musteri-ana-adi          to kim-ana
        move musteri-d-yeri           to kim-dyeri
        move musteri-d-tarihi         to kim-d-tarih
        move musteri-kim-il           to kim-il
        move musteri-kim-ilce         to kim-ilce
        move musteri-kim-mahalle      to kim-mahalle
        move musteri-kim-cilt         to kim-cilt
        move musteri-kim-aile-no      to kim-aile
        move musteri-kim-sira-no      to kim-sirano
        move musteri-gizlilik         to cb-1313-val
        move musteri-g-tarih          to guncel-tarih
        move musteri-k-tarih          to kayit-tarih
        move musteri-fat-ulke         to mis-fat-ulke
        move musteri-muhasebe-kodu    to a-hesap-kodu
        move musteri-puan-kart-no     to kart-numarasi
        move musteri-kazanilan-puan   to toplam-puan
        move musteri-kullanilan-puan  to kullanilan-puan
        move musteri-gecmis-cl-tut    to acc-80-value             
        move musteri-gecmis-kalis-sayisi to acc-81-value
        move musteri-mail-durumu         to mail-durumu
*        move musteri-gecmis-geceleme  to acc-82-value
        move musteri-staf-son         to mis-son-staf
        move musteri-staf-ilk         to mis-ilk-staf
        move musteri-personel-bilinci to personel-bilinci
        move musteri-kol-bandi        to bant-seri
        move musteri-hes-kodu         to hes-kodu
        compute kalan-puan = musteri-kazanilan-puan - musteri-kullanilan-puan 
     end-read
     close musteri

*     perform kvkk-ekran-kontrol-1            | firat 04/03/2020 

     perform kvk-tab-kontrol

     display acc-mis-no cb-mail-durumu acc-mis-adi acc-mis-soy acc-mis-ila acc-son-staf acc-ilk-staf
             acc-egun acc-eay acc-eyil acc-ogun acc-oay acc-oyil   cb-uygulama-dahil
             acc-mis-ulke acc-mis-dil acc-mis-din acc-mis-title acc-mis-vucut-isisi acc-hes
             acc-mis-mesleka acc-mis-meslek acc-mis-email acc-mis-web acc-mis-kart acc-mis-kart-2 acc-mis-gel
             acc-mis-unvan1 acc-mis-unvan2 acc-mis-adres1 acc-mis-adres2 acc-mis-vd cb-1313 acc-bant-seri cb-1301

     display acc-mis-vno acc-mis-il acc-mis-ilce acc-mis-tel1 acc-mis-tel2 acc-mis-tel3
             acc-mis-gsm acc-mis-fax acc-mis-pk acc-mis-hobi1 acc-mis-hobi2 acc-mis-gazete
             acc-mis-kanal acc-mis-prog acc-mis-kis-adrs acc-mis-kis-adrs1 acc-mis-pazar
             Form1-Cm-4 acc-mis-acik  acc-mis-plaka cb-odeme-tipi cb-kart-tipi
             acc-kart-sahibi acc-kart-sahiba cb-ay cb-yil acc-guvenlik
             acc-kim-tcno acc-kim-adi acc-kim-soyadi acc-kim-uyruk cb-kim-cinsiyet acc-kim-medeni
             acc-kim-adrs acc-kim-adrs1 cb-kim-belge acc-kim-serino acc-kim-baba acc-kim-ana acc-kim-dyeri
             acc-kim-dgun acc-kim-day acc-kim-dyil acc-kim-il acc-kim-ilce acc-kim-mahalle acc-kim-cilt
             acc-kim-aile acc-kim-sirano acc-guncel-guna acc-guncel-aya acc-guncel-yila 
             acc-guncel-gun acc-guncel-ay acc-guncel-yil acc-hesap-kodu acc-toplam-puan
             acc-kart-numarasi acc-kullanilan-puan acc-kalan-puan acc-80 acc-81 acc-82
             |acc-mis-araba
*     perform kvkk-ekran-kontrol-2            | firat 09/03/2020 
     perform kart-tipi-oku
     perform kart-tipi-oku-2
     perform ulke-oku
     perform pazar-oku
     perform uyruk-oku
     perform hesap-oku
     .

*
 kvkk-ekran-kontrol-2.
     open input musteri
     initialize musteri-rec
     move mis-sirket    to musteri-sirket
     move mis-no        to musteri-no
     read musteri no lock invalid                  
          initialize deg mail-durumu kim-uyruk a-hesap-kodu acc-80-value   acc-81-value  acc-82-value  
          display acc-mis-adi acc-mis-soy mis-fat-ulke
                  acc-egun acc-eay acc-eyil acc-ogun acc-oay acc-oyil
                  acc-mis-ulke acc-mis-dil acc-mis-din acc-mis-title  acc-mis-vucut-isisi
                  acc-mis-mesleka acc-mis-meslek acc-mis-email acc-mis-web acc-mis-kart acc-mis-kart-2 acc-mis-gel
                  acc-mis-unvan1 acc-mis-unvan2 acc-mis-adres1 acc-mis-adres2 acc-mis-vd
                  acc-mis-vno acc-mis-il acc-mis-ilce acc-mis-tel1 acc-mis-tel2 acc-mis-tel3
                  acc-mis-gsm acc-mis-fax acc-mis-pk acc-mis-hobi1 acc-mis-hobi2 acc-mis-gazete
                  acc-mis-kanal acc-mis-prog acc-kim-uyruk acc-mis-ila
                  acc-hesap-kodu  acc-80 acc-81 acc-82
     not invalid
         move musteri-no               to mis-no 
         move musteri-sirket           to mis-sirket                  
         move musteri-adi              to mis-adi          
         move musteri-soyadi           to mis-soy          
         move musteri-d-tarihi         to kim-d-tarih       
         move musteri-e-tarihi         to mis-etarih       
         move musteri-o-tarihi         to mis-otarih       
         move musteri-ulke             to mis-ulke         
         move musteri-dil-1            to mis-dil   
         move musteri-din              to mis-din
         move musteri-unvan            to mis-title  
         move musteri-vucut-isisi      to mis-vucut-isisi
         move musteri-uygulama-dahil   to uygulama-dahil
         move musteri-kis-ilce         to mis-kisisel-ilce    
         move musteri-kis-il           to mis-kisisel-il
      
         if mis-kisisel-il(1:10) = spaces and mis-kisisel-il(11:1) <> spaces
               initialize mis-kisisel-il(11:1)
         end-if
 
         move musteri-e-mail           to mis-email        
         move musteri-web-adresi       to mis-web          
         move musteri-kart-tipi        to mis-kart-tipi 
         move musteri-kart-tipi-2      to mis-kart-tipi-2
         move musteri-gelis-sayisi     to mis-gelis-sayisi 
         move musteri-unvan1           to mis-unvan1       
         move musteri-unvan2           to mis-unvan2       
         move musteri-adres1           to mis-adres1       
         move musteri-adres2           to mis-adres2       
         move musteri-vdairesi         to mis-vdairesi     
         move musteri-vno              to mis-vno          
         move musteri-il               to mis-il           
         move musteri-ilce             to mis-ilce         
         move musteri-tel1             to mis-tel1         
         move musteri-tel2             to mis-tel2         
         move musteri-tel3             to mis-tel3         
         move musteri-gsm              to mis-gsm          
         move musteri-pk               to mis-pk           
         move musteri-fax              to mis-fax          
         move musteri-kis-adrs         to mis-kis-adrs
         move musteri-kis-adrs1        to mis-kis-adrs1
         move musteri-kaynak           to cb-kaynak(1:2)
         move musteri-aciklama         to mis-acik
*         move musteri-arac-model       to mis-araba
         move musteri-plaka            to mis-plaka  
         move musteri-odeme-tipi       to cb-odeme        
         move musteri-odeme-kart-tipi  to cb-kart-tipi-val
         move musteri-kart-sahibi      to kart-sahibi
         move musteri-kart-no          to kart-no
         move musteri-son-k-ay         to cb-ay-val
         move musteri-son-k-yil        to cb-yil-val
         move musteri-g-kodu           to guvenlik-kodu        
         move musteri-kim-tcno         to kim-tcno
         move musteri-adi              to kim-adi
         move musteri-soyadi           to kim-soy        
         move musteri-kim-uyruk        to kim-uyruk
         move musteri-kim-cinsiyet     to kim-cins
         move musteri-kim-medeni       to kim-medeni
         move musteri-kim-adrs         to kim-adres
         move musteri-kim-adrs1        to kim-adres1
         move musteri-b-turu           to kim-belge
         move musteri-seri-no          to kim-serino
         move musteri-baba-adi         to kim-baba
         move musteri-ana-adi          to kim-ana
         move musteri-d-yeri           to kim-dyeri
         move musteri-d-tarihi         to kim-d-tarih
         move musteri-kim-il           to kim-il
         move musteri-kim-ilce         to kim-ilce
         move musteri-kim-mahalle      to kim-mahalle
         move musteri-kim-cilt         to kim-cilt
         move musteri-kim-aile-no      to kim-aile
         move musteri-kim-sira-no      to kim-sirano
         move musteri-gizlilik         to cb-1313-val
         move musteri-g-tarih          to guncel-tarih
         move musteri-k-tarih          to kayit-tarih
         move musteri-fat-ulke         to mis-fat-ulke
         move musteri-muhasebe-kodu    to a-hesap-kodu
         move musteri-puan-kart-no     to kart-numarasi
         move musteri-kazanilan-puan   to toplam-puan
         move musteri-kullanilan-puan  to kullanilan-puan
         move musteri-gecmis-cl-tut    to acc-80-value             
         move musteri-gecmis-kalis-sayisi to acc-81-value
         move musteri-mail-durumu         to mail-durumu
         move musteri-staf-son         to mis-son-staf
         move musteri-staf-ilk         to mis-ilk-staf
         move musteri-personel-bilinci to personel-bilinci
         move musteri-kol-bandi        to bant-seri
         compute kalan-puan = musteri-kazanilan-puan - musteri-kullanilan-puan 
      end-read
      close musteri
      .
*
 kvkk-ekran-kontrol-1.
     if kim-d-tarih <> spaces 
        move all "*"          to kim-d-tarih
     end-if

     

     if mis-etarih <> spaces 
        move all "*"          to mis-etarih
     end-if

     if mis-otarih <> spaces 
        move all "*"          to mis-otarih
     end-if

     if mis-ulke <> spaces 
        move mis-ulke         to ymis-ulke
        move all "*"          to mis-ulke(3:)
     end-if


     

     if mis-dil <> spaces 
        move mis-dil          to ymis-dil
        move all "*"          to mis-dil(3:)
     end-if

     if mis-din <> spaces 
        move mis-din          to ymis-din
        move all "*"          to mis-din(3:)
     end-if

     if mis-title <> spaces 
        move mis-title        to ymis-title
        move all "*"          to mis-title(3:)
     end-if

     if mis-kisisel-ilce <> spaces 
        move mis-kisisel-ilce to ymis-kisisel-ilce
        move all "*"          to mis-kisisel-ilce(3:)
     end-if

     if mis-kisisel-il <> spaces 
        move mis-kisisel-il   to ymis-kisisel-il
        move all "*"          to mis-kisisel-il(3:)
     end-if

     if mis-email <> spaces 
        move mis-email        to ymis-email
        move all "*"          to mis-email(3:)
     end-if

     if mis-web <> spaces 
        move mis-web          to ymis-web
        move all "*"          to mis-web(3:)
     end-if

     if mis-unvan1 <> spaces 
        move mis-unvan1       to ymis-unvan1
        move all "*"          to mis-unvan1(3:)
     end-if

     if mis-unvan2 <> spaces 
        move mis-unvan2       to ymis-unvan2
        move all "*"          to mis-unvan2(3:)
     end-if

     if mis-adres1 <> spaces 
        move mis-adres1       to ymis-adres1
        move all "*"          to mis-adres1(3:)
     end-if

     if mis-adres2 <> spaces 
        move mis-adres2       to ymis-adres2
        move all "*"          to mis-adres2(3:)
     end-if

     if mis-vdairesi <> spaces 
        move mis-vdairesi     to ymis-vdairesi
        move all "*"          to mis-vdairesi(3:)
     end-if

     if mis-vno <> spaces 
        move mis-vno          to ymis-vno
        move all "*"          to mis-vno(3:)
     end-if

     if mis-il <> spaces 
        move mis-il           to ymis-il
        move all "*"          to mis-il(3:)
     end-if

     if mis-ilce <> spaces 
        move mis-ilce         to ymis-ilce
        move all "*"          to mis-ilce(3:)
     end-if

     if mis-tel1 <> spaces 
        move mis-tel1         to ymis-tel1
        move all "*"          to mis-tel1(3:)
     end-if

     if mis-tel2 <> spaces 
        move mis-tel2         to ymis-tel2
        move all "*"          to mis-tel2(3:)
     end-if

     if mis-tel3 <> spaces 
        move mis-tel3         to ymis-tel3
        move all "*"          to mis-tel3(3:)
     end-if

     if mis-gsm <> spaces 
        move mis-gsm          to ymis-gsm
        move all "*"          to mis-gsm(3:)
     end-if

     if mis-pk <> spaces 
        move mis-pk           to ymis-pk
        move all "*"          to mis-pk(3:)
     end-if

     if mis-fax <> spaces 
        move mis-fax          to ymis-fax
        move all "*"          to mis-fax(3:)
     end-if

     if mis-kis-adrs <> spaces 
        move mis-kis-adrs     to ymis-kis-adrs
        move all "*"          to mis-kis-adrs(3:)
     end-if

     if mis-kis-adrs1 <> spaces 
        move mis-kis-adrs1    to ymis-kis-adrs1
        move all "*"          to mis-kis-adrs1(3:)
     end-if

     if mis-acik <> spaces 
        move mis-acik         to ymis-acik
        move all "*"          to mis-acik(3:)
     end-if

*     if mis-araba <> spaces 
*        move mis-araba        to ymis-araba
*        move all "*"          to mis-araba(3:)
*     end-if

     if mis-plaka <> spaces 
        move mis-plaka        to ymis-plaka
        move all "*"          to mis-plaka(3:)
     end-if

     if kim-uyruk <> spaces 
        move kim-uyruk        to ykim-uyruk
        move all "*"          to kim-uyruk(3:)
     end-if

     if kim-cins <> spaces 
        move kim-cins         to ykim-cins
        move all "*"          to kim-cins(3:)
     end-if

     if kim-medeni <> spaces 
        move kim-medeni       to ykim-medeni
        move all "*"          to kim-medeni(3:)
     end-if

     if kim-adres <> spaces 
        move kim-adres        to ykim-adres
        move all "*"          to kim-adres(3:)
     end-if

     if kim-adres1 <> spaces 
        move kim-adres1       to ykim-adres1
        move all "*"          to kim-adres1(3:)
     end-if

     if kim-belge <> spaces 
        move kim-belge        to ykim-belge
        move all "*"          to kim-belge(3:)
     end-if

     if kim-serino <> spaces 
        move kim-serino       to ykim-serino
        move all "*"          to kim-serino(3:)
     end-if

     if kim-baba <> spaces 
        move kim-baba         to ykim-baba
        move all "*"          to kim-baba(3:)
     end-if

     if kim-ana <> spaces 
        move kim-ana          to ykim-ana
        move all "*"          to kim-ana(3:)
     end-if

     if kim-dyeri <> spaces 
        move kim-dyeri        to ykim-dyeri
        move all "*"          to kim-dyeri(3:)
     end-if

     if kim-il <> spaces 
        move kim-il           to ykim-il
        move all "*"          to kim-il(3:)
     end-if

     if kim-ilce <> spaces 
        move kim-ilce         to ykim-ilce
        move all "*"          to kim-ilce(3:)
     end-if

     if kim-mahalle <> spaces 
        move kim-mahalle      to ykim-mahalle
        move all "*"          to kim-mahalle(3:)
     end-if

     if kim-cilt <> spaces 
        move kim-cilt         to ykim-cilt
        move all "*"          to kim-cilt(3:)
     end-if

     if kim-aile <> spaces 
        move kim-aile         to ykim-aile
        move all "*"          to kim-aile(3:)
     end-if

     if kim-sirano <> spaces 
        move kim-sirano       to ykim-sirano
        move all "*"          to kim-sirano(3:)
     end-if
    .
*
 uyruk-ara.
    initialize uyruk-cagir
    call "/asya/ytl/obj/otel/uyrukara.asy" using uyruk-cagir
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/uyrukara.asy" 
    end-call
    move uyruk-kodu-cagir     to kim-uyruk
    display acc-kim-uyruk
    move 4 to accept-control
    move 126 to control-id.  
*
 ulke-ara.
     initialize ulke-cagir
     call "/asya/ytl/obj/otel/ulkeara.asy" using ulke-cagir
          on exception perform callerr-proc
          not on exception
     cancel "/asya/ytl/obj/otel/ulkeara.asy" 
     end-call
     move ulke-cagir     to mis-ulke
     display acc-mis-ulke
     move 4 to accept-control
     move 22 to control-id. 
*
 acc-mis-ulke-Aft-Procedure.
     perform ulke-oku.
*
 ulke-oku.
     open input ulke
     initialize ulke-rec
     move mis-ulke     to ulke-anah
     read ulke no lock invalid
          move "Tanimsiz....."     to lb-ulke-adi
     not invalid
         move ulke-adi             to lb-ulke-adi
     end-read
     close ulke
     display lb-ulke.
*
 acc-mis-kart-Aft-Procedure.
     perform kart-tipi-oku.    
*
 fis-al.
      open i-o genelfis
      move 1 to genelfis-anahtar
      read genelfis no lock invalid  
        initialize genelfis-rec
        move 1 to genelfis-anahtar
        add  1 to profile-oto
        move profile-oto to mis-no
        display acc-mis-no
        write genelfis-rec invalid
          rewrite genelfis-rec invalid continue
          end-rewrite 
        end-write
      not invalid
          add 1 to profile-oto
          move profile-oto to mis-no
          display acc-mis-no
          rewrite genelfis-rec end-rewrite
      end-read
      close genelfis.
*
 pazar-ara.
      initialize pazar-cagir
      move "E"   to pazar-tipi-cagir
      call "/asya/ytl/obj/otel/pazarara.asy" using pazar-cagir
           on exception perform callerr-proc
           not on exception
      cancel "/asya/ytl/obj/otel/pazarara.asy" 
      end-call
      move pazar-kodu-cagir     to mis-pazar
      display acc-mis-pazar
      move 4 to accept-control
      move 88 to control-id
      perform pazar-oku.
*
 pazar-oku.
      open input kodlar02
      initialize kodlar02-rec
      move "E"       to kodlar02-tipi
      move mis-pazar to kodlar02-kodu
      read kodlar02 no lock invalid
           move "Tanimsiz Pazar Kodu"   to lb-pazar-adi
      not invalid
          move kodlar02-adi      to lb-pazar-adi
      end-read
      close kodlar02
      display lb-pazar.

*
 kvk-tab-kontrol.
     modify cb-1313,enabled = true
     move 0 to vis-kvk vis-kvk2
     inquire Form1-Ta-1,value in tab-sira
     if tab-sira = 5 or tab-sira = 1
        if tab-sira = 1 
           move 1 to vis-kvk2
        end-if
        if tab-sira = 5
           move 1 to vis-kvk
        end-if
        open input kllnc 
        initialize kllnc-rec
        move k-kodu-tasi to k-kodu
        read kllnc no lock invalid
             continue
        end-read
        close kllnc
        if musteri-gizlilik = 0 and k-kvkk-bilgileri-gorebilir <> 1
           if tab-sira = 1 
              move 0 to vis-kvk2
           end-if
           if tab-sira = 5
              move 0 to vis-kvk
              modify cb-1313, enabled = false
           end-if
        end-if
     end-if.
*
 Form1-Ta-1-Ev-Cmd-Tabchanged.
       perform kvk-tab-kontrol
       .
*
 baslik-yukle.
     modify gd1,
            reset-grid = 1
     move "P.No"            to gd-1-col-1
     move "Adi"             to gd-1-col-2
     move "Soyadi"          to gd-1-col-3
     move "C/In Tarihi"     to gd-1-col-4
     move "C/Out Tarihi"    to gd-1-col-5
     MOVE "Otel"            to gd-1-col-6
     move "Sira"            to gd-1-col-7
     move "Rez NO"            to gd-1-col-8
     move "O.NO"            to gd-1-col-9
     move "D"               to gd-1-col-10
     move "Folio No"        to gd-1-col-11 
     move "Cari Tutar"       to gd-1-col-12  
     move "Tahsilat Tutar"   to gd-1-col-13
     move "Kaz.Puan"          to gd-1-col-14

     modify gd1,record-to-add(gd1-rec).
*
 konaklama-bilgisi.
        open input prohrk rez  tprohrk
        initialize prohrk-rec gd1-rec ger-sayi  tprohrk-rec  
                   cari-tutar tahsilat-tutar toplam-puan
        move 1                 to sayi
        move mis-no            to tprohrk-profil-no
        move mis-sirket        to tprohrk-profil-sirket
        start tprohrk key not < tprohrk-gel-anah invalid
              continue
        not invalid
        perform with test after until fs-tprohrk = "10"
        read tprohrk next no lock end move "10"   to fs-tprohrk
        not at end
               if tprohrk-profil-no <> mis-no or
                  tprohrk-profil-sirket <> mis-sirket
                     move "10"   to fs-tprohrk
                     exit perform
               end-if
********************************DIKKATTTTTTTT PUANHES.CPY PROGRAMINDAKI COUT YILDIZI KALDIRICALACAK UNUTMAAAAA       
               move tprohrk-anah to prohrk-anah
               read prohrk no lock invalid 
                    stop " " 
               end-read

               initialize gd1-rec
               add 1                        to sayi   
               move prohrk-profil-no        to gd-1-col-1
               move prohrk-pro-adi          to gd-1-col-2
               move prohrk-pro-soyadi       to gd-1-col-3
               move prohrk-gel-gun          to gd-1-col-4(1:2)
               move "/"                     to gd-1-col-4(3:1)
               move prohrk-gel-ay           to gd-1-col-4(4:2)
               move "/"                     to gd-1-col-4(6:1)
               move prohrk-gel-yil          to gd-1-col-4(7:4)
               move prohrk-git-gun          to gd-1-col-5(1:2)
               move "/"                     to gd-1-col-5(3:1)
               move prohrk-git-ay           to gd-1-col-5(4:2)
               move "/"                     to gd-1-col-5(6:1)
               move prohrk-git-yil          to gd-1-col-5(7:4)
               move prohrk-rez-sirket       to gd-1-col-6
               move prohrk-rez-sira         to gd-1-col-7
               move prohrk-rez-no           to gd-1-col-8
               move prohrk-odano            to gd-1-col-9
               move prohrk-rez-durumu       to gd-1-col-10

               move prohrk-r-folio          to gd-1-col-11
              

               move prohrk-t-oda-fiyati     to z-1
               move z-1                     to gd-1-col-12

               move prohrk-t-ext-fiyati     to z-1
               move z-1                     to gd-1-col-13
         
               move prohrk-puan  to z-puan 
               move z-puan       to   gd-1-col-14
               modify gd1, RECORD-TO-ADD(gd1-rec)
               compute cari-tutar = cari-tutar + prohrk-t-oda-fiyati
               compute tahsilat-tutar = tahsilat-tutar + prohrk-t-ext-fiyati

               if prohrk-rez-durumu = "S"
                  modify gd1(sayi),row-color = 177 
               else
                  add 1                     to ger-sayi
               end-if
               COMPUTE toplam-puan = toplam-puan + prohrk-puan
               compute kalan-puan  = toplam-puan - kullanilan-puan
        end-read
        end-perform
        end-start
        close prohrk rez  tprohrk
        initialize gd1-rec 
        move "Toplam->"                    to gd-1-col-1
        move ger-sayi                      to z-gercek
        move z-gercek                      to gd-1-col-2
        move cari-tutar                    to z-1
        move z-1                           to gd-1-col-12

        move tahsilat-tutar                to z-1
        move z-1                           to gd-1-col-13

        modify gd1(sayi + 1),
               row-color = 480
        modify gd1,
               record-to-add(gd1-rec)
        move ger-sayi                       to musteri-gelis-sayisi  
                                               mis-gelis-sayisi
        display acc-mis-gel  acc-toplam-puan acc-kalan-puan
        modify gd1, mass-update = 0
         .
*
*
 sirket-bilgisi.
      
      open i-o genelfis
      move 1 to genelfis-anahtar
      read genelfis no lock invalid  
        continue
      not invalid
          add 1 to ekran-fis-1
          move ekran-fis-1 (2:3) to takasgrup-dno takastek-dno
          rewrite genelfis-rec end-rewrite
      end-read
      close genelfis.
        open output takasgrup takastek

        close takasgrup takastek

        open i-o  takasgrup takastek


        open input rez kodlar02 gelist cast konuk firma  takvim kur acenta
        initialize rez-rec gd2-rec firma-rec aranan-firma
        start firma key not < firma-kodu invalid
              continue
        not invalid
        perform with test after until fs-firma = "10"
        read firma next no lock end move "10"   to fs-firma
          not at end           
*               if firma-profil-anah  =  m-profil  |firat m-profil bos gorunuyor.. 17/08/2020
               if firma-profil-sirket = musteri-sirket and
                  firma-profil-no = musteri-no 
                  move firma-kodu to aranan-firma
                  move 1 to firma-ara
                  perform dondur-gel
                 
               end-if
         end-read
         end-perform 
         end-start.
          start acenta key not < acenta-kodu invalid
              continue
        not invalid
        perform with test after until fs-acenta = "10"
        read acenta next no lock end move "10"   to fs-acenta
        not at end
        
*               if acenta-profil-anah  =  m-profil         |firat m-profil bos gorunuyor.. 17/08/2020
               if acenta-profil-sirket = musteri-sirket and
                  acenta-profil-no = musteri-no
                 move acenta-kodu to aranan-acenta
                 move 2 to firma-ara
                 perform dondur-gel
                 
               end-if
         end-read
         end-perform 
         end-start.
          PERFORM sir-doldur
           compute top-odaort rounded =  top-odatop /top-odageceleme  
          compute top-paxort rounded =  top-odatop /top-paxgeceleme  
          

          move   top-odatop        to   z-odatop        move  z-odatop       to e-odatop              
          move   top-extratop      to   z-extratop      move  z-extratop     to e-extratop                                             
          move   top-odageceleme   to   z-odageceleme   move  z-odageceleme  to e-odageceleme              
          move   top-paxgeceleme   to   z-paxgeceleme   move  z-paxgeceleme  to e-paxgeceleme
          move   top-odaort        to   z-odaort        move  z-odaort       to e-odaort                   
          move   top-paxort        to   z-paxort        move  z-paxort       to e-paxort      
          move   top-odasay        to   z-odasay        move  z-odasay       to e-odasay      
                          
                                                                                                                                                  
            
         display        a-extragelir        
         display        a-odagelir   
         display        a-paxgece   
         display        a-odagece          
         display        a-paxort a-odaort   a-odasay                
        close takasgrup takastek.
        close rez gelist konuk kodlar02 cast firma takvim kur acenta.
         
        
*

 gd2-Ev-Msg-Begin-Entry.
     
      inquire gd2   x in i y in ii
      inquire gd2(ii,1) hidden-data in hidden1
      initialize takastek-rec
      move function numval(hidden1) to  takastek-grup-no
        
      if takastek-grup-no > 0
          modify gd2 mass-update = 1   
      open input takastek
       inquire gd2(ii,3) hidden-data in hidden3
       if function numval(hidden3) > 0 then 
           initialize hidden3
          modify gd2(ii,3) hidden-data = hidden3
         inquire gd2   last-row = son-satir
         compute iii = ii + 1
         perform varying k from iii  by 1 until k > son-satir
              inquire gd2(iii,4) hidden-data in hidden4 
              if  function numval(hidden4) =   takastek-grup-no
                 modify gd2, record-to-delete(iii)

                else 
                exit perform 

               end-if
         end-perform 

       else
        modify gd2(ii,3) hidden-data = 1
        start takastek key =  takastek-grup-no
          invalid display message box " " 
          not invalid 
           perform until fs-takastek = "10"
              read takastek next no lock end move "10" to fs-takastek
                not end
                 if   function numval(hidden1) not =  takastek-grup-no

                   move "10" to fs-takastek
                   else
                   add 1 to ii
                  modify gd2 insertion-index = ii
                       initialize gd2-rec
               add 1 to sayi   
               move takastek-odano        to gd-2-col-1
              
               move takastek-adi           to gd-2-col-2
               move takastek-pax           to z-pax       move z-pax    to gd-2-col-3
               move takastek-odasay        to z-odasay    move z-odasay to gd-2-col-4
               move takastek-odatop        to z-tutar     move z-tutar  to gd-2-col-5
               move takastek-extratop      to z-tutar     move z-tutar  to gd-2-col-6
               COMPUTE GUNLUK-ODA rounded = takastek-odatop / takastek-odageceleme
               COMPUTE GUNLUK-pax rounded = takastek-odatop / takastek-paxgeceleme
               move gunluk-oda to z-gunluk             
               move z-gunluk to gd-2-col-7
               move gunluk-pax to z-gunluk              
               move z-gunluk               to gd-2-col-8
               move takastek-odageceleme to z-gece    
               move z-gece  to gd-2-col-11
               move takastek-paxgeceleme to z-gece   
               move z-gece             to  gd-2-col-12
               move takastek-cin-gun  to e-gun
               move takastek-cin-ay   to e-ay
               move takastek-cin-yil  to e-yil
               move e-tarih               to          gd-2-col-9
               move takastek-cout-gun  to e-gun
               move takastek-cout-ay   to e-ay                                                         
               move takastek-cout-yil  to e-yil                 
               move e-tarih              to  gd-2-col-10                      
               modify gd2, RECORD-TO-ADD(gd2-rec)
               modify gd2(ii,2)  hidden-data =  takastek-rezno 
                modify gd2(ii,4) hidden-data = takastek-grup-no
                 end-if
               end-read
           end-perform
         
           end-start
           end-if
             close takastek
             modify gd2 mass-update = 0  
         else

              inquire gd2(ii,2) hidden-data in hidden2

              move function numval(hidden2) to  rez-no
                 
              if i >= 7 then
                open input rez
                  read rez no lock invalid
                   continue
                 end-read
                 close rez
             
                  initialize dokcagir-tasi
                    set dokcagir-tasi-call-folio1      to true
                     move rez-folio to  dokcagir-konuk-folio
                    perform dokcagir-call
                    
              else
             
              set dokcagir-tasi-call-rez1     to true
              move rez-no                     to dokcagir-rez-no
               perform dokcagir-call
              end-if
      end-if
      move event-action-fail    to event-action.
*
 dokcagir-call.
     call "/asya/ytl/obj/otel/dokcagir.asy" using dokcagir-tasi
          on exception 
             perform callerr-proc
          not on exception
             cancel "/asya/ytl/obj/otel/dokcagir.asy"
     end-call.

*
 sir-doldur.
    
        initialize  gd2-rec  toplamlar
        move 1 to sayi
        modify gd2,
            reset-grid = 1 mass-update =1
     move "Oda No"         to gd-2-col-1
     move "Adi"            to gd-2-col-2
     move "Pax"            to gd-2-col-3
     move "Oda S"          to gd-2-col-4
     move "Oda Gelir"      to gd-2-col-5
     MOVE "Extra Gelir"    to gd-2-col-6
     MOVE "Oda + Extra"    to gd-2-col-77
     move "OdaOrt"         to gd-2-col-7
     move "PaxOrt"         to gd-2-col-8
     move "Giris Tar"      to gd-2-col-9
     move "Cikis Tar"      to gd-2-col-10
     move "OdaGc"          to gd-2-col-11
     move "PaxGc"          to gd-2-col-12
     modify gd2,record-to-add(gd2-rec).
     initialize takasgrup-rec
        start takasgrup key  > takasgrup-cintar invalid
              continue
        not invalid
        perform with test after until fs-takasgrup = "10"
        read takasgrup next no lock end move "10"   to fs-takasgrup
        not at end
                            
               initialize gd2-rec
               add 1 to sayi   
               move takasgrup-odano        to gd-2-col-1
               if takasgrup-no > 0 then 
                 initialize gd-2-col-1
              end-if
               move takasgrup-adi           to gd-2-col-2
               move takasgrup-pax           to z-pax       move z-pax    to gd-2-col-3
               move takasgrup-odasay        to z-odasay    move z-odasay to gd-2-col-4
               move takasgrup-odatop        to z-tutar     move z-tutar  to gd-2-col-5
               move takasgrup-extratop      to z-tutar     move z-tutar  to gd-2-col-6
               compute takas-oda-extra-toplam = takasgrup-odatop + takasgrup-extratop
               add  takas-oda-extra-toplam        to top-topitop
               move takas-oda-extra-toplam        to z-topitop
               move z-topitop                     to gd-2-col-77
               COMPUTE GUNLUK-ODA rounded = takasgrup-odatop / takasgrup-odageceleme
               COMPUTE GUNLUK-pax rounded = takasgrup-odatop / takasgrup-paxgeceleme
               move gunluk-oda to z-gunluk             
               move z-gunluk to gd-2-col-7
               move gunluk-pax to z-gunluk              
               move z-gunluk               to gd-2-col-8
               move takasgrup-odageceleme to z-gece    
               move z-gece  to gd-2-col-11
               move takasgrup-paxgeceleme to z-gece   
               move z-gece             to  gd-2-col-12
               move takasgrup-cin-gun  to e-gun
               move takasgrup-cin-ay   to e-ay
               move takasgrup-cin-yil  to e-yil
               move e-tarih               to          gd-2-col-9
               move takasgrup-cout-gun  to e-gun
               move takasgrup-cout-ay   to e-ay                                                         
               move takasgrup-cout-yil  to e-yil                 
               move e-tarih              to  gd-2-col-10                      
                   
               
                 add takasgrup-odatop        to  top-odatop                
                 add takasgrup-extratop      to  top-extratop              
                 add takasgrup-odageceleme   to  top-odageceleme         
                 add takasgrup-paxgeceleme   to  top-paxgeceleme         
                 
                 add takasgrup-odasay        to  top-odasay              
                                                 
               modify gd2, RECORD-TO-ADD(gd2-rec)                        
               if takasgrup-no > 0 then                                  
                  modify gd2(sayi,1),row-color = 208 hidden-data =  takasgrup-no  
               else
                  modify gd2(sayi,2) hidden-data = takasgrup-rezno                                       
               end-if
               
        end-read
        end-perform
        end-start             
        modify gd2, mass-update = 0 
         .
*
 dondur-gel.
         
        initialize rez-rec
        move "I" to rez-durumu
        if  firma-ara = 2 then 
            move aranan-acenta to rez-acenta
        end-if
        start rez key not < rez-acen invalid
              continue
        not invalid
        perform with test after until fs-rez = "10"
        read rez next no lock 
           end move "10"   to fs-rez
        not at end
       
               if rez-durumu  not = "I" then 
                    exit perform 
               end-if
         
                 if  firma-ara = 2 then 
                   if aranan-acenta not =  rez-acenta
                       exit perform 
                  end-if
                end-if
                if firma-ara = 1 
                  if rez-firma not = aranan-firma 
                      exit perform cycle
                  end-if
               end-if
               if rez-gir-tar >= tarih-tasi
                   exit perform cycle 
               end-if 
               initialize konuk-rec
               move rez-folio        to konuk-folio
               read konuk no lock invalid
                     continue 
               end-read 
                   if konuk-durumu = "I"
                       exit perform cycle 
                   end-if
               initialize kodlar02-rec
               move rez-odeme-tipi    to kodlar02-kodu
               move "B"          to kodlar02-tipi
               read kodlar02 no lock invalid
                    continue 
               not invalid 
                    if ode-tipi not = "B" and 
                       pesin-gosterme = 1
                        exit perform cycle 
                    end-if 
               end-read 

               add 1 to sayi 
               initialize takasgrup-rec takastek-rec
               move rez-no to takastek-no
               if rez-grup-no = 0 then
                  move rez-no to takasgrup-rezno
               end-if
               move rez-grup-no to takasgrup-no  takastek-grup-no
                 read takasgrup no lock invalid
                     move rez-gir-tar     to takasgrup-cintar 
               
                  move rez-cik-tar     to takasgrup-couttar 
                 end-read
               move rez-odano to takastek-odano   takasgrup-odano

               string rez-adi delimited by "  "
                      " " delimited by size
                      rez-soyadi delimited by size
                      into takastek-adi
              
                if rez-grup-no = 0 then
                  move takastek-adi to takasgrup-adi
                   move rez-no to takastek-rezno
                   ELSE
                    move rez-grup-adi to takasgrup-adi
               end-if
               add rez-buyuk to takasgrup-pax
               move rez-buyuk  to takastek-pax
             
              
               
               perform gece-bul
                add 1 to takasgrup-odasay
                 add oda-geceleme to takasgrup-odageceleme takastek-odageceleme
                 add pax-geceleme to takasgrup-paxgeceleme takastek-paxgeceleme

               if rez-durumu = "I"
                 perform gelir-bul
                 add gelir-extra to takasgrup-extratop   takastek-extratop 
                 add gelir-oda   to takasgrup-odatop     takastek-odatop
               else
                 move 1 to   takasgrup-sil    takastek-sil
               end-if
          
               move rez-gir-tar     to   takastek-cintar
               if rez-gir-tar < takastek-cintar then
                  move rez-gir-tar     to takasgrup-cintar 
               end-if
                if rez-cik-tar > takastek-couttar then
                  move rez-cik-tar     to takasgrup-couttar 
               end-if
               move rez-cik-tar        to   takastek-couttar
               move rez-no             to takastek-rezno
               write takasgrup-rec invalid rewrite takasgrup-rec
               end-write
               write takastek-rec invalid rewrite takastek-rec
               end-write

               
               
               
        end-read
        end-perform
        end-start
         
         .
*
 gece-bul.
     initialize  oda-geceleme pax-geceleme
     if rez-cik-tar > tarih-tasi then 
                move rez-gir-tar to kur-tarih
                if rez-gir-tar > tarih-tasi
                   move tarih-tasi to kur-tarih
                end-if
                move rez-doviz to kur-doviz
                read kur no lock invalid
                   move 1 to rez-kuru
                   not invalid
                   move doviz-alis to rez-kuru
                end-read
     end-if
  
               if rez-durumu = "I"
    move rez-gir-tar to takvim-anah
    start takvim key >= takvim-anah invalid
       continue
       not invalid
       perform until fs-takvim = "10"
           read takvim next no lock end move   "10" to fs-takvim
              not end 
               if rez-cik-tar > takvim-anah then 
                  add 1 to oda-geceleme
                  move takvim-anah to cast-tarih 
                  MOVE REZ-NO TO CAST-REZ-NO
                  read cast no lock invalid
                    continue
                    not invalid
                    add cast-buyuk to  pax-geceleme
                     if takvim-anah >= tarih-tasi then 
                        compute gelir-oda  rounded = gelir-oda + cast-anlasma-fiyati * rez-kuru
                     end-if
                  end-read
                  else move "10" to fs-takvim
               end-if
             
          end-read
       end-perform
    end-start
     end-if
       .
    

*
  gelir-bul.
     initialize gelist-rec gelir-oda gelir-extra
     move rez-folio to gelist-folio
     start gelist key = gelist-folio  invalid continue
        not invalid
          perform until fs-gelist = "10"
             read gelist next no lock 
               end move "10" to fs-gelist
               not end 
                 if gelist-folio not  = rez-folio
                      move "10" to fs-gelist
                 else
                       
                      add gelist-oda to gelir-oda
                      add gelist-yiy to gelir-extra
                      add gelist-ice to gelir-extra
                      add gelist-dig to gelir-extra
                 end-if
               end-read
          end-perform
     end-start.

*
 Form1-Ta-1-Aft-Tabchg-Display.
           if event-data-1 not =  5 
              modify l-ok, VISIBLE = false
              modify l-hata, VISIBLE = false
           end-if
           if event-data-1 = 5
                     if genel-profil-kolbandi-aktif not = 1
                        modify acc-bant-seri, VISIBLE = false
                        modify lb-1301, VISIBLE = false
                        modify cb-1301, VISIBLE = false
                     end-if
              perform xmlkontrol
              move 4 to accept-control
              move 1 to control-id 
           end-if
           perform baslik-yukle
           if event-data-1  =  6 
              perform konaklama-bilgisi
           end-if.
           if event-data-1  =  7 
              perform sirket-bilgisi
           end-if
           if event-data-1  = 8 
              perform anket-grid-doldur
           end-if.
*
 acc-kim-uyruk-Aft-Procedure.
      perform uyruk-oku.
*
 uyruk-oku.
      open input uyruk
      initialize uyruk-rec
      move kim-uyruk      to uyruk-anah
      read uyruk no lock invalid
           move "Tanimsiz Uyruk Adi..."     to acc-lb-uyruk
      not invalid
          move uyruk-adi          to acc-lb-uyruk
      end-read
      close uyruk
      display lb-uyruk     
     .

*
 st-rf.    
     destroy Form1-St-1-Handle
     DISPLAY STATUS-BAR
     PANEL-WIDTHS (15, 100), 
     PANEL-STYLE (1, 1), 
     PANEL-TEXT ("F2->Kaydet,F3->Sil", hata-ack), 
     GRIP, 
     HANDLE IS Form1-St-1-Handle.
*
  xmlkontrol.
    if control-id = 114 and bant-seri <> spaces
       modify cb-1301, value = 0
    end-if         
    initialize polisxml-prb polisxml-prb-ack
    move "Kayit Gonderime uygun" to 
                hata-ack polisxml-prb-ack
    perform 
    perform ortak-kontrol
    if polisxml-prb  = 1 then 
       exit perform 
    end-if
    perform uyruk-kontroly
    if polisxml-prb  = 1 then 
       exit perform 
    end-if
    if kim-tcno > 0
       perform tcno-kontrol
       if tc-dogru = 1 or 2 
          move 0  to polisxml-prb
       else
          move 1  to polisxml-prb
          move "Tc Kimlik No Hatali"      to polisxml-prb-ack
          exit perform 
       end-if 
    end-if 


    if kim-uyruk  = "TC   " then 
          perform turk-kont
       else
         if kim-tcno not = spaces and  
            kim-tcno not = zeroes then
              move 1 to polisxml-prb
              move "Yabanci Misafir icin Vatandaslik No girilemez" to polisxml-prb-ack
              exit perform
         end-if 
    end-if
    end-perform
    move polisxml-prb-ack to hata-ack
    
    if polisxml-prb  = 1 then
       perform kimlik-hata 
    else
       if genel-profil-kolbandi-aktif = 0
          perform kimlik-ok
       else
          if bant-seri <> spaces
             perform kimlik-ok
          else
             if personel-bilinci = 0
                perform kimlik-hata
             else
                perform kimlik-ok
             end-if
          end-if
       end-if
    end-if.
    display l-hata l-ok 
    perform st-rf.
*
 kimlik-ok.
    move 1 to vis-ok
    move 0 to vis-hata.
*
 kimlik-hata.
    move 1 to vis-hata
    move 0 to vis-ok.
*
 turk-kont. 
    perform 
    if kim-tcno = spaces or  
       kim-tcno = zeroes or
       kim-tcno  < 
       0010000000
       move 1 to polisxml-prb
       move "Turk Musteriler icin TC Kimlik No giriniz" 
       to polisxml-prb-ack
       exit perform
     end-if 
     if kim-baba = spaces then
       move 1 to polisxml-prb
       move "Turk Musteriler icin Baba adi giriniz" 
       to polisxml-prb-ack
       exit perform
     end-if
     if kim-ana = spaces then
       move 1 to polisxml-prb
       move "Turk Musteriler icin Ana adi giriniz" 
       to polisxml-prb-ack
       exit perform
     end-if
    
     
     if kim-il = spaces then
       move 1 to polisxml-prb
       move "Nufusa kayitli oldugu Il giriniz" 
       to polisxml-prb-ack
       exit perform
     end-if
     if kim-ilce = spaces then
       move 1 to polisxml-prb
       move "Nufusa kayitli oldugu Ilce giriniz" 
       to polisxml-prb-ack
       exit perform
     end-if
     end-perform. 
*
 uyruk-kontroly.
    open input uyruk.
    move kim-uyruk to uyruk-kodu
    read uyruk no lock invalid
           move 1 to polisxml-prb
           move "Uyruk Kodu Gecersiz" to 
             polisxml-prb-ack acc-lb-uyruk
         not invalid 
            move uyruk-adi to acc-lb-uyruk
    end-read
    display lb-uyruk
    close uyruk.
*
 tcno-kontrol.
    initialize tc-parcala ilk-hesap tc-dogru ikinci-hesap sonuc kalan
    move kim-tcno(1:1)    to bir
    move kim-tcno(3:1)    to uc
    move kim-tcno(5:1)    to bes
    move kim-tcno(7:1)    to yedi
    move kim-tcno(9:1)    to dokuz

    compute ilk-hesap = (bir + uc + bes + yedi + dokuz ) * 7

    move kim-tcno(2:1)    to iki
    move kim-tcno(4:1)    to dort
    move kim-tcno(6:1)    to alti
    move kim-tcno(8:1)    to sekiz
    move kim-tcno(10:1)   to onn
    move kim-tcno(11:1)   to onbir

    compute ikinci-hesap = iki + dort + alti + sekiz 

    compute sonuc = ilk-hesap - ikinci-hesap

///    divide 10 into sonuc remainder kalan 

    move function mod(sonuc,10) to kalan
          
    if kalan = onn
        move 1       to tc-dogru
    end-if 
     
    if tc-dogru = 1
       compute ilk-hesap = bir + iki + uc + dort + bes + alti + yedi + sekiz + dokuz + onn
       
///       divide 10 into ilk-hesap remainder kalan 
        move function mod(ilk-hesap,10) to kalan
       if kalan = onbir
           move 2       to tc-dogru
       end-if 
    end-if.
*
 ortak-kontrol.
     perform 
     if kim-adi = spaces then
        move 1 to polisxml-prb
        move "Misafir adi zorunlu alan" to polisxml-prb-ack
        exit perform
      end-if 
      if kim-soy = spaces then
        move 1 to polisxml-prb
        move "Misafir soyadi zorunlu alan" to polisxml-prb-ack
        exit perform
      end-if
      if kim-d-gun > 31 or kim-d-gun < 1 or
         kim-d-ay > 12 or kim-d-ay < 1  or
         kim-d-yil > yil-tasi or kim-d-yil < 1900      
          then
        move 1 to polisxml-prb
        move "Gecerli bir dogum tarihi giriniz" 
        to polisxml-prb-ack
        exit perform
      end-if
      if kim-serino = spaces 
      or kim-serino = zeroes then
        move 1 to polisxml-prb
        move "Lutfen Kimlik Seri No Giriniz" 
        to polisxml-prb-ack
        exit perform
      end-if
      if kim-adres = spaces then
        move 1 to polisxml-prb
        move "Misafir adresi eksik" to polisxml-prb-ack
        exit perform
      end-if
      if kim-dyeri = spaces
        move 1 to polisxml-prb
        move "Misafir dogum yeri eksik" to polisxml-prb-ack
        exit perform        
      end-if 
      end-perform.
*
 hesap-ara.
      initialize hesapara-link
      move muha-sirketi  to hesapara-isyeri
      move genel-muha-uzak-ip to hesapara-ip-no
      call "/asya/ytl/obj/otel/hesapara.asy" using hesapara-link
             on exception 
                perform callerr-proc
             not on exception
                if hesapara-hesap <> spaces 
                   move hesapara-hesap  to a-hesap-kodu 
                   display acc-hesap-kodu
                end-if
             cancel "/asya/ytl/obj/otel/hesapara.asy"
             perform hesap-oku
      end-call. 
*
 acuserve-adres-aktar.
    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres                                 
                         REFERANS-DOSYA-adres     
                         mgenel-DOSYA-adres
                         muh-kodlar-dosya-adres
                                                                  

    move all low-values to muh-kodlar-acuserve-dosya
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA  
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                 delimited by low-values
           into mgenel-acuserve-dosya.
  
    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string muh-kodlar-acuserve-dosya,
           ip-no                        delimited by low-values
           muh-kodlar-dosya                 delimited by low-values
           into muh-kodlar-acuserve-dosya.

    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.    
    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect muh-kodlar-acuserve-dosya      replacing  all spaces by low-values
    . 
*
 hesap-oku.
    
    if  hesap-dosya-adres not = spaces
    open input hesap 
    initialize hesap-kodu
    move a-hesap-kodu      to hesap-kodu
    read hesap no lock invalid
         move "Tanimsiz Hesap Adi...."     to a-cari-adi
    not invalid
         move hesap-adi                    to a-cari-adi
    end-read
    close hesap
    display acc-cari-adi
    end-if
    .
*
 acc-hesap-kodu-Aft-Procedure.
     perform hesap-oku.
     
     .
*
 rezervasyon-formu-ekle-1.
    move "Resim Dosyalari (*.jpg)|*.jpg" to 
          opnsav-filters
    call "c$opensavebox" using opensave-open-box,
                               opensave-data,
                         giving opensave-return.
    if opensave-return > 0
       perform resim-upload-1
    end-if.
*
 resim-upload-1.
    move low-values           to komut1 komut2 rename-dosya
    inspect opnsav-filename 
            replacing trailing spaces by low-values
    inspect opnsav-basename 
            replacing trailing spaces by low-values
    inspect opnsav-basename,
            replacing all spaces by "_"
    if is-remote
        string komut1,
              "@[DISPLAY]:"      delimited by low-values,
              opnsav-filename    delimited by low-values,
              into komut1

        string rename-dosya,
               mis-no    delimited by low-values
               "-"       delimited by low-values
               resim-no  delimited by low-values 
               ".jpg"    delimited by low-values 
        into rename-dosya        

        CALL "RENAME" using opnsav-basename rename-dosya

        string komut2,
              base-dir           delimited by low-values
              rename-dosya       delimited by low-values
              into komut2
    else
        string komut1,
               opnsav-filename delimited by low-values
        into komut1
        string rename-dosya,
               mis-no   delimited by low-values 
               "-"      delimited by low-values
               resim-no      delimited by low-values 
               ".jpg"            delimited by low-values 
        into rename-dosya        

        CALL "RENAME" using opnsav-basename rename-dosya
        string komut2,
               base-dir        delimited by low-values
               rename-dosya    delimited by low-values
        into komut2
    end-if.
    call "c$copy" using komut1
                        komut2
                  giving copy-status.
*    move rename-dosya               to resim-rez-form 
*    display acc-rez-form
    if copy-status <> 0
       display message box 
               opnsav-filename, " dosyasi",x"0a0d",
               base-dir," klasorune kopyalanamadi ..."
               icon mb_error_icon
               title "Hata"
    end-if.
     
     .
*
 rezervasyon-resim-goruntule-1.
    move low-values to opnsav-filename



    string opnsav-filename
           mis-no delimited by low-values
           "-"      delimited by low-values
           resim-no      delimited by low-values 
           ".jpg"  delimited by low-values
    into opnsav-filename

    if is-remote
        move low-values           to komut2 local-file
        string local-file,
              "@[DISPLAY]:"    delimited by low-values
               local-folder    delimited by low-values
               opnsav-filename delimited by low-values
        into local-file

        string komut2,
               base-dir           delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2

    else
        move low-values           to komut2 local-file
        string local-file,
               local-folder       delimited by low-values
               opnsav-filename    delimited by low-values
        into local-file

        string komut2,
               base-dir           delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2
    end-if.

    call "c$copy" using komut2|kopyaloanýyorrr...
                        local-file
                  giving copy-status.
    if copy-status <> 0
        display message box "Goruntulenecek Profil Resmi Bulunamadi..."
                        title "[ Uyari ]"
                        icon 1
    end-if
    if copy-status = 0
       move 1 to resim-bulundu
       if resim-bulundu = 1
          perform resim-teklif-1
       end-if
    end-if.
*
 resim-teklif-1.
       if is-remote 
          set shell32-dll-uzak to true
          set shell-execute-uzak to true
       else
          set shell32-dll-yerel to true
          set shell-execute-yerel to true
       end-if
       call shell32-dll on exception 
            display message box
                   "shell32.dll dosyasi bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiðiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            exit paragraph.
       if is-remote
          move local-file(12:)   to local-file(1:)
       end-if
       inspect local-file replacing trailing spaces by low-values
       inspect local-file replacing all "/"  by "\"

       call shell-execute using by value 0,
                                by reference ac-komut
                                by reference local-file,
                                null
                                null
                                by value SW_SHOW
        on exception
            display message box
                   "ShellExecute Proseduru bulunamiyor ....",x"0a0d",
                   "Excel dosyaniz otomatik olarak acilmayacaktir",x"0a0d",
                   "Kaydettiðiniz dosyaya cift tiklayarak acabilirsiniz ... !"
                   icon mb_error_icon 
                   title "Hata"
            cancel shell32-dll
            exit paragraph
       end-call.
       cancel shell-execute.
       cancel shell32-dll.
*
 resim-var-yok-kontrol-1.
    move low-values to opnsav-filename

    string opnsav-filename
           mis-no delimited by low-values
           "-"    delimited by low-values 
           resim-no    delimited by low-values 
           ".jpg"  delimited by low-values
    into opnsav-filename

    if is-remote
        move low-values           to komut2 local-file
        string local-file,
              "@[DISPLAY]:"    delimited by low-values
               local-folder    delimited by low-values
               opnsav-filename delimited by low-values
        into local-file

        string komut2,
               base-dir           delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2

    else
        move low-values           to komut2 local-file
        string local-file,
               local-folder       delimited by low-values
               opnsav-filename    delimited by low-values
        into local-file

        string komut2,
               base-dir           delimited by low-values
               opnsav-filename    delimited by low-values
        into komut2
    end-if.

    call "c$copy" using komut2|kopyaloanýyorrr...
                        local-file
                  giving copy-status.
    if copy-status = 0
       initialize foto-rec
       modify gd-foto(i+ 1,2),cell-data(opnsav-filename) 
    end-if.
*
 tarayici-gonder-1.
    initialize tarayici-cagir
    move link-tarayici                      to tarayici-cagir-dosya
    call "/asya/ytl/obj/otel/scanner.asy" using tarayici-cagir
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/scanner.asy" 
    end-call

    
      .
*
 gd-foto-Ev-Msg-Bitmap-Clicked.
     evaluate event-data-1
     when 4
        if event-data-2 = 2
           move 1                 to resim-no
           perform rezervasyon-formu-ekle-1
           modify gd-foto(2,2), CELL-DATA(rename-dosya)
        end-if
        if event-data-2 = 3
           move 2                 to resim-no
           perform rezervasyon-formu-ekle-1
           modify gd-foto(3,2), CELL-DATA(rename-dosya)
        end-if
        if event-data-2 = 4
           move 3                 to resim-no
           perform rezervasyon-formu-ekle-1
           modify gd-foto(4,2), CELL-DATA(rename-dosya)
        end-if
     when 5
        if event-data-2 = 2
           move 1                 to resim-no
           perform rezervasyon-resim-goruntule-1
        end-if
        if event-data-2 = 3
           move 2                 to resim-no
           perform rezervasyon-resim-goruntule-1
        end-if
        if event-data-2 = 4
           move 3                 to resim-no
           perform rezervasyon-resim-goruntule-1
        end-if

     when 3
        if event-data-2 = 2
            move low-values to link-tarayici
        
            string link-tarayici
                   mis-no delimited by low-values
                   "-"    delimited by low-values 
                   "1"    delimited by low-values 
            into link-tarayici
           
           perform tarayici-gonder-1
           modify gd-foto(2,2), CELL-DATA(link-tarayici)
        end-if




        if event-data-2 = 3
            move low-values to link-tarayici
        
            string link-tarayici
                   mis-no delimited by low-values
                   "-"    delimited by low-values 
                   "2"    delimited by low-values 
            into link-tarayici
           perform tarayici-gonder-1
           modify gd-foto(3,2), CELL-DATA(link-tarayici)
        end-if
        if event-data-2 = 4
            move low-values to link-tarayici
        
            string link-tarayici
                   mis-no delimited by low-values
                   "-"    delimited by low-values 
                   "3"    delimited by low-values 
            into link-tarayici

           perform tarayici-gonder-1
           modify gd-foto(4,2), CELL-DATA(link-tarayici)
        end-if         
     end-evaluate
     
     .
*
 Form1-Pb-2-Aft-Procedure.
    if  a-hesap-kodu not = spaces
    open input cari 
    open input muh-kodlar
    initialize cari-kodu
    move a-hesap-kodu      to cari-kodu
    read cari no lock invalid
         display message box "Cari karti Bulunamadi"
    not invalid
      initialize muh-kodlar-rec
      move cari-kodu to muh-kodlar-kodu1
      set muh-kodlar-tipi-cari to true 
      read muh-kodlar no lock invalid
         continue 
      end-read 


      move c-unvan-1      to musteri-unvan1  mis-unvan1
      move c-unvan-2      to musteri-unvan2  mis-unvan2
      move c-adres-1      to musteri-adres1  mis-adres1
      move c-adres-2      to musteri-adres2  mis-adres2
      move c-il-ilce      to musteri-il      mis-il
      move c-vergi-daire  to musteri-vdairesi mis-vdairesi
     
      move c-telefon      to musteri-tel1        mis-tel1
      move c-fax          to musteri-fax         mis-fax
      move c-ulke         to musteri-fat-ulke  mis-fat-ulke
      move c-telefon-1    to musteri-tel2      mis-tel2
      perform varying ix from 1 by 1 until ix > 18
         if c-vergi-no(ix:1) = spaces then 
            move c-vergi-no(ix + 1 :) to c-vergi-no(ix :) 
            move " "                  to c-vergi-no(20:1)
         end-if
      end-perform 
         move c-vergi-no     to musteri-vno   mis-vno
         if mis-vno = spaces and muh-kodlar-cari-tc-kimlik-no not = spaces
            move muh-kodlar-cari-tc-kimlik-no to musteri-vno mis-vno
         end-if 
         
      display acc-mis-unvan1  acc-mis-tel1    acc-mis-vno
              acc-mis-unvan2  acc-mis-fax     acc-mis-adres1      
              acc-mis-ila     acc-mis-adres2  acc-mis-tel2      
              acc-mis-il      acc-mis-vd     

    end-read
    close cari muh-kodlar
    
    end-if.
*
 rez-cagir.
    inquire gd1,cursor-y in sayac
    inquire gd1(sayac,8),
            cell-data in ydk-rez
    initialize dokcagir-tasi
    set dokcagir-tasi-call-rez1   to true
    move ydk-rez                   to dokcagir-rez-no
    perform dokcagir-call
    move dokcagir-rez-no          to rez-no.
*
 folio-cagir.
       inquire gd1,cursor-y in sayac
       inquire gd1(sayac,11),
               cell-data in ydk-konuk-folio
       initialize dokcagir-tasi
       set dokcagir-tasi-call-folio1      to true
       move ydk-konuk-folio               to dokcagir-konuk-folio
       perform dokcagir-call
       move dokcagir-konuk-folio          to konuk-folio.

*
 raporla.

     open i-o genelfis prohrk   
     move 1 to genelfis-anahtar
     read genelfis no lock invalid
          accept print-no from time
     not invalid
          add 1 to print-no
          rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
**************************
     initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya
 


     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Konaklama Detay Dokumu"  to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR

     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Konaklama Detay Dokumu"   to det-filler
     write dokumer-rec from detay
 
 
     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay
 
 
*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLRRRRRRLLRRLLLLLL" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
 
     initialize dokumer-rec detay
     move "1"             to det-dokumer-20(10:1)
     move "D1"            to det-dokumer-20(1:2)



     move "Oda No"         to det-1  
     move "Adi"            to det-2  
     move "Pax"            to det-3  
     move "Oda"            to det-4  
     move "Oda Geliri"     to det-5  
     MOVE "Extra Gelir"    to det-6
     move "Oda + Extra"    to det-77
     move "OdaOrt"         to det-7  
     move "PaxOrt"         to det-8  
     move "Giris Tar"      to det-9  
     move "Cikis Tar"      to det-10 
     move "OdaGc"          to det-11
     move "PaxGc"          to det-12


     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 fil-77 fil-7
                  fil-8 fil-9 fil-10 fil-11 fil-12
     write dokumer-rec from detay
 
     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to det-1 det-2 det-3 det-4 det-5 det-6 det-77 det-7
                      det-8 det-9 det-10 det-11 det-12 
     write dokumer-rec from detay.
 
     inquire gd2, last-row in son-satir
 
******
*     initialize frame-degiskenler
*     move son-satir            to frame-kayit-sayi
*     move 6                    to frame-win-line
*     move 10                   to frame-win-pos
*     move "Raporlaniyor "      to frame-title
*     perform frame-ac
******
 
 
     perform varying i
             from 2
             by 1
             until i > son-satir
             inquire gd2(i),
                     record-data in gd2-rec
 
             initialize dokumer-rec detay topitop
             
             move gd-2-col-1         to det-1  
             move gd-2-col-2         to det-2  
             move gd-2-col-3         to det-3  
             move gd-2-col-4         to det-4  
             move gd-2-col-5         to det-5
             move gd-2-col-6         to det-6
             move gd-2-col-77        to det-77 
*             move z-topitop          to det-77
             move gd-2-col-7         to det-7  
             move gd-2-col-8         to det-8  
             move gd-2-col-9         to det-9 
             move gd-2-col-10        to det-10
             move gd-2-col-11        to det-11
             move gd-2-col-12        to det-12         

                 
*     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 fil-7
*                  fil-8 fil-9 fil-10 fil-11 fil-12
* 
             write dokumer-rec from detay
     end-perform

      initialize dokumer-rec detay 
     move "Toplam"       to det-2
     move top-topitop    to z-top-topitop
     move z-top-topitop  to det-77
     move "|" to fil-1 fil-2 fil-3 fil-4 fil-5 fil-6 fil-77
                 fil-7 fil-8 fil-9 fil-10 fil-11
                 fil-12
     move "A"          to det-dokumer-20(3:1)
     move 481          to det-renk1
     move "1"          to det-dokumer-20(10:1)
     write dokumer-rec from detay


     close dokumer prohrk  
     call dokumer-prog on exception
          perform callerr-proc
     not on exception
          cancel dokumer-prog
     end-call
     delete file dokumer.

     
     .
*
 kart-tipi-ara.
          initialize xpazar-cagir
          call "/asya/ytl/obj/otel/karttipa.asy" using xpazar-cagir
               on exception perform callerr-proc
               not on exception
          cancel "/asya/ytl/obj/otel/karttipa.asy" 
          end-call
          
          move xpazar-kodu-cagir     to mis-kart-tipi
               display acc-mis-kart

               move 4  to accept-control
               move 79 to control-id
          perform kart-tipi-oku
     .
*
 kart-tipi-ara-2.
          initialize xpazar-cagir
          call "/asya/ytl/obj/otel/karttipa.asy" using xpazar-cagir
               on exception perform callerr-proc
               not on exception
          cancel "/asya/ytl/obj/otel/karttipa.asy" 
          end-call
          
          move xpazar-kodu-cagir     to mis-kart-tipi-2
               display acc-mis-kart-2

               move 4  to accept-control
               move 213 to control-id
          perform kart-tipi-oku-2.
*
 kart-tipi-oku.
    open input karttip
    initialize karttip-rec 
    move mis-kart-tipi           to karttip-kodu
    read karttip no lock invalid
         move  "Tanimsiz Kart.." to lb-kart-adi
    not invalid 
         move karttip-adi        to lb-kart-adi
    end-read 
    close karttip
    display lb-kart
        if mis-kart-tipi <> "00" or
           mis-kart-tipi <> spaces
          perform bitmap-kart-goster 
        end-if.
*
 kart-tipi-oku-2.
    open input karttip
    initialize karttip-rec 
    move mis-kart-tipi-2           to karttip-kodu
    read karttip no lock invalid
         move  "Tanimsiz Kart.."   to lb-kart-adi-2
    not invalid 

         move karttip-adi        to lb-kart-adi-2
    end-read 
    close karttip
    display lb-kart-2.
*
 acc-mis-karta-Aft-Procedure.
    perform kart-tipi-oku-2.
*
 bitmap-kart-goster.
    call "w$bitmap" using wbitmap-destroy bmp-handle
    modify bt,
           visible = 0
           bitmap-handle null,
    display bt
     
    call "w$bitmap" using wbitmap-load,
                          karttip-resim-adi
                          giving bmp-handle
    modify bt,
           visible = 1
           bitmap-handle bmp-handle.
*
 puan-kullan.
    initialize link-hepsi
    move tarih-tasi       to link-tarih
    move mis-sirket       to link-m-sirket
    move mis-no           to link-m-p-no
    move 1                to link-hediye-var
    call "/asya/ytl/obj/otel/hediyhrk.asy" using link-hepsi
         on exception perform callerr-proc
         not on exception
    cancel "/asya/ytl/obj/otel/hediyhrk.asy" 
    end-call

    perform kullanilan-puan-bul.
*
 kullanilan-puan-bul.
    open input hediyhrk
    initialize hediyhrk-rec kullanilan-puan
    move m-profil         to hediyhrk-profil-anah
    start hediyhrk key not < hediyhrk-profil-anah invalid
          continue 
    not invalid 
    perform with test after until fs-hediyhrk = "10"
    read hediyhrk next no lock end move "10"  to fs-hediyhrk
    not at end 
            if hediyhrk-profil-anah not = m-profil
                exit perform 
            end-if 
            compute kullanilan-puan = kullanilan-puan + hediyhrk-hediye-puan
    end-read 
    end-perform
    end-start
    close hediyhrk
    compute kalan-puan = toplam-puan - kullanilan-puan
    display acc-kullanilan-puan acc-kalan-puan
    .

        
         .
*
*
 Form1-Aft-Routine.       
     delete file tprohrk
*     modify acc-bant-seri, visible = false
*     modify lb-1301, visible = false
*     modify cb-1301, visible = false
***     display acc-bant-seri lb-1301 cb-1301
     .
*
 gd1-Ev-Msg-Begin-Entry.
     
     
     .
*
 gr-kontrol.
    if kim-d-yil < 1900
       exit paragraph 
    end-if 
    open input musteri
    initialize musteri-rec
    move mis-adi   to musteri-adi  
    move mis-soy   to musteri-soyadi
    start musteri key not < musteri-ilk invalid 
        continue 
    not invalid 
    perform with test after until fs-musteri = "10"
    read musteri next no lock end move "10"  to fs-musteri
    not at end
           
            if musteri-silindi = 1
               exit perform cycle
            end-if
           if musteri-adi = mis-adi and
              musteri-soyadi = mis-soy and
              musteri-d-tarihi = kim-d-tarih

                 move musteri-no    to mis-no
              move musteri-sirket to mis-sirket
              display acc-mis-no acc-mis-sirket
             exit perform 
           else
             if musteri-adi not = mis-adi or
                musteri-soyadi not = mis-soy
                  move "10"  to fs-musteri
             end-if
           end-if 
    end-read 
    end-perform
    end-start
    close musteri
    .
*
 mesajgir.
     if key-status = 3131 and mis-no > 0 then
          
           move "U"     to  link-not-islem
           move "PRF"   to  link-not-dos    
           move musteri-anah to link-not-dos-anah  
           move 39      to link-nereden 
           string musteri-adi delimited by "  "
                  " " delimited by size
                  musteri-soyadi delimited by "  " 
                  " " delimited by size
                  "isimli Profil" delimited by size
                  into link-dosya-aciklamasi
                  call "/asya/ytl/obj/otel/mesajgir.asy" 
                       using link-not
                       on exception 
                       perform callerr-proc
                       exit paragraph
                       not on exception 
                  cancel "/asya/ytl/obj/otel/mesajgir.asy"
                  end-call
                  move  link-not-donus  to  toplam-not
                  display not-ac
                  move musteri-anah     to son-not-d
      exit paragraph 
     end-if.   
*
 mesaj-goster.      
       if musteri-no > 0 then
           move 39 to link-nereden 
           move "K"     to  link-not-islem
           move "PRF"   to  link-NOT-DOS    
           move musteri-anah to link-NOT-DOS-ANAH   
           move 39 to link-nereden 
                   call "/asya/ytl/obj/otel/mesajgir.asy" 
                         using link-not
                          on exception 
                          perform callerr-proc
                          exit paragraph
                        not on exception 
                          cancel "/asya/ytl/obj/otel/mesajgir.asy"
                    end-call
                    move  link-not-donus  to  toplam-not
             display not-ac
             move musteri-anah to son-not-d
         end-if.
*
 anket-grid-doldur.
          modify grd8 , reset-grid = 1
          initialize grd8-record
          move " "  to grd8-col-1
          move "Sirket"  to grd8-col-2
          move "Profil"  to grd8-col-3
          move "Sira"    to grd8-col-4
          move "Tarih"   to grd8-col-5
          move "Staff"   to grd8-col-6
          move "Rpr"     to grd8-col-7 
          modify grd8 , record-to-add(grd8-record)

          open input pahrk
          initialize pahrk-rec satir-say
          move 1 to satir-say
          move mis-sirket  to PAHRK-PROFIL-KUTUPHANE
          move mis-no      to PAHRK-PROFIL-NO
          start pahrk key not < PAHRK-ANAH invalid
                  continue
          not invalid
          perform until fs-pahrk = "10"
          read pahrk next no lock end move "10" to fs-pahrk
          not end
                 if PAHRK-PROFIL-KUTUPHANE <> mis-sirket then
                       exit perform 
                 end-if
                  if PAHRK-PROFIL-NO <> mis-no then
                       exit perform 
                 end-if

                 initialize grd8-record
                 move "*"                    to grd8-col-1
                 move PAHRK-PROFIL-KUTUPHANE to grd8-col-2
                 move PAHRK-PROFIL-NO        to grd8-col-3
                 move PAHRK-ANKET-NO         to grd8-col-4 

                 move PAHRK-KAYIT-YIL        to e-yil
                 move PAHRK-KAYIT-ay         to e-ay
                 move PAHRK-KAYIT-gun        to e-gun
                 move e-tarih                to grd8-col-5
                 move PAHRK-STAF             to grd8-col-6

                 modify grd8 , record-to-add(grd8-record)
                 add 1 to satir-say
                 modify grd8(satir-say,7),  bitmap = print-bmp
                                            bitmap-number = 1
                                            bitmap-width  = 16
                                            color = 0 

                modify grd8(satir-say,2),hidden-data = PAHRK-PROFIL-KUTUPHANE  
                modify grd8(satir-say,3),hidden-data = PAHRK-PROFIL-NO  
                modify grd8(satir-say,4),hidden-data = PAHRK-ANKET-NO  
 
          end-read
          end-perform
          end-start
          close pahrk
         .

*
 grd8-Ev-Msg-Begin-Entry.
      move event-action-fail to event-action
     .
*
 grd8-Ev-Msg-Bitmap-Clicked.
       initialize palink-profil-sirket palink-profil-no palink-anket-no
       inquire grd8(event-data-2,2) , hidden-data in  palink-profil-sirket
       inquire grd8(event-data-2,3) , hidden-data in  palink-profil-no
       inquire grd8(event-data-2,4) , hidden-data in  palink-anket-no
       call "/asya/ytl/obj/otel/pagiris.asy" using palink-profil-sirket palink-profil-no palink-anket-no palink-oda-no
            on exception perform callerr-proc
            not on exception
       cancel "/asya/ytl/obj/otel/pagiris.asy" 
       end-call.
*
 anket-giris.
        initialize palink-profil-sirket palink-profil-no palink-anket-no
        move mis-sirket to palink-profil-sirket
        move mis-no     to palink-profil-no

        open input pahrk
            initialize pahrk-rec
            move mis-sirket to PAHRK-PROFIL-KUTUPHANE
            move mis-no     to PAHRK-PROFIL-NO
            start pahrk key not < pahrk-anah invalid
                    continue
            not invalid
            perform until fs-pahrk = "10"
            read pahrk next no lock end move "10" to fs-pahrk
            not end
                     move pahrk-anket-no to palink-anket-no
            end-read
            end-perform
            end-start
            add 1 to palink-anket-no
            move mis-sirket to palink-profil-sirket
            move mis-no     to palink-profil-no
         close pahrk

             call "/asya/ytl/obj/otel/pagiris.asy" using palink-profil-sirket palink-profil-no palink-anket-no palink-oda-no 
                  on exception perform callerr-proc
                  not on exception
             cancel "/asya/ytl/obj/otel/pagiris.asy" 
             end-call.
*
 tek-mus.
              open i-o genelfis prohrk|transfer programý yüzünden CPY içinde deðil 
               
 
       

  
             move musteri-sirket to mis-sirket
             move musteri-no to mis-no
             move 0 to transferden
              
                
              
 
              perform puan-hesapla
              perform varying s 
                      from 1
                      by 1
                      until s > 10
                         if puanhes-toplam-puan >= alt-puan(s) and
                            puanhes-toplam-puan < ust-puan(s)
                              exit perform  
                         end-if 
              end-perform
              if s < 10                 
                 move s                 to musteri-kart-tipi-2
              else 
                 initialize musteri-kart-tipi-2
              end-if 
                 move musteri-kart-tipi-2      to mis-kart-tipi-2
              move puanhes-toplam-puan  to musteri-kazanilan-puan
                 move musteri-kazanilan-puan   to toplam-puan

                 display acc-mis-kart-2 acc-toplam-puan
                perform  acc-mis-karta-Aft-Procedure
               close genelfis prohrk.|transfer programý yüzünden CPY içinde deðil  
                .
*
 log-goster.
    move musteri-dosya         to link-logview-dosya-adi
    set link-logview-pointer  to address of musteri-rec
    set link-logview-rec-size to size of musteri-rec
    perform logview-call
    initialize key-status
     .
*
 eraysoft-resim-kopyala.
    if on-yuz not = spaces
       move 1                 to resim-no
       move on-yuz            to opnsav-filename 
       move on-yuz-dosya-adi  to opnsav-basename
       perform resim-upload-1
    end-if 
    if arka-yuz not = spaces
       move 2                   to resim-no
       move arka-yuz            to opnsav-filename 
       move arka-yuz-dosya-adi  to opnsav-basename
       perform resim-upload-1
    end-if 
      .
*
 acc-mis-vno-Aft-Procedure.
    move function numval(mis-vno) to num-kont
    evaluate true
      when  num-kont > 9999999999 and  num-kont < 99999999999
      move "TCNO      " to no-acik
      when num-kont > 999999999 and  num-kont < 9999999999
       move "Vergi No     " to no-acik
     when num-kont = 0
       move "            " to no-acik
      when other
         move "Uyumsuz     " to no-acik
     end-evaluate
     display no-acik-lb

     .
*
 yas-hes-pro.

     move gbugun  to yasbulilk-tarih
     move gdogtar to yasbulson-tarih
     subtract yasbulson-gun from yasbulilk-gun giving yasbulfark-gun                                        
     if yasbulfark-gun < 0 then 
       subtract 1 from yasbulilk-ay  
       evaluate yasbulilk-ay
          when 1 
          when 3 
          when 5 
          when 7 
          when 8 
          when 10 
          when 0
             add 31 to yasbulfark-gun 
          when 2
             divide yasbulilk-yil by 4 giving bolum remainder kalan
             if kalan = 0 then 
                 add 29 to yasbulfark-gun 
             else
                 add 28 to yasbulfark-gun
             end-if
          when other 
             add 30 to yasbulfark-gun 
         end-evaluate
     end-if
     subtract yasbulson-ay from yasbulilk-ay giving yasbulfark-ay 
     if yasbulfark-ay < 0 then 
       add 12 to yasbulfark-ay 
       subtract 1 from yasbulilk-yil
     end-if
     subtract yasbulson-yil from yasbulilk-yil giving yasbulfark-yil 
     compute yasbulfark-yil-say  rounded  =  yasbulfark-yil
          + ( yasbulfark-ay / 12 ) + ( yasbulfark-GUN / 365 )  
     move yasbulfark-yil-say to yasz.
*
 cb-1301-Ev-Cmd-Clicked.
     
     .
*
 sifreleme-yap.
                  unstring sifreli-text delimited by " " into
                           kelimem(1)
                           kelimem(2)
                           kelimem(3)
                           kelimem(4)
                           kelimem(5)
                           kelimem(6)
                           kelimem(7)
                           kelimem(8)
                           kelimem(9)
                           kelimem(10)
                  
                  inspect kelime-occurs replacing all spaces by low-values
                  
                  perform varying r
                  from 1
                  by 1
                  until r > 10
                  
                     initialize word-length
                     perform varying word-length
                     from 1 
                     by 1
                     until word-length > 50
                        if kelimem(r)(word-length:1) = low-values 
                           exit perform  
                        end-if
                     end-perform 
                     compute word-length = word-length - 3
                  
                     if kelimem(r) <> low-values                        
                        move all "*" to kelimem(r)(3:word-length)
                     end-if
                  end-perform                                                                                                                   
                  
                  initialize sifreli-text
                  move low-values                 to sifreli-text
                  
                  perform varying r
                  from 1
                  by 1
                  until r > 10
                      string sifreli-text 
                             kelimem(r) delimited by low-values
                             " "       delimited by low-values
                             into sifreli-text
                  end-perform
                  inspect sifreli-text replacing all low-values by spaces.

 
