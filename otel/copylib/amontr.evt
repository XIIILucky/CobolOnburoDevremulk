* amontr.evt
* amontr.evt is generated from F:\asya\acugt.kaya\otel\amontr.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM exception-procedure
     .
***   start event editor code   ***
*
 Form1-Bef-Create. 
      set environment "extra-keys-ok" to 1.
*       set enviroment "Flush-count" to 2048    
       perform adresleri-tasi .        
*
 before-procedure. 
    
             .

 Form1-Aft-Initdata.     
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid
          initialize mesaj-link
          move 03 to mesaj-no
          perform mesaj-ver
    not invalid
        continue
    end-read
    close genel.

*      
 exception-procedure. 
     evaluate key-status
          when 2 
               open output trnot
                  perform islem-yap 
               close trnot
               display  message box "Islem Bitti"  
         end-evaluate. 
*
 islem-yap.         
        if tanim-value  = 1 then           
*              perform akonum-al
*              perform aoda-al
*              perform adep-al
*              perform ulke-ac
*             perform acenta-al
*             perform depkod-al
             
************   perform pans-al
             
        end-if
        if rez-value  = 1 then 
            open output rez konuk ozluk  polisxml yanrez frez fextra froom  facenta fpans
            close rez konuk ozluk polisxml  yanrez frez fextra froom facenta fpans  
            open input fulke
            perform arez-al 
            perform cin-yap             
           close fulke
            

*                 perform rez-al                          
************   perform pans-al                                     
          
        end-if
        
        
        
         if cin-value = 1 then 
            
*             perform cin-yap
          
         end-if
         
         
         if eski-folio-al = 1
            perform eski-fol
            perform in-fol
         end-if
          if hrk-value = 1 then 
              move 1000000 to uuasya-sira
        open output romhrk exthrk
         close romhrk exthrk
          open i-o romhrk exthrk
          open input konuk
              perform ahrkes-al
*              perform ahrk-al
         close romhrk exthrk konuk
         
        end-if
          if xml-kayit = 1
           perform yan-al
         end-if
         if kur-value = 1 then 
            perform kur-al
         end-if
           .
*
 kur-al.
     move "kame2009" to  tkur-dosya-adres
     open input tkur
     open output kur close kur open i-o kur
     initialize tkur-rec
     start tkur key > tkur-kodu 
        invalid continue
        not invalid
        perform until fs-tkur ="10"
              read tkur next end move "10" to fs-tkur
              not end
              if tkur-banka = 01 then
                move tkur-rec to kur-rec
                evaluate tkur-doviz
                      when 1   move 2 to kur-doviz write kur-rec end-write
                      when 2   move 1 to kur-doviz  write kur-rec end-write
                      when 7   move 4 to kur-doviz  write kur-rec end-write
                      when 11  move 3 to kur-doviz  write kur-rec end-write
                      when 99  move 10 to kur-doviz write kur-rec end-write 
                end-evaluate
              end-if
              end-read
         end-perform
     end-start
     close kur tkur.
* 
 ulke-ac.
     open input uyruk
     open output ulke fulke
     close ulke fulke
     open i-o ulke fulke
     initialize uyruk-rec ydk-ulke
     start uyruk key not < uyruk-anah invalid
           continue
     not invalid
     perform with test after until fs-uyruk = "10"
     read uyruk next no lock end move "10" to fs-uyruk
     not at end
            add 1 to ydk-ulke
            move uyruk-kodu to fulke-fide-kodu 
            move ydk-ulke   to fulke-asya-kodu ulke-anah
            move uyruk-adi  to ulke-adi
            write ulke-rec invalid if debug = 1 then stop " " end-if end-write
            write fulke-rec invalid stop" " end-write
     end-read
     end-perform
     end-start
     close uyruk ulke fulke
    .
*
 aoda-al.
    move "odano.txt"  to fidetext-adi
    move "odano2.txt" to amontext-adi
    open input fidetext
    open output amontext odalar
     close odalar 
     open i-o odalar  fkonum
     initialize odalar-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(2) not = spaces
       move amontext-det(1) to odalar-anah
       move amontext-det(2) to fkonum-fide-kodu
       read fkonum no lock invalid 
            if debug = 1 then stop " " end-if
       end-read
       move fkonum-asya-kodu to odalar-konumu
       move amontext-det(3)  to odalar-tipi
       move "VD"             to house-durumu
       move function numval(amontext-det(5)(1:1)) to ydk-kat
       move ydk-kat    to odalar-kat
       if ydk-kat = 0
          move 10 to odalar-kat
       end-if
       write odalar-rec end-write 
     end-if
    write amontext-rec end-write
    end-read
    end-perform
    close fidetext close amontext odalar fkonum.
*
 adep-al.
    move "depart.txt"  to fidetext-adi
    move "depart2.txt" to amontext-adi
    open input fidetext
    open output amontext depkod
     close depkod 
     open i-o depkod 
     initialize depkod-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      
     if amontext-det(2) not = spaces
       move amontext-det(1)  to depkod-anah
       move amontext-det(2)  to depkod-adi
       move function numval(amontext-det(6))  to depkod-kdv
       move "B"              to depkod-ba

       inspect depkod-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
       to x"8DA69A9E989980879FA7818D94"
              call "c$toupper" using depkod-adi value 30
       write depkod-rec end-write 
     end-if
    write amontext-rec end-write
    end-read
    end-perform
    close fidetext close amontext depkod .
*
 arez-al.
    move "gunrez.txt"  to fidetext-adi
    move "gunrez2.txt" to amontext-adi
    open input fidetext
    open output amontext rez  facenta fpans
    close rez   fpans facenta
    open i-o rez  facenta  fpans fkonum
*     move   "paladene" to acenta-dosya-adres
*      open input acenta
*      initialize acenta-rec
*      start acenta key not < acenta-anahtar invalid
*            continue
*      not invalid
*      perform with test after until fs-acenta = "10"
*      read acenta next no lock end move "10"  to fs-acenta
*      not at end
*               move acenta-adi     to facenta-fide-kodu
*               move acenta-kodu    to facenta-asya-kodu
*               write facenta-rec invalid stop " " end-write
*      end-read
*      end-perform
*      end-start
*      close acenta
*    move   isyeri-adres-tasi  to acenta-dosya-adres
    open i-o acenta
    initialize acenta-rec
    start acenta key > acenta-kodu
      invalid continue
      not invalid
      perform until fs-acenta = "10"
      read acenta next no lock end   move "10" to fs-acenta
      not end
      move function numval(acenta-kodu) to ydk-acenta
       if ydk-acenta = 6600 or 5800 or 200 or 300 or
              5500 or 0400 or 0600 or 6200 or 0800 or 1200 or 6500 or 
              6000 or 1800 or 6700 or 2000 or 2200 or 6400 or 2400 or 
              2500 or 2600 or 2800 or 5900 or 3000 or 3100 or 5600 or 
              3200 or 3600 or 3400 or 3500 or 5700 or 4000 or 4100 or 
              4200 or 4400 or 4600 or 4700 or 4800 or 6100 or 6300 or 
              4900 then 
              continue
              else
              delete acenta end-delete
             end-if
       end-read
      end-perform
    end-start
    initialize rez-rec
    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 
    write amontext-rec end-write 
    
    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring  fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform                      

     if amontext-det(6) not = spaces
        move amontext-det(6) to facenta-fide-kodu
        write facenta-rec invalid continue end-write 
     end-if

     if amontext-det(14) not = spaces
        move amontext-det(14) to fpans-fide-kodu
        write fpans-rec invalid continue end-write 
     end-if
                                                       
*       inspect depkod-adi converting x"FDD0DCDEDDD6C7E7FEF0FCFDF6"
*       to x"8DA69A9E989980879FA7818D94"
*              call "c$toupper" using depkod-adi value 30
    write amontext-rec end-write
    end-read
    end-perform

    initialize facenta-fide-kodu ydk-acenta ydk-grup-kodu
    start facenta key > facenta-fide-kodu invalid
          continue
    not invalid
    perform with test after until fs-facenta = "10"
    read facenta next no lock end move "10" to fs-facenta
    not at end
*            initialize fs-acenta
*            perform until fs-acenta = "10"
           add 1 to ydk-acenta
          if ydk-acenta = 6600 or 5800 or 200 or 300 or
              5500 or 0400 or 0600 or 6200 or 0800 or 1200 or 6500 or 
              6000 or 1800 or 6700 or 2000 or 2200 or 6400 or 2400 or 
              2500 or 2600 or 2800 or 5900 or 3000 or 3100 or 5600 or 
              3200 or 3600 or 3400 or 3500 or 5700 or 4000 or 4100 or 
              4200 or 4400 or 4600 or 4700 or 4800 or 6100 or 6300 or 
              4900 then 
              add 1 to ydk-acenta
             end-if
            
*            read acenta no lock invalid move "10" to fs-acenta
*            end-read
*            end-perform
            move ydk-acenta        to facenta-asya-kodu
            
            move facenta-asya-kodu to acenta-kodu
            move facenta-fide-kodu to acenta-adi
            write acenta-rec invalid if debug = 1 then stop " " end-if end-write
            rewrite facenta-rec invalid if debug = 1 then stop " " end-if end-rewrite
    end-read
    end-perform
    end-start

    initialize fpans-fide-kodu ydk-grup-kodu
    start fpans key > fpans-fide-kodu invalid
          continue
    not invalid
    perform with test after until fs-fpans = "10"
    read fpans next no lock end move "10" to fs-fpans
    not at end
            add 1 to ydk-grup-kodu
            move ydk-grup-kodu to fpans-asya-kodu
            rewrite fpans-rec invalid if debug = 1 then stop " " end-if end-rewrite
    end-read
    end-perform
    end-start

    close fidetext 
    open input fidetext
    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform 
    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring  fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform     
        initialize rez-rec 
     if amontext-det(2) not = spaces
        move function numval(amontext-det(2)) to rez-no
        move amontext-det(8)(1:2) to rez-gir-gun
        move amontext-det(8)(4:2) to rez-gir-ay
        move amontext-det(8)(7:4) to rez-gir-yil
        move amontext-det(9)(1:2) to rez-cik-gun
        move amontext-det(9)(4:2) to rez-cik-ay
        move amontext-det(9)(7:4) to rez-cik-yil
        
        move function numval(amontext-det(3)) to ydk-master
        if ydk-master > 0 then 
            move ydk-master to rez-grup-no
        end-if
        move amontext-det(6)      to facenta-fide-kodu
        read facenta no lock invalid 
             if debug = 1 then stop " " end-if
        end-read
        move facenta-asya-kodu   to rez-acenta

        move amontext-det(21)    to rez-adi
        move amontext-det(22)    to rez-soyadi
        move 1                   to rez-tipi
        move "I"                 to rez-durumu
        move amontext-det(4)     to rez-voucher
*        if function numval(amontext-det(3)) > 0
*           move function numval(amontext-det(3))    to ydk-fpans-fide-kodu
*           move ydk-fpans-fide-kodu           to fpans-fide-kodu
*           read fpans no lock invalid 
*                if debug = 1 then stop " " end-if
*           end-read
*           move fpans-asya-kodu     to rez-grup-no        
*        end-if
        move amontext-det(5)        to rez-odano

           move amontext-det(12)    to fkonum-fide-kodu
           read fkonum no lock invalid 
                if debug = 1 then stop " " end-if
           end-read
           move fkonum-asya-kodu   to rez-fiyat-konumu
           initialize fkonum-rec
           move amontext-det(13)    to fkonum-fide-kodu
           read fkonum no lock invalid 
                if debug = 1 then stop " " end-if
           end-read
           move fkonum-asya-kodu   to rez-oda-konumu
           move function numval (amontext-det(35))   to rez-buyuk
           move function numval (amontext-det(36))   to rez-kucuk

           move amontext-det(15)(1:2) to rez-al-gun
           move amontext-det(15)(4:2) to rez-al-ay
           move amontext-det(15)(7:4) to rez-al-yil
           move 01                    to rez-banka
           move "K"                   to rez-k-g-b
           move amontext-det(47)      to fulke-fide-kodu
           read fulke no lock invalid 
               move 001               to fulke-asya-kodu
           end-read

           move fulke-asya-kodu       to rez-ulke
           move 01                    to rez-pazar
           move "G" to REZ-KUR-AYGUN
           move 01                    to rez-anlasma
           move 02                    to rez-odeme-tipi
           move "AL"                  to rez-pan-tipi
           if amontext-det(26)(1:3) = "EUR"
              move 01        to rez-doviz
           end-if
           if amontext-det(26)(1:3) = "USD"
              move 02        to rez-doviz
           end-if
           if amontext-det(26) = "TL"
              move 10        to rez-doviz
           end-if
           move function numval(amontext-det(28))  to rez-fiyati
           move amontext-det(41)(1:20)   to rez-not1
           move amontext-det(41)(20:)    to rez-not2
           move function numval(amontext-det(80))   to ydk-tutar   
           move amontext-det(80)   to rez-e-mail(1:10)
           move function numval(amontext-det(79))   to rez-fiyati
            
           compute REZ-CIN-KURU rounded = ydk-tutar / rez-fiyati
           if  amontext-det(88) not = spaces  then 

               move rez-no to yanrez-rezno
               move 2 to yanrez-sirano
               unstring amontext-det(88) delimited by " "
                   into yanrez-adi yanrez-soyadi
*               write yanrez-rec invalid rewrite yanrez-rec end-write

           end-if
           if  amontext-det(89) not = spaces  then 

               move rez-no to yanrez-rezno
               move 3 to yanrez-sirano
               unstring amontext-det(89) delimited by " "
                   into yanrez-adi yanrez-soyadi
*               write yanrez-rec invalid rewrite yanrez-rec end-write

           end-if 
           move rez-buyuk to rez-s-d-t-g
           if rez-buyuk > 4 then move 4 to rez-s-d-t-g end-if
        write rez-rec invalid if debug = 1 then stop " " end-if end-write 
     end-if    
    end-read
    end-perform             
    close fidetext 
    close amontext rez acenta facenta fpans fkonum.
*
 akonum-al.
    move "odakonum.txt" to fidetext-adi
    move "odakonu2.txt" to amontext-adi
    open input fidetext
    open output amontext konum fkonum
     close konum fkonum
     open i-o konum   fkonum
     initialize konum-rec
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform
    move amontext-det(1) to Fkonum-FIDE-KODU        
    move amontext-det(1)(1:4) to konum-adi
    move function numval(amontext-det(8)) to  KONUM-TOP-ODA konum-hazir-oda 
    if amontext-det(9) = spaces and 
       amontext-det(2) not = spaces then 
            add 1 to konum-anahtar
            move amontext-det(1) to Fkonum-FIDE-KODU
            move konum-anahtar   to fkonum-asya-kodu
            write konum-rec end-write 
            write fkonum-rec invalid if debug = 1 then stop " " end-if end-write
        
    end-if

    write amontext-rec end-write
    end-read
    end-perform
      close fidetext
    open input fidetext
     read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
     initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac
    end-perform


     if amontext-det(9) not = spaces then 
        move amontext-det(9) to fkonum-fide-kodu
        read fkonum no lock invalid if debug = 1 then stop " " end-if
        end-read
        move amontext-det(1) to Fkonum-FIDE-KODU
        write fkonum-rec invalid if debug = 1 then stop " " end-if end-write
     end-if
     end-read
    end-perform
    close fidetext close amontext konum fkonum.
*
fih-al2.
    
      move "fihrist2.txt" to fidetext-adi
      initialize uasya-sira
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
           initialize fidetext-rec
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                       if  function numval (fidetext-rec(32:4)) > 1000 and 
                            < 2000
                            then

                            initialize fihrist-alan fihrist-alan2
                       move  fidetext-rec(63:30)    to fihrist-alan
                        move  fidetext-rec(94:30)    to fihrist-alan2
                       initialize ilk-sayisal-yer baslangic-yer ilk-sayisal-yer2 baslangic-yer2
                       perform varying i from 30 by -1 until i <= 0
                          if fihrist-alan(i:1) = "0" or "1" or "2" or
                                                 "3" or "4" or "5" or
                                                 "6" or "7" or "8" or "9"
                            move i to ilk-sayisal-yer
                          end-if
                          if fihrist-alan(i:1) not =  "0" and not ="1" and not ="2" and
                                                 not ="3" and not ="4" and not ="5" and
                                                 not ="6" and not ="7" and not ="8" and not ="9" and
                                                 not =" " and not ="-" and not ="/"
                            
                             move i to baslangic-yer
                             exit perform 

                          end-if
                       end-perform 
                       perform varying i from 30 by -1 until i <= 0
                          if fihrist-alan2(i:1) = "0" or "1" or "2" or
                                                 "3" or "4" or "5" or
                                                 "6" or "7" or "8" or "9"
                            move i to ilk-sayisal-yer2
                          end-if
                          if fihrist-alan2(i:1) not =  "0" and not = "1" and not =  "2" and 
                                                not =  "3" and not = "4" and not =  "5" and
                                                not =  "6" and not = "7" and not =  "8" and not = "9" and
                                                not =  " " and not = "-" and not =  "/"
                            
                             move i to baslangic-yer2
                             exit perform 

                          end-if
                       end-perform 

                       if ilk-sayisal-yer > 0 or ilk-sayisal-yer2 > 0 then 

                        
                        initialize fihrist-rec
                        move uasya-sira to FIHRIST-NO  
                         add 1 to uasya-sira
                        move fihrist-alan(1:baslangic-yer) to  fihrist-adi
                        if ilk-sayisal-yer > 0 then 
                             move fihrist-alan(ilk-sayisal-yer:) to  fihrist-telefon
                        end-if
                        initialize i
                        inspect fihrist-alan2 TALLYING i FOR ALL "FAX" 
                        if ilk-sayisal-yer2 > 0 
                         if i = 1 then  
                             move fihrist-alan2(ilk-sayisal-yer2:) to fihrist-fax
                           else 
                             move    fihrist-alan2(ilk-sayisal-yer2:) to   FIHRIST-MOBIL-TEL
                         end-if
                         end-if
                        write fihrist-rec invalid if debug = 1 then stop " " end-if end-write
                        end-if
                    end-if
            end-read
         end-perform 
         close fidetext.
           .
fih-al.
      move "fihrist.txt" to fidetext-adi
      initialize uasya-sira
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                  
                  evaluate true  
                     when  fidetext-rec(1:1) = "0" or = "1" 
                      or = "2" or = "3" or = "4" or = "5" or = "6" or = "7" 
                      or = "8" or = "9"
                     or  fidetext-rec(2:1) = "0" or = "1" 
                      or = "2" or = "3" or = "4" or = "5" or = "6" or = "7" 
                      or = "8" or = "9"
                       add 1 to uasya-sira
                        initialize fihrist-rec
                        move uasya-sira to FIHRIST-NO  
                        move  fidetext-rec(1:20)    to fihrist-telefon
                        move  fidetext-rec(32:20)   to       FIHRIST-adi        
                        write fihrist-rec invalid if debug = 1 then stop " " end-if end-write
                     
                    when other
                       add 1 to uasya-sira
                        initialize fihrist-rec
                        move uasya-sira to FIHRIST-NO  
                        move  fidetext-rec(1:25)    to fihrist-adi
                        move  fidetext-rec(32:20)   to       FIHRIST-TELEFON         
                        write fihrist-rec invalid if debug = 1 then stop " " end-if end-write
                  end-evaluate
                  
            end-read
         end-perform 
         close fidetext.


*
 yan-al.
    move "xml.txt"  to fidetext-adi
    move "xml2.txt" to amontext-adi
   
    open input fidetext
    open output amontext polisxml
    close polisxml
    open i-o konum fkonum froom frez rez polisxml yanrez konuk ozluk ulke
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
    perform varying k from 1 by 1 until k > 100
    unstring    fidetext-rec delimited by x"09"
         into amontext-det(k)   pointer sayac

    end-perform
    write amontext-rec end-write
     move function numval(amontext-det(18)) to ydk-frez-fide-rfolio    ydk-frez-fide-efolio
           move 0 to bulundu
          perform frez-baslat 
           if bulundu = 0 then stop " " end-if
    end-read
    end-perform 
    close fidetext froom frez rez polisxml yanrez konuk ozluk ulke amontext.
*
 frez-baslat.
    move ydk-frez-fide-rfolio to frez-fide-rfolio
    start frez key not < frez-fide-rfolio invalid
          continue
    not invalid
    perform with test after until fs-frez = "10"
    read frez next no lock end move "10"    to fs-frez
    not at end
          
           if frez-fide-rfolio <> ydk-frez-fide-rfolio
              exit perform 
           else
           move frez-asya-rez-kodu to rez-anah
           perform tek-xml-al
           move 1 to bulundu
           exit perform
           end-if
    end-read
    end-perform
    end-start
    if bulundu = 1 then exit paragraph  end-if
    move ydk-frez-fide-efolio to frez-fide-efolio
    start frez key not < frez-fide-efolio invalid
          continue
    not invalid
    perform with test after until fs-frez = "10"
    read frez next no lock end move "10"    to fs-frez
    not at end
          
           if frez-fide-efolio <> ydk-frez-fide-efolio
              exit perform 
           else
           move frez-asya-rez-kodu to rez-no
           perform tek-xml-al
           move 1 to bulundu
           exit perform
           end-if
    end-read
    end-perform
    end-start
      .
*
 tek-xml-al.         
*         move frez-asya-rez-kodu to rez-anah
         read rez no lock invalid 
              continue
         not invalid
         move rez-folio to konuk-folio OZLUK-FOLIO
         read konuk no lock invalid 
              continue
         end-read
         READ OZLUK NO LOCK INVALID 
              CONTINUE
         END-READ
            INITIALIZE YANREZ-REC polisxml-rec
            MOVE REZ-NO TO   yanrez-rezno polisxml-rezno
            PERFORM UNTIL yanrez-sirano > 7
              ADD 1 TO yanrez-sirano
               READ YANREZ NO LOCK INVALID 
                    EXIT PERFORM
               END-READ
             END-PERFORM
             move yanrez-sirano to polisxml-sirano
 
             move amontext-det(14) to yanrez-ADI        polisxml-ADI        
             move amontext-det(3)  to yanrez-SOYADI     polisxml-SOYADI     
             move amontext-det(1)  to yanrez-ODANO      polisxml-ODANO      
             string  amontext-det(27) delimited by "   "      
                     amontext-det(28) 
             into polisxml-adr
                                           
             move rez-gir-tar         to yanrez-GEL-TAR    polisxml-GEL-TAR    
             move rez-cik-tar         to yanrez-GIT-TAR    polisxml-GIT-TAR    
             move konuk-gel-zaman     to yanrez-GEL-ZAMAN  polisxml-GEL-ZAMAN  
             move konuk-git-zaman     to yanrez-GIT-ZAMAN  polisxml-GIT-ZAMAN  
*             MOVE KONUK-ULKE TO ULKE-ANAH
*             READ ULKE NO LOCK INVALID CONTINUE
*                NOT INVALID
*                   MOVE ULKE-AKBS TO POLISXML-UYRUK
*             END-READ
              move amontext-det(15) to polisxml-uyruk
              move amontext-det(7)  to polisxml-babaadi   
              move amontext-det(8)  to polisxml-anaadi    
              move amontext-det(20) to polisxml-dyeri     

               

              move "XX"     to polisxml-nil         
              move "XX"     to polisxml-nilce       
*              move fidetext-rec(360:30) to polisxml-nmahalle    
              move "E" to polisxml-medeni
             move amontext-det(17) to  polisxml-kseri
             

              evaluate  amontext-det(16)
                 WHEN "N"     MOVE "N" TO POLISXML-KTURU
                 WHEN "P"     MOVE "P" TO POLISXML-KTURU
                 WHEN "E"     MOVE "E" TO POLISXML-KTURU
                 WHEN OTHER MOVE "D" TO POLISXML-KTURU
              end-evaluate
             if  amontext-det(37)= "K"
                 move "K" to polisxml-cinsiyet   
             else
                 move "E" to polisxml-cinsiyet
             end-if

             move function numval(amontext-det(36))      to polisxml-tckimlikno
             move amontext-det(22)(1:2) to yanrez-dog-gun polisxml-dog-gun
             move amontext-det(22)(4:2) to yanrez-dog-ay polisxml-dog-ay
             move amontext-det(22)(7:4) to yanrez-dog-yil polisxml-dog-yil

             write yanrez-rec   invalid   rewrite yanrez-rec   end-write
             write polisxml-rec invalid   rewrite polisxml-rec end-write
         end-read

      .







      .
*
 cin-yap.
     open i-o rez 
     open output  konuk ozluk 
     close  konuk ozluk
     open i-o frez konuk ozluk
     initialize rez-rec
     start rez key > rez-anah 
       invalid continue
       not invalid
       perform until fs-rez = "10" 
          read rez next no lock 
            end move "10" to fs-rez
            not end 
            if rez-gir-tar <= tarih-tasi and
               REZ-DURUMU = "I" then
                perform tek-cin
                PERFORM extra-cin
            end-if 
          end-read
       end-perform
      end-start       
      close rez konuk ozluk frez
         .     
*
 tek-cin.
          move rez-no to frez-fide-rez-kodu  frez-asya-rez-kodu
          initialize konuk-rec ozluk-rec
          move fol-sira to frez-asya-rfolio-kodu konuk-folio ozluk-folio
          add 1 to fol-sira
          perform oda-cin
          move fol-sira to frez-asya-efolio-kodu
          add 1 to fol-sira
          write frez-rec invalid if debug = 1 then stop " " end-if end-write.
*
 extra-cin.         
    move  frez-asya-efolio-kodu to konuk-folio ozluk-folio ozluk2-folio.         
    move cinpara-ext-fol-banka  to banka-kodu.     
    move cinpara-ext-fol-doviz  to doviz-kodu.                   
    move cinpara-ext-fol-ode    to kodlar02-kodu. 
          move rez-no to konuk-extra-rez-no 
          move "I"  to  konuk-durumu. 
          if konuk-git-tar <= tarih-tasi          
              move "H"                 to konuk-durumu
          end-if
          move "E"  to konuk-fol-kodu. 
          move konuk-adi(1:17)           to konuk-adi(04:17). 
          move "E=>"                     to konuk-adi(01:03). 
***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar   konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno konuk-bos. 
          move konuk-durumu         to  ozluk-durumu. 
          move konuk-adi            to  ozluk-adi(04:17). 
          move "E=>"                to  ozluk-adi(01:03). 
          write konuk-rec invalid if debug = 1 then stop " " end-if
          end-write.                         
          write ozluk-rec invalid if debug = 1 then stop " " end-if
          end-write.
*
 oda-cin.
    move rez-no              to konuk-rez-no ozluk-rez-no
    move rez-adi             to konuk-adi ozluk-adi 
    move rez-soyadi          to konuk-soyadi ozluk-soyadi
    move rez-s-d-t-g         to konuk-s-d-t-g 
    move rez-oda-konumu      to konuk-oda-konumu 
    if rez-fiyat-konumu = 0 then 
       move rez-oda-konumu   to rez-fiyat-konumu
    end-if
    move rez-fiyat-konumu    to konuk-fiyat-konumu 
    move rez-odeme-tipi      to konuk-odeme-tipi 
    move rez-odano           to konuk-odano  
    move rez-ulke            to konuk-ulke 
    move rez-buyuk           to konuk-buyuk  
    move rez-kucuk           to konuk-kucuk  
    move rez-free            to konuk-free   

    move rez-bebek           to konuk-bebek 
    move rez-acenta          to konuk-acenta 
    move rez-grup-no         to konuk-grup-no 
    move rez-voucher         to konuk-voucher 
    move rez-fiyat-konumu    to konuk-fiyat-konumu 
    move rez-nor-indirim     to konuk-nor-indirim 
    move rez-pan-tipi        to konuk-pan-tipi
    move rez-tipi            to konuk-rez-tipi 
    move rez-banka           to konuk-banka
    move rez-doviz           to konuk-doviz 
    move rez-anlasma         to konuk-anlasma
    move rez-pazar           to konuk-pazar
    move rez-share           to konuk-share
    move rez-eb              to konuk-eb
    move rez-ug-ind          to konuk-ug-indirimi
    move rez-fiyat-fix       to konuk-fiyat-fix
    move rez-kur-aygun       to konuk-kur-aygun
    move rez-cin-kuru        to konuk-kur-DEGERI
    move rez-bilbord-eh      to konuk-bilbord-eh
    move REZ-AKSIYON-EH      to konuk-AKSIYON-EH  
    move REZ-share           to konuk-share
    move rez-vip             to konuk-vip
    move rez-gir-tar         to konuk-gel-tar 
    move rez-cik-tar         to konuk-git-tar 
    move rez-not1            to konuk-acik-1 
    move rez-not2            to konuk-acik-2
    move rez-gel-saat        to konuk-gel-saat
    move rez-gel-dak         to konuk-gel-dakika
    move rez-late-zaman      to konuk-late-zaman

    move rez-git-saat        to konuk-git-saat
    move rez-git-dak         to konuk-git-dakika

    move "I"                 to konuk-durumu
     if konuk-git-tar <= tarih-tasi
         move "H"                 to konuk-durumu
     end-if
    move "R"                 to konuk-fol-kodu. 
         initialize rez-ucreti tl-toplam dv-toplam. 
    move rez-fiyati          to rez-ucreti dv-toplam konuk-dv-degeri
                                . 
****>Ozluk Bilgileri ataniyor.....
    move rez-adres1          to ozluk-adres1.
    move rez-adres2          to ozluk-adres2.
    move rez-e-mail          to ozluk-e-mail.
    move rez-telno           to ozluk-telno.
    move konuk-folio to rez-folio
              
    move "E" to rez-c-in
    rewrite rez-rec invalid if debug = 1 then stop " " end-if  end-rewrite
    compute  konuk-oda-tutar  rounded = REZ-FIYATI * konuk-kur-degeri          
    write konuk-rec  invalid if debug = 1 then stop " " end-if end-write
    write ozluk-rec  invalid if debug = 1 then stop " " end-if end-write

      .

*****************************************
*
 eb-anl-al.

        move "ratekod.txt" to fidetext-adi
        open input fidetext
       
       
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                   move fidetext-rec(1:10) to frate-kodu
                   move function numval ( fidetext-rec(63:2)) to   frate-anlasma
                   move function numval ( fidetext-rec(102:1))  to   frate-eb
                   write frate-rec invalid if debug = 1 then stop " " end-if  end-write
            end-read
        end-perform .
        close fidetext.



*
 depkod-al.
        
         move "depart.txt" to fidetext-adi
         open input fidetext
        
         open output fdepkod
      
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
             
                initialize fdepkod-rec  depkod-rec
                move  fidetext-rec(1:10) to Fdepkod-FIDE-KODU
                move function upper-case (fidetext-rec(32:25)) to Fdepkod-adi  depkod-adi 
                move function numval (fidetext-rec(63:3)) to depkod-kodu, Fdepkod-asya-KODU 
                move  fidetext-rec(71:1) to ba
                move  fidetext-rec(80:1) to pay
                 move 1 to depkod-tipi
                evaluate ba 
                  when "1" 
                    move "B" to  depkod-ba
                      move 1 to depkod-turu
                  when "5" 
                    move "A" to  depkod-ba
                    evaluate pay
                        when "1" 
                        when "0"
                        when "4"
                           move 3 to depkod-turu
                        when "2" 
                           move 4 to depkod-turu
                        when "3"
                           move 5 to depkod-turu
                         when other 
                            move 1 to depkod-turu
                    end-evaluate
                  when other 
                    if debug = 1 then stop " " end-if
                end-evaluate

                write depkod-rec invalid if debug = 1 then stop " " end-if end-write
                write fdepkod-rec invalid stop "dgfd " end-write
        
            end-read
         end-perform 
          move 802 to depkod-kodu
          move "A" to depkod-ba
          move 2 to depkod-turu
          move 1 to depkod-tipi
          move "CORRECTION (-)  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write


          move 801 to depkod-kodu
          move "B" to depkod-ba
          move 2 to depkod-turu
          move 1 to depkod-tipi
          move "CORRECTION (+)  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write

           move 808 to depkod-kodu
          move "B" to depkod-ba
          move 3 to depkod-turu
          move 1 to depkod-tipi
          move "GUEST REFUND  " to depkod-adi
          write depkod-rec invalid if debug = 1 then stop " " end-if end-write


         close fidetext fdepkod

         .    
*****************************************   
*****************************************
*

             
*
 hata-goster.
    call "c$rerr" using extend-stat text-message 1.
    move extend-stat       to fileerr-linkage-hata-no.
    move Secondary-Error   to fileerr-linkage-secondary-hata-no.
    call "c$rerrname" using fileerr-linkage-dosya-adi.
    display message box "DOSYA : ",fileerr-linkage-dosya-adi,
    x"0a0d","errrrror :",fileerr-linkage-hata-no,x"0ad0",
    "error2 :",fileerr-linkage-secondary-hata-no.
    set exit-pushed to true
    if debug = 1 then stop " " end-if
    .       
*
 cash-ac.
          move "extfolio.txt" to fidetext-adi
         open input fidetext
         read fidetext next no lock
                end move "10" to fs-fidetext
         end-read
         perform until fs-fidetext = "10"
            read fidetext next no lock
                end move "10" to fs-fidetext
                not end
                 initialize konuk-rec frez-rec
                add 1 to fol-sira 
                initialize frez-rec

                move fol-sira to frez-asya-efolio-kodu
                move fol-sira to konuk-folio 
                move 9000 to konuk-acenta

                 move   fidetext-rec(104:8)    to KONUK-GEL-TAR konuk-git-tar
                 if   fidetext-rec(113:8)  = spaces
                       move "31" to konuk-git-gun
                       move "12" to konuk-git-ay
                  else
                        move   fidetext-rec(113:8)    to KONUK-GIt-TAR
                 end-if
                move    fidetext-rec(32:20)    to KONUK-adi
                move    fidetext-rec(68:20)    to KONUK-soyadi
                move "9999" to konuk-odano
                move "E" to konuk-fol-kodu
                move "01" to konuk-odeme-tipi
                move CINPARA-EXT-FOL-BANKA to konuk-banka
                move  CINPARA-EXT-FOL-DOVIZ to konuk-doviz
                move  CINPARA-EXT-FOL-PAN  to konuk-pan-tipi
                
                move  CINPARA-EXT-FOL-ULKE  to konuk-ulke
                move  CINPARA-EXT-FOL-AYGUN to konuk-kur-aygun
                
                if fidetext-rec(132:8) not = spaces then
                  move fidetext-rec(132:8) to konuk-git-tar
                  move "H" to konuk-durumu
                      else 
                  move "I" to konuk-durumu
               end-if

                write konuk-rec invalid if debug = 1 then stop " " end-if end-write
                write frez-rec invalid stop "dgfd " end-write
        
            end-read
         end-perform.
         close fidetext
         .

*
 eski-fol.
    move "eskfol.txt"  to fidetext-adi
   
    open input fidetext
    
    open i-o  frez froom fextra konuk ozluk facenta  acenta
    initialize  sayac
    perform until fs-fidetext = "10"
        initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
        add 1 to sayac
        if sayac = 1
           exit perform cycle
        end-if

        evaluate function numval(fidetext-rec(157:1)) 
          when 0
              initialize frez-rec
           move function numval(fidetext-rec(1:8))     to ydk-froom-fide-kodu
           move ydk-froom-fide-kodu                    to froom-fide-kodu
           
           move function numval (fidetext-rec(105:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                          to frez-fide-rez-kodu
           read frez no lock invalid 
             continue 
           end-read       
           move function numval (fidetext-rec(1:8))       to ydk-fide-rfolio-kodu
           move ydk-fide-rfolio-kodu                      to frez-fide-rfolio

           write frez-rec invalid 
                 rewrite frez-rec end-rewrite 
           end-write          
             
          when 3
           
           perform efolio-ac2
           move function numval(fidetext-rec(1:8))     to ydk-fextra-fide-kodu
           move ydk-fextra-fide-kodu                   to fextra-fide-kodu
           write fextra-rec invalid 
                 if debug = 1 then stop " " end-if 
           end-write
           
          when 2
                 initialize frez-rec
           move function numval(fidetext-rec(1:8))     to ydk-froom-fide-kodu
           move ydk-froom-fide-kodu                    to froom-fide-kodu
           move function numval (fidetext-rec(105:8))   to ydk-froom-fide-rez-kodu

           
           move ydk-froom-fide-rez-kodu                to froom-fide-rez-kodu         
           
           move function numval (fidetext-rec(105:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                          to frez-fide-rez-kodu
           read frez no lock invalid 
             continue 
           end-read       
           move function numval (fidetext-rec(1:8))       to ydk-fide-rfolio-kodu
           move ydk-fide-rfolio-kodu                      to frez-fide-rfolio

           write frez-rec invalid 
                 rewrite frez-rec end-rewrite 
           end-write          
          when 1
              initialize frez-rec
           move function numval(fidetext-rec(114:8))    to ydk-grup-no
           
           move function numval(fidetext-rec(95:8))    to ydk-froom-fide-kodu
           move ydk-froom-fide-kodu                    to froom-fide-kodu
           move function numval (fidetext-rec(105:8))   to ydk-froom-fide-rez-kodu
           move ydk-froom-fide-rez-kodu                to froom-fide-rez-kodu         
           
           move function numval(fidetext-rec(1:8))      to ydk-fextra-fide-kodu
           
           move ydk-fextra-fide-kodu                    to fextra-fide-kodu 
        

           move function numval (fidetext-rec(105:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                         to frez-fide-rez-kodu
           
           read frez no lock invalid 
                continue 
           end-read       
            if ydk-grup-no not = ydk-fide-rez-kodu 
             move  ydk-grup-no to frez-master
           end-if
           move function numval (fidetext-rec(95:8))      to ydk-fide-rfolio-kodu
           move ydk-fide-rfolio-kodu                      to frez-fide-rfolio

           move function numval (fidetext-rec(1:8))       to ydk-fide-efolio-kodu
           move ydk-fide-efolio-kodu                      to frez-fide-efolio

           write frez-rec invalid 
                 rewrite frez-rec end-rewrite 
           end-write
            
          when other
            if debug = 1 then stop " " end-if
        end-evaluate

    end-read
    end-perform
    close fidetext frez froom fextra konuk ozluk facenta acenta.
*
 in-fol.
    move "infol.txt"  to fidetext-adi
    open input fidetext
    
    open i-o  frez fextra konuk facenta ozluk froom  acenta
    initialize  sayac ydk-fextra-fide-kodu ydk-fextra-fide-kodu
    perform until fs-fidetext = "10"
        initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
        add 1 to sayac

        if sayac = 1
           exit perform cycle
        end-if
 
        evaluate function numval(fidetext-rec(34:1)) 
          when 0
              initialize frez-rec
           move function numval(fidetext-rec(25:8))    to ydk-froom-fide-kodu
           move ydk-froom-fide-kodu                    to froom-fide-kodu
           move function numval (fidetext-rec(58:8))   to ydk-froom-fide-rez-kodu
           move ydk-froom-fide-rez-kodu                to froom-fide-rez-kodu         
           
           move function numval (fidetext-rec(58:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                         to frez-fide-rez-kodu
           read frez no lock invalid 
             continue 
           end-read       
           move function numval (fidetext-rec(25:8))      to ydk-fide-rfolio-kodu
           move ydk-fide-rfolio-kodu                      to frez-fide-rfolio

           write frez-rec invalid 
                 rewrite frez-rec end-rewrite 
           end-write          
           
          when 3
          
           perform efolio-ac
           move function numval(fidetext-rec(25:8))    to ydk-fextra-fide-kodu
           move ydk-fextra-fide-kodu                   to fextra-fide-kodu 
           write fextra-rec invalid 
                 if debug = 1 then stop " " end-if 
           end-write
          
          when 2
           initialize frez-rec
           move function numval(fidetext-rec(25:8))    to ydk-froom-fide-kodu
           move ydk-froom-fide-kodu                    to froom-fide-kodu
           move function numval (fidetext-rec(58:8))   to ydk-froom-fide-rez-kodu
           move ydk-froom-fide-rez-kodu                to froom-fide-rez-kodu         
           
           move function numval (fidetext-rec(58:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                         to frez-fide-rez-kodu
           read frez no lock invalid 
             continue 
           end-read       
           move function numval (fidetext-rec(25:8))      to ydk-fide-rfolio-kodu
           move ydk-fide-rfolio-kodu                      to frez-fide-rfolio

           write frez-rec invalid 
                 rewrite frez-rec end-rewrite 
           end-write          
          when 1
            move function numval(fidetext-rec(68:8))    to ydk-master
            
              initialize frez-rec
           move function numval(fidetext-rec(45:8))    to ydk-froom-fide-kodu
           move ydk-froom-fide-kodu                    to froom-fide-kodu
           move function numval (fidetext-rec(58:8))   to ydk-froom-fide-rez-kodu
           move ydk-froom-fide-rez-kodu                to froom-fide-rez-kodu
         
          

           move function numval(fidetext-rec(25:8))       to ydk-fextra-fide-kodu
           move ydk-fextra-fide-kodu                      to fextra-fide-kodu
           move function numval (fidetext-rec(58:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                         to frez-fide-rez-kodu
           

           move function numval (fidetext-rec(58:8))      to ydk-fide-rez-kodu
           move ydk-fide-rez-kodu                         to frez-fide-rez-kodu
           read frez no lock invalid 
                continue 
           end-read       
           if ydk-master not = ydk-fide-rez-kodu 
             move  ydk-master to frez-master
           end-if
           move function numval (fidetext-rec(45:8))      to ydk-fide-rfolio-kodu
           move ydk-fide-rfolio-kodu                      to frez-fide-rfolio

           move function numval (fidetext-rec(25:8))      to ydk-fide-efolio-kodu
           move ydk-fide-efolio-kodu                      to frez-fide-efolio

           write frez-rec invalid 
                 rewrite frez-rec end-rewrite 
           end-write
            
          when other
*             if debug = 1 then stop " " end-if
        end-evaluate
        
    end-read
    end-perform
    close fidetext frez fextra konuk facenta ozluk froom acenta.
*
*
 efolio-ac2.
     add 1 to fol-sira 
     move fol-sira               to fextra-asya-kodu 
     move  fextra-asya-kodu  to konuk-folio ozluk-folio ozluk2-folio.         
     move cinpara-ext-fol-banka  to banka-kodu.     
     move cinpara-ext-fol-doviz  to doviz-kodu.                   
     move cinpara-ext-fol-ode    to kodlar02-kodu. 
     move 9999           to konuk-odano
*          move rez-no to  konuk-extra-rez-no 
*          if konuk-git-tar <= tarih-tasi          
*              move "H"                 to konuk-durumu
*          end-if
          move "E"  to konuk-fol-kodu. 
          move "E=>"                to konuk-adi(01:03). 
          move fidetext-rec(34:30)  to konuk-adi(04:17). 
          

***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar   konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno konuk-bos. 

          move konuk-durumu         to ozluk-durumu. 
          move fidetext-rec(133:2)  to konuk-gel-gun
          move fidetext-rec(136:2)  to konuk-gel-ay
          move fidetext-rec(139:4)  to konuk-gel-yil

          move fidetext-rec(145:2)  to konuk-git-gun
          move fidetext-rec(148:2)  to konuk-git-ay
          move fidetext-rec(151:4)  to konuk-git-yil
          
              move "H"    to  konuk-durumu             
          
          move fidetext-rec(79:15) to facenta-fide-kodu
          read facenta no lock invalid
             add 1 to ydk-acenta
             if ydk-acenta = 6600 or 5800 or 200 or 300 or
              5500 or 0400 or 0600 or 6200 or 0800 or 1200 or 6500 or 
              6000 or 1800 or 6700 or 2000 or 2200 or 6400 or 2400 or 
              2500 or 2600 or 2800 or 5900 or 3000 or 3100 or 5600 or 
              3200 or 3600 or 3400 or 3500 or 5700 or 4000 or 4100 or 
              4200 or 4400 or 4600 or 4700 or 4800 or 6100 or 6300 or 
              4900 then 
              add 1 to ydk-acenta
             end-if
            move ydk-acenta        to facenta-asya-kodu
            
            move facenta-asya-kodu to acenta-kodu
            move facenta-fide-kodu to acenta-adi
            write acenta-rec invalid if debug = 1 then stop " " end-if end-write
            write facenta-rec invalid if debug = 1 then stop " " end-if end-write



          end-read
          move facenta-asya-kodu    to konuk-acenta
          move "AL"                 to konuk-pan-tipi
          move fidetext-rec(34:30)  to ozluk-adi(04:17). 
          move "E=>"                to ozluk-adi(01:03). 
          move 01                   to konuk-odeme-tipi
          move banka-kodu           to konuk-banka
          move 01                   to konuk-anlasma
          move 01                   to konuk-pazar
          move 001                  to konuk-ulke
          move 01                   to konuk-doviz
          write konuk-rec invalid if debug = 1 then stop " " end-if
          end-write.                         
          write ozluk-rec invalid if debug = 1 then stop " " end-if
          end-write.
*
 efolio-ac.
     add 1 to fol-sira 
     move fol-sira               to fextra-asya-kodu 
     move fextra-asya-kodu  to konuk-folio ozluk-folio ozluk2-folio.         
     move cinpara-ext-fol-banka  to banka-kodu.     
     move cinpara-ext-fol-doviz  to doviz-kodu.                   
     move cinpara-ext-fol-ode    to kodlar02-kodu.
     move 9999           to konuk-odano
*          move rez-no to  konuk-extra-rez-no 
*          if konuk-git-tar <= tarih-tasi          
*              move "H"                 to konuk-durumu
*          end-if
          move "E"  to konuk-fol-kodu. 
          move "E=>"                to konuk-adi(01:03). 
          move fidetext-rec(91:30)  to konuk-adi(04:17). 
          move "E=>"                to konuk-adi(01:03). 
          move fidetext-rec(91:30)  to konuk-soyadi(04:17)

***********>Gereksiz bilgiler sifirlaniyor........... 
          initialize  konuk-rez-no 
          konuk-kisi  konuk-voucher  konuk-nor-indirim 
          konuk-cik-cikma 
          konuk-oda-tutar   konuk-extbed-tutar konuk-kahvalti-tutar 
          konuk-ogle-tutar  konuk-aksam-tutar konuk-icecek-tutar 
          konuk-extra-tutar konuk-top-borc konuk-top-alac konuk-kur-degeri 
          konuk-dv-degeri konuk-dv-degeri konuk-acik konuk-kartno konuk-bos. 

          move konuk-durumu         to ozluk-durumu. 
          move fidetext-rec(174:2)  to konuk-gel-gun
          move fidetext-rec(177:2)  to konuk-gel-ay
          move fidetext-rec(180:4)  to konuk-gel-yil

          move fidetext-rec(186:2)  to konuk-git-gun
          move fidetext-rec(189:2)  to konuk-git-ay
          move fidetext-rec(192:4)  to konuk-git-yil
          if konuk-git-tar >= tarih-tasi
              move "I"    to  konuk-durumu
          else
              move "H"    to  konuk-durumu             
          end-if
          move fidetext-rec(140:12) to facenta-fide-kodu
          read facenta no lock invalid 
            add 1 to ydk-acenta
            if ydk-acenta = 6600 or 5800 or 200 or 300 or
              5500 or 0400 or 0600 or 6200 or 0800 or 1200 or 6500 or 
              6000 or 1800 or 6700 or 2000 or 2200 or 6400 or 2400 or 
              2500 or 2600 or 2800 or 5900 or 3000 or 3100 or 5600 or 
              3200 or 3600 or 3400 or 3500 or 5700 or 4000 or 4100 or 
              4200 or 4400 or 4600 or 4700 or 4800 or 6100 or 6300 or 
              4900 then 
              add 1 to ydk-acenta
             end-if
            move ydk-acenta        to facenta-asya-kodu
            
            move facenta-asya-kodu to acenta-kodu
            move facenta-fide-kodu to acenta-adi
            write acenta-rec invalid if debug = 1 then stop " " end-if end-write
            write facenta-rec invalid if debug = 1 then stop " " end-if end-write




          end-read
          move facenta-asya-kodu    to konuk-acenta
          move "AL"                 to konuk-pan-tipi
          move fidetext-rec(91:30)  to ozluk-adi(04:17). 
          move "E=>"                to ozluk-adi(01:03). 
          move 01                   to konuk-odeme-tipi
          move banka-kodu           to konuk-banka
          move 01                   to konuk-anlasma
          move 01                   to konuk-pazar
          move 001                  to konuk-ulke
          move 01                   to konuk-doviz
          write konuk-rec invalid if debug = 1 then stop " " end-if
          end-write.                         
          write ozluk-rec invalid if debug = 1 then stop " " end-if
          end-write.



*
 ahrkes-al.
    
    move "trtum.txt"  to fidetext-adi
    move "trtum2.txt" to amontext-adi
    open input fidetext 
    open i-o frez froom fextra
    open output amontext
    move 0 to frez-fide-rez-kodu
    read frez no lock invalid continue
    not invalid delete frez end-delete
    end-read

    initialize rez-rec
    read fidetext next no lock
    end continue
    end-read
    move 1 to sayac
    initialize amontext-rec
     move fidetext-rec(27:8) to amontext-det(1)
     move fidetext-rec(46:10) to amontext-det(2)

     move fidetext-rec(57:10)  to amontext-det(3)

     move fidetext-rec(69:5)  to amontext-det(4)
     MOVE Fidetext-rec(15:3)  to amontext-det(5)
     move fidetext-rec(132:5) to amontext-det(7)
     move fidetext-rec(177:8) to amontext-det(8)
     move fidetext-rec(190:8) to amontext-det(9) 
     move fidetext-rec(36:8) to amontext-det(10)
     move fidetext-rec(46:10) to amontext-det(12)
    
   
    
    read fidetext next no lock
    end continue
    end-read
    perform until fs-fidetext = "10"
    initialize fidetext-rec    
    read fidetext next no lock
    end 
    not end
    move 1 to sayac
    initialize amontext-rec
     move fidetext-rec(27:8) to amontext-det(1)
     move fidetext-rec(46:10) to amontext-det(2)

     move fidetext-rec(57:10)  to amontext-det(3)

     move fidetext-rec(69:5)  to amontext-det(4)
     MOVE Fidetext-rec(15:3)  to amontext-det(5)
     move fidetext-rec(132:5) to amontext-det(7)
     move fidetext-rec(177:8) to amontext-det(8)
     move fidetext-rec(190:8) to amontext-det(9)
     move fidetext-rec(36:8) to amontext-det(10)
     move fidetext-rec(80:8) to amontext-det(11)
     move fidetext-rec(46:10) to amontext-det(12)
*       if function numval(amontext-det(12)) = 2036458 then stop " "
*       end-if
        move 0 to bulundu  
        
      
         move function numval (amontext-det(1))       to ydk-amontext-folio-no
        if  ydk-amontext-folio-no = 0 then exit perform cycle end-if
          initialize frez-rec       
         move ydk-amontext-folio-no to frez-fide-rfolio
                            
         start frez key >= frez-fide-rfolio
           invalid continue
           not invalid
             read frez next no lock end continue
             not end 
              if ydk-amontext-folio-no = frez-fide-rfolio  
               move frez-asya-rfolio-kodu  to konuk-folio
               read konuk no lock invalid
                   continue
                  not invalid
                    move 1 to bulundu
                    move frez-asya-rfolio-kodu  to romhrk-folio
                    perform room-yaz

               end-read  
               end-if
             end-read
         end-start
          if bulundu = 1 then exit perform cycle end-if
            initialize frez-rec       
          move ydk-amontext-folio-no to frez-fide-efolio      
         start frez key >= frez-fide-efolio
           invalid continue
           not invalid
             read frez next no lock end continue
             not end 
              if ydk-amontext-folio-no = frez-fide-efolio
                move frez-asya-efolio-kodu to konuk-folio
               read konuk no lock invalid
                   continue
                  not invalid
                     move frez-asya-efolio-kodu  to exthrk-folio
                        perform extra-yaz


                        move 1 to bulundu

               end-read  


               
               end-if
             end-read
         end-start
          if bulundu = 1 then exit perform cycle end-if
         
             initialize fextra-rec    
          move ydk-amontext-folio-no to fextra-fide-kodu
          read fextra no lock invalid continue 
          not invalid
            move  fextra-asya-kodu  to exthrk-folio
               move exthrk-folio to konuk-folio
               read konuk no lock invalid
                   continue
                  not invalid
                     
                        perform extra-yaz


                        move 1 to bulundu

               end-read  
          end-read
          if bulundu = 1 then exit perform cycle end-if
               initialize frez-rec 
          move function numval (amontext-det(10)) to ydk-master
              move ydk-master to frez-master
                    
         start frez key >= frez-master
           invalid continue
           not invalid
             read frez next no lock end continue
             not end 
              if ydk-master = frez-master

                 move frez-asya-rfolio-kodu to konuk-folio
               read konuk no lock invalid
                   continue
                  not invalid
                     move frez-asya-rfolio-kodu  to romhrk-folio
                        perform room-yaz


                        move 1 to bulundu

               end-read  


               
               end-if
             end-read
         end-start


          if bulundu = 0 
                initialize frez-rec       
              move function numval (amontext-det(10)) to ydk-fide-rez-kodu
              move ydk-fide-rez-kodu to frez-fide-rez-kodu
              read frez no lock 
                 invalid 
                   stop " "
                     not invalid 
                      move function numval (amontext-det(5))       to ydk-depkod
                       if ydk-depkod = 201 or ydk-depkod = 301 
                            move 101 to ydk-depkod
                       end-if
                     if ydk-depkod(2:2) = "01" or "02" then 
                       move frez-asya-rfolio-kodu to konuk-folio
                       read konuk no lock invalid
                         stop " "
                         not invalid
                         move konuk-folio to romhrk-folio
                         perform room-yaz
                       end-read
                       else
                       move frez-asya-efolio-kodu to konuk-folio
                       read konuk no lock invalid
                         stop " "
                         not invalid
                         move konuk-folio to exthrk-folio
                         perform extra-yaz
                       end-read


                     end-if
              end-read
          


          end-if
         write amontext-rec end-write
    end-read
    end-perform
    close fidetext 
    close amontext
    close frez froom fextra
     .



 extra-yaz.
     initialize exthrk-corr-depkod
     move amontext-det(3)(1:2)   to exthrk-gun
     move amontext-det(3)(4:2)   to exthrk-ay
     move amontext-det(3)(7:4)   to exthrk-yil
     move amontext-det(4)(1:2)   to exthrk-saat
     move amontext-det(4)(4:2)   to exthrk-dakika
     move amontext-det(4)(7:2)   to exthrk-saniye
           
        

           
     move function numval (amontext-det(5))       to ydk-depkod
     move ydk-depkod             to exthrk-depkod     
     
        move function numval (amontext-det(8))       to ydk-tutar
           
        move  function numval (amontext-det(9))      to ydk-tutar-a

        if ydk-tutar-a not = 0
        if ydk-tutar-a < 0 then
          move "B"        to exthrk-ba
          move "194"      to exthrk-depkod
          move "199"      to exthrk-corr-depkod
           if amontext-det(11)(1:5) = "AVANS" or 
              amontext-det(11)(1:5) = "PESIN"
              move 196      to exthrk-corr-depkod 
           end-if
           if amontext-det(11)(1:5) = "VISA "
              move 199     to exthrk-corr-depkod
           end-if

          compute exthrk-tl-tutar rounded = 
              ydk-tutar-a * (- 1)
          else
            move "A"        to exthrk-ba
           move "199"       to exthrk-depkod
 
           if amontext-det(11)(1:5) = "AVANS" or 
              amontext-det(11)(1:5) = "PESIN"
              move 196      to exthrk-depkod 
           end-if
           if amontext-det(11)(1:5) = "VISA "
              move 199     to exthrk-depkod
           end-if
           compute exthrk-tl-tutar rounded = 
                     ydk-tutar-a 

         end-if
          add 1 to uuasya-sira
           move uuasya-sira to exthrk-islem
          write exthrk-rec invalid stop " " end-write
       end-if
        initialize exthrk-corr-depkod
        if ydk-tutar not = 0
        if ydk-tutar < 0 then
          move "A"        to exthrk-ba
          move "195"      to exthrk-depkod
          move ydk-depkod to exthrk-corr-depkod
          compute exthrk-tl-tutar rounded = 
              ydk-tutar * (- 1)
          else
            move "B"        to exthrk-ba
           move ydk-depkod       to exthrk-depkod
           compute exthrk-tl-tutar rounded = 
                     ydk-tutar 

         end-if
          add 1 to uuasya-sira
           move uuasya-sira to exthrk-islem
          write exthrk-rec invalid stop " " end-write
       end-if

        
          .


* 
 room-yaz.
          initialize romhrk-corr-depkod
     move amontext-det(3)(1:2)   to romhrk-gun
     move amontext-det(3)(4:2)   to romhrk-ay
     move amontext-det(3)(7:4)   to romhrk-yil
     move amontext-det(4)(1:2)   to romhrk-saat
     move amontext-det(4)(4:2)   to romhrk-dakika
     move amontext-det(4)(7:2)   to romhrk-saniye
           
        

            move uuasya-sira to romhrk-islem
     move function numval (amontext-det(5))       to ydk-depkod
     if ydk-depkod = 201 or ydk-depkod = 301 
       move 101 to ydk-depkod
     end-if
     move ydk-depkod             to romhrk-depkod 
     
     
        move function numval (amontext-det(8))       to ydk-tutar
           
        move  function numval (amontext-det(9))      to ydk-tutar-a
        
        if ydk-tutar-a not = 0
        if ydk-tutar-a < 0 then
          move "B"        to romhrk-ba
          move "194"      to romhrk-depkod

          move "199" to romhrk-corr-depkod
           if amontext-det(11)(1:5) = "AVANS" or 
              amontext-det(11)(1:5) = "PESIN"
              move 196      to romhrk-corr-depkod 
           end-if
           if amontext-det(11)(1:5) = "VISA "
              move 199     to romhrk-corr-depkod
           end-if

          compute romhrk-tl-tutar rounded = 
              ydk-tutar-a * (- 1)
          else
           move "A"        to romhrk-ba
           move "199"      to romhrk-depkod
           if amontext-det(11)(1:5) = "AVANS" or 
              amontext-det(11)(1:5) = "PESIN"
              move 196      to ROMHRK-depkod 
           end-if
           if amontext-det(11)(1:5) = "VISA "
              move 199     to romhrk-depkod
           end-if
           compute romhrk-tl-tutar rounded = 
                     ydk-tutar-a 

         end-if
          add 1 to uuasya-sira
              move uuasya-sira to romhrk-islem
          write romhrk-rec invalid stop " " end-write
       end-if
        initialize romhrk-corr-depkod
        if ydk-tutar not = 0
        if ydk-tutar < 0 then
          move "A"        to romhrk-ba
          move "195"      to romhrk-depkod
          move ydk-depkod to romhrk-corr-depkod
          compute romhrk-tl-tutar rounded = 
              ydk-tutar * (- 1)
          else
            move "B"        to romhrk-ba
           move ydk-depkod       to romhrk-depkod
           compute romhrk-tl-tutar rounded = 
                     ydk-tutar 

         end-if
          add 1 to uuasya-sira
              move uuasya-sira to romhrk-islem
          write romhrk-rec invalid stop " " end-write
       end-if

          .







       .


 
