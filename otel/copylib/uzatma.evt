* uzatma.evt
* uzatma.evt is generated from D:\asya\acugt.ytl\otel\uzatma.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Exception-Proc.
     PERFORM Exception-Procedure
     .

 a2-Exception-Proc.
     PERFORM Exception-Procedure
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
     perform icyetki-kontrol.
     call "c$narg" using link-var.
     perform adresleri-tasi.
     open input genel   kllnc
     move 1 to genel-anahtar
     read genel no lock invalid continue
          not invalid
          move calis-yil    to  title-yil
          move calis-ay     to  title-ay
          move calis-gun    to  title-gun
     end-read
     close genel.

     move k-kodu-tasi to k-kodu
     read kllnc no lock invalid continue
     end-read
     close kllnc
     open input kodlar02 odalar.
     open i-o konuk odalar2.
     initialize gec-gecme.
     .
*
 accept-odano-Bef-Procedure.
     initialize eski-tarih yeni-tarih form-acik.
     initialize short-var-yok uzat-kisalt kayit-izni.
     if key-status = 1 and oda-no not = spaces
        exit paragraph
     end-if.
     initialize oda-no.
     if link-var  = 1
        move link-oda  to o-kisa 
            perform oda-uzat
            move o-uzun to  oda-no
        modify accept-odano
     end-if.

     modify button-odaara enabled = true.
     modify button-kaydet enabled = kayit-izni.
     modify accept-foliono value = zeroes

     modify lb-foliono-e   title = spaces
     modify fr-foliotipi-e title = spaces
     modify lb-adi-e       title = spaces
     modify lb-soyadi-e    title = spaces
     modify lb-girtar-e    title = spaces
     modify lb-ciktar-e    title = spaces
     modify fr-pansiyon-e  title = spaces
     modify lb-pansiyon-e  title = spaces
     modify fr-odeme-e     title = spaces
     modify lb-odeme-e     title = spaces
     modify lb-topborc-e   title = spaces
     modify lb-topalacak-e title = spaces
     modify lb-bakiye-e    title = spaces
     display form1.
    if burdan-gitti = 0 then 
       move 1 to burdan-gitti
         perform bef-procedure
        move 0 to burdan-gitti
    end-if
     .
     .
*
 exception-procedure.
     move control-id to gidis-id
     evaluate key-status
         when 1 
            evaluate control-id
              when  1001 
              when  14
               perform oda-ara thru oda-ara-exit
            end-evaluate

         when 2 
              if tum-aktar = 1
                move oda-no to          o-uzun
            perform oda-kisalt
            move o-kisa to   oda-no-k 

                  initialize konuk-rec fol-dizi
                  move "I"          to konuk-durumu
                  move oda-no-k       to konuk-odano
                  start konuk key not < konuk-oda invalid 
                       continue 
                  not invalid 
                  perform until fs-konuk = "10"
                  read konuk next no lock end move "10" to fs-konuk
                  not at end 
                         if konuk-durumu <> "I"
                            exit perform 
                         end-if 
                         if konuk-odano <> oda-no-k
                             exit perform   
                         end-if 
                         add 1                     to fol-adet 
                         move konuk-folio          to fol-dizi-folio-no(fol-adet)                                                   
                  end-read 
                  end-perform
                  end-start
 
                  perform varying u from 1 by 1 until u > 50
                      if fol-dizi-folio-no(u)  = zeroes    
                          exit perform cycle 
                      end-if 
                          move fol-dizi-folio-no(u) to folio-no
                          move folio-no             to konuk-folio     
                          read konuk no lock invalid 
                               move 1 to gec-gecme
                               exit paragraph                    
                          not invalid 
                               continue 
                               if konuk-durumu not = "I"
                                  move 1 to gec-gecme
                                  exit paragraph
                               end-if
                          end-read
                          perform form-kaydet
                  end-perform                  
              else
                perform form-kaydet
              end-if 
              
     end-evaluate.
*
 form-kaydet.
     perform kontroller
     if gecmez
        initialize gec-gecme
        move 4        to accept-control
        move gidis-id to control-id
        exit paragraph
     end-if
     if evet-basildi not = 1
        initialize mesaj-degiskenler
        move "[ Extention ] Islemi Baslasin mi ?..."  to mmesaj-1
        move " [ Islem Basla ] " to mmesaj-title
        move 2           to mmesaj-type
        move 1           to mmesaj-icon
        move 1           to mmesaj-default
        perform mmesaj-ver
        if donus-kodu = 2
           move 4        to accept-control
           move gidis-id to control-id
           initialize evet-basildi
           exit paragraph
        end-if
     end-if 
     
     initialize evet-basildi
     move 1     to evet-basildi

     perform kaydet thru kaydet-exit
     move 4    to accept-control
     move 1001 to control-id.
*                                  
 bef-procedure.
     move control-value    to sonraki-kontrol
     move control-id       to sonraki-id
*     display message box "o-k->" onceki-kontrol, new-line
*                         "S-k->" sonraki-kontrol, new-line
*                         "O-id->" onceki-id, new-line
*                         "S-Id->" sonraki-id, new-line
*                         "key-->" key-status new-line
*                         "gec-gecme-->" gec-gecme.
***>Onceki Kontrole gidebildin ama sonrakine gidemesin....
     if gecmez
        if sonraki-kontrol not = 2
           if sonraki-kontrol > onceki-kontrol
              move 4         to accept-control
              move onceki-id to control-id
              exit paragraph
           end-if
        end-if
     end-if
     evaluate control-id
       when 1001
            modify button-odaara enabled = true
       when 1002
       when 1003
       when 1004
            initialize kayit-izni
            modify button-kaydet enabled = kayit-izni
     end-evaluate.

     initialize mesaj.
     evaluate control-id
          when 1001
              evaluate true
                  when turkce
                       move "Oda Numarasi Giriniz F1->Oda No Ara..." to mesaj
                  when almanca
                       move "Oda Numarasi Giriniz F1->Oda No Ara..." to mesaj
                  when ingilizce
                       move "Oda Numarasi Giriniz F1->Oda No Ara..." to mesaj
              end-evaluate
          when 1002
          when 1003
          when 1004
              evaluate true
                  when turkce
                       move "Yeni Cikis Tarihi Giriniz..." to mesaj
                  when almanca
                       move "Yeni Cikis Tarihi Giriniz..." to mesaj
                  when ingilizce
                       move "Yeni Cikis Tarihi Giriniz..." to mesaj
              end-evaluate
          when 1005
              evaluate true
                  when turkce
                       move "Aciklama Giriniz......." to mesaj
                  when ingilizce
                       move "Aciklama Giriniz......." to mesaj
                  when almanca
                       move "Aciklama Giriniz......." to mesaj
              end-evaluate
          when 1006
              evaluate true
                  when turkce
                       move "Extention Islemini Baslat... " to mesaj
                  when ingilizce
                       move "Extention Islemini Baslat... " to mesaj
                  when almanca
                       move "Extention Islemini Baslat... " to mesaj
              end-evaluate
     end-evaluate.

     modify form1-st-1-handle,
            panel-index = 2 
            panel-text = mesaj.
     .
*
 Aft-Procedure.
      move control-value    to onceki-kontrol
      move control-id       to onceki-id
      move control-id       to gidis-id.
      initialize gec-gecme.
      evaluate control-id
       when 1001
            modify button-odaara enabled = false
         initialize gec-gecme
         if oda-no = spaces
            move 1 to gec-gecme
            exit paragraph
         end-if
         if oda-no not = spaces
         move oda-no to o-uzun
         perform oda-kisalt
         move o-kisa to oda-no-k
         move oda-no-k to odalar-anah
         read odalar no lock invalid 
              initialize mesaj-degiskenler
              move "Tanimsiz Oda Sectiniz."            to mmesaj-1
              move "Oda Numarasini Degistiriniz....."  to mmesaj-2
              move " [ Tanimsiz Oda ] " to mmesaj-title
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

              move 1 to gec-gecme
              initialize oda-no oda-no-k
              display accept-odano
              exit paragraph
         not invalid 
            if odalar-aktif-pasif = 1
              initialize mesaj-degiskenler
              move "Secilen Oda Kullanimda Degil.."            to mmesaj-1
              move " [ Tanimsiz Oda ] " to mmesaj-title
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver

              move 1 to gec-gecme
              initialize oda-no oda-no-k
              display accept-odano
              exit paragraph             
            end-if               
              
              
              continue 
         end-read
         initialize folio-no
             perform tum-oda-sor thru tum-oda-sor-exit

             if gec-gecme = 0 
              initialize folara-cagir folio-no
              move "I"     to folara-cagri-tipi
              move oda-no   to o-uzun
            perform oda-kisalt
            move o-kisa to       folara-odano
              call "/asya/ytl/obj/otel/folara.asy" using folara-cagir
                    on exception perform callerr-proc
                    not on exception
              cancel "/asya/ytl/obj/otel/folara.asy" 
              end-call
              move folara-no-cagir    to folio-no
              if folio-no = 0
                 move 1 to gec-gecme
                 exit paragraph
              end-if
              display message box "Tum Foliolar Aktarilsin Mi?"
                              title "Uyari"
                              icon 1
                              type 2
                              default 2
                              returning return-code 
              if return-code = 1
                 move 1   to tum-aktar
              else
                 move 0   to tum-aktar
              end-if 
              if tum-aktar = 1
                 move oda-no      to o-uzun
                  perform oda-kisalt
                  move o-kisa to  oda-no-k   
                  initialize konuk-rec fol-adet fol-dizi
                  move "I"          to konuk-durumu
                  move oda-no-k       to konuk-odano
                  start konuk key not < konuk-oda invalid 
                       continue 
                  not invalid 
                  perform until fs-konuk = "10"
                  read konuk next no lock end move "10" to fs-konuk
                  not at end 
                         if konuk-durumu <> "I"
                            exit perform 
                         end-if 
                         if konuk-odano <> oda-no-k
                             exit perform   
                         end-if
                         add 1                     to fol-adet 
                         move konuk-folio          to fol-dizi-folio-no(fol-adet)
                         move konuk-fol-kodu       to fol-dizi-folio-kodu(fol-adet) 
                  end-read 
                  end-perform
                  end-start 

                  perform varying u from 1 by 1 until u > 50
                      if fol-dizi-folio-no(u)  = zeroes    
                          exit perform cycle 
                      end-if 
                      if fol-dizi-folio-kodu(u) = "E"
                         exit perform cycle 
                      end-if 
                          move fol-dizi-folio-no(u) to folio-no
                          move folio-no             to konuk-folio     
                          read konuk no lock invalid 
                               move 1 to gec-gecme
                               exit paragraph                    
                          not invalid 
                               
                               if konuk-durumu not = "I"
                                  move 1 to gec-gecme
                                  exit paragraph
                               end-if
                          end-read
                          perform aft-kontrol
                  end-perform

              else 
                  move folio-no to konuk-folio     
                  read konuk no lock invalid 
                       move 1 to gec-gecme
                       exit paragraph                    
                  not invalid 
                       continue 
                       if konuk-durumu not = "I"
                          move 1 to gec-gecme
                          exit paragraph
                       end-if
                  end-read
                  perform aft-kontrol
              end-if              
             end-if
         end-if
       when 1004 
        initialize gec-gecme
        initialize uzat-kisalt
        open input takvim
        initialize takvim-rec
        move yeni-tarih to takvim-anah
             read takvim no lock invalid 
                  close takvim
               initialize mesaj-degiskenler
               move "Girdiginiz Tarih Tanimsiz...... "  to mmesaj-1
               move "Tarihi Kontrol Ediniz......!!!!!"  to mmesaj-2
               move " [ DIKKAT ] " to mmesaj-title
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
                       move 1     to gec-gecme
                       move 1003  to onceki-id
                      exit paragraph
             end-read
                  close takvim

        if yeni-tarih < konuk-git-tar 
           move 1 to uzat-kisalt
           if konuk-fol-kodu = "R" then 
                   if k-fiy-sup = 1 then 
                     move 1 to v-trans
                   else
                        move 0 to v-trans  trans-v
                   end-if
           else
              move 0 to v-trans   trans-v
           end-if
        else
             move 0 to v-trans trans-v
        end-if
         display Form1-Pb-1   display a1 a2 a3 fsil-Cm-1


        if yeni-tarih = konuk-git-tar 
           initialize mesaj-degiskenler
           move "Ayni Cikis Tarihini Yazdiniz...."  to mmesaj-1
           move "Tarihi Degistiriniz..!!!!!!!!!!!"  to mmesaj-2
           move " [ DIKKAT ] " to mmesaj-title
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
                   move 1     to gec-gecme
                   move 1003  to onceki-id
                   exit paragraph
        end-if 
        if yeni-tarih < konuk-gel-tar 
           initialize mesaj-degiskenler
           move "Girdiginiz Tarih C-In Tarihinden"  to mmesaj-1
           move "Kucuk Olamaz.........!!!!!!!!!!!"  to mmesaj-2
           move " [ DIKKAT ] " to mmesaj-title
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
                   move 1     to gec-gecme
                   move 1003  to onceki-id
                   exit paragraph
        end-if

        if yeni-tarih < calisma-tarihi 
           initialize mesaj-degiskenler
           move "Girdiginiz Tarih Onburo Calisma "  to mmesaj-1
           move "Tarihinden Kucuk Olamaz....!!!!!"  to mmesaj-2
           move " [ DIKKAT ] " to mmesaj-title
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
                   move 1     to gec-gecme
                   move 1003  to onceki-id
                   exit paragraph
        end-if

            if uzat
             if konuk-fol-kodu = "R"
                move "Y"  to short-var-yok
                perform short-kontrol thru short-kontrol-exit
             end-if

             if short-var and cinpara-shortta-uzat not = "E"
               initialize mesaj-degiskenler
               move "Shortta Uzatma Islemi Icin     "  to mmesaj-1
               move "Kisitlama Var. UZATMA YAPILAMAZ"  to mmesaj-2
               move " [ DIKKAT ] " to mmesaj-title
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
                       move 1     to gec-gecme
                       move 1003  to onceki-id
                      exit paragraph
             end-if
             if konuk-fol-kodu = "R"

                perform blok-kontrol thru blok-kontrol-exit
             end-if
            
            end-if
            if devam = 1 then 
                move 0 to kayit-izni
                modify button-kaydet enabled = kayit-izni 

            else
                move 1 to kayit-izni
                modify button-kaydet enabled = kayit-izni
            end-if
      end-evaluate.
      .
*
 aft-kontrol.
     perform musteri-oku thru musteri-oku-exit
     if cinpara-tumtar-uzat not = "E" 
        and konuk-git-tar > calisma-tarihi
        initialize mesaj-degiskenler
        move "Bu Odaya Uzatma Yapilamaz. Genel Parametre "  to mmesaj-1
        move "Sadece Cikis Tarihinde Uzatma Yapilabilmesi"  to mmesaj-2
        move "Icin Ayarlanmis................!!!!!!!!!!!!"  to mmesaj-3
        move " [ DIKKAT ] " to mmesaj-title
        move 1           to mmesaj-type
        move 3           to mmesaj-icon
        move 1           to mmesaj-default
        perform mmesaj-ver
                move 1 to gec-gecme
                exit paragraph
     end-if 
     modify accept-foliono value = konuk-folio
     move konuk-git-tar    to eski-tarih  yeni-tarih
     display accept-gun accept-ay accept-yil.
*
 kontroller.
         initialize gec-gecme
         inquire button-kaydet enabled in kayit-izni
         if izin-yok
            move 1     to gec-gecme
            exit paragraph
         end-if
         if oda-no = spaces
            move 1     to gec-gecme
            exit paragraph
         end-if
         if oda-no not = spaces
         move oda-no-k to odalar-anah
         read odalar no lock invalid 
              initialize mesaj-degiskenler
              move "Tanimsiz Oda Sectiniz."            to mmesaj-1
              move "Oda Numarasini Degistiriniz....."  to mmesaj-2
              move " [ Tanimsiz Oda ] " to mmesaj-title
              move 1           to mmesaj-type
              move 3           to mmesaj-icon
              move 1           to mmesaj-default
              perform mmesaj-ver
              move 1     to gec-gecme
              initialize oda-no oda-no-k
              display accept-odano
              exit paragraph
              not invalid continue 
         end-read
             if folio-no = 0
                move 1     to gec-gecme
                exit paragraph
             end-if

              move folio-no to konuk-folio     
              read konuk no lock invalid 
                   move 1 to gec-gecme
                   exit paragraph                    
                   not invalid continue 
                   if konuk-durumu not = "I"
                      move 1     to gec-gecme
                      exit paragraph
                   end-if
              end-read
         end-if 


        open input takvim
        initialize takvim-rec
        move yeni-tarih to takvim-anah
             read takvim no lock invalid 
                  close takvim
               initialize mesaj-degiskenler
               move "Girdiginiz Tarih Tanimsiz...... "  to mmesaj-1
               move "Tarihi Kontrol Ediniz......!!!!!"  to mmesaj-2
               move " [ DIKKAT ] " to mmesaj-title
               move 1           to mmesaj-type
               move 3           to mmesaj-icon
               move 1           to mmesaj-default
               perform mmesaj-ver
                       move 1     to gec-gecme
                      exit paragraph
             end-read
                  close takvim

        initialize uzat-kisalt
        if yeni-tarih < konuk-git-tar 
           move 1 to uzat-kisalt
        end-if
        if yeni-tarih = konuk-git-tar 
           initialize mesaj-degiskenler
           move "Ayni Cikis Tarihini Yazdiniz...."  to mmesaj-1
           move "Tarihi Degistiriniz..!!!!!!!!!!!"  to mmesaj-2
           move " [ DIKKAT ] " to mmesaj-title
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
                   move 1     to gec-gecme
                   exit paragraph
        end-if 
        if yeni-tarih < konuk-gel-tar 
           initialize mesaj-degiskenler
           move "Girdiginiz Tarih C-In Tarihinden"  to mmesaj-1
           move "Kucuk Olamaz.........!!!!!!!!!!!"  to mmesaj-2
           move " [ DIKKAT ] " to mmesaj-title
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
                   move 1     to gec-gecme
                   exit paragraph
        end-if

        if yeni-tarih < calisma-tarihi 
           initialize mesaj-degiskenler
           move "Girdiginiz Tarih Onburo Calisma "  to mmesaj-1
           move "Tarihinden Kucuk Olamaz....!!!!!"  to mmesaj-2
           move " [ DIKKAT ] " to mmesaj-title
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           perform mmesaj-ver
                   move 1     to gec-gecme
                   exit paragraph
        end-if
          .
*
 musteri-oku.
        modify lb-foliono-e title = konuk-folio
        modify fr-foliotipi-e title = konuk-fol-kodu
        modify lb-adi-e     title = konuk-adi
        modify lb-soyadi-e  title = konuk-soyadi

        move konuk-gel-gun      to e-gun
        move konuk-gel-ay       to e-ay 
        move konuk-gel-yil      to e-yil
        modify lb-girtar-e  title = etarih

        move konuk-git-gun      to e-gun
        move konuk-git-ay       to e-ay 
        move konuk-git-yil      to e-yil
        modify lb-ciktar-e  title = etarih

        move "A"            to kodlar02-tipi
        move konuk-pan-tipi to kodlar02-kodu
        read kodlar02 no lock invalid 
             initialize kodlar02-adi 
             not invalid continue
        end-read
        modify fr-pansiyon-e  title = konuk-pan-tipi
        modify lb-pansiyon-e  title = kodlar02-adi

        move "B"            to kodlar02-tipi
        move konuk-odeme-tipi to kodlar02-kodu
        read kodlar02 no lock invalid 
             initialize kodlar02-adi 
             not invalid continue
        end-read
        modify fr-odeme-e  title = konuk-odeme-tipi
        modify lb-odeme-e  title = kodlar02-adi

        move konuk-top-borc     to z-tutar
        modify lb-topborc-e  title = z-tutar
        move konuk-top-alac     to z-tutar
        modify lb-topalacak-e  title = z-tutar
        initialize z-tutar
        compute z-tutar = konuk-top-borc - konuk-top-alac
        modify lb-bakiye-e  title = z-tutar
            .
 musteri-oku-exit.
     exit.
      .
*
 tum-oda-sor.
 oda-no-oku.,
       move oda-no  to o-uzun
            perform oda-kisalt
            move o-kisa to oda-no-k    
    initialize konuk-rec.
    move "I"      to konuk-durumu.
    move oda-no-k to konuk-odano.
    start konuk key not < konuk-oda invalid 
           display message box "Secmis Oldugunuz Oda Bos...."
                          new-line,
                         title = " [ Bos Oda ] "
           move 1 to gec-gecme
           go tum-oda-sor-exit
           not invalid continue
    end-start.

    read konuk next no lock end 
         display message box "Secmis Oldugunuz Oda Bos...."
                         new-line,
                         title = " [ Bos Oda ] "
           move 1 to gec-gecme
           go tum-oda-sor-exit
     end-read.
     if konuk-odano = oda-no-k 
        continue
     else
         display message box "Secmis Oldugunuz Oda Bos...."
                         new-line,
                         title = " [ Bos Oda ] "
         move 1 to gec-gecme
         go tum-oda-sor-exit
     end-if.

 tum-oda-sor-exit.
     exit.

*
 Form1-Aft-Initdata.
      open input kllnc
        initialize kllnc-rec
        move k-kodu-tasi  to k-kodu
        read kllnc no lock invalid continue
        end-read
        close kllnc
        display fsil-Cm-1
        modify form1-fr-3 title = tarih-title.
   
     modify fsil-Cm-1 mass-update = 1 reset-list = 1 .
       move "-----------------TRANSFER YOK-----" to tr-ekle 
       modify fsil-Cm-1 item-to-add tr-ekle
    
        open i-o baglanti
     close baglanti

     open input baglanti
        initialize baglanti-rec
        start baglanti key > baglanti-kodu invalid continue
            not invalid
               initialize fs-baglanti
               perform until fs-baglanti = "10"
                   read baglanti next no lock 
                      end move "10" to fs-baglanti
                      not end
                         if baglanti-guncel not = 1 then 
                           exit perform cycle
                         end-if
                           initialize tr-ekle
                         move baglanti-aciklama-1 to tr-ekle
                         move baglanti-adi        to tr-ekle(31:)
                         modify fsil-Cm-1 item-to-add tr-ekle
                   end-read
               end-perform
         end-start
            initialize tr-ekle
        modify fsil-Cm-1 value = tr-ekle
          modify fsil-Cm-1  
            mass-update = 0.  
     close baglanti.
       move "-----------------TRANSFER YOK-----" to tr-ekle
           modify fsil-Cm-1 value =  tr-ekle
    
     .
*
 rez-at.
  
      if tr-ekle(1:8) not = "--------" then
           open input isyeri
                    initialize isyeri-rec
                    move tr-ekle(31:8) to isyeri-adres 
                    start isyeri key = isyeri-adres invalid 
                       move 99 to isyeri-no
                       
                      not invalid
                      read isyeri next no lock end-read
                     
                   end-start
                      move rez-rec to trez-rec
                      move isyeri-no to REZ-git-sirket  xREZ-git-sirket
                      move tr-acenta to trez-acenta
                    if   REZ-git-sirket = "99"
                          move "99" to trez-gel-sirket 
                    else
                    initialize isyeri-rec
                    move isyeri-adres-tasi to isyeri-adres
                    start isyeri key = isyeri-adres invalid continue
                      not invalid
                      read isyeri next no lock end-read
                      move isyeri-no to trez-gel-sirket 
                    end-start
                    end-if
                   close isyeri
            perform rez-trans-et
        end-if  .
       
*
*
 rez-trans-et.
      perform   onb-adres-aktar
        
             open i-o genelfis2
             move 1 to genelfis2-anahtar
             read genelfis2 no lock invalid  
                  initialize genelfis2-rec
                  move 1 to genelfis2-anahtar
                  add 1  to rez2-oto
                  move rez2-oto to trez-no 
                  write genelfis2-rec invalid
                        rewrite genelfis2-rec invalid continue
                        end-rewrite 
                  end-write
              not invalid
                  add 1 to rez2-oto 
               
                  rewrite genelfis2-rec end-rewrite
             end-read
             close genelfis2
          
        open i-o rez2 
        open i-o takvim
         open i-o CAST4 
          open i-o yanrez2 
           open i-o polisxml2 
        move trez-rec to rez2-rec 
           move rez2-oto to rez2-no 
        move yeni-tarih to rez2-gir-tar
        move rez2-gir-gun to e-gun
        initialize rez2-c-in rez2-odano rez2-folio
        move rez2-gir-ay      to e-ay 
        move rez2-gir-yil      to e-yil
        modify lb-girtar-e     title = etarih
        move konuk-kur-degeri  to REZ2-CIN-KURU
        move tr-acenta to rez2-acenta
        write rez2-rec invalid stop " " end-write
        display message box etarih " girisli " rez2-no " nolu  rezervasyon"  new-line
                            rez2-dosya-adres " kütüphaneli sirkete CIN kuru ile aktarilmistir" new-line
                            "Lutfen Fiyat Hesaplamasi yapip kaydetmeyi unutmayin" new-line
                            "Aksi Halde " rez2-dosya-adres " sirketinizde forecast tutmayacaktir."
                            title "REZERVASYON KAYDIRILDI"                           
       perform ucast-isle       
       open input yanrez polisxml      
       initialize yanrez-rec
       move rez-no to yanrez-rezno
       start yanrez key >= yanrez-anah invalid continue
           not invalid 
             perform until fs-yanrez= "10" 
                 read yanrez next no lock end move "10" to fs-yanrez
                    not end
                    if yanrez-rezno = rez-no
                      move yanrez-rec to yanrez2-rec
                      move rez2-no to  yanrez2-rezno
                    write yanrez2-rec invalid display message box yanrez2-rezno " Yanrez yazilamadi "  yanrez2-adi
                      end-write
                     else
                     move "10" to fs-yanrez
                     end-if
                end-read
             end-perform
       end-start
       initialize polisxml-rec
       move rez-no to polisxml-rezno
       start polisxml key >= polisxml-anah invalid continue
           not invalid 
             perform until fs-polisxml= "10" 
                 read polisxml next no lock end move "10" to fs-polisxml
                    not end
                    if polisxml-rezno = rez-no
                      move polisxml-rec to polisxml2-rec
                      move rez2-no to  polisxml2-rezno
                    write polisxml2-rec invalid display message box polisxml2-rezno " Yanrez yazilamadi "  polisxml2-adi
                      end-write
                     else
                     move "10" to fs-polisxml
                     end-if
                end-read
             end-perform
        end-start

      close rez2 takvim   CAST4 yanrez2 polisxml2 polisxml
        .


*
 hes-gonder.
    
     if konuk-rez-no > 0 then 

         move konuk-rez-no to rez-no
       
        read rez no lock invalid 
            display message box "Rezervasyon Okunamadi"

        end-read
       
        move rez-rec to xrez-rec
        move yeni-tarih  to xrez-cik-tar
        initialize linkh-odahes
        move xrez-no to  linkh-rez-no     
        move 4 to linkh-nereden  
        move 1 to linkh-anl-yaz
        
*         if XREZ-FIYAT-FIX not = "E"
        move  1 to linkh-cast-yaz
*         end-if
        call "/asya/ytl/obj/otel/odahes.asy" 
                        using  xrez-rec   linkh-odahes
                        on exception 
                        perform callerr-proc
                        exit paragraph
                        not on exception 
                   cancel "/asya/ytl/obj/otel/odahes.asy"
        end-call .
*
 kaydet.
 uzatma-yaz.
    move yeni-tarih to konuk-git-tar.
    move "E"        to konuk-uzatma.
    
    rewrite konuk-rec invalid go uzatma-yaz-exit.
            perform log-operation-konuk.
    open i-o uzatma.
    initialize uzatma-rec.
    move calisma-tarihi to uzatma-tarih.
    move folio-no       to uzatma-folio.
    accept uzatma-zaman from time.
    read uzatma no lock invalid continue.
    move eski-tarih     to uzatma-eski-cout.
    move yeni-tarih     to uzatma-yeni-cout.
    move form-acik      to uzatma-aciklama.
    move k-kodu-tasi    to uzatma-staf.
    write uzatma-rec invalid 
          rewrite uzatma-rec,
          end-rewrite continue
    end-write.
    close uzatma.
    if konuk-fol-kodu = "R"      
       if kisalt                   
          perform gun-eksilt thru gun-eksilt-exit
       else
          perform gun-artir  thru gun-artir-exit
       end-if
        perform rez-duzelt   thru rez-duzelt-exit
          if konuk-fol-kodu = "R" 
               if konuk-plan  = 1 then 
                    display message box "Planlama Yapilmis konaklamaya uzatma yaptiniz " new-line
                            "Planlamalariniz Iptal edilmistir. "      new-line
                            "Lutfen  Planlamanizi tekrar yapiniz "     new-line
               end-if
               open input rez
                   perform hes-gonder
               close rez
        end-if
        display message box "Degistirdiginiz tarihlerdeki konaklama fiyatlarini update edilip kontrol edilmesi gerekmektedir" new-line
                              "Lutfen Register karti uzerinde HES butonuna basiniz"   title "DIKKAT"   icon 1
                            
    end-if.
 uzatma-yaz-exit.
    exit.
 islem-bitti.
 kaydet-exit.
    exit.
*
 rez-duzelt.
          open i-o rez.
          move konuk-rez-no   to rez-no.
          read rez no lock invalid 
              go rez-duzelt-bitti.
          
          if konuk-fol-kodu = "R" and tr-ekle(1:4) not = "----" and trans-v = 1
                  perform rez-at
                  move konuk-rez-no   to rez-no
                  read rez no lock invalid continue end-read
          end-if
          move yeni-tarih  to rez-cik-tar.

          accept rez-edit-tarih from century-date  |firat amonra için konuldu 03/11/2020
          accept rez-edit-zaman from time          |                           
          
          rewrite rez-rec invalid continue
          end-rewrite.
           perform log-operation-rez.
          if rez-sharenum > 0 then 
             perform share-koy-kont

          end-if .
                 
 rez-duzelt-bitti.
          close rez.
 rez-duzelt-exit.
    exit.
*
 gun-artir.    
                   open i-o cast takvim break.
           move eski-tarih to takvim-anah.
        start takvim key not < takvim-anah invalid go gun-artir-bitti.
 cast-artir-oku.
        read takvim next no lock end go gun-artir-bitti.
        if fs-takvim = 99 go cast-artir-oku.
        if takvim-anah > yeni-tarih go gun-artir-bitti.
        perform takvim-artir   thru takvim-artir-exit.

        move takvim-anah        to cast-tarih.
        move konuk-rez-no       to cast-rez-no.
        move konuk-odano        to cast-oda-no.

        move konuk-buyuk        to cast-buyuk
        move konuk-kucuk        to cast-kucuk
        move konuk-bebek        to cast-bebek
        move konuk-free         to cast-free 
        move konuk-dv-degeri    to cast-fiyati
        move konuk-oda-konumu   to cast-oda-konumu
        move konuk-fiyat-konumu to cast-fiyat-konumu
        move konuk-anlasma      to cast-anlasma
        move konuk-pan-tipi     to cast-pan-tipi
        move konuk-sharenum     to cast-sharenum
        move konuk-grup-no      to cast-grup
          if cast-tarih = konuk-git-tar
               initialize      cast-fiyati  cast-anlasma-fiyati
           end-if
           initialize cast-basilan-fiyat |ileriye dogru basilan atiyordu düeltildi.
           perform break-mami
        write cast-rec invalid 
              rewrite cast-rec 
              end-rewrite 
        end-write.
          perform log-operation-cast
            go cast-artir-oku.
 takvim-artir.
        if takvim-anah = yeni-tarih go takvim-artir-exit.
        if takvim-anah > yeni-tarih go takvim-artir-exit.
        compute takvim-sat-oda(konuk-oda-konumu)   =
                takvim-sat-oda(konuk-oda-konumu)   + 1.
        compute takvim-sat-buyuk(konuk-oda-konumu) =
                takvim-sat-buyuk(konuk-oda-konumu) + konuk-buyuk.
        compute takvim-sat-kucuk(konuk-oda-konumu) =
                takvim-sat-kucuk(konuk-oda-konumu) + konuk-kucuk.
        compute takvim-sat-free(konuk-oda-konumu)  =
                takvim-sat-free(konuk-oda-konumu)  + konuk-free.
         rewrite takvim-rec invalid continue.
 takvim-artir-exit.
       exit.
 gun-artir-bitti.
            close cast takvim break.
 gun-artir-exit.
    exit.
*
 gun-eksilt.   
         open i-o cast takvim.
 cast-start. 
         initialize cast-rec.
         move konuk-rez-no     to cast-rez-no.
         move yeni-tarih       to cast-tarih.
         start cast key not < cast-anah1 invalid go cast-eksilt-bitti.
 cast-eksilt-oku.
         read cast next no lock end go cast-eksilt-bitti.
         if fs-cast = 99 go cast-eksilt-oku.
         if cast-rez-no > konuk-rez-no go cast-eksilt-bitti.
         if cast-tarih = yeni-tarih go cast-eksilt-oku.
         if cast-rez-no = konuk-rez-no  
            continue
         else 
            go cast-eksilt-oku
         end-if.
            delete cast invalid 
               continue.
           perform log-operation-cast
            go cast-eksilt-oku.  
 cast-eksilt-bitti.
           initialize takvim-rec.
           move yeni-tarih to takvim-anah.
        start takvim key not < takvim-anah invalid go gun-eksilt-bitti.
 takvim-eksilt-oku.
        read takvim next no lock end go gun-eksilt-bitti.
        if fs-takvim = 99 go takvim-eksilt-oku.
        if takvim-anah = eski-tarih go gun-eksilt-bitti.
        if takvim-anah > eski-tarih go gun-eksilt-bitti.
        compute takvim-sat-oda(konuk-oda-konumu)   =
                takvim-sat-oda(konuk-oda-konumu)   - 1.
        compute takvim-sat-buyuk(konuk-oda-konumu) =
                takvim-sat-buyuk(konuk-oda-konumu) - konuk-buyuk.
        compute takvim-sat-kucuk(konuk-oda-konumu) =
                takvim-sat-kucuk(konuk-oda-konumu) - konuk-kucuk.
        compute takvim-sat-free(konuk-oda-konumu)  =
                takvim-sat-free(konuk-oda-konumu)  - konuk-free.
         rewrite takvim-rec invalid continue.
         go takvim-eksilt-oku.
 gun-eksilt-bitti.
            close cast takvim.
 gun-eksilt-exit.
    exit.
*
 short-kontrol.
            open input konum.
            move konuk-oda-konumu   to konum-anahtar.
            read konum no lock invalid 
                 initialize konum-rec.
            close konum.
            open input takvim.
        move "Y" to short-var-yok.
        move eski-tarih to takvim-anah.
        start takvim key not < takvim-anah invalid 
              go short-kontrol-bitti.
 short-oku.
         read takvim next no lock end go short-kontrol-bitti.
         if fs-takvim = 99 go short-oku.
         if takvim-anah = yeni-tarih  go short-kontrol-bitti.
         if takvim-anah > yeni-tarih  go short-kontrol-bitti.
            initialize short-1konum short-toplam.
         compute short-1konum =  1 +
                 takvim-sat-oda(konuk-oda-konumu).
         compute short-toplam =  1 +
                 takvim-sat-oda(1) + takvim-sat-oda(11) +
                 takvim-sat-oda(2) + takvim-sat-oda(12) +
                 takvim-sat-oda(3) + takvim-sat-oda(13) +

                 takvim-sat-oda(4) + takvim-sat-oda(14) +
                 takvim-sat-oda(5) + takvim-sat-oda(15) +
                 takvim-sat-oda(6) + takvim-sat-oda(16) +
                 takvim-sat-oda(7) + takvim-sat-oda(17) +
                 takvim-sat-oda(8) + takvim-sat-oda(18) +
                 takvim-sat-oda(9) + takvim-sat-oda(19) +
                 takvim-sat-oda(10) 
                 
                 
                 .
         if short-1konum > konum-hazir-oda  
            perform 1konum-shortta
              if donus-kodu = 2 
                 go short-kontrol-bitti
              end-if
         end-if.

         if short-toplam > takvim-hazir-oda 
            perform toplam-shortta
              if donus-kodu = 2 
                 go short-kontrol-bitti
              end-if
         end-if.

            go short-oku.
 short-kontrol-bitti.
       close takvim.
 short-kontrol-exit.
    exit.
*
 1konum-shortta.
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Oda Konumunuz Short'ta ] " to mmesaj-title

       move "Bu Tarihte"                           to mmesaj-1(01:10)
       move konum-adi(01:10)                       to mmesaj-1(12:10)
       move "Oda Shortta"                          to mmesaj-1(23:11)
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move konum-hazir-oda  to mmesaj-2(22:04)
       move short-1konum     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 toplam-shortta.
       move "V" to short-var-yok.
       initialize mesaj-degiskenler
       move " [ Tum Konumlar Short'ta ] " to mmesaj-title
       move "Bu Tarihte Tum Konumlar Short'ta"     to mmesaj-1
       move "Tarih:  /  /     Kap:      Sat:     " to mmesaj-2
       move takvim-gun   to mmesaj-2(07:02)
       move takvim-ay    to mmesaj-2(10:02)
       move takvim-yil   to mmesaj-2(13:04)

       move konum-hazir-oda  to mmesaj-2(22:04)
       move short-toplam     to mmesaj-2(32:04)

       move 2           to mmesaj-type
       move 3           to mmesaj-icon
       move 1           to mmesaj-default
            perform mmesaj-ver
        .
*
 blok-kontrol.
        move 0 to devam
          perform blok-kont2
           initialize gec-gecme
           open input cast rez.
        move eski-tarih     to cast-tarih.
        move konuk-odano    to cast-oda-no.
        start cast key not < cast-anah3 invalid 
              go blok-kontrol-bitti.
 blok-kontrol-oku.
        read cast next no lock end 
             go blok-kontrol-bitti.
        if fs-cast = 99 go blok-kontrol-oku.
        if cast-tarih  > yeni-tarih   go blok-kontrol-bitti.
        if cast-tarih  = yeni-tarih   go blok-kontrol-bitti.
        if cast-oda-no > konuk-odano  go blok-kontrol-bitti.
        if cast-oda-no = konuk-odano  
           continue
        else 
           go blok-kontrol-oku
        end-if.
*/SÝLÝNEN REZERVASYONLARIN CASTI TUTULDUÐU ÝÇÝN ODA ÇAKIÞMASI OLUYOR
        initialize rez-rec 
        move cast-rez-no  to rez-no
        read rez no lock invalid 
             continue 
        end-read 
        if rez-durumu = "S"
            go blok-kontrol-oku
        else
            continue 
        end-if 
*/SÝLÝNEN REZERVASYONLARIN CASTI TUTULDUÐU ÝÇÝN ODA ÇAKIÞMASI OLUYOR
        if cast-rez-no   = konuk-rez-no   
            go blok-kontrol-oku.
        if rez-cik-tar = cast-tarih
           go blok-kontrol-oku.
        if cast-sharenum = konuk-sharenum 
            go blok-kontrol-oku.

           initialize mesaj-degiskenler
           move " [ DIKKAT ] " to mmesaj-title
           move "Girdiginiz Oda Bu Tarihte Blokeli  " to mmesaj-1
           move "Tarih..:  /  /                     " to mmesaj-2
           move cast-gun     to mmesaj-2(09:02)
           move cast-ay      to mmesaj-2(12:02)
           move cast-yil     to mmesaj-2(15:04)
           move "Rez No:"    to mmesaj-3(1:7)
           move cast-rez-no  to mmesaj-3(8:)
           move 1           to mmesaj-type
           move 3           to mmesaj-icon
           move 1           to mmesaj-default
           move 1 to devam
             perform mmesaj-ver
             .
 blok-kontrol-bitti.
            close cast rez.
 blok-kontrol-exit.
     exit.
*
 oda-ara.
        
      initialize oda-cagir.
      move "D"   to oda-db-cagir.
      call "/asya/ytl/obj/otel/odaara.asy" using oda-cagir
            on exception perform callerr-proc
               not on exception
               cancel "/asya/ytl/obj/otel/odaara.asy" 
       end-call.
       move odano-cagir     to o-kisa 
            perform oda-uzat
            move o-uzun to  oda-no.
 oda-oku.
          move oda-no    to o-uzun
            perform oda-kisalt
            move o-kisa to  oda-no-k   
       initialize odalar-rec.
       move oda-no-k     to odalar-anah
       read odalar         no lock invalid 
            move 1         to gec-gecme
            not invalid continue 
       end-read
       display accept-odano.
 oda-oku-exit.
       exit.
 oda-ara-exit.
       exit.

*
 mmesaj-ver.
      inspect mmesaj-1 replacing trailing spaces by low-values
      inspect mmesaj-2 replacing trailing spaces by low-values
      inspect mmesaj-3 replacing trailing spaces by low-values
      display message box mmesaj-1, new-line, mmesaj-2, new-line, mmesaj-3
              title   = mmesaj-title
              type    = mmesaj-type
              icon    = mmesaj-icon
              default = mmesaj-default
              returning donus-kodu.
*
 Form1-Aft-Routine.
     close kodlar02 odalar odalar2.
     close konuk.
*
 blok-kont2.           
            if gecmez
               exit paragraph
            end-if                           
               initialize blok-cagir 
               move tarih-tasi       to blok-bas-tar 
               move yeni-tarih       to blok-bit-tar 
               move konuk-rez-no     to blok-rez-no 
               move konuk-odano      to blok-oda 
               call "/asya/ytl/obj/otel/blokara.asy" using blok-cagir
                    on exception perform callerr-proc
                    not on exception
               cancel "/asya/ytl/obj/otel/blokara.asy" 
               end-call
               if rezpara-cifte-blokaj not = "E" and blok-yapabilir = "H" 
                  move eski-tarih to yeni-tarih
                  display accept-gun accept-ay accept-yil
                  move 1 to gec-gecme
                  move 4 to accept-control
                  move 1002 to control-id
                  exit paragraph

               end-if .           
*
 Form1-Pb-1-Link.
       move 1 to trans-v
         move xrez-acenta to tr-acenta
     display a2
       display a1 a2 a3 fsil-Cm-1
     .

*
 share-koy-kont.
****** kural .
****** kontrol edilecek rez kaydi cagrýlmadan okunmus ve kaydedilmis olmali
******* arez.lib acast.lib takvim2.lib sel tfd de olmali  rez acik olmali
         move oda-no    to o-uzun
            perform oda-kisalt
            move o-kisa to  oda-no-k  
       open i-o arez  acast konu2
       open input takvim2
       initialize ana-oda-verildi arez-rec
        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
        move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay     
       initialize ana-oda-verildi acast-rec  share-odalar
         move high-values to ilk-share-tar 
        move low-values  to son-share-tar
        initialize sodasay
        move rez-sharenum to acast-sharenum
        move tarih-tasi to acast-tarih
          initialize fs-acast
       start acast key >= acast-anah6 
               invalid continue
          not invalid
          perform until fs-acast = "10" 
              read acast next no lock end 
                     move "10" to fs-acast
                 not end
                    if rez-sharenum not = acast-sharenum 
                        move "10" to fs-acast
                        exit perform cycle
                    end-if
                    move acast-rez-no to arez-no 
                    read arez no lock invalid 
                          display message  box "Hata Bakim icin arayiniz Castttt "
                     end-read
                            if arez-durumu  = "S" then
                              exit perform cycle
                            end-if

                             if acast-tarih > son-share-tar
                                move  acast-tarih to son-share-tar
                             end-if
                              if acast-tarih < ilk-share-tar
                                move  acast-tarih to ilk-share-tar
                             end-if

                                perform varying ish from 1 by 1 until ish > sodasay or ish > 20 
                                    if share-oda(ish) = acast-oda-no
                                      exit perform 
                                    end-if
                                end-perform
                                 if ish > sodasay then 
                                     if ish >= 20 then
                                          display message box "20 den fazla oda bagladiniz"
                                       else
                                             move acast-oda-no to share-oda(ish)
                                             move ish to  sodasay
                                     end-if
                                 end-if
              end-read
          end-perform 
       end-start
       initialize fs-takvim2 takvim2-rec
       move ilk-share-tar to takvim2-anah 
       start takvim2 key >= takvim2-anah invalid continue
         not invalid 
         perform until fs-takvim2 = "10"
             read takvim2 next no lock end move "10" to fs-takvim2 
               not end
               if takvim2-anah > son-share-tar 
                   move "10" to fs-takvim2 
                   exit perform cycle
                end-if
             end-read
                perform varying ish  from 1 by 1 until ish > sodasay or ish > 20 
                  initialize ana-oda-verildi acast-rec   fs-acast
                  move takvim2-anah to acast-tarih
                  move rez-sharenum to acast-sharenum
                  move share-oda(ish) to acast-oda-no
                  move high-values to acast-fiyati  acast-buyuk

                  start acast key < acast-anah6 invalid 
                          continue
                     not invalid
                       perform until fs-acast = "10" 
                           read acast previous no lock  
                               end
                                move "10" to fs-acast
                                if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                                  else
                                                  display message box "Share Edilmis kayitlarda kesintisiz konaklama yok" new-line 
                                                     "Dikkatinize "
                                               end-if
                                  end-if
                                not end
                                if   takvim2-anah not = acast-tarih  or
                                     rez-sharenum not = acast-sharenum  or
                                     share-oda(ish) not = acast-oda-no
                                       move "10" to fs-acast
                                        if ana-oda-verildi not = 1 
                                          read   acast next no lock 
                                          end   display message box "Hataaaaa"
                                          exit perform cycle
                                          end-read
                                              if   takvim2-anah not = acast-tarih  or
                                                     rez-sharenum not = acast-sharenum  or
                                                     share-oda(ish) not = acast-oda-no
                                                  display message box "Share Edilmis kayitlarda kesintisiz konaklama yok" new-line 
                                                     "Dikkatinize "
                                                   exit perform cycle
                                             end-if
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                                  else
                                                  display message box "Hataaaaa"
                                               end-if
                                         end-if
                                       exit perform cycle
                                end-if
                                move acast-rez-no to arez-no
                                move acast-rez-no to arez-no 
                                    read arez no lock invalid 
                                      display message  box "Hata Bakim icin arayiniz Castttt "
                                          end-read
                                            if arez-durumu  = "S" then
                                                  display message box "Silinmis Share gorunuyor"
                                                  exit perform cycle
                                                  
                                            end-if
                                   if arez-cik-tar <= acast-tarih
                                       if  acast-share not = 1
                                            move 1 to acast-share
                                            rewrite acast-rec invalid stop " " end-rewrite
                                       end-if
                                    else
                                        if ana-oda-verildi not = 1 
                                              move 1 to  ana-oda-verildi
                                               if  acast-share not = 0
                                                    move 0 to acast-share
                                                  rewrite acast-rec invalid stop " " end-rewrite
                                              end-if
                                        else
                                                 if  acast-share not = 1
                                                       move 1 to acast-share
                                                      rewrite acast-rec invalid stop " " end-rewrite
                                                 end-if
                                  end-if
                             end-if

                           end-read
                       end-perform
                  end-start
                end-perform 
        end-perform
      end-start
      initialize arez-rec fs-arez

        move "I" to arez-durumu
        move rez-sharenum to arez-sharenum
       start arez key >= aREZ-anah-share invalid continue
          not invalid
          perform until fs-arez = "10" 
              read arez next no lock end 
                       
                     move "10" to fs-arez
                 not end
                    if rez-sharenum not = arez-sharenum  
                     
                            move "10" to fs-arez
                        exit perform cycle
                    end-if
                    if  arez-durumu not = "I"
                       exit perform cycle
                    end-if
                    if arez-cik-tar < tarih-tasi 
                         exit perform cycle
                    end-if
                    if arez-gir-tar <= tarih-tasi
                       move   tarih-tasi to acast-tarih
                       move   arez-no   to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                                     if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                                     if arez-folio > 0 then 
                                       move arez-folio to konu2-folio
                                       read konu2 no lock invalid continue
                                       not invalid
                                          move acast-share to konu2-share
                                          rewrite konu2-rec invalid continue end-rewrite
                                       end-read

                                     end-if
                             end-if
                             end-if
                       end-read
                        else
                        move   arez-gir-tar  to acast-tarih
                         move   arez-no        to  acast-rez-no
                       read acast no lock invalid 
                                   display message  box "Hata Bakim icin arayiniz Cast444tt "
                             not invalid 
                             if acast-share not = arez-share 
                                     move acast-share to arez-share
                                     rewrite arez-rec invalid stop " " end-rewrite
                             end-if
                       end-read


                   end-if
              end-read
          end-perform 
       end-start
       read rez no lock invalid stop " " 
       end-read

     close arez acast takvim2 konu2. 

*
 acuserve-adres-aktar.

    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres       
                         
                         REFERANS-DOSYA-adres     
                         mgenel-DOSYA-adres       
                       
                        
            

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA  
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.
  
    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    

    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values.
*
 onb-adres-aktar.
     if tr-ekle = spaces then 
          move acenta-dosya       to acenta2-ACUSERVE-DOSYA       
          move fiyatana-dosya     to fana2-ACUSERVE-DOSYA         
          move aksiyon-dosya      to aks2-ACUSERVE-DOSYA   
          move aksiyon2-dosya     to aks22-ACUSERVE-DOSYA    
          move aceanlas-dosya     to ace2-ACUSERVE-DOSYA          
          move not-dosya          to not2-ACUSERVE-DOSYA          
          move acebavel-dosya     to acebavel2-ACUSERVE-DOSYA     
          move firma-dosya        to firma2-ACUSERVE-DOSYA        
       
          move fiyat-dosya        to fiyat2-ACUSERVE-DOSYA  
          move rez-dosya     to rez2-ACUSERVE-DOSYA  
          move yanrez-dosya     to yanrez2-ACUSERVE-DOSYA  
          move cast-dosya     to CAST4-ACUSERVE-DOSYA  
           move genelfis-dosya     to genelfis2-ACUSERVE-DOSYA   
              move polisxml-dosya     to polisxml2-ACUSERVE-DOSYA   

    else 
        move tr-ekle(31:8) to       polisxml2-dosya-adres
                                      rez2-dosya-adres
                                      yanrez2-dosya-adres
                                      CAST4-dosya-adres
                                     genelfis2-dosya-adres

             string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   polisxml2-dosya           delimited " "
                   into  polisxml2-ACUSERVE-DOSYA     

            string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   rez2-dosya           delimited " "
                   into rez2-ACUSERVE-DOSYA 
            string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   yanrez2-dosya           delimited " "
                   into yanrez2-ACUSERVE-DOSYA 
           string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   CAST4-dosya           delimited " "
                   into CAST4-ACUSERVE-DOSYA 

           string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   genelfis2-dosya           delimited " "
                   into genelfis2-ACUSERVE-DOSYA                  
            string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   acenta-dosya           delimited " "
                   into acenta2-ACUSERVE-DOSYA 
              string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyatind-dosya           delimited " "
                   into find2-ACUSERVE-DOSYA 
        
        
             string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyatana-dosya           delimited " "
                   into fana2-ACUSERVE-DOSYA   

           string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   aksiyon-dosya           delimited " "
                   into aks2-ACUSERVE-DOSYA   
            string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   aksiyon2-dosya           delimited " "
                   into aks22-ACUSERVE-DOSYA   

           string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   aceanlas-dosya           delimited " "
                   into ace2-ACUSERVE-DOSYA 

           string "@" delimited by low-values

                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   not-dosya           delimited " "
                   into not2-ACUSERVE-DOSYA 

          string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   acebavel-dosya           delimited " "
                   into acebavel2-ACUSERVE-DOSYA  

           string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   firma-dosya           delimited " "
                   into firma2-ACUSERVE-DOSYA  

          
    
          string "@" delimited by low-values
                   tr-ekle(1:30)          delimited by " "
                    ":" delimited by low-values
                   fiyat-dosya           delimited " "
                   into  fiyat2-ACUSERVE-DOSYA    
 




    ..

*
 ucast-isle.
    
         move rez2-gir-tar to takvim-anah. 
           start takvim key not < takvim-anah invalid 
             continue
             not invalid
             perform until fs-takvim = "10"
                  read takvim next no lock end move "10" to fs-takvim
                     not end
                      if takvim-anah > rez2-cik-tar 
                        move "10" to fs-takvim
                        else

                         initialize CAST4-rec 
           
                           move rez2-no     to   CAST4-rez-no
                           move takvim-anah to   CAST4-tarih
                           move rez2-odano        to CAST4-oda-no
                           move rez2-buyuk        to CAST4-buyuk
                           move rez2-kucuk        to CAST4-kucuk
        
                           move rez2-bebek        to CAST4-bebek
                           move rez2-free         to CAST4-free
                           move rez2-oda-konumu   to CAST4-oda-konumu
                           move rez2-fiyat-konumu to CAST4-fiyat-konumu
                           move rez2-anlasma      to CAST4-anlasma
                           move rez2-pan-tipi     to CAST4-pan-tipi
                            write CAST4-rec invalid 
                            display message box CAST4-tarih " tarihli Cast Yazilamadi"
                             end-write
                         end-if
                  end-read
           end-perform 
        end-start
             .   


    
   
     

 
