* stafrap.evt
* stafrap.evt is generated from D:\asya\acugt.ytl\otel\stafrap.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
     .
*
 Form1-Aft-Initdata.
    move tarih-tasi to ilk-tarih son-tarih.
    display acc-01 acc-02 acc-03 acc-04 acc-05
            acc-06 acc-07.
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*                
 Form1-Ex-Other.
    evaluate key-status
      when 1 perform yardimlar
      when 2 perform islemler
    end-evaluate
    .
*
 islemler.
    perform init-takas
    perform aktar-islemler-takas
    perform aktar-takas-dokumer
    .
*
 aktar-takas-dokumer.
    open input takas
    perform init-dokumer
    perform yaz-dokumer-win-title
    perform yaz-dokumer-baslik
    perform yaz-dokumer-ozellikler
*    perform yaz-dokumer-sutun-baslik
    perform isle-takas-dokumer
    perform finish-dokumer
    close takas
    delete file takas
    .
*
 yaz-dokumer-win-title.
*/WINDOW TITLE
     initialize dokumer-rec detay
     set dokumer-20-win-baslik to true
     move "Kullanici Islem Raporu"  to dokumer-400
     write dokumer-rec, end-write
     .
*
 yaz-dokumer-baslik.
*/ BASLIKLAR
     initialize dokumer-rec
     set dokumer-20-baslik to true
     move "1"              to dokumer-20-10
     move "Kullanici Islem Raporu"  to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec
     set dokumer-20-baslik to true
     move "1"              to dokumer-20-10
     move "Tarih..:"       to dokumer-400(01:10)
     move ilk-gun          to dokumer-400(11:02)
     move "/"              to dokumer-400(13:01)
     move ilk-ay           to dokumer-400(14:02)
     move "/"              to dokumer-400(16:01)
     move ilk-yil          to dokumer-400(17:04)
     move "-"              to dokumer-400(21:01)
     move son-gun          to dokumer-400(22:02)
     move "/"              to dokumer-400(24:01)
     move son-ay           to dokumer-400(25:02)
     move "/"              to dokumer-400(27:01)
     move son-yil          to dokumer-400(28:04)
     write dokumer-rec, end-write

     initialize dokumer-rec
     set dokumer-20-baslik to true
     move "1"              to dokumer-20-10
     move "Staff.....:"    to dokumer-400(01:)
     move staf-kod         to dokumer-400(16:04)
     move "<->"            to dokumer-400(21:03)
     move staf-adi         to dokumer-400(24:40)
     write dokumer-rec, end-write

     initialize dokumer-rec
     set dokumer-20-baslik to true
     write dokumer-rec, end-write
     .
*
 yaz-dokumer-ozellikler.
*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec
     set dokumer-20-ozellik         to true
     set dokumer-oto-sayfa-basi-yap to true
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "LLLLLLLLLLLLLL"          to dokumer-align-occ
     move dokumer-ozellikler-rec    to dokumer-400
     write dokumer-rec, end-write
     .
*
 yaz-dokumer-sutun-baslik.
*/ BASLIKLAR  
     initialize dokumer-rec detay 
     set dokumer-20-detay to true
     move "1"          to dokumer-20-02

*     move "Bolum"      to det-01
*     move "Tarih"      to det-02
*     move "islem no"   to det-03
*     move "Aciklama"   to det-04
     perform pipe-at-rez

     move det-filler to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     set dokumer-20-detay       to true
     set dokumer-20-ekran-yazma to true
     move "2"          to dokumer-20-02
     perform cizgi-cek-rez

     move det-filler to dokumer-400
     write dokumer-rec, end-write
     .
*
 acc-07-Aft-Procedure.
     open input kllnc
     if staf-kod = spaces
        move "Tum Staff"   to staf-adi
     else
        initialize kllnc-rec
        move staf-kod    to k-kodu
        read kllnc no lock invalid
             move "Tanimsiz Staf ..." to k-adi
             move 4 to accept-control
             move 12 to control-id
        end-read
     end-if
     move k-adi    to staf-adi(1:20)
     move k-soyadi to staf-adi(22:20)
     display lb-stafadi
     close kllnc
     .
*
 yardimlar.
     evaluate control-id
       when 12
       when 2001 perform ara-staf
    end-evaluate
     .
*
 ara-staf.
     initialize staf-cagir
     call "/asya/ytl/obj/otel/stafara.asy" 
       using staf-cagir  
       on exception 
          perform callerr-proc
       not on exception
          if staf-cagir <> spaces
             move staf-cagir to staf-kod
             display acc-07
             perform acc-07-Aft-Procedure
          end-if
     end-call
     move 4 to accept-control
     inquire acc-07, id in control-id
     .
*
 init-takas.
     perform oku-genelfis
     
     move ekran-fis-1(2:) to takas-no
     open output takas
     close takas
     open i-o takas with mass-update
     .
*
 init-dokumer.
     perform oku-genelfis2
     initialize dokumer-rec
                dokumer-anah
                dokumer-ozellikler-rec
                dokumer-dosya

     set dokumer-asya-set   to true
     set dokumer-ekran-text to true
     move print-no          to dokumer-dosya-adi
     open output dokumer
     .
*
 oku-genelfis.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock
       invalid 
         move 1 to ekran-fis-1,
     end-read
     
     add 1 to ekran-fis-1
     rewrite genelfis-rec
       invalid 
         write genelfis-rec, end-write
     end-rewrite
     close genelfis
     .
*
 oku-genelfis2.
     open i-o genelfis
     move 1 to genelfis-anahtar
     read genelfis no lock
       invalid
         accept print-no from time
       not invalid
         add 1 to print-no
         rewrite genelfis-rec end-rewrite
     end-read
     close genelfis
     .
*
 aktar-islemler-takas.
     perform aktar-rez-takas
     perform aktar-romhrk-takas
     perform aktar-exthrk-takas
     perform aktar-odadegis-takas
     perform aktar-uzatma-takas
     perform aktar-dovboz-takas
     perform aktar-silhrk-takas
     perform aktar-cektr-takas
     close takas
     .
*
 aktar-rez-takas.
     open input rez
     perform start-rez
     close rez
     .
*
 start-rez.
     initialize rez-rec
     move "I"       to rez-durumu
     move ilk-tarih to rez-isl-tar
     start rez key >= rez-isl
       invalid
         move "10" to fs-rez
       not invalid
         initialize fs-rez
         perform islem-rez
     end-start
     .
*
 restart-rez.
     initialize rez-rec
     move "S"       to rez-durumu
     move ilk-tarih to rez-isl-tar
     start rez key >= rez-isl
       invalid
         move "10" to fs-rez
       not invalid
         initialize fs-rez
         perform islem-rez
     end-start
     .
*
 islem-rez.
     perform with test after
             until fs-rez = "10"
       perform oku-islem-rez
     end-perform
     .
*
 oku-islem-rez.
     read rez next no lock
       end
         move "10" to fs-rez
       not end
         perform filtreler-rez
     end-read
     .
*
 filtreler-rez.
     perform filtre-bitir-rez
     .
*
 filtre-bitir-rez.
     if rez-durumu = "S" and
        rez-isl-tar > son-tarih
        move "10" to fs-rez
     else
        perform filtre-next-rez
     end-if
     .
*
 filtre-next-rez.
     if (rez-durumu = "I" and
        rez-isl-tar > son-tarih) or
        (rez-durumu = "S" and
        rez-isl-tar < ilk-tarih)
        perform restart-rez
     else
        perform filtre-staf-rez
     end-if
     .
*
 filtre-staf-rez.
     if staf-kod = spaces or
        staf-kod = rez-staf
        perform yaz-rez-takas
     end-if
     .
*
 yaz-rez-takas.
     perform ata-takas-rez
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-rez.
     move rez-staf          to takas-staf
     set takas-islem-rez    to true
     move rez-isl-tar       to takas-tarih
     move rez-durumu        to takas-durumu
     move spaces            to takas-folio
     move rez-no            to takas-islem-no
     .
*
 aktar-romhrk-takas.
     open input romhrk
     perform start-romhrk
     close romhrk
     .
*
 start-romhrk.
     initialize romhrk-rec
     move ilk-tarih to romhrk-tarih
     start romhrk key >= romhrk-anah2
       invalid
         move "10" to fs-romhrk
       not invalid
         initialize fs-romhrk
         perform islem-romhrk
     end-start
     .
*
 islem-romhrk.
     perform with test after
             until fs-romhrk = "10"
       perform oku-islem-romhrk
     end-perform
     .
*
 oku-islem-romhrk.
     read romhrk next no lock
       end
         move "10" to fs-romhrk
       not end
         perform filtreler-romhrk
     end-read
     .
*
 filtreler-romhrk.
     perform filtre-bitir-romhrk
     .
*
 filtre-bitir-romhrk.
     if romhrk-tarih > son-tarih
        move "10" to fs-romhrk
     else
        perform filtre-next-romhrk
     end-if
     .
*
 filtre-next-romhrk.
     perform filtre-staf-romhrk
     .
*
 filtre-staf-romhrk.
     if staf-kod = spaces or
        staf-kod = romhrk-staf
        perform yaz-romhrk-takas
     end-if
     .
*
 yaz-romhrk-takas.
     perform ata-takas-romhrk
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-romhrk.
     move romhrk-staf       to takas-staf
     set takas-islem-romhrk to true
     move romhrk-tarih      to takas-tarih
     move space             to takas-durumu
     move romhrk-folio      to takas-folio
     move romhrk-islem      to takas-islem-no
     .
*
 aktar-exthrk-takas.
     open input exthrk
     perform start-exthrk
     close exthrk
     .
*
 start-exthrk.
     initialize exthrk-rec
     move ilk-tarih to exthrk-tarih
     start exthrk key >= exthrk-anah2
       invalid
         move "10" to fs-exthrk
       not invalid
         initialize fs-exthrk
         perform islem-exthrk
     end-start
     .
*
 islem-exthrk.
     perform with test after
             until fs-exthrk = "10"
       perform oku-islem-exthrk
     end-perform
     .
*
 oku-islem-exthrk.
     read exthrk next no lock
       end
         move "10" to fs-exthrk
       not end
         perform filtreler-exthrk
     end-read
     .
*
 filtreler-exthrk.
     perform filtre-bitir-exthrk
     .
*
 filtre-bitir-exthrk.
     if exthrk-tarih > son-tarih
        move "10" to fs-exthrk
     else
        perform filtre-next-exthrk
     end-if
     .
*
 filtre-next-exthrk.
     perform filtre-staf-exthrk
     .
*
 filtre-staf-exthrk.
     if staf-kod = spaces or
        staf-kod = exthrk-staf
        perform yaz-exthrk-takas
     end-if
     .
*
 yaz-exthrk-takas.
     perform ata-takas-exthrk
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-exthrk.
     move exthrk-staf       to takas-staf
     set takas-islem-exthrk to true
     move exthrk-tarih      to takas-tarih
     move space             to takas-durumu
     move exthrk-folio      to takas-folio
     move exthrk-islem      to takas-islem-no
     .
*
 aktar-odadegis-takas.
     open input odadegis
     perform start-odadegis
     close odadegis
     .
*
 start-odadegis.
     initialize odadegis-rec
     move ilk-tarih to odadegis-tarih
     start odadegis key >= odadegis-anah
       invalid
         move "10" to fs-odadegis
       not invalid
         initialize fs-odadegis
         perform islem-odadegis
     end-start
     .
*
 islem-odadegis.
     perform with test after
             until fs-odadegis = "10"
       perform oku-islem-odadegis
     end-perform
     .
*
 oku-islem-odadegis.
     read odadegis next no lock
       end
         move "10" to fs-odadegis
       not end
         perform filtreler-odadegis
     end-read
     .
*
 filtreler-odadegis.
     perform filtre-bitir-odadegis
     .
*
 filtre-bitir-odadegis.
     if odadegis-tarih > son-tarih
        move "10" to fs-odadegis
     else
        perform filtre-next-odadegis
     end-if
     .
*
 filtre-next-odadegis.
     perform filtre-staf-odadegis
     .
*
 filtre-staf-odadegis.
     if staf-kod = spaces or
        staf-kod = odadegis-staf
        perform yaz-odadegis-takas
     end-if
     .
*
 yaz-odadegis-takas.
     perform ata-takas-odadegis
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-odadegis.
     move odadegis-staf       to takas-staf
     set takas-islem-odadegis to true
     move odadegis-tarih      to takas-tarih
     move space               to takas-durumu
     move space               to takas-folio
     move odadegis-zaman      to takas-islem-no
     move odadegis-eski-oda   to takas-odano-1
     move odadegis-yeni-oda   to takas-odano-2
     .
*
 aktar-uzatma-takas.
     open input uzatma
     perform start-uzatma
     close uzatma
     .
*
 start-uzatma.
     initialize uzatma-rec
     move ilk-tarih to uzatma-tarih
     start uzatma key >= uzatma-anah
       invalid
         move "10" to fs-uzatma
       not invalid
         initialize fs-uzatma
         perform islem-uzatma
     end-start
     .
*
 islem-uzatma.
     perform with test after
             until fs-uzatma = "10"
       perform oku-islem-uzatma
     end-perform
     .
*
 oku-islem-uzatma.
     read uzatma next no lock
       end
         move "10" to fs-uzatma
       not end
         perform filtreler-uzatma
     end-read
     .
*
 filtreler-uzatma.
     perform filtre-bitir-uzatma
     .
*
 filtre-bitir-uzatma.
     if uzatma-tarih > son-tarih
        move "10" to fs-uzatma
     else
        perform filtre-next-uzatma
     end-if
     .
*
 filtre-next-uzatma.
     perform filtre-staf-uzatma
     .
*
 filtre-staf-uzatma.
     if staf-kod = spaces or
        staf-kod = uzatma-staf
        perform yaz-uzatma-takas
     end-if
     .
*
 yaz-uzatma-takas.
     perform ata-takas-uzatma
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-uzatma.
     move uzatma-staf       to takas-staf
     set takas-islem-uzatma to true
     move uzatma-tarih      to takas-tarih
     move space             to takas-durumu
     move uzatma-folio      to takas-folio
     move uzatma-zaman      to takas-islem-no
     move space             to takas-odano-1
     move space             to takas-odano-2
     .
*
 aktar-dovboz-takas.
     open input dov-boz
     perform start-dovboz
     close dov-boz
     .
*
 start-dovboz.
     initialize dov-boz-rec
     move ilk-tarih to dov-boz-tarih
     start dov-boz key >= dov-boz-anah
       invalid
         move "10" to fs-dov-boz
       not invalid
         initialize fs-dov-boz
         perform islem-dovboz
     end-start
     .
*
 islem-dovboz.
     perform with test after
             until fs-dov-boz = "10"
       perform oku-islem-dovboz
     end-perform
     .
*
 oku-islem-dovboz.
     read dov-boz next no lock
       end
         move "10" to fs-dov-boz
       not end
         perform filtreler-dovboz
     end-read
     .
*
 filtreler-dovboz.
     perform filtre-bitir-dovboz
     .
*
 filtre-bitir-dovboz.
     if dov-boz-tarih > son-tarih
        move "10" to fs-dov-boz
     else
        perform filtre-next-dovboz
     end-if
     .
*
 filtre-next-dovboz.
     perform filtre-staf-dovboz
     .
*
 filtre-staf-dovboz.
     if staf-kod = spaces or
        staf-kod = dov-boz-staf
        perform yaz-dovboz-takas
     end-if
     .
*
 yaz-dovboz-takas.
     perform ata-takas-dovboz
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-dovboz.
     move dov-boz-staf       to takas-staf
     set takas-islem-dovboz  to true
     move dov-boz-tarih      to takas-tarih
     move space              to takas-durumu
     move space              to takas-folio
     move dov-boz-fisno      to takas-islem-no
     move space              to takas-odano-1
     move space              to takas-odano-2
     .
*
 aktar-silhrk-takas.
     open input silhrk
     perform start-silhrk
     close silhrk
     .
*
 start-silhrk.
     initialize silhrk-rec
     move ilk-tarih to silhrk-tarih
     start silhrk key >= silhrk-anah2
       invalid
         move "10" to fs-silhrk
       not invalid
         initialize fs-silhrk
         perform islem-silhrk
     end-start
     .
*
 islem-silhrk.
     perform with test after
             until fs-silhrk = "10"
       perform oku-islem-silhrk
     end-perform
     .
*
 oku-islem-silhrk.
     read silhrk next no lock
       end
         move "10" to fs-silhrk
       not end
         perform filtreler-silhrk
     end-read
     .
*
 filtreler-silhrk.
     perform filtre-bitir-silhrk
     .
*
 filtre-bitir-silhrk.
     if silhrk-tarih > son-tarih
        move "10" to fs-silhrk
     else
        perform filtre-next-silhrk
     end-if
     .
*
 filtre-next-silhrk.
     perform filtre-staf-silhrk
     .
*
 filtre-staf-silhrk.
     if staf-kod = spaces or
        staf-kod = silhrk-staf
        perform yaz-silhrk-takas
     end-if
     .
*
 yaz-silhrk-takas.
     perform ata-takas-silhrk
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-silhrk.
     move silhrk-staf       to takas-staf
     set takas-islem-silhrk to true
     move silhrk-tarih      to takas-tarih
     move space             to takas-durumu
     move silhrk-folio      to takas-folio
     move silhrk-islem      to takas-islem-no
     move space             to takas-odano-1
     move space             to takas-odano-2
     .
*
 aktar-cektr-takas.
     open input cektr
     perform start-cektr
     close cektr
     .
*
 start-cektr.
     initialize cektr-rec
     move ilk-tarih to cektr-isl-tarih
     start cektr key >= cektr-isl-tarih
       invalid
         move "10" to fs-cektr
       not invalid
         initialize fs-cektr
         perform islem-cektr
     end-start
     .
*
 islem-cektr.
     perform with test after
             until fs-cektr = "10"
       perform oku-islem-cektr
     end-perform
     .
*
 oku-islem-cektr.
     read cektr next no lock
       end
         move "10" to fs-cektr
       not end
         perform filtreler-cektr
     end-read
     .
*
 filtreler-cektr.
     perform filtre-bitir-cektr
     .
*
 filtre-bitir-cektr.
     if cektr-isl-tarih > son-tarih
        move "10" to fs-cektr
     else
        perform filtre-next-cektr
     end-if
     .
*
 filtre-next-cektr.
     perform filtre-staf-cektr
     .
*
 filtre-staf-cektr.
     if staf-kod = spaces or
        staf-kod = cektr-staf
        perform yaz-cektr-takas
     end-if
     .
*
 yaz-cektr-takas.
     perform ata-takas-cektr
     write takas-rec
       invalid
         rewrite takas-rec, end-rewrite
     end-write
     .
*
 ata-takas-cektr.
     move cektr-staf       to takas-staf
     set takas-islem-cektr to true
     move cektr-tarih      to takas-tarih
     move space            to takas-durumu
     move cektr-eski-folio to takas-folio
     move cektr-yeni-folio to takas-folio2
     move cektr-islem      to takas-islem-no
     move space            to takas-odano-1
     move space            to takas-odano-2
     .
*
 isle-takas-dokumer.
     perform yaz-dokumer-baslik-rez
     perform isle-dokumer-rez

     perform yaz-dokumer-baslik-romhrk
     perform isle-dokumer-romhrk

     perform yaz-dokumer-baslik-exthrk
     perform isle-dokumer-exthrk

     perform yaz-dokumer-baslik-odadegis
     perform isle-dokumer-odadegis

     perform yaz-dokumer-baslik-uzatma
     perform isle-dokumer-uzatma
 
     perform yaz-dokumer-baslik-dovboz
     perform isle-dokumer-dovboz
 
     perform yaz-dokumer-baslik-silhrk
     perform isle-dokumer-silhrk
 
     perform yaz-dokumer-baslik-cektr
     perform isle-dokumer-cektr
     .
*
 yaz-dokumer-baslik-rez.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "REZERVASYON BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-rez-01
     move "Staf Adi"       to det-rez-02
     move "islem Tar."     to det-rez-03
     move "D"              to det-rez-04
     move "Rez No"         to det-rez-05
     move "Adi"            to det-rez-06
     move "Soyadi"         to det-rez-07
     move "Pax"            to det-rez-08
     move "Chi"            to det-rez-09
     move "Free"           to det-rez-10
     move "Beb."           to det-rez-100
     move "C/In"           to det-rez-11
     move "C/Out"          to det-rez-12
     move "Rez"            to det-rez-13
     move "Odeme"          to det-rez-14
     move "Acen"           to det-rez-15
     move "Ulke"           to det-rez-16
     move "Voucher"        to det-rez-17
     move "Anlas"          to det-rez-18
     move "Bn"             to det-rez-19
     move "Dv"             to det-rez-20
     move "Rez.Fiyati"     to det-rez-21
     move "Gun"            to det-rez-22
     move "Toplam Rez.Fiy" to det-rez-23
     move "Pazar"          to det-rez-24
     move "X"              to det-rez-25
     move "Pk"             to det-rez-26
     move "K"              to det-rez-27
     move "Konu"           to det-rez-28
     move "Tip"            to det-rez-29
     move "Oda"            to det-rez-30
     move "Grup"           to det-rez-31
     move "IO"             to det-rez-32
     move "KO"             to det-rez-33
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-rez.
     open input kllnc rez kodlar02 acenta ulke konum
     initialize takas-rec
                fs-takas
     move "1" to takas-islem
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-rez-takas
     end-start
     close kllnc rez kodlar02 acenta ulke konum
     .
*
 isle-rez-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-rez-takas
     end-perform
     .
*
 oku-rez-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-rez-takas
     end-read
     .
*
 filtre-rez-takas.
     if takas-islem not = "1"
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-rez
        move det-filler-rez to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-rez.
     move takas-staf       to det-rez-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-rez-02(01:20)
     move k-soyadi         to det-rez-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-rez-03
     move takas-durumu     to det-rez-04

     initialize rez-rec
     move takas-islem-no to rez-no
     perform oku-rez

     move rez-no           to det-rez-05
     move rez-adi          to det-rez-06
     move rez-soyadi       to det-rez-07
     move rez-buyuk        to z2
     move z2               to det-rez-08
     move rez-kucuk        to z2
     move z2               to det-rez-09
     move rez-free         to z2
     move z2               to det-rez-10
     move rez-bebek        to z2
     move z2               to det-rez-100
     move rez-gir-gun      to z-gun
     move rez-gir-ay       to z-ay
     move rez-gir-yil      to z-yil
     move z-tarih          to det-rez-11
     move rez-cik-gun      to z-gun
     move rez-cik-ay       to z-ay
     move rez-cik-yil      to z-yil
     move z-tarih          to det-rez-12
     evaluate rez-tipi
       when 1  move "Alotment" to det-rez-13
       when 2  move "It"       to det-rez-13
       when 3  move "Fit"      to det-rez-13
       when 4  move "Grup"     to det-rez-13
       when 5  move "Munferit" to det-rez-13
       when 6  move "Walk/in"  to det-rez-13
       when 7  move "Sirket"   to det-rez-13
       when 8  move "Ozel"     to det-rez-13
     end-evaluate

     initialize kodlar02-rec
     move rez-odeme-tipi   to kodlar02-kodu
     perform oku-odeme
     move kodlar02-adi     to det-rez-14

     initialize acenta-rec
     move rez-acenta       to acenta-anahtar
     perform oku-acenta
     move acenta-adi       to det-rez-15

     initialize ulke-rec
     move rez-ulke         to ulke-anah
     move ulke-adi         to det-rez-16

     move rez-voucher      to det-rez-17

     initialize kodlar02-rec
     move rez-anlasma      to kodlar02-kodu
     perform oku-anlasma
     move kodlar02-adi     to det-rez-18

     move rez-banka        to det-rez-19
     move rez-doviz        to det-rez-20

     move rez-gir-tar      to g-bul-ilk-tarih
     move rez-cik-tar      to g-bul-son-tarih
     perform g-bul thru g-bul-exit
     perform peryot-fiyat-bul
     COMPUTE rez-fiyati
           = top-rez-fiyati / g-bul-gun-sayisi
     end-compute
     move rez-fiyati       to z15
     move z15              to det-rez-21

     move g-bul-gun-sayisi to z4
     move z4               to det-rez-22

     move top-rez-fiyati   to z15
     move z15              to det-rez-23

     initialize kodlar02-rec
     move rez-pazar        to kodlar02-kodu
     perform oku-pazar
     move kodlar02-adi     to det-rez-24

     move rez-eb           to det-rez-25
     move rez-pan-tipi     to det-rez-26
     move rez-kur-aygun    to det-rez-27

     initialize konum-rec
     move rez-oda-konumu   to konum-anahtar
     perform oku-konum
     move konum-adi        to det-rez-28

     evaluate rez-s-d-t-g
       when 1 move "Single" to det-rez-29
       when 2 move "Double" to det-rez-29
       when 3 move "Triple" to det-rez-29
       when 4 move "Grup"   to det-rez-29
     end-evaluate

     move rez-odano        to det-rez-30
     move rez-grup-no      to det-rez-31
     move rez-nor-indirim  to z2
     move z2               to det-rez-32
     move rez-komisyon     to z2
     move z2               to det-rez-33
     .
*
 yaz-dokumer-baslik-romhrk.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "ROOM FOLIO BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-rom-01
     move "Staf Adi"       to det-rom-02
     move "islem Tar."     to det-rom-03
     move "Oda"            to det-rom-04
     move "DK"             to det-rom-05
     move "Departman"      to det-rom-06
     move "Folio"          to det-rom-07
     move "Adi"            to det-rom-08
     move "Soyadi"         to det-rom-09
     move "Isl.no"         to det-rom-10
     move "TL. Tutar"      to det-rom-11
     move "DV. Tutar"      to det-rom-12
     move "Kart"           to det-rom-13
     move "Cek"            to det-rom-14
     move "Zaman"          to det-rom-15
     move "PD"             to det-rom-16
     move det-filler-rom to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-rom
     move det-filler-rom to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-romhrk.
     open input kllnc romhrk konuk depkod
     initialize takas-rec
                fs-takas
     set takas-islem-romhrk to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-romhrk-takas
     end-start
     close kllnc romhrk konuk depkod
     .
*
 isle-romhrk-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-romhrk-takas
     end-perform
     .
*
 oku-romhrk-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-romhrk-takas
     end-read
     .
*
 filtre-romhrk-takas.
     if not takas-islem-romhrk
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-romhrk
        move det-filler-rom to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-romhrk.
     move takas-staf       to det-rom-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-rom-02(01:20)
     move k-soyadi         to det-rom-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-rom-03

     initialize romhrk-rec
     move takas-folio      to romhrk-folio
                              konuk-folio
     move takas-islem-no   to romhrk-islem
     perform oku-romhrk
     perform oku-konuk

     move konuk-odano      to det-rom-04

     initialize depkod-rec
     move romhrk-depkod    to det-rom-05
                              depkod-kodu
     perform oku-depkod
     move depkod-adi       to det-rom-06

     move konuk-folio      to det-rom-07
     move konuk-adi        to det-rom-08
     move konuk-soyadi     to det-rom-09
     move romhrk-islem     to det-rom-10
     move romhrk-tl-tutar  to z10v2
     move z10v2            to det-rom-11
     move romhrk-dv-tutar  to z9v2
     move z9v2             to det-rom-12
     move romhrk-kart-no   to det-rom-13
     move romhrk-cekno     to det-rom-14
     move romhrk-saat      to z-saat
     move romhrk-dakika    to z-dak
     move romhrk-saniye    to z-san
     move z-zaman          to det-rom-15
     move romhrk-pos-kodu  to det-rom-16
     .
*
 yaz-dokumer-baslik-exthrk.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "EXTRA FOLIO BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-rom-01
     move "Staf Adi"       to det-rom-02
     move "islem Tar."     to det-rom-03
     move "Oda"            to det-rom-04
     move "DK"             to det-rom-05
     move "Departman"      to det-rom-06
     move "Folio"          to det-rom-07
     move "Adi"            to det-rom-08
     move "Soyadi"         to det-rom-09
     move "Isl.no"         to det-rom-10
     move "TL. Tutar"      to det-rom-11
     move "DV. Tutar"      to det-rom-12
     move "Kart"           to det-rom-13
     move "Cek"            to det-rom-14
     move "Zaman"          to det-rom-15
     move "PD"             to det-rom-16
     move det-filler-rom to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-rom
     move det-filler-rom to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-exthrk.
     open input kllnc exthrk konuk depkod
     initialize takas-rec
                fs-takas
     set takas-islem-exthrk to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-exthrk-takas
     end-start
     close kllnc exthrk konuk depkod
     .
*
 isle-exthrk-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-exthrk-takas
     end-perform
     .
*
 oku-exthrk-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-exthrk-takas
     end-read
     .
*
 filtre-exthrk-takas.
     if not takas-islem-exthrk
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-exthrk
        move det-filler-rom to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-exthrk.
     move takas-staf       to det-rom-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-rom-02(01:20)
     move k-soyadi         to det-rom-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-rom-03

     initialize exthrk-rec
     move takas-folio      to exthrk-folio
                              konuk-folio
     move takas-islem-no   to exthrk-islem
     perform oku-exthrk
     perform oku-konuk

     move konuk-odano      to det-rom-04

     initialize depkod-rec
     move exthrk-depkod    to det-rom-05
                              depkod-kodu
     perform oku-depkod
     move depkod-adi       to det-rom-06

     move konuk-folio      to det-rom-07
     move konuk-adi        to det-rom-08
     move konuk-soyadi     to det-rom-09
     move exthrk-islem     to det-rom-10
     move exthrk-tl-tutar  to z10v2
     move z10v2            to det-rom-11
     move exthrk-dv-tutar  to z9v2
     move z9v2             to det-rom-12
     move exthrk-kart-no   to det-rom-13
     move exthrk-cekno     to det-rom-14
     move exthrk-saat      to z-saat
     move exthrk-dakika    to z-dak
     move exthrk-saniye    to z-san
     move z-zaman          to det-rom-15
     move exthrk-pos-kodu  to det-rom-16
     .
*
 yaz-dokumer-baslik-odadegis.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "ROOM CHANGE BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-rch-01
     move "Staf Adi"       to det-rch-02
     move "islem Tar."     to det-rch-03
     move "Eski"           to det-rch-04
     move "Yeni"           to det-rch-05
     move "Zaman"          to det-rch-06
     move "Folio"          to det-rch-07
     move "Adi"            to det-rch-08
     move "Soyadi"         to det-rch-09
     move "Aciklama"       to det-rch-10
     move det-filler-rch   to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-rch
     move det-filler-rch to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-odadegis.
     open input kllnc odadegis konuk
     initialize takas-rec
                fs-takas
     set takas-islem-odadegis to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-odadegis-takas
     end-start
     close kllnc odadegis konuk
     .
*
 isle-odadegis-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-odadegis-takas
     end-perform
     .
*
 oku-odadegis-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-odadegis-takas
     end-read
     .
*
 filtre-odadegis-takas.
     if not takas-islem-odadegis
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-odadegis
        move det-filler-rch to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-odadegis.
     move takas-staf       to det-rch-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-rch-02(01:20)
     move k-soyadi         to det-rch-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-rch-03

     initialize odadegis-rec
     move takas-tarih       to odadegis-tarih
     move takas-odano-1     to odadegis-eski-oda
     move takas-odano-2     to odadegis-yeni-oda
     move takas-islem-no    to odadegis-zaman
     perform oku-odadegis

     move odadegis-eski-oda to det-rch-04
     move odadegis-yeni-oda to det-rch-05
     move odadegis-saat     to z-saat
     move odadegis-dakika   to z-dak
     move odadegis-saniye   to z-san
     move z-zaman           to det-rch-06
     move odadegis-folio    to det-rch-07

     move odadegis-folio    to konuk-folio
     perform oku-konuk
     move konuk-adi         to det-rch-08
     move konuk-soyadi      to det-rch-09
     move odadegis-aciklama to det-rom-10
     .
*
 yaz-dokumer-baslik-uzatma.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "ROOM EXTENSION BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-uza-01
     move "Staf Adi"       to det-uza-02
     move "islem Tar."     to det-uza-03
     move "Zaman"          to det-uza-04
     move "Oda "           to det-uza-05
     move "E.Tarih"        to det-uza-06
     move "Y.Tarih"        to det-uza-07
     move "Folio"          to det-uza-08
     move "Adi"            to det-uza-09
     move "Soyadi"         to det-uza-10
     move "Aciklama"       to det-uza-11
     move det-filler-uza to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-uza
     move det-filler-uza to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-uzatma.
     open input kllnc uzatma konuk
     initialize takas-rec
                fs-takas
     set takas-islem-uzatma to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-uzatma-takas
     end-start
     close kllnc uzatma konuk
     .
*
 isle-uzatma-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-uzatma-takas
     end-perform
     .
*
 oku-uzatma-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-uzatma-takas
     end-read
     .
*
 filtre-uzatma-takas.
     if not takas-islem-uzatma
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-uzatma
        move det-filler-uza to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-uzatma.
     move takas-staf       to det-uza-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-uza-02(01:20)
     move k-soyadi         to det-uza-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-uza-03

     initialize uzatma-rec
     move takas-tarih      to uzatma-tarih
     move takas-folio      to uzatma-folio
                              konuk-folio
     move takas-islem-no   to uzatma-zaman
     perform oku-uzatma
     perform oku-konuk

     move uzatma-saat      to z-saat
     move uzatma-dakika    to z-dak
     move uzatma-saniye    to z-san
     move z-zaman          to det-uza-04
     
     move konuk-odano      to det-uza-05

     move uzatma-eski-gun  to z-gun
     move uzatma-eski-ay   to z-ay
     move uzatma-eski-yil  to z-yil
     move z-tarih          to det-uza-06

     move uzatma-yeni-gun  to z-gun
     move uzatma-yeni-ay   to z-ay
     move uzatma-yeni-yil  to z-yil
     move z-tarih          to det-uza-07

     move uzatma-folio     to det-uza-08
     move konuk-adi        to det-uza-09
     move konuk-soyadi     to det-uza-10
     move uzatma-aciklama  to det-uza-11
     .
*
 yaz-dokumer-baslik-dovboz.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "EXCHANGE BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"            to det-dov-01
     move "Staf Adi"        to det-dov-02
     move "islem Tar."      to det-dov-03
     move "D"               to det-dov-04
     move "Fis no"          to det-dov-05
     move "Bk"              to det-dov-06
     move "Banka adi"       to det-dov-07
     move "Dk"              to det-dov-08
     move "Doviz adi"       to det-dov-09
     move "D/E"             to det-dov-10
     move "Kur tutari"      to det-dov-11
     move "Doviz tutari"    to det-dov-12
     move "TL.Tutari"       to det-dov-13
     move "K%"              to det-dov-14
     move "Komisyon tutari" to det-dov-15
     move "TL. Net Tutar"   to det-dov-16
     move det-filler-dov    to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-dov
     move det-filler-dov to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-dovboz.
     open input kllnc dov-boz banka doviz
     initialize takas-rec
                fs-takas
     set takas-islem-dovboz to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-dovboz-takas
     end-start
     close kllnc dov-boz banka doviz
     .
*
 isle-dovboz-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-dovboz-takas
     end-perform
     .
*
 oku-dovboz-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-dovboz-takas
     end-read
     .
*
 filtre-dovboz-takas.
     if not takas-islem-dovboz
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-dovboz
        move det-filler-rch to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-dovboz.
     move takas-staf          to det-dov-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi                to det-dov-02(01:20)
     move k-soyadi             to det-dov-02(21:20)

     move takas-gun            to z-gun
     move takas-ay             to z-ay
     move takas-yil            to z-yil
     move z-tarih              to det-dov-03

     initialize dov-boz-rec
     move takas-tarih          to dov-boz-tarih
     move takas-islem-no       to dov-boz-fisno
     perform oku-dovboz

     move dov-boz-durumu       to det-dov-04
     move dov-boz-fisno        to det-dov-05

     initialize banka-rec
     move dov-boz-banka        to det-dov-06
                                  banka-kodu
     perform oku-banka
     move banka-adi            to det-dov-07

     initialize doviz-rec
     move dov-boz-doviz        to det-dov-08
                                  doviz-kodu
     perform oku-doviz
     move d-adi-1              to det-dov-09

     move dov-boz-tipi         to det-dov-10

     move dov-boz-kur-tutar    to z7v5
     move z7v5                 to det-dov-11

     move dov-boz-dv-tutar     to z9v2
     move z9v2                 to det-dov-12

     move dov-boz-tl-tutar     to z10v2
     move z10v2                to det-dov-13

     move dov-boz-kom-orani    to det-dov-14

     move dov-boz-komisyon     to z10v2
     move z10v2                to det-dov-15
     
     move dov-boz-net-tl-tutar to z10v2
     move z10v2                to det-dov-16
     .
*
 yaz-dokumer-baslik-silhrk.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "DELETED RECORDS BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-rom-01
     move "Staf Adi"       to det-rom-02
     move "islem Tar."     to det-rom-03
     move "Oda"            to det-rom-04
     move "DK"             to det-rom-05
     move "Departman"      to det-rom-06
     move "Folio"          to det-rom-07
     move "Adi"            to det-rom-08
     move "Soyadi"         to det-rom-09
     move "Isl.no"         to det-rom-10
     move "TL. Tutar"      to det-rom-11
     move "DV. Tutar"      to det-rom-12
     move "Kart"           to det-rom-13
     move "Cek"            to det-rom-14
     move "Zaman"          to det-rom-15
     move "PD"             to det-rom-16
     move det-filler-rom to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-rom
     move det-filler-rom to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-silhrk.
     open input kllnc silhrk konuk depkod
     initialize takas-rec
                fs-takas
     set takas-islem-silhrk to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-silhrk-takas
     end-start
     close kllnc silhrk konuk depkod
     .
*
 isle-silhrk-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-silhrk-takas
     end-perform
     .
*
 oku-silhrk-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-silhrk-takas
     end-read
     .
*
 filtre-silhrk-takas.
     if not takas-islem-silhrk
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-silhrk
        move det-filler-rom to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-silhrk.
     move takas-staf       to det-rom-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-rom-02(01:20)
     move k-soyadi         to det-rom-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-rom-03

     initialize silhrk-rec
     move takas-folio      to silhrk-folio
                              konuk-folio
     move takas-islem-no   to silhrk-islem
     perform oku-silhrk
     perform oku-konuk

     move konuk-odano      to det-rom-04

     initialize depkod-rec
     move silhrk-depkod    to det-rom-05
                              depkod-kodu
     perform oku-depkod
     move depkod-adi       to det-rom-06

     move konuk-folio      to det-rom-07
     move konuk-adi        to det-rom-08
     move konuk-soyadi     to det-rom-09
     move silhrk-islem     to det-rom-10
     move silhrk-tl-tutar  to z10v2
     move z10v2            to det-rom-11
     move silhrk-dv-tutar  to z9v2
     move z9v2             to det-rom-12
     move silhrk-kart-no   to det-rom-13
     move silhrk-cekno     to det-rom-14
     move silhrk-saat      to z-saat
     move silhrk-dakika    to z-dak
     move silhrk-saniye    to z-san
     move z-zaman          to det-rom-15
     move silhrk-pos-kodu  to det-rom-16
     .
*
 yaz-dokumer-baslik-cektr.
     initialize dokumer-rec detay 
     move all "-" to det-filler-rez
     move det-filler-rez to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "CEK FOLIO TRANSFER BOLUMU" to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     move "Staf"           to det-cek-01
     move "Staf Adi"       to det-cek-02
     move "islem Tar."     to det-cek-03
     move "Isl.No"         to det-cek-04
     move "Eski Oda/Folio" to det-cek-05
     move "Yeni Oda/Folio" to det-cek-06
     move "Cek Tarihi"     to det-cek-07
     move "Departman"      to det-cek-08
     move "T.l. tutar"     to det-cek-09
     move "D.v. tutar"     to det-cek-10
     move det-filler-cek to dokumer-400
     write dokumer-rec, end-write

     initialize dokumer-rec detay 
     perform cizgi-cek-cek
     move det-filler-cek to dokumer-400
     write dokumer-rec, end-write
     .
*
 isle-dokumer-cektr.
     open input kllnc cektr konuk depkod
     initialize takas-rec
                fs-takas
     set takas-islem-cektr to true
     start takas key >= takas-anah
       invalid
         continue
       not invalid
         initialize fs-takas
         perform isle-cektr-takas
     end-start
     close kllnc cektr konuk depkod
     .
*
 isle-cektr-takas.
     perform with test after
             until fs-takas = "10"
       perform oku-cektr-takas
     end-perform
     .
*
 oku-cektr-takas.
     read takas next no lock
       end
         move "10" to fs-takas
       not at end
         perform filtre-cektr-takas
     end-read
     .
*
 filtre-cektr-takas.
     if not takas-islem-cektr
        move "10" to fs-takas
     else
        initialize dokumer-rec detay 
        perform ata-takas-dokumer-cektr
        move det-filler-cek to dokumer-400
        write dokumer-rec, end-write
     end-if
     .
*
 ata-takas-dokumer-cektr.
     move takas-staf       to det-cek-01
     initialize kllnc-rec
     move takas-staf to k-kodu
     perform oku-staf
     move k-adi            to det-cek-02(01:20)
     move k-soyadi         to det-cek-02(21:20)

     move takas-gun        to z-gun
     move takas-ay         to z-ay
     move takas-yil        to z-yil
     move z-tarih          to det-cek-03

     initialize cektr-rec
     move takas-folio      to cektr-eski-folio
     move takas-folio2     to cektr-yeni-folio
     move takas-islem-no   to cektr-islem
     perform oku-cektr

     move cektr-islem      to det-cek-04
     
     initialize konuk-rec
     move cektr-eski-folio to konuk-folio
     perform oku-konuk
     move konuk-odano      to det-cek-05(01:04)
     move cektr-eski-folio to det-cek-05(06:08)

     initialize konuk-rec
     move cektr-yeni-folio to konuk-folio
     perform oku-konuk
     move konuk-odano      to det-cek-06(01:04)
     move cektr-yeni-folio to det-cek-06(06:08)

     move cektr-gun        to z-gun
     move cektr-ay         to z-ay
     move cektr-yil        to z-yil
     move z-tarih          to det-cek-07

     initialize depkod-rec
     move cektr-depkod     to det-cek-08(01:03)
                              depkod-kodu
     perform oku-depkod
     move depkod-adi       to det-cek-08(05:10)

     move cektr-tl-tutar   to z10v2
     move z10v2            to det-cek-09
     move cektr-dv-tutar   to z9v2
     move z9v2             to det-cek-10
     .
*
 oku-staf.
     read kllnc no lock
       invalid
         move "Tanimsiz" to k-adi
     end-read
     .
*
 oku-rez.
     read rez no lock
       invalid
         initialize rez-rec
     end-read
     .
*
 oku-odeme.
     move "B" to kodlar02-tipi
     read kodlar02 no lock
       invalid
         move "Tanimsiz" to kodlar02-adi
     end-read
     .
*
 oku-acenta.
     read acenta no lock
       invalid
         move "Tanimsiz" to acenta-adi
     end-read
     .
*
 oku-ulke.
     read ulke no lock
       invalid 
         move "Tanimsiz" to ulke-adi
     end-read
     .
*
 oku-anlasma.
     move "D" to kodlar02-tipi
     read kodlar02 no lock
       invalid
         move "Tanimsiz" to kodlar02-adi
     end-read
     .
*
 oku-pazar.
     move "E" to kodlar02-tipi
     read kodlar02 no lock
       invalid
         move "Tanimsiz" to kodlar02-adi
     end-read
     .
*
 oku-konum.
     read konum no lock
       invalid
         move "Tanimsiz" to konum-adi
     end-read
     .
*
 oku-romhrk.
     read romhrk no lock
       invalid
         initialize romhrk-rec
     end-read
     .
*
 oku-exthrk.
     read exthrk no lock
       invalid
         initialize exthrk-rec
     end-read
     .
*
 oku-odadegis.
     read odadegis no lock
       invalid
         initialize odadegis-rec
     end-read
     .
*
 oku-uzatma.
     read uzatma no lock
       invalid
         initialize uzatma-rec
     end-read
     .
*
 oku-dovboz.
     read dov-boz no lock
       invalid
         initialize dov-boz-rec
     end-read
     .
*
 oku-silhrk.
     read silhrk no lock
       invalid
         initialize silhrk-rec
     end-read
     .
*
 oku-cektr.
     read cektr no lock
       invalid
         initialize cektr-rec
     end-read
     .
*
 oku-konuk.
     read konuk no lock
       invalid
         initialize konuk-rec
     end-read
     .
*
 oku-depkod.
     read depkod no lock
       invalid
         move "Tanimsiz" to depkod-adi
     end-read
     .
*
 oku-banka.
     read banka no lock
       invalid
         move "Tanimsiz" to banka-adi
     end-read
     .
*
 oku-doviz.
     read doviz no lock
       invalid
         move "Tanimsiz" to d-adi-1
     end-read
     .
*
 finish-dokumer.
     close dokumer
     call dokumer-prog
       on exception
          perform callerr-proc
       not on exception
          cancel dokumer-prog
     end-call
     delete file dokumer
     .
*
 pipe-at-rez.
*     move "|" to fil-01 fil-02 fil-03 fil-04
     .
*
 cizgi-cek-rez.
     move all "-" to det-rez-01
                     det-rez-02
                     det-rez-03
                     det-rez-04
                     det-rez-05
                     det-rez-06
                     det-rez-07
                     det-rez-08
                     det-rez-09
                     det-rez-10
                     det-rez-100
                     det-rez-11
                     det-rez-12
                     det-rez-13
                     det-rez-14
                     det-rez-15
                     det-rez-16
                     det-rez-17
                     det-rez-18
                     det-rez-19
                     det-rez-20
                     det-rez-21
                     det-rez-22
                     det-rez-23
                     det-rez-24
                     det-rez-25
                     det-rez-26
                     det-rez-27
                     det-rez-28
                     det-rez-29
                     det-rez-30
                     det-rez-31
                     det-rez-32
                     det-rez-33
     .
*
 cizgi-cek-rom.
     move all "-" to det-rom-01
                     det-rom-02
                     det-rom-03
                     det-rom-04
                     det-rom-05
                     det-rom-06
                     det-rom-07
                     det-rom-08
                     det-rom-09
                     det-rom-10
                     det-rom-11
                     det-rom-12
                     det-rom-13
                     det-rom-14
                     det-rom-15
                     det-rom-16
     .
*
 cizgi-cek-rch.
     move all "-" to det-rch-01
                     det-rch-02
                     det-rch-03
                     det-rch-04
                     det-rch-05
                     det-rch-06
                     det-rch-07
                     det-rch-08
                     det-rch-09
                     det-rch-10
     .
*
 cizgi-cek-uza.
     move all "-" to det-uza-01
                     det-uza-02
                     det-uza-03
                     det-uza-04
                     det-uza-05
                     det-uza-06
                     det-uza-07
                     det-uza-08
                     det-uza-09
                     det-uza-10
                     det-uza-11
     .
*
 cizgi-cek-dov.
     move all "-" to det-dov-01
                     det-dov-02
                     det-dov-03
                     det-dov-04
                     det-dov-05
                     det-dov-06
                     det-dov-07
                     det-dov-08
                     det-dov-09
                     det-dov-10
                     det-dov-11
                     det-dov-12
                     det-dov-13
                     det-dov-14
                     det-dov-15
                     det-dov-16
     .
*
 cizgi-cek-cek.
     move all "-" to det-cek-01
                     det-cek-02
                     det-cek-03
                     det-cek-04
                     det-cek-05
                     det-cek-06
                     det-cek-07
                     det-cek-08
                     det-cek-09
                     det-cek-10
     .
*
 peryot-fiyat-bul.
     open input takvim aksiyhrk fiyat fiyatana
     initialize aksiyhrk-rec aksiyon-durumu
     move "A"              to aksiyhrk-tipi
     move rez-acenta       to aksiyhrk-acenta
     move rez-gir-tar      to aksiyhrk-tarih
     move rez-pan-tipi     to aksiyhrk-pan-tipi
     move g-bul-gun-sayisi to aksiyhrk-gecele

     read aksiyhrk no lock
       invalid
         continue
       not invalid
         set aksiyon-var to true
     end-read

     move rez-fiyati    to ilk-rez-fiyati

     initialize g-bul-gun-sayisi
                takvim-rec
                top-rez-fiyati
     move rez-gir-tar   to takvim-anah
     start takvim key >= takvim-anah
       invalid
         move 1 to g-bul-gun-sayisi
       not invalid
         initialize fs-takvim
         perform with test after
                 until fs-takvim = "10"
           read takvim next no lock
             end
               move "10" to fs-takvim
             not at end
               if takvim-anah = rez-cik-tar
                  move "10" to fs-takvim
                  exit perform cycle
               end-if
               if takvim-anah not > rez-cik-tar
                  perform fiyat-bul thru fiyat-bul-exit
                  add 1 to g-bul-gun-sayisi
                  compute top-rez-fiyati
                        = top-rez-fiyati + ilk-rez-fiyati
               else
                  move "10" to fs-takvim
               end-if
           end-read
         end-perform
     end-start
     close takvim aksiyhrk fiyat fiyatana
     
     if top-rez-fiyati <> zeroes
        continue
     else
        compute top-rez-fiyati
              = g-bul-gun-sayisi * rez-fiyati
     end-if
     .
*
 fiyat-bul.
     if rez-fiyat-fix = "E"
        go fiyat-bulundu
     end-if

     move 0 to oda-fiyati
     move rez-acenta        to fiyat-acenta
     move takvim-anah       to fiyat-tarih
     move rez-tipi          to fiyat-rez-tipi
     move rez-pan-tipi      to fiyat-pan-tipi
     move rez-banka         to fiyat-banka
     move rez-doviz         to fiyat-doviz
     move rez-anlasma       to fiyat-anlasma
     move rez-buyuk         to fiyat-buyuk
     move rez-kucuk         to fiyat-kucuk
     read fiyat no lock
       invalid
         go fiyat-bulundu
     end-read
     move fiyat-acenta    to fiyatana-acenta
     move fiyat-bas-tarih to fiyatana-ilk-tarih
     move fiyat-bit-tarih to fiyatana-son-tarih
     move fiyat-rez-tipi  to fiyatana-rez-tipi
     move fiyat-pan-tipi  to fiyatana-pan-tipi
     move fiyat-banka     to fiyatana-banka
     move fiyat-doviz     to fiyatana-doviz
     move fiyat-anlasma   to fiyatana-anlasma
     move fiyat-buyuk     to fiyatana-buyuk
     move fiyat-kucuk     to fiyatana-kucuk
     read fiyatana no lock
       invalid 
         go fiyat-bulundu
     end-read

     move fiyatana-oda-fiyati(rez-oda-konumu) to oda-fiyati

     if rez-fiyat-konumu not = spaces and
        rez-fiyat-konumu not = zeroes
        move fiyatana-oda-fiyati(rez-fiyat-konumu) to oda-fiyati
     end-if

*/********* 
     if rez-nor-indirim not = 0 
        compute oda-fiyati = 
              (((oda-fiyati * rez-nor-indirim) / 100) - oda-fiyati)
     end-if
*/Early booking orani var ve early booking uygulanacak ise 
     if rez-eb = "E" and fiyatana-eb-oran not = 0 
     compute oda-fiyati = 
            (((oda-fiyati * fiyatana-eb-oran) / 100) - oda-fiyati)
     end-if
*/Kick back
     if fiyatana-kick-back not = 0 
     compute oda-fiyati = 
            (((oda-fiyati * fiyatana-kick-back) / 1000) - oda-fiyati)
     end-if
     . 

 aksiyonlu-uyar. 
*     if rez-eb = "E" and fiyatana-eb-oran not = 0 
*        and eb-de-aksiyon-hesaplama = 1
*        set aksiyon-yok to true
*     end-if

     if rez-aksiyon-eh = "H" 
        set aksiyon-yok to true
     else
        if rez-eb = "E" and fiyatana-eb-oran not = 0 
*           and eb-de-aksiyon-hesaplama = 1
           set aksiyon-yok to true
        end-if
     end-if

     if aksiyon-var
     compute oda-fiyati = ((oda-fiyati * aksiyhrk-ode) / aksiyhrk-gecele). 
*****if oda-fiyati <> rez-fiyati 
     move oda-fiyati  to ilk-rez-fiyati
     .
 aksiyonlu-uyar-exit. 
     exit
     . 

 fiyat-bulundu. 
 fiyat-bul-exit. 
     exit
     .
*
 
