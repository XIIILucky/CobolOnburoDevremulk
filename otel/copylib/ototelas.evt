* ototelas.evt
* ototelas.evt is generated from D:\asya\acugt.ytl\otel\ototelas.Psf
* This is a generated file. DO NOT modify this file directly.

***   start event editor code   ***
*
santral-aktar.
**************************************************
    initialize num-param list-item.
    call "C$NARG" using num-param.
    accept terminal-abilities from terminal-info.
    accept system-information from system-info
**************************************************s

    move "IMZA"   to isyeri-adres-tasi.
    set environment "cursor_mode" to "2".
    accept tarih-tasi from century-date.
    move 0 to okundu
    move "9999" to k-kodu-tasi
          
    accept line-sirket from command-line
    if  line-sirket-adres = spaces or line-sirket = "NORTEL"
       call "/asya/ytl/obj/otel/sirket.asy" using 1
         on exception 
            perform callerr-proc
            stop run
         not on exception
            cancel "/asya/ytl/obj/otel/sirket.asy"
       end-call
    else
       move 0                  to num-param
       move line-sirket-no     to isyeri-no-tasi
       move line-sirket-adres  to isyeri-adres-tasi
    end-if 


            display  standard graphical window 
               
               size 60 lines 50
                CELL HEIGHT 10, 
                 CELL WIDTH 10, COLOR IS 65793, 
                 CONTROL FONT traditional-font, LABEL-OFFSET 0, 
                 LINK TO THREAD, NO SCROLL, WITH SYSTEM MENU, 
                 TITLE-BAR, 
               title "Santral Bilgi Aktarim Konsolu + [T.S./H.K.] - F2- Cikis (v7.0.1)"
                 USER-GRAY, USER-WHITE, NO WRAP
               handle in form1-handle
               display list-box line 1 col 1 lines 48 size 70
               handle in list-handle.

islem-basla.                 | çalýþmayan paragrafmýþ mk

    if isyeri-no-tasi = zeroes or spaces 
       goback
    end-if

    move isyeri-adres-tasi    to tel-log-adres santlog-adres

    open input isyeri
    move isyeri-no-tasi       to isyeri-no
    read isyeri no lock invalid 
         close isyeri goback
         not invalid continue
    end-read
    close isyeri

    perform adresleri-tasi

    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid
          close genel,
          initialize mesaj-degiskenler
          move "Genel Parametreler Tanimsiz      "  to mmesaj-1
          move "Tanimladiktan Sonra Islem Yapiniz"  to mmesaj-2
          move " [ Hata ] " to mmesaj-title
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
*/ Log write
             initialize tel-log-rec
             move "Genel parametre tanimsiz "       to tel-log-durum
             perform log-kaydet
*/
          goback
    end-read
    close  genel

    move cost-sirketi         to pacikla-dosya-adres satkod-dosya-adres p-dosya-alan posdep-dosya-adres kart-dosya-adres
    cgenelfis-dosya-adres.
          
    initialize bekle-sure 
    compute bekle-sure = telpara-dakika * 6000.
        
      move 1 to bekle-sure
      move isyeri-adres-tasi      to santral-lock-file-adres
      if telpara-lock-kontrol = "E"
         open i-o santral-lock-file with mass-update
      end-if.
      if  genel-oto-sant-kapat = 1
        accept omitted line 1 col 1 before time bekle-sure 
      end-if
        perform with test after until (exit-pushed or key-status = 2  or genel-oto-sant-kapat = 1 )
               accept omitted line 1 col 1 before time bekle-sure 
                      on exception key-status 
                          perform form1-ex-other
               end-accept
        end-perform
      if  genel-oto-sant-kapat = 1
        accept omitted line 1 col 1 before time bekle-sure 
      end-if

                                                                                                                       

     .
     
     destroy form1-handle
     initialize key-status.

      if telpara-lock-kontrol = "E"
             close santral-lock-file
             delete file santral-lock-file
      end-if.
     goback.

islem-parametre-kontrol.
|       stop " "
    perform varying i from 1 by 1 until i > 2 
           if line-sirket-adres2 <> spaces then
                   if i = 1 then
                         move 0   to num-param
                         move line-sirket-no    to isyeri-no-tasi
                         move line-sirket-adres to isyeri-adres-tasi
                   end-if
                  if i = 2 then
                         move 0   to num-param
                         move line-sirket-no2    to isyeri-no-tasi
                         move line-sirket-adres2 to isyeri-adres-tasi
                  end-if
                  perform dosya-adres-tasi-yerlestir
                  perform yeni-basla-1  thru  santral-aktar-exit
           else
                 perform dosya-adres-tasi-yerlestir
                 perform yeni-basla-1   thru  santral-aktar-exit
           end-if

    end-perform.

yeni-basla-1.      
     if line-sirket-adres2 <> spaCES and i > 2 then
            exit paragraph
     end-if
      
     modify list-handle,
            item-to-add("Start Transfer ....").
*     display label "Start Transfer ...." line 1 col 1.
     set size-of-santral-rec to size of santral-rec.

     perform adresleri-tasi.
     open input genel
     move 1 to genel-anahtar
     read genel no lock invalid
          close genel,
          initialize mesaj-degiskenler
          move "Genel Parametreler Tanimsiz      "  to mmesaj-1
          move "Tanimladiktan Sonra Islem Yapiniz"  to mmesaj-2
          move " [ Hata ] " to mmesaj-title
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          
          if telpara-lock-kontrol = "E"
             close santral-lock-file
             delete file santral-lock-file
          end-if
*/ Log write
             initialize tel-log-rec
             move "Genel parametre tanimsiz "      to tel-log-durum
             perform log-kaydet
*/


          goback
     end-read
     close  genel
      move calisma-tarihi to calisma2-tarihi
    
     open i-o genelfis
     move 1 to genelfis-anahtar,
     read genelfis no lock invalid
          close genelfis,
          initialize mesaj-degiskenler
          move "Genelfis Parametreleri Tanimsiz  "  to mmesaj-1
          move "Tanimladiktan Sonra Islem Yapiniz"  to mmesaj-2
          move " [ Hata ] " to mmesaj-title
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          if telpara-lock-kontrol = "E"
             close santral-lock-file
             delete file santral-lock-file
          end-if
*/ Log write
             initialize tel-log-rec
             move "Genelfis tanimsiz "      to tel-log-durum
             perform log-kaydet
*/

          goback
     end-read,
     close      genelfis

     open input depkod
     move telpara-depkod   to depkod-anah
     read depkod no lock invalid
          close depkod
          initialize mesaj-degiskenler
          move " [ Hata ] " to mmesaj-title
          move " Telefon departman kodu        "  to mmesaj-1
          move " Tanimsiz  islem iptal edildi.."  to mmesaj-2
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          if telpara-lock-kontrol = "E"
             close santral-lock-file
             delete file santral-lock-file
          end-if
*/ Log write
             initialize tel-log-rec
             move "Telefon dep. kodu tanimsiz "      to tel-log-durum
             perform log-kaydet
*/

          goback
     end-read,
     close depkod,

     if depkod-ba not = "B"
          initialize mesaj-degiskenler
          move " [ Hata ] " to mmesaj-title
          move " Telefon departmaninin B-A kodu" to mmesaj-1
          move "       -B-(Borc) olmali        " to mmesaj-2
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          if telpara-lock-kontrol = "E"
             close santral-lock-file
             delete file santral-lock-file
          end-if
*/ Log write
             initialize tel-log-rec
             move " Telefon departmaninin B-A kodu B olmali"  to tel-log-durum
             perform log-kaydet
*/

        goback,
     end-if,

     if telpara-fol-tipi not = "R" and
        telpara-fol-tipi not = "E" and
        telpara-fol-tipi not = "T"
          initialize mesaj-degiskenler
          move " [ Hata ] " to mmesaj-title
          move " Telefonlarin hangi Folioya ..." to mmesaj-1
          move " Islenecegi belli degil........" to mmesaj-2
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
          if telpara-lock-kontrol = "E"
             close santral-lock-file
             delete file santral-lock-file
          end-if
*/ Log write
             initialize tel-log-rec
             move " Hangi folio tipine islenecegi belirsiz"  to tel-log-durum
             perform log-kaydet
*/
        goback
     end-if,


     initialize gecer-gecmez
     open input kur
     move calisma2-tarihi  to kur-tarih
     move onkpara-banka   to kur-banka
     move onkpara-doviz   to kur-doviz
     read kur no lock invalid
         move 1 to doviz-alis
*          move 1 to gecer-gecmez,
*          if message-box-goster
*             display message box 
*             "Kur girilmediginden transfer islemi tamamlanamadi",new-line
*             "Bilgi Islem Departmanina bilgi veriniz ..."
*             icon mb_error_icon
*             title "Hata",
*             close kur
**/ Log write
*             initialize tel-log-rec
*             move "Kur girilmediginden transfer islemi tamamlanamadi"  to tel-log-durum
*             perform log-kaydet
**/
*
*             go santral-aktar-exit
*          else
*             close kur
             open extend tel-err
             move "Kur girilmemis .."   to tel-err-rec
             move calisma2-tarihi        to tel-err-rec(15:)
             write tel-err-rec
             close tel-err 
*/ Log write
*             initialize tel-log-rec
*             move "Kur girilmediginden transfer islemi tamamlanamadi"  to tel-log-durum
*             perform log-kaydet
*/
*             go santral-aktar-exit
*          end-if
     end-read
     close kur

********************************NORTEL ADEM HAVVA *******13.04.2015**************
      if num-param <> 0 
        initialize sant-al-adres num-args-size
        move low-values to sant-al-adres
        accept num-args from command-line
        initialize nortel-deg
        if num-param = 1 
           if function upper-case(num-args) = "NORTEL"
              set nortel to true
              move 0 to num-param num-args
           end-if
        end-if
     end-if
**************************************************************************************
     if num-param = 1
        accept otel-sant-no from command-line
        if otel-sant-ayrac = "S"
           move 0 to num-param
           open input genel
           initialize genel-rec
           move otel-sant-no1  to genel-anahtar
           read genel no lock invalid
               initialize genel-rec
               move 1 to genel-anahtar
               read genel no lock invalid
                    continue 
               end-read 
           end-read 
           close genel        
        end-if 
     end-if 
     if num-param <> 0 
        initialize sant-al-adres num-args-size
        move low-values to sant-al-adres
        accept num-args from command-line
                   
         if num-param > 1 then 
            UNSTRING num-args
               delimited by  "--"  
               into par1                
                par2
                par3
                par4
               on overflow
                continue
              end-unstring
              move par1 to num-args 
              if  okundu = 0
                  move 1 to okundu
              end-if
              if par2 > 0 and par2 < 7
                  perform genel-oku              
              end-if
         end-if
         inspect num-args
                tallying num-args-size
                for trailing space
        compute num-args-size = function length(num-args) - num-args-size
        string 
             "@[DISPLAY]:" delimited by size,
             num-args(1:num-args-size) delimited by low-values
             into sant-al-adres
     else
        initialize sant-al-adres
        string 
             "@[DISPLAY]:" delimited by size,
             "C:\ASYA\ytl\data\sant\tellog" delimited by low-values
             genel-printer-filtre delimited by low-values
             into sant-al-adres
     end-if
     if genel-beko = 1 
        call "/asya/ytl/obj/otel/callbekotv.asy" using "mamastrofi"
                    on exception perform callerr-proc
                       not on exception
              cancel "/asya/ytl/obj/otel/callbekotv.asy" 
              end-call

     end-if
      if  TELPARA-dishat-ac-kapa = 1 then 
            perform sil-islem
            perform sil-islem-uyandirma
             
      end-if    
    
    initialize bekle-sure 
    compute bekle-sure = telpara-dakika * 6000
    if TEL-PARA-KONTROLLU = 1 then                
                CALL "C$COPY" using sant-al-adres, mdb-dosya-adres giving sonuccopy 
                if sonuccopy = 1 then 
                       if message-box-goster
                          display message box 
                                  "Dosya kopyalanamadi",new-line,
                                  "From : ",sant-al-adres,new-line,
                                  "To : ", sant-git-adres
                
                           go santral-aktar-exit
                       else
                           open extend tel-err
                           move "dosya kopyalanamadi"   to tel-err-rec
                           move sant-al-adres        to tel-err-rec(20:)
                           move sant-git-adres        to tel-err-rec(60:)
                           write tel-err-rec
                          close tel-err
                           go santral-aktar-exit
                       end-if
                 end-if
                 CALL "C$COPY" using sant-git-adres-1, sant-al-adres giving sonuccopy
                    if sonuccopy = 1 Then  
                       if message-box-goster
                               display message box 
                                  "Bos Dosya kopyalanamadi", new-line,
                                  "From : ", sant-git-adres-1,new-line
                                  "To : ",sant-al-adres,new-line
                                 
                                go santral-aktar-exit
                       else
                                open extend tel-err
                                move "Bos dosya kopyalanamadi"   to tel-err-rec
                                move calisma2-tarihi        to tel-err-rec(15:)
                                write tel-err-rec
                                close tel-err
                                go santral-aktar-exit
                
                       end-if
                     end-if 
               
              open output santral
              open input mdb
              open i-o telkont
              perform until fs-mdb = "10" 
                   initialize mdb-rec
                   read mdb next no lock 
                     end move "10" to fs-mdb
                     not end 
                     initialize telkont-rec
                      move mdb-rec(1:20) to telkont-anah
                      read telkont no lock invalid
                        move mdb-rec to santral-rec
                        write santral-rec end-write
                        write telkont-rec end-write
                     end-read
                    end-read
              end-perform 
              close mdb santral  telkont
 
     else     
            move santral-dosya        to sant-git-adres
            CALL "C$COPY" using sant-al-adres, sant-git-adres giving sonuccopy                                
            if sonuccopy = 1 then 
                    if message-box-goster
                          display message box 
                                "Dosya kopyalanamadi",new-line,
                                "From : ",sant-al-adres,new-line,
                                "To : ", sant-git-adres
                
                          go santral-aktar-exit
                     else
                           open extend tel-err
                           move "dosya kopyalanamadi"   to tel-err-rec
                           move sant-al-adres        to tel-err-rec(20:)
                           move sant-git-adres        to tel-err-rec(60:)
                           write tel-err-rec
                           close tel-err
                           go santral-aktar-exit
                      end-if
            end-if
      
            if line-sirket-adres2 <> spaces
                    if i = 2  then
                            CALL "C$COPY" using sant-git-adres-1, sant-al-adres giving sonuccopy
                    end-if
            else
                   CALL "C$COPY" using sant-git-adres-1, sant-al-adres giving sonuccopy
            end-if
        
            if sonuccopy = 1 Then  
               if message-box-goster
                  display message box 
                          "Bos Dosya kopyalanamadi", new-line,
                          "From : ", sant-git-adres-1,new-line
                          "To : ",sant-al-adres,new-line
                         
                  go santral-aktar-exit
               else
                        open extend tel-err
                        move "Bos dosya kopyalanamadi"   to tel-err-rec
                        move calisma2-tarihi        to tel-err-rec(15:)
                        write tel-err-rec
                        close tel-err
                        go santral-aktar-exit
        
               end-if
            end-if
             
    end-if
     initialize islem-kuru
     if onkpara-d-e = "D" and
        onkpara-a-s = "A"
        move doviz-alis    to islem-kuru
     end-if,
     if onkpara-d-e = "D" and
        onkpara-a-s = "S"
        move doviz-satis   to islem-kuru
     end-if,
     if onkpara-d-e = "E" and
        onkpara-a-s = "A"
        move efektif-alis  to islem-kuru
     end-if,
     if onkpara-d-e = "E" and
        onkpara-a-s = "S"
        move efektif-satis to islem-kuru
     end-if,

     if islem-kuru = zeroes or
        gecmez
        open input kur
        initialize gecer-gecmez,
        move all high-value  to kur-tarih
        move onkpara-banka   to kur-banka
        move onkpara-doviz   to kur-doviz
        start kur key > kur-kodu invalid continue 
              move 1 to gecer-gecmez
              not invalid
        perform with test after until sonuc or gecmez
        read kur backward no lock end move 1 to gecer-gecmez
             not end
              if onkpara-banka = kur-banka and
                 onkpara-doviz = kur-doviz  
                 initialize islem-kuru
                 if onkpara-d-e = "D" and
                    onkpara-a-s = "A" and
                    doviz-alis not = zeroes,
                    move doviz-alis    to islem-kuru
                    move 2 to gecer-gecmez,
                 end-if,
                 if onkpara-d-e = "D" and
                    onkpara-a-s = "S" and
                    doviz-satis not = zeroes
                    move doviz-satis   to islem-kuru
                    move 2 to gecer-gecmez,
                 end-if,
                 if onkpara-d-e = "E" and
                    onkpara-a-s = "A" and
                    efektif-alis not = zeroes
                    move efektif-alis  to islem-kuru
                    move 2 to gecer-gecmez,
                 end-if,
                 if onkpara-d-e = "E" and
                    onkpara-a-s = "S" and
                    efektif-satis not = zeroes,
                    move efektif-satis to islem-kuru
                    move 2 to gecer-gecmez,
                 end-if,
              end-if,
        end-read
        end-perform,
        end-start,
        close kur,

        if gecmez or
           islem-kuru = zeroes,
           if message-box-goster 
              display message box 
               "Transferde problem oldu tekrar deneyiniz",new-line,
               "Hata kodu : ", gecer-gecmez,
                call "c$sleep" using 60
                go santral-aktar-exit
           else
                open extend tel-err
                move "Kur girilmemis .."   to tel-err-rec
                move calisma2-tarihi        to tel-err-rec(15:)
                write tel-err-rec
                close tel-err
                go santral-aktar-exit
           end-if
        end-if,
     end-if

     initialize gecer-gecmez,
     open input santral telkod kodlar02 grup
     open i-o teldata konuk romhrk exthrk onkasa odalar takip
     open extend tel-err 

*->  
*      display   message box "osman parametreye bak"
      open extend santlog
     perform with test after until fs-santral = "10"
     initialize santral-rec degiskenler,gecer-gecmez,

     read santral next no lock end 

           move "10" to fs-santral
       not end
          if santral-rec(1:8) = "09/09/09" then 
                exit perform cycle
          end-if


***************NORTEL SANTRAL**********************************
           if nortel
***********CIFT SATIRI TEK SATIRA INDIRIYOR 
*ORJINALI
*N 092 00 8009    T010030 12/31 16:49 00:00:06 A 6984440333
* &                       00001 000350                      
*L 093 00 ATTN02  8204                            12/31 16:52 00:00:24 
*N 094 00 8021    T013023 12/31 16:51 00:00:46 A 7605365001118
* &                       00000 000000                      
*L 095 00 ATTN02  4221                            12/31 16:52 00:00:12 
*N 096 00 8089    T013022 12/31 16:52 00:00:48 A 7605413433364
* &                       00000 000000                      

*CEVRILMIS HALI
*N 092 00 8009    T010030 12/31 16:49 00:00:06 A 6984440333 &                       00001 000350                                                       
*N 094 00 8021    T013023 12/31 16:51 00:00:46 A 7605365001118 &                       00000 000000                                                    
*N 096 00 8089    T013022 12/31 16:52 00:00:48 A 7605413433364 &                       00000 000000                                                    
*N 101 00 4238    T013021 12/31 16:59 00:01:02 A 7605339541853 &                       00000 000000                                                    
*N 104 00 8008    T013020 12/31 17:05 00:00:54 A 7605425856070 &                       00008 000800   


             if santral-rec = spaces
                exit perform cycle
             end-if

             if santral-rec(1:1) <> spaces
                initialize nortel-buffer nortel-ilk-satir nortel-ikinci-satir
                move "E"                    to nortel-ilk-satir
                move santral-rec            to nortel-buffer
                exit perform cycle
             else
                if nortel-ilk-satir = "E" and santral-rec(2:1) = "&"
                   move santral-rec            to nortel-buffer(70:)
                   move nortel-buffer          to santral-rec
                   move space                  to nortel-ilk-satir
                else
                   exit perform cycle
                end-if
             end-if

          end-if

***************NORTEL SANTRAL***************************************
           if TELPARA-dishat-ac-kapa = 1
              perform uyandirma-geri-donus-isle
           end-if 
           initialize degiskenler,gecer-gecmez,
*           display message box "Osmana assagidaki satiri yukluyor" new-line
*           santral-rec
           add 1 to list-item
            if list-item > 100 
               modify list-handle,
                      reset-list = 1
               initialize list-item
            end-if
           modify list-handle,
                  item-to-add(santral-rec)
*           display label santral-rec
                  
             initialize
              santlog-data          
              santlog-tarih           
              santlog-zaman           
              santlog-teldata          
              santlog-folio           
              santlog-err          
           move santral-rec to santlog-data 

          if telpara-oda-okey-eh = "E"
*/ eger house keeping kaydi ise 1 olarak doner ve 
*/ exit paragraph yapar
             initialize gec-gecme
             perform oda-okey
             if gec-gecme = 1
                write santlog-rec end-write
                exit perform cycle
             end-if
           end-if

           if genel-minibar-devrede = "E"
              initialize gec-gecme
              perform minibar
              if gec-gecme = 1
                 write santlog-rec end-write
                 exit perform cycle
              end-if
           end-if



            initialize
              santlog-data          
              santlog-tarih           
              santlog-zaman           
              santlog-teldata          
              santlog-folio           
              santlog-err     
           move santral-rec to santlog-data 
* Oda okey dediler canimizi yediler  LARA BEACH
*          if santral-rec(1:2) = "#O" and 
*             telpara-oda-okey-eh = "E"
*             perform oda-okey
*             exit perform cycle
*          end-if
* Oda okey dediler canimizi yediler 

           move santral-rec(telpara-oda-bas:telpara-oda-hane) to santral-oda
           move function numval (santral-rec(telpara-kon-bas:telpara-kon-hane)) to santral-kontur
           move santral-rec(telpara-tel-bas:telpara-tel-hane) to santral-telno
*-> zero g
*           move santral-kontur to kontur-z initialize santral-kontur
*           move kontur-z       to santral-kontur
*->

           move santral-oda   to tel-oda
           initialize santlog-data
           move santral-rec to santlog-data 
           accept santlog-tarih from century-date
           accept santlog-zaman from time



           read telkod no lock invalid
                  
                move 1 to gecer-gecmez
                initialize  tel-indirim,
                move santral-rec to tel-err-rec
                move "Telefon kodu tanimsiz" to tel-err-rec(100:)  santlog-err
                write tel-err-rec end-write,
           not invalid
               if tel-no-post = 1
                  write santlog-rec end-write
                  exit perform cycle
               end-if
           end-read,

           compute tl-tutar   = santral-kontur * telpara-c-satis
           compute tl-maliyet = santral-kontur * telpara-c-maliyet



           if tel-indirim > 0
              compute tl-tutar = tl-tutar - ((tl-tutar*tel-indirim)/100)
           end-if
           compute dv-tutar   = tl-tutar/islem-kuru

           if gecer and
            (( santral-kontur not = zeroes and tl-tutar > zeroes ) OR TELPARA-KONTURSUZ-CIK = 1)
                 open i-o genelfis,
                 move 1 to genelfis-anahtar,
                 read genelfis no lock invalid
                      initialize genelfis-rec
                      move 1 to genelfis-anahtar tel-fis-oto
                      not invalid
                         add 1 to tel-fis-oto
                 end-read
                 rewrite genelfis-rec invalid
                 write genelfis-rec end-write
                 end-rewrite
                 close genelfis,
*->
                 initialize gecer-gecmez,
                 move calis2-yil      to teldata-yil
                 move calis2-ay       to teldata-ay
                 move calis2-gun      to teldata-gun
                 move santral-oda    to teldata-odano,
                 move tel-fis-oto    to teldata-islemno  santlog-teldata
                 move tel-tipi       to teldata-tipi
                 move santral-telno  to teldata-numara,
                 move santral-kontur to teldata-kontur
                 move tl-tutar       to teldata-satis
                 move tl-maliyet     to teldata-maliyet
                 move folio-no       to teldata-folio
                 if telpara-ger-saat-bas > zeroes 
                    and telpara-ger-saat-bas < 999
                    and telpara-ger-saat-bas numeric
                    and telpara-ger-saat-hane > zeroes 
                    and telpara-ger-saat-hane < 99
                    and telpara-ger-saat-hane numeric
                    and (telpara-ger-saat-bas + telpara-ger-saat-hane < size-of-santral-rec) 
                    move santral-rec(telpara-ger-saat-bas:telpara-ger-saat-hane)
                         to teldata-sant-zaman
                 else 
                    accept teldata-sant-zaman from time
                 end-if
                 if telpara-sure-bas > zeroes 
                    and  telpara-sure-bas numeric 
                    and telpara-sure-hane > 02 
                    and telpara-sure-hane numeric
                    and (telpara-sure-bas + telpara-sure-hane < size-of-santral-rec) 
                    move santral-rec(telpara-sure-bas:telpara-sure-hane)
                         to teldata-sure

                   end-if
                 write teldata-rec 
                 invalid
                       move santral-rec to tel-err-rec
                       move "Gorusme Datasina Yazilamadi" to tel-err-rec(100:)  santlog-err
                       write tel-err-rec end-write,
                       not invalid 
                       move "Teldata islendi " to  santlog-err
                 
                 end-write
*->
            if musteri
               initialize konuk-rec,gecer-gecmez
               move "I"           to konuk-durumu,
               move tel-onb-oda   to konuk-odano
               start konuk key = konuk-oda invalid
                     move santral-rec to tel-err-rec
                     move "Iceride Oda Bulunamadi"  to tel-err-rec(100:)   santlog-err
                     write tel-err-rec,
                     move 5 to gecer-gecmez,
                   not invalid
               perform with test after until (konuk-odano not = tel-onb-oda)
                         or evet
               read konuk next no lock end move all high-value to konuk-odano
                    not end
                           move 6 to gecer-gecmez
                     if konuk-durumu  = "I" and
                        konuk-odano = tel-onb-oda

                        if telpara-fol-tipi = konuk-fol-kodu OR
                           telpara-fol-tipi = "R"
                           
                           move konuk-folio to folio-no ,
                           move 3   to gecer-gecmez
                        end-if
                     end-if
              end-read,
              end-perform,
              end-start,

              if evet
                 move "B"               to kodlar02-tipi
                 move konuk-odeme-tipi  to kodlar02-kodu
                 read kodlar02 no lock invalid
                      move santral-rec to tel-err-rec
                      move "Odeme Kodu Tanimsiz"  to tel-err-rec(100:)  santlog-err
                      write tel-err-rec end-write
                      move "H"   to ode-posting
                      move 7     to gecer-gecmez
                 end-read,
              end-if,
*->
              if evet and
                 ode-posting not = "H"
              if konuk-nor-indirim not = 0
                 compute tl-tutar   =
                         tl-tutar - (tl-tutar * konuk-nor-indirim) / 100
                 compute dv-tutar   = tl-tutar/islem-kuru
              end-if

*-> musteri ise folio'su teldata ya yaziliyor.
                 move tl-tutar       to teldata-satis
                 move tl-maliyet     to teldata-maliyet
                 move folio-no       to teldata-folio
                 rewrite teldata-rec end-rewrite
*->
                 move folio-no      to konuk-folio
                 read konuk no lock invalid
                  not invalid
                      compute konuk-top-borc = konuk-top-borc + tl-tutar
                      rewrite konuk-rec end-rewrite
                 end-read,
*->              
                 initialize onkasa-rec
                 move calis2-yil      to onk-yil
                 move calis2-ay       to onk-ay
                 move calis2-gun      to onk-gun
                 move telpara-depkod to onkasa-dep
                 read onkasa no lock invalid
                      initialize onkasa-tutar-tl onkasa-tutar-dv
                                 onkasa-corr-tutar-tl onkasa-corr-tutar-dv
                                 onkasa-matrah-disi
                 end-read
                 compute onkasa-tutar-tl = onkasa-tutar-tl + tl-tutar
                 compute onkasa-tutar-dv = onkasa-tutar-dv + dv-tutar

                 rewrite onkasa-rec invalid
                 write onkasa-rec end-write
                 end-rewrite,
*->
                 open i-o genelfis
                 move 1 to genelfis-anahtar,
                 read genelfis no lock invalid
                      move 1 to cekgir-oto
                    not invalid
                      add 1 to cekgir-oto
                 end-read
                 rewrite genelfis-rec invalid
                 write genelfis-rec end-write
                 end-rewrite,
                 close genelfis
                 initialize exthrk-rec hrkgir-rec

                 move folio-no          to exthrk-folio,
                 move cekgir-oto        to exthrk-islem,    santlog-folio
                 move "S"               to exthrk-islem-tipi
                 move teldata-islemno   to exthrk-cekno
                 move calis2-yil         to exthrk-yil
                 move calis2-ay          to exthrk-ay
                 move calis2-gun         to exthrk-gun,
                 move telpara-depkod    to exthrk-depkod
                 move "B"               to exthrk-ba
                 move tl-tutar          to exthrk-tl-tutar
                 move dv-tutar          to exthrk-dv-tutar
                 accept exthrk-zaman from time,
                 move spaces            to exthrk-kart-no exthrk-pos-kodu
                 move k-kodu-tasi       to exthrk-staf,



                 open i-o nt
               initialize not-rec
               if konuk-fol-kodu = "R"
                  move  "RHR"     to NOT-DOS
                  move exthrk-anah to  NOT-DOS-ANAH 

               else
                  move  "EHR"      to NOT-DOS
                  move exthrk-anah to  NOT-DOS-ANAH 

               end-if
               move teldata-kontur to zzzz
               string teldata-numara delimited by "   "
                  " no ile " delimited by size
                  teldata-sure delimited by "   "
                  " sure "  delimited by size
*                  zzzz delimited by size
*                  " kontur " delimited by size
                  into   not1
               end-string
              write not-rec invalid
                display message box "Cakisma Hatasi 232352"
              end-write
          
                close nt

***************************firat ekleme room service numarasýndan uzak dur
              open input telkim
              initialize telkim-rec 
              move teldata-numara to TELKIM-TELNO
              read telkim no lock invalid
                   continue
              not invalid
                  if TELKIM-TIPI = "R"
                     initialize exthrk-tl-tutar exthrk-dv-tutar
                  end-if        
              end-read
              close telkim

********************kopyalanacak
               if  exthrk-tl-tutar > 0 
              open input route konu2 rez
              open i-o yromhrk

               move exthrk-rec  to hrkgir-rec
               move hrkgir-rec  to yromhrk-rec
               move hrk2-data to yromhrk-data
              
               write yromhrk-rec invalid stop " " end-write 
              
               close yromhrk
    
               perform folref-bul
               perform folref-ata
               close route konu2 rez
              open i-o hrk2
               move hrkgir-anah to hrk2-anah
               move yromhrk-folio to hrk2-kaynak-folio
               write hrk2-rec end-write
               close hrk2
               move hrkgir-rec       to romhrk-rec exthrk-rec                
**************** kopyalanacak
                  open input konu2 
                  move hrkgir-folio   to konu2-folio
                  read konu2 no lock invalid 
                       continue 
                  end-read 
                  close konu2 
                                                              
                 if konu2-fol-kodu = "R"
                    move exthrk-rec to romhrk-rec,
                    write romhrk-rec invalid
                       move santral-rec to tel-err-rec
                       move "**Romhrk'ye Islenemedi...." to tel-err-rec(100:)  santlog-err(30:)
                       write tel-err-rec end-write
                       not invalid 
                       move "Room Folio islendi " to santlog-err(30:)
                    end-write
                    perform log-operation-romhrk
                  else
                    write exthrk-rec invalid
                       move santral-rec to tel-err-rec
                       move "**Exthrk'ye Islenemedi...." to tel-err-rec(100:) santlog-err(30:)
                       move fs-exthrk                  to tel-err-rec(125:)
                       move exthrk-islem               to tel-err-rec(130:)
                       write tel-err-rec end-write 
                       not invalid 
                        move "Extra Folio islendi " to santlog-err(30:)
                    end-write,
                    perform log-operation-exthrk
                 end-if,
                  
                 if telpara-fis = "E"
                    perform sant-fis-ver
                 end-if
                  end-if
             else
                 if odeme-tanimsiz
                    move santral-rec to tel-err-rec
                    move "Odeme Tipi Tanimsiz" to tel-err-rec(100:)   santlog-err
                    write tel-err-rec
                 end-if
                 if odasiz
                    move santral-rec to tel-err-rec
                    move "Iceride         Nolu Oda Yok" to tel-err-rec(100:)  santlog-err
                    move tel-onb-oda                    to tel-err-rec(110:04)    santlog-err(10:4)
                    write tel-err-rec
                 end-if
                 if foliosuz
                    move santral-rec to tel-err-rec
                    move "      Nolu Odada Gerekli Folio Yok"
                              to tel-err-rec(100:)   santlog-err
                    move tel-onb-oda                    to tel-err-rec(100:04)   santlog-err(1:4)
                    write tel-err-rec
                 end-if
              end-if
            end-if
           else
              if musteri and gecmez and
                 santral-kontur not = zeroes
                 move santral-rec to tel-err-rec
                 move "Santral Oda Parametresi Tanimsiz" to tel-err-rec(100:)
                 move tel-onb-oda                        to tel-err-rec(135:04)
                 write tel-err-rec,
              end-if
           end-if
           write santlog-rec  end-write
     end-read,
     
     
     end-perform,
     close santlog
     close santral telkod kodlar02 odalar grup
     close teldata konuk romhrk exthrk onkasa takip
     close tel-err 
*     go yeni-basla.
*     goback
     .
santral-aktar-exit.
    exit.
  sant-fis-ver.
     open output liste
     move all "=" to liste-rec(1:30)
     write liste-rec

     move calis2-gun              to liste-det1-2
     move calis2-ay               to liste-det1-3
     move calis2-yil              to liste-det1-4,
     initialize liste-rec write liste-rec from liste-det1,

     move tel-oda                to liste-det2-2
     move tel-onb-oda            to liste-det2-4
     initialize liste-rec write liste-rec from liste-det2,

     move cekgir-oto             to liste-det3-2,
     initialize liste-rec write liste-rec from liste-det3,
     initialize liste-rec write liste-rec from liste-det4,

     move all "=" to liste-rec(1:30) write liste-rec,
     move santral-telno          to liste-det5-1
     move santral-kontur         to liste-det5-2
     move tl-tutar               to liste-det5-3
     initialize liste-rec write liste-rec from liste-det5,
     move all "=" to liste-rec(1:30) write liste-rec,

     move exthrk-saat            to liste-det6-21,
     move exthrk-dakika          to liste-det6-22,
     move exthrk-saniye          to liste-det6-23,
     initialize liste-rec write liste-rec from liste-det6,
     initialize liste-rec write liste-rec from liste-det7
     move all "=" to liste-rec(1:30) write liste-rec.
    close liste.


kur-uyari.
     initialize mesaj-degiskenler
     move " [ Hata ] " to mmesaj-title
     move calis2-gun       to mmesaj-1(1:2)
     move "/"             to mmesaj-1(3:1)
     move calis2-ay        to mmesaj-1(4:2)
     move "/"             to mmesaj-1(6:1)
     move calis2-yil       to mmesaj-1(7:4)
     move "Tarihli Gunluk Kur Kaydi bulunamadi" to mmesaj-2
     move 1           to mmesaj-type
     move 1           to mmesaj-icon
     move 1           to mmesaj-default
     perform mmesaj-ver.
*
mmesaj-ver.
       display window pop-up sakla
       display window 
               boxed shadow erase no scroll no wrap
               line 6 col 15 lines 6 size 50
               color 64 reverse
       display mmesaj-1 line 1 col 1 size 50 output centered
       display mmesaj-2 line 2 col 1 size 50 output centered
       display mmesaj-3 line 3 col 1 size 50 output centered
       display "Tamam" line 5 col 23 reverse
       accept omitted line 5 col 25 on exception 
              accept key-status from escape
      end-accept
       initialize key-status
       close window sakla
     .
* Form1
Acu-Form1-Evaluate-Func.
     EVALUATE TRUE
        WHEN Exit-Pushed
           PERFORM Acu-Form1-Exit
        WHEN Event-Occurred
           IF Event-Type = Cmd-Close
              PERFORM Acu-Form1-Exit
           END-IF
     END-EVALUATE
* avoid changing focus
     MOVE 1 TO Accept-Control
     .

Acu-Form1-Display-Status-Msg.
     MODIFY Form1-St-1-Handle
        PANEL-WIDTHS (20, 80), 
        PANEL-STYLE (1, 1), 
        PANEL-TEXT ("F2->Durdur...", SPACE), 
        GRIP, FONT IS Traditional-Font, 
     .

Acu-Form1-Clear-Status-Msg.
     PERFORM Acu-Form1-Display-Status-Msg
     .

Acu-Form1-Exit.
     set exit-pushed to true
     .
Form1-Ex-Other.
*/ Log write
        open i-o onbkodlar10
       initialize onbkodlar10-rec 
            move  "EE" to  onbkodlar10-tipi
          
       read onbkodlar10 no lock invalid
          continue
          
       end-read
     
               accept onbkodlar10-santral-tarih from century-date
               accept  onbkodlar10-santral-zaman from time
               write onbkodlar10-rec invalid rewrite onbkodlar10-rec end-write
        close onbkodlar10



     initialize tel-log-rec
     move "Loopback...."      to tel-log-durum
     perform log-kaydet.
*/   
     if key-status = 3 then
*     open i-o telkont
*     initialize telkont-rec
*       move "00040516" to telkont-anah
*       start telkont key >= telkont-anah invalid continue
*         not invalid
*           perform until fs-telkont = "10"
*             read telkont next no lock 
*               end move "10" to fs-telkont
*               not end 
*                 delete telkont invalid stop " " end-delete
*             end-read
*          end-perform
*        end-start
*     close telkont 
*     initialize key-status
         continue
     end-if   
     if key-status = 99 or 13 
        open i-o wakeup
        perform islem-parametre-kontrol thru  santral-aktar-exit
        initialize key-status
        close wakeup
     end-if.
     .
Form1-Event-Proc.
     .
Form1-Exception-Proc.
     perform form1-ex-other.
*
oda-okey.
     if santral-rec(genel-house-teknik-kayit-belirle-bp:
                    genel-house-teknik-kayit-belirle-au) = 
        genel-house-teknik-kayit-sabit-kosul(1:genel-house-teknik-kayit-belirle-au)
        continue
     else
        exit paragraph | HOUSE KEEPING KAYDI DEGIL
     end-if

*/ house keeping kaydi oldugu icin gec-gecme = 1 yapaz-
     move 1 to gec-gecme

     initialize odalar-rec grup-rec
     move santral-rec(genel-house-teknik-oda-no-bp:
                      genel-house-teknik-oda-no-au) to telkod-anah

     read telkod no lock invalid
        move santral-rec to tel-err-rec
        move "<H/K-TS> Tel.no tanim.yok. Oda :" to tel-err-rec(100:) santlog-err
        move telkod-anah                        to tel-err-rec(135:04) santlog-err(35:04)
        write tel-err-rec
        exit paragraph
     end-read
    


     move tel-onb-oda  to odalar-anah
     read odalar no lock invalid
        move santral-rec to tel-err-rec
        move "<H/K-TS> Tel.no oda tanim.yok. Oda :" to tel-err-rec(100:)   santlog-err
        move telkod-anah                                  to tel-err-rec(138:04)  santlog-err(38:04)
        write tel-err-rec
        exit paragraph
     end-read

     initialize grup-rec
     set grup-hk-ts     to true
     move santral-rec(genel-house-teknik-oda-durum-kodu-bp:
                      genel-house-teknik-oda-durum-kodu-au) to grup-alt
     read grup no lock invalid
        move santral-rec to tel-err-rec
        move "<H/K-TS> Oda durum kodu tanimsiz :" to tel-err-rec(100:)   santlog-err
        move grup-kodu                            to tel-err-rec(135:04)    santlog-err(35:04)
        write tel-err-rec
        exit paragraph
     end-read

     evaluate grup-turu
     when "H" | HOUSE KEEPING ODA OKEYLEMIS
        evaluate grup-oda-durumu
             when "B"
                  move house-bt  to odalar-durumu house-durumu
                  perform maid-girmidimi-kontrol
                  move odalar-anah to  santlog-err
                  move "Bos temize alindi "  to santlog-err(10:)
             when "D"
                  move house-dt  to odalar-durumu house-durumu
                  perform maid-girmidimi-kontrol
                  move odalar-anah to  santlog-err
                  move "Dolu temize alindi "  to santlog-err(10:)
             when "O"
                  move house-ao  to odalar-durumu house-durumu
                  perform maid-girmidimi-kontrol
                  move odalar-anah to  santlog-err
                  move "Out of Order alindi " to  santlog-err(10:)
             when "K"
                  move house-bk  to odalar-durumu house-durumu
                  perform maid-girmidimi-kontrol
                  move odalar-anah to  santlog-err
                  move "bos kirliye alindi "  to santlog-err(10:)
             when "T"
                  perform maid-odaya-girdi
                   move odalar-anah to  santlog-err
                   move "Maid Odada   " to  santlog-err(10:)
                  exit paragraph
             when other
                   move santral-rec to tel-err-rec
                   move "<H/K-TS> H.K. Durum tipi yanl-s  :" to tel-err-rec(100:)   santlog-err
                   move grup-kodu                            to tel-err-rec(135:04)  santlog-err(35:04)
                   write tel-err-rec
                   exit paragraph
        end-evaluate
*        move "H"  to odalar-bos(function length(odalar-bos):)
        rewrite odalar-rec invalid
                continue
        end-rewrite
        perform log-operation-odalar



        initialize takip-rec
        open i-o genelfis
        move 1 to genelfis-anahtar
        read genelfis no lock invalid
             accept HK-TK-SERVIS-NO from time
             compute hk-tk-servis-no = hk-tk-servis-no * 222
        end-read
        add 1 to hk-tk-servis-no
        rewrite genelfis-rec invalid
                continue
        end-rewrite
        close genelfis
        move hk-tk-servis-no             to takip-fis-no
        move 0                           to takip-fis-sira
        set takip-tip-oda-okey           to true
        move tel-onb-oda                 to takip-oda-dep-no
        set takip-acik                   to true
        move calis2-gun                   to takip-ilk-gun
        move calis2-ay                    to takip-ilk-ay
        move calis2-yil                   to takip-ilk-yil
        accept takip-ilk-zaman from time
        move k-kodu-tasi                 to takip-ilk-staf
        move santral-rec(genel-house-teknik-oda-durum-kodu-bp:
                         genel-house-teknik-oda-durum-kodu-au) to 
                         takip-durum-kodu

        move "S"                         to takip-kayit-kaynak
        move "O"                         to takip-odami-depmi
*/ santralden geldigi icin ODA kabul edildi
*/ ileride departmanlar bildirirse duzeltme yapacak
*/ or: lobby bardan kendi arizalarini bildirirlerse falan
        initialize grup-rec
        move santral-rec(genel-house-teknik-maid-kodu-bp:
             genel-house-teknik-maid-kodu-au) to grup-alt
        set grup-hk-ts   to true
        read grup no lock invalid
            move "TANIMSIZ PERSONEL"   to grup-adi
        end-read
        move grup-adi                   to takip-bildiren
        write takip-rec invalid
               move takip-rec           to tel-err-rec
               move "Takip dosyasina Teknik ariza yazilamadi" to tel-err-rec(100:)    santlog-err
               write tel-err-rec
               exit paragraph
        end-write



        exit paragraph
     when "A" | TEKNIK SERVIS ARIZA BILDIRIM FORMU
        initialize takip-rec
        open i-o genelfis
        move 1 to genelfis-anahtar
        read genelfis no lock invalid
             accept HK-TK-SERVIS-NO from time
             compute hk-tk-servis-no = hk-tk-servis-no * 222
        end-read
        add 1 to hk-tk-servis-no
        rewrite genelfis-rec invalid
                continue
        end-rewrite
        close genelfis
        move hk-tk-servis-no             to takip-fis-no
        move 0                           to takip-fis-sira
        set takip-tip-teknik to true
        move tel-onb-oda                 to takip-oda-dep-no    santlog-err
        set takip-acik                   to true
        move calis2-gun                   to takip-ilk-gun
        move calis2-ay                    to takip-ilk-ay
        move calis2-yil                   to takip-ilk-yil
        accept takip-ilk-zaman from time
        move k-kodu-tasi                 to takip-ilk-staf
        move santral-rec(genel-house-teknik-oda-durum-kodu-bp:
                         genel-house-teknik-oda-durum-kodu-au) to takip-durum-kodu santlog-err(7:)
                         move " Teknik ariza girildi   "   to santlog-err(25:)

        move "S"                         to takip-kayit-kaynak
        move "O"                         to takip-odami-depmi
*/ santralden geldigi icin ODA kabul edildi
*/ ileride departmanlar bildirirse duzeltme yapacak
*/ or: lobby bardan kendi arizalarini bildirirlerse falan
        initialize grup-rec
        move santral-rec(genel-house-teknik-maid-kodu-bp:
             genel-house-teknik-maid-kodu-au) to grup-alt
        set grup-hk-ts   to true
        read grup no lock invalid
            move "TANIMSIZ PERSONEL"   to grup-adi
        end-read
        move grup-adi                   to takip-bildiren
        write takip-rec invalid
               move takip-rec           to tel-err-rec
               move "Takip dosyasina Teknik ariza yazilamadi" to tel-err-rec(100:) santlog-err
               write tel-err-rec
               exit paragraph
        end-write

        move house-ao  to odalar-durumu house-durumu
*        move "H" to odalar-bos(function length(odalar-bos):)
        initialize grup-rec
        set GRUP-HK-TS         to true
        move takip-durum-kodu  to grup-alt
        read grup no lock invalid
             move "Tanimsiz ..."  to grup-adi
        end-read
        move grup-adi             to takip-durum1-aciklamalar1
        rewrite odalar-rec invalid
                continue
        end-rewrite
        perform log-operation-odalar
        exit paragraph
     end-evaluate.
*
oda-okey-LARA.
     initialize odalar-rec telkod-rec
     move santral-rec(7:4) to telkod-anah
     read telkod no lock invalid
          move 1 to gecer-gecmez
          exit paragraph
     end-read.
     move tel-onb-oda   to odalar-anah
     read odalar no lock invalid
          move 1 to gecer-gecmez
          exit paragraph
     end-read
*Karel santraller i_in 7
*00 oda okey VC
*04 dolu temiz OC
*08 oda arizali ZART ZURT
     evaluate santral-rec(4:2)
     when "00"
           move house-bt  to odalar-durumu house-durumu
     when "04"
           move house-dt  to odalar-durumu house-durumu
     when "08"
           move house-ao  to odalar-durumu house-durumu
     end-evaluate
     rewrite odalar-rec invalid
             continue
     end-rewrite.
     perform log-operation-odalar.
*K 30/08/05 15:51:41 15:54:14 02:33 1309 1309 702  0002        80 3311111        
*K 30/08/05 15:52:25 15:54:20 01:55 9    9    704  0001        40 3103000        
*ARIZALI DI¦ HAT 702      30/08/05 15:54:36
*#O 00 1234     30/08/05 15:54:47
*#O 04 1234     30/08/05 15:55:43
*#O 08 1234     30/08/05 15:55:51
*1234567890123456789012345678901234
*   00 -> house-bt
*   04 -> house-dt
*   08 -> house-ariza
     
*
log-kaydet.     
     if not debugla
        exit paragraph.
     open extend tel-log.
     accept tel-log-tarih from century-date
     accept tel-log-zaman from time
     write tel-log-rec
     close tel-log.
     call "w$flush" using 256.
     call "w$flush" using 257.
*
genel-oku.

     open input genel
     initialize genel-rec
      move par2 to genel-anahtar
      add 1 to genel-anahtar
     read genel no lock invalid
          close genel,
          initialize mesaj-degiskenler
          move par2  to mmesaj-1
          move " ref Genel Parametreler Tanimsiz "  to mmesaj-1(3:)
          move "Tanimladiktan Sonra Islem Yapiniz"  to mmesaj-2
          move " [ Hata ] " to mmesaj-title
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
*/ Log write
             initialize tel-log-rec
             move "Genel parametre tanimsiz "      to tel-log-durum
             perform log-kaydet
*/

          goback
        end-read
       close  genel  .
      move par2 to SANTRAL-DOSYA-ADI(8:1)
    . 
*/ 
 maid-odaya-girdi.
        initialize takip-rec
        open i-o genelfis
        move 1 to genelfis-anahtar
        read genelfis no lock invalid
             accept HK-TK-SERVIS-NO from time
             compute hk-tk-servis-no = hk-tk-servis-no * 222
        end-read
        add 1 to hk-tk-servis-no
        rewrite genelfis-rec invalid
                continue
        end-rewrite
        close genelfis
        move hk-tk-servis-no             to takip-fis-no
        move 0                           to takip-fis-sira
        set takip-tip-odaya-giris        to true
        move tel-onb-oda                 to takip-oda-dep-no
        set takip-acik                   to true
        move calis2-gun                  to takip-ilk-gun
        move calis2-ay                   to takip-ilk-ay
        move calis2-yil                  to takip-ilk-yil
        accept takip-ilk-zaman from time
        move k-kodu-tasi                 to takip-ilk-staf
        move santral-rec(genel-house-teknik-oda-durum-kodu-bp:
                         genel-house-teknik-oda-durum-kodu-au) to 
                         takip-durum-kodu

        move "S"                         to takip-kayit-kaynak
        move "O"                         to takip-odami-depmi
*/ santralden geldigi icin ODA kabul edildi
*/ ileride departmanlar bildirirse duzeltme yapacak
*/ or: lobby bardan kendi arizalarini bildirirlerse falan
        initialize grup-rec
        move santral-rec(genel-house-teknik-maid-kodu-bp:
             genel-house-teknik-maid-kodu-au) to grup-alt
        set grup-hk-ts   to true
        read grup no lock invalid
            move "TANIMSIZ PERSONEL"   to grup-adi
        end-read
        move grup-adi                   to takip-bildiren
        write takip-rec invalid
               move takip-rec           to tel-err-rec
               move "Takip dosyasina Teknik ariza yazilamadi" to tel-err-rec(100:)
               write tel-err-rec
               exit paragraph
        end-write.
*/ eger oda okeylenirse maid odadan cikmis demektir onun icin kapali
*/ hale getiriyoruz takip-tip-odaya-giris kaydini
maid-girmidimi-kontrol.
    initialize takip-rec
    set takip-tip-odaya-giris to true
    set takip-acik            to true
    move tel-onb-oda          to takip-oda-dep-no
    start takip key not < takip-alt-5 invalid
          continue
    not invalid
    initialize fs-takip
    perform with test after until fs-takip = "10"
    read takip next no lock end move "10" to fs-takip
    not at end
         if not takip-tip-odaya-giris or 
            not takip-acik
                exit perform
         end-if

         if tel-onb-oda <> takip-oda-dep-no
            exit perform
         end-if

         accept takip-son-tarih from century-date
         accept takip-son-zaman from time
         set takip-kapali       to true
         rewrite takip-rec end-rewrite

    end-read
    end-perform
    end-start.

sil-islem.
     
     move all low-values to sildir
     string sildir,
            "/asya/ytl/log/otel/" delimited by low-values
               isyeri-adres-tasi delimited by low-values
            into sildir.
            
     call "c$list-directory" using 
                             listdir-open, 
                             sildir,
                             "*". 
    move return-code to sildir-handle.
    if sildir-handle = 0
      exit paragraph
    end-if.

    initialize sildir-filename

    perform with test after until sildir-filename = spaces
            call "c$list-directory" using 
                                    listdir-next, 
                                    sildir-handle, 
                                    sildir-filename,
                                    listdir-file-information
            if sildir-filename <> spaces and 
               listdir-file-type-regular-file

               inspect sildir-filename 
                       replacing trailing spaces by low-values
                  move all low-values to remove-filename   
                  initialize tayvar
                 inspect sildir-filename tallying tayvar
                    for all ".tay"
                    
                    if tayvar = 0 exit perform cycle end-if
                   
                    string "/asya/ytl/log/otel/" delimited by low-values
                          isyeri-adres-tasi delimited by low-values
                          "/" delimited by spaces
                          sildir-filename   delimited by spaces
                        into remove-filename

                     move remove-filename to tay-al-adres
                     move sildir-filename to tay-git-dosya
                    if tay-git-dosya(4:1) = spaces then
                            move spaces to tay-git-dosya(4:)
                            move ".tay" to tay-git-dosya(4:)
                    end-if

                    CALL "C$COPY" using tay-al-adres, tay-git-adres giving sonuccopy 

                   string "/asya/ytl/log/otel/" delimited by low-values
                          isyeri-adres-tasi delimited by low-values
                          "/" delimited by spaces
                          sildir-filename   delimited by spaces
                        into remove-filename

                     call "CBL_DELETE_FILE" using 
                        remove-filename
           end-if
    end-perform.
    if sonuccopy = 1 Then  
       if message-box-goster
          display message box 
                  "Telayar kopyalanamadi", new-line,
                  "From : ", tay-al-adres,new-line
                  "To : ",tay-git-adres,new-line
                 
         
       else
                open extend tel-err
                move "telayar kopyalanamadi"   to tel-err-rec
                move calisma2-tarihi        to tel-err-rec(15:)
                write tel-err-rec
                close tel-err
                

       end-if
    end-if

    call "c$list-directory" using 
                            listdir-close,
                            sildir-handle.     

    .
sil-islem-uyandirma.
     
     move all low-values to sildir
     string sildir,
            "/asya/ytl/log/otel/" delimited by low-values
               isyeri-adres-tasi delimited by low-values
            into sildir.
            
     call "c$list-directory" using 
                             listdir-open, 
                             sildir,
                             "*". 
    move return-code to sildir-handle.
    if sildir-handle = 0
      exit paragraph
    end-if.

    initialize sildir-filename

    perform with test after until sildir-filename = spaces
            call "c$list-directory" using 
                                    listdir-next, 
                                    sildir-handle, 
                                    sildir-filename,
                                    listdir-file-information
            if sildir-filename <> spaces and 
               listdir-file-type-regular-file

               inspect sildir-filename 
                       replacing trailing spaces by low-values
                  move all low-values to remove-filename   
                  initialize tayvar
                 inspect sildir-filename tallying tayvar
                    for all ".uya"
                    
                    if tayvar = 0 
                       exit perform cycle 
                    end-if
                   
                    string "/asya/ytl/log/otel/" delimited by low-values
                          isyeri-adres-tasi delimited by low-values
                          "/" delimited by spaces
                          sildir-filename   delimited by spaces
                        into remove-filename

                     move remove-filename to tay-al-adres
                     move sildir-filename to tay-git-dosya
                    if tay-git-dosya(4:1) = spaces then
                            move spaces to tay-git-dosya(4:)
                            move ".uya" to tay-git-dosya(4:)
                    end-if

                    CALL "C$COPY" using tay-al-adres, tay-git-adres giving sonuccopy 

                   string "/asya/ytl/log/otel/" delimited by low-values
                          isyeri-adres-tasi delimited by low-values
                          "/" delimited by spaces
                          sildir-filename   delimited by spaces
                        into remove-filename

                     call "CBL_DELETE_FILE" using 
                        remove-filename
           end-if
    end-perform.
    if sonuccopy = 1 Then  
       if message-box-goster
          display message box 
                  "Telayar kopyalanamadi", new-line,
                  "From : ", tay-al-adres,new-line
                  "To : ",tay-git-adres,new-line
                 
         
       else
                open extend tel-err
                move "telayar kopyalanamadi"   to tel-err-rec
                move calisma2-tarihi        to tel-err-rec(15:)
                write tel-err-rec
                close tel-err
                

       end-if
    end-if

    call "c$list-directory" using 
                            listdir-close,
                            sildir-handle.     

    .

**************************Route islemi icin...........
*
folref-bul.
       initialize aroute-anah routtur routyazma routbulundu
        if konuk-grup-no > 0 then 
          move konuk-grup-no to aroute-rezno
          move konuk-grup-no to aroute-folio
            move hrkgir-depkod   to route-depkod
          else
          move high-values to  aroute-anah
       end-if
         move aroute-anah to route-anah
             move hrkgir-depkod   to route-depkod
         read route no lock invalid
           
                initialize route-rec aroute-anah
               if konuk-fol-kodu = "R" then 
                  move konuk-rez-no to aroute-rezno
                 else
                  if konuk-extra-rez-no  > 0 
                      move 1 to extradan-geldi
                      move konuk-extra-rez-no to aroute-rezno
                   else
                      move konuk-folio to aroute-folio
                  end-if
               end-if

       end-read

     
       perform until routbulundu = 1 or routtur > 10 
       add 1 to routtur
       initialize route-rec
        move aroute-anah to route-anah
       move hrkgir-depkod   to route-depkod
       read route no lock invalid
           
           perform rout-folio-kontrol
           perform def-pen-bul
            move 1 to routbulundu
         not invalid
         if route-tip = "P"

            perform rout-folio-kontrol
            move 1 to routbulundu
          else
            if route-tip = "F"
               if route-no <> route-folio
                        initialize aroute-anah
                        move route-no to  aroute-folio
                   else
                     perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

                end-if
              else
                if route-no <> route-rezno
                      initialize aroute-anah
                      move route-no  to aroute-rezno
                         else
                       perform rout-folio-kontrol
                     perform def-pen-bul
                  move 1 to routbulundu

               end-if
            end-if
        end-if
        end-read
       end-perform 
        .
rout-folio-kontrol.
       initialize konu2-rec
       if route-rezno = 0 then
            move route-folio to konu2-folio
       else
       
       move route-rezno to rez-no
       read rez no lock invalid
          move 1 to routyazma
       end-read

         if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move rez-folio to konu2-folio
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move rez-folio to konu2-folio
                  end-if
               else
                move rez-folio to konu2-folio
           end-if

    end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
          if KONU2-ACIK-KAPALI    = "C" 
            move 2 to routyazma
          end-if
          if KONU2-DURUMU not = "I" then
              move 3 to routyazma
          end-if
       end-read
          .
def-pen-bul.
       initialize konu2-rec
      if route-rezno = 0 then
       move route-folio to konu2-folio
       else
        initialize rez-rec
        move route-rezno to rez-no
        read rez no lock invalid
         move 1 to routyazma
        end-read
         if extradan-geldi = 1 then 
               compute konu2-folio = rez-folio + 1
               read konu2 no lock invalid 
                   move 1 to routyazma
                   move rez-folio to konu2-folio
                   not invalid
                   if konu2-extra-rez-no = rez-no then 
                      continue
                      else
                      move 1 to routyazma
                      move rez-folio to konu2-folio
                  end-if
               else
                move rez-folio to konu2-folio
           end-if
     end-if
       read konu2 no lock 
          invalid
           move 1 to routyazma
          not invalid
             move "B"               to kodlar02-tipi
               move konu2-odeme-tipi  to kodlar02-kodu 
              read kodlar02 no lock invalid
                    move 1 to route-no
             
                  not invalid
                     if  ode-tipi  not =  "A"   | KREDI ISE
                        
                          if depkod-tipi = 2 then 
                                move 1 to route-no
                             else
                                move 2 to route-no
                          end-if
                      else
                         move 1 to route-no
                   end-if
             end-read
       end-read
          .
*
folref-ata.
     if routyazma = 0 and routbulundu = 1 
      move konu2-folio to hrkgir-folio
      if vis-pen = 1 then
          move odemepen to hrkgir-ref
             else
          move route-no to hrkgir-ref
      end-if
     else
       move konuk-folio to konu2-folio
       read konu2 no lock invalid
          stop " " 
       end-read        
     end-if
       .



minibar.
*0123456789012345678901234567890123
*B 1002 28/02/00 08:14:00   2500000\r\n
        move 0 to ok-ver

        
        if santral-rec(genel-minibar-kayit-belirle-bp:
                       genel-minibar-kayit-belirle-au) = 
           genel-minibar-kayit-sabit-kosul(1:genel-minibar-kayit-belirle-au)
           continue
        else
           exit paragraph | minibar kaydi degil
        end-if
       
*/ room servis kaydi oldugu icin gec-gecme = 1 yapaz-
        move 1 to gec-gecme

        initialize odalar-rec grup-rec
        move santral-rec(genel-minibar-oda-no-bp:
                         genel-minibar-oda-no-au) to telkod-anah

        read telkod no lock invalid
           move santral-rec to tel-err-rec
           move "<Minibar> Tel.no tanim.yok. Oda :" to tel-err-rec(100:) santlog-err
           move telkod-anah                         to tel-err-rec(135:04) santlog-err(35:04)
           write tel-err-rec
           exit paragraph
        end-read

        move tel-onb-oda  to odalar-anah
        read odalar no lock invalid
           move santral-rec to tel-err-rec
           move "<Minibar> Tel.no oda tanim.yok. Oda :" to tel-err-rec(100:)   santlog-err
           move telkod-anah                                  to tel-err-rec(138:04)  santlog-err(38:04)
           write tel-err-rec
           exit paragraph
        end-read

        move GENEL-MINIBAR-POS-DEP to posdep-anah
        open input posdep
          read posdep no lock invalid
             move santral-rec to tel-err-rec
           move "<Minibar> POS DEP BULUNAMADI POSDEP :" to tel-err-rec(100:)   santlog-err
           move GENEL-MINIBAR-POS-DEP                   to tel-err-rec(138:04)  santlog-err(38:04)
           write tel-err-rec
            close posdep
           exit paragraph
          
        end-read
        close posdep 



        open input satkod
        initialize satkod-rec
        move posdep-recete-dep    to satkod-depkod
        
      
        move "0000" to  satkod-kodu 
        move santral-rec(genel-minibar-ucret-bp:genel-minibar-ucret-au) to satkod-kodu(3:2) 
        if satkod-kodu(1:1) = spaces then move 0 to  satkod-kodu(1:1) end-if
        if satkod-kodu(2:1) = spaces then move 0 to  satkod-kodu(2:1) end-if
        if satkod-kodu(3:1) = spaces then move 0 to  satkod-kodu(3:1) end-if
        if isyeri-adres-tasi(1:4) = "arte" then 
           move santral-rec(genel-minibar-ucret-bp:genel-minibar-ucret-au) 
           to satkod-kodu
           if satkod-kodu(1:1) = spaces then move 0 to  satkod-kodu(1:1) end-if

        end-if
        if isyeri-adres-tasi = "belek013" then 
           move santral-rec(genel-minibar-ucret-bp:genel-minibar-ucret-au) 
           to satkod-kodu
           if satkod-kodu(1:1) = spaces then move 0 to  satkod-kodu(1:1) end-if

        end-if
        read satkod no lock invalid
            if  santral-rec(genel-minibar-ucret-bp:genel-minibar-ucret-au) = GENEL-MINIBAR-KONT
              move 1 to ok-ver
              else
             close satkod
             move "<Minibar> Satis Kodu Tanimsiz:" to tel-err-rec(100:)   santlog-err
             move satkod-kodu                      to tel-err-rec(138:04) santlog-err(38:04)
             write tel-err-rec 
             exit paragraph
           end-if
        end-read
        close satkod.

        if not musteri
           exit paragraph.
       
        open input pacikla
        initialize pacikla-rec
        move "K"                               to pacikla-altgrup-tipi
        move posdep-anah                       to pacikla-altgrup-kodu
        move satkod-kdv-tipi                   to pacikla-aciklama-kodu
        read pacikla no lock invalid
             display message box
                     satkod-kodu " nolu satis koduna bagli onburo departmani tanimlanmamis." x"0a0d"
                     "Kayit onburoya yazilmadi."
                     title " UYARI - Onburo baglantisi tanimsiz."
                      icon mb-warning-icon
              close pacikla
              exit paragraph 
        end-read
        close pacikla  
        if pacikla-kdv-onb-dep = zeroes 
            exit paragraph 
        end-if    
        move pacikla-kdv-onb-dep      to minibar-onb-dep

        open input depkod 
        initialize depkod-rec
        move minibar-onb-dep  to depkod-anah
        read depkod no lock invalid
             close depkod
             exit paragraph 
        end-read 
        close depkod
        if depkod-anah = zeroes
           exit paragraph 
        end-if 

        initialize konuk-rec,gecer-gecmez
        move "I"           to konuk-durumu,
        move tel-onb-oda   to konuk-odano
        start konuk key = konuk-oda invalid
               move santral-rec to tel-err-rec
               move "Iceride Oda Bulunamadi(Minibar)"  to tel-err-rec(100:)   santlog-err
               write tel-err-rec,
               exit paragraph.
        perform with test after until (konuk-odano not = tel-onb-oda) or evet
        read konuk next no lock end move all high-value to konuk-odano
        not end
             move 6 to gecer-gecmez
             if konuk-durumu  = "I" and
                konuk-odano = tel-onb-oda
                if telpara-fol-tipi = konuk-fol-kodu,
                    move konuk-folio to folio-no ,
                    if ok-ver = 1 then 
                        move 1 to konuk-mini-ok
                        rewrite konuk-rec  invalid continue
                        end-rewrite
                        exit paragraph
                    end-if
                    move 3   to gecer-gecmez
                end-if
             end-if
        end-read,
        end-perform,
        open input kart
        initialize kart-rec
         move 0 to kart-ind
          move konuk-folio to kart-folio
          start kart key = kart-folio
            invalid
               continue
            not invalid
             Read Kart next no lock end continue
               if kart-folio not = konuk-folio
                   move 0 to kart-ind
                   initialize kart-rec
               end-if
             end-read
          end-start
        close kart
          initialize tl-tutar dv-tutar
        if genel-minibar-doviz-tl = "D"
           compute tl-tutar rounded = satkod-dv-satis-kdvli * islem-kuru * ( (100 - kart-ind) / 100)
           compute dv-tutar   = satkod-dv-satis-kdvli * ( (100 - kart-ind) / 100)         
        else
           compute tl-tutar rounded = satkod-tl-satis-kdvli * ( (100 - kart-ind) / 100)
           compute dv-tutar   = tl-tutar/islem-kuru
        end-if
        
        if not evet
           move santral-rec to tel-err-rec
           move "Iceride Oda Bulunamadi(Minibar)"  to tel-err-rec(100:)   santlog-err
           write tel-err-rec, 
           exit paragraph
        end-if

        move "B"               to kodlar02-tipi
        move konuk-odeme-tipi  to kodlar02-kodu
        read kodlar02 no lock invalid
             move santral-rec to tel-err-rec
             move "Odeme Kodu Tanimsiz(Minibar)"  to tel-err-rec(100:)  santlog-err
             write tel-err-rec end-write 
             exit paragraph
        end-read,
*->
        if ode-posting = "H"
             move santral-rec to tel-err-rec
             move "Fiyat Basilamaz(Minibar)"  to tel-err-rec(100:)  santlog-err
             write tel-err-rec end-write 
             exit paragraph
        end-if

        if tel-no-post = 1                              |xiii no-post isaretliyse post etme
           move santral-rec to tel-err-rec
           move "Fiyat Basilamaz(NoPost)"  to tel-err-rec(100:)  santlog-err
           write tel-err-rec end-write 
           exit paragraph
        end-if
        open i-o genelfis
        move 1 to genelfis-anahtar,
        read genelfis no lock invalid
             move 1 to cekgir-oto
        not invalid
             add 1 to cekgir-oto
        end-read
        rewrite genelfis-rec invalid
        write genelfis-rec end-write
        end-rewrite,
        close genelfis
        perform pos-write 

        initialize exthrk-rec hrkgir-rec
        move folio-no                  to exthrk-folio,
        move cekgir-oto                to exthrk-islem,    santlog-folio
        move "P"                       to exthrk-islem-tipi
        move teldata-islemno           to exthrk-cekno
        move calis2-yil                to exthrk-yil
        move calis2-ay                 to exthrk-ay
        move calis2-gun                to exthrk-gun,
        move minibar-onb-dep           to exthrk-depkod
        move "B"                       to exthrk-ba
        move tl-tutar                  to exthrk-tl-tutar
        move dv-tutar                  to exthrk-dv-tutar
        move posy-fis-no                  to exthrk-cekno
        accept exthrk-zaman from time,
        move kart-no                    to exthrk-kart-no exthrk-pos-kodu
        move k-kodu-tasi               to exthrk-staf,

***************************ilyas ekleme
********************kopyalanacak
       open input route konu2 rez
       open i-o yromhrk

       move exthrk-rec  to hrkgir-rec
       move hrkgir-rec  to yromhrk-rec
       move hrk2-data to yromhrk-data
       write yromhrk-rec invalid stop " " end-write 
       close yromhrk
    
       perform folref-bul
       perform folref-ata
       close route konu2 rez
       open i-o hrk2
       move hrkgir-anah to hrk2-anah
       move yromhrk-folio to hrk2-kaynak-folio
       write hrk2-rec end-write
       close hrk2
       move hrkgir-rec       to romhrk-rec exthrk-rec
**************** kopyalanacak
                  open input konu2 
                  move hrkgir-folio   to konu2-folio
                  read konu2 no lock invalid 
                       continue 
                  end-read 
                  close konu2                                                     
       if konu2-fol-kodu = "R"
          move exthrk-rec to romhrk-rec,
          write romhrk-rec invalid
             move santral-rec to tel-err-rec
             move "**Romhrk'ye Islenemedi...." to tel-err-rec(100:)  santlog-err(30:)
             write tel-err-rec end-write
             not invalid 
             move "Room Folio islendi " to santlog-err(30:)
          end-write
          perform log-operation-romhrk
        else
          write exthrk-rec invalid
             move santral-rec to tel-err-rec
             move "**Exthrk'ye Islenemedi...." to tel-err-rec(100:) santlog-err(30:)
             move fs-exthrk                  to tel-err-rec(125:)
             move exthrk-islem               to tel-err-rec(130:)
             write tel-err-rec end-write 
          not invalid 
              move "Extra Folio islendi " to santlog-err(30:)
          end-write,
          perform log-operation-exthrk
       end-if,
        open i-o nt
        initialize not-rec
        if konu2-fol-kodu = "R"
           move  "RHR"     to NOT-DOS
           move romhrk-anah to  NOT-DOS-ANAH 
        else
           move  "EHR"      to NOT-DOS
           move exthrk-anah to  NOT-DOS-ANAH 
        end-if

        initialize not1

        if kart-ind > 0
            string 
                 satkod-adi(1:12) ,
                 " %",
                   kart-ind,
                   " Ind."
                   
            into not1
        else   
           move satkod-adi      to not1
        end-if
        write not-rec invalid
              continue
        end-write
        close nt

               
       move calis2-yil              to onk-yil
       move calis2-ay               to onk-ay
       move calis2-gun              to onk-gun
       move minibar-onb-dep         to onkasa-dep
       initialize onkasa-rec
       read onkasa no lock invalid
            initialize onkasa-tutar-tl onkasa-tutar-dv
                       onkasa-corr-tutar-tl onkasa-corr-tutar-dv
                       onkasa-matrah-disi
       end-read
       compute onkasa-tutar-tl = onkasa-tutar-tl + tl-tutar
       compute onkasa-tutar-dv = onkasa-tutar-dv + dv-tutar

       rewrite onkasa-rec invalid
       write onkasa-rec end-write
       end-rewrite.
*
 pos-write.
            open i-o posy
             initialize posy-rec
                move calis2-yil       to   posy-yil   
                move calis2-ay        to   posy-ay
                move calis2-gun       to   posy-gun 
             move 1                                  to posy-fis-sira            
             move posdep-anah                       to posy-depkod
             move "ASYA"                             to posy-staf
            
             move kart-no                          to posy-kart-no
             move satkod-kodu                    to posy-rec-kodu
             move 1                                 to posy-adet
             move satkod-tl-satis-kdvli              to posy-birim-fiat-gercek
             
               compute posy-tutar-tl =  tl-tutar          
               compute posy-tutar-dv =  dv-tutar              
             
             compute posy-birim-fiat = posy-tutar-tl / posy-adet
             compute posy-ind = kart-ind
             
             move satkod-yid                to posy-yid
             move kart-tipi                 to posy-musteri
             move konuk-folio               to posy-folio
             accept posy-satis-zaman       from time
             evaluate kart-tipi
                 when "M"
                      set posy-kdv-dusuk to true
                      
                         move "P" to posy-kapatma-kodu
                         if satkod-alkollumu = "E"
                            set posy-kdv-yuksek   to true
                         end-if
                     
                 when "O"    move "O"             to posy-kapatma-kodu
                        set posy-kdv-dusuk        to true
                 when "I"    move "I"             to posy-kapatma-kodu
                        set posy-kdv-dusuk        to true
             end-evaluate
             
             evaluate true
             when posy-yiyecek
                    if  posy-kdv-yuksek 
                       move posdep-kdv-y   to posy-kdv-oran
                    else
                       move posdep-kdv-y-8 to posy-kdv-oran
                    end-if
               when posy-icecek
                     if  posy-kdv-yuksek 
                       move posdep-kdv-i   to posy-kdv-oran
                    else
                       move posdep-kdv-i-8 to posy-kdv-oran
                    end-if
               when satkod-yid = "D"
               when satkod-yid = "S"
                    if  posy-kdv-yuksek 
                       move posdep-kdv-d   to posy-kdv-oran
                    else
                       move posdep-kdv-d-8 to posy-kdv-oran
                    end-if
             end-evaluate 
                        perform pos-fis-yukselt
                        move cgenelfis-pos-fis             to posy-fis-no
                        read posy no lock invalid 
                             continue 
                        not invalid 
                            perform pos-fis-yukselt |fiþ varsa yeniden fiþ alýnýyor.
                        end-read 
                      write posy-rec invalid                               
                             move "Pos Fis Cakismasi..."   to tel-err-rec(1:20)
                             move posy-rec                 to tel-err-rec(22:)
                             write tel-err-rec end-write   
                      end-write            
                  close posy.
*
uyandirma-geri-donus-isle.
      initialize wakeup-rec
      if telpara-uyandirma-bit-oda = spaces or telpara-uyandirma-bit-oda = zeroes 
         move santral-rec(4:4)   to wakeup-odano 
      else
          move santral-rec(telpara-uyandirma-bas-oda:telpara-uyandirma-bit-oda)   to wakeup-odano          
      end-if       
      start wakeup key not < wakeup-odano invalid 
           continue 
      not invalid 
      perform with test after until fs-wakeup = "10"
      read wakeup next no lock end move "10"  to fs-wakeup
      not at end 
             if telpara-uyandirma-bit-oda = spaces or telpara-uyandirma-bit-oda = zeroes
                if wakeup-odano <> santral-rec(4:4)
                     exit perform 
                end-if 
                         evaluate true
                     when santral-rec(2:1) = "A"
                         move 1  to wakeup-islem-durumu
                     when santral-rec(2:1) = "Z"
                         move 0  to wakeup-islem-durumu
                     end-evaluate
             else
                if wakeup-odano <> santral-rec(telpara-uyandirma-bas-oda:telpara-uyandirma-bit-oda)
                   exit perform
                end-if
                        evaluate true
                     when santral-rec(1:1) = "A"
                         move 1  to wakeup-islem-durumu
                     when santral-rec(1:1) = "Z"
                         move 0  to wakeup-islem-durumu
                     end-evaluate
             end-if 

             
 
             rewrite wakeup-rec end-rewrite 
      end-read 
      end-perform
      end-start.
*
 pos-fis-yukselt.
        open i-o cgenelfis
        move 1 to cgenelfis-anahtar
        read cgenelfis no lock invalid
            close cgenelfis
             exit paragraph             
        not invalid
             compute cgenelfis-pos-fis = cgenelfis-pos-fis + 1
             rewrite cgenelfis-rec of cgenelfis end-rewrite
         end-read
         close cgenelfis.
* 
 dosya-adres-tasi-yerlestir.

    if isyeri-no-tasi = zeroes or spaces 
       goback
    end-if

    move isyeri-adres-tasi    to tel-log-adres santlog-adres

    open input isyeri
    move isyeri-no-tasi       to isyeri-no
    read isyeri no lock invalid 
         close isyeri goback
         not invalid continue
    end-read
    close isyeri

    perform adresleri-tasi
    open input genel
    move 1 to genel-anahtar
    read genel no lock invalid
          close genel,
          initialize mesaj-degiskenler
          move "Genel Parametreler Tanimsiz      "  to mmesaj-1
          move "Tanimladiktan Sonra Islem Yapiniz"  to mmesaj-2
          move " [ Hata ] " to mmesaj-title
          move 1           to mmesaj-type
          move 1           to mmesaj-icon
          move 1           to mmesaj-default
          perform mmesaj-ver
*/ Log write
             initialize tel-log-rec
             move "Genel parametre tanimsiz "       to tel-log-durum
             perform log-kaydet
*/

          goback
    end-read
    close  genel

    move cost-sirketi         to pacikla-dosya-adres satkod-dosya-adres posy-dosya-adres posdep-dosya-adres kart-dosya-adres
    cgenelfis-dosya-adres.
     
     
    initialize bekle-sure 
    compute bekle-sure = telpara-dakika * 6000

    move 1 to bekle-sure
      move isyeri-adres-tasi      to santral-lock-file-adres
      if telpara-lock-kontrol = "E"
         open i-o santral-lock-file with mass-update
      end-if.


 
