* otopro.evt
* otopro.evt is generated from D:\asya\acugt.ytl\otel\otopro.Psf
* This is a generated file. DO NOT modify this file directly.


 Form1-Event-Proc.
     .

 Form1-Exception-Proc.
     PERFORM Form1-Ex-Other
     .

 Form1-Cb-1ab-Exception-Proc.
     PERFORM Form1-Cb-1ab-Ex-Cmd-Clicked
     .
***   start event editor code   ***
*
 Form1-Bef-Create.
    perform adresleri-tasi.
    open input genel
    move 9 to genel-anahtar
     read genel no lock invalid continue
         not invalid move genel-rec(5:) to mail-altlik
    end-read

     move 8 to genel-anahtar
     read genel no lock invalid continue
         not invalid move genel-rec(5:) to mail-altlik2
    end-read

    move 1 to genel-anahtar
    read genel no lock invalid continue
         not invalid continue
    end-read
    close genel.
    call "c$narg" using link-var.
    if link-var > 0 then 
       move 0 to vis-lab 
    end-if
    move genel-printer-filtre to text-oku-filtre.
    move tarih-tasi to fatt-tarih
    perform acuserve-adres-aktar.

     .
*
*
 rezdigtar-at.
         open input rez aceanlas otomail takvim.
         open i-o rezdigtar. 
         initialize rez-rec
         start rez key > rez-anah invalid continue
            not invalid
            perform until fs-rez = "10"
             
              read rez next no lock end move "10" to fs-rez
                    not end
                    if rez-durumu not = "I"  then 
                       exit perform cycle
                    end-if
                     initialize  rezdigtar-rec
                     move rez-no to REZdigtar-rezno  
                     read REZdigtar no lock invalid
                         continue
                     end-read
*                      if rez-acenta = "0002" then stop " " end-if
                      perform otomail-at
                    
                     write rezdigtar-rec  invalid
                        rewrite rezdigtar-rec
                     end-write
              end-read
            end-perform
         end-start


         close rez aceanlas rezdigtar otomail takvim.
*
 otomail-at.
                   initialize otomail-rec  
                     move "A" to otomail-tipi
                      move rez-acenta to otomail-acenta-kodu
                      read otomail no lock invalid
                           initialize  rezdigtar-mail-tar
                         not invalid
                           if otomail-aktif not = 1 then 
                            initialize  rezdigtar-mail-tar
                           else
                             move  otomail-acenta-gun  to dgun
                             move  otomail-acenta-os    to os
                            evaluate  otomail-acenta-ct 
                              when "C" 
                                 move rez-gir-tar to takvim-anah
                                 perform dondur-gel
                                  move takvim-anah to rezdigtar-mail-tar
                              when "T"
                                  move rez-gir-tar to takvim-anah
                                   perform dondur-gel
                                  move takvim-anah to rezdigtar-mail-tar
                              when other 
                                initialize  rezdigtar-mail-tar
                           end-evaluate
                          end-if
                     end-read  .
*
*
 dondur-gel.
       if dgun > 0 then 
         start takvim key = takvim-anah invalid continue
           not invalid
             read takvim next no lock end stop " "  end-read
           perform dgun times
            if os  = "O"
                read takvim previous no lock end exit perform end-read
              else
                read takvim next     no lock  end exit perform end-read
            end-if
           end-perform 
         end-start
       end-if  .

*
 Form1-Aft-Initdata.
    perform rezdigtar-at
    move tarih-tasi to ilk-tarih son-tarih.
    move yil-tasi to ilk-cik-yil son-cik-yil
    add 1 to son-cik-yil
    move 1 to ilk-cik-ay ilk-cik-gun
    move 31 to son-cik-gun
    move 12 to son-cik-ay
    display acc-01 acc-02 acc-03 acc-04 acc-05 acc-06
            acc-01a acc-02a acc-03a acc-04a acc-05a acc-06a.
    if k-kodu-tasi = "ASYA" or "X   " then 
          move 1 to v-eski
          display a-eksi
    end-if.
    if link-var > 0 then 
       initialize mail-gondereyimmi          
       move "E"    to mail-gondereyimmi
       initialize mailsend-link 
                 ek-dosya          
       move 2 to key-status  
       perform form1-ex-other
       set exit-pushed to true
    end-if. 
*/-----------------------------\*  
*/---------DIL AYARLA----------\*    
*/-----------------------------\*    
     perform dil-ayarla-proc.
*/-----------------------------\*         
*
 Form1-Ex-Other.
    evaluate key-status
      when 1
        evaluate control-id
        when 12
        when 2001
             initialize acenta-cagir
             call "/asya/ytl/obj/otel/acenara.asy" 
                  using acenta-cagir  
                  on exception 
                     perform callerr-proc
                  not on exception
                     if acenta-cagir <> spaces
                        move acenta-cagir to acn-kod
                        display acc-07
                     end-if
             end-call
             move 4 to accept-control
             move 12 to control-id
        end-evaluate
        exit paragraph
      when 33 
            call "/asya/ytl/obj/otel/rezfilt.asy" 
                  using filtre-tasi  
                  on exception 
                     perform callerr-proc
                  not on exception
                     continue
             end-call
             display l-filtre
              
      when 2
      when 3               
          if link-var > 0
             move 3 to key-status
          end-if 
          initialize mail-gondereyimmi
         if key-status = 3
            move "E"    to mail-gondereyimmi
            initialize mailsend-link 
                       ek-dosya
         end-if
            if link-var >= 0 then
                     open input takvim
                    move ilk-tarih  to takvim-anah
                    read takvim no lock invalid
                         initialize mesaj-link
                         move 13 to mesaj-no perform mesaj-ver
                         move 4 to accept-control move 4 to control-id
                         close takvim exit paragraph 
                     not invalid continue
                    end-read
                    move son-tarih to ay-basi takvim-anah   
                    move 01 to ay-basi(7:2) 
                    move 32 to  takvim-gun
                    start takvim key < takvim-anah invalid continue
                      not invalid read takvim previous end continue end-read end-start
                    move takvim-anah to ay-sonu
        
                    move son-tarih  to takvim-anah
                    read takvim no lock invalid
                         initialize mesaj-link
                         move 13 to mesaj-no perform mesaj-ver
                         move 4 to accept-control move 8 to control-id
                         close takvim exit paragraph 
                     not invalid continue
                    end-read
                    close takvim
           end-if
        open input konuk kur doviz konum rez  takvim kodlar02  grup yanrez hesayr
          open input  aksiyhrk fiyat fiyatana
        initialize konuk-rec toplam ara-toplam
         
        evaluate link-var 
            when  1 
               display    message box "Hatali lik"
            when  2 
               perform tek-rez-takas
            when other    
               perform takas-aktar thru takas-aktar-exit 
        end-evaluate
              initialize takas-rec toplam kont-eb-ayrisayfa 
                         kont-git-tar gece-say doviz-kontrol kont-donem
              move "F" to kont-eb-ayrisayfa
              start takas key not < takas-kodu invalid
                    initialize mesaj-link
                    move 04 to mesaj-no
                    perform mesaj-ver
                    close konuk takas kur doviz kodlar02 grup yanrez
                   close aksiyhrk fiyat fiyatana takvim rez  konum hesayr
                    exit paragraph
              end-start
              initialize mail-gt-toplam

             PERFORM PRE-DOK
           
              
              initialize fs-takas doviz-kontrol gece-say kont-git-tar
                         kont-gel-tar kont-acenta kont-eb-ayrisayfa  kont-donem kont-firma
                            move "F" to kont-eb-ayrisayfa
              perform with test after until fs-takas = "10"
                    
                    read takas next no lock end move "10" to fs-takas
                    not at end
                       
                      if doviz-kontrol = zeroes 
                         move takas-doviz to doviz-kontrol,
                      end-if
                      if gece-say      = zeroes 
                         move takas-gece  to gece-say,
                      end-if
                      if kont-git-tar      = zeroes 
                         move takas-git-tar  to kont-git-tar,
                      end-if
                      if kont-gel-tar      = zeroes 
                         move takas-gel-tar  to kont-gel-tar,
                      end-if
                       if kont-donem       = zeroes 
                         move takas-donem  to kont-donem,
                      end-if
                      if kont-acenta      = spaces 
                         move takas-acenta  to kont-acenta
                      end-if
                      if kont-firma = spaces
                         move takas-firma to kont-firma
                      end-if              
                      if kont-referans    = spaces  or 0
                          move  takas-referans to kont-referans
                      end-if
*                      stop " "

                      if kont-eb-ayrisayfa     = "F"  
                         move takas-eb-ayrisayfa  to kont-eb-ayrisayfa
                      end-if
                      if  kont-gel-tar = takas-gel-tar and kont-acenta = takas-acenta  and
                         takas-referans = kont-referans  and kont-firma = takas-firma
                      if  kont-git-tar = takas-git-tar and doviz-kontrol = takas-doviz 

                        and takas-eb-ayrisayfa = kont-eb-ayrisayfa 
                        then continue
                        else 
                          if sayfa-basi-v = 1 
                               perform liste-ara-toplam,
                        end-if
                             initialize ara-toplam,
                             if ( kont-git-tar not = takas-git-tar and cout-ayri-v  = 1) or 
                                (takas-eb-ayrisayfa not = kont-eb-ayrisayfa and eb-ayri-v =1) then 
                               initialize dokumer-rec detay
                              
                             end-if
                             move takas-eb-ayrisayfa to kont-eb-ayrisayfa
                             move takas-git-tar   to kont-git-tar
                             move takas-doviz   to doviz-kontrol,
                       end-if
                      else
                      if sayfa-basi-v = 1 
                           perform liste-ara-toplam,

                             initialize ara-toplam

                              perform liste-toplam
                       end-if
                              initialize toplam,
                              initialize dokumer-rec detay
                              
                             if sayfa-basi-v = 1  then 
                               
                                 perform post-dok
                                  perform mail-deg-ata
                                perform pre-dok
                             end-if
                             move takas-eb-ayrisayfa to kont-eb-ayrisayfa
                             move takas-gel-tar to kont-gel-tar
                             move takas-acenta to  kont-acenta,
                             move takas-firma to kont-firma
                             move takas-referans to kont-referans
                             move takas-git-tar to kont-git-tar 
                             move takas-doviz   to doviz-kontrol
                       end-if
                      
                      perform detay-ata
                      write dokumer-rec from detay
                      if yan-goster = 1
                         perform yan-detay-ata
                      end-if
                    end-read
              end-perform
              if sayfa-basi-v = 1 
                 perform liste-ara-toplam
                 perform liste-toplam
               
              end-if
               perform mail-deg-ata
              perform post-dok
              close konuk takas kur doviz rez  takvim kodlar02 grup  yanrez hesayr
              close konum aksiyhrk fiyat fiyatana
            
              DELETE file takas.
     .
*
 mail-deg-ata.
      move kont-git-tar(1:4) to e-yil
      move kont-git-tar(5:2) to e-ay
      move kont-git-tar(7:2) to e-gun
      move etarih to e-git-tar

      move kont-gel-tar(1:4) to e-yil
      move kont-gel-tar(5:2) to e-ay
      move kont-gel-tar(7:2) to e-gun
      move etarih to e-gel-tar
    
       move t-oda        to z-goster.
       move z-goster     to det-11.
   
      
       move t-dv-toplam  to z-1.
       move z-1          to det-15.
       move doviz-kontrol to doviz-kodu
       read doviz no lock invalid continue
       end-read

       string  e-gel-tar delimited by size
               " - " delimited by size
               e-git-tar delimited by size
               "tarihler arasi " delimited by size
               det-11 delimited by size
               " rezervasyon bedeli, " delimited by size
               new-line delimited by size
*               det-14 delimited by size
*               " TL " delimited by size
               det-15 delimited by size
               " " delimited by size
               d-kisa-adi  delimited by size
               " dir. Proforma ektedir."  delimited by size
               into mail-aciklama

        .
*
 POST-DOK.
              
              close dokumer
              if link-var > 0 then 
                        set dokumer-grid to true
              end-if
               if mail-gondereyimmi = "E"

                 perform mail-send-process
              else
***************MAILLLLLLLLLLLLLLLL
                 call dokumer-prog on exception
                      perform callerr-proc
                 not on exception
                      cancel dokumer-prog
                 end-call
              end-if
                delete file dokumer.
*
 PRE-DOK.
             open i-o genelfis
              move 1 to genelfis-anahtar
              read genelfis no lock invalid
                   accept print-no from time
              not invalid
                   add 1 to print-no
                   rewrite genelfis-rec end-rewrite
              end-read
              close genelfis
                 initialize mail-gt-toplam
**************************
       initialize dokumer-rec dokumer-anah dokumer-ozellikler-rec
                dokumer-dosya gt-toplam

     set  dokumer-asya-set to true
     move print-no         to dokumer-dosya-adi
     open output dokumer
*/WINDOW TITLE
     initialize dokumer-rec detay
     move "W"                  to det-dokumer-20(1:)
     move "Acenta Proforma  Raporu"   to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR
     initialize dokumer-rec detay
     move "1"            to det-dokumer-20(10:1)
     move "B"            to det-dokumer-20(1:1)
     move "Acenta Proforma  Raporu"   to det-filler
     move "Tarih..:"     to det-filler(41:10)
     move ilk-gun        to det-filler(51:02)
     move "/"            to det-filler(53:01)
     move ilk-ay         to det-filler(54:02)
     move "/"            to det-filler(56:01)
     move ilk-yil        to det-filler(57:04)
     move "-"            to det-filler(61:01)
     move son-gun        to det-filler(62:02)
     move "/"            to det-filler(64:01)
     move son-ay         to det-filler(65:02)
     move "/"            to det-filler(67:01)
     move son-yil        to det-filler(68:04)
     write dokumer-rec from detay


     initialize dokumer-rec detay
     move "1"          to det-dokumer-20(10:1)
     move "B"                  to det-dokumer-20(1:1)
     move "Acenta....:"           to det-filler(01:)
     move acn-kod                 to det-filler(15:04)
     move "<->"                   to det-filler(20:03)
     if acn-kod       = spaces
        move "Tum Acentalar.."    to det-filler(25:20)
     else
        open input acenta
        initialize acenta-rec  
        move acn-kod        to acenta-kodu
        read acenta no lock invalid 
             move all "*" to acenta-adi  
                        not invalid continue
        end-read
        close acenta
        move acenta-adi           to det-filler(25:20)
     end-if

     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "B"                  to det-dokumer-20(1:1)
     write dokumer-rec from detay


*/ DOKUMER OZELLIKLER-REC
     initialize dokumer-rec detay
     move "O" to det-dokumer-20(1:)
     move "E" to dokumer-oto-sayfa-basi
     move 56  to dokumer-oto-sayfa-satir
     move "|" to dokumer-detay-kolon-ayirici
     move "RRLLRRRRLLRRRRLRRRRRRRR" to dokumer-align-occ
     move dokumer-ozellikler-rec     to det-filler
     write dokumer-rec from detay
*/ BASLIKLAR  

     initialize dokumer-rec detay 
     move "1"          to det-dokumer-20(10:1)
     move "D1"         to det-dokumer-20(1:2)
    
     
     move "Adi       "         to det-3
     move "Soyadi    "         to det-4
     move "Pax "               to det-5
     move "Chi."               to det-6
     move "Free"               to det-7
     move "Beb "               to det-77
     move "Check/In  "         to det-8
     move "Check/Out "         to det-9
     move "Gece"               to det-10
     move "Aksiyon"                to det-100
     move "EB"                 to det-101
     move "Kic"                to det-102
     move "KKP"                to det-104
     move "Spc"                to det-105
     move "Ozl"                to det-106
     move "An"                 to det-200
     move "Kon"                to det-201
    
     move "UG"                 to det-103
     move "Voucher "           to det-11
     move "Ham Fiyat"          to det-ham
*     move "TL.  Tutar     "    to det-12
     move "Gunluk Tut    "     to det-13
*     move "TL.  Toplam    "    to det-14 
     move "Toplam Tutar "     to det-15
     move "Dvz"                to det-16
     move "CIN Kuru"       to det-17
    
     move "|" to  fil-3 fil-4 fil-5 fil-6
                 fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-ham 
                 fil-13  fil-15 fil-16 fil-17 
                 fil-100 fil-101 fil-102 fil-103 
                 fil-104 fil-105 fil-106 fil-200 fil-201
     write dokumer-rec from detay

     initialize dokumer-rec detay
     move "D2"           to det-dokumer-20(1:2)
     move "-"            to det-dokumer-20(5:1)
     move all "-" to  det-3 det-4 det-5 det-6
                  det-7 det-77 det-8 det-9 det-10 det-11 det-ham 
                  det-13  det-15 det-16 det-17 
                  det-100 det-101 det-102 det-103 
                  det-104 det-105 det-106 det-200 det-201
     write dokumer-rec from detay.
*********************************

 takas-aktar.



    perform takas-dosya-ac.

    open input rezdigtar
 
    move fatt-tarih to rezdigtar-mail-tar
    start rezdigtar key =  rezdigtar-mail-tar invalid continue
       not invalid 
       perform until fs-rezdigtar = "10" 
             read rezdigtar next no lock end move "10" to fs-rezdigtar
                 not end
                   if rezdigtar-mail-tar not =  fatt-tarih
                      move "10" to fs-rezdigtar
                      else                   

                         initialize rez-rec
                         move rezdigtar-REZNO to rez-no
                         read rez no lock invalid
                                continue
                            not invalid
                               if rez-durumu not = "S"
                                 if rez-acenta = acn-kod or 
                                    acn-kod = spaces              
                                        perform  tek-rez-yaz
                                 end-if
                               end-if 
                        end-read
                   end-if
              end-read
       end-perform 
    end-start
      close rezdigtar.
           .


 takas-aktar-exit.
    exit.

*
 ref-bul.
     MOVE rez-ODA-KONUMU TO KONUM-ANAHTAR
       READ KONUM NO LOCK INVALID
         DISPLAY MESSAGE BOX "kasa-KONUK-23644"
       END-READ.

*
 gece-al.
    initialize takas-gece takvim-rec.
    move rez-gir-tar to takvim-anah.
*    open input takvim
    start takvim key not < takvim-anah invalid move 1 to takas-gece continue,

        not invalid,
        move spaces to var-yok,
        perform with test after until var,
            read takvim next no lock end move "V" to var-yok,

                not end,

                evaluate true
                    when takvim-anah = rez-cik-tar move "V" to var-yok,
                    when takvim-anah > rez-cik-tar move "V" to var-yok,
                    when takvim-anah not > rez-cik-tar,
                         add 1 to takas-gece,
                end-evaluate,
            end-read,
        end-perform,
    end-start
*    close takvim
    .

 gece-al-exit.
    exit.
 takas-dosya-ac.
    open i-o genelfis.
    move 1 to genelfis-anahtar.
    read genelfis no lock invalid move 1 to ekran-fis-1.
 
    add 1 to ekran-fis-1.
   
    move ekran-fis-1(2:) to takas-no.
    rewrite genelfis-rec invalid write genelfis-rec.
    close genelfis.
    
    open output takas 
    close takas 
    open i-o takas with mass-update.
    initialize takas-rec.
 liste-ara-toplam.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-3 det-4 det-5 det-6
                 det-7 det-77 det-8 det-9 det-10 det-11 det-ham  
                 det-13  det-15 det-16 det-17  
                 det-100 det-101 det-103 det-102 
                 det-104 det-105 det-106 det-200 det-201
    write dokumer-rec from detay
    initialize dokumer-rec detay
    move "- Toplam -" to det-3.
    move a-oda        to z-goster.
  
    move z-goster     to det-5.
    move a-chi        to z-goster.
    move z-goster     to det-6.
    move a-fre        to z-goster.
    move z-goster     to det-7.
    move a-beb        to z-goster.
    move z-goster     to det-77.
*    move a-tl-tutar   to z-2.
*    move z-2          to det-12.
    move a-dv-tutar   to z-2.
    move z-2          to det-13.
*    move a-tl-toplam  to z-1.
*    move z-1          to det-14.
    move a-dv-toplam  to z-1.
    move z-1          to det-15.
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to  fil-3 fil-4 fil-5 fil-6
                fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-ham   
                fil-13  fil-15 fil-16 fil-17 
                fil-100 fil-101 fil-102 fil-103 
                fil-104 fil-105 fil-106 fil-200 fil-201
    perform acenta-yaz
    write dokumer-rec from detay.
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-3 det-4 det-5 det-6
                 det-7 det-77 det-8 det-9 det-10 det-11 det-ham  
                 det-13  det-15 det-16 det-17 
                 det-100 det-101 det-103 det-104 det-105 det-106
                 det-102 det-200 det-201 
    write dokumer-rec from detay.
 detay-ata.
    initialize dokumer-rec detay
    if takas-peryod = 0 or (takas-peryod =  1 and eski-tip = 0 ) then
        move takas-voucher       to det-11
    move takas-adi           to det-3
    move takas-soyadi        to det-4
    move takas-pax           to z-goster
    move z-goster            to det-5
    move takas-chi           to z-goster
    move z-goster            to det-6
    move takas-fre           to z-goster
    move z-goster            to det-7
    move takas-beb           to z-goster
    move z-goster            to det-77
   
   
    initialize kodlar02-rec
    move "D" to kodlar02-tipi
     move takas-anlasma to kodlar02-kodu
    read kodlar02 no lock invalid 
       move takas-anlasma to  det-200
       not invalid
       move kodlar02-adi  to  det-200
    end-read

    move takas-konum   to det-201

    move takas-gel-gun       to xgun
    move takas-gel-ay        to xay
    move takas-gel-yil       to xyil
    move xtarih to det-8
    move takas-git-gun       to xgun
    move takas-git-ay        to xay
    move takas-git-yil       to xyil
    move xtarih to det-9
    end-if
    move "X"              to det-10(1:)
    move takas-gece          to det-10(3:).
    move "GECE"              to det-10(7:)
    move takas-ode           to det-100.
    move takas-eb             to det-101.
    move takas-kick          to det-102.
    move takas-kick2          to det-104.
    move takas-special       to det-105.
    move takas-ozel          to det-106.
    move takas-ug            to det-103.
    move takas-ham           to z-2.
    move z-2                 to det-ham.
   
   
*    move takas-tl-tutar      to z-2.
*    move z-2                 to det-12.
    move takas-dv-tutar      to z-2.
    move z-2                 to det-13.   

    initialize doviz-rec.
    move takas-doviz         to doviz-kodu.   
         read doviz no lock invalid move all "*******" to d-kisa-adi. 
              move d-kisa-adi   to det-16.
    move takas-dv-degeri     to z-22.
    move z-22                to det-17.
  
**** Düzelt !!!

*    initialize takas-tl-toplam takas-dv-toplam.
*    compute takas-tl-toplam = takas-tl-tutar * takas-gece.
*    compute takas-dv-toplam = takas-dv-tutar * takas-gece.
*    move takas-tl-toplam     to z-1.
*    move z-1                 to det-14.
    move takas-dv-toplam     to z-1.
    move z-1                 to det-15.
    if takas-peryod = 0 or (takas-peryod =  1 and eski-tip = 0 ) then
    compute t-oda       = t-oda       + 1
    compute t-pax       = t-pax       + takas-pax
    compute t-chi       = t-chi       + takas-chi
    compute t-fre       = t-fre       + takas-fre
    compute t-beb       = t-beb       + takas-beb
    end-if
    compute t-tl-tutar  = t-tl-tutar  + takas-tl-tutar.
    compute t-dv-tutar  = t-dv-tutar  + takas-dv-tutar.
    compute t-tl-toplam = t-tl-toplam + takas-tl-toplam.
    compute t-dv-toplam = t-dv-toplam + takas-dv-toplam.
    if  takas-peryod = 0 or (takas-peryod =  1 and eski-tip = 0 )  then 
    compute a-oda       = a-oda       + 1
    compute a-pax       = a-pax       + takas-pax
    compute a-chi       = a-chi       + takas-chi
    compute a-fre       = a-fre       + takas-fre
    compute a-beb       = a-beb       + takas-beb
    end-if
    compute a-tl-tutar  = a-tl-tutar  + takas-tl-tutar.
    compute a-dv-tutar  = a-dv-tutar  + takas-dv-tutar.
    compute a-tl-toplam = a-tl-toplam + takas-tl-toplam.
    compute a-dv-toplam = a-dv-toplam + takas-dv-toplam.
    move "|" to  fil-3 fil-4 fil-5 fil-6
                fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-ham   
                fil-13  fil-15 fil-16 fil-17 
                fil-100 fil-101 fil-102 fil-103 
                fil-104 fil-105 fil-106 fil-200 fil-201
                       .
*
 acenta-yaz.
       open input acenta
       move kont-acenta to acenta-kodu 
       read acenta no lock invalid continue
       end-read
       move acenta-adi(1:10) to det-8
       move acenta-adi(11:1) to fil-8
       move acenta-adi(12:)  to det-9
       close acenta
       open input firma
       if acenta-tipi = 3 then 
         move kont-firma to firma-kodu
         read firma no lock invalid continue
         end-read
           move firma-adi(1:10) to det-8
           move firma-adi(11:1) to fil-8
           move firma-adi(12:)  to det-9
        end-if
        close firma
        .

*
 



      
*
 liste-toplam.
    
    initialize dokumer-rec detay

    move "Acenta Top" to det-3.
    if kont-firma not = spaces then 
        move "Firma Top" to det-3
  
    end-if
    add t-oda to gt-oda  mail-gt-oda 
    add t-pax to gt-pax
    add t-chi to gt-chi
    add t-fre to gt-fre
    add t-beb to gt-beb
    add t-tl-tutar  to gt-tl-tutar  
    add t-dv-tutar  to gt-dv-tutar  
    add t-tl-toplam to gt-tl-toplam    mail-gt-tl-toplam           
    add t-dv-toplam to gt-dv-toplam   mail-gt-dv-toplam    
  
  
  

    move t-oda        to z-goster.
    move z-goster     to det-11.
    move t-pax        to z-goster.
    move z-goster     to det-5.
    move t-chi        to z-goster.
    move z-goster     to det-6.
    move t-fre        to z-goster.
    move z-goster     to det-7.
    move t-beb        to z-goster.
    move z-goster     to det-77.
*    move t-tl-tutar   to z-2.
*    move z-2          to det-12.
    move t-dv-tutar   to z-2.
    move z-2          to det-13.
*    move t-tl-toplam  to z-1.
*    move z-1          to det-14.
    move t-dv-toplam  to z-1.
    move z-1          to det-15.
    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to  fil-3 fil-4 fil-5 fil-6
                fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-ham   
                fil-13  fil-15 fil-16 fil-17 
                fil-100 fil-101 fil-102 fil-103 
                fil-104 fil-105 fil-106 fil-200 fil-201.
    perform acenta-yaz     
    write dokumer-rec from detay.
    initialize dokumer-rec detay
*****************************************
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-3 det-4 det-5 det-6
                 det-7 det-77 det-8 det-9 det-10 det-11 det-ham   
                 det-13  det-15 det-16 det-17
                 det-100 det-101 det-102 det-103
                 det-104 det-105 det-106 
    write dokumer-rec from detay.

*
 g-liste-toplam.
    initialize dokumer-rec detay
    move "Genel Top." to det-3.
    move gt-oda        to z-goster.
    move z-goster     to det-11.
    move gt-pax        to z-goster.
    move z-goster     to det-5.
    move gt-chi        to z-goster.
    move z-goster     to det-6.
    move gt-fre        to z-goster.
    move z-goster     to det-7.
    move gt-beb        to z-goster.
    move z-goster     to det-77.
*    move gt-tl-tutar   to z-2.
*    move z-2          to det-12.
    move gt-dv-tutar   to z-2.
    move z-2          to det-13.
*    move gt-tl-toplam  to z-1.
*    move z-1          to det-14.
    move gt-dv-toplam  to z-1.
    move z-1          to det-15.

    add gt-tl-toplam to mail-gt-tl-toplam
    add gt-dv-toplam to mail-gt-dv-toplam
    add gt-oda       to mail-gt-oda

    move "A"          to det-dokumer-20(3:1)
    move 481          to det-renk1
    move "1"          to det-dokumer-20(10:1)
    move "|" to  fil-3 fil-4 fil-5 fil-6
                fil-7 fil-77 fil-8 fil-9 fil-10 fil-11 fil-ham   
                fil-13  fil-15 fil-16 fil-17 
                fil-100 fil-101 fil-102 fil-103 
                fil-104 fil-105 fil-106 fil-200 fil-201.

    write dokumer-rec from detay.
    initialize dokumer-rec detay
*****************************************
    initialize dokumer-rec detay
    move "-"            to det-dokumer-20(5:1)
    move all "-" to  det-3 det-4 det-5 det-6
                 det-7 det-77 det-8 det-9 det-10 det-11 det-ham   
                 det-13  det-15 det-16 det-17 
                 det-100 det-101 det-102 det-103 
                 det-104 det-105 det-106
    write dokumer-rec from detay.
    
*
 acc-07-Aft-Procedure.
      open input acenta
      if acn-kod = spaces 
        move "Tum Acentalar" to acenta-adi
      else 
      move acn-kod    to acenta-kodu
      read acenta no lock invalid
           move "Tanimsiz Acenta ..." to acenta-adi
           move 4 to accept-control
           move 12 to control-id
      end-read
      end-if.
      display lb-acenadi.
      close acenta. 
     
     .


     .
*
 gun-bul2.
     initialize gun-s

     move rez-gir-tar to takvim-anah
     start takvim key not < takvim-anah
         invalid 
             continue
          not invalid
             perform until fs-takvim = "10"
                read takvim next no lock
                    end move "10" to fs-takvim
                    not end
                      if takvim-anah >= rez-cik-tar
                          move "10" to fs-takvim
                        else
                          add 1 to gun-s                      end-if 
                end-read


              end-perform  
      end-start.
     .

*
 Tek-Rez-Takas.
 
    perform takas-dosya-ac.
    
    initialize rez-rec.

      move gelen-rez to rez-anah
*      open input rez
      
      read rez  no lock 
        invalid 
*         close rez
         display message box "Rezervasyon Bulunamadi"
         not invalid 
*                         close rez
                      perform tek-rez-yaz               
         end-read.
               .
 
*
 Form1-Cb-1ab-Ex-Cmd-Clicked.
       display Form1-Cb-1aa Form1-Cb-1a
     .
*
 tek-rez-yaz.
              move rez-odeme-tipi to kodlar02-kodu 
              move "B" to kodlar02-tipi
              read kodlar02 no lock invalid
                exit paragraph
                not invalid
                if Ode-Tipi not = "A" and  Ode-Tipi not = "B"
                   exit paragraph
               end-if
                end-read

                            initialize takas-rec
                 move rez-gir-tar  to takas-gel-tar konuk-gel-tar
                         move rez-cik-tar  to takas-git-tar konuk-git-tar
                         move rez-no    to takas-folio konuk-rez-no
                         move rez-acenta to takas-acenta konuk-acenta
                           move rez-firma to takas-firma
                         if ONKPARA-REFERANS-VAR   = 1 
                           move  xkonum-ref(rez-fiyat-konumu)  to takas-referans
                         end-if

                         if rez-eb = "E" then 
                             move rez-eb      to takas-eb-ayrisayfa
                         end-if

                         read takas no lock invalid continue,end-read
                         move rez-odano    to takas-oda konuk-odano
                         move rez-adi      to takas-adi konuk-adi
                         move rez-anlasma  to takas-anlasma konuk-anlasma
                         move REZ-AL-TAR(5:4)  to takas-isl
                      
                         if function numval (rez-al-tar(1:6)) < 200100 then
                            move REZ-isl-TAR(5:4)  to takas-isl
                         end-if
                         move rez-fiyat-konumu to konum-anahtar
                         
                         read konum no lock invalid 
                            initialize konum-adi
                           
                         end-read
                         move rez-not1 to takas-not 
                         move rez-not2 to takas-not(21:)
                         move konum-adi to takas-konum
                         move rez-soyadi   to takas-soyadi konuk-soyadi
                         move rez-buyuk    to takas-pax konuk-buyuk
                         move rez-kucuk    to takas-chi konuk-kucuk
                         move rez-free     to takas-fre konuk-free
                         move rez-bebek    to takas-beb konuk-bebek
                         move rez-voucher  to takas-voucher konuk-voucher
                       if rez-gec = 1 then 
                          move "*"  to takas-gec-giris
                          else
                          move " " to takas-gec-giris
                       end-if
                         perform gece-al thru gece-al-exit
                         compute takas-tl-tutar = konuk-oda-tutar          +
                                 konuk-extbed-tutar + konuk-kahvalti-tutar +
                                 konuk-ogle-tutar   + konuk-aksam-tutar    +
                                 konuk-icecek-tutar + konuk-extra-tutar
                         move rez-doviz        to takas-doviz konuk-doviz 
        
         move konuk-gel-yil      to kur-yil takvim-yil 
         move konuk-gel-ay       to kur-ay  takvim-ay 
         move konuk-gel-gun      to kur-gun takvim-gun 
         move rez-banka          to kur-banka konuk-banka  
         move Rez-Doviz          to kur-doviz konuk-doviz
         if rez-cin-kuru > 0 and rez-cin-kuru <100 then 
             move rez-cin-kuru to doviz-alis ,
           else
         
         if rez-kur-aygun = "A" move 01 to kur-gun end-if 
         start takvim key <= takvim-anah 
          invalid continue
          not invalid
            move 0 to doviz-bulundu
           perform until doviz-bulundu = 1 or fs-takvim= "10"
            read takvim previous 
              at end move "10" to fs-takvim
              not end
               move takvim-anah to kur-tarih
               read kur no lock 
                   invalid continue
                   not invalid move 1 to doviz-bulundu
                   
               end-read
             end-read
            end-perform
         end-start
        
         end-if
           if  doviz-alis = 0       move 1 to doviz-alis  end-if
         move doviz-alis          to takas-dv-degeri
          MOVE doviz-alis to KONUK-KUR-DEGERI  TAKAS-DV-DEGERI
              compute takas-dv-tutar rounded = takas-tl-tutar / takas-dv-degeri

          move rez-gir-tar to ay-basi  ay-sonu
           move 99 to ay-sonu-gun
           move 01 to ay-basi-gun
           move ay-sonu to takvim-anah
             start takvim key < takvim-anah invalid continue
                not invalid 
                 read takvim previous no lock end continue 
                 end-read 
             end-start
             move takvim-anah to ay-sonu

         if ay-ayir = 1 then 
            continue
          else
              if eski-tip = 1 
                   continue
                  else
                    initialize hesayr-rec
                    move rez-no to hesayr-rez-no
                    start hesayr key > hesayr-anah
                     invalid
                      write takas-rec invalid 
                       rewrite takas-rec,
                      end-write 
                    not invalid
                         move 9 to son-peryot 
                          perform until fs-hesayr = "10"
                               read hesayr next no lock 
                                  end move "10" to fs-hesayr
                                  not end
                                   if hesayr-rez-no not = rez-no then 
                                         move "10" to fs-hesayr
                                         else
                                            if son-peryot = 9 then
                                               if hesayr-tarih < rez-gir-tar then 
                                                  move hesayr-tarih to takas-gel-tar

                                               end-if
                                               move hesayr-per to son-peryot takas-peryod
                                                    move hesayr-aks1-acik    to takas-ode 
                                                    move hesayr-eb-acik      to takas-eb                  
                                                    move hesayr-ug-acik      to takas-ug                  
                                                    move hesayr-kb-acik      to takas-kick                
                                                    move hesayr-kkp-acik     to takas-kick2               
                                                    move hesayr-so1-acik     to takas-special             
                                                     if hesayr-so2-acik not = spaces
                                                       move hesayr-so2-acik     to takas-special
                                                   end-if
                                                    move hesayr-ozl-acik     to takas-ozel
                                                    move hesayr-ham-fiyat    to takas-ham
                                                   move rez-adi      to  takas-adi   
                                                   move rez-soyadi   to   takas-soyadi              
                                                   move rez-buyuk    to   takas-pax                 
                                                   move rez-kucuk    to   takas-chi                 
                                                   move rez-free      to   takas-fre                 
                                                   move  rez-bebek    to   takas-beb                 
                                                              
                                                   move rez-voucher to takas-voucher             
                                                   compute   takas-tl-tutar rounded = KONUK-KUR-DEGERI
                                                        *  hesayr-basilacak-tut
                                                   move hesayr-basilacak-tut to  takas-dv-tutar            
                                                   move rez-banka            to   takas-banka               
                                                   move rez-doviz            to   takas-doviz               
                                                   move KONUK-KUR-DEGERI     to   takas-dv-degeri           
                                                   add  takas-tl-tutar to  takas-tl-toplam           
                                                   add  takas-dv-tutar to  takas-dv-toplam           
                                                   move rez-anlasma     to   takas-anlasma
                                                   move 1 to takas-gece
                                                   else
                                                 if  hesayr-per = son-peryot
                                                     add  takas-tl-tutar to  takas-tl-toplam           
                                                     add  takas-dv-tutar to  takas-dv-toplam 
                                                     add 1 to takas-gece
                                                      else
                                                    write takas-rec invalid stop " " end-write
                                                   move 1 to takas-gece
                                                    initialize takas-tl-toplam takas-dv-toplam
                                                      move hesayr-per to son-peryot takas-peryod
                                                    move hesayr-aks1-acik    to takas-ode 
                                                    move hesayr-eb-acik      to takas-eb                  
                                                    move hesayr-ug-acik      to takas-ug                  
                                                    move hesayr-kb-acik      to takas-kick                
                                                    move hesayr-kkp-acik     to takas-kick2               
                                                    move hesayr-so1-acik     to takas-special             
                                                    move hesayr-ozl-acik     to takas-ozel 
                                                    move hesayr-ham-fiyat    to takas-ham
                                                    move hesayr-ham-fiyat    to takas-ham

                                                     compute   takas-tl-tutar rounded = KONUK-KUR-DEGERI
                                                        *  hesayr-basilacak-tut
                                                   move hesayr-basilacak-tut to  takas-dv-tutar            
                                                   move rez-banka            to   takas-banka               
                                                   move rez-doviz            to   takas-doviz               
                                                   move KONUK-KUR-DEGERI     to   takas-dv-degeri           
                                                   add  takas-tl-tutar to  takas-tl-toplam           
                                                   add  takas-dv-tutar to  takas-dv-toplam           
                                                   move rez-anlasma     to   takas-anlasma        



                                                 end-if
                                            end-if

                                    end-if
                               end-read
                          end-perform 

                    end-start
                    write takas-rec  invalid rewrite takas-rec end-write
              end-if

          end-if




 
 


        .



**
 acuserve-adres-aktar.
    move muha-sirketi of genel-rec to CARI-DOSYA-adres         
                         ISLENEN-DOSYA-adres      
                         HESAP-DOSYA-adres        
                         MAHSUP-DOSYA-adres       
                          
                         REFERANS-DOSYA-adres     
                         Mgenel-DOSYA-adres       
                        
                       
                

    move all low-values to      
                           CARI-ACUSERVE-DOSYA       
                           ISLENEN-ACUSERVE-DOSYA    
                           HESAP-ACUSERVE-DOSYA      
                           MAHSUP-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA   
                           REFERANS-ACUSERVE-DOSYA   
                           Mgenel-ACUSERVE-DOSYA     
                           genelfis-ACUSERVE-DOSYA  
                           ip-no.


    inspect genel-muha-uzak-ip 
            replacing trailing spaces by low-values.

    if genel-muha-uzak-ip <> low-values
       move all low-values to ip-no
       string ip-no,
              "@" delimited by low-values
              genel-muha-uzak-ip delimited by low-values
              ":" delimited by low-values
              into ip-no
    end-if

    string mgenel-acuserve-dosya,
           ip-no                        delimited by low-values
           mgenel-dosya                    delimited by low-values
           into mgenel-acuserve-dosya.
    string genelfis-acuserve-dosya,
           ip-no                        delimited by low-values
           genelfis-dosya                 delimited by low-values
           into genelfis-acuserve-dosya.

    
    string hesap-acuserve-dosya,
           ip-no                        delimited by low-values
           hesap-dosya                 delimited by low-values
           into hesap-acuserve-dosya.
    string mahsup-acuserve-dosya,
           ip-no                        delimited by low-values
           mahsup-dosya                 delimited by low-values
           into mahsup-acuserve-dosya.
    string cari-acuserve-dosya,
           ip-no                        delimited by low-values
           cari-dosya                 delimited by low-values
           into cari-acuserve-dosya.
    string islenen-acuserve-dosya,
           ip-no                        delimited by low-values
           islenen-dosya               delimited by low-values
           into islenen-acuserve-dosya.
    string referans-acuserve-dosya,
           ip-no                        delimited by low-values
           referans-dosya                delimited by low-values
           into referans-acuserve-dosya.
    

    inspect CARI-ACUSERVE-DOSYA        replacing  all spaces by low-values
    inspect ISLENEN-ACUSERVE-DOSYA     replacing  all spaces by low-values
    inspect HESAP-ACUSERVE-DOSYA       replacing  all spaces by low-values
    inspect MAHSUP-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect genelfis-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect REFERANS-ACUSERVE-DOSYA    replacing  all spaces by low-values
    inspect mgenel-ACUSERVE-DOSYA      replacing  all spaces by low-values
    inspect genelfis-ACUSERVE-DOSYA    replacing  all spaces by low-values.
*
 yan-detay-ata.
     initialize yanrez-rec
     move takas-folio          to yanrez-rezno
     start yanrez key not < yanrez-anah invalid
           continue
     not invalid
     perform with test after until fs-yanrez = "10"
     read yanrez next no lock end move "10"  to fs-yanrez
     not at end
            initialize dokumer-rec detay
            if yanrez-rezno <> takas-folio
               exit perform
            end-if

            if yanrez-sirano > 1 then 
                move yanrez-adi       to det-3
                move yanrez-soyadi    to det-4
                write dokumer-rec from detay
                initialize dokumer-rec detay
                   move "-"            to det-dokumer-20(5:1)
                   move all "-" to  det-3 det-4 det-5 det-6
                 det-7 det-77 det-8 det-9 det-10 det-11 det-ham   
                 det-13  det-15 det-16 det-17 
                 det-100 det-101 det-102 det-103
                 det-104 det-105 det-106 
                write dokumer-rec from detay
           end-if


     end-read
     end-perform
     end-start
     .

************MAILLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL

 mail-send-process.
     initialize mailsend-link 
                ek-dosya

     perform mail-send-call-csvyap.
     perform mail-send-add-mail-attach.
     perform mail-send-call-mail.



 mail-send-call-csvyap.
      add 1 to ek-dosya.
      initialize csvyap-link
      call "c$calledby" using  csvyap-link-called-program
      set csvyap-link-islem-xls-yap         to true
      call "/asya/ytl/obj/otel/csvyap.asy" using  csvyap-link on exception 
            perform callerr-proc
            exit paragraph
      not on exception
      cancel "/asya/ytl/obj/otel/csvyap.asy"
      end-call
      exit paragraph.


      initialize csv2xls-link
      move csvyap-link-nereye-cek         to csv2xls-link-girdi
      move all low-values                 to csv2xls-link-cikti
      set csv2xls-lik-girdi-asciiye-cevir to true
*****************mamiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
      string csv2xls-link-cikti
             "@[DISPLAY]:C:\acucorp\acucbl701\acugt\pdf_temp\"        delimited by low-values
             "11.08.2011_tarihli_dosya"                               delimited by low-values
             ek-dosya                                                 delimited by low-values
             into csv2xls-link-cikti
*****************mamiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
      inspect csv2xls-link-cikti replacing all space by "_"

      perform csv2xls.

 csv2xls.
    inspect csv2xls-link-cikti            
            converting x"98" to x"49"
*x9e => b-y-k s 
    inspect csv2xls-link-cikti
            converting x"9E" to x"53"
*x99 => =
    inspect csv2xls-link-cikti
            converting x"99" to x"4F"
*x9A => -
    inspect csv2xls-link-cikti
            converting x"9A" to x"55"
*x9A => +
    inspect csv2xls-link-cikti
            converting x"80" to x"43"
*x9A => yumusak G
    inspect csv2xls-link-cikti
            converting x"A6" to x"47"
****** KUCUK KARAKTERLER
*x9A => yumusak G
    inspect csv2xls-link-cikti
            converting x"A7" to x"67"
* kucuk i noktasizi
    inspect csv2xls-link-cikti
            converting x"8D" to x"69"
* kucuk - 
    inspect csv2xls-link-cikti
            converting x"81" to x"75"
* kucuk _ 
    inspect csv2xls-link-cikti
            converting x"87" to x"63"
* kucuk s  
    inspect csv2xls-link-cikti
            converting x"9F" to x"73"
* kucuk s  
    inspect csv2xls-link-cikti
            converting x"94" to x"6F"

     call "/asya/ytl/obj/otel/csv2xls.asy" using csv2xls-link
          on exception 
             perform callerr-proc
          not on exception
     cancel "/asya/ytl/obj/otel/csv2xls.asy"
     end-call.

 mail-send-add-mail-attach.
    move csvyap-link-nereye-cek               to  csv2xls-link-cikti(12:)

    if not csv2xls-link-hata 
       add  1                                               to ek-dosya
       move csv2xls-link-cikti(12:)                         to mailsend-link-dosya(ek-dosya) 
       move csv2xls-link-cikti(48:)                         to mailsend-link-dosya-aciklama(ek-dosya)
*       move csv2xls-link-cikti(12:)                         to mailsend-link-dosya(ek-dosya) 
*       move csv2xls-link-cikti(48:)                         to mailsend-link-dosya-aciklama(ek-dosya)
       inspect mailsend-link-dosya(ek-dosya) replacing trailing spaces by low-values
       inspect mailsend-link-dosya-aciklama(ek-dosya) replacing trailing spaces by low-values
       move ".xls"                         to mailsend-link-dosya-ext(ek-dosya)
    end-if.


 mail-send-call-mail.
       open input otomail
*****************mamiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
      move acenta-kodu to otomail-acenta-kodu
      move "A" to otomail-tipi
       read otomail no lock invalid 
            continue
       end-read
        initialize mail-aciklama
       move mail-gt-oda to z-oda
       move mail-gt-tl-toplam to z-tl
       move mail-gt-dv-toplam to z-dv
      
     string  mail-aciklama delimited by "    "
             "Acentaniza ait " delimited by size
             z-oda delimited by size
             " adet rezervasyon bedeli " delimited by size
             new-line delimited by size
             z-dv delimited by size
             d-kisa-adi delimited by size
             " dir." delimited by size
             new-line delimited by size
             "Rezervasyon ve fiyat detaylari ektedir."  delimited by size
             new-line delimited by size
             new-line delimited by size
             "Bilginize...."  delimited by size
             into mail-aciklama


     move otomail-kime      to mailsend-link-to
     move   otomail-cc to mailsend-link-bilgi  .
     move  otomail-konu  to  mailsend-link-konu .
       string otomail-ustyazi delimited by "     "
              new-line delimited by size
              new-line delimited by size
              mail-aciklama delimited by  "                             "
              new-line delimited by size
              otomail-altyazi delimited by  "     "
           into  mailsend-link-aciklama(1)
      close otomail
      move   mail-altlik to  mailsend-link-aciklama(2)
      move   mail-altlik2 to  mailsend-link-aciklama(3)
      if genel-oto-proforma-aktif  = 1
         move 1 to mailsend-link-konu(99:1) |otomatik gitmesi için yapýldý 
      end-if 

*****************mamiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
     call "/asya/ytl/obj/otel/mailsend.asy" using mailsend-link
          on exception 
             perform callerr-proc
     not on exception
          cancel "/asya/ytl/otel/otel/mailsend.asy"
     end-call.
***************MAILLLLLLLLLLLLLLLL
*
 Form1-Pb-3-Link.
      
            initialize xlink-otopro-gunsonunda-calis xgelen-folio xgelen-rez
            move 1  to xlink-otopro-gunsonunda-calis
             move 5159457 to xgelen-rez
            call "/asya/ytl/obj/otel/otopro.asy"
              using xgelen-folio , xgelen-rez 
              on exception 
                perform callerr-proc
              not on exception
                cancel "/asya/ytl/obj/otel/otopro.asy"
             end-call.                                         

 
